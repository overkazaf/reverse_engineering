# è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®

## æ¦‚è¿°

è°ƒè¯•æ˜¯é€†å‘å·¥ç¨‹çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æŒæ¡é«˜çº§è°ƒè¯•æŠ€å·§å¯ä»¥å¤§å¹…æå‡é€†å‘æ•ˆç‡ï¼Œå¿«é€Ÿå®šä½å…³é”®ä»£ç ï¼Œç†è§£ç¨‹åºé€»è¾‘ã€‚

---

## ğŸ“š å‰ç½®çŸ¥è¯†

åœ¨å¼€å§‹æœ¬é…æ–¹ä¹‹å‰ï¼Œå»ºè®®å…ˆæŒæ¡ä»¥ä¸‹å†…å®¹ï¼š

| çŸ¥è¯†é¢†åŸŸ | é‡è¦ç¨‹åº¦ | å‚è€ƒèµ„æ–™ |
|----------|---------|---------|
| Chrome DevTools åŸºç¡€ | å¿…éœ€ | [æµè§ˆå™¨å¼€å‘è€…å·¥å…·](../02-Tooling/browser_devtools.md) |
| JavaScript åŸºç¡€ | å¿…éœ€ | [JavaScript åŸºç¡€](../01-Foundations/javascript_basics.md) |
| JavaScript æ‰§è¡Œæœºåˆ¶ | æ¨è | [JavaScript æ‰§è¡Œæœºåˆ¶](../01-Foundations/javascript_execution_mechanism.md) |

> ğŸ’¡ **æç¤º**: è°ƒè¯•æ˜¯é€†å‘å·¥ç¨‹çš„åŸºæœ¬åŠŸã€‚æœ¬é…æ–¹è¯¦ç»†ä»‹ç»å„ç§æ–­ç‚¹ç±»å‹å’Œè°ƒè¯•æŠ€å·§ï¼Œæ˜¯æ·±å…¥åˆ†ææ··æ·†ä»£ç çš„å¿…å¤‡æŠ€èƒ½ã€‚

---

## æ–­ç‚¹ç±»å‹

### 1. è¡Œæ–­ç‚¹ (Line Breakpoint)

æœ€åŸºæœ¬çš„æ–­ç‚¹ç±»å‹ï¼Œç‚¹å‡»è¡Œå·å³å¯è®¾ç½®ã€‚

**å¿«æ·é”®**:

- è®¾ç½®/å–æ¶ˆæ–­ç‚¹: ç‚¹å‡»è¡Œå·
- ç¦ç”¨æ‰€æœ‰æ–­ç‚¹: `Ctrl+F8` (Windows) / `Cmd+F8` (Mac)

**æŠ€å·§**:

- åœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹
- åœ¨å¯ç–‘çš„åŠ å¯†ã€ç­¾åå‡½æ•°å¤„è®¾ç½®

### 2. æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)

åªæœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰è§¦å‘çš„æ–­ç‚¹ã€‚

**è®¾ç½®æ–¹æ³•**:

1. å³é”®è¡Œå·
2. é€‰æ‹© "Add conditional breakpoint"
3. è¾“å…¥æ¡ä»¶è¡¨è¾¾å¼

**ç¤ºä¾‹**:

```javascript
// åªæœ‰å½“ user_id ä¸º 12345 æ—¶æ‰æ–­ç‚¹
user_id === 12345;

// åªæœ‰å½“å‚æ•°åŒ…å« 'admin' æ—¶æ‰æ–­ç‚¹
params.username.includes("admin");

// å¾ªç¯ä¸­æ¯ 100 æ¬¡æ‰æ–­ç‚¹
i % 100 === 0;
```

**ä½¿ç”¨åœºæ™¯**:

- å¤§é‡å¾ªç¯ä¸­å®šä½ç‰¹å®šæ•°æ®
- å¤šæ¬¡è°ƒç”¨çš„å‡½æ•°ä¸­å®šä½ç‰¹å®šå‚æ•°

### 3. æ—¥å¿—ç‚¹ (Logpoint)

ä¸æš‚åœæ‰§è¡Œï¼Œåªè¾“å‡ºæ—¥å¿—ã€‚

**è®¾ç½®æ–¹æ³•**:

1. å³é”®è¡Œå·
2. é€‰æ‹© "Add logpoint"
3. è¾“å…¥è¦è¾“å‡ºçš„è¡¨è¾¾å¼

**ç¤ºä¾‹**:

```javascript
// è¾“å‡ºå˜é‡å€¼
"User ID:", user_id;

// è¾“å‡ºå¯¹è±¡
"Params:", params;

// è¾“å‡ºå‡½æ•°è¿”å›å€¼
"Result:", calculateSign(params);
```

**ä¼˜åŠ¿**:

- ä¸å½±å“ä»£ç æ‰§è¡Œæµç¨‹
- é€‚åˆè¿½è¸ªå˜é‡å˜åŒ–
- æ¯”æ’å…¥ console.log æ›´æ–¹ä¾¿

### 4. DOM æ–­ç‚¹ (DOM Breakpoint)

ç›‘æ§ DOM å˜åŒ–ã€‚

**ç±»å‹**:

- **Subtree modifications**: å­èŠ‚ç‚¹å˜åŒ–
- **Attribute modifications**: å±æ€§å˜åŒ–
- **Node removal**: èŠ‚ç‚¹ç§»é™¤

**ä½¿ç”¨åœºæ™¯**:

- è¿½è¸ªåŠ¨æ€ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡
- è¿½è¸ªä»·æ ¼æ•°æ®çš„åŠ¨æ€æ›´æ–°
- è¿½è¸ªè¡¨å•çš„è‡ªåŠ¨å¡«å……

**è®¾ç½®æ–¹æ³•**:

1. Elements é¢æ¿é€‰ä¸­å…ƒç´ 
2. å³é”® -> Break on
3. é€‰æ‹©æ–­ç‚¹ç±»å‹

### 5. XHR/Fetch æ–­ç‚¹

åœ¨ç½‘ç»œè¯·æ±‚å‘é€æ—¶è§¦å‘æ–­ç‚¹ã€‚

**è®¾ç½®æ–¹æ³•**:

1. Sources é¢æ¿
2. å³ä¾§ "XHR/fetch Breakpoints"
3. è¾“å…¥ URL å…³é”®è¯

**ç¤ºä¾‹**:

```
/api/login
/api/user/info
sign
token
```

**ä½¿ç”¨åœºæ™¯**:

- å¿«é€Ÿå®šä½ API è°ƒç”¨ä»£ç 
- è¿½è¸ªè¯·æ±‚å‚æ•°ç”Ÿæˆé€»è¾‘

### 6. äº‹ä»¶æ–­ç‚¹ (Event Listener Breakpoint)

åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶æ–­ç‚¹ã€‚

**å¸¸ç”¨äº‹ä»¶**:

- Mouse -> click
- Mouse -> mousedown/mouseup
- Keyboard -> keydown/keyup
- Form -> submit
- Timer -> setTimeout/setInterval

**ä½¿ç”¨åœºæ™¯**:

- ä¸çŸ¥é“ç‚¹å‡»äº‹ä»¶ç»‘å®šåœ¨å“ªé‡Œ
- è¿½è¸ªè¡¨å•æäº¤é€»è¾‘
- è¿½è¸ªå®šæ—¶å™¨ä¸­çš„åè°ƒè¯•ä»£ç 

---

## å•æ­¥æ‰§è¡Œ

### å¿«æ·é”®

| æ“ä½œ | Windows/Linux | Mac | è¯´æ˜ |
| ------------- | ------------- | ----------- | -------------------- |
| **Step Over** | `F10` | `F10` | è·³è¿‡å‡½æ•°ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œ |
| **Step Into** | `F11` | `F11` | è¿›å…¥å‡½æ•°å†…éƒ¨ |
| **Step Out** | `Shift+F11` | `Shift+F11` | è·³å‡ºå½“å‰å‡½æ•° |
| **Continue** | `F8` | `F8` | ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ |
| **Resume** | `F8` | `F8` | æ¢å¤è„šæœ¬æ‰§è¡Œ |

### ä½¿ç”¨æŠ€å·§

**Step Over vs Step Into**:

- å¦‚æœä¸‹ä¸€è¡Œæ˜¯åº“å‡½æ•°ï¼ˆå¦‚ `JSON.stringify`ï¼‰ï¼Œç”¨ **Step Over**
- å¦‚æœä¸‹ä¸€è¡Œæ˜¯ä¸šåŠ¡å‡½æ•°ï¼ˆå¦‚ `generateSign`ï¼‰ï¼Œç”¨ **Step Into**

**Step Out**:

- è¿›é”™å‡½æ•°äº†ï¼Ÿç”¨ **Step Out** å¿«é€Ÿè¿”å›

**Continue**:

- å¾ªç¯ä¸­ä¸æƒ³ä¸€æ­¥æ­¥æ‰§è¡Œï¼Ÿåœ¨å¾ªç¯åè®¾ç½®æ–­ç‚¹ï¼Œç”¨ **Continue** è·³è¿‡

---

## è°ƒç”¨æ ˆåˆ†æ (Call Stack)

### æŸ¥çœ‹è°ƒç”¨æ ˆ

æ–­ç‚¹åœä¸‹åï¼Œå³ä¾§ Call Stack é¢æ¿æ˜¾ç¤ºå‡½æ•°è°ƒç”¨é“¾ï¼š

```
generateRequest (main.js:123)
|- getData (utils.js:45)
|- onClick (app.js:789)
|- <anonymous>
```

### ä½¿ç”¨æŠ€å·§

1. **ä»ä¸‹å¾€ä¸Šçœ‹**: æœ€ä¸‹é¢æ˜¯äº‹ä»¶å…¥å£ï¼Œæœ€ä¸Šé¢æ˜¯å½“å‰ä½ç½®
2. **ç‚¹å‡»è·³è½¬**: ç‚¹å‡»ä»»æ„ä¸€å±‚å¯ä»¥æŸ¥çœ‹è¯¥å±‚çš„ä»£ç å’Œå˜é‡
3. **è¿‡æ»¤åº“æ–‡ä»¶**: å³é”® -> Blackbox scriptï¼Œéšè—ç¬¬ä¸‰æ–¹åº“

---

## Scope å˜é‡æŸ¥çœ‹

### ä½œç”¨åŸŸç±»å‹

- **Local**: å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡
- **Closure**: é—­åŒ…å˜é‡
- **Global**: å…¨å±€å˜é‡

### æŠ€å·§

**æŸ¥çœ‹å¤æ‚å¯¹è±¡**:

- å³é”® -> Store as global variable
- åœ¨ Console ä¸­æ“ä½œè¯¥å˜é‡ï¼ˆä¼šè‡ªåŠ¨å‘½åä¸º `temp1`, `temp2`...ï¼‰

**ä¿®æ”¹å˜é‡**:

- åŒå‡»å˜é‡å€¼å¯ä»¥ç›´æ¥ä¿®æ”¹
- ç”¨äºæµ‹è¯•ä¸åŒå‚æ•°çš„å½±å“

---

## Console è°ƒè¯•æŠ€å·§

### æ¡ä»¶è¾“å‡º

```javascript
// åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰è¾“å‡º
if (user_id === 12345) {
console.log("Target user:", user_id);
}
```

### åˆ†ç»„è¾“å‡º

```javascript
console.group("User Info");
console.log("ID:", user_id);
console.log("Name:", username);
console.groupEnd();
```

### è¡¨æ ¼è¾“å‡º

```javascript
const users = [
{ id: 1, name: "Alice" },
{ id: 2, name: "Bob" },
];
console.table(users);
```

### æ€§èƒ½æµ‹é‡

```javascript
console.time("encrypt");
// ... åŠ å¯†ä»£ç 
console.timeEnd("encrypt"); // encrypt: 12.345ms
```

### å †æ ˆè¿½è¸ª

```javascript
console.trace("Where am I?");
```

---

## é«˜çº§è°ƒè¯•æŠ€å·§

### 1. Blackbox ç¬¬ä¸‰æ–¹åº“

é¿å…è°ƒè¯•æ—¶è¿›å…¥ jQueryã€React ç­‰ç¬¬ä¸‰æ–¹åº“ï¼š

**æ–¹æ³•ä¸€**:

1. Settings -> Blackboxing
2. æ·»åŠ æ¨¡å¼ï¼š`/node_modules/`, `/jquery.*.js`

**æ–¹æ³•äºŒ**:

- åœ¨ Call Stack ä¸­å³é”® -> Blackbox script

### 2. å¼‚æ­¥ä»£ç è°ƒè¯•

**é—®é¢˜**: å¼‚æ­¥ä»£ç æ–­ç‚¹åï¼ŒCall Stack æ–­è£‚ã€‚

**è§£å†³**: å‹¾é€‰ "Async" æŒ‰é’®ï¼ˆCall Stack ä¸Šæ–¹ï¼‰ï¼Œæ˜¾ç¤ºå®Œæ•´å¼‚æ­¥è°ƒç”¨æ ˆã€‚

### 3. Source Map

**é—®é¢˜**: ç”Ÿäº§ç¯å¢ƒä»£ç è¢«å‹ç¼©/æ··æ·†ï¼Œæ— æ³•è°ƒè¯•ã€‚

**è§£å†³**: å¦‚æœæœ‰ Source Map æ–‡ä»¶ï¼ˆ`.map`ï¼‰ï¼ŒDevTools ä¼šè‡ªåŠ¨åŠ è½½åŸå§‹ä»£ç ã€‚

### 4. Local Overrides (æœ¬åœ°æ›¿æ¢)

**ç”¨é€”**: ä¿®æ”¹çº¿ä¸Š JS æ–‡ä»¶å¹¶ä¿å­˜ï¼Œåˆ·æ–°åä¾ç„¶ç”Ÿæ•ˆã€‚

**æ­¥éª¤**:

1. Sources -> Overrides
2. é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¤¹
3. ä¿®æ”¹æ–‡ä»¶å¹¶ä¿å­˜ (`Ctrl+S`)

**åº”ç”¨**:

- åˆ é™¤åè°ƒè¯•ä»£ç 
- æ·»åŠ æ—¥å¿—è¾“å‡º
- ä¿®æ”¹åŠ å¯†é€»è¾‘æµ‹è¯•

### 5. Snippets (ä»£ç ç‰‡æ®µ)

**ç”¨é€”**: ä¿å­˜å¸¸ç”¨çš„ Hook è„šæœ¬ï¼Œå¿«é€Ÿæ‰§è¡Œã€‚

**æ­¥éª¤**:

1. Sources -> Snippets
2. æ–°å»º Snippet
3. ç²˜è´´è„šæœ¬ï¼Œ`Ctrl+Enter` æ‰§è¡Œ

---

## åè°ƒè¯•å¯¹æŠ—

### 1. æ— é™ debugger

**ç‰¹å¾**:

```javascript
setInterval(() => {
debugger;
}, 100);
```

**ç»•è¿‡æ–¹æ³•**:

- **æ–¹æ³•ä¸€**: å³é”®æ–­ç‚¹è¡Œ -> "Never pause here"
- **æ–¹æ³•äºŒ**: Hook `Function.prototype.constructor` (è§ [Hook è„šæœ¬](../07-Scripts/javascript_hook_scripts.md))
- **æ–¹æ³•ä¸‰**: Local Overrides åˆ é™¤è¯¥æ®µä»£ç 

### 2. æ£€æµ‹ DevTools æ‰“å¼€

**ç‰¹å¾**:

```javascript
setInterval(() => {
if (window.outerWidth - window.innerWidth > 160) {
alert("DevTools detected!");
window.location.href = "about:blank";
}
}, 1000);
```

**ç»•è¿‡æ–¹æ³•**:

- ä½¿ç”¨ç‹¬ç«‹çª—å£æ¨¡å¼ï¼ˆUndock into separate windowï¼‰
- Hook `window.outerWidth` å’Œ `window.innerWidth`

### 3. æ£€æµ‹æ—¶é—´å·®

**ç‰¹å¾**:

```javascript
let start = Date.now();
debugger;
let end = Date.now();
if (end - start > 100) {
console.log("Debugger detected!");
}
```

**ç»•è¿‡æ–¹æ³•**:

- Hook `Date.now()` è¿”å›å›ºå®šå¢é‡

---

## å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ä¸€ï¼šè¿½è¸ªåŠ å¯†å‡½æ•°

**ç›®æ ‡**: æ‰¾åˆ°ç”Ÿæˆ `sign` å‚æ•°çš„å‡½æ•°

**æ­¥éª¤**:

1. Network é¢æ¿æ‰¾åˆ°åŒ…å« `sign` çš„è¯·æ±‚
2. å…¨å±€æœç´¢ `sign`ï¼ˆå¯èƒ½æœ‰ä¸Šç™¾ä¸ªç»“æœï¼‰
3. è®¾ç½® XHR æ–­ç‚¹ï¼ŒURL å¡« `/api/`
4. åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹åœä¸‹
5. æŸ¥çœ‹ Call Stackï¼Œå®šä½åˆ° `generateSign` å‡½æ•°
6. å•æ­¥è°ƒè¯•ï¼Œç†è§£åŠ å¯†é€»è¾‘

### ç¤ºä¾‹äºŒï¼šç»•è¿‡æ»‘å—éªŒè¯ç 

**ç›®æ ‡**: åˆ†ææ»‘å—éªŒè¯é€»è¾‘

**æ­¥éª¤**:

1. å³é”®æ»‘å—å…ƒç´  -> Break on -> Attribute modifications
2. æ‹–åŠ¨æ»‘å—ï¼Œæ–­ç‚¹åœä¸‹
3. æŸ¥çœ‹ Call Stackï¼Œæ‰¾åˆ°éªŒè¯å‡½æ•°
4. åˆ†æè½¨è¿¹ç”Ÿæˆå’ŒéªŒè¯é€»è¾‘

---

## ç›¸å…³ç« èŠ‚

- [JavaScript Hook è„šæœ¬](../07-Scripts/javascript_hook_scripts.md)
- [æµè§ˆå™¨å¼€å‘è€…å·¥å…·](../02-Tooling/browser_devtools.md)
- [é€†å‘å·¥ç¨‹å·¥ä½œæµ](./re_workflow.md)
