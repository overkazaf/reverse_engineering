---
title: "Native å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘"
date: 2024-12-01
weight: 10
---

# Native å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘

> **ğŸ“š å‰ç½®çŸ¥è¯†**
>
> æœ¬é…æ–¹æ¶‰åŠä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼Œå»ºè®®å…ˆé˜…è¯»ç›¸å…³ç« èŠ‚ï¼š
>
> - **[SO/ELF æ ¼å¼](../../04-Reference/Foundations/so_elf_format.md)** - ç†è§£ .rodata æ®µä¸ç¬¦å·è¡¨
> - **[IDA Pro æŒ‡å—](../../02-Tools/Static/ida_pro_guide.md)** - ä½¿ç”¨ IDA è¿›è¡Œé™æ€åˆ†æ

åœ¨ Android Native å¼€å‘ï¼ˆC/C++ï¼‰ä¸­ï¼Œç›´æ¥å°†æ˜æ–‡å­—ç¬¦ä¸²ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ IDA Proã€Ghidraï¼‰å¯ä»¥è½»æ˜“åœ°åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ `.rodata`ï¼ˆåªè¯»æ•°æ®ï¼‰æ®µä¸­æ‰¾åˆ°è¿™äº›å­—ç¬¦ä¸²ï¼Œä»è€Œæ³„éœ² API åœ°å€ã€åŠ å¯†å¯†é’¥ã€æ•æ„Ÿæ ¡éªŒé€»è¾‘ç­‰ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¼€å‘è€…é€šå¸¸ä¼šé‡‡ç”¨å„ç§å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯æ¥ä¿æŠ¤è¿™äº›æ•°æ®ã€‚

## å¸¸è§çš„ Native å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯

### 1. æ ˆä¸ŠåŠ¨æ€æ„é€  (Stack-based Construction)

è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹æ³•ã€‚å®ƒé¿å…åœ¨æ•°æ®æ®µä¸­ç•™ä¸‹å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åœ¨å‡½æ•°è¿è¡Œæ—¶ï¼Œé€ä¸ªå­—ç¬¦åœ°å°†å­—ç¬¦ä¸²æ„é€ åœ¨æ ˆä¸Šã€‚

**ç¤ºä¾‹ä»£ç :**

```cpp
void get_secret_url() {
char url[19];
url[0] = 'h'; url[1] = 't'; url[2] = 't'; url[3] = 'p';
url[4] = 's'; url[5] = ':'; url[6] = '/'; url[7] = '/';
url[8] = 'a'; url[9] = 'p'; url[10] = 'i'; url[11] = '.';
url[12] = 'e'; url[13] = 'x'; url[14] = 'a'; url[15] = 'm';
url[16] = 'p'; url[17] = 'l'; url[18] = 'e';
url[19] = '\0'; // Null terminator
// ... use url
}

```

**ç¤ºä¾‹ä»£ç :**

```cpp
char* decrypt_string(char* encrypted) {
char key = 0xAB;
int len = strlen(encrypted);
for (int i = 0; i < len; i++) {
encrypted[i] = encrypted[i] ^ key;
}
return encrypted;
}

void use_secret() {
// "secret_key" Xored with 0xAB
char encrypted_key[] = { 0xCF, 0xC4, 0xC2, 0xCD, 0xC4, 0xD1, 0xDF, 0xCB, 0xC4, 0xD8, 0x00 };
char* secret = decrypt_string(encrypted_key);
// ... use secret
}

```

**ä¼˜ç‚¹**: è‡ªåŠ¨åŒ–ã€å…¨å±€è¦†ç›–ã€å¯¹å¼€å‘è€…é€æ˜ã€‚
**ç¼ºç‚¹**: é€šå¸¸éœ€è¦å®šåˆ¶çš„ç¼–è¯‘å™¨æˆ–å·¥å…·é“¾ã€‚

## é€†å‘ç­–ç•¥

é€†å‘å­—ç¬¦ä¸²æ··æ·†çš„ç›®æ ‡æ˜¯ **æ‰¹é‡åœ°ã€è‡ªåŠ¨åŒ–åœ°** å°†æ··æ·†çš„å­—ç¬¦ä¸²è¿˜åŸå‡ºæ¥ã€‚

### 1. é™æ€åˆ†æ (IDA Pro / Ghidra)

é™æ€åˆ†ææ˜¯è¯†åˆ«è§£å¯†ä¾‹ç¨‹ï¼ˆDecryption Routineï¼‰å’Œæ‰¹é‡è§£å¯†çš„å…³é”®ã€‚

- **è¯†åˆ«è§£å¯†æ¨¡å¼**:
- å¯»æ‰¾ç‰¹å¾æ€§çš„å¾ªç¯ç»“æ„ã€‚ä¸€ä¸ªå¾ªç¯éå†å†…å­˜ã€æ‰§è¡Œå›ºå®šæ“ä½œï¼ˆå¦‚ `XOR`ï¼‰ç„¶åå†™å›ï¼Œè¿™é€šå¸¸å°±æ˜¯è§£å¯†å‡½æ•°ã€‚

- åœ¨ IDA Pro ä¸­ï¼Œè¿™ç§å¾ªç¯çš„å›¾å½¢è§†å›¾éå¸¸å…·æœ‰è¾¨è¯†åº¦ã€‚
- **å®šä½è§£å¯†å‡½æ•°**:
- é€šè¿‡äº¤å‰å¼•ç”¨ï¼ˆXrefsï¼‰æ‰¾åˆ°åŠ å¯†æ•°æ®è¢«å“ªäº›å‡½æ•°ä½¿ç”¨ã€‚è¿™äº›å‡½æ•°å¾ˆå¯èƒ½å°±æ˜¯è§£å¯†å‡½æ•°ã€‚

- ä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªè§£å¯†å‡½æ•°ï¼Œåˆ†æå…¶é€»è¾‘ï¼ˆè¾“å…¥ã€è¾“å‡ºã€åŠ å¯†ç®—æ³•ï¼‰ã€‚
- **è‡ªåŠ¨åŒ–è§£å¯† (IDAPython / Ghidra Script)**:

1. **ç¼–å†™è„šæœ¬**: è¿™æ˜¯æœ€é«˜æ•ˆçš„æ–¹æ³•ã€‚ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥æ¨¡æ‹Ÿè§£å¯†é€»è¾‘ã€‚
2. **å¯»æ‰¾å¼•ç”¨**: è„šæœ¬é¦–å…ˆæ‰¾åˆ°æ‰€æœ‰å¯¹è§£å¯†å‡½æ•°çš„äº¤å‰å¼•ç”¨ã€‚
3. **æå–å‚æ•°**: åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹ï¼Œè„šæœ¬å‘ä¸Šå›æº¯ï¼Œè§£æä¼ é€’ç»™è§£å¯†å‡½æ•°çš„å‚æ•°ï¼ˆåŠ å¯†çš„æ•°æ®ã€å¯†é’¥ç­‰ï¼‰ã€‚
4. **æ‰§è¡Œè§£å¯†**: è„šæœ¬åœ¨å†…éƒ¨æ‰§è¡Œè§£å¯†ç®—æ³•ã€‚
5. **æ·»åŠ æ³¨é‡Š**: æœ€åï¼Œå°†è§£å¯†åçš„å­—ç¬¦ä¸²ä½œä¸ºæ³¨é‡Šæ·»åŠ åˆ° IDA Pro æˆ– Ghidra çš„åæ±‡ç¼–ä»£ç ä¸­ã€‚

### 2. åŠ¨æ€åˆ†æ (Frida)

å½“é™æ€åˆ†æè¿‡äºå¤æ‚æˆ–å­˜åœ¨åè°ƒè¯•æ—¶ï¼ŒåŠ¨æ€åˆ†ææ˜¯æœ€ä½³é€‰æ‹©ã€‚

- **Hook è§£å¯†å‡½æ•°**:

1. é€šè¿‡åˆæ­¥çš„é™æ€åˆ†æå®šä½åˆ°ç–‘ä¼¼çš„è§£å¯†å‡½æ•°ã€‚
2. ä½¿ç”¨ Frida `Interceptor.attach` æ¥ Hook è¿™ä¸ªå‡½æ•°çš„å…¥å£å’Œå‡ºå£ã€‚
3. åœ¨ `onEnter` ä¸­ï¼Œæ‰“å°å‡½æ•°çš„å‚æ•°ï¼ˆé€šå¸¸æ˜¯æŒ‡å‘åŠ å¯†æ•°æ®çš„æŒ‡é’ˆï¼‰ã€‚
4. åœ¨ `onLeave` ä¸­ï¼Œæ‰“å°å‡½æ•°çš„è¿”å›å€¼ï¼ˆé€šå¸¸æ˜¯æŒ‡å‘å·²è§£å¯†çš„æ˜æ–‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼‰ã€‚
5. é€šè¿‡è¿è¡Œ App å¹¶è§¦å‘ä¸åŒåŠŸèƒ½ï¼Œå°±å¯ä»¥ä»æ—¥å¿—ä¸­æ”¶é›†åˆ°å¤§é‡çš„æ˜æ–‡å­—ç¬¦ä¸²ã€‚

- **å†…å­˜æ‰«æ**:
- å¦ä¸€ç§ç­–ç•¥æ˜¯è®©åº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åä½¿ç”¨ Frida è„šæœ¬æˆ– GameGuardian ç­‰å·¥å…·æ‰«ææ•´ä¸ªè¿›ç¨‹å†…å­˜ï¼Œå¯»æ‰¾ç¬¦åˆå­—ç¬¦ä¸²ç‰¹å¾ï¼ˆå¦‚ ASCIIã€UTF-8ï¼‰çš„å†…å­˜åŒºåŸŸã€‚

- **ä¼˜ç‚¹**: æ— éœ€å…³å¿ƒè§£å¯†é€»è¾‘ã€‚

- **ç¼ºç‚¹**: ä¿¡æ¯éå¸¸å˜ˆæ‚ï¼ŒåŒ…å«å¤§é‡æ— ç”¨æ•°æ®ï¼›æ— æ³•å°†è¢«åŠ å¯†å­˜å‚¨ä½†åœ¨è¿è¡Œæ—¶æœªè¢«ä½¿ç”¨çš„å­—ç¬¦ä¸²è§£å¯†å‡ºæ¥ã€‚

### 3. æ¨¡æ‹Ÿæ‰§è¡Œ (Emulation)

å¯¹äºä¸€äº›ç‹¬ç«‹çš„ã€æ²¡æœ‰å¤ªå¤šå¤–éƒ¨ä¾èµ–çš„è§£å¯†å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ï¼ˆå¦‚ `Unicorn Engine`ï¼‰æ¥è§£å¯†ã€‚

1. **æå–ä»£ç å’Œæ•°æ®**: ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ dump å‡ºè§£å¯†å‡½æ•°çš„æœºå™¨ç å’Œéœ€è¦è§£å¯†çš„å­—èŠ‚æ•°ç»„ã€‚
2. **è®¾ç½®ç¯å¢ƒ**: åœ¨ Unicorn ä¸­ï¼Œæ˜ å°„æ‰€éœ€çš„å†…å­˜åŒºåŸŸï¼Œå°†åŠ å¯†æ•°æ®æ”¾å…¥ã€‚
3. **æ¨¡æ‹Ÿæ‰§è¡Œ**: è®¾ç½®å¥½åˆå§‹å¯„å­˜å™¨çŠ¶æ€ï¼ˆå¦‚å‚æ•°æŒ‡é’ˆï¼‰ï¼Œç„¶åå¼€å§‹æ¨¡æ‹Ÿæ‰§è¡Œè§£å¯†å‡½æ•°çš„æœºå™¨ç ã€‚
4. **è·å–ç»“æœ**: æ‰§è¡Œå®Œæ¯•åï¼Œä»å†…å­˜ä¸­è¯»å›è§£å¯†åçš„å­—ç¬¦ä¸²ã€‚

**ä¼˜ç‚¹**: é€Ÿåº¦æ¯”åŠ¨æ€åˆ†æå¿«ï¼Œæ— éœ€è¿è¡Œå®Œæ•´çš„ Appï¼Œå¯ç»•è¿‡åè°ƒè¯•ã€‚
**ç¼ºç‚¹**: ç¯å¢ƒè®¾ç½®å¤æ‚ï¼Œä¸é€‚ç”¨äºæœ‰å¤§é‡ç³»ç»Ÿè°ƒç”¨æˆ–å¤æ‚ä¾èµ–çš„å‡½æ•°ã€‚
