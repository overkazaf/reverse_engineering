---
title: "å®‰å“é“¶è¡Œæœ¨é©¬åˆ†ææ¡ˆä¾‹"
weight: 10
---

# å®‰å“é“¶è¡Œæœ¨é©¬åˆ†ææ¡ˆä¾‹

> **ğŸ“š å‰ç½®çŸ¥è¯†**
>
> æœ¬æ¡ˆä¾‹æ¶‰åŠä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼Œå»ºè®®å…ˆé˜…è¯»ç›¸å…³ç« èŠ‚ï¼š
>
> - **[AndroidManifest åˆ†æ](../04-Reference/Foundations/android_manifest.md)** - è¯†åˆ«æ¶æ„æƒé™å’Œå…¥å£ç‚¹
> - **[Jadx é™æ€åˆ†æ](../02-Tools/Static/jadx_guide.md)** - åç¼–è¯‘ APK å®šä½å…³é”®ä»£ç 

æ¶æ„è½¯ä»¶åˆ†ææ˜¯é€†å‘å·¥ç¨‹çš„ä¸€ä¸ªé‡è¦åº”ç”¨é¢†åŸŸã€‚ä¸å¸¸è§„ App åˆ†æä¸åŒï¼Œåˆ†ææ¶æ„è½¯ä»¶æ›´å…³æ³¨å…¶**éšè—è¡Œä¸º**ã€**æŒä¹…åŒ–æœºåˆ¶**ã€**çªƒå¯†æ‰‹æ®µ**ä»¥åŠ**C2 (Command & Control) é€šä¿¡**ã€‚

æœ¬æ¡ˆä¾‹å°†æ¨¡æ‹Ÿåˆ†æä¸€ä¸ªå…¸å‹çš„ **Android é“¶è¡Œæœ¨é©¬ (Banking Trojan)**ã€‚

---

## æ ·æœ¬æ¦‚å†µ

**ä¼ªè£…**: è¯¥æœ¨é©¬ä¼ªè£…æˆ "Flash Player" æˆ– "ç³»ç»Ÿæ›´æ–°" åº”ç”¨ã€‚

**è¡Œä¸º**: è¯±å¯¼ç”¨æˆ·å¼€å¯"æ— éšœç¢æœåŠ¡"ï¼Œç„¶ååˆ©ç”¨è¯¥æƒé™è¿›è¡Œç‚¹å‡»åŠ«æŒã€è¦†ç›–æ”»å‡» (Overlay Attack)ï¼Œçªƒå–é“¶è¡Œ App çš„è´¦å·å¯†ç ï¼Œå¹¶æ‹¦æˆªçŸ­ä¿¡éªŒè¯ç ã€‚

---

## è¯¦ç»†åˆ†ææµç¨‹

### ç¬¬ 1 æ­¥ï¼šé™æ€åˆ†æ (Manifest & æƒé™)

ä½¿ç”¨ `jadx` æ‰“å¼€ APKï¼Œé¦–å…ˆæŸ¥çœ‹ `AndroidManifest.xml`ã€‚

**å…³é”®å‘ç°**:

1. **æ•æ„Ÿæƒé™**:
   - `android.permission.BIND_ACCESSIBILITY_SERVICE` (æ— éšœç¢æœåŠ¡ - æ ¸å¿ƒæƒé™)
   - `android.permission.RECEIVE_SMS` (æ¥æ”¶çŸ­ä¿¡)
   - `android.permission.READ_SMS` (è¯»å–çŸ­ä¿¡)
   - `android.permission.SYSTEM_ALERT_WINDOW` (æ‚¬æµ®çª— - ç”¨äºè¦†ç›–æ”»å‡»)
   - `android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS` (å¿½ç•¥ç”µæ± ä¼˜åŒ– - ä¿æ´»)

2. **å…¥å£ç‚¹ (Entry Points)**:
   - å‘ç°ä¸€ä¸ª `MainActivity`ï¼Œä½†ä»£ç å¾ˆç®€å•ï¼Œåªæ˜¯è¯·æ±‚æƒé™ã€‚
   - å‘ç°ä¸€ä¸ª `MyAccessibilityService`ï¼Œç»§æ‰¿è‡ª `AccessibilityService`ï¼Œè¿™æ˜¯æ ¸å¿ƒé€»è¾‘æ‰€åœ¨ã€‚

### ç¬¬ 2 æ­¥ï¼šåˆ†ææ— éšœç¢æœåŠ¡ (Accessibility Service)

å®šä½åˆ° `MyAccessibilityService` ç±»ï¼Œé‡ç‚¹åˆ†æ `onAccessibilityEvent` æ–¹æ³•ã€‚

```java
public void onAccessibilityEvent(AccessibilityEvent event) {
    String packageName = event.getPackageName().toString();

    // 1. Auto grant permissions (Self-Protection & Persistence)
    if (packageName.equals("com.android.settings")) {
        // If user opens settings page to uninstall or disable permissions,
        // malware will auto click "Back" or "Cancel"
        performGlobalAction(GLOBAL_ACTION_BACK);
    }

    // 2. Monitor target banking apps
    if (TARGET_BANK_APPS.contains(packageName)) {
        // Detected victim opened banking app
        showOverlay(packageName);
    }

    // 3. Keyboard recording (Keylogging)
    if (event.getEventType() == AccessibilityEvent.TYPE_VIEW_TEXT_CHANGED) {
        String text = event.getText().toString();
        logKey(text);
    }
}
```

### ç¬¬ 3 æ­¥ï¼šè¦†ç›–æ”»å‡» (Overlay Attack)

**çªƒå–**: ç”¨æˆ·ä»¥ä¸ºè‡ªå·±åœ¨ç™»å½•é“¶è¡Œï¼Œå®é™…ä¸Šæ˜¯åœ¨æœ¨é©¬çš„ WebView ä¸­è¾“å…¥äº†è´¦å·å¯†ç ã€‚æœ¨é©¬é€šè¿‡ JavaScript Interface å°†è¾“å…¥çš„æ•°æ®ä¼ å› Java å±‚ï¼Œç„¶åä¸Šä¼ æœåŠ¡å™¨ã€‚

### ç¬¬ 4 æ­¥ï¼šçŸ­ä¿¡æ‹¦æˆª (SMS Stealing)

åˆ†æ `SmsReceiver` ç±»ã€‚

```java
public class SmsReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        Object[] pdus = (Object[]) intent.getExtras().get("pdus");
        for (Object pdu : pdus) {
            SmsMessage sms = SmsMessage.createFromPdu((byte[]) pdu);
            String body = sms.getMessageBody();
            String sender = sms.getOriginatingAddress();

            // Upload SMS to C2 Server
            uploadSmsToC2(sender, body);

            // If SMS contains "verification code" or other key words,
            // intercept the broadcast so user cannot see it
            if (is2FACode(body)) {
                abortBroadcast();
            }
        }
    }
}
```

### ç¬¬ 5 æ­¥ï¼šC2 é€šä¿¡åˆ†æ

1. **å®šä½ C2 åœ°å€**:
   - **èµ„æºè§£å¯†**: æœ‰æ—¶ C2 åœ°å€è¢«åŠ å¯†å­˜å‚¨åœ¨ `assets` ä¸‹çš„å›¾ç‰‡æˆ–æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ DGA (åŸŸåç”Ÿæˆç®—æ³•) åŠ¨æ€ç”Ÿæˆã€‚
   - **Native åˆ†æ**: è¶Šæ¥è¶Šå¤šçš„æœ¨é©¬å°† C2 åœ°å€å’Œé€šä¿¡é€»è¾‘éšè—åœ¨ SO åº“ä¸­ã€‚

2. **é€šä¿¡åè®®**:
   - **HTTP/HTTPS**: æŠ“åŒ…åˆ†æ POST è¯·æ±‚ã€‚
   - **WebSocket**: ç”¨äºå®æ—¶æ§åˆ¶ã€‚
   - **Telegram Bot API**: å¾ˆå¤šæ–°å‹æœ¨é©¬åˆ©ç”¨ Telegram Bot ä½œä¸º C2ï¼Œå› ä¸º Telegram çš„æµé‡é€šå¸¸ä¸ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªï¼Œä¸” HTTPS éš¾ä»¥è§£å¯†ã€‚

**Frida Hook ç¤ºä¾‹ (æ‹¦æˆª Telegram API)**:

```javascript
// Assume malware uses OkHttp
Java.perform(function () {
  var OkHttpClient = Java.use("okhttp3.OkHttpClient");
  OkHttpClient.newCall.implementation = function (request) {
    var url = request.url().toString();
    if (url.includes("api.telegram.org")) {
      console.log("[!] Detected Telegram C2 Communication: " + url);
    }
    return this.newCall(request);
  };
});
```

### ç¬¬ 6 æ­¥ï¼šååˆ†ææŠ€æœ¯

æœ¨é©¬ä½œè€…ä¹Ÿä¼šä½¿ç”¨å„ç§æ‰‹æ®µé˜²æ­¢è¢«é€†å‘ï¼š

- **æ¨¡æ‹Ÿå™¨æ£€æµ‹**: æ£€æŸ¥ `Build.FINGERPRINT`, `Build.MODEL` ç­‰ã€‚
- **åŠ å£³**: ä½¿ç”¨å…è´¹æˆ–å•†ä¸šçš„åŠ å›ºæœåŠ¡ã€‚
- **åŠ¨æ€åŠ è½½**: æ ¸å¿ƒ `dex` æ–‡ä»¶è¢«åŠ å¯†å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†åŠ è½½ (DexClassLoader)ã€‚

---

## æ€»ç»“

åˆ†æé“¶è¡Œæœ¨é©¬çš„å…³é”®åœ¨äºç†è§£å…¶**æ”»å‡»é“¾ (Kill Chain)**ï¼š

1. **Infection**: è¯±å¯¼å®‰è£…ã€‚
2. **Persistence**: è·å–æ— éšœç¢æƒé™ã€ä¿æ´»ã€‚
3. **Stealing**: è¦†ç›–æ”»å‡»çªƒå–å‡­è¯ã€æ‹¦æˆªçŸ­ä¿¡ã€‚
4. **Exfiltration**: å°†æ•°æ®å›ä¼  C2ã€‚

é€†å‘å·¥ç¨‹å¸ˆçš„ä»»åŠ¡æ˜¯é˜»æ–­è¿™ä¸€é“¾æ¡ï¼Œæå– IOC (Indicators of Compromiseï¼Œå¦‚ C2 åŸŸåã€æ–‡ä»¶ Hash)ï¼Œå¹¶ååŠ©å¼€å‘æŸ¥æ€ç­–ç•¥ã€‚
