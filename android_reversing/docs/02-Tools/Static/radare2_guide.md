# Radare2 入门指南

Radare2 (通常简称为 r2) 是一款开源、免费、命令行驱动的逆向工程框架。它不仅仅是一个反汇编器，更像是一个功能极其丰富的"瑞士军刀"，集成了十六进制编辑、反汇编、调试、代码分析、漏洞利用、数据可视化等多种功能。Radare2 以其高度的可脚本化和可扩展性而闻名，深受寻求自动化和深度定制的黑客、CTF 选手和安全研究员的喜爱。

## 目录

1. [核心理念与特性](#核心理念与特性)
2. [Radare2 vs. IDA Pro vs. Ghidra](#radare2-vs-ida-pro-vs-ghidra)
3. [安装与入门](#安装与入门)
4. [基本命令与工作流程](#基本命令与工作流程)
5. [Cutter - Radare2 的 GUI](#cutter---radare2-的-gui)
6. [脚本化](#脚本化)
7. [优缺点分析](#优缺点分析)

---

## 核心理念与特性

### 命令行驱动

Radare2 的所有核心功能都通过命令行接口暴露。这使得它非常适合在终端、SSH 会话或脚本中运行，易于实现自动化。

### 模块化设计

其功能由一系列单字母命令和子命令构成，例如 `p` 用于打印 (print)，`a` 用于分析 (analyze)，`d` 用于调试 (debug)。这种设计遵循了 Unix 哲学。

### 海量架构支持

Radare2 支持数量惊人的处理器架构，包括许多非常小众和古老的嵌入式架构，这方面甚至超过了 IDA Pro。

### 高度可脚本化

你可以使用任何你喜欢的语言（Python, Go, JavaScript, Rust 等）通过 r2pipe 与 Radare2 实例进行交互，实现复杂的自动化分析流程。

### 内置调试器

集成了功能强大的多平台调试器，支持硬件断点、跟踪等高级功能。

### 强大的二进制文件解析

不仅支持 ELF, PE, Mach-O 等标准格式，还能解析文件系统、图片、文档等各种二进制 blob。

---

## Radare2 vs. IDA Pro vs. Ghidra

| 特性 | Radare2 | IDA Pro | Ghidra |
|------|---------|---------|--------|
| **价格** | **完全免费** | 非常昂贵 | 完全免费 |
| **开源** | **是 (C)** | 否 | 是 (Java) |
| **核心优势** | **极致的脚本化和命令行** | 最强的交互式反汇编 | 高质量的免费反编译器 |
| **UI** | **命令行** (或 Cutter GUI) | Qt，业界标准，成熟稳定 | Java Swing，功能强大但略显笨重 |
| **学习曲线** | **非常陡峭** | 中等 | 中等 |
| **自动化** | **设计哲学核心，能力极强** | 主要通过 IDC/IDAPython | 强大的 Headless 模式 |
| **灵活性** | **最高**，一切皆可定制 | 较低，依赖插件 | 较高，可通过插件扩展 |

---

## 安装与入门

### 安装

最推荐的安装方式是通过 `git` 克隆官方仓库并运行安装脚本：

```bash
git clone https://github.com/radareorg/radare2
cd radare2
sys/install.sh
```

### 启动

```bash
# 打开文件并分析
r2 /bin/ls

# 打开文件并进入调试模式
r2 -d /bin/ls
```

---

## 基本命令与工作流程

Radare2 的命令结构是 `[命令][子命令][参数]`。例如 `pdf` 是 `p` (print) -> `d` (disassemble) -> `f` (function) 的组合，意为"打印函数反汇编"。

### 核心概念：万物皆 `?`

在任何命令后面加上 `?` 都可以查看该命令的帮助文档。这是学习 Radare2 最重要的方法。

| 命令 | 说明 |
|------|------|
| `?` | 显示顶级帮助 |
| `a?` | 显示分析 (analyze) 命令的帮助 |
| `pdf?` | 显示打印函数反汇编命令的帮助 |

### 分析 (`a`)

在你对一个二进制文件做任何事情之前，通常需要先分析它。

| 命令 | 说明 |
|------|------|
| `aaa` | 自动分析所有（函数、符号等）。这是最常用的起手命令 |
| `afl` | 列出所有已识别的函数 (Analyze Function List) |
| `af` | 分析函数 |

### 打印 (`p`)

用于以不同格式显示数据。

| 命令 | 说明 |
|------|------|
| `px` | 以十六进制格式打印 (Print heXadecimal) |
| `ps` | 打印字符串 (Print String) |
| `pd N` | 反汇编 N 条指令 (Print Disassembly) |
| `pdf` | 打印当前函数的反汇编 (Print Disassembly Function) |

### 信息 (`i`)

用于显示文件的元信息。

| 命令 | 说明 |
|------|------|
| `iI` | 显示文件基本信息 (入口点、架构等) |
| `is` | 显示符号 |
| `iS` | 显示段 (sections) |

### Seek (`s`)

用于在文件中跳转。

| 命令 | 说明 |
|------|------|
| `s main` | 跳转到 `main` 函数的地址 |
| `s 0x8048400` | 跳转到指定地址 |
| `s-` | 撤销上一次跳转 |

### 可视化 (`V`)

Radare2 提供了强大的文本模式可视化功能。

| 操作 | 说明 |
|------|------|
| `V` | 进入可视化模式 |
| `q` | 退出可视化模式 |
| `p` / `P` | 在可视化模式下切换不同视图（反汇编、十六进制、调试寄存器等） |
| `v` | 可视化模式下展示函数的 ASCII-art 流程图 |

---

## Cutter - Radare2 的 GUI

对于不习惯纯命令行的用户，社区开发了 **Cutter**。Cutter 是一个基于 Qt C++ 的图形用户界面，后端由 Radare2 驱动。

### 主要特点

- 提供了类似 IDA Pro 和 Ghidra 的图形化界面
- 包括反汇编窗口、反编译窗口（集成了 Ghidra Decompiler）、函数列表、Hexdump 等
- 所有在 Cutter 中进行的操作，实际上都是在后台调用 Radare2 的命令完成的
- 对于初学者来说，从 Cutter 入手可以极大地降低学习 Radare2 的门槛

---

## 脚本化

Radare2 的精髓在于自动化。`r2pipe` 是其官方的脚本库，支持多种语言。

以下是一个 Python 脚本示例，用于打开一个文件，分析它，并打印所有函数的名称：

```python
import r2pipe

# 打开文件
r2 = r2pipe.open("/bin/ls")

# 运行 'aaa' 命令进行分析
r2.cmd('aaa')

# 运行 'aflj' 命令获取 JSON 格式的函数列表并解析
functions = r2.cmdj('aflj')

# 打印每个函数名
if functions:
    for func in functions:
        print(f"Function found: {func['name']} at {hex(func['offset'])}")
```

---

## 优缺点分析

### 优点

| 优点 | 说明 |
|------|------|
| **无与伦比的脚本化能力** | 设计哲学使其成为自动化逆向分析的理想选择 |
| **极高的灵活性和定制性** | 你可以按照自己的需求组合命令，构建工作流 |
| **轻量与快速** | 核心程序非常小，运行速度快，资源占用少 |
| **海量架构支持** | 对各种奇异架构的支持是其一大特色 |
| **完全免费开源** | 无任何费用，社区可以审查和贡献代码 |

### 缺点

| 缺点 | 说明 |
|------|------|
| **陡峭的学习曲线** | 命令繁多，语法特殊，对新手非常不友好 |
| **文档相对混乱** | 虽然有帮助系统，但官方文档的结构性和完整性不如商业软件 |
| **默认反编译器** | 内置的反编译器质量不如 Ghidra 或 Hex-Rays，但可以通过插件集成 Ghidra Decompiler |
