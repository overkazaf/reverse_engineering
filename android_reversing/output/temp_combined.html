<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Android Reverse Engineering Cookbook</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown.min.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Android Reverse Engineering Cookbook</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#android-reverse-engineering-cookbook"
id="toc-android-reverse-engineering-cookbook">Android Reverse
Engineering Cookbook</a></li>
<li><a href="#android-é€†å‘å·¥ç¨‹-cookbook"
id="toc-android-é€†å‘å·¥ç¨‹-cookbook">android é€†å‘å·¥ç¨‹ Cookbook</a></li>
<li><a href="#å¿«é€Ÿå…¥é—¨" id="toc-å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</a>
<ul>
<li><a href="#ä½ å°†å­¦åˆ°ä»€ä¹ˆ" id="toc-ä½ å°†å­¦åˆ°ä»€ä¹ˆ">ä½ å°†å­¦åˆ°ä»€ä¹ˆ</a></li>
<li><a href="#å‰ç½®æ¡ä»¶" id="toc-å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</a></li>
<li><a href="#æ“ä½œæ­¥éª¤" id="toc-æ“ä½œæ­¥éª¤">æ“ä½œæ­¥éª¤</a></li>
<li><a href="#æ­å–œä½ å·²å®Œæˆå¿«é€Ÿå…¥é—¨"
id="toc-æ­å–œä½ å·²å®Œæˆå¿«é€Ÿå…¥é—¨">æ­å–œï¼ä½ å·²å®Œæˆå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="#å¸¸è§é—®é¢˜" id="toc-å¸¸è§é—®é¢˜">ğŸ’¡ å¸¸è§é—®é¢˜</a></li>
<li><a href="#æ›´å¤šèµ„æº" id="toc-æ›´å¤šèµ„æº">æ›´å¤šèµ„æº</a></li>
</ul></li>
<li><a href="#ç¯å¢ƒé…ç½®æŒ‡å—" id="toc-ç¯å¢ƒé…ç½®æŒ‡å—">ç¯å¢ƒé…ç½®æŒ‡å—</a>
<ul>
<li><a href="#æ‰€éœ€å·¥å…·æ¦‚è§ˆ" id="toc-æ‰€éœ€å·¥å…·æ¦‚è§ˆ">æ‰€éœ€å·¥å…·æ¦‚è§ˆ</a></li>
<li><a href="#é€‰æ‹©ä½ çš„ç³»ç»Ÿ" id="toc-é€‰æ‹©ä½ çš„ç³»ç»Ÿ">é€‰æ‹©ä½ çš„ç³»ç»Ÿ</a></li>
<li><a href="#é…ç½®-android-è®¾å¤‡æ¨¡æ‹Ÿå™¨"
id="toc-é…ç½®-android-è®¾å¤‡æ¨¡æ‹Ÿå™¨">é…ç½® Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</a></li>
<li><a href="#å®‰è£…-frida-server-åˆ°è®¾å¤‡"
id="toc-å®‰è£…-frida-server-åˆ°è®¾å¤‡">å®‰è£… Frida Server åˆ°è®¾å¤‡</a></li>
<li><a href="#å®‰è£…å…¶ä»–å·¥å…·å¯é€‰"
id="toc-å®‰è£…å…¶ä»–å·¥å…·å¯é€‰">å®‰è£…å…¶ä»–å·¥å…·ï¼ˆå¯é€‰ï¼‰</a></li>
<li><a href="#ç¯å¢ƒæ£€æŸ¥æ¸…å•" id="toc-ç¯å¢ƒæ£€æŸ¥æ¸…å•">âœ…
ç¯å¢ƒæ£€æŸ¥æ¸…å•</a></li>
<li><a href="#å¸¸è§é—®é¢˜-1" id="toc-å¸¸è§é—®é¢˜-1">â“ å¸¸è§é—®é¢˜</a></li>
<li><a href="#ä¸‹ä¸€æ­¥" id="toc-ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</a></li>
</ul></li>
<li><a href="#recipe-ä½¿ç”¨åŠ¨æ€åˆ†æéªŒè¯å’Œæ¢ç´¢-android-app-çš„è¿è¡Œæ—¶è¡Œä¸º"
id="toc-recipe-ä½¿ç”¨åŠ¨æ€åˆ†æéªŒè¯å’Œæ¢ç´¢-android-app-çš„è¿è¡Œæ—¶è¡Œä¸º">Recipe:
ä½¿ç”¨åŠ¨æ€åˆ†æéªŒè¯å’Œæ¢ç´¢ android App çš„è¿è¡Œæ—¶è¡Œä¸º</a>
<ul>
<li><a href="#é—®é¢˜åœºæ™¯" id="toc-é—®é¢˜åœºæ™¯">é—®é¢˜åœºæ™¯</a></li>
<li><a href="#å¿…éœ€å·¥å…·-1" id="toc-å¿…éœ€å·¥å…·-1"># å¿…éœ€å·¥å…·</a></li>
<li><a href="#å¯é€‰å·¥å…·" id="toc-å¯é€‰å·¥å…·"># å¯é€‰å·¥å…·</a></li>
<li><a href="#ç¡®è®¤æ¸…å•" id="toc-ç¡®è®¤æ¸…å•"># âœ… ç¡®è®¤æ¸…å•</a></li>
<li><a href="#hook-vs-debug-vs-traceä½•æ—¶ç”¨ä»€ä¹ˆ"
id="toc-hook-vs-debug-vs-traceä½•æ—¶ç”¨ä»€ä¹ˆ"># ğŸ¤” Hook vs Debug vs
Traceï¼šä½•æ—¶ç”¨ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="#ç¬¬-1-æ­¥éªŒè¯é™æ€åˆ†æç»“æœ15-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥éªŒè¯é™æ€åˆ†æç»“æœ15-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šéªŒè¯é™æ€åˆ†æç»“æœï¼ˆ15
åˆ†é’Ÿï¼‰</a></li>
<li><a href="#hook-å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º" id="toc-hook-å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º"># #
1.1 Hook å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º</a></li>
</ul></li>
<li><a href="#connect-to-to-to-to-to-to-to-device"
id="toc-connect-to-to-to-to-to-to-to-device">Connect to to to to to to
to device</a></li>
<li><a href="#attach-to-process" id="toc-attach-to-process">Attach to
process</a></li>
<li><a href="#loadscript" id="toc-loadscript">LoadScript</a></li>
<li><a href="#wait-forscriptinitialize"
id="toc-wait-forscriptinitialize">Wait forScriptInitialize</a></li>
<li><a href="#call-rpc-function" id="toc-call-rpc-function">Call RPC
Function</a></li>
<li><a href="#ä¿æŒè¿è¡Œ" id="toc-ä¿æŒè¿è¡Œ">ä¿æŒè¿è¡Œ</a>
<ul>
<li><a href="#ä½¿ç”¨-gdb-è°ƒè¯•" id="toc-ä½¿ç”¨-gdb-è°ƒè¯•"># # 6.2 ä½¿ç”¨ GDB
è°ƒè¯•</a></li>
</ul></li>
<li><a href="#gdb-in" id="toc-gdb-in">gdb In</a>
<ul>
<li><a href="#é—®é¢˜-4-è°ƒè¯•å™¨æ— æ³•é™„åŠ " id="toc-é—®é¢˜-4-è°ƒè¯•å™¨æ— æ³•é™„åŠ "># âŒ
é—®é¢˜ 4: è°ƒè¯•å™¨æ— æ³•é™„åŠ </a></li>
</ul></li>
<li><a href="#javascript-obfuscator-obæ··æ·†-åˆ†æ"
id="toc-javascript-obfuscator-obæ··æ·†-åˆ†æ">JavaScript Obfuscator
(OBæ··æ·†) åˆ†æ</a>
<ul>
<li><a href="#æ ¸å¿ƒæ··æ·†æŠ€æœ¯" id="toc-æ ¸å¿ƒæ··æ·†æŠ€æœ¯">æ ¸å¿ƒæ··æ·†æŠ€æœ¯</a></li>
<li><a href="#åˆ†æä¸åæ··æ·†ç­–ç•¥"
id="toc-åˆ†æä¸åæ··æ·†ç­–ç•¥">åˆ†æä¸åæ··æ·†ç­–ç•¥</a></li>
<li><a href="#å¸¸ç”¨å·¥å…·" id="toc-å¸¸ç”¨å·¥å…·">å¸¸ç”¨å·¥å…·</a></li>
</ul></li>
<li><a href="#javascript-vmp-é€†å‘å·¥ç¨‹"
id="toc-javascript-vmp-é€†å‘å·¥ç¨‹">JavaScript VMP é€†å‘å·¥ç¨‹</a>
<ul>
<li><a href="#æ ¸å¿ƒåŸç†" id="toc-æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</a></li>
<li><a href="#å¸¸è§ç‰¹å¾" id="toc-å¸¸è§ç‰¹å¾">å¸¸è§ç‰¹å¾</a></li>
<li><a href="#åˆ†æä¸è„±å£³ç­–ç•¥"
id="toc-åˆ†æä¸è„±å£³ç­–ç•¥">åˆ†æä¸è„±å£³ç­–ç•¥</a></li>
<li><a href="#å¸¸ç”¨å·¥å…·-1" id="toc-å¸¸ç”¨å·¥å…·-1">å¸¸ç”¨å·¥å…·</a></li>
</ul></li>
<li><a href="#native-å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘"
id="toc-native-å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘">Native å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘</a>
<ul>
<li><a href="#å¸¸è§çš„-native-å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯"
id="toc-å¸¸è§çš„-native-å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯">å¸¸è§çš„ Native
å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯</a></li>
<li><a href="#é€†å‘ç­–ç•¥" id="toc-é€†å‘ç­–ç•¥">é€†å‘ç­–ç•¥</a></li>
</ul></li>
<li><a href="#ollvm-åæ··æ·†" id="toc-ollvm-åæ··æ·†">OLLVM åæ··æ·†</a>
<ul>
<li><a href="#æ ¸å¿ƒæ··æ·†æŠ€æœ¯-1"
id="toc-æ ¸å¿ƒæ··æ·†æŠ€æœ¯-1">æ ¸å¿ƒæ··æ·†æŠ€æœ¯</a></li>
<li><a href="#åˆ†æä¸åæ··æ·†ç­–ç•¥-1"
id="toc-åˆ†æä¸åæ··æ·†ç­–ç•¥-1">åˆ†æä¸åæ··æ·†ç­–ç•¥</a></li>
</ul></li>
<li><a href="#recipe-android-åº”ç”¨é€†å‘å·¥ç¨‹å®Œæ•´å·¥ä½œæµç¨‹"
id="toc-recipe-android-åº”ç”¨é€†å‘å·¥ç¨‹å®Œæ•´å·¥ä½œæµç¨‹">Recipe: Android
åº”ç”¨é€†å‘å·¥ç¨‹å®Œæ•´å·¥ä½œæµç¨‹</a>
<ul>
<li><a href="#é—®é¢˜åœºæ™¯-1" id="toc-é—®é¢˜åœºæ™¯-1">é—®é¢˜åœºæ™¯</a></li>
<li><a href="#å·¥å…·æ¸…å•" id="toc-å·¥å…·æ¸…å•">å·¥å…·æ¸…å•</a></li>
<li><a href="#å¿…å¤‡å·¥å…·" id="toc-å¿…å¤‡å·¥å…·"># å¿…å¤‡å·¥å…·</a></li>
<li><a href="#å¯é€‰å·¥å…·-1" id="toc-å¯é€‰å·¥å…·-1"># å¯é€‰å·¥å…·</a></li>
<li><a href="#å‰ç½®çŸ¥è¯†" id="toc-å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</a></li>
<li><a href="#è§£å†³æ–¹æ¡ˆ" id="toc-è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#æ ¸å¿ƒåŸåˆ™" id="toc-æ ¸å¿ƒåŸåˆ™"># æ ¸å¿ƒåŸåˆ™</a></li>
<li><a href="#é˜¶æ®µä¸€ä¿¡æ¯æ”¶é›†ä¸åˆæ­¥åˆ†æ-15-30-åˆ†é’Ÿ"
id="toc-é˜¶æ®µä¸€ä¿¡æ¯æ”¶é›†ä¸åˆæ­¥åˆ†æ-15-30-åˆ†é’Ÿ">é˜¶æ®µä¸€ï¼šä¿¡æ¯æ”¶é›†ä¸åˆæ­¥åˆ†æï¼ˆ
15-30 åˆ†é’Ÿï¼‰</a></li>
<li><a href="#æ­¥éª¤-1è·å–-apk-æ–‡ä»¶" id="toc-æ­¥éª¤-1è·å–-apk-æ–‡ä»¶"># æ­¥éª¤
1ï¼šè·å– APK æ–‡ä»¶</a></li>
<li><a href="#æ­¥éª¤-4å¿«é€Ÿç›®å½•ç»“æ„å®¡æŸ¥" id="toc-æ­¥éª¤-4å¿«é€Ÿç›®å½•ç»“æ„å®¡æŸ¥">#
æ­¥éª¤ 4ï¼šå¿«é€Ÿç›®å½•ç»“æ„å®¡æŸ¥</a></li>
<li><a href="#é˜¶æ®µäºŒé™æ€åˆ†æ-1-3-å°æ—¶"
id="toc-é˜¶æ®µäºŒé™æ€åˆ†æ-1-3-å°æ—¶">é˜¶æ®µäºŒï¼šé™æ€åˆ†æï¼ˆ 1-3 å°æ—¶ï¼‰</a></li>
<li><a href="#æ­¥éª¤-1ä½¿ç”¨-jadx-åç¼–è¯‘" id="toc-æ­¥éª¤-1ä½¿ç”¨-jadx-åç¼–è¯‘">#
æ­¥éª¤ 1ï¼šä½¿ç”¨ Jadx åç¼–è¯‘</a></li>
</ul></li>
<li><a href="#æ–°å»ºé¡¹ç›®-å¯¼å…¥æ–‡ä»¶-é€‰æ‹©-.so-æ–‡ä»¶"
id="toc-æ–°å»ºé¡¹ç›®-å¯¼å…¥æ–‡ä»¶-é€‰æ‹©-.so-æ–‡ä»¶">2. æ–°å»ºé¡¹ç›® â†’ å¯¼å…¥æ–‡ä»¶ â†’ é€‰æ‹©
.so æ–‡ä»¶</a></li>
<li><a href="#åŒå‡»æ–‡ä»¶-è‡ªåŠ¨åˆ†æ" id="toc-åŒå‡»æ–‡ä»¶-è‡ªåŠ¨åˆ†æ">3. åŒå‡»æ–‡ä»¶
â†’ è‡ªåŠ¨åˆ†æ</a></li>
<li><a href="#çª—å£-symbol-tree-exports"
id="toc-çª—å£-symbol-tree-exports">4. çª—å£ â†’ Symbol Tree â†’
Exports</a></li>
<li><a href="#æŸ¥çœ‹å¯¼å‡ºå‡½æ•°åˆ—è¡¨"
id="toc-æŸ¥çœ‹å¯¼å‡ºå‡½æ•°åˆ—è¡¨">æŸ¥çœ‹å¯¼å‡ºå‡½æ•°åˆ—è¡¨</a></li>
<li><a href="#åŒå‡»å‡½æ•°-åç¼–è¯‘å³ä¾§é¢æ¿æ˜¾ç¤º-c-ä¼ªä»£ç "
id="toc-åŒå‡»å‡½æ•°-åç¼–è¯‘å³ä¾§é¢æ¿æ˜¾ç¤º-c-ä¼ªä»£ç ">5. åŒå‡»å‡½æ•° â†’
åç¼–è¯‘ï¼ˆå³ä¾§é¢æ¿æ˜¾ç¤º C ä¼ªä»£ç ï¼‰</a></li>
<li><a href="#é…ç½®ä»£ç†" id="toc-é…ç½®ä»£ç†">1. é…ç½®ä»£ç†</a></li>
<li><a href="#å¯åŠ¨åº”ç”¨å¹¶ç»•è¿‡-ssl-pinning"
id="toc-å¯åŠ¨åº”ç”¨å¹¶ç»•è¿‡-ssl-pinning">2. å¯åŠ¨åº”ç”¨å¹¶ç»•è¿‡ SSL
pinning</a></li>
<li><a href="#åœ¨-burp-suite-ä¸­æŸ¥çœ‹æµé‡"
id="toc-åœ¨-burp-suite-ä¸­æŸ¥çœ‹æµé‡">3. åœ¨ Burp Suite ä¸­æŸ¥çœ‹æµé‡</a>
<ul>
<li><a href="#é˜¶æ®µå››ä»£ç ä¿®æ”¹ä¸é‡æ‰“åŒ…-30-60-åˆ†é’Ÿ"
id="toc-é˜¶æ®µå››ä»£ç ä¿®æ”¹ä¸é‡æ‰“åŒ…-30-60-åˆ†é’Ÿ">é˜¶æ®µå››ï¼šä»£ç ä¿®æ”¹ä¸é‡æ‰“åŒ…ï¼ˆ
30-60 åˆ†é’Ÿï¼‰</a></li>
<li><a href="#æ­¥éª¤-1ä¿®æ”¹-smali-ä»£ç " id="toc-æ­¥éª¤-1ä¿®æ”¹-smali-ä»£ç ">#
æ­¥éª¤ 1ï¼šä¿®æ”¹ Smali ä»£ç </a></li>
</ul></li>
<li><a href="#è¯»å–-userinfo.vipstatus"
id="toc-è¯»å–-userinfo.vipstatus">è¯»å– userInfo.vipStatus</a></li>
<li><a href="#æ¯”è¾ƒæ˜¯å¦ç­‰äº-1" id="toc-æ¯”è¾ƒæ˜¯å¦ç­‰äº-1">æ¯”è¾ƒæ˜¯å¦ç­‰äº
1</a></li>
<li><a href="#å¦‚æœç›¸ç­‰è¿”å›-true"
id="toc-å¦‚æœç›¸ç­‰è¿”å›-true">å¦‚æœç›¸ç­‰ï¼Œè¿”å› true</a></li>
<li><a href="#å¦‚æœä¸ç›¸ç­‰è¿”å›-false"
id="toc-å¦‚æœä¸ç›¸ç­‰è¿”å›-false">å¦‚æœä¸ç›¸ç­‰ï¼Œè¿”å› false</a></li>
<li><a href="#æ£€æŸ¥æ˜¯å¦ä¸æ˜¯-vip" id="toc-æ£€æŸ¥æ˜¯å¦ä¸æ˜¯-vip">æ£€æŸ¥æ˜¯å¦ä¸æ˜¯
VIP</a></li>
<li><a href="#å¦‚æœä¸æ˜¯-vipæ˜¾ç¤ºå¹¿å‘Š"
id="toc-å¦‚æœä¸æ˜¯-vipæ˜¾ç¤ºå¹¿å‘Š">å¦‚æœä¸æ˜¯ VIPï¼Œæ˜¾ç¤ºå¹¿å‘Š</a></li>
<li><a href="#è¾“å‡ºmodified-aligned-debugsigned.apk"
id="toc-è¾“å‡ºmodified-aligned-debugsigned.apk">è¾“å‡ºï¼šmodified-aligned-debugSigned.apk</a>
<ul>
<li><a href="#å·¥å…·æ·±å…¥" id="toc-å·¥å…·æ·±å…¥"># å·¥å…·æ·±å…¥</a></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶" id="toc-æ¡ˆä¾‹ç ”ç©¶"># æ¡ˆä¾‹ç ”ç©¶</a></li>
<li><a href="#å‚è€ƒèµ„æ–™" id="toc-å‚è€ƒèµ„æ–™"># å‚è€ƒèµ„æ–™</a></li>
<li><a href="#é€ŸæŸ¥æ‰‹å†Œ" id="toc-é€ŸæŸ¥æ‰‹å†Œ">é€ŸæŸ¥æ‰‹å†Œ</a></li>
<li><a href="#å·¥ä½œæµç¨‹å¿«é€Ÿåœ°å›¾" id="toc-å·¥ä½œæµç¨‹å¿«é€Ÿåœ°å›¾">#
å·¥ä½œæµç¨‹å¿«é€Ÿåœ°å›¾</a></li>
<li><a href="#å¸¸ç”¨å¿«æ·æ“ä½œ" id="toc-å¸¸ç”¨å¿«æ·æ“ä½œ"># âš¡
å¸¸ç”¨å¿«æ·æ“ä½œ</a></li>
</ul></li>
<li><a href="#recipe-ä½¿ç”¨é™æ€åˆ†æå®šä½-android-app-çš„å…³é”®é€»è¾‘"
id="toc-recipe-ä½¿ç”¨é™æ€åˆ†æå®šä½-android-app-çš„å…³é”®é€»è¾‘">Recipe:
ä½¿ç”¨é™æ€åˆ†æå®šä½ android App çš„å…³é”®é€»è¾‘</a>
<ul>
<li><a href="#é—®é¢˜åœºæ™¯-2" id="toc-é—®é¢˜åœºæ™¯-2">é—®é¢˜åœºæ™¯</a></li>
<li><a href="#å¿…éœ€å·¥å…·-2" id="toc-å¿…éœ€å·¥å…·-2"># å¿…éœ€å·¥å…·</a></li>
<li><a href="#å¯é€‰å·¥å…·-2" id="toc-å¯é€‰å·¥å…·-2"># å¯é€‰å·¥å…·</a></li>
<li><a href="#ç¡®è®¤æ¸…å•-1" id="toc-ç¡®è®¤æ¸…å•-1"># âœ… ç¡®è®¤æ¸…å•</a></li>
<li><a href="#é™æ€-vs-åŠ¨æ€ä½•æ—¶é€‰æ‹©ä»€ä¹ˆ"
id="toc-é™æ€-vs-åŠ¨æ€ä½•æ—¶é€‰æ‹©ä»€ä¹ˆ"># ğŸ¤” é™æ€ vs
åŠ¨æ€ï¼šä½•æ—¶é€‰æ‹©ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="#ç¬¬-1-æ­¥ç¡®å®šåˆ†æç›®æ ‡5-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥ç¡®å®šåˆ†æç›®æ ‡5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šç¡®å®šåˆ†æç›®æ ‡ï¼ˆ5
åˆ†é’Ÿï¼‰</a></li>
<li><a href="#jadx-gui-å­—ç¬¦ä¸²æœç´¢" id="toc-jadx-gui-å­—ç¬¦ä¸²æœç´¢"># # 2.1
jadx-gui å­—ç¬¦ä¸²æœç´¢</a></li>
<li><a href="#å‘ä¸Šè¿½æº¯è°ƒç”¨é“¾" id="toc-å‘ä¸Šè¿½æº¯è°ƒç”¨é“¾"># # 3.2
å‘ä¸Šè¿½æº¯è°ƒç”¨é“¾</a></li>
<li><a href="#å®šä½-native-å‡½æ•°" id="toc-å®šä½-native-å‡½æ•°"># # 5.1 å®šä½
Native å‡½æ•°</a></li>
</ul></li>
<li><a href="#libnative-lib.so"
id="toc-libnative-lib.so">libnative-lib.so</a></li>
<li><a href="#ç”¨-ida-pro-æ‰“å¼€" id="toc-ç”¨-ida-pro-æ‰“å¼€">ç”¨ IDA Pro
æ‰“å¼€</a>
<ul>
<li><a href="#ä½¿ç”¨-findcrypt-æ’ä»¶ida-pro"
id="toc-ä½¿ç”¨-findcrypt-æ’ä»¶ida-pro"># # 6.1 ä½¿ç”¨ FindCrypt æ’ä»¶ï¼ˆIDA
Proï¼‰</a></li>
<li><a href="#æ‰‹åŠ¨è¯†åˆ«" id="toc-æ‰‹åŠ¨è¯†åˆ«"># # 6.2 æ‰‹åŠ¨è¯†åˆ«</a></li>
<li><a href="#å¸¸è§é—®é¢˜-2" id="toc-å¸¸è§é—®é¢˜-2">å¸¸è§é—®é¢˜</a></li>
<li><a href="#é—®é¢˜-1-jadx-åç¼–è¯‘å¤±è´¥" id="toc-é—®é¢˜-1-jadx-åç¼–è¯‘å¤±è´¥">#
âŒ é—®é¢˜ 1: jadx åç¼–è¯‘å¤±è´¥</a></li>
<li><a href="#é—®é¢˜-4-ä»£ç å¤ªå¤æ‚çœ‹ä¸æ‡‚"
id="toc-é—®é¢˜-4-ä»£ç å¤ªå¤æ‚çœ‹ä¸æ‡‚"># âŒ é—®é¢˜ 4: ä»£ç å¤ªå¤æ‚çœ‹ä¸æ‡‚</a></li>
<li><a href="#é—®é¢˜-5-å¦‚ä½•éªŒè¯é™æ€åˆ†æç»“æœ"
id="toc-é—®é¢˜-5-å¦‚ä½•éªŒè¯é™æ€åˆ†æç»“æœ"># âŒ é—®é¢˜ 5:
å¦‚ä½•éªŒè¯é™æ€åˆ†æç»“æœï¼Ÿ</a></li>
</ul></li>
<li><a href="#è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥"
id="toc-è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥">è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥</a>
<ul>
<li><a href="#ç›®å½•" id="toc-ç›®å½•">ç›®å½•</a></li>
<li><a href="#è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†"
id="toc-è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†">è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</a></li>
</ul></li>
<li><a href="#calculatesha256"
id="toc-calculatesha256">CalculateSHA256</a></li>
<li><a href="#é¢„æµ‹" id="toc-é¢„æµ‹">é¢„æµ‹</a></li>
<li><a href="#åœ¨å†…-virtualbox-createè™šæ‹Ÿæœº"
id="toc-åœ¨å†…-virtualbox-createè™šæ‹Ÿæœº">åœ¨å†… VirtualBox,
Createè™šæ‹Ÿæœº</a></li>
<li><a href="#systembinsh" id="toc-systembinsh">!/system/bin/sh</a></li>
<li><a href="#åˆ é™¤æˆ–éšè—æ¨¡æ‹Ÿå™¨ç‰¹å¾"
id="toc-åˆ é™¤æˆ–éšè—æ¨¡æ‹Ÿå™¨ç‰¹å¾">åˆ é™¤æˆ–éšè—æ¨¡æ‹Ÿå™¨ç‰¹å¾</a></li>
<li><a href="#anboxuselxcå®¹å™¨å‡ ä¹noperformanceæŸå¤±"
id="toc-anboxuselxcå®¹å™¨å‡ ä¹noperformanceæŸå¤±">AnboxUseLXCå®¹å™¨ï¼Œå‡ ä¹NoPerformanceæŸå¤±</a></li>
<li><a href="#äº‘æ‰‹æœºé€šå¸¸ä½¿ç”¨æ•°æ®ä¸­å¿ƒ-ip"
id="toc-äº‘æ‰‹æœºé€šå¸¸ä½¿ç”¨æ•°æ®ä¸­å¿ƒ-ip">äº‘æ‰‹æœºé€šå¸¸ä½¿ç”¨æ•°æ®ä¸­å¿ƒ IP</a></li>
<li><a href="#detectionipclasstype"
id="toc-detectionipclasstype">DetectionIPClassType</a></li>
<li><a href="#éšæœºæµè§ˆæ—¶é•¿" id="toc-éšæœºæµè§ˆæ—¶é•¿">éšæœºæµè§ˆæ—¶é•¿</a></li>
<li><a href="#éšæœºç‚¹å‡»" id="toc-éšæœºç‚¹å‡»">éšæœºç‚¹å‡»</a></li>
<li><a href="#æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®" id="toc-æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®">æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®</a>
<ul>
<li><a href="#å¼€æºå·¥å…·ä¸æ¡†æ¶"
id="toc-å¼€æºå·¥å…·ä¸æ¡†æ¶">å¼€æºå·¥å…·ä¸æ¡†æ¶</a></li>
</ul></li>
<li><a href="#å®‰è£…é¢„è®¾-app" id="toc-å®‰è£…é¢„è®¾-app">å®‰è£…é¢„è®¾ App</a></li>
<li><a href="#settingssssssä½ç½®"
id="toc-settingssssssä½ç½®">settingssssssä½ç½®</a></li>
<li><a href="#è®°å½•-usageå†å²" id="toc-è®°å½•-usageå†å²">è®°å½•
usageå†å²</a></li>
<li><a href="#elliptic-envelope-detection"
id="toc-elliptic-envelope-detection">Elliptic Envelope
Detection</a></li>
<li><a href="#ç»¼åˆæ£€æŸ¥" id="toc-ç»¼åˆæ£€æŸ¥">ç»¼åˆæ£€æŸ¥</a></li>
<li><a href="#é¢„æµ‹-1" id="toc-é¢„æµ‹-1">é¢„æµ‹</a></li>
<li><a href="#æ£€æµ‹è¿‡äºè§„å¾‹çš„æ“ä½œ"
id="toc-æ£€æµ‹è¿‡äºè§„å¾‹çš„æ“ä½œ">æ£€æµ‹è¿‡äºè§„å¾‹çš„æ“ä½œ</a></li>
<li><a href="#æ£€æµ‹ä¸è‡ªç„¶çš„é€Ÿåº¦"
id="toc-æ£€æµ‹ä¸è‡ªç„¶çš„é€Ÿåº¦">æ£€æµ‹ä¸è‡ªç„¶çš„é€Ÿåº¦</a></li>
<li><a href="#æ£€æµ‹ç¼ºå°‘äººç±»ç‰¹å¾å¦‚å¾®å°æŠ–åŠ¨"
id="toc-æ£€æµ‹ç¼ºå°‘äººç±»ç‰¹å¾å¦‚å¾®å°æŠ–åŠ¨">æ£€æµ‹ç¼ºå°‘äººç±»ç‰¹å¾ï¼ˆå¦‚å¾®å°æŠ–åŠ¨ï¼‰</a></li>
<li><a href="#ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾"
id="toc-ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾">ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾</a></li>
<li><a href="#è·å–ç‰¹å¾é‡è¦æ€§æ’å"
id="toc-è·å–ç‰¹å¾é‡è¦æ€§æ’å">è·å–ç‰¹å¾é‡è¦æ€§æ’å</a></li>
<li><a href="#å¯è§†åŒ–" id="toc-å¯è§†åŒ–">å¯è§†åŒ–</a></li>
<li><a href="#returncontributionæœ€å¤§ç‰¹å¾"
id="toc-returncontributionæœ€å¤§ç‰¹å¾">ReturnContributionæœ€å¤§ç‰¹å¾</a></li>
<li><a href="#è®¾å¤‡æŒ‡çº¹check" id="toc-è®¾å¤‡æŒ‡çº¹check">1.
è®¾å¤‡æŒ‡çº¹Check</a></li>
<li><a href="#è®¾å¤‡associationanalyze" id="toc-è®¾å¤‡associationanalyze">2.
è®¾å¤‡AssociationAnalyze</a></li>
<li><a href="#ç”¨æˆ·è¡Œä¸ºanalyze" id="toc-ç”¨æˆ·è¡Œä¸ºanalyze">3.
ç”¨æˆ·è¡Œä¸ºAnalyze</a></li>
<li><a href="#è®¢å•ç‰¹å¾analyze" id="toc-è®¢å•ç‰¹å¾analyze">4.
è®¢å•ç‰¹å¾Analyze</a></li>
<li><a href="#å†³ç­–" id="toc-å†³ç­–">å†³ç­–</a></li>
<li><a href="#æ£€æµ‹æ¨¡æ‹Ÿå™¨" id="toc-æ£€æµ‹æ¨¡æ‹Ÿå™¨">æ£€æµ‹æ¨¡æ‹Ÿå™¨</a></li>
<li><a href="#æ£€æµ‹-hook-æ¡†æ¶" id="toc-æ£€æµ‹-hook-æ¡†æ¶">æ£€æµ‹ Hook
æ¡†æ¶</a></li>
<li><a href="#æ£€æµ‹è®¾å¤‡å‚æ•°ä¸€è‡´æ€§"
id="toc-æ£€æµ‹è®¾å¤‡å‚æ•°ä¸€è‡´æ€§">æ£€æµ‹è®¾å¤‡å‚æ•°ä¸€è‡´æ€§</a></li>
<li><a href="#æœºå™¨å­¦ä¹ æ£€æµ‹" id="toc-æœºå™¨å­¦ä¹ æ£€æµ‹">æœºå™¨å­¦ä¹ æ£€æµ‹</a></li>
<li><a href="#recipe-ç»•è¿‡-app-å¯¹-frida-çš„æ£€æµ‹"
id="toc-recipe-ç»•è¿‡-app-å¯¹-frida-çš„æ£€æµ‹">Recipe: ç»•è¿‡ App å¯¹ Frida
çš„æ£€æµ‹</a>
<ul>
<li><a href="#é—®é¢˜åœºæ™¯-3" id="toc-é—®é¢˜åœºæ™¯-3">é—®é¢˜åœºæ™¯</a></li>
<li><a href="#å¿…éœ€å·¥å…·-3" id="toc-å¿…éœ€å·¥å…·-3"># å¿…éœ€å·¥å…·</a></li>
<li><a href="#å¯é€‰å·¥å…·-3" id="toc-å¯é€‰å·¥å…·-3"># å¯é€‰å·¥å…·</a></li>
<li><a href="#ç¡®è®¤æ¸…å•-2" id="toc-ç¡®è®¤æ¸…å•-2"># âœ… ç¡®è®¤æ¸…å•</a></li>
<li><a href="#è§£å†³æ–¹æ¡ˆ-1" id="toc-è§£å†³æ–¹æ¡ˆ-1">è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#ç¬¬-1-æ­¥è¯†åˆ«æ£€æµ‹ç±»å‹5-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥è¯†åˆ«æ£€æµ‹ç±»å‹5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ«æ£€æµ‹ç±»å‹ï¼ˆ5
åˆ†é’Ÿï¼‰</a></li>
</ul></li>
<li><a href="#ä¸æ¨èattach-æ¨¡å¼æ£€æµ‹ä»£ç å¯èƒ½å·²è¿è¡Œ"
id="toc-ä¸æ¨èattach-æ¨¡å¼æ£€æµ‹ä»£ç å¯èƒ½å·²è¿è¡Œ">âŒ ä¸æ¨èï¼šAttach
æ¨¡å¼ï¼ˆæ£€æµ‹ä»£ç å¯èƒ½å·²è¿è¡Œï¼‰</a></li>
<li><a href="#æ›¿æ¢æ¨¡å—å" id="toc-æ›¿æ¢æ¨¡å—å">æ›¿æ¢æ¨¡å—å</a></li>
<li><a href="#æ›¿æ¢çº¿ç¨‹å" id="toc-æ›¿æ¢çº¿ç¨‹å">æ›¿æ¢çº¿ç¨‹å</a>
<ul>
<li><a href="#hook-æ—¶æœºå¾ˆé‡è¦" id="toc-hook-æ—¶æœºå¾ˆé‡è¦"># Hook
æ—¶æœºå¾ˆé‡è¦</a></li>
<li><a href="#é—®é¢˜-2-hook-å-app-å´©æºƒ"
id="toc-é—®é¢˜-2-hook-å-app-å´©æºƒ"># âŒ é—®é¢˜ 2: Hook å App å´©æºƒ</a></li>
<li><a href="#é—®é¢˜-3-æŸäº›æ£€æµ‹ç»•ä¸è¿‡å»"
id="toc-é—®é¢˜-3-æŸäº›æ£€æµ‹ç»•ä¸è¿‡å»"># âŒ é—®é¢˜ 3: æŸäº›æ£€æµ‹ç»•ä¸è¿‡å»</a></li>
<li><a href="#ç›¸å…³-recipes" id="toc-ç›¸å…³-recipes"># ç›¸å…³
Recipes</a></li>
<li><a href="#å·¥å…·æ·±å…¥-1" id="toc-å·¥å…·æ·±å…¥-1"># å·¥å…·æ·±å…¥</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ" id="toc-æ¡ˆä¾‹åˆ†æ"># æ¡ˆä¾‹åˆ†æ</a></li>
<li><a href="#è¿›é˜¶èµ„æº" id="toc-è¿›é˜¶èµ„æº"># è¿›é˜¶èµ„æº</a></li>
<li><a href="#ä¸€é”®ç»•è¿‡è„šæœ¬" id="toc-ä¸€é”®ç»•è¿‡è„šæœ¬">#
ä¸€é”®ç»•è¿‡è„šæœ¬</a></li>
<li><a href="#å¸¸ç”¨å‘½ä»¤" id="toc-å¸¸ç”¨å‘½ä»¤"># å¸¸ç”¨å‘½ä»¤</a></li>
</ul></li>
<li><a href="#ç§»åŠ¨ç«¯å®‰å…¨ä¸é£æ§æŠ€æœ¯"
id="toc-ç§»åŠ¨ç«¯å®‰å…¨ä¸é£æ§æŠ€æœ¯">ç§»åŠ¨ç«¯å®‰å…¨ä¸é£æ§æŠ€æœ¯</a>
<ul>
<li><a href="#å…³é”®é˜²å¾¡ç±»å‹" id="toc-å…³é”®é˜²å¾¡ç±»å‹">å…³é”®é˜²å¾¡ç±»å‹</a></li>
<li><a href="#ç»•è¿‡ç­–ç•¥" id="toc-ç»•è¿‡ç­–ç•¥">ç»•è¿‡ç­–ç•¥</a></li>
</ul></li>
<li><a href="#recipe-ç»•è¿‡åº”ç”¨çš„-xposed-æ£€æµ‹"
id="toc-recipe-ç»•è¿‡åº”ç”¨çš„-xposed-æ£€æµ‹">Recipe: ç»•è¿‡åº”ç”¨çš„ Xposed
æ£€æµ‹</a>
<ul>
<li><a href="#é—®é¢˜åœºæ™¯-4" id="toc-é—®é¢˜åœºæ™¯-4">é—®é¢˜åœºæ™¯</a></li>
<li><a href="#å·¥å…·æ¸…å•-1" id="toc-å·¥å…·æ¸…å•-1">å·¥å…·æ¸…å•</a></li>
<li><a href="#å¿…éœ€å·¥å…·-4" id="toc-å¿…éœ€å·¥å…·-4"># å¿…éœ€å·¥å…·</a></li>
<li><a href="#å¯é€‰å·¥å…·-4" id="toc-å¯é€‰å·¥å…·-4"># å¯é€‰å·¥å…·</a></li>
<li><a href="#å‰ç½®æ¡ä»¶-1" id="toc-å‰ç½®æ¡ä»¶-1">å‰ç½®æ¡ä»¶</a></li>
<li><a href="#è§£å†³æ–¹æ¡ˆ-2" id="toc-è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#ç¬¬-1-æ­¥è¯†åˆ«æ£€æµ‹ç±»å‹15-30-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥è¯†åˆ«æ£€æµ‹ç±»å‹15-30-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ«æ£€æµ‹ç±»å‹ï¼ˆ15-30
åˆ†é’Ÿï¼‰</a></li>
</ul></li>
<li><a href="#install-åˆ°è®¾å¤‡" id="toc-install-åˆ°è®¾å¤‡">2. Install
åˆ°è®¾å¤‡</a></li>
<li><a href="#at-lsposededxposed-in-æ¿€æ´»-module"
id="toc-at-lsposededxposed-in-æ¿€æ´»-module">3. At LSPosed/EdXposed In
æ¿€æ´» Module</a></li>
<li><a href="#open-lsposed-manager" id="toc-open-lsposed-manager">- Open
LSPosed Manager</a></li>
<li><a href="#module-æ‰¾åˆ°-anti-xposed-æ£€æµ‹"
id="toc-module-æ‰¾åˆ°-anti-xposed-æ£€æµ‹">- Module â†’ æ‰¾åˆ° â€œAnti Xposed
æ£€æµ‹â€</a></li>
<li><a href="#å‹¾é€‰-enabledå¹¶-atscopeinaddtarget-app"
id="toc-å‹¾é€‰-enabledå¹¶-atscopeinaddtarget-app">- å‹¾é€‰ Enabledï¼Œå¹¶
AtScopeInAddTarget App</a></li>
<li><a href="#é‡å¯-target-app" id="toc-é‡å¯-target-app">- é‡å¯ Target
App</a></li>
<li><a href="#viewlogvalidate" id="toc-viewlogvalidate">4.
ViewLogValidate</a></li>
<li><a href="#å…¨å±€æ›¿æ¢-xposed-ç‰¹å¾ä¸ºè‡ª-definename-ç§°"
id="toc-å…¨å±€æ›¿æ¢-xposed-ç‰¹å¾ä¸ºè‡ª-definename-ç§°">å…¨å±€æ›¿æ¢ Xposed ç‰¹å¾ä¸ºè‡ª
DefineName ç§°</a></li>
<li><a href="#æ›¿æ¢-packagename" id="toc-æ›¿æ¢-packagename">1. æ›¿æ¢
PackageName</a></li>
<li><a href="#æ›¿æ¢-classname" id="toc-æ›¿æ¢-classname">2. æ›¿æ¢
ClassName</a></li>
<li><a href="#renamefile" id="toc-renamefile">3. renameFile</a></li>
<li><a href="#æ›¿æ¢-libraryfilename" id="toc-æ›¿æ¢-libraryfilename">4.
æ›¿æ¢ LibraryFileName</a></li>
<li><a href="#æ›¿æ¢ç³»ç»Ÿ-propertyname" id="toc-æ›¿æ¢ç³»ç»Ÿ-propertyname">5.
æ›¿æ¢ç³»ç»Ÿ PropertyName</a></li>
<li><a href="#æ‰§è¡Œæ›¿æ¢" id="toc-æ‰§è¡Œæ›¿æ¢">æ‰§è¡Œæ›¿æ¢</a></li>
<li><a href="#ç¼–è¯‘ä»¥-edxposed-ä¸ºä¾‹"
id="toc-ç¼–è¯‘ä»¥-edxposed-ä¸ºä¾‹">ç¼–è¯‘ï¼ˆä»¥ EdXposed ä¸ºä¾‹ï¼‰</a></li>
<li><a href="#è¾“å‡ºä½äº-åœ¨å¤–edxp-coreå‘å¸ƒ"
id="toc-è¾“å‡ºä½äº-åœ¨å¤–edxp-coreå‘å¸ƒ">è¾“å‡ºä½äº
åœ¨å¤–/edxp-core/å‘å¸ƒ/</a></li>
<li><a href="#è·å–-a-.zip-æ–‡ä»¶canat-magisk-in-åˆ·å…¥"
id="toc-è·å–-a-.zip-æ–‡ä»¶canat-magisk-in-åˆ·å…¥">è·å– a .zip æ–‡ä»¶ï¼ŒCanAt
Magisk In åˆ·å…¥</a></li>
<li><a href="#æŸ¥çœ‹-app-æ˜¯å¦æœ‰æ£€æµ‹ç›¸å…³æ—¥å¿—"
id="toc-æŸ¥çœ‹-app-æ˜¯å¦æœ‰æ£€æµ‹ç›¸å…³æ—¥å¿—">æŸ¥çœ‹ App
æ˜¯å¦æœ‰æ£€æµ‹ç›¸å…³æ—¥å¿—</a></li>
<li><a href="#should-see" id="toc-should-see">Should seeï¼š</a></li>
<li><a href="#hook-æˆåŠŸ-log" id="toc-hook-æˆåŠŸ-log">- Hook æˆåŠŸ
Log</a></li>
<li><a href="#æ²¡æœ‰æ£€æµ‹ç›¸å…³é”™è¯¯æ—¥å¿—" id="toc-æ²¡æœ‰æ£€æµ‹ç›¸å…³é”™è¯¯æ—¥å¿—">-
æ²¡æœ‰æ£€æµ‹ç›¸å…³é”™è¯¯æ—¥å¿—</a></li>
<li><a href="#æœç´¢æ‰€æœ‰å¯èƒ½æ£€æµ‹æ¨¡å¼"
id="toc-æœç´¢æ‰€æœ‰å¯èƒ½æ£€æµ‹æ¨¡å¼">æœç´¢æ‰€æœ‰å¯èƒ½æ£€æµ‹æ¨¡å¼</a></li>
<li><a href="#optionalfield"
id="toc-optionalfield">OptionalField</a></li>
<li><a href="#åœ¨å†…-twrp-install-é€‰æ‹©-zip-æ»‘åŠ¨ç¡®è®¤"
id="toc-åœ¨å†…-twrp-install-é€‰æ‹©-zip-æ»‘åŠ¨ç¡®è®¤">åœ¨å†… TWRP, ï¼šInstall â†’ é€‰æ‹©
ZIP â†’ æ»‘åŠ¨ç¡®è®¤</a></li>
<li><a href="#æ£€æŸ¥-if-å…¥å£-class-is-exists-at"
id="toc-æ£€æŸ¥-if-å…¥å£-class-is-exists-at">æ£€æŸ¥ if å…¥å£ Class is exists
at</a></li>
<li><a href="#ç¡®è®¤ç±»å®ç°äº†-ixposedhookloadpackage-æ¥å£"
id="toc-ç¡®è®¤ç±»å®ç°äº†-ixposedhookloadpackage-æ¥å£">ç¡®è®¤ç±»å®ç°äº†
IXposedHookLoadPackage æ¥å£</a>
<ul>
<li><a href="#å¿«é€Ÿå‚è€ƒ" id="toc-å¿«é€Ÿå‚è€ƒ">å¿«é€Ÿå‚è€ƒ</a></li>
<li><a href="#xposed-æ£€æµ‹æ–¹æ³•é€ŸæŸ¥è¡¨" id="toc-xposed-æ£€æµ‹æ–¹æ³•é€ŸæŸ¥è¡¨">#
Xposed æ£€æµ‹æ–¹æ³•é€ŸæŸ¥è¡¨</a></li>
<li><a href="#å®Œæ•´ç»•è¿‡æ¨¡å—æ¨¡æ¿ä¸€é”®ä½¿ç”¨"
id="toc-å®Œæ•´ç»•è¿‡æ¨¡å—æ¨¡æ¿ä¸€é”®ä½¿ç”¨">#
å®Œæ•´ç»•è¿‡æ¨¡å—æ¨¡æ¿ï¼ˆä¸€é”®ä½¿ç”¨ï¼‰</a></li>
</ul></li>
<li><a href="#æŸ¥çœ‹å·²å®‰è£…çš„-xposed-æ¨¡å—"
id="toc-æŸ¥çœ‹å·²å®‰è£…çš„-xposed-æ¨¡å—">æŸ¥çœ‹å·²å®‰è£…çš„ Xposed æ¨¡å—</a></li>
<li><a href="#check-lsposed-status" id="toc-check-lsposed-status">Check
LSPosed Status</a></li>
<li><a href="#logdebug" id="toc-logdebug">========== LogDebug
==========</a></li>
<li><a href="#view-xposed-æ¡†æ¶-log" id="toc-view-xposed-æ¡†æ¶-log">View
Xposed æ¡†æ¶ Log</a></li>
<li><a href="#æŸ¥çœ‹æ¨¡å—æ—¥å¿—å‡è®¾æ¨¡å—æ ‡ç­¾ä¸º-antidetect"
id="toc-æŸ¥çœ‹æ¨¡å—æ—¥å¿—å‡è®¾æ¨¡å—æ ‡ç­¾ä¸º-antidetect">æŸ¥çœ‹æ¨¡å—æ—¥å¿—ï¼ˆå‡è®¾æ¨¡å—æ ‡ç­¾ä¸º
AntiDetectï¼‰</a></li>
<li><a href="#view-app-detection-ç›¸å…³-log"
id="toc-view-app-detection-ç›¸å…³-log">View App Detection ç›¸å…³
Log</a></li>
<li><a href="#æ¸…ç©ºæ—¥å¿—å¹¶å®æ—¶æŸ¥çœ‹"
id="toc-æ¸…ç©ºæ—¥å¿—å¹¶å®æ—¶æŸ¥çœ‹">æ¸…ç©ºæ—¥å¿—å¹¶å®æ—¶æŸ¥çœ‹</a></li>
<li><a href="#modulemanage" id="toc-modulemanage">==========
ModuleManage ==========</a></li>
<li><a href="#compile-xposed-module"
id="toc-compile-xposed-module">Compile Xposed Module</a></li>
<li><a href="#installmodule"
id="toc-installmodule">InstallModule</a></li>
<li><a href="#å¸è½½æ¨¡å—" id="toc-å¸è½½æ¨¡å—">å¸è½½æ¨¡å—</a></li>
<li><a href="#é‡å¯ç›®æ ‡-appåº”ç”¨æ›´æ”¹"
id="toc-é‡å¯ç›®æ ‡-appåº”ç”¨æ›´æ”¹">é‡å¯ç›®æ ‡ Appï¼ˆåº”ç”¨æ›´æ”¹ï¼‰</a></li>
<li><a href="#å®šåˆ¶æ¡†æ¶" id="toc-å®šåˆ¶æ¡†æ¶">========== å®šåˆ¶æ¡†æ¶
==========</a></li>
<li><a href="#æ¨é€è‡ªå®šä¹‰æ¡†æ¶åˆ°è®¾å¤‡"
id="toc-æ¨é€è‡ªå®šä¹‰æ¡†æ¶åˆ°è®¾å¤‡">æ¨é€è‡ªå®šä¹‰æ¡†æ¶åˆ°è®¾å¤‡</a></li>
<li><a href="#åœ¨å†…-magisk-installcommand-line-æ–¹å¼"
id="toc-åœ¨å†…-magisk-installcommand-line-æ–¹å¼">åœ¨å†… Magisk,
Installï¼ˆcommand line æ–¹å¼ï¼‰</a></li>
<li><a href="#é‡å¯è®¾å¤‡" id="toc-é‡å¯è®¾å¤‡">é‡å¯è®¾å¤‡</a></li>
<li><a href="#testvalidate" id="toc-testvalidate">==========
TestValidate ==========</a></li>
<li><a href="#install-xposedchecker-testtool"
id="toc-install-xposedchecker-testtool">Install XposedChecker
TestTool</a></li>
<li><a href="#runtarget-app-å¹¶è§‚å¯Ÿè¡Œä¸º"
id="toc-runtarget-app-å¹¶è§‚å¯Ÿè¡Œä¸º">RunTarget App å¹¶è§‚å¯Ÿè¡Œä¸º</a></li>
<li><a href="#æŠ“å–å´©æºƒæ—¥å¿—" id="toc-æŠ“å–å´©æºƒæ—¥å¿—">æŠ“å–å´©æºƒæ—¥å¿—</a></li>
<li><a href="#checkprocessmemorymappingæŸ¥æ‰¾-xposed-ç‰¹å¾"
id="toc-checkprocessmemorymappingæŸ¥æ‰¾-xposed-ç‰¹å¾">CheckProcessMemoryMappingï¼ˆæŸ¥æ‰¾
Xposed ç‰¹å¾ï¼‰</a></li>
<li><a href="#å·¥ç¨‹åŒ–è‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿ"
id="toc-å·¥ç¨‹åŒ–è‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿ">å·¥ç¨‹åŒ–ï¼šè‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿ</a></li>
<li><a href="#unity-æ¸¸æˆè¿æ¥" id="toc-unity-æ¸¸æˆè¿æ¥">Unity
æ¸¸æˆè¿æ¥</a></li>
<li><a href="#android-åŸç”Ÿåº”ç”¨è¿æ¥"
id="toc-android-åŸç”Ÿåº”ç”¨è¿æ¥">Android åŸç”Ÿåº”ç”¨è¿æ¥</a></li>
<li><a href="#åŸºæœ¬æ“ä½œ" id="toc-åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</a></li>
<li><a href="#ç­‰å¾…å…ƒç´ å‡ºç°" id="toc-ç­‰å¾…å…ƒç´ å‡ºç°">ç­‰å¾…å…ƒç´ å‡ºç°</a></li>
<li><a href="#æ‹–æ‹½æ“ä½œ" id="toc-æ‹–æ‹½æ“ä½œ">æ‹–æ‹½æ“ä½œ</a></li>
<li><a href="#å¤šç‚¹è§¦æ§" id="toc-å¤šç‚¹è§¦æ§">å¤šç‚¹è§¦æ§</a></li>
<li><a href="#ç­‰å¾…æ¸¸æˆçŠ¶æ€" id="toc-ç­‰å¾…æ¸¸æˆçŠ¶æ€">ç­‰å¾…æ¸¸æˆçŠ¶æ€</a></li>
<li><a href="#useexample" id="toc-useexample">UseExample</a></li>
<li><a href="#è®¾ç½®-poco-æ—¥å¿—" id="toc-è®¾ç½®-poco-æ—¥å¿—">è®¾ç½® Poco
æ—¥å¿—</a></li>
<li><a href="#è‡ªå®šä¹‰æ“ä½œæ—¥å¿—"
id="toc-è‡ªå®šä¹‰æ“ä½œæ—¥å¿—">è‡ªå®šä¹‰æ“ä½œæ—¥å¿—</a></li>
<li><a href="#ä½¿ç”¨ç¤ºä¾‹" id="toc-ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li>
<li><a href="#é€†å‘æŠ€æœ¯åŠ¨æ€ä½å®…-ip-ä»£ç†æ± "
id="toc-é€†å‘æŠ€æœ¯åŠ¨æ€ä½å®…-ip-ä»£ç†æ± ">é€†å‘æŠ€æœ¯ï¼šåŠ¨æ€ä½å®… IP ä»£ç†æ± </a>
<ul>
<li><a href="#åŠ¨æ€ä½å®…-ip-æ‹¨å·ä»£ç†-åŸç†"
id="toc-åŠ¨æ€ä½å®…-ip-æ‹¨å·ä»£ç†-åŸç†">1. åŠ¨æ€ä½å®… IP (æ‹¨å·ä»£ç†)
åŸç†</a></li>
<li><a href="#æ­å»ºæ‹¨å·ä»£ç†æ± " id="toc-æ­å»ºæ‹¨å·ä»£ç†æ± ">2.
æ­å»ºæ‹¨å·ä»£ç†æ± </a></li>
</ul></li>
<li><a href="#é‡æ–°è¿æ¥" id="toc-é‡æ–°è¿æ¥">é‡æ–°è¿æ¥</a></li>
<li><a href="#è·å–æ–°-ip" id="toc-è·å–æ–°-ip">è·å–æ–° IP</a></li>
<li><a href="#å®¹å™¨åŒ–éƒ¨ç½²docker-ä¸-kubernetes-å®æˆ˜"
id="toc-å®¹å™¨åŒ–éƒ¨ç½²docker-ä¸-kubernetes-å®æˆ˜">å®¹å™¨åŒ–éƒ¨ç½²ï¼šDocker ä¸
Kubernetes å®æˆ˜</a>
<ul>
<li><a href="#dockerfile-æœ€ä½³å®è·µ" id="toc-dockerfile-æœ€ä½³å®è·µ">1.
Dockerfile æœ€ä½³å®è·µ</a></li>
</ul></li>
<li><a href="#è®¾ç½®å·¥ä½œç›®å½•" id="toc-è®¾ç½®å·¥ä½œç›®å½•">è®¾ç½®å·¥ä½œç›®å½•</a></li>
<li><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" id="toc-è®¾ç½®ç¯å¢ƒå˜é‡">è®¾ç½®ç¯å¢ƒå˜é‡</a></li>
<li><a href="#é˜²æ­¢-python-ç”Ÿæˆ-.pyc-æ–‡ä»¶"
id="toc-é˜²æ­¢-python-ç”Ÿæˆ-.pyc-æ–‡ä»¶">é˜²æ­¢ Python ç”Ÿæˆ .pyc æ–‡ä»¶</a></li>
<li><a href="#å®‰è£…ç³»ç»Ÿä¾èµ–-å¦‚æœéœ€è¦ç¼–è¯‘-lxml-æˆ–å…¶å®ƒåº“"
id="toc-å®‰è£…ç³»ç»Ÿä¾èµ–-å¦‚æœéœ€è¦ç¼–è¯‘-lxml-æˆ–å…¶å®ƒåº“">å®‰è£…ç³»ç»Ÿä¾èµ–
(å¦‚æœéœ€è¦ç¼–è¯‘ lxml æˆ–å…¶å®ƒåº“)</a></li>
<li><a
href="#run-apt-get-update-apt-get-install--y-gcc-libxml2-dev-libxslt-dev-rm--rf-varlibaptlists"
id="toc-run-apt-get-update-apt-get-install--y-gcc-libxml2-dev-libxslt-dev-rm--rf-varlibaptlists">RUN
apt-get update &amp;&amp; apt-get install -y gcc libxml2-dev libxslt-dev
&amp;&amp; rm -rf /var/lib/apt/lists/*</a></li>
<li><a href="#å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…"
id="toc-å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…">å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…</a></li>
<li><a href="#å¤åˆ¶é¡¹ç›®ä»£ç " id="toc-å¤åˆ¶é¡¹ç›®ä»£ç ">å¤åˆ¶é¡¹ç›®ä»£ç </a></li>
<li><a href="#é»˜è®¤å¯åŠ¨å‘½ä»¤-å¯è¢«-docker-run-è¦†ç›–"
id="toc-é»˜è®¤å¯åŠ¨å‘½ä»¤-å¯è¢«-docker-run-è¦†ç›–">é»˜è®¤å¯åŠ¨å‘½ä»¤ (å¯è¢« docker run
è¦†ç›–)</a></li>
<li><a
href="#è¿™é‡Œæˆ‘ä»¬é»˜è®¤å¯åŠ¨-scrapyd-å¦‚æœä½¿ç”¨-scrapyd-éƒ¨ç½²-æˆ–ä»…ä½œä¸ºä¸€ä¸ª-shell"
id="toc-è¿™é‡Œæˆ‘ä»¬é»˜è®¤å¯åŠ¨-scrapyd-å¦‚æœä½¿ç”¨-scrapyd-éƒ¨ç½²-æˆ–ä»…ä½œä¸ºä¸€ä¸ª-shell">è¿™é‡Œæˆ‘ä»¬é»˜è®¤å¯åŠ¨
scrapyd (å¦‚æœä½¿ç”¨ scrapyd éƒ¨ç½²) æˆ–ä»…ä½œä¸ºä¸€ä¸ª shell</a></li>
<li><a href="#mongodb-æœåŠ¡-æ•°æ®å­˜å‚¨" id="toc-mongodb-æœåŠ¡-æ•°æ®å­˜å‚¨">2.
MongoDB æœåŠ¡ (æ•°æ®å­˜å‚¨)</a></li>
<li><a href="#çˆ¬è™«æœåŠ¡-masterslave-æ¨¡å¼ä¸­çš„-slave"
id="toc-çˆ¬è™«æœåŠ¡-masterslave-æ¨¡å¼ä¸­çš„-slave">3. çˆ¬è™«æœåŠ¡ (Master/Slave
æ¨¡å¼ä¸­çš„ Slave)</a></li>
<li><a href="#appconfig" id="toc-appconfig">AppConfig</a></li>
<li><a href="#view-pod-status" id="toc-view-pod-status">View Pod
Status</a></li>
<li><a href="#åŠ¨æ€æ‰©ç¼©å®¹-noéœ€modify-yaml"
id="toc-åŠ¨æ€æ‰©ç¼©å®¹-noéœ€modify-yaml">åŠ¨æ€æ‰©ç¼©å®¹ (Noéœ€Modify
yaml)</a></li>
<li><a href="#å¯ç”¨-scrapy-redis-è°ƒåº¦å™¨"
id="toc-å¯ç”¨-scrapy-redis-è°ƒåº¦å™¨">1. å¯ç”¨ Scrapy-Redis è°ƒåº¦å™¨</a></li>
<li><a href="#å¯ç”¨-scrapy-redis-å»é‡filterå™¨"
id="toc-å¯ç”¨-scrapy-redis-å»é‡filterå™¨">2. å¯ç”¨ Scrapy-Redis
å»é‡Filterå™¨</a></li>
<li><a href="#å…è®¸æš‚åœ-æ–­ç‚¹ç»­çˆ¬core" id="toc-å…è®¸æš‚åœ-æ–­ç‚¹ç»­çˆ¬core">3.
å…è®¸æš‚åœ (æ–­ç‚¹ç»­çˆ¬Core)</a></li>
<li><a href="#å¦‚æœä¸ºçœŸå½“çˆ¬è™«åœæ­¢æ—¶redis-ä¸­çš„è¯·æ±‚é˜Ÿåˆ—ä¸ä¼šè¢«æ¸…ç©º"
id="toc-å¦‚æœä¸ºçœŸå½“çˆ¬è™«åœæ­¢æ—¶redis-ä¸­çš„è¯·æ±‚é˜Ÿåˆ—ä¸ä¼šè¢«æ¸…ç©º">å¦‚æœä¸ºçœŸï¼Œå½“çˆ¬è™«åœæ­¢æ—¶ï¼ŒRedis
ä¸­çš„è¯·æ±‚é˜Ÿåˆ—ä¸ä¼šè¢«æ¸…ç©º</a></li>
<li><a href="#settingssssss-redis-connect"
id="toc-settingssssss-redis-connect">4. settingssssss Redis
Connect</a></li>
<li><a href="#æ–¹å¼ä¸€å•ç‹¬setting"
id="toc-æ–¹å¼ä¸€å•ç‹¬setting">æ–¹å¼ä¸€ï¼šå•ç‹¬Setting</a></li>
<li><a href="#æ–¹å¼äºŒå®Œæˆ-åœ°å€" id="toc-æ–¹å¼äºŒå®Œæˆ-åœ°å€">æ–¹å¼äºŒï¼šå®Œæˆ
åœ°å€</a></li>
<li><a href="#redis_url-redisuserpasshostname9001"
id="toc-redis_url-redisuserpasshostname9001">REDIS_URL =
â€˜redis://user:pass@hostname:9001â€™</a></li>
<li><a href="#é…ç½®è¯·æ±‚é˜Ÿåˆ—æ¨¡å¼å¯é€‰é»˜è®¤ä¸º-priorityqueue"
id="toc-é…ç½®è¯·æ±‚é˜Ÿåˆ—æ¨¡å¼å¯é€‰é»˜è®¤ä¸º-priorityqueue">5.
é…ç½®è¯·æ±‚é˜Ÿåˆ—æ¨¡å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º PriorityQueueï¼‰</a></li>
<li><a
href="#scheduler_queue_class-scrapy_redis.queue.priorityqueue-æœ‰åºé›†åˆæ”¯æŒä¼˜å…ˆçº§"
id="toc-scheduler_queue_class-scrapy_redis.queue.priorityqueue-æœ‰åºé›†åˆæ”¯æŒä¼˜å…ˆçº§">SCHEDULER_QUEUE_CLASS
= â€˜scrapy_redis.queue.PriorityQueueâ€™ # æœ‰åºé›†åˆï¼Œæ”¯æŒä¼˜å…ˆçº§</a></li>
<li><a
href="#scheduler_queue_class-scrapy_redis.queue.fifoqueue-å…ˆè¿›å…ˆå‡ºåˆ—è¡¨"
id="toc-scheduler_queue_class-scrapy_redis.queue.fifoqueue-å…ˆè¿›å…ˆå‡ºåˆ—è¡¨">SCHEDULER_QUEUE_CLASS
= â€˜scrapy_redis.queue.FifoQueueâ€™ # å…ˆè¿›å…ˆå‡ºåˆ—è¡¨</a></li>
<li><a
href="#scheduler_queue_class-scrapy_redis.queue.lifoqueue-åè¿›å…ˆå‡ºåˆ—è¡¨æ ˆ"
id="toc-scheduler_queue_class-scrapy_redis.queue.lifoqueue-åè¿›å…ˆå‡ºåˆ—è¡¨æ ˆ">SCHEDULER_QUEUE_CLASS
= â€˜scrapy_redis.queue.LifoQueueâ€™ # åè¿›å…ˆå‡ºåˆ—è¡¨ï¼ˆæ ˆï¼‰</a></li>
<li><a href="#å¯é€‰-å°†æ•°æ®å­˜å…¥-redis-pipeline"
id="toc-å¯é€‰-å°†æ•°æ®å­˜å…¥-redis-pipeline">6. (å¯é€‰) å°†æ•°æ®å­˜å…¥ Redis
Pipeline</a>
<ul>
<li><a href="#bloom-filter-å»é‡ä¼˜åŒ–" id="toc-bloom-filter-å»é‡ä¼˜åŒ–">#
Bloom Filter å»é‡ä¼˜åŒ–</a></li>
<li><a href="#è§£å†³æ–¹æ¡ˆ-3" id="toc-è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#ç¬¬-1-æ­¥è¯†åˆ«åŠ å¯†ç®—æ³•5-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥è¯†åˆ«åŠ å¯†ç®—æ³•5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ï¼ˆ5
åˆ†é’Ÿï¼‰</a></li>
<li><a href="#æœç´¢ç‰¹å¾å­—ç¬¦ä¸²" id="toc-æœç´¢ç‰¹å¾å­—ç¬¦ä¸²"># # 1.1
æœç´¢ç‰¹å¾å­—ç¬¦ä¸²</a></li>
</ul></li>
<li><a href="#search-.so-fileinencryptlibrary"
id="toc-search-.so-fileinencryptlibrary">Search .so
FileInEncryptLibrary</a></li>
<li><a href="#or-ç”¨-toolanalyze" id="toc-or-ç”¨-toolanalyze">or ç”¨
ToolAnalyze</a>
<ul>
<li><a href="#ç¬¬-4-æ­¥åŠ¨æ€æå–å¯†é’¥15-åˆ†é’Ÿ"
id="toc-ç¬¬-4-æ­¥åŠ¨æ€æå–å¯†é’¥15-åˆ†é’Ÿ"># ç¬¬ 4 æ­¥ï¼šåŠ¨æ€æå–å¯†é’¥ï¼ˆ15
åˆ†é’Ÿï¼‰</a></li>
<li><a href="#hook-java-å±‚åŠ å¯†" id="toc-hook-java-å±‚åŠ å¯†"># # 4.1 Hook
Java å±‚åŠ å¯†</a></li>
</ul></li>
<li><a href="#ä½¿ç”¨nmæŸ¥çœ‹å‡½æ•°"
id="toc-ä½¿ç”¨nmæŸ¥çœ‹å‡½æ•°">ä½¿ç”¨nmæŸ¥çœ‹å‡½æ•°</a></li>
<li><a href="#ä½¿ç”¨frida" id="toc-ä½¿ç”¨frida">ä½¿ç”¨Frida</a>
<ul>
<li><a href="#python-è„šæœ¬éªŒè¯" id="toc-python-è„šæœ¬éªŒè¯"># 5.2 Python
è„šæœ¬éªŒè¯</a></li>
<li><a href="#é—®é¢˜-3-native-å‡½æ•°æ‰¾ä¸åˆ°"
id="toc-é—®é¢˜-3-native-å‡½æ•°æ‰¾ä¸åˆ°"># âŒ é—®é¢˜ 3: Native
å‡½æ•°æ‰¾ä¸åˆ°</a></li>
<li><a href="#å»¶ä¼¸é˜…è¯»" id="toc-å»¶ä¼¸é˜…è¯»">å»¶ä¼¸é˜…è¯»</a></li>
<li><a href="#ç›¸å…³-recipes-1" id="toc-ç›¸å…³-recipes-1"># ç›¸å…³
Recipes</a></li>
<li><a href="#å·¥å…·æ·±å…¥-2" id="toc-å·¥å…·æ·±å…¥-2"># å·¥å…·æ·±å…¥</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-1" id="toc-æ¡ˆä¾‹åˆ†æ-1"># æ¡ˆä¾‹åˆ†æ</a></li>
<li><a href="#ç†è®ºåŸºç¡€" id="toc-ç†è®ºåŸºç¡€"># ç†è®ºåŸºç¡€</a></li>
<li><a href="#å¿«é€Ÿå‚è€ƒ-1" id="toc-å¿«é€Ÿå‚è€ƒ-1">å¿«é€Ÿå‚è€ƒ</a></li>
<li><a href="#hook-è„šæœ¬æ¨¡æ¿åº“" id="toc-hook-è„šæœ¬æ¨¡æ¿åº“"># Hook
è„šæœ¬æ¨¡æ¿åº“</a></li>
</ul></li>
<li><a href="#aes-encrypt" id="toc-aes-encrypt">AES Encrypt</a></li>
<li><a href="#aes-decrypt" id="toc-aes-decrypt">AES Decrypt</a></li>
<li><a href="#generate-md5" id="toc-generate-md5">Generate MD5</a></li>
<li><a href="#generate-sha256" id="toc-generate-sha256">Generate
SHA256</a></li>
<li><a href="#rsa-å¯†é’¥ç”Ÿæˆ" id="toc-rsa-å¯†é’¥ç”Ÿæˆ">RSA å¯†é’¥ç”Ÿæˆ</a></li>
<li><a href="#ja3-tls-æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£"
id="toc-ja3-tls-æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£">JA3 TLS æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</a>
<ul>
<li><a href="#ç›®å½•-1" id="toc-ç›®å½•-1">ç›®å½•</a></li>
</ul></li>
<li><a href="#ja4-tlsquic-æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£"
id="toc-ja4-tlsquic-æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£">JA4+ TLS/QUIC æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</a>
<ul>
<li><a href="#ç›®å½•-2" id="toc-ç›®å½•-2">ç›®å½•</a></li>
<li><a href="#ä¸ºä»€ä¹ˆéœ€è¦-ja4-ja3-çš„å±€é™æ€§"
id="toc-ä¸ºä»€ä¹ˆéœ€è¦-ja4-ja3-çš„å±€é™æ€§">ä¸ºä»€ä¹ˆéœ€è¦ JA4+ (JA3
çš„å±€é™æ€§)</a></li>
<li><a href="#ja4-çš„æ ¸å¿ƒè®¾è®¡---ä¸å†æ˜¯å“ˆå¸Œ"
id="toc-ja4-çš„æ ¸å¿ƒè®¾è®¡---ä¸å†æ˜¯å“ˆå¸Œ">JA4 çš„æ ¸å¿ƒè®¾è®¡ -
ä¸å†æ˜¯å“ˆå¸Œ</a></li>
<li><a href="#ja4-å¥—ä»¶æ¦‚è§ˆ" id="toc-ja4-å¥—ä»¶æ¦‚è§ˆ">JA4+ å¥—ä»¶æ¦‚è§ˆ</a></li>
<li><a href="#ja4-vs-ja3æ ¸å¿ƒä¼˜åŠ¿" id="toc-ja4-vs-ja3æ ¸å¿ƒä¼˜åŠ¿">JA4 vs
JA3ï¼šæ ¸å¿ƒä¼˜åŠ¿</a></li>
<li><a href="#åº”ç”¨ä¸å®è·µ" id="toc-åº”ç”¨ä¸å®è·µ">åº”ç”¨ä¸å®è·µ</a></li>
</ul></li>
<li><a href="#recipe-æŠ“åŒ…åˆ†æ-android-åº”ç”¨çš„ç½‘ç»œæµé‡"
id="toc-recipe-æŠ“åŒ…åˆ†æ-android-åº”ç”¨çš„ç½‘ç»œæµé‡">Recipe: æŠ“åŒ…åˆ†æ android
åº”ç”¨çš„ç½‘ç»œæµé‡</a>
<ul>
<li><a href="#é—®é¢˜åœºæ™¯-5" id="toc-é—®é¢˜åœºæ™¯-5">é—®é¢˜åœºæ™¯</a></li>
<li><a href="#å·¥å…·æ¸…å•-2" id="toc-å·¥å…·æ¸…å•-2">å·¥å…·æ¸…å•</a></li>
<li><a href="#å¿…éœ€å·¥å…·-5" id="toc-å¿…éœ€å·¥å…·-5"># å¿…éœ€å·¥å…·</a></li>
<li><a href="#å¯é€‰å·¥å…·-5" id="toc-å¯é€‰å·¥å…·-5"># å¯é€‰å·¥å…·</a></li>
<li><a href="#å‰ç½®æ¡ä»¶-2" id="toc-å‰ç½®æ¡ä»¶-2">å‰ç½®æ¡ä»¶</a></li>
<li><a href="#ç¡®è®¤æ¸…å•-3" id="toc-ç¡®è®¤æ¸…å•-3"># âœ… ç¡®è®¤æ¸…å•</a></li>
<li><a href="#è§£å†³æ–¹æ¡ˆ-4" id="toc-è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#ç¬¬-1-æ­¥é…ç½®æŠ“åŒ…å·¥å…·5-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥é…ç½®æŠ“åŒ…å·¥å…·5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šé…ç½®æŠ“åŒ…å·¥å…·ï¼ˆ5
åˆ†é’Ÿï¼‰</a></li>
<li><a href="#ç¬¬-2-æ­¥é…ç½®æ‰‹æœºä»£ç†2-åˆ†é’Ÿ"
id="toc-ç¬¬-2-æ­¥é…ç½®æ‰‹æœºä»£ç†2-åˆ†é’Ÿ"># ç¬¬ 2 æ­¥ï¼šé…ç½®æ‰‹æœºä»£ç†ï¼ˆ2
åˆ†é’Ÿï¼‰</a></li>
<li><a href="#ç¬¬-3-æ­¥å®‰è£…-https-è¯ä¹¦5-10-åˆ†é’Ÿ"
id="toc-ç¬¬-3-æ­¥å®‰è£…-https-è¯ä¹¦5-10-åˆ†é’Ÿ"># ç¬¬ 3 æ­¥ï¼šå®‰è£… HTTPS
è¯ä¹¦ï¼ˆ5-10 åˆ†é’Ÿï¼‰</a></li>
<li><a href="#ç¬¬-4-æ­¥å¼€å§‹æŠ“åŒ…1-åˆ†é’Ÿ" id="toc-ç¬¬-4-æ­¥å¼€å§‹æŠ“åŒ…1-åˆ†é’Ÿ"># ç¬¬
4 æ­¥ï¼šå¼€å§‹æŠ“åŒ…ï¼ˆ1 åˆ†é’Ÿï¼‰</a></li>
<li><a href="#ç¬¬-5-æ­¥ç»•è¿‡-ssl-pinningå¦‚é‡åˆ°"
id="toc-ç¬¬-5-æ­¥ç»•è¿‡-ssl-pinningå¦‚é‡åˆ°"># ç¬¬ 5 æ­¥ï¼šç»•è¿‡ SSL
Pinningï¼ˆå¦‚é‡åˆ°ï¼‰</a></li>
<li><a href="#å·¥ä½œåŸç†-1" id="toc-å·¥ä½œåŸç†-1">å·¥ä½œåŸç†</a></li>
<li><a href="#mitmä¸­é—´äººæ”»å‡»æµç¨‹" id="toc-mitmä¸­é—´äººæ”»å‡»æµç¨‹">#
MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰æµç¨‹</a></li>
<li><a href="#é—®é¢˜-1-æ‰‹æœºæ— æ³•è¿æ¥ä»£ç†"
id="toc-é—®é¢˜-1-æ‰‹æœºæ— æ³•è¿æ¥ä»£ç†"># âŒ é—®é¢˜ 1: æ‰‹æœºæ— æ³•è¿æ¥ä»£ç†</a></li>
<li><a href="#é—®é¢˜-3-frida-è„šæœ¬ä¸ç”Ÿæ•ˆ"
id="toc-é—®é¢˜-3-frida-è„šæœ¬ä¸ç”Ÿæ•ˆ"># âŒ é—®é¢˜ 3: Frida è„šæœ¬ä¸ç”Ÿæ•ˆ</a></li>
<li><a href="#å»¶ä¼¸é˜…è¯»-1" id="toc-å»¶ä¼¸é˜…è¯»-1">å»¶ä¼¸é˜…è¯»</a></li>
<li><a href="#ç›¸å…³-recipes-2" id="toc-ç›¸å…³-recipes-2"># ç›¸å…³
Recipes</a></li>
<li><a href="#å·¥å…·æ·±å…¥-3" id="toc-å·¥å…·æ·±å…¥-3"># å·¥å…·æ·±å…¥</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-2" id="toc-æ¡ˆä¾‹åˆ†æ-2"># æ¡ˆä¾‹åˆ†æ</a></li>
<li><a href="#å¿«é€Ÿå‚è€ƒ-2" id="toc-å¿«é€Ÿå‚è€ƒ-2">å¿«é€Ÿå‚è€ƒ</a></li>
<li><a href="#ä¸€é”®å¯åŠ¨è„šæœ¬" id="toc-ä¸€é”®å¯åŠ¨è„šæœ¬">#
ä¸€é”®å¯åŠ¨è„šæœ¬</a></li>
<li><a href="#è§£å†³æ–¹æ¡ˆ-5" id="toc-è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#ç¬¬-1-æ­¥ç†è§£-tls-æŒ‡çº¹è¯†åˆ«åŸç†5-åˆ†é’Ÿ"
id="toc-ç¬¬-1-æ­¥ç†è§£-tls-æŒ‡çº¹è¯†åˆ«åŸç†5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šç†è§£ TLS
æŒ‡çº¹è¯†åˆ«åŸç†ï¼ˆ5 åˆ†é’Ÿï¼‰</a></li>
<li><a href="#ç¬¬-2-æ­¥æ£€æµ‹ä½ çš„-tls-æŒ‡çº¹10-åˆ†é’Ÿ"
id="toc-ç¬¬-2-æ­¥æ£€æµ‹ä½ çš„-tls-æŒ‡çº¹10-åˆ†é’Ÿ"># ç¬¬ 2 æ­¥ï¼šæ£€æµ‹ä½ çš„ TLS
æŒ‡çº¹ï¼ˆ10 åˆ†é’Ÿï¼‰</a></li>
</ul></li>
<li><a href="#ä¼ªè£…æˆ-firefox-121" id="toc-ä¼ªè£…æˆ-firefox-121">ä¼ªè£…æˆ
Firefox 121</a></li>
<li><a href="#ä¼ªè£…æˆ-safari-17" id="toc-ä¼ªè£…æˆ-safari-17">ä¼ªè£…æˆ Safari
17</a></li>
<li><a href="#åˆ›å»ºä¼šè¯ä¼ªè£…æˆ-chrome-120"
id="toc-åˆ›å»ºä¼šè¯ä¼ªè£…æˆ-chrome-120">åˆ›å»ºä¼šè¯ï¼Œä¼ªè£…æˆ Chrome 120</a></li>
<li><a href="#sendrequest" id="toc-sendrequest">SendRequest</a></li>
<li><a href="#ä½¿ç”¨ä¼ªè£…çš„-tls-æŒ‡çº¹"
id="toc-ä½¿ç”¨ä¼ªè£…çš„-tls-æŒ‡çº¹">ä½¿ç”¨ä¼ªè£…çš„ TLS æŒ‡çº¹</a>
<ul>
<li><a href="#é—®é¢˜-4-å¦‚ä½•åœ¨-frida-ä¸­ä¿®æ”¹-tls-æŒ‡çº¹"
id="toc-é—®é¢˜-4-å¦‚ä½•åœ¨-frida-ä¸­ä¿®æ”¹-tls-æŒ‡çº¹"># âŒ é—®é¢˜ 4: å¦‚ä½•åœ¨ Frida
ä¸­ä¿®æ”¹ TLS æŒ‡çº¹ï¼Ÿ</a></li>
<li><a href="#å»¶ä¼¸é˜…è¯»-2" id="toc-å»¶ä¼¸é˜…è¯»-2">å»¶ä¼¸é˜…è¯»</a></li>
<li><a href="#ç›¸å…³-recipes-3" id="toc-ç›¸å…³-recipes-3"># ç›¸å…³
Recipes</a></li>
<li><a href="#å·¥å…·æ·±å…¥-4" id="toc-å·¥å…·æ·±å…¥-4"># å·¥å…·æ·±å…¥</a></li>
<li><a href="#åœ¨çº¿èµ„æº" id="toc-åœ¨çº¿èµ„æº"># åœ¨çº¿èµ„æº</a></li>
<li><a href="#ç†è®ºåŸºç¡€-1" id="toc-ç†è®ºåŸºç¡€-1"># ç†è®ºåŸºç¡€</a></li>
<li><a href="#å¿«é€Ÿå‚è€ƒ-3" id="toc-å¿«é€Ÿå‚è€ƒ-3">å¿«é€Ÿå‚è€ƒ</a></li>
<li><a href="#å¸¸ç”¨å·¥å…·å¯¹æ¯”" id="toc-å¸¸ç”¨å·¥å…·å¯¹æ¯”">#
å¸¸ç”¨å·¥å…·å¯¹æ¯”</a></li>
<li><a href="#å¿«é€Ÿæ£€æµ‹è„šæœ¬" id="toc-å¿«é€Ÿæ£€æµ‹è„šæœ¬">#
å¿«é€Ÿæ£€æµ‹è„šæœ¬</a></li>
</ul></li>
<li><a href="#ä½¿ç”¨ç¤ºä¾‹-1" id="toc-ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</a></li>
<li><a href="#éªŒè¯æŒ‡çº¹" id="toc-éªŒè¯æŒ‡çº¹">éªŒè¯æŒ‡çº¹</a></li>
<li><a href="#å‘é€è¯·æ±‚" id="toc-å‘é€è¯·æ±‚">å‘é€è¯·æ±‚</a></li>
<li><a
href="#usethreadæ± concurrentinstall-æ³¨æ„adb-concurrentå¯èƒ½ä¸stableè§†æƒ…å†µè°ƒæ•´"
id="toc-usethreadæ± concurrentinstall-æ³¨æ„adb-concurrentå¯èƒ½ä¸stableè§†æƒ…å†µè°ƒæ•´">UseThreadæ± ConcurrentInstall
(æ³¨æ„ï¼šADB Concurrentå¯èƒ½ä¸Stableï¼Œè§†æƒ…å†µè°ƒæ•´)</a></li>
<li><a href="#useexample-1" id="toc-useexample-1">UseExample</a></li>
<li><a href="#æ‰¹é‡å®‰è£…å½“å‰ç›®å½•ä¸‹-apks-æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰-apk"
id="toc-æ‰¹é‡å®‰è£…å½“å‰ç›®å½•ä¸‹-apks-æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰-apk">æ‰¹é‡å®‰è£…å½“å‰ç›®å½•ä¸‹
apks æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰ apk</a></li>
<li><a href="#manager.install_all.apks"
id="toc-manager.install_all.apks">manager.install_all(â€œ./apksâ€)</a></li>
<li><a href="#settingssssssä»£ç†ä»¥ä¾¿æŠ“package"
id="toc-settingssssssä»£ç†ä»¥ä¾¿æŠ“package">settingssssssä»£ç†ä»¥ä¾¿æŠ“Package</a></li>
<li><a href="#manager.setup_proxy192.168.1.10-8080"
id="toc-manager.setup_proxy192.168.1.10-8080">manager.setup_proxy(â€œ192.168.1.10â€,
â€œ8080â€)</a></li>
<li><a href="#c-ä»£ç ç”¨äºè¿è¡Œæ—¶ä»¿çœŸä¸è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ"
id="toc-c-ä»£ç ç”¨äºè¿è¡Œæ—¶ä»¿çœŸä¸è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ">C
ä»£ç ï¼šç”¨äºè¿è¡Œæ—¶ä»¿çœŸä¸è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ</a>
<ul>
<li><a href="#è¿è¡Œæ—¶ä»¿çœŸ-runtime-emulation"
id="toc-è¿è¡Œæ—¶ä»¿çœŸ-runtime-emulation">1. è¿è¡Œæ—¶ä»¿çœŸ (Runtime
Emulation)</a></li>
</ul></li>
<li><a href="#attach-mode" id="toc-attach-mode">Attach mode</a></li>
<li><a href="#run-script" id="toc-run-script">2. Run script</a></li>
<li><a href="#view-traffic-in-burpmitmproxy"
id="toc-view-traffic-in-burpmitmproxy">3. View traffic in
Burp/mitmproxy</a></li>
<li><a href="#rpc_controller.py---python-rpc-control-script"
id="toc-rpc_controller.py---python-rpc-control-script">rpc_controller.py
- Python RPC control script</a></li>
<li><a href="#attach-to-running-app"
id="toc-attach-to-running-app">Attach to running app</a></li>
<li><a href="#section"
id="toc-section">========================================</a></li>
<li><a href="#load-frida-script" id="toc-load-frida-script">Load Frida
Script</a></li>
<li><a href="#section-1"
id="toc-section-1">========================================</a></li>
<li><a href="#section-2"
id="toc-section-2">========================================</a></li>
<li><a href="#get-rpc-api" id="toc-get-rpc-api">Get RPC API</a></li>
<li><a href="#section-3"
id="toc-section-3">========================================</a></li>
<li><a href="#section-4"
id="toc-section-4">========================================</a></li>
<li><a href="#example-1-call-encryption-function"
id="toc-example-1-call-encryption-function">Example 1: Call encryption
function</a></li>
<li><a href="#section-5"
id="toc-section-5">========================================</a></li>
<li><a href="#section-6"
id="toc-section-6">========================================</a></li>
<li><a href="#example-2-batch-test"
id="toc-example-2-batch-test">Example 2: Batch test</a></li>
<li><a href="#section-7"
id="toc-section-7">========================================</a></li>
<li><a href="#section-8"
id="toc-section-8">========================================</a></li>
<li><a href="#example-3-get-app-info"
id="toc-example-3-get-app-info">Example 3: Get app info</a></li>
<li><a href="#section-9"
id="toc-section-9">========================================</a></li>
<li><a href="#section-10"
id="toc-section-10">========================================</a></li>
<li><a href="#keep-session-alive" id="toc-keep-session-alive">Keep
session alive</a></li>
<li><a href="#section-11"
id="toc-section-11">========================================</a></li>
<li><a href="#run-the-program" id="toc-run-the-program">Run the
program</a></li>
<li><a href="#output" id="toc-output">Output:</a></li>
<li><a href="#xor-encryption-algorithm-test"
id="toc-xor-encryption-algorithm-test">=== XOR Encryption Algorithm Test
===</a>
<ul>
<li><a href="#plaintext-hello-android-reverse-engineering"
id="toc-plaintext-hello-android-reverse-engineering">Plaintext: Hello,
Android Reverse Engineering!</a></li>
</ul></li>
<li><a href="#plaintext-hex-48-65-6c-6c-6f-2c-20-41-6e-64-72-6f-69-64"
id="toc-plaintext-hex-48-65-6c-6c-6f-2c-20-41-6e-64-72-6f-69-64">Plaintext
HEX: 48 65 6c 6c 6f 2c 20 41 6e 64 72 6f 69 64 â€¦</a>
<ul>
<li><a href="#after-encryption" id="toc-after-encryption">After
encryption:</a></li>
</ul></li>
<li><a href="#ciphertext-hex-17-30-39-39-32-79-75-16-39-31-2d-32-36-31"
id="toc-ciphertext-hex-17-30-39-39-32-79-75-16-39-31-2d-32-36-31">Ciphertext
HEX: 17 30 39 39 32 79 75 16 39 31 2d 32 36 31 â€¦</a>
<ul>
<li><a href="#after-decryption-hello-android-reverse-engineering"
id="toc-after-decryption-hello-android-reverse-engineering">After
decryption: Hello, Android Reverse Engineering!</a></li>
</ul></li>
<li><a href="#run-the-program-1" id="toc-run-the-program-1">Run the
program</a></li>
<li><a href="#output-json-format-device-fingerprint"
id="toc-output-json-format-device-fingerprint">Output JSON format device
fingerprint:</a></li>
<li><a href="#section-12" id="toc-section-12">{</a></li>
<li><a href="#timestamp-1734518400"
id="toc-timestamp-1734518400">â€œtimestampâ€: 1734518400,</a></li>
<li><a href="#device" id="toc-device">â€œdeviceâ€: {</a></li>
<li><a href="#brand-google" id="toc-brand-google">â€œbrandâ€:
â€œgoogleâ€,</a></li>
<li><a href="#model-pixel-5" id="toc-model-pixel-5">â€œmodelâ€: â€œPixel
5â€,</a></li>
<li><a href="#manufacturer-google"
id="toc-manufacturer-google">â€œmanufacturerâ€: â€œGoogleâ€,</a></li>
<li><a href="#section-13" id="toc-section-13">â€¦</a></li>
<li><a href="#section-14" id="toc-section-14">}</a></li>
<li><a href="#section-15" id="toc-section-15">}</a></li>
<li><a href="#save-to-file" id="toc-save-to-file">Save to file</a>
<ul>
<li><a href="#å¿«é€Ÿå‚è€ƒ-4" id="toc-å¿«é€Ÿå‚è€ƒ-4">å¿«é€Ÿå‚è€ƒ</a></li>
</ul></li>
<li><a href="#frida-å®æˆ˜è„šæœ¬é›†" id="toc-frida-å®æˆ˜è„šæœ¬é›†">Frida
å®æˆ˜è„šæœ¬é›†</a>
<ul>
<li><a href="#ç›®å½•-3" id="toc-ç›®å½•-3">ç›®å½•</a></li>
</ul></li>
<li><a href="#native-å±‚-hook-æŠ€å·§-native-hooking-patterns"
id="toc-native-å±‚-hook-æŠ€å·§-native-hooking-patterns">Native å±‚ Hook æŠ€å·§
(Native Hooking Patterns)</a>
<ul>
<li><a href="#æ–‡ä»¶æ“ä½œç›‘æ§-file-io" id="toc-æ–‡ä»¶æ“ä½œç›‘æ§-file-io">1.
æ–‡ä»¶æ“ä½œç›‘æ§ (File I/O)</a></li>
<li><a href="#hook-open-openat" id="toc-hook-open-openat"># Hook
<code>open</code> / <code>openat</code></a></li>
</ul></li>
<li><a href="#searchcontains-encrypt-method"
id="toc-searchcontains-encrypt-method">SearchContains â€œencryptâ€
Method</a></li>
<li><a href="#å¼ºåˆ¶-isrooted-methodreturn-å‡"
id="toc-å¼ºåˆ¶-isrooted-methodreturn-å‡">å¼ºåˆ¶ isRooted MethodReturn
å‡</a></li>
<li><a href="#å‡è®¾ä¸Šä¸€æ­¥æœç´¢åˆ°å®ä¾‹-hashcode-ä¸º-123456"
id="toc-å‡è®¾ä¸Šä¸€æ­¥æœç´¢åˆ°å®ä¾‹-hashcode-ä¸º-123456">å‡è®¾ä¸Šä¸€æ­¥æœç´¢åˆ°å®ä¾‹
hashcode ä¸º 123456</a></li>
<li><a href="#è°ƒç”¨è¯¥å®ä¾‹çš„-gettoken-æ–¹æ³•"
id="toc-è°ƒç”¨è¯¥å®ä¾‹çš„-gettoken-æ–¹æ³•">è°ƒç”¨è¯¥å®ä¾‹çš„ getToken æ–¹æ³•</a></li>
<li><a
href="#will-libnative-lib.so-exportåˆ°nativefile-used-forä¿®å¤è„±å£³after-so"
id="toc-will-libnative-lib.so-exportåˆ°nativefile-used-forä¿®å¤è„±å£³after-so">Will
libnative-lib.so Exportåˆ°NativeFile (Used forä¿®å¤è„±å£³After SO)</a></li>
<li><a href="#f-å¯åŠ¨åº”ç”¨" id="toc-f-å¯åŠ¨åº”ç”¨">-f: å¯åŠ¨åº”ç”¨</a></li>
<li><a href="#no-pause-ä¸æš‚åœç«‹å³è¿è¡Œ"
id="toc-no-pause-ä¸æš‚åœç«‹å³è¿è¡Œ">â€“no-pause: ä¸æš‚åœï¼Œç«‹å³è¿è¡Œ</a></li>
<li><a href="#è„šæœ¬ä¼šè‡ªåŠ¨" id="toc-è„šæœ¬ä¼šè‡ªåŠ¨">è„šæœ¬ä¼šè‡ªåŠ¨ï¼š</a></li>
<li><a href="#å¯åŠ¨åº”ç”¨" id="toc-å¯åŠ¨åº”ç”¨">1. å¯åŠ¨åº”ç”¨</a></li>
<li><a href="#hook-dex-åŠ è½½å‡½æ•°" id="toc-hook-dex-åŠ è½½å‡½æ•°">2. Hook DEX
åŠ è½½å‡½æ•°</a></li>
<li><a href="#å¯¼å‡ºæ‰€æœ‰å·²åŠ è½½çš„-dex-æ–‡ä»¶"
id="toc-å¯¼å‡ºæ‰€æœ‰å·²åŠ è½½çš„-dex-æ–‡ä»¶">3. å¯¼å‡ºæ‰€æœ‰å·²åŠ è½½çš„ DEX æ–‡ä»¶</a></li>
<li><a href="#ä¿å­˜åˆ°å½“å‰ç›®å½•" id="toc-ä¿å­˜åˆ°å½“å‰ç›®å½•">4.
ä¿å­˜åˆ°å½“å‰ç›®å½•</a></li>
<li><a href="#ç„¶ååœ¨åº”ç”¨å†…è§¦å‘éœ€è¦åˆ†æçš„åŠŸèƒ½"
id="toc-ç„¶ååœ¨åº”ç”¨å†…è§¦å‘éœ€è¦åˆ†æçš„åŠŸèƒ½">ç„¶ååœ¨åº”ç”¨å†…è§¦å‘éœ€è¦åˆ†æçš„åŠŸèƒ½</a></li>
<li><a href="#æ‹‰å–åˆ°æœ¬åœ°" id="toc-æ‹‰å–åˆ°æœ¬åœ°">æ‹‰å–åˆ°æœ¬åœ°</a></li>
<li><a href="#æŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„-so-æ–‡ä»¶"
id="toc-æŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„-so-æ–‡ä»¶">æŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ SO æ–‡ä»¶</a></li>
<li><a href="#è¾“å‡ºç¤ºä¾‹" id="toc-è¾“å‡ºç¤ºä¾‹">è¾“å‡ºç¤ºä¾‹:</a></li>
<li><a href="#libnative-lib.so-0x7abc000000-0x50000"
id="toc-libnative-lib.so-0x7abc000000-0x50000">libnative-lib.so
0x7abc000000 0x50000</a></li>
<li><a href="#ç¡®è®¤åŒ…åæ­£ç¡®" id="toc-ç¡®è®¤åŒ…åæ­£ç¡®">2.
ç¡®è®¤åŒ…åæ­£ç¡®</a></li>
<li><a href="#ä»-androidmanifest.xml-è·å–å‡†ç¡®åŒ…å"
id="toc-ä»-androidmanifest.xml-è·å–å‡†ç¡®åŒ…å">ä» AndroidManifest.xml
è·å–å‡†ç¡®åŒ…å</a></li>
<li><a href="#å°è¯•-attach-æ¨¡å¼" id="toc-å°è¯•-attach-æ¨¡å¼">3. å°è¯• Attach
æ¨¡å¼</a></li>
<li><a href="#å…ˆæ‰‹åŠ¨å¯åŠ¨åº”ç”¨"
id="toc-å…ˆæ‰‹åŠ¨å¯åŠ¨åº”ç”¨">å…ˆæ‰‹åŠ¨å¯åŠ¨åº”ç”¨</a></li>
<li><a href="#å†é™„åŠ " id="toc-å†é™„åŠ ">å†é™„åŠ </a>
<ul>
<li><a href="#å¿«é€Ÿå‚è€ƒ-5" id="toc-å¿«é€Ÿå‚è€ƒ-5">å¿«é€Ÿå‚è€ƒ</a></li>
</ul></li>
<li><a href="#so-æ–‡ä»¶åæ··æ·†èŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤"
id="toc-so-æ–‡ä»¶åæ··æ·†èŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤">SO
æ–‡ä»¶åæ··æ·†ï¼šèŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤</a>
<ul>
<li><a href="#ç›®å½•-4" id="toc-ç›®å½•-4">ç›®å½•</a></li>
<li><a href="#èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹"
id="toc-èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹">èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹</a></li>
<li><a href="#åƒåœ¾æŒ‡ä»¤-junk-code" id="toc-åƒåœ¾æŒ‡ä»¤-junk-code"># åƒåœ¾æŒ‡ä»¤
(Junk Code)</a></li>
</ul></li>
<li><a href="#è·å–æŒ‡ä»¤é•¿åº¦" id="toc-è·å–æŒ‡ä»¤é•¿åº¦">è·å–æŒ‡ä»¤é•¿åº¦</a></li>
<li><a href="#å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€"
id="toc-å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€">å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</a></li>
<li><a href="#æ‰§è¡Œè„šæœ¬" id="toc-æ‰§è¡Œè„šæœ¬">â€” æ‰§è¡Œè„šæœ¬ â€”</a></li>
<li><a href="#patch_junk_jumps"
id="toc-patch_junk_jumps">patch_junk_jumps()</a></li>
<li><a href="#å¯ç–‘ç±»å" id="toc-å¯ç–‘ç±»å">å¯ç–‘ç±»å:</a></li>
<li><a href="#com.tencent.stubshell.txappentry-è…¾è®¯ä¹å›º"
id="toc-com.tencent.stubshell.txappentry-è…¾è®¯ä¹å›º">com.tencent.StubShell.TxAppEntry
(è…¾è®¯ä¹å›º)</a></li>
<li><a href="#com.secneo.apkwrapper.applicationwrapper-æ¢†æ¢†-security"
id="toc-com.secneo.apkwrapper.applicationwrapper-æ¢†æ¢†-security">com.secneo.apkwrapper.ApplicationWrapper
(æ¢†æ¢† Security)</a></li>
<li><a href="#com.baidu.protect.stubapplication-ç™¾åº¦åŠ å›º"
id="toc-com.baidu.protect.stubapplication-ç™¾åº¦åŠ å›º">com.baidu.protect.StubApplication
(ç™¾åº¦åŠ å›º)</a></li>
<li><a href="#æ£€æŸ¥-dex-æ–‡ä»¶å¤§å°" id="toc-æ£€æŸ¥-dex-æ–‡ä»¶å¤§å°">2. æ£€æŸ¥ DEX
æ–‡ä»¶å¤§å°</a></li>
<li><a href="#å¦‚æœ-classes.dex-100kb-ä¸”-app-åŠŸèƒ½å¤æ‚å¾ˆå¯èƒ½åŠ å£³"
id="toc-å¦‚æœ-classes.dex-100kb-ä¸”-app-åŠŸèƒ½å¤æ‚å¾ˆå¯èƒ½åŠ å£³">å¦‚æœ
classes.dex &lt; 100KB ä¸” App åŠŸèƒ½å¤æ‚ï¼Œå¾ˆå¯èƒ½åŠ å£³</a></li>
<li><a href="#æ£€æŸ¥å¯ç–‘æ–‡ä»¶" id="toc-æ£€æŸ¥å¯ç–‘æ–‡ä»¶">3.
æ£€æŸ¥å¯ç–‘æ–‡ä»¶</a></li>
<li><a href="#è¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«åŠ å¯†çš„åŸå§‹-dex"
id="toc-è¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«åŠ å¯†çš„åŸå§‹-dex">è¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«åŠ å¯†çš„åŸå§‹
DEX</a></li>
<li><a href="#æ£€æŸ¥-lib-ç›®å½•ä¸­çš„å¯ç–‘-so"
id="toc-æ£€æŸ¥-lib-ç›®å½•ä¸­çš„å¯ç–‘-so">4. æ£€æŸ¥ lib ç›®å½•ä¸­çš„å¯ç–‘ SO</a></li>
<li><a href="#attach-æ¨¡å¼" id="toc-attach-æ¨¡å¼">Attach æ¨¡å¼</a></li>
<li><a href="#æŸ¥çœ‹æå–åˆ°çš„-dex-æ–‡ä»¶" id="toc-æŸ¥çœ‹æå–åˆ°çš„-dex-æ–‡ä»¶">2.
æŸ¥çœ‹æå–åˆ°çš„ DEX æ–‡ä»¶</a></li>
<li><a href="#è¾“å‡ºç¤ºä¾‹-1" id="toc-è¾“å‡ºç¤ºä¾‹-1">è¾“å‡ºç¤ºä¾‹:</a></li>
<li><a href="#rw-rr-1-user-user-5.2m-dumped_1234567890.dex"
id="toc-rw-rr-1-user-user-5.2m-dumped_1234567890.dex">-rw-râ€“râ€“ 1 user
user 5.2M dumped_1234567890.dex</a></li>
<li><a href="#rw-rr-1-user-user-1.8m-dumped_0987654321.dex"
id="toc-rw-rr-1-user-user-1.8m-dumped_0987654321.dex">-rw-râ€“râ€“ 1 user
user 1.8M dumped_0987654321.dex</a></li>
<li><a href="#éªŒè¯-dex-æ–‡ä»¶å®Œæ•´æ€§" id="toc-éªŒè¯-dex-æ–‡ä»¶å®Œæ•´æ€§">3. éªŒè¯
DEX æ–‡ä»¶å®Œæ•´æ€§</a></li>
<li><a href="#åº”è¯¥çœ‹åˆ°-dex-magic-64-65-78-0a-dex"
id="toc-åº”è¯¥çœ‹åˆ°-dex-magic-64-65-78-0a-dex">åº”è¯¥çœ‹åˆ° DEX magic: 64 65 78
0a (dex)</a></li>
<li><a href="#ä½¿ç”¨-jadx-æ‰“å¼€éªŒè¯" id="toc-ä½¿ç”¨-jadx-æ‰“å¼€éªŒè¯">4. ä½¿ç”¨
Jadx æ‰“å¼€éªŒè¯</a></li>
<li><a href="#å¦‚æœèƒ½æ­£å¸¸åç¼–è¯‘è¡¨ç¤ºè„±å£³æˆåŠŸ"
id="toc-å¦‚æœèƒ½æ­£å¸¸åç¼–è¯‘è¡¨ç¤ºè„±å£³æˆåŠŸ">å¦‚æœèƒ½æ­£å¸¸åç¼–è¯‘ï¼Œè¡¨ç¤ºè„±å£³æˆåŠŸ</a></li>
<li><a href="#è¿™éœ€è¦ä½¿ç”¨-dexpatcher-æˆ–è‡ªå®šä¹‰è„šæœ¬"
id="toc-è¿™éœ€è¦ä½¿ç”¨-dexpatcher-æˆ–è‡ªå®šä¹‰è„šæœ¬">è¿™éœ€è¦ä½¿ç”¨ DexPatcher
æˆ–è‡ªå®šä¹‰è„šæœ¬</a></li>
<li><a href="#åæ±‡ç¼–-dex" id="toc-åæ±‡ç¼–-dex">2. åæ±‡ç¼– DEX</a></li>
<li><a href="#æŸ¥æ‰¾ç©ºæ–¹æ³•å¹¶æ›¿æ¢" id="toc-æŸ¥æ‰¾ç©ºæ–¹æ³•å¹¶æ›¿æ¢">3.
æŸ¥æ‰¾ç©ºæ–¹æ³•å¹¶æ›¿æ¢</a></li>
<li><a href="#åœ¨-smali_output-ä¸­æ‰¾åˆ°æ–¹æ³•ä½“ä¸ºç©ºçš„-.smali-æ–‡ä»¶"
id="toc-åœ¨-smali_output-ä¸­æ‰¾åˆ°æ–¹æ³•ä½“ä¸ºç©ºçš„-.smali-æ–‡ä»¶">åœ¨ smali_output
ä¸­ï¼Œæ‰¾åˆ°æ–¹æ³•ä½“ä¸ºç©ºçš„ .smali æ–‡ä»¶</a></li>
<li><a href="#å°†å¯¼å‡ºçš„-codeitem-åæ±‡ç¼–åçš„å†…å®¹å¤åˆ¶è¿›å»"
id="toc-å°†å¯¼å‡ºçš„-codeitem-åæ±‡ç¼–åçš„å†…å®¹å¤åˆ¶è¿›å»">å°†å¯¼å‡ºçš„ CodeItem
åæ±‡ç¼–åçš„å†…å®¹å¤åˆ¶è¿›å»</a></li>
<li><a href="#é‡æ–°ç»„è£…" id="toc-é‡æ–°ç»„è£…">4. é‡æ–°ç»„è£…</a></li>
<li><a href="#éªŒè¯" id="toc-éªŒè¯">5. éªŒè¯</a></li>
<li><a href="#connect-to-device-and-attach-to-process"
id="toc-connect-to-device-and-attach-to-process">â€¦ Connect to device and
attach to process â€¦</a></li>
<li><a href="#script-session.create_scriptjs_code"
id="toc-script-session.create_scriptjs_code">script =
session.create_script(js_code)</a></li>
<li><a href="#section-16" id="toc-section-16">â€¦</a></li>
<li><a href="#script.load" id="toc-script.load">script.load()</a></li>
<li><a href="#call-the-exported-function-from-the-script"
id="toc-call-the-exported-function-from-the-script">Call the exported
function from the script</a></li>
<li><a href="#frida-æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†"
id="toc-frida-æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†">Frida æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†</a>
<ul>
<li><a href="#ç›®å½•-5" id="toc-ç›®å½•-5">ç›®å½•</a></li>
</ul></li>
<li><a href="#unidbg-æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—"
id="toc-unidbg-æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—</a>
<ul>
<li><a href="#ç¯å¢ƒæ­å»º" id="toc-ç¯å¢ƒæ­å»º"># ç¯å¢ƒæ­å»º</a></li>
</ul></li>
<li><a href="#ghidra-å…¥é—¨" id="toc-ghidra-å…¥é—¨">Ghidra
å…¥é—¨</a>
<ul>
<li><a href="#å®‰è£…ä¸é…ç½®" id="toc-å®‰è£…ä¸é…ç½®"># å®‰è£…ä¸é…ç½®</a></li>
</ul></li>
<li><a href="#ida-pro-å…¥é—¨" id="toc-ida-pro-å…¥é—¨">IDA Pro
å…¥é—¨</a></li>
<li><a href="#radare2-å…¥é—¨" id="toc-radare2-å…¥é—¨">Radare2
å…¥é—¨</a></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶ååˆ†ææŠ€æœ¯"
id="toc-æ¡ˆä¾‹ç ”ç©¶ååˆ†ææŠ€æœ¯">æ¡ˆä¾‹ç ”ç©¶ï¼šååˆ†ææŠ€æœ¯</a>
<ul>
<li><a href="#åè°ƒè¯•-anti-debugging" id="toc-åè°ƒè¯•-anti-debugging">1.
åè°ƒè¯• (Anti-Debugging)</a></li>
<li><a href="#å-hook-anti-hooking" id="toc-å-hook-anti-hooking">2. å
Hook (Anti-Hooking)</a></li>
<li><a href="#åæ¨¡æ‹Ÿå™¨-anti-emulator" id="toc-åæ¨¡æ‹Ÿå™¨-anti-emulator">3.
åæ¨¡æ‹Ÿå™¨ (Anti-Emulator)</a></li>
<li><a href="#æ€»ç»“" id="toc-æ€»ç»“">æ€»ç»“</a></li>
</ul></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶flutter-åº”ç”¨é€†å‘"
id="toc-æ¡ˆä¾‹ç ”ç©¶flutter-åº”ç”¨é€†å‘">æ¡ˆä¾‹ç ”ç©¶ï¼šFlutter åº”ç”¨é€†å‘</a>
<ul>
<li><a href="#æ ¸å¿ƒæ¶æ„" id="toc-æ ¸å¿ƒæ¶æ„">æ ¸å¿ƒæ¶æ„</a></li>
<li><a href="#é€†å‘æµç¨‹" id="toc-é€†å‘æµç¨‹">é€†å‘æµç¨‹</a></li>
<li><a href="#ç¬¬-1-æ­¥è¯†åˆ«-flutter-åº”ç”¨"
id="toc-ç¬¬-1-æ­¥è¯†åˆ«-flutter-åº”ç”¨"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ« Flutter åº”ç”¨</a></li>
<li><a href="#ç¬¬-2-æ­¥ä½¿ç”¨-reflutter-æ¡†æ¶"
id="toc-ç¬¬-2-æ­¥ä½¿ç”¨-reflutter-æ¡†æ¶"># ç¬¬ 2 æ­¥ï¼šä½¿ç”¨ reFlutter
æ¡†æ¶</a></li>
<li><a href="#ç¬¬-4-æ­¥çŸ­ä¿¡æ‹¦æˆª-sms-stealing"
id="toc-ç¬¬-4-æ­¥çŸ­ä¿¡æ‹¦æˆª-sms-stealing"># ç¬¬ 4 æ­¥ï¼šçŸ­ä¿¡æ‹¦æˆª (SMS
Stealing)</a></li>
</ul></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶éŸ³ä¹-app" id="toc-æ¡ˆä¾‹ç ”ç©¶éŸ³ä¹-app">æ¡ˆä¾‹ç ”ç©¶ï¼šéŸ³ä¹
App</a>
<ul>
<li><a href="#æ€»ç»“-1" id="toc-æ€»ç»“-1">æ€»ç»“</a></li>
</ul></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶ç¤¾äº¤åª’ä½“-app-ä¸é£æ§"
id="toc-æ¡ˆä¾‹ç ”ç©¶ç¤¾äº¤åª’ä½“-app-ä¸é£æ§">æ¡ˆä¾‹ç ”ç©¶ï¼šç¤¾äº¤åª’ä½“ App ä¸é£æ§</a>
<ul>
<li><a href="#ç¬¬-1-æ­¥å®šä½ç­¾åå‚æ•°" id="toc-ç¬¬-1-æ­¥å®šä½ç­¾åå‚æ•°"># ç¬¬ 1
æ­¥ï¼šå®šä½ç­¾åå‚æ•°</a></li>
<li><a href="#ç¬¬-2-æ­¥å®šä½ç­¾åç”Ÿæˆä»£ç "
id="toc-ç¬¬-2-æ­¥å®šä½ç­¾åç”Ÿæˆä»£ç "># ç¬¬ 2 æ­¥ï¼šå®šä½ç­¾åç”Ÿæˆä»£ç </a></li>
</ul></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶ä¸»æµ-app-çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ"
id="toc-æ¡ˆä¾‹ç ”ç©¶ä¸»æµ-app-çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ">æ¡ˆä¾‹ç ”ç©¶ï¼šä¸»æµ App
çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ</a>
<ul>
<li><a href="#æ¡ˆä¾‹åˆ†æ-1ç”µå•†-app-ç±»æ‹¼å¤šå¤šæ¨¡å¼"
id="toc-æ¡ˆä¾‹åˆ†æ-1ç”µå•†-app-ç±»æ‹¼å¤šå¤šæ¨¡å¼">æ¡ˆä¾‹åˆ†æ 1ï¼šç”µå•† App
(ç±»æ‹¼å¤šå¤šæ¨¡å¼)</a></li>
<li><a href="#æ ¸å¿ƒé£æ§å­—æ®µ-anti_content"
id="toc-æ ¸å¿ƒé£æ§å­—æ®µ-anti_content"># æ ¸å¿ƒé£æ§å­—æ®µ
(<code>anti_content</code>)</a></li>
<li><a href="#api-è®¤è¯ç­¾å-sign" id="toc-api-è®¤è¯ç­¾å-sign"># API
è®¤è¯ç­¾å (<code>sign</code>)</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-2ç¤¾äº¤-app-ç±»å°çº¢ä¹¦æ¨¡å¼"
id="toc-æ¡ˆä¾‹åˆ†æ-2ç¤¾äº¤-app-ç±»å°çº¢ä¹¦æ¨¡å¼">æ¡ˆä¾‹åˆ†æ 2ï¼šç¤¾äº¤ App
(ç±»å°çº¢ä¹¦æ¨¡å¼)</a></li>
<li><a href="#å¤æ‚çš„è¯·æ±‚å¤´ç­¾å-x-sign"
id="toc-å¤æ‚çš„è¯·æ±‚å¤´ç­¾å-x-sign"># å¤æ‚çš„è¯·æ±‚å¤´ç­¾å
(<code>X-Sign</code>)</a></li>
<li><a href="#è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥-x-deviceinfo"
id="toc-è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥-x-deviceinfo"># è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥
(<code>X-DeviceInfo</code>)</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-3å­—èŠ‚è·³åŠ¨ç³»-æŠ–éŸ³tiktok"
id="toc-æ¡ˆä¾‹åˆ†æ-3å­—èŠ‚è·³åŠ¨ç³»-æŠ–éŸ³tiktok">æ¡ˆä¾‹åˆ†æ 3ï¼šå­—èŠ‚è·³åŠ¨ç³»
(æŠ–éŸ³/TikTok)</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-4å¿«æ‰‹" id="toc-æ¡ˆä¾‹åˆ†æ-4å¿«æ‰‹">æ¡ˆä¾‹åˆ†æ
4ï¼šå¿«æ‰‹</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-5ç¾å›¢" id="toc-æ¡ˆä¾‹åˆ†æ-5ç¾å›¢">æ¡ˆä¾‹åˆ†æ
5ï¼šç¾å›¢</a></li>
<li><a href="#æ¡ˆä¾‹åˆ†æ-6é˜¿é‡Œç³»-æ·˜å®æ”¯ä»˜å®"
id="toc-æ¡ˆä¾‹åˆ†æ-6é˜¿é‡Œç³»-æ·˜å®æ”¯ä»˜å®">æ¡ˆä¾‹åˆ†æ 6ï¼šé˜¿é‡Œç³»
(æ·˜å®ã€æ”¯ä»˜å®)</a></li>
<li><a href="#é€†å‘åˆ†æé€šç”¨ç­–ç•¥"
id="toc-é€†å‘åˆ†æé€šç”¨ç­–ç•¥">é€†å‘åˆ†æé€šç”¨ç­–ç•¥</a></li>
<li><a href="#ä»€ä¹ˆæ˜¯é»‘ç›’-rpc-è°ƒç”¨" id="toc-ä»€ä¹ˆæ˜¯é»‘ç›’-rpc-è°ƒç”¨">#
ä»€ä¹ˆæ˜¯é»‘ç›’ RPC è°ƒç”¨ï¼Ÿ</a></li>
<li><a href="#å®ç°é»‘ç›’-rpc-çš„æ ¸å¿ƒæ­¥éª¤"
id="toc-å®ç°é»‘ç›’-rpc-çš„æ ¸å¿ƒæ­¥éª¤"># å®ç°é»‘ç›’ RPC çš„æ ¸å¿ƒæ­¥éª¤</a></li>
</ul></li>
<li><a href="#client.py" id="toc-client.py">client.py</a></li>
<li><a href="#load-frida-agent-script"
id="toc-load-frida-agent-script">Load Frida Agent script</a></li>
<li><a href="#prepare-parameters" id="toc-prepare-parameters">Prepare
parameters</a></li>
<li><a href="#call-rpc-interface-like-calling-a-local-function"
id="toc-call-rpc-interface-like-calling-a-local-function">Call RPC
interface like calling a local function</a></li>
<li><a
href="#can-use-the-obtained-sign-to-construct-and-send-network-requests-here"
id="toc-can-use-the-obtained-sign-to-construct-and-send-network-requests-here">Can
use the obtained sign to construct and send network requests
here</a></li>
<li><a href="#section-17" id="toc-section-17">â€¦</a></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶unity-æ¸¸æˆé€†å‘-il2cpp"
id="toc-æ¡ˆä¾‹ç ”ç©¶unity-æ¸¸æˆé€†å‘-il2cpp">æ¡ˆä¾‹ç ”ç©¶ï¼šUnity æ¸¸æˆé€†å‘
(Il2Cpp)</a></li>
<li><a href="#æ¡ˆä¾‹ç ”ç©¶è§†é¢‘-app-ä¸-drm"
id="toc-æ¡ˆä¾‹ç ”ç©¶è§†é¢‘-app-ä¸-drm">æ¡ˆä¾‹ç ”ç©¶ï¼šè§†é¢‘ App ä¸ DRM</a>
<ul>
<li><a href="#æ€»ç»“-2" id="toc-æ€»ç»“-2">æ€»ç»“</a></li>
</ul></li>
<li><a href="#android-æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—"
id="toc-android-æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—">android æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—</a></li>
<li><a href="#aosp-ä¸-android-ç³»ç»Ÿè£å‰ª"
id="toc-aosp-ä¸-android-ç³»ç»Ÿè£å‰ª">AOSP ä¸ android ç³»ç»Ÿè£å‰ª</a></li>
<li><a href="#æŸ¥æ‰¾.init_arrayæ®µ"
id="toc-æŸ¥æ‰¾.init_arrayæ®µ">æŸ¥æ‰¾.init_arrayæ®µ</a></li>
<li><a href="#åŸºäº-aosp-çš„æ·±åº¦æ”¹æœºæŠ€æœ¯æŒ‡å—"
id="toc-åŸºäº-aosp-çš„æ·±åº¦æ”¹æœºæŠ€æœ¯æŒ‡å—">åŸºäº AOSP
çš„æ·±åº¦æ”¹æœºæŠ€æœ¯æŒ‡å—</a></li>
<li><a href="#æ„å»ºæœ€å°åŒ–-android-ç³»ç»Ÿ-rootfs-æŒ‡å—"
id="toc-æ„å»ºæœ€å°åŒ–-android-ç³»ç»Ÿ-rootfs-æŒ‡å—">æ„å»ºæœ€å°åŒ– android ç³»ç»Ÿ
(RootFS) æŒ‡å—</a>
<ul>
<li><a href="#æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶" id="toc-æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶">#
æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></li>
</ul></li>
<li><a href="#switch-toä¸€stable-branch"
id="toc-switch-toä¸€stable-branch">Switch toä¸€Stable branch</a></li>
<li><a href="#é…ç½®å†…æ ¸" id="toc-é…ç½®å†…æ ¸">é…ç½®å†…æ ¸</a></li>
<li><a href="#ç¼–è¯‘å†…æ ¸" id="toc-ç¼–è¯‘å†…æ ¸">ç¼–è¯‘å†…æ ¸</a></li>
<li><a
href="#compilesuccessafterä¼šinat-archarm64boot-directoryä¸‹generate-image.gz-å†…æ ¸file"
id="toc-compilesuccessafterä¼šinat-archarm64boot-directoryä¸‹generate-image.gz-å†…æ ¸file">CompileSuccessAfterï¼Œä¼šin/at
arch/arm64/boot/ Directoryä¸‹Generate Image.gz å†…æ ¸File</a></li>
<li><a
href="#ç¡®ä¿-commonarcharm64bootimage.gz-and-rootfs.cpio.gz-inatcurrentdirectory"
id="toc-ç¡®ä¿-commonarcharm64bootimage.gz-and-rootfs.cpio.gz-inatcurrentdirectory">ç¡®ä¿
common/arch/arm64/boot/Image.gz and rootfs.cpio.gz
in/atCurrentDirectory</a></li>
<li><a href="#so-è¿è¡Œæ—¶ä»¿çœŸè„±ç¦»è®¾å¤‡çš„-native-ä»£ç æ‰§è¡Œ"
id="toc-so-è¿è¡Œæ—¶ä»¿çœŸè„±ç¦»è®¾å¤‡çš„-native-ä»£ç æ‰§è¡Œ">SO
è¿è¡Œæ—¶ä»¿çœŸï¼šè„±ç¦»è®¾å¤‡çš„ Native ä»£ç æ‰§è¡Œ</a>
<ul>
<li><a href="#æ ¸å¿ƒæ¶æ„-1" id="toc-æ ¸å¿ƒæ¶æ„-1">æ ¸å¿ƒæ¶æ„</a></li>
<li><a href="#elf-åŠ è½½å™¨-elf-loader" id="toc-elf-åŠ è½½å™¨-elf-loader"># 1.
ELF åŠ è½½å™¨ (ELF Loader)</a></li>
<li><a href="#cpu-æ¨¡æ‹Ÿå™¨-cpu-emulator"
id="toc-cpu-æ¨¡æ‹Ÿå™¨-cpu-emulator"># 2. CPU æ¨¡æ‹Ÿå™¨ (CPU Emulator)</a></li>
<li><a href="#ç³»ç»Ÿåº“ä¸ç¯å¢ƒæ¨¡æ‹Ÿ-library-environment-mocking"
id="toc-ç³»ç»Ÿåº“ä¸ç¯å¢ƒæ¨¡æ‹Ÿ-library-environment-mocking"># 3.
ç³»ç»Ÿåº“ä¸ç¯å¢ƒæ¨¡æ‹Ÿ (Library &amp; Environment Mocking)</a></li>
<li><a href="#æ¨èé¡¹ç›®unidbg"
id="toc-æ¨èé¡¹ç›®unidbg">æ¨èé¡¹ç›®ï¼š<code>unidbg</code></a></li>
<li><a href="#unidbg-ä½¿ç”¨èŒƒä¾‹-æ¦‚å¿µä»£ç "
id="toc-unidbg-ä½¿ç”¨èŒƒä¾‹-æ¦‚å¿µä»£ç "># <code>unidbg</code> ä½¿ç”¨èŒƒä¾‹
(æ¦‚å¿µä»£ç )</a></li>
<li><a href="#å®ç°æ­¥éª¤" id="toc-å®ç°æ­¥éª¤"># 2. å®ç°æ­¥éª¤</a></li>
</ul></li>
<li><a href="#å°†æ®µå†™å…¥æ¨¡æ‹Ÿå™¨å†…å­˜"
id="toc-å°†æ®µå†™å…¥æ¨¡æ‹Ÿå™¨å†…å­˜">å°†æ®µå†™å…¥æ¨¡æ‹Ÿå™¨å†…å­˜</a></li>
<li><a href="#section-18" id="toc-section-18">â€¦</a></li>
<li><a href="#load_somu-libnative-lib.so"
id="toc-load_somu-libnative-lib.so">load_so(mu, â€˜libnative-lib.soâ€™)</a>
<ul>
<li><a href="#åŸºäº-chroot-ä¸-linker-çš„é«˜çº§ä»¿çœŸ-cè¯­è¨€"
id="toc-åŸºäº-chroot-ä¸-linker-çš„é«˜çº§ä»¿çœŸ-cè¯­è¨€">åŸºäº <code>chroot</code>
ä¸ <code>linker</code> çš„é«˜çº§ä»¿çœŸ (Cè¯­è¨€)</a></li>
<li><a href="#æ ¸å¿ƒæ€è·¯" id="toc-æ ¸å¿ƒæ€è·¯"># 1. æ ¸å¿ƒæ€è·¯</a></li>
<li><a href="#å®ç°æ­¥éª¤-1" id="toc-å®ç°æ­¥éª¤-1"># 2. å®ç°æ­¥éª¤</a></li>
</ul></li>
<li><a href="#include-dlfcn.h" id="toc-include-dlfcn.h">include
&lt;dlfcn.h&gt;</a></li>
<li><a href="#include-unistd.h" id="toc-include-unistd.h">include
&lt;unistd.h&gt;</a></li>
<li><a href="#include-stdlib.h" id="toc-include-stdlib.h">include
&lt;stdlib.h&gt;</a></li>
<li><a href="#å·¥ç¨‹åŒ–æ¡†æ¶å·¥å…·ä¸ä¸­é—´ä»¶"
id="toc-å·¥ç¨‹åŒ–æ¡†æ¶å·¥å…·ä¸ä¸­é—´ä»¶">å·¥ç¨‹åŒ–ï¼šæ¡†æ¶ã€å·¥å…·ä¸ä¸­é—´ä»¶</a></li>
<li><a href="#å·¥ç¨‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—-message-queue"
id="toc-å·¥ç¨‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—-message-queue">å·¥ç¨‹åŒ–ï¼šæ¶ˆæ¯é˜Ÿåˆ— (Message
Queue)</a>
<ul>
<li><a href="#æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨" id="toc-æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨">1.
æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨</a></li>
<li><a href="#ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ" id="toc-ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ">2.
ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ</a></li>
<li><a href="#æ€»ç»“-3" id="toc-æ€»ç»“-3">æ€»ç»“</a></li>
</ul></li>
<li><a href="#redis-å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•" id="toc-redis-å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•">Redis
å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•</a>
<ul>
<li><a href="#é”®-key-æ“ä½œ" id="toc-é”®-key-æ“ä½œ"># é”® (Key) æ“ä½œ</a></li>
<li><a href="#å­—ç¬¦ä¸²-string" id="toc-å­—ç¬¦ä¸²-string"># å­—ç¬¦ä¸²
(String)</a></li>
<li><a href="#å“ˆå¸Œ-hash" id="toc-å“ˆå¸Œ-hash"># å“ˆå¸Œ (Hash)</a></li>
<li><a href="#åˆ—è¡¨-list" id="toc-åˆ—è¡¨-list"># åˆ—è¡¨ (List)</a></li>
<li><a href="#é›†åˆ-set" id="toc-é›†åˆ-set"># é›†åˆ (Set)</a></li>
<li><a href="#æœ‰åºé›†åˆ-sorted-set-zset"
id="toc-æœ‰åºé›†åˆ-sorted-set-zset"># æœ‰åºé›†åˆ (Sorted Set /
ZSet)</a></li>
<li><a href="#redis-å‘å±•å†ç¨‹ä¸architectureæ¼”è¿›"
id="toc-redis-å‘å±•å†ç¨‹ä¸architectureæ¼”è¿›">Redis
å‘å±•å†ç¨‹ä¸architectureæ¼”è¿›</a></li>
<li><a href="#ç‰ˆæœ¬å‘å±•" id="toc-ç‰ˆæœ¬å‘å±•"># ç‰ˆæœ¬å‘å±•</a></li>
<li><a href="#architectureæ¼”è¿›è·¯å¾„" id="toc-architectureæ¼”è¿›è·¯å¾„">#
architectureæ¼”è¿›è·¯å¾„</a></li>
</ul></li>
<li><a href="#at-leastneed2slave-nodemaximum-delay10second"
id="toc-at-leastneed2slave-nodemaximum-delay10second">At leastNeed2Slave
Nodeï¼Œmaximum delay10Second</a>
<ul>
<li><a href="#cluster-é›†ç¾¤æ¨¡å¼" id="toc-cluster-é›†ç¾¤æ¨¡å¼"># Cluster
é›†ç¾¤æ¨¡å¼</a></li>
</ul></li>
<li><a href="#viewclusterinformation"
id="toc-viewclusterinformation">ViewClusterInformation</a></li>
<li><a href="#re-sharding" id="toc-re-sharding">Re-Sharding</a></li>
<li><a href="#addnode" id="toc-addnode">AddNode</a></li>
<li><a href="#æœ€ä¼˜ä½æ•°ç»„å¤§å°"
id="toc-æœ€ä¼˜ä½æ•°ç»„å¤§å°">æœ€ä¼˜ä½æ•°ç»„å¤§å°</a></li>
<li><a href="#æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡"
id="toc-æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡">æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡</a></li>
<li><a href="#å…¶ä¸­nå…ƒç´ æ•°é‡pè¯¯æŠ¥ç‡mä½æ•°ç»„å¤§å°kå“ˆå¸Œå‡½æ•°æ•°é‡"
id="toc-å…¶ä¸­nå…ƒç´ æ•°é‡pè¯¯æŠ¥ç‡mä½æ•°ç»„å¤§å°kå“ˆå¸Œå‡½æ•°æ•°é‡">å…¶ä¸­ï¼šn=å…ƒç´ æ•°é‡ï¼Œp=è¯¯æŠ¥ç‡ï¼Œm=ä½æ•°ç»„å¤§å°ï¼Œk=å“ˆå¸Œå‡½æ•°æ•°é‡</a></li>
<li><a href="#æ·»åŠ å…ƒç´ " id="toc-æ·»åŠ å…ƒç´ ">æ·»åŠ å…ƒç´ </a></li>
<li><a href="#æ£€æŸ¥å…ƒç´ " id="toc-æ£€æŸ¥å…ƒç´ ">æ£€æŸ¥å…ƒç´ </a></li>
<li><a href="#getinformation"
id="toc-getinformation">GetInformation</a></li>
<li><a href="#æ·»åŠ æ¶ˆæ¯" id="toc-æ·»åŠ æ¶ˆæ¯">æ·»åŠ æ¶ˆæ¯</a></li>
<li><a href="#è¯»å–æ¶ˆæ¯" id="toc-è¯»å–æ¶ˆæ¯">è¯»å–æ¶ˆæ¯</a></li>
<li><a href="#viewstreaminformation"
id="toc-viewstreaminformation">ViewStreamInformation</a></li>
<li><a href="#èŒƒå›´æŸ¥è¯¢" id="toc-èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢</a></li>
<li><a href="#ä¿®å‰ª-stream" id="toc-ä¿®å‰ª-stream">ä¿®å‰ª Stream</a>
<ul>
<li><a href="#ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ" id="toc-ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ">#
ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#åˆ†å¸ƒå¼é”å®ç°" id="toc-åˆ†å¸ƒå¼é”å®ç°">#
åˆ†å¸ƒå¼é”å®ç°</a></li>
</ul></li>
<li><a href="#configoptimize" id="toc-configoptimize">ConfigOptimize</a>
<ul>
<li><a href="#capç†è®ºä¸é€‰æ‹©" id="toc-capç†è®ºä¸é€‰æ‹©">#
CAPç†è®ºä¸é€‰æ‹©</a></li>
</ul></li>
<li><a href="#æŸ¥mysqlgetbasic-information"
id="toc-æŸ¥mysqlgetbasic-information">2. æŸ¥MySQLGetBasic
information</a></li>
<li><a href="#æŸ¥mongodbgetextensioninformation"
id="toc-æŸ¥mongodbgetextensioninformation">3.
æŸ¥MongoDBGetExtensionInformation</a></li>
<li><a href="#åˆå¹¶æ•°æ®å¹¶ç¼“å­˜" id="toc-åˆå¹¶æ•°æ®å¹¶ç¼“å­˜">4.
åˆå¹¶æ•°æ®å¹¶ç¼“å­˜</a>
<ul>
<li><a href="#é€‰å‹åŸåˆ™" id="toc-é€‰å‹åŸåˆ™"># é€‰å‹åŸåˆ™</a></li>
<li><a href="#æœ€ä½³å®è·µ" id="toc-æœ€ä½³å®è·µ"># æœ€ä½³å®è·µ</a></li>
</ul></li>
<li><a href="#verifyinstall"
id="toc-verifyinstall">VerifyInstall</a></li>
<li><a href="#memorycheck-only-linux"
id="toc-memorycheck-only-linux">MemoryCheck (Only Linux)</a></li>
<li><a href="#orcompilespecifictarget"
id="toc-orcompilespecifictarget">orCompileSpecificTarget</a></li>
<li><a href="#shouldoutput-pathtoandroid-ndk-r25c"
id="toc-shouldoutput-pathtoandroid-ndk-r25c">ShouldOutput:
/path/to/android-ndk-r25c</a></li>
<li><a href="#verify-ndk-toolchain" id="toc-verify-ndk-toolchain">Verify
NDK Toolchain</a></li>
<li><a href="#config-android-toolchain"
id="toc-config-android-toolchain">Config android Toolchain</a></li>
<li><a href="#compile" id="toc-compile">Compile</a></li>
<li><a href="#compile-support-universal-binary"
id="toc-compile-support-universal-binary">Compile (Support Universal
Binary)</a></li>
<li><a href="#æ£€æŸ¥ç¬¦å·" id="toc-æ£€æŸ¥ç¬¦å·">æ£€æŸ¥ç¬¦å·</a>
<ul>
<li><a href="#åå‹-backpressure-æœºåˆ¶" id="toc-åå‹-backpressure-æœºåˆ¶">#
2. åå‹ (Backpressure) æœºåˆ¶</a></li>
<li><a href="#exactly-onceè¯­ä¹‰ä¿è¯" id="toc-exactly-onceè¯­ä¹‰ä¿è¯"># 3.
Exactly-Onceè¯­ä¹‰ä¿è¯</a></li>
<li><a href="#çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ" id="toc-çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ"># 5.
çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ</a></li>
<li><a href="#shell-æ“ä½œ" id="toc-shell-æ“ä½œ">Shell æ“ä½œ</a></li>
<li><a href="#è¿æ¥ä¸åŸºæœ¬æ“ä½œ" id="toc-è¿æ¥ä¸åŸºæœ¬æ“ä½œ">#
è¿æ¥ä¸åŸºæœ¬æ“ä½œ</a></li>
</ul></li>
<li><a href="#listnamespace"
id="toc-listnamespace">ListNamespace</a></li>
<li><a href="#deletenamespace"
id="toc-deletenamespace">DeleteNamespace</a></li>
<li><a href="#æŸ¥è¯¢å•è¡Œ" id="toc-æŸ¥è¯¢å•è¡Œ">æŸ¥è¯¢å•è¡Œ</a></li>
<li><a href="#æŸ¥è¯¢æŒ‡å®šåˆ—æ—" id="toc-æŸ¥è¯¢æŒ‡å®šåˆ—æ—">æŸ¥è¯¢æŒ‡å®šåˆ—æ—</a></li>
<li><a href="#æŸ¥è¯¢æŒ‡å®šåˆ—" id="toc-æŸ¥è¯¢æŒ‡å®šåˆ—">æŸ¥è¯¢æŒ‡å®šåˆ—</a></li>
<li><a href="#æ‰«æè¡¨" id="toc-æ‰«æè¡¨">æ‰«æè¡¨</a></li>
<li><a href="#æ¡ä»¶æ‰«æ" id="toc-æ¡ä»¶æ‰«æ">æ¡ä»¶æ‰«æ</a></li>
<li><a href="#åˆ é™¤æ•°æ®" id="toc-åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</a></li>
<li><a href="#åˆ é™¤è¡Œ" id="toc-åˆ é™¤è¡Œ">åˆ é™¤è¡Œ</a></li>
<li><a href="#è®¡æ•°" id="toc-è®¡æ•°">è®¡æ•°</a></li>
<li><a href="#æŸ¥çœ‹è´Ÿè½½å‡è¡¡çŠ¶æ€"
id="toc-æŸ¥çœ‹è´Ÿè½½å‡è¡¡çŠ¶æ€">æŸ¥çœ‹è´Ÿè½½å‡è¡¡çŠ¶æ€</a></li>
<li><a href="#viewregionserverinformation"
id="toc-viewregionserverinformation">ViewRegionServerInformation</a></li>
<li><a href="#view-tablestatisticsinformation"
id="toc-view-tablestatisticsinformation">View
tableStatisticsInformation</a>
<ul>
<li><a href="#çƒ­ç‚¹é—®é¢˜è¯Šæ–­" id="toc-çƒ­ç‚¹é—®é¢˜è¯Šæ–­"># 6.
çƒ­ç‚¹é—®é¢˜è¯Šæ–­</a></li>
</ul></li>
<li><a href="#hive-æ•°æ®ä»“åº“" id="toc-hive-æ•°æ®ä»“åº“">Hive æ•°æ®ä»“åº“</a>
<ul>
<li><a href="#æ ¸å¿ƒç»„ä»¶" id="toc-æ ¸å¿ƒç»„ä»¶"># æ ¸å¿ƒç»„ä»¶</a></li>
<li><a href="#å·¥ä½œæµç¨‹" id="toc-å·¥ä½œæµç¨‹"># å·¥ä½œæµç¨‹</a></li>
<li><a href="#åŸºæœ¬æ•°æ®ç±»å‹" id="toc-åŸºæœ¬æ•°æ®ç±»å‹">#
åŸºæœ¬æ•°æ®ç±»å‹</a></li>
<li><a href="#å¤æ‚æ•°æ®ç±»å‹" id="toc-å¤æ‚æ•°æ®ç±»å‹">#
å¤æ‚æ•°æ®ç±»å‹</a></li>
<li><a href="#ddl-æ“ä½œ" id="toc-ddl-æ“ä½œ">DDL æ“ä½œ</a></li>
<li><a href="#æ•°æ®åº“æ“ä½œ" id="toc-æ•°æ®åº“æ“ä½œ"># æ•°æ®åº“æ“ä½œ</a></li>
</ul></li>
<li><a href="#apache-spark-å¤§æ•°æ®å¤„ç†"
id="toc-apache-spark-å¤§æ•°æ®å¤„ç†">Apache Spark å¤§æ•°æ®å¤„ç†</a>
<ul>
<li><a href="#é›†ç¾¤æ¶æ„" id="toc-é›†ç¾¤æ¶æ„"># é›†ç¾¤æ¶æ„</a></li>
<li><a href="#è¿è¡Œæµç¨‹" id="toc-è¿è¡Œæµç¨‹"># è¿è¡Œæµç¨‹</a></li>
<li><a href="#rddåŸºæœ¬æ¦‚å¿µ" id="toc-rddåŸºæœ¬æ¦‚å¿µ"># RDDåŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#rddåˆ›å»º" id="toc-rddåˆ›å»º"># RDDåˆ›å»º</a></li>
</ul></li>
<li><a href="#å†…å­˜å¯†é›†å‹" id="toc-å†…å­˜å¯†é›†å‹">å†…å­˜å¯†é›†å‹</a></li>
<li><a href="#å¹³è¡¡å‹" id="toc-å¹³è¡¡å‹">å¹³è¡¡å‹</a></li>
<li><a href="#android-å››å¤§ç»„ä»¶" id="toc-android-å››å¤§ç»„ä»¶">android
å››å¤§ç»„ä»¶</a>
<ul>
<li><a href="#æ´»åŠ¨-activity" id="toc-æ´»åŠ¨-activity">1. æ´»åŠ¨
(Activity)</a></li>
<li><a href="#æœåŠ¡-service" id="toc-æœåŠ¡-service">2. æœåŠ¡
(Service)</a></li>
<li><a href="#å¹¿æ’­æ¥æ”¶å™¨-broadcast-receiver"
id="toc-å¹¿æ’­æ¥æ”¶å™¨-broadcast-receiver">3. å¹¿æ’­æ¥æ”¶å™¨ (Broadcast
Receiver)</a></li>
<li><a href="#å†…å®¹æä¾›å™¨-content-provider"
id="toc-å†…å®¹æä¾›å™¨-content-provider">4. å†…å®¹æä¾›å™¨ (Content
Provider)</a></li>
</ul></li>
<li><a href="#androidmanifest.xml-æ·±åº¦è§£æ"
id="toc-androidmanifest.xml-æ·±åº¦è§£æ">androidManifest.xml
æ·±åº¦è§£æ</a></li>
<li><a href="#android-studio-è°ƒè¯•å·¥å…·é›†"
id="toc-android-studio-è°ƒè¯•å·¥å…·é›†">android Studio è°ƒè¯•å·¥å…·é›†</a>
<ul>
<li><a href="#æ—¥å¿—çŒ«-logcat" id="toc-æ—¥å¿—çŒ«-logcat">1. æ—¥å¿—çŒ«
(Logcat)</a></li>
<li><a href="#å¸ƒå±€æ£€æŸ¥å™¨-layout-inspector"
id="toc-å¸ƒå±€æ£€æŸ¥å™¨-layout-inspector">2. å¸ƒå±€æ£€æŸ¥å™¨ (Layout
Inspector)</a></li>
<li><a href="#åº”ç”¨åˆ†æå™¨-profiler" id="toc-åº”ç”¨åˆ†æå™¨-profiler">3.
åº”ç”¨åˆ†æå™¨ (Profiler)</a></li>
<li><a href="#æ•°æ®åº“æ£€æŸ¥å™¨-database-inspector"
id="toc-æ•°æ®åº“æ£€æŸ¥å™¨-database-inspector">4. æ•°æ®åº“æ£€æŸ¥å™¨ (Database
Inspector)</a></li>
</ul></li>
<li><a href="#apk-æ–‡ä»¶ç»“æ„è¯¦è§£" id="toc-apk-æ–‡ä»¶ç»“æ„è¯¦è§£">APK
æ–‡ä»¶ç»“æ„è¯¦è§£</a></li>
<li><a href="#arm-æ±‡ç¼–å…¥é—¨-android-native"
id="toc-arm-æ±‡ç¼–å…¥é—¨-android-native">ARM æ±‡ç¼–å…¥é—¨ (android
Native)</a></li>
<li><a href="#android-è¿è¡Œæ—¶-art-æ·±åº¦è§£æ"
id="toc-android-è¿è¡Œæ—¶-art-æ·±åº¦è§£æ">android è¿è¡Œæ—¶ (ART)
æ·±åº¦è§£æ</a></li>
<li><a href="#dex-æ–‡ä»¶æƒå¨æŒ‡å—" id="toc-dex-æ–‡ä»¶æƒå¨æŒ‡å—">DEX
æ–‡ä»¶æƒå¨æŒ‡å—</a></li>
<li><a href="#smali-è¯­æ³•å…¥é—¨" id="toc-smali-è¯­æ³•å…¥é—¨">Smali
è¯­æ³•å…¥é—¨</a></li>
<li><a href="#format-.field-static-final"
id="toc-format-.field-static-final">Format: .field <access_modifier>
[static] [final] <field_name>:<field_type></a></li>
<li><a href="#complex-check-logic-corresponding-smali-instructions"
id="toc-complex-check-logic-corresponding-smali-instructions">Complex
check logic corresponding smali instructionsâ€¦</a></li>
<li><a href="#android-.so-æ–‡ä»¶è¯¦è§£-elf-format"
id="toc-android-.so-æ–‡ä»¶è¯¦è§£-elf-format">android .so æ–‡ä»¶è¯¦è§£ (ELF
Format)</a></li>
<li><a href="#or-use-objdump" id="toc-or-use-objdump">Or use
objdump</a></li>
<li><a href="#x86-ä¸-arm-æ±‡ç¼–åŸºç¡€æŒ‡å—"
id="toc-x86-ä¸-arm-æ±‡ç¼–åŸºç¡€æŒ‡å—">x86 ä¸ ARM æ±‡ç¼–åŸºç¡€æŒ‡å—</a></li>
<li><a href="#ctf-ä¸-ç»ƒä¹ å¹³å°-ctf-practice-platforms"
id="toc-ctf-ä¸-ç»ƒä¹ å¹³å°-ctf-practice-platforms">CTF ä¸ ç»ƒä¹ å¹³å° (CTF
&amp; Practice Platforms)</a>
<ul>
<li><a href="#ç§»åŠ¨å®‰å…¨ä¸“é¡¹æŒ‘æˆ˜-mobile-specific-challenges"
id="toc-ç§»åŠ¨å®‰å…¨ä¸“é¡¹æŒ‘æˆ˜-mobile-specific-challenges">ç§»åŠ¨å®‰å…¨ä¸“é¡¹æŒ‘æˆ˜
(Mobile Specific Challenges)</a></li>
<li><a href="#ç»¼åˆ-ctf-å¹³å°-general-ctf-platforms"
id="toc-ç»¼åˆ-ctf-å¹³å°-general-ctf-platforms">ç»¼åˆ CTF å¹³å° (General CTF
Platforms)</a></li>
<li><a href="#crackme-ç½‘ç«™" id="toc-crackme-ç½‘ç«™">CrackMe ç½‘ç«™</a></li>
<li><a href="#æ¨èç»ƒä¹ è·¯çº¿" id="toc-æ¨èç»ƒä¹ è·¯çº¿">æ¨èç»ƒä¹ è·¯çº¿</a></li>
</ul></li>
<li><a href="#é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„-github-å¼€æºé¡¹ç›®"
id="toc-é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„-github-å¼€æºé¡¹ç›®">é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„ GitHub
å¼€æºé¡¹ç›®</a></li>
<li><a href="#æœ¯è¯­è¡¨-glossary" id="toc-æœ¯è¯­è¡¨-glossary">æœ¯è¯­è¡¨
(Glossary)</a>
<ul>
<li><a href="#a" id="toc-a">A</a></li>
<li><a href="#b" id="toc-b">B</a></li>
<li><a href="#d" id="toc-d">D</a></li>
<li><a href="#e" id="toc-e">E</a></li>
<li><a href="#f" id="toc-f">F</a></li>
<li><a href="#g" id="toc-g">G</a></li>
<li><a href="#h" id="toc-h">H</a></li>
<li><a href="#i" id="toc-i">I</a></li>
<li><a href="#j" id="toc-j">J</a></li>
<li><a href="#m" id="toc-m">M</a></li>
<li><a href="#n" id="toc-n">N</a></li>
<li><a href="#o" id="toc-o">O</a></li>
<li><a href="#r" id="toc-r">R</a></li>
<li><a href="#s" id="toc-s">S</a></li>
<li><a href="#v" id="toc-v">V</a></li>
<li><a href="#x" id="toc-x">X</a></li>
<li><a href="#z" id="toc-z">Z</a></li>
</ul></li>
<li><a href="#å­¦ä¹ èµ„æº-learning-resources"
id="toc-å­¦ä¹ èµ„æº-learning-resources">å­¦ä¹ èµ„æº (Learning Resources)</a>
<ul>
<li><a href="#ä¹¦ç±-books" id="toc-ä¹¦ç±-books">ä¹¦ç± (Books)</a></li>
<li><a href="#åšå®¢ä¸ç½‘ç«™-blogs-websites"
id="toc-åšå®¢ä¸ç½‘ç«™-blogs-websites">åšå®¢ä¸ç½‘ç«™ (Blogs &amp;
Websites)</a></li>
<li><a href="#è®ºå›ä¸ç¤¾åŒº-forums-communities"
id="toc-è®ºå›ä¸ç¤¾åŒº-forums-communities">è®ºå›ä¸ç¤¾åŒº (Forums &amp;
Communities)</a></li>
<li><a href="#è¯¾ç¨‹ä¸æ•™ç¨‹-courses-tutorials"
id="toc-è¯¾ç¨‹ä¸æ•™ç¨‹-courses-tutorials">è¯¾ç¨‹ä¸æ•™ç¨‹ (Courses &amp;
Tutorials)</a></li>
<li><a href="#å…¶ä»–èµ„æº" id="toc-å…¶ä»–èµ„æº">å…¶ä»–èµ„æº</a></li>
</ul></li>
</ul>
</nav>
<h1 id="android-reverse-engineering-cookbook">Android Reverse
Engineering Cookbook</h1>
<p>å®Œæ•´çš„ Android é€†å‘å·¥ç¨‹å­¦ä¹ å’Œå®æˆ˜æŒ‡å—</p>
<hr />
<!-- index.md -->
<h1 id="android-é€†å‘å·¥ç¨‹-cookbook">android é€†å‘å·¥ç¨‹ Cookbook</h1>
<p>æ¬¢è¿æ¥åˆ° <strong>Android RE Cookbook</strong> â€”â€” ä¸€æœ¬å®æˆ˜å¯¼å‘çš„
Android é€†å‘å·¥ç¨‹å®ç”¨æ‰‹å†Œã€‚</p>
<p>æœ¬ Cookbook
é‡‡ç”¨<strong>åœºæ™¯é©±åŠ¨</strong>çš„ç»„ç»‡æ–¹å¼ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°è§£å†³ç‰¹å®šé—®é¢˜çš„æ–¹æ³•ï¼Œè€Œéä¼ ç»Ÿçš„çŸ¥è¯†ç‚¹ç½—åˆ—ã€‚
___ ## ğŸš€ æ–°æ‰‹ï¼Ÿä»è¿™é‡Œå¼€å§‹</p>
<p><strong>å®Œå…¨æ–°æ‰‹ï¼Ÿ</strong> å…ˆå®Œæˆ 10 åˆ†é’Ÿå¿«é€Ÿå…¥é—¨ï¼Œä½“éªŒç¬¬ä¸€æ¬¡
Hookï¼</p>
<p>ğŸ‘‰ <strong><a href="./00-Quick-Start/index.md">10
åˆ†é’Ÿå¿«é€Ÿå…¥é—¨</a></strong> - å®‰è£… Frida å¹¶å®Œæˆç¬¬ä¸€æ¬¡ Hook</p>
<p><strong>ç¯å¢ƒè¿˜æ²¡é…ç½®å¥½ï¼Ÿ</strong> ğŸ‘‰ <strong><a
href="./00-Quick-Start/setup.md">ç¯å¢ƒé…ç½®æŒ‡å—</a></strong> -
ä»é›¶æ­å»ºé€†å‘åˆ†æç¯å¢ƒ ___ ## ğŸ“– å¦‚ä½•ä½¿ç”¨æœ¬ Cookbook</p>
<h3 id="æŒ‰éœ€æŸ¥æ‰¾">ğŸ¯ æŒ‰éœ€æŸ¥æ‰¾</h3>
<ul>
<li><strong>é‡åˆ°é—®é¢˜ï¼Ÿ</strong> ç›´æ¥æŸ¥çœ‹ <a href="#recipes">Recipes</a>
ç« èŠ‚ï¼Œæ‰¾åˆ°å¯¹åº”åœºæ™¯çš„è§£å†³æ–¹æ¡ˆ</li>
<li><strong>å­¦ä¹ å·¥å…·ï¼Ÿ</strong> æŸ¥çœ‹ <a href="#tools">Tools</a>
ç« èŠ‚ï¼Œäº†è§£å„ç±»å·¥å…·çš„ä½¿ç”¨æ–¹æ³•</li>
<li><strong>å‚è€ƒæ¡ˆä¾‹ï¼Ÿ</strong> æµè§ˆ <a href="#case-studies">Case
Studies</a>ï¼Œå­¦ä¹ å®æˆ˜åˆ†ææµç¨‹</li>
<li><strong>æŸ¥é˜…èµ„æ–™ï¼Ÿ</strong> è®¿é—® <a
href="#reference">Reference</a>ï¼Œæ·±å…¥ç†è§£åº•å±‚åŸç†</li>
</ul>
<h3 id="å­¦ä¹ è·¯å¾„">ğŸ“š å­¦ä¹ è·¯å¾„</h3>
<ol type="1">
<li><strong>æ–°æ‰‹å…¥é—¨</strong>: Reference â†’ Tools â†’ Recipes</li>
<li><strong>å®æˆ˜ä¸ºä¸»</strong>: Recipes â†’ Tools â†’ Case Studies</li>
<li><strong>è¿›é˜¶æå‡</strong>: Case Studies â†’ Reference/Advanced ___ ##
ğŸ¯ Recipes</li>
</ol>
<p>æŒ‰åœºæ™¯åˆ†ç±»çš„å®æˆ˜èœè°±ï¼Œæä¾›å¯ç›´æ¥ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="network---ç½‘ç»œä¸åŠ å¯†">ğŸŒ <a href="./01-Recipes/Network/">Network
- ç½‘ç»œä¸åŠ å¯†</a></h3>
<p>è§£å†³ç½‘ç»œæŠ“åŒ…ã€åŠ å¯†åˆ†æã€TLSæŒ‡çº¹ç­‰é—®é¢˜ã€‚</p>
<ul>
<li><a href="./01-Recipes/Network/network_sniffing.md">Network
Sniffing</a> - ç½‘ç»œåè®®åˆ†æä¸æŠ“åŒ…</li>
<li><a href="./01-Recipes/Network/crypto_analysis.md">Crypto
Analysis</a> - å¯†ç å­¦åˆ†æ</li>
<li><a href="./01-Recipes/Network/tls_fingerprinting_guide.md">TLS
Fingerprinting</a> - TLSæŒ‡çº¹è¯†åˆ«</li>
<li><a href="./01-Recipes/Network/ja3_fingerprinting.md">JA3
Fingerprinting</a> - JA3æŒ‡çº¹åˆ†æ</li>
<li><a href="./01-Recipes/Network/ja4_fingerprinting.md">JA4
Fingerprinting</a> - JA4æŒ‡çº¹åˆ†æ</li>
</ul>
<h3 id="anti-detection---åæ£€æµ‹ä¸å¯¹æŠ—">ğŸ›¡ï¸ <a
href="./01-Recipes/Anti-Detection/">Anti-Detection -
åæ£€æµ‹ä¸å¯¹æŠ—</a></h3>
<p>ç»•è¿‡å„ç±»æ£€æµ‹æœºåˆ¶ï¼ŒåŒ…æ‹¬åè°ƒè¯•ã€åHookã€éªŒè¯ç ç­‰ã€‚</p>
<ul>
<li><a href="./01-Recipes/Anti-Detection/frida_anti_debugging.md">Frida
Anti Debugging</a> - Fridaåè°ƒè¯•ç»•è¿‡</li>
<li><a
href="./01-Recipes/Anti-Detection/xposed_anti_debugging.md">Xposed Anti
Debugging</a> - Xposedåè°ƒè¯•ç»•è¿‡</li>
<li><a
href="./01-Recipes/Anti-Detection/captcha_bypassing_techniques.md">Captcha
Bypassing</a> - éªŒè¯ç ç»•è¿‡</li>
<li><a
href="./01-Recipes/Anti-Detection/app_hardening_identification.md">App
Hardening Identification</a> - åŠ å›ºè¯†åˆ«</li>
<li><a
href="./01-Recipes/Anti-Detection/device_fingerprinting_and_bypass.md">Device
Fingerprinting &amp; Bypass</a> - è®¾å¤‡æŒ‡çº¹ç»•è¿‡</li>
<li><a
href="./01-Recipes/Anti-Detection/mobile_app_sec_and_anti_bot.md">Mobile
App Security &amp; Anti Bot</a> - ç§»åŠ¨ç«¯å®‰å…¨ä¸åæœºå™¨äºº</li>
</ul>
<h3 id="unpacking---è„±å£³ä¸ä¿®å¤">ğŸ“¦ <a
href="./01-Recipes/Unpacking/">Unpacking - è„±å£³ä¸ä¿®å¤</a></h3>
<p>å¤„ç†åŠ å£³åº”ç”¨çš„è„±å£³å’Œä¿®å¤å·¥ä½œã€‚</p>
<ul>
<li><a href="./01-Recipes/Unpacking/un-packing.md">Unpacking</a> -
åº”ç”¨è„±å£³æŠ€æœ¯</li>
<li><a
href="./01-Recipes/Unpacking/frida_unpacking_and_so_fixing.md">Frida
Unpacking &amp; SO Fixing</a> - Fridaè„±å£³ä¸SOä¿®å¤</li>
<li><a href="./01-Recipes/Unpacking/so_obfuscation_deobfuscation.md">SO
Obfuscation Deobfuscation</a> - SOæ··æ·†ä¸åæ··æ·†</li>
<li><a href="./01-Recipes/Unpacking/so_string_deobfuscation.md">SO
String Deobfuscation</a> - SOå­—ç¬¦ä¸²åæ··æ·†</li>
</ul>
<h3 id="analysis---åˆ†æä¸è°ƒè¯•">ğŸ”¬ <a
href="./01-Recipes/Analysis/">Analysis - åˆ†æä¸è°ƒè¯•</a></h3>
<p>é™æ€åˆ†æã€åŠ¨æ€åˆ†æå’Œä»£ç æ··æ·†åˆ†æã€‚</p>
<ul>
<li><a href="./01-Recipes/Analysis/re_workflow.md">RE Workflow</a> -
é€†å‘å·¥ç¨‹å·¥ä½œæµ</li>
<li><a href="./01-Recipes/Analysis/static_analysis_deep_dive.md">Static
Analysis Deep Dive</a> - é™æ€åˆ†ææ·±å…¥</li>
<li><a
href="./01-Recipes/Analysis/dynamic_analysis_deep_dive.md">Dynamic
Analysis Deep Dive</a> - åŠ¨æ€åˆ†ææ·±å…¥</li>
<li><a href="./01-Recipes/Analysis/ollvm_deobfuscation.md">OLLVM
Deobfuscation</a> - OLLVMåæ··æ·†</li>
<li><a href="./01-Recipes/Analysis/vmp_analysis.md">VMP Analysis</a> -
VMPåˆ†æ</li>
<li><a href="./01-Recipes/Analysis/js_obfuscator.md">JS Obfuscator</a> -
JSæ··æ·†åˆ†æ</li>
<li><a href="./01-Recipes/Analysis/js_vmp.md">JS VMP</a> -
JSè™šæ‹Ÿæœºä¿æŠ¤</li>
<li><a href="./01-Recipes/Analysis/native_string_obfuscation.md">Native
String Obfuscation</a> - Nativeå­—ç¬¦ä¸²æ··æ·†</li>
</ul>
<h3 id="automation---è‡ªåŠ¨åŒ–ä¸è§„æ¨¡åŒ–">ğŸ¤– <a
href="./01-Recipes/Automation/">Automation - è‡ªåŠ¨åŒ–ä¸è§„æ¨¡åŒ–</a></h3>
<p>æ„å»ºè‡ªåŠ¨åŒ–åˆ†æç³»ç»Ÿå’Œè§„æ¨¡åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li><a
href="./01-Recipes/Automation/automation_and_device_farming.md">Automation
&amp; Device Farming</a> - è‡ªåŠ¨åŒ–ä¸ç¾¤æ§</li>
<li><a href="./01-Recipes/Automation/dial_up_proxy_pools.md">Dial Up
Proxy Pools</a> - åŠ¨æ€ä»£ç†æ± </li>
<li><a href="./01-Recipes/Automation/proxy_pool_design.md">Proxy Pool
Design</a> - ä»£ç†æ± è®¾è®¡</li>
<li><a href="./01-Recipes/Automation/scrapy.md">Scrapy</a> -
Scrapyçˆ¬è™«æ¡†æ¶</li>
<li><a href="./01-Recipes/Automation/scrapy_redis_distributed.md">Scrapy
Redis Distributed</a> - åˆ†å¸ƒå¼Scrapy</li>
<li><a href="./01-Recipes/Automation/docker_deployment.md">Docker
Deployment</a> - Dockeréƒ¨ç½²</li>
<li><a
href="./01-Recipes/Automation/virtualization_and_containers.md">Virtualization
&amp; Containers</a> - è™šæ‹ŸåŒ–ä¸å®¹å™¨</li>
<li><a href="./01-Recipes/Automation/web_anti_scraping.md">Web Anti
Scraping</a> - Webåçˆ¬è™«</li>
</ul>
<h3 id="scripts---å³ç”¨è„šæœ¬">ğŸ“ <a href="./01-Recipes/Scripts/">Scripts -
å³ç”¨è„šæœ¬</a></h3>
<p>å¯ç›´æ¥ä½¿ç”¨çš„è„šæœ¬é›†åˆã€‚</p>
<ul>
<li><a href="./01-Recipes/Scripts/frida_script_examples.md">Frida Script
Examples</a> - Fridaè„šæœ¬ç¤ºä¾‹</li>
<li><a href="./01-Recipes/Scripts/frida_common_scripts.md">Frida Common
Scripts</a> - Fridaå¸¸ç”¨è„šæœ¬</li>
<li><a href="./01-Recipes/Scripts/automation_scripts.md">Automation
Scripts</a> - è‡ªåŠ¨åŒ–è„šæœ¬</li>
<li><a href="./01-Recipes/Scripts/native_hooking.md">Native Hooking</a>
- Native Hookæ¨¡å¼</li>
<li><a href="./01-Recipes/Scripts/objection_snippets.md">Objection
Snippets</a> - Objectionä»£ç ç‰‡æ®µ</li>
<li><a href="./01-Recipes/Scripts/c_for_emulation.md">C For
Emulation</a> - Cè¯­è¨€ä»¿çœŸ ___ ## ğŸ”¨ Tools</li>
</ul>
<p>å·¥å…·ä½¿ç”¨æŒ‡å—å’ŒåŸç†å‰–æã€‚</p>
<h3 id="dynamic---åŠ¨æ€åˆ†æå·¥å…·">âš¡ <a href="./02-Tools/Dynamic/">Dynamic
- åŠ¨æ€åˆ†æå·¥å…·</a></h3>
<ul>
<li><a href="./02-Tools/Dynamic/frida_guide.md">Frida Guide</a> -
Fridaä½¿ç”¨æŒ‡å—</li>
<li><a href="./02-Tools/Dynamic/frida_internals.md">Frida Internals</a>
- Fridaå†…éƒ¨åŸç†</li>
<li><a href="./02-Tools/Dynamic/xposed_guide.md">Xposed Guide</a> -
Xposedä½¿ç”¨æŒ‡å—</li>
<li><a href="./02-Tools/Dynamic/xposed_internals.md">Xposed
Internals</a> - Xposedå†…éƒ¨åŸç†</li>
<li><a href="./02-Tools/Dynamic/unidbg_guide.md">Unidbg Guide</a> -
Unidbgä½¿ç”¨æŒ‡å—</li>
<li><a href="./02-Tools/Dynamic/unidbg_internals.md">Unidbg
Internals</a> - Unidbgå†…éƒ¨åŸç†</li>
</ul>
<h3 id="static---é™æ€åˆ†æå·¥å…·">ğŸ” <a href="./02-Tools/Static/">Static -
é™æ€åˆ†æå·¥å…·</a></h3>
<ul>
<li><a href="./02-Tools/Static/ghidra_guide.md">Ghidra Guide</a> -
Ghidraä½¿ç”¨æŒ‡å—</li>
<li><a href="./02-Tools/Static/ida_pro_guide.md">IDA Pro Guide</a> - IDA
Proä½¿ç”¨æŒ‡å—</li>
<li><a href="./02-Tools/Static/radare2_guide.md">Radare2 Guide</a> -
Radare2ä½¿ç”¨æŒ‡å—</li>
</ul>
<h3 id="cheatsheets---é€ŸæŸ¥è¡¨">ğŸ“‹ <a
href="./02-Tools/Cheatsheets/">Cheatsheets - é€ŸæŸ¥è¡¨</a></h3>
<ul>
<li><a href="./02-Tools/Cheatsheets/adb_cheatsheet.md">ADB
Cheatsheet</a> - ADBå‘½ä»¤é€ŸæŸ¥ ___ ## ğŸ“š Case Studies</li>
</ul>
<p>çœŸå®åœºæ™¯çš„æ¡ˆä¾‹åˆ†æï¼Œç»¼åˆè¿ç”¨å„ç±»æŠ€æœ¯ã€‚</p>
<ul>
<li><a href="./03-Case-Studies/case_anti_analysis_techniques.md">Anti
Analysis Techniques</a> - ååˆ†ææŠ€æœ¯æ¡ˆä¾‹</li>
<li><a href="./03-Case-Studies/case_music_apps.md">Music Apps</a> -
éŸ³ä¹Appåˆ†æ</li>
<li><a href="./03-Case-Studies/case_social_media_and_anti_bot.md">Social
Media &amp; Anti Bot</a> - ç¤¾äº¤åª’ä½“ä¸é£æ§</li>
<li><a href="./03-Case-Studies/case_study_app_encryption.md">App
Encryption</a> - åº”ç”¨åŠ å¯†æ¡ˆä¾‹</li>
<li><a href="./03-Case-Studies/case_video_apps_and_drm.md">Video Apps
&amp; DRM</a> - è§†é¢‘Appä¸DRM</li>
<li><a href="./03-Case-Studies/case_unity_games.md">Unity Games
(Il2Cpp)</a> - Unityæ¸¸æˆåˆ†æ</li>
<li><a href="./03-Case-Studies/case_flutter_apps.md">Flutter Apps</a> -
Flutteråº”ç”¨åˆ†æ</li>
<li><a href="./03-Case-Studies/case_malware_analysis.md">Malware
Analysis</a> - æ¶æ„è½¯ä»¶åˆ†æ ___ ## ğŸ“– Reference</li>
</ul>
<p>å‚è€ƒèµ„æ–™å’Œç†è®ºçŸ¥è¯†ï¼Œéœ€è¦æ—¶æŸ¥é˜…ã€‚</p>
<h3 id="foundations---åŸºç¡€çŸ¥è¯†">ğŸ“± <a
href="./04-Reference/Foundations/">Foundations - åŸºç¡€çŸ¥è¯†</a></h3>
<p>Androidåº”ç”¨å’Œç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€ã€‚</p>
<ul>
<li><a href="./04-Reference/Foundations/apk_structure.md">APK
Structure</a> - APKç»“æ„</li>
<li><a href="./04-Reference/Foundations/android_components.md">Android
Components</a> - å®‰å“å››å¤§ç»„ä»¶</li>
<li><a href="./04-Reference/Foundations/android_manifest.md">Android
Manifest</a> - AndroidManifest.xml</li>
<li><a
href="./04-Reference/Foundations/android_studio_debug_tools.md">Android
Studio Debug Tools</a> - Android Studioè°ƒè¯•å·¥å…·</li>
<li><a href="./04-Reference/Foundations/dex_format.md">DEX Format</a> -
DEXæ–‡ä»¶æ ¼å¼</li>
<li><a href="./04-Reference/Foundations/smali_syntax.md">Smali
Syntax</a> - Smaliè¯­æ³•</li>
<li><a href="./04-Reference/Foundations/so_elf_format.md">SO ELF
Format</a> - SOæ–‡ä»¶(ELF)æ ¼å¼</li>
<li><a href="./04-Reference/Foundations/art_runtime.md">ART Runtime</a>
- ARTè¿è¡Œæ—¶</li>
<li><a href="./04-Reference/Foundations/arm_assembly.md">ARM
Assembly</a> - ARMæ±‡ç¼–</li>
<li><a
href="./04-Reference/Foundations/x86_and_arm_assembly_basics.md">x86
&amp; ARM Assembly Basics</a> - x86ä¸ARMæ±‡ç¼–åŸºç¡€</li>
</ul>
<h3 id="advanced---é«˜çº§ä¸»é¢˜">ğŸš€ <a
href="./04-Reference/Advanced/">Advanced - é«˜çº§ä¸»é¢˜</a></h3>
<p>æ·±å…¥çš„ç³»ç»Ÿçº§å’Œé«˜çº§æŠ€æœ¯ã€‚</p>
<ul>
<li><a
href="./04-Reference/Advanced/android_sandbox_implementation.md">Android
Sandbox Implementation</a> - Androidæ²™ç®±å®ç°</li>
<li><a
href="./04-Reference/Advanced/aosp_and_system_customization.md">AOSP
&amp; System Customization</a> - AOSPä¸ç³»ç»Ÿå®šåˆ¶</li>
<li><a href="./04-Reference/Advanced/aosp_device_modification.md">AOSP
Device Modification</a> - AOSPè®¾å¤‡ä¿®æ”¹</li>
<li><a href="./04-Reference/Advanced/minimal_android_rootfs.md">Minimal
Android Rootfs</a> - æœ€å°åŒ–Androidæ ¹æ–‡ä»¶ç³»ç»Ÿ</li>
<li><a
href="./04-Reference/Advanced/so_anti_debugging_and_obfuscation.md">SO
Anti Debugging &amp; Obfuscation</a> - SOåè°ƒè¯•ä¸æ··æ·†</li>
<li><a href="./04-Reference/Advanced/so_runtime_emulation.md">SO Runtime
Emulation</a> - SOè¿è¡Œæ—¶ä»¿çœŸ</li>
</ul>
<h3 id="engineering---å·¥ç¨‹åŒ–">ğŸ”© <a
href="./04-Reference/Engineering/">Engineering - å·¥ç¨‹åŒ–</a></h3>
<p>è§„æ¨¡åŒ–å’Œå·¥ç¨‹åŒ–ç›¸å…³æŠ€æœ¯ã€‚</p>
<ul>
<li><a
href="./04-Reference/Engineering/frameworks_and_middleware.md">Frameworks
&amp; Middleware</a> - æ¡†æ¶ä¸ä¸­é—´ä»¶</li>
<li><a href="./04-Reference/Engineering/message_queues.md">Message
Queues</a> - æ¶ˆæ¯é˜Ÿåˆ—</li>
<li><a href="./04-Reference/Engineering/redis.md">Redis</a> -
Redisæ•°æ®åº“</li>
<li><a
href="./04-Reference/Engineering/risk_control_sdk_build_guide.md">Risk
Control SDK Build Guide</a> - é£æ§SDKæ„å»º</li>
</ul>
<h4 id="data-analysis---æ•°æ®åˆ†æ">ğŸ“Š Data Analysis - æ•°æ®åˆ†æ</h4>
<ul>
<li><a
href="./04-Reference/Engineering/Data-Analysis/data_warehousing_and_processing.md">Data
Warehousing &amp; Processing</a> - æ•°æ®ä»“åº“ä¸å¤„ç†</li>
<li><a
href="./04-Reference/Engineering/Data-Analysis/flink.md">Flink</a> -
Flinkæµå¤„ç†</li>
<li><a
href="./04-Reference/Engineering/Data-Analysis/hbase.md">HBase</a> -
HBaseåˆ†å¸ƒå¼æ•°æ®åº“</li>
<li><a href="./04-Reference/Engineering/Data-Analysis/hive.md">Hive</a>
- Hiveæ•°æ®ä»“åº“</li>
<li><a
href="./04-Reference/Engineering/Data-Analysis/spark.md">Spark</a> -
Sparkå¤§æ•°æ®å¤„ç† ___ ## ğŸ“ Appendix</li>
</ul>
<p>é™„å½•èµ„æºå’Œç¤¾åŒºèµ„æºã€‚</p>
<ul>
<li><a href="./05-Appendix/github_projects.md">Github Projects</a> -
å¼€æºé¡¹ç›®æ¨è</li>
<li><a href="./05-Appendix/learning_resources.md">Learning Resources</a>
- å­¦ä¹ èµ„æº</li>
<li><a href="./05-Appendix/ctf_platforms.md">CTF Platforms</a> -
CTFå¹³å°</li>
<li><a href="./05-Appendix/glossary.md">Glossary</a> - æœ¯è¯­è¡¨ ___ ## ğŸ¯
å¿«é€Ÿå¯¼èˆª</li>
</ul>
<h3 id="æˆ‘æƒ³">æˆ‘æƒ³â€¦</h3>
<ul>
<li><strong>æŠ“åŒ…åˆ†æ HTTPS æµé‡</strong> â†’ <a
href="./01-Recipes/Network/network_sniffing.md">Network
Sniffing</a></li>
<li><strong>ç»•è¿‡åº”ç”¨çš„åè°ƒè¯•æ£€æµ‹</strong> â†’ <a
href="./01-Recipes/Anti-Detection/frida_anti_debugging.md">Frida Anti
Debugging</a></li>
<li><strong>è„±å£³åŠ å›ºåº”ç”¨</strong> â†’ <a
href="./01-Recipes/Unpacking/un-packing.md">Unpacking</a></li>
<li><strong>åˆ†æåŠ å¯†ç®—æ³•</strong> â†’ <a
href="./01-Recipes/Network/crypto_analysis.md">Crypto Analysis</a></li>
<li><strong>å­¦ä¹  Frida ä½¿ç”¨</strong> â†’ <a
href="./02-Tools/Dynamic/frida_guide.md">Frida Guide</a></li>
<li><strong>æŸ¥çœ‹ Frida è„šæœ¬ç¤ºä¾‹</strong> â†’ <a
href="./01-Recipes/Scripts/frida_script_examples.md">Frida Script
Examples</a></li>
<li><strong>äº†è§£ APK æ–‡ä»¶ç»“æ„</strong> â†’ <a
href="./04-Reference/Foundations/apk_structure.md">APK
Structure</a></li>
<li><strong>çœ‹å®æˆ˜æ¡ˆä¾‹</strong> â†’ <a href="./03-Case-Studies/">Case
Studies</a> ___ ## ğŸ“ è´¡çŒ®</li>
</ul>
<p>æœ¬ Cookbook æŒç»­æ›´æ–°ä¸­ã€‚å¦‚æœ‰å»ºè®®æˆ–å‘ç°é”™è¯¯ï¼Œæ¬¢è¿åé¦ˆï¼ ___
<strong>Happy Hacking! ğŸš€</strong></p>
<!-- 00-Quick-Start/index.md -->
<h1 id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h1>
<p>æ¬¢è¿ï¼è¿™ä¸ªæŒ‡å—å°†å¸®åŠ©ä½ åœ¨ <strong>10 åˆ†é’Ÿå†…</strong>å®Œæˆç¬¬ä¸€æ¬¡ Android
é€†å‘åˆ†æã€‚</p>
<hr />
<h2 id="ä½ å°†å­¦åˆ°ä»€ä¹ˆ">ä½ å°†å­¦åˆ°ä»€ä¹ˆ</h2>
<p>å®Œæˆæœ¬æŒ‡å—åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… åœ¨çœŸæœº/æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ Frida</li>
<li>âœ… Hook ä¸€ä¸ª Android åº”ç”¨çš„ Java æ–¹æ³•</li>
<li>âœ… æŸ¥çœ‹å’Œä¿®æ”¹æ–¹æ³•çš„å‚æ•°ä¸è¿”å›å€¼</li>
<li>âœ… ç†è§£åŸºæœ¬çš„é€†å‘åˆ†ææµç¨‹</li>
</ul>
<p><strong>é¢„è®¡ç”¨æ—¶</strong>: 10-15 åˆ†é’Ÿ</p>
<hr />
<h2 id="å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</h2>
<h3 id="å¿…éœ€å·¥å…·">å¿…éœ€å·¥å…·</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr>
<th>å·¥å…·</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>â˜ Android è®¾å¤‡</td>
<td>å·² Root çš„çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ï¼ˆæ¨è Genymotion / Android Studio AVDï¼‰</td>
</tr>
<tr>
<td>â˜ ADB</td>
<td>Android Debug Bridge</td>
</tr>
<tr>
<td>â˜ Python</td>
<td>ç‰ˆæœ¬ 3.8+</td>
</tr>
<tr>
<td>â˜ æµ‹è¯• App</td>
<td>æœ¬æŒ‡å—ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„è®¾ç½®åº”ç”¨</td>
</tr>
</tbody>
</table>
<h3 id="æ£€æŸ¥æ¸…å•">æ£€æŸ¥æ¸…å•</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Check if ADB is installed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> version</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Check if Python is installed</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">--version</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Check device connection</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> devices</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Should display your device</span></span></code></pre></div>
<h2 id="æ“ä½œæ­¥éª¤">æ“ä½œæ­¥éª¤</h2>
<h3 id="ç¬¬-1-æ­¥å®‰è£…-frida2-åˆ†é’Ÿ">ç¬¬ 1 æ­¥ï¼šå®‰è£… Fridaï¼ˆ2 åˆ†é’Ÿï¼‰</h3>
<p><strong>åœ¨ç”µè„‘ä¸Šå®‰è£… Frida å·¥å…·</strong>ï¼š</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install frida-tools</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visit https://github.com/frida/frida/releases</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Download frida-server matching your Python frida version</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View your frida version</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">--version</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View device architecture</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell getprop ro.product.cpu.abi</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Common output: arm64-v8a, armeabi-v7a, x86_64</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Decompress and push to device</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> frida-server-<span class="pp">*</span>.zip</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> push frida-server-<span class="pp">*</span>-android-<span class="pp">*</span> /data/local/tmp/frida-server</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. grant execute permission and run</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;chmod 755 /data/local/tmp/frida-server&quot;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;/data/local/tmp/frida-server &amp;&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Should see output like:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PID Name</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- ---------------</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1234 com.android.settings</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 5678 com.android.systemui</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span></code></pre></div>
<p>æˆ‘ä»¬å°† Hook Android è®¾ç½®åº”ç”¨ï¼Œç›‘æ§å…¶æ–¹æ³•è°ƒç”¨ã€‚</p>
<p><strong>åˆ›å»º Hook è„šæœ¬</strong> <code>first_hook.js</code>ï¼š</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// first_hook.js - your first Frida script</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">[*] Frida hook started!&quot;</span>)<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Finding TargetClass...</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hook Android system Log class</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Log <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;android.util.Log&quot;</span>)<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hook Log.d method (debug log)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  Log<span class="op">.</span><span class="at">d</span><span class="op">.</span><span class="fu">overload</span>(<span class="st">&quot;java.lang.String&quot;</span><span class="op">,</span> <span class="st">&quot;java.lang.String&quot;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> (tag<span class="op">,</span> msg) {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">[+] Captured LogCall:&quot;</span>)<span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Tag: &quot;</span> <span class="op">+</span> tag)<span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Message: &quot;</span> <span class="op">+</span> msg)<span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Call original method</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">d</span>(tag<span class="op">,</span> msg)<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Hook setup completed! Now open Settings app...</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: attach to running app</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-n</span> com.android.settings <span class="at">-l</span> first_hook.js</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: inject at app startup</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.android.settings <span class="at">-l</span> first_hook.js <span class="at">--no-pause</span></span></code></pre></div>
<pre><code>
[+] Captured LogCall:
Tag: SettingsActivity
Message: onCreate called

[+] Captured LogCall:
Tag: SettingsFragment
Message: Loading preferences...
</code></pre>
<p>âœ… <strong>çœ‹åˆ°æ—¥å¿—è¾“å‡ºäº†å—ï¼Ÿæ­å–œï¼ä½ å·²ç»æˆåŠŸ Hook äº†ä¸€ä¸ª Android
åº”ç”¨ï¼</strong></p>
<hr />
<h3 id="ç¬¬-3-æ­¥ä¿®æ”¹åº”ç”¨è¡Œä¸º3-åˆ†é’Ÿ">ç¬¬ 3 æ­¥ï¼šä¿®æ”¹åº”ç”¨è¡Œä¸ºï¼ˆ3 åˆ†é’Ÿï¼‰</h3>
<p>ç°åœ¨è®©æˆ‘ä»¬åšç‚¹æ›´æœ‰è¶£çš„ â€”â€” <strong>ä¿®æ”¹åº”ç”¨çš„è¿”å›å€¼</strong>ã€‚</p>
<p><strong>åˆ›å»ºè„šæœ¬</strong> <code>modify_behavior.js</code>ï¼š</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// modify_behavior.js - Modify App behavior</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">[*] Start Hook...</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hook String Class equals Method</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> <span class="bu">String</span> <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.lang.String&quot;</span>)<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">String</span><span class="op">.</span><span class="at">equals</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (other) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// get original result</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">equals</span>(other)<span class="op">;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// if string is &quot;WiFi&quot;, modify result</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">toString</span>() <span class="op">===</span> <span class="st">&quot;WiFi&quot;</span> <span class="op">||</span> other<span class="op">.</span><span class="fu">toString</span>() <span class="op">===</span> <span class="st">&quot;WiFi&quot;</span>) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">[!] detected WiFi String comparison&quot;</span>)<span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Original: &#39;&quot;</span> <span class="op">+</span> <span class="kw">this</span> <span class="op">+</span> <span class="st">&quot;&#39; == &#39;&quot;</span> <span class="op">+</span> other <span class="op">+</span> <span class="st">&quot;&#39; =&gt; &quot;</span> <span class="op">+</span> result)<span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Modified: true</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// return true</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;[*] Hook completed! All &#39;WiFi&#39; String comparison will return true</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.android.settings <span class="at">-l</span> modify_behavior.js <span class="at">--no-pause</span></span></code></pre></div>
<ul>
<li>ä¿®æ”¹åŠ å¯†å‚æ•°</li>
<li>ç»•è¿‡ç­¾åéªŒè¯</li>
<li>ç¯¡æ”¹ç½‘ç»œè¯·æ±‚</li>
</ul>
<hr />
<h2 id="æ­å–œä½ å·²å®Œæˆå¿«é€Ÿå…¥é—¨">æ­å–œï¼ä½ å·²å®Œæˆå¿«é€Ÿå…¥é—¨</h2>
<h3 id="ä½ å­¦ä¼šäº†ä»€ä¹ˆ">ä½ å­¦ä¼šäº†ä»€ä¹ˆ</h3>
<p>âœ… å®‰è£…å’Œè¿è¡Œ Frida âœ… ç¼–å†™åŸºæœ¬çš„ Hook è„šæœ¬ âœ… ç›‘æ§æ–¹æ³•è°ƒç”¨ âœ…
ä¿®æ”¹æ–¹æ³•è¿”å›å€¼</p>
<h3 id="ä¸‹ä¸€æ­¥å­¦ä¹ ">ä¸‹ä¸€æ­¥å­¦ä¹ </h3>
<p>æ ¹æ®ä½ çš„å…´è¶£é€‰æ‹©ï¼š</p>
<h4 id="æˆ‘æƒ³æ·±å…¥å­¦ä¹ å·¥å…·"><strong>æˆ‘æƒ³æ·±å…¥å­¦ä¹ å·¥å…·</strong></h4>
<ul>
<li><a href="../02-Tools/Dynamic/frida_guide.md">Frida å®Œæ•´æŒ‡å—</a> -
å­¦ä¹  Frida çš„æ‰€æœ‰ API</li>
<li><a href="../02-Tools/Dynamic/frida_internals.md">Frida å†…éƒ¨åŸç†</a>
- ç†è§£ Frida å¦‚ä½•å·¥ä½œ</li>
<li><a href="../02-Tools/Cheatsheets/adb_cheatsheet.md">ADB å‘½ä»¤é€ŸæŸ¥</a>
- æŒæ¡ ADB å¸¸ç”¨å‘½ä»¤</li>
</ul>
<h4 id="æˆ‘æƒ³è§£å†³å…·ä½“é—®é¢˜"><strong>æˆ‘æƒ³è§£å†³å…·ä½“é—®é¢˜</strong></h4>
<p><strong>åœºæ™¯ 1: æŠ“åŒ…åˆ†æ</strong> â†’ <a
href="../01-Recipes/Network/network_sniffing.md">ç½‘ç»œæŠ“åŒ… Recipe</a></p>
<p><strong>åœºæ™¯ 2: ç»•è¿‡åè°ƒè¯•</strong> â†’ <a
href="../01-Recipes/Anti-Detection/frida_anti_debugging.md">åè°ƒè¯•ç»•è¿‡
Recipe</a></p>
<p><strong>åœºæ™¯ 3: åˆ†æåŠ å¯†ç®—æ³•</strong> â†’ <a
href="../01-Recipes/Network/crypto_analysis.md">å¯†ç å­¦åˆ†æ
Recipe</a></p>
<p><strong>åœºæ™¯ 4: è„±å£³åŠ å›º App</strong> â†’ <a
href="../01-Recipes/Unpacking/un-packing.md">åº”ç”¨è„±å£³ Recipe</a></p>
<h4 id="æˆ‘æƒ³çœ‹å®æˆ˜æ¡ˆä¾‹"><strong>æˆ‘æƒ³çœ‹å®æˆ˜æ¡ˆä¾‹</strong></h4>
<ul>
<li><a href="../03-Case-Studies/case_music_apps.md">éŸ³ä¹ App åˆ†æ</a> -
VIP ç ´è§£ã€éŸ³é¢‘è§£å¯†</li>
<li><a href="../03-Case-Studies/case_social_media_and_anti_bot.md">ç¤¾äº¤
App é£æ§</a> - API ç­¾åã€è®¾å¤‡æŒ‡çº¹</li>
</ul>
<h4 id="æˆ‘æƒ³ç†è§£åŸºç¡€åŸç†"><strong>æˆ‘æƒ³ç†è§£åŸºç¡€åŸç†</strong></h4>
<ul>
<li><a href="../04-Reference/Foundations/apk_structure.md">APK
æ–‡ä»¶ç»“æ„</a></li>
<li><a href="../04-Reference/Foundations/android_components.md">Android
å››å¤§ç»„ä»¶</a></li>
<li><a href="../04-Reference/Foundations/dex_format.md">DEX
æ–‡ä»¶æ ¼å¼</a></li>
</ul>
<hr />
<h2 id="å¸¸è§é—®é¢˜">ğŸ’¡ å¸¸è§é—®é¢˜</h2>
<h3 id="q-frida-è¿æ¥ä¸ä¸Šè®¾å¤‡">Q: Frida è¿æ¥ä¸ä¸Šè®¾å¤‡ï¼Ÿ</h3>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Confirm frida-server is running</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;ps | grep frida&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. é‡å¯ frida-server</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;pkill frida-server&quot;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;/data/local/tmp/frida-server &amp;&quot;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Check port forwarding (if needed)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> forward tcp:27042 tcp:27042</span></code></pre></div>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol type="1">
<li><strong>ç¡®è®¤åº”ç”¨æ­£åœ¨è¿è¡Œ</strong>ï¼š</li>
</ol>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span> <span class="kw">|</span> <span class="fu">grep</span> YourAppPackageName</span></code></pre></div>
<ul>
<li>ä½¿ç”¨ jadx-gui åç¼–è¯‘æŸ¥çœ‹å‡†ç¡®çš„ç±»å</li>
<li>æ³¨æ„å†…éƒ¨ç±»çš„ <code>$</code> ç¬¦å·ï¼ˆå¦‚
<code>OuterClass$InnerClass</code>ï¼‰</li>
</ul>
<ol start="3" type="1">
<li><strong>å¤„ç†æ–¹æ³•é‡è½½</strong>ï¼š</li>
</ol>
<div class="sourceCode" id="cb12"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// If method has multiple overloads, need to specify parameter class type</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>YourClass<span class="op">.</span><span class="at">yourMethod</span><span class="op">.</span><span class="fu">overload</span>(<span class="st">&#39;java.lang.String&#39;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="op">...</span></span></code></pre></div>
<p>â†’ æŸ¥çœ‹ <a
href="../01-Recipes/Anti-Detection/frida_anti_debugging.md">Frida
åè°ƒè¯•ç»•è¿‡</a></p>
<hr />
<h2 id="æ›´å¤šèµ„æº">æ›´å¤šèµ„æº</h2>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Frida å®˜æ–¹æ–‡æ¡£</strong></td>
<td>https://frida.re/docs/</td>
</tr>
<tr>
<td><strong>Frida CodeShare</strong></td>
<td>https://codeshare.frida.re/ ï¼ˆç¤¾åŒºè„šæœ¬ï¼‰</td>
</tr>
<tr>
<td><strong>æœ¬ Cookbook è„šæœ¬åº“</strong></td>
<td><a href="../01-Recipes/Scripts/frida_script_examples.md">Frida
è„šæœ¬ç¤ºä¾‹</a></td>
</tr>
</tbody>
</table>
<hr />
<p><strong>å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹ä½ çš„é€†å‘ä¹‹æ—…å§ï¼</strong></p>
<!-- 00-Quick-Start/setup.md -->
<h1 id="ç¯å¢ƒé…ç½®æŒ‡å—">ç¯å¢ƒé…ç½®æŒ‡å—</h1>
<p>æœ¬æŒ‡å—å¸®åŠ©ä½ ä»é›¶å¼€å§‹æ­å»º Android é€†å‘åˆ†æç¯å¢ƒã€‚</p>
<hr />
<h2 id="æ‰€éœ€å·¥å…·æ¦‚è§ˆ">æ‰€éœ€å·¥å…·æ¦‚è§ˆ</h2>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>ç”¨é€”</th>
<th>å¿…éœ€ç¨‹åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADB</td>
<td>ä¸ Android è®¾å¤‡é€šä¿¡</td>
<td>å¿…éœ€</td>
</tr>
<tr>
<td>Python 3.8+</td>
<td>è¿è¡Œ Frida å·¥å…·</td>
<td>å¿…éœ€</td>
</tr>
<tr>
<td>Frida</td>
<td>åŠ¨æ€æ’æ¡©æ¡†æ¶</td>
<td>å¿…éœ€</td>
</tr>
<tr>
<td>Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</td>
<td>è¿è¡Œç›®æ ‡åº”ç”¨</td>
<td>å¿…éœ€</td>
</tr>
<tr>
<td>jadx-gui</td>
<td>åç¼–è¯‘ APK</td>
<td>æ¨è</td>
</tr>
<tr>
<td>Burp Suite</td>
<td>æŠ“åŒ…åˆ†æ</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>IDA Pro / Ghidra</td>
<td>é™æ€åˆ†æ Native ä»£ç </td>
<td>å¯é€‰</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="é€‰æ‹©ä½ çš„ç³»ç»Ÿ">é€‰æ‹©ä½ çš„ç³»ç»Ÿ</h2>
<details>
<summary>
<b>Windows ç”¨æˆ·</b>
</summary>
<h3 id="å®‰è£…-python">1. å®‰è£… Python</h3>
<p><strong>ä¸‹è½½å®‰è£…åŒ…</strong>ï¼š</p>
<ul>
<li>è®¿é—® https://www.python.org/downloads/</li>
<li>ä¸‹è½½ Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li>å®‰è£…æ—¶<strong>å‹¾é€‰</strong> â€œAdd Python to PATHâ€</li>
</ul>
<p><strong>éªŒè¯å®‰è£…</strong>ï¼š</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cmd"><code class="sourceCode dosbat"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>python -<span class="at">-version</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pip -<span class="at">-version</span></span></code></pre></div>
<p><strong>æ–¹æ³• 1: é€šè¿‡ Android Studio</strong></p>
<ul>
<li>ä¸‹è½½ Android Studio: https://developer.android.com/studio</li>
<li>å®‰è£…åï¼ŒSDK Manager ä¼šè‡ªåŠ¨å®‰è£… ADB</li>
<li>è·¯å¾„é€šå¸¸åœ¨:
<code>C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Android\Sdk\platform-tools\</code></li>
</ul>
<p><strong>æ–¹æ³• 2: ç‹¬ç«‹å®‰è£… platform-tools</strong></p>
<ul>
<li>ä¸‹è½½:
https://developer.android.com/studio/releases/platform-tools</li>
<li>è§£å‹åˆ° <code>C:\adb\</code></li>
<li>æ·»åŠ åˆ°ç³»ç»Ÿ PATH ç¯å¢ƒå˜é‡</li>
</ul>
<p><strong>éªŒè¯å®‰è£…</strong>ï¼š</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cmd"><code class="sourceCode dosbat"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>adb version</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cmd"><code class="sourceCode dosbat"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pip install frida<span class="at">-tools</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>frida -<span class="at">-version</span></span></code></pre></div>
<details>
<summary>
<b>macOS ç”¨æˆ·</b>
</summary>
<h3 id="å®‰è£…-homebrewå¦‚æœæ²¡æœ‰">1. å®‰è£… Homebrewï¼ˆå¦‚æœæ²¡æœ‰ï¼‰</h3>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span> <span class="at">-c</span> <span class="st">&quot;</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="va">)</span><span class="st">&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install python3</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install android-platform-tools</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install frida-tools</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">--version</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> version</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">--version</span></span></code></pre></div>
<details>
<summary>
<b>Linux ç”¨æˆ·</b>
</summary>
<h3 id="å®‰è£…-python-1">1. å®‰è£… Python</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install python3 python3-pip</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install android-tools-adb</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install frida-tools</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">--version</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> version</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">--version</span></span></code></pre></div>
<hr />
<h2 id="é…ç½®-android-è®¾å¤‡æ¨¡æ‹Ÿå™¨">é…ç½® Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</h2>
<h3 id="é€‰é¡¹-1-ä½¿ç”¨çœŸæœºæ¨èç”¨äºå®æˆ˜">é€‰é¡¹ 1:
ä½¿ç”¨çœŸæœºï¼ˆæ¨èç”¨äºå®æˆ˜ï¼‰</h3>
<h4 id="æ­¥éª¤-1-å¯ç”¨å¼€å‘è€…é€‰é¡¹">æ­¥éª¤ 1: å¯ç”¨å¼€å‘è€…é€‰é¡¹</h4>
<ol type="1">
<li>æ‰“å¼€ <strong>è®¾ç½®</strong> â†’ <strong>å…³äºæ‰‹æœº</strong></li>
<li>è¿ç»­ç‚¹å‡» <strong>â€œç‰ˆæœ¬å·â€</strong> 7 æ¬¡</li>
<li>è¿”å›è®¾ç½®ï¼Œæ‰¾åˆ° <strong>å¼€å‘è€…é€‰é¡¹</strong></li>
</ol>
<h4 id="æ­¥éª¤-2-å¯ç”¨-usb-è°ƒè¯•">æ­¥éª¤ 2: å¯ç”¨ USB è°ƒè¯•</h4>
<p>åœ¨å¼€å‘è€…é€‰é¡¹ä¸­ï¼š</p>
<ul>
<li>âœ… å¯ç”¨ <strong>USB è°ƒè¯•</strong></li>
<li>âœ… å¯ç”¨ <strong>USB å®‰è£…</strong>ï¼ˆå…è®¸é€šè¿‡ ADB å®‰è£…åº”ç”¨ï¼‰</li>
</ul>
<h4 id="æ­¥éª¤-3-è¿æ¥è®¾å¤‡">æ­¥éª¤ 3: è¿æ¥è®¾å¤‡</h4>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect device to PC via USB</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Device will pop up an authorization prompt, click &quot;Allow&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify connection</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> devices</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Should see:</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># List of devices attached</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ABC123456789 device</span></span></code></pre></div>
<p><strong>æ–¹æ³• 1: ä½¿ç”¨ Magisk</strong></p>
<ol type="1">
<li>è§£é” Bootloaderï¼ˆå‚å•†ç‰¹å®šï¼‰</li>
<li>å®‰è£… Magisk: https://github.com/topjohnwu/Magisk</li>
<li>å‚è€ƒå®˜æ–¹æ–‡æ¡£</li>
</ol>
<p><strong>æ–¹æ³• 2: ä½¿ç”¨å·² Root çš„æµ‹è¯•æœº</strong></p>
<ul>
<li>Google Pixel ç³»åˆ—ï¼ˆå®¹æ˜“è§£é”ï¼‰</li>
<li>ä¸€åŠ è®¾å¤‡</li>
<li>æˆ–è´­ä¹°ä¸“é—¨çš„æµ‹è¯•æœº</li>
</ul>
<p><strong>âš ï¸ è­¦å‘Š</strong>: Root ä¼šå¤±å»ä¿ä¿®ï¼Œä»…åœ¨æµ‹è¯•è®¾å¤‡ä¸Šæ“ä½œï¼</p>
<hr />
<h3 id="é€‰é¡¹-2-ä½¿ç”¨-android-æ¨¡æ‹Ÿå™¨æ¨èæ–°æ‰‹">é€‰é¡¹ 2: ä½¿ç”¨ android
æ¨¡æ‹Ÿå™¨ï¼ˆæ¨èæ–°æ‰‹ï¼‰</h3>
<h4 id="æ–¹æ¡ˆ-a-genymotionæœ€ç¨³å®š">æ–¹æ¡ˆ A: Genymotionï¼ˆæœ€ç¨³å®šï¼‰</h4>
<p><strong>ä¼˜ç‚¹</strong>: è‡ªå¸¦ Rootï¼Œæ€§èƒ½å¥½ <strong>ç¼ºç‚¹</strong>:
ä¸ªäººç‰ˆå…è´¹ä½†åŠŸèƒ½å—é™</p>
<ol type="1">
<li>ä¸‹è½½ Genymotion: https://www.genymotion.com/download/</li>
<li>å®‰è£…å¹¶æ³¨å†Œè´¦å·</li>
<li>åˆ›å»ºè™šæ‹Ÿè®¾å¤‡ï¼ˆæ¨è Google Pixel 3, Android 9.0ï¼‰</li>
<li>å¯åŠ¨è™šæ‹Ÿè®¾å¤‡</li>
</ol>
<p><strong>éªŒè¯</strong>ï¼š</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> devices</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Should see Genymotion device</span></span></code></pre></div>
<p><strong>æ­¥éª¤</strong>ï¼š</p>
<ol type="1">
<li>æ‰“å¼€ Android Studio</li>
<li>Tools â†’ Device Manager â†’ Create Device</li>
<li>é€‰æ‹©è®¾å¤‡ï¼ˆå¦‚ Pixel 5ï¼‰</li>
<li>é€‰æ‹©ç³»ç»Ÿé•œåƒï¼ˆâš ï¸ å¿…é¡»é€‰æ‹© <strong>ä¸å¸¦ Google Play</strong>
çš„é•œåƒï¼Œå¦‚ â€œx86_64 API 30â€ï¼‰</li>
<li>å¯åŠ¨æ¨¡æ‹Ÿå™¨</li>
</ol>
<p><strong>å¯ç”¨ Root</strong>ï¼š</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> root</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> remount</span></code></pre></div>
<p><strong>æ¨è</strong>ï¼š</p>
<ul>
<li>å¤œç¥: https://www.yeshen.com/</li>
<li>é›·ç”µ: https://www.ldmnq.com/</li>
</ul>
<p><strong>æ³¨æ„</strong>: éƒ¨åˆ†æ¨¡æ‹Ÿå™¨å¯èƒ½ä¸æ”¯æŒæŸäº›åº”ç”¨</p>
<hr />
<h2 id="å®‰è£…-frida-server-åˆ°è®¾å¤‡">å®‰è£… Frida Server åˆ°è®¾å¤‡</h2>
<h3 id="æ­¥éª¤-1-ç¡®å®šè®¾å¤‡æ¶æ„">æ­¥éª¤ 1: ç¡®å®šè®¾å¤‡æ¶æ„</h3>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell getprop ro.product.cpu.abi</span></code></pre></div>
<ul>
<li><code>arm64-v8a</code> â†’ ä¸‹è½½
<strong>frida-server-*-android-arm64</strong>ï¼ˆçœŸæœºå¸¸ç”¨ï¼‰</li>
<li><code>armeabi-v7a</code> â†’ ä¸‹è½½
<strong>frida-server-*-android-arm</strong></li>
<li><code>x86_64</code> â†’ ä¸‹è½½
<strong>frida-server-*-android-x86_64</strong>ï¼ˆæ¨¡æ‹Ÿå™¨å¸¸ç”¨ï¼‰</li>
<li><code>x86</code> â†’ ä¸‹è½½
<strong>frida-server-*-android-x86</strong></li>
</ul>
<h3 id="æ­¥éª¤-2-ä¸‹è½½-frida-server">æ­¥éª¤ 2: ä¸‹è½½ Frida Server</h3>
<ol type="1">
<li>è®¿é—®: https://github.com/frida/frida/releases</li>
<li>æ‰¾åˆ°ä¸ä½ ç”µè„‘ Frida ç‰ˆæœ¬ä¸€è‡´çš„ release</li>
</ol>
<p><strong>æ£€æŸ¥æœ¬åœ° Frida ç‰ˆæœ¬</strong>ï¼š</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">--version</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># E.g.: 16.1.4</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Decompress</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unxz</span> frida-server-16.1.4-android-arm64.xz</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or Windows: Use 7-Zip Decompress</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename (optional, easier to manage)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> frida-server-16.1.4-android-arm64 frida-server</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># push to device</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> push frida-server /data/local/tmp/</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Grant Execute permission</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;chmod 755 /data/local/tmp/frida-server&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;/data/local/tmp/frida-server &amp;&quot;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify it is running</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;ps | grep frida-server&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to /data/adb/service.d/ (Need Root)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Should see process list</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PID Name</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- ---------------</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1234 com.android.settings</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span></code></pre></div>
<h2 id="å®‰è£…å…¶ä»–å·¥å…·å¯é€‰">å®‰è£…å…¶ä»–å·¥å…·ï¼ˆå¯é€‰ï¼‰</h2>
<h3 id="jadx-guiå¼ºçƒˆæ¨è">jadx-guiï¼ˆå¼ºçƒˆæ¨èï¼‰</h3>
<p>ç”¨äºåç¼–è¯‘ APK æŸ¥çœ‹ Java ä»£ç ã€‚</p>
<p><strong>å®‰è£…</strong>ï¼š</p>
<ol type="1">
<li>ä¸‹è½½: https://github.com/skylot/jadx/releases</li>
<li>è§£å‹å¹¶è¿è¡Œ <code>jadx-gui</code>ï¼ˆæˆ– Windows ä¸Šè¿è¡Œ
<code>jadx-gui.bat</code>ï¼‰</li>
</ol>
<p><strong>ä½¿ç”¨</strong>ï¼š</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># command line</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx</span> <span class="at">-d</span> output_dir app.apk</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># or use GUI: Open APK File</span></span></code></pre></div>
<p><strong>IDA Pro</strong>:</p>
<ul>
<li>å•†ä¸šè½¯ä»¶ï¼ŒåŠŸèƒ½å¼ºå¤§</li>
<li>å®˜ç½‘: https://hex-rays.com/ida-pro/</li>
</ul>
<p><strong>Ghidra</strong>ï¼ˆå…è´¹å¼€æºï¼‰:</p>
<ul>
<li>NSA å¼€æºå·¥å…·</li>
<li>ä¸‹è½½: https://github.com/NationalSecurityAgency/ghidra/releases</li>
<li>éœ€è¦ JDK 11+</li>
</ul>
<hr />
<h2 id="ç¯å¢ƒæ£€æŸ¥æ¸…å•">âœ… ç¯å¢ƒæ£€æŸ¥æ¸…å•</h2>
<p>å®Œæˆé…ç½®åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Python</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">--version</span> <span class="co"># Should &gt;= 3.8</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Pip</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> <span class="at">--version</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ADB</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> version</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Verify device connection</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> devices <span class="co"># Should display device</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Frida native tool</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">--version</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Frida Server</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span> <span class="co"># Should list processes</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. jadx (Optional)</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx</span> <span class="at">--version</span></span></code></pre></div>
<hr />
<h2 id="å¸¸è§é—®é¢˜-1">â“ å¸¸è§é—®é¢˜</h2>
<h3 id="q-adb-devices-æ˜¾ç¤º-unauthorized">Q: <code>adb devices</code>
æ˜¾ç¤º â€œunauthorizedâ€ï¼Ÿ</h3>
<p><strong>è§£å†³</strong>ï¼š</p>
<ol type="1">
<li>è®¾å¤‡ä¸Šæ²¡æœ‰å¼¹å‡ºæˆæƒæç¤ºï¼Ÿé‡æ–°æ’æ‹” USB</li>
<li>æ’¤é”€æˆæƒå¹¶é‡è¯•ï¼š</li>
</ol>
<div class="sourceCode" id="cb33"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> kill-server</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> start-server</span></code></pre></div>
<h3 id="q-adb-devices-ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤º">Q: <code>adb devices</code>
ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤ºï¼Ÿ</h3>
<p><strong>Windows</strong>:</p>
<ol type="1">
<li>å®‰è£…è®¾å¤‡é©±åŠ¨ï¼ˆå‚å•†ç½‘ç«™ä¸‹è½½ï¼‰</li>
<li>æˆ–å®‰è£… Universal ADB Driver</li>
</ol>
<p><strong>Linux</strong>:</p>
<ol type="1">
<li>æ£€æŸ¥ udev è§„åˆ™æ˜¯å¦é…ç½®</li>
<li>å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ <code>plugdev</code> ç»„ï¼š</li>
</ol>
<div class="sourceCode" id="cb34"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod <span class="at">-aG</span> plugdev <span class="va">$USER</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to re-login for changes to take effect</span></span></code></pre></div>
<ol type="1">
<li><strong>ç¡®è®¤è®¾å¤‡å·² Root</strong>ï¼š</li>
</ol>
<div class="sourceCode" id="cb35"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell su</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If shows &quot;not found&quot;, indicates no Root</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;setenforce 0&quot;</span> <span class="co"># Temporarily disable SELinux</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-verify architecture</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell getprop ro.product.cpu.abi</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Download matching frida-server</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Native Frida Version</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">--version</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure frida-server version matches</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-download corresponding version frida-server</span></span></code></pre></div>
<p><strong>Android Studio AVD</strong>:</p>
<ul>
<li>ä½¿ç”¨ x86_64 é•œåƒï¼ˆè€Œé ARMï¼‰</li>
<li>å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆIntel HAXM / AMD Hypervisorï¼‰</li>
</ul>
<hr />
<h2 id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</h2>
<p>ç¯å¢ƒé…ç½®å®Œæˆï¼æ¥ä¸‹æ¥ï¼š</p>
<ol type="1">
<li><strong>å®Œæˆå¿«é€Ÿå…¥é—¨</strong> â†’ <a href="./index.md">10 åˆ†é’Ÿç¬¬ä¸€æ¬¡
Hook</a></li>
<li><strong>å­¦ä¹  Frida å·¥å…·</strong> â†’ <a
href="../02-Tools/Dynamic/frida_guide.md">Frida å®Œæ•´æŒ‡å—</a></li>
<li><strong>æŸ¥çœ‹å®æˆ˜è„šæœ¬</strong> â†’ <a
href="../01-Recipes/Scripts/frida_script_examples.md">Frida
è„šæœ¬ç¤ºä¾‹</a></li>
</ol>
<hr />
<p><strong>ç¥é…ç½®é¡ºåˆ©ï¼</strong></p>
<!-- 01-Recipes/Analysis/dynamic_analysis_deep_dive.md -->
<h1 id="recipe-ä½¿ç”¨åŠ¨æ€åˆ†æéªŒè¯å’Œæ¢ç´¢-android-app-çš„è¿è¡Œæ—¶è¡Œä¸º">Recipe:
ä½¿ç”¨åŠ¨æ€åˆ†æéªŒè¯å’Œæ¢ç´¢ android App çš„è¿è¡Œæ—¶è¡Œä¸º</h1>
<h2 id="é—®é¢˜åœºæ™¯">é—®é¢˜åœºæ™¯</h2>
<p>*ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ*</p>
<ul>
<li>âœ… ä½ å·²ç»é™æ€åˆ†ææ‰¾åˆ°äº†ç›®æ ‡å‡½æ•°ï¼Œç°åœ¨æƒ³éªŒè¯å®ƒçš„å®é™…è¾“å…¥è¾“å‡º</li>
<li>ä½ æƒ³æ•è·è¿è¡Œæ—¶æ‰ç”Ÿæˆçš„æ•°æ®ï¼ˆå¦‚åŠ¨æ€å¯†é’¥ã€ç­¾åç»“æœï¼‰</li>
<li>ä½ æƒ³ç»•è¿‡ SSL Pinning / åè°ƒè¯• / Root æ£€æµ‹</li>
<li>ğŸ§ª ä½ æƒ³ä¸»åŠ¨è°ƒç”¨å‡½æ•°æµ‹è¯•ä¸åŒå‚æ•°çš„æ•ˆæœ</li>
<li>ğŸ•µï¸ ä½ æƒ³è¿½è¸ªä»£ç æ‰§è¡Œè·¯å¾„ï¼Œçœ‹çœ‹å“ªäº›å‡½æ•°è¢«è°ƒç”¨äº†</li>
</ul>
<p>*æœ¬é…æ–¹æ•™ä½ *ï¼šç³»ç»Ÿæ€§åœ°ä½¿ç”¨
Fridaã€è°ƒè¯•å™¨ã€è¿½è¸ªå·¥å…·æ¥éªŒè¯é™æ€åˆ†æç»“æœã€è·å–è¿è¡Œæ—¶æ•°æ®ã€ç»•è¿‡ä¿æŠ¤æœºåˆ¶ã€‚</p>
<p>*æ ¸å¿ƒç†å¿µ*ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>åŠ¨æ€åˆ†æï¼šè®©ä»£ç è¯´è¯</strong></p>
<ul>
<li>åŠ¨æ€åˆ†æéªŒè¯é™æ€åˆ†æçš„å‡è®¾</li>
<li>è·å–åªåœ¨è¿è¡Œæ—¶å­˜åœ¨çš„æ•°æ®</li>
<li>ä¸»åŠ¨æ¢ç´¢ç¨‹åºçš„å†…éƒ¨çŠ¶æ€</li>
<li>Hook â†’ Debug â†’ Trace ä¸‰ç§æ­¦å™¨å„æœ‰ç”¨é€”</li>
</ul>
</blockquote>
<p>*é¢„è®¡ç”¨æ—¶*: 30-90 åˆ†é’Ÿ ___ ## å·¥å…·æ¸…å•</p>
<h2 id="å¿…éœ€å·¥å…·-1"># å¿…éœ€å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>Frida</strong> - åŠ¨æ€æ’æ¡©æ¡†æ¶</li>
</ul></li>
<li><ul>
<li><strong>Android è®¾å¤‡</strong>ï¼ˆå·² Rootï¼‰æˆ–æ¨¡æ‹Ÿå™¨</li>
</ul></li>
<li><ul>
<li><strong>Python 3.7+</strong> - è¿è¡Œ Frida è„šæœ¬</li>
</ul></li>
</ul>
<h2 id="å¯é€‰å·¥å…·"># å¯é€‰å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>IDA Pro Remote Debugger</strong> - Native å±‚è°ƒè¯•</li>
</ul></li>
<li><ul>
<li><strong>objection</strong> - Frida çš„äº¤äº’å¼å·¥å…·</li>
</ul></li>
<li><ul>
<li><strong>Burp Suite</strong> - ç½‘ç»œæŠ“åŒ…</li>
</ul></li>
<li><ul>
<li><strong>GDB</strong> - GNU è°ƒè¯•å™¨ ___ ## å‰ç½®æ¡ä»¶</li>
</ul></li>
</ul>
<h2 id="ç¡®è®¤æ¸…å•"># âœ… ç¡®è®¤æ¸…å•</h2>
<div class="sourceCode" id="cb39"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Frida æ­£å¸¸è¿è¡Œ</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Python ç¯å¢ƒ</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">--version</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ç›®æ ‡ App å·²å®‰è£…</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell pm list packages <span class="kw">|</span> <span class="fu">grep</span> <span class="op">&lt;</span>app_name<span class="op">&gt;</span></span></code></pre></div>
<h2 id="hook-vs-debug-vs-traceä½•æ—¶ç”¨ä»€ä¹ˆ"># ğŸ¤” Hook vs Debug vs
Traceï¼šä½•æ—¶ç”¨ä»€ä¹ˆï¼Ÿ</h2>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 25%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èå·¥å…·</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td>æƒ³çŸ¥é“æŸä¸ªå‡½æ•°çš„è¾“å…¥è¾“å‡º</td>
<td><strong>Frida Hook</strong></td>
<td>æœ€å¿«é€Ÿï¼Œä¸ä¸­æ–­ç¨‹åºæµ</td>
</tr>
<tr>
<td>æƒ³ç†è§£å¤æ‚ç®—æ³•çš„æ¯ä¸€æ­¥ç»†èŠ‚</td>
<td><strong>IDA/GDB è°ƒè¯•å™¨</strong></td>
<td>å¯ä»¥å•æ­¥æ‰§è¡Œï¼ŒæŸ¥çœ‹æ¯ä¸ªå˜é‡</td>
</tr>
<tr>
<td>æƒ³çŸ¥é“ç¨‹åºæ‰§è¡Œäº†å“ªäº›ä»£ç è·¯å¾„</td>
<td><strong>Stalker/Trace</strong></td>
<td>å…¨è‡ªåŠ¨è®°å½•ï¼Œæ— éœ€è®¾æ–­ç‚¹</td>
</tr>
<tr>
<td>æƒ³ç»•è¿‡æŸä¸ªæ£€æµ‹ï¼ˆå¦‚ SSL Pinningï¼‰</td>
<td><strong>Frida Hook</strong></td>
<td>ç›´æ¥æ›¿æ¢å‡½æ•°è¿”å›å€¼</td>
</tr>
<tr>
<td>æƒ³æ‰¾åˆ°æŸä¸ªå­—ç¬¦ä¸²æ˜¯åœ¨å“ªé‡Œç”Ÿæˆçš„</td>
<td><strong>å†…å­˜æ–­ç‚¹ + è°ƒè¯•å™¨</strong></td>
<td>åœ¨å†™å…¥æ—¶ä¸­æ–­</td>
</tr>
<tr>
<td>æƒ³åˆ†æåè°ƒè¯•æœºåˆ¶</td>
<td><strong>Frida + è°ƒè¯•å™¨ç»„åˆ</strong></td>
<td>å…ˆç”¨ Frida ç¦ç”¨ï¼Œå†ç”¨è°ƒè¯•å™¨åˆ†æ</td>
</tr>
</tbody>
</table>
<p>*ç»éªŒæ³•åˆ™*ï¼š</p>
<ul>
<li>èƒ½ç”¨ Hook è§£å†³çš„ï¼Œåˆ«ç”¨è°ƒè¯•å™¨ï¼ˆæ•ˆç‡é—®é¢˜ï¼‰</li>
<li>éœ€è¦ç†è§£é€»è¾‘çš„ï¼Œå¿…é¡»ç”¨è°ƒè¯•å™¨ï¼ˆæ·±åº¦é—®é¢˜ï¼‰</li>
<li>éœ€è¦å…¨å±€è§†é‡çš„ï¼Œç”¨è¿½è¸ªï¼ˆè¦†ç›–ç‡é—®é¢˜ï¼‰ ___ ## è§£å†³æ–¹æ¡ˆ</li>
</ul>
<h2 id="ç¬¬-1-æ­¥éªŒè¯é™æ€åˆ†æç»“æœ15-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šéªŒè¯é™æ€åˆ†æç»“æœï¼ˆ15
åˆ†é’Ÿï¼‰</h2>
<p>å‡è®¾é™æ€åˆ†æå‘ç°äº†ç­¾åå‡½æ•°ï¼š<code>SignUtils.generateSign()</code></p>
<h2 id="hook-å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º"># # 1.1 Hook å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º</h2>
<p>*åŸºç¡€ Hook è„šæœ¬* <code>verify_sign.js</code>ï¼š</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Start Hook SignUtils.generateSign&quot;</span>)<span class="op">;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SignUtils <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;com.example.SignUtils&quot;</span>)<span class="op">;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>SignUtils<span class="op">.</span><span class="at">generateSign</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (params) {</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">[*] generateSign is called!&quot;</span>)<span class="op">;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; InputParameter:&quot;</span>)<span class="op">;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Print HashMap</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> iterator <span class="op">=</span> params<span class="op">.</span><span class="fu">entrySet</span>()<span class="op">.</span><span class="fu">iterator</span>()<span class="op">;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (iterator<span class="op">.</span><span class="fu">hasNext</span>()) {</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> entry <span class="op">=</span> iterator<span class="op">.</span><span class="fu">next</span>()<span class="op">;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; &quot;</span> <span class="op">+</span> entry<span class="op">.</span><span class="fu">getKey</span>() <span class="op">+</span> <span class="st">&quot; = &quot;</span> <span class="op">+</span> entry<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Call original function</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">generateSign</span>(params)<span class="op">;</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; ReturnValue: &quot;</span> <span class="op">+</span> result)<span class="op">;</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Hook install completed&quot;</span>)<span class="op">;</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>user = test123 timestamp = 1701234567 action = login ReturnValue:
a1b2c3d4e5f6g7h8i9j0</p>
<pre><code>
## # # 2.1 åˆ—å‡ºæ‰€æœ‰é‡è½½

```javascript
Java.perform(function () {
var CryptoUtil = Java.use(&quot;com.example.CryptoUtil&quot;);

// List all encryption methods
console.log(&quot;[*] encrypt Method overloads:&quot;);
CryptoUtil.encrypt.overloads.forEach(function (overload) {
console.log(&quot; &quot; + overload);
});
});
</code></pre>
<p>encrypt([B)</p>
<pre><code>
// This is the second overloaded version
CryptoUtil.encrypt.overload(
&quot;java.lang.String&quot;,
&quot;java.lang.String&quot;
).implementation = function (data, key) {
console.log(&quot;[*] encrypt(String, String) is called&quot;);
console.log(&quot; Data:&quot;, data);
console.log(&quot; Key:&quot;, key);

var result = this.encrypt(data, key);
console.log(&quot; Result:&quot;, result);

return result;
};

// This is the third overloaded version
CryptoUtil.encrypt.overload(&quot;[B&quot;).implementation = function (bytes) {
console.log(&quot;[*] encrypt(byte[]) is called&quot;);
console.log(&quot; BytesLength:&quot;, bytes.length);

var result = this.encrypt(bytes);
console.log(&quot; ResultLength:&quot;, result.length);

return result;
};
});
</code></pre>
<p>*æ–¹æ³• 1ï¼šåˆ›å»ºæ–°å®ä¾‹*</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CryptoUtil <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;com.example.CryptoUtil&quot;</span>)<span class="op">;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Constructor accessible</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> instance <span class="op">=</span> CryptoUtil<span class="op">.</span><span class="fu">$new</span>()<span class="op">;</span> <span class="co">// Call no-arg constructor</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> result <span class="op">=</span> instance<span class="op">.</span><span class="fu">encrypt</span>(<span class="st">&quot;Hello World&quot;</span><span class="op">,</span> <span class="st">&quot;mykey&quot;</span>)<span class="op">;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] MainCallResult:&quot;</span><span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] No way to create instance:&quot;</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Java.choose(â€œcom.example.CryptoUtilâ€, { onMatch: function (instance)
{ console.log(â€œ[+] Instance:â€, instance);</p>
<p>// Actively call var encrypted = instance.encrypt(â€œtest dataâ€);
console.log(â€œ[*] EncryptResult:â€, encrypted);</p>
<p>var decrypted = instance.decrypt(encrypted); console.log(â€œ[*]
DecryptResult:â€, decrypted); }, onComplete: function () {
console.log(â€œ[*] Search completedâ€); },</p>
<p>}); });</p>
<pre><code>var HashMap = Java.use(&quot;java.util.HashMap&quot;);

// CreateParameter
var params = HashMap.$new();
params.put(&quot;user&quot;, &quot;testuser&quot;);
params.put(&quot;timestamp&quot;, String(Date.now()));

// Actively call static method
var sign = SignUtils.generateSign(params);
console.log(&quot;[*] GenerateSignature:&quot;, sign);
});
</code></pre>
<div class="sourceCode" id="cb45"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> RootDetector <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;com.example.security.RootDetector&quot;</span>)<span class="op">;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>RootDetector<span class="op">.</span><span class="at">isRooted</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> () {</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Root Detection is Bypassed&quot;</span>)<span class="op">;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">false</span><span class="op">;</span> <span class="co">// Force return false (not rooted)</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>RootDetector<span class="op">.</span><span class="at">isXposedInstalled</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> () {</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Xposed Detection is Bypassed&quot;</span>)<span class="op">;</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>// Hook OkHttp 3 try { var CertificatePinner =
Java.use(â€œokhttp3.CertificatePinnerâ€); CertificatePinner.check.overload(
â€œjava.lang.Stringâ€, â€œjava.util.Listâ€ ).implementation = function
(hostname, peerCertificates) { console.log(â€œ[*] Bypass OkHttp3 SSL
Pinning:â€, hostname); return; // Return directly, skip validation };
console.log(â€œ[+] OkHttp3 SSL Pinning å·² Bypassâ€); } catch (e) {}</p>
<p>// Hook TrustManager try { var X509TrustManager =
Java.use(â€œjavax.net.ssl.X509TrustManagerâ€); var SSLContext =
Java.use(â€œjavax.net.ssl.SSLContextâ€);</p>
<p>var TrustManager = Java.registerClass({ name:
â€œcom.example.TrustManagerâ€, implements: [X509TrustManager], methods: {
checkClientTrusted: function (chain, authType) {}, checkServerTrusted:
function (chain, authType) {}, getAcceptedIssuers: function () { return
[]; }, }, });</p>
<p>var TrustManagers = [TrustManager.$new()]; var SSLContext_init =
SSLContext.init.overload( â€œ[Ljavax.net.ssl.KeyManager;â€,
â€œ[Ljavax.net.ssl.TrustManager;â€, â€œjava.security.SecureRandomâ€ );
SSLContext_init.implementation = function ( keyManager, trustManager,
secureRandom ) { console.log(â€œ[*] æ›¿æ¢ TrustManagerâ€);
SSLContext_init.call(this, keyManager, TrustManagers, secureRandom); };
console.log(â€œ[+] TrustManager å·²Bypassâ€);</p>
<p>} catch (e) {}</p>
<p>console.log(â€œ[*] SSL Pinning BypassConfig å®Œæˆâ€); });</p>
<pre><code>
## # # 5.1 å®šä¹‰ RPC å‡½æ•°

* *rpc_example.js**ï¼š

```javascript
rpc.exports = {
// ExportFunctionï¼šGenerateSignature
generateSign: function (params) {
var result = null;

Java.perform(function () {
var SignUtils = Java.use(&quot;com.example.SignUtils&quot;);
var HashMap = Java.use(&quot;java.util.HashMap&quot;);

var map = HashMap.$new();
for (var key in params) {
map.put(key, params[key]);
}

result = SignUtils.generateSign(map);
});

return result;
},

// ExportFunctionï¼šEncryptData
encrypt: function (plaintext, key) {
var result = null;

Java.perform(function () {
var CryptoUtil = Java.use(&quot;com.example.CryptoUtil&quot;);
result = CryptoUtil.encrypt(plaintext, key);
});

return result;
},
};
</code></pre>
<p>import frida import sys</p>
<p>def on_message(message, data): print(fâ€[*] Message: {message}â€œ)</p>
<h1 id="connect-to-to-to-to-to-to-to-device">Connect to to to to to to
to device</h1>
<p>device = frida.get_usb_device()</p>
<h1 id="attach-to-process">Attach to process</h1>
<p>pid = device.spawn([â€˜com.example.appâ€™]) session =
device.attach(pid)</p>
<h1 id="loadscript">LoadScript</h1>
<p>with open(â€˜rpc_example.jsâ€™, â€˜râ€™) as f: script =
session.create_script(f.read())</p>
<p>script.on(â€˜messageâ€™, on_message) script.load()</p>
<p>device.resume(pid)</p>
<h1 id="wait-forscriptinitialize">Wait forScriptInitialize</h1>
<p>import time time.sleep(2)</p>
<h1 id="call-rpc-function">Call RPC Function</h1>
<p>params = { â€˜userâ€™: â€˜testuserâ€™, â€˜timestampâ€™: â€˜1701234567â€™, â€˜actionâ€™:
â€˜loginâ€™ }</p>
<p>sign = script.exports_sync.generate_sign(params) print(fâ€[+]
GenerateSignature: {sign}â€œ)</p>
<p>encrypted = script.exports_sync.encrypt(â€˜Hello Worldâ€™, â€˜mykeyâ€™)
print(fâ€[+] EncryptResult: {encrypted}â€œ)</p>
<h1 id="ä¿æŒè¿è¡Œ">ä¿æŒè¿è¡Œ</h1>
<p>sys.stdin.read()</p>
<pre><code>
## # # 6.1 IDA Pro è¿œç¨‹è°ƒè¯• Native ä»£ç 

\*å‡†å¤‡\*ï¼š

```bash
# 1. æ¨é€ android_server åˆ°è®¾å¤‡
adb push android_server64 /data/local/tmp/
adb shell chmod 755 /data/local/tmp/android_server64

# 2. ä»¥ æ ¹ æƒé™Run
adb shell su -c &quot;/data/local/tmp/android_server64&quot;

# 3. Portè½¬å‘
adb forward tcp:23946 tcp:23946
</code></pre>
<ul>
<li>Port: 23946</li>
<li>Hostname: localhost</li>
<li>Port: 23946</li>
</ul>
<ol start="3" type="1">
<li><strong>Debugger â†’ Attach to Process</strong> â†’ é€‰æ‹©ç›®æ ‡ App</li>
<li>åœ¨ç›®æ ‡å‡½æ•°å¤„è®¾ç½®æ–­ç‚¹ï¼ˆF2ï¼‰</li>
<li>è§¦å‘ App ä¸­çš„æ“ä½œï¼Œæ–­ç‚¹å‘½ä¸­</li>
</ol>
<h2 id="ä½¿ç”¨-gdb-è°ƒè¯•"># # 6.2 ä½¿ç”¨ GDB è°ƒè¯•</h2>
<div class="sourceCode" id="cb48"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach to process</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="op">&lt;</span>app_name<span class="op">&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># æ‰¾åˆ° PIDï¼Œå¦‚ 12345</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="ex">gdbserver</span> :5039 <span class="at">--attach</span> 12345</span></code></pre></div>
<p>arm-linux-androideabi-gdb</p>
<h1 id="gdb-in">gdb In</h1>
<p>(gdb) target remote :5039 (gdb) continue</p>
<pre><code>| --------- | --------------------------- |
| `F2` | è®¾ç½®/å–æ¶ˆæ–­ç‚¹ |
| `F9` | è¿è¡Œ/ç»§ç»­ |
| `F7` | å•æ­¥è¿›å…¥ï¼ˆStep Intoï¼‰ |
| `F8` | å•æ­¥è·³è¿‡ï¼ˆStep Overï¼‰ |
| `Ctrl+F7` | æ‰§è¡Œåˆ°è¿”å›ï¼ˆRun to Returnï¼‰ |
___
## # ç¬¬ 7 æ­¥ï¼šä½¿ç”¨ Stalker è¿½è¸ªä»£ç è¦†ç›–ç‡ï¼ˆ15 åˆ†é’Ÿï¼‰

Frida Stalker å¯ä»¥è®°å½•çº¿ç¨‹æ‰§è¡Œçš„æ‰€æœ‰æŒ‡ä»¤ã€‚

## # # 7.1 åŸºç¡€ Stalker ç¤ºä¾‹

```javascript
// Stalker trace function execution
Interceptor.attach(
Module.findExportByName(&quot;libnative.so&quot;, &quot;Java_com_example_Native_encrypt&quot;),
{
onEnter: function (args) {
console.log(&quot;[*] Startè¿½è¸ª...&quot;);

Stalker.follow(Process.getCurrentThreadId(), {
events: {
call: true, // RecordFunctionCall
ret: false,
exec: false,
},
onReceive: function (events) {
console.log(&quot;[*] æ•è·åˆ°&quot;, events.length, &quot;äº‹ä»¶&quot;);

// Parse events
var calls = Stalker.parse(events, {
annotate: true,
stringify: false,
});

calls.forEach(function (call) {
console.log(&quot; Call:&quot;, call);
});
},
});
},
onLeave: function (retval) {
Stalker.unfollow(Process.getCurrentThreadId());
Stalker.flush();
console.log(&quot;[*] è¿½è¸ªEnd&quot;);
},
}
);
</code></pre>
<p>var base = Module.findBaseAddress(â€œlibnative.soâ€); var size =
Process.findModuleByName(â€œlibnative.soâ€).size;</p>
<p>Stalker.follow(Process.getCurrentThreadId(), { transform: function
(iterator) { var instruction = iterator.next(); do { // Only record
instructions within libnative.so if ( instruction.address.compare(base)
&gt;= 0 &amp;&amp; instruction.address.compare(base.add(size)) &lt; 0 )
{ iterator.keep(); } instruction = iterator.next(); } while (instruction
!== null); }, });</p>
<pre><code>
â”‚ Frida Hook â”‚ å¿«é€Ÿè·å– I/O â”‚ ä¸ä¸­æ–­æµç¨‹ â”‚ åªçœ‹å•ç‚¹ â”‚
â”‚ â”‚ ä¿®æ”¹è¿”å›å€¼ â”‚ æ˜“äº Auto åŒ– â”‚ ä¸çŸ¥é“ç»†èŠ‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Debug å™¨ â”‚ ç†è§£ç®—æ³• Logic â”‚ å®Œå…¨ Control â”‚ Speed æ…¢ â”‚
â”‚ (IDA/GDB) â”‚ å•æ­¥è·Ÿè¸ª â”‚ çœ‹æ‰€æœ‰ Variable â”‚ NeedManualOp â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stalker â”‚ Code è¦†ç›–ç‡ â”‚ å…¨ Auto â”‚ Performance å¼€é”€å¤§ â”‚
â”‚ â”‚ è¿½è¸ª ExecutePath â”‚ No éœ€æ–­ç‚¹ â”‚ Output é‡å·¨å¤§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>â†“ â†“ Send RPC Request Execute Java.perform() â†“ â†“ Etcå¾…Result Call App
Function â†“ â†“ ReceiveReturnValue ReturnResult â†“ â†“ ProcessData å®Œæˆ</p>
<pre><code>
\*æ£€æŸ¥æ¸…å•\*ï¼š

1. **ç¡®è®¤ç±»/æ–¹æ³•åæ­£ç¡®**

```javascript
// List all classes
Java.enumerateLoadedClasses({
onMatch: function (className) {
if (className.includes(&quot;SignUtils&quot;)) {
console.log(className);
}
},
onComplete: function () {},
});
</code></pre>
<ul>
<li><p>åœ¨ App ä¸­è§¦å‘ç›¸å…³æ“ä½œ</p></li>
<li><p>æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä»£ç è·¯å¾„</p></li>
<li><p>åœ¨ App ä¸­è§¦å‘ç›¸å…³æ“ä½œ</p></li>
<li><p>æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä»£ç è·¯å¾„</p></li>
</ul>
<ol start="3" type="1">
<li><strong>æ£€æŸ¥æ··æ·†</strong></li>
</ol>
<div class="sourceCode" id="cb52"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">// If class name is obfuscated as a.b.c, use obfuscated name</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SignUtils <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;a.b.c&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>*ç—‡çŠ¶*ï¼š<code>script.exports_sync.func()</code> ä¸€ç›´ç­‰å¾…</p>
<p>*è§£å†³*ï¼š</p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># UseAsyncCall</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_rpc_message(result, error):</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> error:</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;[-] Error: </span><span class="sc">{</span>error<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;[+] Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>script.exports.func(params, on_rpc_message)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># orå¢åŠ è¶…When</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> script.exports_sync.func(params, timeout<span class="op">=</span><span class="dv">10</span>)</span></code></pre></div>
<p>// App Code Socket socket = new Socket(â€œ127.0.0.1â€, 27042); // Frida
default port</p>
<pre><code>
* *ç»•è¿‡**ï¼šä¿®æ”¹ Frida Server ç«¯å£

```bash
frida-server -l 0.0.0.0:8888
</code></pre>
<ol start="2" type="1">
<li><strong>æ£€æŸ¥ maps æ–‡ä»¶</strong></li>
</ol>
<div class="sourceCode" id="cb55"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">BufferedReader</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="bu">BufferedReader</span><span class="op">(</span><span class="kw">new</span> <span class="bu">FileReader</span><span class="op">(</span><span class="st">&quot;/proc/self/maps&quot;</span><span class="op">));</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>line<span class="op">.</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;frida&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">System</span><span class="op">.</span><span class="fu">exit</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># strongR-frida</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/hluwa/strongR-frida-android/releases/download/xxx/frida-server</span></code></pre></div>
<h2 id="é—®é¢˜-4-è°ƒè¯•å™¨æ— æ³•é™„åŠ "># âŒ é—®é¢˜ 4: è°ƒè¯•å™¨æ— æ³•é™„åŠ </h2>
<p>*ç—‡çŠ¶*ï¼šIDA Pro æ˜¾ç¤º â€œCannot attach to processâ€</p>
<p>*è§£å†³*ï¼š</p>
<ol type="1">
<li><strong>æ£€æŸ¥ SELinux</strong></li>
</ol>
<div class="sourceCode" id="cb57"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell getenforce</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># IfIs Enforcing</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell setenforce 0</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell ps <span class="kw">|</span> <span class="fu">grep</span> <span class="op">&lt;</span>app_name<span class="op">&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ç¡®è®¤ PID æ­£ç¡®</span></span></code></pre></div>
<pre><code>```bash</code></pre>
<p>adb shell su echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope</p>
<pre><code>
\*ç—‡çŠ¶\*ï¼šå¯ç”¨ Stalker å App å¡æ­»

\*ä¼˜åŒ–\*ï¼š

1. **åªè¿½è¸ªå…³é”®æ¨¡å—**ï¼ˆè§ç¬¬ 7.2 æ­¥ï¼‰

2. **å‡å°‘äº‹ä»¶ç±»å‹**

```javascript
events: {
call: true, // Only record function calls
ret: false, // Don&#39;t record returns
exec: false // Don&#39;t record every instruction
}
</code></pre>
<pre><code>```javascript</code></pre>
<p>transform: function(iterator) { // Skip code we donâ€™t care about
}</p>
<pre><code>
## å»¶ä¼¸é˜…è¯»

## # ç›¸å…³é…æ–¹

- **[é™æ€åˆ†ææ·±å…¥](./static_analysis_deep_dive.md)** - å…ˆé™æ€æ‰¾åˆ°ç›®æ ‡
- **[Frida å¸¸ç”¨è„šæœ¬](../Scripts/frida_common_scripts.md)** - Hook è„šæœ¬æ¨¡æ¿
- **[Frida åè°ƒè¯•](../Anti-Detection/frida_anti_debugging.md)** - ç»•è¿‡æ£€æµ‹
- **[SSL Pinning ç»•è¿‡](../Network/network_sniffing.md#ç»•è¿‡-ssl-pinning)** - æŠ“åŒ…å¿…å¤‡

## # å·¥å…·æ·±å…¥

- **[Frida å®Œæ•´æŒ‡å—](../../02-Tools/Dynamic/frida_guide.md)**
- **[IDA Pro è°ƒè¯•](../../02-Tools/Static/ida_pro_guide.md#è¿œç¨‹è°ƒè¯•)**
- **[objection ä½¿ç”¨](../../02-Tools/Dynamic/)** - TODO

## # åœ¨çº¿èµ„æº

- **Frida å®˜æ–¹æ–‡æ¡£** - https://frida.re/docs/
- **Frida Codeshare** - https://codeshare.frida.re/ (è„šæœ¬åˆ†äº«)
- **Frida Handbook** - https://learnfrida.info/

## # ç†è®ºåŸºç¡€

- **[ARM æ±‡ç¼–](../../04-Reference/Foundations/arm_assembly.md)** - ç†è§£ Native è°ƒè¯•
- **[ART è¿è¡Œæ—¶](../../04-Reference/Foundations/art_runtime.md)** - ç†è§£ Java Hook
___
## å¿«é€Ÿå‚è€ƒ

## # Frida Hook æ¨¡æ¿

\*Hook Java æ–¹æ³•\*ï¼š

```javascript
Java.perform(function () {
var ClassName = Java.use(&quot;com.example.ClassName&quot;);

ClassName.methodName.implementation = function (arg1, arg2) {
console.log(&quot;[*] methodName called&quot;);
console.log(&quot; arg1:&quot;, arg1);
console.log(&quot; arg2:&quot;, arg2);

var result = this.methodName(arg1, arg2);
console.log(&quot; result:&quot;, result);

return result;
};
});
</code></pre>
<p>onEnter: function (args) { console.log(â€œ[*] native_func calledâ€);
console.log(â€ arg0:â€œ, args[0]); console.log(â€ arg1:â€œ, args[1]); },
onLeave: function (retval) { console.log(â€ retval:â€œ, retval); }, });</p>
<pre><code>var result = null;
Java.perform(function () {
var Class = Java.use(className);
result = Class[methodName].apply(Class, args);
});
return result;
},
};
</code></pre>
<p>F8 - å•æ­¥è·³è¿‡ Ctrl+F7 - Execute åˆ° Return</p>
<pre><code>next - å•æ­¥è·³è¿‡
finish - Executeåˆ°Return
info registers - Viewå¯„å­˜å™¨
x/10x $sp - Viewæ ˆå†…å®¹
</code></pre>
<pre><code></code></pre>
<!-- 01-Recipes/Analysis/js_obfuscator.md -->
<h1 id="javascript-obfuscator-obæ··æ·†-åˆ†æ">JavaScript Obfuscator
(OBæ··æ·†) åˆ†æ</h1>
<p><code>javascript-obfuscator</code>
æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œå’Œå¼ºå¤§çš„å¼€æºå·¥å…·ï¼Œç”¨äºæ··æ·†å’Œä¿æŠ¤ JavaScript
ä»£ç ã€‚å®ƒçš„æ··æ·†äº§ç‰©é€šå¸¸è¢«ç§°ä¸ºâ€OBæ··æ·†â€ã€‚OBæ··æ·†é€šè¿‡å¤šç§æ‰‹æ®µçš„ç»„åˆï¼Œä½¿å¾—ä»£ç éš¾ä»¥é˜…è¯»ã€ç†è§£å’Œè°ƒè¯•ã€‚</p>
<h2 id="æ ¸å¿ƒæ··æ·†æŠ€æœ¯">æ ¸å¿ƒæ··æ·†æŠ€æœ¯</h2>
<p>OBæ··æ·†ä¸»è¦ä¾èµ–äºä»¥ä¸‹å‡ ç§å…³é”®æŠ€æœ¯ï¼š</p>
<h3 id="å­—ç¬¦ä¸²æ··æ·†-string-concealing">1. å­—ç¬¦ä¸²æ··æ·† (String
Concealing)</h3>
<ul>
<li><p><strong>å­—ç¬¦ä¸²æ•°ç»„</strong>ï¼šå°†ä»£ç ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼ˆç‰¹åˆ«æ˜¯æ•æ„Ÿä¿¡æ¯ï¼‰æå–å‡ºæ¥ï¼Œæ”¾å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå·¨å¤§çš„æ•°ç»„ä¸­ã€‚</p></li>
<li><p><strong>ç¼–ç ä¸åŠ å¯†</strong>ï¼šè¿™äº›å­—ç¬¦ä¸²é€šå¸¸ä¼šä½¿ç”¨ Base64ã€RC4
æˆ–å…¶ä»–è‡ªå®šä¹‰ç®—æ³•è¿›è¡Œç¼–ç æˆ–åŠ å¯†ã€‚</p></li>
<li><p><strong>è§£ç å‡½æ•°</strong>ï¼šæä¾›ä¸€ä¸ªæˆ–å¤šä¸ªè§£ç å‡½æ•°ã€‚åœ¨ä»£ç æ‰§è¡Œæ—¶ï¼Œé€šè¿‡è°ƒç”¨
<code>decoder("0x1")</code> è¿™æ ·çš„å½¢å¼æ¥è·å–åŸå§‹å­—ç¬¦ä¸²ã€‚</p></li>
<li><p><strong>æ•°ç»„ä¹±åºä¸è‡ªæ„ˆ</strong>ï¼šä¸ºäº†é˜²æ­¢é™æ€åˆ†æï¼Œå­—ç¬¦ä¸²æ•°ç»„çš„é¡ºåºä¼šåœ¨è„šæœ¬æ‰§è¡ŒåˆæœŸè¢«åŠ¨æ€æ‰“ä¹±ï¼Œè§£ç å‡½æ•°ä¹Ÿä¼šéšä¹‹è°ƒæ•´ï¼Œå¢åŠ äº†é™æ€è¿˜åŸçš„éš¾åº¦ã€‚</p></li>
</ul>
<h3 id="æ§åˆ¶æµå¹³å¦åŒ–-control-flow-flattening">2. æ§åˆ¶æµå¹³å¦åŒ– (Control
Flow Flattening)</h3>
<p>è¿™æ˜¯ OB æ··æ·†æœ€æ ¸å¿ƒã€æœ€å¤æ‚çš„ç‰¹å¾ä¹‹ä¸€ã€‚</p>
<ul>
<li><p><strong>çŠ¶æ€æœºè½¬æ¢</strong>ï¼šå°†åŸå§‹ä»£ç å—ï¼ˆå¦‚å‡½æ•°ä½“å†…çš„è¯­å¥ï¼‰åˆ†å‰²æˆå¤šä¸ªå°çš„ä»£ç ç‰‡æ®µï¼Œå¹¶æ”¾å…¥ä¸€ä¸ªå·¨å¤§çš„
<code>while</code> å¾ªç¯ä¸­çš„ <code>switch</code> ç»“æ„é‡Œã€‚</p></li>
<li><p><strong>çŠ¶æ€å˜é‡</strong>ï¼šç”¨ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰æ¥æ§åˆ¶
<code>switch</code> çš„æ‰§è¡Œé¡ºåºã€‚æ¯ä¸ª <code>case</code>
æ‰§è¡Œå®Œæ¯•åï¼Œä¼šæ›´æ–°çŠ¶æ€å˜é‡ï¼Œå†³å®šä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„
<code>case</code>ã€‚</p></li>
<li><p><strong>é€»è¾‘æ‰“æ–­</strong>ï¼šåŸå§‹çº¿æ€§çš„ä»£ç é€»è¾‘è¢«å®Œå…¨æ‰“ä¹±ï¼Œå˜æˆäº†åœ¨ä¸€ä¸ªå·¨å¤§çš„å¾ªç¯ä¸­æ— åºè·³è½¬ï¼Œä½¿å¾—äººå·¥è·Ÿè¸ªå˜å¾—æå…¶å›°éš¾ã€‚</p></li>
</ul>
<h3 id="ä»£ç è½¬æ¢ä¸ç¼–ç -code-transformation">3. ä»£ç è½¬æ¢ä¸ç¼–ç  (Code
Transformation)</h3>
<ul>
<li><p><strong>å˜é‡åæ··æ·† (Identifier
Mangling)</strong>ï¼šå°†æœ‰æ„ä¹‰çš„å˜é‡åã€å‡½æ•°åå’Œå±æ€§åæ›¿æ¢æˆæ— æ„ä¹‰çš„çŸ­å­—ç¬¦ï¼Œå¦‚
<code>_0xabc123</code>ã€‚</p></li>
<li><p><strong>æ•°å­—å¸¸é‡æ›¿æ¢</strong>ï¼šå°†ä»£ç ä¸­çš„æ•°å­—å¸¸é‡ï¼ˆå¦‚
<code>123</code>ï¼‰æ›¿æ¢æˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼ˆå¦‚
<code>0x7b</code>ï¼‰ï¼Œæˆ–è€…æ›´å¤æ‚çš„è¡¨è¾¾å¼ï¼Œå¢åŠ é˜…è¯»éš¾åº¦ã€‚</p></li>
<li><p><strong>ä»£ç†å‡½æ•° (Proxy Functions)</strong>ï¼šå°†ç®€å•çš„äºŒå…ƒè¿ç®—ï¼ˆå¦‚
<code>a + b</code>ï¼‰æˆ–å¯¹è±¡å±æ€§è®¿é—®ï¼ˆ<code>obj.prop</code>ï¼‰æ›¿æ¢æˆå¯¹ä¸€ä¸ªä»£ç†å‡½æ•°çš„è°ƒç”¨ï¼Œä¾‹å¦‚
<code>add(a, b)</code>ã€‚è¿™ä½¿å¾—æ‰¹é‡æ›¿æ¢å’Œæ¨¡å¼è¯†åˆ«å˜å¾—æ›´åŠ å›°éš¾ã€‚</p></li>
<li><p><strong>æ­»ä»£ç æ³¨å…¥ (Dead Code
Injection)</strong>ï¼šåœ¨ä»£ç ä¸­æ’å…¥ä¸€äº›æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œçš„ã€ä½†çœ‹èµ·æ¥å¾ˆå¤æ‚çš„é€»è¾‘åˆ†æ”¯ï¼ˆé€šå¸¸ä¸ä¸é€æ˜è°“è¯ç»“åˆï¼‰ï¼Œç”¨æ¥è¿·æƒ‘åˆ†æè€…ã€‚</p></li>
</ul>
<h3 id="åè°ƒè¯•ä¸åæ ¼å¼åŒ–-anti-debugging">4. åè°ƒè¯•ä¸åæ ¼å¼åŒ–
(Anti-Debugging)</h3>
<ul>
<li><p><strong><code>debugger</code> è¯­å¥</strong>ï¼šåœ¨ä»£ç ä¸­æ’å…¥
<code>debugger;</code>
è¯­å¥ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå°†å…¶åŒ…è£¹åœ¨ä¸€ä¸ªæ— é™å¾ªç¯çš„å‡½æ•°ä¸­ã€‚å½“å¼€å‘è€…å·¥å…·æ‰“å¼€æ—¶ï¼Œç¨‹åºä¼šç«‹å³æš‚åœå¹¶é™·å…¥è¿™ä¸ªå¾ªç¯ï¼Œé˜»ç¢åŠ¨æ€è°ƒè¯•ã€‚</p></li>
<li><p><strong>å‡½æ•°é‡ç»‘å®š</strong>ï¼šé€šè¿‡
<code>Function.prototype.constructor</code> æˆ– <code>eval</code>
æ¥æ‰§è¡Œä»£ç ï¼Œä½¿å¾—å¸¸è§„çš„æ–­ç‚¹éš¾ä»¥å‘½ä¸­ã€‚</p></li>
<li><p><strong>åæ ¼å¼åŒ–</strong>ï¼šæ£€æµ‹ä»£ç æ˜¯å¦è¢«ç¾åŒ–æˆ–æ ¼å¼åŒ–ï¼Œå¦‚æœå‘ç°ï¼Œåˆ™å¯èƒ½è¿›å…¥æ­»å¾ªç¯æˆ–æ‰§è¡Œé”™è¯¯é€»è¾‘ã€‚</p></li>
</ul>
<h2 id="åˆ†æä¸åæ··æ·†ç­–ç•¥">åˆ†æä¸åæ··æ·†ç­–ç•¥</h2>
<p>åæ··æ·† OB ä»£ç é€šå¸¸æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§çš„å·¥ç¨‹ï¼Œéœ€è¦å¤šç§å·¥å…·å’ŒæŠ€æœ¯ç»“åˆã€‚</p>
<h3 id="å­—ç¬¦ä¸²è§£å¯†ä¸æ›¿æ¢">1. å­—ç¬¦ä¸²è§£å¯†ä¸æ›¿æ¢</h3>
<ul>
<li><p><strong>å®šä½è§£ç å‡½æ•°</strong>ï¼šæ‰¾åˆ°è´Ÿè´£ä»å­—ç¬¦ä¸²æ•°ç»„ä¸­å–å€¼å¹¶è§£å¯†çš„å‡½æ•°ã€‚</p></li>
<li><p><strong>æ‰§è¡Œè§£ç é€»è¾‘</strong>ï¼š</p></li>
<li><p><strong>åŠ¨æ€æ‰§è¡Œ</strong>ï¼šåœ¨ Node.js
æˆ–æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨è§£ç å‡½æ•°ï¼Œå°†æ‰€æœ‰åŠ å¯†çš„å­—ç¬¦ä¸²é¢„å…ˆè§£å¯†å‡ºæ¥ã€‚</p></li>
<li><p><strong>é™æ€åˆ†æ</strong>ï¼šå¦‚æœè§£ç ç®—æ³•ï¼ˆå¦‚
RC4ï¼‰æ¯”è¾ƒæ ‡å‡†ï¼Œå¯ä»¥ç¼–å†™è„šæœ¬é™æ€åœ°è§£å¯†æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</p></li>
<li><p><strong>æ‰¹é‡æ›¿æ¢</strong>ï¼šç¼–å†™è„šæœ¬ï¼ˆé€šå¸¸åŸºäº
ASTï¼‰ï¼Œå°†ä»£ç ä¸­æ‰€æœ‰å¯¹è§£ç å‡½æ•°çš„è°ƒç”¨ <code>decoder("0x1")</code>
æ›¿æ¢æˆå…¶è¿”å›çš„åŸå§‹å­—ç¬¦ä¸² <code>"original_string"</code>ã€‚</p></li>
</ul>
<h3 id="æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ">2. æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>
<p>è¿™æ˜¯æœ€å›°éš¾çš„ä¸€æ­¥ï¼Œä½†ä¹Ÿæ˜¯æœ€æœ‰ä»·å€¼çš„ä¸€æ­¥ã€‚</p>
<ul>
<li><p><strong>AST åˆ†æ</strong>ï¼šä½¿ç”¨ Babel ç­‰å·¥å…·å°†ä»£ç è§£ææˆ
ASTã€‚</p></li>
<li><p><strong>å®šä½ä¸»å¾ªç¯</strong>ï¼šæ‰¾åˆ°åŒ…å« <code>while(true)</code> å’Œ
<code>switch</code> çš„å·¨å¤§å¾ªç¯ä½“ã€‚</p></li>
<li><p><strong>è¯†åˆ«çŠ¶æ€å˜é‡</strong>ï¼šæ‰¾åˆ°æ§åˆ¶ <code>switch</code>
è·³è½¬çš„çŠ¶æ€å˜é‡å’Œå®ƒçš„åˆå§‹å€¼ã€‚</p></li>
<li><p><strong>é‡æ’ä»£ç å—</strong>ï¼š</p></li>
</ul>
<ol type="1">
<li>æå– <code>switch</code> çš„ <code>case</code>
æ•°ç»„å’ŒçŠ¶æ€å˜é‡çš„åˆå§‹è·³è½¬é¡ºåºã€‚</li>
<li>æ ¹æ®è¿™ä¸ªé¡ºåºï¼Œå°†æ¯ä¸ª <code>case</code>
å—ä¸­çš„ä»£ç æŒ‰æ­£ç¡®çš„é€»è¾‘é‡æ–°æ’åˆ—ã€‚</li>
<li>ç§»é™¤ <code>while</code> å’Œ <code>switch</code>
ç»“æ„ï¼Œç”Ÿæˆçº¿æ€§çš„ã€å¯è¯»çš„ä»£ç ã€‚</li>
</ol>
<ul>
<li><strong>è‡ªåŠ¨åŒ–å·¥å…·</strong>ï¼šç¤¾åŒºä¸­æœ‰ä¸€äº›å°è¯•è‡ªåŠ¨åŒ–è¿˜åŸæ§åˆ¶æµçš„å·¥å…·ï¼Œä½†ç”±äº
OB æ··æ·†å˜ç§ç¹å¤šï¼Œé€šç”¨æ€§æœ‰é™ã€‚</li>
</ul>
<h3 id="å…¶ä»–å‡€åŒ–æ“ä½œ">3. å…¶ä»–å‡€åŒ–æ“ä½œ</h3>
<ul>
<li><p><strong>å¸¸é‡è¡¨è¾¾å¼è®¡ç®—</strong>ï¼šå°† <code>0x7b</code>
è¿™æ ·çš„è¡¨è¾¾å¼ç›´æ¥è®¡ç®—æˆ <code>123</code>ã€‚</p></li>
<li><p><strong>ä»£ç†å‡½æ•°å†…è”</strong>ï¼šå°†ä»£ç†å‡½æ•°çš„é€»è¾‘ç›´æ¥æ›¿æ¢å›åŸæ¥çš„ä½ç½®ï¼Œä¾‹å¦‚å°†
<code>add(a, b)</code> è¿˜åŸæˆ <code>a + b</code>ã€‚</p></li>
<li><p><strong>æ­»ä»£ç ç§»é™¤</strong>ï¼šé€šè¿‡åˆ†ææ§åˆ¶æµï¼Œè¯†åˆ«å¹¶åˆ é™¤æ— æ³•è®¿é—®åˆ°çš„ä»£ç å—ã€‚</p></li>
</ul>
<h2 id="å¸¸ç”¨å·¥å…·">å¸¸ç”¨å·¥å…·</h2>
<ul>
<li><p><strong>Babel
(æ ¸å¿ƒ)</strong>ï¼šç”¨äºè§£æï¼ˆParseï¼‰ã€è½¬æ¢ï¼ˆTransformï¼‰å’Œç”Ÿæˆï¼ˆGenerateï¼‰JavaScript
ä»£ç ï¼Œæ˜¯ç¼–å†™åæ··æ·†è„šæœ¬çš„åŸºç¡€ã€‚</p></li>
<li><p><strong>AST Explorer</strong>ï¼šåœ¨çº¿æŸ¥çœ‹ AST
ç»“æ„ï¼Œä¾¿äºç¼–å†™è½¬æ¢é€»è¾‘ã€‚</p></li>
<li><p><strong>Node.js /
æµè§ˆå™¨æ§åˆ¶å°</strong>ï¼šç”¨äºåŠ¨æ€æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œç‰¹åˆ«æ˜¯è§£å¯†å‡½æ•°ã€‚</p></li>
<li><p><strong>de4js</strong>,
<strong>js-beautify</strong>ï¼šç”¨äºåŸºæœ¬çš„ä»£ç æ ¼å¼åŒ–å’Œä¸€äº›ç®€å•çš„åæ··æ·†ã€‚</p></li>
<li><p><strong>AST-Deobfuscator</strong>ï¼šä¸€äº›å¼€æºçš„ã€åŸºäº AST
çš„åæ··æ·†å·¥å…·æ¡†æ¶ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚</p></li>
</ul>
<!-- 01-Recipes/Analysis/js_vmp.md -->
<h1 id="javascript-vmp-é€†å‘å·¥ç¨‹">JavaScript VMP é€†å‘å·¥ç¨‹</h1>
<p>JavaScript VMPï¼ˆè™šæ‹Ÿæœºä¿æŠ¤ï¼‰æ˜¯ä¸€ç§é«˜çº§çš„ä»£ç ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†åŸå§‹çš„
JavaScript
ä»£ç è½¬æ¢æˆä¸€ç§è‡ªå®šä¹‰çš„ã€åŸºäºè™šæ‹Ÿæœºçš„å­—èŠ‚ç ã€‚ç„¶åï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¸€ä¸ªå†…ç½®çš„è§£é‡Šå™¨ï¼ˆæˆ–è™šæ‹Ÿæœºï¼‰ä¼šæ‰§è¡Œè¿™äº›å­—èŠ‚ç ã€‚è¿™ç§æ–¹å¼æå¤§åœ°å¢åŠ äº†é€†å‘å·¥ç¨‹çš„éš¾åº¦ï¼Œå› ä¸ºå®ƒéšè—äº†åŸå§‹çš„ä»£ç é€»è¾‘å’Œç»“æ„ã€‚</p>
<h2 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h2>
<p>JSVMP
çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡ä»¤é›†å’Œä¸€ä¸ªå¯¹åº”çš„è™šæ‹Ÿæœºæ¥æ‰§è¡Œå®ƒã€‚</p>
<ol type="1">
<li><strong>ä»£ç è½¬æ¢ï¼ˆç¼–è¯‘ï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li><p><strong>è¯æ³•åˆ†æä¸è§£æ</strong>ï¼šå°†åŸå§‹ JavaScript
ä»£ç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤ç”Ÿæˆ</strong>ï¼šéå†
ASTï¼Œå°†ä»£ç é€»è¾‘è½¬æ¢æˆè‡ªå®šä¹‰çš„å­—èŠ‚ç åºåˆ—ã€‚ä¾‹å¦‚ï¼Œ<code>a + b</code>
å¯èƒ½ä¼šè¢«è½¬æ¢æˆ <code>PUSH a; PUSH b; ADD</code>ã€‚</p></li>
<li><p><strong>è™šæ‹Ÿæœºæ³¨å…¥</strong>ï¼šå°†å®ç°äº†è§£é‡Šå™¨ã€æŒ‡ä»¤è°ƒåº¦å¾ªç¯å’Œæ“ä½œå‡½æ•°çš„è™šæ‹Ÿæœºï¼ˆé€šå¸¸ç”¨
JavaScript ç¼–å†™ï¼‰ä¸ç”Ÿæˆçš„å­—èŠ‚ç æ‰“åŒ…åœ¨ä¸€èµ·ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>è¿è¡Œæ—¶æ‰§è¡Œ</strong>ï¼š</li>
</ol>
<ul>
<li><p><strong>è™šæ‹Ÿæœºåˆå§‹åŒ–</strong>ï¼šè®¾ç½®è™šæ‹Ÿæœºçš„æ‰§è¡Œç¯å¢ƒï¼Œå¦‚å †æ ˆï¼ˆStackï¼‰ã€ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰å’Œä¸Šä¸‹æ–‡ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤å¾ªç¯ï¼ˆFetch-Decode-Executeï¼‰</strong>ï¼š</p></li>
<li><p><strong>Fetch</strong>ï¼šä»å­—èŠ‚ç æ•°ç»„ä¸­è·å–å½“å‰ PC
æŒ‡å‘çš„æŒ‡ä»¤ã€‚</p></li>
<li><p><strong>Decode</strong>ï¼šè§£ææŒ‡ä»¤çš„æ“ä½œç å’Œæ“ä½œæ•°ã€‚</p></li>
<li><p><strong>Execute</strong>ï¼šæ‰§è¡ŒæŒ‡ä»¤å¯¹åº”çš„æ“ä½œï¼Œä¾‹å¦‚è¿›è¡Œæ•°å­¦è¿ç®—ã€æ“ä½œå †æ ˆã€è°ƒç”¨å‡½æ•°ç­‰ã€‚</p></li>
<li><p><strong>ç¨‹åºç»“æŸ</strong>ï¼šå½“æ‰§è¡Œå®Œæ‰€æœ‰å­—èŠ‚ç åï¼Œè™šæ‹Ÿæœºå°†ç»“æœè¿”å›æˆ–å®Œæˆæ“ä½œã€‚</p></li>
</ul>
<h2 id="å¸¸è§ç‰¹å¾">å¸¸è§ç‰¹å¾</h2>
<ul>
<li><p><strong>å·¨å¤§çš„ä»£ç ä½“ç§¯</strong>ï¼šä»£ç ä¸­é€šå¸¸åŒ…å«ä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼ˆå­—èŠ‚ç ï¼‰å’Œä¸€ä¸ªåºå¤§çš„
<code>switch</code> æˆ– <code>while</code>
å¾ªç¯ï¼ˆè™šæ‹Ÿæœºè§£é‡Šå™¨ï¼‰ã€‚</p></li>
<li><p><strong>æ§åˆ¶æµå¹³å¦åŒ–</strong>ï¼šåŸå§‹çš„ <code>if/else</code>,
<code>for</code>, <code>while</code>
ç»“æ„è¢«è½¬æ¢æˆç”±ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰æ§åˆ¶çš„è·³è½¬æŒ‡ä»¤ï¼Œä½¿å¾—ä»£ç é€»è¾‘éš¾ä»¥è·Ÿè¸ªã€‚</p></li>
<li><p><strong>ä¸é€æ˜è°“è¯</strong>ï¼šå¼•å…¥ä¸€äº›æ’ä¸ºçœŸæˆ–æ’ä¸ºå‡çš„å¤æ‚æ¡ä»¶åˆ¤æ–­ï¼Œå¢åŠ é™æ€åˆ†æçš„éš¾åº¦ã€‚</p></li>
<li><p><strong>è‡ªå®šä¹‰æ•°æ®ç»“æ„</strong>ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„å †æ ˆæ¥å­˜å‚¨å˜é‡å’Œä¸­é—´ç»“æœï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨
JavaScript çš„å˜é‡ã€‚</p></li>
</ul>
<h2 id="åˆ†æä¸è„±å£³ç­–ç•¥">åˆ†æä¸è„±å£³ç­–ç•¥</h2>
<p>é€†å‘ JSVMP æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œé€šå¸¸éœ€è¦ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æã€‚</p>
<h3 id="é™æ€åˆ†æç†è§£è™šæ‹Ÿæœº">1. é™æ€åˆ†æï¼šç†è§£è™šæ‹Ÿæœº</h3>
<ul>
<li><p><strong>å®šä½æ ¸å¿ƒç»„ä»¶</strong>ï¼š</p></li>
<li><p><strong>å­—èŠ‚ç æ•°ç»„</strong>ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªå·¨å¤§çš„ã€åŒ…å«æ•°å­—æˆ–çŸ­å­—ç¬¦ä¸²çš„æ•°ç»„ã€‚</p></li>
<li><p><strong>è™šæ‹Ÿæœºå…¥å£</strong>ï¼šå¯åŠ¨æ•´ä¸ªè§£é‡Šå™¨å¾ªç¯çš„å‡½æ•°ã€‚</p></li>
<li><p><strong>åˆ†å‘å™¨ï¼ˆDispatcherï¼‰</strong>ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªå¤§çš„
<code>switch</code> è¯­å¥æˆ– <code>while(true)</code>
å¾ªç¯ï¼Œæ ¹æ®æŒ‡ä»¤ç è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤å¤„ç†å™¨ï¼ˆHandlersï¼‰</strong>ï¼š<code>switch</code>
ä¸­çš„æ¯ä¸ª <code>case</code>
æˆ–è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå®ç°äº†å…·ä½“æŒ‡ä»¤çš„åŠŸèƒ½ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤é›†é‡å»º</strong>ï¼š</p></li>
<li><p>é€šè¿‡åˆ†ææ¯ä¸ª Handler
çš„åŠŸèƒ½ï¼Œé€æ­¥è¿˜åŸå‡ºæ¯ä¸ªå­—èŠ‚ç å¯¹åº”çš„å…·ä½“æ“ä½œï¼ˆå¦‚ <code>ADD</code>,
<code>SUB</code>, <code>JMP</code> ç­‰ï¼‰ã€‚</p></li>
<li><p>ä¸ºæ¯ä¸ªæ“ä½œç ï¼ˆOpcodeï¼‰æ·»åŠ æ³¨é‡Šï¼Œè®°å½•å…¶åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶ä½†è‡³å…³é‡è¦çš„æ­¥éª¤ã€‚</p></li>
</ul>
<h3 id="åŠ¨æ€åˆ†æè·Ÿè¸ªä¸è°ƒè¯•">2. åŠ¨æ€åˆ†æï¼šè·Ÿè¸ªä¸è°ƒè¯•</h3>
<ul>
<li><p><strong>Hook å…³é”®å‡½æ•°</strong>ï¼šä½¿ç”¨ Frida
æˆ–æµè§ˆå™¨å¼€å‘è€…å·¥å…·åœ¨å…³é”®ä½ç½®ï¼ˆå¦‚æŒ‡ä»¤å¤„ç†å™¨ï¼‰ä¸‹æ–­ç‚¹æˆ–æ’å…¥æ—¥å¿—ã€‚</p></li>
<li><p><strong>è·Ÿè¸ª PC
å’Œæ“ä½œæ•°</strong>ï¼šè®°å½•æ¯æ¬¡å¾ªç¯çš„ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰å’Œå½“å‰æŒ‡ä»¤çš„æ“ä½œæ•°ï¼Œå¯ä»¥å¾—åˆ°å®Œæ•´çš„æ‰§è¡Œè½¨è¿¹ï¼ˆTraceï¼‰ã€‚</p></li>
<li><p><strong>ç›‘æ§å †æ ˆå˜åŒ–</strong>ï¼šè§‚å¯Ÿè™šæ‹Ÿæœºè‡ªå®šä¹‰å †æ ˆçš„å‹å…¥ï¼ˆpushï¼‰å’Œå¼¹å‡ºï¼ˆpopï¼‰æ“ä½œï¼Œä»¥ç†è§£æ•°æ®æµã€‚</p></li>
<li><p><strong>AST è¾…åŠ©åˆ†æ</strong>ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚ Babelï¼‰å°† Handler
çš„ä»£ç è§£ææˆ
ASTï¼Œå¯ä»¥æ›´å¿«åœ°ç†è§£å…¶åŠŸèƒ½ï¼Œç”šè‡³è‡ªåŠ¨åŒ–åœ°è¯†åˆ«æŒ‡ä»¤æ¨¡å¼ã€‚</p></li>
</ul>
<h3 id="ä»£ç è¿˜åŸä¸é‡æ„">3. ä»£ç è¿˜åŸä¸é‡æ„</h3>
<ul>
<li><p><strong>ç¼–å†™åç¼–è¯‘å™¨</strong>ï¼šåŸºäºå·²ç»é‡å»ºçš„æŒ‡ä»¤é›†ï¼Œç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œå°†å­—èŠ‚ç åºåˆ—ç¿»è¯‘å›æ›´é«˜çº§ã€æ›´æ˜“è¯»çš„
JavaScript ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§æ­¥éª¤ï¼Œéœ€è¦å¯¹è™šæ‹Ÿæœºæœ‰å®Œæ•´çš„ç†è§£ã€‚</p></li>
<li><p><strong>æ‰‹åŠ¨é€»è¾‘é‡æ„</strong>ï¼šå¯¹äºä¸æ˜¯ç‰¹åˆ«å¤æ‚çš„
VMPï¼Œå¯ä»¥é€šè¿‡è·Ÿè¸ªæ‰§è¡Œæµç¨‹ï¼Œæ‰‹åŠ¨å°†å…³é”®é€»è¾‘ï¼ˆå¦‚åŠ å¯†ç®—æ³•ï¼‰ç”¨ç­‰æ•ˆçš„
JavaScript ä»£ç é‡å†™å‡ºæ¥ã€‚</p></li>
</ul>
<h2 id="å¸¸ç”¨å·¥å…·-1">å¸¸ç”¨å·¥å…·</h2>
<ul>
<li><p><strong>æµè§ˆå™¨å¼€å‘è€…å·¥å…·</strong>ï¼šç”¨äºä¸‹æ–­ç‚¹ã€å•æ­¥è°ƒè¯•å’Œè§‚å¯Ÿå˜é‡ã€‚</p></li>
<li><p><strong>Frida</strong>ï¼šç”¨äº Hook
å…³é”®å‡½æ•°ï¼Œå®ç°åŠ¨æ€è·Ÿè¸ªã€‚</p></li>
<li><p><strong>Babel</strong>ï¼šç”¨äºå°† JavaScript ä»£ç è§£ææˆ
ASTï¼Œè¾…åŠ©é™æ€åˆ†æã€‚</p></li>
<li><p><strong>AST
Explorer</strong>ï¼šä¸€ä¸ªåœ¨çº¿å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹ä»£ç å¯¹åº”çš„ AST
ç»“æ„ã€‚</p></li>
<li><p><strong>IDA Pro /
Ghidra</strong>ï¼šè™½ç„¶ä¸»è¦ç”¨äºåŸç”Ÿä»£ç ï¼Œä½†å®ƒä»¬å¼ºå¤§çš„åæ±‡ç¼–å’Œåç¼–è¯‘åŠŸèƒ½å¯ä»¥ä¸ºç†è§£å¤æ‚çš„
JavaScript è™šæ‹Ÿæœºé€»è¾‘æä¾›å€Ÿé‰´ã€‚</p></li>
</ul>
<!-- 01-Recipes/Analysis/native_string_obfuscation.md -->
<h1 id="native-å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘">Native å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘</h1>
<p>åœ¨ Android Native
å¼€å‘ï¼ˆC/C++ï¼‰ä¸­ï¼Œç›´æ¥å°†æ˜æ–‡å­—ç¬¦ä¸²ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚
IDA Proã€Ghidraï¼‰å¯ä»¥è½»æ˜“åœ°åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„
<code>.rodata</code>ï¼ˆåªè¯»æ•°æ®ï¼‰æ®µä¸­æ‰¾åˆ°è¿™äº›å­—ç¬¦ä¸²ï¼Œä»è€Œæ³„éœ² API
åœ°å€ã€åŠ å¯†å¯†é’¥ã€æ•æ„Ÿæ ¡éªŒé€»è¾‘ç­‰ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¼€å‘è€…é€šå¸¸ä¼šé‡‡ç”¨å„ç§å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯æ¥ä¿æŠ¤è¿™äº›æ•°æ®ã€‚</p>
<h2 id="å¸¸è§çš„-native-å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯">å¸¸è§çš„ Native å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯</h2>
<h3 id="æ ˆä¸ŠåŠ¨æ€æ„é€ -stack-based-construction">1. æ ˆä¸ŠåŠ¨æ€æ„é€ 
(Stack-based Construction)</h3>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹æ³•ã€‚å®ƒé¿å…åœ¨æ•°æ®æ®µä¸­ç•™ä¸‹å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åœ¨å‡½æ•°è¿è¡Œæ—¶ï¼Œé€ä¸ªå­—ç¬¦åœ°å°†å­—ç¬¦ä¸²æ„é€ åœ¨æ ˆä¸Šã€‚</p>
<p><strong>ç¤ºä¾‹ä»£ç :</strong></p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> get_secret_url<span class="op">()</span> <span class="op">{</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> url<span class="op">[</span><span class="dv">19</span><span class="op">];</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>url<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;h&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;t&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;t&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;p&#39;</span><span class="op">;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>url<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;s&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;:&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;/&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">7</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;/&#39;</span><span class="op">;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>url<span class="op">[</span><span class="dv">8</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;a&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;p&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;i&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">11</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;.&#39;</span><span class="op">;</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>url<span class="op">[</span><span class="dv">12</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;e&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">13</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;x&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">14</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;a&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">15</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;m&#39;</span><span class="op">;</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>url<span class="op">[</span><span class="dv">16</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;p&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">17</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;l&#39;</span><span class="op">;</span> url<span class="op">[</span><span class="dv">18</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;e&#39;</span><span class="op">;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>url<span class="op">[</span><span class="dv">19</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">;</span> <span class="co">// Null terminator</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co">// ... use url</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>ç¤ºä¾‹ä»£ç :</strong></p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> decrypt_string<span class="op">(</span><span class="dt">char</span><span class="op">*</span> encrypted<span class="op">)</span> <span class="op">{</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> key <span class="op">=</span> <span class="bn">0xAB</span><span class="op">;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> len <span class="op">=</span> strlen<span class="op">(</span>encrypted<span class="op">);</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>encrypted<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> encrypted<span class="op">[</span>i<span class="op">]</span> <span class="op">^</span> key<span class="op">;</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> encrypted<span class="op">;</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> use_secret<span class="op">()</span> <span class="op">{</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co">// &quot;secret_key&quot; Xored with 0xAB</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> encrypted_key<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="bn">0xCF</span><span class="op">,</span> <span class="bn">0xC4</span><span class="op">,</span> <span class="bn">0xC2</span><span class="op">,</span> <span class="bn">0xCD</span><span class="op">,</span> <span class="bn">0xC4</span><span class="op">,</span> <span class="bn">0xD1</span><span class="op">,</span> <span class="bn">0xDF</span><span class="op">,</span> <span class="bn">0xCB</span><span class="op">,</span> <span class="bn">0xC4</span><span class="op">,</span> <span class="bn">0xD8</span><span class="op">,</span> <span class="bn">0x00</span> <span class="op">};</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> secret <span class="op">=</span> decrypt_string<span class="op">(</span>encrypted_key<span class="op">);</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co">// ... use secret</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>ä¼˜ç‚¹</strong>: è‡ªåŠ¨åŒ–ã€å…¨å±€è¦†ç›–ã€å¯¹å¼€å‘è€…é€æ˜ã€‚
<strong>ç¼ºç‚¹</strong>: é€šå¸¸éœ€è¦å®šåˆ¶çš„ç¼–è¯‘å™¨æˆ–å·¥å…·é“¾ã€‚</p>
<h2 id="é€†å‘ç­–ç•¥">é€†å‘ç­–ç•¥</h2>
<p>é€†å‘å­—ç¬¦ä¸²æ··æ·†çš„ç›®æ ‡æ˜¯ <strong>æ‰¹é‡åœ°ã€è‡ªåŠ¨åŒ–åœ°</strong>
å°†æ··æ·†çš„å­—ç¬¦ä¸²è¿˜åŸå‡ºæ¥ã€‚</p>
<h3 id="é™æ€åˆ†æ-ida-pro-ghidra">1. é™æ€åˆ†æ (IDA Pro / Ghidra)</h3>
<p>é™æ€åˆ†ææ˜¯è¯†åˆ«è§£å¯†ä¾‹ç¨‹ï¼ˆDecryption Routineï¼‰å’Œæ‰¹é‡è§£å¯†çš„å…³é”®ã€‚</p>
<ul>
<li><p><strong>è¯†åˆ«è§£å¯†æ¨¡å¼</strong>:</p></li>
<li><p>å¯»æ‰¾ç‰¹å¾æ€§çš„å¾ªç¯ç»“æ„ã€‚ä¸€ä¸ªå¾ªç¯éå†å†…å­˜ã€æ‰§è¡Œå›ºå®šæ“ä½œï¼ˆå¦‚
<code>XOR</code>ï¼‰ç„¶åå†™å›ï¼Œè¿™é€šå¸¸å°±æ˜¯è§£å¯†å‡½æ•°ã€‚</p></li>
<li><p>åœ¨ IDA Pro ä¸­ï¼Œè¿™ç§å¾ªç¯çš„å›¾å½¢è§†å›¾éå¸¸å…·æœ‰è¾¨è¯†åº¦ã€‚</p></li>
<li><p><strong>å®šä½è§£å¯†å‡½æ•°</strong>:</p></li>
<li><p>é€šè¿‡äº¤å‰å¼•ç”¨ï¼ˆXrefsï¼‰æ‰¾åˆ°åŠ å¯†æ•°æ®è¢«å“ªäº›å‡½æ•°ä½¿ç”¨ã€‚è¿™äº›å‡½æ•°å¾ˆå¯èƒ½å°±æ˜¯è§£å¯†å‡½æ•°ã€‚</p></li>
<li><p>ä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªè§£å¯†å‡½æ•°ï¼Œåˆ†æå…¶é€»è¾‘ï¼ˆè¾“å…¥ã€è¾“å‡ºã€åŠ å¯†ç®—æ³•ï¼‰ã€‚</p></li>
<li><p><strong>è‡ªåŠ¨åŒ–è§£å¯† (IDAPython / Ghidra Script)</strong>:</p></li>
</ul>
<ol type="1">
<li><strong>ç¼–å†™è„šæœ¬</strong>:
è¿™æ˜¯æœ€é«˜æ•ˆçš„æ–¹æ³•ã€‚ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥æ¨¡æ‹Ÿè§£å¯†é€»è¾‘ã€‚</li>
<li><strong>å¯»æ‰¾å¼•ç”¨</strong>:
è„šæœ¬é¦–å…ˆæ‰¾åˆ°æ‰€æœ‰å¯¹è§£å¯†å‡½æ•°çš„äº¤å‰å¼•ç”¨ã€‚</li>
<li><strong>æå–å‚æ•°</strong>:
åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹ï¼Œè„šæœ¬å‘ä¸Šå›æº¯ï¼Œè§£æä¼ é€’ç»™è§£å¯†å‡½æ•°çš„å‚æ•°ï¼ˆåŠ å¯†çš„æ•°æ®ã€å¯†é’¥ç­‰ï¼‰ã€‚</li>
<li><strong>æ‰§è¡Œè§£å¯†</strong>: è„šæœ¬åœ¨å†…éƒ¨æ‰§è¡Œè§£å¯†ç®—æ³•ã€‚</li>
<li><strong>æ·»åŠ æ³¨é‡Š</strong>: æœ€åï¼Œå°†è§£å¯†åçš„å­—ç¬¦ä¸²ä½œä¸ºæ³¨é‡Šæ·»åŠ åˆ° IDA
Pro æˆ– Ghidra çš„åæ±‡ç¼–ä»£ç ä¸­ã€‚</li>
</ol>
<h3 id="åŠ¨æ€åˆ†æ-frida">2. åŠ¨æ€åˆ†æ (Frida)</h3>
<p>å½“é™æ€åˆ†æè¿‡äºå¤æ‚æˆ–å­˜åœ¨åè°ƒè¯•æ—¶ï¼ŒåŠ¨æ€åˆ†ææ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<ul>
<li><strong>Hook è§£å¯†å‡½æ•°</strong>:</li>
</ul>
<ol type="1">
<li>é€šè¿‡åˆæ­¥çš„é™æ€åˆ†æå®šä½åˆ°ç–‘ä¼¼çš„è§£å¯†å‡½æ•°ã€‚</li>
<li>ä½¿ç”¨ Frida <code>Interceptor.attach</code> æ¥ Hook
è¿™ä¸ªå‡½æ•°çš„å…¥å£å’Œå‡ºå£ã€‚</li>
<li>åœ¨ <code>onEnter</code>
ä¸­ï¼Œæ‰“å°å‡½æ•°çš„å‚æ•°ï¼ˆé€šå¸¸æ˜¯æŒ‡å‘åŠ å¯†æ•°æ®çš„æŒ‡é’ˆï¼‰ã€‚</li>
<li>åœ¨ <code>onLeave</code>
ä¸­ï¼Œæ‰“å°å‡½æ•°çš„è¿”å›å€¼ï¼ˆé€šå¸¸æ˜¯æŒ‡å‘å·²è§£å¯†çš„æ˜æ–‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼‰ã€‚</li>
<li>é€šè¿‡è¿è¡Œ App
å¹¶è§¦å‘ä¸åŒåŠŸèƒ½ï¼Œå°±å¯ä»¥ä»æ—¥å¿—ä¸­æ”¶é›†åˆ°å¤§é‡çš„æ˜æ–‡å­—ç¬¦ä¸²ã€‚</li>
</ol>
<ul>
<li><p><strong>å†…å­˜æ‰«æ</strong>:</p></li>
<li><p>å¦ä¸€ç§ç­–ç•¥æ˜¯è®©åº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åä½¿ç”¨ Frida è„šæœ¬æˆ–
GameGuardian ç­‰å·¥å…·æ‰«ææ•´ä¸ªè¿›ç¨‹å†…å­˜ï¼Œå¯»æ‰¾ç¬¦åˆå­—ç¬¦ä¸²ç‰¹å¾ï¼ˆå¦‚
ASCIIã€UTF-8ï¼‰çš„å†…å­˜åŒºåŸŸã€‚</p></li>
<li><p><strong>ä¼˜ç‚¹</strong>: æ— éœ€å…³å¿ƒè§£å¯†é€»è¾‘ã€‚</p></li>
<li><p><strong>ç¼ºç‚¹</strong>:
ä¿¡æ¯éå¸¸å˜ˆæ‚ï¼ŒåŒ…å«å¤§é‡æ— ç”¨æ•°æ®ï¼›æ— æ³•å°†è¢«åŠ å¯†å­˜å‚¨ä½†åœ¨è¿è¡Œæ—¶æœªè¢«ä½¿ç”¨çš„å­—ç¬¦ä¸²è§£å¯†å‡ºæ¥ã€‚</p></li>
</ul>
<h3 id="æ¨¡æ‹Ÿæ‰§è¡Œ-emulation">3. æ¨¡æ‹Ÿæ‰§è¡Œ (Emulation)</h3>
<p>å¯¹äºä¸€äº›ç‹¬ç«‹çš„ã€æ²¡æœ‰å¤ªå¤šå¤–éƒ¨ä¾èµ–çš„è§£å¯†å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ï¼ˆå¦‚
<code>Unicorn Engine</code>ï¼‰æ¥è§£å¯†ã€‚</p>
<ol type="1">
<li><strong>æå–ä»£ç å’Œæ•°æ®</strong>: ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ dump
å‡ºè§£å¯†å‡½æ•°çš„æœºå™¨ç å’Œéœ€è¦è§£å¯†çš„å­—èŠ‚æ•°ç»„ã€‚</li>
<li><strong>è®¾ç½®ç¯å¢ƒ</strong>: åœ¨ Unicorn
ä¸­ï¼Œæ˜ å°„æ‰€éœ€çš„å†…å­˜åŒºåŸŸï¼Œå°†åŠ å¯†æ•°æ®æ”¾å…¥ã€‚</li>
<li><strong>æ¨¡æ‹Ÿæ‰§è¡Œ</strong>:
è®¾ç½®å¥½åˆå§‹å¯„å­˜å™¨çŠ¶æ€ï¼ˆå¦‚å‚æ•°æŒ‡é’ˆï¼‰ï¼Œç„¶åå¼€å§‹æ¨¡æ‹Ÿæ‰§è¡Œè§£å¯†å‡½æ•°çš„æœºå™¨ç ã€‚</li>
<li><strong>è·å–ç»“æœ</strong>:
æ‰§è¡Œå®Œæ¯•åï¼Œä»å†…å­˜ä¸­è¯»å›è§£å¯†åçš„å­—ç¬¦ä¸²ã€‚</li>
</ol>
<p><strong>ä¼˜ç‚¹</strong>: é€Ÿåº¦æ¯”åŠ¨æ€åˆ†æå¿«ï¼Œæ— éœ€è¿è¡Œå®Œæ•´çš„
Appï¼Œå¯ç»•è¿‡åè°ƒè¯•ã€‚ <strong>ç¼ºç‚¹</strong>:
ç¯å¢ƒè®¾ç½®å¤æ‚ï¼Œä¸é€‚ç”¨äºæœ‰å¤§é‡ç³»ç»Ÿè°ƒç”¨æˆ–å¤æ‚ä¾èµ–çš„å‡½æ•°ã€‚</p>
<!-- 01-Recipes/Analysis/ollvm_deobfuscation.md -->
<h1 id="ollvm-åæ··æ·†">OLLVM åæ··æ·†</h1>
<p>OLLVM (Obfuscator-LLVM) æ˜¯ä¸€ä¸ªè‘—åçš„å¼€æºä»£ç æ··æ·†æ¡†æ¶ï¼Œå®ƒåœ¨ LLVM
ç¼–è¯‘å™¨ IR (ä¸­é—´è¡¨ç¤º)
å±‚é¢è¿›è¡Œæ“ä½œã€‚è¿™ä½¿å…¶èƒ½å¤Ÿä¸å…·ä½“è¯­è¨€æ— å…³ï¼Œå¹¶å¯¹ä»£ç åº”ç”¨å¤æ‚çš„ã€éš¾ä»¥é€†å‘çš„è½¬æ¢ã€‚</p>
<p>!!! warning â€œåœºæ™¯å¯¼å…¥ï¼šå½“ä½ é‡åˆ° OLLVMâ€ æ‰“å¼€
IDAï¼Œåç¼–è¯‘ä¸€ä¸ªå‡½æ•°ï¼Œç»“æœçœ‹åˆ°ï¼š</p>
<ul>
<li>ä¸€ä¸ªå·¨å¤§çš„ <code>switch-case</code> å¾ªç¯ï¼Œæœ‰å‡ åç”šè‡³ä¸Šç™¾ä¸ª case
åˆ†æ”¯</li>
<li>æ¯ä¸ª case é‡Œåªæœ‰å‡ è¡Œä»£ç ï¼Œç„¶ååˆè·³å› switch</li>
<li>åˆ°å¤„éƒ½æ˜¯çœ‹èµ·æ¥æœ‰ç”¨å®é™…æ— ç”¨çš„ <code>if</code> åˆ¤æ–­</li>
<li>ç®€å•çš„åŠ æ³•è¢«æ›¿æ¢æˆäº† <code>a = b - (-c)</code> è¿™æ ·çš„æ€ªå¼‚è¡¨è¾¾å¼</li>
</ul>
<p><strong>ä½ çš„ç¬¬ä¸€ååº”å¯èƒ½æ˜¯ï¼šè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</strong></p>
<p>æ­å–œï¼Œä½ é‡åˆ°äº† OLLVM æ§åˆ¶æµå¹³å¦åŒ– (FLA) + è™šå‡æ§åˆ¶æµ (BCF) + æŒ‡ä»¤æ›¿æ¢
(SUB) çš„â€ä¸‰ä»¶å¥—â€ã€‚ è¿™æ˜¯ç›®å‰ Android Native
å±‚æœ€å¸¸è§çš„å•†ä¸šçº§æ··æ·†æ–¹æ¡ˆã€‚</p>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼šé¢å¯¹è¿™ç§æ··æ·†ï¼Œæ˜¯é€‰æ‹©â€ç¡¬çœ‹â€ä»£ç ï¼Œè¿˜æ˜¯æœ‰æ›´èªæ˜çš„åŠæ³•ï¼Ÿ</p>
<p>æœ¬æ–‡æ¡£æ¶µç›–äº†å¸¸è§çš„ OLLVM æ··æ·†é€šé“ (pass) åŠå…¶åˆ†æå’Œé€†å‘ç­–ç•¥ã€‚</p>
<hr />
<h2 id="æ ¸å¿ƒæ··æ·†æŠ€æœ¯-1">æ ¸å¿ƒæ··æ·†æŠ€æœ¯</h2>
<p>OLLVM çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºå…¶ä¸‰ç§æ ¸å¿ƒæ··æ·†æŠ€æœ¯ï¼š</p>
<ol type="1">
<li><p><strong>æ§åˆ¶æµå¹³å¦åŒ– (<code>-fla</code>)</strong>:
è¯¥æŠ€æœ¯ä¼šå½»åº•å¹³å¦åŒ–ä¸€ä¸ªå‡½æ•°çš„æ§åˆ¶æµã€‚å®ƒé€šè¿‡å°†æ‰€æœ‰åŸºæœ¬å—æ”¾å…¥ä¸€ä¸ªå•ä¸€çš„ã€å·¨å¤§çš„åˆ†å‘å™¨å¾ªç¯ï¼ˆâ€œä¸»åˆ†å‘å™¨â€ï¼‰ä¸­æ¥éšè—åŸå§‹çš„ç¨‹åºæµç¨‹ã€‚ä¸€ä¸ªçŠ¶æ€å˜é‡ç”¨äºæ§åˆ¶ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»£ç å—ã€‚é€†å‘æ­¤æŠ€æœ¯éœ€è¦é‡å»ºåŸå§‹çš„æ§åˆ¶æµå›¾
(CFG)ã€‚</p></li>
<li><p><strong>è™šå‡æ§åˆ¶æµ (<code>-bcf</code>)</strong>:
è¯¥æŠ€æœ¯åœ¨ä»£ç ä¸­æ’å…¥æ— æ•ˆçš„æ¡ä»¶åˆ†æ”¯å’Œä¸é€æ˜è°“è¯ã€‚è¿™äº›åˆ†æ”¯è¢«è®¾è®¡ä¸ºé™æ€åˆ†æéš¾ä»¥è§£æï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œå®ƒä»¬æ€»æ˜¯ä¼šå¾—å‡ºç›¸åŒçš„ç»“æœã€‚è¿™ä¼šç»™æ§åˆ¶æµå›¾å¢åŠ å¤§é‡çš„å™ªå£°ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤æ›¿æ¢ (<code>-sub</code>)</strong>:
è¿™æ˜¯æœ€ç®€å•çš„æ··æ·†æ–¹å¼ã€‚å®ƒå°†æ ‡å‡†çš„äºŒè¿›åˆ¶è¿ç®—ç¬¦ï¼ˆå¦‚ <code>add</code>,
<code>sub</code>, <code>and</code>,
<code>or</code>ï¼‰æ›¿æ¢ä¸ºåŠŸèƒ½ä¸Šç­‰ä»·ä½†æ›´å¤æ‚çš„æŒ‡ä»¤åºåˆ—ã€‚ä¾‹å¦‚ï¼Œ<code>a = b + c</code>
å¯èƒ½ä¼šå˜æˆ <code>a = b - (-c)</code>ã€‚</p></li>
</ol>
<hr />
<h2 id="åˆ†æä¸åæ··æ·†ç­–ç•¥-1">åˆ†æä¸åæ··æ·†ç­–ç•¥</h2>
<p>!!! question â€œæ€è€ƒï¼šé™æ€åˆ†æ vs åŠ¨æ€åˆ†æï¼Œå“ªä¸ªæ›´æœ‰æ•ˆï¼Ÿâ€ é¢å¯¹ OLLVM
æ··æ·†ï¼Œæœ‰ä¸¤ç§å®Œå…¨ä¸åŒçš„æ€è·¯ï¼š</p>
<p><strong>é™æ€åˆ†æ</strong>ï¼š - âœ…
ä¼˜åŠ¿ï¼šèƒ½çœ‹åˆ°æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†åˆ†æ”¯ - âŒ
åŠ£åŠ¿ï¼šéœ€è¦å¯¹æŠ—å¤§é‡çš„è™šå‡åˆ†æ”¯ï¼Œåˆ†æå·¥ä½œé‡å·¨å¤§ -
é€‚ç”¨åœºæ™¯ï¼šä½ éœ€è¦ç†è§£å®Œæ•´çš„ç®—æ³•é€»è¾‘ï¼Œæˆ–è€…å¯»æ‰¾æ¼æ´</p>
<p><strong>åŠ¨æ€åˆ†æ</strong>ï¼š - âœ…
ä¼˜åŠ¿ï¼šç›´æ¥è®°å½•çœŸå®æ‰§è¡Œè·¯å¾„ï¼Œç»•è¿‡æ‰€æœ‰è™šå‡åˆ†æ”¯ - âŒ
åŠ£åŠ¿ï¼šåªèƒ½çœ‹åˆ°å½“å‰è¾“å…¥ä¸‹çš„æ‰§è¡Œè·¯å¾„ï¼Œå¯èƒ½é—æ¼å…³é”®åˆ†æ”¯ -
é€‚ç”¨åœºæ™¯ï¼šä½ åªæƒ³æå–ç®—æ³•ç»“æœï¼ˆå¦‚åŠ å¯†ç­¾åï¼‰ï¼Œä¸å…³å¿ƒå†…éƒ¨é€»è¾‘</p>
<p><strong>å®æˆ˜å»ºè®®</strong>ï¼š 1. å…ˆç”¨åŠ¨æ€åˆ†æï¼ˆFrida Stalker / Unidbg
traceï¼‰å¿«é€Ÿè·å–â€çœŸå®â€çš„æ‰§è¡Œæµ 2.
å†ç”¨é™æ€åˆ†æéªŒè¯å’Œè¡¥å……åŠ¨æ€åˆ†æé—æ¼çš„éƒ¨åˆ† 3.
å¦‚æœç›®æ ‡æ˜¯è‡ªåŠ¨åŒ–ï¼ˆå¦‚ç®—æ³•è¿˜åŸï¼‰ï¼Œè€ƒè™‘ç¬¦å·æ‰§è¡Œï¼ˆAngrï¼‰</p>
<h3 id="é™æ€åˆ†æ">1. é™æ€åˆ†æ</h3>
<ul>
<li><p><strong>CFG é‡å»º</strong>:
å¯¹äºæ§åˆ¶æµå¹³å¦åŒ–ï¼Œå…³é”®æ˜¯è¯†åˆ«çŠ¶æ€å˜é‡å’Œåˆ†å‘å™¨ã€‚é€šè¿‡ç¬¦å·æ‰§è¡Œæˆ–æ¨¡å¼åŒ¹é…åˆ†å‘å™¨é€»è¾‘ï¼Œå¯ä»¥ç¡®å®šæ¯ä¸ªçœŸå®åŸºæœ¬å—çš„åç»§ï¼Œä»è€Œé‡å»ºåŸå§‹å›¾ã€‚</p></li>
<li><p><strong>ä¸é€æ˜è°“è¯æ±‚è§£</strong>: Z3 æˆ–å…¶ä»– SMT
æ±‚è§£å™¨ç­‰å·¥å…·å¯ç”¨äºè‡ªåŠ¨è¯æ˜è™šå‡æ§åˆ¶æµä¸­çš„æ¡ä»¶æ˜¯ä¸å˜çš„ã€‚è¿™ä½¿å¾—åˆ†æå¸ˆèƒ½å¤Ÿè¯†åˆ«å¹¶ç§»é™¤æ— æ•ˆçš„ä»£ç è·¯å¾„ã€‚</p></li>
<li><p><strong>æ¨¡å¼åŒ¹é…</strong>:
å¯¹äºæŒ‡ä»¤æ›¿æ¢ï¼Œå¯ä»¥è¯†åˆ«å¹¶æ›¿æ¢ç®€å•çš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåƒ
<code>x = rdtsc(); y = x &amp; 1; if (y == 0) ...</code>
è¿™æ ·çš„åºåˆ—æ˜¯ä¸€ä¸ªå¸¸è§çš„è™šå‡è°“è¯ã€‚</p></li>
</ul>
<h3 id="åŠ¨æ€åˆ†æ">2. åŠ¨æ€åˆ†æ</h3>
<ul>
<li><p><strong>ä½¿ç”¨ Frida/Unidbg è¿›è¡Œè¿½è¸ª</strong>:
åŠ¨æ€è¿½è¸ªéå¸¸æœ‰æ•ˆã€‚é€šè¿‡ä½¿ç”¨ Frida çš„ <code>Stalker</code> æˆ– Unidbg
çš„è¿½è¸ªåŠŸèƒ½ï¼Œå¯ä»¥è®°å½•è¿è¡Œæ—¶æ‰§è¡Œçš„åŸºæœ¬å—çš„ç¡®åˆ‡é¡ºåºã€‚è¿™å¯ä»¥ç»•è¿‡æ‰€æœ‰çš„æ§åˆ¶æµæ··æ·†ï¼Œä¸ºä½ æä¾›â€çœŸå®â€çš„æ‰§è¡Œè·¯å¾„ã€‚</p></li>
<li><p><strong>ç¬¦å·æ‰§è¡Œ</strong>: åƒ Angr
è¿™æ ·çš„å¼•æ“å¯ç”¨äºæ¢ç´¢ç¨‹åºçŠ¶æ€ã€‚ç¬¦å·æ‰§è¡Œå¯ä»¥è‡ªåŠ¨æ±‚è§£è·¯å¾„çº¦æŸï¼Œä»è€Œæœ‰æ•ˆåœ°åæ··æ·†æ§åˆ¶æµå¹¶ç®€åŒ–ä¸é€æ˜è°“è¯ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½å¾ˆæ…¢ï¼Œä½†åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚</p></li>
</ul>
<h3 id="è‡ªåŠ¨åŒ–å·¥å…·">3. è‡ªåŠ¨åŒ–å·¥å…·</h3>
<ul>
<li><p><strong>d-obfuscator</strong>: ä¸€ä¸ªåŸºäº Python
çš„å·¥å…·ï¼Œä½¿ç”¨ç¬¦å·æ‰§è¡Œï¼ˆé€šè¿‡ Angrï¼‰æ¥åæ··æ·† OLLVMã€‚</p></li>
<li><p><strong>QB-Di</strong>: ä¸€ä¸ªåŸºäº QBDI
åŠ¨æ€æ’æ¡©æ¡†æ¶çš„äº¤äº’å¼åæ··æ·†å·¥å…·ã€‚</p></li>
<li><p><strong>Triton</strong>:
ä¸€ä¸ªåŠ¨æ€äºŒè¿›åˆ¶åˆ†ææ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬æ¥æ‰§è¡Œæ±¡ç‚¹åˆ†æå’Œç¬¦å·æ‰§è¡Œã€‚</p></li>
</ul>
<!-- 01-Recipes/Analysis/re_workflow.md -->
<h1 id="recipe-android-åº”ç”¨é€†å‘å·¥ç¨‹å®Œæ•´å·¥ä½œæµç¨‹">Recipe: Android
åº”ç”¨é€†å‘å·¥ç¨‹å®Œæ•´å·¥ä½œæµç¨‹</h1>
<h2 id="é—®é¢˜åœºæ™¯-1">é—®é¢˜åœºæ™¯</h2>
<p>ä½ åˆšæ‹¿åˆ°ä¸€ä¸ª Android åº”ç”¨éœ€è¦åˆ†æï¼Œä½†é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p>
<ul>
<li>ğŸ¤” <strong>â€œæ‹¿åˆ° APK ååº”è¯¥å…ˆåšä»€ä¹ˆï¼Ÿä»å“ªé‡Œå…¥æ‰‹ï¼Ÿâ€</strong></li>
<li>ğŸ¤” <strong>â€œé™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æåº”è¯¥å¦‚ä½•é…åˆï¼Ÿâ€</strong></li>
<li>ğŸ¤” <strong>â€œå¦‚ä½•ç³»ç»ŸåŒ–åœ°åˆ†æï¼Œè€Œä¸æ˜¯ç›²ç›®å°è¯•ï¼Ÿâ€</strong></li>
<li>ğŸ¤” <strong>â€œé‡åˆ°åŠ å›ºã€æ··æ·†ã€åè°ƒè¯•è¯¥æ€ä¹ˆåŠï¼Ÿâ€</strong></li>
<li>ğŸ¤” <strong>â€œåˆ†æå®Œæˆåå¦‚ä½•ä¿®æ”¹åº”ç”¨ä»¥è¾¾åˆ°ç›®çš„ï¼Ÿâ€</strong></li>
</ul>
<p>æœ¬ Recipe
æä¾›ä¸€ä¸ª<strong>ç»è¿‡å®æˆ˜éªŒè¯çš„æ ‡å‡†åŒ–å·¥ä½œæµç¨‹</strong>ï¼Œå¸®åŠ©ä½ ç³»ç»ŸåŒ–åœ°å®Œæˆä»ä¿¡æ¯æ”¶é›†åˆ°ä»£ç ä¿®æ”¹çš„æ•´ä¸ªé€†å‘å·¥ç¨‹è¿‡ç¨‹ã€‚</p>
<hr />
<h2 id="å·¥å…·æ¸…å•">å·¥å…·æ¸…å•</h2>
<h2 id="å¿…å¤‡å·¥å…·"># å¿…å¤‡å·¥å…·</h2>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#x">x</a> <strong>APK æå–</strong></td>
<td>ADB + Package Manager</td>
</tr>
<tr>
<td><a href="#x">x</a> <strong>è§£åŒ…/å›åŒ…</strong></td>
<td>Apktool</td>
</tr>
<tr>
<td><a href="#x">x</a> <strong>åç¼–è¯‘å·¥å…·</strong></td>
<td>Jadx-GUIï¼ˆæ¨èï¼‰æˆ– JEB</td>
</tr>
<tr>
<td><a href="#x">x</a> <strong>åŠ¨æ€åˆ†æ</strong></td>
<td>Frida + Frida-tools</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="#x">x</a> <strong>Root è®¾å¤‡/æ¨¡æ‹Ÿå™¨</strong> -
Genymotionã€å¤œç¥ã€é›·ç”µç­‰</li>
</ul>
<h2 id="å¯é€‰å·¥å…·-1"># å¯é€‰å·¥å…·</h2>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>â˜ <strong>Native åˆ†æ</strong></td>
<td>IDA Pro / Ghidra / Binary Ninja</td>
</tr>
<tr>
<td>â˜ <strong>ç½‘ç»œæŠ“åŒ…</strong></td>
<td>mitmproxy / Burp Suite / Charles</td>
</tr>
<tr>
<td>â˜ <strong>è°ƒè¯•å™¨</strong></td>
<td>Android Studio / jdb</td>
</tr>
<tr>
<td>â˜ <strong>ç­¾åå·¥å…·</strong></td>
<td>apksignerï¼ˆAndroid SDK è‡ªå¸¦ï¼‰</td>
</tr>
<tr>
<td>â˜ <strong>åŠ å£³æ£€æµ‹</strong></td>
<td>PKid / ApkTool-Plus</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</h2>
<p>âœ… <strong>äº†è§£ Android åŸºæœ¬æ¶æ„</strong>ï¼ˆå››å¤§ç»„ä»¶ã€Manifest æ–‡ä»¶ï¼‰
âœ… <strong>æŒæ¡åŸºæœ¬ Java/Smali è¯­æ³•</strong> âœ… <strong>ç†Ÿæ‚‰ ADB
å‘½ä»¤</strong> âœ… <strong>æ‹¥æœ‰ Root è®¾å¤‡</strong>ï¼ˆåŠ¨æ€åˆ†æå¿…éœ€ï¼‰</p>
<hr />
<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<h2 id="æ ¸å¿ƒåŸåˆ™"># æ ¸å¿ƒåŸåˆ™</h2>
<blockquote>
<p><strong>ç”±å¤–åˆ°å†…ã€ç”±æµ…å…¥æ·±ã€é™åŠ¨ç»“åˆ</strong></p>
<ol type="1">
<li><strong>ä¿¡æ¯ä¾¦å¯Ÿ</strong> â†’ äº†è§£åº”ç”¨åŸºæœ¬ä¿¡æ¯å’ŒæŠ€æœ¯æ ˆ</li>
<li><strong>é™æ€åˆ†æ</strong> â†’ ç†è§£ä»£ç é€»è¾‘å’Œç®—æ³•</li>
<li><strong>åŠ¨æ€éªŒè¯</strong> â†’ è§‚å¯Ÿå®é™…è¡Œä¸ºã€ç»•è¿‡ä¿æŠ¤</li>
<li><strong>ä»£ç ä¿®æ”¹</strong> â†’ å®ç°æ°¸ä¹…æ€§æ”¹åŠ¨</li>
</ol>
</blockquote>
<hr />
<h2
id="é˜¶æ®µä¸€ä¿¡æ¯æ”¶é›†ä¸åˆæ­¥åˆ†æ-15-30-åˆ†é’Ÿ">é˜¶æ®µä¸€ï¼šä¿¡æ¯æ”¶é›†ä¸åˆæ­¥åˆ†æï¼ˆ
15-30 åˆ†é’Ÿï¼‰</h2>
<ul>
<li>*ç›®æ ‡**ï¼šåœ¨ä¸è¿è¡Œåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿäº†è§£åŸºæœ¬ä¿¡æ¯ã€åŠŸèƒ½å’Œæ½œåœ¨å…¥å£ç‚¹ã€‚</li>
</ul>
<h2 id="æ­¥éª¤-1è·å–-apk-æ–‡ä»¶"># æ­¥éª¤ 1ï¼šè·å– APK æ–‡ä»¶</h2>
<h3 id="æ–¹æ³•-aä»å·²å®‰è£…åº”ç”¨æå–"># æ–¹æ³• Aï¼šä»å·²å®‰è£…åº”ç”¨æå–</h3>
<div class="sourceCode" id="cb68"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. åˆ—å‡ºæ‰€æœ‰åŒ…å</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell pm list packages <span class="kw">|</span> <span class="fu">grep</span> <span class="op">&lt;</span>å…³é”®è¯<span class="op">&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ç¤ºä¾‹ï¼šæŸ¥æ‰¾éŸ³ä¹åº”ç”¨</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell pm list packages <span class="kw">|</span> <span class="fu">grep</span> music</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºï¼špackage:com.example.musicapp</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. è·å– APK è·¯å¾„</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell pm path com.example.musicapp</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºï¼špackage:/data/app/~~ABC123/com.example.musicapp-XYZ456/base.apk</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. æ‹‰å–åˆ°æœ¬åœ°</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /data/app/~~ABC123/com.example.musicapp-XYZ456/base.apk ./target.apk</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸€é”®è„šæœ¬ï¼ˆä¿å­˜ä¸º pull-apk.shï¼‰</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="va">PACKAGE</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="va">APK_PATH</span><span class="op">=</span><span class="va">$(</span><span class="ex">adb</span> shell pm path <span class="va">$PACKAGE</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d:</span> <span class="at">-f2</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&#39;\r&#39;</span><span class="va">)</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull <span class="va">$APK_PATH</span> ./<span class="va">$PACKAGE</span>.apk</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;[+] APK å·²ä¿å­˜: </span><span class="va">$PACKAGE</span><span class="st">.apk&quot;</span></span></code></pre></div>
<pre><code>
```bash
# ä½¿ç”¨ Apktoolï¼ˆæ¨è - è§£ç èµ„æºå’Œ Smaliï¼‰
apktool d target.apk -o target_unpacked

# è¾“å‡ºç›®å½•ç»“æ„ï¼š
# target_unpacked/
# â”œâ”€â”€ androidManifest.xml (å·²è§£ç )
# â”œâ”€â”€ apktool.yml
# â”œâ”€â”€ smali/ (Dalvik å­—èŠ‚ç )
# â”œâ”€â”€ smali_classes2/ (å¤šä¸ª DEX)
# â”œâ”€â”€ res/ (èµ„æºæ–‡ä»¶)
# â”œâ”€â”€ lib/ (native åº“)
# â”œâ”€â”€ assets/ (èµ„äº§æ–‡ä»¶)
# â””â”€â”€ original/

# å¿«é€ŸæŸ¥çœ‹ï¼ˆä¸è§£ç ï¼‰
unzip -l target.apk
unzip target.apk -d target_quick
</code></pre>
<div class="sourceCode" id="cb70"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹å·²è§£ç çš„ manifest</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> target_unpacked/AndroidManifest.xml</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æˆ–ä½¿ç”¨å·¥å…·ç¾åŒ–</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="ex">xmllint</span> <span class="at">--format</span> target_unpacked/AndroidManifest.xml</span></code></pre></div>
<div class="line-block"><strong>åŒ…å</strong> |
<code>&lt;manifest package="..."&gt;</code> | åº”ç”¨å”¯ä¸€æ ‡è¯† |<br />
<strong>å…¥å£ Activity</strong> | <code>&lt;activity&gt;</code> å¸¦
<code>LAUNCHER</code> intent | åº”ç”¨å¯åŠ¨å…¥å£ |<br />
<strong>Application ç±»</strong> |
<code>&lt;application android:name="..."&gt;</code> | è‡ªå®šä¹‰
Applicationï¼ˆå¯èƒ½æœ‰åˆå§‹åŒ–é€»è¾‘ï¼‰|<br />
<strong>æƒé™</strong> | <code>&lt;uses-permission&gt;</code> |
æ¨æ–­åŠŸèƒ½ï¼ˆç½‘ç»œã€å­˜å‚¨ã€ä½ç½®ç­‰ï¼‰|<br />
<strong>è°ƒè¯•æ ‡å¿—</strong> | <code>android:debuggable="true"</code> | âš ï¸
å¯ç›´æ¥è°ƒè¯• |<br />
<strong>å¤‡ä»½æ ‡å¿—</strong> | <code>android:allowBackup="true"</code> | âš ï¸
æ•°æ®å¯å¯¼å‡º |<br />
<strong>å¯¼å‡ºç»„ä»¶</strong> | <code>android:exported="true"</code> | âš ï¸
å¯è¢«å¤–éƒ¨è°ƒç”¨ |<br />
<strong>URL Scheme</strong> | <code>&lt;intent-filter&gt;</code> å¸¦
<code>&lt;data&gt;</code> | Deep link å…¥å£ç‚¹ |<br />
<strong>ContentProvider</strong> | <code>&lt;provider&gt;</code> |
æ•°æ®åº“æ¥å£ |<br />
<strong>Service</strong> | <code>&lt;service&gt;</code> | åå°æœåŠ¡
|</div>
<h3 id="çœŸå®æ¡ˆä¾‹åˆ†æè…¾è®¯ä¹å›ºåº”ç”¨"># çœŸå®æ¡ˆä¾‹ï¼šåˆ†æè…¾è®¯ä¹å›ºåº”ç”¨</h3>
<div class="sourceCode" id="cb71"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">application</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="ot">android:name=</span><span class="st">&quot;com.tencent.StubShell.TxAppEntry&quot;</span> <span class="er">&lt;!--</span><span class="co"> âš ï¸ åŠ å£³ç‰¹å¾ --&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>android:debuggable=&quot;false&quot;</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>android:allowBackup=&quot;false&quot;&gt;</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">activity</span> <span class="ot">android:name=</span><span class="st">&quot;.MainActivity&quot;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="ot">android:exported=</span><span class="st">&quot;true&quot;</span>&gt; <span class="co">&lt;!-- âš ï¸ å¯å¤–éƒ¨å¯åŠ¨ --&gt;</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">action</span> <span class="ot">android:name=</span><span class="st">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">category</span> <span class="ot">android:name=</span><span class="st">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- âš ï¸ è‡ªå®šä¹‰ URL Scheme --&gt;</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">intent-filter</span>&gt;</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">data</span> <span class="ot">android:scheme=</span><span class="st">&quot;myapp&quot;</span> <span class="ot">android:host=</span><span class="st">&quot;open&quot;</span>/&gt;</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">action</span> <span class="ot">android:name=</span><span class="st">&quot;android.intent.action.VIEW&quot;</span>/&gt;</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">category</span> <span class="ot">android:name=</span><span class="st">&quot;android.intent.category.BROWSABLE&quot;</span>/&gt;</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">intent-filter</span>&gt;</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">activity</span>&gt;</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">application</span>&gt;</span></code></pre></div>
<ul>
<li>âš ï¸ å¯é€šè¿‡ <code>myapp://open</code> URL å¯åŠ¨</li>
<li>âœ… è°ƒè¯•å’Œå¤‡ä»½å·²ç¦ç”¨ï¼ˆå®‰å…¨é…ç½®è‰¯å¥½ï¼‰</li>
</ul>
<hr />
<h2 id="æ­¥éª¤-4å¿«é€Ÿç›®å½•ç»“æ„å®¡æŸ¥"># æ­¥éª¤ 4ï¼šå¿«é€Ÿç›®å½•ç»“æ„å®¡æŸ¥</h2>
<div class="sourceCode" id="cb72"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹ native åº“</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> target_unpacked/lib/<span class="pp">*</span>/</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºç¤ºä¾‹ï¼š</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># lib/arm64-v8a/libnative-lib.so (2.3 MB) â† Native ä»£ç </span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># lib/arm64-v8a/libencrypt.so (450 KB) â† å¯èƒ½æ˜¯åŠ å¯†åº“</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># lib/armeabi-v7a/libnative-lib.so</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹èµ„äº§æ–‡ä»¶</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> target_unpacked/assets/</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºç¤ºä¾‹ï¼š</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># config.json â† é…ç½®æ–‡ä»¶</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># encrypted.dat â† åŠ å¯†æ•°æ®</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># web/index.html â† H5 é¡µé¢</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ç»Ÿè®¡ Smali æ–‡ä»¶æ•°é‡ï¼ˆä¼°ç®—ä»£ç è§„æ¨¡ï¼‰</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span> target_unpacked/smali<span class="pp">*</span> <span class="at">-name</span> <span class="st">&quot;*.smali&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºï¼š8432 (çº¦ 8000+ ç±»)</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co"># æœç´¢å¯ç–‘å…³é”®è¯</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;password&quot;</span> target_unpacked/smali/ <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 10</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;encrypt&quot;</span> target_unpacked/smali/ <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 10</span></code></pre></div>
<ul>
<li>âœ… æŠ€æœ¯æ ˆè¯†åˆ«ï¼ˆæ˜¯å¦åŠ å£³ã€æ˜¯å¦ä½¿ç”¨ native ä»£ç ï¼‰</li>
<li>âœ… æ½œåœ¨æ”»å‡»é¢ï¼ˆå¯¼å‡ºç»„ä»¶ã€URL Schemeï¼‰</li>
<li>âœ… åˆæ­¥åˆ†ææ–¹å‘ï¼ˆåº”è¯¥æ·±å…¥å“ªé‡Œï¼‰</li>
</ul>
<hr />
<h2 id="é˜¶æ®µäºŒé™æ€åˆ†æ-1-3-å°æ—¶">é˜¶æ®µäºŒï¼šé™æ€åˆ†æï¼ˆ 1-3 å°æ—¶ï¼‰</h2>
<ul>
<li>*ç›®æ ‡**ï¼šé€šè¿‡åç¼–è¯‘ç†è§£åº”ç”¨å¦‚ä½•å·¥ä½œã€ç®—æ³•å’Œä¸šåŠ¡é€»è¾‘ã€‚</li>
</ul>
<h2 id="æ­¥éª¤-1ä½¿ç”¨-jadx-åç¼–è¯‘"># æ­¥éª¤ 1ï¼šä½¿ç”¨ Jadx åç¼–è¯‘</h2>
<div class="sourceCode" id="cb73"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å¯åŠ¨ Jadx GUI</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx-gui</span> target.apk</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æˆ–å‘½ä»¤è¡Œæ¨¡å¼</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx</span> <span class="at">-d</span> target_decompiled target.apk</span></code></pre></div>
<ul>
<li><p>â€œencryptâ€ã€â€œdecryptâ€ã€â€œAESâ€ã€â€œDESâ€ â†’ åŠ å¯†ç®—æ³•</p></li>
<li><p>â€œhttpâ€ã€â€œapiâ€ã€â€œrequestâ€ â†’ ç½‘ç»œè¯·æ±‚</p></li>
<li><p>â€œpremiumâ€ã€â€œvipâ€ã€â€œpaidâ€ â†’ ä¼šå‘˜æ£€æŸ¥</p></li>
<li><p>â€œsignatureâ€ã€â€œsignâ€ â†’ ç­¾åç®—æ³•</p></li>
<li><p>â€œrootâ€ã€â€œfridaâ€ã€â€œxposedâ€ â†’ åæ£€æµ‹ ```</p></li>
<li><p>*ğŸ“ å®šä½å…³é”®ä»£ç **ï¼š</p></li>
</ul>
<ol type="1">
<li>ä»å…¥å£ Activity å¼€å§‹ï¼ˆ<code>MainActivity.onCreate()</code>ï¼‰</li>
<li>æ£€æŸ¥ Application å­ç±»ï¼ˆ<code>Application.onCreate()</code> -
åˆå§‹åŒ–é€»è¾‘ï¼‰</li>
<li>æœç´¢å­—ç¬¦ä¸²å¸¸é‡ï¼ˆå³é”® â†’ â€œæŸ¥æ‰¾ç”¨æ³•â€ï¼‰</li>
<li>åˆ†æç½‘ç»œè¯·æ±‚ï¼ˆOkHttpã€Retrofitã€HttpURLConnectionï¼‰</li>
<li>è¿½è¸ªç”¨æˆ·è¾“å…¥å¤„ç†ï¼ˆ<code>onClick</code> å›è°ƒï¼‰</li>
</ol>
<ul>
<li><ul>
<li>ä»£ç å¯¼èˆª**ï¼š</li>
</ul></li>
</ul>
<pre><code>- Ctrl+Hï¼šæŸ¥çœ‹ç±»å±‚æ¬¡ç»“æ„
- Ctrl+F12ï¼šæŸ¥çœ‹å½“å‰ç±»çš„æ‰€æœ‰æ–¹æ³•
    ```

- --

## # æ­¥éª¤ 2ï¼šè¯†åˆ«ä»£ç æ¨¡å¼

### âœ… æ­£å¸¸ä»£ç 

```java
// å¯è¯»çš„ç±»åå’Œæ–¹æ³•å
public class LoginManager {
private static final String API_URL = &quot;https://api.example.com/login&quot;;

public boolean login(String username, String password) {
String encryptedPassword = AESUtil.encrypt(password);
return ApiClient.post(API_URL, username, encryptedPassword);
}
}
</code></pre>
<p>// ProGuard/R8 æ··æ·† public class a { private static final String a =
â€œhttps://api.example.com/loginâ€;</p>
<p>public boolean a(String str, String str2) { String b = b.a(str2); //
å­—ç¬¦ä¸²å¸¸é‡é€šå¸¸ä¼šä¿ç•™ return c.a(a, str, b); } }</p>
<pre><code>

- --

## # æ­¥éª¤ 3ï¼šåˆ†æ Native åº“

å¦‚æœåº”ç”¨åŒ…å« `.so` æ–‡ä»¶ï¼Œæ ¸å¿ƒç®—æ³•é€šå¸¸åœ¨è¿™é‡Œå®ç°ã€‚

### æ–¹æ³• Aï¼šä½¿ç”¨ IDA Pro åˆ†æ

```bash
# 1. æ‰“å¼€ SO æ–‡ä»¶
ida64 target_unpacked/lib/arm64-v8a/libnative-lib.so

# 2. ç­‰å¾…è‡ªåŠ¨åˆ†æå®Œæˆ

# 3. æŸ¥çœ‹å¯¼å‡ºå‡½æ•°ï¼ˆExports çª—å£ï¼‰
# æŸ¥æ‰¾ JNI å‡½æ•°å‘½åæ¨¡å¼ï¼š
# Java_com_example_app_NativeHelper_encrypt
# Java_&lt;åŒ…å&gt;_&lt;ç±»å&gt;_&lt;æ–¹æ³•å&gt;

# 4. åç¼–è¯‘å…³é”®å‡½æ•°ï¼ˆF5 åç¼–è¯‘ä¸ºä¼ªä»£ç ï¼‰
</code></pre>
<h1 id="æ–°å»ºé¡¹ç›®-å¯¼å…¥æ–‡ä»¶-é€‰æ‹©-.so-æ–‡ä»¶">2. æ–°å»ºé¡¹ç›® â†’ å¯¼å…¥æ–‡ä»¶ â†’ é€‰æ‹©
.so æ–‡ä»¶</h1>
<h1 id="åŒå‡»æ–‡ä»¶-è‡ªåŠ¨åˆ†æ">3. åŒå‡»æ–‡ä»¶ â†’ è‡ªåŠ¨åˆ†æ</h1>
<h1 id="çª—å£-symbol-tree-exports">4. çª—å£ â†’ Symbol Tree â†’ Exports</h1>
<h1 id="æŸ¥çœ‹å¯¼å‡ºå‡½æ•°åˆ—è¡¨">æŸ¥çœ‹å¯¼å‡ºå‡½æ•°åˆ—è¡¨</h1>
<h1 id="åŒå‡»å‡½æ•°-åç¼–è¯‘å³ä¾§é¢æ¿æ˜¾ç¤º-c-ä¼ªä»£ç ">5. åŒå‡»å‡½æ•° â†’
åç¼–è¯‘ï¼ˆå³ä¾§é¢æ¿æ˜¾ç¤º C ä¼ªä»£ç ï¼‰</h1>
<pre><code>
# è¾“å‡ºç¤ºä¾‹ï¼š
# 00012340 T Java_com_example_app_Crypto_encrypt
# 00012680 T Java_com_example_app_Crypto_decrypt
# 00012a00 T Java_com_example_app_Sign_generate

# æœç´¢å­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ‰¾åˆ°åŠ å¯†å¯†é’¥ï¼‰
strings libnative-lib.so | grep -i &quot;key\|secret\|password&quot;
</code></pre>
<div class="sourceCode" id="cb77"><pre
class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## åˆ†æç›®æ ‡</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>â˜ æå–ç™»å½• API ç­¾åç®—æ³•</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>â˜ ç»•è¿‡ VIP ä¼šå‘˜æ£€æŸ¥</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>â˜ è·å–åŠ å¯†å¯†é’¥</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## å·²å®šä½çš„å…³é”®ç±»/æ–¹æ³•</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`com.example.app.utils.SignUtil.generateSign(Map params)`</span> - ç­¾åç”Ÿæˆ</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`com.example.app.user.UserManager.isPremium()`</span> - ä¼šå‘˜æ£€æŸ¥</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Native: <span class="in">`Java_com_example_app_Crypto_encrypt`</span> - åŠ å¯†å‡½æ•°</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hook ç­–ç•¥</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hook <span class="in">`generateSign()`</span> æŸ¥çœ‹å‚æ•°å’Œè¿”å›å€¼</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hook <span class="in">`isPremium()`</span> å¼ºåˆ¶è¿”å› true</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hook native å‡½æ•°è·å–åŠ å¯†å¯†é’¥</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## é¢„æœŸæŒ‘æˆ˜</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ç­¾åç®—æ³•å¯èƒ½åœ¨ native å±‚</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>å¯èƒ½æœ‰ Frida æ£€æµ‹</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ç½‘ç»œè¯·æ±‚å¯èƒ½æœ‰ SSL pinning</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="in">```</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="in">### é˜¶æ®µäºŒäº§å‡º</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="in">- âœ… ç†è§£åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="in">- âœ… å®šä½å…³é”®ç±»ã€æ–¹æ³•å’Œ native å‡½æ•°</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="in">- âœ… è¯†åˆ«ä½¿ç”¨çš„åŠ å¯†/ç­¾åç®—æ³•</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="in">- âœ… ç¡®å®šåŠ¨æ€åˆ†æçš„ hook ç‚¹æ¸…å•</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="in">- âœ… è¯†åˆ«æ½œåœ¨çš„åè°ƒè¯•/å hook æœºåˆ¶</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="in">- --</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="in">## é˜¶æ®µä¸‰ï¼šåŠ¨æ€åˆ†æï¼ˆ 2-4 å°æ—¶ï¼‰</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a><span class="in">* *ç›®æ ‡**ï¼šåœ¨è¿è¡Œæ—¶è§‚å¯Ÿå®é™…è¡Œä¸ºï¼ŒéªŒè¯é™æ€åˆ†æç»“è®ºï¼Œç»•è¿‡ä¿æŠ¤æœºåˆ¶ã€‚</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a><span class="in">## # æ­¥éª¤ 1ï¼šè®¾ç½® Frida ç¯å¢ƒ</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a><span class="in"># 1. å¯åŠ¨ Frida Serverï¼ˆåœ¨è®¾å¤‡ä¸Šï¼‰</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a><span class="in">adb push frida-server /data/local/tmp/</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a><span class="in">adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;</span></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a><span class="in">adb shell &quot;/data/local/tmp/frida-server &amp;&quot;</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a><span class="in"># 2. éªŒè¯è¿æ¥ï¼ˆåœ¨ PC ä¸Šï¼‰</span></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a><span class="in">frida-ps -U</span></span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a><span class="in"># åº”è¯¥çœ‹åˆ°è®¾å¤‡ä¸Šè¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨</span></span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a><span class="in"># 3. æµ‹è¯• hook</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a><span class="in">frida -U -f com.example.app --no-pause</span></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a><span class="in"># è¿›å…¥äº¤äº’å¼æ§åˆ¶å°</span></span></code></pre></div>
<p>åŸºäºé™æ€åˆ†æç»“æœï¼Œç¼–å†™ Frida è„šæœ¬ã€‚</p>
<h3 id="ç¤ºä¾‹-1hook-ä¼šå‘˜æ£€æŸ¥"># ç¤ºä¾‹ 1ï¼šHook ä¼šå‘˜æ£€æŸ¥</h3>
<div class="sourceCode" id="cb78"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">// hook_premium.js - ç»•è¿‡ VIP æ£€æŸ¥</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] å¼€å§‹ hook ä¼šå‘˜æ£€æŸ¥...&quot;</span>)<span class="op">;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> UserManager <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;com.example.app.user.UserManager&quot;</span>)<span class="op">;</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook isPremium æ–¹æ³•</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>UserManager<span class="op">.</span><span class="at">isPremium</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] isPremium() è¢«è°ƒç”¨&quot;</span>)<span class="op">;</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co">// è°ƒç”¨åŸå§‹æ–¹æ³•æŸ¥çœ‹çœŸå®ç»“æœ</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> realResult <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">isPremium</span>()<span class="op">;</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; çœŸå®è¿”å›å€¼: &quot;</span> <span class="op">+</span> realResult)<span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co">// å¼ºåˆ¶è¿”å› true</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; ä¿®æ”¹è¿”å›å€¼: true&quot;</span>)<span class="op">;</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Hook å®Œæˆ&quot;</span>)<span class="op">;</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>// hook_sign.js - æå–ç­¾åç®—æ³•</p>
<p>Java.perform(function() { var SignUtil =
Java.use(â€œcom.example.app.utils.SignUtilâ€);</p>
<p>SignUtil.generateSign.implementation = function(params) {
console.log(â€œgenerateSign() è¢«è°ƒç”¨â€); console.log(â€ å‚æ•°ç±»å‹: â€ +
params.$className);</p>
<p>// å¦‚æœæ˜¯ Mapï¼Œéå†æ‰“å° if (params.$className ===
â€œjava.util.HashMapâ€) { var HashMap = Java.use(â€œjava.util.HashMapâ€); var
entrySet = params.entrySet(); var iterator = entrySet.iterator();</p>
<p>console.log(â€ å‚æ•°å†…å®¹:â€œ); while (iterator.hasNext()) { var entry =
iterator.next(); var key = entry.getKey(); var value = entry.getValue();
console.log(â€ â€ + key + â€ = â€ + value); } }</p>
<p>// è°ƒç”¨åŸå§‹æ–¹æ³• var result = this.generateSign(params);</p>
<p>console.log(â€ ç­¾åç»“æœ: â€ + result); console.log(â€ ç­¾åé•¿åº¦: â€ +
result.length);</p>
<p>// æ‰“å°è°ƒç”¨æ ˆ console.log(â€ è°ƒç”¨æ ˆ:â€œ);
console.log(Java.use(â€android.util.Logâ€).getStackTraceString(
Java.use(â€œjava.lang.Exceptionâ€).$new() ));</p>
<p>return result; };</p>
<p>console.log(â€œ[+] ç­¾å hook å®Œæˆâ€); });</p>
<pre><code>
var encryptAddr = Module.findExportByName(&quot;libnative-lib.so&quot;,
&quot;Java_com_example_app_Crypto_encrypt&quot;);

if (encryptAddr) {
console.log(&quot;[+] æ‰¾åˆ° encrypt å‡½æ•°: &quot; + encryptAddr);

Interceptor.attach(encryptAddr, {
onEnter: function(args) {
console.log(&quot;\n[NATIVE] encrypt() è¢«è°ƒç”¨&quot;);
console.log(&quot; JNIEnv*: &quot; + args[0]);
console.log(&quot; jobject: &quot; + args[1]);

// ç¬¬ 3 ä¸ªå‚æ•°é€šå¸¸æ˜¯ jstringï¼ˆè¾“å…¥æ•°æ®ï¼‰
try {
var env = Java.vm.getEnv();
var inputStr = env.getStringUtfChars(args[2], null);
var input = inputStr.readCString();
console.log(&quot; è¾“å…¥: &quot; + input);
env.releaseStringUtfChars(args[2], inputStr);
} catch (e) {
console.log(&quot; è¾“å…¥: [æ— æ³•è¯»å–]&quot;);
}
},

onLeave: function(retval) {
// è¿”å›å€¼ä¹Ÿæ˜¯ jstringï¼ˆå¯†æ–‡ï¼‰
try {
var env = Java.vm.getEnv();
var outputStr = env.getStringUtfChars(retval, null);
var output = outputStr.readCString();
console.log(&quot; è¾“å‡º: &quot; + output);
env.releaseStringUtfChars(retval, outputStr);
} catch (e) {
console.log(&quot; è¾“å‡º: &quot; + retval);
}
}
});

console.log(&quot;[+] Native hook å®Œæˆ&quot;);
} else {
console.log(&quot;[-] æœªæ‰¾åˆ° encrypt å‡½æ•°&quot;);
}
</code></pre>
<p>// bypass_all.js - ç»¼åˆç»•è¿‡è„šæœ¬</p>
<p>Java.perform(function() { console.log(â€œ[+] åŠ è½½åæ£€æµ‹æ¨¡å—â€¦â€);</p>
<p>// 1. ç»•è¿‡ Frida ç«¯å£æ£€æµ‹ var connect =
Module.findExportByName(â€œlibc.soâ€, â€œconnectâ€);
Interceptor.attach(connect, { onEnter: function(args) { var sockaddr =
ptr(args[1]); var port = (sockaddr.add(2).readU8() &lt;&lt; 8) |
sockaddr.add(3).readU8(); if (port === 27042 || port === 27043) {
console.log(â€œâœ“ [æ£€æµ‹] æ‹¦æˆªäº† Frida ç«¯å£æ‰«æâ€);
sockaddr.add(2).writeU8(0xFF); } } });</p>
<p>// 2. ç»•è¿‡ TracerPid æ£€æµ‹ var fgets =
Module.findExportByName(â€œlibc.soâ€, â€œfgetsâ€); Interceptor.attach(fgets, {
onLeave: function(retval) { if (retval &amp;&amp; !retval.isNull()) {
var line = retval.readCString(); if (line &amp;&amp;
line.includes(â€œTracerPid:â€)) { retval.writeUtf8String(â€œTracerPid:â€);
console.log(â€œâœ“ [æ£€æµ‹] ä¿®æ”¹ TracerPid ä¸º 0â€); } } } });</p>
<p>// 3. ç»•è¿‡å­—ç¬¦ä¸²æ£€æµ‹ var strstr = Module.findExportByName(â€œlibc.soâ€,
â€œstrstrâ€); Interceptor.attach(strstr, { onLeave: function(retval) { if
(this.needle &amp;&amp; this.needle.toLowerCase().includes(â€œfridaâ€)) {
retval.replace(ptr(0)); console.log(â€œâœ“ [æ£€æµ‹] éšè— Frida å­—ç¬¦ä¸²â€); } },
onEnter: function(args) { this.needle = args[1].readCString(); } });</p>
<p>console.log(â€œ[+] åæ£€æµ‹æ¨¡å—åŠ è½½å®Œæˆâ€); });</p>
<pre><code>- l bypass_all.js \
- l hook_premium.js \
- -no-pause
</code></pre>
<h1 id="é…ç½®ä»£ç†">1. é…ç½®ä»£ç†</h1>
<p>adb shell settings put global http_proxy 192.168.1.100:8080</p>
<h1 id="å¯åŠ¨åº”ç”¨å¹¶ç»•è¿‡-ssl-pinning">2. å¯åŠ¨åº”ç”¨å¹¶ç»•è¿‡ SSL pinning</h1>
<p>frida -U -f com.example.app -l bypass_ssl_pinning.js â€“no-pause</p>
<h1 id="åœ¨-burp-suite-ä¸­æŸ¥çœ‹æµé‡">3. åœ¨ Burp Suite ä¸­æŸ¥çœ‹æµé‡</h1>
<pre><code>var RealInterceptorChain = Java.use(&quot;okhttp3.internal.http.RealInterceptorChain&quot;);

RealInterceptorChain.proceed.implementation = function(request) {
console.log(&quot;\n[HTTP] &quot; + request.method() + &quot; &quot; + request.url().toString());

// æ‰“å°è¯·æ±‚å¤´
var headers = request.headers();
for (var i = 0; i &lt; headers.size(); i++) {
console.log(&quot; &quot; + headers.name(i) + &quot;: &quot; + headers.value(i));
}

var response = this.proceed(request);

console.log(&quot;[RESP] Code: &quot; + response.code());

return response;
};
});
</code></pre>
<ul>
<li>âœ… æˆåŠŸç»•è¿‡ä¼šå‘˜æ£€æŸ¥ã€åè°ƒè¯•ç­‰é™åˆ¶</li>
<li>âœ… å®Œæ•´çš„ç½‘ç»œè¯·æ±‚/å“åº”æ—¥å¿—</li>
<li>âœ… å‡†å¤‡å¥½é‡æ‰“åŒ…çš„ä¿®æ”¹ç‚¹</li>
</ul>
<hr />
<h2 id="é˜¶æ®µå››ä»£ç ä¿®æ”¹ä¸é‡æ‰“åŒ…-30-60-åˆ†é’Ÿ">é˜¶æ®µå››ï¼šä»£ç ä¿®æ”¹ä¸é‡æ‰“åŒ…ï¼ˆ
30-60 åˆ†é’Ÿï¼‰</h2>
<ul>
<li>*ç›®æ ‡**ï¼šå¯¹åº”ç”¨è¿›è¡Œæ°¸ä¹…æ€§ä¿®æ”¹ï¼Œå®ç°æŒä¹…åŒ–çš„åŠŸèƒ½æ”¹å˜ã€‚</li>
</ul>
<h2 id="æ­¥éª¤-1ä¿®æ”¹-smali-ä»£ç "># æ­¥éª¤ 1ï¼šä¿®æ”¹ Smali ä»£ç </h2>
<p>åŸºäºåŠ¨æ€åˆ†æç»“æœï¼Œåœ¨ Smali å±‚é¢è¿›è¡Œä¿®æ”¹ã€‚</p>
<h3 id="ç¤ºä¾‹-1ç»•è¿‡ä¼šå‘˜æ£€æŸ¥"># ç¤ºä¾‹ 1ï¼šç»•è¿‡ä¼šå‘˜æ£€æŸ¥</h3>
<ul>
<li>*åŸå§‹ Java ä»£ç **ï¼ˆJadx åç¼–è¯‘ï¼‰ï¼š</li>
</ul>
<div class="sourceCode" id="cb82"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isPremium</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">userInfo</span><span class="op">.</span><span class="fu">vipStatus</span> <span class="op">==</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="è¯»å–-userinfo.vipstatus">è¯»å– userInfo.vipStatus</h1>
<p>iget-object v0, p0,
Lcom/example/app/user/UserManager;-&gt;userInfo:Lcom/example/app/model/UserInfo;
iget v0, v0, Lcom/example/app/model/UserInfo;-&gt;vipStatus:I</p>
<h1 id="æ¯”è¾ƒæ˜¯å¦ç­‰äº-1">æ¯”è¾ƒæ˜¯å¦ç­‰äº 1</h1>
<p>const/4 v1, 0x1 if-ne v0, v1, :cond_0</p>
<h1 id="å¦‚æœç›¸ç­‰è¿”å›-true">å¦‚æœç›¸ç­‰ï¼Œè¿”å› true</h1>
<p>const/4 v0, 0x1 return v0</p>
<h1 id="å¦‚æœä¸ç›¸ç­‰è¿”å›-false">å¦‚æœä¸ç›¸ç­‰ï¼Œè¿”å› false</h1>
<p>:cond_0 const/4 v0, 0x0 return v0 .end method</p>
<pre><code>
# ç›´æ¥è¿”å› trueï¼Œè·³è¿‡æ‰€æœ‰æ£€æŸ¥
const/4 v0, 0x1
return v0
.end method
</code></pre>
<p>.method private showAd()V .locals 1</p>
<h1 id="æ£€æŸ¥æ˜¯å¦ä¸æ˜¯-vip">æ£€æŸ¥æ˜¯å¦ä¸æ˜¯ VIP</h1>
<p>invoke-virtual {p0}, Lcom/example/app/MainActivity;-&gt;isPremium()Z
move-result v0</p>
<h1 id="å¦‚æœä¸æ˜¯-vipæ˜¾ç¤ºå¹¿å‘Š">å¦‚æœä¸æ˜¯ VIPï¼Œæ˜¾ç¤ºå¹¿å‘Š</h1>
<p>if-nez v0, :cond_0 invoke-direct {p0},
Lcom/example/app/MainActivity;-&gt;loadAdView()V</p>
<p>:cond_0 return-void .end method</p>
<pre><code>
# ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ
return-void
.end method
</code></pre>
<div class="sourceCode" id="cb85"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ä½¿ç”¨ Apktool é‡æ‰“åŒ…</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> b target_unpacked <span class="at">-o</span> modified.apk</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºï¼š</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Using Apktool 2.x.x</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Checking whether sources has changed...</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Smali folder: smali</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Smali folder: smali_classes2</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Copying raw resources...</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Copying libs... (/lib)</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Copying assets... (/assets)</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Building apk file...</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Copying unknown files/dir...</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># I: Built apk into: modified.apk</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. æ£€æŸ¥ç”Ÿæˆçš„ APK</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> modified.apk</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># -rw-r--r-- 1 user user 8.5M modified.apk</span></span></code></pre></div>
<div class="sourceCode" id="cb86"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ç”Ÿæˆç­¾åå¯†é’¥ï¼ˆåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼‰</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="ex">keytool</span> <span class="at">-genkey</span> <span class="at">-v</span> <span class="dt">\</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>- keystore my-release-key.keystore <span class="dt">\</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>- alias my-key-alias <span class="dt">\</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>- keyalg RSA <span class="dt">\</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>- keysize 2048 <span class="dt">\</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>- validity 10000</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co"># æç¤ºè¾“å…¥å¯†ç å’Œä¿¡æ¯ï¼š</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Enter keystore password: [è¾“å…¥å¯†ç ]</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-enter new password: [å†æ¬¡è¾“å…¥]</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># What is your first and last name? [éšæ„å¡«å†™]</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ç­¾å APK</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="ex">apksigner</span> sign <span class="dt">\</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>- <span class="at">-ks</span> my-release-key.keystore <span class="dt">\</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>- <span class="at">-ks-key-alias</span> my-key-alias <span class="dt">\</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>- <span class="at">-out</span> signed.apk <span class="dt">\</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>modified.apk</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="co"># æç¤ºè¾“å…¥ keystore å¯†ç </span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºï¼šsigned.apk</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. éªŒè¯ç­¾å</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a><span class="ex">apksigner</span> verify signed.apk</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºï¼šVerifies</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a><span class="co"># è¡¨ç¤ºç­¾åæˆåŠŸ</span></span></code></pre></div>
<p>java -jar uber-apk-signer.jar â€“apks modified.apk</p>
<h1
id="è¾“å‡ºmodified-aligned-debugsigned.apk">è¾“å‡ºï¼šmodified-aligned-debugSigned.apk</h1>
<pre><code>
```bash
# 1. å¸è½½åŸåº”ç”¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
adb uninstall com.example.app

# 2. å®‰è£…ä¿®æ”¹åçš„ APK
adb install signed.apk

# å¦‚æœé‡åˆ°ç­¾åå†²çªï¼š
# adb install -r signed.apk (æ›¿æ¢å®‰è£…)

# 3. å¯åŠ¨åº”ç”¨
adb shell am start -n com.example.app/.MainActivity

# 4. æŸ¥çœ‹æ—¥å¿—éªŒè¯ä¿®æ”¹
adb logcat | grep &quot;example.app&quot;
</code></pre>
<ul class="task-list">
<li><label><input type="checkbox" />ä¿®æ”¹çš„åŠŸèƒ½ç”Ÿæ•ˆï¼ˆä¾‹å¦‚ VIP
æƒé™è§£é”ï¼‰</label></li>
<li><label><input type="checkbox" />æ²¡æœ‰å´©æºƒæˆ–å¼‚å¸¸è¡Œä¸º</label></li>
<li><label><input
type="checkbox" />ç½‘ç»œåŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚æœä¿®æ”¹äº†ç­¾åç›¸å…³ä»£ç ï¼‰</label></li>
</ul>
<h3 id="å¸¸è§é—®é¢˜æ’æŸ¥"># å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<div class="sourceCode" id="cb88"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹å´©æºƒæ—¥å¿—</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> logcat <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;AndroidRuntime&quot;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># å¸¸è§é”™è¯¯ï¼š</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. &quot;INSTALL_PARSE_FAILED_NO_CERTIFICATES&quot;</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># â†’ ç­¾åå¤±è´¥ï¼Œé‡æ–°ç­¾å</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. &quot;INSTALL_FAILED_UPDATE_INCOMPATIBLE&quot;</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># â†’ ç­¾åä¸åŒ¹é…ï¼Œå…ˆå¸è½½åŸåº”ç”¨</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. åº”ç”¨å´©æºƒ</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co"># â†’ æŸ¥çœ‹ logcatï¼Œå¯èƒ½æ˜¯ Smali è¯­æ³•é”™è¯¯</span></span></code></pre></div>
<p>é¿å…ç›²ç›®åˆ†ææµªè´¹æ—¶é—´ â†“ é™æ€åˆ†æ (1-3å°æ—¶) â†“ ç†è§£ä»£ç é€»è¾‘å’Œç®—æ³•
å®šä½å…³é”®å‡½æ•°å’Œ hook ç‚¹ â†“ åŠ¨æ€åˆ†æ (2-4å°æ—¶) â†“ éªŒè¯é™æ€åˆ†æç»“è®º
ç»•è¿‡è¿è¡Œæ—¶ä¿æŠ¤ è·å–å®é™…æ•°æ®ï¼ˆå¯†é’¥ã€API å‚æ•°ï¼‰ â†“ ä»£ç ä¿®æ”¹ (30-60åˆ†é’Ÿ) â†“
æ°¸ä¹…æ€§ä¿®æ”¹ æ— éœ€æ¯æ¬¡éƒ½ä½¿ç”¨ Frida</p>
<pre><code>| **ç»•è¿‡æ··æ·†** | âŒ å›°éš¾ | âœ… å¯è¡Œ | âœ… é«˜æ•ˆ |
| **è·å–å¯†é’¥** | âŒ éš¾ï¼ˆå¯èƒ½ç¡¬ç¼–ç ï¼‰| âœ… æ˜“ï¼ˆè¿è¡Œæ—¶ï¼‰| âœ… æœ€ä½³ |
| **ä¿®æ”¹ä»£ç ** | âœ… ç²¾ç¡® | âŒ ä¸æŒä¹… | âœ… çµæ´» |
| **æ—¶é—´æˆæœ¬** | é«˜ï¼ˆæœ‰æ··æ·†æ—¶ï¼‰| ä¸­ç­‰ | ä½ï¼ˆäº’è¡¥ï¼‰|

- --

## å¸¸è§é—®é¢˜

## # âŒ é—®é¢˜ 1ï¼šApktool è§£åŒ…å¤±è´¥

* *é”™è¯¯ä¿¡æ¯**ï¼š`brut.androlib.AndrolibException: Could not decode arsc file`

* *å¯èƒ½åŸå› **ï¼š
1. APK ä½¿ç”¨äº†èµ„æºæ··æ·†ï¼ˆAndResGuardï¼‰
2. APK å·²æŸå
3. Apktool ç‰ˆæœ¬è¿‡æ—§


* *è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. æ›´æ–° Apktool åˆ°æœ€æ–°ç‰ˆæœ¬
# ä¸‹è½½ï¼šhttps://ibotpeaches.github.io/Apktool/

# 2. ä½¿ç”¨ -r å‚æ•°è·³è¿‡èµ„æºè§£ç 
apktool d target.apk -r -o target_unpacked
# -r: ä¸è§£ç èµ„æºæ–‡ä»¶ (resources.arsc)

# 3. ä½¿ç”¨ --only-main-classes ä»…è§£ç ä¸» DEX
apktool d target.apk --only-main-classes -o target_unpacked

# 4. å¦‚æœåªéœ€è¦ Smaliï¼Œç›´æ¥ä½¿ç”¨ dex2jar + jd-gui
d2j-dex2jar target.apk
# ç”Ÿæˆ target-dex2jar.jarï¼Œç”¨ JD-GUI æ‰“å¼€
</code></pre>
<ul>
<li>*è§£å†³æ–¹æ¡ˆ**ï¼š</li>
</ul>
<div class="sourceCode" id="cb90"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ä¼˜å…ˆä½¿ç”¨åŠ¨æ€åˆ†æ</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># æ··æ·†çš„ä»£ç åœ¨è¿è¡Œæ—¶è¡Œä¸ºä¸å˜</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨ Frida ç›´æ¥ hookï¼Œè§‚å¯Ÿå‚æ•°å’Œè¿”å›å€¼</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. åˆ©ç”¨å­—ç¬¦ä¸²å¸¸é‡å®šä½</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># å­—ç¬¦ä¸²é€šå¸¸ä¸ä¼šè¢«æ··æ·†</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># åœ¨ Jadx ä¸­æœç´¢å…³é”®å­—ç¬¦ä¸²ï¼Œåå‘å®šä½ä»£ç </span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. é‡å‘½åç±»/æ–¹æ³•ï¼ˆJadx æ”¯æŒï¼‰</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co"># å³é”®ç±»å â†’ Rename</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co"># æ ¹æ®åŠŸèƒ½æ‰‹åŠ¨é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ä½¿ç”¨ç¬¦å·è¿˜åŸå·¥å…·</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœæœ‰ mapping.txtï¼ˆæ··æ·†æ˜ å°„æ–‡ä»¶ï¼‰</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="co"># å¯ä»¥ä½¿ç”¨å·¥å…·è¿˜åŸç¬¦å·</span></span></code></pre></div>
<ol type="1">
<li>åº”ç”¨æœªè¿è¡Œ</li>
<li>åŒ…åé”™è¯¯</li>
<li>Frida Server æœªå¯åŠ¨</li>
</ol>
<ul>
<li>*è§£å†³æ–¹æ¡ˆ**ï¼š</li>
</ul>
<div class="sourceCode" id="cb91"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. æ£€æŸ¥ Frida Server æ˜¯å¦è¿è¡Œ</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell ps <span class="kw">|</span> <span class="fu">grep</span> frida-server</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œéœ€è¦å¯åŠ¨ Frida Server</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ç¡®è®¤åº”ç”¨æ­£åœ¨è¿è¡Œ</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell ps <span class="kw">|</span> <span class="fu">grep</span> com.example.app</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># æˆ–</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span> <span class="kw">|</span> <span class="fu">grep</span> example</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ä½¿ç”¨æ­£ç¡®çš„åŒ…å</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹å·²å®‰è£…åº”ç”¨çš„åŒ…å</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell pm list packages <span class="kw">|</span> <span class="fu">grep</span> example</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ä½¿ç”¨ spawn æ¨¡å¼ï¼ˆè‡ªåŠ¨å¯åŠ¨åº”ç”¨ï¼‰</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-l</span> script.js <span class="at">--no-pause</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="co"># -f: spawn æ¨¡å¼ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨åº”ç”¨</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. æ£€æŸ¥è®¾å¤‡è¿æ¥</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> devices</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="co"># åº”æ˜¾ç¤ºï¼šdeviceï¼ˆä¸æ˜¯ offline æˆ– unauthorizedï¼‰</span></span></code></pre></div>
<ol type="1">
<li>Smali è¯­æ³•é”™è¯¯</li>
<li>ä¿®æ”¹ç ´åäº†ç±»ç»“æ„</li>
<li>ç¼ºå°‘ä¾èµ–</li>
</ol>
<ul>
<li>*è§£å†³æ–¹æ¡ˆ**ï¼š</li>
</ul>
<div class="sourceCode" id="cb92"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. æŸ¥çœ‹è¯¦ç»†å´©æºƒæ—¥å¿—</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> logcat <span class="at">-c</span> <span class="co"># æ¸…ç©ºæ—¥å¿—</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> logcat <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">&quot;AndroidRuntime|FATAL&quot;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. éªŒè¯ Smali è¯­æ³•</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ç”¨ Apktool é‡æ–°åç¼–è¯‘ä¿®æ”¹åçš„ APK</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> d signed.apk <span class="at">-o</span> verify_unpacked</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æç¤º</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. å›æ»šä¿®æ”¹ï¼Œé€æ­¥æµ‹è¯•</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="co"># å…ˆä¿®æ”¹å•ä¸ªæ–¹æ³•ï¼Œé€šè¿‡åå†ä¿®æ”¹å…¶ä»–</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ä½¿ç”¨ baksmali/smali éªŒè¯</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="ex">baksmali</span> d modified.apk <span class="at">-o</span> smali_test</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="ex">smali</span> a smali_test <span class="at">-o</span> test.dex</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¯´æ˜ Smali è¯­æ³•æ­£ç¡®</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. æ£€æŸ¥æ–¹æ³•ç­¾åæ˜¯å¦æ­£ç¡®</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ç¡®ä¿ä¿®æ”¹çš„æ–¹æ³•ç­¾åä¸æ¥å£/çˆ¶ç±»åŒ¹é…</span></span></code></pre></div>
<p>|â€”â€”|â€”â€”| | <a href="../Network/network_sniffing.md">Recipe | Android
åº”ç”¨ç½‘ç»œæµé‡åˆ†æ</a> - è¯¦ç»†çš„ç½‘ç»œæµé‡åˆ†ææ­¥éª¤ | | <a
href="../Anti-Detection/frida_anti_debugging.md">Recipe | ç»•è¿‡åº”ç”¨å¯¹
Frida çš„æ£€æµ‹</a> - åè°ƒè¯•ç»•è¿‡ | | <a
href="../Unpacking/un-packing.md">Recipe | è„±å£³å’Œåˆ†æåŠ å›ºçš„ Android
åº”ç”¨</a> - å¤„ç†åŠ å£³åº”ç”¨ | | <a
href="../Scripts/frida_common_scripts.md">Recipe | Frida
å¸¸ç”¨è„šæœ¬é€ŸæŸ¥</a> - ç°æˆçš„è„šæœ¬æ¨¡æ¿ |</p>
<h2 id="å·¥å…·æ·±å…¥"># å·¥å…·æ·±å…¥</h2>
<ul>
<li><a href="../../02-Tools/Dynamic/frida_guide.md">Frida ä½¿ç”¨æŒ‡å—</a> -
å®Œæ•´çš„ Frida ä½¿ç”¨æ‰‹å†Œ</li>
<li><a href="../../02-Tools/Static/ghidra_guide.md">Ghidra ä½¿ç”¨æŒ‡å—</a>
- Native ä»£ç åˆ†æ</li>
<li><a href="../../02-Tools/Static/ida_pro_guide.md">IDA Pro
ä½¿ç”¨æŒ‡å—</a> - ä¸“ä¸šé€†å‘å·¥ç¨‹å·¥å…·</li>
</ul>
<h2 id="æ¡ˆä¾‹ç ”ç©¶"># æ¡ˆä¾‹ç ”ç©¶</h2>
<ul>
<li><a
href="../../03-Case-Studies/case_music_apps.md">æ¡ˆä¾‹ï¼šéŸ³ä¹åº”ç”¨åˆ†æ</a> -
å®Œæ•´å·¥ä½œæµç¨‹å®è·µ</li>
<li><a
href="../../03-Case-Studies/case_study_app_encryption.md">æ¡ˆä¾‹ï¼šåº”ç”¨åŠ å¯†åˆ†æ</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"># å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="../../04-Reference/Foundations/apk_structure.md">APK
æ–‡ä»¶ç»“æ„è¯¦è§£</a></li>
<li><a href="../../04-Reference/Foundations/smali_syntax.md">Smali
è¯­æ³•å‚è€ƒ</a></li>
<li><a
href="../../04-Reference/Foundations/android_components.md">Android
ç»„ä»¶è¯¦è§£</a></li>
</ul>
<hr />
<h2 id="é€ŸæŸ¥æ‰‹å†Œ">é€ŸæŸ¥æ‰‹å†Œ</h2>
<h2 id="å·¥ä½œæµç¨‹å¿«é€Ÿåœ°å›¾"># å·¥ä½œæµç¨‹å¿«é€Ÿåœ°å›¾</h2>
<pre><code>è§£åŒ… APK åˆ†æ Manifest æŸ¥çœ‹ç›®å½•
â”‚ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
ç¡®å®šåˆ†ææ–¹å‘
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â†“ â†“
é™æ€åˆ†æ åŠ¨æ€åˆ†æ
(Jadx/IDA) (Frida)
â”‚ â”‚
â”œâ”€ å®šä½å…³é”®ä»£ç  â”‚
â”œâ”€ ç†è§£ç®—æ³•é€»è¾‘ â”‚
â””â”€ ç¡®å®š hook ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
â†“ â†“
Hook éªŒè¯ ç»•è¿‡ä¿æŠ¤
â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
æå–å…³é”®æ•°æ®
(å¯†é’¥/ç®—æ³•)
â†“
ä¿®æ”¹ Smali
â†“
é‡æ‰“åŒ… &amp; ç­¾å
â†“
æµ‹è¯• &amp; éªŒè¯
</code></pre>
<div class="line-block"><strong>è§£åŒ…</strong> | Apktool |
<code>apktool d app.apk -o unpacked</code> |<br />
<strong>åç¼–è¯‘</strong> | Jadx | <code>jadx-gui app.apk</code> |<br />
<strong>Native åˆ†æ</strong> | IDA/Ghidra | ç›´æ¥æ‰“å¼€ <code>.so</code>
æ–‡ä»¶ |<br />
<strong>åŠ¨æ€åˆ†æ</strong> | Frida |
<code>frida -U -f &lt;pkg&gt; -l script.js --no-pause</code> |<br />
<strong>é‡æ‰“åŒ…</strong> | Apktool |
<code>apktool b unpacked -o modified.apk</code> |<br />
<strong>ç­¾å</strong> | apksigner |
<code>apksigner sign --ks key.keystore --out signed.apk modified.apk</code>
|<br />
<strong>å®‰è£…</strong> | ADB | <code>adb install signed.apk</code>
|</div>
<h2 id="å¸¸ç”¨å¿«æ·æ“ä½œ"># âš¡ å¸¸ç”¨å¿«æ·æ“ä½œ</h2>
<div class="sourceCode" id="cb94"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ä¸€é”®æå– APK è„šæœ¬ï¼ˆä¿å­˜ä¸º get-apk.shï¼‰</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !/bin/bash</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="va">PKG</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">$(</span><span class="ex">adb</span> shell pm path <span class="va">$PKG</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d:</span> <span class="at">-f2</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&#39;\r&#39;</span><span class="va">)</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull <span class="va">$PATH</span> ./<span class="va">$PKG</span>.apk</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;[+] å·²ä¿å­˜: </span><span class="va">$PKG</span><span class="st">.apk&quot;</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨ï¼š./get-apk.sh com.example.app</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ä¸€é”®è§£åŒ… + åç¼–è¯‘</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> d app.apk <span class="kw">&amp;&amp;</span> <span class="ex">jadx-gui</span> app.apk <span class="kw">&amp;</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. å¿«é€ŸæŸ¥çœ‹ Manifest</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> d <span class="at">-s</span> app.apk <span class="at">-o</span> temp <span class="kw">&amp;&amp;</span> <span class="fu">cat</span> temp/AndroidManifest.xml</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. è‡ªåŠ¨ç­¾åè„šæœ¬ï¼ˆä¿å­˜ä¸º sign-apk.shï¼‰</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a><span class="co"># !/bin/bash</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="va">APK</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> uber-apk-signer.jar <span class="at">--apks</span> <span class="va">$APK</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;[+] ç­¾å APK å·²åˆ›å»º&quot;</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Frida å¿«é€Ÿ hookï¼ˆäº¤äº’æ¨¡å¼ï¼‰</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> com.example.app</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="co"># è¿›å…¥åæ‰§è¡Œ:</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Java.perform(function() {</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="co"># var cls = Java.use(&quot;com.example.Class&quot;);</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a><span class="co"># cls.method.implementation = function() { return true; };</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="co"># });</span></span></code></pre></div>
<p>â”‚ â””â”€ æœ‰ â†’ ç›´æ¥é˜…è¯»ä»£ç  â†’ åŠ¨æ€éªŒè¯ â”‚ â””â”€ æ—  â†’ ç»§ç»­ â”‚ â”œâ”€ æ˜¯å¦åŠ å£³? â”‚ â””â”€
æ˜¯ â†’ å…ˆè„±å£³ï¼ˆå‚è§è„±å£³ Recipeï¼‰ â”‚ â””â”€ å¦ â†’ ç»§ç»­ â”‚ â”œâ”€ æ˜¯å¦æ··æ·†? â”‚ â””â”€
é‡åº¦æ··æ·† â†’ ä¼˜å…ˆåŠ¨æ€åˆ†æï¼ˆFridaï¼‰ â”‚ â””â”€ è½»åº¦/æ—  â†’ ä¼˜å…ˆé™æ€åˆ†æï¼ˆJadxï¼‰ â”‚
â”œâ”€ Native ä»£ç å¤š? â”‚ â””â”€ æ˜¯ â†’ ç”¨ IDA/Ghidra åˆ†æ .so â”‚ â””â”€ å¦ â†’ ä¸“æ³¨ Java
å±‚ â”‚ â””â”€ æœ‰åè°ƒè¯•? â””â”€ æ˜¯ â†’ å…ˆç»•è¿‡æ£€æµ‹ â””â”€ å¦ â†’ ç›´æ¥ hook</p>
<pre><code></code></pre>
<!-- 01-Recipes/Analysis/static_analysis_deep_dive.md -->
<h1 id="recipe-ä½¿ç”¨é™æ€åˆ†æå®šä½-android-app-çš„å…³é”®é€»è¾‘">Recipe:
ä½¿ç”¨é™æ€åˆ†æå®šä½ android App çš„å…³é”®é€»è¾‘</h1>
<h2 id="é—®é¢˜åœºæ™¯-2">é—®é¢˜åœºæ™¯</h2>
<p>*ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ*</p>
<ul>
<li>ä½ æƒ³æ‰¾åˆ° App çš„åŠ å¯†/ç­¾åç®—æ³•ï¼Œä½†ä»£ç å¤ªå¤šä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹</li>
<li>ğŸ§© ä½ æƒ³ç†è§£ App çš„å®Œæ•´ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬æ‰€æœ‰åˆ†æ”¯å’Œè¾¹ç•Œæ¡ä»¶</li>
<li>ğŸ› ä½ æƒ³å¯»æ‰¾å®‰å…¨æ¼æ´ï¼Œæ¯”å¦‚ç¡¬ç¼–ç å¯†é’¥ã€é€»è¾‘ç¼ºé™·</li>
<li>ä½ æƒ³åœ¨æ²¡æœ‰è¿è¡Œç¯å¢ƒçš„æƒ…å†µä¸‹åˆ†æ APK</li>
<li>ä½ æƒ³è¿›è¡Œæ‰¹é‡è‡ªåŠ¨åŒ–åˆ†æ</li>
</ul>
<p>*æœ¬é…æ–¹æ•™ä½ *ï¼šç³»ç»Ÿæ€§åœ°ä½¿ç”¨é™æ€åˆ†æå·¥å…·ï¼ˆjadx, IDA Pro,
Ghidraï¼‰å¿«é€Ÿå®šä½å…³é”®ä»£ç ã€è¿½è¸ªæ•°æ®æµã€è¯†åˆ«åŠ å¯†ç®—æ³•ã€‚</p>
<p>*æ ¸å¿ƒç†å¿µ*ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>é™æ€åˆ†æï¼šä¸è¿è¡Œä»£ç ï¼Œçœ‹æ¸…å…¨å±€</strong></p>
<ul>
<li>é™æ€åˆ†æèƒ½çœ‹åˆ°æ‰€æœ‰ä»£ç è·¯å¾„ï¼ˆåŒ…æ‹¬æœªè§¦å‘çš„åˆ†æ”¯ï¼‰</li>
<li>é€‚åˆç†è§£å®Œæ•´ç®—æ³•å’Œå¯»æ‰¾æ¼æ´</li>
<li>å…ˆåŠ¨æ€è·å–çº¿ç´¢ï¼Œå†é™æ€æ·±å…¥åˆ†æ</li>
<li>äº¤æ›¿è¿­ä»£ï¼šåŠ¨æ€å‘ç° â†’ é™æ€éªŒè¯ â†’ åŠ¨æ€æµ‹è¯•</li>
</ul>
</blockquote>
<p>*é¢„è®¡ç”¨æ—¶*: 40-90 åˆ†é’Ÿ ___ ## å·¥å…·æ¸…å•</p>
<h2 id="å¿…éœ€å·¥å…·-2"># å¿…éœ€å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>jadx-gui</strong> - Java/Smali åç¼–è¯‘</li>
</ul></li>
<li><ul>
<li><strong>IDA Pro / Ghidra</strong> - Native å±‚åˆ†æ</li>
</ul></li>
<li><ul>
<li><strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong> - è®°å½•åˆ†æç¬”è®°</li>
</ul></li>
</ul>
<h2 id="å¯é€‰å·¥å…·-2"># å¯é€‰å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>Binary Ninja</strong> - å¯è§†åŒ– CFG</li>
</ul></li>
<li><ul>
<li><strong>FindCrypt</strong> (IDA æ’ä»¶) - è¯†åˆ«åŠ å¯†ç®—æ³•</li>
</ul></li>
<li><ul>
<li><strong>YARA</strong> - æ¨¡å¼åŒ¹é…</li>
</ul></li>
<li><ul>
<li><strong>angr</strong> - ç¬¦å·æ‰§è¡Œï¼ˆé«˜çº§ï¼‰ ___ ## å‰ç½®æ¡ä»¶</li>
</ul></li>
</ul>
<h2 id="ç¡®è®¤æ¸…å•-1"># âœ… ç¡®è®¤æ¸…å•</h2>
<div class="sourceCode" id="cb96"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. jadx-gui å·²å®‰è£…</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx-gui</span> <span class="at">--version</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. IDA Pro or Ghidra å¯ç”¨</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># IDA Pro: å•†ä¸šè½¯ä»¶</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ghidra: å…è´¹ï¼Œä¸‹è½½è‡ª https://ghidra-sre.org/</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. APK æ–‡ä»¶å·²è§£å‹</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> app.apk <span class="at">-d</span> app_unzipped</span></code></pre></div>
<h2 id="é™æ€-vs-åŠ¨æ€ä½•æ—¶é€‰æ‹©ä»€ä¹ˆ"># ğŸ¤” é™æ€ vs åŠ¨æ€ï¼šä½•æ—¶é€‰æ‹©ä»€ä¹ˆï¼Ÿ</h2>
<table>
<colgroup>
<col style="width: 41%" />
<col style="width: 11%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr>
<th>ä½ çš„ç›®æ ‡</th>
<th>æ¨èèµ·ç‚¹</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¿«é€Ÿæå–ç»“æœ</strong>ï¼ˆå¦‚åŠ å¯†å‚æ•°ï¼‰</td>
<td>åŠ¨æ€ä¼˜å…ˆ</td>
<td>ç›´æ¥ Hook æ‹¿ç»“æœï¼Œä¸å¿…ç†è§£å…¨éƒ¨é€»è¾‘</td>
</tr>
<tr>
<td><strong>ç†è§£å®Œæ•´ç®—æ³•</strong>ï¼ˆå¦‚åè®®é€†å‘ï¼‰</td>
<td>é™æ€ä¼˜å…ˆ</td>
<td>éœ€è¦çœ‹æ¸…æ‰€æœ‰åˆ†æ”¯å’Œè¾¹ç•Œæ¡ä»¶</td>
</tr>
<tr>
<td><strong>å¯»æ‰¾æ¼æ´</strong></td>
<td>é™æ€ä¼˜å…ˆ</td>
<td>éœ€è¦è¦†ç›–æ‰€æœ‰ä»£ç è·¯å¾„ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†</td>
</tr>
<tr>
<td><strong>å¯¹æŠ—æ··æ·†/åŠ å£³</strong></td>
<td>åŠ¨æ€ä¼˜å…ˆ</td>
<td>é™æ€åˆ†æå¯èƒ½å®Œå…¨å¤±æ•ˆï¼Œå…ˆåŠ¨æ€è„±å£³</td>
</tr>
<tr>
<td><strong>æ‰¹é‡è‡ªåŠ¨åŒ–</strong></td>
<td>é™æ€ä¼˜å…ˆ</td>
<td>åŠ¨æ€åˆ†æéœ€è¦è¿è¡Œç¯å¢ƒï¼Œé™æ€å¯ç¦»çº¿</td>
</tr>
</tbody>
</table>
<p>*æœ€ä½³å®è·µ*ï¼š</p>
<ol type="1">
<li><strong>å…ˆåŠ¨æ€è·å–çº¿ç´¢</strong> - ç”¨ Frida å¿«é€Ÿå®šä½å…³é”®å‡½æ•°</li>
<li><strong>å†é™æ€æ·±å…¥åˆ†æ</strong> - æœ‰äº†â€åœ°å›¾â€åæ›´æœ‰æ–¹å‘æ€§</li>
<li><strong>äº¤æ›¿è¿­ä»£</strong> - åŠ¨æ€å‘ç°çš„ç–‘ç‚¹ç”¨é™æ€éªŒè¯ ___ ##
è§£å†³æ–¹æ¡ˆ</li>
</ol>
<h2 id="ç¬¬-1-æ­¥ç¡®å®šåˆ†æç›®æ ‡5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šç¡®å®šåˆ†æç›®æ ‡ï¼ˆ5
åˆ†é’Ÿï¼‰</h2>
<p>*æ˜ç¡®ä½ æƒ³æ‰¾ä»€ä¹ˆ*ï¼š</p>
<ul>
<li><ul>
<li>API ç­¾åç®—æ³•</li>
</ul></li>
<li><ul>
<li>åŠ å¯†å¯†é’¥ä½ç½®</li>
</ul></li>
<li><ul>
<li>ç½‘ç»œåè®®é€»è¾‘</li>
</ul></li>
<li><ul>
<li>ç‰¹å®šåŠŸèƒ½å®ç°ï¼ˆå¦‚ç™»å½•ã€æ”¯ä»˜ï¼‰</li>
</ul></li>
<li><ul>
<li>å®‰å…¨æ¼æ´</li>
</ul></li>
</ul>
<p>*ç¤ºä¾‹*ï¼šå‡è®¾ç›®æ ‡æ˜¯æ‰¾åˆ° API è¯·æ±‚çš„ç­¾åé€»è¾‘ ___ ## # ç¬¬ 2
æ­¥ï¼šä»å­—ç¬¦ä¸²å…¥æ‰‹ï¼ˆ10 åˆ†é’Ÿï¼‰</p>
<p>*æœ€æœ‰æ•ˆçš„èµ·ç‚¹*ï¼šæœç´¢å…³é”®å­—ç¬¦ä¸²</p>
<h2 id="jadx-gui-å­—ç¬¦ä¸²æœç´¢"># # 2.1 jadx-gui å­—ç¬¦ä¸²æœç´¢</h2>
<pre><code>md5
sha
hmac
key
secret
encrypt
</code></pre>
<p>HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();
params.put(â€œsignâ€, generateSign(data));</p>
<pre><code></code></pre>
<ol type="1">
<li>å³é”®ç‚¹å‡» <code>generateSign</code> å‡½æ•°</li>
<li>é€‰æ‹© <strong>â€œFind Usageâ€</strong> æˆ–æŒ‰ <code>X</code></li>
<li>æŸ¥çœ‹æ‰€æœ‰è°ƒç”¨ç‚¹</li>
</ol>
<p>*åœ¨ IDA Pro ä¸­*ï¼š</p>
<ol type="1">
<li>å…‰æ ‡ç§»åˆ°å‡½æ•°å</li>
<li>æŒ‰ <code>X</code> é”®</li>
<li>æŸ¥çœ‹ <strong>Xrefs to</strong>ï¼ˆè¢«è°è°ƒç”¨ï¼‰å’Œ <strong>Xrefs
from</strong>ï¼ˆè°ƒç”¨äº†è°ï¼‰</li>
</ol>
<h2 id="å‘ä¸Šè¿½æº¯è°ƒç”¨é“¾"># # 3.2 å‘ä¸Šè¿½æº¯è°ƒç”¨é“¾</h2>
<pre><code>RequestBuilder.buildParams()
â†“
SignUtils.generateSign() â† ç›®æ ‡å‡½æ•°
</code></pre>
<p>// Step 1: Sort parameters TreeMap&lt;String, String&gt; sortedParams
= new TreeMap&lt;&gt;(params);</p>
<p>// Step 2: Concatenate string StringBuilder sb = new StringBuilder();
for (Map.Entry&lt;String, String&gt; entry : sortedParams.entrySet()) {
sb.append(entry.getKey()).append(â€œ=â€).append(entry.getValue()).append(â€œ&amp;â€);
} sb.append(â€œkey=â€).append(SECRET_KEY);</p>
<p>// Step 3: Calculate MD5 return MD5.encode(sb.toString());</p>
<p>}</p>
<pre><code>___
## # ç¬¬ 4 æ­¥ï¼šæ•°æ®æµåˆ†æï¼ˆ15 åˆ†é’Ÿï¼‰

* *ç›®æ ‡**ï¼šè¿½è¸ª `SECRET_KEY` çš„æ¥æº

## # # 4.1 æŸ¥æ‰¾å˜é‡å®šä¹‰

* *åœ¨ jadx ä¸­**ï¼š

1. ç‚¹å‡» `SECRET_KEY`
2. Ctrl+Click è·³è½¬åˆ°å®šä¹‰


* *å¯èƒ½çš„æƒ…å†µ**ï¼š

&lt;details&gt;
&lt;summary&gt;&lt;b&gt;æƒ…å†µ 1: ç¡¬ç¼–ç ï¼ˆæœ€ç®€å•ï¼‰&lt;/b&gt;&lt;/summary&gt;

```java
private static final String SECRET_KEY = &quot;abc123def456&quot;;
</code></pre>
<summary>
<b>æƒ…å†µ 2: ä»é…ç½®æ–‡ä»¶è¯»å–</b>
</summary>
<div class="sourceCode" id="cb101"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="op">{</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">load</span><span class="op">(</span>context<span class="op">.</span><span class="fu">getAssets</span><span class="op">().</span><span class="fu">open</span><span class="op">(</span><span class="st">&quot;config.properties&quot;</span><span class="op">));</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>SECRET_KEY <span class="op">=</span> props<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">&quot;api.secret&quot;</span><span class="op">);</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">IOException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>SECRET_KEY <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>cat app_unzipped/assets/config.properties</p>
<pre><code>
```java
static {
System.loadLibrary(&quot;native-lib&quot;);
SECRET_KEY = getKeyFromNative();
}

private static native String getKeyFromNative();
</code></pre>
<p>åœ¨ Ghidra åç¼–è¯‘çª—å£ï¼š</p>
<ol type="1">
<li>åŒå‡»å˜é‡å</li>
<li>æ‰€æœ‰ä½¿ç”¨è¯¥å˜é‡çš„åœ°æ–¹ä¼šé«˜äº®æ˜¾ç¤º</li>
<li>è¿½è¸ªå˜é‡åœ¨å‡½æ•°å†…çš„æµåŠ¨ ___ ## # ç¬¬ 5 æ­¥ï¼šNative å±‚åˆ†æï¼ˆ20
åˆ†é’Ÿï¼‰</li>
</ol>
<p>å¦‚æœå…³é”®é€»è¾‘åœ¨ SO æ–‡ä»¶ä¸­ã€‚</p>
<h2 id="å®šä½-native-å‡½æ•°"># # 5.1 å®šä½ Native å‡½æ•°</h2>
<p>*åœ¨ jadx ä¸­æ‰¾åˆ° JNI å£°æ˜*ï¼š</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">native</span> <span class="bu">String</span> <span class="fu">encrypt</span><span class="op">(</span><span class="bu">String</span> plaintext<span class="op">);</span></span></code></pre></div>
<p>ls app_unzipped/lib/arm64-v8a/</p>
<h1 id="libnative-lib.so">libnative-lib.so</h1>
<h1 id="ç”¨-ida-pro-æ‰“å¼€">ç”¨ IDA Pro æ‰“å¼€</h1>
<pre><code>3. åŒå‡»è·³è½¬åˆ°å‡½æ•°


* *æˆ–ä½¿ç”¨ Exports çª—å£**ï¼š

1. **View â†’ Open Subviews â†’ Exports**
2. æœç´¢å‡½æ•°å
3. åŒå‡»è·³è½¬


## # # 5.3 åˆ†æå‡½æ•°é€»è¾‘

* *ç¤ºä¾‹åç¼–è¯‘ä»£ç **ï¼ˆIDA/Ghidraï¼‰ï¼š

```c
jstring Java_com_example_CryptoUtils_encrypt(JNIEnv *env, jobject obj, jstring plaintext) {
const char *plain = (*env)-&gt;GetStringUTFChars(env, plaintext, 0);

// AES encryption
unsigned char key[16] = {0x12, 0x34, 0x56, 0x78, ...};
unsigned char iv[16] = {0x00, 0x00, 0x00, 0x00, ...};

unsigned char *encrypted = aes_encrypt(plain, key, iv);

jstring result = (*env)-&gt;NewStringUTF(env, encrypted);
(*env)-&gt;ReleaseStringUTFChars(env, plaintext, plain);

return result;
}
</code></pre>
<ul>
<li>IVï¼š<code>{0x00, 0x00, ...}</code> ___ ## # ç¬¬ 6
æ­¥ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ï¼ˆ10 åˆ†é’Ÿï¼‰</li>
</ul>
<h2 id="ä½¿ç”¨-findcrypt-æ’ä»¶ida-pro"># # 6.1 ä½¿ç”¨ FindCrypt æ’ä»¶ï¼ˆIDA
Proï¼‰</h2>
<p>*å®‰è£…*ï¼š</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸‹è½½</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/polymorf/findcrypt-yara.git</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># å¤åˆ¶åˆ° IDA æ’ä»¶ç›®å½•</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> findcrypt3.py <span class="va">$IDA_PATH</span>/plugins/</span></code></pre></div>
<h2 id="æ‰‹åŠ¨è¯†åˆ«"># # 6.2 æ‰‹åŠ¨è¯†åˆ«</h2>
<p>*å¸¸è§åŠ å¯†ç®—æ³•ç‰¹å¾*ï¼š</p>
<table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>ç‰¹å¾å¸¸é‡ï¼ˆåå…­è¿›åˆ¶ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>AES</td>
<td><code>63 7C 77 7B F2 6B 6F C5</code> (S-Box)</td>
</tr>
<tr>
<td>MD5</td>
<td><code>67 45 23 01 EF CD AB 89</code> (åˆå§‹åŒ–å‘é‡)</td>
</tr>
<tr>
<td>SHA-1</td>
<td><code>67 45 23 01 EF CD AB 89 98 BA DC FE</code></td>
</tr>
<tr>
<td>SHA-256</td>
<td><code>428A2F98 71374491 B5C0FBCF</code></td>
</tr>
<tr>
<td>DES</td>
<td>å›ºå®šçš„ S-Box å’Œ P-Box è¡¨</td>
</tr>
</tbody>
</table>
<p>*åœ¨ IDA ä¸­æœç´¢*ï¼š</p>
<pre><code>
* *ç”¨é€”**ï¼šç†è§£å¤æ‚å‡½æ•°çš„é€»è¾‘ç»“æ„

## # 7.1 æŸ¥çœ‹ CFG

* *IDA Pro**ï¼š
</code></pre>
<pre><code>[æ£€æŸ¥å¯†ç é•¿åº¦] --No--&gt; [è¿”å›é”™è¯¯ 2]
â†“ Yes
[åŠ å¯†å¯†ç ]
â†“
[å‘é€ç½‘ç»œè¯·æ±‚]
â†“
[è§£æå“åº”] --Failed--&gt; [è¿”å›é”™è¯¯ 3]
â†“ Success
[ä¿å­˜ Token]
â†“
[è¿”å›æˆåŠŸ]
</code></pre>
<p>*Xrefs to*ï¼ˆè¢«è°è°ƒç”¨ï¼‰ï¼š</p>
<pre><code></code></pre>
<p>â†’ Base64.encode()</p>
<pre><code>â†“
params.put(&quot;user&quot;, username) â† æ±¡ç‚¹ä¼ æ’­
â†“
String signData = buildSignData(params)
â†“
network.send(signData) â† å¯èƒ½æ³¨å…¥ç‚¹
</code></pre>
<pre><code>[A] [B][C][D] [E]
\ | | | /
\ | | | /
[Dispatcher]
</code></pre>
<hr />
<h2 id="å¸¸è§é—®é¢˜-2">å¸¸è§é—®é¢˜</h2>
<h2 id="é—®é¢˜-1-jadx-åç¼–è¯‘å¤±è´¥"># âŒ é—®é¢˜ 1: jadx åç¼–è¯‘å¤±è´¥</h2>
<p>*ç—‡çŠ¶*ï¼šæ‰“å¼€ APK åæ˜¾ç¤ºé”™è¯¯æˆ–ä»£ç ä¸å®Œæ•´</p>
<p>*è§£å†³*ï¼š</p>
<ol type="1">
<li><strong>å°è¯•ä¸åŒç‰ˆæœ¬çš„ jadx</strong></li>
</ol>
<div class="sourceCode" id="cb111"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨æœ€æ–°ç‰ˆ</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip</span></code></pre></div>
<pre><code>- ç¦ç”¨ &quot;Deobfuscation&quot;
- ç¦ç”¨ &quot;Inline methods&quot;
    ```

3. **æŸ¥çœ‹ Smali ä»£ç **
    ```bash
# ä½¿ç”¨ apktool
apktool d app.apk -o app_smali
</code></pre>
<p>*å¯èƒ½åŸå› *ï¼š</p>
<ol type="1">
<li><strong>å­—ç¬¦ä¸²è¢«åŠ å¯†/æ··æ·†</strong></li>
</ol>
<ul>
<li><p>åœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†</p></li>
<li><p><strong>è§£å†³</strong>ï¼šç”¨ Frida Hook æŸ¥çœ‹è¿è¡Œæ—¶å­—ç¬¦ä¸²</p></li>
<li><p>åœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†</p></li>
<li><p><strong>è§£å†³</strong>ï¼šç”¨ Frida Hook æŸ¥çœ‹è¿è¡Œæ—¶å­—ç¬¦ä¸²</p></li>
</ul>
<ol start="2" type="1">
<li><strong>å­—ç¬¦ä¸²åœ¨ Native å±‚</strong></li>
</ol>
<div class="sourceCode" id="cb113"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># åœ¨ SO æ–‡ä»¶ä¸­æœç´¢</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strings</span> libnative-lib.so <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;sign&quot;</span></span></code></pre></div>
<pre><code>```java</code></pre>
<p>// Code might be String key = â€œsecâ€ + â€œretâ€ + â€œkeyâ€;</p>
<pre><code>
\*ç—‡çŠ¶\*ï¼šæ‰“å¼€ SO æ–‡ä»¶ååªçœ‹åˆ°æ•°æ®ï¼Œæ²¡æœ‰å‡½æ•°

\*è§£å†³\*ï¼š

1. **æ‰‹åŠ¨åˆ›å»ºå‡½æ•°**
</code></pre>
<ul>
<li>æŒ‰ â€˜Pâ€™ é”®åˆ›å»ºå‡½æ•°</li>
<li>æŒ‰ â€˜Câ€™ é”®è½¬æ¢ä¸ºä»£ç  ```</li>
</ul>
<ol start="2" type="1">
<li><strong>ä½¿ç”¨è‡ªåŠ¨åˆ†æ</strong></li>
</ol>
<pre><code>å‹¾é€‰ &quot;Create Functions&quot; &quot;Analyze Code&quot;
</code></pre>
<ul>
<li><p>OLLVM æ§åˆ¶æµå¹³å¦åŒ–</p></li>
<li><p>å‚è€ƒï¼š<a href="./ollvm_deobfuscation.md">OLLVM
åæ··æ·†</a></p></li>
<li><p>OLLVM æ§åˆ¶æµå¹³å¦åŒ–</p></li>
<li><p>å‚è€ƒï¼š<a href="./ollvm_deobfuscation.md">OLLVM
åæ··æ·†</a></p></li>
</ul>
<h2 id="é—®é¢˜-4-ä»£ç å¤ªå¤æ‚çœ‹ä¸æ‡‚"># âŒ é—®é¢˜ 4: ä»£ç å¤ªå¤æ‚çœ‹ä¸æ‡‚</h2>
<p>*ç­–ç•¥*ï¼š</p>
<ol type="1">
<li><strong>é‡å‘½åå˜é‡å’Œå‡½æ•°</strong></li>
</ol>
<pre><code>Ghidra: å³é”® â†’ Rename
</code></pre>
<div class="sourceCode" id="cb118"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Original</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> a <span class="op">=</span> <span class="fu">b</span><span class="op">(</span>c<span class="op">,</span> d<span class="op">);</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">// After renaming</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> encryptedData <span class="op">=</span> <span class="fu">encrypt</span><span class="op">(</span>plaintext<span class="op">,</span> key<span class="op">);</span></span></code></pre></div>
<pre><code>Ghidra: å³é”® â†’ Set Comment
</code></pre>
<ul>
<li><p>ä¸€æ¬¡åªåˆ†æä¸€ä¸ªåŠŸèƒ½</p></li>
<li><p>ç”»æµç¨‹å›¾è®°å½•é€»è¾‘</p></li>
<li><p>ä¸€æ¬¡åªåˆ†æä¸€ä¸ªåŠŸèƒ½</p></li>
<li><p>ç”»æµç¨‹å›¾è®°å½•é€»è¾‘</p></li>
</ul>
<h2 id="é—®é¢˜-5-å¦‚ä½•éªŒè¯é™æ€åˆ†æç»“æœ"># âŒ é—®é¢˜ 5:
å¦‚ä½•éªŒè¯é™æ€åˆ†æç»“æœï¼Ÿ</h2>
<p>*æ–¹æ³• 1ï¼šä½¿ç”¨ CyberChef*</p>
<p>è®¿é—® https://gchq.github.io/CyberChef/</p>
<pre><code>def generate_sign(params, secret_key):
# ä»é™æ€åˆ†æå¤åˆ¶çš„é€»è¾‘
sorted_params = sorted(params.items())
sign_str = &#39;&amp;&#39;.join([f&#39;{k}={v}&#39; for k, v in sorted_params])
sign_str += f&#39;&amp;key={secret_key}&#39;
return hashlib.md5(sign_str.encode()).hexdigest()

# æµ‹è¯•
params = {&#39;user&#39;: &#39;test&#39;, &#39;timestamp&#39;: &#39;1234567890&#39;}
secret = &#39;abc123&#39;
print(generate_sign(params, secret))
</code></pre>
<p>var SignUtils = Java.use(â€˜com.example.SignUtilsâ€™); var HashMap =
Java.use(â€˜java.util.HashMapâ€™);</p>
<p>var params = HashMap.$new(); params.put(â€˜userâ€™, â€˜testâ€™);
params.put(â€˜timestampâ€™, â€˜1234567890â€™);</p>
<p>var sign = SignUtils.generateSign(params); console.log(â€˜[*]
ç­¾åç»“æœ:â€™, sign);</p>
<p>});</p>
<pre><code>- **[é€†å‘å·¥ç¨‹å·¥ä½œæµ](./re_workflow.md)** - å®Œæ•´çš„åˆ†ææµç¨‹
- **[å¯†ç å­¦åˆ†æ](../Network/crypto_analysis.md)** - åŠ å¯†ç®—æ³•è¯†åˆ«
- **[OLLVM åæ··æ·†](./ollvm_deobfuscation.md)** - å¤„ç†æ··æ·†ä»£ç 


## # å·¥å…·æ·±å…¥

- **[IDA Pro ä½¿ç”¨æŒ‡å—](../../02-Tools/Static/ida_pro_guide.md)**
- **[Ghidra ä½¿ç”¨æŒ‡å—](../../02-Tools/Static/ghidra_guide.md)**
- **[jadx ä½¿ç”¨æŠ€å·§](../../02-Tools/Static/)** - TODO


## # åœ¨çº¿èµ„æº


| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **IDA Pro æ•™ç¨‹** - https | //www.hex-rays.com/products/ida/support/tutorials/ |
| **Ghidra å®˜æ–¹æ‰‹å†Œ** - https | //ghidra-sre.org/docs/ |
| **FindCrypt æ’ä»¶** - https | //github.com/polymorf/findcrypt-yara |


## # ç†è®ºåŸºç¡€

- **[ARM æ±‡ç¼–åŸºç¡€](../../04-Reference/Foundations/arm_assembly.md)**
- **[DEX æ–‡ä»¶æ ¼å¼](../../04-Reference/Foundations/dex_format.md)**
- **[ELF æ–‡ä»¶æ ¼å¼](../../04-Reference/Foundations/so_elf_format.md)**
___
## å¿«é€Ÿå‚è€ƒ

## # jadx å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Ctrl+Shift+F` | å…¨å±€æœç´¢ |
| `Ctrl+F` | å½“å‰æ–‡ä»¶æœç´¢ |
| `X` | æŸ¥æ‰¾ç”¨æ³•ï¼ˆXrefsï¼‰ |
| `Ctrl+Click` | è·³è½¬åˆ°å®šä¹‰ |
| `Alt+â†` | åé€€ |
| `F5` | é‡æ–°åç¼–è¯‘ |

## # IDA Pro å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `X` | äº¤å‰å¼•ç”¨ |
| `N` | é‡å‘½å |
| `;` | æ·»åŠ æ³¨é‡Š |
| `Space` | åˆ‡æ¢å›¾å½¢/æ–‡æœ¬è§†å›¾ |
| `G` | è·³è½¬åˆ°åœ°å€ |
| `P` | åˆ›å»ºå‡½æ•° |
| `C` | è½¬æ¢ä¸ºä»£ç  |
| `A` | è½¬æ¢ä¸ºå­—ç¬¦ä¸² |
| `Shift+F12` | æŸ¥çœ‹å­—ç¬¦ä¸² |
| `Alt+T` | æ–‡æœ¬æœç´¢ |
| `Alt+B` | äºŒè¿›åˆ¶æœç´¢ |

## # åˆ†ææµç¨‹æ¨¡æ¿
</code></pre>
<hr />
<p>â†“ * <strong> â†“ * </strong> * <strong> â†“ * </strong> â†“ * <strong> 5.
å…³é”®å˜é‡: - åç§°: </strong>**<strong>___</strong>**<strong> - ç±»å‹:
</strong>**<strong>___</strong>**<strong> - æ¥æº:
</strong>**<strong>___</strong>**<strong> - åç§°:
</strong>**<strong>___</strong>**<strong> - ç±»å‹:
</strong>**<strong>___</strong>**<strong> - æ¥æº:
</strong>**<strong>___</strong>**<strong> 6. ç®—æ³•è¯†åˆ«:
</strong>**<strong>___</strong>**<strong> 7. éªŒè¯ç»“æœ:
</strong>**<strong>___</strong>**<strong> 8. ä¸‹ä¸€æ­¥:
</strong>**<strong>___</strong>**** ``` ___ * æˆåŠŸå®šä½å…³é”®é€»è¾‘äº†å—ï¼Ÿ*
ç°åœ¨ä½ å¯ä»¥ç†è§£ App çš„æ ¸å¿ƒç®—æ³•äº†ï¼</p>
<p>ä¸‹ä¸€æ­¥æ¨èï¼š<a
href="./dynamic_analysis_deep_dive.md">åŠ¨æ€åˆ†ææ·±å…¥</a>ï¼ˆéªŒè¯å’Œæµ‹è¯•ä½ çš„å‘ç°ï¼‰</p>
<pre><code>


&lt;!-- 01-Recipes/Analysis/vmp_analysis.md --&gt;

# VMP åˆ†æ

VMP (VMProtect çš„ç®€ç§°) æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„è½¯ä»¶ä¿æŠ¤è§£å†³æ–¹æ¡ˆï¼Œå®ƒä½¿ç”¨è™šæ‹ŸåŒ–ï¼ˆä¸€ä¸ª&quot;è™šæ‹Ÿæœº&quot;ï¼‰æ¥ä¿æŠ¤ä»£ç ã€‚å—ä¿æŠ¤çš„ä»£ç ä¸å†æ‰§è¡ŒåŸç”Ÿ CPU æŒ‡ä»¤ï¼Œè€Œæ˜¯è¢«è½¬æ¢æˆä¸€ç§è‡ªå®šä¹‰çš„å­—èŠ‚ç ï¼Œåªæœ‰ç‰¹å®šçš„ã€åµŒå…¥çš„è™šæ‹Ÿæœºæ‰èƒ½è§£é‡Šæ‰§è¡Œã€‚

åˆ†æå— VMP ä¿æŠ¤çš„ä»£ç æ˜¯é€†å‘å·¥ç¨‹ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ä¹‹ä¸€ã€‚

___

## æ ¸å¿ƒæ¦‚å¿µ

1. **è™šæ‹Ÿæœº (VM)**: VMP çš„æ ¸å¿ƒã€‚å®ƒåŒ…æ‹¬ï¼š
* **è§£é‡Šå™¨å¾ªç¯**: è¯»å–å­—èŠ‚ç å¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†ç¨‹åº (handler)ã€‚
* **å¤„ç†ç¨‹åº (Handlers)**: å®ç°æ¯ä¸ªè‡ªå®šä¹‰å­—èŠ‚ç æŒ‡ä»¤é€»è¾‘çš„å°æ®µåŸç”Ÿä»£ç ï¼ˆä¾‹å¦‚ï¼Œè™šæ‹ŸåŠ æ³•ã€è™šæ‹Ÿè·³è½¬ï¼‰ã€‚
* **è™šæ‹Ÿå¯„å­˜å™¨**: VM ä½¿ç”¨è‡ªå·±çš„ä¸€å¥—è™šæ‹Ÿå¯„å­˜å™¨æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™äº›è™šæ‹Ÿå¯„å­˜å™¨ä¼šæ˜ å°„åˆ°åŸç”Ÿå¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ã€‚
* **VM ä¸Šä¸‹æ–‡**: ä¸€ä¸ªå­˜å‚¨ VM æ‰€æœ‰çŠ¶æ€çš„ç»“æ„ï¼ŒåŒ…æ‹¬è™šæ‹Ÿå¯„å­˜å™¨ã€æ ‡å¿—ä½å’Œè™šæ‹ŸæŒ‡ä»¤æŒ‡é’ˆ (VIP)ã€‚

2. **å­—èŠ‚ç **: åŸå§‹çš„åŸç”Ÿä»£ç è¢«ç¿»è¯‘æˆä¸€ä¸ªä¸“ä¸ºåµŒå…¥å¼ VM è®¾è®¡çš„è‡ªå®šä¹‰ã€éæ ‡å‡†çš„æŒ‡ä»¤é›†ã€‚

3. **çªå˜ (Mutation)**: ä¸ºäº†è®©åˆ†ææ›´åŠ å›°éš¾ï¼ŒVMP ä¼šä¸ºæ¯ä¸ªæ–°ç‰ˆæœ¬çš„å—ä¿æŠ¤è½¯ä»¶çªå˜ VM çš„å¤„ç†ç¨‹åºå’Œå­—èŠ‚ç ã€‚è¿™æ„å‘³ç€ä¸€ä¸ª&quot;è™šæ‹ŸåŠ æ³•&quot;æŒ‡ä»¤çš„å¤„ç†ç¨‹åºæ¯æ¬¡éƒ½ä¼šçœ‹èµ·æ¥ä¸ä¸€æ ·ã€‚

___

## åˆ†æç­–ç•¥

ç›´æ¥å¯¹ VMP è¿›è¡Œå»è™šæ‹ŸåŒ–æå…¶å›°éš¾ï¼Œé€šå¸¸ä¹Ÿä¸æ˜¯ä¸»è¦ç›®æ ‡ã€‚é‡ç‚¹é€šå¸¸æ˜¯ç†è§£æŸä¸ªç‰¹å®šå—ä¿æŠ¤å‡½æ•°çš„é€»è¾‘ã€‚

### 1. è¯†åˆ« VM åŠå…¶ç»„ä»¶

* **å…¥å£ç‚¹åˆ†æ**: ç¬¬ä¸€æ­¥æ˜¯å®šä½&quot;VM å…¥å£&quot;ï¼Œå³ç¨‹åºä»æ‰§è¡ŒåŸç”Ÿä»£ç åˆ‡æ¢åˆ° VM è§£é‡Šå™¨å¾ªç¯çš„åœ°æ–¹ã€‚å…¶ç‰¹å¾é€šå¸¸æ˜¯ä¸€ç³»åˆ—çš„ PUSH æŒ‡ä»¤ï¼Œç”¨ä»¥ä¿å­˜åŸç”Ÿä¸Šä¸‹æ–‡ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ä¸€ä¸ª JMP/CALL æŒ‡ä»¤è¿›å…¥è§£é‡Šå™¨ã€‚
* **å¤„ç†ç¨‹åºè¿½è¸ª**: ä¸€æ—¦è¿›å…¥ VMï¼Œè¿½è¸ªæ‰§è¡Œæµå°†æ­ç¤ºä¸åŒå¤„ç†ç¨‹åºçš„åœ°å€ã€‚é€šè¿‡åˆ†ææ¯ä¸ªå¤„ç†ç¨‹åºå¯¹ VM ä¸Šä¸‹æ–‡åšäº†ä»€ä¹ˆï¼Œå°±å¯ä»¥å¼€å§‹å‹¾å‹’å‡ºè™šæ‹ŸæŒ‡ä»¤é›†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¯»å–ä¸¤ä¸ªè™šæ‹Ÿå¯„å­˜å™¨ã€å°†å®ƒä»¬ç›¸åŠ å¹¶å­˜å‚¨ç»“æœçš„å¤„ç†ç¨‹åºå¾ˆå¯èƒ½å°±æ˜¯&quot;è™šæ‹ŸåŠ æ³•&quot;ã€‚

### 2. åŠ¨æ€åˆ†æä¸è¿½è¸ª

* **æŒ‡ä»¤è¿½è¸ª**: è¿™æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„è™šæ‹ŸæŒ‡ä»¤çš„è¿½è¸ªè®°å½•ã€‚è¿™éœ€è¦ï¼š
1. åœ¨è§£é‡Šå™¨å¾ªç¯çš„å¼€å§‹å¤„ï¼ˆæˆ–æ¯ä¸ªå¤„ç†ç¨‹åºä¸Šï¼‰è®¾ç½®æ–­ç‚¹ã€‚
2. åœ¨æ¯ä¸€æ­¥ï¼Œè½¬å‚¨è™šæ‹Ÿæœºçš„çŠ¶æ€ï¼ˆè™šæ‹Ÿå¯„å­˜å™¨ã€VIPï¼‰ã€‚
3. è®°å½•å¤„ç†ç¨‹åºæ‰§è¡Œçš„åŸç”Ÿæ“ä½œã€‚
* **Frida/DBI å·¥å…·**: åƒ Fridaã€Pin æˆ– QBDI è¿™æ ·çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡© (DBI) æ¡†æ¶è‡³å…³é‡è¦ã€‚å®ƒä»¬å…è®¸ä½ ç¼–å†™è¿½è¸ªè¿‡ç¨‹çš„è„šæœ¬ï¼Œåœ¨è§£é‡Šå™¨çš„æ¯ä¸€æ­¥è‡ªåŠ¨è®°å½• VM çŠ¶æ€ã€‚

### 3. é‡å»ºé€»è¾‘

* **è¯­ä¹‰é‡å»º**: æ”¶é›†åˆ°è™šæ‹ŸæŒ‡ä»¤çš„è¿½è¸ªè®°å½•åï¼Œå°±å¯ä»¥å¼€å§‹é‡å»ºé«˜å±‚é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª&quot;åŠ è½½&quot;ã€&quot;ç›¸åŠ &quot;ã€&quot;å­˜å‚¨&quot;çš„è™šæ‹ŸæŒ‡ä»¤åºåˆ—å¯ä»¥è¢«ç¿»è¯‘å›ç±»ä¼¼ C çš„è¡¨è¾¾å¼ `var = a + b;`ã€‚
* **æå‡åˆ°æ›´é«˜çº§åˆ«çš„ IR**: å®Œæ•´çš„å»è™šæ‹ŸåŒ–å·¥ä½œçš„æœ€ç»ˆç›®æ ‡æ˜¯å°†è‡ªå®šä¹‰å­—èŠ‚ç &quot;æå‡&quot;åˆ°ä¸€ä¸ªæ ‡å‡†çš„ä¸­é—´è¡¨ç¤ºï¼Œå¦‚ LLVM IR æˆ– REILã€‚è¿™è®©ä½ èƒ½å¤Ÿä½¿ç”¨æ ‡å‡†çš„ç¼–è¯‘å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ã€ç ”ç©¶çº§åˆ«çš„é—®é¢˜ã€‚

### 4. å…³é”®è¦ç‚¹

ä¸è¦è¯•å›¾åç¼–è¯‘ VM æœ¬èº«ã€‚ç›¸åï¼Œ**è¿½è¸ª VM çš„æ‰§è¡Œ**æ¥ç†è§£å®ƒåœ¨åšä»€ä¹ˆã€‚å®ƒæ‰€è°ƒç”¨çš„å¤„ç†ç¨‹åºçš„åºåˆ—æ‰æ˜¯ä½ éœ€è¦åˆ†æçš„çœŸæ­£é€»è¾‘ã€‚



&lt;!-- 01-Recipes/Anti-Detection/app_hardening_identification.md --&gt;

# ä¸»æµåº”ç”¨åŠ å›ºå‚å•†åŠå…¶ç‰¹å¾è¯†åˆ«

Android åº”ç”¨åŠ å›ºæ˜¯ä¸€ç§ä¿æŠ¤ App ä¸è¢«è½»æ˜“é€†å‘ã€ç¯¡æ”¹æˆ–æ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µã€‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œåœ¨å¼€å§‹åˆ†æä¸€ä¸ª App ä¹‹å‰ï¼Œ**é¦–è¦ä»»åŠ¡å°±æ˜¯è¯†åˆ«å‡ºå®ƒæ‰€ä½¿ç”¨çš„åŠ å›ºå‚å•†**ï¼Œå› ä¸ºä¸åŒçš„åŠ å›ºæ–¹æ¡ˆéœ€è¦ä¸åŒçš„è„±å£³å’Œåˆ†æç­–ç•¥ã€‚

æœ¬æŒ‡å—æ—¨åœ¨ç³»ç»Ÿæ€§åœ°æ€»ç»“ä¸­å›½å¸‚åœºä¸»æµåŠ å›ºå‚å•†çš„é™æ€ç‰¹å¾&quot;æŒ‡çº¹&quot;ï¼Œå¸®åŠ©åˆ†æäººå‘˜å¿«é€Ÿè¯†åˆ«ç›®æ ‡ã€‚

___

## ç›®å½•
1. [**é€šç”¨è¯†åˆ«æ€è·¯**](#é€šç”¨è¯†åˆ«æ€è·¯)
2. [**ä¸»æµå‚å•†ç‰¹å¾è¯¦è§£**](#ä¸»æµå‚å•†ç‰¹å¾è¯¦è§£)

* [æ¢†æ¢†å®‰å…¨ (Bangcle)](#æ¢†æ¢†å®‰å…¨-bangcle)

* [360 åŠ å›º (Qihoo 360)](#360-åŠ å›º-qihoo-360)

* [è…¾è®¯ä¹å›º (Tencent Legu)](#è…¾è®¯ä¹å›º-tencent-legu)

* [ç½‘æ˜“æ˜“ç›¾ (Netease Yidun)](#ç½‘æ˜“æ˜“ç›¾-netease-yidun)

* [çˆ±åŠ å¯† (Ijiami)](#çˆ±åŠ å¯†-ijiami)
3. [**å¿«é€Ÿè¯†åˆ«æ‘˜è¦è¡¨**](#å¿«é€Ÿè¯†åˆ«æ‘˜è¦è¡¨)

___

## é€šç”¨è¯†åˆ«æ€è·¯

è¯†åˆ«åŠ å›ºå‚å•†é€šå¸¸éµå¾ªä»¥ä¸‹é™æ€åˆ†æè·¯å¾„ï¼š
1. **æ£€æŸ¥ DEX æ–‡ä»¶**ï¼šè§£å‹ APKï¼ŒæŸ¥çœ‹ä¸» `classes.dex` æ–‡ä»¶çš„å¤§å°ã€‚å¦‚æœå®ƒéå¸¸å°ï¼ˆé€šå¸¸å°äº 1MBï¼‰ï¼Œè€Œ APK æœ¬èº«ä½“ç§¯å¾ˆå¤§ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ª&quot;å£³&quot;ï¼Œè´Ÿè´£åŠ è½½çœŸæ­£çš„ã€è¢«åŠ å¯†éšè—èµ·æ¥çš„ DEXã€‚
2. **æ£€æŸ¥ SO åº“**ï¼šæŸ¥çœ‹ `lib/[arch]/` ç›®å½•ä¸‹çš„ `.so` æ–‡ä»¶åˆ—è¡¨ã€‚åŠ å›ºå‚å•†é€šå¸¸ä¼šæ”¾å…¥å¸¦æœ‰è‡ªèº«å“ç‰Œæ ‡è¯†çš„ SO åº“ï¼Œè¿™æ˜¯æœ€æ˜æ˜¾çš„ç‰¹å¾ã€‚
3. **æ£€æŸ¥ `assets` ç›®å½•**ï¼šå¾ˆå¤šåŠ å›ºæ–¹æ¡ˆä¼šå°†åŠ å¯†åçš„ DEX æ–‡ä»¶ã€é…ç½®æ–‡ä»¶æˆ–å…¶ä»–ç»„ä»¶æ”¾å…¥ `assets` ç›®å½•ã€‚
4. **æ£€æŸ¥ `AndroidManifest.xml`**ï¼šåŠ å›ºæ–¹æ¡ˆé€šå¸¸ä¼šç”¨è‡ªå·±çš„ä»£ç† `Application` ç±»æ›¿æ¢æ‰åŸå§‹çš„ `Application` ç±»ã€‚æ£€æŸ¥ `application` æ ‡ç­¾ä¸‹çš„ `android:name` å±æ€§ï¼Œå¯ä»¥æ‰¾åˆ°ä»£ç†ç±»çš„åå­—ï¼Œå…¶åŒ…åå¾€å¾€æš´éœ²å‚å•†ä¿¡æ¯ã€‚

## ä¸»æµå‚å•†ç‰¹å¾è¯¦è§£

### æ¢†æ¢†å®‰å…¨ (Bangcle)
æ¢†æ¢†æ˜¯æœ€æ—©æœŸçš„åŠ å›ºå‚å•†ä¹‹ä¸€ï¼Œç‰¹å¾ç›¸å¯¹æ˜æ˜¾ã€‚

* **SO åº“ç‰¹å¾**:
* `libSecShell.so`

* `libsecexe.so`

* `libsecmain.so`
* **Java å±‚ç‰¹å¾**:
* ä»£ç† Application åŒ…åï¼š`com.bangcle.protect` æˆ– `com.secshell.shell`ã€‚
* **`assets` ç›®å½•ç‰¹å¾**:
* å¯èƒ½ä¼šæœ‰ `bangcle_classes.jar` æˆ–ç±»ä¼¼å‘½åçš„åŠ å¯† DEX æ–‡ä»¶ã€‚
* **å…¶ä»–**:
* `AndroidManifest.xml` çš„ `meta-data` ä¸­å¯èƒ½ä¼šåŒ…å«åŸå§‹ Application çš„ä¿¡æ¯ã€‚

### 360 åŠ å›º (Qihoo 360)
360 åŠ å›ºéå¸¸æ™®éï¼Œå…¶ç‰¹å¾ä¹Ÿå¹¿ä¸ºäººçŸ¥ã€‚

* **SO åº“ç‰¹å¾**:
* `libjiagu.so`

* `libprotectClass.so`

* `libjiagu_x86.so` / `libjiagu_art.so`
* **Java å±‚ç‰¹å¾**:
* ä»£ç† Application åŒ…åï¼š`com.qihoo.util`ã€‚

* å¯åŠ¨ç±»ä¸­å¯èƒ½åŒ…å« `com.stub.StubApp`ã€‚
* **`assets` ç›®å½•ç‰¹å¾**:
* `libjiagu.so` (æ˜¯çš„ï¼Œæœ‰æ—¶ä¹Ÿä¼šæ”¾åœ¨ assets é‡Œ)

* `.jiagu` åç¼€çš„åŠ å¯†æ–‡ä»¶ã€‚

### è…¾è®¯ä¹å›º (Tencent Legu)
è…¾è®¯ä¹å›ºé€šå¸¸ä¸ Bugly SDK ä¸€èµ·å‡ºç°ï¼Œç‰¹å¾æ˜æ˜¾ã€‚

* **SO åº“ç‰¹å¾**:
* `liblegu.so`

* `libshella-xxxx.so` (xxxx æ˜¯ç‰ˆæœ¬å·)
* **Java å±‚ç‰¹å¾**:
* ä»£ç† Application åŒ…åï¼š`com.tencent.bugly.legu`ã€‚
* **`assets` ç›®å½•ç‰¹å¾**:
* `legu_data.so`

* `tosversion` æ–‡ä»¶
* **å…¶ä»–**:
* DEX æ–‡ä»¶å¤´é€šå¸¸è¢«ä¿®æ”¹ä¸º `legu`ã€‚

### ç½‘æ˜“æ˜“ç›¾ (Netease Yidun)
ç½‘æ˜“æ˜“ç›¾æ˜¯è¿‘å¹´æ¥å…´èµ·çš„ä¸€æ¬¾å¼ºå¤§åŠ å›ºï¼Œç‰¹å¾ä¹Ÿæ¯”è¾ƒç‹¬ç‰¹ã€‚

* **SO åº“ç‰¹å¾**:
* `libnesec.so` (æœ€æ ¸å¿ƒçš„ç‰¹å¾)
* **Java å±‚ç‰¹å¾**:
* ä»£ç† Application åŒ…åï¼š`com.netease.nis.wrapper`ã€‚
* **`assets` ç›®å½•ç‰¹å¾**:
* `nesec.dat`

* `classes.dex.ys` (åŠ å¯†çš„ä¸» DEX)

* `xxx.dat` æ ¼å¼çš„åŠ å¯† DEX æ–‡ä»¶ã€‚

### çˆ±åŠ å¯† (Ijiami)
çˆ±åŠ å¯†ä¹Ÿæ˜¯ä¸€æ¬¾å¸¸è§çš„åŠ å›ºäº§å“ã€‚

* **SO åº“ç‰¹å¾**:
* `libexec.so`

* `libexecmain.so`

* `libijiami.so`
* **Java å±‚ç‰¹å¾**:
* ä»£ç† Application åŒ…åï¼š`com.ijiami.client.protect`ã€‚
* **`assets` ç›®å½•ç‰¹å¾**:
* `ijiami.dat`

* `ijm_lib` ç›®å½•

___

## å¿«é€Ÿè¯†åˆ«æ‘˜è¦è¡¨

| åŠ å›ºå‚å•† | æ ¸å¿ƒ SO ç‰¹å¾ | Java åŒ…å/ç±»åç‰¹å¾ | `assets` ç›®å½•ç‰¹å¾ |
| :--- | :--- | :--- | :--- |
| **æ¢†æ¢†å®‰å…¨** | `libSecShell.so` | `com.bangcle.protect` | `bangcle_classes.jar` |
| **360 åŠ å›º** | `libjiagu.so`, `libprotectClass.so` | `com.qihoo.util` | `.jiagu` æ–‡ä»¶ |
| **è…¾è®¯ä¹å›º** | `liblegu.so` | `com.tencent.bugly.legu` | `legu_data.so` |
| **ç½‘æ˜“æ˜“ç›¾** | `libnesec.so` | `com.netease.nis.wrapper`| `nesec.dat`, `classes.dex.ys`|
| **çˆ±åŠ å¯†** | `libexec.so`, `libijiami.so` | `com.ijiami.client.protect` | `ijiami.dat` | 


&lt;!-- 01-Recipes/Anti-Detection/captcha_bypassing_techniques.md --&gt;

# éªŒè¯ç ç»•è¿‡æŠ€æœ¯ï¼šæ»‘å—ä¸ç‚¹é€‰ç¯‡

æ»‘å—å’Œç‚¹é€‰ï¼ˆæˆ–ç§°å›¾æ ‡ï¼‰éªŒè¯ç æ˜¯ç°ä»£ Web åº”ç”¨ä¸­ç”¨äºåŒºåˆ†äººç±»ç”¨æˆ·å’Œè‡ªåŠ¨åŒ–ç¨‹åºï¼ˆæœºå™¨äººï¼‰çš„å¸¸è§æ‰‹æ®µã€‚ä¸ä¼ ç»Ÿçš„å­—ç¬¦è¾“å…¥éªŒè¯ç ç›¸æ¯”ï¼Œå®ƒä»¬æ›´æ³¨é‡äºåˆ†æç”¨æˆ·çš„&quot;è¡Œä¸ºç‰¹å¾&quot;ã€‚æœ¬æ–‡æ—¨åœ¨è¯¦ç»†ä»‹ç»ç»•è¿‡è¿™ä¸¤ç±»éªŒè¯ç çš„ä¸»æµæŠ€æœ¯å’Œæ ¸å¿ƒæ€æƒ³ã€‚

- --

## ç›®å½•
- [éªŒè¯ç ç»•è¿‡æŠ€æœ¯ï¼šæ»‘å—ä¸ç‚¹é€‰ç¯‡](#éªŒè¯ç ç»•è¿‡æŠ€æœ¯æ»‘å—ä¸ç‚¹é€‰ç¯‡)
- [ç›®å½•](#ç›®å½•)
- [éªŒè¯ç æ ¸å¿ƒæœºåˆ¶](#éªŒè¯ç æ ¸å¿ƒæœºåˆ¶)
- [æ»‘å—éªŒè¯ç ](#æ»‘å—éªŒè¯ç )

- [ç‚¹é€‰éªŒè¯ç ](#ç‚¹é€‰éªŒè¯ç )
- [ç»•è¿‡ç­–ç•¥ä¸€ï¼šæ¨¡æ‹Ÿäººç±»è¡Œä¸º](#ç»•è¿‡ç­–ç•¥ä¸€æ¨¡æ‹Ÿäººç±»è¡Œä¸º)
- [æ­¥éª¤ 1: ç›®æ ‡è¯†åˆ« (è®¡ç®—æœºè§†è§‰)](#æ­¥éª¤-1-ç›®æ ‡è¯†åˆ«-è®¡ç®—æœºè§†è§‰)

- [æ­¥éª¤ 2: è½¨è¿¹æ¨¡æ‹Ÿ (æ ¸å¿ƒå…³é”®)](#æ­¥éª¤-2-è½¨è¿¹æ¨¡æ‹Ÿ-æ ¸å¿ƒå…³é”®)
- [ç»•è¿‡ç­–ç•¥äºŒï¼šæœºå™¨å­¦ä¹ ä¸ AI](#ç»•è¿‡ç­–ç•¥äºŒæœºå™¨å­¦ä¹ ä¸-ai)
- [ç›®æ ‡æ£€æµ‹æ¨¡å‹ (YOLO/SSD)](#ç›®æ ‡æ£€æµ‹æ¨¡å‹-yolossd)

- [ç¬¬ä¸‰æ–¹æ‰“ç å¹³å°](#ç¬¬ä¸‰æ–¹æ‰“ç å¹³å°)
- [ç»•è¿‡ç­–ç•¥ä¸‰ï¼šå¯»æ‰¾é€»è¾‘æ¼æ´](#ç»•è¿‡ç­–ç•¥ä¸‰å¯»æ‰¾é€»è¾‘æ¼æ´)

- [é˜²å¾¡ä¸å¯¹æŠ—çš„æ¼”è¿›](#é˜²å¾¡ä¸å¯¹æŠ—çš„æ¼”è¿›)

- --

### éªŒè¯ç æ ¸å¿ƒæœºåˆ¶

#### æ»‘å—éªŒè¯ç 
* **ç›®æ ‡**: ç”¨æˆ·éœ€è¦å°†æ»‘å—æ‹–åŠ¨åˆ°èƒŒæ™¯å›¾çš„ç¼ºå£ä½ç½®ã€‚

* **éªŒè¯é‡ç‚¹**:
1. **ç»“æœå‡†ç¡®æ€§**: æ»‘å—æœ€ç»ˆåœç•™çš„ä½ç½®æ˜¯å¦åœ¨ç¼ºå£çš„ç›®æ ‡å®¹å·®èŒƒå›´å†…ã€‚
2. **è¡Œä¸ºå¯ä¿¡åº¦**: **(æ›´é‡è¦)** ç”¨æˆ·çš„é¼ æ ‡è½¨è¿¹æ˜¯å¦åƒäººã€‚ä¸€ä¸ªç”±ç¨‹åºç”Ÿæˆçš„ã€åŒ€é€Ÿçš„ã€å®Œç¾çš„ç›´çº¿è½¨è¿¹å‡ ä¹è‚¯å®šä¼šè¢«åˆ¤å®šä¸ºæœºå™¨äººã€‚

#### ç‚¹é€‰éªŒè¯ç 
* **ç›®æ ‡**: æ ¹æ®æç¤ºï¼ŒæŒ‰é¡ºåºç‚¹å‡»å›¾ç‰‡ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ±‰å­—ã€å›¾æ ‡æˆ–ç‰©ä½“ã€‚

* **éªŒè¯é‡ç‚¹**:
1. **è¯†åˆ«å‡†ç¡®æ€§**: æ˜¯å¦èƒ½æ­£ç¡®è¯†åˆ«å¹¶ç‚¹å‡»ç›®æ ‡ã€‚
2. **è¡Œä¸ºå¯ä¿¡åº¦**: ç‚¹å‡»çš„åæ ‡ã€é—´éš”æ—¶é—´ã€é¼ æ ‡ç§»åŠ¨è½¨è¿¹æ˜¯å¦è‡ªç„¶ã€‚

- --

### ç»•è¿‡ç­–ç•¥ä¸€ï¼šæ¨¡æ‹Ÿäººç±»è¡Œä¸º

è¿™æ˜¯æœ€ä¸»æµã€æœ€æ ¹æœ¬çš„ç»•è¿‡æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ˜¯å°½å¯èƒ½åœ°æ¨¡ä»¿äººç±»æ“ä½œçš„ä¸å®Œç¾æ€§ã€‚

#### æ­¥éª¤ 1: ç›®æ ‡è¯†åˆ« (è®¡ç®—æœºè§†è§‰)

åœ¨æ¨¡æ‹Ÿæ“ä½œä¹‹å‰ï¼Œç¨‹åºéœ€è¦å…ˆåƒäººä¸€æ ·&quot;çœ‹æ‡‚&quot;éªŒè¯ç ã€‚

* **å¯¹äºæ»‘å—éªŒè¯ç  (ç¼ºå£è¯†åˆ«)**:
* **å¸¸ç”¨åº“**: OpenCV (Python)ã€‚

* **æ–¹æ³•ä¸€ï¼šè¾¹ç¼˜æ£€æµ‹**:
1. è·å–å¸¦ç¼ºå£çš„èƒŒæ™¯å›¾å’Œä¸å¸¦ç¼ºå£çš„å®Œæ•´èƒŒæ™¯å›¾ï¼ˆé€šå¸¸å¯ä»¥ä»ç½‘ç»œè¯·æ±‚ä¸­æ‰¾åˆ°ï¼‰ã€‚
2. ä½¿ç”¨ Canny ç­‰è¾¹ç¼˜æ£€æµ‹ç®—æ³•åˆ†åˆ«å¤„ç†ä¸¤å¼ å›¾ç‰‡ã€‚
3. å¯¹æ¯”ä¸¤å¼ å›¾çš„è¾¹ç¼˜å·®å¼‚ï¼Œå·®å¼‚æœ€æ˜¾è‘—çš„åŒºåŸŸå°±æ˜¯ç¼ºå£çš„ä½ç½®ã€‚

* **æ–¹æ³•äºŒï¼šæ¨¡æ¿åŒ¹é…**:
1. ä»ç½‘ç»œè¯·æ±‚æˆ–é¡µé¢å…ƒç´ ä¸­è·å–åˆ°ç‹¬ç«‹çš„&quot;æ»‘å—&quot;å›¾ç‰‡ã€‚
2. å°†æ»‘å—å›¾ç‰‡ä½œä¸º&quot;æ¨¡æ¿&quot;ï¼Œåœ¨å¸¦ç¼ºå£çš„èƒŒæ™¯å›¾ä¸Šè¿›è¡Œæ¨¡æ¿åŒ¹é… (`cv2.matchTemplate`)ã€‚åŒ¹é…åº¦æœ€é«˜çš„åœ°æ–¹å°±æ˜¯ç¼ºå£çš„èµ·å§‹ X åæ ‡ã€‚

* **å¯¹äºç‚¹é€‰éªŒè¯ç  (ç›®æ ‡è¯†åˆ«)**:
* å¦‚æœç›®æ ‡æ˜¯å›ºå®šçš„æ–‡å­—æˆ–å›¾æ ‡ï¼Œå¯ä»¥é‡‡ç”¨ä¸æ»‘å—ç±»ä¼¼çš„**æ¨¡æ¿åŒ¹é…**æ–¹æ³•ã€‚

* å¦‚æœç›®æ ‡æ˜¯å˜åŒ–çš„ã€å¤æ‚çš„ï¼Œä¾‹å¦‚&quot;è¯·ç‚¹å‡»å›¾ä¸­æ‰€æœ‰çš„å…¬äº¤è½¦&quot;ï¼Œåˆ™éœ€è¦ä¾èµ–æ›´é«˜çº§çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼ˆè§ç­–ç•¥äºŒï¼‰ã€‚

#### æ­¥éª¤ 2: è½¨è¿¹æ¨¡æ‹Ÿ (æ ¸å¿ƒå…³é”®)

è¿™æ˜¯æ•´ä¸ªç»•è¿‡è¿‡ç¨‹çš„çµé­‚ã€‚ä¸€ä¸ªå¥½çš„è½¨è¿¹æ¨¡æ‹Ÿç®—æ³•éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼Œä»¥æ¬ºéª—æœåŠ¡å™¨ç«¯çš„è¡Œä¸ºåˆ†ææ¨¡å‹ï¼š

* **éçº¿æ€§ç§»åŠ¨**: ç»å¯¹ä¸èƒ½æ˜¯ `(x1, y1)` åˆ° `(x2, y2)` çš„ç›´çº¿ã€‚è·¯å¾„éœ€è¦æ˜¯å¸¦æœ‰å¼§åº¦çš„æ›²çº¿ã€‚

* **å˜é€Ÿç§»åŠ¨**: æ¨¡æ‹Ÿäººç±»æ“ä½œçš„è‚Œè‚‰æ§åˆ¶ï¼Œè½¨è¿¹åº”è¯¥æ˜¯&quot;æ…¢-å¿«-æ…¢&quot;çš„æ¨¡å¼ã€‚
* **åˆæ®µåŠ é€Ÿ**: åˆå§‹ç§»åŠ¨é€Ÿåº¦è¾ƒæ…¢ã€‚

* **ä¸­æ®µåŒ€é€Ÿ/åŠ é€Ÿ**: ä¸­é—´è¿‡ç¨‹é€Ÿåº¦åŠ å¿«ã€‚

* **æœ«æ®µå‡é€Ÿ**: æ¥è¿‘ç›®æ ‡æ—¶ï¼Œé€Ÿåº¦ä¼šæ˜¾è‘—å‡æ…¢ï¼Œè¿›è¡Œå¾®è°ƒã€‚
* **éšæœºæŠ–åŠ¨**: åœ¨ä¸»è½¨è¿¹çš„åŸºç¡€ä¸Šï¼Œå åŠ å¾®å°çš„ã€éšæœºçš„ Y è½´ï¼ˆæœ‰æ—¶ä¹ŸåŒ…æ‹¬ X è½´ï¼‰åç§»ï¼Œæ¨¡æ‹Ÿæ‰‹éƒ¨è‡ªç„¶çš„æŠ–åŠ¨ã€‚

* **è¶…è¶Šä¸å›é€€**: æœ‰æ—¶å¯ä»¥æ¨¡æ‹Ÿ&quot;æ‹–è¿‡å¤´äº†ä¸€ç‚¹ç‚¹ï¼Œå†å¾€å›æ‹‰&quot;çš„è¡Œä¸ºï¼Œè¿™ä¼šæå¤§åœ°å¢åŠ è½¨è¿¹çš„å¯ä¿¡åº¦ã€‚

* **åœé¡¿**: åœ¨æ‹–åŠ¨è¿‡ç¨‹ä¸­å¯ä»¥åŠ å…¥çŸ­æš‚çš„ã€éšæœºæ—¶é•¿çš„åœé¡¿ã€‚

* *å®ç°ç¤ºä¾‹ (ä¼ªä»£ç )**:

```python
def generate_human_like_track(target_distance):
track = []
current_pos = 0
# Movement pattern: accelerate first, then decelerate
while current_pos &lt; target_distance:
# 1. Calculate movement step size for current phase (non-uniform speed)
if current_pos &lt; target_distance * 0.7:
step = random.uniform(2, 4) # Acceleration phase
else:
step = random.uniform(0.5, 2) # Deceleration and fine-tuning phase

# 2. Add random jitter
y_offset = random.uniform(-1, 1)

# 3. Record trajectory point
track.append((step, y_offset, random.uniform(10, 50))) # (x step, y offset, time interval ms)
current_pos += step

# (Optional) Add &quot;overshoot and pull back&quot; trajectory points
# ...
return track
</code></pre>
<ul>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>:
éœ€è¦ä»ä¸€å¼ å¤§å›¾ä¸­è¯†åˆ«å¹¶å®šä½å¤šä¸ªä¸è§„åˆ™ç‰©ä½“çš„ç‚¹é€‰éªŒè¯ç ï¼ˆä¾‹å¦‚ï¼Œâ€œé€‰å‡ºæ‰€æœ‰çš„çº¢ç»¿ç¯â€ï¼‰ã€‚</p></li>
<li><p><strong>æ–¹æ³•</strong>:</p></li>
</ul>
<ol type="1">
<li><strong>æ•°æ®æ ‡æ³¨</strong>:
æ”¶é›†å¤§é‡çš„éªŒè¯ç å›¾ç‰‡ï¼Œå¹¶æ‰‹åŠ¨æ ‡æ³¨å‡ºéœ€è¦è¯†åˆ«çš„ç‰©ä½“ï¼ˆå¦‚â€çº¢ç»¿ç¯â€ã€â€œå…¬äº¤è½¦â€ï¼‰ã€‚</li>
<li><strong>æ¨¡å‹è®­ç»ƒ</strong>:
ä½¿ç”¨æ ‡æ³¨å¥½çš„æ•°æ®é›†è®­ç»ƒä¸€ä¸ªç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œå¦‚ YOLOv5 æˆ– SSDã€‚</li>
<li><strong>æ¨ç†</strong>:
åœ¨å®é™…ç»•è¿‡æ—¶ï¼Œå°†éªŒè¯ç å›¾ç‰‡è¾“å…¥åˆ°è®­ç»ƒå¥½çš„æ¨¡å‹ä¸­ï¼Œæ¨¡å‹ä¼šè¿”å›æ‰€æœ‰è¯†åˆ«åˆ°çš„ç›®æ ‡çš„ä½ç½®åæ ‡ã€‚</li>
<li><strong>åç»­æ“ä½œ</strong>:
æ‹¿åˆ°åæ ‡åï¼Œå†ç»“åˆä¸Šä¸€èŠ‚çš„â€è½¨è¿¹æ¨¡æ‹Ÿâ€æ–¹æ³•å»ç‚¹å‡»ã€‚</li>
</ol>
<h4 id="ç¬¬ä¸‰æ–¹æ‰“ç å¹³å°">ç¬¬ä¸‰æ–¹æ‰“ç å¹³å°</h4>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>:
å°†è¯†åˆ«éªŒè¯ç è¿™ä¸€ä¸“ä¸šä»»åŠ¡å¤–åŒ…ç»™ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚è¿™äº›å¹³å°èƒŒåé€šå¸¸æ˜¯å¤§é‡çš„äººå·¥æˆ–è€…æ›´å¼ºå¤§çš„
AI æ¨¡å‹ã€‚</p></li>
<li><p><strong>ä»£è¡¨æœåŠ¡</strong>: 2Captcha, Anti-Captcha ç­‰ã€‚</p></li>
<li><p><strong>å·¥ä½œæµç¨‹</strong>:</p></li>
</ul>
<ol type="1">
<li>æ³¨å†Œå¹¶å……å€¼ã€‚</li>
<li>é€šè¿‡ API å°†éªŒè¯ç å›¾ç‰‡ï¼ˆæˆ–ä»»åŠ¡æè¿°ï¼‰å‘é€ç»™å¹³å°ã€‚</li>
<li>å¹³å°è¿”å›ç»“æœï¼ˆå¦‚æ»‘å—çš„ X åæ ‡ï¼Œæˆ–ç‚¹é€‰ç›®æ ‡çš„åæ ‡åºåˆ—ï¼‰ã€‚</li>
<li>ä½ çš„ç¨‹åºæ‹¿åˆ°ç»“æœåï¼Œå†æ‰§è¡Œåç»­çš„æ¨¡æ‹Ÿæ“ä½œã€‚</li>
</ol>
<ul>
<li><p><strong>ä¼˜ç‚¹</strong>:
æˆåŠŸç‡æé«˜ï¼Œèƒ½è§£å†³å‡ ä¹æ‰€æœ‰ç±»å‹çš„éªŒè¯ç ï¼Œæ— éœ€è‡ªå·±ç»´æŠ¤å¤æ‚çš„è¯†åˆ«æ¨¡å‹ã€‚</p></li>
<li><p><strong>ç¼ºç‚¹</strong>:
éœ€è¦ä»˜è´¹ï¼Œå­˜åœ¨éšç§å’Œå®‰å…¨é£é™©ï¼ˆå°†æ•°æ®å‘ç»™ç¬¬ä¸‰æ–¹ï¼‰ï¼Œæœ‰ç½‘ç»œå»¶è¿Ÿã€‚</p></li>
</ul>
<hr />
<h3 id="ç»•è¿‡ç­–ç•¥ä¸‰å¯»æ‰¾é€»è¾‘æ¼æ´">ç»•è¿‡ç­–ç•¥ä¸‰ï¼šå¯»æ‰¾é€»è¾‘æ¼æ´</h3>
<p>åœ¨æŠ•å…¥å¤§é‡ç²¾åŠ›ç¼–å†™å¤æ‚çš„æ¨¡æ‹Ÿå’Œè¯†åˆ«ä»£ç å‰ï¼Œå…ˆå°è¯•å¯»æ‰¾â€æ·å¾„â€æ˜¯ä¸€ç§é«˜æ€§ä»·æ¯”çš„ç­–ç•¥ã€‚</p>
<ul>
<li><p><strong>åˆ†æå‰ç«¯ JS</strong>: ä»”ç»†å®¡æŸ¥é¡µé¢çš„ JavaScript
æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸éªŒè¯ç ç›¸å…³çš„é€»è¾‘ã€‚æœ‰æ—¶å¯èƒ½ä¼šå‘ç°ï¼š</p></li>
<li><p><strong>ç­”æ¡ˆç¡¬ç¼–ç æˆ–å¼±åŠ å¯†</strong>:
ç¼ºå£ä½ç½®ã€ç›®æ ‡åæ ‡ç­‰ä¿¡æ¯ä»¥æ˜æ–‡æˆ–ç®€å•åŠ å¯†çš„æ–¹å¼å­˜åœ¨äºå‰ç«¯ä»£ç ä¸­ã€‚</p></li>
<li><p><strong>å¯é¢„æµ‹çš„éšæœºæ•°</strong>:
ç”¨äºç”ŸæˆéªŒè¯ç çš„éšæœºç§å­æˆ–ç®—æ³•è¿‡äºç®€å•ï¼Œå¯ä»¥è¢«é¢„æµ‹ã€‚</p></li>
<li><p><strong>API æ¼æ´</strong>:</p></li>
<li><p><strong>éªŒè¯ç»•è¿‡</strong>: å°è¯•ç›´æ¥è°ƒç”¨æäº¤è¡¨å•çš„
APIï¼Œä½†ä¸å¸¦éªŒè¯ç ç›¸å…³çš„å‚æ•°ï¼Œçœ‹åç«¯æ˜¯å¦å¼ºåˆ¶æ ¡éªŒã€‚</p></li>
<li><p><strong>Token é‡æ”¾</strong>: æˆåŠŸé€šè¿‡ä¸€æ¬¡éªŒè¯åï¼Œè·å–åˆ°çš„
<code>session_token</code> æˆ– <code>captcha_id</code>
æ˜¯å¦å¯ä»¥è¢«å¤šæ¬¡é‡ç”¨ã€‚</p></li>
</ul>
<hr />
<h3 id="é˜²å¾¡ä¸å¯¹æŠ—çš„æ¼”è¿›">é˜²å¾¡ä¸å¯¹æŠ—çš„æ¼”è¿›</h3>
<p>éªŒè¯ç æä¾›å•†ä¹Ÿåœ¨ä¸æ–­è¿›åŒ–ï¼Œä»¥å¯¹æŠ—ä¸Šè¿°ç»•è¿‡æŠ€æœ¯ï¼š</p>
<ul>
<li><p><strong>ç¯å¢ƒæ£€æµ‹</strong>: æ£€æµ‹ WebDriver ç‰¹å¾ï¼ˆå¦‚
<code>navigator.webdriver</code>
æ ‡å¿—ï¼‰ã€æµè§ˆå™¨æŒ‡çº¹ã€å­—ä½“ã€åˆ†è¾¨ç‡ç­‰ã€‚</p></li>
<li><p><strong>æ›´å¤æ‚çš„è¡Œä¸ºåˆ†æ</strong>:
ä¸ä»…ä»…æ˜¯è½¨è¿¹ï¼Œè¿˜ä¼šåˆ†æç‚¹å‡»å‹åŠ›ã€æ»šè½®è¡Œä¸ºã€é¼ æ ‡åŠ é€Ÿåº¦ç­‰æ›´æ·±å±‚æ¬¡çš„ç”Ÿç‰©ç‰¹å¾ã€‚</p></li>
<li><p><strong>å›¾åƒå¹²æ‰°</strong>:
åœ¨éªŒè¯ç å›¾ç‰‡ä¸Šå¢åŠ å¹²æ‰°çº¿ã€å™ªç‚¹ã€å½¢å˜ã€é¢œè‰²æŠ–åŠ¨ï¼Œå¢åŠ  CV
è¯†åˆ«éš¾åº¦ã€‚</p></li>
<li><p><strong>æ— æ„ŸéªŒè¯ (reCAPTCHA v3)</strong>:
å®Œå…¨åœ¨åå°æ ¹æ®ç”¨æˆ·çš„ç»¼åˆè¡Œä¸ºè¯„åˆ†ï¼Œåˆ†æ•°è¿‡ä½æ—¶æ‰å¼¹å‡ºæŒ‘æˆ˜ã€‚</p></li>
</ul>
<!-- 01-Recipes/Anti-Detection/device_fingerprinting_and_bypass.md -->
<h1
id="è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥">è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥</h1>
<ul>
<li>*è®¾å¤‡æŒ‡çº¹ (Device Fingerprinting)**
æ˜¯æŒ‡é€šè¿‡é‡‡é›†è®¾å¤‡çš„è½¯ç¡¬ä»¶ç‰¹å¾ï¼Œç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿå”¯ä¸€æ ‡è¯†è¯¥è®¾å¤‡çš„ã€å…·æœ‰é«˜ç†µå€¼å’Œç¨³å®šæ€§çš„
ID
çš„è¿‡ç¨‹ã€‚åœ¨å½“ä»Šçš„äº’è”ç½‘æœåŠ¡ä¸­ï¼Œå®ƒå·²æˆä¸ºåæ¬ºè¯ˆã€åæœºå™¨äººã€ç”¨æˆ·è¡Œä¸ºè¿½è¸ªå’Œå®‰å…¨é£æ§çš„åŸºçŸ³æŠ€æœ¯ã€‚</li>
</ul>
<p>ç»•è¿‡è®¾å¤‡æŒ‡çº¹å¹¶éç®€å•åœ°ä¿®æ”¹ä¸€ä¸¤ä¸ªå‚æ•°ï¼Œè€Œæ˜¯è¦åˆ›é€ ä¸€ä¸ªå®Œæ•´çš„ã€é€»è¾‘è‡ªæ´½çš„ã€å¯ä¿¡çš„è™šæ‹Ÿè®¾å¤‡â€ç”»åƒâ€ã€‚æœ¬æŒ‡å—å°†ç³»ç»Ÿæ€§åœ°æ‹†è§£ä¸»æµçš„æŒ‡çº¹é‡‡é›†ç»´åº¦ï¼Œå¹¶æ¢è®¨ä¸ä¹‹å¯¹åº”çš„æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ã€‚</p>
<hr />
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><p><a
href="#è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥">è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†">è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</a></p></li>
<li><p><a href="#æŒ‡çº¹ç”Ÿæˆç®—æ³•">æŒ‡çº¹ç”Ÿæˆç®—æ³•</a></p></li>
<li><p><a href="#ç†µå€¼ä¸ç¨³å®šæ€§">ç†µå€¼ä¸ç¨³å®šæ€§</a></p></li>
<li><p><a href="#æŒ‡çº¹æ›´æ–°ç­–ç•¥">æŒ‡çº¹æ›´æ–°ç­–ç•¥</a></p></li>
<li><p><a href="#ä¸»æµè®¾å¤‡æŒ‡çº¹é‡‡é›†ç»´åº¦">ä¸»æµè®¾å¤‡æŒ‡çº¹é‡‡é›†ç»´åº¦</a></p></li>
<li><p><a href="#ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦">ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦</a></p></li>
<li><p><a href="#ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</a></p></li>
<li><p><a href="#ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</a></p></li>
<li><p><a href="#é€šè¿‡-svc-ç³»ç»Ÿè°ƒç”¨-è·å–ä¿¡æ¯">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨)
è·å–ä¿¡æ¯</a></p></li>
<li><p><a href="#ç½‘ç»œç¯å¢ƒæŒ‡çº¹">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</a></p></li>
<li><p><a href="#è¡Œä¸ºç‰¹å¾æŒ‡çº¹">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</a></p></li>
<li><p><a href="#æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ä¸ç­–ç•¥">æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ä¸ç­–ç•¥</a></p></li>
<li><p><a href="#hook-æŠ€æœ¯-fridaxposed">Hook æŠ€æœ¯
(Frida/Xposed)</a></p></li>
<li><p><a href="#æ·±åº¦è®¾å¤‡ä¿®æ”¹-æ”¹æœº">æ·±åº¦è®¾å¤‡ä¿®æ”¹ (â€œæ”¹æœºâ€)</a></p></li>
<li><p><a href="#ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</a></p></li>
<li><p><a href="#äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£">äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£</a></p></li>
<li><p><a
href="#æ„å»ºä¸€è‡´æ€§çš„è®¾å¤‡ç”»åƒ">æ„å»ºä¸€è‡´æ€§çš„â€è®¾å¤‡ç”»åƒâ€</a></p></li>
<li><p><a href="#å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡">å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡</a></p></li>
<li><p><a
href="#å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†">å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†</a></p></li>
<li><p><a href="#å›½é™…çŸ¥åäº§å“">å›½é™…çŸ¥åäº§å“</a></p></li>
<li><p><a href="#å¼€æºå·¥å…·ä¸æ¡†æ¶">å¼€æºå·¥å…·ä¸æ¡†æ¶</a></p></li>
<li><p><a href="#è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</a></p></li>
<li><p><a href="#åæŒ‡çº¹å·¥å…·">åæŒ‡çº¹å·¥å…·</a></p></li>
<li><p><a href="#å¯¹æŠ—ä¸æŒ‘æˆ˜">å¯¹æŠ—ä¸æŒ‘æˆ˜</a></p></li>
<li><p><a href="#hook-æ¡†æ¶æ£€æµ‹">Hook æ¡†æ¶æ£€æµ‹</a></p></li>
<li><p><a href="#æœåŠ¡ç«¯äº¤å‰éªŒè¯">æœåŠ¡ç«¯äº¤å‰éªŒè¯</a></p></li>
<li><p><a href="#æœºå™¨å­¦ä¹ æ£€æµ‹">æœºå™¨å­¦ä¹ æ£€æµ‹</a></p></li>
<li><p><a href="#å®æˆ˜æ¡ˆä¾‹åˆ†æ">å®æˆ˜æ¡ˆä¾‹åˆ†æ</a></p></li>
<li><p><a
href="#æ¡ˆä¾‹1æŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ">æ¡ˆä¾‹1ï¼šæŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ</a></p></li>
<li><p><a
href="#æ¡ˆä¾‹2é‡‘èappé£æ§ç»•è¿‡">æ¡ˆä¾‹2ï¼šé‡‘èAppé£æ§ç»•è¿‡</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†">è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</a></p></li>
<li><p><a href="#æŒ‡çº¹ç”Ÿæˆç®—æ³•">æŒ‡çº¹ç”Ÿæˆç®—æ³•</a></p></li>
<li><p><a href="#ç†µå€¼ä¸ç¨³å®šæ€§">ç†µå€¼ä¸ç¨³å®šæ€§</a></p></li>
<li><p><a href="#æŒ‡çº¹æ›´æ–°ç­–ç•¥">æŒ‡çº¹æ›´æ–°ç­–ç•¥</a></p></li>
<li><p><a href="#æŒ‡çº¹ç”Ÿæˆç®—æ³•">æŒ‡çº¹ç”Ÿæˆç®—æ³•</a></p></li>
<li><p><a href="#ç†µå€¼ä¸ç¨³å®šæ€§">ç†µå€¼ä¸ç¨³å®šæ€§</a></p></li>
<li><p><a href="#æŒ‡çº¹æ›´æ–°ç­–ç•¥">æŒ‡çº¹æ›´æ–°ç­–ç•¥</a></p></li>
<li><p><a href="#ä¸»æµè®¾å¤‡æŒ‡çº¹é‡‡é›†ç»´åº¦">ä¸»æµè®¾å¤‡æŒ‡çº¹é‡‡é›†ç»´åº¦</a></p></li>
<li><p><a href="#ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦">ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦</a></p></li>
<li><p><a href="#ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</a></p></li>
<li><p><a href="#ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</a></p></li>
<li><p><a href="#é€šè¿‡-svc-ç³»ç»Ÿè°ƒç”¨-è·å–ä¿¡æ¯">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨)
è·å–ä¿¡æ¯</a></p></li>
<li><p><a href="#ç½‘ç»œç¯å¢ƒæŒ‡çº¹">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</a></p></li>
<li><p><a href="#è¡Œä¸ºç‰¹å¾æŒ‡çº¹">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</a></p></li>
<li><p><a href="#ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦">ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦</a></p></li>
<li><p><a href="#ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</a></p></li>
<li><p><a href="#ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</a></p></li>
<li><p><a href="#é€šè¿‡-svc-ç³»ç»Ÿè°ƒç”¨-è·å–ä¿¡æ¯">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨)
è·å–ä¿¡æ¯</a></p></li>
<li><p><a href="#ç½‘ç»œç¯å¢ƒæŒ‡çº¹">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</a></p></li>
<li><p><a href="#è¡Œä¸ºç‰¹å¾æŒ‡çº¹">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</a></p></li>
<li><p><a href="#æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ä¸ç­–ç•¥">æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ä¸ç­–ç•¥</a></p></li>
<li><p><a href="#hook-æŠ€æœ¯-fridaxposed">Hook æŠ€æœ¯
(Frida/Xposed)</a></p></li>
<li><p><a href="#æ·±åº¦è®¾å¤‡ä¿®æ”¹-æ”¹æœº">æ·±åº¦è®¾å¤‡ä¿®æ”¹ (â€œæ”¹æœºâ€)</a></p></li>
<li><p><a href="#ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</a></p></li>
<li><p><a href="#äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£">äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£</a></p></li>
<li><p><a
href="#æ„å»ºä¸€è‡´æ€§çš„è®¾å¤‡ç”»åƒ">æ„å»ºä¸€è‡´æ€§çš„â€è®¾å¤‡ç”»åƒâ€</a></p></li>
<li><p><a href="#hook-æŠ€æœ¯-fridaxposed">Hook æŠ€æœ¯
(Frida/Xposed)</a></p></li>
<li><p><a href="#æ·±åº¦è®¾å¤‡ä¿®æ”¹-æ”¹æœº">æ·±åº¦è®¾å¤‡ä¿®æ”¹ (â€œæ”¹æœºâ€)</a></p></li>
<li><p><a href="#ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</a></p></li>
<li><p><a href="#äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£">äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£</a></p></li>
<li><p><a
href="#æ„å»ºä¸€è‡´æ€§çš„è®¾å¤‡ç”»åƒ">æ„å»ºä¸€è‡´æ€§çš„â€è®¾å¤‡ç”»åƒâ€</a></p></li>
<li><p><a href="#å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡">å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡</a></p></li>
<li><p><a
href="#å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†">å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†</a></p></li>
<li><p><a href="#å›½é™…çŸ¥åäº§å“">å›½é™…çŸ¥åäº§å“</a></p></li>
<li><p><a
href="#å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†">å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†</a></p></li>
<li><p><a href="#å›½é™…çŸ¥åäº§å“">å›½é™…çŸ¥åäº§å“</a></p></li>
<li><p><a href="#å¼€æºå·¥å…·ä¸æ¡†æ¶">å¼€æºå·¥å…·ä¸æ¡†æ¶</a></p></li>
<li><p><a href="#è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</a></p></li>
<li><p><a href="#åæŒ‡çº¹å·¥å…·">åæŒ‡çº¹å·¥å…·</a></p></li>
<li><p><a href="#è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</a></p></li>
<li><p><a href="#åæŒ‡çº¹å·¥å…·">åæŒ‡çº¹å·¥å…·</a></p></li>
<li><p><a href="#å¯¹æŠ—ä¸æŒ‘æˆ˜">å¯¹æŠ—ä¸æŒ‘æˆ˜</a></p></li>
<li><p><a href="#hook-æ¡†æ¶æ£€æµ‹">Hook æ¡†æ¶æ£€æµ‹</a></p></li>
<li><p><a href="#æœåŠ¡ç«¯äº¤å‰éªŒè¯">æœåŠ¡ç«¯äº¤å‰éªŒè¯</a></p></li>
<li><p><a href="#æœºå™¨å­¦ä¹ æ£€æµ‹">æœºå™¨å­¦ä¹ æ£€æµ‹</a></p></li>
<li><p><a href="#hook-æ¡†æ¶æ£€æµ‹">Hook æ¡†æ¶æ£€æµ‹</a></p></li>
<li><p><a href="#æœåŠ¡ç«¯äº¤å‰éªŒè¯">æœåŠ¡ç«¯äº¤å‰éªŒè¯</a></p></li>
<li><p><a href="#æœºå™¨å­¦ä¹ æ£€æµ‹">æœºå™¨å­¦ä¹ æ£€æµ‹</a></p></li>
<li><p><a href="#å®æˆ˜æ¡ˆä¾‹åˆ†æ">å®æˆ˜æ¡ˆä¾‹åˆ†æ</a></p></li>
<li><p><a
href="#æ¡ˆä¾‹1æŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ">æ¡ˆä¾‹1ï¼šæŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ</a></p></li>
<li><p><a
href="#æ¡ˆä¾‹2é‡‘èappé£æ§ç»•è¿‡">æ¡ˆä¾‹2ï¼šé‡‘èAppé£æ§ç»•è¿‡</a></p></li>
<li><p><a
href="#æ¡ˆä¾‹1æŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ">æ¡ˆä¾‹1ï¼šæŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ</a></p></li>
<li><p><a
href="#æ¡ˆä¾‹2é‡‘èappé£æ§ç»•è¿‡">æ¡ˆä¾‹2ï¼šé‡‘èAppé£æ§ç»•è¿‡</a></p></li>
</ul>
<hr />
<h2 id="è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†">è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</h2>
<h3 id="æŒ‡çº¹ç”Ÿæˆç®—æ³•">æŒ‡çº¹ç”Ÿæˆç®—æ³•</h3>
<p>è®¾å¤‡æŒ‡çº¹çš„ç”Ÿæˆå¹¶éç®€å•åœ°å°†æ‰€æœ‰é‡‡é›†åˆ°çš„ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯é€šè¿‡å¤æ‚çš„ç®—æ³•å¤„ç†ï¼Œç¡®ä¿ç”Ÿæˆçš„æŒ‡çº¹å…·æœ‰å”¯ä¸€æ€§ã€ç¨³å®šæ€§å’Œä¸å¯é€†æ€§ã€‚</p>
<h4 id="åŸºæœ¬æµç¨‹">åŸºæœ¬æµç¨‹</h4>
<pre><code>å¯¹é‡‡é›†åˆ°çš„åŸå§‹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼š
- **æ ¼å¼ç»Ÿä¸€**: å°†ä¸åŒæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼ˆå¦‚MACåœ°å€ç»Ÿä¸€ä¸ºå°å†™ã€å»é™¤åˆ†éš”ç¬¦ï¼‰
- **ç¼ºå¤±å€¼å¤„ç†**: å¯¹æ— æ³•è·å–çš„å­—æ®µä½¿ç”¨é»˜è®¤å€¼æˆ–ç‰¹æ®Šæ ‡è®°
- **æƒé‡åˆ†é…**: æ ¹æ®ç¨³å®šæ€§å’Œå”¯ä¸€æ€§ç»™ä¸åŒç»´åº¦åˆ†é…æƒé‡


**3. ç‰¹å¾ç»„åˆ**
å°†å¤„ç†åçš„æ•°æ®æŒ‰ç…§é¢„å®šè§„åˆ™ç»„åˆï¼š</code></pre>
<div class="sourceCode" id="cb124"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æ¦‚å¿µä»£ç </span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>fingerprint_input <span class="op">=</span> {</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;hardware&#39;</span>: {</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;android_id&#39;</span>: <span class="st">&#39;abc123&#39;</span>,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;imei&#39;</span>: <span class="st">&#39;867530900000000&#39;</span>,</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;mac&#39;</span>: <span class="st">&#39;00:11:22:33:44:55&#39;</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;software&#39;</span>: {</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;model&#39;</span>: <span class="st">&#39;Pixel 6&#39;</span>,</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;sdk&#39;</span>: <span class="dv">33</span>,</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;fingerprint&#39;</span>: <span class="st">&#39;google/raven/raven:...&#39;</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;environment&#39;</span>: {</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;screen&#39;</span>: <span class="st">&#39;1080x2400&#39;</span>,</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;dpi&#39;</span>: <span class="dv">420</span>,</span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;timezone&#39;</span>: <span class="st">&#39;Asia/Shanghai&#39;</span></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>import hashlib import json</p>
<p>def generate_fingerprint(data): #
WillDataè½¬ä¸ºJSONStringï¼ˆç¡®ä¿é¡ºåºä¸€è‡´ï¼‰ json_str = json.dumps(data,
sort_keys=True)</p>
<h1 id="calculatesha256">CalculateSHA256</h1>
<p>fingerprint = hashlib.sha256(json_str.encode()).hexdigest()</p>
<p>return fingerprint</p>
<pre><code>
| ç®—æ³• | è¾“å‡ºé•¿åº¦ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|----------|
| MD5 | 128ä½ | é€Ÿåº¦å¿«ï¼Œä½†å®‰å…¨æ€§ä½ | ä½å®‰å…¨è¦æ±‚åœºæ™¯ |
| SHA-256 | 256ä½ | å®‰å…¨æ€§é«˜ï¼Œè®¡ç®—ç¨æ…¢ | é‡‘èã€é«˜å®‰å…¨åœºæ™¯ |
| MurmurHash | å¯å˜ | é€Ÿåº¦æå¿«ï¼Œé€‚åˆéåŠ å¯† | å¤§è§„æ¨¡æ•°æ®å¤„ç† |
| xxHash | å¯å˜ | æ€§èƒ½ä¼˜å¼‚ | å®æ—¶è®¡ç®—åœºæ™¯ |

#### é«˜çº§æŠ€æœ¯

* *1. æ¨¡ç³ŠHash (Fuzzy Hashing)**
å…è®¸è®¾å¤‡æŒ‡çº¹åœ¨ç»†å¾®å˜åŒ–æ—¶ä»èƒ½åŒ¹é…ã€‚ä½¿ç”¨ SimHashã€MinHash ç­‰ç®—æ³•ï¼š

```python
# SimHash æ¦‚å¿µImplement
def simhash(features, hash_bits=64):
&quot;&quot;&quot;
å°†ç‰¹å¾å‘é‡è½¬æ¢ä¸º SimHash å€¼
ç›¸ä¼¼ç‰¹å¾ä¼šäº§ç”Ÿç›¸ä¼¼HashValue
&quot;&quot;&quot;
v = [0] * hash_bits

for feature, weight in features.items():
h = hash(feature)
for i in range(hash_bits):
if h &amp; (1 &lt;&lt; i):
v[i] += weight
else:
v[i] -= weight

fingerprint = 0
for i in range(hash_bits):
if v[i] &gt;= 0:
fingerprint |= (1 &lt;&lt; i)

return fingerprint
</code></pre>
<ul>
<li><strong>ä¸‰çº§æŒ‡çº¹ï¼ˆç¯å¢ƒæŒ‡çº¹ï¼‰</strong>: åŸºäºç½‘ç»œã€è¡Œä¸ºç­‰ä¸´æ—¶ç‰¹å¾</li>
</ul>
<div class="sourceCode" id="cb126"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_tiered_fingerprint(data):</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸€çº§æŒ‡çº¹ï¼šç¡¬ä»¶ID</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>tier1 <span class="op">=</span> hashlib.sha256(</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="ss">f&quot;</span><span class="sc">{</span>data[<span class="st">&#39;imei&#39;</span>]<span class="sc">}</span><span class="ss">|</span><span class="sc">{</span>data[<span class="st">&#39;android_id&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>.encode()</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>).hexdigest()</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># äºŒçº§æŒ‡çº¹ï¼šç³»ç»Ÿç‰¹å¾</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>tier2 <span class="op">=</span> hashlib.sha256(</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="ss">f&quot;</span><span class="sc">{</span>tier1<span class="sc">}</span><span class="ss">|</span><span class="sc">{</span>data[<span class="st">&#39;model&#39;</span>]<span class="sc">}</span><span class="ss">|</span><span class="sc">{</span>data[<span class="st">&#39;sdk&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>.encode()</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>).hexdigest()</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸‰çº§æŒ‡çº¹ï¼šCompleteç‰¹å¾</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>tier3 <span class="op">=</span> hashlib.sha256(</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>json.dumps(data, sort_keys<span class="op">=</span><span class="va">True</span>).encode()</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>).hexdigest()</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> {</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;strong&#39;</span>: tier1,</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;medium&#39;</span>: tier2,</span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;weak&#39;</span>: tier3</span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>ä½¿ç”¨PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰æå–å…³é”®ç‰¹å¾</li>
<li>ä½¿ç”¨èšç±»ç®—æ³•è¯†åˆ«å¼‚å¸¸è®¾å¤‡</li>
<li>ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ç”Ÿæˆè®¾å¤‡åµŒå…¥å‘é‡ï¼ˆEmbeddingï¼‰</li>
</ul>
<h3 id="ç†µå€¼ä¸ç¨³å®šæ€§">ç†µå€¼ä¸ç¨³å®šæ€§</h3>
<p>å¥½çš„è®¾å¤‡æŒ‡çº¹éœ€è¦åœ¨<strong>å”¯ä¸€æ€§ï¼ˆé«˜ç†µå€¼ï¼‰</strong>å’Œ<strong>ç¨³å®šæ€§</strong>ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚</p>
<h4 id="ç†µå€¼è®¡ç®—">ç†µå€¼è®¡ç®—</h4>
<p>ç†µå€¼è¡¡é‡ä¸€ä¸ªç‰¹å¾çš„ä¿¡æ¯é‡å’ŒåŒºåˆ†èƒ½åŠ›ï¼š</p>
<div class="sourceCode" id="cb127"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_entropy(values):</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">Calculateä¸€ç‰¹å¾é¦™å†œç†µ</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="co">ç†µå€¼è¶Šé«˜ï¼Œè¯´æ˜è¯¥ç‰¹å¾åŒºåˆ†èƒ½åŠ›è¶Šå¼º</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(values)</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> Counter(values)</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>entropy <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> count <span class="kw">in</span> counter.values():</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> count <span class="op">/</span> total</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>entropy <span class="op">-=</span> p <span class="op">*</span> math.log2(p)</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> entropy</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>android_ids <span class="op">=</span> [<span class="st">&#39;id1&#39;</span>, <span class="st">&#39;id2&#39;</span>, <span class="st">&#39;id3&#39;</span>, ...] <span class="co"># é‡‡é›†æ•°æ®</span></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>entropy <span class="op">=</span> calculate_entropy(android_ids)</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Android IDç†µValue: </span><span class="sc">{</span>entropy<span class="sc">}</span><span class="ss"> bits&quot;</span>)</span></code></pre></div>
<div class="line-block">Android ID | 60+ bits | é«˜ | ä¸­ï¼ˆæ¢å¤å‡ºå‚ä¼šå˜ï¼‰
|<br />
MACåœ°å€ | 48 bits | é«˜ | ä¸­ï¼ˆè¶Šæ¥è¶Šéš¾è·å–ï¼‰ |<br />
è®¾å¤‡å‹å· | 8-10 bits | ä½ | é«˜ |<br />
å±å¹•åˆ†è¾¨ç‡ | 6-8 bits | ä½ | é«˜ |<br />
ä¼ æ„Ÿå™¨åˆ—è¡¨ | 15-20 bits | ä¸­ | é«˜ |</div>
<h4 id="ç¨³å®šæ€§è¯„ä¼°">ç¨³å®šæ€§è¯„ä¼°</h4>
<p>ç¨³å®šæ€§æŒ‡çš„æ˜¯è®¾å¤‡åœ¨ä¸åŒæ—¶é—´ç‚¹ã€ä¸åŒç¯å¢ƒä¸‹ç”Ÿæˆçš„æŒ‡çº¹ä¸€è‡´æ€§ï¼š</p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stability_score(fingerprints):</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">è¯„ä¼°åŒä¸€è®¾å¤‡åœ¨ä¸åŒæ—¶é—´ç”Ÿæˆçš„æŒ‡çº¹Stableæ€§</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">fingerprints: åŒä¸€è®¾å¤‡å¤šæ¬¡ç”Ÿæˆçš„æŒ‡çº¹åˆ—è¡¨</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(fingerprints) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="fl">1.0</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co"># è®¡ç®—æŒ‡çº¹ä¹‹é—´ç›¸ä¼¼åº¦</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> fingerprints[<span class="dv">0</span>]</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>similarities <span class="op">=</span> []</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fp <span class="kw">in</span> fingerprints[<span class="dv">1</span>:]:</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Hamming è·ç¦»</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> <span class="bu">sum</span>(c1 <span class="op">!=</span> c2 <span class="cf">for</span> c1, c2 <span class="kw">in</span> <span class="bu">zip</span>(base, fp))</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>similarity <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (diff <span class="op">/</span> <span class="bu">len</span>(base))</span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>similarities.append(similarity)</span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="bu">sum</span>(similarities) <span class="op">/</span> <span class="bu">len</span>(similarities)</span></code></pre></div>
<p>â€œâ€œâ€ è®¡ç®—æŒ‡çº¹æ–¹æ¡ˆè´¨é‡åˆ†æ•° entropy: ç†µValue (0-100) stability: Stableæ€§
(0-1) coverage: è®¾å¤‡è¦†ç›–ç‡ (0-1) â€œâ€œâ€ # åŠ æƒè®¡ç®— score = ( entropy * 0.4
+ # å”¯ä¸€æ€§æƒé‡40% stability * 50 * 0.4 + # ç¨³å®šæ€§æƒé‡40% coverage * 100
* 0.2 # è¦†ç›–ç‡æƒé‡20% ) return score</p>
<pre><code>- è®¾å¤‡ç¡¬ä»¶å˜æ›´ï¼ˆæ¢SIMå¡ã€é‡ç½®è®¾å¤‡ï¼‰
- Appç‰ˆæœ¬å‡çº§ï¼ˆæŒ‡çº¹ç®—æ³•æ›´æ–°ï¼‰
- å®šæœŸåˆ·æ–°ï¼ˆå¦‚æ¯30å¤©ï¼‰


**2. è¢«åŠ¨æ›´æ–°**
- æ£€æµ‹åˆ°æŒ‡çº¹å†²çªï¼ˆå¤šä¸ªè®¾å¤‡å…·æœ‰ç›¸åŒæŒ‡çº¹ï¼‰
- æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼ˆç–‘ä¼¼æ”¹æœºï¼‰
- æœåŠ¡ç«¯è¦æ±‚å¼ºåˆ¶æ›´æ–°


#### æ›´æ–°ç­–ç•¥

```python
class FingerprintManager:
def should_update(self, old_fp, new_data):
&quot;&quot;&quot;
CheckisNoNeedUpdateæŒ‡çº¹
&quot;&quot;&quot;
# è®¡ç®—æ–°æŒ‡çº¹
new_fp = self.generate_fingerprint(new_data)

# 1. å…³KeyFieldå˜æ›´
critical_changed = self._check_critical_fields(old_fp, new_data)
if critical_changed:
return True, &quot;Critical field changed&quot;

# 2. ç›¸ä¼¼åº¦è¿‡ä½
similarity = self._calculate_similarity(old_fp, new_fp)
if similarity &lt; 0.7:
return True, &quot;Low similarity&quot;

# 3. Timeè¿‡æœŸ
if self._is_expired(old_fp):
return True, &quot;Expired&quot;

return False, &quot;No update needed&quot;

def update_fingerprint(self, device_id, new_fp, reason):
&quot;&quot;&quot;
æ›´æ–°æŒ‡çº¹æ—¶ä¿ç•™å†å²è®°å½•
&quot;&quot;&quot;
history = {
&#39;device_id&#39;: device_id,
&#39;old_fingerprint&#39;: self.current_fp,
&#39;new_fingerprint&#39;: new_fp,
&#39;update_reason&#39;: reason,
&#39;timestamp&#39;: time.time()
}
self._save_history(history)
self.current_fp = new_fp
</code></pre>
<div class="sourceCode" id="cb130"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">ProcessæŒ‡çº¹æ¼‚ç§»</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">baseline_fp: åŸºçº¿æŒ‡çº¹</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co">current_fp: CurrentæŒ‡çº¹</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co">threshold: ç›¸ä¼¼åº¦é˜ˆValue</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>similarity <span class="op">=</span> calculate_similarity(baseline_fp, current_fp)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> similarity <span class="op">&gt;=</span> threshold:</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="co"># å¯æ¥å—æ¼‚ç§»ï¼Œè§†ä¸ºåŒä¸€è®¾å¤‡</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="st">&quot;same_device&quot;</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> similarity <span class="op">&gt;=</span> <span class="fl">0.6</span>:</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="co"># å¼‚å¸¸æ¼‚ç§»ï¼Œéœ€è¦äºŒæ¬¡éªŒè¯</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="st">&quot;verification_needed&quot;</span></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a><span class="co"># é‡å¤§å˜åŒ–ï¼Œç–‘ä¼¼æ–°è®¾å¤‡oræ”¹æœº</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="st">&quot;new_device&quot;</span></span></code></pre></div>
<p>è¿™äº›æ˜¯ä¼ ç»Ÿçš„ã€æƒé™è¾ƒé«˜çš„è®¾å¤‡ IDã€‚</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">æ ‡è¯†ç¬¦</th>
<th style="text-align: left;">è·å–æ–¹å¼ (Java API)</th>
<th style="text-align: left;">ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Android ID</strong></td>
<td
style="text-align: left;"><code>Settings.Secure.getString(resolver, "android_id")</code></td>
<td style="text-align: left;">Android 8.0 ä»¥ä¸Šï¼Œå¯¹æ¯ä¸ª App
å’Œç”¨æˆ·éƒ½ä¸åŒã€‚æ¢å¤å‡ºå‚è®¾ç½®ä¼šæ”¹å˜ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>IMEI/MEID</strong></td>
<td
style="text-align: left;"><code>TelephonyManager.getImei()</code></td>
<td style="text-align: left;">æ‰‹æœºçš„å”¯ä¸€èº«ä»½ç ã€‚éœ€è¦
<code>READ_PHONE_STATE</code> æƒé™ï¼Œä¸”è¶Šæ¥è¶Šéš¾è·å–ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>IMSI</strong></td>
<td
style="text-align: left;"><code>TelephonyManager.getSubscriberId()</code></td>
<td style="text-align: left;">SIM å¡çš„å”¯ä¸€èº«ä»½ç ã€‚åŒæ ·éœ€è¦é«˜æƒé™ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MAC åœ°å€</strong></td>
<td style="text-align: left;"><code>WifiInfo.getMacAddress()</code></td>
<td style="text-align: left;">Android 6.0 ä»¥åï¼ŒApp
è·å–åˆ°çš„é€šå¸¸æ˜¯ä¸€ä¸ªå›ºå®šçš„å‡å€¼ <code>02:00:00:00:00:00</code>ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</h3>
<p>è¿™æ˜¯æŒ‡çº¹åº“çš„ä¸»ä½“ï¼Œä¿¡æ¯é‡å¤§ï¼Œè·å–æˆæœ¬ä½ã€‚</p>
<ul>
<li><p><strong>Build å±æ€§</strong>: é€šè¿‡ <code>android.os.Build</code>
ç±»æˆ–ç›´æ¥è¯»å– <code>/system/build.prop</code> æ–‡ä»¶è·å–ã€‚</p></li>
<li><p><code>Build.MODEL</code>: è®¾å¤‡å‹å· (e.g., â€œPixel 6â€)</p></li>
<li><p><code>Build.BRAND</code>: å“ç‰Œ (e.g., â€œGoogleâ€)</p></li>
<li><p><code>Build.MANUFACTURER</code>: åˆ¶é€ å•† (e.g., â€œGoogleâ€)</p></li>
<li><p><code>Build.VERSION.SDK_INT</code>: SDK ç‰ˆæœ¬å· (e.g.,
33)</p></li>
<li><p><code>Build.FINGERPRINT</code>:
ç³»ç»Ÿæ„å»ºæŒ‡çº¹ï¼Œä¿¡æ¯é‡å·¨å¤§ã€‚</p></li>
<li><p><code>Build.MODEL</code>: è®¾å¤‡å‹å· (e.g., â€œPixel 6â€)</p></li>
<li><p><code>Build.BRAND</code>: å“ç‰Œ (e.g., â€œGoogleâ€)</p></li>
<li><p><code>Build.MANUFACTURER</code>: åˆ¶é€ å•† (e.g., â€œGoogleâ€)</p></li>
<li><p><code>Build.VERSION.SDK_INT</code>: SDK ç‰ˆæœ¬å· (e.g.,
33)</p></li>
<li><p><code>Build.FINGERPRINT</code>:
ç³»ç»Ÿæ„å»ºæŒ‡çº¹ï¼Œä¿¡æ¯é‡å·¨å¤§ã€‚</p></li>
<li><p><strong>ç³»ç»Ÿè®¾ç½®</strong>:</p></li>
<li><p>å±å¹•åˆ†è¾¨ç‡ã€DPI (<code>DisplayMetrics</code>)</p></li>
<li><p>ç³»ç»Ÿè¯­è¨€ã€æ—¶åŒºã€é»˜è®¤å­—ä½“åˆ—è¡¨ã€‚</p></li>
<li><p>å±å¹•åˆ†è¾¨ç‡ã€DPI (<code>DisplayMetrics</code>)</p></li>
<li><p>ç³»ç»Ÿè¯­è¨€ã€æ—¶åŒºã€é»˜è®¤å­—ä½“åˆ—è¡¨ã€‚</p></li>
<li><p><strong>è½¯ä»¶ç¯å¢ƒ</strong>:</p></li>
<li><p>å·²å®‰è£…åº”ç”¨åˆ—è¡¨
(<code>PackageManager.getInstalledPackages</code>)ã€‚</p></li>
<li><p>ç‰¹å®š App (å¦‚è¾“å…¥æ³•) çš„ç‰ˆæœ¬ã€‚</p></li>
<li><p>å·²å®‰è£…åº”ç”¨åˆ—è¡¨
(<code>PackageManager.getInstalledPackages</code>)ã€‚</p></li>
<li><p>ç‰¹å®š App (å¦‚è¾“å…¥æ³•) çš„ç‰ˆæœ¬ã€‚</p></li>
</ul>
<h3 id="ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</h3>
<p>åˆ©ç”¨ç¡¬ä»¶çš„ç»†å¾®ç‰©ç†å·®å¼‚æ¥åˆ›å»ºæŒ‡çº¹ã€‚</p>
<ul>
<li><p><strong>ä¼ æ„Ÿå™¨æ•°æ®</strong>:
è¯»å–åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªç­‰ä¼ æ„Ÿå™¨çš„æ ¡å‡†æ•°æ®æˆ–åœ¨ç‰¹å®šæ“ä½œä¸‹çš„è¯»æ•°ã€‚ä¸åŒæ‰¹æ¬¡çš„ä¼ æ„Ÿå™¨å­˜åœ¨ç‰©ç†å·®å¼‚ã€‚</p></li>
<li><p><strong>CPU/GPU ä¿¡æ¯</strong>:</p></li>
<li><p>è¯»å– <code>/proc/cpuinfo</code> è·å– CPU
å‹å·ã€æ ¸å¿ƒæ•°ã€ç‰¹æ€§ç­‰ã€‚</p></li>
<li><p>é€šè¿‡ OpenGL/WebGL API æŸ¥è¯¢ GPU
ä¾›åº”å•†ã€æ¸²æŸ“å™¨ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥æ‰§è¡Œä¸€ä¸ªæ ‡å‡†æ¸²æŸ“ä»»åŠ¡ï¼Œå°†æ¸²æŸ“ç»“æœçš„ Hash
ä½œä¸ºæŒ‡çº¹ã€‚</p></li>
<li><p>è¯»å– <code>/proc/cpuinfo</code> è·å– CPU
å‹å·ã€æ ¸å¿ƒæ•°ã€ç‰¹æ€§ç­‰ã€‚</p></li>
<li><p>é€šè¿‡ OpenGL/WebGL API æŸ¥è¯¢ GPU
ä¾›åº”å•†ã€æ¸²æŸ“å™¨ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥æ‰§è¡Œä¸€ä¸ªæ ‡å‡†æ¸²æŸ“ä»»åŠ¡ï¼Œå°†æ¸²æŸ“ç»“æœçš„ Hash
ä½œä¸ºæŒ‡çº¹ã€‚</p></li>
<li><p><strong>æ‘„åƒå¤´å‚æ•°</strong>: <code>CameraCharacteristics</code>
ä¸­åŒ…å«çš„è¯¦ç»†å‚æ•°ã€‚</p></li>
</ul>
<h3 id="é€šè¿‡-svc-ç³»ç»Ÿè°ƒç”¨-è·å–ä¿¡æ¯">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨) è·å–ä¿¡æ¯</h3>
<p>è¿™æ˜¯ä¸€ç§é«˜çº§çš„å Hook
æŠ€æœ¯ï¼Œå¸¸è§äºåŠ å›ºæ–¹æ¡ˆä¸­ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>ç»•è¿‡æ‰€æœ‰ä¸Šå±‚ API å’Œ libc
å‡½æ•°</strong>ï¼Œé€šè¿‡ <code>SVC</code> æŒ‡ä»¤ç›´æ¥å‘èµ·ç³»ç»Ÿè°ƒç”¨
(<code>syscall</code>) æ¥è·å–ä¿¡æ¯æˆ–æ‰§è¡Œæ“ä½œã€‚</p>
<ul>
<li><p><strong>åŸç†</strong>: <code>SVC</code> æ˜¯ ARM
å¤„ç†å™¨çš„ä¸€æ¡æŒ‡ä»¤ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªè½¯ä»¶ä¸­æ–­ï¼Œä½¿ CPU ä»ç”¨æˆ·æ€ï¼ˆUser
Modeï¼‰åˆ‡æ¢åˆ°ç®¡ç†æ€ï¼ˆSupervisor
Modeï¼‰ï¼Œä»è€Œæ‰§è¡Œå†…æ ¸ä»£ç ã€‚è¿™æ˜¯æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„åŸºç¡€ã€‚åŠ å›ºå‚å•†åœ¨ SO
æ–‡ä»¶ä¸­ç›´æ¥åµŒå…¥ <code>SVC</code> æŒ‡ä»¤ï¼Œå¯ä»¥ä¸ç»è¿‡ <code>libc.so</code>
ä¸­çš„ <code>read</code>, <code>open</code>, <code>ioctl</code>
ç­‰å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å†…æ ¸ä¸­å¯¹åº”çš„åŠŸèƒ½ã€‚</p></li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>:</p></li>
<li><p><strong>ç»•è¿‡ API Hook</strong>: è¿™æ˜¯å…¶æœ€ä¸»è¦çš„ç›®çš„ã€‚ç”±äº
Fridaã€Xposed ç­‰æ¡†æ¶ä¸»è¦ Hook çš„æ˜¯ App è¿›ç¨‹ç©ºé—´ä¸­çš„å‡½æ•°ï¼ˆJava API æˆ–
Native APIï¼‰ï¼Œ<code>SVC</code> æŒ‡ä»¤ç›´æ¥ä¸å†…æ ¸äº¤äº’ï¼Œä½¿å¾—è¿™äº›ä¸Šå±‚ Hook
å®Œå…¨å¤±æ•ˆã€‚</p></li>
<li><p><strong>è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>: ç›´æ¥ä½¿ç”¨
<code>open</code>/<code>read</code> çš„ç³»ç»Ÿè°ƒç”¨å·æ¥è¯»å–
<code>/proc/self/maps</code>, <code>/proc/cpuinfo</code>
ç­‰æ–‡ä»¶ï¼Œä»¥æ£€æµ‹ç¯å¢ƒæˆ–æ”¶é›†æŒ‡çº¹ã€‚</p></li>
<li><p><strong>æ‰§è¡Œåè°ƒè¯•</strong>: ä½¿ç”¨ <code>ptrace</code>
çš„ç³»ç»Ÿè°ƒç”¨å·æ¥æ‰§è¡Œåè°ƒè¯•æ£€æŸ¥ã€‚</p></li>
<li><p><strong>ç»•è¿‡ API Hook</strong>: è¿™æ˜¯å…¶æœ€ä¸»è¦çš„ç›®çš„ã€‚ç”±äº
Fridaã€Xposed ç­‰æ¡†æ¶ä¸»è¦ Hook çš„æ˜¯ App è¿›ç¨‹ç©ºé—´ä¸­çš„å‡½æ•°ï¼ˆJava API æˆ–
Native APIï¼‰ï¼Œ<code>SVC</code> æŒ‡ä»¤ç›´æ¥ä¸å†…æ ¸äº¤äº’ï¼Œä½¿å¾—è¿™äº›ä¸Šå±‚ Hook
å®Œå…¨å¤±æ•ˆã€‚</p></li>
<li><p><strong>è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>: ç›´æ¥ä½¿ç”¨
<code>open</code>/<code>read</code> çš„ç³»ç»Ÿè°ƒç”¨å·æ¥è¯»å–
<code>/proc/self/maps</code>, <code>/proc/cpuinfo</code>
ç­‰æ–‡ä»¶ï¼Œä»¥æ£€æµ‹ç¯å¢ƒæˆ–æ”¶é›†æŒ‡çº¹ã€‚</p></li>
<li><p><strong>æ‰§è¡Œåè°ƒè¯•</strong>: ä½¿ç”¨ <code>ptrace</code>
çš„ç³»ç»Ÿè°ƒç”¨å·æ¥æ‰§è¡Œåè°ƒè¯•æ£€æŸ¥ã€‚</p></li>
<li><p><strong>åˆ†æä¸è¯†åˆ«</strong>:</p></li>
<li><p><strong>é™æ€åˆ†æ</strong>: åœ¨ IDA ç­‰åæ±‡ç¼–å·¥å…·ä¸­ï¼Œç›´æ¥æœç´¢
<code>SVC</code> æŒ‡ä»¤ã€‚å¦‚æœä¸€ä¸ª SO æ–‡ä»¶ä¸­å«æœ‰å¤§é‡ <code>SVC</code>
æŒ‡ä»¤ï¼Œä¸”å…¶ä¸Šä¸‹æ–‡é€»è¾‘å¤æ‚ï¼Œåˆ™ææœ‰å¯èƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚</p></li>
<li><p><strong>åŠ¨æ€åˆ†æ</strong>: Hook ç³»ç»Ÿè°ƒç”¨éœ€è¦æ›´åº•å±‚çš„å·¥å…·ã€‚Frida
çš„ <code>Stalker</code> å¯ä»¥ç”¨æ¥è·Ÿè¸ªæŒ‡ä»¤çº§çš„æ‰§è¡Œæµç¨‹ï¼Œä»è€Œæ•æ‰åˆ°
<code>SVC</code> çš„è°ƒç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Hook
<code>libc.so</code> ä¸­ä¸ <code>syscall</code>
ç›¸å…³çš„åº•å±‚å‡½æ•°æ¥å°è¯•æ•è·ã€‚</p></li>
<li><p><strong>é™æ€åˆ†æ</strong>: åœ¨ IDA ç­‰åæ±‡ç¼–å·¥å…·ä¸­ï¼Œç›´æ¥æœç´¢
<code>SVC</code> æŒ‡ä»¤ã€‚å¦‚æœä¸€ä¸ª SO æ–‡ä»¶ä¸­å«æœ‰å¤§é‡ <code>SVC</code>
æŒ‡ä»¤ï¼Œä¸”å…¶ä¸Šä¸‹æ–‡é€»è¾‘å¤æ‚ï¼Œåˆ™ææœ‰å¯èƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚</p></li>
<li><p><strong>åŠ¨æ€åˆ†æ</strong>: Hook ç³»ç»Ÿè°ƒç”¨éœ€è¦æ›´åº•å±‚çš„å·¥å…·ã€‚Frida
çš„ <code>Stalker</code> å¯ä»¥ç”¨æ¥è·Ÿè¸ªæŒ‡ä»¤çº§çš„æ‰§è¡Œæµç¨‹ï¼Œä»è€Œæ•æ‰åˆ°
<code>SVC</code> çš„è°ƒç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Hook
<code>libc.so</code> ä¸­ä¸ <code>syscall</code>
ç›¸å…³çš„åº•å±‚å‡½æ•°æ¥å°è¯•æ•è·ã€‚</p></li>
</ul>
<h3 id="ç½‘ç»œç¯å¢ƒæŒ‡çº¹">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</h3>
<ul>
<li><p><strong>IP åœ°å€</strong>:
æœ€åŸºç¡€çš„ç»´åº¦ï¼Œç»“åˆåœ°ç†ä½ç½®åº“å¯ä»¥åˆ¤æ–­ç”¨æˆ·ä½ç½®ã€‚</p></li>
<li><p><strong>ç½‘ç»œä¿¡æ¯</strong>: è¿è¥å•†åç§°
(<code>TelephonyManager.getNetworkOperatorName</code>)ã€Wi-Fi
BSSID/SSIDã€‚</p></li>
<li><p><strong>TLS/JA3 æŒ‡çº¹</strong>: åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯
<code>Client Hello</code>
åŒ…çš„ç‰¹å¾å¯ä»¥æ„æˆä¸€ä¸ªç¨³å®šçš„æŒ‡çº¹ï¼Œç”¨äºè¯†åˆ«ç‰¹å®šçš„ç½‘ç»œåº“å’Œç‰ˆæœ¬ã€‚</p></li>
</ul>
<h3 id="è¡Œä¸ºç‰¹å¾æŒ‡çº¹">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</h3>
<p>è¡Œä¸ºç‰¹å¾æ˜¯ä¸€ç§åŠ¨æ€æŒ‡çº¹ï¼ŒåŸºäºç”¨æˆ·çš„æ“ä½œæ¨¡å¼å’Œè®¾å¤‡ä½¿ç”¨ä¹ æƒ¯ã€‚</p>
<h4 id="é‡‡é›†ç»´åº¦">é‡‡é›†ç»´åº¦</h4>
<ul>
<li>*1. è§¦æ‘¸è¡Œä¸º** ```java // è§¦æ‘¸äº‹ä»¶é‡‡é›† view.setOnTouchListener(new
View.OnTouchListener() { <span class="citation"
data-cites="Override">@Override</span> public boolean onTouch(View v,
MotionEvent event) { // é‡‡é›†è§¦æ‘¸å‹åŠ› float pressure =
event.getPressure(); // é‡‡é›†è§¦æ‘¸é¢ç§¯ float size = event.getSize(); //
é‡‡é›†è§¦æ‘¸åæ ‡andTimeæˆ³ long timestamp = event.getEventTime(); float x =
event.getX(); float y = event.getY();</li>
</ul>
<p>// Buildè§¦æ‘¸ç‰¹å¾å‘é‡ TouchFeature feature = new TouchFeature(
pressure, size, timestamp, x, y ); return false; } });</p>
<pre><code>- æ‰‹æŒ‡æ¥è§¦é¢ç§¯


* *2. ä¼ æ„Ÿå™¨è¡Œä¸º**
    ```java
// åŠ é€Ÿè®¡/é™€èºä»ªæ•°æ®é‡‡é›†
SensorManager sensorManager = (SensorManager) getSystemService(SENSOR_SERVICE);
Sensor accelerometer = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);

sensorManager.registerListener(new SensorEventListener() {
@Override
public void onSensorChanged(SensorEvent event) {
float x = event.values[0];
float y = event.values[1];
float z = event.values[2];

// AnalysisæŒæ¡å§¿æ€ã€æ­¥æ€ç‰¹å¾etc.
analyzeMotionPattern(x, y, z);
}

@Override
public void onAccuracyChanged(Sensor sensor, int accuracy) {}
}, accelerometer, SensorManager.SENSOR_DELAY_NORMAL);
</code></pre>
<ul>
<li><p>*3. åº”ç”¨ä½¿ç”¨æ¨¡å¼**</p></li>
<li><p>Appå¯åŠ¨æ—¶é—´åˆ†å¸ƒ</p></li>
<li><p>å¸¸ç”¨ App åˆ—è¡¨åŠä½¿ç”¨é¢‘ç‡</p></li>
<li><p>å‰åå°åˆ‡æ¢æ¨¡å¼</p></li>
<li><p>åº”ç”¨å®‰è£…/å¸è½½ä¹ æƒ¯</p></li>
<li><p>*4. ç½‘ç»œè¡Œä¸º**</p></li>
<li><p>è®¿é—®æ—¶é—´æ¨¡å¼ï¼ˆå·¥ä½œæ—¥vså‘¨æœ«ï¼Œç™½å¤©vsæ™šä¸Šï¼‰</p></li>
<li><p>è¯·æ±‚é¢‘ç‡å’Œé—´éš”</p></li>
<li><p>ç½‘ç»œåˆ‡æ¢ä¹ æƒ¯ï¼ˆWiFi â†”ï¸ 4G/5Gï¼‰</p></li>
<li><p>å¸¸ç”¨åœ°ç†ä½ç½®</p></li>
</ul>
<h4 id="è¡Œä¸ºæŒ‡çº¹ç”Ÿæˆ">è¡Œä¸ºæŒ‡çº¹ç”Ÿæˆ</h4>
<div class="sourceCode" id="cb132"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BehaviorFingerprint:</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.touch_features <span class="op">=</span> []</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.sensor_features <span class="op">=</span> []</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.app_usage <span class="op">=</span> {}</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.network_pattern <span class="op">=</span> {}</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_touch_signature(<span class="va">self</span>, touch_events):</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">ä»è§¦æ‘¸äº‹ä»¶æå–ç”¨æˆ·Signature</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="co"># CalculateStatisticsç‰¹å¾</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>pressures <span class="op">=</span> [e.pressure <span class="cf">for</span> e <span class="kw">in</span> touch_events]</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>velocities <span class="op">=</span> <span class="va">self</span>._calculate_velocities(touch_events)</span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>signature <span class="op">=</span> {</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;avg_pressure&#39;</span>: np.mean(pressures),</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;std_pressure&#39;</span>: np.std(pressures),</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;avg_velocity&#39;</span>: np.mean(velocities),</span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;touch_rhythm&#39;</span>: <span class="va">self</span>._analyze_rhythm(touch_events)</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> signature</span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_behavior_fingerprint(<span class="va">self</span>):</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a><span class="co">Generateç»¼åˆè¡Œä¸ºæŒ‡çº¹</span></span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>touch_sig <span class="op">=</span> <span class="va">self</span>.extract_touch_signature(<span class="va">self</span>.touch_features)</span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a>motion_sig <span class="op">=</span> <span class="va">self</span>.extract_motion_signature(<span class="va">self</span>.sensor_features)</span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>usage_sig <span class="op">=</span> <span class="va">self</span>.extract_usage_signature(<span class="va">self</span>.app_usage)</span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ç»„åˆä¸ºè¡Œä¸ºç‰¹å¾å‘é‡</span></span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>behavior_vector <span class="op">=</span> {</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;touch&#39;</span>: touch_sig,</span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;motion&#39;</span>: motion_sig,</span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;usage&#39;</span>: usage_sig,</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;network&#39;</span>: <span class="va">self</span>.network_pattern</span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-39"><a href="#cb132-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-40"><a href="#cb132-40" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> hashlib.sha256(</span>
<span id="cb132-41"><a href="#cb132-41" aria-hidden="true" tabindex="-1"></a>json.dumps(behavior_vector, sort_keys<span class="op">=</span><span class="va">True</span>).encode()</span>
<span id="cb132-42"><a href="#cb132-42" aria-hidden="true" tabindex="-1"></a>).hexdigest()</span></code></pre></div>
<p>import numpy as np</p>
<p>class BehaviorClassifier: def <strong>init</strong>(self): self.model
= RandomForestClassifier(n_estimators=100)</p>
<p>def train(self, features, labels): â€œâ€œâ€ è®­ç»ƒè¡Œä¸ºè¯†åˆ«æ¨¡Type features:
è¡Œä¸ºç‰¹å¾å‘é‡Array labels: è®¾å¤‡/ç”¨æˆ·æ ‡è¯† â€œâ€œâ€ self.model.fit(features,
labels)</p>
<p>def predict_device(self, behavior_features): â€œâ€œâ€
æ ¹æ®è¡Œä¸ºç‰¹å¾é¢„æµ‹è®¾å¤‡èº«ä»½ â€œâ€œâ€ # ç‰¹å¾å‘é‡åŒ– feature_vector =
self._vectorize(behavior_features)</p>
<h1 id="é¢„æµ‹">é¢„æµ‹</h1>
<p>device_id = self.model.predict([feature_vector])[0] confidence =
self.model.predict_proba([feature_vector]).max()</p>
<p>return device_id, confidence</p>
<p>def detect_anomaly(self, behavior_features, known_device_id): â€œâ€œâ€
æ£€æµ‹å¼‚å¸¸è¡Œä¸ºï¼ˆå¯èƒ½æ˜¯è´¦å·è¢«ç›—æˆ–è®¾å¤‡è¢«å†’ç”¨ï¼‰ â€œâ€œâ€ predicted_id, confidence
= self.predict_device(behavior_features)</p>
<p>if predicted_id != known_device_id: return True, fâ€Behavior mismatch
(confidence: {confidence})â€</p>
<p>if confidence &lt; 0.7: return True, â€œLow confidence in behavior
matchâ€</p>
<p>return False, â€œNormal behaviorâ€</p>
<pre><code>
**æ ¸å¿ƒæ€è·¯**: è¯†åˆ« -&gt; Hook -&gt; ä¼ªé€ 
1. **è¯†åˆ«**: å®šä½ App è·å–å…³é”®æŒ‡çº¹ä¿¡æ¯çš„ä»£ç ä½ç½®ï¼ˆJava API æˆ– JNI å‡½æ•°ï¼‰ã€‚
2. **Hook**: ä½¿ç”¨ Frida æˆ– Xposed æ‹¦æˆªè¿™äº›å‡½æ•°çš„è°ƒç”¨ã€‚
3. **ä¼ªé€ **: åœ¨å‡½æ•°è¿”å›å‰ï¼Œç”¨ä¸€å¥—é¢„è®¾çš„ã€è‡ªæ´½çš„å‡æ•°æ®æ›¿æ¢çœŸå®è¿”å›å€¼ã€‚


**Frida æ¦‚å¿µè„šæœ¬ (ä¼ªé€  Build.MODEL):**

```javascript
Java.perform(function () {
var Build = Java.use(&quot;android.os.Build&quot;);
Build.MODEL.value = &quot;Pixel 4&quot;; // Modify MODEL Field

var String = Java.use(&quot;java.lang.String&quot;);
var TelephonyManager = Java.use(&quot;android.telephony.TelephonyManager&quot;);
TelephonyManager.getDeviceId.overload().implementation = function () {
console.log(&quot;Hooked getDeviceId(). Returning a fake IMEI.&quot;);
return String.$new(&quot;867530900000000&quot;); // Returnä¼ªé€  IMEI
};
});
</code></pre>
<ul>
<li><p><strong>ä¼˜ç‚¹</strong>: æ— æ³•é€šè¿‡åº”ç”¨å±‚çš„æ£€æµ‹æ‰‹æ®µè¯†ç ´ï¼Œå› ä¸º App
è·å–åˆ°çš„å°±æ˜¯ç³»ç»Ÿå±‚è¿”å›çš„â€çœŸå®â€æ•°æ®ã€‚</p></li>
<li><p><strong>ç¼ºç‚¹</strong>: æŠ€æœ¯é—¨æ§›é«˜ï¼Œå·¥ä½œé‡å·¨å¤§ã€‚</p></li>
</ul>
<h3 id="ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</h3>
<p>è™šæ‹ŸåŒ–å’Œå®¹å™¨æŠ€æœ¯æ˜¯è§„æ¨¡åŒ–è®¾å¤‡æŒ‡çº¹ç»•è¿‡çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œèƒ½å¤Ÿåœ¨å•å°ç‰©ç†æœºä¸Šè¿è¡Œæ•°ç™¾ä¸ªç‹¬ç«‹çš„Androidå®ä¾‹ã€‚</p>
<h4 id="androidè™šæ‹ŸåŒ–æŠ€æœ¯æ ˆ">androidè™šæ‹ŸåŒ–æŠ€æœ¯æ ˆ</h4>
<p><strong>1. åŸºäºQEMUçš„å®Œæ•´è™šæ‹ŸåŒ–</strong></p>
<p>Androidå®˜æ–¹æ¨¡æ‹Ÿå™¨ï¼ˆAVDï¼‰åŸºäºQEMUå®ç°ï¼š</p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># startupAVDæ¨¡æ‹Ÿå™¨</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="ex">emulator</span> <span class="at">-avd</span> Pixel_6_API_33 <span class="dt">\</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>- no-snapshot <span class="dt">\</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>- wipe-data <span class="dt">\</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>- gpu swiftshader_indirect</span></code></pre></div>
<p><strong>ä¸»è¦é—®é¢˜</strong>ï¼š</p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å®¹æ˜“è¢«æ£€æµ‹çš„ç‰¹å¾</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.hardware <span class="co"># Return &quot;goldfish&quot; or &quot;ranchu&quot;</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.product.model <span class="co"># Return &quot;android SDK built for x86&quot;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.build.fingerprint <span class="co"># Contains &quot;é€šç”¨&quot; å­—æ ·</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ç¼ºå¤±ä¼ æ„Ÿå™¨</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="ex">pm</span> list features <span class="kw">|</span> <span class="fu">grep</span> sensor <span class="co"># å¤§é‡ä¼ æ„Ÿå™¨ç¼ºå¤±</span></span></code></pre></div>
<p>wget
https://osdn.net/projects/android-x86/releases/android-x86_64-9.0-r2.iso</p>
<h1 id="åœ¨å†…-virtualbox-createè™šæ‹Ÿæœº">åœ¨å†… VirtualBox, Createè™šæ‹Ÿæœº</h1>
<p>VBoxManage createvm â€“name â€œAndroid-x86â€ â€“ostype â€œLinux_64â€ â€“register
VBoxManage modifyvm â€œAndroid-x86â€ â€“memory 4096 â€“vram 128 VBoxManage
storagectl â€œAndroid-x86â€ â€“name â€œSATAâ€ â€“add sata VBoxManage storageattach
â€œAndroid-x86â€ â€“storagectl â€œSATAâ€<br />
â€“port 0 â€“device 0 â€“type dvddrive â€“medium android-x86.iso</p>
<pre><code>

* *ç¼ºç‚¹**ï¼š
- ä»æœ‰è™šæ‹ŸåŒ–ç‰¹å¾
- GPUåŠ é€Ÿæ”¯æŒæœ‰é™
- ARMåº”ç”¨å…¼å®¹æ€§å·®ï¼ˆéœ€è¦ARMè½¬è¯‘å±‚ï¼‰


* *3. åŸºäºå®¹å™¨çš„æ–¹æ¡ˆ (Docker/LXC)**

å®¹å™¨æŠ€æœ¯æä¾›æ›´è½»é‡çš„éš”ç¦»ï¼š

```dockerfile
# Dockerfile for android container
FROM ubuntu:20.04

# å®‰è£… android ç¯å¢ƒ
RUN apt-get update &amp;&amp; apt-get install -y \
openjdk-11-jdk \
android-sdk \
adb \
fastboot

# é…ç½® android ç¯å¢ƒ
ENV ANDROID_HOME=/opt/android-sdk
ENV PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools

# RunADBService
CMD [&quot;adb&quot;, &quot;-a&quot;, &quot;nodaemon&quot;, &quot;server&quot;]
</code></pre>
<div class="line-block">LXC/LXD | ç³»ç»Ÿçº§ | é«˜ | å¤šç§Ÿæˆ·ã€äº‘æ‰‹æœº |<br />
Kubernetes | é›†ç¾¤çº§ | ä¸­ | å¤§è§„æ¨¡éƒ¨ç½² |</div>
<ul>
<li>*4. ä¸“ä¸šå®¹å™¨æ–¹æ¡ˆï¼šRedroid**</li>
</ul>
<p>Redroid æ˜¯ä¸€ä¸ªåŸºäºDockerçš„Androidå®¹å™¨æ–¹æ¡ˆï¼š</p>
<div class="sourceCode" id="cb137"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RunRedroidå®¹å™¨</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>--name redroid <span class="dt">\</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>--privileged <span class="dt">\</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>-v ~/data:/data <span class="dt">\</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>-p 5555:5555 <span class="dt">\</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>redroid/redroid:11.0.0-latest</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to to to to to to Redroid</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> connect localhost:5555</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell</span></code></pre></div>
<ul>
<li>æ”¯æŒGPUåŠ é€Ÿï¼ˆé€šè¿‡ mesa/virglï¼‰</li>
</ul>
<h4 id="è™šæ‹ŸåŒ–æ£€æµ‹å¯¹æŠ—">è™šæ‹ŸåŒ–æ£€æµ‹å¯¹æŠ—</h4>
<ul>
<li>*æ£€æµ‹ç‚¹1ï¼šBuildå±æ€§**</li>
</ul>
<div class="sourceCode" id="cb138"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å®¹æ˜“æš´éœ²çš„å±æ€§</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.hardware <span class="co"># goldfish/ranchu</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.product.board <span class="co"># goldfish_x86</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.product.device <span class="co"># generic</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.build.product <span class="co"># sdk_gphone_x86</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="ex">getprop</span> ro.build.tags <span class="co"># test-keys</span></span></code></pre></div>
<p>ro.hardware=qcom ro.product.board=msmnile
ro.product.device=OnePlus7Pro ro.build.product=OnePlus7Pro
ro.build.tags=release-keys EOF</p>
<pre><code># è™šæ‹Ÿæœºå¯èƒ½æ˜¾ç¤º: Intel Core i7 (ä¸»æœº CPU)
# çœŸæœºåº”è¯¥æ˜¾ç¤º: Qualcomm Snapdragon 888

# DetectionHypervisor
cat /proc/cpuinfo | grep hypervisor
# If exists at, indicatesRunAtè™šæ‹ŸæœºIn
</code></pre>
<p>static int c_show(struct seq_file <em>m, void </em>v) { //
ä¼ªé€ CPUInfo seq_printf(m, â€œmodel name %sâ€, fake_cpu_name); // â€¦ }</p>
<pre><code>List&lt;Sensor&gt; sensors = sm.getSensorList(Sensor.TYPE_ALL);

// æ¨¡æ‹Ÿå™¨å¯èƒ½åªæœ‰ 3-5 ä¸ªåŸºæœ¬ä¼ æ„Ÿå™¨
if (sensors.size() &lt; 15) {
// å¯èƒ½æ˜¯æ¨¡æ‹Ÿå™¨
}
</code></pre>
<p>â€œandroid.hardware.SensorManagerâ€, lpparam.classLoader,
â€œgetSensorListâ€, int.class, new XC_MethodHook() { <span class="citation"
data-cites="Override">@Override</span> protected void
afterHookedMethod(MethodHookParam param) { List<Sensor> original =
(List<Sensor>) param.getResult(); // Addä¼ªé€ ä¼ æ„Ÿå™¨
original.add(createFakeSensor(Sensor.TYPE_GYROSCOPE));
original.add(createFakeSensor(Sensor.TYPE_MAGNETIC_FIELD)); // â€¦
param.setResult(original); } } );</p>
<pre><code>ls -la /dev/ | grep -E &quot;qemu|vbox|vmware&quot;

# æ£€æµ‹ç‰¹å®šè®¾å¤‡èŠ‚ç‚¹
if [ -e &quot;/dev/socket/qemud&quot; ]; then
echo &quot;Emulator detected&quot;
fi
</code></pre>
<h1 id="systembinsh">!/system/bin/sh</h1>
<h1 id="åˆ é™¤æˆ–éšè—æ¨¡æ‹Ÿå™¨ç‰¹å¾">åˆ é™¤æˆ–éšè—æ¨¡æ‹Ÿå™¨ç‰¹å¾</h1>
<p>rm -f /dev/socket/qemud rm -f /dev/qemu_pipe mount -o bind /dev/null
/system/bin/qemu-props EOF</p>
<pre><code># ConfigGPUç›´é€šï¼ˆNeedIOMMUSupportï¼‰
# ç¼–è¾‘ /etc/é»˜è®¤/grub
GRUB_CMDLINE_LINUX=&quot;intel_iommu=on vfio-pci.ids=10de:1b80&quot;

# åˆ›å»ºå¸¦ GPU çš„è™šæ‹Ÿæœº
virt-install \
- -name android-vm \
- -ram 8192 \
- -vcpus 4 \
- -disk path=/var/lib/libvirt/images/android.qcow2 \
- -hostdev 01:00.0 # GPU PCIAddress
</code></pre>
<p>snap install â€“devmode â€“beta anbox</p>
<h1
id="anboxuselxcå®¹å™¨å‡ ä¹noperformanceæŸå¤±">AnboxUseLXCå®¹å™¨ï¼Œå‡ ä¹NoPerformanceæŸå¤±</h1>
<p>lxc-info -n android</p>
<pre><code>

* *3. åµŒå¥—è™šæ‹ŸåŒ–**

åœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡ŒAndroidè™šæ‹Ÿæœºï¼š

```bash
# AWS EC2ä¸ŠEnabledåµŒå¥—è™šæ‹ŸåŒ–
aws ec2 modify-instance-attribute \
--instance-id i-1234567890abcdef0 \
--cpu-options &quot;CoreCount=4,ThreadsPerCore=2&quot;

# æ£€æŸ¥ if KVM is å¯ç”¨
lsmod | grep kvm
</code></pre>
<p>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚Android â”‚ â”‚Android â”‚
â”‚Android â”‚ â”‚ â”‚ â”‚Container â”‚ â”‚Container â”‚ â”‚Container â”‚ â€¦ â”‚ â”‚ â”‚ #1 â”‚ â”‚ #2
â”‚ â”‚ #N â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ å®¹å™¨ç¼–æ’Layer
(Orchestration) â”‚ â”‚ - è°ƒåº¦ (Scheduling) â”‚ â”‚ - è´Ÿè½½å‡è¡¡ (Load Balancing)
â”‚ â”‚ - Autoæ‰©ç¼©å®¹ (Auto Scaling) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ç‰©ç†Server /
äº‘Mainæœº â”‚ â”‚ - é«˜PerformanceCPU (å¤šCore) â”‚ â”‚ - å¤§Memory (128GB+) â”‚ â”‚ -
GPU (Optionalï¼ŒUsed foråŠ é€Ÿ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code>kind: Deployment
metadata:
name: android-farm
spec:
replicas: 50 # 50androidInstance
selector:
matchLabels:
app: android
template:
metadata:
labels:
app: android
spec:
containers:
- name: android
image: redroid/redroid:11.0.0
securityContext:
privileged: true
resources:
limits:
memory: &quot;2Gi&quot;
cpu: &quot;2&quot;
ports:
- containerPort: 5555
image: redroid/redroid:11.0.0
securityContext:
privileged: true
resources:
limits:
memory: &quot;2Gi&quot;
cpu: &quot;2&quot;
ports:
- containerPort: 5555
___
apiVersion: v1
kind: Service
metadata:
name: android-service
spec:
type: LoadBalancer
selector:
app: android
ports:
- port: 5555
targetPort: 5555
</code></pre>
<h4 id="äº‘æ‰‹æœºæ¶æ„">äº‘æ‰‹æœºæ¶æ„</h4>
<p><strong>1. æŠ€æœ¯æ ˆåˆ†å±‚</strong></p>
<pre><code>â”‚ - WebControlå° â”‚
â”‚ - APIService â”‚
â”‚ - AutoåŒ–Script â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº‘æ‰‹æœºInstanceLayer (Instance Layer) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ äº‘æ‰‹æœº1 â”‚ â”‚ äº‘æ‰‹æœº2 â”‚ ... â”‚
â”‚ â”‚ Android â”‚ â”‚ Android â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è™šæ‹ŸåŒ–Layer (Virtualization Layer) â”‚
â”‚ - ARMè™šæ‹ŸåŒ– (KVM/QEMU) â”‚
â”‚ - GPUè™šæ‹ŸåŒ– (vGPU) â”‚
â”‚ - Networkè™šæ‹ŸåŒ– (VPC) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¡¬ä»¶Layer (Hardware Layer) â”‚
â”‚ - ARMServer (åä¸ºé²²é¹/é£è…¾) â”‚
â”‚ - é«˜PerformanceStorage (NVMe SSD) â”‚
â”‚ - ä¸“ç”¨GPU (Mali/Adreno) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ul>
<li>AWS Graviton2</li>
</ul>
<p>ä¼˜åŠ¿ï¼š - åŸç”ŸARMæŒ‡ä»¤é›†ï¼ŒNoéœ€è½¬è¯‘ - æ€§èƒ½æ¥è¿‘çœŸå®è®¾å¤‡ - å…¼å®¹æ€§æå¥½
```</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼š</p>
<div class="sourceCode" id="cb146"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># UselibvirtManageKVMè™šæ‹Ÿæœº</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="ex">virsh</span> define android-vm.xml</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># android-vm.xml</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>domain <span class="va">type</span><span class="op">=</span><span class="st">&#39;kvm&#39;</span><span class="op">&gt;</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>name<span class="op">&gt;</span>android-1<span class="op">&lt;</span>/name<span class="op">&gt;</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>memory <span class="va">unit</span><span class="op">=</span><span class="st">&#39;GiB&#39;</span><span class="op">&gt;</span>4<span class="op">&lt;</span>/memory<span class="op">&gt;</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>vcpu<span class="op">&gt;</span>4<span class="op">&lt;</span>/vcpu<span class="op">&gt;</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>os<span class="op">&gt;</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>type <span class="va">arch</span><span class="op">=</span><span class="st">&#39;aarch64&#39;</span><span class="op">&gt;</span>hvm<span class="op">&lt;</span>/type<span class="op">&gt;</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>boot <span class="va">dev</span><span class="op">=</span><span class="st">&#39;hd&#39;</span>/<span class="op">&gt;</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>/os<span class="op">&gt;</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>devices<span class="op">&gt;</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>disk <span class="va">type</span><span class="op">=</span><span class="st">&#39;file&#39;</span> <span class="va">device</span><span class="op">=</span><span class="st">&#39;disk&#39;</span><span class="op">&gt;</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>source <span class="va">file</span><span class="op">=</span><span class="st">&#39;/var/lib/libvirt/images/android.img&#39;</span>/<span class="op">&gt;</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>target <span class="va">dev</span><span class="op">=</span><span class="st">&#39;vda&#39;</span> <span class="va">bus</span><span class="op">=</span><span class="st">&#39;virtio&#39;</span>/<span class="op">&gt;</span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>/disk<span class="op">&gt;</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>graphics <span class="va">type</span><span class="op">=</span><span class="st">&#39;vnc&#39;</span> <span class="va">port</span><span class="op">=</span><span class="st">&#39;5900&#39;</span>/<span class="op">&gt;</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>/devices<span class="op">&gt;</span></span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>/domain<span class="op">&gt;</span></span></code></pre></div>
<ul>
<li>è‡ªç ”å®¹å™¨RunWhen</li>
</ul>
<p>ä¼˜åŠ¿ï¼š - æé«˜å¯†åº¦ (å•å°ServerRun100+Instance) - å¿«é€ŸStart/Boot
(&lt;5Second) - Resourceså ç”¨ä½ ```</p>
<p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<div class="sourceCode" id="cb147"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use to runandroid</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="ex">lxc</span> launch ubuntu:20.04 android-base</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="ex">lxc</span> exec android-base <span class="at">--</span> bash</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co"># åœ¨å†… å®¹å™¨, Installandroid</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install android-tools-adb android-tools-fastboot</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co"># é…ç½® android ç³»ç»Ÿ</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="ex">lxc</span> config set android-base raw.lxc <span class="st">&quot;lxc.mount.auto = proc:rw sys:rw&quot;</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="ex">lxc</span> config device add android-base kmsg unix-char path=/dev/kmsg</span></code></pre></div>
<ul>
<li>è½¯ä»¶æ¸²æŸ“ (SwiftShader, ANGLE)</li>
</ul>
<p>Appåœºæ™¯ï¼š - æ¸¸æˆäº‘æ‰‹æœº - è§†é¢‘Process - å›¾å½¢æ¸²æŸ“ ```</p>
<h4 id="äº‘æ‰‹æœºå¹³å°å¯¹æ¯”">äº‘æ‰‹æœºå¹³å°å¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>å¹³å°</th>
<th>æ¶æ„</th>
<th>å¯†åº¦</th>
<th>æ€§èƒ½</th>
<th>æˆæœ¬</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>åä¸ºäº‘æ‰‹æœº</td>
<td>ARMæœåŠ¡å™¨+KVM</td>
<td>ä¸­</td>
<td>é«˜</td>
<td>é«˜</td>
<td>ä¼ä¸šçº§åº”ç”¨</td>
</tr>
<tr>
<td>çº¢æ‰‹æŒ‡</td>
<td>ARMå®¹å™¨</td>
<td>é«˜</td>
<td>ä¸­</td>
<td>ä¸­</td>
<td>è‡ªåŠ¨åŒ–ã€æŒ‚æœº</td>
</tr>
<tr>
<td>å¤šå¤šäº‘æ‰‹æœº</td>
<td>x86+å®¹å™¨</td>
<td>é«˜</td>
<td>ä½</td>
<td>ä½</td>
<td>æ‰¹é‡æ³¨å†Œã€å…»å·</td>
</tr>
<tr>
<td>AWS Device Farm</td>
<td>çœŸæœº</td>
<td>ä½</td>
<td>æé«˜</td>
<td>æé«˜</td>
<td>æµ‹è¯•ã€å…¼å®¹æ€§éªŒè¯</td>
</tr>
</tbody>
</table>
<h4 id="äº‘æ‰‹æœºæŒ‡çº¹ç‰¹å¾">äº‘æ‰‹æœºæŒ‡çº¹ç‰¹å¾</h4>
<p>äº‘æ‰‹æœºè™½ç„¶æ¥è¿‘çœŸæœºï¼Œä½†ä»æœ‰å¯è¢«æ£€æµ‹çš„ç‰¹å¾ï¼š</p>
<p><strong>æ£€æµ‹ç‚¹1ï¼šæ€§èƒ½ç‰¹å¾å¼‚å¸¸</strong></p>
<div class="sourceCode" id="cb148"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">// äº‘æ‰‹æœºCPUPerformanceå¯èƒ½è¿‡äºä¸€è‡´</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> startTime <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">nanoTime</span><span class="op">();</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span><span class="op">(</span>i<span class="op">);</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> duration <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">nanoTime</span><span class="op">()</span> <span class="op">-</span> startTime<span class="op">;</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Trueæœºä¼šæœ‰æ³¢åŠ¨ï¼Œäº‘æ‰‹æœºå¯èƒ½è¿‡äºStable</span></span></code></pre></div>
<h1 id="äº‘æ‰‹æœºé€šå¸¸ä½¿ç”¨æ•°æ®ä¸­å¿ƒ-ip">äº‘æ‰‹æœºé€šå¸¸ä½¿ç”¨æ•°æ®ä¸­å¿ƒ IP</h1>
<p>curl ifconfig.me # è¿”å›: 42.120.x.x (é˜¿é‡Œäº‘) # 119.28.x.x
(è…¾è®¯äº‘)</p>
<h1 id="detectionipclasstype">DetectionIPClassType</h1>
<p>curl https://api.ipgeolocation.io/ipgeo?apiKey=xxx # organization:
â€œAlibaba Cloudâ€ # isp: â€œChina Mobileâ€ # çœŸæœºæ›´å¸¸è§</p>
<pre><code></code></pre>
<ul>
<li>SupportGPUåŠ é€Ÿ</li>
<li>æä¾›åŸç”Ÿ Android ä½“éªŒ</li>
</ul>
<p>APIUseï¼š</p>
<div class="sourceCode" id="cb150"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> huaweicloudsdkcore.auth.credentials <span class="im">import</span> BasicCredentials</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> huaweicloudsdkcph.v1 <span class="im">import</span> CphClient, RunCloudPhoneRequest</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co"># åˆ›å»ºäº‘æ‰‹æœºå®ä¾‹</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>credentials <span class="op">=</span> BasicCredentials(ak, sk)</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> CphClient.new_builder().with_credentials(credentials).build()</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>request <span class="op">=</span> RunCloudPhoneRequest()</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>request.body <span class="op">=</span> {</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;server_id&quot;</span>: <span class="st">&quot;server-123&quot;</span>,</span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;phone_model&quot;</span>: <span class="st">&quot;cloudphone.arm.d2.16_64&quot;</span>,</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;count&quot;</span>: <span class="dv">10</span></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.run_cloud_phone(request)</span></code></pre></div>
<ul>
<li>7x24å°æ—¶åœ¨çº¿</li>
<li>ä¸»è¦ç”¨äºæ¸¸æˆæŒ‚æœº</li>
</ul>
<p>ç‰¹ç‚¹ï¼š - ä»·æ ¼ä¾¿å®œ (å‡ å…ƒ/æœˆ) - æ€§èƒ½ä¸€èˆ¬ - æœ‰æ˜æ˜¾çš„è™šæ‹ŸåŒ–ç‰¹å¾ ```</p>
<p><strong>3. å¤šå¤šäº‘ (DuoduoCloud)</strong></p>
<pre><code>- æä¾›HTTP API
- æ”¯æŒæ‰¹é‡æ§åˆ¶
- é€‚åˆè‡ªåŠ¨åŒ–ä¸šåŠ¡


ä½¿ç”¨ç¤ºä¾‹ï¼š

```bash
# APIControläº‘æ‰‹æœº
curl -X POST https://api.duoduoyun.com/v1/device/control \
- H &quot;Authorization: Bearer $TOKEN&quot; \
- d &#39;{
&quot;device_id&quot;: &quot;12345&quot;,
&quot;action&quot;: &quot;install_app&quot;,
&quot;package&quot;: &quot;com.example.app&quot;
}&#39;
</code></pre>
<ul>
<li>å®šåˆ¶è®¾å¤‡é…ç½®å‚æ•°</li>
</ul>
<p><strong>ç­–ç•¥2ï¼šè®¾å¤‡æŒ‡çº¹éšæœºåŒ–</strong></p>
<div class="sourceCode" id="cb152"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸ºæ¯ä¸ªäº‘æ‰‹æœºå®ä¾‹ç”Ÿæˆå”¯ä¸€æŒ‡çº¹</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> customize_cloud_phone(device_id):</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>fingerprint <span class="op">=</span> generate_realistic_fingerprint()</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co"># é€šè¿‡ ADB ä¿®æ”¹è®¾å¤‡å±æ€§</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>adb_connect(device_id)</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>adb_shell(<span class="ss">f&quot;setprop ro.product.model </span><span class="sc">{</span>fingerprint[<span class="st">&#39;model&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>adb_shell(<span class="ss">f&quot;setprop ro.build.fingerprint </span><span class="sc">{</span>fingerprint[<span class="st">&#39;build_fp&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a><span class="co"># å®‰è£…éšæœº App</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>install_random_apps(device_id, count<span class="op">=</span>random.randint(<span class="dv">20</span>, <span class="dv">50</span>))</span></code></pre></div>
<h1 id="éšæœºæµè§ˆæ—¶é•¿">éšæœºæµè§ˆæ—¶é•¿</h1>
<p>browse_time = random.randint(300, 1800) # 5-30Minute</p>
<h1 id="éšæœºç‚¹å‡»">éšæœºç‚¹å‡»</h1>
<p>for _ in range(random.randint(5, 20)): x = random.randint(0,
device.width) y = random.randint(0, device.height) device.tap(x, y)
time.sleep(random.uniform(1, 5))</p>
<h1 id="æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®">æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®</h1>
<p>inject_sensor_data(device)</p>
<pre><code>

- --

## å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡

### å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†

#### 1. é¡¶è±¡ç§‘æŠ€ (DingXiang)

* *äº§å“**: é¡¶è±¡è®¾å¤‡æŒ‡çº¹ (Device Fingerprint)

* *æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- é‡‡é›†200+è®¾å¤‡ç‰¹å¾ç»´åº¦
- æ”¯æŒAndroidã€iOSã€Webã€å°ç¨‹åº
- 99.9%+è®¾å¤‡å”¯ä¸€æ€§è¯†åˆ«ç‡
- è®¾å¤‡æŒ‡çº¹æœ‰æ•ˆæœŸ90å¤©+
- æ”¯æŒç§æœ‰åŒ–éƒ¨ç½²


* *æ ¸å¿ƒèƒ½åŠ›**ï¼š
</code></pre>
<ul>
<li>é»‘åå•ç®¡ç† ```</li>
</ul>
<p><strong>å®šä»·</strong>ï¼šæŒ‰APIè°ƒç”¨æ¬¡æ•°è®¡è´¹ï¼Œä¼ä¸šç‰ˆçº¦0.005-0.01å…ƒ/æ¬¡</p>
<h4 id="åŒç›¾ç§‘æŠ€-tongdun">2. åŒç›¾ç§‘æŠ€ (Tongdun)</h4>
<p><strong>äº§å“</strong>: åŒç›¾è®¾å¤‡æŒ‡çº¹</p>
<p><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š - ç»“åˆAIå’Œå¤§æ•°æ®åˆ†æ - è®¾å¤‡è¡Œä¸ºç”»åƒ -
å®æ—¶é£é™©å†³ç­– - è¦†ç›–é‡‘èã€ç”µå•†ã€O2Oç­‰åœºæ™¯</p>
<p><strong>APIç¤ºä¾‹</strong>ï¼š</p>
<div class="sourceCode" id="cb154"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tongdun_device_risk(device_id, event_type):</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="co">CallåŒç›¾è®¾å¤‡é£é™©è¯„ä¼°API</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&quot;https://api.tongdun.cn/riskService&quot;</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;partner_code&quot;</span>: <span class="st">&quot;your_partner_code&quot;</span>,</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;device_id&quot;</span>: device_id,</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;event_type&quot;</span>: event_type, <span class="co"># å¦‚: login, register, pay</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;timestamp&quot;</span>: <span class="bu">int</span>(time.time() <span class="op">*</span> <span class="dv">1000</span>)</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="co"># AddSignature</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>params[<span class="st">&quot;sign&quot;</span>] <span class="op">=</span> generate_sign(params)</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.post(url, json<span class="op">=</span>params)</span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> response.json()</span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> {</span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;risk_score&quot;</span>: result[<span class="st">&quot;final_score&quot;</span>], <span class="co"># é£é™©åˆ†æ•° 0-100</span></span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;risk_level&quot;</span>: result[<span class="st">&quot;risk_level&quot;</span>], <span class="co"># high/medium/low</span></span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;device_labels&quot;</span>: result[<span class="st">&quot;labels&quot;</span>] <span class="co"># è®¾å¤‡æ ‡ç­¾</span></span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li><p>*æŠ€æœ¯ç‰¹ç‚¹**ï¼š</p></li>
<li><p>ä¸“æ³¨äºå†…å®¹å®‰å…¨å’Œä¸šåŠ¡å®‰å…¨</p></li>
<li><p>è®¾å¤‡æŒ‡çº¹+è¡Œä¸ºåˆ†æ</p></li>
<li><p>å®æ—¶é»‘äº§è®¾å¤‡åº“</p></li>
<li><p>æ”¯æŒå¤šåœºæ™¯é£æ§</p></li>
<li><p>*åº”ç”¨åœºæ™¯**ï¼š</p></li>
<li><p>ç¾Šæ¯›å…šè¯†åˆ«</p></li>
<li><p>è™šå‡æ³¨å†Œæ‹¦æˆª</p></li>
<li><p>åˆ·å•æ£€æµ‹</p></li>
<li><p>æ¶æ„çˆ¬è™«è¯†åˆ«</p></li>
</ul>
<h4 id="ç½‘æ˜“æ˜“ç›¾-netease-yidun">4. ç½‘æ˜“æ˜“ç›¾ (NetEase YiDun)</h4>
<ul>
<li><p>*äº§å“**: æ˜“ç›¾è®¾å¤‡æŒ‡çº¹</p></li>
<li><p>*æŠ€æœ¯ç‰¹ç‚¹**ï¼š</p></li>
<li><p>ç½‘æ˜“å†…éƒ¨é£æ§æŠ€æœ¯å¤–åŒ–</p></li>
<li><p>æ¸¸æˆã€ç¤¾äº¤åœºæ™¯ä¼˜åŒ–</p></li>
<li><p>è®¾å¤‡å”¯ä¸€æ€§è¯†åˆ«</p></li>
<li><p>è®¾å¤‡ç¯å¢ƒæ£€æµ‹ï¼ˆRootã€æ¨¡æ‹Ÿå™¨ã€Hookæ¡†æ¶ï¼‰</p></li>
<li><p>*SDKé›†æˆç¤ºä¾‹<strong>ï¼ˆAndroidï¼‰</strong>ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb155"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>NECaptcha<span class="op">.</span><span class="fu">getInstance</span><span class="op">()</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">init</span><span class="op">(</span>context<span class="op">,</span> <span class="st">&quot;your_business_id&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">NECaptchaListener</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onReady</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co">// è·å–è®¾å¤‡æŒ‡çº¹</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> deviceId <span class="op">=</span> NEDeviceRisk<span class="op">.</span><span class="fu">getDeviceId</span><span class="op">();</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a><span class="co">// è·å–è®¾å¤‡é£é™©ä¿¡æ¯</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>NEDeviceRisk<span class="op">.</span><span class="fu">check</span><span class="op">(</span>context<span class="op">,</span> <span class="kw">new</span> <span class="fu">NEDeviceRiskCallback</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onResult</span><span class="op">(</span>NEDeviceRiskResult result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> riskLevel <span class="op">=</span> result<span class="op">.</span><span class="fu">getRiskLevel</span><span class="op">();</span> <span class="co">// 0-4çº§é£é™©</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> isEmulator <span class="op">=</span> result<span class="op">.</span><span class="fu">isEmulator</span><span class="op">();</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> isRooted <span class="op">=</span> result<span class="op">.</span><span class="fu">isRoot</span><span class="op">();</span></span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a><span class="dt">boolean</span> isHooked <span class="op">=</span> result<span class="op">.</span><span class="fu">isHook</span><span class="op">();</span></span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<ul>
<li><p>å¾®ä¿¡ã€QQç”Ÿæ€æ•°æ®æ”¯æŒ</p></li>
<li><p>é»‘äº§è®¾å¤‡åº“å®æ—¶æ›´æ–°</p></li>
<li><p>è®¾å¤‡é£é™©è¯„åˆ†</p></li>
<li><p>*å®šä»·**ï¼š</p></li>
<li><p>æŒ‰QPSè®¡è´¹</p></li>
<li><p>ä¼ä¸šç‰ˆ: çº¦0.01-0.03å…ƒ/æ¬¡</p></li>
<li><p>æ”¯æŒåŒ…å¹´åŒ…æœˆ</p></li>
</ul>
<h3 id="å›½é™…çŸ¥åäº§å“">å›½é™…çŸ¥åäº§å“</h3>
<h4 id="fingerprintjs">1. FingerprintJS</h4>
<ul>
<li><p>*ç±»å‹**: å¼€æº + å•†ä¸šç‰ˆ</p></li>
<li><p>*ç‰¹ç‚¹**ï¼š</p></li>
<li><p>ä¸»è¦ç”¨äº Web æµè§ˆå™¨æŒ‡çº¹</p></li>
<li><p>å¼€æºç‰ˆæœ¬åŸºç¡€åŠŸèƒ½å…è´¹</p></li>
<li><p>Proç‰ˆæä¾›99.5%å‡†ç¡®ç‡</p></li>
<li><p>*ä½¿ç”¨ç¤ºä¾‹**ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb156"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> FingerprintJS <span class="im">from</span> <span class="st">&#39;@fingerprintjs/fingerprintjs&#39;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Initializeagent</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> fpPromise <span class="op">=</span> FingerprintJS<span class="op">.</span><span class="fu">load</span>()</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Getè®¿å®¢æ ‡è¯†</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>fpPromise</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">then</span>(fp <span class="kw">=&gt;</span> fp<span class="op">.</span><span class="fu">get</span>())</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a><span class="co">// ThisIsè®¿å®¢æ ‡è¯†</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> visitorId <span class="op">=</span> result<span class="op">.</span><span class="at">visitorId</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(visitorId)</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a><span class="co">// æ‰€æœ‰Componentï¼ˆæµè§ˆå™¨ç‰¹å¾ï¼‰</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(result<span class="op">.</span><span class="at">components</span>)</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<ul>
<li><p>åŒ…å«æ•°ä¸‡ç§è®¾å¤‡å‹å·</p></li>
<li><p>ä¸»è¦ç”¨äºç§»åŠ¨å¹¿å‘Šå’Œåˆ†æ</p></li>
<li><p>æ”¯æŒäº‘ç«¯APIå’Œæœ¬åœ°éƒ¨ç½²</p></li>
<li><p>*APIç¤ºä¾‹**ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb157"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> deviceatlas <span class="im">import</span> DeviceApi</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> DeviceApi(<span class="st">&quot;/path/to/DeviceAtlas.json&quot;</span>)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co"># æ ¹æ® User-Agent è¯†åˆ«è®¾å¤‡</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>user_agent <span class="op">=</span> <span class="st">&quot;Mozilla/5.0 (Linux; Android 11; Pixel 5)...&quot;</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>properties <span class="op">=</span> api.get_properties(user_agent)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(properties.get(<span class="st">&#39;displayWidth&#39;</span>)) <span class="co"># å±å¹•å®½åº¦</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(properties.get(<span class="st">&#39;model&#39;</span>)) <span class="co"># è®¾å¤‡å‹å·</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(properties.get(<span class="st">&#39;manufacturer&#39;</span>)) <span class="co"># åˆ¶é€ å•†</span></span></code></pre></div>
<ul>
<li>å¹¿å‘Šå½’å› è¿½è¸ª</li>
<li>é˜²ä½œå¼Šæœºåˆ¶</li>
<li>æ”¯æŒIDFAã€GAIDã€è®¾å¤‡æŒ‡çº¹</li>
</ul>
<h4 id="appsflyer">4. AppsFlyer</h4>
<ul>
<li><p>*äº§å“**: ç§»åŠ¨å½’å› å’Œè¥é”€åˆ†æ</p></li>
<li><p>*ç‰¹ç‚¹**ï¼š</p></li>
<li><p>è®¾å¤‡æŒ‡çº¹æŠ€æœ¯</p></li>
<li><p>é˜²ä½œå¼Šï¼ˆProtect360ï¼‰</p></li>
<li><p>æ”¯æŒè·¨å¹³å°è¿½è¸ª</p></li>
<li><p>éšç§ä¿æŠ¤æ¨¡å¼</p></li>
</ul>
<hr />
<h2 id="å¼€æºå·¥å…·ä¸æ¡†æ¶">å¼€æºå·¥å…·ä¸æ¡†æ¶</h2>
<h3 id="è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</h3>
<h4 id="fingerprintjs2-å·²åºŸå¼ƒç”±fingerprintjså–ä»£">1. fingerprintjs2
(å·²åºŸå¼ƒï¼Œç”±FingerprintJSå–ä»£)</h4>
<ul>
<li><p>*GitHub**:
https://github.com/fingerprintjs/fingerprintjs</p></li>
<li><p>*ç‰¹ç‚¹**ï¼š</p></li>
<li><p>è½»é‡çº§æµè§ˆå™¨æŒ‡çº¹åº“</p></li>
<li><p>çº¯JavaScriptå®ç°</p></li>
<li><p>é‡‡é›†Canvasã€WebGLã€Audioç­‰ç‰¹å¾</p></li>
<li><p>*ä½¿ç”¨ç¤ºä¾‹**ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb158"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>Fingerprint2<span class="op">.</span><span class="fu">get</span>(<span class="kw">function</span> (components) {</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Component æ˜¯é”®å€¼å¯¹æ•°ç»„</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> values <span class="op">=</span> components<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span> (component) {</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> component<span class="op">.</span><span class="at">value</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="co">// è®¡ç®—æŒ‡çº¹å“ˆå¸Œ</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> murmur <span class="op">=</span> Fingerprint2<span class="op">.</span><span class="fu">x64hash128</span>(values<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;&#39;</span>)<span class="op">,</span> <span class="dv">31</span>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(murmur) <span class="co">// è®¾å¤‡æŒ‡çº¹</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<ul>
<li><p>æ”¯æŒ12000+è®¾å¤‡å‹å·</p></li>
<li><p>å¯ä»¥æ ¹æ®Build.MODELè·å–å¸‚åœºåŒ–è®¾å¤‡åç§°</p></li>
<li><p>*ä½¿ç”¨ç¤ºä¾‹**ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb159"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>DeviceName<span class="op">.</span><span class="fu">with</span><span class="op">(</span>context<span class="op">).</span><span class="fu">request</span><span class="op">(</span><span class="kw">new</span> DeviceName<span class="op">.</span><span class="fu">Callback</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onFinished</span><span class="op">(</span>DeviceName<span class="op">.</span><span class="fu">DeviceInfo</span> info<span class="op">,</span> <span class="bu">Exception</span> error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> manufacturer <span class="op">=</span> info<span class="op">.</span><span class="fu">manufacturer</span><span class="op">;</span> <span class="co">// &quot;Samsung&quot;</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> marketName <span class="op">=</span> info<span class="op">.</span><span class="fu">marketName</span><span class="op">;</span> <span class="co">// &quot;Galaxy S21&quot;</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> model <span class="op">=</span> info<span class="op">.</span><span class="fu">model</span><span class="op">;</span> <span class="co">// &quot;SM-G991B&quot;</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> codename <span class="op">=</span> info<span class="op">.</span><span class="fu">codename</span><span class="op">;</span> <span class="co">// &quot;o1s&quot;</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<ul>
<li><p>è§£æUser-Agent</p></li>
<li><p>è¯†åˆ«è®¾å¤‡ç±»å‹ã€å“ç‰Œã€å‹å·</p></li>
<li><p>*Pythonç¤ºä¾‹**ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb160"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> device_detector <span class="im">import</span> DeviceDetector</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>user_agent <span class="op">=</span> <span class="st">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X)...&quot;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> DeviceDetector(user_agent).parse()</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(device.os_name()) <span class="co"># iOS</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(device.device_brand()) <span class="co"># Apple</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(device.device_model()) <span class="co"># iPhone</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(device.is_mobile()) <span class="co"># True</span></span></code></pre></div>
<div class="sourceCode" id="cb161"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¿®æ”¹è®¾å¤‡æŒ‡çº¹</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="ex">props</span> ro.build.fingerprint <span class="st">&quot;google/raven/raven:12/...&quot;</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="ex">props</span> ro.product.model <span class="st">&quot;Pixel 6&quot;</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="co"># åº”ç”¨ä¿®æ”¹</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="ex">props</span> ro.build.product <span class="st">&quot;raven&quot;</span></span></code></pre></div>
<h4 id="xposed-æ¨¡å—">2. Xposed æ¨¡å—</h4>
<ul>
<li><p>*a) XPrivacyLua**</p></li>
<li><p>*GitHub**: https://github.com/M66B/XPrivacyLua</p></li>
<li><p>*åŠŸèƒ½**ï¼š</p></li>
<li><p>ç»†ç²’åº¦æƒé™æ§åˆ¶</p></li>
<li><p>APIè¿”å›å€¼Hook</p></li>
<li><p>è®¾å¤‡ä¿¡æ¯ä¼ªé€ </p></li>
<li><p>*ä½¿ç”¨**ï¼š</p></li>
</ul>
<pre><code>    ```

**b) VirtualXposed / Taichi**

**åŠŸèƒ½**ï¼š
- å… Root ä½¿ç”¨ Xposed
- åº”ç”¨è™šæ‹ŸåŒ–
- åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä¿®æ”¹è®¾å¤‡ä¿¡æ¯

#### 3. Frida è„šæœ¬åº“

**a) frida-scripts (è®¾å¤‡æŒ‡çº¹ç›¸å…³)**

å¸¸ç”¨çš„è®¾å¤‡ä¿¡æ¯ Hook è„šæœ¬ï¼š

```javascript
// é€šç”¨è®¾å¤‡ä¿¡æ¯ Hook è„šæœ¬
Java.perform(function() {
// æ‹¦æˆª Build ç±»æ‰€æœ‰å­—æ®µ
var Build = Java.use(&quot;android.os.Build&quot;);
Build.BRAND.value = &quot;google&quot;;
Build.MODEL.value = &quot;Pixel 6&quot;;
Build.DEVICE.value = &quot;raven&quot;;
Build.PRODUCT.value = &quot;raven&quot;;
Build.MANUFACTURER.value = &quot;Google&quot;;

// Hook settingsss.Secure
var Settings = Java.use(&quot;android.provider.Settings$Secure&quot;);
Settings.getString.overload(
&quot;android.content.ContentResolver&quot;,
&quot;java.lang.String&quot;
).implementation = function(resolver, name) {
if (name == &quot;android_id&quot;) {
return &quot;fake_android_id_12345678&quot;;
}
return this.getString(resolver, name);
};

// Hook TelephonyManager
var TelephonyManager = Java.use(&quot;android.telephony.TelephonyManager&quot;);
TelephonyManager.getDeviceId.overload().implementation = function() {
return &quot;fake_imei_123456789012345&quot;;
};
});
</code></pre>
<ul>
<li><p>*åŠŸèƒ½**ï¼š</p></li>
<li><p>ä¿®æ”¹Android ID</p></li>
<li><p>ä¿®æ”¹IMEI/MEID</p></li>
<li><p>ä¿®æ”¹MACåœ°å€</p></li>
<li><p>ä¿®æ”¹æ‰‹æœºå·ç </p></li>
<li><p>ä¿®æ”¹è®¾å¤‡åºåˆ—å·</p></li>
<li><p>*b) Busyboxæ”¹æœº**</p></li>
</ul>
<p>ä½¿ç”¨busyboxå‘½ä»¤ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ï¼š</p>
<div class="sourceCode" id="cb163"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifybuild.prop</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="ex">busybox</span> sed <span class="at">-i</span> <span class="st">&#39;s/ro.product.model=.*/ro.product.model=Pixel 6/&#39;</span> /system/build.prop</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ModifyMultipleProperty</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;&gt;</span> /system/build.prop <span class="op">&lt;&lt; EOF</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="st">ro.product.brand=google</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="st">ro.product.device=raven</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="st">ro.product.manufacturer=Google</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span></code></pre></div>
<p>|â€”â€”|â€”â€”| | <strong>GSMArena API</strong> | è®¾å¤‡è§„æ ¼æ•°æ®åº“ | |
<strong>Device Atlas</strong> | å•†ä¸šè®¾å¤‡å±æ€§API | |
<strong>WURFL</strong> | è®¾å¤‡æè¿°åº“ |</p>
<ul>
<li>*ä½¿ç”¨ç¤ºä¾‹**ï¼š</li>
</ul>
<div class="sourceCode" id="cb164"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_device_specs(model):</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="co">ä»GSMArenaGetè®¾å¤‡è§„æ ¼</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>api_url <span class="op">=</span> <span class="ss">f&quot;https://api.gsmarena.com/devices/</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(api_url)</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> {</span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;model&#39;</span>: data[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;display&#39;</span>: data[<span class="st">&#39;display&#39;</span>],</span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;chipset&#39;</span>: data[<span class="st">&#39;chipset&#39;</span>],</span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;memory&#39;</span>: data[<span class="st">&#39;memory&#39;</span>],</span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;camera&#39;</span>: data[<span class="st">&#39;camera&#39;</span>],</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;battery&#39;</span>: data[<span class="st">&#39;battery&#39;</span>],</span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;sensors&#39;</span>: data[<span class="st">&#39;sensors&#39;</span>]</span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>def <strong>init</strong>(self, device_pool_db): self.db =
device_pool_db self.used_fingerprints = set()</p>
<p>def get_unused_fingerprint(self): â€œâ€œâ€ ä»è®¾å¤‡æ± ä¸­è·å–æœªä½¿ç”¨çš„æŒ‡çº¹ â€œâ€œâ€
while True: fp = self.db.get_random_fingerprint() fp_hash =
hashlib.md5(json.dumps(fp).encode()).hexdigest()</p>
<p>if fp_hash not in self.used_fingerprints:
self.used_fingerprints.add(fp_hash) return fp</p>
<p>def apply_fingerprint(self, adb_device, fingerprint): â€œâ€œâ€
å°†æŒ‡çº¹åº”ç”¨åˆ°è®¾å¤‡ â€œâ€œâ€ # ä¿®æ”¹ç³»ç»Ÿå±æ€§ for key, value in
fingerprint[â€˜build_propsâ€™].items(): adb_device.shell(fâ€setprop {key}
{value}â€œ)</p>
<h1 id="å®‰è£…é¢„è®¾-app">å®‰è£…é¢„è®¾ App</h1>
<p>for apk in fingerprint[â€˜appsâ€™]: adb_device.install(apk)</p>
<h1 id="settingssssssä½ç½®">settingssssssä½ç½®</h1>
<p>adb_device.shell(fâ€settings put secure location_mode 3â€)
adb_device.shell( fâ€am startservice -a com.example.fakelocation â€ fâ€â€“es
lat {fingerprint[â€˜locationâ€™][â€˜latâ€™]} â€ fâ€â€“es lng
{fingerprint[â€˜locationâ€™][â€˜lngâ€™]}â€ )</p>
<p>def rotate_fingerprint(self, adb_device, interval_hours=24): â€œâ€œâ€
å®šæœŸè½®æ¢è®¾å¤‡æŒ‡çº¹ â€œâ€œâ€ while True: new_fp = self.get_unused_fingerprint()
self.apply_fingerprint(adb_device, new_fp)</p>
<h1 id="è®°å½•-usageå†å²">è®°å½• usageå†å²</h1>
<p>self.db.log_usage(adb_device.serial, new_fp,
timestamp=time.time())</p>
<p>time.sleep(interval_hours * 3600)</p>
<pre><code>
* æ£€æŸ¥ `/proc/self/maps` ä¸­æ˜¯å¦åŠ è½½äº† `frida-agent.so` æˆ– `XposedBridge.jar`ã€‚


* æ£€æµ‹ Frida çš„é»˜è®¤ç«¯å£ `27042`ã€‚


* é€šè¿‡ `try-catch` æ‰§è¡Œä¸€ä¸ªä¼šå›  Xposed ä¿®æ”¹è€Œæ”¹å˜è¡Œä¸ºçš„å‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚


### æœåŠ¡ç«¯äº¤å‰éªŒè¯

è¿™æ˜¯è®¾å¤‡æŒ‡ç´‹æŠ€æœ¯æœ€å¼ºå¤§çš„åœ°æ–¹ã€‚
åç«¯æœåŠ¡ä¼šå°†å®¢æˆ·ç«¯ä¸Šä¼ çš„å‡ ç™¾ä¸ªç»´åº¦çš„æŒ‡çº¹æ•°æ®è¿›è¡Œäº¤å‰æ¯”å¯¹ã€‚ä¸€ä¸ª `IMEI` æ˜¾ç¤ºæ˜¯ä¸‰æ˜Ÿè®¾å¤‡ï¼Œä½† `Build.FINGERPRINT` å´å±äºå°ç±³ï¼Œè¿™ç§çŸ›ç›¾ä¼šç«‹åˆ»å¯¼è‡´è¯¥è®¾å¤‡è¢«æ ‡è®°ä¸ºé«˜é£é™©ã€‚ä»»ä½•ä¸&quot;æ­£å¸¸è®¾å¤‡&quot;è¡Œä¸ºæ¨¡å¼ä¸ç¬¦çš„ç‰¹å¾ç»„åˆéƒ½ä¼šè¢«è¯†åˆ«å‡ºæ¥ã€‚

**äº¤å‰éªŒè¯è§„åˆ™ç¤ºä¾‹**ï¼š

```python
class FingerprintValidator:
def __init__(self):
self.device_database = self.load_device_db()
self.inconsistency_rules = self.load_rules()

def validate_fingerprint(self, fingerprint):
&quot;&quot;&quot;
Validateè®¾å¤‡æŒ‡çº¹ä¸€è‡´æ€§
&quot;&quot;&quot;
issues = []

# è§„åˆ™1ï¼šå“ç‰Œä¸å‹å·åŒ¹é…
if not self.check_brand_model_match(
fingerprint[&#39;brand&#39;],
fingerprint[&#39;model&#39;]
):
issues.append({
&#39;type&#39;: &#39;brand_model_mismatch&#39;,
&#39;severity&#39;: &#39;high&#39;,
&#39;message&#39;: f&quot;Brand {fingerprint[&#39;brand&#39;]} does not match model {fingerprint[&#39;model&#39;]}&quot;
})

# è§„åˆ™2ï¼šå±å¹•åˆ†è¾¨ç‡ä¸å‹å·åŒ¹é…
expected_resolution = self.device_database.get_resolution(fingerprint[&#39;model&#39;])
if fingerprint[&#39;screen_resolution&#39;] != expected_resolution:
issues.append({
&#39;type&#39;: &#39;resolution_mismatch&#39;,
&#39;severity&#39;: &#39;medium&#39;,
&#39;message&#39;: f&quot;Unexpected resolution for {fingerprint[&#39;model&#39;]}&quot;
})

# è§„åˆ™3ï¼šä¼ æ„Ÿå™¨ListCompleteæ€§
expected_sensors = self.device_database.get_sensors(fingerprint[&#39;model&#39;])
if len(fingerprint[&#39;sensors&#39;]) &lt; len(expected_sensors) * 0.8:
issues.append({
&#39;type&#39;: &#39;sensor_missing&#39;,
&#39;severity&#39;: &#39;high&#39;,
&#39;message&#39;: &#39;Too few sensors for this device model&#39;
})

# è§„åˆ™4ï¼šCPUå‹å·ä¸è®¾å¤‡å‹å·åŒ¹é…
expected_cpu = self.device_database.get_cpu(fingerprint[&#39;model&#39;])
if fingerprint[&#39;cpu&#39;] != expected_cpu:
issues.append({
&#39;type&#39;: &#39;cpu_mismatch&#39;,
&#39;severity&#39;: &#39;high&#39;,
&#39;message&#39;: f&quot;CPU mismatch: expected {expected_cpu}, got {fingerprint[&#39;cpu&#39;]}&quot;
})

# è§„åˆ™5ï¼šBuildTimeæˆ³åˆç†æ€§
release_date = self.device_database.get_release_date(fingerprint[&#39;model&#39;])
if fingerprint[&#39;build_time&#39;] &lt; release_date:
issues.append({
&#39;type&#39;: &#39;build_time_invalid&#39;,
&#39;severity&#39;: &#39;critical&#39;,
&#39;message&#39;: &#39;Build date earlier than device release date&#39;
})

return {
&#39;is_valid&#39;: len(issues) == 0,
&#39;risk_score&#39;: self.calculate_risk_score(issues),
&#39;issues&#39;: issues
}
</code></pre>
<p>ä½¿ç”¨æ ‡æ³¨æ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œè¯†åˆ«çœŸå®è®¾å¤‡ vs ä¼ªé€ è®¾å¤‡ï¼š</p>
<div class="sourceCode" id="cb166"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, GradientBoostingClassifier</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DeviceAuthenticityClassifier:</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="co"># é›†æˆå¤šä¸ªæ¨¡å‹</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.models <span class="op">=</span> {</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;random_forest&#39;</span>: RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">200</span>, max_depth<span class="op">=</span><span class="dv">15</span>),</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;gradient_boosting&#39;</span>: GradientBoostingClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>),</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;neural_network&#39;</span>: MLPClassifier(hidden_layers<span class="op">=</span>(<span class="dv">128</span>, <span class="dv">64</span>, <span class="dv">32</span>))</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.feature_extractor <span class="op">=</span> FeatureExtractor()</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(<span class="va">self</span>, X_train, y_train):</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a><span class="co">è®­ç»ƒåˆ†ç±»å™¨</span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a><span class="co">X_train: è®¾å¤‡æŒ‡çº¹ç‰¹å¾</span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a><span class="co">y_train: æ ‡ç­¾ (0=ä¼ªé€ , 1=Trueå®)</span></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> <span class="va">self</span>.models.items():</span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Training </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict(<span class="va">self</span>, fingerprint):</span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a><span class="co">é¢„æµ‹è®¾å¤‡çœŸå®æ€§</span></span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> <span class="va">self</span>.feature_extractor.extract(fingerprint)</span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a><span class="co"># é›†æˆæŠ•ç¥¨</span></span>
<span id="cb166-32"><a href="#cb166-32" aria-hidden="true" tabindex="-1"></a>votes <span class="op">=</span> []</span>
<span id="cb166-33"><a href="#cb166-33" aria-hidden="true" tabindex="-1"></a>probabilities <span class="op">=</span> []</span>
<span id="cb166-34"><a href="#cb166-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-35"><a href="#cb166-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> <span class="va">self</span>.models.items():</span>
<span id="cb166-36"><a href="#cb166-36" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict([features])[<span class="dv">0</span>]</span>
<span id="cb166-37"><a href="#cb166-37" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> model.predict_proba([features])[<span class="dv">0</span>]</span>
<span id="cb166-38"><a href="#cb166-38" aria-hidden="true" tabindex="-1"></a>votes.append(pred)</span>
<span id="cb166-39"><a href="#cb166-39" aria-hidden="true" tabindex="-1"></a>probabilities.append(prob[<span class="dv">1</span>]) <span class="co"># çœŸå®è®¾å¤‡æ¦‚ç‡</span></span>
<span id="cb166-40"><a href="#cb166-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-41"><a href="#cb166-41" aria-hidden="true" tabindex="-1"></a><span class="co"># åŠ æƒå¹³å‡</span></span>
<span id="cb166-42"><a href="#cb166-42" aria-hidden="true" tabindex="-1"></a>avg_probability <span class="op">=</span> np.mean(probabilities)</span>
<span id="cb166-43"><a href="#cb166-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-44"><a href="#cb166-44" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> {</span>
<span id="cb166-45"><a href="#cb166-45" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;is_genuine&#39;</span>: avg_probability <span class="op">&gt;</span> <span class="fl">0.5</span>,</span>
<span id="cb166-46"><a href="#cb166-46" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;confidence&#39;</span>: avg_probability,</span>
<span id="cb166-47"><a href="#cb166-47" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;votes&#39;</span>: <span class="bu">dict</span>(<span class="bu">zip</span>(<span class="va">self</span>.models.keys(), votes))</span>
<span id="cb166-48"><a href="#cb166-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-49"><a href="#cb166-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-50"><a href="#cb166-50" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FeatureExtractor:</span>
<span id="cb166-51"><a href="#cb166-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract(<span class="va">self</span>, fingerprint):</span>
<span id="cb166-52"><a href="#cb166-52" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-53"><a href="#cb166-53" aria-hidden="true" tabindex="-1"></a><span class="co">ä»åŸå§‹æŒ‡çº¹æå–æœºå™¨å­¦ä¹ ç‰¹å¾</span></span>
<span id="cb166-54"><a href="#cb166-54" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-55"><a href="#cb166-55" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> []</span>
<span id="cb166-56"><a href="#cb166-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-57"><a href="#cb166-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. æ•°å€¼ç‰¹å¾</span></span>
<span id="cb166-58"><a href="#cb166-58" aria-hidden="true" tabindex="-1"></a>features.extend([</span>
<span id="cb166-59"><a href="#cb166-59" aria-hidden="true" tabindex="-1"></a>fingerprint.get(<span class="st">&#39;screen_width&#39;</span>, <span class="dv">0</span>),</span>
<span id="cb166-60"><a href="#cb166-60" aria-hidden="true" tabindex="-1"></a>fingerprint.get(<span class="st">&#39;screen_height&#39;</span>, <span class="dv">0</span>),</span>
<span id="cb166-61"><a href="#cb166-61" aria-hidden="true" tabindex="-1"></a>fingerprint.get(<span class="st">&#39;dpi&#39;</span>, <span class="dv">0</span>),</span>
<span id="cb166-62"><a href="#cb166-62" aria-hidden="true" tabindex="-1"></a>fingerprint.get(<span class="st">&#39;memory_mb&#39;</span>, <span class="dv">0</span>),</span>
<span id="cb166-63"><a href="#cb166-63" aria-hidden="true" tabindex="-1"></a>fingerprint.get(<span class="st">&#39;cpu_cores&#39;</span>, <span class="dv">0</span>),</span>
<span id="cb166-64"><a href="#cb166-64" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(fingerprint.get(<span class="st">&#39;sensors&#39;</span>, [])),</span>
<span id="cb166-65"><a href="#cb166-65" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(fingerprint.get(<span class="st">&#39;installed_apps&#39;</span>, []))</span>
<span id="cb166-66"><a href="#cb166-66" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb166-67"><a href="#cb166-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-68"><a href="#cb166-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. åˆ†Classç‰¹å¾ï¼ˆç‹¬çƒ­Encodeï¼‰</span></span>
<span id="cb166-69"><a href="#cb166-69" aria-hidden="true" tabindex="-1"></a>features.extend(<span class="va">self</span>.encode_categorical(fingerprint.get(<span class="st">&#39;brand&#39;</span>, <span class="st">&#39;unknown&#39;</span>)))</span>
<span id="cb166-70"><a href="#cb166-70" aria-hidden="true" tabindex="-1"></a>features.extend(<span class="va">self</span>.encode_categorical(fingerprint.get(<span class="st">&#39;os_version&#39;</span>, <span class="st">&#39;unknown&#39;</span>)))</span>
<span id="cb166-71"><a href="#cb166-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-72"><a href="#cb166-72" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Statisticsç‰¹å¾</span></span>
<span id="cb166-73"><a href="#cb166-73" aria-hidden="true" tabindex="-1"></a>app_list <span class="op">=</span> fingerprint.get(<span class="st">&#39;installed_apps&#39;</span>, [])</span>
<span id="cb166-74"><a href="#cb166-74" aria-hidden="true" tabindex="-1"></a>features.append(<span class="va">self</span>.calculate_app_diversity(app_list))</span>
<span id="cb166-75"><a href="#cb166-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-76"><a href="#cb166-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ä¸€è‡´æ€§ç‰¹å¾</span></span>
<span id="cb166-77"><a href="#cb166-77" aria-hidden="true" tabindex="-1"></a>features.append(<span class="va">self</span>.check_brand_model_consistency(fingerprint))</span>
<span id="cb166-78"><a href="#cb166-78" aria-hidden="true" tabindex="-1"></a>features.append(<span class="va">self</span>.check_hardware_software_consistency(fingerprint))</span>
<span id="cb166-79"><a href="#cb166-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-80"><a href="#cb166-80" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> np.array(features)</span>
<span id="cb166-81"><a href="#cb166-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-82"><a href="#cb166-82" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_app_diversity(<span class="va">self</span>, app_list):</span>
<span id="cb166-83"><a href="#cb166-83" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-84"><a href="#cb166-84" aria-hidden="true" tabindex="-1"></a><span class="co">CalculateAppListå¤šæ ·æ€§</span></span>
<span id="cb166-85"><a href="#cb166-85" aria-hidden="true" tabindex="-1"></a><span class="co">ä¼ªé€ è®¾å¤‡å¯èƒ½AppListè¿‡äºSimpleOrè¿‡äºComplex</span></span>
<span id="cb166-86"><a href="#cb166-86" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb166-87"><a href="#cb166-87" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> app_list:</span>
<span id="cb166-88"><a href="#cb166-88" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb166-89"><a href="#cb166-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-90"><a href="#cb166-90" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨é¦™å†œç†µè¡¡é‡å¤šæ ·æ€§</span></span>
<span id="cb166-91"><a href="#cb166-91" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb166-92"><a href="#cb166-92" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> Counter(app.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="cf">for</span> app <span class="kw">in</span> app_list) <span class="co"># ByPackageNameBeforeç¼€</span></span>
<span id="cb166-93"><a href="#cb166-93" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(app_list)</span>
<span id="cb166-94"><a href="#cb166-94" aria-hidden="true" tabindex="-1"></a>entropy <span class="op">=</span> <span class="op">-</span><span class="bu">sum</span>((count<span class="op">/</span>total) <span class="op">*</span> np.log2(count<span class="op">/</span>total) <span class="cf">for</span> count <span class="kw">in</span> counts.values())</span>
<span id="cb166-95"><a href="#cb166-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-96"><a href="#cb166-96" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> entropy</span></code></pre></div>
<p>from sklearn.covariance import EllipticEnvelope</p>
<p>class AnomalyDetector: def <strong>init</strong>(self):
self.isolation_forest = IsolationForest(contamination=0.1,
random_state=42) self.elliptic_envelope =
EllipticEnvelope(contamination=0.1)</p>
<p>def fit(self, normal_devices): â€œâ€œâ€ ä½¿ç”¨æ­£å¸¸è®¾å¤‡æ•°æ®è®­ç»ƒ
normal_devices: å·²çŸ¥çœŸå®è®¾å¤‡ç‰¹å¾å‘é‡ â€œâ€œâ€
self.isolation_forest.fit(normal_devices)
self.elliptic_envelope.fit(normal_devices)</p>
<p>def detect_anomaly(self, device_features): â€œâ€œâ€
Detectionè®¾å¤‡IsNoException Return: (is_anomaly, anomaly_score) â€œâ€œâ€ #
Isolation Forest Detection if_score =
self.isolation_forest.score_samples([device_features])[0] if_pred =
self.isolation_forest.predict([device_features])[0] #
-1representsanomaly</p>
<h1 id="elliptic-envelope-detection">Elliptic Envelope Detection</h1>
<p>ee_pred = self.elliptic_envelope.predict([device_features])[0]</p>
<h1 id="ç»¼åˆæ£€æŸ¥">ç»¼åˆæ£€æŸ¥</h1>
<p>is_anomaly = (if_pred == -1) or (ee_pred == -1) anomaly_score =
abs(if_score) # åˆ†æ•°è¶Šä½è¶Šanomaly</p>
<p>return is_anomaly, anomaly_score</p>
<pre><code>from tensorflow.keras import layers, models

class DeepFingerprintDetector:
def __init__(self, input_dim):
self.model = self.build_model(input_dim)

def build_model(self, input_dim):
&quot;&quot;&quot;
Buildæ·±åº¦ç¥ç»Network
&quot;&quot;&quot;
model = models.Sequential([
layers.Dense(256, activation=&#39;relu&#39;, input_shape=(input_dim,)),
layers.Dropout(0.3),
layers.Dense(128, activation=&#39;relu&#39;),
layers.Dropout(0.3),
layers.Dense(64, activation=&#39;relu&#39;),
layers.Dropout(0.2),
layers.Dense(32, activation=&#39;relu&#39;),
layers.Dense(1, activation=&#39;sigmoid&#39;) # è¾“å‡º: Trueå®è®¾å¤‡æ¦‚ç‡
])

model.compile(
optimizer=&#39;adam&#39;,
loss=&#39;binary_crossentropy&#39;,
metrics=[&#39;accuracy&#39;, tf.keras.metrics.AUC()]
)

return model

def train(self, X_train, y_train, epochs=50, batch_size=32):
&quot;&quot;&quot;
è®­ç»ƒæ¨¡Type
&quot;&quot;&quot;
self.model.fit(
X_train, y_train,
epochs=epochs,
batch_size=batch_size,
validation_split=0.2
)

def predict(self, device_features):
&quot;&quot;&quot;
é¢„æµ‹è®¾å¤‡çœŸå®æ€§
&quot;&quot;&quot;
probability = self.model.predict([device_features])[0][0]

return {
&#39;is_genuine&#39;: probability &gt; 0.5,
&#39;confidence&#39;: probability
}
</code></pre>
<p>from tensorflow.keras.layers import LSTM, Dense from
tensorflow.keras.models import Sequential</p>
<p>class BehaviorSequenceDetector: def <strong>init</strong>(self,
sequence_length=100, feature_dim=20): self.sequence_length =
sequence_length self.model = self.build_lstm_model(sequence_length,
feature_dim)</p>
<p>def build_lstm_model(self, sequence_length, feature_dim): â€œâ€œâ€
BuildLSTMæ¨¡TypeAnalyzeè¡Œä¸ºåºåˆ— â€œâ€œâ€ model = Sequential([ LSTM(128,
return_sequences=True, input_shape=(sequence_length, feature_dim)),
LSTM(64, return_sequences=False), Dense(32, activation=â€˜reluâ€™), Dense(1,
activation=â€˜sigmoidâ€™)])</p>
<p>model.compile(optimizer=â€˜adamâ€™, loss=â€˜binary_crossentropyâ€™,
metrics=[â€˜accuracyâ€™]) return model</p>
<p>def detect_bot_behavior(self, action_sequence): â€œâ€œâ€
Detectionæœºå™¨äººè¡Œä¸º action_sequence: ç”¨æˆ·æ“ä½œåºåˆ— (ç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥ç­‰)
â€œâ€œâ€ # æå–ç‰¹å¾ features =
self.extract_sequence_features(action_sequence)</p>
<h1 id="é¢„æµ‹-1">é¢„æµ‹</h1>
<p>is_bot_probability = self.model.predict([features])[0][0]</p>
<p>return { â€˜is_botâ€™: is_bot_probability &gt; 0.7, â€˜confidenceâ€™:
is_bot_probability, â€˜suspicious_patternsâ€™:
self.identify_suspicious_patterns(action_sequence) }</p>
<p>def identify_suspicious_patterns(self, action_sequence): â€œâ€œâ€
è¯†åˆ«å¯ç–‘æ¨¡å¼ â€œâ€œâ€ patterns = []</p>
<h1 id="æ£€æµ‹è¿‡äºè§„å¾‹çš„æ“ä½œ">æ£€æµ‹è¿‡äºè§„å¾‹çš„æ“ä½œ</h1>
<p>if self.is_too_regular(action_sequence):
patterns.append(â€˜regular_intervalsâ€™)</p>
<h1 id="æ£€æµ‹ä¸è‡ªç„¶çš„é€Ÿåº¦">æ£€æµ‹ä¸è‡ªç„¶çš„é€Ÿåº¦</h1>
<p>if self.is_speed_abnormal(action_sequence):
patterns.append(â€˜abnormal_speedâ€™)</p>
<h1 id="æ£€æµ‹ç¼ºå°‘äººç±»ç‰¹å¾å¦‚å¾®å°æŠ–åŠ¨">æ£€æµ‹ç¼ºå°‘äººç±»ç‰¹å¾ï¼ˆå¦‚å¾®å°æŠ–åŠ¨ï¼‰</h1>
<p>if not self.has_human_jitter(action_sequence):
patterns.append(â€˜no_human_jitterâ€™)</p>
<p>return patterns</p>
<pre><code>
class DeviceGraphAnalyzer:
def __init__(self):
self.device_graph = nx.Graph()

def add_device_relationships(self, device_id, related_devices, relationship_type):
&quot;&quot;&quot;
Addè®¾å¤‡å…³ç³»åˆ°å›¾In
relationship_type: &#39;same_ip&#39;, &#39;same_wifi&#39;, &#39;same_behavior&#39;, etc.
&quot;&quot;&quot;
self.device_graph.add_node(device_id)

for related_id in related_devices:
self.device_graph.add_edge(
device_id,
related_id,
relationship=relationship_type
)

def detect_device_farm(self, threshold=10):
&quot;&quot;&quot;
æ£€æµ‹è®¾å¤‡å†œåœºï¼ˆå¤§é‡å…³è”è®¾å¤‡ï¼‰
&quot;&quot;&quot;
# å¯»æ‰¾è¿é€šåˆ†é‡
components = list(nx.connected_components(self.device_graph))

suspicious_clusters = []
for component in components:
if len(component) &gt; threshold:
# AnalyzeThisClusterç‰¹å¾
cluster_info = {
&#39;devices&#39;: list(component),
&#39;size&#39;: len(component),
&#39;density&#39;: nx.density(self.device_graph.subgraph(component)),
&#39;risk_score&#39;: self.calculate_cluster_risk(component)
}
suspicious_clusters.append(cluster_info)

return suspicious_clusters

def calculate_cluster_risk(self, device_cluster):
&quot;&quot;&quot;
è®¡ç®—è®¾å¤‡ç°‡é£é™©åˆ†æ•°
&quot;&quot;&quot;
subgraph = self.device_graph.subgraph(device_cluster)

# ç‰¹å¾1ï¼šè¿æ¥å¯†åº¦ï¼ˆå¯†åº¦è¶Šé«˜ï¼Œè¶Šå¯èƒ½æ˜¯è®¾å¤‡å†œåœºï¼‰
density = nx.density(subgraph)

# ç‰¹å¾2ï¼šå…±äº«å…³ç³»ç±»å‹
edge_types = [subgraph[u][v][&#39;relationship&#39;] for u, v in subgraph.edges()]
type_diversity = len(set(edge_types)) / len(edge_types) if edge_types else 0

# ç‰¹å¾3ï¼šç°‡å¤§å°
size_score = min(len(device_cluster) / 100, 1.0)

# ç»¼åˆè¯„åˆ†
risk_score = (density * 0.4 + (1 - type_diversity) * 0.3 + size_score * 0.3) * 100

return risk_score
</code></pre>
<p>class FeatureImportanceAnalyzer: def <strong>init</strong>(self,
model, X_train): self.model = model self.explainer =
shap.TreeExplainer(model) self.X_train = X_train</p>
<p>def analyze_feature_importance(self, feature_names): â€œâ€œâ€
Analyzeå“ªäº›ç‰¹å¾å¯¹è¯†åˆ«ä¼ªé€ è®¾å¤‡æœ€é‡è¦ â€œâ€œâ€ shap_values =
self.explainer.shap_values(self.X_train)</p>
<h1 id="ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾">ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾</h1>
<p>shap.summary_plot(shap_values, self.X_train,
feature_names=feature_names)</p>
<h1 id="è·å–ç‰¹å¾é‡è¦æ€§æ’å">è·å–ç‰¹å¾é‡è¦æ€§æ’å</h1>
<p>feature_importance = np.abs(shap_values).mean(axis=0) importance_df =
pd.DataFrame({ â€˜featureâ€™: feature_names, â€˜importanceâ€™:
feature_importance }).sort_values(â€˜importanceâ€™, ascending=False)</p>
<p>return importance_df</p>
<p>def explain_prediction(self, device_features, feature_names): â€œâ€œâ€
è§£é‡Šå•ä¸ªè®¾å¤‡é¢„æµ‹ç»“æœ â€œâ€œâ€ shap_values =
self.explainer.shap_values(device_features)</p>
<h1 id="å¯è§†åŒ–">å¯è§†åŒ–</h1>
<p>shap.force_plot( self.explainer.expected_value, shap_values,
device_features, feature_names=feature_names )</p>
<h1 id="returncontributionæœ€å¤§ç‰¹å¾">ReturnContributionæœ€å¤§ç‰¹å¾</h1>
<p>contributions = dict(zip(feature_names, shap_values.flatten()))
top_contributors = sorted( contributions.items(), key=lambda x:
abs(x[1]), reverse=True )[:10]</p>
<p>return top_contributors</p>
<pre><code>æŸå¤§å‹ç”µå•†å¹³å°é¢ä¸´å¤§é‡åˆ·å•ã€è™šå‡è¯„è®ºå’Œè–…ç¾Šæ¯›è¡Œä¸ºï¼Œéœ€è¦é€šè¿‡è®¾å¤‡æŒ‡çº¹è¯†åˆ«æ¶æ„ç”¨æˆ·ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

**1. æŒ‡çº¹é‡‡é›†**

```java
public class EcommerceFingerprintCollector {
public DeviceFingerprint collect(Context context) {
DeviceFingerprint fp = new DeviceFingerprint();

// Basicç¡¬ä»¶Info
fp.setAndroidId(getAndroidId(context));
fp.setModel(Build.MODEL);
fp.setBrand(Build.BRAND);

// NetworkInfo
fp.setIpAddress(getIPAddress());
fp.setMacAddress(getMacAddress(context));

// AppInfo
fp.setInstalledApps(getInstalledApps(context));

// è¡Œä¸ºç‰¹å¾
fp.setTouchPressure(collectTouchPressure());
fp.setTypingSpeed(collectTypingSpeed());

// ç¯å¢ƒDetection
fp.setIsRooted(checkRootStatus());
fp.setIsEmulator(checkEmulatorStatus());
fp.setIsHooked(checkHookStatus());

return fp;
}

private boolean checkHookStatus() {
// DetectionFrida
if (checkFridaPort()) return true;
if (checkFridaLibraries()) return true;

// DetectionXposed
if (checkXposedEnvironment()) return true;

return false;
}
}
</code></pre>
<p>self.fingerprint_db = FingerprintDatabase() self.ml_detector =
DeviceAuthenticityClassifier() self.behavior_analyzer =
BehaviorSequenceDetector()</p>
<p>def check_order_risk(self, user_id, device_fp, order_info): â€œâ€œâ€
è®¢å•é£é™©è¯„ä¼° â€œâ€œâ€ risk_factors = [] risk_score = 0</p>
<h1 id="è®¾å¤‡æŒ‡çº¹check">1. è®¾å¤‡æŒ‡çº¹Check</h1>
<p>device_risk = self.check_device_fingerprint(device_fp) if
device_risk[â€˜is_suspiciousâ€™]: risk_factors.append(device_risk)
risk_score += 30</p>
<h1 id="è®¾å¤‡associationanalyze">2. è®¾å¤‡AssociationAnalyze</h1>
<p>related_devices = self.fingerprint_db.find_related_devices(device_fp)
if len(related_devices) &gt; 10: risk_factors.append({ â€˜typeâ€™:
â€˜device_clusterâ€™, â€˜messageâ€™: fâ€™Device associated with
{len(related_devices)} other devicesâ€™ }) risk_score += 25</p>
<h1 id="ç”¨æˆ·è¡Œä¸ºanalyze">3. ç”¨æˆ·è¡Œä¸ºAnalyze</h1>
<p>user_behavior = self.fingerprint_db.get_user_behavior(user_id) if
self.is_bot_behavior(user_behavior): risk_factors.append({â€˜typeâ€™:
â€˜bot_behaviorâ€™}) risk_score += 35</p>
<h1 id="è®¢å•ç‰¹å¾analyze">4. è®¢å•ç‰¹å¾Analyze</h1>
<p>if order_info[â€˜amountâ€™] &gt; 10000 and order_info[â€˜create_timeâ€™] -
user_id.register_time &lt; 3600: risk_factors.append({â€˜typeâ€™:
â€˜new_user_large_orderâ€™}) risk_score += 20</p>
<h1 id="å†³ç­–">å†³ç­–</h1>
<p>if risk_score &gt;= 60: action = â€˜rejectâ€™ elif risk_score &gt;= 40:
action = â€˜manual_reviewâ€™ else: action = â€˜approveâ€™</p>
<p>return { â€˜actionâ€™: action, â€˜risk_scoreâ€™: risk_score, â€˜risk_factorsâ€™:
risk_factors }</p>
<p>def check_device_fingerprint(self, fp): â€œâ€œâ€ è®¾å¤‡æŒ‡çº¹å®Œæ•´æ€§æ£€æŸ¥ â€œâ€œâ€
issues = []</p>
<h1 id="æ£€æµ‹æ¨¡æ‹Ÿå™¨">æ£€æµ‹æ¨¡æ‹Ÿå™¨</h1>
<p>if fp.get(â€˜is_emulatorâ€™): issues.append(â€˜emulator_detectedâ€™)</p>
<h1 id="æ£€æµ‹-hook-æ¡†æ¶">æ£€æµ‹ Hook æ¡†æ¶</h1>
<p>if fp.get(â€˜is_hookedâ€™): issues.append(â€˜hook_framework_detectedâ€™)</p>
<h1 id="æ£€æµ‹è®¾å¤‡å‚æ•°ä¸€è‡´æ€§">æ£€æµ‹è®¾å¤‡å‚æ•°ä¸€è‡´æ€§</h1>
<p>validator = FingerprintValidator() validation =
validator.validate_fingerprint(fp) if not validation[â€˜is_validâ€™]:
issues.extend([issue[â€˜typeâ€™] for issue in validation[â€˜issuesâ€™]])</p>
<h1 id="æœºå™¨å­¦ä¹ æ£€æµ‹">æœºå™¨å­¦ä¹ æ£€æµ‹</h1>
<p>ml_result = self.ml_detector.predict(fp) if not
ml_result[â€˜is_genuineâ€™]: issues.append(â€˜ml_fake_device_detectedâ€™)</p>
<p>return { â€˜is_suspiciousâ€™: len(issues) &gt; 0, â€˜issuesâ€™: issues,
â€˜risk_levelâ€™: â€˜highâ€™ if len(issues) &gt;= 3 else â€˜mediumâ€™ if len(issues)
&gt; 0 else â€˜lowâ€™ }</p>
<pre><code>- Frida Hookè®¾å¤‡ä¿¡æ¯API
- éšæœºåŒ–åº”ç”¨åˆ—è¡¨


* *æ£€æµ‹å¯¹æŠ—**ï¼š

```python
def advanced_detection(device_fp, user_behavior):
&quot;&quot;&quot;
AdvancedDetectionæŠ€æœ¯
&quot;&quot;&quot;
# Detection1ï¼šäº‘æ‰‹æœºç‰¹å¾
if is_cloud_phone(device_fp):
return {&#39;blocked&#39;: True, &#39;reason&#39;: &#39;cloud_phone_detected&#39;}

# Detection2ï¼šä»£ç†/æœºæˆ¿IP
ip_info = get_ip_info(device_fp[&#39;ip_address&#39;])
if ip_info[&#39;isp&#39;] in [&#39;Alibaba Cloud&#39;, &#39;Tencent Cloud&#39;, &#39;AWS&#39;]:
if not is_corporate_user(user_id):
return {&#39;blocked&#39;: True, &#39;reason&#39;: &#39;datacenter_ip&#39;}

# æ£€æµ‹3ï¼šè®¾å¤‡å‚æ•°è¿‡äºå®Œç¾
if all_parameters_perfectly_match(device_fp):
return {&#39;blocked&#39;: True, &#39;reason&#39;: &#39;too_perfect_fingerprint&#39;}

# Detection4ï¼šè¡Œä¸ºæ¨¡å¼æœºå™¨åŒ–
if behavior_too_regular(user_behavior):
return {&#39;blocked&#39;: True, &#39;reason&#39;: &#39;bot_behavior&#39;}

return {&#39;blocked&#39;: False}
</code></pre>
<h3 id="æ¡ˆä¾‹2é‡‘èappé£æ§ç»•è¿‡">æ¡ˆä¾‹2ï¼šé‡‘èAppé£æ§ç»•è¿‡</h3>
<ul>
<li><p>*èƒŒæ™¯**ï¼š
æŸé‡‘èAppä½¿ç”¨é¡¶è±¡è®¾å¤‡æŒ‡çº¹è¿›è¡Œé£æ§ï¼Œæ”»å‡»è€…å°è¯•ç»•è¿‡è¿›è¡Œæ‰¹é‡æ³¨å†Œå’Œè–…ç¾Šæ¯›ã€‚</p></li>
<li><p>*Appä¿æŠ¤æªæ–½**ï¼š</p></li>
</ul>
<ol type="1">
<li>é›†æˆé¡¶è±¡SDKé‡‡é›†è®¾å¤‡æŒ‡çº¹</li>
<li>SOå±‚åŠ å›ºï¼ˆ360åŠ å›ºï¼‰</li>
<li>æ£€æµ‹Rootã€æ¨¡æ‹Ÿå™¨ã€Hookæ¡†æ¶</li>
<li>ç½‘ç»œè¯·æ±‚ç­¾åéªŒè¯</li>
</ol>
<ul>
<li><p>*åˆ†æè¿‡ç¨‹**ï¼š</p></li>
<li><p>*Step 1: è®¾å¤‡æŒ‡çº¹SDKå®šä½**</p></li>
</ul>
<div class="sourceCode" id="cb171"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># åç¼–è¯‘ APK</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> d app.apk</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æœç´¢è®¾å¤‡æŒ‡çº¹ç›¸å…³ä»£ç </span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;getDeviceId&quot;</span> .</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;fingerprint&quot;</span> .</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a><span class="co"># æ‰¾åˆ° SDK åŒ…å</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="co"># com.dingxiang.sdk.fingerprint</span></span></code></pre></div>
<p>// Hooké¡¶è±¡SDK var DXFingerprint =
Java.use(â€œcom.dingxiang.sdk.fingerprint.DXFingerprintâ€);</p>
<p>DXFingerprint.getDeviceId.implementation = function() {
console.log(â€œ[*] getDeviceId() calledâ€);</p>
<p>// Returnä¼ªé€ è®¾å¤‡ID var fakeDeviceId = â€œfake_dx_device_id_â€ +
Math.random().toString(36).substring(7); console.log(â€œ[*] Returning fake
device ID:â€ + fakeDeviceId);</p>
<p>return fakeDeviceId; };</p>
<p>// Hooké‡‡é›†Method DXFingerprint.collect.implementation =
function(context) { console.log(â€œ[*] collect() calledâ€);</p>
<p>// Modifyé‡‡é›†Data var result = this.collect(context);</p>
<p>// ç¯¡æ”¹æŒ‡çº¹Data modifyFingerprintData(result);</p>
<p>return result; }; });</p>
<pre><code>
```python
CompleteBypassFlow
&quot;&quot;&quot;
# 1. å‡†å¤‡ç¯å¢ƒ
device = setup_rooted_device()

# 2. InstallMagiskéšè—Root
install_magisk_modules([
&#39;MagiskHide&#39;,
&#39;Universal SafetyNet Fix&#39;,
&#39;Device Faker&#39;
])

# 3. ä¿®æ”¹è®¾å¤‡æŒ‡çº¹
fake_fingerprint = generate_realistic_fingerprint()
apply_fingerprint(device, fake_fingerprint)

# 4. éšè— Frida
use_frida_server_rename()
use_frida_gadget_injection()

# 5. å¯åŠ¨ Frida è„šæœ¬
frida_script = load_script(&#39;dingxiang_bypass.js&#39;)
attach_to_app(device, &#39;com.financial.app&#39;, frida_script)

# 6. ä»£ç†è®¾ç½®ï¼ˆç»•è¿‡ IP é£æ§ï¼‰
setup_proxy(device, get_random_proxy())

# 7. æ¨¡æ‹ŸçœŸå®è¡Œä¸º
simulate_human_behavior(device, duration=300) # 5 åˆ†é’Ÿ

# 8. æ‰§è¡Œç›®æ ‡æ“ä½œ
register_account(device)
</code></pre>
<div class="sourceCode" id="cb173"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. æ‹¦æˆª Native å±‚è®¾å¤‡æŒ‡çº¹é‡‡é›†</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> libc <span class="op">=</span> Process<span class="op">.</span><span class="fu">getModuleByName</span>(<span class="st">&quot;libc.so&quot;</span>)<span class="op">;</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Hookç³»ç»ŸCallï¼ˆSVCæŒ‡ä»¤ï¼‰</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libc.so&quot;</span><span class="op">,</span> <span class="st">&quot;syscall&quot;</span>)<span class="op">,</span> {</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span>(args) {</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> syscall_num <span class="op">=</span> args[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toInt32</span>()<span class="op">;</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="co">// InterceptSpecificç³»ç»ŸCall</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (syscall_num <span class="op">==</span> <span class="dv">3</span>) { <span class="co">// read</span></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a><span class="co">// ModifyReadå†…å®¹</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (syscall_num <span class="op">==</span> <span class="dv">5</span>) { <span class="co">// open</span></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> path <span class="op">=</span> Memory<span class="op">.</span><span class="fu">readUtf8String</span>(args[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Opening file: &quot;</span> <span class="op">+</span> path)<span class="op">;</span></span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Interceptæ•æ„ŸFileRead</span></span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (path<span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;/proc/cpuinfo&quot;</span>)) {</span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Returnä¼ªé€ cpuinfo</span></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. HookåŠ å›ºAfterSO</span></span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> libjiagu <span class="op">=</span> Process<span class="op">.</span><span class="fu">getModuleByName</span>(<span class="st">&quot;libjiagu.so&quot;</span>)<span class="op">;</span></span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-28"><a href="#cb173-28" aria-hidden="true" tabindex="-1"></a><span class="co">// å¯»æ‰¾å…³KeyFunction</span></span>
<span id="cb173-29"><a href="#cb173-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> init_array <span class="op">=</span> libjiagu<span class="op">.</span><span class="fu">enumerateSymbols</span>()<span class="op">;</span></span>
<span id="cb173-30"><a href="#cb173-30" aria-hidden="true" tabindex="-1"></a>init_array<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(symbol) {</span>
<span id="cb173-31"><a href="#cb173-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (symbol<span class="op">.</span><span class="at">name</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;fingerprint&quot;</span>)) {</span>
<span id="cb173-32"><a href="#cb173-32" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Found fingerprint function: &quot;</span> <span class="op">+</span> symbol<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb173-33"><a href="#cb173-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-34"><a href="#cb173-34" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(symbol<span class="op">.</span><span class="at">address</span><span class="op">,</span> {</span>
<span id="cb173-35"><a href="#cb173-35" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span>(args) {</span>
<span id="cb173-36"><a href="#cb173-36" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Called: &quot;</span> <span class="op">+</span> symbol<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb173-37"><a href="#cb173-37" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb173-38"><a href="#cb173-38" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span>(retval) {</span>
<span id="cb173-39"><a href="#cb173-39" aria-hidden="true" tabindex="-1"></a><span class="co">// ä¿®æ”¹è¿”å›å€¼</span></span>
<span id="cb173-40"><a href="#cb173-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-41"><a href="#cb173-41" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb173-42"><a href="#cb173-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-43"><a href="#cb173-43" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb173-44"><a href="#cb173-44" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>æ¯ä¸ªå®ä¾‹é…ç½®ç‹¬ç«‹ä»£ç†</p></li>
<li><p>å®ç°å®Œæ•´çš„è®¾å¤‡æŒ‡çº¹æ¨¡æ‹Ÿ</p></li>
<li><p>æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºæ¨¡å¼</p></li>
<li><p>æˆæœ¬ï¼šçº¦2å…ƒ/è´¦å·</p></li>
<li><p>*æ•™è®­**ï¼š</p></li>
</ul>
<ol type="1">
<li><strong>å•çº¯çš„Hookä¸å¤Ÿ</strong>ï¼šéœ€è¦å®Œæ•´çš„ç¯å¢ƒä¼ªè£…</li>
<li><strong>è®¾å¤‡ä¸€è‡´æ€§è‡³å…³é‡è¦</strong>ï¼šæ‰€æœ‰å‚æ•°å¿…é¡»é€»è¾‘è‡ªæ´½</li>
<li><strong>è¡Œä¸ºæ¨¡æ‹Ÿå¿…ä¸å¯å°‘</strong>ï¼šçº¯æŠ€æœ¯ç»•è¿‡å®¹æ˜“è¢«è¡Œä¸ºåˆ†æè¯†ç ´</li>
<li><strong>æˆæœ¬ä¸æ”¶ç›Šå¹³è¡¡</strong>ï¼šé«˜è´¨é‡ç»•è¿‡éœ€è¦è¾ƒé«˜æˆæœ¬</li>
</ol>
<p>å› æ­¤ï¼ŒæˆåŠŸçš„ç»•è¿‡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€åœºå…³äºâ€ä¼ªé€ ä¸€ä¸ªå¤©è¡£æ— ç¼çš„è®¾å¤‡ç”»åƒâ€çš„æŒä¹…æˆ˜ã€‚</p>
<!-- 01-Recipes/Anti-Detection/frida_anti_debugging.md -->
<h1 id="recipe-ç»•è¿‡-app-å¯¹-frida-çš„æ£€æµ‹">Recipe: ç»•è¿‡ App å¯¹ Frida
çš„æ£€æµ‹</h1>
<h2 id="é—®é¢˜åœºæ™¯-3">é—®é¢˜åœºæ™¯</h2>
<p>*ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ*</p>
<ul>
<li>âŒ è¿è¡Œ Frida å App ç«‹å³å´©æºƒæˆ–é—ªé€€</li>
<li>âŒ App æ˜¾ç¤ºâ€æ£€æµ‹åˆ°è°ƒè¯•å·¥å…·â€å¹¶æ‹’ç»è¿è¡Œ</li>
<li>âŒ Hook è„šæœ¬åŠ è½½å App æ— å“åº”æˆ–è¿›å…¥å®‰å…¨æ¨¡å¼</li>
<li>âŒ æŸäº›åŠŸèƒ½åœ¨ Frida ç¯å¢ƒä¸‹è¢«ç¦ç”¨</li>
<li>âŒ App é¢‘ç¹å¼¹çª—æç¤ºâ€è¿è¡Œç¯å¢ƒå¼‚å¸¸â€</li>
</ul>
<p>*æœ¬é…æ–¹æ•™ä½ *ï¼šè¯†åˆ« Frida æ£€æµ‹æŠ€æœ¯ã€ä½¿ç”¨ Hook ç»•è¿‡æ£€æµ‹ã€å®šåˆ¶ Frida
é¿å…ç‰¹å¾ã€‚</p>
<p>*æ ¸å¿ƒç†å¿µ*ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>ç”¨ Frida å¯¹æŠ—æ£€æµ‹ Frida</strong> - ä»¥å­ä¹‹çŸ›æ”»å­ä¹‹ç›¾</p>
<ul>
<li>åœ¨ App æ£€æµ‹ä¹‹å‰å°± Hook æ£€æµ‹å‡½æ•°</li>
<li>ä¿®æ”¹æ£€æµ‹ç»“æœè®©å®ƒâ€çœ‹ä¸è§â€ Frida</li>
<li>æˆ–å¹²è„†éšè— Frida çš„æ‰€æœ‰ç‰¹å¾</li>
</ul>
</blockquote>
<p>*é¢„è®¡ç”¨æ—¶*: 15-45 åˆ†é’Ÿï¼ˆå–å†³äºæ£€æµ‹å¤æ‚åº¦ï¼‰ ___ ## å·¥å…·æ¸…å•</p>
<h2 id="å¿…éœ€å·¥å…·-3"># å¿…éœ€å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>Frida</strong> - åŠ¨æ€æ’æ¡©æ¡†æ¶</li>
</ul></li>
<li><ul>
<li><strong>Android è®¾å¤‡</strong>ï¼ˆå·² Rootï¼‰</li>
</ul></li>
<li><ul>
<li><strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong> - ç¼–å†™ç»•è¿‡è„šæœ¬</li>
</ul></li>
</ul>
<h2 id="å¯é€‰å·¥å…·-3"># å¯é€‰å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>jadx-gui</strong> - é™æ€åˆ†ææ£€æµ‹ä»£ç </li>
</ul></li>
<li><ul>
<li><strong>IDA Pro / Ghidra</strong> - Native å±‚æ£€æµ‹åˆ†æ</li>
</ul></li>
<li><ul>
<li><strong>å®šåˆ¶ç‰ˆ Frida</strong> - ç»ˆæè§£å†³æ–¹æ¡ˆ ___ ## å‰ç½®æ¡ä»¶</li>
</ul></li>
</ul>
<h2 id="ç¡®è®¤æ¸…å•-2"># âœ… ç¡®è®¤æ¸…å•</h2>
<div class="sourceCode" id="cb174"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Frida æ­£å¸¸Run</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. èƒ½æ­£å¸¸ attachï¼ˆNoDetectionWhenï¼‰</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. æ ¹ æƒé™å¯ç”¨</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell su</span></code></pre></div>
<hr />
<h2 id="è§£å†³æ–¹æ¡ˆ-1">è§£å†³æ–¹æ¡ˆ</h2>
<h2 id="ç¬¬-1-æ­¥è¯†åˆ«æ£€æµ‹ç±»å‹5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ«æ£€æµ‹ç±»å‹ï¼ˆ5
åˆ†é’Ÿï¼‰</h2>
<h3 id="è§¦å‘æ£€æµ‹"># 1.1 è§¦å‘æ£€æµ‹</h3>
<p>*è¿è¡Œ Frida å¹¶è§‚å¯Ÿç°è±¡*ï¼š</p>
<div class="sourceCode" id="cb175"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use spawn æ¨¡å¼startup App</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">--no-pause</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="co"># è§‚å¯Ÿè¾“å‡ºå’Œ App è¡Œä¸º</span></span></code></pre></div>
<div class="line-block">å¼¹çª—â€æ£€æµ‹åˆ° Root/è°ƒè¯•â€ | æ¨¡å—åæ£€æµ‹ã€çº¿ç¨‹åæ£€æµ‹
| |<br />
ç‰¹å®šåŠŸèƒ½è¢«ç¦ç”¨ | Inline Hook æ£€æµ‹ | |<br />
éšæœºå´©æºƒ/å¡é¡¿ | å¤šé‡æ£€æµ‹ç»„åˆ | |</div>
<h3 id="é™æ€åˆ†ææ£€æµ‹ä»£ç å¯é€‰"># 1.2 é™æ€åˆ†ææ£€æµ‹ä»£ç ï¼ˆå¯é€‰ï¼‰</h3>
<p>*ç”¨ jadx æœç´¢å…³é”®è¯*ï¼š</p>
<pre><code>gum-js
27042

# æ£€æµ‹ç›¸å…³
/proc/self/maps
/proc/*/cmdline
pthread_create
connect
socket
</code></pre>
<div class="sourceCode" id="cb177"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">boolean</span> <span class="fu">isFridaDetected</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="co">// CheckPort</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span><span class="fu">checkPort</span><span class="op">(</span><span class="dv">27042</span><span class="op">))</span> <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co">// CheckProcess</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span><span class="fu">findProcess</span><span class="op">(</span><span class="st">&quot;frida-server&quot;</span><span class="op">))</span> <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="co">// CheckModule</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span><span class="fu">checkMaps</span><span class="op">(</span><span class="st">&quot;frida-agent&quot;</span><span class="op">))</span> <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>*é‡å‘½å frida-server*ï¼š</p>
<div class="sourceCode" id="cb178"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download frida-server</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="co"># é‡å‘½åä¸ºæ— å®³åå­—</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> frida-server-16.1.4-android-arm64 system_daemon</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="co"># push to device</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> push system_daemon /data/local/tmp/</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;chmod 755 /data/local/tmp/system_daemon&quot;</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="co"># UseNotæ ‡å‡†Portstartup</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;/data/local/tmp/system_daemon -l 0.0.0.0:8888 &amp;&quot;</span></span></code></pre></div>
<p>frida -U -f com.example.app -l bypass.js â€“no-pause</p>
<h1 id="ä¸æ¨èattach-æ¨¡å¼æ£€æµ‹ä»£ç å¯èƒ½å·²è¿è¡Œ">âŒ ä¸æ¨èï¼šAttach
æ¨¡å¼ï¼ˆæ£€æµ‹ä»£ç å¯èƒ½å·²è¿è¡Œï¼‰</h1>
<p>frida -U com.example.app -l bypass.js</p>
<pre><code>
```javascript
Java.perform(function () {
console.log(&quot;\nğŸ›¡ï¸ [Frida Anti-Detection] å·²å¯åŠ¨\n&quot;);

// =====================================
// 1. ç»•è¿‡ç«¯å£æ‰«ææ£€æµ‹
// =====================================
var connect = Module.findExportByName(&quot;libc.so&quot;, &quot;connect&quot;);
if (connect) {
Interceptor.attach(connect, {
onEnter: function (args) {
var sockaddr = ptr(args[1]);
var family = sockaddr.readU16();

if (family === 2) {
// AF_INET
var port = (sockaddr.add(2).readU8() &lt;&lt; 8) | sockaddr.add(3).readU8();
var ip = sockaddr.add(4).readU32();

// æ£€æµ‹æ˜¯å¦åœ¨æ‰«æ Frida é»˜è®¤ç«¯å£
if (port === 27042 || port === 27043) {
console.log(&quot;âœ“ [Port] æ‹¦æˆªç«¯å£æ‰«æ: &quot; + port);
// ä¿®æ”¹ç«¯å£ä¸ºæ— æ•ˆç«¯å£
sockaddr.add(2).writeU8(0xff);
sockaddr.add(3).writeU8(0xff);
}
}
},
});
console.log(&quot;âœ“ [Port] Hook connect() å®Œæˆ&quot;);
}

// =====================================
// 2. Bypass /proc/self/maps Detection
// =====================================
var fopen = Module.findExportByName(&quot;libc.so&quot;, &quot;fopen&quot;);
var fgets = Module.findExportByName(&quot;libc.so&quot;, &quot;fgets&quot;);

if (fgets) {
Interceptor.attach(fgets, {
onEnter: function (args) {
this.buffer = args[0];
this.fp = args[2];
},
onLeave: function (retval) {
if (retval.isNull()) return;

var line = this.buffer.readCString();
if (line) {
// éšè— Frida ç›¸å…³Module
if (
line.includes(&quot;frida&quot;) ||
line.includes(&quot;gum-js&quot;) ||
line.includes(&quot;frida-agent&quot;)
) {
console.log(
&quot;âœ“ [Maps] éšè—Module: &quot; + line.substring(0, 50) + &quot;...&quot;
);
// æ›¿æ¢ä¸ºFalseè¡Œ
this.buffer.writeUtf8String(&quot;\n&quot;);
}
}
},
});
console.log(&quot;âœ“ [Maps] Hook fgets() å®Œæˆ&quot;);
}

// =====================================
// 3. Bypass strstr StringDetection
// =====================================
var strstr = Module.findExportByName(&quot;libc.so&quot;, &quot;strstr&quot;);
if (strstr) {
Interceptor.attach(strstr, {
onEnter: function (args) {
this.haystack = args[0].readCString();
this.needle = args[1].readCString();

if (
this.needle &amp;&amp;
(this.needle.includes(&quot;frida&quot;) ||
this.needle.includes(&quot;gum-js&quot;) ||
this.needle === &quot;frida-agent&quot; ||
this.needle === &quot;frida-server&quot;)
) {
this.shouldBypass = true;
}
},
onLeave: function (retval) {
if (this.shouldBypass) {
console.log(&quot;âœ“ [Strstr] éšè—String: &quot; + this.needle);
retval.replace(ptr(0)); // è¿”å› ç©ºï¼ˆæœªæ‰¾åˆ°ï¼‰
}
},
});
console.log(&quot;âœ“ [Strstr] Hook strstr() å®Œæˆ&quot;);
}

// =====================================
// 4. Bypass Java LayerDetectionFunction
// =====================================
setTimeout(function () {
// Searchå¸¸è§DetectionFunctionName
var detectNames = [
&quot;isFridaDetected&quot;,
&quot;checkFrida&quot;,
&quot;detectDebugger&quot;,
&quot;isHooked&quot;,
&quot;checkRoot&quot;,
];

Java.enumerateLoadedClasses({
onMatch: function (className) {
try {
var clazz = Java.use(className);
detectNames.forEach(function (methodName) {
if (clazz[methodName]) {
console.log(
&quot;âœ“ [Java] æ‰¾åˆ°DetectionFunction: &quot; +
className +
&quot;.&quot; +
methodName
);
clazz[methodName].implementation = function () {
console.log(
&quot;âœ“ [Java] InterceptCall: &quot; + className + &quot;.&quot; + methodName
);
return false; // è¿”å›&quot;æœªæ£€æµ‹åˆ°&quot;
};
}
});
} catch (e) {}
},
onComplete: function () {
console.log(&quot;âœ“ [Java] ClassEnumerateå®Œæˆ&quot;);
},
});
}, 500);

// =====================================
// 5. BypassThreadNameDetection
// =====================================
var pthread_setname_np = Module.findExportByName(
&quot;libc.so&quot;,
&quot;pthread_setname_np&quot;
);
if (pthread_setname_np) {
Interceptor.attach(pthread_setname_np, {
onEnter: function (args) {
var threadName = args[1].readCString();
if (
threadName &amp;&amp;
(threadName.includes(&quot;gum-js&quot;) ||
threadName.includes(&quot;gmain&quot;) ||
threadName.includes(&quot;pool-&quot;))
) {
console.log(
&quot;âœ“ [Thread] ModifyThreadName: &quot; + threadName + &quot; â†’ normal&quot;
);
args[1].writeUtf8String(&quot;normal&quot;);
}
},
});
console.log(&quot;âœ“ [Thread] Hook pthread_setname_np() å®Œæˆ&quot;);
}

console.log(&quot;\nğŸ›¡ï¸ [Frida Anti-Detection] æ‰€æœ‰ Hook å·²å°±ç»ª\n&quot;);
});
</code></pre>
<p>âœ“ [Maps] Hook fgets() å®Œæˆ âœ“ [Strstr] Hook strstr() å®Œæˆ âœ“ [Thread]
Hook pthread_setname_np() å®Œæˆ âœ“ [Java] ç±»æšä¸¾å®Œæˆ âœ“ [Java]
æ‰¾åˆ°æ£€æµ‹å‡½æ•°: com.example.SecurityCheck.isFridaDetected</p>
<p>ğŸ›¡ï¸ [Frida Anti-Detection] æ‰€æœ‰ Hook å·²å°±ç»ª</p>
<p>âœ“ [Port] æ‹¦æˆªç«¯å£æ‰«æ: 27042 âœ“ [Strstr] éšè—å­—ç¬¦ä¸²: frida-agent âœ“
[Java] æ‹¦æˆªè°ƒç”¨: com.example.SecurityCheck.isFridaDetected</p>
<pre><code>
\*å¦‚æœä½ æ‰¾åˆ°äº†æ£€æµ‹å‡½æ•°\*ï¼ˆä»ç¬¬ 1 æ­¥ï¼‰ï¼š

```javascript
Java.perform(function () {
var SecurityCheck = Java.use(&quot;com.example.app.SecurityCheck&quot;);

// Hook DetectionFunction
SecurityCheck.isFridaDetected.implementation = function () {
console.log(&quot;âœ“ Bypass isFridaDetected()&quot;);
return false; // å§‹ç»ˆReturn&quot;æœªæ£€æµ‹åˆ°&quot;
};

// æ‹¦æˆª å…¶ä»–Detectionç›¸å…³Function
SecurityCheck.checkPort.implementation = function (port) {
console.log(&quot;âœ“ Bypass checkPort(&quot; + port + &quot;)&quot;);
return false;
};
});
</code></pre>
<p>// RestoreFunctionoriginal å­—èŠ‚ï¼ˆAdvancedï¼‰ var targetFunc =
Module.findExportByName(â€œlibc.soâ€, â€œstrcmpâ€); if (targetFunc) { //
ReadoriginalBytecodeï¼ˆä»ç£ç›˜ä¸Š libc.soï¼‰ var libcPath =
â€œ/system/lib64/libc.soâ€; var libcFile = new File(libcPath, â€œrbâ€); // â€¦
ComplexRestoreLogic â€¦ }</p>
<pre><code>
### 5.1 ä¿®æ”¹æºç 

* *å…‹éš† Frida**ï¼š

```bash
git clone --recurse-submodules https://github.com/frida/frida.git
cd frida
</code></pre>
<h1 id="æ›¿æ¢æ¨¡å—å">æ›¿æ¢æ¨¡å—å</h1>
<p>find . -type f -exec sed -i â€˜s/frida-agent/system-agent/gâ€™ {} + find
. -type f -exec sed -i â€˜s/frida-server/system-daemon/gâ€™ {} +</p>
<h1 id="æ›¿æ¢çº¿ç¨‹å">æ›¿æ¢çº¿ç¨‹å</h1>
<p>find . -type f -exec sed -i â€˜s/gum-js-loop/normal-thread/gâ€™ {} + find
. -type f -exec sed -i â€˜s/gmain/worker/gâ€™ {} +</p>
<pre><code>
# Compile
make
</code></pre>
<pre><code>â”‚ â”œâ”€â”€ ProcessName: frida-server
â”‚ â””â”€â”€ Commandè¡ŒParameterContains &quot;frida&quot;
â”œâ”€â”€ 3. MemoryLayer
â”‚ â”œâ”€â”€ ModuleName: frida-agent.so, frida-gadget.so
â”‚ â”œâ”€â”€ ThreadName: gum-js-loop, gmain, pool-*
â”‚ â””â”€â”€ Function Hook: Modifyç³»ç»ŸFunctionBytecode
â””â”€â”€ 4. è¡Œä¸ºLayer
â””â”€â”€ D-Bus æ¶ˆæ¯ã€Exceptionç³»ç»ŸCallåºåˆ—
</code></pre>
<div class="line-block">è¿›ç¨‹åæ£€æµ‹ | é‡å‘½å frida-server | |<br />
/proc/self/maps | Hook <code>fgets()</code> è¿‡æ»¤è¾“å‡º | |<br />
å­—ç¬¦ä¸²æ£€æµ‹ | Hook <code>strstr()</code> è¿”å› NULL | |<br />
çº¿ç¨‹åæ£€æµ‹ | Hook <code>pthread_setname_np()</code> | |<br />
Inline Hook æ£€æµ‹ | Hook æ£€æµ‹å‡½æ•°æœ¬èº« | |<br />
å¤šé‡ç»„åˆæ£€æµ‹ | å®šåˆ¶ Frida æºç  | |</div>
<h2 id="hook-æ—¶æœºå¾ˆé‡è¦"># Hook æ—¶æœºå¾ˆé‡è¦</h2>
<pre><code>â†“
[0.5s] App é™æ€åˆå§‹åŒ–ä»£ç è¿è¡Œ
â†“
[1s] App onCreate() å¼€å§‹
â†“
[1.5s] âš ï¸ åè°ƒè¯•æ£€æµ‹é€šå¸¸åœ¨æ­¤è¿è¡Œ
â†“
[2s] âŒ Attach æ¨¡å¼ï¼šFrida åœ¨æ­¤æ—¶æ‰æ³¨å…¥ï¼ˆå¤ªæ™šï¼‰
</code></pre>
<p>*ç—‡çŠ¶*ï¼šHook è„šæœ¬è¿è¡Œäº†ï¼Œä½† App ä»ç„¶æ£€æµ‹åˆ° Frida</p>
<p>*å¯èƒ½åŸå› *ï¼š</p>
<ol type="1">
<li><strong>Hook æ—¶æœºå¤ªæ™š</strong></li>
</ol>
<div class="sourceCode" id="cb185"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… æ­£ç¡®ï¼š--no-pause ç«‹å³è¿è¡Œ</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-l</span> bypass.js <span class="at">--no-pause</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="co"># âŒ é”™è¯¯ï¼šä¼šæš‚åœç­‰å¾…æ‰‹åŠ¨æ¢å¤</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-l</span> bypass.js</span></code></pre></div>
<p>â†’ ä½¿ç”¨ <code>frida-gadget</code> è€Œé
<code>frida-server</code>ï¼ˆæ›´æ—©æ³¨å…¥ï¼‰</p>
<p>â†’ ä½¿ç”¨ <code>frida-gadget</code> è€Œé
<code>frida-server</code>ï¼ˆæ›´æ—©æ³¨å…¥ï¼‰</p>
<ol start="3" type="1">
<li><strong>å­˜åœ¨æœªè¦†ç›–çš„æ£€æµ‹ç‚¹</strong> â†’ ä½¿ç”¨ jadx
åˆ†æå®Œæ•´çš„æ£€æµ‹é€»è¾‘</li>
</ol>
<p>â†’ ä½¿ç”¨ jadx åˆ†æå®Œæ•´çš„æ£€æµ‹é€»è¾‘</p>
<h2 id="é—®é¢˜-2-hook-å-app-å´©æºƒ"># âŒ é—®é¢˜ 2: Hook å App å´©æºƒ</h2>
<p>*ç—‡çŠ¶*ï¼šåŠ è½½ Hook è„šæœ¬å App ç«‹å³å´©æºƒ</p>
<p>*æ£€æŸ¥*ï¼š</p>
<ol type="1">
<li><strong>Hook çš„å‡½æ•°ç­¾åé”™è¯¯</strong></li>
</ol>
<div class="sourceCode" id="cb186"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Checké‡è½½</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;ClassName&quot;</span>)<span class="op">.</span><span class="at">methodName</span><span class="op">.</span><span class="at">overloads</span><span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (o) {</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(o)<span class="op">;</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb187"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">// âŒ Error</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>SomeClass<span class="op">.</span><span class="at">returnsInt</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> () {</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="st">&quot;string&quot;</span><span class="op">;</span> <span class="co">// ClassTypeErrorï¼</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="co">// âœ… æ­£ç¡®</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>SomeClass<span class="op">.</span><span class="at">returnsInt</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> () {</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>â†’ æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼Œåª Hook ç‰¹å®šæƒ…å†µ</p>
<p>â†’ æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼Œåª Hook ç‰¹å®šæƒ…å†µ</p>
<h2 id="é—®é¢˜-3-æŸäº›æ£€æµ‹ç»•ä¸è¿‡å»"># âŒ é—®é¢˜ 3: æŸäº›æ£€æµ‹ç»•ä¸è¿‡å»</h2>
<p>*ç—‡çŠ¶*ï¼šå°è¯•äº†æ‰€æœ‰æ–¹æ³•ï¼Œä»æœ‰æ£€æµ‹æœªç»•è¿‡</p>
<p>*é«˜çº§å¯¹ç­–*ï¼š</p>
<ol type="1">
<li><strong>ä½¿ç”¨ frida-gadgetï¼ˆåµŒå…¥å¼ï¼‰</strong></li>
</ol>
<div class="sourceCode" id="cb188"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># è§£åŒ… APK</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> d app.apk</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Will frida-gadget.so Add to lib/</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify androidManifest.xml And smali CodeLoad gadget</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="co"># å‚è€ƒï¼šhttps://frida.re/docs/gadget/</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-æ‰“Package</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="ex">apktool</span> b app <span class="at">-o</span> app_patched.apk</span></code></pre></div>
<ol start="3" type="1">
<li><strong>é€†å‘æ£€æµ‹é€»è¾‘å¹¶ Patch APK</strong> ```bash #
ç›´æ¥ä¿®æ”¹æ£€æµ‹å‡½æ•°è¿”å›å€¼ # ç”¨ jadx æ‰¾åˆ° .smali ä»£ç  # ä¿®æ”¹è¿”å›æŒ‡ä»¤ä¸ºè¿”å› 0
# é‡æ–°æ‰“åŒ…</li>
</ol>
<pre><code>
\*ç—‡çŠ¶\*ï¼šæŒ‰ç…§æ•™ç¨‹ç¼–è¯‘ Frida æ—¶å‡ºé”™

\*è§£å†³\*ï¼š

1. **ä½¿ç”¨é¢„ç¼–è¯‘çš„å®šåˆ¶ç‰ˆ**

- ç¤¾åŒºé¡¹ç›®ï¼šhttps://github.com/hluwa/strongR-frida-android
- å·²é‡å‘½åæ‰€æœ‰ç‰¹å¾å­—ç¬¦ä¸²

- ç¤¾åŒºé¡¹ç›®ï¼šhttps://github.com/hluwa/strongR-frida-android
- å·²é‡å‘½åæ‰€æœ‰ç‰¹å¾å­—ç¬¦ä¸²

2. **ä½¿ç”¨ Docker ç¼–è¯‘ç¯å¢ƒ**

```bash
docker run --rm -v $(pwd):/work frida/ci
</code></pre>
<ul>
<li><p>ä¸è¦å…¨å±€æ›¿æ¢ï¼Œå®¹æ˜“ç ´åä»£ç </p></li>
<li><p>åªä¿®æ”¹ï¼šç«¯å£å·ã€æ¨¡å—åã€çº¿ç¨‹å</p></li>
<li><p>ä¸è¦å…¨å±€æ›¿æ¢ï¼Œå®¹æ˜“ç ´åä»£ç </p></li>
<li><p>åªä¿®æ”¹ï¼šç«¯å£å·ã€æ¨¡å—åã€çº¿ç¨‹å ___ ## å»¶ä¼¸é˜…è¯»</p></li>
</ul>
<h2 id="ç›¸å…³-recipes"># ç›¸å…³é…æ–¹</h2>
<ul>
<li><strong><a href="./device_fingerprinting_and_bypass.md">Root
æ£€æµ‹ç»•è¿‡</a></strong> - é€šå¸¸ä¸ Frida æ£€æµ‹ä¸€èµ·å‡ºç°</li>
<li><strong><a
href="../Network/network_sniffing.md#ç¬¬-5-æ­¥ç»•è¿‡-ssl-pinningå¦‚é‡åˆ°">SSL
Pinning ç»•è¿‡</a></strong> - å¯èƒ½ä¹Ÿæœ‰å Frida</li>
<li><strong><a
href="./device_fingerprinting_and_bypass.md">æ¨¡æ‹Ÿå™¨æ£€æµ‹ç»•è¿‡</a></strong>
- å¤šé‡æ£€æµ‹ç»„åˆ</li>
</ul>
<h2 id="å·¥å…·æ·±å…¥-1"># å·¥å…·æ·±å…¥</h2>
<ul>
<li><strong><a href="../../02-Tools/Dynamic/frida_guide.md">Frida
å®Œæ•´æŒ‡å—</a></strong></li>
<li><strong><a href="../../02-Tools/Dynamic/frida_internals.md">Frida
å†…éƒ¨åŸç†</a></strong> - ç†è§£æ£€æµ‹åŸç†</li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ"># æ¡ˆä¾‹åˆ†æ</h2>
<ul>
<li><strong><a
href="../../03-Case-Studies/case_anti_analysis_techniques.md">ååˆ†ææŠ€æœ¯æ¡ˆä¾‹</a></strong></li>
<li><strong><a
href="../../03-Case-Studies/case_social_media_and_anti_bot.md">ç¤¾äº¤åª’ä½“é£æ§</a></strong>
- é«˜çº§æ£€æµ‹å¯¹æŠ—</li>
</ul>
<h2 id="è¿›é˜¶èµ„æº"># è¿›é˜¶èµ„æº</h2>
<ul>
<li><strong>strongR-frida</strong>:
https://github.com/hluwa/strongR-frida-android</li>
<li><strong>frida-gadget æ–‡æ¡£</strong>:
https://frida.re/docs/gadget/</li>
<li><strong>ç¼–è¯‘ Frida</strong>: https://frida.re/docs/building/ ___ ##
å¿«é€Ÿå‚è€ƒ</li>
</ul>
<h2 id="ä¸€é”®ç»•è¿‡è„šæœ¬"># ä¸€é”®ç»•è¿‡è„šæœ¬</h2>
<p>*ä¸‹è½½é€šç”¨ç»•è¿‡è„šæœ¬*ï¼š</p>
<div class="sourceCode" id="cb190"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨ç¤¾åŒºç»´æŠ¤çš„ BypassScript</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> https://raw.githubusercontent.com/0xdea/frida-scripts/master/raptor_frida_android_bypass.js</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the command</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-l</span> raptor_frida_android_bypass.js <span class="at">--no-pause</span></span></code></pre></div>
<div class="line-block">è¿›ç¨‹å | <code>/proc/*/cmdline</code> | é‡å‘½å +
Hook <code>fopen()</code> |<br />
æ¨¡å—å | <code>/proc/self/maps</code> | Hook <code>fgets()</code> è¿‡æ»¤
|<br />
å­—ç¬¦ä¸² | <code>strstr()</code> | Hook <code>strstr()</code> |<br />
çº¿ç¨‹å | <code>/proc/self/task/*/comm</code> | Hook
<code>pthread_setname_np()</code> |<br />
Java æ£€æµ‹ | <code>isFridaDetected()</code> | Hook æ£€æµ‹å‡½æ•° |</div>
<h2 id="å¸¸ç”¨å‘½ä»¤"># å¸¸ç”¨å‘½ä»¤</h2>
<div class="sourceCode" id="cb191"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># éæ ‡å‡†ç«¯å£è¿è¡Œ frida-server</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;/data/local/tmp/frida -l 0.0.0.0:8888 &amp;&quot;</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co"># è¿æ¥ to to to to to to Notæ ‡å‡†Port</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-H</span> 127.0.0.1:8888 <span class="at">-f</span> com.example.app</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Spawn modeï¼ˆé‡è¦ï¼‰</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-l</span> bypass.js <span class="at">--no-pause</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="co"># åˆ—è¡¨ allModuleï¼ˆCheckIsNoæœ‰ frida-agentï¼‰</span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-e</span> <span class="st">&#39;Process.enumerateModules()&#39;</span></span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a><span class="co"># List allThreadï¼ˆCheckThreadNameï¼‰</span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-e</span> <span class="st">&#39;Process.enumerateThreads()&#39;</span></span></code></pre></div>
<!-- 01-Recipes/Anti-Detection/mobile_app_sec_and_anti_bot.md -->
<h1 id="ç§»åŠ¨ç«¯å®‰å…¨ä¸é£æ§æŠ€æœ¯">ç§»åŠ¨ç«¯å®‰å…¨ä¸é£æ§æŠ€æœ¯</h1>
<p>ç°ä»£ç§»åŠ¨åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å¤„ç†æ•æ„Ÿç”¨æˆ·æ•°æ®æˆ–æœ‰ä»·å€¼ä¸šåŠ¡é€»è¾‘çš„åº”ç”¨ï¼Œé€šå¸¸ä¼šå®ç°å¤šå±‚å®‰å…¨æœºåˆ¶æ¥é˜²å¾¡é€†å‘å·¥ç¨‹ã€ç¯¡æ”¹å’Œè‡ªåŠ¨åŒ–æ»¥ç”¨ï¼ˆæœºå™¨äººï¼‰ã€‚è¿™ä¸€é¢†åŸŸé€šå¸¸è¢«ç§°ä¸ºâ€RASPâ€ï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰æˆ–â€åæœºå™¨äººæŠ€æœ¯â€ã€‚</p>
<p>æœ¬æ–‡æ¡£æ¦‚è¿°äº†å¸¸è§çš„æŠ€æœ¯ã€‚</p>
<hr />
<h2 id="å…³é”®é˜²å¾¡ç±»å‹">å…³é”®é˜²å¾¡ç±»å‹</h2>
<h3 id="åè°ƒè¯•ä¸ååˆ†æ">1. åè°ƒè¯•ä¸ååˆ†æ</h3>
<p>è¿™äº›æŠ€æœ¯æ—¨åœ¨æ£€æµ‹å¹¶é˜»æ­¢åƒè°ƒè¯•å™¨å’Œæ’æ¡©æ¡†æ¶è¿™æ ·çš„åˆ†æå·¥å…·ã€‚</p>
<ul>
<li><p><strong>è°ƒè¯•å™¨æ£€æµ‹</strong>:</p></li>
<li><p>æ£€æŸ¥ <code>/proc/self/status</code> ä¸­çš„
<code>TracerPid</code>ã€‚ä¸€ä¸ªéé›¶å€¼è¡¨ç¤ºæœ‰è°ƒè¯•å™¨é™„åŠ ã€‚</p></li>
<li><p>ä½¿ç”¨ <code>ptrace(PTRACE_TRACEME, 0, NULL, NULL)</code>
å¹¶æ£€æŸ¥è¿”å›å€¼æ˜¯å¦å°äº 0ã€‚</p></li>
<li><p>æ—¶é—´æ£€æŸ¥ï¼šæµ‹é‡æ‰§è¡Œä¸€æ®µä»£ç æ‰€éœ€çš„æ—¶é—´ã€‚å¦‚æœé™„åŠ äº†è°ƒè¯•å™¨ï¼ˆå¸¦æœ‰æ–­ç‚¹ï¼‰ï¼Œæ—¶é—´å°†ä¼šæœ‰æ˜¾è‘—ä¸åŒã€‚</p></li>
<li><p><strong>Frida æ£€æµ‹</strong>:</p></li>
<li><p>æ‰«æå†…å­˜ä¸­æ˜¯å¦å­˜åœ¨ <code>frida-agent</code> æˆ–
<code>frida-gadget</code> åº“ã€‚</p></li>
<li><p>é€šè¿‡å°è¯•è¿æ¥å…¶é»˜è®¤ç«¯å£ï¼ˆ27042ï¼‰æ¥æ£€æµ‹ Frida çš„æœåŠ¡å™¨ã€‚</p></li>
<li><p>æ£€æŸ¥ Frida ç‰¹æœ‰çš„ç—•è¿¹ï¼Œå¦‚å‘½åç®¡é“ï¼ˆ<code>frida-pipe</code>ï¼‰æˆ–å¯¹
<code>REPL</code> ç¯å¢ƒçš„ä¿®æ”¹ã€‚</p></li>
<li><p><strong>æ¨¡æ‹Ÿå™¨/Root æ£€æµ‹</strong>:</p></li>
<li><p>æ£€æŸ¥å·²çŸ¥çš„æ¨¡æ‹Ÿå™¨ç‰¹æœ‰æ–‡ä»¶ã€å±æ€§ï¼ˆ<code>ro.kernel.qemu</code>ï¼‰æˆ–è®¾å¤‡é©±åŠ¨ã€‚</p></li>
<li><p>æ£€æŸ¥æ˜¯å¦å­˜åœ¨ root ç®¡ç†åº”ç”¨ï¼ˆå¦‚ SuperSUï¼‰æˆ– <code>su</code>
äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></li>
</ul>
<h3 id="åç¯¡æ”¹">2. åç¯¡æ”¹</h3>
<p>è¿™äº›æŠ€æœ¯ç¡®ä¿åº”ç”¨çš„ä»£ç å’Œæ•°æ®æœªè¢«ä¿®æ”¹ã€‚</p>
<ul>
<li><p><strong>ä»£ç å®Œæ•´æ€§æ ¡éªŒ</strong>: åœ¨è¿è¡Œæ—¶è®¡ç®—
<code>classes.dex</code>
æ–‡ä»¶æˆ–åŸç”Ÿåº“ï¼ˆ<code>.so</code>ï¼‰çš„æ ¡éªŒå’Œæˆ–å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚
SHA-256ï¼‰ï¼Œå¹¶ä¸å®‰å…¨å­˜å‚¨çš„å·²çŸ¥è‰¯å¥½å€¼è¿›è¡Œæ¯”è¾ƒã€‚</p></li>
<li><p><strong>ç­¾åéªŒè¯</strong>:
åœ¨è¿è¡Œæ—¶ï¼Œè·å–åº”ç”¨è‡ªèº«çš„ç­¾åå¹¶éªŒè¯å…¶æ˜¯å¦ä¸å®˜æ–¹å¼€å‘è€…ç­¾ååŒ¹é…ã€‚è¿™å¯ä»¥é˜²æ­¢é‡æ‰“åŒ…ã€‚</p></li>
<li><p><strong>å†…å­˜å®Œæ•´æ€§æ ¡éªŒ</strong>:
å®šæœŸæ‰«æåº”ç”¨è‡ªèº«çš„å†…å­˜ï¼Œä»¥ç¡®ä¿å…³é”®å‡½æ•°æœªè¢« Frida
ç­‰å·¥å…·é’©ä½æˆ–ä¿®è¡¥ã€‚</p></li>
</ul>
<h3 id="åæœºå™¨äººä¸ä¸šåŠ¡é€»è¾‘ä¿æŠ¤">3. åæœºå™¨äººä¸ä¸šåŠ¡é€»è¾‘ä¿æŠ¤</h3>
<p>è¿™äº›æŠ€æœ¯æ—¨åœ¨é˜²æ­¢è‡ªåŠ¨åŒ–è„šæœ¬æ»¥ç”¨åº”ç”¨çš„ API
æˆ–åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºåƒåœ¾è´¦æˆ·ã€æŠ“å–æ•°æ®ï¼‰ã€‚</p>
<ul>
<li><p><strong>è®¾å¤‡è¯æ˜</strong>: ä½¿ç”¨åƒ Android çš„
<code>SafetyNet</code> / <code>Play Integrity</code> API
è¿™æ ·çš„æœåŠ¡ï¼Œä»è°·æ­ŒæœåŠ¡å™¨è·å–ä¸€ä¸ªåŠ å¯†è¯æ˜ï¼Œè¯æ˜è®¾å¤‡æ˜¯çœŸå®çš„ã€é root
çš„ï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡Œå®˜æ–¹åº”ç”¨ã€‚è¿™éå¸¸éš¾ä»¥ç»•è¿‡ã€‚</p></li>
<li><p><strong>è¯·æ±‚ç­¾å</strong>: å…³é”®çš„ API
è¯·æ±‚é€šå¸¸å—â€ç­¾åâ€ä¿æŠ¤ã€‚è¿™ä¸ªç­¾åæ˜¯æ ¹æ®è¯·æ±‚å‚æ•°ã€æ—¶é—´æˆ³ã€éšæœºæ•°å’Œä¸€ä¸ªå¯†é’¥è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚
HMAC-SHA256ï¼‰ã€‚å¯†é’¥é€šå¸¸ä½¿ç”¨æ··æ·†ç­‰æŠ€æœ¯éšè—èµ·æ¥ã€‚é€†å‘è¿™ä¸ªç­¾åç®—æ³•æ˜¯åˆ†æå¸ˆçš„ä¸€ä¸ªå¸¸è§ç›®æ ‡ã€‚</p></li>
<li><p><strong>è¡Œä¸ºåˆ†æ</strong>: åœ¨æœåŠ¡å™¨ç«¯ï¼Œåˆ†æ API
è°ƒç”¨çš„<em>æ—¶é—´</em>å’Œ<em>é¡ºåº</em>ï¼Œä»¥å»ºç«‹çœŸå®ç”¨æˆ·çš„è¡Œä¸ºç”»åƒã€‚æœºå™¨äººé€šå¸¸å…·æœ‰éå¸¸åƒµç¡¬ã€éäººç±»çš„æ—¶é—´æ¨¡å¼ï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹å®ƒä»¬ã€‚</p></li>
</ul>
<hr />
<h2 id="ç»•è¿‡ç­–ç•¥">ç»•è¿‡ç­–ç•¥</h2>
<p>ç»•è¿‡è¿™äº›é˜²å¾¡éœ€è¦ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æã€‚</p>
<ul>
<li><p><strong>é’©å­ä¸è¡¥ä¸</strong>: ä½¿ç”¨ Frida
é’©ä½è´Ÿè´£è¿™äº›æ£€æŸ¥çš„å‡½æ•°ï¼Œå¹¶å¼ºåˆ¶å®ƒä»¬è¿”å›ä¸€ä¸ªâ€å®‰å…¨â€çš„å€¼ã€‚ä¾‹å¦‚ï¼Œé’©ä½è¯»å–
<code>TracerPid</code> çš„å‡½æ•°ï¼Œä½¿å…¶æ€»æ˜¯è¿”å› 0ã€‚</p></li>
<li><p><strong>è‡ªå®šä¹‰ Frida ç‰ˆæœ¬</strong>: ä¸ºäº†å¯¹æŠ— Frida
æ£€æµ‹ï¼Œä½ å¯ä»¥ç¼–è¯‘ä¸€ä¸ªè‡ªå®šä¹‰åç§°å’Œä¸åŒé»˜è®¤ç«¯å£çš„ <code>frida-server</code>
ç‰ˆæœ¬ã€‚</p></li>
<li><p><strong>é™æ€åˆ†æ</strong>:
åæ±‡ç¼–åº”ç”¨ä»¥æ‰¾åˆ°æ£€æŸ¥é€»è¾‘ã€‚ä¸€æ—¦æ‰¾åˆ°ï¼Œä½ é€šå¸¸å¯ä»¥å°†å…¶â€nopâ€æ‰ï¼ˆç”¨
<code>NOP</code> æŒ‡ä»¤æ›¿æ¢ï¼‰ï¼Œä»¥æ°¸ä¹…ç¦ç”¨å®ƒã€‚</p></li>
</ul>
<!-- 01-Recipes/Anti-Detection/xposed_anti_debugging.md -->
<h1 id="recipe-ç»•è¿‡åº”ç”¨çš„-xposed-æ£€æµ‹">Recipe: ç»•è¿‡åº”ç”¨çš„ Xposed
æ£€æµ‹</h1>
<h2 id="é—®é¢˜åœºæ™¯-4">é—®é¢˜åœºæ™¯</h2>
<p>ä½ å¯èƒ½é‡åˆ°ä»¥ä¸‹æƒ…å†µï¼š</p>
<ol type="1">
<li><strong>App å¯åŠ¨å³é€€å‡º</strong>ï¼šApp å¯åŠ¨åå¼¹å‡ºâ€æ£€æµ‹åˆ° Xposed
æ¡†æ¶ï¼Œç¦æ­¢è¿è¡Œâ€ï¼Œéšå³é—ªé€€</li>
<li><strong>åŠŸèƒ½å—é™</strong>ï¼šé‡‘è/æ”¯ä»˜ç±» App æ£€æµ‹åˆ° Xposed
åæ‹’ç»æä¾›æœåŠ¡ï¼ˆæ— æ³•è½¬è´¦ã€æ”¯ä»˜ï¼‰</li>
<li><strong>è´¦å·å°ç¦</strong>ï¼šæ¸¸æˆæ£€æµ‹åˆ° Xposed
ç¯å¢ƒåè§¦å‘é£æ§ï¼Œå¯¼è‡´å°å·</li>
<li><strong>åˆ†æå—é˜»</strong>ï¼šéœ€è¦åœ¨ Xposed ç¯å¢ƒä¸‹åˆ†æ App
è¡Œä¸ºï¼Œä½†è¢«åè°ƒè¯•æ‹¦æˆª</li>
<li><strong>é€šç”¨æ–¹æ¡ˆå¤±æ•ˆ</strong>ï¼šå·²ç»ä½¿ç”¨ RootCloak Plus
ç­‰é€šç”¨éšè—æ¨¡å—ï¼Œä½†ä»è¢«æ£€æµ‹åˆ°</li>
</ol>
<h2 id="å·¥å…·æ¸…å•-1">å·¥å…·æ¸…å•</h2>
<h2 id="å¿…éœ€å·¥å…·-4"># å¿…éœ€å·¥å…·</h2>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>Xposed
æ¡†æ¶</strong>ï¼šEdXposed æˆ– LSPosedï¼ˆæ¨è LSPosedï¼Œæ›´ç¨³å®šï¼‰</label></li>
<li><label><input type="checkbox" /><strong>Root è®¾å¤‡</strong>ï¼šå·² Root
çš„ Android è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ï¼ˆå¦‚ Genymotionï¼‰</label></li>
<li><label><input type="checkbox" /><strong>ç›®æ ‡
APK</strong>ï¼šéœ€è¦ç»•è¿‡æ£€æµ‹çš„åº”ç”¨å®‰è£…åŒ…</label></li>
<li><label><input type="checkbox" /><strong>Xposed
æ¨¡å—å¼€å‘ç¯å¢ƒ</strong>ï¼šAndroid
Studioï¼ˆç”¨äºç¼–å†™è‡ªå®šä¹‰ç»•è¿‡æ¨¡å—ï¼‰</label></li>
</ul>
<h2 id="å¯é€‰å·¥å…·-4"># å¯é€‰å·¥å…·</h2>
<ul class="task-list">
<li><label><input
type="checkbox" /><strong>JEB/Jadx</strong>ï¼šåç¼–è¯‘å·¥å…·ï¼Œç”¨äºåˆ†æ App
çš„æ£€æµ‹ä»£ç </label></li>
<li><label><input type="checkbox" /><strong>RootCloak
Plus</strong>ï¼šé€šç”¨ Xposed/Root éšè—æ¨¡å—ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰</label></li>
<li><label><input type="checkbox" /><strong>Hide My
Applist</strong>ï¼šé«˜çº§åº”ç”¨åˆ—è¡¨å’Œæ¡†æ¶éšè—å·¥å…·</label></li>
<li><label><input type="checkbox" /><strong>MT Manager</strong>ï¼šAndroid
æ–‡ä»¶ç®¡ç†å™¨ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ–‡ä»¶</label></li>
<li><label><input type="checkbox" /><strong>Xposed
æºç </strong>ï¼šEdXposed æºç ï¼ˆå®šåˆ¶åŒ–æ¡†æ¶éœ€æ±‚ï¼‰</label></li>
</ul>
<h2 id="å‰ç½®æ¡ä»¶-1">å‰ç½®æ¡ä»¶</h2>
<p>å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š</p>
<ul>
<li>âœ… <strong>å·²å®‰è£… Xposed æ¡†æ¶</strong>ï¼šè®¾å¤‡ä¸Šå·²åˆ·å…¥ EdXposed æˆ–
LSPosedï¼Œå¹¶èƒ½æ­£å¸¸ä½¿ç”¨</li>
<li>âœ… <strong>è®¾å¤‡å·² Root</strong>ï¼šæ‹¥æœ‰ Root
æƒé™ï¼Œæˆ–ä½¿ç”¨è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ˆå¦‚ VirtualXposedï¼‰</li>
<li>âœ… <strong>èƒ½åç¼–è¯‘ APK</strong>ï¼šä¼šä½¿ç”¨ Jadx/JEB æŸ¥çœ‹ Java
ä»£ç </li>
<li>âœ… <strong>äº†è§£ Xposed Hook åŸºç¡€</strong>ï¼šçŸ¥é“å¦‚ä½•ç¼–å†™ç®€å•çš„ Xposed
æ¨¡å—ï¼ˆå¯å‚è€ƒ <a href="../../02-Tools/Dynamic/xposed_guide.md">Xposed
Guide</a>ï¼‰</li>
<li>âœ… <strong>äº†è§£ Java åå°„æœºåˆ¶</strong>ï¼šç†è§£
<code>Class.forName()</code>, <code>ClassLoader</code> ç­‰æ¦‚å¿µ</li>
</ul>
<h2 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h2>
<h2 id="ç¬¬-1-æ­¥è¯†åˆ«æ£€æµ‹ç±»å‹15-30-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ«æ£€æµ‹ç±»å‹ï¼ˆ15-30
åˆ†é’Ÿï¼‰</h2>
<p>é¦–å…ˆéœ€è¦ç¡®å®š App ä½¿ç”¨äº†å“ªç§æ£€æµ‹æ–¹æ³•ï¼Œè¿™å†³å®šäº†åç»­çš„ç»•è¿‡ç­–ç•¥ã€‚</p>
<h3 id="æ–¹æ³•-1è§‚å¯Ÿè¿è¡Œè¡Œä¸º"># æ–¹æ³• 1ï¼šè§‚å¯Ÿè¿è¡Œè¡Œä¸º</h3>
<p>è¿è¡Œç›®æ ‡ Appï¼Œè§‚å¯Ÿå¼‚å¸¸è¡Œä¸ºçš„æ—¶æœºå’Œç‰¹å¾ï¼š</p>
<table>
<thead>
<tr>
<th>å¼‚å¸¸æ—¶æœº</th>
<th>å¯èƒ½çš„æ£€æµ‹ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¯åŠ¨é˜¶æ®µç«‹å³å´©æºƒ/é€€å‡º</strong></td>
<td>è°ƒç”¨æ ˆæ£€æµ‹ï¼ˆApplication.onCreate ä¸­ï¼‰</td>
</tr>
<tr>
<td><strong>ç‰¹å®šåŠŸèƒ½ï¼ˆç™»å½•ã€æ”¯ä»˜ï¼‰å—é™</strong></td>
<td>å…³é”®æ–¹æ³•å¤„çš„å®šç‚¹æ£€æµ‹</td>
</tr>
<tr>
<td><strong>å»¶è¿Ÿå‡ ç§’åå¼¹å‡ºè­¦å‘Š</strong></td>
<td>å®šæ—¶å™¨æˆ–å¼‚æ­¥çº¿ç¨‹ä¸­çš„æ£€æµ‹</td>
</tr>
<tr>
<td><strong>éšæœºè§¦å‘</strong></td>
<td>å¤šç‚¹åˆ†æ•£æ£€æµ‹æˆ–æ··æ·†åçš„æ£€æµ‹</td>
</tr>
</tbody>
</table>
<h3 id="æ–¹æ³•-2é™æ€åˆ†ææ£€æµ‹ä»£ç "># æ–¹æ³• 2ï¼šé™æ€åˆ†ææ£€æµ‹ä»£ç </h3>
<p>ä½¿ç”¨ Jadx åç¼–è¯‘ APKï¼Œæœç´¢ Xposed æ£€æµ‹çš„ç‰¹å¾å­—ç¬¦ä¸²ï¼š</p>
<div class="sourceCode" id="cb192"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># åç¼–è¯‘ APK</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx</span> <span class="at">-d</span> ./decompiled target.apk</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æœç´¢ Xposed ç›¸å…³ç‰¹å¾</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> decompiled</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;xposed&quot;</span> <span class="at">--include</span><span class="op">=</span><span class="st">&quot;*.java&quot;</span> .</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;XposedBridge&quot;</span> <span class="at">--include</span><span class="op">=</span><span class="st">&quot;*.java&quot;</span> .</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;de.robv.android&quot;</span> <span class="at">--include</span><span class="op">=</span><span class="st">&quot;*.java&quot;</span> .</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SearchDetectionMethodCall</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;getStackTrace&quot;</span> <span class="at">--include</span><span class="op">=</span><span class="st">&quot;*.java&quot;</span> .</span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;Class.forName&quot;</span> <span class="at">--include</span><span class="op">=</span><span class="st">&quot;*.java&quot;</span> .</span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;/proc/self/maps&quot;</span> <span class="at">--include</span><span class="op">=</span><span class="st">&quot;*.java&quot;</span> .</span></code></pre></div>
<p>// ç‰¹å¾ Code try { throw new Exception(â€œXposed Detectionâ€); } catch
(Exception e) { for (StackTraceElement element : e.getStackTrace()) { if
(element.getClassName().contains(â€œde.robv.android.xposedâ€)) { // Xposed
Detected! return true; } } }</p>
<pre><code>try {
Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;);
// If æ²¡æŠ› anomalyï¼ŒDesc Xposed exists at
return true;
} catch (ClassNotFoundException e) {
return false;
}
</code></pre>
<p>if (xposedJar.exists()) { // Xposed Detected! }</p>
<pre><code>FILE* fp = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
// Readå†…å®¹å¹¶æŸ¥æ‰¾ &quot;libxposed_art.so&quot; or &quot;XposedBridge&quot;

```
void* handle = dlopen(&quot;libart.so&quot;, RTLD_NOW);
void* sym = dlsym(handle, &quot;_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjjPNS_6JValueEPKc&quot;);
// æ£€æŸ¥ if åœ°å€ is åœ¨éæ ‡å‡†å†…å­˜åŒºåŸŸ
</code></pre>
<p>|â€”â€”â€”|â€”â€”â€”|â€”â€”-|â€”â€”| | Java å±‚è°ƒç”¨æ ˆæ£€æµ‹ | Hook
<code>StackTraceElement.getClassName()</code> | 90% | 30min | | Java
å±‚ç±»åŠ è½½æ£€æµ‹ | Hook <code>Class.forName()</code> | 85% | 20min | |
æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹ | Hook <code>File.exists()</code> | 95% | 20min | | Native
å±‚ maps æ£€æµ‹ | Hook <code>fopen()</code> / å®šåˆ¶æ¡†æ¶ | 60% | 2-4h | |
ç»¼åˆæ£€æµ‹ï¼ˆå¤šç§æ–¹æ³•ï¼‰ | å®šåˆ¶åŒ– Xposed æ¡†æ¶ | 80% | 4h+ |</p>
<p>*å†³ç­–æ ‘*ï¼š</p>
<pre><code>
å¿«é€Ÿæµ‹è¯•éœ€æ±‚æˆ–ä¸æƒ³å†™ä»£ç 
â””â”€â†’ Strategy Bï¼šUseç°æˆéšè—Moduleï¼ˆæœ€å¿«ï¼‰
</code></pre>
<p>åˆ›å»º <code>AntiXposedDetection.java</code>ï¼š</p>
<div class="sourceCode" id="cb196"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">example</span><span class="op">.</span><span class="im">antidetect</span><span class="op">;</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">android</span><span class="op">.</span><span class="im">os</span><span class="op">.</span><span class="im">Bundle</span><span class="op">;</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.*;</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">callbacks</span><span class="op">.</span><span class="im">XC_LoadPackage</span><span class="op">.</span><span class="im">LoadPackageParam</span><span class="op">;</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">File</span><span class="op">;</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> AntiXposedDetection <span class="kw">implements</span> IXposedHookLoadPackage <span class="op">{</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Modifyä¸ºä½ TargetAppPackageName</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> TARGET_PACKAGE <span class="op">=</span> <span class="st">&quot;com.target.app&quot;</span><span class="op">;</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleLoadPackage</span><span class="op">(</span>LoadPackageParam lpparam<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Only Hook TargetApp</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>lpparam<span class="op">.</span><span class="fu">packageName</span><span class="op">.</span><span class="fu">equals</span><span class="op">(</span>TARGET_PACKAGE<span class="op">))</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;[AntiDetect] Start Hook &quot;</span> <span class="op">+</span> TARGET_PACKAGE<span class="op">);</span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a><span class="co">// BypassCallæ ˆDetection</span></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a><span class="fu">hookStackTrace</span><span class="op">();</span></span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a><span class="co">// BypassClassLoadDetection</span></span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a><span class="fu">hookClassForName</span><span class="op">();</span></span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a><span class="co">// BypassFileç³»ç»ŸDetection</span></span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a><span class="fu">hookFileExists</span><span class="op">();</span></span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Bypassç³»ç»ŸPropertyDetection</span></span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a><span class="fu">hookSystemProperties</span><span class="op">();</span></span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;[AntiDetect] æ‰€æœ‰ Hook å·²æ¿€æ´»&quot;</span><span class="op">);</span></span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> BypassCall<span class="co">æ ˆ</span>Detection</span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">åŸç†ï¼š</span>Modify StackTraceElement<span class="co">.</span>getClassName<span class="co">()</span> ReturnValue</span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">/</span></span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a>private void hookStackTrace<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="co">.</span>findAndHookMethod<span class="co">(</span></span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a>StackTraceElement<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>getClassName<span class="co">&quot;,</span></span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a>new XC_MethodHook<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a><span class="co">@</span>Override</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a>protected void afterHookedMethod<span class="co">(</span>MethodHookParam param<span class="co">)</span> throws Throwable <span class="co">{</span></span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a>String originalClassName <span class="co">=</span> <span class="co">(</span>String<span class="co">)</span> param<span class="co">.</span>getResult<span class="co">();</span></span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a><span class="co">//</span> <span class="co">å¦‚æœç±»ååŒ…å«</span> xposed <span class="co">ç‰¹å¾ï¼Œæ›¿æ¢ä¸º</span>No<span class="co">å®³ç³»ç»Ÿ</span>Class</span>
<span id="cb196-49"><a href="#cb196-49" aria-hidden="true" tabindex="-1"></a>if <span class="co">(</span>originalClassName <span class="co">!=</span> null <span class="er">&amp;&amp;</span></span>
<span id="cb196-50"><a href="#cb196-50" aria-hidden="true" tabindex="-1"></a>originalClassName<span class="co">.</span>toLowerCase<span class="co">().</span>contains<span class="co">(&quot;</span>xposed<span class="co">&quot;))</span> <span class="co">{</span></span>
<span id="cb196-51"><a href="#cb196-51" aria-hidden="true" tabindex="-1"></a>param<span class="co">.</span>setResult<span class="co">(&quot;</span>com<span class="co">.</span>android<span class="co">.</span>internal<span class="co">.</span>os<span class="co">.</span>ZygoteInit<span class="co">&quot;);</span></span>
<span id="cb196-52"><a href="#cb196-52" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="co">.</span>log<span class="co">(&quot;[</span>AntiDetect<span class="co">]</span> <span class="co">éšè—è°ƒç”¨æ ˆ:</span> <span class="co">&quot;</span> <span class="co">+</span> originalClassName<span class="co">);</span></span>
<span id="cb196-53"><a href="#cb196-53" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-54"><a href="#cb196-54" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-55"><a href="#cb196-55" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-56"><a href="#cb196-56" aria-hidden="true" tabindex="-1"></a><span class="co">);</span></span>
<span id="cb196-57"><a href="#cb196-57" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-58"><a href="#cb196-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-59"><a href="#cb196-59" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb196-60"><a href="#cb196-60" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> BypassClassLoadDetection</span>
<span id="cb196-61"><a href="#cb196-61" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">åŸç†ï¼š</span>Intercept Class<span class="co">.</span>forName<span class="co">()</span> Call<span class="co">ï¼Œå¯¹</span> Xposed Class<span class="co">æŠ›å‡º</span> ClassNotFoundException</span>
<span id="cb196-62"><a href="#cb196-62" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">/</span></span>
<span id="cb196-63"><a href="#cb196-63" aria-hidden="true" tabindex="-1"></a>private void hookClassForName<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-64"><a href="#cb196-64" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="co">.</span>findAndHookMethod<span class="co">(</span></span>
<span id="cb196-65"><a href="#cb196-65" aria-hidden="true" tabindex="-1"></a>Class<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-66"><a href="#cb196-66" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>forName<span class="co">&quot;,</span></span>
<span id="cb196-67"><a href="#cb196-67" aria-hidden="true" tabindex="-1"></a>String<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-68"><a href="#cb196-68" aria-hidden="true" tabindex="-1"></a>new XC_MethodHook<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-69"><a href="#cb196-69" aria-hidden="true" tabindex="-1"></a><span class="co">@</span>Override</span>
<span id="cb196-70"><a href="#cb196-70" aria-hidden="true" tabindex="-1"></a>protected void beforeHookedMethod<span class="co">(</span>MethodHookParam param<span class="co">)</span> throws Throwable <span class="co">{</span></span>
<span id="cb196-71"><a href="#cb196-71" aria-hidden="true" tabindex="-1"></a>String className <span class="co">=</span> <span class="co">(</span>String<span class="co">)</span> param<span class="co">.</span>args<span class="co">[0];</span></span>
<span id="cb196-72"><a href="#cb196-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-73"><a href="#cb196-73" aria-hidden="true" tabindex="-1"></a><span class="co">//</span> If<span class="co">å°è¯•</span>Load Xposed <span class="co">ç›¸å…³</span>Class<span class="co">ï¼ŒæŠ›å‡º</span> ClassNotFoundanomaly</span>
<span id="cb196-74"><a href="#cb196-74" aria-hidden="true" tabindex="-1"></a>if <span class="co">(</span>className <span class="co">!=</span> null <span class="er">&amp;&amp;</span></span>
<span id="cb196-75"><a href="#cb196-75" aria-hidden="true" tabindex="-1"></a><span class="co">(</span>className<span class="co">.</span>contains<span class="co">(&quot;</span>xposed<span class="co">&quot;)</span> <span class="co">||</span></span>
<span id="cb196-76"><a href="#cb196-76" aria-hidden="true" tabindex="-1"></a>className<span class="co">.</span>contains<span class="co">(&quot;</span>Xposed<span class="co">&quot;)</span> <span class="co">||</span></span>
<span id="cb196-77"><a href="#cb196-77" aria-hidden="true" tabindex="-1"></a>className<span class="co">.</span>contains<span class="co">(&quot;</span>EdXposed<span class="co">&quot;)</span> <span class="co">||</span></span>
<span id="cb196-78"><a href="#cb196-78" aria-hidden="true" tabindex="-1"></a>className<span class="co">.</span>contains<span class="co">(&quot;</span>LSPosed<span class="co">&quot;)))</span> <span class="co">{</span></span>
<span id="cb196-79"><a href="#cb196-79" aria-hidden="true" tabindex="-1"></a>param<span class="co">.</span>setThrowable<span class="co">(</span>new ClassNotFoundException<span class="co">(</span>className<span class="co">));</span></span>
<span id="cb196-80"><a href="#cb196-80" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="co">.</span>log<span class="co">(&quot;[</span>AntiDetect<span class="co">]</span> <span class="co">é˜»æ­¢</span>LoadClass<span class="co">:</span> <span class="co">&quot;</span> <span class="co">+</span> className<span class="co">);</span></span>
<span id="cb196-81"><a href="#cb196-81" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-82"><a href="#cb196-82" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-83"><a href="#cb196-83" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-84"><a href="#cb196-84" aria-hidden="true" tabindex="-1"></a><span class="co">);</span></span>
<span id="cb196-85"><a href="#cb196-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-86"><a href="#cb196-86" aria-hidden="true" tabindex="-1"></a><span class="co">//</span> <span class="co">ä¹Ÿ</span> <span class="co">æ‹¦æˆª</span> <span class="co">ä¸‰</span>ParameterVersion forName</span>
<span id="cb196-87"><a href="#cb196-87" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="co">.</span>findAndHookMethod<span class="co">(</span></span>
<span id="cb196-88"><a href="#cb196-88" aria-hidden="true" tabindex="-1"></a>Class<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-89"><a href="#cb196-89" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>forName<span class="co">&quot;,</span></span>
<span id="cb196-90"><a href="#cb196-90" aria-hidden="true" tabindex="-1"></a>String<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-91"><a href="#cb196-91" aria-hidden="true" tabindex="-1"></a>boolean<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-92"><a href="#cb196-92" aria-hidden="true" tabindex="-1"></a>ClassLoader<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-93"><a href="#cb196-93" aria-hidden="true" tabindex="-1"></a>new XC_MethodHook<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-94"><a href="#cb196-94" aria-hidden="true" tabindex="-1"></a><span class="co">@</span>Override</span>
<span id="cb196-95"><a href="#cb196-95" aria-hidden="true" tabindex="-1"></a>protected void beforeHookedMethod<span class="co">(</span>MethodHookParam param<span class="co">)</span> throws Throwable <span class="co">{</span></span>
<span id="cb196-96"><a href="#cb196-96" aria-hidden="true" tabindex="-1"></a>String className <span class="co">=</span> <span class="co">(</span>String<span class="co">)</span> param<span class="co">.</span>args<span class="co">[0];</span></span>
<span id="cb196-97"><a href="#cb196-97" aria-hidden="true" tabindex="-1"></a>if <span class="co">(</span>className <span class="co">!=</span> null <span class="er">&amp;&amp;</span> className<span class="co">.</span>toLowerCase<span class="co">().</span>contains<span class="co">(&quot;</span>xposed<span class="co">&quot;))</span> <span class="co">{</span></span>
<span id="cb196-98"><a href="#cb196-98" aria-hidden="true" tabindex="-1"></a>param<span class="co">.</span>setThrowable<span class="co">(</span>new ClassNotFoundException<span class="co">(</span>className<span class="co">));</span></span>
<span id="cb196-99"><a href="#cb196-99" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-100"><a href="#cb196-100" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-101"><a href="#cb196-101" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-102"><a href="#cb196-102" aria-hidden="true" tabindex="-1"></a><span class="co">);</span></span>
<span id="cb196-103"><a href="#cb196-103" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-104"><a href="#cb196-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-105"><a href="#cb196-105" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb196-106"><a href="#cb196-106" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> BypassFile<span class="co">ç³»ç»Ÿ</span>Detection</span>
<span id="cb196-107"><a href="#cb196-107" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">åŸç†ï¼š</span>Modify File<span class="co">.</span>exists<span class="co">()</span> ReturnValue<span class="co">ï¼Œéšè—</span> Xposed <span class="co">ç‰¹å¾</span>File</span>
<span id="cb196-108"><a href="#cb196-108" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">/</span></span>
<span id="cb196-109"><a href="#cb196-109" aria-hidden="true" tabindex="-1"></a>private void hookFileExists<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-110"><a href="#cb196-110" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="co">.</span>findAndHookMethod<span class="co">(</span></span>
<span id="cb196-111"><a href="#cb196-111" aria-hidden="true" tabindex="-1"></a>File<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-112"><a href="#cb196-112" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>exists<span class="co">&quot;,</span></span>
<span id="cb196-113"><a href="#cb196-113" aria-hidden="true" tabindex="-1"></a>new XC_MethodHook<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-114"><a href="#cb196-114" aria-hidden="true" tabindex="-1"></a><span class="co">@</span>Override</span>
<span id="cb196-115"><a href="#cb196-115" aria-hidden="true" tabindex="-1"></a>protected void afterHookedMethod<span class="co">(</span>MethodHookParam param<span class="co">)</span> throws Throwable <span class="co">{</span></span>
<span id="cb196-116"><a href="#cb196-116" aria-hidden="true" tabindex="-1"></a>File file <span class="co">=</span> <span class="co">(</span>File<span class="co">)</span> param<span class="co">.</span>thisObject<span class="co">;</span></span>
<span id="cb196-117"><a href="#cb196-117" aria-hidden="true" tabindex="-1"></a>String path <span class="co">=</span> file<span class="co">.</span>getAbsolutePath<span class="co">();</span></span>
<span id="cb196-118"><a href="#cb196-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-119"><a href="#cb196-119" aria-hidden="true" tabindex="-1"></a><span class="co">//</span> Xposed <span class="co">ç‰¹å¾</span>FileList</span>
<span id="cb196-120"><a href="#cb196-120" aria-hidden="true" tabindex="-1"></a>String<span class="co">[]</span> xposedPaths <span class="co">=</span> <span class="co">{</span></span>
<span id="cb196-121"><a href="#cb196-121" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>XposedBridge<span class="co">&quot;,</span></span>
<span id="cb196-122"><a href="#cb196-122" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>xposed<span class="co">&quot;,</span></span>
<span id="cb196-123"><a href="#cb196-123" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>de<span class="co">.</span>robv<span class="co">.</span>android<span class="co">.</span>xposed<span class="co">&quot;,</span></span>
<span id="cb196-124"><a href="#cb196-124" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>EdXposed<span class="co">&quot;,</span></span>
<span id="cb196-125"><a href="#cb196-125" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>LSPosed<span class="co">&quot;,</span></span>
<span id="cb196-126"><a href="#cb196-126" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>libxposed<span class="co">&quot;,</span></span>
<span id="cb196-127"><a href="#cb196-127" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>libedxposed<span class="co">&quot;,</span></span>
<span id="cb196-128"><a href="#cb196-128" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>liblspd<span class="co">&quot;</span></span>
<span id="cb196-129"><a href="#cb196-129" aria-hidden="true" tabindex="-1"></a><span class="co">};</span></span>
<span id="cb196-130"><a href="#cb196-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-131"><a href="#cb196-131" aria-hidden="true" tabindex="-1"></a><span class="co">//</span> <span class="co">æ£€æŸ¥</span> if <span class="co">è·¯å¾„</span> is Contains<span class="co">ç‰¹å¾</span></span>
<span id="cb196-132"><a href="#cb196-132" aria-hidden="true" tabindex="-1"></a>for <span class="co">(</span>String keyword <span class="co">:</span> xposedPaths<span class="co">)</span> <span class="co">{</span></span>
<span id="cb196-133"><a href="#cb196-133" aria-hidden="true" tabindex="-1"></a>if <span class="co">(</span>path<span class="co">.</span>contains<span class="co">(</span>keyword<span class="co">))</span> <span class="co">{</span></span>
<span id="cb196-134"><a href="#cb196-134" aria-hidden="true" tabindex="-1"></a>param<span class="co">.</span>setResult<span class="co">(</span>false<span class="co">);</span> <span class="co">//</span> <span class="co">ä¼ªè£…æ–‡ä»¶ä¸å­˜åœ¨</span></span>
<span id="cb196-135"><a href="#cb196-135" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="co">.</span>log<span class="co">(&quot;[</span>AntiDetect<span class="co">]</span> <span class="co">éšè—</span>File<span class="co">:</span> <span class="co">&quot;</span> <span class="co">+</span> path<span class="co">);</span></span>
<span id="cb196-136"><a href="#cb196-136" aria-hidden="true" tabindex="-1"></a>return<span class="co">;</span></span>
<span id="cb196-137"><a href="#cb196-137" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-138"><a href="#cb196-138" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-139"><a href="#cb196-139" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-140"><a href="#cb196-140" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-141"><a href="#cb196-141" aria-hidden="true" tabindex="-1"></a><span class="co">);</span></span>
<span id="cb196-142"><a href="#cb196-142" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-143"><a href="#cb196-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-144"><a href="#cb196-144" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb196-145"><a href="#cb196-145" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> Bypass<span class="co">ç³»ç»Ÿ</span>PropertyDetection</span>
<span id="cb196-146"><a href="#cb196-146" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">åŸç†ï¼š</span>Intercept System<span class="co">.</span>getProperty<span class="co">()</span> Call</span>
<span id="cb196-147"><a href="#cb196-147" aria-hidden="true" tabindex="-1"></a><span class="co">*</span> <span class="co">/</span></span>
<span id="cb196-148"><a href="#cb196-148" aria-hidden="true" tabindex="-1"></a>private void hookSystemProperties<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-149"><a href="#cb196-149" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="co">.</span>findAndHookMethod<span class="co">(</span></span>
<span id="cb196-150"><a href="#cb196-150" aria-hidden="true" tabindex="-1"></a>System<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-151"><a href="#cb196-151" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;</span>getProperty<span class="co">&quot;,</span></span>
<span id="cb196-152"><a href="#cb196-152" aria-hidden="true" tabindex="-1"></a>String<span class="co">.</span>class<span class="co">,</span></span>
<span id="cb196-153"><a href="#cb196-153" aria-hidden="true" tabindex="-1"></a>new XC_MethodHook<span class="co">()</span> <span class="co">{</span></span>
<span id="cb196-154"><a href="#cb196-154" aria-hidden="true" tabindex="-1"></a><span class="co">@</span>Override</span>
<span id="cb196-155"><a href="#cb196-155" aria-hidden="true" tabindex="-1"></a>protected void afterHookedMethod<span class="co">(</span>MethodHookParam param<span class="co">)</span> throws Throwable <span class="co">{</span></span>
<span id="cb196-156"><a href="#cb196-156" aria-hidden="true" tabindex="-1"></a>String key <span class="co">=</span> <span class="co">(</span>String<span class="co">)</span> param<span class="co">.</span>args<span class="co">[0];</span></span>
<span id="cb196-157"><a href="#cb196-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-158"><a href="#cb196-158" aria-hidden="true" tabindex="-1"></a><span class="co">//</span> VirtualXposed Etc<span class="co">ä¼š</span>settingss<span class="co">ç‰¹æ®Š</span>Property</span>
<span id="cb196-159"><a href="#cb196-159" aria-hidden="true" tabindex="-1"></a>if <span class="co">(</span>key <span class="co">!=</span> null <span class="er">&amp;&amp;</span></span>
<span id="cb196-160"><a href="#cb196-160" aria-hidden="true" tabindex="-1"></a><span class="co">(</span>key<span class="co">.</span>contains<span class="co">(&quot;</span>xposed<span class="co">&quot;)</span> <span class="co">||</span></span>
<span id="cb196-161"><a href="#cb196-161" aria-hidden="true" tabindex="-1"></a>key<span class="co">.</span>contains<span class="co">(&quot;</span>vxp<span class="co">&quot;)</span> <span class="co">||</span></span>
<span id="cb196-162"><a href="#cb196-162" aria-hidden="true" tabindex="-1"></a>key<span class="co">.</span>equals<span class="co">(&quot;</span>ro<span class="co">.</span>build<span class="co">.</span>version<span class="co">.</span>xposed<span class="co">&quot;)))</span> <span class="co">{</span></span>
<span id="cb196-163"><a href="#cb196-163" aria-hidden="true" tabindex="-1"></a>param<span class="co">.</span>setResult<span class="co">(</span>null<span class="co">);</span> <span class="co">//</span> Return null</span>
<span id="cb196-164"><a href="#cb196-164" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="co">.</span>log<span class="co">(&quot;[</span>AntiDetect<span class="co">]</span> <span class="co">éšè—ç³»ç»Ÿ</span>Property<span class="co">:</span> <span class="co">&quot;</span> <span class="co">+</span> key<span class="co">);</span></span>
<span id="cb196-165"><a href="#cb196-165" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-166"><a href="#cb196-166" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-167"><a href="#cb196-167" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-168"><a href="#cb196-168" aria-hidden="true" tabindex="-1"></a><span class="co">);</span></span>
<span id="cb196-169"><a href="#cb196-169" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb196-170"><a href="#cb196-170" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span></code></pre></div>
<p>â”‚ â”‚ â”œâ”€â”€ AndroidManifest.xml â”‚ â”‚ â”œâ”€â”€ assets/ â”‚ â”‚ â”‚ â””â”€â”€ xposed_init #
å…¥å£ç±»å£°æ˜ â”‚ â”‚ â””â”€â”€ java/com/example/antidetect/ â”‚ â”‚ â””â”€â”€
AntiXposedDetection.java â”‚ â””â”€â”€ build.gradle â””â”€â”€ build.gradle</p>
<pre><code>package=&quot;com.example.antidetect&quot;&gt;

&lt;application
android:allowBackup=&quot;true&quot;
android:label=&quot;Anti Xposed Detection&quot;
android:icon=&quot;@mipmap/ic_launcher&quot;&gt;

&lt;!-- Xposed Moduleå£°æ˜ --&gt;
&lt;meta-data
android:name=&quot;xposedmodule&quot;
android:value=&quot;true&quot; /&gt;
&lt;meta-data
android:name=&quot;xposeddescription&quot;
android:value=&quot;Hide Xposed from target app&quot; /&gt;
&lt;meta-data
android:name=&quot;xposedminversion&quot;
android:value=&quot;54&quot; /&gt;
&lt;/application&gt;
&lt;/manifest&gt;
</code></pre>
<p>./gradlew assembleRelease</p>
<h1 id="install-åˆ°è®¾å¤‡">2. Install åˆ°è®¾å¤‡</h1>
<p>adb install app/build/outputs/apk/release/app-release.apk</p>
<h1 id="at-lsposededxposed-in-æ¿€æ´»-module">3. At LSPosed/EdXposed In
æ¿€æ´» Module</h1>
<h1 id="open-lsposed-manager">- Open LSPosed Manager</h1>
<h1 id="module-æ‰¾åˆ°-anti-xposed-æ£€æµ‹">- Module â†’ æ‰¾åˆ° â€œAnti Xposed
æ£€æµ‹â€</h1>
<h1 id="å‹¾é€‰-enabledå¹¶-atscopeinaddtarget-app">- å‹¾é€‰ Enabledï¼Œå¹¶
AtScopeInAddTarget App</h1>
<h1 id="é‡å¯-target-app">- é‡å¯ Target App</h1>
<h1 id="viewlogvalidate">4. ViewLogValidate</h1>
<p>adb logcat -s Xposed:V | grep AntiDetect</p>
<pre><code>
1. **Hide My Applist**ï¼ˆæœ€å¼ºå¤§ï¼Œæ¨èï¼‰
- ä¸‹è½½ï¼š[GitHub](https://github.com/Dr-TSNG/Hide-My-Applist)
- åŠŸèƒ½ï¼šéšè—åº”ç”¨åˆ—è¡¨ã€Xposed æ¡†æ¶ã€Root
- æ”¯æŒé»‘ç™½åå•ã€æ¨¡æ¿ç³»ç»Ÿ

- ä¸‹è½½ï¼š[GitHub](https://github.com/Dr-TSNG/Hide-My-Applist)
- åŠŸèƒ½ï¼šéšè—åº”ç”¨åˆ—è¡¨ã€Xposed æ¡†æ¶ã€Root
- æ”¯æŒé»‘ç™½åå•ã€æ¨¡æ¿ç³»ç»Ÿ


2. **XposedChecker Bypass**
- ä¸“é—¨é’ˆå¯¹ XposedChecker è¿™ç±»æ£€æµ‹å·¥å…·
- è¦†ç›–å¸¸è§æ£€æµ‹ç‚¹

- ä¸“é—¨é’ˆå¯¹ XposedChecker è¿™ç±»æ£€æµ‹å·¥å…·
- è¦†ç›–å¸¸è§æ£€æµ‹ç‚¹


3. **RootCloak Plus**ï¼ˆè€ç‰Œæ¨¡å—ï¼‰
- åŒæ—¶éšè— Root å’Œ Xposed
- é…ç½®ç®€å•ï¼Œä½†å¯¹æ–°å‹æ£€æµ‹æ•ˆæœè¾ƒå·®

- åŒæ—¶éšè— Root å’Œ Xposed
- é…ç½®ç®€å•ï¼Œä½†å¯¹æ–°å‹æ£€æµ‹æ•ˆæœè¾ƒå·®


* *ä½¿ç”¨æ­¥éª¤ï¼ˆä»¥ Hide My Applist ä¸ºä¾‹ï¼‰**ï¼š

```bash
# 1. Downloadå¹¶Install
# ä» GitHub å‘å¸ƒ Downloadæœ€æ–° APK
adb install HideMyApplist.apk

# 2. At LSPosed Inæ¿€æ´»
# LSPosed ç®¡ç†å™¨ â†’ Module â†’ Hide My Applist â†’ å‹¾é€‰Enabled

# 3. Configéšè—è§„åˆ™
# Open Hide My Applist App
# â†’ æ¨¡æ¿Manage â†’ æ–°å»ºæ¨¡æ¿
# â†’ é€‰æ‹©éšè—å†…å®¹ï¼š
# é»‘åå•æ¨¡å¼ï¼ˆéšè— Xposed ç›¸å…³ï¼‰
# éšè— Xposed Module
# éšè—ç³»ç»Ÿæ¡†æ¶
# â†’ AppManage â†’ é€‰æ‹©Target App â†’ Appæ¨¡æ¿

# 4. é‡å¯Target App
adb shell am force-stop com.target.app
adb shell am start -n com.target.app/.MainActivity
</code></pre>
<ul>
<li><p>åŒ…åï¼š<code>de.robv.android.xposed</code> â†’
<code>com.myfw.custom</code></p></li>
<li><p>ç±»åï¼š<code>XposedBridge</code> â†’
<code>CustomBridge</code></p></li>
<li><p>æ–‡ä»¶åï¼š<code>libxposed_art.so</code> â†’
<code>libcustom_art.so</code></p></li>
<li><p>ç³»ç»Ÿå±æ€§ï¼š<code>persist.xposed.*</code> â†’
<code>persist.myfw.*</code></p></li>
<li><p>*è¯¦ç»†æ­¥éª¤*ï¼š</p></li>
<li><p>*1. è·å– Xposed æºç *ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb199"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å…‹éš† EdXposed æºç ï¼ˆæ¨èï¼Œæ¯”åŸç‰ˆ Xposed æ›´æ´»è·ƒï¼‰</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--recursive</span> https://github.com/ElderDrivers/EdXposed</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> EdXposed</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¹Ÿå¯ä»¥å…‹éš† LSPosedï¼ˆæ›´ç°ä»£å®ç°ï¼‰</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--recursive</span> https://github.com/LSPosed/LSPosed</span></code></pre></div>
<h1 id="å…¨å±€æ›¿æ¢-xposed-ç‰¹å¾ä¸ºè‡ª-definename-ç§°">å…¨å±€æ›¿æ¢ Xposed ç‰¹å¾ä¸ºè‡ª
DefineName ç§°</h1>
<p>OLD_PACKAGE=â€œde.robv.android.xposedâ€
NEW_PACKAGE=â€œcom.myframework.customâ€</p>
<p>OLD_CLASS=â€œXposedâ€ NEW_CLASS=â€œCustomâ€</p>
<p>OLD_LIB=â€œxposedâ€ NEW_LIB=â€œmyfwâ€</p>
<p>echo â€œStart æ›¿æ¢ Xposed ç‰¹å¾â€¦â€</p>
<h1 id="æ›¿æ¢-packagename">1. æ›¿æ¢ PackageName</h1>
<p>echo â€œæ›¿æ¢ PackageNameâ€¦â€ find . -type f ( -name â€œ<em>.javaâ€ -o -name
â€</em>.cppâ€ -o -name â€œ*.hâ€ )<br />
</p>
<ul>
<li>exec sed -i â€œs/<span
class="math inline"><em>O</em><em>L</em><em>D</em><sub><em>P</em></sub><em>A</em><em>C</em><em>K</em><em>A</em><em>G</em><em>E</em>/</span>NEW_PACKAGE/gâ€
{} +</li>
</ul>
<h1 id="æ›¿æ¢-classname">2. æ›¿æ¢ ClassName</h1>
<p>echo â€œæ›¿æ¢ ClassNameâ€¦â€ find . -type f -name â€œ_.javaâ€<br />
</p>
<ul>
<li>exec sed -i â€œs/<span
class="math inline"><em>O</em><em>L</em><em>D</em><sub><em>C</em></sub><em>L</em><em>A</em><em>S</em><em>S</em><em>B</em><em>r</em><em>i</em><em>d</em><em>g</em><em>e</em>/</span>{NEW<em>CLASS}Bridge/gâ€
{} + find . -type f -name â€</em>.javaâ€<br />
</li>
<li>exec sed -i â€œs/<span
class="math inline"><em>O</em><em>L</em><em>D</em><sub><em>C</em></sub><em>L</em><em>A</em><em>S</em><em>S</em><em>H</em><em>e</em><em>l</em><em>p</em><em>e</em><em>r</em><em>s</em>/</span>{NEW_CLASS}Helpers/gâ€
{} +</li>
</ul>
<h1 id="renamefile">3. renameFile</h1>
<p>echo â€œé‡å‘½ NameFileâ€¦â€ find . -name â€œ<em>Xposed</em>â€ | while read
file; do newfile=<span class="math inline">$(echo "$</span>fileâ€ | sed
â€œs/Xposed/Custom/gâ€) mv â€œ<span class="math inline">$file"
"$</span>newfileâ€ 2&gt;/dev/null done</p>
<h1 id="æ›¿æ¢-libraryfilename">4. æ›¿æ¢ LibraryFileName</h1>
<p>echo â€œæ›¿æ¢ Native LibraryNameâ€¦â€ find . -type f ( -name â€œ<em>.cppâ€ -o
-name â€</em>.mkâ€ -o -name â€œCMakeLists.txtâ€ )<br />
</p>
<ul>
<li>exec sed -i â€œs/lib<span
class="math inline"><em>O</em><em>L</em><em>D</em><sub><em>L</em></sub><em>I</em><em>B</em>/<em>l</em><em>i</em><em>b</em></span>{NEW_LIB}/gâ€
{} +</li>
</ul>
<h1 id="æ›¿æ¢ç³»ç»Ÿ-propertyname">5. æ›¿æ¢ç³»ç»Ÿ PropertyName</h1>
<p>echo â€œæ›¿æ¢ç³»ç»Ÿ Propertyâ€¦â€ find . -type f ( -name â€œ<em>.cppâ€ -o -name
â€</em>.javaâ€ )<br />
</p>
<ul>
<li>exec sed -i â€œs/persist.xposed/persist.myfw/gâ€ {} + - exec sed -i
â€œs/ro.xposed/ro.myfw/gâ€ {} +</li>
</ul>
<p>echo â€œâœ“ ç‰¹å¾æ›¿æ¢å®Œæˆï¼â€ echo â€œè¯· ManualCheck ä»¥ä¸‹ FileIsNo æ­£ç¡®ï¼šâ€
echo â€ - AndroidManifest.xmlâ€ echo â€ - module.prop (Magisk
ModuleConfig)â€ echo â€ - build.gradleâ€</p>
<pre><code>name=Custom Framework (Xposed)
version=v1.0.0
versionCode=1
author=YourName
description=Customized Xposed Framework with renamed signatures
minMagisk=21000
</code></pre>
<h1 id="æ‰§è¡Œæ›¿æ¢">æ‰§è¡Œæ›¿æ¢</h1>
<p>./rename_xposed.sh</p>
<h1 id="ç¼–è¯‘ä»¥-edxposed-ä¸ºä¾‹">ç¼–è¯‘ï¼ˆä»¥ EdXposed ä¸ºä¾‹ï¼‰</h1>
<p>cd EdXposed ./gradlew :edxp-core:buildAll</p>
<h1 id="è¾“å‡ºä½äº-åœ¨å¤–edxp-coreå‘å¸ƒ">è¾“å‡ºä½äº åœ¨å¤–/edxp-core/å‘å¸ƒ/</h1>
<h1 id="è·å–-a-.zip-æ–‡ä»¶canat-magisk-in-åˆ·å…¥">è·å– a .zip æ–‡ä»¶ï¼ŒCanAt
Magisk In åˆ·å…¥</h1>
<pre><code>
# æ–¹æ³• 1ï¼šé€šè¿‡ Magisk ç®¡ç†å™¨ Install
# æ‰“å¼€ Magisk ç®¡ç†å™¨ â†’ Module â†’ ä»NativeInstall â†’ é€‰æ‹© ZIP

# æ–¹æ³• 2ï¼šé€šè¿‡ TWRP Recovery åˆ·å…¥ï¼ˆIfæœ‰ï¼‰
# adb reboot recovery
# åœ¨å†… TWRP, é€‰æ‹© Install â†’ é€‰æ‹© ZIP â†’ æ»‘åŠ¨ç¡®è®¤

# é‡å¯è®¾å¤‡
adb reboot
</code></pre>
<ul>
<li><p><label><input type="checkbox" /><strong>Xposed Hook
ä¾ç„¶ç”Ÿæ•ˆ</strong>ï¼šä½ çš„ Hook æ¨¡å—èƒ½æ­£å¸¸ Hook ç›®æ ‡æ–¹æ³•</label></p></li>
<li><p><label><input
type="checkbox" /><strong>æ£€æµ‹å·¥å…·æ˜¾ç¤ºå¹²å‡€</strong>ï¼šä½¿ç”¨ XposedChecker
ç­‰å·¥å…·æµ‹è¯•ï¼Œæ˜¾ç¤ºæœªæ£€æµ‹åˆ°</label></p></li>
<li><p>*éªŒè¯æ–¹æ³•*ï¼š</p></li>
<li><p>*1. ç¼–å†™æµ‹è¯• Xposed æ¨¡å—*ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb202"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co">// éªŒè¯ æ‹¦æˆª IsNoç”Ÿæ•ˆ</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;com.target.app.MainActivity&quot;</span><span class="op">,</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>lpparam<span class="op">.</span><span class="fu">classLoader</span><span class="op">,</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;onCreate&quot;</span><span class="op">,</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>Bundle<span class="op">.</span><span class="fu">class</span><span class="op">,</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">afterHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;âœ“ Hook æˆåŠŸï¼App æœªæ£€æµ‹åˆ° Xposed&quot;</span><span class="op">);</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="co">// å¯é€‰ï¼šå¼¹å‡º Toast æç¤º</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Toast.makeText(context, &quot;Xposed Hook Active&quot;, Toast.LENGTH_SHorT).show();</span></span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
<h1 id="æŸ¥çœ‹-app-æ˜¯å¦æœ‰æ£€æµ‹ç›¸å…³æ—¥å¿—">æŸ¥çœ‹ App æ˜¯å¦æœ‰æ£€æµ‹ç›¸å…³æ—¥å¿—</h1>
<p>adb logcat | grep -i â€œxposed|detect|security|checkâ€</p>
<h1 id="should-see">Should seeï¼š</h1>
<h1 id="hook-æˆåŠŸ-log">- Hook æˆåŠŸ Log</h1>
<h1 id="æ²¡æœ‰æ£€æµ‹ç›¸å…³é”™è¯¯æ—¥å¿—">- æ²¡æœ‰æ£€æµ‹ç›¸å…³é”™è¯¯æ—¥å¿—</h1>
<pre><code>
# Run and view Result
# IfBypassSuccessï¼ŒShould display &quot;Xposed: Not Detected&quot;
</code></pre>
<p>â””â”€â†’ TestCoreBusinessï¼ˆæ”¯ä»˜/æ¸¸æˆ/Viewæ•æ„ŸInfoï¼‰ â””â”€â†’
è§‚å¯ŸIsNoè§¦å‘é£æ§OrException</p>
<pre><code>å½“ Xposed Hook ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®é™…çš„è°ƒç”¨é“¾æ˜¯ï¼š
</code></pre>
<p>*3. æ–‡ä»¶ç³»ç»Ÿç‰¹å¾*ï¼š Xposed éœ€è¦åœ¨ç³»ç»Ÿä¸­å®‰è£…æ–‡ä»¶ï¼š</p>
<ul>
<li><code>/system/framework/XposedBridge.jar</code></li>
<li><code>/system/lib/libxposed_art.so</code> æˆ–
<code>/system/lib64/libxposed_art.so</code></li>
</ul>
<p>*4. å†…å­˜æ˜ å°„ç‰¹å¾*ï¼š
è¿›ç¨‹çš„å†…å­˜æ˜ å°„ï¼ˆ<code>/proc/self/maps</code>ï¼‰ä¸­ä¼šå‡ºç° Xposed
ç›¸å…³çš„åº“ï¼š</p>
<pre><code>
å…³é”®æŠ€æœ¯ç‚¹ï¼š

1. **æ‹¦æˆªæ£€æµ‹æ–¹æ³•çš„æ‰§è¡Œ**ï¼šåœ¨æ£€æµ‹ä»£ç æ‰§è¡Œå‰ Hookï¼Œä¿®æ”¹å…¶è¡Œä¸º
2. **ä¿®æ”¹è¿”å›å€¼**ï¼šè®©æ£€æµ‹æ–¹æ³•æ€»æ˜¯è¿”å›&quot;æœªæ£€æµ‹åˆ°&quot;çš„ç»“æœ
3. **è¿‡æ»¤ç‰¹å¾å­—ç¬¦ä¸²**ï¼šå°†åŒ…å« &quot;xposed&quot; çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ— å®³å­—ç¬¦ä¸²
4. **é˜»æ­¢å¼‚å¸¸æŠ›å‡º**ï¼šå¯¹äº `Class.forName()` è¿™ç±»æ£€æµ‹ï¼Œä¸»åŠ¨æŠ›å‡º `ClassNotFoundException`

\*ç¤ºä¾‹ï¼šè°ƒç”¨æ ˆæ£€æµ‹çš„ç»•è¿‡åŸç†\*
</code></pre>
<p>Hook Afterï¼ˆBypassDetectionï¼‰ï¼š App Call getStackTrace() â†’ Return
[MainActivity, XposedBridge, ZygoteInit, â€¦] â†’ æˆ‘ä»¬ Hook Intercept
getClassName() â†’ Will â€œXposedBridgeâ€ æ›¿æ¢ä¸º â€œZygoteInitâ€ â†’ App Onlyçœ‹åˆ°
[MainActivity, ZygoteInit, ZygoteInit, â€¦] â†’ DetectionFailedï¼ˆæœªå‘ç°
Xposedï¼‰</p>
<pre><code>| ç±»åŠ è½½æ£€æµ‹ | `Class.forName(&quot;de.robv...XposedBridge&quot;)` | åŒ…åæ”¹ä¸º `com.myfw...CustomBridge` | âœ… æ£€æµ‹å¤±è´¥ |
| æ–‡ä»¶æ£€æµ‹ | `/system/framework/XposedBridge.jar` | æ–‡ä»¶åæ”¹ä¸º `CustomBridge.jar` | âœ… æ£€æµ‹å¤±è´¥ |
| maps æ£€æµ‹ | æœç´¢ `libxposed_art.so` | åº“åæ”¹ä¸º `libcustom_art.so` | âœ… æ£€æµ‹å¤±è´¥ |

\*ç¼ºç‚¹\*ï¼š

- ç»´æŠ¤æˆæœ¬é«˜ï¼Œéœ€è¦è·Ÿéšå®˜æ–¹ Xposed æ›´æ–°
- ç¼–è¯‘è¿‡ç¨‹å¤æ‚ï¼Œéœ€è¦é…ç½® Android NDK
- éƒ¨åˆ†ä¾èµ–åŸç‰ˆ Xposed API çš„æ¨¡å—å¯èƒ½ä¸å…¼å®¹

## å¸¸è§é—®é¢˜

## # âŒ é—®é¢˜ 1ï¼šHook æ¨¡å—æ¿€æ´»åï¼ŒApp ä»ç„¶æ£€æµ‹åˆ° Xposed

\*ç—‡çŠ¶\*ï¼š
</code></pre>
<ol start="2" type="1">
<li><strong>Native å±‚æ£€æµ‹</strong>ï¼šApp ä½¿ç”¨ JNI æ£€æµ‹ï¼ŒJava Hook
æ— æ³•æ‹¦æˆª</li>
<li><strong>é—æ¼çš„æ£€æµ‹ç‚¹</strong>ï¼šApp ä½¿ç”¨äº†ä½ æ²¡æœ‰è¦†ç›–çš„æ£€æµ‹æ–¹æ³•</li>
<li><strong>Hook ä½œç”¨åŸŸæœªé…ç½®</strong>ï¼šLSPosed ä¸­æœªå°†ç›®æ ‡ App
åŠ å…¥ä½œç”¨åŸŸ</li>
</ol>
<ul>
<li><p>*è§£å†³æ–¹æ¡ˆ**ï¼š</p></li>
<li><p>*æ–¹æ¡ˆ 1ï¼šæå‰ Hook æ—¶æœº**</p></li>
</ul>
<div class="sourceCode" id="cb207"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co">// At Application.attachBaseContext() InæBefore æ‹¦æˆª</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;com.target.app.MyApplication&quot;</span><span class="op">,</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>lpparam<span class="op">.</span><span class="fu">classLoader</span><span class="op">,</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;attachBaseContext&quot;</span><span class="op">,</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Context</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">beforeHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a><span class="co">// At Application InitializeBeforeå°± æ‹¦æˆª æ‰€æœ‰DetectionMethod</span></span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hookAllDetectionMethods</span><span class="op">(</span>lpparam<span class="op">);</span></span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;[AntiDetect] Early hooks installed&quot;</span><span class="op">);</span></span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
<p>// Frida Scriptï¼šHook fopen() Intercept maps FileRead
Interceptor.attach(Module.findExportByName(â€œlibc.soâ€, â€œfopenâ€), {
onEnter: function(args) { var path = Memory.readUtf8String(args[0]); if
(path === â€œ/proc/self/mapsâ€) { console.log(â€œ[*] fopen() called for
/proc/self/mapsâ€); // é‡å®šå‘åˆ°ä¸€å¹²å‡€ maps æ–‡ä»¶ args[0] =
Memory.allocUtf8String(â€œ/data/local/tmp/fake_mapsâ€); } } });</p>
<pre><code>// Call native MethodDo inline hook
nativeHookFopen();
</code></pre>
<p>cd decompiled</p>
<h1 id="æœç´¢æ‰€æœ‰å¯èƒ½æ£€æµ‹æ¨¡å¼">æœç´¢æ‰€æœ‰å¯èƒ½æ£€æµ‹æ¨¡å¼</h1>
<p>grep -rn
â€œgetStackTrace|forName|/proc/self/maps|XposedBridge|exists()â€ .<br />
</p>
<ul>
<li>-include=â€œ*.javaâ€ &gt; detection_points.txt</li>
</ul>
<pre><code>adb shell &quot;su -c &#39;ls /data/adb/lspd/config/modules/&#39;&quot;
# Should seeä½ Module ID

# CheckScopeConfig
# LSPosed ç®¡ç†å™¨ â†’ Module â†’ ä½ Module â†’ AppScope
# ç¡®ä¿ç›®æ ‡ App å·²å‹¾é€‰
</code></pre>
<ul>
<li><p>META-INF ç›®å½•ä¸‹çš„è„šæœ¬ç¼ºå¤±</p></li>
<li><p>ç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œç”Ÿæˆçš„ ZIP æŸå</p></li>
<li><p>*è§£å†³æ–¹æ¡ˆ**ï¼š</p></li>
<li><p>*æ–¹æ¡ˆ 1ï¼šæ£€æŸ¥ ZIP ç»“æ„**</p></li>
</ul>
<div class="sourceCode" id="cb210"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DecompressViewç»“æ„</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> <span class="at">-l</span> edxp-custom.zip</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æ ‡å‡† Magisk Moduleç»“æ„ï¼š</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="co"># META-INF/</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="co"># com/google/android/</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="co"># update-binary # InstallScript</span></span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a><span class="co"># updater-script # ç©ºæ–‡ä»¶å³å¯</span></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="co"># module.prop # ModuleConfig</span></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a><span class="co"># system/ # ç³»ç»Ÿæ–‡ä»¶</span></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a><span class="co"># framework/</span></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="co"># CustomBridge.jar</span></span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lib64/</span></span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a><span class="co"># libcustom_art.so</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a><span class="co"># riru/ # Riru ç›¸å…³ï¼ˆIfUse Riruï¼‰</span></span></code></pre></div>
<p>id=custom_xposed name=Custom Xposed Framework version=v1.0.0
versionCode=100 author=YourName description=Customized Xposed with
renamed signatures</p>
<h1 id="optionalfield">OptionalField</h1>
<p>minMagisk=21000 maxMagisk=99999</p>
<pre><code>mkdir -p magisk_module/system/framework
mkdir -p magisk_module/system/lib64

# ReplicationFile
cp update-binary magisk_module/META-INF/com/google/android/
touch magisk_module/META-INF/com/google/android/updater-script
cp module.prop magisk_module/
cp CustomBridge.jar magisk_module/system/framework/
cp libcustom_art.so magisk_module/system/lib64/

# Packageï¼ˆæ³¨æ„ï¼šMustAtModuleDirectoryå†…æ‰“Packageï¼‰
cd magisk_module
zip -r ../custom-xposed-magisk.zip .
cd ..

# æ¨é€å¹¶å®‰è£…
adb push custom-xposed-magisk.zip /sdcard/
# In Magisk Manager, Install
</code></pre>
<h1 id="åœ¨å†…-twrp-install-é€‰æ‹©-zip-æ»‘åŠ¨ç¡®è®¤">åœ¨å†… TWRP, ï¼šInstall â†’ é€‰æ‹©
ZIP â†’ æ»‘åŠ¨ç¡®è®¤</h1>
<pre><code></code></pre>
<ul>
<li><p>*è§£å†³æ–¹æ¡ˆ*ï¼š</p></li>
<li><p>*æ–¹æ¡ˆ 1ï¼šç²¾å‡† Hookï¼Œç¼©å°ä½œç”¨èŒƒå›´*</p></li>
</ul>
<p>âŒ <strong>é”™è¯¯ç¤ºèŒƒï¼šå…¨å±€ Hook</strong></p>
<div class="sourceCode" id="cb213"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co">// è¿™æ ·ä¼šå½±å“æ‰€æœ‰ç±»åŠ è½½ï¼ŒåŒ…æ‹¬æ­£å¸¸ä¸šåŠ¡</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span><span class="bu">Class</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="st">&quot;forName&quot;</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">...</span><span class="op">);</span></span></code></pre></div>
<p>â€œcom.target.app.security.SecurityCheckerâ€, lpparam.classLoader,
â€œcheckXposedâ€, new XC_MethodReplacement() { <span class="citation"
data-cites="Override">@Override</span> protected Object
replaceHookedMethod(MethodHookParam param) {
XposedBridge.log(â€œ[AntiDetect] checkXposed() blockedâ€); return false; //
è¿”å›â€æœªæ£€æµ‹åˆ°â€ } } );</p>
<pre><code>String className = (String) param.getResult();

// OnlyFilter Xposed ç›¸å…³ï¼Œä¸å½±å“å…¶ä»–Class
if (className != null &amp;&amp; className.toLowerCase().contains(&quot;xposed&quot;)) {
param.setResult(&quot;android.app.Activity&quot;);
}
// å…¶ä»–æƒ…å†µä¿æŒåŸæ ·ï¼Œä¸åšModify
}
</code></pre>
<p>// ä¸€æ¬¡OnlyEnabledä¸€ æ‹¦æˆªï¼ŒTestIsNoå¯¼è‡´å´©æºƒ hookStackTrace(); //
Testï¼šOK // hookClassForName(); // æš‚WhenCommentæ‰ // hookFileExists();
// æš‚WhenCommentæ‰</p>
<p>// é€ä¸ªå¯ç”¨å¹¶æµ‹è¯•ï¼Œæ‰¾å‡ºå¯¼è‡´å´©æºƒ æ‹¦æˆª</p>
<p>}</p>
<pre><code>
// ç¡®ä¿ReturnValueClassTypeåŒ¹é…
@Override
protected void afterHookedMethod(MethodHookParam param) {
// IfåŸMethodReturn booleanï¼Œä½ ä¹ŸMustReturn boolean
param.setResult(false); // âœ… æ­£ç¡®
// param.setResult(&quot;å‡&quot;); // âŒ é”™è¯¯ï¼ClassTypeä¸åŒ¹é…
}
</code></pre>
<ul>
<li><code>assets/xposed_init</code> æ–‡ä»¶ç¼ºå¤±æˆ–è·¯å¾„é”™è¯¯</li>
<li><code>AndroidManifest.xml</code> ä¸­ç¼ºå°‘ Xposed å…ƒæ•°æ®å£°æ˜</li>
<li>æ¨¡å—å…¥å£ç±»çš„åŒ…å/ç±»åä¸ <code>xposed_init</code> ä¸­ä¸ä¸€è‡´</li>
<li>LSPosed ç¼“å­˜æœªåˆ·æ–°</li>
</ul>
<p>*è§£å†³æ–¹æ¡ˆ*ï¼š</p>
<p>*æ–¹æ¡ˆ 1ï¼šæ£€æŸ¥ <code>assets/xposed_init</code> æ–‡ä»¶*</p>
<div class="sourceCode" id="cb216"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ç¡®è®¤æ–‡ä»¶å­˜åœ¨</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> <span class="at">-l</span> app-release.apk <span class="kw">|</span> <span class="fu">grep</span> xposed_init</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Should see: assets/xposed_init</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a><span class="co"># æ£€æŸ¥å†…å®¹ï¼ˆå¿…é¡»æ˜¯å®Œæ•´ç±»åï¼Œæ— æ–‡ä»¶æ‰©å±•åï¼‰</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> <span class="at">-p</span> app-release.apk assets/xposed_init</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="co"># OutputShouldIsï¼šcom.example.antidetect.AntiXposedDetection</span></span></code></pre></div>
<p>âœ… assets/xposed_init # æ­£ç¡®</p>
<pre><code>&lt;!-- å¿…é¡»æœ‰è¿™ä¸‰ä¸ª meta-data --&gt;
&lt;meta-data
android:name=&quot;xposedmodule&quot;
android:value=&quot;true&quot; /&gt;
&lt;meta-data
android:name=&quot;xposeddescription&quot;
android:value=&quot;Hide Xposed from detection&quot; /&gt;
&lt;meta-data
android:name=&quot;xposedminversion&quot;
android:value=&quot;54&quot; /&gt;
&lt;/application&gt;
</code></pre>
<h1 id="æ£€æŸ¥-if-å…¥å£-class-is-exists-at">æ£€æŸ¥ if å…¥å£ Class is exists
at</h1>
<p>ls -l
./decompiled/com/example/antidetect/AntiXposedDetection.java</p>
<h1 id="ç¡®è®¤ç±»å®ç°äº†-ixposedhookloadpackage-æ¥å£">ç¡®è®¤ç±»å®ç°äº†
IXposedHookLoadPackage æ¥å£</h1>
<p>grep â€œimplements IXposedHookLoadPackageâ€<br />
./decompiled/com/example/antidetect/AntiXposedDetection.java</p>
<pre><code>
# æ¸…é™¤ LSPosed ç¼“å­˜
adb shell &quot;su -c &#39;rm -rf /data/adb/lspd/cache/*&#39;&quot;

# Re-Install
adb install app-release.apk

# é‡å¯ LSPosedï¼ˆoré‡å¯è®¾å¤‡ï¼‰
adb shell &quot;su -c &#39;killall -9 com.android.systemui&#39;&quot;
# or
adb reboot

# æ‰“å¼€ LSPosed ç®¡ç†å™¨ï¼ŒShouldèƒ½çœ‹åˆ°Module
</code></pre>
<ul>
<li><p><a href="../Analysis/re_workflow.md">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a> -
å®Œæ•´çš„é€†å‘åˆ†ææµç¨‹</p></li>
<li><p>*å·¥å…·æ·±å…¥*ï¼š</p></li>
<li><p><a href="../../02-Tools/Dynamic/xposed_guide.md">Xposed
ä½¿ç”¨æŒ‡å—</a> - Xposed æ¡†æ¶åŸºç¡€ä½¿ç”¨</p></li>
<li><p><a href="../../02-Tools/Dynamic/xposed_internals.md">Xposed
å†…éƒ¨åŸç†</a> - Xposed å·¥ä½œæœºåˆ¶è¯¦è§£</p></li>
<li><p><a href="../../02-Tools/Dynamic/frida_guide.md">Frida
ä½¿ç”¨æŒ‡å—</a> - Frida ä¸ Xposed ååŒä½¿ç”¨</p></li>
<li><p>*å‚è€ƒèµ„æ–™*ï¼š</p></li>
<li><p><a
href="../../04-Reference/Advanced/android_sandbox_implementation.md">Android
æ²™ç®±å®ç°</a> - è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ä½¿ç”¨ Xposed</p></li>
<li><p><a href="../../04-Reference/Foundations/art_runtime.md">ART
è¿è¡Œæ—¶</a> - ç†è§£ Xposed å¦‚ä½•ä¿®æ”¹ ART</p></li>
<li><p>*æ¡ˆä¾‹åˆ†æ*ï¼š</p></li>
<li><p><a
href="../../03-Case-Studies/case_anti_analysis_techniques.md">Anti
Analysis Techniques</a> - ç»¼åˆååˆ†ææŠ€æœ¯æ¡ˆä¾‹</p></li>
<li><p><a
href="../../03-Case-Studies/case_social_media_and_anti_bot.md">Social
Media &amp; Anti Bot</a> - ç¤¾äº¤åº”ç”¨çš„ Xposed æ£€æµ‹</p></li>
</ul>
<h2 id="å¿«é€Ÿå‚è€ƒ">å¿«é€Ÿå‚è€ƒ</h2>
<h2 id="xposed-æ£€æµ‹æ–¹æ³•é€ŸæŸ¥è¡¨"># Xposed æ£€æµ‹æ–¹æ³•é€ŸæŸ¥è¡¨</h2>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 37%" />
<col style="width: 20%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th>æ£€æµ‹ç±»å‹</th>
<th>æ£€æµ‹å±‚çº§</th>
<th>ç‰¹å¾ä»£ç </th>
<th>ç»•è¿‡æ–¹æ³•</th>
<th>Hook ç›®æ ‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>è°ƒç”¨æ ˆæ£€æµ‹</td>
<td>Java</td>
<td><code>getStackTrace()</code> + <code>contains("xposed")</code></td>
<td>Hook è¿”å›å€¼è¿‡æ»¤</td>
<td><code>StackTraceElement.getClassName()</code></td>
</tr>
<tr>
<td>ç±»åŠ è½½æ£€æµ‹</td>
<td>Java</td>
<td><code>Class.forName("XposedBridge")</code></td>
<td>æŠ›å‡º ClassNotFoundException</td>
<td><code>Class.forName()</code></td>
</tr>
<tr>
<td>å·²åŠ è½½ç±»æ£€æµ‹</td>
<td>Java</td>
<td><code>ClassLoader.loadClass(...)</code></td>
<td>åŒä¸Š</td>
<td><code>ClassLoader.loadClass()</code></td>
</tr>
<tr>
<td>æ–‡ä»¶æ£€æµ‹</td>
<td>Java</td>
<td><code>new File("/system/.../XposedBridge.jar").exists()</code></td>
<td>è¿”å› false</td>
<td><code>File.exists()</code></td>
</tr>
<tr>
<td>maps æ£€æµ‹</td>
<td>Native</td>
<td><code>fopen("/proc/self/maps")</code> +
<code>strstr("libxposed")</code></td>
<td>Hook fopen æˆ–å®šåˆ¶æ¡†æ¶</td>
<td><code>libc.fopen()</code></td>
</tr>
<tr>
<td>ç³»ç»Ÿå±æ€§æ£€æµ‹</td>
<td>Java/Native</td>
<td><code>System.getProperty("vxp_...")</code></td>
<td>è¿”å› null</td>
<td><code>System.getProperty()</code></td>
</tr>
<tr>
<td>ç¬¦å·åœ°å€æ£€æµ‹</td>
<td>Native</td>
<td><code>dlsym(...)</code> æ£€æŸ¥åœ°å€å¼‚å¸¸</td>
<td>å®šåˆ¶æ¡†æ¶</td>
<td>N/Aï¼ˆéœ€æºç ä¿®æ”¹ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="å®Œæ•´ç»•è¿‡æ¨¡å—æ¨¡æ¿ä¸€é”®ä½¿ç”¨"># å®Œæ•´ç»•è¿‡æ¨¡å—æ¨¡æ¿ï¼ˆä¸€é”®ä½¿ç”¨ï¼‰</h2>
<p>ä¿å­˜ä¸º <code>AntiXposedBypass.java</code>ï¼Œä¿®æ”¹åŒ…åå’Œç›®æ ‡ App
å³å¯ä½¿ç”¨ï¼š</p>
<div class="sourceCode" id="cb219"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">example</span><span class="op">.</span><span class="im">antidetect</span><span class="op">;</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.*;</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">callbacks</span><span class="op">.</span><span class="im">XC_LoadPackage</span><span class="op">.</span><span class="im">LoadPackageParam</span><span class="op">;</span></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">File</span><span class="op">;</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> AntiXposedBypass <span class="kw">implements</span> IXposedHookLoadPackage <span class="op">{</span></span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> TARGET <span class="op">=</span> <span class="st">&quot;com.target.app&quot;</span><span class="op">;</span> <span class="co">// æ”¹ä¸ºä½ Target App</span></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleLoadPackage</span><span class="op">(</span>LoadPackageParam lpparam<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>lpparam<span class="op">.</span><span class="fu">packageName</span><span class="op">.</span><span class="fu">equals</span><span class="op">(</span>TARGET<span class="op">))</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;[Bypass] Hooking &quot;</span> <span class="op">+</span> TARGET<span class="op">);</span></span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-17"><a href="#cb219-17" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. BypassCallæ ˆDetection</span></span>
<span id="cb219-18"><a href="#cb219-18" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span><span class="bu">StackTraceElement</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="st">&quot;getClassName&quot;</span><span class="op">,</span></span>
<span id="cb219-19"><a href="#cb219-19" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb219-20"><a href="#cb219-20" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb219-21"><a href="#cb219-21" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">afterHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb219-22"><a href="#cb219-22" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> name <span class="op">=</span> <span class="op">(</span><span class="bu">String</span><span class="op">)</span> param<span class="op">.</span><span class="fu">getResult</span><span class="op">();</span></span>
<span id="cb219-23"><a href="#cb219-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>name <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> name<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;xposed&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb219-24"><a href="#cb219-24" aria-hidden="true" tabindex="-1"></a>param<span class="op">.</span><span class="fu">setResult</span><span class="op">(</span><span class="st">&quot;com.android.internal.os.ZygoteInit&quot;</span><span class="op">);</span></span>
<span id="cb219-25"><a href="#cb219-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-26"><a href="#cb219-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-27"><a href="#cb219-27" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb219-28"><a href="#cb219-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-29"><a href="#cb219-29" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. BypassClassLoadDetection</span></span>
<span id="cb219-30"><a href="#cb219-30" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span><span class="bu">Class</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="st">&quot;forName&quot;</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span></span>
<span id="cb219-31"><a href="#cb219-31" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb219-32"><a href="#cb219-32" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb219-33"><a href="#cb219-33" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">beforeHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb219-34"><a href="#cb219-34" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> cls <span class="op">=</span> <span class="op">(</span><span class="bu">String</span><span class="op">)</span> param<span class="op">.</span><span class="fu">args</span><span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb219-35"><a href="#cb219-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>cls <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> cls<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;xposed&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb219-36"><a href="#cb219-36" aria-hidden="true" tabindex="-1"></a>param<span class="op">.</span><span class="fu">setThrowable</span><span class="op">(</span><span class="kw">new</span> <span class="bu">ClassNotFoundException</span><span class="op">(</span>cls<span class="op">));</span></span>
<span id="cb219-37"><a href="#cb219-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-38"><a href="#cb219-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-39"><a href="#cb219-39" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb219-40"><a href="#cb219-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-41"><a href="#cb219-41" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. BypassFileDetection</span></span>
<span id="cb219-42"><a href="#cb219-42" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span><span class="bu">File</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="st">&quot;exists&quot;</span><span class="op">,</span></span>
<span id="cb219-43"><a href="#cb219-43" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb219-44"><a href="#cb219-44" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb219-45"><a href="#cb219-45" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">afterHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb219-46"><a href="#cb219-46" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> path <span class="op">=</span> <span class="op">((</span><span class="bu">File</span><span class="op">)</span> param<span class="op">.</span><span class="fu">thisObject</span><span class="op">).</span><span class="fu">getAbsolutePath</span><span class="op">();</span></span>
<span id="cb219-47"><a href="#cb219-47" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>path<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;xposed&quot;</span><span class="op">)</span> <span class="op">||</span></span>
<span id="cb219-48"><a href="#cb219-48" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;edxposed&quot;</span><span class="op">)</span> <span class="op">||</span></span>
<span id="cb219-49"><a href="#cb219-49" aria-hidden="true" tabindex="-1"></a>path<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;lspd&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb219-50"><a href="#cb219-50" aria-hidden="true" tabindex="-1"></a>param<span class="op">.</span><span class="fu">setResult</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb219-51"><a href="#cb219-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-52"><a href="#cb219-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-53"><a href="#cb219-53" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb219-54"><a href="#cb219-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-55"><a href="#cb219-55" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;[Bypass] All hooks activated&quot;</span><span class="op">);</span></span>
<span id="cb219-56"><a href="#cb219-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb219-57"><a href="#cb219-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>adb shell â€œsu -c â€˜ls -l /system/framework/Xposed*â€™â€ adb shell â€œsu -c
â€˜ps -A | grep xposedâ€™â€</p>
<h1 id="æŸ¥çœ‹å·²å®‰è£…çš„-xposed-æ¨¡å—">æŸ¥çœ‹å·²å®‰è£…çš„ Xposed æ¨¡å—</h1>
<p>adb shell â€œsu -c â€˜ls /data/app/ | grep -i xposedâ€™â€</p>
<h1 id="check-lsposed-status">Check LSPosed Status</h1>
<p>adb shell â€œsu -c â€˜ls -l /data/adb/lspd/â€™â€</p>
<h1 id="logdebug">========== LogDebug ==========</h1>
<h1 id="view-xposed-æ¡†æ¶-log">View Xposed æ¡†æ¶ Log</h1>
<p>adb logcat -s Xposed:V</p>
<h1
id="æŸ¥çœ‹æ¨¡å—æ—¥å¿—å‡è®¾æ¨¡å—æ ‡ç­¾ä¸º-antidetect">æŸ¥çœ‹æ¨¡å—æ—¥å¿—ï¼ˆå‡è®¾æ¨¡å—æ ‡ç­¾ä¸º
AntiDetectï¼‰</h1>
<p>adb logcat | grep AntiDetect</p>
<h1 id="view-app-detection-ç›¸å…³-log">View App Detection ç›¸å…³ Log</h1>
<p>adb logcat | grep -iE â€œdetect|xposed|security|checkâ€</p>
<h1 id="æ¸…ç©ºæ—¥å¿—å¹¶å®æ—¶æŸ¥çœ‹">æ¸…ç©ºæ—¥å¿—å¹¶å®æ—¶æŸ¥çœ‹</h1>
<p>adb logcat -c &amp;&amp; adb logcat -v time</p>
<h1 id="modulemanage">========== ModuleManage ==========</h1>
<h1 id="compile-xposed-module">Compile Xposed Module</h1>
<p>./gradlew assembleDebug # Debug ç‰ˆ ./gradlew assembleRelease #
Release ç‰ˆ</p>
<h1 id="installmodule">InstallModule</h1>
<p>adb install app/build/outputs/apk/debug/app-debug.apk</p>
<h1 id="å¸è½½æ¨¡å—">å¸è½½æ¨¡å—</h1>
<p>adb uninstall com.example.antidetect</p>
<h1 id="é‡å¯ç›®æ ‡-appåº”ç”¨æ›´æ”¹">é‡å¯ç›®æ ‡ Appï¼ˆåº”ç”¨æ›´æ”¹ï¼‰</h1>
<p>adb shell am force-stop com.target.app adb shell am start -n
com.target.app/.MainActivity</p>
<h1 id="å®šåˆ¶æ¡†æ¶">========== å®šåˆ¶æ¡†æ¶ ==========</h1>
<h1 id="æ¨é€è‡ªå®šä¹‰æ¡†æ¶åˆ°è®¾å¤‡">æ¨é€è‡ªå®šä¹‰æ¡†æ¶åˆ°è®¾å¤‡</h1>
<p>adb push EdXposed-custom.zip /sdcard/</p>
<h1 id="åœ¨å†…-magisk-installcommand-line-æ–¹å¼">åœ¨å†… Magisk,
Installï¼ˆcommand line æ–¹å¼ï¼‰</h1>
<p>adb shell â€œsu -c â€˜magisk â€“install-module
/sdcard/EdXposed-custom.zipâ€™â€</p>
<h1 id="é‡å¯è®¾å¤‡">é‡å¯è®¾å¤‡</h1>
<p>adb reboot</p>
<h1 id="testvalidate">========== TestValidate ==========</h1>
<h1 id="install-xposedchecker-testtool">Install XposedChecker
TestTool</h1>
<p>adb install XposedChecker.apk</p>
<h1 id="runtarget-app-å¹¶è§‚å¯Ÿè¡Œä¸º">RunTarget App å¹¶è§‚å¯Ÿè¡Œä¸º</h1>
<p>adb shell am start -n com.target.app/.MainActivity</p>
<h1 id="æŠ“å–å´©æºƒæ—¥å¿—">æŠ“å–å´©æºƒæ—¥å¿—</h1>
<p>adb logcat -b crash</p>
<h1
id="checkprocessmemorymappingæŸ¥æ‰¾-xposed-ç‰¹å¾">CheckProcessMemoryMappingï¼ˆæŸ¥æ‰¾
Xposed ç‰¹å¾ï¼‰</h1>
<p>adb shell â€œsu -c â€˜cat /proc/$(pidof com.target.app)/maps | grep -i
xposedâ€™â€</p>
<pre><code>
// æ¨¡å¼ 1ï¼šCallæ ˆDetection
if (element.getClassName().contains(&quot;xposed&quot;)) { /* Detectionåˆ° */ }

// æ¨¡å¼ 2ï¼šanomalyCallæ ˆDetection
try { throw new Exception(); } catch (Exception e) {
for (StackTraceElement elem : e.getStackTrace()) { /* Check */ }
}

// æ¨¡å¼ 3ï¼šClassLoadDetection
Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;);

// æ¨¡å¼ 4ï¼šClassLoader æ£€æµ‹
ClassLoader.getSystemClassLoader().loadClass(&quot;de.robv.android.xposed.XposedHelpers&quot;);

// æ¨¡å¼ 5ï¼šFileDetection
new File(&quot;/system/framework/XposedBridge.jar&quot;).exists()

// æ¨¡å¼ 6ï¼šç³»ç»ŸPropertyDetection
System.getProperty(&quot;vxp_forbid_status&quot;)
System.getProperty(&quot;ro.xposed.version&quot;)

// ========== Native LayerDetectionæ¨¡å¼ ==========

// æ¨¡å¼ 7ï¼šmaps FileDetectionï¼ˆC/C++ï¼‰
FILE* fp = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
// ThenSearch &quot;xposed&quot; or &quot;libxposed&quot;

// æ¨¡å¼ 8ï¼šdlopen æ£€æµ‹
void* handle = dlopen(&quot;libxposed_art.so&quot;, RTLD_NOW);
if (handle != NULL) { /* Detectionåˆ° */ }
</code></pre>
<p>Class.forName /proc/self/maps libxposed vxp_forbid ro.xposed EdXposed
LSPosed</p>
<div class="line-block">æ™®é€šåº”ç”¨ï¼ˆç¤¾äº¤ã€å·¥å…·ï¼‰ | Java å±‚è°ƒç”¨æ ˆæ£€æµ‹ |
ç­–ç•¥ Aï¼šé€šç”¨ Hook æ¨¡å— | 95% |<br />
é‡‘è Appï¼ˆé“¶è¡Œã€æ”¯ä»˜ï¼‰ | Java + Native ç»¼åˆæ£€æµ‹ | ç­–ç•¥ Cï¼šå®šåˆ¶æ¡†æ¶ +
Hook | 70% |<br />
å¤§å‹æ¸¸æˆ | Native å±‚ + å®šæ—¶æ£€æµ‹ | ç­–ç•¥ Cï¼šå®šåˆ¶æ¡†æ¶ | 60% |<br />
å®‰å…¨ç±» Appï¼ˆVPNã€æ€æ¯’ï¼‰ | æ·±åº¦æ£€æµ‹ + å®Œæ•´æ€§æ ¡éªŒ | ç­–ç•¥ C + è™šæ‹ŸåŒ– | 50%
|<br />
å°ä¼— App | ç®€å•æ£€æµ‹æˆ–æ— æ£€æµ‹ | ç­–ç•¥ Bï¼šç°æˆæ¨¡å— | 99% |</div>
<p>*æˆåŠŸç‡è¯´æ˜*ï¼š</p>
<ul>
<li><strong>95%+</strong>ï¼šé€šç”¨æ–¹æ³•å³å¯ç»•è¿‡</li>
<li><strong>70-90%</strong>ï¼šéœ€è¦é’ˆå¯¹æ€§ç¼–å†™ Hook</li>
<li><strong>50-70%</strong>ï¼šéœ€è¦å®šåˆ¶æ¡†æ¶æˆ–å¤šç§æŠ€æœ¯ç»„åˆ</li>
<li><strong>&lt;50%</strong>ï¼šå¯èƒ½éœ€è¦è™šæ‹ŸåŒ–ã€ç³»ç»Ÿçº§ä¿®æ”¹ç­‰é«˜çº§æŠ€æœ¯</li>
</ul>
<pre><code></code></pre>
<!-- 01-Recipes/Automation/automation_and_device_farming.md -->
<h1 id="å·¥ç¨‹åŒ–è‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿ">å·¥ç¨‹åŒ–ï¼šè‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿ</h1>
<p>åœ¨è™šæ‹ŸåŒ–å’Œå®¹å™¨åŒ–è§£å†³äº†â€ç¯å¢ƒâ€é—®é¢˜ä¹‹åï¼Œè‡ªåŠ¨åŒ–å’Œç¾¤æ§ç³»ç»Ÿåˆ™è´Ÿè´£è§£å†³â€æ‰§è¡Œâ€å’Œâ€ç®¡ç†â€çš„é—®é¢˜ã€‚å®ƒä»¬æ˜¯é©±åŠ¨æ•´ä¸ªè§„æ¨¡åŒ–æµ‹è¯•å’Œåˆ†ææµæ°´çº¿è¿è½¬çš„æ ¸å¿ƒå¼•æ“ã€‚
___ ## 1. è‡ªåŠ¨åŒ–æ¡†æ¶</p>
<p>è‡ªåŠ¨åŒ–æ¡†æ¶æ˜¯æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºã€ä¸ App UI
è¿›è¡Œäº¤äº’çš„å·¥å…·é›†ã€‚å®ƒçš„æ ¸å¿ƒä»»åŠ¡æ˜¯ä»£æ›¿äººå·¥ï¼Œå®ç°å¯¹ App çš„ç¨‹åºåŒ–æ§åˆ¶ã€‚</p>
<h3 id="a-ä¸»æµæ¡†æ¶å¯¹æ¯”">a) ä¸»æµæ¡†æ¶å¯¹æ¯”</h3>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th>é©±åŠ¨åŸç†</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Appium</strong></td>
<td>WebDriver åè®® -&gt; UIAutomator2/XCUITest</td>
<td>è·¨å¹³å°ï¼ˆAndroid/iOSï¼‰ï¼Œå¤šè¯­è¨€æ”¯æŒï¼Œç”Ÿæ€æˆç†Ÿï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</td>
<td>ç¯å¢ƒé…ç½®å¤æ‚ï¼Œæ‰§è¡Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå¯¹ App æœ‰ä¸€å®šçš„ä¾µå…¥æ€§ï¼ˆéœ€è¦å®‰è£…
WebDriver Agentï¼‰ã€‚</td>
<td>æ ‡å‡†åŒ–çš„ã€è·¨å¹³å°çš„ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰åŠŸèƒ½æµ‹è¯•ã€‚</td>
</tr>
<tr>
<td><strong>UIAutomator2 (Python)</strong></td>
<td>Google UIAutomator2</td>
<td>ç›´æ¥ä¸è®¾å¤‡é€šä¿¡ï¼Œé€Ÿåº¦å¿«ï¼Œç¨³å®šï¼ŒAPI ç®€æ´æ˜“ç”¨ã€‚</td>
<td>ä»…æ”¯æŒ Androidï¼ŒåŠŸèƒ½ç›¸å¯¹ Appium è¾ƒå°‘ã€‚</td>
<td>çº¯ Android å¹³å°çš„å¿«é€Ÿè‡ªåŠ¨åŒ–ã€çˆ¬è™«å’Œæ—¥å¸¸è„šæœ¬ã€‚</td>
</tr>
<tr>
<td><strong>Airtest / Poco</strong></td>
<td>å›¾åƒè¯†åˆ« + UI æ§ä»¶</td>
<td>èƒ½å¤Ÿè§£å†³æ— æ³•è·å– UI æ§ä»¶æ ‘çš„é—®é¢˜ï¼ˆå¦‚æ¸¸æˆï¼‰ï¼Œè·¨å¼•æ“ï¼ˆUnity,
Cocosï¼‰ã€‚</td>
<td>å›¾åƒè¯†åˆ«ä¸ç¨³å®šï¼Œå—åˆ†è¾¨ç‡å’Œ UI å˜åŒ–å½±å“å¤§ï¼Œé€Ÿåº¦æ…¢ã€‚</td>
<td>æ¸¸æˆè‡ªåŠ¨åŒ–ï¼Œé»‘ç›’æµ‹è¯•ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="c-poco-è‡ªåŠ¨åŒ–æŠ€æœ¯æ·±åº¦è§£æ">c) Poco è‡ªåŠ¨åŒ–æŠ€æœ¯æ·±åº¦è§£æ</h3>
<p>Poco æ˜¯ç½‘æ˜“æ¨å‡ºçš„ UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œä¸“ä¸ºæ¸¸æˆå’Œå¤æ‚åº”ç”¨è®¾è®¡ï¼Œæ˜¯
Airtest é¡¹ç›®çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚</p>
<h4 id="æ ¸å¿ƒæ¶æ„ä¸åŸç†">æ ¸å¿ƒæ¶æ„ä¸åŸç†</h4>
<pre><code>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚Poco SDK â”‚ â”‚ â”‚ â”‚
â”‚ â”‚æ’ä»¶ â”‚ â”‚ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â†“ â”‚ â”‚ â”‚
â”‚ UIæ§ä»¶æ ‘ â”‚ â”‚ â”‚
â”‚ èŠ‚ç‚¹ä¿¡æ¯ â”‚ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ol start="4" type="1">
<li><strong>æŒ‡ä»¤æ‰§è¡Œ</strong>: æ¥æ”¶æ§åˆ¶ç«¯æŒ‡ä»¤ï¼Œæ“ä½œå¯¹åº” UI æ§ä»¶</li>
<li><strong>ç»“æœå›ä¼ </strong>: å°†æ“ä½œç»“æœå’ŒçŠ¶æ€ä¿¡æ¯è¿”å›æ§åˆ¶ç«¯</li>
</ol>
<h4 id="sdké›†æˆæ–¹å¼">SDKé›†æˆæ–¹å¼</h4>
<ul>
<li>*Unityå¼•æ“é›†æˆ**:</li>
</ul>
<div class="sourceCode" id="cb223"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Unity é¡¹ç›®ä¸­é›†æˆ Poco SDK</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Poco<span class="op">;</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PocoManager <span class="op">:</span> MonoBehaviour <span class="op">{</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="co">// å¯åŠ¨ Poco æœåŠ¡</span></span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> poco <span class="op">=</span> <span class="kw">new</span> <span class="fu">PocoServiceBuilder</span><span class="op">()</span></span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">SetPort</span><span class="op">(</span><span class="dv">5001</span><span class="op">)</span></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">SetDebugMode</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">Build</span><span class="op">();</span></span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>poco<span class="op">.</span><span class="fu">Start</span><span class="op">();</span></span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>bool AppDelegate::applicationDidFinishLaunching() { // åˆå§‹åŒ– Poco
æœåŠ¡ poco::PocoManager::getInstance()-&gt;start();</p>
<p>return true; }</p>
<pre><code>
public class MainActivity extends AppCompatActivity {
@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);

// å¯åŠ¨ Poco æœåŠ¡
Poco.start(&quot;poco&quot;, 5001);
}
}
</code></pre>
<p>from poco.drivers.android.uiautomation import
AndroidUiautomationPoco</p>
<h1 id="unity-æ¸¸æˆè¿æ¥">Unity æ¸¸æˆè¿æ¥</h1>
<p>poco = UnityPoco((â€˜192.168.1.100â€™, 5001))</p>
<h1 id="android-åŸç”Ÿåº”ç”¨è¿æ¥">Android åŸç”Ÿåº”ç”¨è¿æ¥</h1>
<p>poco = AndroidUiautomationPoco(use_airtest_input=True,
screenshot_each_action=False)</p>
<h1 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h1>
<p>poco(â€˜Buttonâ€™).click() # ç‚¹å‡»æŒ‰é’® poco(â€˜InputFieldâ€™).set_text(â€˜testâ€™)
# è¾“å…¥æ–‡æœ¬ poco(â€˜ScrollViewâ€™).swipe(â€˜upâ€™) # æ»‘åŠ¨æ“ä½œ</p>
<h1 id="ç­‰å¾…å…ƒç´ å‡ºç°">ç­‰å¾…å…ƒç´ å‡ºç°</h1>
<p>poco(â€˜LoadingPanelâ€™).wait_for_disappearance() # ç­‰å¾…åŠ è½½å®Œæˆ</p>
<pre><code>
# å±æ€§é€‰æ‹©
poco(text=&#39;ç¡®å®š&#39;).click()
poco(name=&#39;startBtn&#39;, enabled=True).click()
poco(type=&#39;Button&#39;, visible=True).click()

# ç›¸å¯¹ä½ç½®é€‰æ‹©
poco(&#39;username&#39;).sibling(&#39;password&#39;) # å…„å¼ŸèŠ‚ç‚¹
poco(&#39;title&#39;).parent() # çˆ¶èŠ‚ç‚¹

# æ¡ä»¶è¿‡æ»¤
buttons = poco(&#39;Button&#39;).filter(lambda x: x.get_text().startswith(&#39;ç¡®å®š&#39;))
</code></pre>
<h1 id="æ‹–æ‹½æ“ä½œ">æ‹–æ‹½æ“ä½œ</h1>
<p>poco.drag_to([0.2, 0.2], [0.8, 0.8])</p>
<h1 id="å¤šç‚¹è§¦æ§">å¤šç‚¹è§¦æ§</h1>
<p>poco.pinch(in_or_out=â€˜inâ€™, center=[0.5, 0.5], percent=0.6)</p>
<h1 id="ç­‰å¾…æ¸¸æˆçŠ¶æ€">ç­‰å¾…æ¸¸æˆçŠ¶æ€</h1>
<p>def wait_for_battle_end(): return poco(â€˜BattleResultâ€™).exists()</p>
<p>poco.wait_for_all(wait_for_battle_end, timeout=60)</p>
<pre><code>class PocoEngine:
def __init__(self, addr):
self.client = PocoClient(addr)

def screenshot(self):
&quot;&quot;&quot;è·å–æ¸¸æˆæˆªå›¾&quot;&quot;&quot;
return self.client.call(&quot;Screenshot&quot;)

def get_screen_size(self):
&quot;&quot;&quot;è·å–å±å¹•å°ºå¯¸&quot;&quot;&quot;
return self.client.call(&quot;GetScreenSize&quot;)

def click(self, pos):
&quot;&quot;&quot;ç‚¹å‡»æ“ä½œ&quot;&quot;&quot;
return self.client.call(&quot;Click&quot;, pos)

def dump_hierarchy(self):
&quot;&quot;&quot;è·å– UI æ§ä»¶æ ‘&quot;&quot;&quot;
return self.client.call(&quot;Dump&quot;)
</code></pre>
<p>if engine_type == â€˜unityâ€™: return UnityPoco(device_info[â€˜addrâ€™]) elif
engine_type == â€˜cocosâ€™: return CocosJSPoco(device_info[â€˜addrâ€™]) elif
engine_type == â€˜unrealâ€™: return UE4Poco(device_info[â€˜addrâ€™]) elif
engine_type == â€˜androidâ€™: return AndroidUiautomationPoco() else: raise
ValueError(fâ€Unsupported engine: {engine_type}â€œ)</p>
<pre><code>def __init__(self, max_connections=10):
self.pool = queue.Queue(max_connections)
self.max_connections = max_connections

def get_connection(self, addr):
try:
return self.pool.get_nowait()
except queue.Empty:
return UnityPoco(addr)

def return_connection(self, conn):
try:
self.pool.put_nowait(conn)
except queue.Full:
pass # ä¸¢å¼ƒå¤šä½™è¿æ¥
</code></pre>
<p>â€œâ€œâ€œæ‰¹é‡è·å–å¤šä¸ªå…ƒç´ ï¼Œå‡å°‘ RPC è°ƒç”¨â€â€œâ€ elements = {} for name,
selector in selectors.items(): try: elements[name] = poco(selector)
except: elements[name] = None return elements</p>
<h1 id="useexample">UseExample</h1>
<p>ui_elements = batch_get_elements(poco, { â€˜start_btnâ€™: â€˜StartButtonâ€™,
â€˜settings_btnâ€™: â€˜SettingsButtonâ€™, â€˜exit_btnâ€™: â€˜ExitButtonâ€™ })</p>
<pre><code>
def retry_on_failure(max_retries=3, delay=1):
def decorator(func):
@wraps(func)
def wrapper(*args, **kwargs):
for attempt in range(max_retries):
try:
return func(*args, **kwargs)
except Exception as e:
if attempt == max_retries - 1:
raise e
print(f&quot;Attempt {attempt + 1} failed: {e}&quot;)
time.sleep(delay)
return None
return wrapper
return decorator

@retry_on_failure(max_retries=3, delay=2)
def stable_click(poco, selector):
&quot;&quot;&quot;ç¨³å®šçš„ç‚¹å‡»æ“ä½œï¼Œå¸¦é‡è¯•æœºåˆ¶&quot;&quot;&quot;
element = poco(selector)
if element.exists():
element.click()
return True
else:
raise Exception(f&quot;Element {selector} not found&quot;)
</code></pre>
<h1 id="è®¾ç½®-poco-æ—¥å¿—">è®¾ç½® Poco æ—¥å¿—</h1>
<p>setup_logger(level=logging.DEBUG)</p>
<h1 id="è‡ªå®šä¹‰æ“ä½œæ—¥å¿—">è‡ªå®šä¹‰æ“ä½œæ—¥å¿—</h1>
<p>class PocoLogger: <span class="citation"
data-cites="staticmethod">@staticmethod</span> def log_action(action,
element, result=None): timestamp = time.strftime(â€œ%Y-%m-%d %H:%M:%Sâ€)
print(fâ€[{timestamp}] {action} on {element}, result: {result}â€œ)</p>
<p><span class="citation" data-cites="staticmethod">@staticmethod</span>
def log_screenshot(path): print(fâ€Screenshot saved: {path}â€œ)</p>
<h1 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h1>
<p>def logged_click(poco, selector): try: poco(selector).click()
PocoLogger.log_action(â€œCLICKâ€, selector, â€œSUCCESSâ€) except Exception as
e: PocoLogger.log_action(â€œCLICKâ€, selector, fâ€FAILED: {e}â€œ) #
ä¿å­˜é”™è¯¯æ—¶çš„æˆªå›¾ screenshot_path = fâ€error_{int(time.time())}.pngâ€
poco.snapshot(screenshot_path)
PocoLogger.log_screenshot(screenshot_path) raise</p>
<pre><code>def __init__(self, device_id, poco_port=5001):
self.device_id = device_id
self.poco_port = poco_port
self.poco = None

def connect(self):
&quot;&quot;&quot;è¿æ¥åˆ°è®¾å¤‡ä¸Šçš„ Poco æœåŠ¡&quot;&quot;&quot;
device_ip = self.get_device_ip(self.device_id)
self.poco = UnityPoco((device_ip, self.poco_port))
return self.poco is not None

def execute_task(self, task_config):
&quot;&quot;&quot;æ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡&quot;&quot;&quot;
try:
# è§£æä»»åŠ¡é…ç½®
actions = task_config[&#39;actions&#39;]

for action in actions:
self.execute_action(action)

return {&quot;status&quot;: &quot;success&quot;, &quot;device_id&quot;: self.device_id}

except Exception as e:
return {&quot;status&quot;: &quot;failed&quot;, &quot;error&quot;: str(e), &quot;device_id&quot;: self.device_id}

def execute_action(self, action):
&quot;&quot;&quot;æ‰§è¡Œå•ä¸ªæ“ä½œ&quot;&quot;&quot;
action_type = action[&#39;type&#39;]

if action_type == &#39;click&#39;:
self.poco(action[&#39;selector&#39;]).click()
elif action_type == &#39;input&#39;:
self.poco(action[&#39;selector&#39;]).set_text(action[&#39;text&#39;])
elif action_type == &#39;wait&#39;:
time.sleep(action[&#39;duration&#39;])
# ... å…¶ä»–æ“ä½œç±»å‹
</code></pre>
<ol start="4" type="1">
<li><strong>å¼‚æ­¥æ“ä½œ</strong>: å¯¹äºè€—æ—¶æ“ä½œä½¿ç”¨å¼‚æ­¥æ¨¡å¼æé«˜æ•ˆç‡</li>
<li><strong>é”™è¯¯å¤„ç†</strong>: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ¢å¤æœºåˆ¶</li>
<li><strong>æ€§èƒ½ç›‘æ§</strong>: ç›‘æ§RPCè°ƒç”¨å»¶è¿Ÿå’ŒæˆåŠŸç‡</li>
</ol>
<h4 id="ä¸å…¶ä»–è‡ªåŠ¨åŒ–æ¡†æ¶å¯¹æ¯”">ä¸å…¶ä»–è‡ªåŠ¨åŒ–æ¡†æ¶å¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">Poco</th>
<th style="text-align: left;">Appium</th>
<th style="text-align: left;">UIAutomator2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>æ¸¸æˆæ”¯æŒ</strong></td>
<td style="text-align: left;">âœ… ä¼˜ç§€</td>
<td style="text-align: left;">âŒ ä¸æ”¯æŒ</td>
<td style="text-align: left;">âŒ ä¸æ”¯æŒ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>è·¨å¼•æ“</strong></td>
<td style="text-align: left;">âœ… Unity/Cocos/UE4</td>
<td style="text-align: left;">âŒ ä»…åŸç”Ÿ</td>
<td style="text-align: left;">âŒ ä»…AndroidåŸç”Ÿ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>é›†æˆå¤æ‚åº¦</strong></td>
<td style="text-align: left;">ä¸­ç­‰(éœ€SDK)</td>
<td style="text-align: left;">ä½(æ— éœ€ä¿®æ”¹)</td>
<td style="text-align: left;">ä½(æ— éœ€ä¿®æ”¹)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ‰§è¡Œé€Ÿåº¦</strong></td>
<td style="text-align: left;">å¿«</td>
<td style="text-align: left;">ä¸­ç­‰</td>
<td style="text-align: left;">å¿«</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç¨³å®šæ€§</strong></td>
<td style="text-align: left;">é«˜</td>
<td style="text-align: left;">ä¸­ç­‰</td>
<td style="text-align: left;">é«˜</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å­¦ä¹ æˆæœ¬</strong></td>
<td style="text-align: left;">ä¸­ç­‰</td>
<td style="text-align: left;">é«˜</td>
<td style="text-align: left;">ä½</td>
</tr>
</tbody>
</table>
<p>Pocoç‰¹åˆ«é€‚åˆæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ã€æ¸¸æˆAIè®­ç»ƒã€æ¸¸æˆå†…å®¹éªŒè¯ç­‰åœºæ™¯ï¼Œæ˜¯ç§»åŠ¨æ¸¸æˆè‡ªåŠ¨åŒ–çš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<h3 id="b-è„šæœ¬ç¼–å†™çš„æœ€ä½³å®è·µ">b) è„šæœ¬ç¼–å†™çš„æœ€ä½³å®è·µ</h3>
<ul>
<li><p><strong>åˆ†ç¦» UI å…ƒç´ ä¸ä¸šåŠ¡é€»è¾‘ (Page Object Model)</strong>:
ä¸è¦å°† UI å…ƒç´ çš„å®šä½ç¬¦ï¼ˆå¦‚
<code>resource-id</code>ï¼‰ç¡¬ç¼–ç åœ¨ä¸šåŠ¡ä»£ç ä¸­ã€‚åº”è¯¥ä¸ºæ¯ä¸ªé¡µé¢åˆ›å»ºä¸€ä¸ªç±»ï¼ˆPage
Objectï¼‰ï¼Œå°è£…è¯¥é¡µé¢çš„æ‰€æœ‰å…ƒç´ å’Œæ“ä½œã€‚å½“ UI å˜åŒ–æ—¶ï¼Œä½ åªéœ€è¦ä¿®æ”¹å¯¹åº”çš„
Page Objectï¼Œè€Œæ— éœ€æ”¹åŠ¨ä¸šåŠ¡æµç¨‹ä»£ç ã€‚</p></li>
<li><p><strong>æ˜ç¡®çš„æ–­è¨€</strong>:
æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½åº”è¯¥æœ‰æ˜ç¡®çš„æˆåŠŸæˆ–å¤±è´¥çš„åˆ¤æ–­æ ‡å‡†ï¼ˆæ–­è¨€ï¼‰ã€‚ä¾‹å¦‚ï¼Œç‚¹å‡»ç™»å½•åï¼Œæ–­è¨€â€ç”¨æˆ·åâ€å…ƒç´ æ˜¯å¦å‡ºç°åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ã€‚</p></li>
<li><p><strong>å¼‚å¸¸å¤„ç†ä¸é‡è¯•</strong>:
ç½‘ç»œå»¶è¿Ÿã€ç³»ç»Ÿå¼¹çª—ç­‰éƒ½å¯èƒ½å¯¼è‡´è‡ªåŠ¨åŒ–å¤±è´¥ã€‚åœ¨å…³é”®æ­¥éª¤åŠ å…¥åˆç†çš„ç­‰å¾…ã€å¼‚å¸¸æ•è·å’Œé‡è¯•æœºåˆ¶ï¼Œå¯ä»¥å¤§å¤§æé«˜è„šæœ¬çš„ç¨³å®šæ€§ã€‚</p></li>
<li><p><strong>æ—¥å¿—ä¸æŠ¥å‘Š</strong>:
åœ¨è„šæœ¬çš„å…³é”®èŠ‚ç‚¹è¾“å‡ºæœ‰æ„ä¹‰çš„æ—¥å¿—ã€‚æµ‹è¯•ç»“æŸåï¼Œç”Ÿæˆå›¾æ–‡å¹¶èŒ‚çš„æµ‹è¯•æŠ¥å‘Šï¼ˆå¦‚
Allure Reportï¼‰ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½é—®é¢˜ã€‚ ___ ## 2. ç¾¤æ§ç³»ç»Ÿ (Device
Farming)</p></li>
</ul>
<p>ç¾¤æ§ç³»ç»Ÿæ˜¯ä¸€ä¸ªå°†å¤§é‡ç‰©ç†è®¾å¤‡æˆ–è™šæ‹Ÿè®¾å¤‡ï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰æ±‡é›†æˆä¸€ä¸ªç»Ÿä¸€çš„ã€å¯ç¼–ç¨‹çš„èµ„æºæ± ï¼Œå¹¶å¯¹å…¶è¿›è¡Œé›†ä¸­åŒ–ç®¡ç†ã€è°ƒåº¦å’Œç›‘æ§çš„å¹³å°ã€‚</p>
<h3 id="a-æ ¸å¿ƒæ¶æ„">a) æ ¸å¿ƒæ¶æ„</h3>
<p>ä¸€ä¸ªå·¥ä¸šçº§çš„ç¾¤æ§ç³»ç»Ÿé€šå¸¸æ˜¯å¾®æœåŠ¡æ¶æ„ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ol type="1">
<li><strong>API ç½‘å…³ (API Gateway)</strong>:</li>
</ol>
<ul>
<li>ä½œä¸ºæ‰€æœ‰æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±ã€èº«ä»½è®¤è¯å’Œé€Ÿç‡é™åˆ¶ã€‚</li>
</ul>
<ol start="2" type="1">
<li><strong>è®¾å¤‡ç®¡ç†æœåŠ¡ (Device Management Service)</strong>:</li>
</ol>
<ul>
<li><p>ç»´æŠ¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰è®¾å¤‡ï¼ˆçœŸæœº/æ¨¡æ‹Ÿå™¨ï¼‰ä¿¡æ¯çš„æ•°æ®åº“ã€‚</p></li>
<li><p>é€šè¿‡å¿ƒè·³æœºåˆ¶å®æ—¶ç›‘æ§æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€ï¼ˆç©ºé—²ã€å ç”¨ã€ç¦»çº¿ã€å¥åº·çŠ¶å†µï¼‰ã€‚</p></li>
<li><p>å¤„ç†è®¾å¤‡çš„æ¥å…¥å’Œæ³¨é”€ã€‚</p></li>
</ul>
<ol start="3" type="1">
<li><strong>ä»»åŠ¡è°ƒåº¦æœåŠ¡ (Task Scheduling Service)</strong>:</li>
</ol>
<ul>
<li><p>æ¥æ”¶ç”¨æˆ·æäº¤çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œâ€œåœ¨ Android 12 ä¸Šå¯¹ App X æ‰§è¡Œ Y
æµ‹è¯•â€ï¼‰ã€‚</p></li>
<li><p>æ ¹æ®ä»»åŠ¡è¦æ±‚ï¼ˆè®¾å¤‡ç±»å‹ã€ç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰å’Œé¢„è®¾çš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚ä¼˜å…ˆçº§ã€FIFOï¼‰ä»è®¾å¤‡ç®¡ç†æœåŠ¡ä¸­æŸ¥è¯¢å¹¶é”å®šä¸€ä¸ªåˆé€‚çš„è®¾å¤‡ã€‚</p></li>
</ul>
<ol start="4" type="1">
<li><strong>æ‰§è¡Œä»£ç† (Agent)</strong>:</li>
</ol>
<ul>
<li><p>åœ¨æ¯ä¸ªç‰©ç†è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œçš„ä¸€ä¸ªè½»é‡çº§ä»£ç†ç¨‹åºã€‚</p></li>
<li><p>è´Ÿè´£æ¥æ”¶å¹¶æ‰§è¡Œæ¥è‡ªè°ƒåº¦ä¸­å¿ƒçš„å…·ä½“æŒ‡ä»¤ï¼Œå¦‚ï¼šå®‰è£…/å¸è½½
APKã€å¯åŠ¨/åœæ­¢ Appiumã€æ‰§è¡Œ shell å‘½ä»¤ã€ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶ç­‰ã€‚</p></li>
</ul>
<ol start="5" type="1">
<li><strong>ç»“æœæ”¶é›†ä¸æŠ¥å‘ŠæœåŠ¡</strong>:</li>
</ol>
<ul>
<li><p>æ¥æ”¶æ¥è‡ª Agent çš„å®æ—¶æ—¥å¿—ã€æˆªå›¾ã€å½•å±å’Œæµ‹è¯•ç»“æœã€‚</p></li>
<li><p>å°†ç»“æœå­˜å…¥æ•°æ®åº“ï¼Œå¹¶åœ¨ä»»åŠ¡ç»“æŸåç”Ÿæˆæœ€ç»ˆçš„æµ‹è¯•æŠ¥å‘Šã€‚</p></li>
</ul>
<ol start="6" type="1">
<li><strong>Web ç®¡ç†å‰ç«¯</strong>:</li>
</ol>
<ul>
<li>æä¾›ä¸€ä¸ªå¯è§†åŒ–çš„ç•Œé¢ï¼Œè®©ç”¨æˆ·å¯ä»¥å®æ—¶æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ï¼ˆå¦‚
STFï¼‰ã€æäº¤ä»»åŠ¡ã€æŸ¥çœ‹ä»»åŠ¡é˜Ÿåˆ—å’Œå†å²æŠ¥å‘Šã€‚</li>
</ul>
<h3 id="b-å¼€æºæ–¹æ¡ˆä¸è‡ªç ”">b) å¼€æºæ–¹æ¡ˆä¸è‡ªç ”</h3>
<ul>
<li><p><strong>STF (Smartphone Test Farm)</strong>:
æä¾›äº†ä¼˜ç§€çš„è®¾å¤‡ç®¡ç†å’Œè¿œç¨‹æ§åˆ¶åŠŸèƒ½ï¼Œæ˜¯è®¸å¤šè‡ªç ”ç¾¤æ§ç³»ç»Ÿçš„åŸºç¡€ã€‚ä½†å®ƒæœ¬èº«ä¸åŒ…å«ä»»åŠ¡è°ƒåº¦å’ŒæŠ¥å‘Šç­‰åŠŸèƒ½ã€‚</p></li>
<li><p><strong>è‡ªç ”</strong>: è®¸å¤šå¤§å‹å…¬å¸ä¼šåŸºäº
STFã€Appiumã€Dockerã€Kubernetes
ç­‰å¼€æºæŠ€æœ¯æ ˆï¼Œç»“åˆè‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ­å»ºè‡ªç ”çš„ç¾¤æ§å¹³å°ï¼Œä»¥å®ç°æ›´çµæ´»çš„è°ƒåº¦é€»è¾‘å’Œæ›´æ·±å…¥çš„ä¸šåŠ¡é›†æˆã€‚
___ ## æ€»ç»“</p></li>
</ul>
<p>è‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿæ˜¯ç§»åŠ¨ç«¯å·¥ç¨‹åŒ–èƒ½åŠ›çš„é›†ä¸­ä½“ç°ã€‚å®ƒå°†åº•å±‚çš„è®¾å¤‡èµ„æºã€ä¸­å±‚çš„æ‰§è¡Œè„šæœ¬å’Œä¸Šå±‚çš„ä¸šåŠ¡éœ€æ±‚æœ‰æœºåœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªå¼ºå¤§çš„ã€å¯æ‰©å±•çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ç°ä»£
App å¼€å‘ã€æµ‹è¯•å’Œå®‰å…¨åˆ†æä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚</p>
<!-- 01-Recipes/Automation/dial_up_proxy_pools.md -->
<h1 id="é€†å‘æŠ€æœ¯åŠ¨æ€ä½å®…-ip-ä»£ç†æ± ">é€†å‘æŠ€æœ¯ï¼šåŠ¨æ€ä½å®… IP ä»£ç†æ± </h1>
<p>åœ¨é«˜å¼ºåº¦çš„çˆ¬è™«å’Œé€†å‘åˆ†æåœºæ™¯ä¸­ï¼Œè¯·æ±‚çš„ IP
åœ°å€æ˜¯è¯†åˆ«å’Œå°ç¦çˆ¬è™«æµé‡çš„ç¬¬ä¸€é“å…³å¡ã€‚ç›¸æ¯”äºæ˜“äºè¢«è¯†åˆ«å’Œå±è”½çš„æ•°æ®ä¸­å¿ƒ
IPï¼ŒåŠ¨æ€å˜åŒ–çš„ä½å®… IP
åœ°å€å…·æœ‰æé«˜çš„ä¼ªè£…åº¦ï¼Œæ˜¯ç»•è¿‡åçˆ¬è™«ç­–ç•¥çš„å…³é”®æŠ€æœ¯ã€‚æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»åŠ¨æ€ä½å®…
IPï¼ˆæ‹¨å·ä»£ç†ï¼‰çš„åŸç†åŠå…¶ä»£ç†æ± çš„æ­å»ºæ–¹æ³•ã€‚</p>
<hr />
<h2 id="åŠ¨æ€ä½å®…-ip-æ‹¨å·ä»£ç†-åŸç†">1. åŠ¨æ€ä½å®… IP (æ‹¨å·ä»£ç†) åŸç†</h2>
<h3 id="a-ä»€ä¹ˆæ˜¯åŠ¨æ€ä½å®…-ip">a) ä»€ä¹ˆæ˜¯åŠ¨æ€ä½å®… IPï¼Ÿ</h3>
<ul>
<li><p><strong>ä½å®… IP</strong>:
æŒ‡ç”±äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼ˆISPï¼‰ï¼Œå¦‚ç”µä¿¡ã€è”é€šã€ç§»åŠ¨ï¼Œåˆ†é…ç»™æ™®é€šå®¶åº­ç”¨æˆ·çš„ IP
åœ°å€ã€‚è¿™äº› IP åœ°å€å±äºçœŸå®çš„ä½å®…ç½‘ç»œï¼Œä¿¡èª‰åº¦æœ€é«˜ã€‚</p></li>
<li><p><strong>åŠ¨æ€ IP</strong>: ä¸æ•°æ®ä¸­å¿ƒå›ºå®šçš„é™æ€ IP
ä¸åŒï¼Œä½å®…å®½å¸¦é€šå¸¸ä½¿ç”¨ <strong>PPPoE (Point-to-Point Protocol over
Ethernet)</strong>
åè®®è¿›è¡Œæ‹¨å·ä¸Šç½‘ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š<strong>æ¯æ–­å¼€ä¸€æ¬¡è¿æ¥å†é‡æ–°æ‹¨å·ï¼ŒISP
çš„BRASï¼ˆå®½å¸¦è¿œç¨‹æ¥å…¥æœåŠ¡å™¨ï¼‰å°±ä¼šä»å…¶åœ°å€æ± ä¸­é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„ IP
åœ°å€ç»™ç”¨æˆ·</strong>ã€‚</p></li>
</ul>
<p>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºè‡ªåŠ¨åŒ–åœ°æ§åˆ¶ ADSL (æˆ–å…‰çŒ«)
è¿›è¡Œâ€æ–­çº¿é‡æ‹¨â€ï¼Œä»è€Œåœ¨æçŸ­çš„æ—¶é—´å†…è·å–ä¸€ä¸ªå…¨æ–°çš„ã€å¹²å‡€çš„ã€çœŸå®çš„ä½å®…
IPã€‚è¿™å°±æ˜¯æ‹¨å·ä»£ç†çš„æ ¸å¿ƒåŸç†ã€‚</p>
<h3 id="b-ä¼˜åŠ¿">b) ä¼˜åŠ¿</h3>
<ul>
<li><p><strong>æé«˜çš„çœŸå®æ€§</strong>: IP æ¥è‡ªçœŸå®çš„ ISP
ä½å®…ç½‘ç»œï¼Œæ— æ³•è¢«ç›®æ ‡æœåŠ¡å™¨é€šè¿‡ IP åº“è¯†åˆ«ä¸ºæ•°æ®ä¸­å¿ƒæµé‡ã€‚</p></li>
<li><p><strong>æµ·é‡ IP èµ„æº</strong>: ä¸€ä¸ªåœ°åŒºçº§çš„ ISP
è¿è¥å•†é€šå¸¸æ‹¥æœ‰æ•°ä¸‡åˆ°æ•°ç™¾ä¸‡çš„ IP
åœ°å€æ± ã€‚ç†è®ºä¸Šï¼Œé€šè¿‡ä¸æ–­é‡æ‹¨ï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¥åœ°åŒºçš„æ‰€æœ‰ IPã€‚</p></li>
<li><p><strong>æˆæœ¬å¯æ§</strong>:
ç›¸æ¯”äºæŒ‰æµé‡è®¡è´¹çš„å•†ä¸šä½å®…ä»£ç†æœåŠ¡ï¼Œè‡ªå»ºæ‹¨å·ä»£ç†æ± ï¼ˆå°¤å…¶æ˜¯åœ¨æ‹¥æœ‰ç‰©ç†è®¾å¤‡çš„æƒ…å†µä¸‹ï¼‰çš„é•¿æœŸæˆæœ¬æ›´ä½ã€‚</p></li>
</ul>
<hr />
<h2 id="æ­å»ºæ‹¨å·ä»£ç†æ± ">2. æ­å»ºæ‹¨å·ä»£ç†æ± </h2>
<p>æ­å»ºä¸€ä¸ªç¨³å®šé«˜æ•ˆçš„æ‹¨å·ä»£ç†æ± ï¼Œéœ€è¦å°†ç‰©ç†å±‚çš„æ‹¨å·è®¾å¤‡ã€ç½‘ç»œå±‚çš„ä»£ç†æœåŠ¡å’Œç®¡ç†å±‚çš„è°ƒåº¦ç³»ç»Ÿç»“åˆèµ·æ¥ã€‚</p>
<h3 id="a-ç¡¬ä»¶ä¸ç‰©ç†å±‚">a) ç¡¬ä»¶ä¸ç‰©ç†å±‚</h3>
<ol type="1">
<li><strong>ADSL/å…‰çŒ« + è·¯ç”±å™¨</strong>:
è¿™æ˜¯æœ€åŸºç¡€çš„å•å…ƒã€‚ä½ éœ€è¦ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰åŠç†äº†å®½å¸¦ä¸šåŠ¡çš„ ADSL
çŒ«æˆ–å…‰çŒ«ï¼Œå¹¶è¿æ¥åˆ°ä¸€ä¸ªå¯ä»¥è¢«ç¨‹åºæ§åˆ¶çš„è·¯ç”±å™¨ã€‚</li>
<li><strong>æ ‘è“æ´¾/å°å‹ PC</strong>:
åœ¨æ¯ä¸ªæ‹¨å·è®¾å¤‡æ—è¾¹ï¼Œæ”¾ç½®ä¸€ä¸ªç±»ä¼¼æ ‘è“æ´¾çš„å»‰ä»·å°å‹ä¸»æœºï¼Œç”¨äºæ‰§è¡Œæ‹¨å·å’Œä»£ç†æœåŠ¡çš„æŒ‡ä»¤ã€‚</li>
<li><strong>4G/5G æ¨¡å— (å¯é€‰)</strong>: é™¤äº†å›ºå®šå®½å¸¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ 4G/5G
å·¥ä¸šæ¨¡å—ã€‚é€šè¿‡æ§åˆ¶æ¨¡å—çš„é£è¡Œæ¨¡å¼åˆ‡æ¢æˆ–é‡ç½®ï¼ŒåŒæ ·å¯ä»¥å®ç° IP
çš„æ›´æ¢ã€‚è¿™ç§æ–¹å¼çµæ´»æ€§æ›´é«˜ï¼Œä½†æµé‡æˆæœ¬ä¹Ÿæ›´é«˜ã€‚</li>
</ol>
<h3 id="b-è½¯ä»¶ä¸ç½‘ç»œå±‚">b) è½¯ä»¶ä¸ç½‘ç»œå±‚</h3>
<ol type="1">
<li><strong>æ‹¨å·è„šæœ¬</strong>:
åœ¨æ ‘è“æ´¾ä¸Šè¿è¡Œä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºæ§åˆ¶è·¯ç”±å™¨æ‰§è¡Œ PPPoE
çš„æ–­å¼€å’Œé‡è¿æ“ä½œã€‚è¿™é€šå¸¸å¯ä»¥é€šè¿‡ <code>curl</code> æˆ– <code>ssh</code>
è°ƒç”¨è·¯ç”±å™¨çš„ç®¡ç†æ¥å£æ¥å®ç°ã€‚</li>
</ol>
<ul>
<li><strong>ç¤ºä¾‹ (æ§åˆ¶ OpenWrt/LEDE è·¯ç”±å™¨çš„è„šæœ¬)</strong>: ```bash #
æ–­å¼€ PPPoE è¿æ¥ ssh root@192.168.1.1 â€˜ifdown wanâ€™</li>
</ul>
<h1 id="é‡æ–°è¿æ¥">é‡æ–°è¿æ¥</h1>
<p>ssh root@192.168.1.1 â€˜ifup wanâ€™</p>
<h1 id="è·å–æ–°-ip">è·å–æ–° IP</h1>
<p>ssh root@192.168.1.1 â€˜ifconfig pppoe-wan | grep â€œinet addrâ€ | cut -d:
-f2 | cut -dâ€ â€ -f1â€™</p>
<pre><code>
* **Squid é…ç½®ç¤ºä¾‹ (`squid.conf`)**:
    ```

# å…è®¸æ‰€æœ‰æ¥æºçš„æ‰€æœ‰è¯·æ±‚
http_access allow all

# ç›‘å¬ç«¯å£
http_port 3128

# ç¦æ­¢æ³„éœ²åŸå§‹ IP
forwarded_for off
request_header_access Via deny all
request_header_access X-Forwarded-For deny all
</code></pre>
<p>å½“ä½ æœ‰å¤§é‡çš„æ‹¨å·èŠ‚ç‚¹æ—¶ï¼Œä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç®¡ç†ç³»ç»Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<ol type="1">
<li><strong>ä¸­å¿ƒ API æœåŠ¡å™¨</strong>:</li>
</ol>
<ul>
<li><p><strong>IP æ³¨å†Œ</strong>: æ¯ä¸ªæ‹¨å·èŠ‚ç‚¹åœ¨æˆåŠŸè·å–æ–° IP åï¼Œå°†
<code>(æ–°IP:ç«¯å£, åœ°ç†ä½ç½®, ISP)</code>
ç­‰ä¿¡æ¯ä¸ŠæŠ¥ç»™ä¸­å¿ƒæœåŠ¡å™¨ã€‚</p></li>
<li><p><strong>IP è·å–</strong>: ä¸šåŠ¡ç¨‹åºï¼ˆå¦‚çˆ¬è™«ï¼‰é€šè¿‡è°ƒç”¨
APIï¼Œä»ä¸­å¿ƒæœåŠ¡å™¨è·å–ä¸€ä¸ªå½“å‰å¯ç”¨çš„ä»£ç†
IPã€‚å¯ä»¥æ ¹æ®éœ€æ±‚æŒ‡å®šåœ°ç†ä½ç½®ç­‰æ¡ä»¶ã€‚</p></li>
<li><p><strong>IP ç»­æœŸä¸å¿ƒè·³</strong>:
æ‹¨å·èŠ‚ç‚¹éœ€è¦å®šæœŸå‘ä¸­å¿ƒæœåŠ¡å™¨å‘é€å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±ä»ç„¶åœ¨çº¿ã€‚å¦‚æœå¿ƒè·³è¶…æ—¶ï¼ŒæœåŠ¡å™¨å°±å°†è¯¥
IP ä»å¯ç”¨æ± ä¸­ç§»é™¤ã€‚</p></li>
<li><p><strong>IP æ³¨å†Œ</strong>: æ¯ä¸ªæ‹¨å·èŠ‚ç‚¹åœ¨æˆåŠŸè·å–æ–° IP åï¼Œå°†
<code>(æ–°IP:ç«¯å£, åœ°ç†ä½ç½®, ISP)</code>
ç­‰ä¿¡æ¯ä¸ŠæŠ¥ç»™ä¸­å¿ƒæœåŠ¡å™¨ã€‚</p></li>
<li><p><strong>IP è·å–</strong>: ä¸šåŠ¡ç¨‹åºï¼ˆå¦‚çˆ¬è™«ï¼‰é€šè¿‡è°ƒç”¨
APIï¼Œä»ä¸­å¿ƒæœåŠ¡å™¨è·å–ä¸€ä¸ªå½“å‰å¯ç”¨çš„ä»£ç†
IPã€‚å¯ä»¥æ ¹æ®éœ€æ±‚æŒ‡å®šåœ°ç†ä½ç½®ç­‰æ¡ä»¶ã€‚</p></li>
<li><p><strong>IP ç»­æœŸä¸å¿ƒè·³</strong>:
æ‹¨å·èŠ‚ç‚¹éœ€è¦å®šæœŸå‘ä¸­å¿ƒæœåŠ¡å™¨å‘é€å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±ä»ç„¶åœ¨çº¿ã€‚å¦‚æœå¿ƒè·³è¶…æ—¶ï¼ŒæœåŠ¡å™¨å°±å°†è¯¥
IP ä»å¯ç”¨æ± ä¸­ç§»é™¤ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>IP æ± ç®¡ç†ç­–ç•¥</strong>:</li>
</ol>
<ul>
<li><p><strong>å¯ç”¨æ€§æ£€æµ‹</strong>:
ä¸­å¿ƒæœåŠ¡å™¨å®šæœŸä¸»åŠ¨æ£€æµ‹æ± ä¸­ä»£ç†çš„è¿é€šæ€§ï¼Œå‰”é™¤å¤±æ•ˆçš„ IPã€‚</p></li>
<li><p><strong>IP è½®æ¢</strong>: å½“ä¸€ä¸ª IP
è¢«å°ç¦æˆ–ä½¿ç”¨æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œä¸šåŠ¡ç¨‹åºå¯ä»¥è°ƒç”¨ API
è¯·æ±‚ä¸­å¿ƒæœåŠ¡å™¨é€šçŸ¥å¯¹åº”çš„æ‹¨å·èŠ‚ç‚¹æ‰§è¡Œâ€æ¢IPâ€æ“ä½œã€‚</p></li>
<li><p><strong>å¹¶å‘æ§åˆ¶</strong>: ç®¡ç†æ¯ä¸ªä»£ç† IP
å½“å‰çš„å¹¶å‘è¯·æ±‚æ•°ï¼Œé¿å…å› è¿‡åº¦ä½¿ç”¨è€Œè¢«å°ç¦ã€‚</p></li>
<li><p><strong>å¯ç”¨æ€§æ£€æµ‹</strong>:
ä¸­å¿ƒæœåŠ¡å™¨å®šæœŸä¸»åŠ¨æ£€æµ‹æ± ä¸­ä»£ç†çš„è¿é€šæ€§ï¼Œå‰”é™¤å¤±æ•ˆçš„ IPã€‚</p></li>
<li><p><strong>IP è½®æ¢</strong>: å½“ä¸€ä¸ª IP
è¢«å°ç¦æˆ–ä½¿ç”¨æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œä¸šåŠ¡ç¨‹åºå¯ä»¥è°ƒç”¨ API
è¯·æ±‚ä¸­å¿ƒæœåŠ¡å™¨é€šçŸ¥å¯¹åº”çš„æ‹¨å·èŠ‚ç‚¹æ‰§è¡Œâ€æ¢IPâ€æ“ä½œã€‚</p></li>
<li><p><strong>å¹¶å‘æ§åˆ¶</strong>: ç®¡ç†æ¯ä¸ªä»£ç† IP
å½“å‰çš„å¹¶å‘è¯·æ±‚æ•°ï¼Œé¿å…å› è¿‡åº¦ä½¿ç”¨è€Œè¢«å°ç¦ã€‚</p></li>
</ul>
<h3 id="d-æ•´ä½“æ¶æ„å›¾">d) æ•´ä½“æ¶æ„å›¾</h3>
<pre class="mermaid"><code>graph TD
subgraph &quot;ä¸šåŠ¡æœåŠ¡å™¨&quot;
A[çˆ¬è™«/ä¸šåŠ¡åº”ç”¨] --&gt; B{ä¸­å¿ƒ API Server};
end

B -- è·å–ä»£ç† --&gt; A;
B -- ç®¡ç†/è°ƒåº¦ --&gt; C1;
B -- ç®¡ç†/è°ƒåº¦ --&gt; C2;
B -- ç®¡ç†/è°ƒåº¦ --&gt; C3;

subgraph &quot;æ‹¨å·èŠ‚ç‚¹ 1 (ä¸Šæµ·ç”µä¿¡)&quot;
C1[æ ‘è“æ´¾] --&gt; D1[ä»£ç†æœåŠ¡ (Squid)];
C1 -- æ§åˆ¶é‡æ‹¨ --&gt; E1[è·¯ç”±å™¨/å…‰çŒ«];
E1 -- PPPoE --&gt; F1[(ISP ç½‘ç»œ)];
end

subgraph &quot;æ‹¨å·èŠ‚ç‚¹ 2 (åŒ—äº¬è”é€š)&quot;
C2[æ ‘è“æ´¾] --&gt; D2[ä»£ç†æœåŠ¡ (Squid)];
C2 -- æ§åˆ¶é‡æ‹¨ --&gt; E2[è·¯ç”±å™¨/å…‰çŒ«];
E2 -- PPPoE --&gt; F2[(ISP ç½‘ç»œ)];
end

subgraph &quot;æ‹¨å·èŠ‚ç‚¹ N (æ·±åœ³ç§»åŠ¨)&quot;
C3[æ ‘è“æ´¾] --&gt; D3[ä»£ç†æœåŠ¡ (Squid)];
C3 -- æ§åˆ¶é‡æ‹¨ --&gt; E3[è·¯ç”±å™¨/å…‰çŒ«];
E3 -- PPPoE --&gt; F3[(ISP ç½‘ç»œ)];
end

C1 -- ä¸ŠæŠ¥ IP --&gt; B;
C2 -- ä¸ŠæŠ¥ IP --&gt; B;
C3 -- ä¸ŠæŠ¥ IP --&gt; B;
</code></pre>
<!-- 01-Recipes/Automation/docker_deployment.md -->
<h1 id="å®¹å™¨åŒ–éƒ¨ç½²docker-ä¸-kubernetes-å®æˆ˜">å®¹å™¨åŒ–éƒ¨ç½²ï¼šDocker ä¸
Kubernetes å®æˆ˜</h1>
<p>å°†çˆ¬è™«é¡¹ç›®å®¹å™¨åŒ–æ˜¯å®ç°æ ‡å‡†åŒ–éƒ¨ç½²ã€å¼¹æ€§ä¼¸ç¼©å’Œ CI/CD
çš„ç¬¬ä¸€æ­¥ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ç¼–å†™ Dockerfileï¼Œä½¿ç”¨ Docker Compose
ç¼–æ’æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•åœ¨ Kubernetes (K8s) ä¸Šè¿è¡Œçˆ¬è™«ä»»åŠ¡ã€‚</p>
<h2 id="dockerfile-æœ€ä½³å®è·µ">1. Dockerfile æœ€ä½³å®è·µ</h2>
<p>æˆ‘ä»¬éœ€è¦ä¸º Scrapy é¡¹ç›®æ„å»ºä¸€ä¸ªè½»é‡ã€ç¨³å®šçš„ Docker é•œåƒã€‚</p>
<h3 id="ç›®å½•ç»“æ„">ç›®å½•ç»“æ„</h3>
<pre class="text"><code>my_crawler/
â”œâ”€â”€ scrapy.cfg
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â””â”€â”€ myproject/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ items.py
â”œâ”€â”€ settings.py
â””â”€â”€ spiders/
</code></pre>
<p>FROM python:3.9-slim-buster</p>
<h1 id="è®¾ç½®å·¥ä½œç›®å½•">è®¾ç½®å·¥ä½œç›®å½•</h1>
<p>WORKDIR /app</p>
<h1 id="è®¾ç½®ç¯å¢ƒå˜é‡">è®¾ç½®ç¯å¢ƒå˜é‡</h1>
<h1 id="é˜²æ­¢-python-ç”Ÿæˆ-.pyc-æ–‡ä»¶">é˜²æ­¢ Python ç”Ÿæˆ .pyc æ–‡ä»¶</h1>
<p>ENV PYTHONDONTWRITEBYTECODE 1 # é˜²æ­¢ Python ç¼“å†²åŒº
stdout/stderrï¼Œç¡®ä¿æ—¥å¿—å®æ—¶è¾“å‡º ENV PYTHONUNBUFFERED 1 # è®¾ç½®æ—¶åŒº (å¯é€‰)
ENV TZ=Asia/Shanghai</p>
<h1 id="å®‰è£…ç³»ç»Ÿä¾èµ–-å¦‚æœéœ€è¦ç¼–è¯‘-lxml-æˆ–å…¶å®ƒåº“">å®‰è£…ç³»ç»Ÿä¾èµ–
(å¦‚æœéœ€è¦ç¼–è¯‘ lxml æˆ–å…¶å®ƒåº“)</h1>
<h1
id="run-apt-get-update-apt-get-install--y-gcc-libxml2-dev-libxslt-dev-rm--rf-varlibaptlists">RUN
apt-get update &amp;&amp; apt-get install -y gcc libxml2-dev libxslt-dev
&amp;&amp; rm -rf /var/lib/apt/lists/*</h1>
<h1 id="å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…">å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…</h1>
<p>COPY requirements.txt . RUN pip install â€“no-cache-dir -r
requirements.txt</p>
<h1 id="å¤åˆ¶é¡¹ç›®ä»£ç ">å¤åˆ¶é¡¹ç›®ä»£ç </h1>
<p>COPY . .</p>
<h1 id="é»˜è®¤å¯åŠ¨å‘½ä»¤-å¯è¢«-docker-run-è¦†ç›–">é»˜è®¤å¯åŠ¨å‘½ä»¤ (å¯è¢« docker run
è¦†ç›–)</h1>
<h1
id="è¿™é‡Œæˆ‘ä»¬é»˜è®¤å¯åŠ¨-scrapyd-å¦‚æœä½¿ç”¨-scrapyd-éƒ¨ç½²-æˆ–ä»…ä½œä¸ºä¸€ä¸ª-shell">è¿™é‡Œæˆ‘ä»¬é»˜è®¤å¯åŠ¨
scrapyd (å¦‚æœä½¿ç”¨ scrapyd éƒ¨ç½²) æˆ–ä»…ä½œä¸ºä¸€ä¸ª shell</h1>
<p>CMD [â€œscrapyâ€, â€œlistâ€]</p>
<pre><code>
# è¿è¡Œçˆ¬è™«
docker run --rm my-crawler:v1 scrapy crawl myspider
</code></pre>
<p>version: â€˜3.8â€™</p>
<p>services: # 1. Redis æœåŠ¡ (æ¶ˆæ¯é˜Ÿåˆ—) redis: image: redis:6.2-alpine
ports: - â€œ6379:6379â€ volumes: - redis_data:/data command: redis-server
â€“appendonly yes</p>
<h1 id="mongodb-æœåŠ¡-æ•°æ®å­˜å‚¨">2. MongoDB æœåŠ¡ (æ•°æ®å­˜å‚¨)</h1>
<p>mongo: image: mongo:5.0 ports: - â€œ27017:27017â€ environment:
MONGO_INITDB_ROOT_USERNAME: admin MONGO_INITDB_ROOT_PASSWORD: password
volumes: - mongo_data:/data/db</p>
<h1 id="çˆ¬è™«æœåŠ¡-masterslave-æ¨¡å¼ä¸­çš„-slave">3. çˆ¬è™«æœåŠ¡ (Master/Slave
æ¨¡å¼ä¸­çš„ Slave)</h1>
<p>crawler: build: . image: my-crawler:latest # è¦†ç›–é»˜è®¤å‘½ä»¤ï¼Œå¯åŠ¨çˆ¬è™«
command: scrapy crawl myspider_distributed # ä¾èµ–æœåŠ¡å°±ç»ª depends_on: -
redis - mongo environment: - REDIS_HOST=redis -
MONGO_URI=mongodb://admin:password@mongo:27017 #
æƒ³è¦å¼€å¯å¤šä¸ªçˆ¬è™«èŠ‚ç‚¹ï¼Ÿç›´æ¥ scale deploy: replicas: 3</p>
<p>volumes: redis_data: mongo_data:</p>
<pre><code>
# æ‰©å®¹çˆ¬è™«èŠ‚ç‚¹åˆ° 5
docker-compose up -d --scale crawler=5

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f crawler
</code></pre>
<div class="sourceCode" id="cb235"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> scrapy-worker</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="fu">app</span><span class="kw">:</span><span class="at"> scrapy-worker</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="co"># å‰¯æœ¬æ•°ï¼Œå³å¹¶å‘çˆ¬è™«èŠ‚ç‚¹æ•°é‡</span></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a><span class="fu">app</span><span class="kw">:</span><span class="at"> scrapy-worker</span></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a><span class="fu">app</span><span class="kw">:</span><span class="at"> scrapy-worker</span></span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> crawler</span></span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span><span class="kw">:</span><span class="at"> registry.example.com/my-crawler:v1</span></span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a><span class="co"># å®¹å™¨startupCommand</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;scrapy&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;crawl&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;myspider_distributed&quot;</span><span class="kw">]</span></span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Env VarsConfig</span></span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> REDIS_HOST</span></span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;redis-service&quot;</span><span class="co"> # K8s Service Name</span></span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> MONGO_URI</span></span>
<span id="cb235-28"><a href="#cb235-28" aria-hidden="true" tabindex="-1"></a><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb235-29"><a href="#cb235-29" aria-hidden="true" tabindex="-1"></a><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb235-30"><a href="#cb235-30" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> db-secrets</span></span>
<span id="cb235-31"><a href="#cb235-31" aria-hidden="true" tabindex="-1"></a><span class="fu">key</span><span class="kw">:</span><span class="at"> mongo-uri</span></span>
<span id="cb235-32"><a href="#cb235-32" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb235-33"><a href="#cb235-33" aria-hidden="true" tabindex="-1"></a><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb235-34"><a href="#cb235-34" aria-hidden="true" tabindex="-1"></a><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;256Mi&quot;</span></span>
<span id="cb235-35"><a href="#cb235-35" aria-hidden="true" tabindex="-1"></a><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb235-36"><a href="#cb235-36" aria-hidden="true" tabindex="-1"></a><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb235-37"><a href="#cb235-37" aria-hidden="true" tabindex="-1"></a><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;512Mi&quot;</span></span>
<span id="cb235-38"><a href="#cb235-38" aria-hidden="true" tabindex="-1"></a><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb236"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> batch/v1</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CronJob</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> daily-crawler</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Run daily</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="fu">schedule</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;0 2 * * *&quot;</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a><span class="fu">jobTemplate</span><span class="kw">:</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> crawler</span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span><span class="kw">:</span><span class="at"> registry.example.com/my-crawler:v1</span></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;scrapy&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;crawl&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;daily_spider&quot;</span><span class="kw">]</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> REDIS_HOST</span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;redis-service&quot;</span></span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> OnFailure</span></span></code></pre></div>
<h1 id="appconfig">AppConfig</h1>
<p>kubectl apply -f crawler-deployment.yaml</p>
<h1 id="view-pod-status">View Pod Status</h1>
<p>kubectl get pods</p>
<h1 id="åŠ¨æ€æ‰©ç¼©å®¹-noéœ€modify-yaml">åŠ¨æ€æ‰©ç¼©å®¹ (Noéœ€Modify yaml)</h1>
<p>kubectl scale deployment scrapy-worker â€“replicas=10</p>
<pre><code>* **Gerapy**: åŸºäº Scrapyd çš„åˆ†å¸ƒå¼ç®¡ç† GUIï¼Œæ”¯æŒèŠ‚ç‚¹ç®¡ç†ã€ä»£ç ç¼–è¾‘ã€å®šæ—¶ä»»åŠ¡ã€‚


**Dockerfile (é›†æˆ Scrapyd)**:

```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install scrapyd
COPY scrapyd.conf /etc/scrapyd/
CMD [&quot;scrapyd&quot;]




&lt;!-- 01-Recipes/Automation/proxy_pool_design.md --&gt;

# ä»£ç†æ± è®¾è®¡ä¸ Scrapy é›†æˆ

åœ¨é¢å¯¹åçˆ¬è™«ç­–ç•¥ä¸¥å‰çš„ç›®æ ‡ç«™ï¼ˆå¦‚ç”µå•†ã€ç¤¾äº¤åª’ä½“ï¼‰æ—¶ï¼Œå•ä¸€ IP å¾ˆå®¹æ˜“è¢«å°ç¦ã€‚æ„å»ºä¸€ä¸ªé«˜å¯ç”¨ã€è‡ªåŠ¨è½®è½¬çš„ä»£ç†æ±  (Proxy Pool) æ˜¯å¤§è§„æ¨¡æ•°æ®é‡‡é›†çš„åŸºç¡€è®¾æ–½ã€‚

## 1. ä»£ç†æ± æ¶æ„è®¾è®¡

ä¸€ä¸ªæˆç†Ÿçš„ä»£ç†æ± ç³»ç»Ÿé€šå¸¸åŒ…å«å››ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œé€šè¿‡ Redis è¿›è¡Œè§£è€¦ï¼š

### æ ¸å¿ƒç»„ä»¶

1. **Fetcher (è·å–å™¨)**:

- **èŒè´£**: å®šæ—¶ä»å„å¤§å…è´¹ä»£ç†ç½‘ç«™ï¼ˆå¿«ä»£ç†ã€äº‘ä»£ç†ç­‰ï¼‰æˆ–ä»˜è´¹ API æ¥å£æ‹‰å–ä»£ç† IPã€‚
- **ç­–ç•¥**: æ¯éš” N åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œå°†è·å–åˆ°çš„æ–° IP å­˜å…¥ Redis çš„â€œå¾…æ£€æµ‹â€é˜Ÿåˆ—ã€‚

2. **Checker (æ£€æµ‹å™¨)**:

- **èŒè´£**: å¼‚æ­¥æ£€æµ‹ Redis ä¸­ä»£ç† IP çš„å¯ç”¨æ€§ã€åŒ¿ååº¦å’Œå“åº”é€Ÿåº¦ã€‚
- **å®ç°**: ä½¿ç”¨ `aiohttp` æˆ– `requests` å¯¹ç›®æ ‡ç½‘ç«™ï¼ˆå¦‚ç™¾åº¦ã€è°·æ­Œæˆ–ç‰¹å®šç›®æ ‡ç«™ï¼‰å‘èµ·è¯·æ±‚ã€‚
- **è¯„åˆ†æœºåˆ¶**:

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **å¯ç”¨** | åˆ†æ•°è®¾ä¸º 100ï¼ˆæˆ– +1ï¼‰ã€‚ |
| **ä¸å¯ç”¨** | åˆ†æ•°å‡ 1ï¼Œå½“åˆ†æ•°ä½äºé˜ˆå€¼ï¼ˆå¦‚ 0ï¼‰æ—¶ï¼Œä» Redis ç§»é™¤ã€‚ |
| **å¤æ£€** | å®šæ—¶éå† Redis ä¸­ç°å­˜çš„ä»£ç†è¿›è¡Œå¤æ£€ï¼Œç¡®ä¿åº“ä¸­ IP å§‹ç»ˆæœ‰æ•ˆã€‚ |


3. **Storage (å­˜å‚¨å™¨)**:


| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **æ•°æ®åº“** | Redis æ˜¯æœ€ä½³é€‰æ‹©ã€‚ |
| **æ•°æ®ç»“æ„** | `Sorted Set` (æœ‰åºé›†åˆ)ã€‚ |
| **Key** | ä»£ç† IP (`1.2.3.4:8080`) |
| **Score** | ä»£ç†åˆ†æ•° (0-100) |
| **ä¼˜åŠ¿** | å¯ä»¥åˆ©ç”¨ `ZRANGEBYSCORE` è½»æ¾è·å–é«˜è´¨é‡ï¼ˆæ»¡åˆ†ï¼‰ä»£ç†ã€‚ |


4. **API Server (æ¥å£æœåŠ¡)**:
- **èŒè´£**: ä¸ºçˆ¬è™«æä¾›ç®€å•çš„ HTTP æ¥å£è·å–ä»£ç†ã€‚
- **æ¥å£**:
- `/get`: éšæœºè¿”å›ä¸€ä¸ªé«˜åˆ†ä»£ç†ã€‚
- `/count`: æŸ¥çœ‹å½“å‰å¯ç”¨ä»£ç†æ•°é‡ã€‚

### architecture å›¾

```mermaid
graph LR
ProxySources[å…è´¹/ä»˜è´¹æº] --&gt; Fetcher
Fetcher --&gt;|Raw Proxy| Redis[(Redis Sorted Set)]
Redis &lt;--&gt;|Validation| Checker
Crawler[Scrapy çˆ¬è™«] --&gt;|Request| API[API Server]
API --&gt;|Get High Score Proxy| Redis
</code></pre>
<ol type="1">
<li><strong>è¯·æ±‚å‰ (<code>process_request</code>)</strong>:
ä»ä»£ç†æ± è·å–ä¸€ä¸ªä»£ç†ï¼Œèµ‹å€¼ç»™ <code>request.meta['proxy']</code>ã€‚</li>
<li><strong>å“åº”å (<code>process_response</code>)</strong>:
æ£€æŸ¥çŠ¶æ€ç ã€‚å¦‚æœæ˜¯ 200ï¼Œè¯´æ˜ä»£ç†æ­£å¸¸ï¼›å¦‚æœæ˜¯
403/429/è¶…æ—¶ï¼Œè¯´æ˜ä»£ç†å¯èƒ½å¤±æ•ˆæˆ–è¢«å°ã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç† (<code>process_exception</code>)</strong>:
æ•è·è¿æ¥è¶…æ—¶ã€è¿æ¥æ‹’ç»ç­‰ç½‘ç»œé”™è¯¯ï¼Œæ ‡è®°è¯¥ä»£ç†å¤±æ•ˆï¼Œå¹¶å¯¹å½“å‰è¯·æ±‚è¿›è¡Œé‡è¯•ã€‚</li>
</ol>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<div class="sourceCode" id="cb238"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># middlewares.py</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scrapy.exceptions <span class="im">import</span> IgnoreRequest</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProxyMiddleware:</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, proxy_pool_url):</span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.proxy_pool_url <span class="op">=</span> proxy_pool_url</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a><span class="at">@classmethod</span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> from_crawler(cls, crawler):</span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> cls(</span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>proxy_pool_url<span class="op">=</span>crawler.settings.get(<span class="st">&#39;PROXY_POOL_URL&#39;</span>)</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _get_random_proxy(<span class="va">self</span>):</span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="va">self</span>.proxy_pool_url)</span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> response.text.strip()</span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> requests.<span class="pp">ConnectionError</span>:</span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="va">None</span></span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="va">None</span></span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-26"><a href="#cb238-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_request(<span class="va">self</span>, request, spider):</span>
<span id="cb238-27"><a href="#cb238-27" aria-hidden="true" tabindex="-1"></a><span class="co"># IfRequestå·²ç»settingssssssä»£ç†ï¼ˆE.g.SpecificRequestï¼‰ï¼Œåˆ™è·³è¿‡</span></span>
<span id="cb238-28"><a href="#cb238-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> request.meta.get(<span class="st">&#39;proxy&#39;</span>):</span>
<span id="cb238-29"><a href="#cb238-29" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span></span>
<span id="cb238-30"><a href="#cb238-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-31"><a href="#cb238-31" aria-hidden="true" tabindex="-1"></a>proxy <span class="op">=</span> <span class="va">self</span>._get_random_proxy()</span>
<span id="cb238-32"><a href="#cb238-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> proxy:</span>
<span id="cb238-33"><a href="#cb238-33" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.logger.debug(<span class="ss">f&quot;Using proxy: </span><span class="sc">{</span>proxy<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-34"><a href="#cb238-34" aria-hidden="true" tabindex="-1"></a><span class="co"># settingssssssä»£ç†ï¼Œæ ¼å¼: http://user:pass@ip:ç«¯å£ or http://ip:ç«¯å£</span></span>
<span id="cb238-35"><a href="#cb238-35" aria-hidden="true" tabindex="-1"></a>request.meta[<span class="st">&#39;proxy&#39;</span>] <span class="op">=</span> <span class="ss">f&quot;http://</span><span class="sc">{</span>proxy<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb238-36"><a href="#cb238-36" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb238-37"><a href="#cb238-37" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.logger.warning(<span class="st">&quot;No proxy available from pool!&quot;</span>)</span>
<span id="cb238-38"><a href="#cb238-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-39"><a href="#cb238-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_response(<span class="va">self</span>, request, response, spider):</span>
<span id="cb238-40"><a href="#cb238-40" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœé‡åˆ°éªŒè¯ç ã€å°ç¦ç­‰çŠ¶æ€ç </span></span>
<span id="cb238-41"><a href="#cb238-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="kw">in</span> [<span class="dv">403</span>, <span class="dv">429</span>]:</span>
<span id="cb238-42"><a href="#cb238-42" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.logger.warning(<span class="ss">f&quot;Proxy </span><span class="sc">{</span>request<span class="sc">.</span>meta<span class="sc">.</span>get(<span class="st">&#39;proxy&#39;</span>)<span class="sc">}</span><span class="ss"> banned (Status </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">), retrying...&quot;</span>)</span>
<span id="cb238-43"><a href="#cb238-43" aria-hidden="true" tabindex="-1"></a><span class="co"># æ ‡è®°è¯¥ä»£ç†å¤±æ•ˆï¼ˆå¯é€‰ï¼šè°ƒç”¨ æ¥å£ æŠ¥å‘Šè¯¥ä»£ç†åï¼‰</span></span>
<span id="cb238-44"><a href="#cb238-44" aria-hidden="true" tabindex="-1"></a><span class="co"># self._report_bad_proxy(request.meta.get(&#39;proxy&#39;))</span></span>
<span id="cb238-45"><a href="#cb238-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-46"><a href="#cb238-46" aria-hidden="true" tabindex="-1"></a><span class="co"># DeleteCurrentä»£ç†settingssssssï¼ŒRe-è°ƒåº¦Requestï¼ˆä¼šå†æ¬¡ç»è¿‡ process_request æ¢æ–°ä»£ç†ï¼‰</span></span>
<span id="cb238-47"><a href="#cb238-47" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> request.meta[<span class="st">&#39;proxy&#39;</span>]</span>
<span id="cb238-48"><a href="#cb238-48" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> request.replace(dont_filter<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb238-49"><a href="#cb238-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-50"><a href="#cb238-50" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> response</span>
<span id="cb238-51"><a href="#cb238-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-52"><a href="#cb238-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_exception(<span class="va">self</span>, request, exception, spider):</span>
<span id="cb238-53"><a href="#cb238-53" aria-hidden="true" tabindex="-1"></a><span class="co"># process connection timeoutã€DNS ErrorEtc</span></span>
<span id="cb238-54"><a href="#cb238-54" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.logger.error(<span class="ss">f&quot;Proxy </span><span class="sc">{</span>request<span class="sc">.</span>meta<span class="sc">.</span>get(<span class="st">&#39;proxy&#39;</span>)<span class="sc">}</span><span class="ss"> failed: </span><span class="sc">{</span>exception<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-55"><a href="#cb238-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-56"><a href="#cb238-56" aria-hidden="true" tabindex="-1"></a><span class="co"># æ¢ä»£ç†é‡è¯•</span></span>
<span id="cb238-57"><a href="#cb238-57" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> request.meta[<span class="st">&#39;proxy&#39;</span>]</span>
<span id="cb238-58"><a href="#cb238-58" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> request.replace(dont_filter<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p>â€˜myproject.middlewares.ProxyMiddlewareâ€™: 543, # ç¦ç”¨ Scrapy é»˜è®¤
UserAgent and é‡è¯• Iné—´ä»¶ï¼ˆè§†æƒ…å†µè€Œå®šï¼‰ #
â€˜scrapy.downloadermiddlewares.useragent.UserAgentMiddlewareâ€™: None,
}</p>
<p>PROXY_POOL_URL = â€˜http://localhost:5000/getâ€™</p>
<pre><code>
- **GitHub**: `jhao104/proxy_pool`
- **ç‰¹ç‚¹**: ä¹Ÿæ˜¯åŸºäº Redisï¼Œæ¶æ„æ¸…æ™°ï¼Œæ”¯æŒ Docker ä¸€é”®éƒ¨ç½²ï¼Œå†…ç½®äº†å‡ åä¸ªå…è´¹æºçš„æŠ“å–è§„åˆ™ã€‚

2. **Gerapy / Scylla**

- **GitHub**: `imWildCat/scylla`
- **ç‰¹ç‚¹**: æ™ºèƒ½åŒ–ä»£ç†æ± ï¼Œè‡ªåŠ¨å­¦ä¹ ä»£ç†çš„ç¨³å®šæ€§ã€‚

3. **GimmeProxy**
- **ç‰¹ç‚¹**: Go è¯­è¨€ç¼–å†™ï¼Œæ€§èƒ½å¼ºåŠ²ã€‚
___
## 4. éš§é“ä»£ç† (Tunnel Proxy)

å¯¹äºä¼ä¸šçº§åº”ç”¨ï¼Œç»´æŠ¤è‡ªå»ºä»£ç†æ± æˆæœ¬è¾ƒé«˜ï¼ˆå…è´¹ IP è´¨é‡æå·®ï¼Œå¯ç”¨ç‡ä¸è¶³ 5%ï¼‰ã€‚æ­¤æ—¶é€šå¸¸ä½¿ç”¨å‚å•†æä¾›çš„**éš§é“ä»£ç†**ã€‚

**ç‰¹ç‚¹**:

- ä¸éœ€è¦åœ¨æœ¬åœ°ç»´æŠ¤ IP æ± ã€‚
- åªæœ‰ä¸€ä¸ªå›ºå®šçš„å…¥å£åœ°å€ï¼ˆå¦‚ `http://proxy.vendor.com:8000`ï¼‰ã€‚
- **æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œäº‘ç«¯ä¼šè‡ªåŠ¨è½¬å‘ç»™èƒŒåä¸åŒçš„åŠ¨æ€ IP**ã€‚

**Scrapy é›†æˆ**:
åªéœ€è¦åœ¨ `process_request` ä¸­å°†ä»£ç†è®¾ç½®ä¸ºè¯¥å›ºå®šåœ°å€ï¼Œå¹¶åœ¨ Header ä¸­æ·»åŠ é‰´æƒä¿¡æ¯ã€‚

```python
# Tunnel Proxy Example
request.meta[&#39;proxy&#39;] = &quot;http://proxy.vendor.com:8000&quot;
# æŸäº›å‚å•†è¦æ±‚åœ¨å¤´éƒ¨é€šè¿‡ Proxy-Authorization è®¤è¯
import base64
auth = base64.b64encode(b&quot;user:pass&quot;).decode()
request.headers[&#39;Proxy-Authorization&#39;] = f&quot;Basic {auth}&quot;




&lt;!-- 01-Recipes/Automation/scrapy.md --&gt;

# Scrapy å¿«é€Ÿå…¥é—¨å¤‡å¿˜å½•

Scrapy æ˜¯ä¸€ä¸ªç”¨äºç½‘ç»œçˆ¬è™«å’Œæ•°æ®æŠ“å–çš„ã€å¼€æºçš„ã€åä½œå¼çš„ Python æ¡†æ¶ã€‚å®ƒå…·æœ‰é€Ÿåº¦å¿«ã€åŠŸèƒ½å¼ºå¤§ã€å¯æ‰©å±•æ€§é«˜çš„ç‰¹ç‚¹ã€‚æœ¬å¤‡å¿˜å½•ä¸º Scrapy çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤æä¾›å¿«é€Ÿå‚è€ƒã€‚

- --

## ç›®å½•
- [Scrapy å¿«é€Ÿå…¥é—¨å¤‡å¿˜å½•](#scrapy-å¿«é€Ÿå…¥é—¨å¤‡å¿˜å½•)
- [ç›®å½•](#ç›®å½•)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)

- [é¡¹ç›®å‘½ä»¤](#é¡¹ç›®å‘½ä»¤)

- [Spider (çˆ¬è™«)](#spider-çˆ¬è™«)
- [åŸºæœ¬ç»“æ„](#åŸºæœ¬ç»“æ„)

- [æå–æ•°æ® (Selectors)](#æå–æ•°æ®-selectors)

- [å¤„ç†åˆ†é¡µå’Œé“¾æ¥](#å¤„ç†åˆ†é¡µå’Œé“¾æ¥)
- [Item (æ•°æ®å®¹å™¨)](#item-æ•°æ®å®¹å™¨)

- [Pipeline (æ•°æ®ç®¡é“)](#pipeline-æ•°æ®ç®¡é“)

- [Settings (è®¾ç½®)](#settings-è®¾ç½®)

- --

### æ ¸å¿ƒç»„ä»¶

Scrapy çš„æ•°æ®æµç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ååŒå®Œæˆï¼š

1. **Engine (å¼•æ“)**: è´Ÿè´£æ§åˆ¶æ‰€æœ‰ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµï¼Œå¹¶åœ¨ç›¸åº”åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘äº‹ä»¶ã€‚
2. **Scheduler (è°ƒåº¦å™¨)**: æ¥æ”¶æ¥è‡ªå¼•æ“çš„è¯·æ±‚ (`Request`)ï¼Œå¹¶å°†å…¶å…¥é˜Ÿï¼Œä»¥ä¾¿åç»­å¼•æ“è¯·æ±‚æ—¶æä¾›ã€‚
3. **Downloader (ä¸‹è½½å™¨)**: è´Ÿè´£è·å–é¡µé¢æ•°æ®ï¼Œå¹¶å°†å…¶æä¾›ç»™å¼•æ“ï¼Œè€Œåç”±å¼•æ“å°†ç»“æœ (`Response`) äº¤ç»™ Spiderã€‚
4. **Spiders (çˆ¬è™«)**: ç”¨æˆ·ç¼–å†™çš„ç”¨äºè§£æ `Response` å¹¶æå– `Item` æˆ–é¢å¤– `Request` çš„ç±»ã€‚
5. **Item Pipeline (é¡¹ç›®ç®¡é“)**: è´Ÿè´£å¤„ç†ç”± Spider æå–å‡ºæ¥çš„ `Item`ã€‚å…¸å‹çš„æ“ä½œåŒ…æ‹¬æ•°æ®æ¸…æ´—ã€éªŒè¯å’ŒæŒä¹…åŒ–ï¼ˆå¦‚å­˜å…¥æ•°æ®åº“ï¼‰ã€‚
6. **Downloader Middlewares (ä¸‹è½½å™¨ä¸­é—´ä»¶)**: ä½äºå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´çš„é’©å­ï¼Œç”¨äºåœ¨è¯·æ±‚å‘é€å’Œå“åº”è¿”å›æ—¶è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼ˆå¦‚è®¾ç½® User-Agentã€å¤„ç†ä»£ç†ï¼‰ã€‚
7. **Spider Middlewares (çˆ¬è™«ä¸­é—´ä»¶)**: ä½äºå¼•æ“å’Œ Spider ä¹‹é—´çš„é’©å­ï¼Œç”¨äºå¤„ç† Spider çš„è¾“å…¥ (`Response`) å’Œè¾“å‡º (`Item`, `Request`)ã€‚

![Scrapy Architecture](https://docs.scrapy.org/en/latest/_images/scrapy_architecture.png)

- --

### é¡¹ç›®å‘½ä»¤

| å‘½ä»¤ | æè¿° |
| :--- | :--- |
| `pip install scrapy` | å®‰è£… Scrapy æ¡†æ¶ |
| `scrapy startproject myproject` | åˆ›å»ºä¸€ä¸ªåä¸º `myproject` çš„æ–°é¡¹ç›® |
| `cd myproject` | è¿›å…¥é¡¹ç›®ç›®å½• |
| `scrapy genspider example example.com`| åœ¨ `spiders` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `example` çš„çˆ¬è™«ï¼Œé™å®šåŸŸåä¸º `example.com` |
| `scrapy crawl example` | è¿è¡Œåä¸º `example` çš„çˆ¬è™« |
| `scrapy crawl example -o output.json` | è¿è¡Œçˆ¬è™«å¹¶å°†æå–çš„æ•°æ®ä¿å­˜ä¸º JSON æ–‡ä»¶ |
| `scrapy shell &quot;http://example.com&quot;` | å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ Shellï¼Œç”¨äºæµ‹è¯• XPath/CSS é€‰æ‹©å™¨ |
| `scrapy list` | åˆ—å‡ºé¡¹ç›®ä¸­çš„æ‰€æœ‰å¯ç”¨çˆ¬è™« |

- --

### Spider (çˆ¬è™«)

Spider æ˜¯ä½ å®šä¹‰å¦‚ä½•çˆ¬å–æŸä¸ªç½‘ç«™ï¼ˆæˆ–ä¸€ç»„ç½‘ç«™ï¼‰çš„ç±»ï¼ŒåŒ…æ‹¬çˆ¬å–åŠ¨ä½œå’Œå¦‚ä½•ä»é¡µé¢å†…å®¹ä¸­æå–ç»“æ„åŒ–æ•°æ®ã€‚

#### åŸºæœ¬ç»“æ„

```python
# myproject/spiders/example_spider.py
import scrapy

class ExampleSpider(scrapy.Spider):
# çˆ¬è™«çš„å”¯ä¸€æ ‡è¯†åç§°
name = &#39;example&#39;
# å…è®¸çˆ¬å–çš„åŸŸååˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
allowed_domains = [&#39;example.com&#39;]
# çˆ¬è™«å¯åŠ¨æ—¶è¯·æ±‚çš„ URL åˆ—è¡¨
start_urls = [&#39;http://example.com/&#39;]

# å¤„ç† start_urls å“åº”çš„é»˜è®¤å›è°ƒæ–¹æ³•
def parse(self, response):
# åœ¨è¿™é‡Œç¼–å†™è§£æé€»è¾‘
pass
</code></pre>
<ul>
<li><p><code>response.css('a::attr(href)').getall()</code>: æå–æ‰€æœ‰
<code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§ã€‚</p></li>
<li><p><code>response.css('div.product &gt; p::text').get()</code>: æå–
<code>class="product"</code> çš„ <code>div</code> ä¸‹çš„ <code>p</code>
æ ‡ç­¾æ–‡æœ¬ã€‚</p></li>
<li><p><strong>XPath è¡¨è¾¾å¼</strong>:</p></li>
<li><p><code>response.xpath('//h1/text()').get()</code>: æå–ç¬¬ä¸€ä¸ª
<code>&lt;h1&gt;</code> æ ‡ç­¾çš„æ–‡æœ¬ã€‚</p></li>
<li><p><code>response.xpath('//a/@href').getall()</code>: æå–æ‰€æœ‰
<code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§ã€‚</p></li>
<li><p><code>response.xpath('//div[@class="product"]/p/text()').get()</code>:
åŒä¸Šã€‚</p></li>
</ul>
<h4 id="å¤„ç†åˆ†é¡µå’Œé“¾æ¥">å¤„ç†åˆ†é¡µå’Œé“¾æ¥</h4>
<p>åœ¨ <code>parse</code> æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥ <code>yield</code> æ–°çš„
<code>Request</code> å¯¹è±¡æ¥è·Ÿè¿›é“¾æ¥ã€‚</p>
<div class="sourceCode" id="cb240"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse(<span class="va">self</span>, response):</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ... æå–å½“å‰é¡µé¢æ•°æ® ...</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æå–ä¸‹ä¸€é¡µé“¾æ¥å¹¶ç”Ÿæˆæ–°è¯·æ±‚</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>next_page <span class="op">=</span> response.css(<span class="st">&#39;a.next_page::attr(href)&#39;</span>).get()</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> next_page <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a><span class="co"># response.urljoin() ç”¨äºå¤„ç†ç›¸å¯¹ URL</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a><span class="cf">yield</span> response.follow(next_page, callback<span class="op">=</span><span class="va">self</span>.parse)</span></code></pre></div>
<div class="sourceCode" id="cb241"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># myproject/items.py</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scrapy</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProductItem(scrapy.Item):</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> scrapy.Field()</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>price <span class="op">=</span> scrapy.Field()</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>description <span class="op">=</span> scrapy.Field()</span></code></pre></div>
<p>item = ProductItem() item[â€˜nameâ€™] =
response.css(â€˜h1.product-name::textâ€™).get() item[â€˜priceâ€™] =
response.css(â€˜span.price::textâ€™).get() yield item</p>
<pre><code>
```python
# myproject/pipelines.py
import sqlite3

class SQLitePipeline:
def open_spider(self, spider):
# çˆ¬è™«å¼€å¯æ—¶è°ƒç”¨
self.connection = sqlite3.connect(&#39;products.db&#39;)
self.cursor = self.connection.cursor()
self.cursor.execute(&#39;CREATE TABLE IF NOT EXISTS products (name TEXT, price TEXT)&#39;)

def close_spider(self, spider):
# çˆ¬è™«å…³é—­æ—¶è°ƒç”¨
self.connection.close()

def process_item(self, item, spider):
# æ¯ä¸ª item éƒ½ä¼šè°ƒç”¨
self.cursor.execute(&#39;INSERT INTO products (name, price) VALUES (?, ?)&#39;, (item[&#39;name&#39;], item[&#39;price&#39;]))
self.connection.commit()
return item # å¿…é¡»è¿”å› item
</code></pre>
<p>â€˜myproject.pipelines.SQLitePipelineâ€™: 300, }</p>
<pre><code>
* `DEFAULT_REQUEST_HEADERS`: è®¾ç½®é»˜è®¤çš„è¯·æ±‚å¤´ï¼Œå¦‚ `User-Agent`ã€‚

* `DOWNLOAD_DELAY = 1`: è®¾ç½®ä¸‹è½½å»¶è¿Ÿï¼ˆç§’ï¼‰ï¼Œä»¥é¿å…å¯¹æœåŠ¡å™¨é€ æˆå¤ªå¤§å‹åŠ›ã€‚

* `CONCURRENT_REQUESTS = 16`: å¹¶å‘è¯·æ±‚æ•°ã€‚

* `ITEM_PIPELINES`: æ¿€æ´»å’Œè®¾ç½® Item Pipeline çš„ä¼˜å…ˆçº§ã€‚

* `DOWNLOADER_MIDDLEWARES`: æ¿€æ´»å’Œè®¾ç½®ä¸‹è½½å™¨ä¸­é—´ä»¶çš„ä¼˜å…ˆçº§ã€‚



&lt;!-- 01-Recipes/Automation/scrapy_redis_distributed.md --&gt;

# åˆ†å¸ƒå¼çˆ¬è™«å®æˆ˜ï¼šScrapy-Redis è¯¦è§£

Scrapy é»˜è®¤æ˜¯å•æœºæ¶æ„ï¼Œè¯·æ±‚é˜Ÿåˆ—ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯å³å¤±ï¼Œä¸”æ— æ³•å¤šæœºå…±äº«ã€‚**Scrapy-Redis** æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç»„ä»¶ï¼Œå®ƒé‡å†™äº† Scrapy çš„è°ƒåº¦å™¨ (Scheduler) å’Œå»é‡ç»„ä»¶ (DupeFilter)ï¼Œå°†è¯·æ±‚é˜Ÿåˆ—å’ŒæŒ‡çº¹é›†åˆå­˜å‚¨åœ¨ Redis ä¸­ï¼Œä»è€Œå®ç°ï¼š
1. **åˆ†å¸ƒå¼çˆ¬å–**: å¤šä¸ªçˆ¬è™«èŠ‚ç‚¹å…±äº«åŒä¸€ä¸ª Redis é˜Ÿåˆ—ï¼ŒååŒå·¥ä½œã€‚
2. **æ–­ç‚¹ç»­çˆ¬**: è¯·æ±‚æŒä¹…åŒ–åœ¨ Redis ä¸­ï¼Œçˆ¬è™«æŒ‚æ‰é‡å¯åå¯ç»§ç»­è¿è¡Œã€‚
___
## 1. æ ¸å¿ƒarchitectureåŸç†

## # åŸç”Ÿ Scrapy vs Scrapy-Redis

* **åŸç”Ÿ Scrapy**:
* **Scheduler**: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python `deque` æˆ– `queue`ã€‚
* **DupeFilter**: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python `set`ã€‚
* **ç¼ºç‚¹**: æ— æ³•è·¨è¿›ç¨‹/è·¨æœºå™¨å…±äº«ï¼Œå†…å­˜å—é™ã€‚

* **Scheduler**: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python `deque` æˆ– `queue`ã€‚
* **DupeFilter**: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python `set`ã€‚
* **ç¼ºç‚¹**: æ— æ³•è·¨è¿›ç¨‹/è·¨æœºå™¨å…±äº«ï¼Œå†…å­˜å—é™ã€‚


* **Scrapy-Redis**:
* **Scheduler**: ä» Redis çš„ `List` (æˆ– `PriorityQueue`) ä¸­ `POP` è¯·æ±‚ï¼Œå‘å…¶ `PUSH` æ–°è¯·æ±‚ã€‚
* **DupeFilter**: åˆ©ç”¨ Redis çš„ `Set` æ•°æ®ç»“æ„å­˜å‚¨ URL æŒ‡çº¹ (SHA1)ï¼Œåˆ©ç”¨ Redis çš„åŸå­æ€§è¿›è¡Œå»é‡ã€‚
* **Item Pipeline**: å¯é€‰å°†æå–çš„æ•°æ®ç›´æ¥æ¨å…¥ Redisï¼Œç”±ç‹¬ç«‹çš„ Worker æ¶ˆè´¹å­˜å‚¨ã€‚

* **Scheduler**: ä» Redis çš„ `List` (æˆ– `PriorityQueue`) ä¸­ `POP` è¯·æ±‚ï¼Œå‘å…¶ `PUSH` æ–°è¯·æ±‚ã€‚
* **DupeFilter**: åˆ©ç”¨ Redis çš„ `Set` æ•°æ®ç»“æ„å­˜å‚¨ URL æŒ‡çº¹ (SHA1)ï¼Œåˆ©ç”¨ Redis çš„åŸå­æ€§è¿›è¡Œå»é‡ã€‚
* **Item Pipeline**: å¯é€‰å°†æå–çš„æ•°æ®ç›´æ¥æ¨å…¥ Redisï¼Œç”±ç‹¬ç«‹çš„ Worker æ¶ˆè´¹å­˜å‚¨ã€‚
___
## 2. ç¯å¢ƒæ­å»ºä¸é…ç½®

## # å®‰è£…

```bash
pip install scrapy-redis
</code></pre>
<h1 id="å¯ç”¨-scrapy-redis-è°ƒåº¦å™¨">1. å¯ç”¨ Scrapy-Redis è°ƒåº¦å™¨</h1>
<p>SCHEDULER = â€œscrapy_redis.scheduler.Schedulerâ€</p>
<h1 id="å¯ç”¨-scrapy-redis-å»é‡filterå™¨">2. å¯ç”¨ Scrapy-Redis
å»é‡Filterå™¨</h1>
<p>DUPEFILTER_CLASS = â€œscrapy_redis.dupefilter.RFPDupeFilterâ€</p>
<h1 id="å…è®¸æš‚åœ-æ–­ç‚¹ç»­çˆ¬core">3. å…è®¸æš‚åœ (æ–­ç‚¹ç»­çˆ¬Core)</h1>
<h1
id="å¦‚æœä¸ºçœŸå½“çˆ¬è™«åœæ­¢æ—¶redis-ä¸­çš„è¯·æ±‚é˜Ÿåˆ—ä¸ä¼šè¢«æ¸…ç©º">å¦‚æœä¸ºçœŸï¼Œå½“çˆ¬è™«åœæ­¢æ—¶ï¼ŒRedis
ä¸­çš„è¯·æ±‚é˜Ÿåˆ—ä¸ä¼šè¢«æ¸…ç©º</h1>
<p>SCHEDULER_PERSIST = True</p>
<h1 id="settingssssss-redis-connect">4. settingssssss Redis Connect</h1>
<h1 id="æ–¹å¼ä¸€å•ç‹¬setting">æ–¹å¼ä¸€ï¼šå•ç‹¬Setting</h1>
<p>REDIS_HOST = â€˜192.168.1.100â€™ REDIS_PORT = 6379 # REDIS_PARAMS =
{â€˜passwordâ€™: â€˜yourpasswordâ€™}</p>
<h1 id="æ–¹å¼äºŒå®Œæˆ-åœ°å€">æ–¹å¼äºŒï¼šå®Œæˆ åœ°å€</h1>
<h1 id="redis_url-redisuserpasshostname9001">REDIS_URL =
â€˜redis://user:pass@hostname:9001â€™</h1>
<h1 id="é…ç½®è¯·æ±‚é˜Ÿåˆ—æ¨¡å¼å¯é€‰é»˜è®¤ä¸º-priorityqueue">5.
é…ç½®è¯·æ±‚é˜Ÿåˆ—æ¨¡å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º PriorityQueueï¼‰</h1>
<h1
id="scheduler_queue_class-scrapy_redis.queue.priorityqueue-æœ‰åºé›†åˆæ”¯æŒä¼˜å…ˆçº§">SCHEDULER_QUEUE_CLASS
= â€˜scrapy_redis.queue.PriorityQueueâ€™ # æœ‰åºé›†åˆï¼Œæ”¯æŒä¼˜å…ˆçº§</h1>
<h1
id="scheduler_queue_class-scrapy_redis.queue.fifoqueue-å…ˆè¿›å…ˆå‡ºåˆ—è¡¨">SCHEDULER_QUEUE_CLASS
= â€˜scrapy_redis.queue.FifoQueueâ€™ # å…ˆè¿›å…ˆå‡ºåˆ—è¡¨</h1>
<h1
id="scheduler_queue_class-scrapy_redis.queue.lifoqueue-åè¿›å…ˆå‡ºåˆ—è¡¨æ ˆ">SCHEDULER_QUEUE_CLASS
= â€˜scrapy_redis.queue.LifoQueueâ€™ # åè¿›å…ˆå‡ºåˆ—è¡¨ï¼ˆæ ˆï¼‰</h1>
<h1 id="å¯é€‰-å°†æ•°æ®å­˜å…¥-redis-pipeline">6. (å¯é€‰) å°†æ•°æ®å­˜å…¥ Redis
Pipeline</h1>
<p>ITEM_PIPELINES = { â€˜scrapy_redis.pipelines.RedisPipelineâ€™: 300, }</p>
<pre><code>
```python
from scrapy_redis.spiders import RedisSpider
import scrapy

class MyDistributedSpider(RedisSpider):
name = &#39;myspider_distributed&#39;

# æ ¸å¿ƒå·®å¼‚ï¼šä¸å†å®šä¹‰ start_urls
# å®šä¹‰ redis_keyï¼Œçˆ¬è™«å¯åŠ¨åä¼šé˜»å¡ç­‰å¾…è¯¥é”®ä¸­å‡ºç°çš„ URL
redis_key = &#39;myspider:start_urls&#39;

def parse(self, response):
self.logger.info(f&quot;Crawling {response.url}&quot;)

# æå–æ•°æ®é€»è¾‘ä¸æ™®é€š Spider ä¸€è‡´
yield {
&#39;url&#39;: response.url,
&#39;title&#39;: response.css(&#39;title::text&#39;).get()
}

# ç”Ÿæˆæ–°è¯·æ±‚
for href in response.css(&#39;a::attr(href)&#39;).getall():
yield response.follow(href, self.parse)
</code></pre>
<pre><code>
2. å‘ Redis æ¨é€èµ·å§‹ URLï¼š
    ```bash
redis-cli lpush myspider:start_urls http://example.com
</code></pre>
<p>å¦‚æœä½ éœ€è¦åˆ©ç”¨ <code>Rule</code> å’Œ <code>LinkExtractor</code>
è‡ªåŠ¨æŠ“å–å…¨ç«™ï¼Œå¯ä»¥ä½¿ç”¨ <code>RedisCrawlSpider</code>ã€‚ ___ ## 4.
è¿›é˜¶ä¼˜åŒ–ç­–ç•¥</p>
<h2 id="bloom-filter-å»é‡ä¼˜åŒ–"># Bloom Filter å»é‡ä¼˜åŒ–</h2>
<p>Scrapy-Redis é»˜è®¤ä½¿ç”¨ Redis <code>Set</code> å­˜å‚¨æ‰€æœ‰æŒ‡çº¹ã€‚å¯¹äºäº¿çº§
URL çš„çˆ¬å–ï¼Œè¿™ä¼šæ¶ˆè€—æ•°å GB å†…å­˜ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é›†æˆ <strong>Bloom
Filter</strong>ã€‚</p>
<ul>
<li>*å®ç°æ€è·¯**:</li>
</ul>
<ol type="1">
<li>é‡å†™ <code>RFPDupeFilter</code>ã€‚</li>
<li>ä½¿ç”¨ <code>redis-py</code> çš„ <code>bf.add</code> å’Œ
<code>bf.exists</code> å‘½ä»¤ (éœ€è¦ RedisBloom æ¨¡å—) æˆ– Python ç«¯çš„
<code>pybloom_live</code> æ˜ å°„åˆ° Redis BitMapã€‚</li>
</ol>
<div class="sourceCode" id="cb246"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom_dupefilter.py ç®€æ˜“ç¤ºæ„</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scrapy_redis.dupefilter <span class="im">import</span> RFPDupeFilter</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BloomFilterDupeFilter(RFPDupeFilter):</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> request_seen(<span class="va">self</span>, request):</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> <span class="va">self</span>.request_fingerprint(request)</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume self.æœåŠ¡å™¨ Is Redis è¿æ¥ï¼Œä¸”supports s s s s s BF command</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="co"># If fingerprintexists atï¼ŒReturn True</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">self</span>.server.execute_command(<span class="st">&#39;BF.EXISTS&#39;</span>, <span class="va">self</span>.key, fp):</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="va">True</span></span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ElseAddæŒ‡çº¹</span></span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.server.execute_command(<span class="st">&#39;BF.ADD&#39;</span>, <span class="va">self</span>.key, fp)</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="va">False</span></span></code></pre></div>
<div class="sourceCode" id="cb247"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># When Generate Request Specify priority</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="cf">yield</span> scrapy.Request(url, priority<span class="op">=</span><span class="dv">100</span>) <span class="co"># é¦–é¡µï¼Œä¼˜å…ˆ</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="cf">yield</span> scrapy.Request(url, priority<span class="op">=</span><span class="dv">10</span>) <span class="co"># è¯¦æƒ…é¡µï¼Œæ¬¡ä¹‹</span></span></code></pre></div>
<div class="sourceCode" id="cb248"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># settings.py</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="co"># æŒ‡å®šç©ºé—²ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶åˆ™å…³é—­çˆ¬è™«</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>SCHEDULER_IDLE_BEFORE_CLOSE <span class="op">=</span> <span class="dv">10</span></span></code></pre></div>
<p>subgraph â€œMaster / Redis Serverâ€ Redis[(Redis Queue &amp; Set)]
end</p>
<p>subgraph â€œSlave 1â€ Spider1[Scrapy Spider 1] â€“&gt;|Pop Request| Redis
Spider1 â€“&gt;|Push Request| Redis Spider1 â€“&gt;|Dupe Check| Redis
end</p>
<p>subgraph â€œSlave 2â€ Spider2[Scrapy Spider 2] â€“&gt;|Pop Request| Redis
Spider2 â€“&gt;|Push Request| Redis Spider2 â€“&gt;|Dupe Check| Redis
end</p>
<p>subgraph â€œData Storageâ€ Mongo[(MongoDB)] end</p>
<p>Spider1 â€“&gt;|Store Item| Mongo Spider2 â€“&gt;|Store Item| Mongo</p>
<pre><code>


&lt;!-- 01-Recipes/Automation/virtualization_and_containers.md --&gt;

# å·¥ç¨‹åŒ–ï¼šè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯

ç§»åŠ¨ç«¯è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯åœ¨æœåŠ¡å™¨ç«¯æ¨¡æ‹Ÿå‡ºæˆç™¾ä¸Šåƒä¸ª Android è®¾å¤‡ç¯å¢ƒçš„èƒ½åŠ›ï¼Œå®ƒæ˜¯æ‰€æœ‰å¤§è§„æ¨¡è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ•°æ®é‡‡é›†å’Œå®‰å…¨åˆ†æä»»åŠ¡çš„åŸºçŸ³ã€‚è¿™é¡¹æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºå¹³è¡¡æ€§èƒ½ã€éš”ç¦»æ€§å’ŒçœŸå®æ€§ã€‚

___

## 1. Android æ¨¡æ‹Ÿå™¨ (Emulators)

Android æ¨¡æ‹Ÿå™¨æ˜¯åœ¨é ARM æ¶æ„ï¼ˆé€šå¸¸æ˜¯ x86_64ï¼‰çš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è½¯ä»¶æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ Android æ“ä½œç³»ç»Ÿç¯å¢ƒçš„ç¨‹åºã€‚

### a) ä¸»æµæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ç±»å‹ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| **Android SDK Emulator** | å…¨ç³»ç»Ÿæ¨¡æ‹Ÿ (QEMU) | åŠŸèƒ½æœ€å…¨ï¼ŒGoogle å®˜æ–¹æ”¯æŒï¼Œèƒ½æ¨¡æ‹Ÿæœ€æ–°çš„ Android API å’Œ Google æœåŠ¡ã€‚ | æ€§èƒ½å¼€é”€æå¤§ï¼Œèµ„æºå ç”¨é«˜ï¼Œå¯åŠ¨æ…¢ã€‚ | åº”ç”¨å¼€å‘ä¸è°ƒè¯•ï¼Œå°è§„æ¨¡æµ‹è¯•ã€‚ |
| **Anbox / Waydroid** | åŸºäºå†…æ ¸çš„å®¹å™¨ | æ€§èƒ½æé«˜ï¼Œæ¥è¿‘åŸç”Ÿï¼Œèµ„æºå ç”¨å°ã€‚ | éš”ç¦»æ€§è¾ƒå·®ï¼Œä¾èµ–å®¿ä¸»æœºå†…æ ¸ï¼Œå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚ | å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„æ¸¸æˆæµ‹è¯•ï¼Œäº‘æ¸¸æˆã€‚ |
| **Redroid / anbox-cloud** | åŸºäº Docker çš„å®¹å™¨åŒ–æ¨¡æ‹Ÿå™¨ | éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†æä¸ºæ–¹ä¾¿ï¼Œæ˜“äºé›†æˆåˆ° CI/CD æµæ°´çº¿ã€‚ | é…ç½®ç›¸å¯¹å¤æ‚ï¼Œå¯¹ Docker å’Œç½‘ç»œçŸ¥è¯†æœ‰ä¸€å®šè¦æ±‚ã€‚ | å¤§è§„æ¨¡ã€åŠ¨æ€ä¼¸ç¼©çš„äº‘æ‰‹æœºå¹³å°ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•é›†ç¾¤ã€‚ |
| **Genymotion** | å•†ä¸šè™šæ‹ŸåŒ–æ–¹æ¡ˆ | æ€§èƒ½å¥½ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ˆGPS, æ‘„åƒå¤´æ¨¡æ‹Ÿï¼‰ï¼Œæä¾› PaaS/SaaS æœåŠ¡ã€‚ | æ”¶è´¹ï¼Œé—­æºã€‚ | ä¼ä¸šçº§æµ‹è¯•ï¼Œéœ€è¦ä¸“ä¸šæŠ€æœ¯æ”¯æŒçš„åœºæ™¯ã€‚ |

### b) å…³é”®æŠ€æœ¯ç‚¹

* **æŒ‡ä»¤é›†ç¿»è¯‘**: åœ¨ x86 æœåŠ¡å™¨ä¸Šè¿è¡Œä¸º ARM æ¶æ„ç¼–è¯‘çš„ Appï¼Œéœ€è¦è¿›è¡ŒåŠ¨æ€çš„æŒ‡ä»¤é›†ç¿»è¯‘ã€‚Intel çš„ `libhoudini` å’Œ Google çš„ `NdkVm` æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½çš„å…³é”®ç»„ä»¶ï¼Œå…¶æ•ˆç‡ç›´æ¥å†³å®šäº†æ¨¡æ‹Ÿå™¨çš„æ€§èƒ½ã€‚

* **GPU ç¡¬ä»¶åŠ é€Ÿ**: ä¸ºäº†æ¸²æŸ“å¤æ‚çš„ UI å’Œæ¸¸æˆï¼Œæ¨¡æ‹Ÿå™¨éœ€è¦å°† Android çš„å›¾å½¢æ¸²æŸ“æŒ‡ä»¤ï¼ˆOpenGL ESï¼‰æ¡¥æ¥åˆ°å®¿ä¸»æœºçš„ GPU ä¸Šã€‚`Virgil3D` ç­‰é¡¹ç›®å®ç°äº†è¿™ç§é€ä¼ èƒ½åŠ›ã€‚

* **å¿«ç…§ä¸çŠ¶æ€ç®¡ç†**: é«˜æ•ˆçš„å¿«ç…§åŠŸèƒ½å…è®¸æˆ‘ä»¬å¿«é€Ÿåœ°å°†æ¨¡æ‹Ÿå™¨æ¢å¤åˆ°ä¸€ä¸ªå¹²å‡€ã€é¢„è®¾çš„çŠ¶æ€ï¼Œè¿™å¯¹äºä¿è¯æ¯æ¬¡è‡ªåŠ¨åŒ–æµ‹è¯•éƒ½åœ¨åŒæ ·çš„ç¯å¢ƒä¸­è¿›è¡Œè‡³å…³é‡è¦ã€‚

___

## 2. å®¹å™¨æŠ€æœ¯ (Containerization)

å®¹å™¨æŠ€æœ¯ï¼ˆä»¥ Docker ä¸ºä»£è¡¨ï¼‰è™½ç„¶ä¸ç›´æ¥è¿è¡Œ Android ç³»ç»Ÿï¼Œä½†å®ƒåœ¨æ•´ä¸ªå·¥ç¨‹åŒ–ä½“ç³»ä¸­æ‰®æ¼”ç€&quot;èƒ¶æ°´&quot;å’Œ&quot;æ ‡å‡†äº¤ä»˜&quot;çš„å…³é”®è§’è‰²ã€‚

### a) éš”ç¦»ä¸æ‰“åŒ…ä¾èµ–é¡¹

åœ¨å¤æ‚çš„è‡ªåŠ¨åŒ–æµç¨‹ä¸­ï¼Œé™¤äº† Android æ¨¡æ‹Ÿå™¨æœ¬èº«ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤§é‡çš„å‘¨è¾¹æœåŠ¡ã€‚

* **ä»»åŠ¡é˜Ÿåˆ—**: ä½¿ç”¨ `redis` æˆ– `rabbitmq` å®¹å™¨æ¥ç®¡ç†å’Œåˆ†å‘æˆåƒä¸Šä¸‡çš„æµ‹è¯•ä»»åŠ¡ã€‚

* **ä»£ç†æœåŠ¡**: éƒ¨ç½² `mitmproxy` æˆ– `squid` å®¹å™¨æ¥é›†ä¸­æ‹¦æˆªå’Œåˆ†ææ‰€æœ‰æ¨¡æ‹Ÿå™¨çš„ç½‘ç»œæµé‡ã€‚

* **æ•°æ®åº“**: ä½¿ç”¨ `mongodb` æˆ– `postgresql` å®¹å™¨æ¥æŒä¹…åŒ–å­˜å‚¨æµ‹è¯•ç»“æœã€App å…ƒæ•°æ®å’Œè®¾å¤‡çŠ¶æ€ã€‚

* **æ–‡ä»¶å­˜å‚¨**: ä½¿ç”¨ `minio` å®¹å™¨æ¥æä¾›ä¸€ä¸ª S3 å…¼å®¹çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œç”¨äºå­˜æ”¾ APK æ–‡ä»¶ã€æµ‹è¯•æŠ¥å‘Šå’Œæˆªå›¾ã€‚

å°†è¿™äº›æœåŠ¡å…¨éƒ¨å®¹å™¨åŒ–ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª `docker-compose.yml` æ–‡ä»¶ï¼Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ä¸€é”®æ‹‰èµ·æ•´å¥—åç«¯åŸºç¡€è®¾æ–½ï¼Œæå¤§åœ°ç®€åŒ–äº†éƒ¨ç½²å’Œè¿ç»´ã€‚

### b) æ„å»ºæ ‡å‡†åŒ–çš„æ‰§è¡Œç¯å¢ƒ

æˆ‘ä»¬å¯ä»¥å°† Appiumã€UIAutomator2 è„šæœ¬ã€Frida è„šæœ¬ä»¥åŠæ‰€æœ‰ Python ä¾èµ–æ‰“åŒ…åˆ°ä¸€ä¸ª Docker é•œåƒä¸­ã€‚

* **ä¸€è‡´æ€§**: ç¡®ä¿æ— è®ºæ˜¯åœ¨å¼€å‘è€…çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œè¿˜æ˜¯åœ¨ CI/CD æœåŠ¡å™¨ä¸Šï¼Œè„šæœ¬çš„è¿è¡Œç¯å¢ƒéƒ½å®Œå…¨ä¸€è‡´ï¼Œé¿å…äº†&quot;åœ¨æˆ‘è¿™é‡Œèƒ½è·‘&quot;çš„é—®é¢˜ã€‚

* **ç‰ˆæœ¬æ§åˆ¶**: å¯ä»¥ä¸ºæ¯ä¸ªç‰ˆæœ¬çš„ App é…å¥—ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„æµ‹è¯•é•œåƒï¼Œæ–¹ä¾¿åœ°å¯¹å†å²ç‰ˆæœ¬è¿›è¡Œå›å½’æµ‹è¯•ã€‚

* **å¯ç§»æ¤æ€§**: æ•´ä¸ªæµ‹è¯•å¥—ä»¶å¯ä»¥ä½œä¸ºä¸€ä¸ª Docker é•œåƒè½»æ¾åœ°è¿ç§»åˆ°ä¸åŒçš„äº‘å¹³å°æˆ–ç‰©ç†æœåŠ¡å™¨ä¸Šã€‚

___

## æ€»ç»“

è™šæ‹ŸåŒ–å’Œå®¹å™¨åŒ–æ˜¯ä»&quot;æ‰‹å·¥ä½œåŠ&quot;è¿ˆå‘&quot;å·¥ä¸šåŒ–ç”Ÿäº§&quot;çš„ç¬¬ä¸€æ­¥ã€‚

* **è™šæ‹ŸåŒ–** è§£å†³äº†&quot;è®¾å¤‡ä»å“ªé‡Œæ¥&quot;çš„é—®é¢˜ï¼Œæä¾›äº†å¯å¤§è§„æ¨¡å¤åˆ¶çš„ã€éš”ç¦»çš„ Android è¿è¡Œç¯å¢ƒã€‚

* **å®¹å™¨åŒ–** è§£å†³äº†&quot;ä¾èµ–å’Œè„šæœ¬å¦‚ä½•ç®¡ç†&quot;çš„é—®é¢˜ï¼Œæä¾›äº†æ ‡å‡†åŒ–çš„ã€å¯ç§»æ¤çš„äº¤ä»˜ç‰©ã€‚

äºŒè€…ç»“åˆï¼Œä¸ºä¸Šå±‚çš„è‡ªåŠ¨åŒ–å’Œç¾¤æ§ç³»ç»Ÿæä¾›äº†åšå®ã€å¯é ã€å¯æ‰©å±•çš„åŸºç¡€è®¾æ–½ã€‚


&lt;!-- 01-Recipes/Automation/web_anti_scraping.md --&gt;

# Web åçˆ¬è™«æŠ€æœ¯

ç½‘ç»œçˆ¬è™«æ˜¯è‡ªåŠ¨ä»ç½‘ç«™æå–æ•°æ®çš„è¿‡ç¨‹ã€‚ç”±äºè¿™å¯èƒ½è¢«æ»¥ç”¨ï¼Œè®¸å¤šç°ä»£ç½‘ç«™å’ŒæœåŠ¡å®æ–½äº†å¤æ‚çš„åçˆ¬è™«ï¼ˆæˆ–&quot;åæœºå™¨äºº&quot;ï¼‰æŠ€æœ¯æ¥ä¿æŠ¤å…¶æ•°æ®ã€‚è¿™äº›æŠ€æœ¯å¯å¤§è‡´åˆ†ä¸ºå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ç«¯é˜²å¾¡ã€‚

___

## 1. å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æŒ‘æˆ˜

è¿™äº›é˜²å¾¡æªæ–½çš„é‡ç‚¹æ˜¯ç¡®ä¿å®¢æˆ·ç«¯æ˜¯ç”±äººç±»æ“ä½œçš„çœŸå®ã€æ ‡å‡†çš„ç½‘ç»œæµè§ˆå™¨ã€‚

*   **JavaScript (JS) æŒ‘æˆ˜**: æœåŠ¡å™¨å‘é€ä¸€æ®µå¤æ‚çš„ JavaScriptï¼Œå®¢æˆ·ç«¯å¿…é¡»æ­£ç¡®æ‰§è¡Œã€‚è¯¥è„šæœ¬å¯èƒ½æ‰§è¡Œè®¡ç®—ã€ä¸æµè§ˆå™¨ API äº¤äº’ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¿…é¡»åœ¨åç»­è¯·æ±‚ä¸­å‘å›çš„ä»¤ç‰Œã€‚éœ€è¦ä½¿ç”¨åƒ Puppeteer æˆ– Selenium è¿™æ ·çš„æ— å¤´æµè§ˆå™¨æ¥é€šè¿‡è¿™äº›æŒ‘æˆ˜ã€‚
    *   **ä¾‹å­**: Akamai Bot Manager, Cloudflare Bot Managementã€‚

*   **æµè§ˆå™¨æŒ‡çº¹**: æœåŠ¡å™¨æ”¶é›†å®¢æˆ·ç«¯æµè§ˆå™¨ç¯å¢ƒçš„è¯¦ç»†ç”»åƒã€‚è¿™åŒ…æ‹¬ï¼š
    *   `User-Agent`ã€å±å¹•åˆ†è¾¨ç‡ã€é¢œè‰²æ·±åº¦ã€æ—¶åŒºã€‚
    *   å®‰è£…çš„å­—ä½“ã€æµè§ˆå™¨æ’ä»¶ã€‚
    *   æµè§ˆå™¨ JS å¼•æ“æˆ–æ¸²æŸ“å¼•æ“ï¼ˆCanvasï¼‰è¡Œä¸ºçš„ç»†å¾®å·®å¼‚ã€‚

*   **TLS æŒ‡çº¹**: åˆ†æå®¢æˆ·ç«¯ TLS æ¡æ‰‹çš„å‚æ•°ï¼ˆå¯†ç å¥—ä»¶ã€æ‰©å±•ç­‰ï¼‰ã€‚
    *   ä¸æ ‡å‡†æµè§ˆå™¨ç”»åƒï¼ˆä¾‹å¦‚ï¼ŒWindows ä¸Šçš„ Chromeï¼‰çš„åå·®å¯ç”¨äºå°†å®¢æˆ·ç«¯æ ‡è®°ä¸ºæœºå™¨äººã€‚

*   **CAPTCHA**: &quot;å…¨è‡ªåŠ¨åŒºåˆ†è®¡ç®—æœºå’Œäººç±»çš„å…¬å¼€å›¾çµæµ‹è¯•&quot;ã€‚è¿™éœ€è¦ç”¨æˆ·è§£å†³ä¸€ä¸ªå¯¹æœºå™¨äººæ¥è¯´å¾ˆå›°éš¾çš„æŒ‘æˆ˜ï¼ˆä¾‹å¦‚ï¼Œåœ¨å›¾åƒä¸­è¯†åˆ«ç‰©ä½“ï¼‰ã€‚
    *   **ä¾‹å­**: è°·æ­Œçš„ reCAPTCHA (v2/v3), hCaptchaã€‚ç»•è¿‡è¿™äº›é€šå¸¸éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹ç ´è§£æœåŠ¡ã€‚

## 2. æœåŠ¡å™¨ç«¯æ£€æµ‹

è¿™äº›é˜²å¾¡æªæ–½é€šè¿‡åˆ†ææœåŠ¡å™¨ä¸Šçš„è¯·æ±‚æ¨¡å¼æ¥è¯†åˆ«éäººç±»è¡Œä¸ºã€‚

*   **IP åœ°å€ä¿¡èª‰**: é˜»æ­¢æˆ–é€Ÿç‡é™åˆ¶æ¥è‡ªå·²çŸ¥å±äºæ•°æ®ä¸­å¿ƒï¼ˆå¦‚ AWSã€è°·æ­Œäº‘ï¼‰æˆ–ä»£ç†/VPN æœåŠ¡çš„ IP åœ°å€çš„è¯·æ±‚ã€‚é€šå¸¸ä½¿ç”¨ä½å®…ä»£ç†æ¥è§„é¿æ­¤é—®é¢˜ã€‚

*   **é€Ÿç‡é™åˆ¶**: é™åˆ¶å•ä¸ª IP åœ°å€æˆ–ç”¨æˆ·å¸æˆ·åœ¨ç»™å®šæ—¶é—´æ®µå†…å¯ä»¥å‘å‡ºçš„è¯·æ±‚æ•°é‡ã€‚çˆ¬è™«å¿…é¡»éµå®ˆè¿™äº›é™åˆ¶ä»¥é¿å…è¢«é˜»æ­¢ã€‚

*   **è¡Œä¸ºåˆ†æ**: è¿™æ˜¯æœ€å…ˆè¿›çš„æŠ€æœ¯ã€‚æœåŠ¡å™¨ä¼šé•¿æœŸè·Ÿè¸ªç”¨æˆ·è¡Œä¸ºï¼Œä»¥å»ºç«‹&quot;æ­£å¸¸&quot;äººç±»äº¤äº’çš„æ¨¡å‹ã€‚
    *   **é¼ æ ‡ç§»åŠ¨å’ŒæŒ‰é”®**: çœŸå®ç”¨æˆ·æœ‰æ··ä¹±ã€éçº¿æ€§çš„é¼ æ ‡ç§»åŠ¨å’Œæ‰“å­—æ¨¡å¼ã€‚æœºå™¨äººé€šå¸¸ç¼ºä¹è¿™ä¸€ç‚¹ã€‚é«˜çº§æœºå™¨äººå¿…é¡»æ¨¡æ‹Ÿè¿™ç§&quot;äººç±»&quot;è¾“å…¥ã€‚
    *   **å¯¼èˆªæ¨¡å¼**: äººç±»é€šè¿‡ç½‘ç«™çš„è·¯å¾„æ˜¯å¯é¢„æµ‹ä½†éå®Œå…¨çº¿æ€§çš„ã€‚æœºå™¨äººé€šå¸¸ç›´æ¥æˆ–ä»¥åƒµç¡¬çš„é¡ºåºè®¿é—®é¡µé¢ã€‚
    *   **è¯·æ±‚æ—¶é—´**: æ¥è‡ªäººç±»ç”¨æˆ·çš„è¯·æ±‚ä¹‹é—´çš„æ—¶é—´æ˜¯å¯å˜çš„ã€‚æœºå™¨äººé€šå¸¸ä»¥å›ºå®šçš„ã€æœ€å°çš„å»¶è¿Ÿè¿è¡Œã€‚

___

## è§„é¿ç­–ç•¥

*   **ä½¿ç”¨åŠŸèƒ½é½å…¨çš„æµè§ˆå™¨**: ä½¿ç”¨ **Selenium**ã€**Puppeteer** æˆ– **Playwright** ç­‰å·¥å…·æ¥è‡ªåŠ¨åŒ–ä¸€ä¸ªçœŸå®çš„æµè§ˆå™¨ã€‚è¿™æœ‰åŠ©äºè§£å†³ JS æŒ‘æˆ˜å¹¶æä¾›æ›´å…·è¯´æœåŠ›çš„æµè§ˆå™¨æŒ‡çº¹ã€‚ä½¿ç”¨&quot;stealth&quot;æ’ä»¶è¿›ä¸€æ­¥éšè—è‡ªåŠ¨åŒ–ã€‚

*   **è½®æ¢ IP**: ä½¿ç”¨é«˜è´¨é‡çš„**ä½å®…æˆ–ç§»åŠ¨ä»£ç†**æ± æ¥é¿å…åŸºäº IP çš„å°é”å¹¶æ¨¡ä»¿çœŸå®ç”¨æˆ·ã€‚

*   **æ¨¡ä»¿äººç±»è¡Œä¸º**: å¼•å…¥éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿé€¼çœŸçš„é¼ æ ‡ç§»åŠ¨ï¼Œå¹¶ä»¥æ›´åƒäººç±»çš„æ–¹å¼åœ¨ç½‘ç«™ä¸Šå¯¼èˆªã€‚

*   **é€†å‘å·¥ç¨‹ JS**: å¯¹äºæŸäº› JS æŒ‘æˆ˜ï¼Œå¯ä»¥é€†å‘å·¥ç¨‹æ··æ·†çš„ JavaScript ä»£ç ï¼Œä»¥äº†è§£åæœºå™¨äººä»¤ç‰Œæ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚è¿™ä½¿ä½ å¯ä»¥åœ¨è‡ªå·±çš„è„šæœ¬ä¸­å¤åˆ¶é€»è¾‘ï¼Œè€Œæ— éœ€å®Œæ•´çš„æµè§ˆå™¨ï¼Œè¿™æ ·ä¼šå¿«å¾—å¤šã€‚ç”šè‡³å¯ä»¥ä½¿ç”¨ Frida ç­‰å·¥å…·æ¥é’©ä½æµè§ˆå™¨è¿›ç¨‹ä»¥è¿›è¡Œåˆ†æã€‚

*   **IP è´¨é‡æ£€æµ‹**: æœåŠ¡å™¨ç«¯ä¼šæ£€æŸ¥è¯·æ±‚ IP çš„ç±»å‹ï¼ˆæ•°æ®ä¸­å¿ƒã€ä½å®…ã€ç§»åŠ¨ï¼‰ï¼Œå¹¶å¯¹æ¥è‡ªæ•°æ®ä¸­å¿ƒçš„ IP æ–½åŠ æ›´ä¸¥æ ¼çš„é™åˆ¶ã€‚

*   **è¡Œä¸ºåˆ†æ**: æœåŠ¡å™¨é€šè¿‡åˆ†æç”¨æˆ·åœ¨ä¸€ç³»åˆ—è¯·æ±‚ä¸­çš„è¡Œä¸ºæ¨¡å¼ï¼ˆå¦‚è¯·æ±‚é¢‘ç‡ã€è®¿é—®è·¯å¾„ã€é¼ æ ‡ç§»åŠ¨è½¨è¿¹ï¼‰æ¥åˆ¤æ–­å…¶æ˜¯å¦ä¸ºæœºå™¨äººã€‚

___

## ä¸“é¢˜ï¼šç»•è¿‡ Cloudflare äº”ç§’ç›¾

Cloudflare çš„&quot;I&#39;m Under Attack Mode&quot;ï¼ˆæˆ‘æ­£é­å—æ”»å‡»æ¨¡å¼ï¼‰æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„å¼ºåŠ›åæœºå™¨äººæªæ–½ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ä¸€ä¸ªæŒç»­çº¦äº”ç§’çš„&quot;Checking your browser before accessing...&quot;é¡µé¢ã€‚è¿™å°±æ˜¯ä¿—ç§°çš„&quot;äº”ç§’ç›¾&quot;ã€‚

### 1. å·¥ä½œåŸç†

äº”ç§’ç›¾çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª **JavaScript æŒ‘æˆ˜ (JS Challenge)**ã€‚å½“ç”¨æˆ·é¦–æ¬¡è®¿é—®å—ä¿æŠ¤çš„é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªåŒ…å«å¤æ‚ã€é«˜åº¦æ··æ·†çš„ JavaScript ä»£ç çš„ HTML é¡µé¢ã€‚è¿™æ®µ JS çš„ä¸»è¦ç›®çš„ä¸æ˜¯ä¸ºäº†å¥½çœ‹ï¼Œè€Œæ˜¯ä¸ºäº†ï¼š

1.  **ç¯å¢ƒæ£€æµ‹**: æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºä¸€ä¸ªçœŸå®çš„ã€æ ‡å‡†çš„æµè§ˆå™¨ã€‚å®ƒä¼šæ£€æµ‹ `window`, `document` ç­‰å¯¹è±¡ï¼Œä»¥åŠå±å¹•åˆ†è¾¨ç‡ã€æ—¶åŒºã€æ’ä»¶ç­‰æµè§ˆå™¨æŒ‡çº¹ä¿¡æ¯ã€‚
2.  **è®¡ç®—å¯†é›†å‹ä»»åŠ¡**: æ‰§è¡Œä¸€ç³»åˆ—å¤æ‚çš„æ•°å­¦è¿ç®—ã€‚è¿™äº›è¿ç®—å¯¹äºç°ä»£æµè§ˆå™¨æ¥è¯´è€—æ—¶å¾ˆçŸ­ï¼ˆé€šå¸¸åœ¨ 1-2 ç§’å†…ï¼‰ï¼Œä½†å¯¹äºä¸å…·å¤‡ JS æ‰§è¡Œå¼•æ“çš„ç®€å•çˆ¬è™«ï¼ˆå¦‚çº¯ç²¹çš„ `requests` åº“ï¼‰æ¥è¯´æ˜¯æ— æ³•å®Œæˆçš„ã€‚
3.  **ç”ŸæˆéªŒè¯ Token**: JS è®¡ç®—çš„æœ€ç»ˆç»“æœä¼šä½œä¸ºä¸€ä¸ª Tokenï¼Œé€šè¿‡è¡¨å•æäº¤æˆ– Ajax è¯·æ±‚å‘é€å› Cloudflare çš„æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚
4.  **è®¾ç½®èº«ä»½ Cookie**: éªŒè¯é€šè¿‡åï¼ŒCloudflare ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„ Cookieï¼ˆå¦‚ `__cf_bm` æˆ– `cf_clearance`ï¼‰ï¼Œè¯¥ Cookie åœ¨ä¸€å®šæ—¶é—´å†…æœ‰æ•ˆã€‚åç»­çš„è¯·æ±‚åªè¦æºå¸¦è¿™ä¸ªæœ‰æ•ˆçš„ Cookieï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®ç½‘ç«™ï¼Œæ— éœ€å†æ¬¡æŒ‘æˆ˜ã€‚

### 2. ç»•è¿‡æ–¹æ¡ˆ

ç»•è¿‡äº”ç§’ç›¾çš„æ ¸å¿ƒæ€æƒ³æ˜¯ **æ¨¡æ‹Ÿä¸€ä¸ªèƒ½å¤ŸæˆåŠŸæ‰§è¡Œå…¶ JS æŒ‘æˆ˜çš„ç¯å¢ƒ**ã€‚

#### a. æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨æ— å¤´æµè§ˆå™¨ (Headless Browser) - æ¨è

è¿™æ˜¯æœ€ç¨³å®šã€æˆåŠŸç‡æœ€é«˜çš„æ–¹æ¡ˆã€‚ä½¿ç”¨ `Puppeteer` (Node.js), `Playwright` (Python/Node.js) æˆ– `Selenium` ç­‰è‡ªåŠ¨åŒ–æµè§ˆå™¨æ¡†æ¶ã€‚

*   **å·¥ä½œæ–¹å¼**: è¿™äº›å·¥å…·ä¼šå¯åŠ¨ä¸€ä¸ªçœŸå®çš„ã€å®Œæ•´çš„æµè§ˆå™¨å†…æ ¸ï¼ˆå¦‚ Chromeï¼‰ï¼Œåªæ˜¯æ²¡æœ‰å›¾å½¢ç•Œé¢ã€‚å½“å®ƒä»¬è®¿é—®ç›®æ ‡é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šåƒæ­£å¸¸ç”¨æˆ·è®¿é—®ä¸€æ ·ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰çš„ JavaScriptï¼Œå®ŒæˆæŒ‘æˆ˜ï¼Œè·å– Cookieï¼Œç„¶åç»§ç»­è®¿é—®ç›®æ ‡é¡µé¢ã€‚
*   **ä¼˜ç‚¹**: æˆåŠŸç‡æé«˜ï¼Œå‡ ä¹èƒ½åº”å¯¹æ‰€æœ‰åŸºäº JS æŒ‘æˆ˜çš„é˜²æŠ¤ã€‚
*   **ç¼ºç‚¹**: èµ„æºæ¶ˆè€—å¤§ï¼ˆéœ€è¦å¯åŠ¨æ•´ä¸ªæµè§ˆå™¨ï¼‰ï¼Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚

**Playwright (Python) ç¤ºä¾‹ï¼š**


&lt;!-- 01-Recipes/Network/crypto_analysis.md --&gt;

# Recipe: åˆ†æå¹¶æå– android åº”ç”¨çš„åŠ å¯†å¯†é’¥

## é—®é¢˜åœºæ™¯

_ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ_

- â“ App çš„ API è¯·æ±‚å‚æ•°è¢«åŠ å¯†äº†ï¼Œçœ‹ä¸æ‡‚å†…å®¹
- â“ æƒ³çŸ¥é“ App ä½¿ç”¨äº†ä»€ä¹ˆåŠ å¯†ç®—æ³•
- â“ éœ€è¦æå–åŠ å¯†å¯†é’¥æ¥è§£å¯†æ•°æ®
- â“ æƒ³é‡ç° App çš„åŠ å¯†/ç­¾åé€»è¾‘ç”¨äºè‡ªåŠ¨åŒ–
- â“ éœ€è¦ç»•è¿‡åŠ å¯†éªŒè¯æˆ–ç­¾åæ£€æŸ¥

_æœ¬é…æ–¹æ•™ä½ _ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ã€å®šä½å¯†é’¥ä½ç½®ã€ä½¿ç”¨ Frida åŠ¨æ€æå–å¯†é’¥ã€‚

_æ ¸å¿ƒç†å¿µ_ï¼š

&gt; ğŸ’¡ **å¯†ç å­¦é€†å‘çš„å…³é”®ä¸æ˜¯ç ´è§£ç®—æ³•ï¼Œè€Œæ˜¯æ‰¾åˆ°å¯†é’¥**
&gt;
&gt; - âŒ ä¸è¦è¯•å›¾&quot;ç ´è§£&quot; AES/RSA ç­‰æˆç†Ÿç®—æ³•ï¼ˆå‡ ä¹ä¸å¯èƒ½ï¼‰
&gt; - âœ… ç”¨åŠ¨æ€åˆ†æç›´æ¥æå–å¯†é’¥
&gt; - âœ… æˆ–ç›´æ¥è°ƒç”¨ App è‡ªå·±çš„åŠ å¯†å‡½æ•°ï¼ˆåˆ©ç”¨å·²æœ‰å¯†é’¥ï¼‰

_é¢„è®¡ç”¨æ—¶_: 30-60 åˆ†é’Ÿ

- --

## å·¥å…·æ¸…å•

## # å¿…éœ€å·¥å…·

- â˜ **jadx-gui** - Java å±‚é™æ€åˆ†æ
- â˜ **Frida** - åŠ¨æ€ Hook æå–å¯†é’¥
- â˜ **Android è®¾å¤‡**ï¼ˆå·² Rootï¼‰

## # å¯é€‰å·¥å…·

- â˜ **IDA Pro / Ghidra** - Native å±‚åˆ†æ
- â˜ **Burp Suite** - æŠ“åŒ…æŸ¥çœ‹åŠ å¯†åçš„æ•°æ®
- â˜ **CyberChef** - åœ¨çº¿åŠ å¯†/è§£å¯†å·¥å…·ï¼ˆhttps://gchq.github.io/CyberChef/ï¼‰

- --

## å‰ç½®æ¡ä»¶

## # âœ… ç¡®è®¤æ¸…å•

```bash
# 1. Frida æ­£å¸¸è¿è¡Œ
frida-ps -U

# 2. jadx-gui å·²å®‰è£…
jadx-gui --version

# 3. æŠ“åŒ…ç¯å¢ƒå·²é…ç½®ï¼ˆå¯é€‰ï¼‰
# å‚è€ƒ: network_sniffing.md
</code></pre>
<hr />
<h2 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h2>
<h2 id="ç¬¬-1-æ­¥è¯†åˆ«åŠ å¯†ç®—æ³•5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ï¼ˆ5
åˆ†é’Ÿï¼‰</h2>
<h2 id="æœç´¢ç‰¹å¾å­—ç¬¦ä¸²"># # 1.1 æœç´¢ç‰¹å¾å­—ç¬¦ä¸²</h2>
<ul>
<li><em>ç”¨ jadx-gui æ‰“å¼€ APK</em>ï¼Œå…¨å±€æœç´¢ï¼š</li>
</ul>
<pre><code>
# éå¯¹ç§°åŠ å¯†
RSA
ECC

# å“ˆå¸Œç®—æ³•
MD5
SHA
SHA256
HMAC

# åŠ å¯†æ¨¡å¼
ECB
CBC
CTR
GCM

# Padding
PKCS5Padding
PKCS7Padding

# Encode
Base64
</code></pre>
<div class="sourceCode" id="cb251"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Java LayerEncrypt API</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>javax<span class="op">.</span><span class="fu">crypto</span><span class="op">.</span><span class="fu">Cipher</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>javax<span class="op">.</span><span class="fu">crypto</span><span class="op">.</span><span class="fu">spec</span><span class="op">.</span><span class="fu">SecretKeySpec</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>javax<span class="op">.</span><span class="fu">crypto</span><span class="op">.</span><span class="fu">spec</span><span class="op">.</span><span class="fu">IvParameterSpec</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>javax<span class="op">.</span><span class="fu">crypto</span><span class="op">.</span><span class="fu">Mac</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>java<span class="op">.</span><span class="fu">security</span><span class="op">.</span><span class="fu">Signature</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>java<span class="op">.</span><span class="fu">security</span><span class="op">.</span><span class="fu">MessageDigest</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Base64 Encode</span></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>android<span class="op">.</span><span class="fu">util</span><span class="op">.</span><span class="fu">Base64</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>java<span class="op">.</span><span class="fu">util</span><span class="op">.</span><span class="fu">Base64</span></span></code></pre></div>
<p>unzip app.apk -d app_unzipped</p>
<h1 id="search-.so-fileinencryptlibrary">Search .so
FileInEncryptLibrary</h1>
<p>strings app<em>unzipped/lib/</em>/lib_.so | grep -i -E
â€œopenssl|crypto|encrypt|aes|rsaâ€</p>
<h1 id="or-ç”¨-toolanalyze">or ç”¨ ToolAnalyze</h1>
<p>rabin2 -z app_unzipped/lib/arm64-v8a/libnative.so | grep -i
encrypt</p>
<pre><code>
_ç¤ºä¾‹_ï¼šå‡è®¾ä½ æœåˆ°äº† `AES/CBC/PKCS5Padding`

1. åœ¨ jadx ä¸­ç‚¹å‡»è¿™ä¸ªå­—ç¬¦ä¸²
2. æŸ¥çœ‹äº¤å‰å¼•ç”¨ï¼ˆ`X` é”®æˆ–å³é”® â†’ Find Usageï¼‰
3. è·³è½¬åˆ°ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°

_å…¸å‹ä»£ç æ¨¡å¼_ï¼š

```java
// ä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç 
public static String encrypt(String plaintext) {
Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);
SecretKeySpec key = new SecretKeySpec(KEY_BYTES, &quot;AES&quot;);
IvParameterSpec iv = new IvParameterSpec(IV_BYTES);
cipher.init(Cipher.ENCRYPT_MODE, key, iv);
byte[] encrypted = cipher.doFinal(plaintext.getBytes());
return Base64.encodeToString(encrypted, Base64.DEFAULT);
}
</code></pre>
<p>å¯†é’¥ Variable: KEY_BYTES IV Variable: IV_BYTES EncryptFunction:
com.example.app.CryptoUtils.encrypt()</p>
<pre><code>
&lt;details&gt;
&lt;summary&gt;&lt;b&gt;ğŸ“ ä½ç½® 1: Java ä»£ç ç¡¬ç¼–ç ï¼ˆéš¾åº¦ï¼šï¼‰&lt;/b&gt;&lt;/summary&gt;

* *æŸ¥æ‰¾æ–¹æ³•**ï¼š

```java
// æœç´¢å…³é”®è¯
SecretKeySpec
byte[] key
private static final byte[]
</code></pre>
<p>private static final byte[] KEY = { 0x12, 0x34, 0x56, 0x78, 0x9a,
0xbc, 0xde, 0xf0, // â€¦ 16/24/32 å­—èŠ‚ };</p>
<pre><code>- AES-256: 32 å­—èŠ‚


&lt;/details&gt;

&lt;details&gt;
&lt;summary&gt;&lt;b&gt;ğŸ“ ä½ç½® 2: èµ„æºæ–‡ä»¶ï¼ˆéš¾åº¦ï¼šï¼‰&lt;/b&gt;&lt;/summary&gt;

* *æŸ¥æ‰¾è·¯å¾„**ï¼š

```bash
# Check assets Directory
ls app_unzipped/assets/

# Check res/raw
ls app_unzipped/res/raw/

# æœç´¢äºŒè¿›åˆ¶æ–‡ä»¶
find app_unzipped -type f -exec file {} \; | grep data
</code></pre>
<ul>
<li><code>secret.key</code></li>
</ul>
</details>
<details>
<summary>
<b>ğŸ“ ä½ç½® 3: Native (.so) ç¡¬ç¼–ç ï¼ˆéš¾åº¦ï¼šï¼‰</b>
</summary>
<ul>
<li><em>IDA Pro åˆ†æ</em>ï¼š</li>
</ul>
<ol type="1">
<li>æ‰“å¼€ <code>.so</code> æ–‡ä»¶</li>
<li>è·³è½¬åˆ° <strong>Strings</strong> çª—å£ (<code>Shift+F12</code>)</li>
<li>æœç´¢å…³é”®å­—ç¬¦ä¸²</li>
<li>æŸ¥çœ‹äº¤å‰å¼•ç”¨æ‰¾åˆ°ä½¿ç”¨å¯†é’¥çš„å‡½æ•°</li>
</ol>
<ul>
<li><em>Ghidra åˆ†æ</em>ï¼š</li>
</ul>
<ol type="1">
<li>å¯¼å…¥ <code>.so</code> æ–‡ä»¶</li>
<li>æœç´¢ â†’ For Strings</li>
<li>ç­›é€‰é•¿åº¦ä¸º 16/24/32 çš„å¯ç–‘å­—ç¬¦ä¸²</li>
</ol>
</details>
<details>
<summary>
<b>ğŸ“ ä½ç½® 4: åŠ¨æ€ç”Ÿæˆï¼ˆéš¾åº¦ï¼šï¼‰</b>
</summary>
<p><em>ç‰¹å¾</em>ï¼šå¯†é’¥é€šè¿‡ç®—æ³•è®¡ç®—ï¼Œå¸¸è§æ–¹å¼ï¼š</p>
<div class="sourceCode" id="cb255"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co">// åŸºäºè®¾å¤‡ä¿¡æ¯ç”Ÿæˆ</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> deviceId <span class="op">=</span> <span class="fu">getDeviceId</span><span class="op">();</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="dt">byte</span><span class="op">[]</span> key <span class="op">=</span> <span class="fu">MD5</span><span class="op">(</span>deviceId <span class="op">+</span> SALT<span class="op">);</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="co">// åŸºäºæ—¶é—´æˆ³</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> timestamp <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">currentTimeMillis</span><span class="op">();</span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="dt">byte</span><span class="op">[]</span> key <span class="op">=</span> <span class="fu">HMACSHA256</span><span class="op">(</span>timestamp<span class="op">,</span> SECRET<span class="op">);</span></span></code></pre></div>
<p><em>ç‰¹å¾</em>ï¼š</p>
<ul>
<li>å¯åŠ¨æ—¶ä»æœåŠ¡å™¨è·å–å¯†é’¥</li>
<li>å¯èƒ½ç»è¿‡ RSA åŠ å¯†ä¼ è¾“</li>
</ul>
<p><em>å¯¹ç­–</em>ï¼š</p>
<ol type="1">
<li>æŠ“åŒ…æŸ¥çœ‹å¯†é’¥ä¼ è¾“</li>
<li>Hook ç½‘ç»œè¯·æ±‚è·å–å¯†é’¥</li>
<li>æˆ–ç›´æ¥ Hook åŠ å¯†å‡½æ•°ï¼ˆå¯†é’¥å·²åœ¨å†…å­˜ä¸­ï¼‰</li>
</ol>
</details>
<hr />
<h2 id="ç¬¬-4-æ­¥åŠ¨æ€æå–å¯†é’¥15-åˆ†é’Ÿ"># ç¬¬ 4 æ­¥ï¼šåŠ¨æ€æå–å¯†é’¥ï¼ˆ15
åˆ†é’Ÿï¼‰</h2>
<p><em>ç»ˆçº§æ–¹æ³•</em>ï¼šæ— è®ºå¯†é’¥è—åœ¨å“ªï¼Œåªè¦åŠ å¯†å‡½æ•°è¢«è°ƒç”¨ï¼ŒHook
å°±èƒ½æŠ“åˆ°</p>
<h2 id="hook-java-å±‚åŠ å¯†"># # 4.1 Hook Java å±‚åŠ å¯†</h2>
<p><em>é€šç”¨ AES Hook è„šæœ¬</em> <code>dump_aes_key.js</code>ï¼š</p>
<div class="sourceCode" id="cb256"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> [Crypto Hook] started</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook Cipher.init</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Cipher <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.crypto.Cipher&quot;</span>)<span class="op">;</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>Cipher<span class="op">.</span><span class="at">init</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;int&quot;</span><span class="op">,</span></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.security.Key&quot;</span><span class="op">,</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.security.spec.AlgorithmParameterSpec&quot;</span></span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (opmode<span class="op">,</span> key<span class="op">,</span> spec) {</span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">ğŸ” [Cipher.init] captured!&quot;</span>)<span class="op">;</span></span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a><span class="co">// æ¨¡å¼</span></span>
<span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mode <span class="op">=</span> opmode <span class="op">==</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">&quot;ENCRYPT&quot;</span> <span class="op">:</span> <span class="st">&quot;DECRYPT&quot;</span><span class="op">;</span></span>
<span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; mode: &quot;</span> <span class="op">+</span> mode)<span class="op">;</span></span>
<span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a><span class="co">// ç®—æ³•</span></span>
<span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; algo: &quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAlgorithm</span>())<span class="op">;</span></span>
<span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a><span class="co">// æå–å¯†é’¥</span></span>
<span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> secretKey <span class="op">=</span> Java<span class="op">.</span><span class="fu">cast</span>(</span>
<span id="cb256-23"><a href="#cb256-23" aria-hidden="true" tabindex="-1"></a>key<span class="op">,</span></span>
<span id="cb256-24"><a href="#cb256-24" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.crypto.spec.SecretKeySpec&quot;</span>)</span>
<span id="cb256-25"><a href="#cb256-25" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb256-26"><a href="#cb256-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> keyBytes <span class="op">=</span> secretKey<span class="op">.</span><span class="fu">getEncoded</span>()<span class="op">;</span></span>
<span id="cb256-27"><a href="#cb256-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Base64 <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;android.util.Base64&quot;</span>)<span class="op">;</span></span>
<span id="cb256-28"><a href="#cb256-28" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; key (Base64): &quot;</span> <span class="op">+</span> Base64<span class="op">.</span><span class="fu">encodeToString</span>(keyBytes<span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb256-29"><a href="#cb256-29" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; key (Hex): &quot;</span> <span class="op">+</span> <span class="fu">bytesToHex</span>(keyBytes))<span class="op">;</span></span>
<span id="cb256-30"><a href="#cb256-30" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb256-31"><a href="#cb256-31" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; key classNames: &quot;</span> <span class="op">+</span> key<span class="op">.</span><span class="at">$className</span>)<span class="op">;</span></span>
<span id="cb256-32"><a href="#cb256-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb256-33"><a href="#cb256-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-34"><a href="#cb256-34" aria-hidden="true" tabindex="-1"></a><span class="co">// æå– IV</span></span>
<span id="cb256-35"><a href="#cb256-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (spec) {</span>
<span id="cb256-36"><a href="#cb256-36" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb256-37"><a href="#cb256-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ivSpec <span class="op">=</span> Java<span class="op">.</span><span class="fu">cast</span>(</span>
<span id="cb256-38"><a href="#cb256-38" aria-hidden="true" tabindex="-1"></a>spec<span class="op">,</span></span>
<span id="cb256-39"><a href="#cb256-39" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.crypto.spec.IvParameterSpec&quot;</span>)</span>
<span id="cb256-40"><a href="#cb256-40" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb256-41"><a href="#cb256-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ivBytes <span class="op">=</span> ivSpec<span class="op">.</span><span class="fu">getIV</span>()<span class="op">;</span></span>
<span id="cb256-42"><a href="#cb256-42" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; IV (Hex): &quot;</span> <span class="op">+</span> <span class="fu">bytesToHex</span>(ivBytes))<span class="op">;</span></span>
<span id="cb256-43"><a href="#cb256-43" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {}</span>
<span id="cb256-44"><a href="#cb256-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb256-45"><a href="#cb256-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-46"><a href="#cb256-46" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">init</span>(opmode<span class="op">,</span> key<span class="op">,</span> spec)<span class="op">;</span></span>
<span id="cb256-47"><a href="#cb256-47" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb256-48"><a href="#cb256-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-49"><a href="#cb256-49" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook Cipher.doFinal</span></span>
<span id="cb256-50"><a href="#cb256-50" aria-hidden="true" tabindex="-1"></a>Cipher<span class="op">.</span><span class="at">doFinal</span><span class="op">.</span><span class="fu">overload</span>(<span class="st">&quot;[B&quot;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (input) {</span>
<span id="cb256-51"><a href="#cb256-51" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">doFinal</span>(input)<span class="op">;</span></span>
<span id="cb256-52"><a href="#cb256-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-53"><a href="#cb256-53" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">ğŸ“¦ [Cipher.doFinal] captured!&quot;</span>)<span class="op">;</span></span>
<span id="cb256-54"><a href="#cb256-54" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; InputLength: &quot;</span> <span class="op">+</span> input<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb256-55"><a href="#cb256-55" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; OutputLength: &quot;</span> <span class="op">+</span> result<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb256-56"><a href="#cb256-56" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb256-57"><a href="#cb256-57" aria-hidden="true" tabindex="-1"></a><span class="st">&quot; InputData (first 32 bytes): &quot;</span> <span class="op">+</span> <span class="fu">bytesToHex</span>(input<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">32</span>))</span>
<span id="cb256-58"><a href="#cb256-58" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb256-59"><a href="#cb256-59" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb256-60"><a href="#cb256-60" aria-hidden="true" tabindex="-1"></a><span class="st">&quot; OutputData (first 32 bytes): &quot;</span> <span class="op">+</span> <span class="fu">bytesToHex</span>(result<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">32</span>))</span>
<span id="cb256-61"><a href="#cb256-61" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb256-62"><a href="#cb256-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-63"><a href="#cb256-63" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb256-64"><a href="#cb256-64" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb256-65"><a href="#cb256-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-66"><a href="#cb256-66" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bytesToHex</span>(bytes) {</span>
<span id="cb256-67"><a href="#cb256-67" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> hex <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb256-68"><a href="#cb256-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> bytes<span class="op">.</span><span class="at">length</span> <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="dv">32</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb256-69"><a href="#cb256-69" aria-hidden="true" tabindex="-1"></a>hex<span class="op">.</span><span class="fu">push</span>((<span class="st">&quot;0&quot;</span> <span class="op">+</span> (bytes[i] <span class="op">&amp;</span> <span class="bn">0xff</span>)<span class="op">.</span><span class="fu">toString</span>(<span class="dv">16</span>))<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb256-70"><a href="#cb256-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb256-71"><a href="#cb256-71" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> hex<span class="op">.</span><span class="fu">join</span>(<span class="st">&quot; &quot;</span>)<span class="op">;</span></span>
<span id="cb256-72"><a href="#cb256-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb256-73"><a href="#cb256-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-74"><a href="#cb256-74" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ… [Crypto Hook] configured</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb256-75"><a href="#cb256-75" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<pre><code>key (Base64): MTIzNDU2Nzg5MGFiY2RlZg==
å¯†é’¥ (Hex): 31 32 33 34 35 36 37 38 39 30 61 62 63 64 65 66
IV (Hex): 66 65 64 63 62 61 30 39 38 37 36 35 34 33 32 31

ğŸ“¦ [Cipher.doFinal] captured!
InputLength: 128
OutputLength: 144
InputData (first 32 bytes): 7b 22 75 73 65 72 6e 61 6d 65 22 3a ...
OutputData (first 32 bytes): a3 b2 c1 d0 e4 f5 ...
</code></pre>
<h1 id="ä½¿ç”¨nmæŸ¥çœ‹å‡½æ•°">ä½¿ç”¨nmæŸ¥çœ‹å‡½æ•°</h1>
<p>nm -D libnative.so | grep -i encrypt</p>
<h1 id="ä½¿ç”¨frida">ä½¿ç”¨Frida</h1>
<p>frida -U -f com.example.app &gt;
Module.enumerateExports(â€˜libnative.soâ€™).filter(e =&gt;
e.name.includes(â€˜encryptâ€™))</p>
<pre><code>
Interceptor.attach(Module.findExportByName(&#39;libnative.so&#39;, &#39;Java_com_example_Crypto_encrypt&#39;), {
onEnter: function(args) {
console.log(&quot;\n [Native Encrypt] Call!&quot;);

// args[0] = JNIEnv*
// args[1] = jclass
// args[2] = ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆé€šå¸¸æ˜¯æ˜æ–‡ï¼‰
// args[3] = ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯èƒ½æ˜¯å¯†é’¥ï¼‰

// è¯»å–å­—ç¬¦ä¸²å‚æ•°
var plaintext = Java.vm.getEnv().getStringUtfChars(args[2], null).readCString();
console.log(&quot; æ˜æ–‡: &quot; + plaintext);

// è¯»å–å­—èŠ‚æ•°ç»„å‚æ•°
this.keyPtr = args[3]; // ä¿å­˜æŒ‡é’ˆç”¨äºåç»­è¯»å–
},
onLeave: function(retval) {
// retval æ˜¯è¿”å›å€¼ï¼ˆå¯†æ–‡ï¼‰
console.log(&quot; è¿”å›å€¼: &quot; + retval);
}

});
</code></pre>
<ol type="1">
<li>é€‰æ‹©æ“ä½œï¼š<code>AES Decrypt</code></li>
<li>è¾“å…¥ï¼š</li>
</ol>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Key</strong> (Hex)</td>
<td><code>31 32 33 34 ...</code></td>
</tr>
<tr>
<td><strong>IV</strong> (Hex)</td>
<td><code>66 65 64 63 ...</code></td>
</tr>
<tr>
<td><strong>Mode</strong></td>
<td><code>CBC</code></td>
</tr>
<tr>
<td><strong>Input</strong></td>
<td>å¯†æ–‡ï¼ˆBase64 æˆ– Hexï¼‰</td>
</tr>
<tr>
<td><strong>Key</strong> (Hex)</td>
<td><code>31 32 33 34 ...</code></td>
</tr>
<tr>
<td><strong>IV</strong> (Hex)</td>
<td><code>66 65 64 63 ...</code></td>
</tr>
<tr>
<td><strong>Mode</strong></td>
<td><code>CBC</code></td>
</tr>
<tr>
<td><strong>Input</strong></td>
<td>å¯†æ–‡ï¼ˆBase64 æˆ– Hexï¼‰</td>
</tr>
</tbody>
</table>
<ol start="3" type="1">
<li>ç‚¹å‡» <strong>Bake!</strong></li>
</ol>
<ul>
<li>*å¦‚æœè§£å¯†æˆåŠŸ**ï¼Œè¯´æ˜å¯†é’¥æ­£ç¡®ï¼</li>
</ul>
<h2 id="python-è„šæœ¬éªŒè¯"># 5.2 Python è„šæœ¬éªŒè¯</h2>
<div class="sourceCode" id="cb259"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> Crypto.Cipher <span class="im">import</span> AES</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> Crypto.Util.Padding <span class="im">import</span> unpad</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ä» Frida è·å–å¯†é’¥å’Œ IVï¼ˆHex è½¬ bytesï¼‰</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> <span class="bu">bytes</span>.fromhex(<span class="st">&#39;31 32 33 34 35 36 37 38 39 30 61 62 63 64 65 66&#39;</span>)</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>iv <span class="op">=</span> <span class="bu">bytes</span>.fromhex(<span class="st">&#39;66 65 64 63 62 61 30 39 38 37 36 35 34 33 32 31&#39;</span>)</span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ä»æŠ“åŒ…è·å–å¯†æ–‡</span></span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>ciphertext <span class="op">=</span> base64.b64decode(<span class="st">&#39;YWJjZGVmZ2hpamtsbW5vcA==&#39;</span>)</span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a><span class="co"># è§£å¯†</span></span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a>cipher <span class="op">=</span> AES.new(key, AES.MODE_CBC, iv)</span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a>plaintext <span class="op">=</span> unpad(cipher.decrypt(ciphertext), AES.block_size)</span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;è§£å¯†ç»“æœ:&quot;</span>, plaintext.decode())</span></code></pre></div>
<p>Java.perform(function() { var CryptoUtils =
Java.use(â€˜com.example.app.CryptoUtilsâ€™);</p>
<p>// CallEncryptFunction var encrypted = CryptoUtils.encrypt(â€œHello
Worldâ€); console.log(â€œEncryptResult:â€ + encrypted);</p>
<p>// CallDecryptFunction var decrypted =
CryptoUtils.decrypt(encrypted); console.log(â€œDecryptResult:â€ +
decrypted);</p>
<p>});</p>
<pre><code>
| ç®—æ³•ç±»å‹ | ç®—æ³• | å¯†é’¥é•¿åº¦ | ç”¨é€” |
| -------------- | ------- | ------------------ | ---------------- |
| **å¯¹ç§°åŠ å¯†** | AES | 128/192/256 bit | åŠ å¯†æ•°æ® |
| | DES | 56 bit | æ—§æ ‡å‡†ï¼ˆä¸å®‰å…¨ï¼‰ |
| | 3DES | 168 bit | DES å¢å¼ºç‰ˆ |
| **éå¯¹ç§°åŠ å¯†** | RSA | 1024/2048/4096 bit | å¯†é’¥äº¤æ¢ã€ç­¾å |
| | ECC | 256/384/521 bit | RSA çš„é«˜æ•ˆæ›¿ä»£ |
| **å“ˆå¸Œ** | MD5 | 128 bit è¾“å‡º | æ ¡éªŒï¼ˆä¸å®‰å…¨ï¼‰ |
| | SHA-256 | 256 bit è¾“å‡º | å®‰å…¨å“ˆå¸Œ |
| | HMAC | å¯å˜ | å¸¦å¯†é’¥çš„å“ˆå¸Œ |

## # AES åŠ å¯†æµç¨‹
</code></pre>
<p><a href="#aes-encrypt">AES Encrypt</a> â† Use å¯†é’¥ + IV â†“ å¯†æ–‡ Data â†“
[Base64 Encode] â† ä¾¿äºä¼ è¾“ â†“ æœ€ç»ˆå¯†æ–‡</p>
<pre><code>
- --

## å¸¸è§é—®é¢˜

## # âŒ é—®é¢˜ 1: Hook è„šæœ¬ä¸ç”Ÿæ•ˆ

_ç—‡çŠ¶_ï¼šè¿è¡Œ Frida è„šæœ¬åæ²¡æœ‰ä»»ä½•è¾“å‡º

_æ£€æŸ¥_ï¼š

1. **ç¡®è®¤åŠ å¯†å‡½æ•°è¢«è°ƒç”¨äº†å—ï¼Ÿ**

```javascript
Java.use(&quot;javax.crypto.Cipher&quot;).$init.overload().implementation = function () {
console.log(&quot;[TEST] Cipher å®ä¾‹åŒ–&quot;);
return this.$init();
};
</code></pre>
<p>â†’ æ”¹ç”¨ Native Hook</p>
<ol start="3" type="1">
<li><strong>ç±»åå¯èƒ½è¢«æ··æ·†</strong> â†’ æœç´¢æ‰€æœ‰åŒ…å« <code>Cipher</code>
çš„ç±»ï¼š</li>
</ol>
<div class="sourceCode" id="cb262"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">enumerateLoadedClasses</span>({</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="dt">onMatch</span><span class="op">:</span> <span class="kw">function</span> (className) {</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (className<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;cipher&quot;</span>)) {</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(className)<span class="op">;</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="dt">onComplete</span><span class="op">:</span> <span class="kw">function</span> () {}<span class="op">,</span></span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><em>å¯èƒ½åŸå› </em>ï¼š</p>
<ol type="1">
<li><strong>IV ä¸æ­£ç¡®</strong></li>
</ol>
<ul>
<li>ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† IV</li>
<li>æŸäº›å®ç°ä¼šå°† IV é™„åŠ åœ¨å¯†æ–‡å¼€å¤´</li>
</ul>
<ol start="2" type="1">
<li><strong>Padding ä¸åŒ¹é…</strong></li>
</ol>
<ul>
<li>å°è¯•ä¸åŒçš„ Paddingï¼š<code>PKCS5Padding</code>,
<code>PKCS7Padding</code>, <code>NoPadding</code></li>
</ul>
<ol start="3" type="1">
<li><strong>ç¼–ç é—®é¢˜</strong></li>
</ol>
<div class="sourceCode" id="cb263"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å°è¯•ä¸åŒç¼–ç </span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>ciphertext <span class="op">=</span> base64.b64decode(data) <span class="co"># Base64</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>ciphertext <span class="op">=</span> <span class="bu">bytes</span>.fromhex(data) <span class="co"># Hex</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>ciphertext <span class="op">=</span> data.encode() <span class="co"># UTF-8</span></span></code></pre></div>
<ul>
<li>å¯èƒ½ä½¿ç”¨äº† PBKDF2 ç­‰å¯†é’¥æ´¾ç”Ÿå‡½æ•°</li>
<li>Hook <code>SecretKeyFactory.generateSecret()</code> æŸ¥çœ‹</li>
</ul>
<h2 id="é—®é¢˜-3-native-å‡½æ•°æ‰¾ä¸åˆ°"># âŒ é—®é¢˜ 3: Native å‡½æ•°æ‰¾ä¸åˆ°</h2>
<p><em>ç—‡çŠ¶</em>ï¼š<code>Module.findExportByName()</code> è¿”å›
<code>null</code></p>
<p><em>è§£å†³</em>ï¼š</p>
<ol type="1">
<li><strong>å‡½æ•°å¯èƒ½æœªå¯¼å‡º</strong></li>
</ol>
<div class="sourceCode" id="cb264"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹æ‰€æœ‰ç¬¦å·ï¼ˆåŒ…æ‹¬æœªå¯¼å‡ºï¼‰</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-s</span> libnative.so <span class="kw">|</span> <span class="fu">grep</span> encrypt</span></code></pre></div>
<div class="sourceCode" id="cb265"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> baseAddr <span class="op">=</span> Module<span class="op">.</span><span class="fu">findBaseAddress</span>(<span class="st">&#39;libnative.so&#39;</span>)<span class="op">;</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> funcAddr <span class="op">=</span> baseAddr<span class="op">.</span><span class="fu">add</span>(<span class="bn">0x1234</span>)<span class="op">;</span> <span class="co">// ä» IDA è·å–åç§»</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(funcAddr<span class="op">,</span> { <span class="op">...</span> })<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb266"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook RegisterNatives</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> RegisterNatives <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;libart.so&quot;</span><span class="op">,</span></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi&quot;</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(RegisterNatives<span class="op">,</span> {</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> methods <span class="op">=</span> <span class="fu">ptr</span>(args[<span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Register JNI Method:&quot;</span><span class="op">,</span> methods<span class="op">.</span><span class="fu">readCString</span>())<span class="op">;</span></span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><em>ç—‡çŠ¶</em>ï¼š</p>
<div class="sourceCode" id="cb267"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co">// çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç </span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="bu">SecretKeySpec</span> key <span class="op">=</span> <span class="kw">new</span> <span class="bu">SecretKeySpec</span><span class="op">(</span><span class="st">&quot;MyPassword123&quot;</span><span class="op">.</span><span class="fu">getBytes</span><span class="op">(),</span> <span class="st">&quot;AES&quot;</span><span class="op">);</span></span></code></pre></div>
<p><em>è§£å†³æ–¹æ¡ˆ</em>ï¼š</p>
<ul>
<li>*1. ä½¿ç”¨å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆKDFï¼‰**</li>
</ul>
<div class="sourceCode" id="cb268"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> Crypto.Protocol.KDF <span class="im">import</span> PBKDF2</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>password <span class="op">=</span> <span class="st">&quot;MyPassword123&quot;</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>salt <span class="op">=</span> <span class="st">b&quot;somesalt&quot;</span> <span class="co"># éœ€è¦ä»ä»£ç ä¸­æ‰¾åˆ°</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> PBKDF2(password, salt, dkLen<span class="op">=</span><span class="dv">16</span>) <span class="co"># 16 å­—èŠ‚ AES-128</span></span></code></pre></div>
<ul>
<li><p><code>PBKDF2</code>
ä¼šå°†ä»»æ„é•¿åº¦çš„å¯†ç æ´¾ç”Ÿä¸ºå›ºå®šé•¿åº¦çš„å¯†é’¥</p></li>
<li><p><code>salt</code> é€šå¸¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æˆ–ä»æœåŠ¡å™¨è·å–</p></li>
<li><p><code>dkLen</code> å†³å®šè¾“å‡ºå¯†é’¥é•¿åº¦ï¼š16 (AES-128) / 24 (AES-192)
/ 32 (AES-256)</p></li>
<li><p>*2. Hook å¯†é’¥æ´¾ç”Ÿå‡½æ•°**</p></li>
</ul>
<div class="sourceCode" id="cb269"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SecretKeyFactory <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.crypto.SecretKeyFactory&quot;</span>)<span class="op">;</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>SecretKeyFactory<span class="op">.</span><span class="at">generateSecret</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (keySpec) {</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> key <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">generateSecret</span>(keySpec)<span class="op">;</span></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[å¯†é’¥æ´¾ç”Ÿ] ç®—æ³•:&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAlgorithm</span>())<span class="op">;</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[å¯†é’¥æ´¾ç”Ÿ] å¯†é’¥ (Hex):&quot;</span><span class="op">,</span> <span class="fu">bytesToHex</span>(key<span class="op">.</span><span class="fu">getEncoded</span>()))<span class="op">;</span></span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co">// å°è¯•è·å– saltï¼ˆå¦‚æœæ˜¯ PBEKeySpecï¼‰</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PBEKeySpec <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.crypto.spec.PBEKeySpec&quot;</span>)<span class="op">;</span></span>
<span id="cb269-10"><a href="#cb269-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pbeSpec <span class="op">=</span> Java<span class="op">.</span><span class="fu">cast</span>(keySpec<span class="op">,</span> PBEKeySpec)<span class="op">;</span></span>
<span id="cb269-11"><a href="#cb269-11" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[å¯†é’¥æ´¾ç”Ÿ] Salt:&quot;</span><span class="op">,</span> <span class="fu">bytesToHex</span>(pbeSpec<span class="op">.</span><span class="fu">getSalt</span>()))<span class="op">;</span></span>
<span id="cb269-12"><a href="#cb269-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[å¯†é’¥æ´¾ç”Ÿ] è¿­ä»£æ¬¡æ•°:&quot;</span><span class="op">,</span> pbeSpec<span class="op">.</span><span class="fu">getIterationCount</span>())<span class="op">;</span></span>
<span id="cb269-13"><a href="#cb269-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {}</span>
<span id="cb269-14"><a href="#cb269-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-15"><a href="#cb269-15" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> key<span class="op">;</span></span>
<span id="cb269-16"><a href="#cb269-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb270"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># åœ¨ä»£ç ä¸­æœç´¢</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jadx-gui</span> app.apk</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="co"># æœç´¢: getBytes()ã€&quot;password&quot;ã€&quot;secret&quot;ã€&quot;key&quot;</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="co"># åœ¨ Frida ä¸­æšä¸¾æ‰€æœ‰å­—ç¬¦ä¸²å­—æ®µ</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Java.perform</span><span class="er">(</span><span class="kw">function()</span> <span class="kw">{</span></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Java.choose</span><span class="er">(</span><span class="st">&quot;com.example.CryptoUtils&quot;</span><span class="ex">,</span> {</span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a><span class="ex">onMatch:</span> function<span class="er">(</span><span class="ex">instance</span><span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a><span class="ex">console.log</span><span class="er">(</span><span class="st">&quot;Found instance:&quot;</span><span class="ex">,</span> instance<span class="kw">);</span></span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a><span class="ex">//</span> æ‰“å°æ‰€æœ‰å­—æ®µ</span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a><span class="ex">var</span> fields = instance.class.getDeclaredFields<span class="er">(</span><span class="kw">);</span></span>
<span id="cb270-12"><a href="#cb270-12" aria-hidden="true" tabindex="-1"></a><span class="ex">fields.forEach</span><span class="er">(</span><span class="kw">function(</span><span class="ex">field</span><span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb270-13"><a href="#cb270-13" aria-hidden="true" tabindex="-1"></a><span class="ex">field.setAccessible</span><span class="er">(</span><span class="fu">true</span><span class="kw">);</span></span>
<span id="cb270-14"><a href="#cb270-14" aria-hidden="true" tabindex="-1"></a><span class="ex">console.log</span><span class="er">(</span><span class="fu">field.getName()</span> <span class="ex">+</span> <span class="st">&quot;:&quot;</span>, field.get<span class="er">(</span><span class="ex">instance</span><span class="kw">));</span></span>
<span id="cb270-15"><a href="#cb270-15" aria-hidden="true" tabindex="-1"></a><span class="kw">});</span></span>
<span id="cb270-16"><a href="#cb270-16" aria-hidden="true" tabindex="-1"></a><span class="ex">},</span></span>
<span id="cb270-17"><a href="#cb270-17" aria-hidden="true" tabindex="-1"></a><span class="ex">onComplete:</span> function<span class="er">(</span><span class="kw">)</span> <span class="ex">{}</span></span>
<span id="cb270-18"><a href="#cb270-18" aria-hidden="true" tabindex="-1"></a><span class="kw">});</span></span>
<span id="cb270-19"><a href="#cb270-19" aria-hidden="true" tabindex="-1"></a><span class="kw">});</span></span></code></pre></div>
<div class="sourceCode" id="cb271"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> Crypto.Cipher <span class="im">import</span> AES</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> Crypto.Util.Padding <span class="im">import</span> unpad</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ä»ä»£ç ä¸­æ‰¾åˆ°çš„å­—ç¬¦ä¸²å¯†ç </span></span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>password <span class="op">=</span> <span class="st">&quot;MyPassword123&quot;</span></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a><span class="co"># æ–¹æ³• 1: ç›´æ¥ä½¿ç”¨å‰ 16 å­—èŠ‚</span></span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> password.encode()[:<span class="dv">16</span>].ljust(<span class="dv">16</span>, <span class="st">b&#39;</span><span class="ch">\0</span><span class="st">&#39;</span>)</span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a><span class="co"># æ–¹æ³• 2: MD5 å“ˆå¸Œï¼ˆå¸¸è§åšæ³•ï¼Œè¾“å‡ºæ­£å¥½ 16 å­—èŠ‚ï¼‰</span></span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> hashlib.md5(password.encode()).digest()</span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a><span class="co"># æ–¹æ³• 3: SHA256 å‰ 16 å­—èŠ‚</span></span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> hashlib.sha256(password.encode()).digest()[:<span class="dv">16</span>]</span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ç„¶åç”¨äºè§£å¯†</span></span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a>cipher <span class="op">=</span> AES.new(key, AES.MODE_CBC, iv)</span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a>plaintext <span class="op">=</span> unpad(cipher.decrypt(ciphertext), AES.block_size)</span></code></pre></div>
<h2 id="å»¶ä¼¸é˜…è¯»">å»¶ä¼¸é˜…è¯»</h2>
<h2 id="ç›¸å…³-recipes-1"># ç›¸å…³é…æ–¹</h2>
<ul>
<li><strong><a href="./network_sniffing.md">ç½‘ç»œæŠ“åŒ…</a></strong> -
è·å–åŠ å¯†åçš„æ•°æ®æ ·æœ¬</li>
<li><strong><a href="../Anti-Detection/frida_anti_debugging.md">Frida
åè°ƒè¯•</a></strong> - å¦‚æœ App æ£€æµ‹åˆ° Hook</li>
<li><strong><a href="../../01-Recipes/Scripts/native_hooking.md">Native
Hook æ¨¡å¼</a></strong> - æ·±å…¥ Native å±‚åˆ†æ</li>
</ul>
<h2 id="å·¥å…·æ·±å…¥-2"># å·¥å…·æ·±å…¥</h2>
<ul>
<li><strong><a href="../../02-Tools/Dynamic/frida_guide.md">Frida
å®Œæ•´æŒ‡å—</a></strong></li>
<li><strong><a href="../../02-Tools/Static/ida_pro_guide.md">IDA Pro
ä½¿ç”¨</a></strong></li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-1"># æ¡ˆä¾‹åˆ†æ</h2>
<ul>
<li><strong><a href="../../03-Case-Studies/case_music_apps.md">éŸ³ä¹ App
åˆ†æ</a></strong> - åŠ å¯†éŸ³é¢‘æ ¼å¼åˆ†æ</li>
<li><strong><a
href="../../03-Case-Studies/case_social_media_and_anti_bot.md">ç¤¾äº¤åª’ä½“é£æ§</a></strong>
- API ç­¾åç®—æ³•é€†å‘</li>
</ul>
<h2 id="ç†è®ºåŸºç¡€"># ç†è®ºåŸºç¡€</h2>
<ul>
<li><strong><a
href="../../04-Reference/Foundations/">å¯†ç å­¦åŸºç¡€çŸ¥è¯†</a></strong> -
TODO</li>
</ul>
<hr />
<h2 id="å¿«é€Ÿå‚è€ƒ-1">å¿«é€Ÿå‚è€ƒ</h2>
<h2 id="hook-è„šæœ¬æ¨¡æ¿åº“"># Hook è„šæœ¬æ¨¡æ¿åº“</h2>
<p><em>1. é€šç”¨ AES Hook</em></p>
<div class="sourceCode" id="cb272"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Cipher <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;javax.crypto.Cipher&#39;</span>)<span class="op">;</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>Cipher<span class="op">.</span><span class="at">init</span><span class="op">.</span><span class="fu">overload</span>(<span class="st">&#39;int&#39;</span><span class="op">,</span> <span class="st">&#39;java.security.Key&#39;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(opmode<span class="op">,</span> key) {</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[RSA] æ¨¡å¼:&quot;</span><span class="op">,</span> opmode <span class="op">==</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">&quot;ENCRYPT&quot;</span> <span class="op">:</span> <span class="st">&quot;DECRYPT&quot;</span>)<span class="op">;</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[RSA] å¯†é’¥ClassType:&quot;</span><span class="op">,</span> key<span class="op">.</span><span class="at">$className</span>)<span class="op">;</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Getå…¬é’¥/ç§é’¥</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (key<span class="op">.</span><span class="at">$className</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;PublicKey&quot;</span>)) {</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[RSA] å…¬é’¥:&quot;</span><span class="op">,</span> key<span class="op">.</span><span class="fu">getEncoded</span>())<span class="op">;</span></span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (key<span class="op">.</span><span class="at">$className</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;PrivateKey&quot;</span>)) {</span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[RSA] ç§é’¥:&quot;</span><span class="op">,</span> key<span class="op">.</span><span class="fu">getEncoded</span>())<span class="op">;</span></span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">init</span>(opmode<span class="op">,</span> key)<span class="op">;</span></span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Mac <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;javax.crypto.Mac&#39;</span>)<span class="op">;</span></span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a>Mac<span class="op">.</span><span class="at">init</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(key) {</span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[HMAC] ç®—æ³•:&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAlgorithm</span>())<span class="op">;</span></span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-20"><a href="#cb272-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> secretKey <span class="op">=</span> Java<span class="op">.</span><span class="fu">cast</span>(key<span class="op">,</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;javax.crypto.spec.SecretKeySpec&#39;</span>))<span class="op">;</span></span>
<span id="cb272-21"><a href="#cb272-21" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[HMAC] å¯†é’¥:&quot;</span><span class="op">,</span> secretKey<span class="op">.</span><span class="fu">getEncoded</span>())<span class="op">;</span></span>
<span id="cb272-22"><a href="#cb272-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-23"><a href="#cb272-23" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">init</span>(key)<span class="op">;</span></span>
<span id="cb272-24"><a href="#cb272-24" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb272-25"><a href="#cb272-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-26"><a href="#cb272-26" aria-hidden="true" tabindex="-1"></a>Mac<span class="op">.</span><span class="at">doFinal</span><span class="op">.</span><span class="fu">overload</span>(<span class="st">&#39;[B&#39;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(data) {</span>
<span id="cb272-27"><a href="#cb272-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">doFinal</span>(data)<span class="op">;</span></span>
<span id="cb272-28"><a href="#cb272-28" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[HMAC] Input:&quot;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb272-29"><a href="#cb272-29" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[HMAC] Output:&quot;</span><span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb272-30"><a href="#cb272-30" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb272-31"><a href="#cb272-31" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb272-32"><a href="#cb272-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-33"><a href="#cb272-33" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Base64 <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;android.util.Base64&#39;</span>)<span class="op">;</span></span>
<span id="cb272-34"><a href="#cb272-34" aria-hidden="true" tabindex="-1"></a>Base64<span class="op">.</span><span class="at">decode</span><span class="op">.</span><span class="fu">overload</span>(<span class="st">&#39;java.lang.String&#39;</span><span class="op">,</span> <span class="st">&#39;int&#39;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(str<span class="op">,</span> flags) {</span>
<span id="cb272-35"><a href="#cb272-35" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">decode</span>(str<span class="op">,</span> flags)<span class="op">;</span></span>
<span id="cb272-36"><a href="#cb272-36" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[Base64] Decode:&quot;</span>)<span class="op">;</span></span>
<span id="cb272-37"><a href="#cb272-37" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Input:&quot;</span><span class="op">,</span> str<span class="op">.</span><span class="fu">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">50</span>) <span class="op">+</span> <span class="st">&quot;...&quot;</span>)<span class="op">;</span></span>
<span id="cb272-38"><a href="#cb272-38" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Output (Hex):&quot;</span><span class="op">,</span> <span class="fu">bytesToHex</span>(result))<span class="op">;</span></span>
<span id="cb272-39"><a href="#cb272-39" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb272-40"><a href="#cb272-40" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h1 id="aes-encrypt">AES Encrypt</h1>
<p>echo â€œHelloâ€ | openssl enc -aes-128-cbc -K
3132333435363738393061626364656666 -iv
6665646362613039383736353433323120 -base64</p>
<h1 id="aes-decrypt">AES Decrypt</h1>
<p>echo â€œå¯†æ–‡â€ | base64 -d | openssl enc -d -aes-128-cbc -K â€¦ -iv â€¦</p>
<h1 id="generate-md5">Generate MD5</h1>
<p>echo -n â€œtextâ€ | openssl md5</p>
<h1 id="generate-sha256">Generate SHA256</h1>
<p>echo -n â€œtextâ€ | openssl sha256</p>
<h1 id="rsa-å¯†é’¥ç”Ÿæˆ">RSA å¯†é’¥ç”Ÿæˆ</h1>
<p>openssl genrsa -out private.pem 2048 openssl rsa -in private.pem
-pubout -out public.pem</p>
<pre><code></code></pre>
<!-- 01-Recipes/Network/ja3_fingerprinting.md -->
<h1 id="ja3-tls-æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£">JA3 TLS æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</h1>
<p>JA3 æ˜¯ä¸€ç§åˆ›å»º SSL/TLS
å®¢æˆ·ç«¯æŒ‡çº¹çš„æ–¹æ³•ï¼Œæ—¨åœ¨è½»æ¾è¯†åˆ«ç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹åŠ å¯†è¿æ¥æ—¶ï¼Œå®ƒé¦–å…ˆä¼šå‘é€ä¸€ä¸ª
<code>Client Hello</code>
åŒ…ã€‚è¿™ä¸ªåŒ…çš„æ ¼å¼å’Œå†…å®¹åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç”¨äºåˆ›å»ºè¿æ¥çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚æµè§ˆå™¨ã€æ¶æ„è½¯ä»¶ã€ç§»åŠ¨
Appï¼‰ä¸­çš„åº“å’Œæ–¹æ³•ã€‚JA3 é€šè¿‡æ”¶é›† <code>Client Hello</code>
åŒ…ä¸­ç‰¹å®šå­—æ®µçš„å€¼ï¼Œå¹¶å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªæ˜“äºå…±äº«å’Œæ¯”è¾ƒçš„ MD5
å“ˆå¸Œå€¼ï¼Œä»è€Œä¸ºå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹çš„â€æŒ‡çº¹â€ã€‚</p>
<hr />
<h2 id="ç›®å½•-1">ç›®å½•</h2>
<ul>
<li><a href="#å·¥ä½œåŸç†">å·¥ä½œåŸç†</a></li>
<li><a href="#æŒ‡çº¹ç”Ÿæˆè¿‡ç¨‹">æŒ‡çº¹ç”Ÿæˆè¿‡ç¨‹</a></li>
<li><a href="#ja3s---æœåŠ¡å™¨ç«¯æŒ‡çº¹">JA3S - æœåŠ¡å™¨ç«¯æŒ‡çº¹</a></li>
<li><a href="#åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></li>
<li><a href="#å±€é™æ€§">å±€é™æ€§</a></li>
<li><a href="#å¦‚ä½•æ£€æµ‹-ja3">å¦‚ä½•æ£€æµ‹ JA3</a></li>
</ul>
<hr />
<h3 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h3>
<p>JA3 æŒ‡çº¹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å®¢æˆ·ç«¯çš„ <code>Client Hello</code>
åŒ…æš´éœ²äº†å…¶èº«ä»½</strong>ã€‚</p>
<p>ä¸€ä¸ª <code>Client Hello</code>
åŒ…åŒ…å«äº†å®¢æˆ·ç«¯å¸Œæœ›å¦‚ä½•ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„å„ç§ç»†èŠ‚ã€‚JA3
æ–¹æ³•ç²¾ç¡®åœ°é€‰æ‹©äº†ä»¥ä¸‹ 5 ä¸ªå­—æ®µï¼Œå¹¶æŒ‰ç…§ç‰¹å®šé¡ºåºå°†å®ƒä»¬ä¸²è”èµ·æ¥ï¼š</p>
<ol type="1">
<li><strong>SSL/TLS Version (ç‰ˆæœ¬å·)</strong>: å®¢æˆ·ç«¯æ”¯æŒçš„æœ€é«˜ TLS
ç‰ˆæœ¬ã€‚</li>
<li><strong>Accepted Ciphers (åŠ å¯†å¥—ä»¶)</strong>:
å®¢æˆ·ç«¯æ„¿æ„æ¥å—çš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ŒæŒ‰å…¶åå¥½é¡ºåºæ’åˆ—ã€‚</li>
<li><strong>List of Extensions (æ‰©å±•åˆ—è¡¨)</strong>:
<code>Client Hello</code> ä¸­åŒ…å«çš„æ‰€æœ‰æ‰©å±•ï¼ŒæŒ‰å…¶å‡ºç°é¡ºåºæ’åˆ—ã€‚</li>
<li><strong>Elliptic Curves (æ¤­åœ†æ›²çº¿)</strong>:
å®¢æˆ·ç«¯æ”¯æŒçš„æ¤­åœ†æ›²çº¿åˆ—è¡¨ã€‚</li>
<li><strong>Elliptic Curve Point Formats (æ¤­åœ†æ›²çº¿ç‚¹æ ¼å¼)</strong>:
æ”¯æŒçš„ç‚¹æ ¼å¼åˆ—è¡¨ã€‚</li>
</ol>
<p>è¿™äº›å­—æ®µçš„ç»„åˆå¯¹äºç‰¹å®šçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆåŠå…¶ç‰ˆæœ¬ï¼‰æ¥è¯´é€šå¸¸æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ä¾‹å¦‚ï¼ŒChrome
æµè§ˆå™¨ã€Firefox æµè§ˆå™¨ã€Tor æµè§ˆå™¨å’Œä¸€ä¸ª Golang
ç¼–å†™çš„åƒµå°¸ç½‘ç»œç¨‹åºï¼Œå®ƒä»¬ç”Ÿæˆçš„ <code>Client Hello</code>
åœ¨è¿™äº›å­—æ®µä¸Šä¼šæœ‰æ˜æ˜¾çš„å·®å¼‚ã€‚</p>
<hr />
<h3 id="æŒ‡çº¹ç”Ÿæˆè¿‡ç¨‹">æŒ‡çº¹ç”Ÿæˆè¿‡ç¨‹</h3>
<p>ç”Ÿæˆ JA3 æŒ‡çº¹çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li><strong>æ”¶é›†å­—æ®µå€¼</strong>: ä»ä¸€ä¸ª TCP ä¼šè¯çš„
<code>Client Hello</code> åŒ…ä¸­ï¼Œæå–ä¸Šè¿° 5 ä¸ªå­—æ®µçš„åè¿›åˆ¶å€¼ã€‚</li>
<li><strong>æ ¼å¼åŒ–å’Œæ‹¼æ¥</strong>:
<ul>
<li>æ¯ä¸ªå­—æ®µå†…çš„å€¼ç”¨ <code>-</code> åˆ†éš”ã€‚</li>
<li>5 ä¸ªä¸»è¦å­—æ®µä¹‹é—´ç”¨ <code>,</code> åˆ†éš”ã€‚</li>
<li>ä¾‹å¦‚ï¼Œä¸€ä¸ª JA3
å­—ç¬¦ä¸²çœ‹èµ·æ¥åƒè¿™æ ·ï¼š<code>771,4865-4866-4867-49195-49199-...,23-65281-10-11-35-16-0-13-18,29-23-24,0</code></li>
</ul></li>
<li><strong>è®¡ç®— MD5 å“ˆå¸Œ</strong>: å¯¹ä¸Šè¿°æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²è®¡ç®— MD5
å“ˆå¸Œå€¼ã€‚</li>
<li><strong>æœ€ç»ˆæŒ‡çº¹</strong>: å¾—åˆ°çš„ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²å°±æ˜¯è¯¥å®¢æˆ·ç«¯çš„
JA3 æŒ‡çº¹ã€‚
<ul>
<li>ä¾‹å¦‚ï¼Œä¸Šè¿°å­—ç¬¦ä¸²çš„ MD5
å“ˆå¸Œå¯èƒ½æ˜¯ï¼š<code>e7d705a3286e19ea42f587b344ee6865</code>ã€‚</li>
</ul></li>
</ol>
<p>è¿™ä¸ªæœ€ç»ˆçš„ MD5 å“ˆå¸Œå°±æ˜¯å¯ç”¨äºè¯†åˆ«ã€å…±äº«å’ŒæŸ¥è¯¢çš„ JA3 æŒ‡çº¹ã€‚</p>
<hr />
<h3 id="ja3s---æœåŠ¡å™¨ç«¯æŒ‡çº¹">JA3S - æœåŠ¡å™¨ç«¯æŒ‡çº¹</h3>
<p>ä¸ JA3 å¯¹åº”ï¼Œ<strong>JA3S</strong>
æ˜¯å¯¹æœåŠ¡å™¨å“åº”çš„æŒ‡çº¹ã€‚å®ƒåŸºäºæœåŠ¡å™¨åœ¨ <code>Server Hello</code>
åŒ…ä¸­é€‰æ‹©çš„å‚æ•°ã€‚JA3S æ”¶é›†ä»¥ä¸‹å­—æ®µï¼š</p>
<ol type="1">
<li><strong>SSL/TLS Version</strong></li>
<li><strong>Selected Cipher</strong></li>
<li><strong>List of Extensions</strong></li>
</ol>
<p>å°†è¿™äº›å€¼æ‹¼æ¥å¹¶è¿›è¡Œ MD5 å“ˆå¸Œï¼Œå°±å¾—åˆ°äº† JA3S æŒ‡çº¹ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ JA3S å¾ˆé‡è¦ï¼Ÿ</strong></p>
<p>å°† JA3 å’Œ JA3S
ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æä¾›å¯¹åŠ å¯†è¿æ¥çš„æ›´å¼ºæ´å¯ŸåŠ›ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¶æ„è½¯ä»¶ (JA3)
å¯èƒ½ä¼šå°è¯•è¿æ¥å¤šä¸ªä¸åŒçš„ C2 æœåŠ¡å™¨ (ä¸åŒçš„ JA3S)ã€‚åä¹‹ï¼Œä¸€ä¸ª C2 æœåŠ¡å™¨
(JA3S) å¯èƒ½ä¼šæ¥å—æ¥è‡ªä¸åŒç±»å‹æ¶æ„è½¯ä»¶ (ä¸åŒçš„ JA3)
çš„è¿æ¥ã€‚è¿™ç§ç»„åˆåˆ†æå¯ä»¥æ›´ç²¾ç¡®åœ°æç»˜å‡ºå¨èƒæ´»åŠ¨çš„å…¨è²Œã€‚</p>
<hr />
<h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>
<ul>
<li><strong>æ¶æ„è½¯ä»¶å®¶æ—è¯†åˆ«</strong>: è®¸å¤šæ¶æ„è½¯ä»¶å®¶æ—ï¼ˆå¦‚ Trickbot,
Emotetï¼‰ä½¿ç”¨ç‰¹å®šçš„ SSL/TLS åº“ï¼Œå¯¼è‡´å®ƒä»¬å…·æœ‰ç‹¬ç‰¹ä¸”ä¸€è‡´çš„ JA3
æŒ‡çº¹ã€‚å®‰å…¨åˆ†æå¸ˆå¯ä»¥åˆ›å»ºè§„åˆ™æ¥æ£€æµ‹æˆ–é˜»æ­¢å·²çŸ¥çš„æ¶æ„ JA3 å“ˆå¸Œã€‚</li>
<li><strong>åƒµå°¸ç½‘ç»œæ£€æµ‹</strong>:
åƒµå°¸ç½‘ç»œä¸­çš„å®¢æˆ·ç«¯é€šå¸¸æ˜¯ç›¸åŒçš„ç¨‹åºï¼Œå› æ­¤å®ƒä»¬çš„ JA3
æŒ‡çº¹ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚è¿™ä½¿å¾—å¤§è§„æ¨¡è¯†åˆ«å—æ„ŸæŸ“ä¸»æœºæˆä¸ºå¯èƒ½ã€‚</li>
<li><strong>å¨èƒæƒ…æŠ¥å…±äº«</strong>: JA3
æŒ‡çº¹æ˜¯ä¸€ä¸ªä¼˜ç§€çš„æŠ€æœ¯æ€§â€å¤±é™·æŒ‡æ ‡â€(IOC)ã€‚å®‰å…¨ç¤¾åŒºå¯ä»¥å…±äº«å·²çŸ¥çš„æ¶æ„ JA3
åˆ—è¡¨ï¼Œå°±åƒå…±äº«æ¶æ„ IP åœ°å€æˆ–åŸŸåä¸€æ ·ã€‚</li>
<li><strong>è¯†åˆ«éæ ‡å‡†åº”ç”¨</strong>:
å¯ä»¥ç”¨äºè¯†åˆ«ç»„ç»‡å†…éƒ¨ç½‘ç»œä¸­ä¸åˆè§„æˆ–éæ ‡å‡†çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<hr />
<h3 id="å±€é™æ€§">å±€é™æ€§</h3>
<p>å°½ç®¡ JA3 éå¸¸æœ‰ç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li><strong>æŒ‡çº¹å†²çª</strong>:
ä¸åŒçš„åº”ç”¨ç¨‹åºå¯èƒ½å¶ç„¶ä¼šä½¿ç”¨ç›¸åŒçš„åŠ å¯†åº“å’Œé…ç½®ï¼Œä»è€Œäº§ç”Ÿç›¸åŒçš„ JA3
æŒ‡çº¹ã€‚</li>
<li><strong>å®¹æ˜“è¢«è§„é¿ (Spoofing)</strong>:
åªè¦æ”»å‡»è€…æœ‰èƒ½åŠ›ä¿®æ”¹å…¶å®¢æˆ·ç«¯çš„ SSL/TLS
åº“ï¼Œä»–ä»¬å°±å¯ä»¥åˆ»æ„æ¨¡ä»¿ä¸€ä¸ªå¸¸è§ã€åˆæ³•çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚ Chrome æµè§ˆå™¨ï¼‰çš„
<code>Client Hello</code> åŒ…ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªâ€åˆæ³•â€çš„ JA3
æŒ‡çº¹æ¥é€ƒé¿æ£€æµ‹ã€‚è¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºâ€JA3 æ¬ºéª—â€ã€‚</li>
<li><strong>æŒ‡çº¹éšç‰ˆæœ¬å˜åŒ–</strong>: å½“ä¸€ä¸ªåˆæ³•åº”ç”¨ï¼ˆå¦‚
Chromeï¼‰æ›´æ–°æ—¶ï¼Œå®ƒçš„ TLS å®ç°å¯èƒ½ä¼šæ”¹å˜ï¼Œå¯¼è‡´å…¶ JA3
æŒ‡çº¹ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚è¿™æ„å‘³ç€ç»´æŠ¤ä¸€ä¸ªå‡†ç¡®çš„æŒ‡çº¹æ•°æ®åº“éœ€è¦æŒç»­çš„åŠªåŠ›ã€‚</li>
<li><strong>ä¿¡æ¯æœ‰é™</strong>: ä¸€ä¸ª MD5
å“ˆå¸Œæœ¬èº«ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ã€‚ä½ æ— æ³•ä»ä¸¤ä¸ªä¸åŒçš„å“ˆå¸Œå€¼çœ‹å‡ºå®ƒä»¬å¯¹åº”çš„å®¢æˆ·ç«¯æœ‰å¤šç›¸ä¼¼ã€‚ä¾‹å¦‚ï¼ŒChrome
90 å’Œ Chrome 91 çš„ JA3 å“ˆå¸Œå¯èƒ½å®Œå…¨ä¸åŒï¼Œå³ä½¿å®ƒä»¬çš„
<code>Client Hello</code> åŒ…åªæœ‰å¾®å°çš„å·®å¼‚ã€‚</li>
</ul>
<hr />
<h3 id="å¦‚ä½•æ£€æµ‹-ja3">å¦‚ä½•æ£€æµ‹ JA3</h3>
<p>è¦å®ç° JA3 æ£€æµ‹ï¼Œä½ éœ€è¦èƒ½å¤Ÿç›‘æ§ç½‘ç»œæµé‡å¹¶è§£æ TLS
æ¡æ‰‹çš„å·¥å…·ã€‚å¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç½‘ç»œå®‰å…¨ç›‘æ§ (NSM) å·¥å…·</strong>: Zeek (åŸå Bro) æ˜¯åŸç”Ÿæ”¯æŒ
JA3 å’Œ JA3S æŒ‡çº¹ç”Ÿæˆçš„é»„é‡‘æ ‡å‡†ã€‚</li>
<li><strong>Suricata</strong>: ä» 4.1 ç‰ˆæœ¬å¼€å§‹ï¼ŒSuricata ä¹Ÿå†…ç½®äº† JA3
æŒ‡çº¹åŠŸèƒ½ã€‚</li>
<li><strong>Wireshark</strong>: å¯ä»¥é€šè¿‡ç‰¹å®šçš„æ’ä»¶æˆ–æ‰‹åŠ¨çš„ tshark
è„šæœ¬æ¥æå–å’Œè®¡ç®— JA3ã€‚</li>
</ul>
<!-- 01-Recipes/Network/ja4_fingerprinting.md -->
<h1 id="ja4-tlsquic-æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£">JA4+ TLS/QUIC
æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</h1>
<p>JA4+ æ˜¯ç”± FoxIO (åŸ Salesforce çš„ JA3 å›¢é˜Ÿ)
å¼€å‘çš„ä¸€å¥—ç½‘ç»œæŒ‡çº¹è¯†åˆ«æ–¹æ³•çš„é›†åˆï¼Œæ—¨åœ¨æˆä¸º JA3
çš„ä¸‹ä¸€ä»£æ¼”è¿›ç‰ˆæœ¬ã€‚å®ƒä¸ä»…ä»…æ˜¯å¯¹ JA3
çš„ç®€å•å‡çº§ï¼Œè€Œæ˜¯ä¸€ä¸ªæ›´å…¨é¢ã€æ›´å…·ç»“æ„åŒ–å’Œå¯æ“ä½œæ€§çš„æŒ‡çº¹å¥—ä»¶ï¼Œæ—¨åœ¨è§£å†³ JA3
çš„æ ¸å¿ƒç—›ç‚¹ï¼Œå¹¶æ‰©å±•åˆ° QUIC å’Œ HTTP ç­‰åè®®ã€‚</p>
<hr />
<h2 id="ç›®å½•-2">ç›®å½•</h2>
<ol type="1">
<li><a href="#ä¸ºä»€ä¹ˆéœ€è¦-ja4-ja3-çš„å±€é™æ€§"><strong>ä¸ºä»€ä¹ˆéœ€è¦ JA4+ (JA3
çš„å±€é™æ€§)</strong></a></li>
<li><a href="#ja4-çš„æ ¸å¿ƒè®¾è®¡---ä¸å†æ˜¯å“ˆå¸Œ"><strong>JA4 çš„æ ¸å¿ƒè®¾è®¡ -
ä¸å†æ˜¯å“ˆå¸Œ</strong></a></li>
<li><a href="#ja4-å¥—ä»¶æ¦‚è§ˆ"><strong>JA4+ å¥—ä»¶æ¦‚è§ˆ</strong></a>
<ul>
<li><a href="#ja4-å®¢æˆ·ç«¯-tls"><strong>JA4</strong> (å®¢æˆ·ç«¯ TLS)</a></li>
<li><a href="#ja4s-æœåŠ¡å™¨ç«¯-tls"><strong>JA4S</strong> (æœåŠ¡å™¨ç«¯
TLS)</a></li>
<li><a href="#ja4h-http-å®¢æˆ·ç«¯"><strong>JA4H</strong> (HTTP
å®¢æˆ·ç«¯)</a></li>
<li><a href="#ja4x-tls-è¯ä¹¦"><strong>JA4X</strong> (TLS è¯ä¹¦)</a></li>
<li><a href="#ja4l-å®éªŒæ€§"><strong>JA4L</strong> (å®éªŒæ€§)</a></li>
</ul></li>
<li><a href="#ja4-vs-ja3æ ¸å¿ƒä¼˜åŠ¿"><strong>JA4 vs
JA3ï¼šæ ¸å¿ƒä¼˜åŠ¿</strong></a></li>
<li><a href="#åº”ç”¨ä¸å®è·µ"><strong>åº”ç”¨ä¸å®è·µ</strong></a></li>
</ol>
<hr />
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-ja4-ja3-çš„å±€é™æ€§">ä¸ºä»€ä¹ˆéœ€è¦ JA4+ (JA3 çš„å±€é™æ€§)</h2>
<p>JA3 æ˜¯ä¸€ä¸ªéå¸¸æˆåŠŸçš„æŠ€æœ¯ï¼Œä½†å…¶æ ¸å¿ƒè®¾è®¡â€”â€”ä¸€ä¸ªå•ä¸€çš„ MD5
å“ˆå¸Œâ€”â€”å¸¦æ¥äº†å‡ ä¸ªæ— æ³•å…‹æœçš„æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>ç¼ºä¹ä¸Šä¸‹æ–‡</strong>: ä¸€ä¸ª MD5
å“ˆå¸Œæ˜¯ä¸é€æ˜çš„ã€‚<code>e7d705a3...</code> å’Œ <code>a8d9b1c2...</code>
è¿™ä¸¤ä¸ªå“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­å®ƒä»¬ä»£è¡¨çš„å®¢æˆ·ç«¯æœ‰å¤šç›¸ä¼¼ã€‚å¯èƒ½åªæ˜¯ TLS
æ‰©å±•é¡ºåºçš„ä¸€ä¸ªå¾®å°å˜åŒ–ï¼Œå°±å¯¼è‡´äº†å®Œå…¨ä¸åŒçš„å“ˆå¸Œã€‚</li>
<li><strong>â€œé›ªå´©æ•ˆåº”â€</strong>: å®¢æˆ·ç«¯çš„ä»»ä½•å¾®å°æ›´æ–°ï¼ˆä¾‹å¦‚ï¼ŒChrome 101
-&gt; 102ï¼‰éƒ½å¯èƒ½å¯¼è‡´ JA3
å“ˆå¸Œå®Œå…¨æ”¹å˜ï¼Œä½¿å¾—åŸºäºç²¾ç¡®åŒ¹é…çš„è§„åˆ™å˜å¾—éå¸¸è„†å¼±ã€‚</li>
<li><strong>éš¾ä»¥è¿›è¡Œæ¨¡ç³Šæœç´¢</strong>: æ— æ³•è¿›è¡Œâ€æœç´¢æ‰€æœ‰ä½¿ç”¨ TLS 1.3
ä½†ä¸åŒ…å«æŸä¸ªç‰¹å®šåŠ å¯†å¥—ä»¶çš„å®¢æˆ·ç«¯â€è¿™æ ·çš„çµæ´»æŸ¥è¯¢ã€‚</li>
<li><strong>æ˜“äºè¢«æ¨¡ä»¿</strong>: æ”»å‡»è€…åªéœ€è¦ç²¾ç¡®å¤ç°
<code>Client Hello</code> çš„ç‰¹å®šå­—æ®µï¼Œå°±èƒ½å®Œå…¨å¤åˆ¶ä¸€ä¸ªåˆæ³•åº”ç”¨çš„ JA3
å“ˆå¸Œã€‚</li>
</ul>
<p>JA4+ çš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<hr />
<h2 id="ja4-çš„æ ¸å¿ƒè®¾è®¡---ä¸å†æ˜¯å“ˆå¸Œ">JA4 çš„æ ¸å¿ƒè®¾è®¡ - ä¸å†æ˜¯å“ˆå¸Œ</h2>
<p>JA4
æœ€å¤§çš„é©æ–°æ˜¯<strong>æ”¾å¼ƒäº†å•ä¸€ã€ä¸é€æ˜çš„å“ˆå¸Œå€¼</strong>ï¼Œè½¬è€Œé‡‡ç”¨ä¸€ç§<strong>ç»“æ„åŒ–ã€äººç±»å¯è¯»çš„å­—ç¬¦ä¸²æ ¼å¼</strong>ã€‚è¿™ä½¿å¾—æŒ‡çº¹æœ¬èº«å°±æºå¸¦äº†ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
<p>JA4
çš„æŒ‡çº¹æ ¼å¼ä¸ºï¼š<code>Protocol_Version_Ciphers_Extensions_Signature</code>ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰å’Œæ„é€ æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„ JA4
æŒ‡çº¹ä¾‹å­ï¼š<code>t13d1516h2_174735a34e8a_b2149a751699</code></p>
<p>æˆ‘ä»¬æ¥åˆ†è§£å®ƒï¼š</p>
<ul>
<li><strong><code>t</code> (Protocol)</strong>: åè®®ã€‚<code>t</code>
ä»£è¡¨ TLS, <code>q</code> ä»£è¡¨ QUICã€‚</li>
<li><strong><code>13</code> (TLS Version)</strong>:
<code>Client Hello</code> ä¸­æ”¯æŒçš„æœ€é«˜ TLS ç‰ˆæœ¬ã€‚<code>12</code> = TLS
1.2, <code>13</code> = TLS 1.3ã€‚</li>
<li><strong><code>d1516h2</code> (Ciphers &amp; Extensions
Count)</strong>:
<ul>
<li><code>d</code>: å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶æ˜¯æœ‰åºçš„
(sorted)ã€‚<code>i</code> è¡¨ç¤ºæ— åº (insipid)ã€‚</li>
<li><code>15</code>: å®¢æˆ·ç«¯æä¾›äº† 15 ä¸ªåŠ å¯†å¥—ä»¶ã€‚</li>
<li><code>16</code>: å®¢æˆ·ç«¯æä¾›äº† 16 ä¸ªæ‰©å±•ã€‚</li>
<li><code>h2</code>: å®¢æˆ·ç«¯åœ¨ <code>Client Hello</code> ä¸­ä½¿ç”¨äº† 2 ä¸ª
GREASE (Generate Random Extensions And Sustain Extensibility)
å€¼ï¼Œè¿™é€šå¸¸æ˜¯ç°ä»£æµè§ˆå™¨çš„ç‰¹å¾ã€‚</li>
</ul></li>
<li><strong><code>_</code> (åˆ†éš”ç¬¦)</strong></li>
<li><strong><code>174735a34e8a</code> (Extensions)</strong>:
è¿™æ˜¯å¯¹<strong>æœ‰åºçš„</strong>æ‰©å±•åˆ—è¡¨è¿›è¡Œç‰¹å®šç®—æ³•è®¡ç®—åå¾—åˆ°çš„<strong>éƒ¨åˆ†å“ˆå¸Œ</strong>ã€‚ç›¸ä¼¼çš„æ‰©å±•åˆ—è¡¨ä¼šäº§ç”Ÿç›¸ä¼¼çš„å“ˆå¸Œå‰ç¼€ã€‚</li>
<li><strong><code>_</code> (åˆ†éš”ç¬¦)</strong></li>
<li><strong><code>b2149a751699</code> (Signature Algorithms)</strong>:
è¿™æ˜¯å¯¹ç­¾åç®—æ³•å’Œæ”¯æŒçš„ç»„ï¼ˆæ¤­åœ†æ›²çº¿ï¼‰è¿›è¡Œéƒ¨åˆ†å“ˆå¸Œè®¡ç®—åå¾—åˆ°çš„å€¼ã€‚</li>
</ul>
<p>è¿™ç§ç»“æ„ä½¿å¾—æŒ‡çº¹æ—¢èƒ½ç”¨äºç²¾ç¡®åŒ¹é…ï¼Œä¹Ÿèƒ½ç”¨äºå¼ºå¤§çš„æ¨¡ç³ŠåŒ¹é…ã€‚</p>
<hr />
<h2 id="ja4-å¥—ä»¶æ¦‚è§ˆ">JA4+ å¥—ä»¶æ¦‚è§ˆ</h2>
<p>JA4+ ä¸æ˜¯å•ä¸€çš„å·¥å…·ï¼Œè€Œæ˜¯ä¸€ä¸ªæ–¹æ³•è®ºé›†åˆã€‚</p>
<h3 id="ja4-å®¢æˆ·ç«¯-tls">JA4 (å®¢æˆ·ç«¯ TLS)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: è¯†åˆ«å‘èµ· TLS è¿æ¥çš„å®¢æˆ·ç«¯åº”ç”¨ã€‚</li>
<li><strong>æ ¼å¼</strong>: å¦‚ä¸Šæ‰€è¿°çš„ <code>p_v_c_e_s</code> ç»“æ„ã€‚</li>
</ul>
<h3 id="ja4s-æœåŠ¡å™¨ç«¯-tls">JA4S (æœåŠ¡å™¨ç«¯ TLS)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: è¯†åˆ«å“åº” TLS è¿æ¥çš„æœåŠ¡å™¨åº”ç”¨ã€‚</li>
<li><strong>æ ¼å¼</strong>: <code>p_v_c_e</code>ï¼Œæ¯”å®¢æˆ·ç«¯æŒ‡çº¹ç¨ç®€å•ã€‚
<ul>
<li>ä¾‹å¦‚ï¼š<code>t13d03_a06f30d07525</code></li>
<li><code>t</code> = TLS, <code>13</code> = TLS 1.3, <code>d</code> =
æœ‰åº, <code>03</code> = 3 ä¸ªæ‰©å±•, <code>a06...</code> =
æ‰©å±•çš„éƒ¨åˆ†å“ˆå¸Œã€‚</li>
</ul></li>
<li><strong>åº”ç”¨</strong>: å°† JA4 å’Œ JA4S
ç»“åˆï¼Œå¯ä»¥è¿›è¡Œæ›´ç²¾å‡†çš„åŒ¹é…ï¼Œä¾‹å¦‚â€åªå‘Šè­¦è¿™ä¸ªç‰¹å®š JA4 è¿æ¥åˆ°è¿™ä¸ªç‰¹å®š JA4S
çš„è¡Œä¸ºâ€ã€‚</li>
</ul>
<h3 id="ja4h-http-å®¢æˆ·ç«¯">JA4H (HTTP å®¢æˆ·ç«¯)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: å¯¹ HTTP è¯·æ±‚è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œä½œä¸ºå¯¹ JA4
çš„è¡¥å……ã€‚</li>
<li><strong>æ ¼å¼</strong>: <code>p_m_v_h</code>
<ul>
<li><code>p</code>: åè®® (<code>h</code>=HTTP/1,
<code>h2</code>=HTTP/2)ã€‚</li>
<li><code>m</code>: è¯·æ±‚æ–¹æ³• (<code>g</code>=GET,
<code>p</code>=POST)ã€‚</li>
<li><code>v</code>: HTTP ç‰ˆæœ¬ã€‚</li>
<li><code>h</code>: å¯¹ HTTP Header çš„ç‰¹å®šç»„åˆè¿›è¡Œå“ˆå¸Œã€‚</li>
</ul></li>
<li><strong>åº”ç”¨</strong>: å¯ä»¥ç”¨æ¥æ£€æµ‹ JA4 æ¬ºéª—ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå£°ç§°è‡ªå·±æ˜¯
Chrome çš„ JA4 æŒ‡çº¹ï¼Œå´å‘é€äº†ä¸ç¬¦åˆ Chrome è¡Œä¸ºçš„ JA4H
æŒ‡çº¹ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ¶æ„å®¢æˆ·ç«¯ã€‚</li>
</ul>
<h3 id="ja4x-tls-è¯ä¹¦">JA4X (TLS è¯ä¹¦)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: å¯¹ TLS è¯ä¹¦é“¾è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ã€‚</li>
<li><strong>åº”ç”¨</strong>:
å¿«é€Ÿè¯†åˆ«è‡ªç­¾åè¯ä¹¦ã€ç‰¹å®šæ¶æ„è½¯ä»¶ä½¿ç”¨çš„è¯ä¹¦ç­‰ã€‚</li>
</ul>
<h3 id="ja4l-å®éªŒæ€§">JA4L (å®éªŒæ€§)</h3>
<ul>
<li><strong>L</strong> for
<strong>L</strong>ightweightã€‚è¿™æ˜¯ä¸€ä¸ªæ›´ç®€å•çš„ç‰ˆæœ¬ï¼ŒåªåŒ…å«æ•°å­—å’Œè®¡æ•°ï¼Œä¸åŒ…å«å“ˆå¸Œã€‚</li>
<li><strong>åº”ç”¨</strong>:
é€‚ç”¨äºæ€§èƒ½æé«˜æˆ–èµ„æºå—é™çš„ç¯å¢ƒï¼Œæä¾›åŸºæœ¬çš„æ¨¡ç³ŠåŒ¹é…èƒ½åŠ›ã€‚</li>
</ul>
<hr />
<h2 id="ja4-vs-ja3æ ¸å¿ƒä¼˜åŠ¿">JA4 vs JA3ï¼šæ ¸å¿ƒä¼˜åŠ¿</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">JA4+</th>
<th style="text-align: left;">JA3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>æ ¼å¼</strong></td>
<td style="text-align: left;"><strong>ç»“æ„åŒ–å­—ç¬¦ä¸²</strong></td>
<td style="text-align: left;">å•ä¸€ MD5 å“ˆå¸Œ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¯è¯»æ€§</strong></td>
<td style="text-align: left;"><strong>é«˜</strong>ï¼ŒæŒ‡çº¹æœ¬èº«åŒ…å«ä¿¡æ¯</td>
<td style="text-align: left;"><strong>æ— </strong></td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ¨¡ç³ŠåŒ¹é…</strong></td>
<td
style="text-align: left;"><strong>åŸç”Ÿæ”¯æŒ</strong>ï¼Œå¯æŒ‰éƒ¨åˆ†æŸ¥è¯¢</td>
<td style="text-align: left;">å¦</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ä¸Šä¸‹æ–‡</strong></td>
<td style="text-align: left;"><strong>ä¸°å¯Œ</strong> (åè®®, ç‰ˆæœ¬,
è®¡æ•°)</td>
<td style="text-align: left;">æ— </td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ¬ºéª—éš¾åº¦</strong></td>
<td style="text-align: left;"><strong>æ›´é«˜</strong>ï¼Œéœ€åŒ¹é…è¡Œä¸ºé€»è¾‘</td>
<td style="text-align: left;">è¾ƒä½ï¼Œåªéœ€åŒ¹é…å­—æ®µ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>è¦†ç›–èŒƒå›´</strong></td>
<td style="text-align: left;">TLS, QUIC, HTTP, Certificates</td>
<td style="text-align: left;">ä»… TLS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¥å£®æ€§</strong></td>
<td
style="text-align: left;"><strong>é«˜</strong>ï¼Œå¾®å°å˜åŒ–ä¸å½±å“å¤§å±€</td>
<td style="text-align: left;">ä½ï¼Œâ€œé›ªå´©æ•ˆåº”â€</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="åº”ç”¨ä¸å®è·µ">åº”ç”¨ä¸å®è·µ</h2>
<p>JA4+ çš„åº”ç”¨åœºæ™¯æ¯” JA3 æ›´å¹¿æ³›å’Œæ·±å…¥ï¼š</p>
<ul>
<li><strong>é«˜çº§å¨èƒç‹©çŒ</strong>:</li>
</ul>
<!-- 01-Recipes/Network/network_sniffing.md -->
<h1 id="recipe-æŠ“åŒ…åˆ†æ-android-åº”ç”¨çš„ç½‘ç»œæµé‡">Recipe: æŠ“åŒ…åˆ†æ android
åº”ç”¨çš„ç½‘ç»œæµé‡</h1>
<h2 id="é—®é¢˜åœºæ™¯-5">é—®é¢˜åœºæ™¯</h2>
<ul>
<li><p><em>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</em></p></li>
<li><p>â“ æƒ³çŸ¥é“æŸä¸ª App è°ƒç”¨äº†å“ªäº› API æ¥å£</p></li>
<li><p>â“ éœ€è¦åˆ†æ API çš„è¯·æ±‚å‚æ•°å’Œå“åº”æ•°æ®</p></li>
<li><p>â“ æƒ³æŸ¥çœ‹ App å‘é€äº†å“ªäº›æ•æ„Ÿä¿¡æ¯ï¼ˆè®¾å¤‡ä¿¡æ¯ã€å®šä½ç­‰ï¼‰</p></li>
<li><p>â“ éœ€è¦æ‰¾åˆ°åŠ å¯†ç­¾åçš„ç”Ÿæˆé€»è¾‘</p></li>
<li><p>â“ æƒ³é‡æ”¾æˆ–ä¿®æ”¹ API è¯·æ±‚</p></li>
<li><p><em>æœ¬é…æ–¹æ•™ä½ </em>ï¼šé…ç½®æŠ“åŒ…ç¯å¢ƒï¼Œæ‹¦æˆªå¹¶åˆ†æ HTTPS
æµé‡ï¼Œç»•è¿‡ SSL Pinning é™åˆ¶ã€‚</p></li>
<li><p><em>é¢„è®¡ç”¨æ—¶</em>: 15-30 åˆ†é’Ÿï¼ˆé¦–æ¬¡é…ç½®ï¼‰</p></li>
</ul>
<hr />
<h2 id="å·¥å…·æ¸…å•-2">å·¥å…·æ¸…å•</h2>
<h2 id="å¿…éœ€å·¥å…·-5"># å¿…éœ€å·¥å…·</h2>
<ul class="task-list">
<li><label><input type="checkbox" /><em>Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</em>ï¼ˆå·²
Rootï¼Œæˆ–å¯å®‰è£…è¯ä¹¦ï¼‰</label></li>
<li><label><input
type="checkbox" /><em>æŠ“åŒ…ä»£ç†å·¥å…·</em>ï¼ˆé€‰æ‹©å…¶ä¸€ï¼‰ï¼š</label>
<ul>
<li>Burp Suiteï¼ˆæ¨èï¼ŒåŠŸèƒ½æœ€å¼ºï¼‰</li>
<li>Charlesï¼ˆUI å‹å¥½ï¼‰</li>
<li>mitmproxyï¼ˆå¼€æºï¼Œå¯ç¼–ç¨‹ï¼‰</li>
</ul></li>
<li><label><input type="checkbox" /><em>Frida</em>ï¼ˆç”¨äºç»•è¿‡ SSL
Pinningï¼‰</label></li>
</ul>
<h2 id="å¯é€‰å·¥å…·-5"># å¯é€‰å·¥å…·</h2>
<ul class="task-list">
<li><label><input type="checkbox" /><em>Wireshark</em>ï¼ˆåˆ†æåº•å±‚ TCP/UDP
æµé‡ï¼‰</label></li>
<li><label><input type="checkbox" /><em>HttpCanary</em>ï¼ˆAndroid
ä¸Šçš„æŠ“åŒ…å·¥å…·ï¼Œæ— éœ€ PCï¼‰</label></li>
</ul>
<hr />
<h2 id="å‰ç½®æ¡ä»¶-2">å‰ç½®æ¡ä»¶</h2>
<h2 id="ç¡®è®¤æ¸…å•-3"># âœ… ç¡®è®¤æ¸…å•</h2>
<div class="sourceCode" id="cb274"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Verify device connection</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> devices</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Frida å¯ç”¨</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span></span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. PC and phone on the same Wi-Fi network</span></span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Record PC IP addressï¼ˆused below as YOUR_PC_IPï¼‰</span></span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows: ipconfig</span></span>
<span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS/Linux: ifconfig or ip addr</span></span></code></pre></div>
<ul>
<li><em>Android 7.0+</em>ï¼šéœ€è¦ Root æƒé™å®‰è£…ç³»ç»Ÿè¯ä¹¦</li>
<li><em>Android 6.0-</em>ï¼šå¯ç›´æ¥å®‰è£…ç”¨æˆ·è¯ä¹¦ï¼Œæ— éœ€ Root</li>
<li>æˆ–ä½¿ç”¨æ”¯æŒç”¨æˆ·è¯ä¹¦çš„ Appï¼ˆTarget SDK &lt; 24ï¼‰</li>
</ul>
<hr />
<h2 id="è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</h2>
<h2 id="ç¬¬-1-æ­¥é…ç½®æŠ“åŒ…å·¥å…·5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šé…ç½®æŠ“åŒ…å·¥å…·ï¼ˆ5
åˆ†é’Ÿï¼‰</h2>
<details>
<summary>
<b>ä½¿ç”¨ Burp Suiteï¼ˆæ¨èï¼‰</b>
</summary>
<h3 id="å¯åŠ¨-burp-suite"># 1.1 å¯åŠ¨ Burp Suite</h3>
<div class="sourceCode" id="cb275"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download Burp Suite Community Edition (free)</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://portswigger.net/burp/communitydownload</span></span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the command</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> burpsuite_community.jar</span></code></pre></div>
<ol type="1">
<li>æ‰“å¼€ <em>Proxy</em> â†’ <em>Options</em></li>
<li>åœ¨ <em>Proxy Listeners</em> éƒ¨åˆ†</li>
<li>ç‚¹å‡» <em>Add</em>ï¼Œé…ç½®ï¼š</li>
</ol>
<ul>
<li><em>Bind to port</em>: <code>8888</code></li>
<li><em>Bind to address</em>: <code>All interfaces</code>ï¼ˆæˆ–é€‰æ‹©ä½ çš„
Wi-Fi ç½‘å¡ï¼‰</li>
</ul>
<ol start="4" type="1">
<li>ç‚¹å‡» <em>OK</em> ä¿å­˜</li>
</ol>
<figure>
<img src="../../images/burp_proxy_config.png" alt="Burp Proxyé…ç½®" />
<figcaption aria-hidden="true">Burp Proxyé…ç½®</figcaption>
</figure>
<p>âœ… <em>éªŒè¯</em>ï¼šæµè§ˆå™¨è®¿é—®
<code>http://YOUR_PC_IP:8888</code>ï¼Œåº”è¯¥çœ‹åˆ° Burp
çš„é”™è¯¯é¡µé¢ï¼ˆè¡¨ç¤ºä»£ç†å·¥ä½œæ­£å¸¸ï¼‰</p>
</details>
<details>
<summary>
<b>ä½¿ç”¨ Charles</b>
</summary>
<h3 id="å¯åŠ¨-charles"># 1.1 å¯åŠ¨ Charles</h3>
<p>ä¸‹è½½ï¼šhttps://www.charlesproxy.com/download/</p>
<h3 id="é…ç½®ä»£ç†-1"># 1.2 é…ç½®ä»£ç†</h3>
<ol type="1">
<li><em>Proxy</em> â†’ <em>Proxy Settings</em></li>
<li>è®¾ç½® Port ä¸º <code>8888</code></li>
<li>å‹¾é€‰ <em>Enable transparent HTTP proxying</em></li>
</ol>
</details>
<details>
<summary>
<b>ä½¿ç”¨ mitmproxy</b>
</summary>
<div class="sourceCode" id="cb276"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install mitmproxy</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="co"># startupï¼ˆç›‘å¬ 8888 ç«¯å£ï¼‰</span></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="ex">mitmproxy</span> <span class="at">-p</span> 8888 <span class="at">--listen-host</span> 0.0.0.0</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a><span class="co"># æˆ–ä½¿ç”¨ Web ç•Œé¢</span></span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a><span class="ex">mitmweb</span> <span class="at">-p</span> 8888 <span class="at">--listen-host</span> 0.0.0.0</span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a><span class="co"># è®¿é—® http://127.0.0.1:8081 æŸ¥çœ‹æµé‡</span></span></code></pre></div>
<hr />
<h2 id="ç¬¬-2-æ­¥é…ç½®æ‰‹æœºä»£ç†2-åˆ†é’Ÿ"># ç¬¬ 2 æ­¥ï¼šé…ç½®æ‰‹æœºä»£ç†ï¼ˆ2
åˆ†é’Ÿï¼‰</h2>
<h3 id="è¿æ¥åˆ°åŒä¸€-wi-fi"># 2.1 è¿æ¥åˆ°åŒä¸€ Wi-Fi</h3>
<p>ç¡®ä¿æ‰‹æœºå’Œ PC åœ¨<em>åŒä¸€å±€åŸŸç½‘</em>ã€‚</p>
<h3 id="è®¾ç½®æ‰‹åŠ¨ä»£ç†"># 2.2 è®¾ç½®æ‰‹åŠ¨ä»£ç†</h3>
<ol type="1">
<li>æ‰“å¼€æ‰‹æœº <em>è®¾ç½®</em> â†’ <em>Wi-Fi</em></li>
<li><em>é•¿æŒ‰</em>å½“å‰è¿æ¥çš„ Wi-Fi â†’ <em>ä¿®æ”¹ç½‘ç»œ</em></li>
<li>å±•å¼€ <em>é«˜çº§é€‰é¡¹</em></li>
<li>ä»£ç†è®¾ç½®æ”¹ä¸º <em>æ‰‹åŠ¨</em>ï¼š</li>
</ol>
<ul>
<li><em>ä»£ç†æœåŠ¡å™¨ä¸»æœºå</em>: <code>YOUR_PC_IP</code>ï¼ˆå¦‚
<code>192.168.1.100</code>ï¼‰</li>
<li><em>ä»£ç†æœåŠ¡å™¨ç«¯å£</em>: <code>8888</code></li>
</ul>
<ol start="5" type="1">
<li>ä¿å­˜</li>
</ol>
<h3 id="éªŒè¯ä»£ç†è¿æ¥"># 2.3 éªŒè¯ä»£ç†è¿æ¥</h3>
<div class="sourceCode" id="cb277"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æ‰‹æœºæµè§ˆå™¨è®¿é—®ä»»æ„ HTTP ç½‘ç«™ï¼ˆå¦‚ http://example.comï¼‰</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="co"># æ­¤æ—¶ Burp/Charles åº”è¯¥æ˜¾ç¤ºæ‹¦æˆªåˆ°çš„è¯·æ±‚</span></span></code></pre></div>
<h2 id="ç¬¬-3-æ­¥å®‰è£…-https-è¯ä¹¦5-10-åˆ†é’Ÿ"># ç¬¬ 3 æ­¥ï¼šå®‰è£… HTTPS
è¯ä¹¦ï¼ˆ5-10 åˆ†é’Ÿï¼‰</h2>
<p><em>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</em> HTTPS
æµé‡ç»è¿‡åŠ å¯†ï¼Œéœ€è¦å®‰è£…è¯ä¹¦æ‰èƒ½è§£å¯†æŸ¥çœ‹ã€‚</p>
<details>
<summary>
<b>Burp Suite è¯ä¹¦å®‰è£…</b>
</summary>
<h3 id="ä¸‹è½½è¯ä¹¦"># 3.1 ä¸‹è½½è¯ä¹¦</h3>
<ol type="1">
<li>æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://burp</code></li>
<li>ç‚¹å‡» <em>CA Certificate</em> ä¸‹è½½ <code>cacert.der</code></li>
</ol>
<h3 id="å®‰è£…è¯ä¹¦"># 3.2 å®‰è£…è¯ä¹¦</h3>
<ul>
<li><em>Android 7.0+ ï¼ˆéœ€è¦ Rootï¼‰</em>ï¼š</li>
</ul>
<div class="sourceCode" id="cb278"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. è½¬æ¢è¯ä¹¦æ ¼å¼</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> x509 <span class="at">-inform</span> DER <span class="at">-in</span> cacert.der <span class="at">-out</span> cacert.pem</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. è®¡ç®—è¯ä¹¦å“ˆå¸Œ</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="va">HASH</span><span class="op">=</span><span class="va">$(</span><span class="ex">openssl</span> x509 <span class="at">-inform</span> PEM <span class="at">-subject_hash_old</span> <span class="at">-in</span> cacert.pem <span class="kw">|</span> <span class="fu">head</span> <span class="at">-1</span><span class="va">)</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. é‡å‘½åå¹¶æ¨é€åˆ°ç³»ç»Ÿç›®å½•</span></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> cacert.pem <span class="va">$HASH</span>.0</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> root</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> remount</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> push <span class="va">$HASH</span>.0 /system/etc/security/cacerts/</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell chmod 644 /system/etc/security/cacerts/<span class="va">$HASH</span>.0</span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. é‡å¯è®¾å¤‡</span></span>
<span id="cb278-15"><a href="#cb278-15" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> reboot</span></code></pre></div>
<details>
<summary>
<b>Charles è¯ä¹¦å®‰è£…</b>
</summary>
<ol type="1">
<li>æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://chls.pro/ssl</code></li>
<li>ä¸‹è½½å¹¶å®‰è£…è¯ä¹¦</li>
<li>Android 7.0+ åŒæ ·éœ€è¦å®‰è£…åˆ°ç³»ç»Ÿç›®å½•ï¼ˆå‚è€ƒ Burp æ­¥éª¤ï¼‰</li>
</ol>
</details>
<details>
<summary>
<b>mitmproxy è¯ä¹¦å®‰è£…</b>
</summary>
<ol type="1">
<li>æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://mitm.it</code></li>
<li>ç‚¹å‡» Android å›¾æ ‡ä¸‹è½½è¯ä¹¦</li>
<li>å®‰è£…æ­¥éª¤åŒä¸Š</li>
</ol>
</details>
<hr />
<h2 id="ç¬¬-4-æ­¥å¼€å§‹æŠ“åŒ…1-åˆ†é’Ÿ"># ç¬¬ 4 æ­¥ï¼šå¼€å§‹æŠ“åŒ…ï¼ˆ1 åˆ†é’Ÿï¼‰</h2>
<h3 id="æ¸…ç©ºæ—§è®°å½•"># 4.1 æ¸…ç©ºæ—§è®°å½•</h3>
<ul>
<li><em>Burp</em>: Proxy â†’ HTTP history â†’ å³é”® â†’ <em>Clear
history</em></li>
<li><em>Charles</em>: Proxy â†’ <em>Clear Session</em></li>
</ul>
<h3 id="å¯åŠ¨ç›®æ ‡-app"># 4.2 å¯åŠ¨ç›®æ ‡ App</h3>
<p>åœ¨æ‰‹æœºä¸Šæ‰“å¼€è¦åˆ†æçš„åº”ç”¨ï¼Œæ­£å¸¸ä½¿ç”¨ã€‚</p>
<h3 id="æŸ¥çœ‹æµé‡"># 4.3 æŸ¥çœ‹æµé‡</h3>
<p>åœ¨æŠ“åŒ…å·¥å…·ä¸­ï¼š</p>
<ul>
<li>æŸ¥çœ‹ HTTP history / Sequence</li>
<li>ç­›é€‰ç›®æ ‡ App çš„åŸŸå</li>
<li>åˆ†æ Request/Response å†…å®¹</li>
</ul>
<p><em>ç¤ºä¾‹åˆ†æç‚¹</em>ï¼š</p>
<ul>
<li>è¯·æ±‚ URL å’Œå‚æ•°</li>
<li>Request Headersï¼ˆ<code>User-Agent</code>,
<code>Authorization</code>, è‡ªå®šä¹‰ç­¾åå¤´ï¼‰</li>
<li>Request Bodyï¼ˆPOST æ•°æ®ï¼‰</li>
<li>Response Bodyï¼ˆAPI è¿”å›çš„ JSON/XMLï¼‰</li>
</ul>
<hr />
<h2 id="ç¬¬-5-æ­¥ç»•è¿‡-ssl-pinningå¦‚é‡åˆ°"># ç¬¬ 5 æ­¥ï¼šç»•è¿‡ SSL
Pinningï¼ˆå¦‚é‡åˆ°ï¼‰</h2>
<p><em>ç—‡çŠ¶</em>ï¼š</p>
<ul>
<li><p>è¯ä¹¦å·²å®‰è£…ï¼Œä½† HTTPS è¯·æ±‚ä»æ— æ³•æŠ“å–</p></li>
<li><p>App æ˜¾ç¤ºâ€ç½‘ç»œé”™è¯¯â€æˆ–ç›´æ¥é—ªé€€</p></li>
<li><p>æŠ“åŒ…å·¥å…·æ˜¾ç¤º SSL æ¡æ‰‹å¤±è´¥</p></li>
<li><p><em>åŸå› </em>ï¼šApp å¯ç”¨äº† SSL
Pinningï¼ˆè¯ä¹¦é”å®šï¼‰ï¼Œæ‹’ç»ä¿¡ä»»ç³»ç»Ÿè¯ä¹¦ã€‚</p></li>
</ul>
<h3 id="æ–¹æ³•-1-ä½¿ç”¨-frida-é€šç”¨è„šæœ¬æ¨è"># æ–¹æ³• 1: ä½¿ç”¨ Frida
é€šç”¨è„šæœ¬ï¼ˆæ¨èï¼‰</h3>
<p><em>ä¸‹è½½è„šæœ¬</em> <code>bypass_ssl_pinning.js</code>ï¼š</p>
<div class="sourceCode" id="cb279"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Universal android SSL Pinning Bypass</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; [SSL Pinning Bypass] å·²Start/Boot&quot;</span>)<span class="op">;</span></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// æ‹¦æˆª TrustManagerImpl (å¸¸ç”¨)</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> TrustManagerImpl <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;com.android.org.conscrypt.TrustManagerImpl&quot;</span></span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>    TrustManagerImpl<span class="op">.</span><span class="at">verifyChain</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>      untrustedChain<span class="op">,</span></span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>      trustAnchorChain<span class="op">,</span></span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>      host<span class="op">,</span></span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>      clientAuth<span class="op">,</span></span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a>      ocspData<span class="op">,</span></span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a>      tlsSctData</span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb279-18"><a href="#cb279-18" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [TrustManagerImpl] BypassCertValidate: &quot;</span> <span class="op">+</span> host)<span class="op">;</span></span>
<span id="cb279-19"><a href="#cb279-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> untrustedChain<span class="op">;</span></span>
<span id="cb279-20"><a href="#cb279-20" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb279-21"><a href="#cb279-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb279-22"><a href="#cb279-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;! TrustManagerImpl ä¸å­˜At&quot;</span>)<span class="op">;</span></span>
<span id="cb279-23"><a href="#cb279-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb279-24"><a href="#cb279-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-25"><a href="#cb279-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hook OkHttp3</span></span>
<span id="cb279-26"><a href="#cb279-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb279-27"><a href="#cb279-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> CertificatePinner <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;okhttp3.CertificatePinner&quot;</span>)<span class="op">;</span></span>
<span id="cb279-28"><a href="#cb279-28" aria-hidden="true" tabindex="-1"></a>    CertificatePinner<span class="op">.</span><span class="at">check</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb279-29"><a href="#cb279-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;java.lang.String&quot;</span><span class="op">,</span></span>
<span id="cb279-30"><a href="#cb279-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;java.util.List&quot;</span></span>
<span id="cb279-31"><a href="#cb279-31" aria-hidden="true" tabindex="-1"></a>    )<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (hostname<span class="op">,</span> peerCertificates) {</span>
<span id="cb279-32"><a href="#cb279-32" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [OkHttp3] Bypass SSL Pinning: &quot;</span> <span class="op">+</span> hostname)<span class="op">;</span></span>
<span id="cb279-33"><a href="#cb279-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb279-34"><a href="#cb279-34" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb279-35"><a href="#cb279-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb279-36"><a href="#cb279-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;! OkHttp3 ä¸å­˜At&quot;</span>)<span class="op">;</span></span>
<span id="cb279-37"><a href="#cb279-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb279-38"><a href="#cb279-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-39"><a href="#cb279-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hook SSLContext</span></span>
<span id="cb279-40"><a href="#cb279-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb279-41"><a href="#cb279-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> SSLContext <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.SSLContext&quot;</span>)<span class="op">;</span></span>
<span id="cb279-42"><a href="#cb279-42" aria-hidden="true" tabindex="-1"></a>    SSLContext<span class="op">.</span><span class="at">init</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb279-43"><a href="#cb279-43" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;[Ljavax.net.ssl.KeyManager;&quot;</span><span class="op">,</span></span>
<span id="cb279-44"><a href="#cb279-44" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;[Ljavax.net.ssl.TrustManager;&quot;</span><span class="op">,</span></span>
<span id="cb279-45"><a href="#cb279-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;java.security.SecureRandom&quot;</span></span>
<span id="cb279-46"><a href="#cb279-46" aria-hidden="true" tabindex="-1"></a>    )<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (keyManager<span class="op">,</span> trustManager<span class="op">,</span> secureRandom) {</span>
<span id="cb279-47"><a href="#cb279-47" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [SSLContext] Useè‡ªDefine TrustManager&quot;</span>)<span class="op">;</span></span>
<span id="cb279-48"><a href="#cb279-48" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">init</span>(keyManager<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> secureRandom)<span class="op">;</span></span>
<span id="cb279-49"><a href="#cb279-49" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb279-50"><a href="#cb279-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb279-51"><a href="#cb279-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;! SSLContext hook Failed&quot;</span>)<span class="op">;</span></span>
<span id="cb279-52"><a href="#cb279-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb279-53"><a href="#cb279-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-54"><a href="#cb279-54" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; [SSL Pinning Bypass] Configå®Œæˆ</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb279-55"><a href="#cb279-55" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb280"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æ–¹å¼1ï¼šé™„åŠ åˆ°è¿è¡Œä¸­çš„ App</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> com.example.app <span class="at">-l</span> bypass_ssl_pinning.js</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æ–¹å¼2ï¼šå¯åŠ¨ App å¹¶æ³¨å…¥</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.example.app <span class="at">-l</span> bypass_ssl_pinning.js <span class="at">--no-pause</span></span></code></pre></div>
<pre><code>[SSL Pinning Bypass] Configå®Œæˆ
</code></pre>
<h3 id="æ–¹æ³•-2-ä½¿ç”¨-xposed-æ¨¡å—"># æ–¹æ³• 2: ä½¿ç”¨ Xposed æ¨¡å—</h3>
<details>
<summary>
<b>JustTrustMe å®‰è£…æ­¥éª¤</b>
</summary>
<ol type="1">
<li>ç¡®ä¿è®¾å¤‡å·²å®‰è£… Xposed Framework</li>
<li>ä¸‹è½½ JustTrustMe æ¨¡å—ï¼šhttps://github.com/Fuzion24/JustTrustMe</li>
<li>åœ¨ Xposed Installer ä¸­æ¿€æ´»</li>
<li>é‡å¯è®¾å¤‡</li>
</ol>
<h3 id="æ–¹æ³•-3-ä¿®æ”¹-apké‡æ‰“åŒ…"># æ–¹æ³• 3: ä¿®æ”¹ APKï¼ˆé‡æ‰“åŒ…ï¼‰</h3>
<details>
<summary>
<b>APK é‡æ‰“åŒ…æ­¥éª¤</b>
</summary>
<p>å¦‚æœ Frida è¢«æ£€æµ‹ï¼Œå¯ä»¥ä¿®æ”¹ APK æ¥ä¿¡ä»»ç”¨æˆ·è¯ä¹¦ï¼š</p>
<ol type="1">
<li>åç¼–è¯‘ APK</li>
<li>ä¿®æ”¹ <code>AndroidManifest.xml</code>ï¼Œæ·»åŠ ï¼š</li>
</ol>
<div class="sourceCode" id="cb282"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">application</span> <span class="ot">android:networkSecurityConfig=</span><span class="st">&quot;@xml/network_security_config&quot;</span>&gt;</span></code></pre></div>
<div class="sourceCode" id="cb283"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">network-security-config</span>&gt;</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">base-config</span> <span class="ot">cleartextTrafficPermitted=</span><span class="st">&quot;true&quot;</span>&gt;</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">trust-anchors</span>&gt;</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">certificates</span> <span class="ot">src=</span><span class="st">&quot;system&quot;</span> /&gt;</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">certificates</span> <span class="ot">src=</span><span class="st">&quot;user&quot;</span> /&gt;</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">trust-anchors</span>&gt;</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">base-config</span>&gt;</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">network-security-config</span>&gt;</span></code></pre></div>
</details>
<hr />
<h2 id="å·¥ä½œåŸç†-1">å·¥ä½œåŸç†</h2>
<h2 id="mitmä¸­é—´äººæ”»å‡»æµç¨‹"># MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰æµç¨‹</h2>
<pre><code>2. ä»£ç†è§£å¯†è¯·æ±‚ï¼ˆä½¿ç”¨å®‰è£…çš„è¯ä¹¦ï¼‰
3. ä»£ç†é‡æ–°åŠ å¯†å¹¶è½¬å‘åˆ°çœŸå®æœåŠ¡å™¨
4. æœåŠ¡å™¨å“åº”ç»è¿‡ä»£ç†è¿”å›ç»™ App
    ```

## # SSL Pinning æ˜¯ä»€ä¹ˆï¼Ÿ

App å†…ç½®äº†æœåŠ¡å™¨è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashï¼‰ï¼Œåªä¿¡ä»»ç‰¹å®šè¯ä¹¦ï¼š

```java
CertificatePinner pinner = new CertificatePinner.Builder()
.add(&quot;api.example.com&quot;, &quot;sha256/AAAAAAAAAA...&quot;)
.build();
</code></pre>
<h2 id="é—®é¢˜-1-æ‰‹æœºæ— æ³•è¿æ¥ä»£ç†"># âŒ é—®é¢˜ 1: æ‰‹æœºæ— æ³•è¿æ¥ä»£ç†</h2>
<p><em>ç—‡çŠ¶</em>ï¼šæµè§ˆå™¨æ˜¾ç¤ºâ€æ— æ³•è¿æ¥åˆ°ä»£ç†æœåŠ¡å™¨â€</p>
<p><em>æ£€æŸ¥</em>ï¼š</p>
<ol type="1">
<li>PC å’Œæ‰‹æœºæ˜¯å¦åœ¨åŒä¸€ Wi-Fiï¼Ÿ</li>
<li>PC é˜²ç«å¢™æ˜¯å¦å…è®¸ 8888 ç«¯å£ï¼Ÿ</li>
</ol>
<div class="sourceCode" id="cb285"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows é˜²ç«å¢™è§„åˆ™ï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="ex">netsh</span> advfirewall firewall add rule name=<span class="st">&quot;Burp Proxy&quot;</span> dir=in action=allow protocol=TCP localport=8888</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS</span></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§ â†’ é˜²ç«å¢™é€‰é¡¹ â†’ å…è®¸ Java</span></span></code></pre></div>
<div class="sourceCode" id="cb286"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æ£€æŸ¥ç«¯å£</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">netstat</span> <span class="at">-an</span> <span class="kw">|</span> <span class="fu">grep</span> 8888 <span class="co"># macOS/Linux</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="fu">netstat</span> <span class="at">-an</span> <span class="kw">|</span> <span class="ex">findstr</span> 8888 <span class="co"># Windows</span></span></code></pre></div>
<p><em>ç—‡çŠ¶</em>ï¼šæµè§ˆå™¨æ˜¾ç¤ºè¯ä¹¦æ— æ•ˆ</p>
<p><em>Android 7.0+ é™åˆ¶</em>ï¼š</p>
<ul>
<li>é»˜è®¤åªä¿¡ä»»ç³»ç»Ÿè¯ä¹¦</li>
<li>å¿…é¡»å°†è¯ä¹¦å®‰è£…åˆ° <code>/system/etc/security/cacerts/</code>ï¼ˆéœ€è¦
Rootï¼‰</li>
</ul>
<p><em>æ—  Root è®¾å¤‡çš„è§£å†³æ–¹æ¡ˆ</em>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Magisk + MagiskTrustUserCerts æ¨¡å—</li>
<li>æˆ–ä¿®æ”¹ APKï¼ˆå‚è€ƒæ–¹æ³• 3ï¼‰</li>
</ul>
<h2 id="é—®é¢˜-3-frida-è„šæœ¬ä¸ç”Ÿæ•ˆ"># âŒ é—®é¢˜ 3: Frida è„šæœ¬ä¸ç”Ÿæ•ˆ</h2>
<p><em>å¯èƒ½åŸå› </em>ï¼š</p>
<ol type="1">
<li><p><em>App ä½¿ç”¨äº†è‡ªå®šä¹‰ç½‘ç»œåº“</em> â†’ éœ€è¦å®šä½å…·ä½“çš„ç±»åå’Œæ–¹æ³•ï¼Œå®šåˆ¶
Hook è„šæœ¬</p></li>
<li><p><em>Frida è¢«æ£€æµ‹</em> â†’ ä½¿ç”¨é‡å‘½åçš„ frida-serverï¼š</p></li>
</ol>
<div class="sourceCode" id="cb287"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> push frida-server /data/local/tmp/random_name</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell <span class="st">&quot;/data/local/tmp/random_name &amp;&quot;</span></span></code></pre></div>
<p>â†’ Hook æ‰€æœ‰è¿›ç¨‹ï¼š</p>
<div class="sourceCode" id="cb288"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-U</span> <span class="co"># æ‰¾åˆ°æ‰€æœ‰è¿›ç¨‹</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-p</span> PID1 <span class="at">-p</span> PID2 <span class="at">-l</span> script.js</span></code></pre></div>
<p><em>å¯èƒ½åŸå› </em>ï¼š</p>
<ol type="1">
<li><p><em>ä½¿ç”¨äº† HTTP/2 æˆ– QUIC</em> â†’ Burp Suite â†’ Proxy â†’ Options â†’
HTTP/2 â†’ å‹¾é€‰â€Enable HTTP/2â€</p></li>
<li><p><em>ç›´æ¥ä½¿ç”¨ Socket é€šä¿¡</em> â†’ éœ€è¦ä½¿ç”¨ Wireshark æˆ– tcpdump
æŠ“å–åŸå§‹ TCP åŒ…</p></li>
<li><p><em>åŠ å¯†çš„è‡ªå®šä¹‰åè®®</em> â†’ éœ€è¦é€†å‘åˆ†æåŠ å¯†ç®—æ³•å¹¶è§£å¯†</p></li>
</ol>
<hr />
<h2 id="å»¶ä¼¸é˜…è¯»-1">å»¶ä¼¸é˜…è¯»</h2>
<h2 id="ç›¸å…³-recipes-2"># ç›¸å…³é…æ–¹</h2>
<ul>
<li><em><a href="./crypto_analysis.md">å¯†ç å­¦åˆ†æ</a></em> - åˆ†æ API
ç­¾åå’ŒåŠ å¯†ç®—æ³•</li>
<li><em><a href="../Anti-Detection/frida_anti_debugging.md">Frida
åè°ƒè¯•ç»•è¿‡</a></em> - å¦‚æœ App æ£€æµ‹åˆ° Frida</li>
<li><em><a href="./tls_fingerprinting_guide.md">TLS æŒ‡çº¹åˆ†æ</a></em> -
ç†è§£ TLS æŒ‡çº¹æŠ€æœ¯</li>
</ul>
<h2 id="å·¥å…·æ·±å…¥-3"># å·¥å…·æ·±å…¥</h2>
<ul>
<li><em><a href="../../02-Tools/Dynamic/frida_guide.md">Frida
å®Œæ•´æŒ‡å—</a></em></li>
<li><em>[Burp Suite ä½¿ç”¨æŠ€å·§]</em> - TODOï¼Œä¸€ä¸ªæ¯”è¾ƒæµæ°“çš„å·¥å…·</li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-2"># æ¡ˆä¾‹åˆ†æ</h2>
<ul>
<li><em><a href="../../03-Case-Studies/case_music_apps.md">éŸ³ä¹ App
åˆ†æ</a></em> - API æŠ“åŒ…å®æˆ˜</li>
<li><em><a
href="../../03-Case-Studies/case_social_media_and_anti_bot.md">ç¤¾äº¤åª’ä½“é£æ§</a></em>
- å¤æ‚ç­¾ååˆ†æ</li>
</ul>
<hr />
<h2 id="å¿«é€Ÿå‚è€ƒ-2">å¿«é€Ÿå‚è€ƒ</h2>
<h2 id="ä¸€é”®å¯åŠ¨è„šæœ¬"># ä¸€é”®å¯åŠ¨è„šæœ¬</h2>
<ul>
<li><em>macOS/Linux</em>:</li>
</ul>
<div class="sourceCode" id="cb289"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !/bin/bash</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="co"># start_proxy.sh</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="co"># è·å–æœ¬æœº IP</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="va">IP</span><span class="op">=</span><span class="va">$(</span><span class="ex">ifconfig</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;inet &quot;</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-v</span> 127.0.0.1 <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $2}&#39;</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-1</span><span class="va">)</span></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;ğŸ“¡ ä»£ç†åœ°å€: </span><span class="va">$IP</span><span class="st">:8888&quot;</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; é…ç½®æ‰‹æœºä»£ç†åˆ°: </span><span class="va">$IP</span><span class="st">:8888&quot;</span></span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; è¯ä¹¦ä¸‹è½½: http://burp (Burp) æˆ– http://mitm.it (mitmproxy)&quot;</span></span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a><span class="co"># å¯åŠ¨ mitmproxy</span></span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a><span class="ex">mitmweb</span> <span class="at">-p</span> 8888 <span class="at">--listen-host</span> 0.0.0.0</span></code></pre></div>
<pre class="batch"><code>@echo off
REM start_proxy.bat

for /f &quot;tokens=2 delims=:&quot; %%a in (&#39;ipconfig ^| findstr /c:&quot;IPv4&quot;&#39;) do set IP=%%a
echo ğŸ“¡ ä»£ç†åœ°å€: %IP%:8888
echo é…ç½®æ‰‹æœºä»£ç†åˆ°: %IP%:8888
pause

java -jar burpsuite_community.jar
</code></pre>
<div class="sourceCode" id="cb291"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸‹è½½é€šç”¨ SSL Pinning ç»•è¿‡è„šæœ¬</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># è¿è¡Œ</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.target.app <span class="at">-l</span> universal-ssl-pinning.js <span class="at">--no-pause</span></span></code></pre></div>
<pre><code>


&lt;!-- 01-Recipes/Network/tls_fingerprinting_guide.md --&gt;

# Recipe: ä½¿ç”¨ TLS æŒ‡çº¹è¯†åˆ«æ£€æµ‹å’Œç»•è¿‡åº”ç”¨æŒ‡çº¹

## é—®é¢˜åœºæ™¯

_ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ_

- ä½ çš„è‡ªåŠ¨åŒ–è„šæœ¬è¢«æœåŠ¡å™¨è¯†åˆ«å¹¶å°ç¦äº†
- ä½ ç”¨ Python/curl è¯·æ±‚ APIï¼Œä½†æœåŠ¡å™¨è¿”å› 403/é£æ§æ‹¦æˆª
- ä½ æƒ³ä¼ªè£…æˆçœŸå®æµè§ˆå™¨/å®˜æ–¹ App çš„ TLS æŒ‡çº¹
- ä½ æƒ³åˆ†æ App ä½¿ç”¨çš„ TLS åº“å’Œé…ç½®
- ä½ æƒ³æ£€æµ‹è‡ªå·±çš„è¯·æ±‚æ˜¯å¦æš´éœ²äº†å¼‚å¸¸çš„ TLS ç‰¹å¾

_æœ¬é…æ–¹æ•™ä½ _ï¼šç†è§£ TLS æŒ‡çº¹è¯†åˆ«åŸç†ã€å¦‚ä½•æ£€æµ‹è‡ªå·±çš„ TLS æŒ‡çº¹ã€ä»¥åŠå¦‚ä½•ä¼ªé€ åˆæ³•çš„ TLS æŒ‡çº¹ã€‚

_æ ¸å¿ƒç†å¿µ_ï¼š

&gt; ğŸ’¡ **TLS æŒ‡çº¹æ˜¯åº”ç”¨çš„&quot;DNA&quot;**
&gt;
&gt; - TLS æ¡æ‰‹é˜¶æ®µæš´éœ²äº†å®¢æˆ·ç«¯ä½¿ç”¨çš„åº“å’Œé…ç½®
&gt; - ä¸åŒçš„ HTTP å®¢æˆ·ç«¯æœ‰ä¸åŒçš„ TLS æŒ‡çº¹
&gt; - æœåŠ¡å™¨å¯ä»¥é€šè¿‡ JA3/JA4 æŒ‡çº¹è¯†åˆ«ä½ çš„çœŸå®èº«ä»½
&gt; - å³ä½¿ä½¿ç”¨ HTTPSï¼ŒTLS æ¡æ‰‹ç‰¹å¾ä¹Ÿæ˜¯æ˜æ–‡çš„

_é¢„è®¡ç”¨æ—¶_: 20-40 åˆ†é’Ÿ

- --

## å·¥å…·æ¸…å•

## # å¿…éœ€å·¥å…·

- â˜ **Wireshark** - æŠ“å– TLS æ¡æ‰‹åŒ…
- â˜ **åœ¨çº¿ JA3 æ£€æµ‹å·¥å…·** - https://ja3er.com æˆ– https://tls.peet.ws
- â˜ **Python 3.7+** - ç”¨äºè„šæœ¬æµ‹è¯•

## # å¯é€‰å·¥å…·

- â˜ **curl-impersonate** - ä¼ªè£…æµè§ˆå™¨ TLS æŒ‡çº¹çš„ curl
- â˜ **tls-client** (Python) - æ”¯æŒè‡ªå®šä¹‰ TLS æŒ‡çº¹çš„ HTTP åº“
- â˜ **Burp Suite** - æŠ“åŒ…åˆ†æ
- â˜ **ja3transport** (Go) - Go è¯­è¨€çš„ TLS ä¼ªè£…åº“

- --

## å‰ç½®æ¡ä»¶

## # âœ… ç¡®è®¤æ¸…å•

1. **Wireshark å·²å®‰è£…å¹¶å¯ç”¨**
2. **Python 3.7+ ç¯å¢ƒé…ç½®å®Œæˆ**

```bash
# éªŒè¯ Wireshark å®‰è£…
wireshark --version

# éªŒè¯ Python ç¯å¢ƒ
python3 --version

# å®‰è£…å¿…è¦çš„ Python åº“
pip3 install requests pycurl tls-client
</code></pre>
<hr />
<h2 id="è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</h2>
<h2 id="ç¬¬-1-æ­¥ç†è§£-tls-æŒ‡çº¹è¯†åˆ«åŸç†5-åˆ†é’Ÿ"># ç¬¬ 1 æ­¥ï¼šç†è§£ TLS
æŒ‡çº¹è¯†åˆ«åŸç†ï¼ˆ5 åˆ†é’Ÿï¼‰</h2>
<h3 id="ä»€ä¹ˆæ˜¯-ja3-æŒ‡çº¹"># 1.1 ä»€ä¹ˆæ˜¯ JA3 æŒ‡çº¹ï¼Ÿ</h3>
<p><em>JA3</em> æ˜¯ä¸€ç§é€šè¿‡åˆ†æ TLS <code>Client Hello</code>
åŒ…ç”ŸæˆæŒ‡çº¹çš„æŠ€æœ¯ã€‚</p>
<p><em>æå–çš„å­—æ®µ</em>ï¼š</p>
<ol type="1">
<li>TLS ç‰ˆæœ¬ï¼ˆå¦‚ TLS 1.3 = 771ï¼‰</li>
<li>åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ˆCipher Suitesï¼‰</li>
<li>æ‰©å±•åˆ—è¡¨ï¼ˆExtensionsï¼‰</li>
<li>æ¤­åœ†æ›²çº¿åˆ—è¡¨ï¼ˆElliptic Curvesï¼‰</li>
<li>æ¤­åœ†æ›²çº¿ç‚¹æ ¼å¼ï¼ˆEC Point Formatsï¼‰</li>
</ol>
<p><em>ç”Ÿæˆè¿‡ç¨‹</em>ï¼š</p>
<pre><code>æ‹¼æ¥æˆString: &quot;771,4865-4866-4867,0-23-65281,29-23-24,0&quot;
â†“
Calculate MD5 å“ˆå¸Œ
â†“
JA3 æŒ‡çº¹: e7d705a3286e19ea42f587b344ee6865
</code></pre>
<div class="line-block"><strong>æ ¼å¼</strong> | MD5 å“ˆå¸Œ | ç»“æ„åŒ–å­—ç¬¦ä¸²
|<br />
<strong>å¯è¯»æ€§</strong> | æ—  | é«˜ï¼ˆåŒ…å«ç‰ˆæœ¬ã€è®¡æ•°ç­‰ï¼‰ |<br />
<strong>ç¤ºä¾‹</strong> | <code>e7d705a3286e19ea42f587b344ee6865</code> |
<code>t13d1516h2_174735a34e8a_b2149a751699</code> |<br />
<strong>ä¼˜åŠ¿</strong> | ç®€å•ï¼Œå¹¿æ³›æ”¯æŒ | å¯æ¨¡ç³ŠåŒ¹é…ï¼ŒæŠ—å¹²æ‰° |</div>
<p>âœ… <strong>å…³é”®ç‚¹</strong>ï¼šä¸åŒçš„ HTTP åº“æœ‰ä¸åŒçš„ JA3 æŒ‡çº¹</p>
<table>
<thead>
<tr>
<th>å®¢æˆ·ç«¯</th>
<th>JA3 æŒ‡çº¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chrome 120</td>
<td><code>579ccef312d18482fc42e2b822ca2430</code></td>
</tr>
<tr>
<td>Firefox 121</td>
<td><code>3b5074b1b5d032e5620f69f9f700ff0e</code></td>
</tr>
<tr>
<td>Python requests</td>
<td><code>084c44f52a434da89e0b1bc98f8dd159</code></td>
</tr>
<tr>
<td>curl é»˜è®¤</td>
<td><code>51c64c77e60f3980eea90869b68c58a8</code></td>
</tr>
</tbody>
</table>
<p><em>é—®é¢˜</em>ï¼šå¦‚æœä½ ç”¨ Python requests è®¿é—®æœåŠ¡å™¨ï¼Œå³ä½¿è®¾ç½®äº†
User-Agentï¼ŒæœåŠ¡å™¨ä¹Ÿèƒ½é€šè¿‡ JA3 è¯†åˆ«å‡ºä½ ä¸æ˜¯çœŸå®æµè§ˆå™¨</p>
<hr />
<h2 id="ç¬¬-2-æ­¥æ£€æµ‹ä½ çš„-tls-æŒ‡çº¹10-åˆ†é’Ÿ"># ç¬¬ 2 æ­¥ï¼šæ£€æµ‹ä½ çš„ TLS
æŒ‡çº¹ï¼ˆ10 åˆ†é’Ÿï¼‰</h2>
<h3 id="åœ¨çº¿æ£€æµ‹"># 2.1 åœ¨çº¿æ£€æµ‹</h3>
<p><em>æ–¹æ³• 1ï¼šè®¿é—® JA3 æ£€æµ‹ç½‘ç«™</em></p>
<div class="sourceCode" id="cb294"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ç”¨ curl æµ‹è¯•</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> https://ja3er.com/json</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ç”¨ Python requests æµ‹è¯•</span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="op">&lt;&lt; &#39;EOF&#39;</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="st">import requests</span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="st">r = requests.get(&#39;https://ja3er.com/json&#39;)</span></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="st">print(r.text)</span></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;ja3&quot;</span><span class="ex">:</span> <span class="st">&quot;084c44f52a434da89e0b1bc98f8dd159&quot;</span>,</span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;ja3_text&quot;</span><span class="ex">:</span> <span class="st">&quot;771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-23-65281-10-11-35-16-5-13-18-51-45-43-27-21,29-23-24,0&quot;</span>,</span>
<span id="cb294-15"><a href="#cb294-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;User-Agent&quot;</span><span class="ex">:</span> <span class="st">&quot;python-requests/2.31.0&quot;</span></span>
<span id="cb294-16"><a href="#cb294-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>curl -s https://tls.peet.ws/api/all | jq .</p>
<pre><code>2. è¿‡æ»¤å™¨è¾“å…¥ï¼š`tls.handshake.type == 1`ï¼ˆåªæ˜¾ç¤º Client Helloï¼‰
3. åœ¨ç»ˆç«¯æ‰§è¡Œè¯·æ±‚ï¼š

```bash
curl https://example.com
</code></pre>
<ol start="5" type="1">
<li>å±•å¼€ <strong>Transport Layer Security â†’ Handshake Protocol: Client
Hello</strong></li>
</ol>
<p><em>æŸ¥çœ‹å…³é”®å­—æ®µ</em>ï¼š</p>
<pre><code>- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)
- ...
Extension: supported_groups (len=10)
- secp256r1 (0x0017)
- x25519 (0x001d)
- ...
    ```

âœ… **æˆåŠŸæ ‡å¿—**ï¼šä½ å·²ç»çœ‹åˆ°äº†è‡ªå·±å®¢æˆ·ç«¯çš„ TLS æ¡æ‰‹ç‰¹å¾

- --

## # ç¬¬ 3 æ­¥ï¼šè·å–ç›®æ ‡æŒ‡çº¹ï¼ˆ5 åˆ†é’Ÿï¼‰

* *ç›®æ ‡**ï¼šè·å–çœŸå®æµè§ˆå™¨æˆ–å®˜æ–¹ App çš„ JA3 æŒ‡çº¹ç”¨äºä¼ªè£…

### 3.1 æµè§ˆå™¨æŒ‡çº¹

* *æ–¹æ³• 1ï¼šç›´æ¥æŸ¥è¯¢**

Chrome æµè§ˆå™¨è®¿é—® https://ja3er.com/json

è®°å½•æ˜¾ç¤ºçš„ JA3 å“ˆå¸Œå€¼ã€‚

* *æ–¹æ³• 2ï¼šä» GitHub æ•°æ®åº“æŸ¥è¯¢**

è®¿é—® https://github.com/salesforce/ja3/blob/master/lists/osx-nix-ja3.csv

æœç´¢ &quot;Chrome&quot;ã€&quot;Safari&quot;ã€&quot;Firefox&quot; æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ JA3ã€‚

### 3.2 android App æŒ‡çº¹

* *ä½¿ç”¨ Wireshark æŠ“å–çœŸå® App çš„æµé‡**ï¼š

1. é…ç½®æ‰‹æœºèµ°ç”µè„‘ä»£ç†
2. Wireshark ç›‘å¬å¯¹åº”ç½‘å¡
3. æ‰“å¼€ç›®æ ‡ Appï¼Œè§¦å‘ç½‘ç»œè¯·æ±‚
4. è¿‡æ»¤ `tls.handshake.type == 1` æ‰¾åˆ° Client Hello åŒ…
5. è®°å½•æˆ–å¯¼å‡ºè¯¥åŒ…

* *æå– JA3**ï¼š

```bash
# Use ja3 Toolï¼ˆNeedInstallï¼‰
pip3 install pyshark
python3 &lt;&lt; &#39;EOF&#39;
import pyshark
cap = pyshark.FileCapture(&#39;capture.pcap&#39;, display_filter=&#39;tls.handshake.type == 1&#39;)
for pkt in cap:
print(pkt.tls.handshake_ciphersuite)
EOF

```

## # ç¬¬ 4 æ­¥ï¼šä¼ªé€  TLS æŒ‡çº¹ï¼ˆ15 åˆ†é’Ÿï¼‰

### 4.1 ä½¿ç”¨ curl-impersonateï¼ˆæ¨èï¼‰

* *curl-impersonate** æ˜¯ä¸€ä¸ªä¿®æ”¹ç‰ˆçš„ curlï¼Œèƒ½å®Œç¾æ¨¡æ‹Ÿæµè§ˆå™¨çš„ TLS æŒ‡çº¹ã€‚

* *å®‰è£…**ï¼ˆmacOSï¼‰ï¼š

```bash
# Use Homebrew
brew install curl-impersonate

# or downloadpre-compiled version
# https://github.com/lwthiker/curl-impersonate/releases
</code></pre>
<p>curl_chrome120 https://ja3er.com/json</p>
<h1 id="ä¼ªè£…æˆ-firefox-121">ä¼ªè£…æˆ Firefox 121</h1>
<p>curl_ff121 https://ja3er.com/json</p>
<h1 id="ä¼ªè£…æˆ-safari-17">ä¼ªè£…æˆ Safari 17</h1>
<p>curl_safari17 https://ja3er.com/json</p>
<pre><code>
### 4.2 ä½¿ç”¨ Python tls-client åº“

* *å®‰è£…**ï¼š

```bash
pip3 install tls-client
</code></pre>
<h1 id="åˆ›å»ºä¼šè¯ä¼ªè£…æˆ-chrome-120">åˆ›å»ºä¼šè¯ï¼Œä¼ªè£…æˆ Chrome 120</h1>
<p>session = tls_client.Session( client_identifier=â€œchrome_120â€,
random_tls_extension_order=True )</p>
<h1 id="sendrequest">SendRequest</h1>
<p>response = session.get(â€œhttps://ja3er.com/jsonâ€)
print(response.json())</p>
<pre><code>&quot;firefox_102&quot;, &quot;firefox_104&quot;, &quot;firefox_121&quot;
&quot;safari_15_3&quot;, &quot;safari_16_0&quot;, &quot;safari_17_0&quot;

# ç§»åŠ¨ç«¯
&quot;okhttp4_android_7&quot;, &quot;okhttp4_android_8&quot;, &quot;okhttp4_android_13&quot;
</code></pre>
<p>client_identifier=â€œcustomâ€,
ja3_string=â€œ771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-23-65281-10-11-35-16-5-13-18-51-45-43-27-21,29-23-24,0â€
)</p>
<pre><code></code></pre>
<p>â€œfmtâ€ â€œioâ€ â€œnet/httpâ€ â€œgithub.com/CUCyber/ja3transportâ€ )</p>
<p>func main() { // Create å¸¦ JA3 æŒ‡çº¹ Transport tr, _ :=
ja3transport.NewTransport(â€œ771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-23-65281-10-11-35-16-5-13-18-51-45-43-27-21,29-23-24,0â€)</p>
<p>client := &amp;http.Client{Transport: tr}</p>
<p>resp, _ := client.Get(â€œhttps://ja3er.com/jsonâ€) defer
resp.Body.Close()</p>
<p>body, _ := io.ReadAll(resp.Body) fmt.Println(string(body))</p>
<p>}</p>
<pre><code>
* *åˆ›å»ºå¯¹æ¯”è„šæœ¬**ï¼š

```bash
# !/bin/bash

echo &quot;=== åŸç”Ÿ curl ===&quot;
curl -s https://ja3er.com/json | jq -r &#39;.ja3&#39;

echo &quot;&quot;
echo &quot;=== curl-impersonate (Chrome) ===&quot;
curl_chrome120 -s https://ja3er.com/json | jq -r &#39;.ja3&#39;

echo &quot;&quot;
echo &quot;=== Python requests ===&quot;
python3 -c &quot;import requests; print(requests.get(&#39;https://ja3er.com/json&#39;).json()[&#39;ja3&#39;])&quot;

echo &quot;&quot;
echo &quot;=== Python tls-client ===&quot;
python3 &lt;&lt; &#39;EOF&#39;
import tls_client
session = tls_client.Session(client_identifier=&quot;chrome_120&quot;)
print(session.get(&quot;https://ja3er.com/json&quot;).json()[&#39;ja3&#39;])
EOF
</code></pre>
<p>./compare_ja3.sh</p>
<pre><code>579ccef312d18482fc42e2b822ca2430

=== Python requests ===
084c44f52a434da89e0b1bc98f8dd159

=== Python tls-client ===
579ccef312d18482fc42e2b822ca2430
</code></pre>
<p>import tls_client</p>
<h1 id="ä½¿ç”¨ä¼ªè£…çš„-tls-æŒ‡çº¹">ä½¿ç”¨ä¼ªè£…çš„ TLS æŒ‡çº¹</h1>
<p>session = tls_client.Session(client_identifier=â€œchrome_120â€)</p>
<p>headers = { â€˜User-Agentâ€™: â€˜Mozilla/5.0 (Windows NT 10.0; Win64; x64)
AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36â€™
}</p>
<p>response = session.get(â€˜https://api.example.com/protectedâ€™,
headers=headers) print(response.status_code) print(response.text)</p>
<pre><code>| tls-client | Chrome | Chrome | âœ… 200 OK |

- --

## å·¥ä½œåŸç†

## # TLS æ¡æ‰‹è¿‡ç¨‹
</code></pre>
<div class="line-block">|</div>
<p>|â†â€“ Server Hello â€”â€”â€”â€”â€“| | (Server JA3S æŒ‡çº¹) | | | |â€” Key Exchange
â€”â€”â€”â€”-â†’| |â†â€“ Finished â€”â€”â€”â€”â€”â€”| | | |â†â†’ EncryptDataä¼ è¾“ â†â†’|</p>
<pre><code>
## # JA3 æŒ‡çº¹ç”Ÿæˆç»†èŠ‚

_åŸå§‹å­—ç¬¦ä¸²ç¤ºä¾‹_ï¼š
</code></pre>
<p>29-23-24 â†’ Supported Groups (æ¤­åœ†æ›²çº¿) 0 â†’ EC Point Formats</p>
<pre><code></code></pre>
<p>16 â†’ 16 Extensions h2 â†’ HTTP/2 _174735â€¦ â†’ Extensions å“ˆå¸Œï¼ˆæˆªæ–­ï¼‰
_b2149aâ€¦ â†’ Signature Algorithms å“ˆå¸Œ</p>
<pre><code>- å¯è¯»æ€§å¼ºï¼ˆæ— éœ€æŸ¥è¡¨ï¼‰


- --

## å¸¸è§é—®é¢˜

## # âŒ é—®é¢˜ 1: curl-impersonate å®‰è£…å¤±è´¥

* *ç—‡çŠ¶**ï¼šHomebrew æ‰¾ä¸åˆ° curl-impersonate

* *è§£å†³**ï¼š

```bash
# macOS/Linux: ManualDownloadpre-compiled version
wget https://github.com/lwthiker/curl-impersonate/releases/download/v0.6.1/curl-impersonate-v0.6.1.x86_64-linux-gnu.tar.gz

tar -xzf curl-impersonate-*.tar.gz
cd curl-impersonate-*
sudo cp curl_* /usr/local/bin/
</code></pre>
<p>ValueError: Unknown client identifier: chrome_999</p>
<pre><code>print(tls_client.settings.ClientIdentifiers)
</code></pre>
<ul>
<li><p>JA3 æŒ‡çº¹æ˜¯æµè§ˆå™¨ï¼Œä½† HTTP å¤´é¡ºåº/å€¼ä¸å¯¹</p></li>
<li><p><strong>è§£å†³</strong>ï¼šä½¿ç”¨å®Œæ•´çš„æµè§ˆå™¨æ¨¡æ‹Ÿï¼ˆåŒ…æ‹¬ HTTP/2
ç‰¹å¾ï¼‰</p></li>
<li><p>JA3 æŒ‡çº¹æ˜¯æµè§ˆå™¨ï¼Œä½† HTTP å¤´é¡ºåº/å€¼ä¸å¯¹</p></li>
<li><p><strong>è§£å†³</strong>ï¼šä½¿ç”¨å®Œæ•´çš„æµè§ˆå™¨æ¨¡æ‹Ÿï¼ˆåŒ…æ‹¬ HTTP/2
ç‰¹å¾ï¼‰</p></li>
</ul>
<ol start="2" type="1">
<li><strong>è¡Œä¸ºç‰¹å¾å¼‚å¸¸</strong></li>
</ol>
<ul>
<li><p>è¯·æ±‚é€Ÿåº¦å¤ªå¿«</p></li>
<li><p>ç¼ºå°‘ Referer/Cookie</p></li>
<li><p><strong>è§£å†³</strong>ï¼šæ·»åŠ å»¶è¿Ÿã€æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º</p></li>
<li><p>è¯·æ±‚é€Ÿåº¦å¤ªå¿«</p></li>
<li><p>ç¼ºå°‘ Referer/Cookie</p></li>
<li><p><strong>è§£å†³</strong>ï¼šæ·»åŠ å»¶è¿Ÿã€æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º</p></li>
</ul>
<ol start="3" type="1">
<li><strong>IP ä¿¡èª‰é—®é¢˜</strong></li>
</ol>
<ul>
<li><p>IP è¢«æ ‡è®°ä¸ºæ•°æ®ä¸­å¿ƒ/ä»£ç†</p></li>
<li><p><strong>è§£å†³</strong>ï¼šä½¿ç”¨ä½å®…ä»£ç†æˆ–è½®æ¢ IP</p></li>
<li><p>IP è¢«æ ‡è®°ä¸ºæ•°æ®ä¸­å¿ƒ/ä»£ç†</p></li>
<li><p><strong>è§£å†³</strong>ï¼šä½¿ç”¨ä½å®…ä»£ç†æˆ–è½®æ¢ IP</p></li>
</ul>
<ol start="4" type="1">
<li><strong>è®¾å¤‡æŒ‡çº¹</strong></li>
</ol>
<ul>
<li><p>æœåŠ¡å™¨æ£€æµ‹ Canvas æŒ‡çº¹ã€WebGL æŒ‡çº¹ç­‰</p></li>
<li><p><strong>è§£å†³</strong>ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆSelenium +
undetected-chromedriverï¼‰</p></li>
<li><p>æœåŠ¡å™¨æ£€æµ‹ Canvas æŒ‡çº¹ã€WebGL æŒ‡çº¹ç­‰</p></li>
<li><p><strong>è§£å†³</strong>ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆSelenium +
undetected-chromedriverï¼‰</p></li>
</ul>
<h2 id="é—®é¢˜-4-å¦‚ä½•åœ¨-frida-ä¸­ä¿®æ”¹-tls-æŒ‡çº¹"># âŒ é—®é¢˜ 4: å¦‚ä½•åœ¨ Frida
ä¸­ä¿®æ”¹ TLS æŒ‡çº¹ï¼Ÿ</h2>
<ul>
<li><p>*åœºæ™¯**ï¼šä½ æƒ³ä¿®æ”¹ Android App çš„ TLS æŒ‡çº¹</p></li>
<li><p>*æ–¹æ³• 1ï¼šHook Java å±‚ SSLSocket**</p></li>
</ul>
<div class="sourceCode" id="cb307"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> SSLSocket <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.SSLSocket&quot;</span>)<span class="op">;</span></span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>  SSLSocket<span class="op">.</span><span class="at">setEnabledCipherSuites</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (suites) {</span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Original Cipher Suites:&quot;</span><span class="op">,</span> suites)<span class="op">;</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä¿®æ”¹ä¸ºç›®æ ‡æŒ‡çº¹åŠ å¯†å¥—ä»¶</span></span>
<span id="cb307-8"><a href="#cb307-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> customSuites <span class="op">=</span> [</span>
<span id="cb307-9"><a href="#cb307-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;TLS_AES_128_GCM_SHA256&quot;</span><span class="op">,</span></span>
<span id="cb307-10"><a href="#cb307-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;TLS_AES_256_GCM_SHA384&quot;</span><span class="op">,</span></span>
<span id="cb307-11"><a href="#cb307-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;TLS_CHACHA20_POLY1305_SHA256&quot;</span><span class="op">,</span></span>
<span id="cb307-12"><a href="#cb307-12" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb307-13"><a href="#cb307-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-14"><a href="#cb307-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] ModifyAfter:&quot;</span><span class="op">,</span> customSuites)<span class="op">;</span></span>
<span id="cb307-15"><a href="#cb307-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">setEnabledCipherSuites</span>(customSuites)<span class="op">;</span></span>
<span id="cb307-16"><a href="#cb307-16" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb307-17"><a href="#cb307-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="å»¶ä¼¸é˜…è¯»-2">å»¶ä¼¸é˜…è¯»</h2>
<h2 id="ç›¸å…³-recipes-3"># ç›¸å…³é…æ–¹</h2>
<ul>
<li><strong><a href="./network_sniffing.md">ç½‘ç»œæŠ“åŒ…</a></strong> - æŠ“å–
TLS æ¡æ‰‹åŒ…</li>
<li><strong><a href="./crypto_analysis.md">å¯†ç å­¦åˆ†æ</a></strong> -
åˆ†æåŠ å¯†å®ç°</li>
<li><strong><a href="./ja3_fingerprinting.md">JA3 æŒ‡çº¹è¯¦è§£</a></strong>
- JA3 æŠ€æœ¯æ·±å…¥</li>
<li><strong><a href="./ja4_fingerprinting.md">JA4 æŒ‡çº¹è¯¦è§£</a></strong>
- JA4+ å¥—ä»¶è¯¦è§£</li>
</ul>
<h2 id="å·¥å…·æ·±å…¥-4"># å·¥å…·æ·±å…¥</h2>
<ul>
<li><strong>curl-impersonate æ–‡æ¡£</strong> -
https://github.com/lwthiker/curl-impersonate</li>
<li><strong>tls-client (Python)</strong> -
https://github.com/FlorianREGAZ/Python-Tls-Client</li>
<li><strong>ja3transport (Go)</strong> -
https://github.com/CUCyber/ja3transport</li>
</ul>
<h2 id="åœ¨çº¿èµ„æº"># åœ¨çº¿èµ„æº</h2>
<ul>
<li><strong>JA3 æ£€æµ‹</strong> - https://ja3er.com</li>
<li><strong>TLS æŒ‡çº¹æ£€æµ‹</strong> - https://tls.peet.ws</li>
<li><strong>JA3 æ•°æ®åº“</strong> - https://github.com/salesforce/ja3</li>
</ul>
<h2 id="ç†è®ºåŸºç¡€-1"># ç†è®ºåŸºç¡€</h2>
<ul>
<li><strong><a href="../../04-Reference/Advanced/">TLS
åè®®è¯¦è§£</a></strong> - TODO</li>
<li><strong><a href="../../04-Reference/Advanced/">HTTP/2
æŒ‡çº¹</a></strong> - TODO</li>
</ul>
<hr />
<h2 id="å¿«é€Ÿå‚è€ƒ-3">å¿«é€Ÿå‚è€ƒ</h2>
<h2 id="å¸¸ç”¨å·¥å…·å¯¹æ¯”"># å¸¸ç”¨å·¥å…·å¯¹æ¯”</h2>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>è¯­è¨€</th>
<th>éš¾åº¦</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>curl-impersonate</strong></td>
<td>Bash</td>
<td></td>
<td>æœ€ç®€å•ï¼Œå®Œç¾æ¨¡æ‹Ÿ</td>
</tr>
<tr>
<td><strong>tls-client</strong></td>
<td>Python</td>
<td></td>
<td>æ˜“ç”¨ï¼Œæ”¯æŒå¤šç§æµè§ˆå™¨</td>
</tr>
<tr>
<td><strong>ja3transport</strong></td>
<td>Go</td>
<td></td>
<td>é«˜æ€§èƒ½ï¼Œéœ€è¦ Go ç¯å¢ƒ</td>
</tr>
<tr>
<td><strong>requests + urllib3</strong></td>
<td>Python</td>
<td></td>
<td>å¤æ‚ï¼Œéœ€æ·±åº¦å®šåˆ¶</td>
</tr>
</tbody>
</table>
<h2 id="å¿«é€Ÿæ£€æµ‹è„šæœ¬"># å¿«é€Ÿæ£€æµ‹è„šæœ¬</h2>
<ul>
<li>*detect_ja3.sh**ï¼š</li>
</ul>
<div class="sourceCode" id="cb308"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !/bin/bash</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; æ­£AtDetection TLS æŒ‡çº¹...&quot;</span></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="va">URL</span><span class="op">=</span><span class="st">&quot;https://ja3er.com/json&quot;</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a><span class="co"># DetectionCurrentClient</span></span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a><span class="va">JA3</span><span class="op">=</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-s</span> <span class="st">&quot;</span><span class="va">$URL</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">jq</span> <span class="at">-r</span> <span class="st">&#39;.ja3&#39;</span><span class="va">)</span></span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;ä½  JA3: </span><span class="va">$JA3</span><span class="st">&quot;</span></span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥è¯¢å·²çŸ¥æŒ‡çº¹</span></span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; å¸¸è§Client JA3:&quot;</span></span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; Chrome 120: 579ccef312d18482fc42e2b822ca2430&quot;</span></span>
<span id="cb308-16"><a href="#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; Firefox 121: 3b5074b1b5d032e5620f69f9f700ff0e&quot;</span></span>
<span id="cb308-17"><a href="#cb308-17" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; Safari 17: 4e2d5f6c3e8f7a9b0c1d2e3f4a5b6c7d&quot;</span></span>
<span id="cb308-18"><a href="#cb308-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; Python req: 084c44f52a434da89e0b1bc98f8dd159&quot;</span></span>
<span id="cb308-19"><a href="#cb308-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; curl: 51c64c77e60f3980eea90869b68c58a8&quot;</span></span>
<span id="cb308-20"><a href="#cb308-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-21"><a href="#cb308-21" aria-hidden="true" tabindex="-1"></a><span class="co"># å¯¹æ¯”</span></span>
<span id="cb308-22"><a href="#cb308-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$JA3</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;579ccef312d18482fc42e2b822ca2430&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-23"><a href="#cb308-23" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-24"><a href="#cb308-24" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;âœ… åŒ¹é…: Chrome 120&quot;</span></span>
<span id="cb308-25"><a href="#cb308-25" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$JA3</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;084c44f52a434da89e0b1bc98f8dd159&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb308-26"><a href="#cb308-26" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-27"><a href="#cb308-27" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;âš ï¸ åŒ¹é…: Python requests (å®¹æ˜“è¢«è¯†åˆ«)&quot;</span></span>
<span id="cb308-28"><a href="#cb308-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb308-29"><a href="#cb308-29" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-30"><a href="#cb308-30" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;â“ æœªçŸ¥æŒ‡çº¹&quot;</span></span>
<span id="cb308-31"><a href="#cb308-31" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<p>â€œâ€œâ€ TLS æŒ‡çº¹ä¼ªè£…æ¨¡æ¿ â€œâ€œâ€ import tls_client</p>
<p>class BrowserSession: â€œâ€œâ€œæ¨¡æ‹Ÿæµè§ˆå™¨ä¼šè¯â€â€œâ€</p>
<p>PROFILES = { â€˜chromeâ€™: â€˜chrome_120â€™, â€˜firefoxâ€™: â€˜firefox_121â€™,
â€˜safariâ€™: â€˜safari_17_0â€™, â€˜androidâ€™: â€˜okhttp4_android_13â€™ }</p>
<p>def <strong>init</strong>(self, browser=â€˜chromeâ€™): â€œâ€œâ€œInitialize
ä¼šè¯</p>
<p>Args: browser: æµè§ˆå™¨ ClassType (â€˜chromeâ€™, â€˜firefoxâ€™, â€˜safariâ€™,
â€˜androidâ€™) â€œâ€œâ€ identifier = self.PROFILES.get(browser, â€˜chrome_120â€™)
self.session = tls_client.Session( client_identifier=identifier,
random_tls_extension_order=True ) self._set_headers(browser)</p>
<p>def _set_headers(self, browser): â€œâ€œâ€œSetting å¯¹åº” HTTP å¤´â€â€œâ€
user_agents = { â€˜chromeâ€™: â€˜Mozilla/5.0 (Windows NT 10.0; Win64; x64)
AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36â€™,
â€˜firefoxâ€™: â€˜Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0)
Gecko/20100101 Firefox/121.0â€™, â€˜safariâ€™: â€˜Mozilla/5.0 (Macintosh; Intel
Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0
Safari/605.1.15â€™, â€˜androidâ€™: â€˜Mozilla/5.0 (Linux; Android 13)
AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.144 Mobile
Safari/537.36â€™ }</p>
<p>self.session.headers.update({ â€˜User-Agentâ€™:
user<em>agents.get(browser, user_agents[â€˜chromeâ€™]), â€˜Acceptâ€™:
â€™text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,</em>/_;q=0.8â€™,
â€˜Accept-Languageâ€™: â€˜en-US,en;q=0.5â€™, â€˜Accept-Encodingâ€™: â€˜gzip, deflate,
brâ€™, â€˜DNTâ€™: â€˜1â€™, â€˜Connectionâ€™: â€˜keep-aliveâ€™,
â€˜Upgrade-Insecure-Requestsâ€™: â€˜1â€™ })</p>
<p>def get(self, url, <strong>kwargs): â€œâ€œâ€œSend GET Requestâ€â€œâ€ return
self.session.get(url, </strong>kwargs)</p>
<p>def post(self, url, <strong>kwargs): â€œâ€œâ€œSend POST Requestâ€â€œâ€ return
self.session.post(url, </strong>kwargs)</p>
<p>def verify_fingerprint(self): â€œâ€œâ€œValidate TLS æŒ‡çº¹â€â€œâ€ r =
self.get(â€˜https://ja3er.com/jsonâ€™) return r.json()</p>
<h1 id="ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</h1>
<p>if <strong>name</strong> == â€˜<strong>main</strong>â€™: # åˆ›å»º Chrome
ä¼šè¯ browser = BrowserSession(â€˜chromeâ€™)</p>
<h1 id="éªŒè¯æŒ‡çº¹">éªŒè¯æŒ‡çº¹</h1>
<p>print(â€ Validate TLS æŒ‡çº¹â€¦â€œ) result = browser.verify_fingerprint()
print(fâ€JA3: {result[â€˜ja3â€™]}â€œ) print(fâ€User-Agent:
{result[â€˜User-Agentâ€™]}â€œ)</p>
<h1 id="å‘é€è¯·æ±‚">å‘é€è¯·æ±‚</h1>
<p>response = browser.get(â€˜https://api.example.com/dataâ€™) print(fâ€ç :
{response.status_code}â€œ)</p>
<pre><code></code></pre>
<pre><code>


&lt;!-- 01-Recipes/Scripts/automation_scripts.md --&gt;

# è‡ªåŠ¨åŒ–è„šæœ¬ (Automation Scripts)

åœ¨ Android é€†å‘å·¥ç¨‹ä¸­ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬å¯ä»¥æå¤§åœ°æé«˜æ•ˆç‡ï¼Œä¾‹å¦‚è‡ªåŠ¨å®‰è£… APKã€é‡å¯åº”ç”¨ã€æ¨¡æ‹Ÿç‚¹å‡»ä»¥åŠæ‰¹é‡å¤„ç†è®¾å¤‡ã€‚Python æ˜¯ç¼–å†™è¿™äº›è„šæœ¬çš„é¦–é€‰è¯­è¨€ã€‚

## 1. åŸºç¡€ ADB å°è£… (Python)

è™½ç„¶å¯ä»¥ç›´æ¥åœ¨ shell ä¸­è¿è¡Œ `adb` å‘½ä»¤ï¼Œä½†åœ¨ Python ä¸­å°è£…ä¸€å±‚å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œé€»è¾‘æ§åˆ¶ã€‚

```python
import subprocess
import time
import os

class AdbWrapper:
def __init__(self, device_id=None):
self.device_id = device_id

def run_cmd(self, cmd):
adb_cmd = [&quot;adb&quot;]
if self.device_id:
adb_cmd.extend([&quot;-s&quot;, self.device_id])
adb_cmd.extend(cmd)

try:
result = subprocess.run(
adb_cmd, 
capture_output=True, 
text=True, 
check=True
)
return result.stdout.strip()
except subprocess.CalledProcessError as e:
print(f&quot;Error running command {&#39; &#39;.join(adb_cmd)}: {e.stderr}&quot;)
return None

def install(self, apk_path):
print(f&quot;Installing {apk_path}...&quot;)
return self.run_cmd([&quot;install&quot;, &quot;-r&quot;, apk_path])

def uninstall(self, package_name):
print(f&quot;Uninstalling {package_name}...&quot;)
return self.run_cmd([&quot;uninstall&quot;, package_name])

def start_app(self, package_name, activity_name):
print(f&quot;Starting {package_name}/{activity_name}...&quot;)
return self.run_cmd([&quot;shell&quot;, &quot;am&quot;, &quot;start&quot;, &quot;-n&quot;, f&quot;{package_name}/{activity_name}&quot;])

def stop_app(self, package_name):
print(f&quot;Stopping {package_name}...&quot;)
return self.run_cmd([&quot;shell&quot;, &quot;am&quot;, &quot;force-stop&quot;, package_name])

def clear_data(self, package_name):
print(f&quot;Clearing data for {package_name}...&quot;)
return self.run_cmd([&quot;shell&quot;, &quot;pm&quot;, &quot;clear&quot;, package_name])

def click(self, x, y):
return self.run_cmd([&quot;shell&quot;, &quot;input&quot;, &quot;tap&quot;, str(x), str(y)])

def swipe(self, x1, y1, x2, y2, duration=500):
return self.run_cmd([&quot;shell&quot;, &quot;input&quot;, &quot;swipe&quot;, str(x1), str(y1), str(x2), str(y2), str(duration)])

def input_text(self, text):
# Note: special characters might need escaping
return self.run_cmd([&quot;shell&quot;, &quot;input&quot;, &quot;text&quot;, text])

def screenshot(self, remote_path=&quot;/sdcard/screenshot.png&quot;, local_path=&quot;screenshot.png&quot;):
self.run_cmd([&quot;shell&quot;, &quot;screencap&quot;, &quot;-p&quot;, remote_path])
self.run_cmd([&quot;pull&quot;, remote_path, local_path])
print(f&quot;Screenshot saved to {local_path}&quot;)

# UseExample
if __name__ == &quot;__main__&quot;:
adb = AdbWrapper() # é»˜è®¤è¿æ¥ç¬¬ä¸€ä¸ªè®¾å¤‡

# æ‰“å° connectedè®¾å¤‡
print(&quot;Devices:&quot;, adb.run_cmd([&quot;devices&quot;]))

# adb.start_app(&quot;com.example.app&quot;, &quot;com.example.app.MainActivity&quot;)
# time.sleep(5)
# adb.click(500, 1000)
# adb.screenshot()
</code></pre>
<p>pip install uiautomator2</p>
<pre><code>
import time

# Connect to to to to to to to device (USB)
d = u2.connect() 
# oré€šè¿‡ WiFi: d = u2.è¿æ¥(&#39;192.168.1.100&#39;)

print(f&quot;Connected to device: {d.info}&quot;)

# startupApp
pkg_name = &quot;com.example.android.apis&quot;
d.app_start(pkg_name)

# Wait forAppstartup
d.wait_activity(&quot;.ApiDemos&quot;, timeout=10)

# æŸ¥æ‰¾å¹¶ç‚¹å‡»å…ƒç´  (Supportå¤šç§é€‰æ‹©å™¨)
try:
# é€šè¿‡æ–‡æœ¬æŸ¥æ‰¾å¹¶ç‚¹å‡»
if d(text=&quot;App&quot;).exists:
d(text=&quot;App&quot;).click()

# é€šè¿‡ resourceId æŸ¥æ‰¾
# d(resourceId=&quot;com.example:id/button&quot;).click()

# æ»šåŠ¨æŸ¥æ‰¾ (å‘ä¸‹æ»‘åŠ¨ç›´åˆ°æ‰¾åˆ°æ–‡æœ¬ä¸º &#39;é€šçŸ¥&#39; å…ƒç´ )
d(scrollable=True).scroll.to(text=&quot;Notification&quot;)
d(text=&quot;Notification&quot;).click()

# è¾“å…¥æ–‡æœ¬
# d(resourceId=&quot;com.example:id/edit_text&quot;).set_text(&quot;Hello World&quot;)

# æˆªå›¾
d.screenshot(&quot;uiauto_screenshot.jpg&quot;)

except Exception as e:
print(f&quot;Error: {e}&quot;)

finally:
# åœæ­¢ App
# d.app_stoperation (pkg_name)
pass
</code></pre>
<p>import glob from concurrent.futures import ThreadPoolExecutor</p>
<p>class BatchManager: def <strong>init</strong>(self, adb_wrapper):
self.adb = adb_wrapper</p>
<p>def install_all(self, directory): apk_files =
glob.glob(os.path.join(directory, â€œ*.apkâ€)) print(fâ€Found
{len(apk_files)} APKs.â€)</p>
<h1
id="usethreadæ± concurrentinstall-æ³¨æ„adb-concurrentå¯èƒ½ä¸stableè§†æƒ…å†µè°ƒæ•´">UseThreadæ± ConcurrentInstall
(æ³¨æ„ï¼šADB Concurrentå¯èƒ½ä¸Stableï¼Œè§†æƒ…å†µè°ƒæ•´)</h1>
<p>with ThreadPoolExecutor(max_workers=3) as executor:
executor.map(self.adb.install, apk_files)</p>
<p>def setup_proxy(self, host, port): print(fâ€Setting global http proxy
to {host}:{port}â€¦â€œ) self.adb.run_cmd([â€œshellâ€, â€œsettingsâ€, â€œputâ€,
â€œglobalâ€, â€œhttp_proxyâ€, fâ€{host}:{port}â€])</p>
<p>def clear_proxy(self): print(â€œClearing global http proxyâ€¦â€)
self.adb.run_cmd([â€œshellâ€, â€œsettingsâ€, â€œputâ€, â€œglobalâ€, â€œhttp_proxyâ€,
â€œ:0â€])</p>
<h1 id="useexample-1">UseExample</h1>
<p>if <strong>name</strong> == â€œ<strong>main</strong>â€: adb =
AdbWrapper() manager = BatchManager(adb)</p>
<h1 id="æ‰¹é‡å®‰è£…å½“å‰ç›®å½•ä¸‹-apks-æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰-apk">æ‰¹é‡å®‰è£…å½“å‰ç›®å½•ä¸‹
apks æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰ apk</h1>
<h1 id="manager.install_all.apks">manager.install_all(â€œ./apksâ€)</h1>
<h1
id="settingssssssä»£ç†ä»¥ä¾¿æŠ“package">settingssssssä»£ç†ä»¥ä¾¿æŠ“Package</h1>
<h1
id="manager.setup_proxy192.168.1.10-8080">manager.setup_proxy(â€œ192.168.1.10â€,
â€œ8080â€)</h1>
<!-- 01-Recipes/Scripts/c_for_emulation.md -->
<h1 id="c-ä»£ç ç”¨äºè¿è¡Œæ—¶ä»¿çœŸä¸è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ">C
ä»£ç ï¼šç”¨äºè¿è¡Œæ—¶ä»¿çœŸä¸è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ</h1>
<p>åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œç›´æ¥ä½¿ç”¨ C/C++
ç¼–å†™ä¸€äº›è¾…åŠ©å·¥å…·æˆ–é‡ç°ç›®æ ‡é€»è¾‘æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„ç­–ç•¥ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬è„±ç¦»å¤æ‚çš„
App ç¯å¢ƒï¼Œå¯¹æ ¸å¿ƒç®—æ³•è¿›è¡Œç‹¬ç«‹çš„æµ‹è¯•ã€Fuzzing æˆ–ä»¿çœŸã€‚</p>
<h2 id="è¿è¡Œæ—¶ä»¿çœŸ-runtime-emulation">1. è¿è¡Œæ—¶ä»¿çœŸ (Runtime
Emulation)</h2>
<p>å½“æˆ‘ä»¬åœ¨ SO
æ–‡ä»¶ä¸­å®šä½åˆ°ä¸€ä¸ªå…³é”®çš„æ ¸å¿ƒç®—æ³•ï¼ˆå¦‚è‡ªå®šä¹‰åŠ å¯†ã€ç­¾åç”Ÿæˆï¼‰åï¼Œå¦‚æœè¯¥ç®—æ³•é€»è¾‘æ¸…æ™°ä¸”ä¾èµ–è¾ƒå°‘ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯å°†å…¶é€»è¾‘ç”¨
C/C++ â€œç¿»è¯‘â€ä¸€éã€‚</p>
<ul>
<li>*åœºæ™¯ç¤ºä¾‹ï¼šé‡ç°ä¸€ä¸ªç®€å•çš„ XOR åŠ å¯†ç®—æ³•**</li>
</ul>
<p>å‡è®¾åœ¨ IDA Pro ä¸­çœ‹åˆ°å¦‚ä¸‹ä¼ªä»£ç ï¼š</p>
<div class="sourceCode" id="cb312"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Decompiled pseudo-code from IDA</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> encrypt_data<span class="op">(</span><span class="dt">char</span><span class="op">*</span> data<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>data<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>data<span class="op">[</span>i<span class="op">]</span> <span class="op">^</span> <span class="bn">0x5A</span><span class="op">)</span> <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>// Re-implementation of the encryption algorithm void
simulate_encrypt(char* data, size_t len) { for (size_t i = 0; i &lt;
len; ++i) { data<a href="#i">i</a> = (data<a href="#i">i</a> ^ 0x5A) +
5; } }</p>
<p>// Corresponding decryption for our own testing void
simulate_decrypt(char* data, size_t len) { for (size_t i = 0; i &lt;
len; ++i) { data<a href="#i">i</a> = (data<a href="#i">i</a> - 5) ^
0x5A; } }</p>
<p>int main() { char my_data[] = â€œthis_is_a_test_messageâ€; size_t len =
strlen(my_data);</p>
<p>printf(â€œOriginal: %sâ€, my_data);</p>
<p>// Encrypt it simulate_encrypt(my_data, len); printf(â€œEncrypted (as
hex):â€); for(size_t i = 0; i &lt; len; ++i) { printf(â€œ%02xâ€, (unsigned
char)my_data<a href="#i">i</a>); } printf(â€œâ€);</p>
<p>// Decrypt it simulate_decrypt(my_data, len); printf(â€œDecrypted: %sâ€,
my_data);</p>
<p>return 0; }</p>
<pre><code>
## 2. è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ (Device Fingerprint Generation)

è®¸å¤š App ä¼šé€šè¿‡è¯»å– Android ç³»ç»Ÿçš„ `build.prop` æˆ–å…¶ä»–ç³»ç»Ÿå±æ€§æ¥ç”Ÿæˆè®¾å¤‡æŒ‡çº¹ï¼Œç”¨äºè¯†åˆ«å’Œè·Ÿè¸ªè®¾å¤‡ã€‚åœ¨è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ¨¡æ‹Ÿè¿™äº›æŒ‡çº¹ã€‚

`getprop` æ˜¯ Android shell ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥è¯»å–ç³»ç»Ÿå±æ€§ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ C ä»£ç åœ¨ Native å±‚å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä»è€Œç”Ÿæˆå¯ä»¥ä¹±çœŸçš„æŒ‡çº¹æ•°æ®ã€‚

* *åœºæ™¯ç¤ºä¾‹ï¼šç”¨ C è¯»å–å…³é”®è®¾å¤‡å±æ€§å¹¶ç”Ÿæˆ JSON**

```c
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

// A simple wrapper to execute a shell command and get its output
// In a real scenario, you might use direct system calls for better performance/stealth
char* get_prop(const char* key) {
char command[256];
snprintf(command, sizeof(command), &quot;getprop %s&quot;, key);

FILE* fp = popen(command, &quot;r&quot;);
if (fp == NULL) {
return NULL;
}

char* line = malloc(256);
if (fgets(line, 256, fp) == NULL) {
free(line);
pclose(fp);
return NULL;
}

// Remove trailing newline
line[strcspn(line, &quot;\n&quot;)] = 0;
pclose(fp);
return line;
}

int main() {
// List of properties we want to fetch
const char* props_to_fetch[] = {
&quot;ro.product.brand&quot;,
&quot;ro.product.model&quot;,
&quot;ro.product.manufacturer&quot;,
&quot;ro.build.version.release&quot;,
&quot;ro.build.version.sdk&quot;,
&quot;ro.build.fingerprint&quot;
};
int num_props = sizeof(props_to_fetch) / sizeof(props_to_fetch[0]);

printf(&quot;{\n&quot;);
for (int i = 0; i &lt; num_props; ++i) {
char* value = get_prop(props_to_fetch[i]);
if (value) {
printf(&quot; \&quot;%s\&quot;: \&quot;%s\&quot;&quot;, props_to_fetch[i], value);
if (i &lt; num_props - 1) {
printf(&quot;,&quot;);
}
printf(&quot;\n&quot;);
free(value);
}
}
printf(&quot;}\n&quot;);

return 0;
}
</code></pre>
<pre><code>    ```bash
# (NDK_PATH is the path to your android NDK)
# This command is for arm64 architecture, adjust as needed
$NDK_PATH/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android21-clang fingerprinter.c -o fingerprinter
# Then push to device and run
# adb push fingerprinter /data/local/tmp/
# adb shell &#39;cd /data/local/tmp/ &amp;&amp; ./fingerprinter&#39;
</code></pre>
<pre><code>


&lt;!-- 01-Recipes/Scripts/frida_common_scripts.md --&gt;

# Recipe: Frida å¸¸ç”¨è„šæœ¬é€ŸæŸ¥æ‰‹å†Œ

## é—®é¢˜åœºæ™¯

ä½ åœ¨ä½¿ç”¨ Frida è¿›è¡Œ Android é€†å‘æ—¶ï¼Œç»å¸¸é‡åˆ°ä»¥ä¸‹æƒ…å†µï¼š

- ğŸ’­ **&quot;æˆ‘éœ€è¦ç»•è¿‡ SSL Pinning æŠ“åŒ…ï¼Œä½†ä¸æƒ³ä»é›¶å†™è„šæœ¬&quot;**
- ğŸ’­ **&quot;å¦‚ä½•å¿«é€Ÿ Hook æ‰€æœ‰ JNI å‡½æ•°æ¥åˆ†æ Native å±‚ï¼Ÿ&quot;**
- ğŸ’­ **&quot;æƒ³æ‹¦æˆªå¹¶ä¿®æ”¹ç½‘ç»œè¯·æ±‚ï¼Œæœ‰ç°æˆçš„æ¨¡æ¿å—ï¼Ÿ&quot;**
- ğŸ’­ **&quot;éœ€è¦ä» PC ç«¯ä¸»åŠ¨è°ƒç”¨ App çš„åŠ å¯†å‡½æ•°ï¼Œæ€ä¹ˆå†™ RPCï¼Ÿ&quot;**
- ğŸ’­ **&quot;App æ£€æµ‹åˆ° Frida å°±é—ªé€€ï¼Œæœ‰é€šç”¨çš„ç»•è¿‡è„šæœ¬å—ï¼Ÿ&quot;**

æœ¬é…æ–¹æä¾›ä¸€å¥—**ç»è¿‡å®æˆ˜éªŒè¯**çš„ Frida è„šæœ¬æ¨¡æ¿åº“ï¼ŒæŒ‰åœºæ™¯åˆ†ç±»ï¼Œå¯ç›´æ¥ä½¿ç”¨æˆ–å¿«é€Ÿä¿®æ”¹ã€‚æ¯ä¸ªè„šæœ¬éƒ½åŒ…å«è¯¦ç»†æ³¨é‡Šå’Œä½¿ç”¨è¯´æ˜ã€‚

___

## å·¥å…·æ¸…å•

### å¿…éœ€å·¥å…·

- [x] **Frida** - å·²å®‰è£…å¹¶é…ç½®å¥½ (å‚è€ƒ [Frida ä½¿ç”¨æŒ‡å—](../../02-Tools/Dynamic/frida_guide.md))
- [x] **Root è®¾å¤‡/æ¨¡æ‹Ÿå™¨** - è¿è¡Œ Frida Server
- [x] **ç›®æ ‡åº”ç”¨å·²å®‰è£…** - éœ€è¦åˆ†æçš„ App

### å¯é€‰å·¥å…·

- â˜ **Python 3** - ç”¨äº RPC æ§åˆ¶è„šæœ¬
- â˜ **mitmproxy/Burp Suite** - é…åˆ SSL Pinning ç»•è¿‡ä½¿ç”¨
- â˜ **IDA Pro/Ghidra** - ç”¨äºåˆ†æ Native ä»£ç ç¡®å®š Hook ç‚¹

___

## å‰ç½®æ¡ä»¶

âœ… **Frida ç¯å¢ƒå·²é…ç½®**å¹¶èƒ½æˆåŠŸ attach åˆ°ç›®æ ‡åº”ç”¨
âœ… **äº†è§£åŸºæœ¬çš„ JavaScript è¯­æ³•**
âœ… **çŸ¥é“å¦‚ä½•è¿è¡Œ Frida è„šæœ¬** (`frida -U -f com.app -l script.js`)
âœ… **èƒ½è¯†åˆ«éœ€è¦ Hook çš„ç±»/å‡½æ•°å**ï¼ˆè‡³å°‘çŸ¥é“åŒ…åï¼‰

___

## è„šæœ¬ç´¢å¼•

æœ¬æ‰‹å†ŒåŒ…å«ä»¥ä¸‹ **8 ç±»åœºæ™¯**çš„è„šæœ¬ï¼š

| åœºæ™¯ | è„šæœ¬æ•°é‡ | é€‚ç”¨æƒ…å†µ |
| ---------------------------------------- | -------- | ----------------------------- |
| ğŸ›¡ï¸ [ç»•è¿‡ä¿æŠ¤æœºåˆ¶](#1-ç»•è¿‡ä¿æŠ¤æœºåˆ¶) | 3 ä¸ª | åè°ƒè¯•ã€å Fridaã€SSL Pinning |
| [ç½‘ç»œæ‹¦æˆªä¸ä¿®æ”¹](#2-ç½‘ç»œæ‹¦æˆªä¸ä¿®æ”¹) | 1 ä¸ª | æŠ“åŒ…ã€ä¿®æ”¹è¯·æ±‚/å“åº” |
| [è‡ªåŠ¨åŒ– RPC è°ƒç”¨](#3-è‡ªåŠ¨åŒ–-rpc-è°ƒç”¨) | 1 å¥— | ä¸»åŠ¨è°ƒç”¨åŠ å¯†å‡½æ•°ã€æ‰¹é‡æµ‹è¯• |
| [JNI å‡½æ•°åˆ†æ](#4-jni-å‡½æ•°åˆ†æ) | 5 ä¸ª | Native å±‚é€†å‘ã€å‚æ•°è¿½è¸ª |
| [é€šç”¨ Hook æ¨¡æ¿](#5-é€šç”¨-hook-æ¨¡æ¿) | 3 ä¸ª | å¿«é€Ÿå®šä½ã€æ‰¹é‡ Hook |
| [C ä»£ç è¾…åŠ©å·¥å…·](#6-c-ä»£ç è¾…åŠ©å·¥å…·) | 2 ä¸ª | ç®—æ³•ä»¿çœŸã€è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ |

___

## 1. ç»•è¿‡ä¿æŠ¤æœºåˆ¶

### è„šæœ¬ 1.1: ç»•è¿‡ TracerPid åè°ƒè¯•æ£€æµ‹

\*ä½•æ—¶ä½¿ç”¨\*: App é€šè¿‡è¯»å– `/proc/self/status` ä¸­çš„ `TracerPid` æ¥æ£€æµ‹è°ƒè¯•å™¨ã€‚

\*å·¥ä½œåŸç†\*: Hook `fgets` å‡½æ•°ï¼Œå½“æ£€æµ‹åˆ°è¯»å– `TracerPid` æ—¶ï¼Œå°†å…¶å€¼å¼ºåˆ¶æ”¹ä¸º 0ã€‚

```javascript
// bypass_tracerpid.js - Bypass TracerPid Anti-Debugging

// Step 1: Establish FILE* to path mapping
var fpMap = {};

// Hook fopen to record file paths
Interceptor.attach(Module.findExportByName(null, &quot;fopen&quot;), {
onEnter: function (args) {
this.path = args[0].readCString();
},
onLeave: function (retval) {
if (!retval.isNull() &amp;&amp; this.path) {
fpMap[retval.toString()] = this.path;
if (this.path.includes(&quot;/status&quot;)) {
console.log(&quot;[+] fopen: &quot; + this.path);
}
}
},
});

// Hook fgets to modify TracerPid value
Interceptor.attach(Module.findExportByName(null, &quot;fgets&quot;), {
onEnter: function (args) {
this.buf = args[0];
this.fp = args[2];
},
onLeave: function (retval) {
if (retval.isNull()) return;

var fp = this.fp.toString();
var path = fpMap[fp];

if (path &amp;&amp; path.endsWith(&quot;/status&quot;)) {
var line = this.buf.readCString();

if (line &amp;&amp; line.includes(&quot;TracerPid:&quot;)) {
var oldValue = line.match(/TracerPid:\s*(\d+)/);
this.buf.writeUtf8String(&quot;TracerPid:\t0\n&quot;);

if (oldValue &amp;&amp; oldValue[1] !== &quot;0&quot;) {
console.log(&quot;âœ“ [TracerPid] Modify: &quot; + oldValue[1] + &quot; -&gt; 0&quot;);
}
}
}
},
});

console.log(&quot;[+] TracerPid Anti-Debugging Bypass activated&quot;);
</code></pre>
<h1 id="attach-mode">Attach mode</h1>
<p>frida -U com.target.app -l bypass_tracerpid.js</p>
<pre><code>
**å·¥ä½œåŸç†**: Hook å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°ï¼Œå½“å‘ç°æ¯”è¾ƒå†…å®¹åŒ…å« &quot;frida&quot; æ—¶ï¼Œè¿”å›ä¸åŒ¹é…ã€‚

```javascript
// hide_frida_strings.js - Hide Frida signature strings

// Hook strstr (most commonly used string search function)
var strstrPtr = Module.findExportByName(&#39;libc.so&#39;, &#39;strstr&#39;);
if (strstrPtr) {
Interceptor.attach(strstrPtr, {
onEnter: function(args) {
this.haystack = args[0].readCString();
this.needle = args[1].readCString();
},
onLeave: function(retval) {
if (this.haystack &amp;&amp; this.needle) {
var haystackLower = this.haystack.toLowerCase();
var needleLower = this.needle.toLowerCase();

if (haystackLower.includes(&#39;frida&#39;) || needleLower.includes(&#39;frida&#39;)) {
console.log(&quot;âœ“ [strstr] Intercept Frida Detection:&quot;);
console.log(&quot; Search: \&quot;&quot; + this.needle + &quot;\&quot; in \&quot;&quot; + this.haystack.substring(0, 50) + &quot;...\&quot;&quot;);
retval.replace(ptr(0)); // Return NULL (not found)
}
}
}
});
console.log(&quot;[+] strstr hook configured&quot;);
}

// Hook strcmp
var strcmpPtr = Module.findExportByName(&#39;libc.so&#39;, &#39;strcmp&#39;);
if (strcmpPtr) {
Interceptor.attach(strcmpPtr, {
onEnter: function(args) {
this.str1 = args[0].readCString();
this.str2 = args[1].readCString();
},
onLeave: function(retval) {
if (this.str1 &amp;&amp; this.str2) {
var str1Lower = this.str1.toLowerCase();
var str2Lower = this.str2.toLowerCase();

if (str1Lower.includes(&#39;frida&#39;) || str2Lower.includes(&#39;frida&#39;)) {
console.log(&quot;âœ“ [strcmp] Intercept Frida Detection:&quot;);
console.log(&quot; Comparing: \&quot;&quot; + this.str1 + &quot;\&quot; vs \&quot;&quot; + this.str2 + &quot;\&quot;&quot;);
retval.replace(1); // Return non-zero (not equal)
}
}
}
});
console.log(&quot;[+] strcmp hook configured&quot;);
}

console.log(&quot;[+] Frida string hiding activated&quot;);
</code></pre>
<p><strong>å·¥ä½œåŸç†</strong>: Hook
å¸¸è§ç½‘ç»œåº“ï¼ˆTrustManagerã€OkHttp3ã€HttpsURLConnectionï¼‰çš„è¯ä¹¦æ ¡éªŒå‡½æ•°ã€‚</p>
<div class="sourceCode" id="cb317"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co">// bypass_ssl_pinning.js - Universal SSL Pinning Bypass Script</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Starting SSL Pinning bypass...&quot;</span>)<span class="op">;</span></span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. TrustManagerImpl (system level)</span></span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-9"><a href="#cb317-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb317-10"><a href="#cb317-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TrustManagerImpl <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb317-11"><a href="#cb317-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;com.android.org.conscrypt.TrustManagerImpl&quot;</span></span>
<span id="cb317-12"><a href="#cb317-12" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb317-13"><a href="#cb317-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-14"><a href="#cb317-14" aria-hidden="true" tabindex="-1"></a><span class="co">// android 7.0+</span></span>
<span id="cb317-15"><a href="#cb317-15" aria-hidden="true" tabindex="-1"></a>TrustManagerImpl<span class="op">.</span><span class="at">verifyChain</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (</span>
<span id="cb317-16"><a href="#cb317-16" aria-hidden="true" tabindex="-1"></a>untrustedChain<span class="op">,</span></span>
<span id="cb317-17"><a href="#cb317-17" aria-hidden="true" tabindex="-1"></a>trustAnchorChain<span class="op">,</span></span>
<span id="cb317-18"><a href="#cb317-18" aria-hidden="true" tabindex="-1"></a>host<span class="op">,</span></span>
<span id="cb317-19"><a href="#cb317-19" aria-hidden="true" tabindex="-1"></a>clientAuth<span class="op">,</span></span>
<span id="cb317-20"><a href="#cb317-20" aria-hidden="true" tabindex="-1"></a>ocspData<span class="op">,</span></span>
<span id="cb317-21"><a href="#cb317-21" aria-hidden="true" tabindex="-1"></a>tlsSctData</span>
<span id="cb317-22"><a href="#cb317-22" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb317-23"><a href="#cb317-23" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [TrustManagerImpl] Bypass cert validation: &quot;</span> <span class="op">+</span> host)<span class="op">;</span></span>
<span id="cb317-24"><a href="#cb317-24" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> untrustedChain<span class="op">;</span> <span class="co">// Trust directly</span></span>
<span id="cb317-25"><a href="#cb317-25" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-26"><a href="#cb317-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-27"><a href="#cb317-27" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] TrustManagerImpl Hook æˆåŠŸ&quot;</span>)<span class="op">;</span></span>
<span id="cb317-28"><a href="#cb317-28" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb317-29"><a href="#cb317-29" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] TrustManagerImpl not found: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb317-30"><a href="#cb317-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-31"><a href="#cb317-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-32"><a href="#cb317-32" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-33"><a href="#cb317-33" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. OkHttp3 (most commonly used)</span></span>
<span id="cb317-34"><a href="#cb317-34" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-35"><a href="#cb317-35" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb317-36"><a href="#cb317-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CertificatePinner <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;okhttp3.CertificatePinner&quot;</span>)<span class="op">;</span></span>
<span id="cb317-37"><a href="#cb317-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-38"><a href="#cb317-38" aria-hidden="true" tabindex="-1"></a>CertificatePinner<span class="op">.</span><span class="at">check</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb317-39"><a href="#cb317-39" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.lang.String&quot;</span><span class="op">,</span></span>
<span id="cb317-40"><a href="#cb317-40" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.util.List&quot;</span></span>
<span id="cb317-41"><a href="#cb317-41" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (hostname<span class="op">,</span> peerCertificates) {</span>
<span id="cb317-42"><a href="#cb317-42" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [OkHttp3] Bypass cert pinning: &quot;</span> <span class="op">+</span> hostname)<span class="op">;</span></span>
<span id="cb317-43"><a href="#cb317-43" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span> <span class="co">// Skip all checks</span></span>
<span id="cb317-44"><a href="#cb317-44" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-45"><a href="#cb317-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-46"><a href="#cb317-46" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] OkHttp3 CertificatePinner Hook æˆåŠŸ&quot;</span>)<span class="op">;</span></span>
<span id="cb317-47"><a href="#cb317-47" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb317-48"><a href="#cb317-48" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] OkHttp3 not found: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb317-49"><a href="#cb317-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-50"><a href="#cb317-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-51"><a href="#cb317-51" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-52"><a href="#cb317-52" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. OkHttp3 - Hostname Verifier</span></span>
<span id="cb317-53"><a href="#cb317-53" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-54"><a href="#cb317-54" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb317-55"><a href="#cb317-55" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OkHostnameVerifier <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb317-56"><a href="#cb317-56" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;okhttp3.internal.tls.OkHostnameVerifier&quot;</span></span>
<span id="cb317-57"><a href="#cb317-57" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb317-58"><a href="#cb317-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-59"><a href="#cb317-59" aria-hidden="true" tabindex="-1"></a>OkHostnameVerifier<span class="op">.</span><span class="at">verify</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb317-60"><a href="#cb317-60" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.lang.String&quot;</span><span class="op">,</span></span>
<span id="cb317-61"><a href="#cb317-61" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;javax.net.ssl.SSLSession&quot;</span></span>
<span id="cb317-62"><a href="#cb317-62" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (host<span class="op">,</span> session) {</span>
<span id="cb317-63"><a href="#cb317-63" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [OkHttp3] Bypass hostname validation: &quot;</span> <span class="op">+</span> host)<span class="op">;</span></span>
<span id="cb317-64"><a href="#cb317-64" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// Always return validation passed</span></span>
<span id="cb317-65"><a href="#cb317-65" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-66"><a href="#cb317-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-67"><a href="#cb317-67" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] OkHostnameVerifier Hook æˆåŠŸ&quot;</span>)<span class="op">;</span></span>
<span id="cb317-68"><a href="#cb317-68" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb317-69"><a href="#cb317-69" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] OkHostnameVerifier not found: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb317-70"><a href="#cb317-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-71"><a href="#cb317-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-72"><a href="#cb317-72" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-73"><a href="#cb317-73" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. HttpsURLConnection</span></span>
<span id="cb317-74"><a href="#cb317-74" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-75"><a href="#cb317-75" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb317-76"><a href="#cb317-76" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> HttpsURLConnection <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.HttpsURLConnection&quot;</span>)<span class="op">;</span></span>
<span id="cb317-77"><a href="#cb317-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-78"><a href="#cb317-78" aria-hidden="true" tabindex="-1"></a>HttpsURLConnection<span class="op">.</span><span class="at">setDefaultHostnameVerifier</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (</span>
<span id="cb317-79"><a href="#cb317-79" aria-hidden="true" tabindex="-1"></a>hostnameVerifier</span>
<span id="cb317-80"><a href="#cb317-80" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb317-81"><a href="#cb317-81" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb317-82"><a href="#cb317-82" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;âœ“ [HttpsURLConnection] Intercept setDefaultHostnameVerifier&quot;</span></span>
<span id="cb317-83"><a href="#cb317-83" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb317-84"><a href="#cb317-84" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span> <span class="co">// Don&#39;t set verifier</span></span>
<span id="cb317-85"><a href="#cb317-85" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-86"><a href="#cb317-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-87"><a href="#cb317-87" aria-hidden="true" tabindex="-1"></a>HttpsURLConnection<span class="op">.</span><span class="at">setSSLSocketFactory</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (</span>
<span id="cb317-88"><a href="#cb317-88" aria-hidden="true" tabindex="-1"></a>socketFactory</span>
<span id="cb317-89"><a href="#cb317-89" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb317-90"><a href="#cb317-90" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [HttpsURLConnection] Intercept setSSLSocketFactory&quot;</span>)<span class="op">;</span></span>
<span id="cb317-91"><a href="#cb317-91" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span> <span class="co">// Don&#39;t set factory</span></span>
<span id="cb317-92"><a href="#cb317-92" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-93"><a href="#cb317-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-94"><a href="#cb317-94" aria-hidden="true" tabindex="-1"></a>HttpsURLConnection<span class="op">.</span><span class="at">setHostnameVerifier</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (</span>
<span id="cb317-95"><a href="#cb317-95" aria-hidden="true" tabindex="-1"></a>hostnameVerifier</span>
<span id="cb317-96"><a href="#cb317-96" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb317-97"><a href="#cb317-97" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [HttpsURLConnection] Intercept setHostnameVerifier&quot;</span>)<span class="op">;</span></span>
<span id="cb317-98"><a href="#cb317-98" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb317-99"><a href="#cb317-99" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-100"><a href="#cb317-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-101"><a href="#cb317-101" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] HttpsURLConnection Hook æˆåŠŸ&quot;</span>)<span class="op">;</span></span>
<span id="cb317-102"><a href="#cb317-102" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb317-103"><a href="#cb317-103" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] HttpsURLConnection Hook Failed: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb317-104"><a href="#cb317-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-105"><a href="#cb317-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-106"><a href="#cb317-106" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-107"><a href="#cb317-107" aria-hidden="true" tabindex="-1"></a><span class="co">// 5. SSLContext</span></span>
<span id="cb317-108"><a href="#cb317-108" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb317-109"><a href="#cb317-109" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb317-110"><a href="#cb317-110" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SSLContext <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.SSLContext&quot;</span>)<span class="op">;</span></span>
<span id="cb317-111"><a href="#cb317-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-112"><a href="#cb317-112" aria-hidden="true" tabindex="-1"></a>SSLContext<span class="op">.</span><span class="at">init</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb317-113"><a href="#cb317-113" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;[Ljavax.net.ssl.KeyManager;&quot;</span><span class="op">,</span></span>
<span id="cb317-114"><a href="#cb317-114" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;[Ljavax.net.ssl.TrustManager;&quot;</span><span class="op">,</span></span>
<span id="cb317-115"><a href="#cb317-115" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.security.SecureRandom&quot;</span></span>
<span id="cb317-116"><a href="#cb317-116" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (km<span class="op">,</span> tm<span class="op">,</span> random) {</span>
<span id="cb317-117"><a href="#cb317-117" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [SSLContext] Use custom TrustManager&quot;</span>)<span class="op">;</span></span>
<span id="cb317-118"><a href="#cb317-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-119"><a href="#cb317-119" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a TrustManager that trusts all certificates</span></span>
<span id="cb317-120"><a href="#cb317-120" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TrustManager <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.X509TrustManager&quot;</span>)<span class="op">;</span></span>
<span id="cb317-121"><a href="#cb317-121" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> EmptyTrustManager <span class="op">=</span> Java<span class="op">.</span><span class="fu">registerClass</span>({</span>
<span id="cb317-122"><a href="#cb317-122" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;com.frida.EmptyTrustManager&quot;</span><span class="op">,</span></span>
<span id="cb317-123"><a href="#cb317-123" aria-hidden="true" tabindex="-1"></a><span class="dt">implements</span><span class="op">:</span> [TrustManager]<span class="op">,</span></span>
<span id="cb317-124"><a href="#cb317-124" aria-hidden="true" tabindex="-1"></a><span class="dt">methods</span><span class="op">:</span> {</span>
<span id="cb317-125"><a href="#cb317-125" aria-hidden="true" tabindex="-1"></a><span class="dt">checkClientTrusted</span><span class="op">:</span> <span class="kw">function</span> (chain<span class="op">,</span> authType) {}<span class="op">,</span></span>
<span id="cb317-126"><a href="#cb317-126" aria-hidden="true" tabindex="-1"></a><span class="dt">checkServerTrusted</span><span class="op">:</span> <span class="kw">function</span> (chain<span class="op">,</span> authType) {}<span class="op">,</span></span>
<span id="cb317-127"><a href="#cb317-127" aria-hidden="true" tabindex="-1"></a><span class="dt">getAcceptedIssuers</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb317-128"><a href="#cb317-128" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb317-129"><a href="#cb317-129" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb317-130"><a href="#cb317-130" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb317-131"><a href="#cb317-131" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb317-132"><a href="#cb317-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-133"><a href="#cb317-133" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> emptyTrustManager <span class="op">=</span> EmptyTrustManager<span class="op">.</span><span class="fu">$new</span>()<span class="op">;</span></span>
<span id="cb317-134"><a href="#cb317-134" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">init</span>(km<span class="op">,</span> [emptyTrustManager]<span class="op">,</span> random)<span class="op">;</span></span>
<span id="cb317-135"><a href="#cb317-135" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb317-136"><a href="#cb317-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-137"><a href="#cb317-137" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] SSLContext Hook æˆåŠŸ&quot;</span>)<span class="op">;</span></span>
<span id="cb317-138"><a href="#cb317-138" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb317-139"><a href="#cb317-139" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] SSLContext Hook Failed: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb317-140"><a href="#cb317-140" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-141"><a href="#cb317-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-142"><a href="#cb317-142" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] SSL Pinning bypass configuration complete&quot;</span>)<span class="op">;</span></span>
<span id="cb317-143"><a href="#cb317-143" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h1 id="run-script">2. Run script</h1>
<p>frida -U -f com.target.app -l bypass_ssl_pinning.js â€“no-pause</p>
<h1 id="view-traffic-in-burpmitmproxy">3. View traffic in
Burp/mitmproxy</h1>
<pre><code>
* *ä½•æ—¶ä½¿ç”¨**: éœ€è¦åœ¨ä¸ä½¿ç”¨ä»£ç†çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨ App å†…éƒ¨æ‹¦æˆªå’Œä¿®æ”¹ç½‘ç»œæµé‡ã€‚

* *å·¥ä½œåŸç†**: Hook OkHttp3 çš„ `RealInterceptorChain.proceed` æ–¹æ³•ï¼Œå¯ä»¥è®¿é—®å’Œä¿®æ”¹è¯·æ±‚/å“åº”ã€‚

```javascript
// intercept_okhttp.js - Intercept and modify OkHttp3 network requests

Java.perform(function() {
console.log(&quot;[+] Starting OkHttp3 hook...&quot;);

try {
var RealInterceptorChain = Java.use(&#39;okhttp3.internal.http.RealInterceptorChain&#39;);

RealInterceptorChain.proceed.implementation = function(request) {
// ========================================
// Request Interception
// ========================================
console.log(&quot;\n[REQUEST] ========================================&quot;);
console.log(&quot; URL: &quot; + request.url().toString());
console.log(&quot; Method: &quot; + request.method());

// Print request headers
var headers = request.headers();
var headerCount = headers.size();
if (headerCount &gt; 0) {
console.log(&quot; Headers:&quot;);
for (var i = 0; i &lt; headerCount; i++) {
console.log(&quot; &quot; + headers.name(i) + &quot;: &quot; + headers.value(i));
}
}

// Print request body
var requestBody = request.body();
if (requestBody) {
try {
var Buffer = Java.use(&#39;okio.Buffer&#39;);
var buffer = Buffer.$new();
requestBody.writeTo(buffer);
var bodyString = buffer.readUtf8();
console.log(&quot; Body: &quot; + bodyString);
} catch (e) {
console.log(&quot; Body: [Cannot read]&quot;);
}
}

// ========================================
// Modify Request (Optional)
// ========================================
var modifiedRequest = request.newBuilder()
.header(&#39;X-Custom-Header&#39;, &#39;Injected-By-Frida&#39;) // Add custom header
.header(&#39;User-Agent&#39;, &#39;FridaBot/1.0&#39;) // Modify User-Agent
.build();

// Execute request
var response = this.proceed(modifiedRequest);

// ========================================
// Response Interception
// ========================================
console.log(&quot;\n[RESPONSE] ========================================&quot;);
console.log(&quot; Code: &quot; + response.code());
console.log(&quot; Message: &quot; + response.message());

// Print response headers
var respHeaders = response.headers();
var respHeaderCount = respHeaders.size();
if (respHeaderCount &gt; 0) {
console.log(&quot; Headers:&quot;);
for (var i = 0; i &lt; respHeaderCount; i++) {
console.log(&quot; &quot; + respHeaders.name(i) + &quot;: &quot; + respHeaders.value(i));
}
}

// ========================================
// Modify Response (Optional)
// ========================================
var responseBody = response.body();
if (responseBody) {
try {
var contentType = responseBody.contentType();
var bodyString = responseBody.string();

console.log(&quot; Body: &quot; + bodyString.substring(0, 500));

// Example: Modify JSON response field
if (bodyString.includes(&#39;&quot;status&quot;&#39;)) {
var modifiedBody = bodyString.replace(/&quot;status&quot;:&quot;error&quot;/g, &#39;&quot;status&quot;:&quot;success&quot;&#39;);
console.log(&quot;âœ“ [Modify] Status field: error -&gt; success&quot;);

// Rebuild response
var MediaType = Java.use(&#39;okhttp3.MediaType&#39;);
var ResponseBody = Java.use(&#39;okhttp3.ResponseBody&#39;);

var newBody = ResponseBody.create(contentType, modifiedBody);

return response.newBuilder()
.body(newBody)
.build();
}

// If not modified, need to recreate body (because it was already read)
var ResponseBody = Java.use(&#39;okhttp3.ResponseBody&#39;);
var newBody = ResponseBody.create(contentType, bodyString);

return response.newBuilder()
.body(newBody)
.build();

} catch (e) {
console.log(&quot; Body: [Read failed] &quot; + e);
}
}

return response;
};

console.log(&quot;[+] OkHttp3 Hook æˆåŠŸ&quot;);

} catch (e) {
console.log(&quot;[-] Hook Failed: &quot; + e);
}
});
</code></pre>
<pre><code>
**ä½•æ—¶ä½¿ç”¨**: éœ€è¦ä» PC ç«¯æ‰¹é‡è°ƒç”¨ App çš„åŠ å¯†å‡½æ•°ã€ç­¾åç®—æ³•ç­‰ï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

**Frida è„šæœ¬** (`rpc_agent.js`):

```javascript
// rpc_agent.js - RPC export functions for Python calls

console.log(&quot;[+] RPC Agent loaded&quot;);

// Define exported RPC functions
rpc.exports = {
// ========================================
// Example 1: Call static encryption function
// ========================================
callEncrypt: function(plaintext) {
var result = &quot;&quot;;

Java.perform(function() {
try {
// Modify to target app&#39;s actual class name and method name
var CryptoUtil = Java.use(&#39;com.example.app.utils.CryptoUtil&#39;);

// Call static method
result = CryptoUtil.encrypt(plaintext);

console.log(&quot;[RPC] encrypt(\&quot;&quot; + plaintext + &quot;\&quot;) = &quot; + result);

} catch (e) {
result = &quot;ERROR: &quot; + e;
console.log(&quot;[-] &quot; + result);
}
});

return result;
},

// ========================================
// Example 2: Call instance method
// ========================================
callInstanceMethod: function(className, methodName, args) {
var result = &quot;&quot;;

Java.perform(function() {
try {
var TargetClass = Java.use(className);

// Enumerate all instances
Java.choose(className, {
onMatch: function(instance) {
console.log(&quot;[RPC] Found instance: &quot; + instance);

// Call instance method
result = instance[methodName].apply(instance, args);

console.log(&quot;[RPC] &quot; + methodName + &quot;() = &quot; + result);
},
onComplete: function() {}
});

} catch (e) {
result = &quot;ERROR: &quot; + e;
console.log(&quot;[-] &quot; + result);
}
});

return result;
},

// ========================================
// Example 3: Call Native Function
// ========================================
callNativeFunction: function(libraryName, functionName, args) {
try {
var funcAddr = Module.findExportByName(libraryName, functionName);

if (!funcAddr) {
return &quot;ERROR: Function not found&quot;;
}

// Define function signature (modify based on actual situation)
// Example: int encrypt(char* input, char* output, int length)
var nativeFunc = new NativeFunction(funcAddr, &#39;int&#39;, [&#39;pointer&#39;, &#39;pointer&#39;, &#39;int&#39;]);

// Prepare parameters
var input = Memory.allocUtf8String(args[0]);
var output = Memory.alloc(1024);

// Call function
var ret = nativeFunc(input, output, args[0].length);

var result = output.readCString();
console.log(&quot;[RPC] Native &quot; + functionName + &quot;() returned: &quot; + ret);
console.log(&quot;[RPC] Output: &quot; + result);

return result;

} catch (e) {
return &quot;ERROR: &quot; + e;
}
},

// ========================================
// Example 4: Get app info
// ========================================
getAppInfo: function() {
var info = {};

Java.perform(function() {
var Context = Java.use(&#39;android.app.ActivityThread&#39;).currentApplication().getApplicationContext();
var PackageManager = Context.getPackageManager();
var PackageName = Context.getPackageName();
var PackageInfo = PackageManager.getPackageInfo(PackageName, 0);

info.packageName = PackageName;
info.versionName = PackageInfo.versionName.value;
info.versionCode = PackageInfo.versionCode.value;

console.log(&quot;[RPC] App Info: &quot; + JSON.stringify(info));
});

return info;
}
};

console.log(&quot;[+] RPC functions exported:&quot;);
console.log(&quot; - callEncrypt(plaintext)&quot;);
console.log(&quot; - callInstanceMethod(className, methodName, args)&quot;);
console.log(&quot; - callNativeFunction(libraryName, functionName, args)&quot;);
console.log(&quot; - getAppInfo()&quot;);
</code></pre>
<h1 id="rpc_controller.py---python-rpc-control-script">rpc_controller.py
- Python RPC control script</h1>
<p>import frida import sys</p>
<p>def on_message(message, data): â€œâ€œâ€œProcess messages from Frida
scriptâ€â€œâ€ if message[â€˜typeâ€™] == â€˜sendâ€™: print(fâ€[*]
{message[â€˜payloadâ€™]}â€œ) elif message[â€˜typeâ€™] == â€˜errorâ€™: print(fâ€[!]
Error: {message[â€˜stackâ€™]}â€œ)</p>
<p>def main(): # ======================================== # Connect to
device and app # ======================================== try: device =
frida.get_usb_device(timeout=5) print(fâ€[+] Connected to device:
{device}â€œ) except frida.TimedOutError: print(â€[-] Device connection
timeoutâ€) sys.exit(1)</p>
<h1 id="attach-to-running-app">Attach to running app</h1>
<p>try: package_name = â€œcom.example.appâ€ # Modify to target app package
name session = device.attach(package_name) print(fâ€[+] Attached to:
{package_name}â€œ) except frida.ProcessNotFoundError: print(fâ€[-] Process
not found: {package_name}â€œ) print(â€[*] Please ensure app is runningâ€)
sys.exit(1)</p>
<h1 id="section">========================================</h1>
<h1 id="load-frida-script">Load Frida Script</h1>
<h1 id="section-1">========================================</h1>
<p>with open(â€œrpc_agent.jsâ€, â€œrâ€, encoding=â€œutf-8â€) as f: script_code =
f.read()</p>
<p>script = session.create_script(script_code) script.on(â€˜messageâ€™,
on_message) script.load() print(â€œ[+] Frida script loadedâ€)</p>
<h1 id="section-2">========================================</h1>
<h1 id="get-rpc-api">Get RPC API</h1>
<h1 id="section-3">========================================</h1>
<p>api = script.exports</p>
<h1 id="section-4">========================================</h1>
<h1 id="example-1-call-encryption-function">Example 1: Call encryption
function</h1>
<h1 id="section-5">========================================</h1>
<p>print(â€œ=â€ * 60) print(â€œExample 1: Call encryption functionâ€)
print(â€œ=â€ * 60)</p>
<p>test_data = â€œHello, Frida RPC!â€ encrypted =
api.call_encrypt(test_data) print(fâ€Plaintext: {test_data}â€œ)
print(fâ€Ciphertext: {encrypted}â€œ)</p>
<h1 id="section-6">========================================</h1>
<h1 id="example-2-batch-test">Example 2: Batch test</h1>
<h1 id="section-7">========================================</h1>
<p>print(â€œ=â€ * 60) print(â€œExample 2: Batch testâ€) print(â€œ=â€ * 60)</p>
<p>test_cases = [ â€œtest1â€, â€œtest2â€, â€œtest3â€, â€œaâ€ * 100, # Long string
â€œâ€œ, # Empty string]</p>
<p>for i, test_input in enumerate(test_cases): result =
api.call_encrypt(test_input) print(fâ€[{i+1}] {test_input[:20]:&lt;20}
-&gt; {result}â€œ)</p>
<p>print()</p>
<h1 id="section-8">========================================</h1>
<h1 id="example-3-get-app-info">Example 3: Get app info</h1>
<h1 id="section-9">========================================</h1>
<p>print(â€œ=â€ * 60) print(â€œExample 3: Get app infoâ€) print(â€œ=â€ * 60)</p>
<p>app_info = api.get_app_info() print(fâ€Package name:
{app_info[â€˜packageNameâ€™]}â€œ) print(fâ€Version: {app_info[â€˜versionNameâ€™]}
({app_info[â€˜versionCodeâ€™]})â€œ)</p>
<h1 id="section-10">========================================</h1>
<h1 id="keep-session-alive">Keep session alive</h1>
<h1 id="section-11">========================================</h1>
<p>print(â€œRPC session established, press Ctrl+C to exitâ€) try:
sys.stdin.read() except KeyboardInterrupt: print(â€œDisconnectingâ€¦â€)</p>
<p>session.detach() print(â€œ[+] Disconnectedâ€)</p>
<p>if <strong>name</strong> == â€œ<strong>main</strong>â€: main()</p>
<pre><code>
# 2. Run Python script
python3 rpc_controller.py

# Output example:
# [+] Connected to device: ...
# [+] Attached to: com.example.app
# [+] Frida script loaded
## Plaintext: Hello, Frida RPC!
# Ciphertext: SGVsbG8sIEZyaWRhIFJQQyE=
</code></pre>
<div class="sourceCode" id="cb321"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="co">// enumerate_jni.js - Enumerate all JNI functions in specified SO file</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">enumerateJNIFunctions</span>(libraryName) {</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> module <span class="op">=</span> Process<span class="op">.</span><span class="fu">findModuleByName</span>(libraryName)<span class="op">;</span></span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>module) {</span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] Module not found: &quot;</span> <span class="op">+</span> libraryName)<span class="op">;</span></span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Trying to wait for module loading...&quot;</span>)<span class="op">;</span></span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Monitor dlopen</span></span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="kw">null</span><span class="op">,</span> <span class="st">&quot;dlopen&quot;</span>)<span class="op">,</span> {</span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> path <span class="op">=</span> args[<span class="dv">0</span>]<span class="op">.</span><span class="fu">readCString</span>()<span class="op">;</span></span>
<span id="cb321-14"><a href="#cb321-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (path <span class="op">&amp;&amp;</span> path<span class="op">.</span><span class="fu">includes</span>(libraryName)) {</span>
<span id="cb321-15"><a href="#cb321-15" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Detected target library loading: &quot;</span> <span class="op">+</span> path)<span class="op">;</span></span>
<span id="cb321-16"><a href="#cb321-16" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">target</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb321-17"><a href="#cb321-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-18"><a href="#cb321-18" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb321-19"><a href="#cb321-19" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span> (retval) {</span>
<span id="cb321-20"><a href="#cb321-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">target</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>retval<span class="op">.</span><span class="fu">isNull</span>()) {</span>
<span id="cb321-21"><a href="#cb321-21" aria-hidden="true" tabindex="-1"></a><span class="pp">setTimeout</span>(<span class="kw">function</span> () {</span>
<span id="cb321-22"><a href="#cb321-22" aria-hidden="true" tabindex="-1"></a><span class="fu">enumerateJNIFunctions</span>(libraryName)<span class="op">;</span></span>
<span id="cb321-23"><a href="#cb321-23" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb321-24"><a href="#cb321-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-25"><a href="#cb321-25" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb321-26"><a href="#cb321-26" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb321-27"><a href="#cb321-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-28"><a href="#cb321-28" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb321-29"><a href="#cb321-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-30"><a href="#cb321-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-31"><a href="#cb321-31" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span>(<span class="dv">70</span>))<span class="op">;</span></span>
<span id="cb321-32"><a href="#cb321-32" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; JNI Function Enumeration: &quot;</span> <span class="op">+</span> libraryName)<span class="op">;</span></span>
<span id="cb321-33"><a href="#cb321-33" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Base address: &quot;</span> <span class="op">+</span> module<span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb321-34"><a href="#cb321-34" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Size: &quot;</span> <span class="op">+</span> (module<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="dv">1024</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">&quot; KB&quot;</span>)<span class="op">;</span></span>
<span id="cb321-35"><a href="#cb321-35" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb321-36"><a href="#cb321-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-37"><a href="#cb321-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> exports <span class="op">=</span> module<span class="op">.</span><span class="fu">enumerateExports</span>()<span class="op">;</span></span>
<span id="cb321-38"><a href="#cb321-38" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> jniFunctions <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb321-39"><a href="#cb321-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-40"><a href="#cb321-40" aria-hidden="true" tabindex="-1"></a><span class="co">// Filter JNI functions</span></span>
<span id="cb321-41"><a href="#cb321-41" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (exp) {</span>
<span id="cb321-42"><a href="#cb321-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (exp<span class="op">.</span><span class="at">name</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&quot;Java_&quot;</span>)) {</span>
<span id="cb321-43"><a href="#cb321-43" aria-hidden="true" tabindex="-1"></a>jniFunctions<span class="op">.</span><span class="fu">push</span>(exp)<span class="op">;</span></span>
<span id="cb321-44"><a href="#cb321-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-45"><a href="#cb321-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb321-46"><a href="#cb321-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-47"><a href="#cb321-47" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (jniFunctions<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb321-48"><a href="#cb321-48" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] No JNI functions found&quot;</span>)<span class="op">;</span></span>
<span id="cb321-49"><a href="#cb321-49" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb321-50"><a href="#cb321-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-51"><a href="#cb321-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-52"><a href="#cb321-52" aria-hidden="true" tabindex="-1"></a><span class="co">// Sort by name</span></span>
<span id="cb321-53"><a href="#cb321-53" aria-hidden="true" tabindex="-1"></a>jniFunctions<span class="op">.</span><span class="fu">sort</span>(<span class="kw">function</span> (a<span class="op">,</span> b) {</span>
<span id="cb321-54"><a href="#cb321-54" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> a<span class="op">.</span><span class="at">name</span><span class="op">.</span><span class="fu">localeCompare</span>(b<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb321-55"><a href="#cb321-55" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb321-56"><a href="#cb321-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-57"><a href="#cb321-57" aria-hidden="true" tabindex="-1"></a><span class="co">// Print results</span></span>
<span id="cb321-58"><a href="#cb321-58" aria-hidden="true" tabindex="-1"></a>jniFunctions<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (exp<span class="op">,</span> index) {</span>
<span id="cb321-59"><a href="#cb321-59" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[&quot;</span> <span class="op">+</span> index <span class="op">+</span> <span class="st">&quot;] &quot;</span> <span class="op">+</span> exp<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb321-60"><a href="#cb321-60" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Address: &quot;</span> <span class="op">+</span> exp<span class="op">.</span><span class="at">address</span>)<span class="op">;</span></span>
<span id="cb321-61"><a href="#cb321-61" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Offset: +&quot;</span> <span class="op">+</span> <span class="fu">ptr</span>(exp<span class="op">.</span><span class="at">address</span>)<span class="op">.</span><span class="fu">sub</span>(module<span class="op">.</span><span class="at">base</span>))<span class="op">;</span></span>
<span id="cb321-62"><a href="#cb321-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-63"><a href="#cb321-63" aria-hidden="true" tabindex="-1"></a><span class="co">// Parse JNI function name</span></span>
<span id="cb321-64"><a href="#cb321-64" aria-hidden="true" tabindex="-1"></a><span class="co">// Format: Java_PackageName_ClassName_MethodName</span></span>
<span id="cb321-65"><a href="#cb321-65" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> parts <span class="op">=</span> exp<span class="op">.</span><span class="at">name</span><span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;_&quot;</span>)<span class="op">;</span></span>
<span id="cb321-66"><a href="#cb321-66" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (parts<span class="op">.</span><span class="at">length</span> <span class="op">&gt;=</span> <span class="dv">4</span>) {</span>
<span id="cb321-67"><a href="#cb321-67" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> packageAndClass <span class="op">=</span> parts<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&quot;.&quot;</span>)<span class="op">;</span></span>
<span id="cb321-68"><a href="#cb321-68" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> methodName <span class="op">=</span> parts[parts<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb321-69"><a href="#cb321-69" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb321-70"><a href="#cb321-70" aria-hidden="true" tabindex="-1"></a><span class="st">&quot; Java Method: &quot;</span> <span class="op">+</span> packageAndClass <span class="op">+</span> <span class="st">&quot;.&quot;</span> <span class="op">+</span> methodName <span class="op">+</span> <span class="st">&quot;()&quot;</span></span>
<span id="cb321-71"><a href="#cb321-71" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb321-72"><a href="#cb321-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-73"><a href="#cb321-73" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>()<span class="op">;</span></span>
<span id="cb321-74"><a href="#cb321-74" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb321-75"><a href="#cb321-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-76"><a href="#cb321-76" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Found &quot;</span> <span class="op">+</span> jniFunctions<span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="st">&quot; JNI functions</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb321-77"><a href="#cb321-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb321-78"><a href="#cb321-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-79"><a href="#cb321-79" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb321-80"><a href="#cb321-80" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage example</span></span>
<span id="cb321-81"><a href="#cb321-81" aria-hidden="true" tabindex="-1"></a><span class="co">// ========================================</span></span>
<span id="cb321-82"><a href="#cb321-82" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TARGET_LIBRARY <span class="op">=</span> <span class="st">&quot;libnative-lib.so&quot;</span><span class="op">;</span> <span class="co">// Modify to target SO file name</span></span>
<span id="cb321-83"><a href="#cb321-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-84"><a href="#cb321-84" aria-hidden="true" tabindex="-1"></a><span class="co">// Method 1: If library is already loaded</span></span>
<span id="cb321-85"><a href="#cb321-85" aria-hidden="true" tabindex="-1"></a><span class="fu">enumerateJNIFunctions</span>(TARGET_LIBRARY)<span class="op">;</span></span>
<span id="cb321-86"><a href="#cb321-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-87"><a href="#cb321-87" aria-hidden="true" tabindex="-1"></a><span class="co">// Method 2: Wait for library to load then enumerate</span></span>
<span id="cb321-88"><a href="#cb321-88" aria-hidden="true" tabindex="-1"></a><span class="co">// (If not found above, will automatically enable monitoring)</span></span></code></pre></div>
<p>// hook_jni_function.js - Hook single JNI function</p>
<p>function hookJNIFunction(libraryName, functionName) { var funcAddr =
Module.findExportByName(libraryName, functionName);</p>
<p>if (!funcAddr) { console.log(â€œ[-] Function not found:â€ +
functionName); return; }</p>
<p>console.log(â€œ[+] Hooking:â€ + functionName); console.log(â€ Address: â€
+ funcAddr);</p>
<p>Interceptor.attach(funcAddr, { onEnter: function (args) {
console.log(â€œâ€ + â€œ=â€.repeat(60)); console.log(â€œ[JNI CALL]â€ +
functionName); console.log(â€œ=â€.repeat(60)); console.log(â€ JNIEnv*: â€ +
args[0]); console.log(â€ jobject/jclass: â€ + args[1]);</p>
<p>// Try to parse parameters (starting from args[2]) for (var i = 2; i
&lt; 8 &amp;&amp; i &lt; args.length; i++) { var arg = args<a
href="#i">i</a>; console.log(â€ arg[â€ + (i - 2) + â€]: â€ + arg);</p>
<p>if (arg.isNull()) { console.log(â€ -&gt; nullâ€); continue; }</p>
<p>// Try to parse as jstring try { var env = Java.vm.getEnv(); var
strPtr = env.getStringUtfChars(arg, null); var str =
strPtr.readCString();</p>
<p>if (str &amp;&amp; str.length &gt; 0 &amp;&amp; str.length &lt; 500)
{ console.log(â€™ -&gt; jstring: â€œâ€™ + str + â€˜â€œâ€™); }</p>
<p>env.releaseStringUtfChars(arg, strPtr); continue; } catch (e) {}</p>
<p>// Try to parse as integer try { var intVal = arg.toInt32();
console.log( â€ -&gt; jint: â€ + intVal + â€ (0xâ€ + intVal.toString(16) +
â€œ)â€ ); continue; } catch (e) {}</p>
<p>// Try to parse as byte array try { var env = Java.vm.getEnv(); var
arrayLen = env.getArrayLength(arg);</p>
<p>if (arrayLen &gt; 0 &amp;&amp; arrayLen &lt; 1024) { console.log(â€
-&gt; jbyteArray[â€ + arrayLen + â€]â€œ);</p>
<p>var bytePtr = env.getByteArrayElements(arg, null); var bytes =
bytePtr.readByteArray(Math.min(arrayLen, 64)); console.log(
hexdump(bytes, { offset: 0, length: Math.min(arrayLen, 64), header:
false, ansi: false, }) ); env.releaseByteArrayElements(arg, bytePtr, 0);
} continue; } catch (e) {}</p>
<p>console.log(â€ -&gt; Pointer: â€ + arg); } },</p>
<p>onLeave: function (retval) { console.log(â€œ:â€ + retval);</p>
<p>if (retval.isNull()) { console.log(â€ -&gt; nullâ€); return; }</p>
<p>// Try to parse return value try { var env = Java.vm.getEnv(); var
strPtr = env.getStringUtfChars(retval, null); var str =
strPtr.readCString();</p>
<p>if (str &amp;&amp; str.length &gt; 0 &amp;&amp; str.length &lt; 500)
{ console.log(â€™ -&gt; jstring: â€œâ€™ + str + â€˜â€œâ€™); }</p>
<p>env.releaseStringUtfChars(retval, strPtr); } catch (e) { try { var
intVal = retval.toInt32(); console.log(â€ -&gt; jint: â€ + intVal); }
catch (e2) { console.log(â€ -&gt; Pointer: â€ + retval); } }</p>
<p>console.log(â€œ=â€.repeat(60) + â€œâ€); }, });</p>
<p>console.log(â€œ[+] Hook configuredâ€); }</p>
<p>// ======================================== // Usage example //
========================================
hookJNIFunction(â€œlibnative-lib.soâ€,
â€œJava_com_example_app_Crypto_encryptâ€);</p>
<pre><code>// hook_all_jni.js - Batch hook all JNI functions

function hookAllJNI(libraryName) {
var module = Process.findModuleByName(libraryName);

if (!module) {
console.log(&quot;[-] Module not found, waiting for load: &quot; + libraryName);

Interceptor.attach(Module.findExportByName(null, &quot;dlopen&quot;), {
onEnter: function (args) {
var path = args[0].readCString();
if (path &amp;&amp; path.includes(libraryName)) {
this.target = true;
}
},
onLeave: function (retval) {
if (this.target &amp;&amp; !retval.isNull()) {
setTimeout(function () {
hookAllJNI(libraryName);
}, 500);
}
},
});

return;
}

console.log(&quot;[+] Starting batch JNI function hook: &quot; + libraryName);

var exports = module.enumerateExports();
var hookedCount = 0;

exports.forEach(function (exp) {
if (!exp.name.startsWith(&quot;Java_&quot;)) {
return;
}

try {
Interceptor.attach(exp.address, {
onEnter: function (args) {
console.log(&quot;\n[JNI] &quot; + exp.name);

// Simplified output, only print first 3 parameters
for (var i = 0; i &lt; 5 &amp;&amp; i &lt; args.length; i++) {
var arg = args[i];

if (i === 0) {
console.log(&quot; JNIEnv*: &quot; + arg);
} else if (i === 1) {
console.log(&quot; jobject: &quot; + arg);
} else {
console.log(&quot; arg[&quot; + (i - 2) + &quot;]: &quot; + arg);

// Try to parse string
if (!arg.isNull()) {
try {
var env = Java.vm.getEnv();
var str = env.getStringUtfChars(arg, null).readCString();
if (str &amp;&amp; str.length &gt; 0 &amp;&amp; str.length &lt; 100) {
console.log(&#39; -&gt; &quot;&#39; + str + &#39;&quot;&#39;);
}
env.releaseStringUtfChars(arg, str);
} catch (e) {}
}
}
}
},

onLeave: function (retval) {
console.log(&quot; Return: &quot; + retval);
},
});

hookedCount++;
} catch (e) {
console.log(&quot;[-] Hook failed: &quot; + exp.name);
}
});

console.log(&quot;[+] Successfully hooked &quot; + hookedCount + &quot; JNI functions&quot;);
}

// ========================================
// Usage
// ========================================
hookAllJNI(&quot;libnative-lib.so&quot;);
</code></pre>
<p>// hook_jni_onload.js - Hook JNI_OnLoad function</p>
<p>function hookJNIOnLoad(libraryName) { var onLoadAddr =
Module.findExportByName(libraryName, â€œJNI_OnLoadâ€);</p>
<p>if (!onLoadAddr) { console.log(â€œ[-] JNI_OnLoad not found:â€ +
libraryName); return; }</p>
<p>console.log(â€œ[+] Hooking JNI_OnLoadâ€); console.log(â€ Address: â€ +
onLoadAddr);</p>
<p>Interceptor.attach(onLoadAddr, { onEnter: function (args) {
console.log(â€œâ€ + â€œ=â€.repeat(60)); console.log(â€œ[JNI_OnLoad] Calledâ€);
console.log(â€œ=â€.repeat(60)); console.log(â€ JavaVM*: â€ + args[0]);
console.log(â€ reserved: â€ + args[1]);</p>
<p>this.vm = args[0]; },</p>
<p>onLeave: function (retval) { var jniVersion = retval.toInt32();
console.log(â€ Return JNI Version: â€ + jniVersion);</p>
<p>// Parse version number var major = (jniVersion &gt;&gt; 16) &amp;
0xffff; var minor = jniVersion &amp; 0xffff; console.log(â€ -&gt;
JNI_VERSION_â€ + major + â€œ_â€ + minor);</p>
<p>console.log(â€œ=â€.repeat(60));</p>
<p>// After JNI_OnLoad completes, can start hooking other JNI functions
setTimeout(function () { console.log( â€œJNI_OnLoad completed, starting to
hook JNI functionsâ€¦â€ ); // Can call other hook functions here }, 100);
}, }); }</p>
<p>// Monitor library loading
Interceptor.attach(Module.findExportByName(null, â€œdlopenâ€), { onEnter:
function (args) { var path = args[0].readCString();
console.log(â€œ[dlopen]â€ + path);</p>
<p>if (path &amp;&amp; path.includes(â€œlibnative-lib.soâ€)) {
console.log(â€œ[+] Detected target library loadingâ€); this.target = true;
} },</p>
<p>onLeave: function (retval) { if (this.target &amp;&amp;
!retval.isNull()) { setTimeout(function () {
hookJNIOnLoad(â€œlibnative-lib.soâ€); }, 100); } }, });</p>
<p>console.log(â€œ[+] Monitoring library loadingâ€¦â€);</p>
<pre><code>
```javascript
// hook_java_method.js - Universal Java method hook template

function hookJavaMethod(className, methodName) {
Java.perform(function () {
try {
var targetClass = Java.use(className);

// Get all overloads
var overloads = targetClass[methodName].overloads;

console.log(
&quot;[+] Found &quot; +
overloads.length +
&quot; overloads: &quot; +
className +
&quot;.&quot; +
methodName
);

// Hook all overloads
overloads.forEach(function (overload) {
overload.implementation = function () {
console.log(&quot;\n[CALL] &quot; + className + &quot;.&quot; + methodName);

// Print parameters
for (var i = 0; i &lt; arguments.length; i++) {
console.log(&quot; arg[&quot; + i + &quot;]: &quot; + arguments[i]);
}

// Call original method
var result = this[methodName].apply(this, arguments);

console.log(&quot; Return: &quot; + result);

return result;
};
});

console.log(&quot;[+] Hook complete&quot;);
} catch (e) {
console.log(&quot;[-] Hook failed: &quot; + e);
}
});
}

// Usage example
hookJavaMethod(&quot;android.util.Log&quot;, &quot;d&quot;);
hookJavaMethod(&quot;com.example.app.Crypto&quot;, &quot;encrypt&quot;);
</code></pre>
<p>// hook_all_methods.js - Hook all methods of a class</p>
<p>function hookAllMethods(className) { Java.perform(function () { try {
var targetClass = Java.use(className); var methods =
targetClass.class.getDeclaredMethods();</p>
<p>console.log(â€œ[+] Class:â€ + className); console.log(â€œ[+] Foundâ€ +
methods.length + â€ methodsâ€œ);</p>
<p>var hookedCount = 0;</p>
<p>methods.forEach(function (method) { try { var methodName =
method.getName();</p>
<p>// Skip certain methods if (methodName === â€œtoStringâ€ || methodName
=== â€œhashCodeâ€) { return; }</p>
<p>var overloads = targetClass[methodName].overloads;</p>
<p>overloads.forEach(function (overload) { overload.implementation =
function () { console.log(â€œâ€ + methodName + â€œ()â€);</p>
<p>if (arguments.length &gt; 0) { console.log(â€ Parameters:â€œ); for (var
i = 0; i &lt; arguments.length; i++) { console.log(â€ [â€ + i + â€] â€ +
arguments<a href="#i">i</a>); } }</p>
<p>var result = this[methodName].apply(this, arguments);</p>
<p>console.log(â€ Return: â€ + result);</p>
<p>return result; }; });</p>
<p>hookedCount++; } catch (e) { // Some methods may not be hookable }
});</p>
<p>console.log(â€œ[+] Successfully hookedâ€ + hookedCount + â€ methodsâ€); }
catch (e) { console.log(â€œ[-] Failed:â€ + e); } }); }</p>
<p>// Usage hookAllMethods(â€œcom.example.app.utils.CryptoUtilâ€);</p>
<pre><code>// hook_constructor.js - Hook class constructor

function hookConstructor(className) {
Java.perform(function () {
try {
var targetClass = Java.use(className);

// $init is the special name for constructors
var overloads = targetClass.$init.overloads;

console.log(
&quot;[+] Found &quot; + overloads.length + &quot; constructors: &quot; + className
);

overloads.forEach(function (overload) {
overload.implementation = function () {
console.log(&quot;\n[NEW] &quot; + className + &quot;()&quot;);

if (arguments.length &gt; 0) {
console.log(&quot; Constructor parameters:&quot;);
for (var i = 0; i &lt; arguments.length; i++) {
console.log(&quot; [&quot; + i + &quot;] &quot; + arguments[i]);
}
}

// Call original constructor
var result = this.$init.apply(this, arguments);

console.log(&quot; Instance: &quot; + this);

return result;
};
});

console.log(&quot;[+] Constructor hook complete&quot;);
} catch (e) {
console.log(&quot;[-] Failed: &quot; + e);
}
});
}

// Usage
hookConstructor(&quot;javax.crypto.spec.SecretKeySpec&quot;);
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šXOR åŠ å¯†ç®—æ³•ä»¿çœŸ</strong></p>
<div class="sourceCode" id="cb325"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co">// emulate_xor_encrypt.c - Emulate XOR encryption algorithm</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a><span class="pp"># include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a><span class="pp"># include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a><span class="pp"># include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Algorithm extracted from IDA pseudocode</span></span>
<span id="cb325-8"><a href="#cb325-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> encrypt_data<span class="op">(</span><span class="dt">uint8_t</span><span class="op">*</span> data<span class="op">,</span> <span class="dt">size_t</span> len<span class="op">,</span> <span class="dt">uint8_t</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb325-9"><a href="#cb325-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb325-10"><a href="#cb325-10" aria-hidden="true" tabindex="-1"></a>data<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>data<span class="op">[</span>i<span class="op">]</span> <span class="op">^</span> key<span class="op">)</span> <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb325-11"><a href="#cb325-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb325-12"><a href="#cb325-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb325-13"><a href="#cb325-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-14"><a href="#cb325-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Corresponding decryption algorithm</span></span>
<span id="cb325-15"><a href="#cb325-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> decrypt_data<span class="op">(</span><span class="dt">uint8_t</span><span class="op">*</span> data<span class="op">,</span> <span class="dt">size_t</span> len<span class="op">,</span> <span class="dt">uint8_t</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb325-16"><a href="#cb325-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb325-17"><a href="#cb325-17" aria-hidden="true" tabindex="-1"></a>data<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>data<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> <span class="dv">5</span><span class="op">)</span> <span class="op">^</span> key<span class="op">;</span></span>
<span id="cb325-18"><a href="#cb325-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb325-19"><a href="#cb325-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb325-20"><a href="#cb325-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-21"><a href="#cb325-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Helper function: Print hexadecimal</span></span>
<span id="cb325-22"><a href="#cb325-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_hex<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span> label<span class="op">,</span> <span class="dt">uint8_t</span><span class="op">*</span> data<span class="op">,</span> <span class="dt">size_t</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb325-23"><a href="#cb325-23" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">: &quot;</span><span class="op">,</span> label<span class="op">);</span></span>
<span id="cb325-24"><a href="#cb325-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb325-25"><a href="#cb325-25" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%02x</span><span class="st"> &quot;</span><span class="op">,</span> data<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb325-26"><a href="#cb325-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb325-27"><a href="#cb325-27" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb325-28"><a href="#cb325-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb325-29"><a href="#cb325-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-30"><a href="#cb325-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb325-31"><a href="#cb325-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Test data</span></span>
<span id="cb325-32"><a href="#cb325-32" aria-hidden="true" tabindex="-1"></a><span class="dt">uint8_t</span> plaintext<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;Hello, Android Reverse Engineering!&quot;</span><span class="op">;</span></span>
<span id="cb325-33"><a href="#cb325-33" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> len <span class="op">=</span> strlen<span class="op">((</span><span class="dt">char</span><span class="op">*)</span>plaintext<span class="op">);</span></span>
<span id="cb325-34"><a href="#cb325-34" aria-hidden="true" tabindex="-1"></a><span class="dt">uint8_t</span> key <span class="op">=</span> <span class="bn">0x5A</span><span class="op">;</span></span>
<span id="cb325-35"><a href="#cb325-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-36"><a href="#cb325-36" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;=== XOR Encryption Algorithm Test ===</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb325-37"><a href="#cb325-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-38"><a href="#cb325-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Plaintext</span></span>
<span id="cb325-39"><a href="#cb325-39" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;Plaintext: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> plaintext<span class="op">);</span></span>
<span id="cb325-40"><a href="#cb325-40" aria-hidden="true" tabindex="-1"></a>print_hex<span class="op">(</span><span class="st">&quot;Plaintext HEX&quot;</span><span class="op">,</span> plaintext<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb325-41"><a href="#cb325-41" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb325-42"><a href="#cb325-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-43"><a href="#cb325-43" aria-hidden="true" tabindex="-1"></a><span class="co">// Encrypt</span></span>
<span id="cb325-44"><a href="#cb325-44" aria-hidden="true" tabindex="-1"></a>encrypt_data<span class="op">(</span>plaintext<span class="op">,</span> len<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb325-45"><a href="#cb325-45" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;After encryption:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb325-46"><a href="#cb325-46" aria-hidden="true" tabindex="-1"></a>print_hex<span class="op">(</span><span class="st">&quot;Ciphertext HEX&quot;</span><span class="op">,</span> plaintext<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb325-47"><a href="#cb325-47" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb325-48"><a href="#cb325-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-49"><a href="#cb325-49" aria-hidden="true" tabindex="-1"></a><span class="co">// Decrypt</span></span>
<span id="cb325-50"><a href="#cb325-50" aria-hidden="true" tabindex="-1"></a>decrypt_data<span class="op">(</span>plaintext<span class="op">,</span> len<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb325-51"><a href="#cb325-51" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;After decryption: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> plaintext<span class="op">);</span></span>
<span id="cb325-52"><a href="#cb325-52" aria-hidden="true" tabindex="-1"></a>print_hex<span class="op">(</span><span class="st">&quot;Decrypted HEX&quot;</span><span class="op">,</span> plaintext<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb325-53"><a href="#cb325-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-54"><a href="#cb325-54" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb325-55"><a href="#cb325-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="run-the-program">Run the program</h1>
<p>./emulate</p>
<h1 id="output">Output:</h1>
<h1 id="xor-encryption-algorithm-test">=== XOR Encryption Algorithm Test
===</h1>
<h2 id="plaintext-hello-android-reverse-engineering">Plaintext: Hello,
Android Reverse Engineering!</h2>
<h1
id="plaintext-hex-48-65-6c-6c-6f-2c-20-41-6e-64-72-6f-69-64">Plaintext
HEX: 48 65 6c 6c 6f 2c 20 41 6e 64 72 6f 69 64 â€¦</h1>
<h2 id="after-encryption">After encryption:</h2>
<h1
id="ciphertext-hex-17-30-39-39-32-79-75-16-39-31-2d-32-36-31">Ciphertext
HEX: 17 30 39 39 32 79 75 16 39 31 2d 32 36 31 â€¦</h1>
<h2 id="after-decryption-hello-android-reverse-engineering">After
decryption: Hello, Android Reverse Engineering!</h2>
<pre><code>
```c
// device_fingerprint.c - è®¾å¤‡æŒ‡çº¹GenerateTool

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

// Execute shell command and get output
char* execute_command(const char* cmd) {
FILE* fp = popen(cmd, &quot;r&quot;);
if (!fp) return NULL;

char* result = malloc(256);
if (fgets(result, 256, fp) == NULL) {
free(result);
pclose(fp);
return NULL;
}

// Remove newline character
result[strcspn(result, &quot;\n&quot;)] = 0;
pclose(fp);

return result;
}

// Get system property
char* get_prop(const char* key) {
char command[256];
snprintf(command, sizeof(command), &quot;getprop %s&quot;, key);
return execute_command(command);
}

int main() {
printf(&quot;{\n&quot;);
printf(&quot; \&quot;timestamp\&quot;: %ld,\n&quot;, time(NULL));
printf(&quot; \&quot;device\&quot;: {\n&quot;);

// Device info
const char* props[] = {
&quot;ro.product.brand&quot;,
&quot;ro.product.model&quot;,
&quot;ro.product.manufacturer&quot;,
&quot;ro.product.device&quot;,
&quot;ro.build.version.release&quot;,
&quot;ro.build.version.sdk&quot;,
&quot;ro.build.fingerprint&quot;,
&quot;ro.serialno&quot;,
&quot;ro.boot.serialno&quot;
};

int num_props = sizeof(props) / sizeof(props[0]);

for (int i = 0; i &lt; num_props; i++) {
char* value = get_prop(props[i]);

if (value) {
// Extract last part of property name
const char* last_dot = strrchr(props[i], &#39;.&#39;);
const char* key = last_dot ? last_dot + 1 : props[i];

printf(&quot; \&quot;%s\&quot;: \&quot;%s\&quot;&quot;, key, value);

if (i &lt; num_props - 1) {
printf(&quot;,&quot;);
}
printf(&quot;\n&quot;);

free(value);
}
}

printf(&quot; }\n&quot;);
printf(&quot;}\n&quot;);

return 0;
}
</code></pre>
<p>adb push device_fingerprint.c /data/local/tmp/ adb shell cd
/data/local/tmp gcc device_fingerprint.c -o fingerprint chmod +x
fingerprint</p>
<h1 id="run-the-program-1">Run the program</h1>
<p>./fingerprint</p>
<h1 id="output-json-format-device-fingerprint">Output JSON format device
fingerprint:</h1>
<h1 id="section-12">{</h1>
<h1 id="timestamp-1734518400">â€œtimestampâ€: 1734518400,</h1>
<h1 id="device">â€œdeviceâ€: {</h1>
<h1 id="brand-google">â€œbrandâ€: â€œgoogleâ€,</h1>
<h1 id="model-pixel-5">â€œmodelâ€: â€œPixel 5â€,</h1>
<h1 id="manufacturer-google">â€œmanufacturerâ€: â€œGoogleâ€,</h1>
<h1 id="section-13">â€¦</h1>
<h1 id="section-14">}</h1>
<h1 id="section-15">}</h1>
<h1 id="save-to-file">Save to file</h1>
<p>./fingerprint &gt; /sdcard/device_info.json</p>
<pre><code>
**å¯èƒ½åŸå› **:
1. Hook æ—¶æœºå¤ªæ™šï¼Œç›®æ ‡å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•
2. ç±»åæˆ–æ–¹æ³•åæ‹¼å†™é”™è¯¯
3. ä½¿ç”¨äº† Attach æ¨¡å¼ï¼Œä½† DEX è¿˜æœªåŠ è½½

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. Use Spawn mode (Recommended)
frida -U -f com.target.app -l script.js --no-pause

# 2. Check if class name is correct
Java.perform(function() {
Java.enumerateLoadedClasses({
onMatch: function(className) {
if (className.indexOf(&quot;Crypto&quot;) !== -1) {
console.log(&quot;[+] Found class: &quot; + className);
}
},
onComplete: function() {}
});
});

# 3. Delayed hook (if using Attach mode)
setTimeout(function() {
hookJavaMethod(&quot;com.example.app.Crypto&quot;, &quot;encrypt&quot;);
}, 2000);
</code></pre>
<p><strong>å¯èƒ½åŸå› </strong>:</p>
<ol type="1">
<li>è¯»å–äº†æ— æ•ˆçš„æŒ‡é’ˆ</li>
<li>JNIEnv ä½¿ç”¨ä¸å½“</li>
<li>å­—èŠ‚æ•°ç»„é‡Šæ”¾é—®é¢˜</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<div class="sourceCode" id="cb328"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Add try-catch protection</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(funcAddr<span class="op">,</span> {</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Check pointer validity first</span></span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>args[<span class="dv">2</span>]<span class="op">.</span><span class="fu">isNull</span>()) {</span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> env <span class="op">=</span> Java<span class="op">.</span><span class="at">vm</span><span class="op">.</span><span class="fu">getEnv</span>()<span class="op">;</span></span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ... Process parameters</span></span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] Caught exception: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Don&#39;t re-throw to avoid crash</span></span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb328-15"><a href="#cb328-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ol type="1">
<li>ç±»è¿˜æœªåŠ è½½åˆ°å†…å­˜</li>
<li>ç±»åé”™è¯¯æˆ–è¢«æ··æ·†</li>
<li>ä½¿ç”¨äº†åŠ¨æ€åŠ è½½çš„ DEX</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<div class="sourceCode" id="cb329"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On Python side, wait for class to load first</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>api.wait_for_class(<span class="st">&quot;com.example.app.Crypto&quot;</span>) <span class="co"># Custom wait function</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or check in Frida script</span></span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>rpc.exports <span class="op">=</span> {</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>callEncrypt: function(<span class="bu">input</span>) {</span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>var result <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a>Java.perform(function() {</span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Check <span class="cf">if</span> <span class="kw">class</span> exists first</span>
<span id="cb329-11"><a href="#cb329-11" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb329-12"><a href="#cb329-12" aria-hidden="true" tabindex="-1"></a>var Crypto <span class="op">=</span> Java.use(<span class="st">&quot;com.example.app.Crypto&quot;</span>)<span class="op">;</span></span>
<span id="cb329-13"><a href="#cb329-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> Crypto.encrypt(<span class="bu">input</span>)<span class="op">;</span></span>
<span id="cb329-14"><a href="#cb329-14" aria-hidden="true" tabindex="-1"></a>} catch (e) {</span>
<span id="cb329-15"><a href="#cb329-15" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Try to <span class="bu">enumerate</span> <span class="kw">and</span> find</span>
<span id="cb329-16"><a href="#cb329-16" aria-hidden="true" tabindex="-1"></a>Java.enumerateLoadedClasses({</span>
<span id="cb329-17"><a href="#cb329-17" aria-hidden="true" tabindex="-1"></a>onMatch: function(className) {</span>
<span id="cb329-18"><a href="#cb329-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (className.includes(<span class="st">&quot;Crypto&quot;</span>)) {</span>
<span id="cb329-19"><a href="#cb329-19" aria-hidden="true" tabindex="-1"></a>console.log(<span class="st">&quot;[+] Found: &quot;</span> <span class="op">+</span> className)<span class="op">;</span></span>
<span id="cb329-20"><a href="#cb329-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb329-21"><a href="#cb329-21" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb329-22"><a href="#cb329-22" aria-hidden="true" tabindex="-1"></a>onComplete: function() {}</span>
<span id="cb329-23"><a href="#cb329-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb329-24"><a href="#cb329-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-25"><a href="#cb329-25" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="st">&quot;ERROR: &quot;</span> <span class="op">+</span> e<span class="op">;</span></span>
<span id="cb329-26"><a href="#cb329-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb329-27"><a href="#cb329-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb329-28"><a href="#cb329-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-29"><a href="#cb329-29" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb329-30"><a href="#cb329-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb329-31"><a href="#cb329-31" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<ol type="1">
<li>åº”ç”¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ SSL Pinning å®ç°</li>
<li>Native å±‚å®ç°çš„ Pinning</li>
<li>ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ç½‘ç»œåº“ (å¦‚ Cronet)</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<div class="sourceCode" id="cb330"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Add more hook points</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook custom TrustManager</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">enumerateLoadedClasses</span>({</span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a><span class="dt">onMatch</span><span class="op">:</span> <span class="kw">function</span> (className) {</span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (</span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>className<span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;TrustManager&quot;</span>) <span class="op">||</span></span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a>className<span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;Certificate&quot;</span>)</span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb330-10"><a href="#cb330-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Found suspicious class: &quot;</span> <span class="op">+</span> className)<span class="op">;</span></span>
<span id="cb330-11"><a href="#cb330-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-12"><a href="#cb330-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb330-13"><a href="#cb330-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> clazz <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(className)<span class="op">;</span></span>
<span id="cb330-14"><a href="#cb330-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> methods <span class="op">=</span> clazz<span class="op">.</span><span class="at">class</span><span class="op">.</span><span class="fu">getDeclaredMethods</span>()<span class="op">;</span></span>
<span id="cb330-15"><a href="#cb330-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-16"><a href="#cb330-16" aria-hidden="true" tabindex="-1"></a>methods<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (method) {</span>
<span id="cb330-17"><a href="#cb330-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> methodName <span class="op">=</span> method<span class="op">.</span><span class="fu">getName</span>()<span class="op">;</span></span>
<span id="cb330-18"><a href="#cb330-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (methodName<span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;check&quot;</span>) <span class="op">||</span> methodName<span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;verify&quot;</span>)) {</span>
<span id="cb330-19"><a href="#cb330-19" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Hook: &quot;</span> <span class="op">+</span> className <span class="op">+</span> <span class="st">&quot;.&quot;</span> <span class="op">+</span> methodName)<span class="op">;</span></span>
<span id="cb330-20"><a href="#cb330-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Batch hook</span></span>
<span id="cb330-21"><a href="#cb330-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb330-22"><a href="#cb330-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb330-23"><a href="#cb330-23" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {}</span>
<span id="cb330-24"><a href="#cb330-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb330-25"><a href="#cb330-25" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb330-26"><a href="#cb330-26" aria-hidden="true" tabindex="-1"></a><span class="dt">onComplete</span><span class="op">:</span> <span class="kw">function</span> () {}<span class="op">,</span></span>
<span id="cb330-27"><a href="#cb330-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb330-28"><a href="#cb330-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb330-29"><a href="#cb330-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-30"><a href="#cb330-30" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Hook native layer SSL_CTX_set_verify</span></span>
<span id="cb330-31"><a href="#cb330-31" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SSL_CTX_set_verify <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(</span>
<span id="cb330-32"><a href="#cb330-32" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;libssl.so&quot;</span><span class="op">,</span></span>
<span id="cb330-33"><a href="#cb330-33" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;SSL_CTX_set_verify&quot;</span></span>
<span id="cb330-34"><a href="#cb330-34" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb330-35"><a href="#cb330-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (SSL_CTX_set_verify) {</span>
<span id="cb330-36"><a href="#cb330-36" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(SSL_CTX_set_verify<span class="op">,</span> {</span>
<span id="cb330-37"><a href="#cb330-37" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb330-38"><a href="#cb330-38" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [SSL_CTX_set_verify] Bypass&quot;</span>)<span class="op">;</span></span>
<span id="cb330-39"><a href="#cb330-39" aria-hidden="true" tabindex="-1"></a>args[<span class="dv">1</span>] <span class="op">=</span> <span class="fu">ptr</span>(<span class="dv">0</span>)<span class="op">;</span> <span class="co">// SSL_VERIFY_NONE</span></span>
<span id="cb330-40"><a href="#cb330-40" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb330-41"><a href="#cb330-41" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb330-42"><a href="#cb330-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li><a href="../Network/network_sniffing.md">Recipe: æŠ“åŒ…åˆ†æ Android
åº”ç”¨çš„ç½‘ç»œæµé‡</a> - é…åˆ SSL Pinning ç»•è¿‡ä½¿ç”¨</li>
<li><a href="../Network/crypto_analysis.md">Recipe: åˆ†æå¹¶æå– Android
åº”ç”¨çš„åŠ å¯†å¯†é’¥</a> - å¯†ç å­¦åˆ†æçš„å®Œæ•´æµç¨‹</li>
</ul>
<h3 id="å·¥å…·æ·±å…¥-5">å·¥å…·æ·±å…¥</h3>
<ul>
<li><a href="../../02-Tools/Dynamic/frida_guide.md">Frida ä½¿ç”¨æŒ‡å—</a> -
å®Œæ•´çš„ Frida ä½¿ç”¨æ‰‹å†Œ</li>
<li><a href="../../02-Tools/Dynamic/frida_internals.md">Frida
å†…éƒ¨åŸç†</a> - æ·±å…¥ç†è§£ Frida å·¥ä½œæœºåˆ¶</li>
</ul>
<h3 id="æ¡ˆä¾‹åˆ†æ-3">æ¡ˆä¾‹åˆ†æ</h3>
<ul>
<li><a href="../../03-Case-Studies/case_music_apps.md">æ¡ˆä¾‹: éŸ³ä¹ App
åˆ†æ</a> - ç»¼åˆè¿ç”¨å¤šä¸ªè„šæœ¬</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™-1">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="../../04-Reference/Foundations/jni_reference.md">JNI
å‡½æ•°é€ŸæŸ¥</a></li>
<li><a
href="../../04-Reference/Foundations/crypto_algorithms.md">å¸¸è§åŠ å¯†ç®—æ³•è¯†åˆ«</a></li>
</ul>
<hr />
<h2 id="å¿«é€Ÿå‚è€ƒ-4">å¿«é€Ÿå‚è€ƒ</h2>
<h3 id="è„šæœ¬é€ŸæŸ¥è¡¨">è„šæœ¬é€ŸæŸ¥è¡¨</h3>
<table>
<thead>
<tr>
<th>éœ€æ±‚</th>
<th>ä½¿ç”¨è„šæœ¬</th>
<th>éš¾åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç»•è¿‡ TracerPid æ£€æµ‹</strong></td>
<td><code>bypass_tracerpid.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>éšè— Frida å­—ç¬¦ä¸²</strong></td>
<td><code>hide_frida_strings.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>ç»•è¿‡ SSL Pinning</strong></td>
<td><code>bypass_ssl_pinning.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>æ‹¦æˆªç½‘ç»œè¯·æ±‚</strong></td>
<td><code>intercept_okhttp.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>RPC è°ƒç”¨åŠ å¯†å‡½æ•°</strong></td>
<td><code>rpc_agent.js + rpc_controller.py</code></td>
<td></td>
</tr>
<tr>
<td><strong>æšä¸¾ JNI å‡½æ•°</strong></td>
<td><code>enumerate_jni.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>Hook JNI å‡½æ•°</strong></td>
<td><code>hook_jni_function.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>æ‰¹é‡ Hook JNI</strong></td>
<td><code>hook_all_jni.js</code></td>
<td></td>
</tr>
<tr>
<td><strong>Hook æ„é€ å‡½æ•°</strong></td>
<td><code>hook_constructor.js</code></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="å¸¸ç”¨å‘½ä»¤-1">å¸¸ç”¨å‘½ä»¤</h3>
<div class="sourceCode" id="cb331"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Spawn mode run script (recommended)</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.target.app <span class="at">-l</span> script.js <span class="at">--no-pause</span></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Attach mode</span></span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> com.target.app <span class="at">-l</span> script.js</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. List all processes</span></span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a><span class="ex">frida-ps</span> <span class="at">-Ua</span></span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Interactive REPL</span></span>
<span id="cb331-11"><a href="#cb331-11" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> com.target.app</span>
<span id="cb331-12"><a href="#cb331-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-13"><a href="#cb331-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Load multiple scripts</span></span>
<span id="cb331-14"><a href="#cb331-14" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> com.target.app <span class="at">-l</span> script1.js <span class="at">-l</span> script2.js <span class="at">--no-pause</span></span>
<span id="cb331-15"><a href="#cb331-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-16"><a href="#cb331-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Export output to file</span></span>
<span id="cb331-17"><a href="#cb331-17" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> com.target.app <span class="at">-l</span> script.js <span class="op">&gt;</span> output.log <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb331-18"><a href="#cb331-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-19"><a href="#cb331-19" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span> <span class="pp">**</span>é€‚åº¦æ‰“å°æ—¥å¿—<span class="pp">**</span> <span class="at">-</span> è¿‡å¤šæ—¥å¿—ä¼šå½±å“æ€§èƒ½</span>
<span id="cb331-20"><a href="#cb331-20" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span> <span class="pp">**</span>æ¨¡å—åŒ–ç»„ç»‡<span class="pp">**</span> <span class="at">-</span> å°†å¸¸ç”¨å‡½æ•°å°è£…ä¸ºç‹¬ç«‹æ¨¡å—</span>
<span id="cb331-21"><a href="#cb331-21" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span> <span class="pp">**</span>ä¿å­˜è„šæœ¬åº“<span class="pp">**</span> <span class="at">-</span> å»ºç«‹è‡ªå·±çš„è„šæœ¬æ¨¡æ¿åº“</span>
<span id="cb331-22"><a href="#cb331-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-23"><a href="#cb331-23" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> <span class="at">--</span></span>
<span id="cb331-24"><a href="#cb331-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-25"><a href="#cb331-25" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> <span class="pp">*</span>ğŸ’¡ æç¤º<span class="pp">**</span>: è¿™äº›è„šæœ¬éƒ½æ˜¯<span class="pp">**</span>æ¨¡æ¿<span class="pp">**</span>ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®ç›®æ ‡ App çš„å…·ä½“æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚å»ºè®®å…ˆç†è§£è„šæœ¬åŸç†ï¼Œå†ä¿®æ”¹å…³é”®å‚æ•° <span class="er">(</span><span class="ex">å¦‚ç±»åã€æ–¹æ³•åã€SO</span> æ–‡ä»¶åç­‰<span class="kw">)</span><span class="ex">ã€‚</span></span>
<span id="cb331-26"><a href="#cb331-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">```</span></span></code></pre></div>
<!-- 01-Recipes/Scripts/frida_script_examples.md -->
<h1 id="frida-å®æˆ˜è„šæœ¬é›†">Frida å®æˆ˜è„šæœ¬é›†</h1>
<p>æœ¬æ–‡æ¡£æ”¶é›†äº†é€‚ç”¨äºå„ç§å¸¸è§åœºæ™¯çš„ Frida
è„šæœ¬ã€‚è¿™äº›è„šæœ¬æ—¨åœ¨ä½œä¸ºå³ç”¨å‹æ¨¡æ¿ï¼Œæ‚¨å¯ä»¥æ ¹æ®ç‰¹å®šç›®æ ‡è¿›è¡Œä¿®æ”¹ã€‚</p>
<hr />
<h2 id="ç›®å½•-3">ç›®å½•</h2>
<ol type="1">
<li><a href="#ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›† (Information Gathering)</a></li>
<li><a href="#hook-ä¸ä¿®æ”¹">Hook ä¸ä¿®æ”¹ (Hooking &amp;
Modification)</a></li>
<li><a href="#ç½‘ç»œç›‘æ§ä¸ç»•è¿‡">ç½‘ç»œç›‘æ§ä¸ç»•è¿‡ (Networking)</a></li>
<li><a href="#æ•°æ®æŒä¹…åŒ–ä¸è„±å£³">æ•°æ®æŒä¹…åŒ–ä¸è„±å£³ (Storage &amp;
Dumping)</a></li>
<li><a href="#åè°ƒè¯•ä¸ç¯å¢ƒæ£€æµ‹ç»•è¿‡">åè°ƒè¯•ä¸ç¯å¢ƒæ£€æµ‹ç»•è¿‡
(Anti-Analysis)</a></li>
<li><a href="#ui-ä¸äº‹ä»¶">UI ä¸äº‹ä»¶ (UI &amp; Events)</a></li>
</ol>
<hr />
<h3 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h3>
<h4 id="æšä¸¾æŒ‡å®šç±»çš„æ‰€æœ‰æ–¹æ³•">1. æšä¸¾æŒ‡å®šç±»çš„æ‰€æœ‰æ–¹æ³•</h4>
<div class="sourceCode" id="cb332"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage: frida -U -f com.example.app -l list_methods.js</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace &#39;com.example.target class&#39; below</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> targetClass <span class="op">=</span> <span class="st">&#39;com.example.TargetClass&#39;</span><span class="op">;</span></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> wrapper <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(targetClass)<span class="op">;</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ownMethods <span class="op">=</span> wrapper<span class="op">.</span><span class="at">class</span><span class="op">.</span><span class="fu">getDeclaredMethods</span>()<span class="op">;</span></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Methods of class &quot;</span> <span class="op">+</span> targetClass <span class="op">+</span> <span class="st">&quot;:&quot;</span>)<span class="op">;</span></span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a>ownMethods<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(method) {</span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(method<span class="op">.</span><span class="fu">toString</span>())<span class="op">;</span></span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>console.log(â€œListing all loaded classesâ€¦â€);
Java.enumerateLoadedClasses({ onMatch: function(className) {
console.log(className); }, onComplete: function() { console.log(â€œClass
enumeration complete.â€); } }); });</p>
<pre><code>Java.perform(function() {
var TargetClass = Java.use(&#39;com.example.app.CryptoUtils&#39;);
var methodName = &#39;encrypt&#39;; // Method name to trace

// Handle method overloads
TargetClass[methodName].overloads.forEach(function(overload) {
overload.implementation = function() {
console.log(&#39;\n[+] Called &#39; + TargetClass.$className + &#39;.&#39; + methodName);

// Print arguments
for (var i = 0; i &lt; arguments.length; i++) {
console.log(&#39; - Argument &#39; + i + &#39;: &#39; + arguments[i]);
}

// Call original method
var retval = this[methodName].apply(this, arguments);

// Print return value
console.log(&#39; - Return value: &#39; + retval);

return retval;
};
});
});
</code></pre>
<p>Java.perform(function() { var PremiumUtils =
Java.use(â€˜com.example.app.PremiumUtilsâ€™);</p>
<p>PremiumUtils.isUserPremium.implementation = function() {
console.log(â€˜[+] Bypassing Premium checkâ€¦â€™); return true; // Return true
directly }; });</p>
<pre><code>
Java.choose(&#39;com.example.app.UserInfo&#39;, {
onMatch: function(instance) {
console.log(&#39;[+] Found UserInfo instance.&#39;);
// Directly modify field value
instance.userLevel.value = 99;
console.log(&#39; - Patched userLevel to 99.&#39;);
},
onComplete: function() {}
});
});
</code></pre>
<div class="sourceCode" id="cb335"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage: frida -U --no-pause -f com.example.app -l universal_ssl_unpinning.js</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Source: https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="pp">setTimeout</span>(<span class="kw">function</span>() {</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[.] Android SSL Pinning Bypass&quot;</span>)<span class="op">;</span></span>
<span id="cb335-7"><a href="#cb335-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-8"><a href="#cb335-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CertificateFactory <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.security.cert.CertificateFactory&quot;</span>)<span class="op">;</span></span>
<span id="cb335-9"><a href="#cb335-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> FileInputStream <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.FileInputStream&quot;</span>)<span class="op">;</span></span>
<span id="cb335-10"><a href="#cb335-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> BufferedInputStream <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.BufferedInputStream&quot;</span>)<span class="op">;</span></span>
<span id="cb335-11"><a href="#cb335-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> X509Certificate <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.security.cert.X509Certificate&quot;</span>)<span class="op">;</span></span>
<span id="cb335-12"><a href="#cb335-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> KeyStore <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.security.KeyStore&quot;</span>)<span class="op">;</span></span>
<span id="cb335-13"><a href="#cb335-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TrustManagerFactory <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.TrustManagerFactory&quot;</span>)<span class="op">;</span></span>
<span id="cb335-14"><a href="#cb335-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SSLContext <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;javax.net.ssl.SSLContext&quot;</span>)<span class="op">;</span></span>
<span id="cb335-15"><a href="#cb335-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-16"><a href="#cb335-16" aria-hidden="true" tabindex="-1"></a><span class="co">// TrustManagerImpl (android &gt; 7)</span></span>
<span id="cb335-17"><a href="#cb335-17" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb335-18"><a href="#cb335-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TrustManagerImpl <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;com.android.org.conscrypt.TrustManagerImpl&#39;</span>)<span class="op">;</span></span>
<span id="cb335-19"><a href="#cb335-19" aria-hidden="true" tabindex="-1"></a>TrustManagerImpl<span class="op">.</span><span class="at">verifyChain</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(untrustedChain<span class="op">,</span> trustAnchorChain<span class="op">,</span> host<span class="op">,</span> clientAuth<span class="op">,</span> ocspData<span class="op">,</span> tlsSctData) {</span>
<span id="cb335-20"><a href="#cb335-20" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;[+] Bypassing TrustManagerImpl verifyChain() for host: &#39;</span> <span class="op">+</span> host)<span class="op">;</span></span>
<span id="cb335-21"><a href="#cb335-21" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> untrustedChain<span class="op">;</span></span>
<span id="cb335-22"><a href="#cb335-22" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb335-23"><a href="#cb335-23" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb335-24"><a href="#cb335-24" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] TrustManagerImpl not found. Skipping.&quot;</span>)<span class="op">;</span></span>
<span id="cb335-25"><a href="#cb335-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb335-26"><a href="#cb335-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-27"><a href="#cb335-27" aria-hidden="true" tabindex="-1"></a><span class="co">// OkHttp3</span></span>
<span id="cb335-28"><a href="#cb335-28" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb335-29"><a href="#cb335-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OkHttpClient <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;okhttp3.OkHttpClient&quot;</span>)<span class="op">;</span></span>
<span id="cb335-30"><a href="#cb335-30" aria-hidden="true" tabindex="-1"></a>OkHttpClient<span class="op">.</span><span class="at">Builder</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">build</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb335-31"><a href="#cb335-31" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> builder <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">build</span><span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb335-32"><a href="#cb335-32" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] OkHttp3 CertificatePinner removed.&quot;</span>)<span class="op">;</span></span>
<span id="cb335-33"><a href="#cb335-33" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="at">certificatePinner</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb335-34"><a href="#cb335-34" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> builder<span class="op">;</span></span>
<span id="cb335-35"><a href="#cb335-35" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb335-36"><a href="#cb335-36" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span>(e) {</span>
<span id="cb335-37"><a href="#cb335-37" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] OkHttp3 not found. Skipping.&quot;</span>)<span class="op">;</span></span>
<span id="cb335-38"><a href="#cb335-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb335-39"><a href="#cb335-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-40"><a href="#cb335-40" aria-hidden="true" tabindex="-1"></a><span class="co">// TrustManager (universal)</span></span>
<span id="cb335-41"><a href="#cb335-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TrustManager <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;javax.net.ssl.X509TrustManager&#39;</span>)<span class="op">;</span></span>
<span id="cb335-42"><a href="#cb335-42" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> checkServerTrusted <span class="op">=</span> TrustManager<span class="op">.</span><span class="at">checkServerTrusted</span><span class="op">;</span></span>
<span id="cb335-43"><a href="#cb335-43" aria-hidden="true" tabindex="-1"></a>checkServerTrusted<span class="op">.</span><span class="fu">overload</span>(<span class="st">&#39;java.security.cert.X509Certificate[]&#39;</span><span class="op">,</span> <span class="st">&#39;java.lang.String&#39;</span>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(chain<span class="op">,</span> authType) {</span>
<span id="cb335-44"><a href="#cb335-44" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;[+] Bypassing TrustManager checkServerTrusted for authType: &#39;</span> <span class="op">+</span> authType)<span class="op">;</span></span>
<span id="cb335-45"><a href="#cb335-45" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb335-46"><a href="#cb335-46" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb335-47"><a href="#cb335-47" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb335-48"><a href="#cb335-48" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span></code></pre></div>
<p>Java.perform(function() { var sharedPrefsEditor =
Java.use(â€˜android.app.SharedPreferencesImpl$EditorImplâ€™);</p>
<p>sharedPrefsEditor.putString.implementation = function(key, value) {
console.log(â€˜[SP Write] key:â€™ + key + â€˜, value:â€™ + value); return
this.putString(key, value); };</p>
<p>var sharedPrefs = Java.use(â€˜android.app.SharedPreferencesImplâ€™);
sharedPrefs.getString.implementation = function(key, defValue) { var
value = this.getString(key, defValue); console.log(â€˜[SP Read] key:â€™ +
key + â€˜, value:â€™ + value); return value; }; });</p>
<pre><code>
SQLiteDatabase.query.overload(&#39;java.lang.String&#39;, &#39;[Ljava.lang.String;&#39;, &#39;java.lang.String&#39;, &#39;[Ljava.lang.String;&#39;, &#39;java.lang.String&#39;, &#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation = function(table, columns, selection, selectionArgs, groupBy, having, orderBy) {
console.log(&quot;\n[SQL Query] Table: &quot; + table);
console.log(&quot; - Columns: &quot; + columns);
console.log(&quot; - Selection: &quot; + selection);
console.log(&quot; - Selection Args: &quot; + selectionArgs);
return this.query(table, columns, selection, selectionArgs, groupBy, having, orderBy);
};

SQLiteDatabase.execSQL.overload(&#39;java.lang.String&#39;, &#39;[Ljava.lang.Object;&#39;).implementation = function(sql, bindArgs) {
console.log(&quot;\n[SQL execSQL] SQL: &quot; + sql);
console.log(&quot; - Bind Args: &quot; + bindArgs);
return this.execSQL(sql, bindArgs);
};
});
</code></pre>
<p>Java.perform(function () { var RootCheckClass =
Java.use(â€˜com.example.security.RootUtilâ€™); // Replace with target
class</p>
<p>RootCheckClass.isDeviceRooted.implementation = function() {
console.log(â€˜[+] Bypassing root checkâ€¦â€™); return false; }; });</p>
<pre><code>Debug.isDebuggerConnected.implementation = function() {
console.log(&#39;[+] Bypassing isDebuggerConnected check...&#39;);
return false;
}
});
</code></pre>
<p>Java.perform(function() { var View =
Java.use(â€˜android.view.Viewâ€™);</p>
<p>View.setOnClickListener.implementation = function(listener) { var
originalListener = listener; var view = this;</p>
<p>// Create a new listener to wrap the original listener var
newListener =
Java.implement(Java.use(â€˜android.view.View$OnClickListenerâ€™), { onClick:
function(v) { console.log(â€˜[+] View clicked! Class:â€™ +
view.getClass().getName() + â€˜, ID:â€™ + view.getId()); if
(originalListener) { originalListener.onClick(v); // Call the original
click event } } });</p>
<p>// Set the new listener this.setOnClickListener(newListener); };
});</p>
<!-- 01-Recipes/Scripts/native_hooking.md -->
<h1 id="native-å±‚-hook-æŠ€å·§-native-hooking-patterns">Native å±‚ Hook æŠ€å·§
(Native Hooking Patterns)</h1>
<p>åœ¨ Android é€†å‘ä¸­ï¼ŒNative å±‚ (C/C++) çš„åˆ†æå¾€å¾€æ¯” Java
å±‚æ›´å…·æŒ‘æˆ˜æ€§ã€‚Hook æ ‡å‡† C åº“ (libc) å‡½æ•°æ˜¯ç†è§£ Native
å±‚è¡Œä¸ºã€è„±å£³å’Œè¿˜åŸç®—æ³•çš„é‡è¦æ‰‹æ®µã€‚</p>
<h2 id="æ–‡ä»¶æ“ä½œç›‘æ§-file-io">1. æ–‡ä»¶æ“ä½œç›‘æ§ (File I/O)</h2>
<p>ç›‘æ§æ–‡ä»¶æ“ä½œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç° App è¯»å–äº†å“ªäº›é…ç½®æ–‡ä»¶ã€åŠ è½½äº†å“ªäº›
Dex/So æ–‡ä»¶ï¼Œæˆ–è€…å°†è§£å¯†åçš„æ•°æ®å†™å…¥åˆ°äº†å“ªé‡Œã€‚</p>
<h2 id="hook-open-openat"># Hook <code>open</code> /
<code>openat</code></h2>
<div class="sourceCode" id="cb338"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook open and openat to trace file access</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">hookFileOpen</span>() {</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Intercept &#39;open&#39;</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> openPtr <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libc.so&quot;</span><span class="op">,</span> <span class="st">&quot;open&quot;</span>)<span class="op">;</span></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (openPtr) {</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(openPtr<span class="op">,</span> {</span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span>(args) {</span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">path</span> <span class="op">=</span> args[<span class="dv">0</span>]<span class="op">.</span><span class="fu">readCString</span>()<span class="op">;</span></span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">flags</span> <span class="op">=</span> args[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toInt32</span>()<span class="op">;</span></span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a><span class="co">// console.log(&quot;[open] &quot; + this.path);</span></span>
<span id="cb338-11"><a href="#cb338-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb338-12"><a href="#cb338-12" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span>(retval) {</span>
<span id="cb338-13"><a href="#cb338-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">path</span> <span class="op">&amp;&amp;</span> (<span class="kw">this</span><span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">endsWith</span>(<span class="st">&quot;.dex&quot;</span>) <span class="op">||</span> <span class="kw">this</span><span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">endsWith</span>(<span class="st">&quot;.so&quot;</span>))) {</span>
<span id="cb338-14"><a href="#cb338-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[open] FD: &quot;</span> <span class="op">+</span> retval <span class="op">+</span> <span class="st">&quot; Path: &quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">path</span>)<span class="op">;</span></span>
<span id="cb338-15"><a href="#cb338-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-16"><a href="#cb338-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-17"><a href="#cb338-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb338-18"><a href="#cb338-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-19"><a href="#cb338-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-20"><a href="#cb338-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Intercept &#39;openat&#39; (commonly used on newer android versions)</span></span>
<span id="cb338-21"><a href="#cb338-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> openatPtr <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libc.so&quot;</span><span class="op">,</span> <span class="st">&quot;openat&quot;</span>)<span class="op">;</span></span>
<span id="cb338-22"><a href="#cb338-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (openatPtr) {</span>
<span id="cb338-23"><a href="#cb338-23" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(openatPtr<span class="op">,</span> {</span>
<span id="cb338-24"><a href="#cb338-24" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span>(args) {</span>
<span id="cb338-25"><a href="#cb338-25" aria-hidden="true" tabindex="-1"></a><span class="co">// args[0] is dirfd, args[1] is path</span></span>
<span id="cb338-26"><a href="#cb338-26" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">path</span> <span class="op">=</span> args[<span class="dv">1</span>]<span class="op">.</span><span class="fu">readCString</span>()<span class="op">;</span></span>
<span id="cb338-27"><a href="#cb338-27" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">flags</span> <span class="op">=</span> args[<span class="dv">2</span>]<span class="op">.</span><span class="fu">toInt32</span>()<span class="op">;</span></span>
<span id="cb338-28"><a href="#cb338-28" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb338-29"><a href="#cb338-29" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span>(retval) {</span>
<span id="cb338-30"><a href="#cb338-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">path</span> <span class="op">&amp;&amp;</span> (<span class="kw">this</span><span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">indexOf</span>(<span class="st">&quot;base.apk&quot;</span>) <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="kw">this</span><span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">indexOf</span>(<span class="st">&quot;.dex&quot;</span>) <span class="op">&gt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb338-31"><a href="#cb338-31" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[openat] FD: &quot;</span> <span class="op">+</span> retval <span class="op">+</span> <span class="st">&quot; Path: &quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">path</span>)<span class="op">;</span></span>
<span id="cb338-32"><a href="#cb338-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-33"><a href="#cb338-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-34"><a href="#cb338-34" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb338-35"><a href="#cb338-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-36"><a href="#cb338-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>function hookDlopen() { var dlopen = Module.findExportByName(null,
â€œdlopenâ€); var android_dlopen_ext = Module.findExportByName(null,
â€œandroid_dlopen_extâ€);</p>
<p>if (dlopen) { Interceptor.attach(dlopen, { onEnter: function(args) {
this.path = args[0].readCString(); }, onLeave: function(retval) { if
(this.path) { console.log(â€œ[dlopen]â€ + this.path + â€ -&gt; Handle: â€ +
retval); if (this.path.indexOf(â€œlibnative-lib.soâ€) &gt;= 0) { // Library
loaded, ready to hook functions inside it } } } }); }</p>
<p>if (android_dlopen_ext) { Interceptor.attach(android_dlopen_ext, {
onEnter: function(args) { this.path = args[0].readCString(); }, onLeave:
function(retval) { if (this.path) { console.log(â€œ[android_dlopen_ext]â€ +
this.path + â€ -&gt; Handle: â€ + retval); } } }); } }</p>
<pre><code>
```javascript
function hookMemcpy() {
var memcpy = Module.findExportByName(&quot;libc.so&quot;, &quot;memcpy&quot;);

Interceptor.attach(memcpy, {
onEnter: function(args) {
this.dest = args[0];
this.src = args[1];
this.n = args[2].toInt32();
},
onLeave: function(retval) {
// Filter by size or content to reduce noise
if (this.n &gt; 100 &amp;&amp; this.n &lt; 200) {
// Check if source contains specific magic bytes (e.g., ELF header)
try {
var magic = this.src.readU32();
if (magic == 0x464c457f) { // .ELF
console.log(&quot;[memcpy] ELF header detected! Size: &quot; + this.n);
console.log(hexdump(this.src, {length: 32}));
}
} catch(e) {}
}
}
});
}
</code></pre>
<p>function hookDlsym() { var dlsym = Module.findExportByName(null,
â€œdlsymâ€);</p>
<p>Interceptor.attach(dlsym, { onEnter: function(args) { this.handle =
args[0]; this.symbol = args[1].readCString(); }, onLeave:
function(retval) { if (this.symbol) { console.log(â€œ[dlsym] Symbol:â€ +
this.symbol + â€ -&gt; Address: â€ + retval); } } }); }</p>
<pre><code>function hookStrcmp() {
var strcmp = Module.findExportByName(&quot;libc.so&quot;, &quot;strcmp&quot;);

Interceptor.attach(strcmp, {
onEnter: function(args) {
var s1 = args[0].readCString();
var s2 = args[1].readCString();

// Filter for interesting strings
if ((s1 &amp;&amp; s1.indexOf(&quot;secret&quot;) &gt;= 0) || (s2 &amp;&amp; s2.indexOf(&quot;secret&quot;) &gt;= 0)) {
console.log(&quot;[strcmp] &quot; + s1 + &quot; VS &quot; + s2);
}
}
});
}
</code></pre>
<pre><code>


&lt;!-- 01-Recipes/Scripts/objection_snippets.md --&gt;

# Objection å¸¸ç”¨æŠ€å·§ (Objection Snippets)

Objection æ˜¯ä¸€ä¸ªåŸºäº Frida å¼€å‘çš„è¿è¡Œæ—¶ç§»åŠ¨ç«¯æ¢ç´¢å·¥å…·åŒ…ã€‚å®ƒæä¾›äº†ç±»ä¼¼äº shell çš„äº¤äº’å¼å‘½ä»¤è¡Œï¼Œæ— éœ€ç¼–å†™ JavaScript ä»£ç å³å¯å®Œæˆå¤§éƒ¨åˆ†å¸¸è§çš„é€†å‘ä»»åŠ¡ã€‚

* *å®‰è£…**: `pip install objection`
* *å¯åŠ¨**: `objection -g com.example.app explore`

## 1. å†…å­˜æ¼«æ¸¸ä¸ç±»æŸ¥æ‰¾

åœ¨ä¸çŸ¥é“ä»ä½•å…¥æ‰‹æ—¶ï¼Œé¦–å…ˆæµè§ˆåº”ç”¨ä¸­åŠ è½½äº†å“ªäº›ç±»ã€‚

* **æœç´¢ç±»**:
    ```bash
# SearchContains &quot;Crypto&quot; Class
android hooking search classes Crypto
</code></pre>
<pre><code>```bash</code></pre>
<h1 id="searchcontains-encrypt-method">SearchContains â€œencryptâ€
Method</h1>
<p>android hooking search methods encrypt</p>
<pre><code>    ```bash
# åˆ—è¡¨ com.ç¤ºä¾‹.app.MainActivity æ‰€æœ‰Method
android hooking list class_methods com.example.app.MainActivity
</code></pre>
<p>Objection çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯å¿«é€Ÿ Hook
ç±»æˆ–æ–¹æ³•ï¼Œæ‰“å°è°ƒç”¨çš„å‚æ•°ã€è¿”å›å€¼å’Œè°ƒç”¨æ ˆã€‚</p>
<ul>
<li><strong>Hook æ•´ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•</strong>: ```bash android hooking
watch class com.example.app.CryptoUtil</li>
</ul>
<pre><code>    ```bash
# æ‹¦æˆª åŠ å¯† æ–¹æ³•ï¼Œå¹¶PrintParameterandReturnValue (--å¯¼å‡º-args --å¯¼å‡º-è¿”å›)
android hooking watch class_method com.example.app.CryptoUtil.encrypt --dump-args --dump-return
</code></pre>
<pre><code>```bash</code></pre>
<h1 id="å¼ºåˆ¶-isrooted-methodreturn-å‡">å¼ºåˆ¶ isRooted MethodReturn
å‡</h1>
<p>android hooking set return_value com.example.app.Security.isRooted
false</p>
<pre><code>
å¯ä»¥æœç´¢å†…å­˜ä¸­å­˜åœ¨çš„å¯¹è±¡å®ä¾‹ï¼Œç”šè‡³è°ƒç”¨è¿™äº›å®ä¾‹çš„æ–¹æ³•ã€‚

* **æœç´¢å †ä¸­çš„å®ä¾‹**:
    ```bash
# æŸ¥æ‰¾å†…å­˜ä¸­ç°å­˜çš„ User å®ä¾‹
android heap search instances com.example.app.User
</code></pre>
<pre><code>```bash</code></pre>
<h1 id="å‡è®¾ä¸Šä¸€æ­¥æœç´¢åˆ°å®ä¾‹-hashcode-ä¸º-123456">å‡è®¾ä¸Šä¸€æ­¥æœç´¢åˆ°å®ä¾‹
hashcode ä¸º 123456</h1>
<h1 id="è°ƒç”¨è¯¥å®ä¾‹çš„-gettoken-æ–¹æ³•">è°ƒç”¨è¯¥å®ä¾‹çš„ getToken æ–¹æ³•</h1>
<p>android heap execute 123456 getToken</p>
<pre><code>    ```bash
# æŸ¥çœ‹è¯¥å®ä¾‹çš„ username å­—æ®µå€¼
android heap evaluate 123456
# (è¿›å…¥ç¼–è¾‘å™¨AfterInput) console.æ—¥å¿—(clazz.username.å€¼)
</code></pre>
<ul>
<li><strong>æŸ¥çœ‹å½“å‰ Activity</strong>: ```bash android hooking get
current_activity</li>
</ul>
<pre><code>    ```bash
android hooking list fragments
</code></pre>
<pre><code>```bash</code></pre>
<p>android intent launch_activity com.example.app.SecretActivity</p>
<pre><code>
* **åˆ—å‡ºåŠ è½½çš„ SO åº“**:
    ```bash
memory list modules
</code></pre>
<pre><code>```bash</code></pre>
<h1
id="will-libnative-lib.so-exportåˆ°nativefile-used-forä¿®å¤è„±å£³after-so">Will
libnative-lib.so Exportåˆ°NativeFile (Used forä¿®å¤è„±å£³After SO)</h1>
<p>memory dump from_base 0x7b12345000 0x50000 output.so # orAutoDownload
memory dump all libnative-lib.so</p>
<pre><code>    ```bash
ls
cd cache
cat log.txt
file download /data/data/com.example.app/shared_prefs/config.xml
</code></pre>
<ul>
<li><strong>ç¦ç”¨ SSL Pinning</strong>: ```bash android sslpinning
disable</li>
</ul>
<pre><code>    ```bash
android root disable
</code></pre>
<pre><code>```bash</code></pre>
<p>import /path/to/my_script.js</p>
<pre><code>


&lt;!-- 01-Recipes/Unpacking/frida_unpacking_and_so_fixing.md --&gt;

# Recipe: ä½¿ç”¨ Frida è„±å£³åŠ å›º App å¹¶ä¿®å¤ SO æ–‡ä»¶

## é—®é¢˜åœºæ™¯

\*ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\*

- ç”¨ jadx æ‰“å¼€ APKï¼Œå‘ç°ä»£ç è¢«æ··æ·†æˆ–çœ‹ä¸åˆ°å…³é”®é€»è¾‘
- ğŸ›¡ï¸ APK ä½¿ç”¨äº†åŠ å›ºï¼ˆåŠ å£³ï¼‰ä¿æŠ¤ï¼Œæ— æ³•é™æ€åˆ†æ
- ğŸ“¦ SO æ–‡ä»¶è¢«åŠ å¯†ï¼ŒIDA Pro æ— æ³•æ­£ç¡®åŠ è½½
- ä½ æƒ³è·å– App è¿è¡Œæ—¶çœŸæ­£çš„ DEX æ–‡ä»¶
- ğŸ§© éœ€è¦åˆ†æ Native å±‚ä»£ç ï¼Œä½† SO æ–‡ä»¶å·²è¢«åŠ å£³

\*æœ¬é…æ–¹æ•™ä½ \*ï¼šä½¿ç”¨ Frida åŠ¨æ€è„±å£³åŠ å›º Appã€Dump å†…å­˜ä¸­çš„ DEX å’Œ SO æ–‡ä»¶ã€ä¿®å¤æ–‡ä»¶æ ¼å¼ä»¥ä¾›åˆ†æã€‚

\*æ ¸å¿ƒç†å¿µ\*ï¼š

&gt; ğŸ’¡ **åŠ¨æ€è„±å£³ï¼šåœ¨è¿è¡Œæ—¶è·å–å·²è§£å¯†çš„ä»£ç **
&gt;
&gt; - åŠ å£³åªæ˜¯é™æ€ä¿æŠ¤ï¼Œè¿è¡Œæ—¶å¿…ç„¶ä¼šè§£å¯†
&gt; - Frida å¯ä»¥åœ¨ DEX/SO åŠ è½½æ—¶ dump å†…å­˜
&gt; - ä¿®å¤æ–‡ä»¶æ ¼å¼åå³å¯ç”¨ä¼ ç»Ÿå·¥å…·åˆ†æ
&gt; - ç»•è¿‡æ‰€æœ‰åŠ å›ºæ–¹æ¡ˆçš„é€šç”¨æ–¹æ³•

\*é¢„è®¡ç”¨æ—¶\*: 30-60 åˆ†é’Ÿ

___

## å·¥å…·æ¸…å•

### å¿…éœ€å·¥å…·

- â˜ **Frida** - åŠ¨æ€æ’æ¡©æ¡†æ¶
- â˜ **Android è®¾å¤‡**ï¼ˆå·² Rootï¼‰æˆ–æ¨¡æ‹Ÿå™¨
- â˜ **Python 3.7+** - è¿è¡Œ Frida è„šæœ¬
- â˜ **jadx-gui** - åˆ†æè„±å£³åçš„ DEX

### å¯é€‰å·¥å…·

- â˜ **IDA Pro / Ghidra** - åˆ†æ SO æ–‡ä»¶
- â˜ **frida-dexdump** - è‡ªåŠ¨åŒ– DEX è„±å£³
- â˜ **FRIDA-DEXDump** - å¦ä¸€ä¸ªæµè¡Œçš„è„±å£³å·¥å…·
- â˜ **SoFixer** - ä¿®å¤ dump çš„ SO æ–‡ä»¶

___

## å‰ç½®æ¡ä»¶

### âœ… ç¡®è®¤æ¸…å•

```bash
# 1. Frida æ­£å¸¸è¿è¡Œ
frida-ps -U

# 2. Python ç¯å¢ƒ
python3 --version

# 3. jadx-gui å·²å®‰è£…
jadx-gui --version

# 4. æ£€æŸ¥è®¾å¤‡ root çŠ¶æ€
adb shell su -c &#39;id&#39;
# åº”è¯¥æ˜¾ç¤º uid=0(root)
</code></pre>
<h3 id="è¯†åˆ«-app-æ˜¯å¦åŠ å›º">è¯†åˆ« App æ˜¯å¦åŠ å›º</h3>
<p>*æ–¹æ³• 1ï¼šjadx æŸ¥çœ‹*</p>
<p>æ‰“å¼€ APKï¼Œå¦‚æœçœ‹åˆ°ï¼š</p>
<ul>
<li><p>åªæœ‰å‡ ä¸ªç±»å’Œæ–¹æ³•</p></li>
<li><p>æœ‰ <code>StubApp</code>ã€<code>ProxyApplication</code>
ç­‰å­—æ ·</p></li>
<li><p>MainActivity é€»è¾‘å¼‚å¸¸ç®€å•</p></li>
<li><p>*æ–¹æ³• 2ï¼šæŸ¥çœ‹ SO æ–‡ä»¶*</p></li>
</ul>
<div class="sourceCode" id="cb357"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># è§£å‹ APK</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> app.apk <span class="at">-d</span> app_unzipped</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æŸ¥çœ‹ lib ç›®å½•</span></span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> app_unzipped/lib/arm64-v8a/</span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a><span class="co"># å¸¸è§åŠ å›ºå£³ SO æ–‡ä»¶å</span></span>
<span id="cb357-8"><a href="#cb357-8" aria-hidden="true" tabindex="-1"></a><span class="co"># libjiagu.so (360åŠ å›º)</span></span>
<span id="cb357-9"><a href="#cb357-9" aria-hidden="true" tabindex="-1"></a><span class="co"># libDexHelper.so (æ¢†æ¢†åŠ å›º)</span></span>
<span id="cb357-10"><a href="#cb357-10" aria-hidden="true" tabindex="-1"></a><span class="co"># libtup.so (è…¾è®¯åŠ å›º)</span></span>
<span id="cb357-11"><a href="#cb357-11" aria-hidden="true" tabindex="-1"></a><span class="co"># libexec.so (çˆ±åŠ å¯†)</span></span></code></pre></div>
<h3 id="ç¬¬-1-æ­¥ä½¿ç”¨-frida-dexdump-è„±å£³10-åˆ†é’Ÿ">ç¬¬ 1 æ­¥ï¼šä½¿ç”¨
frida-dexdump è„±å£³ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<h4 id="å®‰è£…-frida-dexdump">1.1 å®‰è£… frida-dexdump</h4>
<div class="sourceCode" id="cb358"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å…‹éš†é¡¹ç›®</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/hluwa/frida-dexdump.git</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> frida-dexdump</span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="co"># å®‰è£…ä¾èµ–</span></span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install frida frida-tools</span></code></pre></div>
<h1 id="f-å¯åŠ¨åº”ç”¨">-f: å¯åŠ¨åº”ç”¨</h1>
<h1 id="no-pause-ä¸æš‚åœç«‹å³è¿è¡Œ">â€“no-pause: ä¸æš‚åœï¼Œç«‹å³è¿è¡Œ</h1>
<p>python3 main.py -U -f com.example.app</p>
<h1 id="è„šæœ¬ä¼šè‡ªåŠ¨">è„šæœ¬ä¼šè‡ªåŠ¨ï¼š</h1>
<h1 id="å¯åŠ¨åº”ç”¨">1. å¯åŠ¨åº”ç”¨</h1>
<h1 id="hook-dex-åŠ è½½å‡½æ•°">2. Hook DEX åŠ è½½å‡½æ•°</h1>
<h1 id="å¯¼å‡ºæ‰€æœ‰å·²åŠ è½½çš„-dex-æ–‡ä»¶">3. å¯¼å‡ºæ‰€æœ‰å·²åŠ è½½çš„ DEX æ–‡ä»¶</h1>
<h1 id="ä¿å­˜åˆ°å½“å‰ç›®å½•">4. ä¿å­˜åˆ°å½“å‰ç›®å½•</h1>
<pre><code>[DEXDump] Dumping DEX file: 0x7abc000000, size: 4562314
[DEXDump] Saved: com.example.app_classes.dex
[DEXDump] Found DEX: /data/app/.../base.apk!classes2.dex
[DEXDump] Dumping DEX file: 0x7abc500000, size: 2314567
[DEXDump] Saved: com.example.app_classes2.dex
[DEXDump] Total: 2 DEX files dumped
</code></pre>
<h1
id="ç„¶ååœ¨åº”ç”¨å†…è§¦å‘éœ€è¦åˆ†æçš„åŠŸèƒ½">ç„¶ååœ¨åº”ç”¨å†…è§¦å‘éœ€è¦åˆ†æçš„åŠŸèƒ½</h1>
<pre><code>
# ç”¨ jadx æ‰“å¼€
jadx-gui com.example.app_classes.dex
</code></pre>
<h3 id="ç¬¬-2-æ­¥ä½¿ç”¨-frida-dexdumpå¤‡é€‰æ–¹æ¡ˆ10-åˆ†é’Ÿ">ç¬¬ 2 æ­¥ï¼šä½¿ç”¨
FRIDA-DEXDumpï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<p>å¦‚æœ frida-dexdump ä¸å·¥ä½œï¼Œå¯ä»¥å°è¯• FRIDA-DEXDumpï¼š</p>
<div class="sourceCode" id="cb361"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å®‰è£…</span></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/lasting-yang/frida_dump.git</span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> frida_dump</span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a><span class="co"># è¿è¡Œå‘½ä»¤</span></span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> dump_dex.py <span class="at">-U</span> <span class="at">-f</span> com.example.app</span></code></pre></div>
<hr />
<h3 id="ç¬¬-3-æ­¥æ‰‹åŠ¨è„šæœ¬è„±å£³é«˜çº§15-åˆ†é’Ÿ">ç¬¬ 3
æ­¥ï¼šæ‰‹åŠ¨è„šæœ¬è„±å£³ï¼ˆé«˜çº§ï¼‰ï¼ˆ15 åˆ†é’Ÿï¼‰</h3>
<p>å¦‚æœè‡ªåŠ¨åŒ–å·¥å…·å¤±è´¥ï¼Œå¯ä»¥ç¼–å†™è‡ªå®šä¹‰ Frida è„šæœ¬ã€‚</p>
<h4 id="hook-opencommoné€‚ç”¨äº-android-8.0">3.1 Hook OpenCommonï¼ˆé€‚ç”¨äº
android 8.0+ï¼‰</h4>
<p>*dex_dump.js*ï¼š</p>
<div class="sourceCode" id="cb362"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dumpDex</span>() {</span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] DEX Dumper started&quot;</span>)<span class="op">;</span></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a><span class="co">// æŸ¥æ‰¾ libart.so</span></span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> libart <span class="op">=</span> Process<span class="op">.</span><span class="fu">findModuleByName</span>(<span class="st">&quot;libart.so&quot;</span>)<span class="op">;</span></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>libart) {</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] libart.so not found&quot;</span>)<span class="op">;</span></span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook OpenCommon (android 8.0+)</span></span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a><span class="co">// ç¬¦å·åç§°å› ç‰ˆæœ¬è€Œå¼‚ï¼Œéœ€è¦ç”¨ nm æˆ– readelf ç¡®è®¤</span></span>
<span id="cb362-14"><a href="#cb362-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OpenCommon <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb362-15"><a href="#cb362-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-16"><a href="#cb362-16" aria-hidden="true" tabindex="-1"></a><span class="co">// å°è¯•å¸¸è§ç¬¦å·</span></span>
<span id="cb362-17"><a href="#cb362-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> symbols <span class="op">=</span> [</span>
<span id="cb362-18"><a href="#cb362-18" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;_ZN3art7DexFile10OpenCommonEPKhjS2_jRKNS_10OatDexFileEbbPS1_&quot;</span><span class="op">,</span></span>
<span id="cb362-19"><a href="#cb362-19" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;_ZN3art7DexFile10OpenCommonEPKhmS2_jRKNS_10OatDexFileEbbPS1_NS_6Handle&quot;</span><span class="op">,</span></span>
<span id="cb362-20"><a href="#cb362-20" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb362-21"><a href="#cb362-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-22"><a href="#cb362-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> symbols<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb362-23"><a href="#cb362-23" aria-hidden="true" tabindex="-1"></a>OpenCommon <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libart.so&quot;</span><span class="op">,</span> symbols[i])<span class="op">;</span></span>
<span id="cb362-24"><a href="#cb362-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (OpenCommon) {</span>
<span id="cb362-25"><a href="#cb362-25" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Found OpenCommon:&quot;</span><span class="op">,</span> OpenCommon)<span class="op">;</span></span>
<span id="cb362-26"><a href="#cb362-26" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span>
<span id="cb362-27"><a href="#cb362-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-28"><a href="#cb362-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-29"><a href="#cb362-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-30"><a href="#cb362-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>OpenCommon) {</span>
<span id="cb362-31"><a href="#cb362-31" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] OpenCommon not found&quot;</span>)<span class="op">;</span></span>
<span id="cb362-32"><a href="#cb362-32" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb362-33"><a href="#cb362-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-34"><a href="#cb362-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-35"><a href="#cb362-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook</span></span>
<span id="cb362-36"><a href="#cb362-36" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(OpenCommon<span class="op">,</span> {</span>
<span id="cb362-37"><a href="#cb362-37" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb362-38"><a href="#cb362-38" aria-hidden="true" tabindex="-1"></a><span class="co">// args[0] = base (DEX å†…å­˜åœ°å€)</span></span>
<span id="cb362-39"><a href="#cb362-39" aria-hidden="true" tabindex="-1"></a><span class="co">// args[1] = size (DEX æ–‡ä»¶å¤§å°)</span></span>
<span id="cb362-40"><a href="#cb362-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-41"><a href="#cb362-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> base <span class="op">=</span> args[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb362-42"><a href="#cb362-42" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> size <span class="op">=</span> args[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toInt32</span>()<span class="op">;</span></span>
<span id="cb362-43"><a href="#cb362-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-44"><a href="#cb362-44" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] æ£€æµ‹åˆ° DEX!&quot;</span>)<span class="op">;</span></span>
<span id="cb362-45"><a href="#cb362-45" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; åŸºå€: &quot;</span> <span class="op">+</span> base)<span class="op">;</span></span>
<span id="cb362-46"><a href="#cb362-46" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; å¤§å°: &quot;</span> <span class="op">+</span> size)<span class="op">;</span></span>
<span id="cb362-47"><a href="#cb362-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-48"><a href="#cb362-48" aria-hidden="true" tabindex="-1"></a><span class="co">// è¯»å– DEX æ–‡ä»¶å¤´ï¼ŒéªŒè¯é­”æ•°</span></span>
<span id="cb362-49"><a href="#cb362-49" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> magic <span class="op">=</span> base<span class="op">.</span><span class="fu">readCString</span>(<span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb362-50"><a href="#cb362-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (magic <span class="op">===</span> <span class="st">&quot;dex</span><span class="sc">\n</span><span class="st">&quot;</span>) {</span>
<span id="cb362-51"><a href="#cb362-51" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Magic: &quot;</span> <span class="op">+</span> magic <span class="op">+</span> <span class="st">&quot; âœ“&quot;</span>)<span class="op">;</span></span>
<span id="cb362-52"><a href="#cb362-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-53"><a href="#cb362-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Dump DEX</span></span>
<span id="cb362-54"><a href="#cb362-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dexBytes <span class="op">=</span> base<span class="op">.</span><span class="fu">readByteArray</span>(size)<span class="op">;</span></span>
<span id="cb362-55"><a href="#cb362-55" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fileName <span class="op">=</span> <span class="st">&quot;/sdcard/&quot;</span> <span class="op">+</span> size <span class="op">+</span> <span class="st">&quot;.dex&quot;</span><span class="op">;</span></span>
<span id="cb362-56"><a href="#cb362-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-57"><a href="#cb362-57" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> file <span class="op">=</span> <span class="kw">new</span> <span class="bu">File</span>(fileName<span class="op">,</span> <span class="st">&quot;wb&quot;</span>)<span class="op">;</span></span>
<span id="cb362-58"><a href="#cb362-58" aria-hidden="true" tabindex="-1"></a>file<span class="op">.</span><span class="fu">write</span>(dexBytes)<span class="op">;</span></span>
<span id="cb362-59"><a href="#cb362-59" aria-hidden="true" tabindex="-1"></a>file<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb362-60"><a href="#cb362-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-61"><a href="#cb362-61" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] DEX dumped to: &quot;</span> <span class="op">+</span> fileName)<span class="op">;</span></span>
<span id="cb362-62"><a href="#cb362-62" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb362-63"><a href="#cb362-63" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; Invalid magic: &quot;</span> <span class="op">+</span> magic)<span class="op">;</span></span>
<span id="cb362-64"><a href="#cb362-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-65"><a href="#cb362-65" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb362-66"><a href="#cb362-66" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb362-67"><a href="#cb362-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-68"><a href="#cb362-68" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[*] Hooks installed, waiting for DEX load...&quot;</span>)<span class="op">;</span></span>
<span id="cb362-69"><a href="#cb362-69" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb362-70"><a href="#cb362-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-71"><a href="#cb362-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-72"><a href="#cb362-72" aria-hidden="true" tabindex="-1"></a><span class="fu">setImmediate</span>(dumpDex)<span class="op">;</span></span></code></pre></div>
<h1 id="æ‹‰å–åˆ°æœ¬åœ°">æ‹‰å–åˆ°æœ¬åœ°</h1>
<p>adb pull /sdcard/*.dex .</p>
<pre><code>Module.enumerateExports(&quot;libart.so&quot;).forEach(function(exp) {
if (exp.name.includes(&quot;DexFile&quot;) &amp;&amp; exp.name.includes(&quot;Open&quot;)) {
console.log(exp.name, exp.address);
}
});
</code></pre>
<h1 id="æŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„-so-æ–‡ä»¶">æŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ SO æ–‡ä»¶</h1>
<p>frida -U -f com.example.app</p>
<blockquote>
<p>Process.enumerateModules().forEach(function(m) { if
(m.name.includes(â€œnativeâ€) || m.name.includes(â€œencryptâ€)) {
console.log(m.name, m.base, m.size); } });</p>
</blockquote>
<h1 id="è¾“å‡ºç¤ºä¾‹">è¾“å‡ºç¤ºä¾‹:</h1>
<h1 id="libnative-lib.so-0x7abc000000-0x50000">libnative-lib.so
0x7abc000000 0x50000</h1>
<pre><code>var module = Process.findModuleByName(moduleName);
if (!module) {
console.log(&quot;[-] Module not found: &quot; + moduleName);
return;
}

console.log(&quot;[+] æ‰¾åˆ°æ¨¡å—:&quot;, moduleName);
console.log(&quot; åŸºå€: &quot; + module.base);
console.log(&quot; å¤§å°: &quot; + module.size);

// å¯¼å‡ºæ•´ä¸ªæ¨¡å—
var buffer = module.base.readByteArray(module.size);
var fileName = &quot;/sdcard/&quot; + moduleName;

var file = new File(fileName, &quot;wb&quot;);
file.write(buffer);
file.close();

console.log(&quot;[+] å·²å¯¼å‡ºåˆ°: &quot; + fileName);

}

// ä½¿ç”¨
dumpSo(&quot;libnative-lib.so&quot;);
</code></pre>
<p>adb pull /sdcard/libnative-lib.so .</p>
<pre><code>cd frida-all-in-one

# è¿è¡Œå‘½ä»¤

python3 dump_so.py -U com.example.app libnative-lib.so

# ä¼šè‡ªåŠ¨å¯¼å‡ºå¹¶ä¿®å¤ SO æ–‡ä»¶
</code></pre>
<h4 id="ä½¿ç”¨-sofixer">5.1 ä½¿ç”¨ SoFixer</h4>
<div class="sourceCode" id="cb366"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸‹è½½</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/F8LEFT/SoFixer.git</span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> SoFixer</span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ç¼–è¯‘ï¼ˆéœ€è¦ CMakeï¼‰</span></span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> build <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> build</span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> ..</span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-10"><a href="#cb366-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨</span></span>
<span id="cb366-11"><a href="#cb366-11" aria-hidden="true" tabindex="-1"></a><span class="ex">./SoFixer</span> ../libnative-lib.so ../libnative-lib_fixed.so</span></code></pre></div>
<p>[+] Detected architecture: ARM64 [+] Rebuilding ELF headerâ€¦ [+]
Fixing section tableâ€¦ [+] Fixing dynamic symbolsâ€¦ [+] Output file:
libnative-lib_fixed.so [+] Done!</p>
<pre><code># åº”è¯¥æ˜¾ç¤º: ELF 64-bit LSB shared object, ARM aarch64...

# ç”¨ IDA Pro æ‰“å¼€
# æˆ–ç”¨ readelf æŸ¥çœ‹
readelf -h libnative-lib_fixed.so
</code></pre>
<pre><code>è§£å¯†åŸå§‹ DEXï¼ˆåœ¨å†…å­˜ä¸­ï¼‰
â†“
è°ƒç”¨ DexFile::OpenCommon åŠ è½½ DEX â† Frida Hook ç‚¹
â†“
Frida è¯»å–å†…å­˜ä¸­çš„ DEX æ•°æ®
â†“
ä¿å­˜åˆ°æ–‡ä»¶
</code></pre>
<p>size_t size, // DEX å¤§å° â€¦)</p>
<pre><code>Only dump Thisäº›æ®µOriginalDataï¼Œç¼ºå°‘ ELF Fileç»“æ„
</code></pre>
<p>[.text æ®µ] [.data æ®µ] [.rodata æ®µ] â€¦ [Symbol Table] â† é‡å»º [String
Table] â† é‡å»º</p>
<pre><code>| æ¢†æ¢†åŠ å›º | libDexHelper.so | |
| è…¾è®¯åŠ å›º | libtup.so | |
| çˆ±åŠ å¯† | libexec.so | |
| ç½‘æ˜“æ˜“ç›¾ | libnesec.so | |

* *é€šç”¨ç­–ç•¥**ï¼šæ‰€æœ‰åŠ å›ºéƒ½éœ€è¦åœ¨è¿è¡Œæ—¶è§£å¯†ï¼ŒFrida è„±å£³éƒ½æœ‰æ•ˆï¼

- --

## å¸¸è§é—®é¢˜

### âŒ é—®é¢˜ 1: frida-dexdump æŠ¥é”™ &quot;Failed to spawn&quot;

* *ç—‡çŠ¶**ï¼š
</code></pre>
<p>adb shell pm list packages | grep example</p>
<h1 id="ç¡®è®¤åŒ…åæ­£ç¡®">2. ç¡®è®¤åŒ…åæ­£ç¡®</h1>
<h1 id="ä»-androidmanifest.xml-è·å–å‡†ç¡®åŒ…å">ä» AndroidManifest.xml
è·å–å‡†ç¡®åŒ…å</h1>
<h1 id="å°è¯•-attach-æ¨¡å¼">3. å°è¯• Attach æ¨¡å¼</h1>
<h1 id="å…ˆæ‰‹åŠ¨å¯åŠ¨åº”ç”¨">å…ˆæ‰‹åŠ¨å¯åŠ¨åº”ç”¨</h1>
<p>adb shell am start -n com.example.app/.MainActivity</p>
<h1 id="å†é™„åŠ ">å†é™„åŠ </h1>
<p>python3 main.py -U com.example.app</p>
<pre><code>
1. **DEX å¤´éƒ¨æŸå**
    ```bash
# æ£€æŸ¥é­”æ•°
xxd dumped.dex | head -1
# åº”è¯¥çœ‹åˆ°: 64 65 78 0a (dex\n)

```
    ```python
# éªŒè¯ DEX å¤§å°
with open(&#39;dumped.dex&#39;, &#39;rb&#39;) as f:
f.seek(32) # è·³åˆ° file_size å­—æ®µ
size = int.from_bytes(f.read(4), &#39;little&#39;)
print(f&quot;DEX å£°æ˜çš„å¤§å°: {size}&quot;)

import os
actual_size = os.path.getsize(&#39;dumped.dex&#39;)
print(f&quot;å®é™…æ–‡ä»¶å¤§å°: {actual_size}&quot;)

```
    ```bash
git clone https://github.com/anestisb/dexrepair.git
python3 dexrepair/dexrepair.py dumped.dex fixed.dex

```

* *æ£€æŸ¥æ­¥éª¤**ï¼š

1. **ç¡®è®¤ libart.so å·²åŠ è½½**
    ```javascript
var libart = Process.findModuleByName(&quot;libart.so&quot;);
console.log(&quot;libart found:&quot;, libart !== null);

```
    ```javascript
Module.enumerateExports(&quot;libart.so&quot;).forEach(function(exp) {
if (exp.name.includes(&quot;OpenCommon&quot;)) {
console.log(exp.name);
}
});

```
    ```javascript
// android 7.0-
var OpenMemory = Module.findExportByName(&quot;libart.so&quot;,
&quot;_ZN3art7DexFile10OpenMemoryEPKhjRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEjPNS_6MemMapEPKNS_10OatDexFileEPS9_&quot;);

```

* *ç—‡çŠ¶**ï¼šIDA æ‰“å¼€ååªæ˜¾ç¤ºæ•°æ®ï¼Œæ²¡æœ‰å‡½æ•°

* *è§£å†³**ï¼š

1. **æ‰‹åŠ¨å®šä¹‰å‡½æ•°**
    ```

IDA Inï¼š
- å…‰æ ‡ç§»åˆ°ç–‘ä¼¼Functionèµ·å§‹å¤„
- By &#39;P&#39; KeyCreateFunction
- By &#39;C&#39; KeyConvertä¸ºCode
    ```

2. **ä½¿ç”¨ç¬¦å·æ¢å¤å·¥å…·**
    ```bash
# If åŸå§‹ SO æœ‰ç¬¦å·table
readelf -s original.so &gt; symbols.txt

# ç”¨ IDA ScriptImportç¬¦å·

```
- å¦‚æœçœ‹åˆ°å¤§é‡è·³è½¬å’Œæ— æ„ä¹‰çš„ä»£ç å—
- å¯èƒ½æ˜¯ OLLVM æ§åˆ¶æµå¹³å¦åŒ–
- å‚è€ƒï¼š[OLLVM åæ··æ·†](../Analysis/ollvm_deobfuscation.md)

- å¦‚æœçœ‹åˆ°å¤§é‡è·³è½¬å’Œæ— æ„ä¹‰çš„ä»£ç å—
- å¯èƒ½æ˜¯ OLLVM æ§åˆ¶æµå¹³å¦åŒ–
- å‚è€ƒï¼š[OLLVM åæ··æ·†](../Analysis/ollvm_deobfuscation.md)


### âŒ é—®é¢˜ 5: App æ£€æµ‹åˆ° Frida å¹¶å´©æºƒ

* *ç—‡çŠ¶**ï¼šå¯åŠ¨åç«‹å³é€€å‡ºï¼Œlogcat æ˜¾ç¤ºåè°ƒè¯•æç¤º

* *è§£å†³**ï¼š

å‚è€ƒ [Frida åè°ƒè¯•ç»•è¿‡](../Anti-Detection/frida_anti_debugging.md)

å¿«é€Ÿæ–¹æ³•ï¼š

```bash
# ä½¿ç”¨ Magisk Hide
# æˆ–ä½¿ç”¨ä¿®æ”¹ç‰ˆ Frida æœåŠ¡å™¨
wget https://github.com/hluwa/strongR-frida-android/releases/download/xxx/frida-server
</code></pre>
<ul>
<li><strong><a href="./un-packing.md">åº”ç”¨è„±å£³æ€»è§ˆ</a></strong> -
å„ç§è„±å£³æŠ€æœ¯å¯¹æ¯”</li>
<li><strong><a href="../Anti-Detection/frida_anti_debugging.md">Frida
åè°ƒè¯•ç»•è¿‡</a></strong> - å¤„ç†å Frida æ£€æµ‹</li>
<li><strong><a href="./so_obfuscation_deobfuscation.md">SO
æ··æ·†åˆ†æ</a></strong> - åˆ†ææ··æ·†çš„ SO æ–‡ä»¶</li>
<li><strong><a href="../Analysis/ollvm_deobfuscation.md">OLLVM
åæ··æ·†</a></strong> - å¤„ç†æ§åˆ¶æµæ··æ·†</li>
</ul>
<h3 id="å·¥å…·æ·±å…¥-6">å·¥å…·æ·±å…¥</h3>
<ul>
<li><strong><a href="../../02-Tools/Dynamic/frida_guide.md">Frida
å®Œæ•´æŒ‡å—</a></strong></li>
<li><strong><a href="../../02-Tools/Static/ida_pro_guide.md">IDA Pro
ä½¿ç”¨</a></strong></li>
</ul>
<h3 id="é¡¹ç›®èµ„æº">é¡¹ç›®èµ„æº</h3>
<table>
<colgroup>
<col style="width: 41%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>frida-dexdump</strong> - https</td>
<td>//github.com/hluwa/frida-dexdump</td>
</tr>
<tr>
<td><strong>FRIDA-DEXDump</strong> - https</td>
<td>//github.com/lasting-yang/frida_dump</td>
</tr>
<tr>
<td><strong>SoFixer</strong> - https</td>
<td>//github.com/F8LEFT/SoFixer</td>
</tr>
<tr>
<td><strong>frida-all-in-one</strong> - https</td>
<td>//github.com/hookmaster/frida-all-in-one</td>
</tr>
</tbody>
</table>
<h3 id="ç†è®ºåŸºç¡€-2">ç†è®ºåŸºç¡€</h3>
<ul>
<li><strong><a href="../../04-Reference/Foundations/dex_format.md">DEX
æ–‡ä»¶æ ¼å¼</a></strong></li>
<li><strong><a
href="../../04-Reference/Foundations/so_elf_format.md">SO/ELF
æ–‡ä»¶æ ¼å¼</a></strong></li>
<li><strong><a href="../../04-Reference/Foundations/art_runtime.md">ART
è¿è¡Œæ—¶</a></strong></li>
</ul>
<hr />
<h2 id="å¿«é€Ÿå‚è€ƒ-5">å¿«é€Ÿå‚è€ƒ</h2>
<h3 id="è„±å£³å·¥å…·å¯¹æ¯”">è„±å£³å·¥å…·å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>ç±»å‹</th>
<th>éš¾åº¦</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>frida-dexdump</strong></td>
<td>è‡ªåŠ¨åŒ–</td>
<td></td>
<td>ç®€å•ï¼Œæ”¯æŒå¤šç‰ˆæœ¬</td>
</tr>
<tr>
<td><strong>FRIDA-DEXDump</strong></td>
<td>è‡ªåŠ¨åŒ–</td>
<td></td>
<td>æ·±åº¦æœç´¢ï¼Œæ›´å…¨é¢</td>
</tr>
<tr>
<td><strong>æ‰‹åŠ¨è„šæœ¬</strong></td>
<td>å®šåˆ¶</td>
<td></td>
<td>çµæ´»ï¼Œé€‚åˆç‰¹æ®Šæƒ…å†µ</td>
</tr>
<tr>
<td><strong>objection</strong></td>
<td>äº¤äº’å¼</td>
<td></td>
<td>å¤šåŠŸèƒ½ï¼Œå«è„±å£³</td>
</tr>
</tbody>
</table>
<h3 id="ä¸€é”®è„±å£³è„šæœ¬">ä¸€é”®è„±å£³è„šæœ¬</h3>
<p>*auto_unpack.sh*ï¼š</p>
<div class="sourceCode" id="cb372"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a><span class="va">PACKAGE</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$PACKAGE</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;ç”¨æ³•: </span><span class="va">$0</span><span class="st"> &lt;package_name&gt;&quot;</span></span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> 1</span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb372-9"><a href="#cb372-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-10"><a href="#cb372-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; å¼€å§‹è„±å£³: </span><span class="va">$PACKAGE</span><span class="st">&quot;</span></span>
<span id="cb372-11"><a href="#cb372-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-12"><a href="#cb372-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Dump DEX</span></span>
<span id="cb372-13"><a href="#cb372-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb372-14"><a href="#cb372-14" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;ğŸ“¦ å¯¼å‡º DEX æ–‡ä»¶...&quot;</span></span>
<span id="cb372-15"><a href="#cb372-15" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> ~/tools/frida-dexdump/main.py <span class="at">-U</span> <span class="at">-f</span> <span class="va">$PACKAGE</span></span>
<span id="cb372-16"><a href="#cb372-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-17"><a href="#cb372-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Dump SO</span></span>
<span id="cb372-18"><a href="#cb372-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb372-19"><a href="#cb372-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; å¯¼å‡º SO æ–‡ä»¶...&quot;</span></span>
<span id="cb372-20"><a href="#cb372-20" aria-hidden="true" tabindex="-1"></a><span class="ex">frida</span> <span class="at">-U</span> <span class="at">-f</span> <span class="va">$PACKAGE</span> <span class="at">-l</span> dump_all_so.js <span class="at">--no-pause</span></span>
<span id="cb372-21"><a href="#cb372-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-22"><a href="#cb372-22" aria-hidden="true" tabindex="-1"></a><span class="fu">sleep</span> 5</span>
<span id="cb372-23"><a href="#cb372-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-24"><a href="#cb372-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. æ‹‰å–æ–‡ä»¶</span></span>
<span id="cb372-25"><a href="#cb372-25" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb372-26"><a href="#cb372-26" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;ğŸ“¥ æ‹‰å–æ–‡ä»¶...&quot;</span></span>
<span id="cb372-27"><a href="#cb372-27" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /sdcard/<span class="pp">*</span>.dex .</span>
<span id="cb372-28"><a href="#cb372-28" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /sdcard/<span class="pp">*</span>.so .</span>
<span id="cb372-29"><a href="#cb372-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-30"><a href="#cb372-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. æ¸…ç†</span></span>
<span id="cb372-31"><a href="#cb372-31" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell rm /sdcard/<span class="pp">*</span>.dex</span>
<span id="cb372-32"><a href="#cb372-32" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> shell rm /sdcard/<span class="pp">*</span>.so</span>
<span id="cb372-33"><a href="#cb372-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-34"><a href="#cb372-34" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb372-35"><a href="#cb372-35" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;âœ… å®Œæˆ! æ–‡ä»¶å·²ä¿å­˜åˆ°å½“å‰ç›®å½•&quot;</span></span>
<span id="cb372-36"><a href="#cb372-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> <span class="pp">*</span>.dex <span class="pp">*</span>.so</span></code></pre></div>
<p>function dumpAllSo() { var modules = Process.enumerateModules();
console.log(â€œ[*] æ‰¾åˆ°â€ + modules.length + â€ ä¸ªæ¨¡å—â€);</p>
<p>modules.forEach(function(module) { // åªå¯¼å‡º .so æ–‡ä»¶ if
(!module.name.endsWith(â€˜.soâ€™)) { return; }</p>
<p>// æ’é™¤ç³»ç»Ÿåº“ if (module.path.startsWith(â€˜/systemâ€™) ||
module.path.startsWith(â€˜/apexâ€™)) { return; }</p>
<p>console.log(â€œ[+] å¯¼å‡º:â€ + module.name); console.log(â€ è·¯å¾„: â€ +
module.path); console.log(â€ åŸºå€: â€ + module.base); console.log(â€ å¤§å°:
â€ + module.size);</p>
<p>try { var buffer = module.base.readByteArray(module.size); var
fileName = â€œ/sdcard/â€ + module.name; var file = new File(fileName,
â€œwbâ€); file.write(buffer); file.close(); console.log(â€ å·²ä¿å­˜: â€ +
fileName); } catch(e) { console.log(â€ é”™è¯¯: â€ + e); } });</p>
<p>console.log(â€œ[*] å®Œæˆ!â€);</p>
<p>}</p>
<p>setImmediate(dumpAllSo);</p>
<!-- 01-Recipes/Unpacking/so_obfuscation_deobfuscation.md -->
<h1 id="so-æ–‡ä»¶åæ··æ·†èŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤">SO
æ–‡ä»¶åæ··æ·†ï¼šèŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤</h1>
<p>åœ¨ Android SO æ–‡ä»¶é€†å‘å·¥ç¨‹ä¸­ï¼Œ<strong>ä»£ç æ··æ·† (Code
Obfuscation)</strong>ï¼Œä¿—ç§°â€èŠ±æŒ‡ä»¤â€ï¼Œæ˜¯å¼€å‘è€…ä¸ºäº†ä¿æŠ¤æ ¸å¿ƒé€»è¾‘ã€å¢åŠ é€†å‘åˆ†æéš¾åº¦è€Œé‡‡ç”¨çš„ä¸€ç§å¸¸ç”¨æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ä»£ç ä¸­æ’å…¥å¤§é‡å¯¹ç¨‹åºæœ¬èº«é€»è¾‘æ— ç”¨ä½†èƒ½è¿·æƒ‘åæ±‡ç¼–å·¥å…·å’Œåˆ†æäººå‘˜çš„æŒ‡ä»¤ã€‚</p>
<p>æœ¬æŒ‡å—å°†ç³»ç»Ÿä»‹ç»èŠ±æŒ‡ä»¤çš„å¸¸è§ç±»å‹ã€è¯†åˆ«æ–¹æ³•ï¼Œå¹¶é‡ç‚¹é˜è¿°å¦‚ä½•åˆ©ç”¨
<code>IDAPython</code> ç¼–å†™è„šæœ¬ï¼Œå®ç°è‡ªåŠ¨åŒ–â€å»èŠ±â€ã€‚</p>
<hr />
<h2 id="ç›®å½•-4">ç›®å½•</h2>
<ul>
<li><p><a href="#so-æ–‡ä»¶åæ··æ·†èŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤">SO
æ–‡ä»¶åæ··æ·†ï¼šèŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹">èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹</a></p></li>
<li><p><a href="#åƒåœ¾æŒ‡ä»¤-junk-code">åƒåœ¾æŒ‡ä»¤ (Junk Code)</a></p></li>
<li><p><a href="#ä¸é€æ˜è°“è¯-opaque-predicates">ä¸é€æ˜è°“è¯ (Opaque
Predicates)</a></p></li>
<li><p><a href="#æŒ‡ä»¤æ›¿æ¢-instruction-substitution">æŒ‡ä»¤æ›¿æ¢
(Instruction Substitution)</a></p></li>
<li><p><a href="#æ§åˆ¶æµå¹³å¦åŒ–-control-flow-flattening">æ§åˆ¶æµå¹³å¦åŒ–
(Control Flow Flattening)</a></p></li>
<li><p><a href="#å¦‚ä½•è¯†åˆ«èŠ±æŒ‡ä»¤">å¦‚ä½•è¯†åˆ«èŠ±æŒ‡ä»¤</a></p></li>
<li><p><a href="#é™æ€åˆ†æç‰¹å¾">é™æ€åˆ†æç‰¹å¾</a></p></li>
<li><p><a href="#åŠ¨æ€è°ƒè¯•éªŒè¯">åŠ¨æ€è°ƒè¯•éªŒè¯</a></p></li>
<li><p><a href="#è‡ªåŠ¨åŒ–å»èŠ±è„šæœ¬-idapython-å®æˆ˜">è‡ªåŠ¨åŒ–â€å»èŠ±â€è„šæœ¬
(IDAPython å®æˆ˜)</a></p></li>
<li><p><a href="#åœºæ™¯ä¸€nop-æ‰æ— æ•ˆè·³è½¬">åœºæ™¯ä¸€ï¼šNOP
æ‰æ— æ•ˆè·³è½¬</a></p></li>
<li><p><a
href="#åœºæ™¯äºŒä¿®å¤ä¸é€æ˜è°“è¯">åœºæ™¯äºŒï¼šä¿®å¤ä¸é€æ˜è°“è¯</a></p></li>
<li><p><a href="#æ€»ç»“">æ€»ç»“</a></p></li>
</ul>
<hr />
<h2 id="èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹">èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹</h2>
<h2 id="åƒåœ¾æŒ‡ä»¤-junk-code"># åƒåœ¾æŒ‡ä»¤ (Junk Code)</h2>
<p>æœ€ç®€å•çš„æ··æ·†å½¢å¼ã€‚åœ¨çœŸå®æŒ‡ä»¤ä¹‹é—´æ’å…¥ä¸ä¼šå½±å“ç¨‹åºçŠ¶æ€ï¼ˆå¯„å­˜å™¨ã€å†…å­˜ã€æ ‡å¿—ä½ï¼‰çš„æŒ‡ä»¤ã€‚</p>
<pre class="assembly"><code>; çœŸå®ä»£ç 
PUSH EAX

; --- åƒåœ¾ä»£ç  ---
NOP
MOV EBX, EBX
XCHG ECX, ECX
ADD EAX, 0
; --- åƒåœ¾ä»£ç ç»“æŸ ---

; çœŸå®ä»£ç 
POP EAX
</code></pre>
<p>MOV EAX, EDX XOR EAX, EDX ; æ¸…é›¶ EAX TEST EAX, EAX ; è®¾ç½® Z æ ‡å¿—</p>
<p>; JZ (ä¸ºé›¶åˆ™è·³è½¬) å°†å§‹ç»ˆè·³è½¬ ; JNZ åˆ†æ”¯ä¸‹çš„ä»£ç æ˜¯æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„æ­»ä»£ç 
JZ real_code_path ; â€” æ­»ä»£ç  â€” ADD EAX, 1234 CALL some_fake_func ; â€”
æ­»ä»£ç ç»“æŸ â€”</p>
<p>real_code_path: ; â€¦</p>
<pre><code>
## # æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)
è¿™æ˜¯ä¸€ç§é«˜çº§ä¸”éå¸¸æœ‰æ•ˆçš„æ··æ·†æŠ€æœ¯ã€‚å®ƒå°†ä¸€ä¸ªå‡½æ•°çš„æ­£å¸¸é€»è¾‘å—æ‰“æ•£ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªä¸­å¤®åˆ†å‘å™¨ï¼ˆDispatcherï¼‰å’Œ `switch-case` ç»“æ„æ¥æ§åˆ¶æ‰§è¡Œæµã€‚åŸå§‹çš„è°ƒç”¨å…³ç³»è¢«éšè—åœ¨ä¸€ä¸ªå·¨å¤§çš„å¾ªç¯ä¸­ï¼Œä½¿å¾—å‡½æ•°é€»è¾‘æéš¾è¢«ç†è§£ã€‚

- --

## å¦‚ä½•è¯†åˆ«èŠ±æŒ‡ä»¤

## # é™æ€åˆ†æç‰¹å¾
åœ¨ IDA Pro æˆ– Ghidra ä¸­è§‚å¯Ÿï¼š

* **æ— æ•ˆè·³è½¬**ï¼š`JMP loc_A` çš„ä¸‹ä¸€æ¡æŒ‡ä»¤å°±æ˜¯ `loc_A`ã€‚

* **è·³è½¬åˆ°æŒ‡ä»¤ä¸­é—´**ï¼š`JMP $+5` è·³è½¬åˆ°ä¸€ä¸ªæ­£å¸¸æŒ‡ä»¤çš„ä¸­é—´ï¼Œç ´ååæ±‡ç¼–ã€‚

* **å¯¹ç§°æ“ä½œ**ï¼šè¿ç»­çš„ `PUSH`/`POP` åŒä¸€ä¸ªå¯„å­˜å™¨ã€‚

* **æ’æˆç«‹/ä¸æˆç«‹çš„æ¡ä»¶**ï¼šåœ¨ `Jcc` æŒ‡ä»¤å‰ï¼Œ`CMP` çš„ä¸¤ä¸ªæ“ä½œæ•°æ˜æ˜¾ç›¸ç­‰æˆ–ä¸ç­‰ã€‚

* **æ— æ„ä¹‰çš„è®¡ç®—**ï¼šè®¡ç®—ç»“æœæ²¡æœ‰è¢«åç»­ä»£ç ä½¿ç”¨ã€‚

* **IDA å›¾å½¢è§†å›¾**ï¼šæ§åˆ¶æµå¹³å¦åŒ–çš„å‡½æ•°ä¼šå‘ˆç°å‡ºä¸€ä¸ªå·¨å¤§çš„ã€èŠ‚ç‚¹ä¼—å¤šçš„ `switch` ç»“æ„ï¼Œæ‰€æœ‰é€»è¾‘å—éƒ½æŒ‡å‘ä¸€ä¸ªä¸­å¿ƒåˆ†å‘å—ã€‚

## # åŠ¨æ€è°ƒè¯•éªŒè¯
æœ€å¯é çš„æ–¹æ³•ã€‚ä½¿ç”¨ `gdb` æˆ– IDA çš„è°ƒè¯•å™¨ï¼š

* åœ¨å¯ç–‘åˆ†æ”¯ä¸‹æ–­ç‚¹ï¼Œå¦‚æœæ–­ç‚¹ä»æœªå‘½ä¸­ï¼Œåˆ™è¯´æ˜è¯¥åˆ†æ”¯æ˜¯æ­»ä»£ç ã€‚

* å•æ­¥æ‰§è¡Œï¼Œè§‚å¯Ÿå¯„å­˜å™¨å’Œå†…å­˜çš„å˜åŒ–ã€‚å¦‚æœä¸€æ®µæŒ‡ä»¤æ‰§è¡Œåï¼Œç›¸å…³çš„çŠ¶æ€æ²¡æœ‰å˜åŒ–ï¼Œåˆ™å¾ˆå¯èƒ½æ˜¯åƒåœ¾ä»£ç ã€‚

- --

## è‡ªåŠ¨åŒ–&quot;å»èŠ±&quot;è„šæœ¬ (IDAPython å®æˆ˜)

å½“èŠ±æŒ‡ä»¤æ•°é‡åºå¤§æ—¶ï¼Œæ‰‹åŠ¨ä¿®å¤æ˜¯ä¸ç°å®çš„ã€‚ç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–å¤„ç†æ˜¯å”¯ä¸€é«˜æ•ˆçš„é€”å¾„ã€‚ä»¥ä¸‹ä»¥ IDAPython ä¸ºä¾‹ã€‚

## # åœºæ™¯ä¸€ï¼šNOP æ‰æ— æ•ˆè·³è½¬
ä¸€ä¸ªå¸¸è§çš„èŠ±æŒ‡ä»¤æ¨¡å¼æ˜¯ `JMP dest`ï¼Œè€Œ `dest` ç´§æ¥ç€ `JMP` æŒ‡ä»¤ã€‚

```assembly
.text:00001234 JMP short loc_1236 ; è·³è½¬æŒ‡ä»¤æœ¬èº«å  2 å­—èŠ‚
.text:00001236 ; ... çœŸå®ä»£ç 
</code></pre>
<p>import idaapi</p>
<p>def patch_junk_jumps(): â€œâ€œâ€ æŸ¥æ‰¾å¹¶å°†å½¢å¼ä¸º
<code>JMP next_instruction</code> çš„è·³è½¬ NOP æ‰ã€‚ â€œâ€œâ€
print(â€œæ‰«æåƒåœ¾è·³è½¬â€¦â€) count = 0 # éå†ä»£ç æ®µ for seg_ea in
idc.get_segm_list(): if idc.get_segm_attr(seg_ea, idc.SEGATTR_TYPE) !=
idc.SEG_CODE: continue</p>
<p>seg_start = idc.get_segm_start(seg_ea) seg_end =
idc.get_segm_end(seg_ea)</p>
<p>for head in idautils.Heads(seg_start, seg_end): # æ£€æŸ¥æ˜¯å¦æ˜¯ JMP æŒ‡ä»¤
if idaapi.is_jmp_insn(head): # è·å–è·³è½¬ç›®æ ‡åœ°å€ target_ea =
idc.get_operand_value(head, 0)</p>
<h1 id="è·å–æŒ‡ä»¤é•¿åº¦">è·å–æŒ‡ä»¤é•¿åº¦</h1>
<p>insn_len = idc.get_item_size(head)</p>
<h1
id="å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€">å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</h1>
<p>if target_ea == (head + insn_len): print(fâ€åœ¨ 0x{head:X} å¤„æ‰¾åˆ°åƒåœ¾
JMPï¼Œç›®æ ‡: 0x{target_ea:X}â€œ) # ç”¨ NOP ä¿®è¡¥ for i in range(insn_len):
idc.patch_byte(head + i, 0x90) count += 1</p>
<p>print(fâ€å®Œæˆã€‚ä¿®è¡¥äº† {count} ä¸ªåƒåœ¾è·³è½¬ã€‚â€œ)</p>
<h1 id="æ‰§è¡Œè„šæœ¬">â€” æ‰§è¡Œè„šæœ¬ â€”</h1>
<h1 id="patch_junk_jumps">patch_junk_jumps()</h1>
<pre><code># ... éå†æŒ‡ä»¤ ...
head = ...

# æ£€æŸ¥æ˜¯å¦æ˜¯ JNE æŒ‡ä»¤ (ä¾‹å¦‚ï¼Œæ“ä½œç  0x75)
if idc.get_byte(head) == 0x75:
# æ£€æŸ¥ JNE ä¹‹å‰çš„æŒ‡ä»¤æ˜¯å¦æ˜¯ CMP
prev_head = idc.prev_head(head)
if idc.print_insn_mnem(prev_head) == &quot;cmp&quot;:
# æ£€æŸ¥ CMP çš„ä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸åŒ
op1 = idc.get_operand_value(prev_head, 0)
op2 = idc.get_operand_value(prev_head, 1)

# è¿™æ˜¯ä¸€ä¸ªç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…çš„æ“ä½œæ•°ç±»å‹æ£€æŸ¥ä¼šæ›´å¤æ‚
# if idc.get_operand_type(prev_head, 0) == o_reg and ...
if op1 == op2: # ä¾‹å¦‚ï¼ŒCMP EAX, EAX
print(f&quot;åœ¨ 0x{head:X} å¤„æ‰¾åˆ°ä¸é€æ˜è°“è¯&quot;)
# å°† JNE æŒ‡ä»¤ NOP æ‰
insn_len = idc.get_item_size(head)
for i in range(insn_len):
idc.patch_byte(head + i, 0x90)
</code></pre>
<ol start="2" type="1">
<li><strong>è¯†åˆ«</strong>ï¼šæ‰¾åˆ°è¯¥æ¨¡å¼çš„é€šç”¨æœºå™¨ç æˆ–æŒ‡ä»¤ç‰¹å¾ã€‚</li>
<li><strong>ç¼–ç </strong>ï¼šç¼–å†™è„šæœ¬ï¼Œç²¾ç¡®åœ°å®šä½è¿™äº›ç‰¹å¾å¹¶è¿›è¡Œä¿®å¤
(Patch)ã€‚</li>
</ol>
<p>è™½ç„¶èŠ±æŒ‡ä»¤çš„å˜ç§å±‚å‡ºä¸ç©·ï¼Œä½†å…¶æœ¬è´¨æ˜¯æœ‰é™çš„ã€‚æŒæ¡äº†è‡ªåŠ¨åŒ–çš„è„šæœ¬å»èŠ±èƒ½åŠ›ï¼Œå°±èƒ½æå¤§åœ°æå‡
SO æ–‡ä»¶é€†å‘åˆ†æçš„æ•ˆç‡ã€‚</p>
<pre><code>


&lt;!-- 01-Recipes/Unpacking/so_string_deobfuscation.md --&gt;

# SO æ–‡ä»¶å­—ç¬¦ä¸²æ··æ·†å¯¹æŠ—æŒ‡å—

åœ¨ Android Native å±‚å®‰å…¨ä¸­ï¼Œå­—ç¬¦ä¸²æ··æ·†æ˜¯ä¸€ç§ç”¨äºéšè—æ•æ„Ÿä¿¡æ¯ã€å¢åŠ é€†å‘åˆ†æéš¾åº¦çš„å¸¸ç”¨æŠ€æœ¯ã€‚å¼€å‘è€…é€šè¿‡å¯¹ SO æ–‡ä»¶ä¸­çš„å…³é”®å­—ç¬¦ä¸²ï¼ˆå¦‚ API URLã€åŠ å¯†å¯†é’¥ã€Shell å‘½ä»¤ã€åŠŸèƒ½å¼€å…³ç­‰ï¼‰è¿›è¡Œç¼–ç æˆ–åŠ å¯†ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ `strings` å‘½ä»¤æˆ– IDA Pro çš„å­—ç¬¦ä¸²çª—å£ï¼‰ç›´æ¥å‘ç°å®ƒä»¬ã€‚

æœ¬æ–‡æ—¨åœ¨ç³»ç»Ÿæ€§åœ°ä»‹ç» SO æ–‡ä»¶ä¸­å¸¸è§çš„å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯ï¼Œå¹¶æä¾›ä¸€å¥—ä»é™æ€åˆ†æåˆ°åŠ¨æ€åˆ†æçš„å®Œæ•´å¯¹æŠ—ç­–ç•¥ã€‚

- --

## ç›®å½•
- [SO æ–‡ä»¶å­—ç¬¦ä¸²æ··æ·†å¯¹æŠ—æŒ‡å—](#so-æ–‡ä»¶å­—ç¬¦ä¸²æ··æ·†å¯¹æŠ—æŒ‡å—)
- [ç›®å½•](#ç›®å½•)
- [å­—ç¬¦ä¸²æ··æ·†çš„æ ¸å¿ƒæ€æƒ³](#å­—ç¬¦ä¸²æ··æ·†çš„æ ¸å¿ƒæ€æƒ³)

- [å¸¸è§çš„æ··æ·†æŠ€æœ¯](#å¸¸è§çš„æ··æ·†æŠ€æœ¯)

- [å¯¹æŠ—ç­–ç•¥ä¸€ï¼šé™æ€åˆ†æ (IDA Pro / Ghidra)](#å¯¹æŠ—ç­–ç•¥ä¸€é™æ€åˆ†æ-ida-pro--ghidra)
- [è¯†åˆ«è§£å¯†/è§£æ··æ·†å‡½æ•°](#è¯†åˆ«è§£å¯†è§£æ··æ·†å‡½æ•°)

- [å®šä½äº¤å‰å¼•ç”¨](#å®šä½äº¤å‰å¼•ç”¨)

- [è‡ªåŠ¨åŒ–è„šæœ¬è§£å¯†](#è‡ªåŠ¨åŒ–è„šæœ¬è§£å¯†)
- [å¯¹æŠ—ç­–ç•¥äºŒï¼šåŠ¨æ€åˆ†æ (Frida)](#å¯¹æŠ—ç­–ç•¥äºŒåŠ¨æ€åˆ†æ-frida)
- [Hook è§£å¯†å‡½æ•°ï¼ˆé¦–é€‰ç­–ç•¥ï¼‰](#hook-è§£å¯†å‡½æ•°é¦–é€‰ç­–ç•¥)

- [å†…å­˜æ¼«æ¸¸ä¸æœç´¢](#å†…å­˜æ¼«æ¸¸ä¸æœç´¢)
- [æ€»ç»“ï¼šæœ€é«˜æ•ˆçš„åˆ†ææµç¨‹](#æ€»ç»“æœ€é«˜æ•ˆçš„åˆ†ææµç¨‹)

- --

### å­—ç¬¦ä¸²æ··æ·†çš„æ ¸å¿ƒæ€æƒ³

å…¶æœ¬è´¨æ˜¯**é¿å…å°†æ˜æ–‡å­—ç¬¦ä¸²ç›´æ¥å­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ `.rodata` æˆ– `.data` æ®µä¸­**ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ç‰¹å®šçš„å‡½æ•°åŠ¨æ€åœ°åœ¨å†…å­˜ä¸­ï¼ˆæ ˆæˆ–å †ï¼‰æ¢å¤å‡ºåŸå§‹çš„å­—ç¬¦ä¸²ã€‚

ä¸€ä¸ªå…¸å‹çš„æµç¨‹å¦‚ä¸‹ï¼š
`åŠ å¯†çš„å­—èŠ‚æ•°ç»„` -&gt; `è§£å¯†/è§£æ··æ·†å‡½æ•°` -&gt; `å†…å­˜ä¸­çš„æ˜æ–‡å­—ç¬¦ä¸²`

æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æˆªè·&quot;å†…å­˜ä¸­çš„æ˜æ–‡å­—ç¬¦ä¸²&quot;ã€‚

- --

### å¸¸è§çš„æ··æ·†æŠ€æœ¯

1. **ç®€å•ç¼–ç **:
* **Base64**: å°† Base64 ç¼–ç åçš„å­—ç¬¦ä¸²å­˜å‚¨ï¼Œä½¿ç”¨æ—¶å†è§£ç ã€‚

* **ROT13/Caesar Cipher**: ç®€å•çš„å­—ç¬¦ä½ç§»ã€‚
2. **æŒ‰ä½è¿ç®—**:
* **XOR (å¼‚æˆ–)**: å°†åŸå§‹å­—ç¬¦ä¸²ä¸ä¸€ä¸ªå›ºå®šçš„ï¼ˆæˆ–åŠ¨æ€è®¡ç®—çš„ï¼‰å¯†é’¥è¿›è¡ŒæŒ‰å­—èŠ‚å¼‚æˆ–ã€‚è¿™æ˜¯æœ€å¸¸è§ã€æœ€é«˜æ•ˆçš„ä¸€ç§æ–¹å¼ã€‚
3. **æ ˆä¸Šæ„å»º**:
* ä¸åœ¨ä»»ä½•æ®µä¸­å­˜å‚¨å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åœ¨å‡½æ•°å¼€å§‹æ—¶ï¼Œé€šè¿‡ä¸€ç³»åˆ— `mov` æŒ‡ä»¤é€å­—èŠ‚åœ°å°†å­—ç¬¦ä¸² push åˆ°æ ˆä¸Šã€‚
    ```c++
void get_secret_string() {
char secret[12];
secret[0] = &#39;s&#39;;
secret[1] = &#39;e&#39;;
// ...
secret[10] = &#39;t&#39;;
secret[11] = &#39;\0&#39;;
// use secret
}
</code></pre>
<ul>
<li>ä½¿ç”¨å¦‚ AES, RC4, DES
ç­‰æ ‡å‡†å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å¯†é’¥æœ¬èº«å¯èƒ½è¢«å†æ¬¡æ··æ·†æˆ–ä»å…¶ä»–åœ°æ–¹åŠ¨æ€è·å–ã€‚</li>
</ul>
<hr />
<h3 id="å¯¹æŠ—ç­–ç•¥ä¸€é™æ€åˆ†æ-ida-pro-ghidra">å¯¹æŠ—ç­–ç•¥ä¸€ï¼šé™æ€åˆ†æ (IDA Pro
/ Ghidra)</h3>
<p>é™æ€åˆ†æçš„ç›®æ ‡æ˜¯<strong>ç†è§£è§£å¯†é€»è¾‘å¹¶è‡ªåŠ¨åŒ–åœ°åº”ç”¨å®ƒ</strong>ã€‚</p>
<h4 id="è¯†åˆ«è§£å¯†è§£æ··æ·†å‡½æ•°">è¯†åˆ«è§£å¯†/è§£æ··æ·†å‡½æ•°</h4>
<ul>
<li><p><strong>ç‰¹å¾</strong>:
è§£å¯†å‡½æ•°é€šå¸¸å…·æœ‰ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾ï¼š</p></li>
<li><p>æ¥å—ä¸€ä¸ªæŒ‡å‘å­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆå’Œä¸€ä¸ªé•¿åº¦ä½œä¸ºå‚æ•°ã€‚</p></li>
<li><p>å‡½æ•°å†…éƒ¨åŒ…å«ä¸€ä¸ªå¾ªç¯ç»“æ„ï¼ˆ<code>for</code> /
<code>while</code>ï¼‰ã€‚</p></li>
<li><p>å¾ªç¯å†…éƒ¨æœ‰æŒ‰ä½æ“ä½œï¼Œç‰¹åˆ«æ˜¯ <code>XOR</code> (å¼‚æˆ–)
æŒ‡ä»¤ã€‚</p></li>
<li><p>å‡½æ•°çš„äº¤å‰å¼•ç”¨ï¼ˆXrefsï¼‰éå¸¸å¤šï¼Œä¸”è°ƒç”¨çš„åœ°æ–¹éƒ½ä¼´éšç€ä¸€ä¸ªæ•°æ®å—çš„åœ°å€ã€‚</p></li>
<li><p><strong>æ–¹æ³•</strong>: åœ¨ IDA Pro æˆ– Ghidra
ä¸­ï¼Œé€šè¿‡æœç´¢è¿™äº›ä»£ç æ¨¡å¼ï¼Œé€šå¸¸èƒ½å¾ˆå¿«å®šä½åˆ°æ ¸å¿ƒçš„è§£å¯†å‡½æ•°ã€‚</p></li>
</ul>
<h4 id="å®šä½äº¤å‰å¼•ç”¨">å®šä½äº¤å‰å¼•ç”¨</h4>
<p>ä¸€æ—¦ä½ è¯†åˆ«å‡ºäº†è§£å¯†å‡½æ•°ï¼ˆä¾‹å¦‚
<code>decrypt_string</code>ï¼‰ï¼Œç«‹å³æŸ¥çœ‹å®ƒçš„æ‰€æœ‰äº¤å‰å¼•ç”¨ã€‚æ¯ä¸€ä¸ªè°ƒç”¨
<code>decrypt_string</code>
çš„åœ°æ–¹ï¼Œéƒ½æ˜¯ä¸€ä¸ªåŠ å¯†å­—ç¬¦ä¸²è¢«ä½¿ç”¨çš„åœ°æ–¹ã€‚ä¼ é€’ç»™è¯¥å‡½æ•°çš„å‚æ•°ï¼Œå°±æ˜¯åŠ å¯†çš„æ•°æ®ã€‚</p>
<h4 id="è‡ªåŠ¨åŒ–è„šæœ¬è§£å¯†">è‡ªåŠ¨åŒ–è„šæœ¬è§£å¯†</h4>
<p>è¿™æ˜¯é™æ€åˆ†æçš„ç²¾é«“æ‰€åœ¨ã€‚ 1. <strong>åˆ†æç®—æ³•</strong>:
ä»”ç»†é˜…è¯»è§£å¯†å‡½æ•°çš„æ±‡ç¼–æˆ–åç¼–è¯‘ä»£ç ï¼Œç”¨ä¸€ç§é«˜çº§è¯­è¨€ï¼ˆå¦‚
Pythonï¼‰é‡æ–°å®ç°å…¶é€»è¾‘ã€‚ ```python # ç¤ºä¾‹: Python å®ç°çš„ç®€å• XOR
è§£å¯†ç®—æ³• def decrypt_xor(data, key): decrypted = bytearray() for i in
range(len(data)): decrypted.append(data<a href="#i">i</a> ^ key[i %
len(key)]) return decrypted.decode(â€˜utf-8â€™)</p>
<pre><code>
* **è„šæœ¬é€»è¾‘**:
1. è·å–è§£å¯†å‡½æ•°çš„åœ°å€ã€‚
2. éå†è¯¥å‡½æ•°çš„æ‰€æœ‰äº¤å‰å¼•ç”¨ã€‚
3. åœ¨æ¯ä¸ªäº¤å‰å¼•ç”¨çš„åœ°æ–¹ï¼Œè§£æå…¶å‚æ•°ï¼Œæå–å‡ºåŠ å¯†æ•°æ®å—çš„åœ°å€å’Œé•¿åº¦ã€‚
4. è¯»å–åŠ å¯†æ•°æ®ã€‚
5. è°ƒç”¨æ­¥éª¤ 1 ä¸­å®ç°çš„ Python è§£å¯†å‡½æ•°ã€‚
6. **å°†è§£å¯†åçš„æ˜æ–‡å­—ç¬¦ä¸²ï¼Œä½œä¸ºæ³¨é‡Šï¼Œæ·»åŠ åˆ°äº¤å‰å¼•ç”¨çš„ä»£ç è¡Œæ—è¾¹**ã€‚

* **æ•ˆæœ**: è¿è¡Œè„šæœ¬åï¼ŒIDA/Ghidra ä¸­çš„ä»£ç å°†å˜å¾—éå¸¸æ˜“è¯»ï¼Œæ‰€æœ‰åŠ å¯†å­—ç¬¦ä¸²éƒ½ä»¥æ³¨é‡Šçš„å½¢å¼è¢«&quot;è¿˜åŸ&quot;äº†ã€‚

- --

### å¯¹æŠ—ç­–ç•¥äºŒï¼šåŠ¨æ€åˆ†æ (Frida)
åŠ¨æ€åˆ†æçš„æ ¸å¿ƒæ€æƒ³æ˜¯**ä¸å…³å¿ƒè§£å¯†è¿‡ç¨‹ï¼Œåªå…³å¿ƒè§£å¯†ç»“æœ**ã€‚å®ƒé€šå¸¸æ›´å¿«é€Ÿã€æ›´ç›´æ¥ã€‚

#### Hook è§£å¯†å‡½æ•°ï¼ˆé¦–é€‰ç­–ç•¥ï¼‰
è¿™æ˜¯å¯¹æŠ—å­—ç¬¦ä¸²æ··æ·†**æœ€ç®€å•ã€æœ€é«˜æ•ˆ**çš„æ–¹æ³•ã€‚
1. **å®šä½å‡½æ•°**: ä½¿ç”¨é™æ€åˆ†æå·¥å…·ï¼ˆIDA/Ghidraï¼‰æ‰¾åˆ°è§£å¯†å‡½æ•°çš„åœ°å€ã€‚
2. **ç¼–å†™ Frida è„šæœ¬**:
* **Hook `onEnter`**: åœ¨è¿›å…¥è§£å¯†å‡½æ•°æ—¶ï¼Œæ‰“å°å…¶è¾“å…¥å‚æ•°ï¼ˆåŠ å¯†çš„å­—èŠ‚æ•°ç»„ï¼‰ã€‚

* **Hook `onLeave` (æ›´å¸¸ç”¨)**: åœ¨å‡½æ•°è¿”å›æ—¶ï¼Œç›´æ¥è¯»å–å…¶è¿”å›å€¼ã€‚å› ä¸ºè¿”å›å€¼é€šå¸¸å°±æ˜¯æŒ‡å‘å†…å­˜ä¸­æ˜æ–‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚
    ```javascript
const decryptFuncPtr = Module.findExportByName(&quot;libnative-lib.so&quot;, &quot;Java_com_example_MainActivity_decryptString&quot;);
// æˆ–è€…ç›´æ¥ä½¿ç”¨åœ°å€: const decryptFuncPtr = Module.getBaseAddress(&quot;libnative-lib.so&quot;).add(0x1234);

Interceptor.attach(decryptFuncPtr, {
onEnter: function(args) {
console.log(&quot;è¿›å…¥ decryptStringï¼Œæ•°æ®: &quot; + args[0].readCString());
},
onLeave: function(retval) {
// retval æ˜¯æŒ‡å‘è§£å¯†åå­—ç¬¦ä¸²çš„æŒ‡é’ˆ
var decryptedString = retval.readCString();
console.log(&quot;è§£å¯†åçš„å­—ç¬¦ä¸² -&gt; &quot; + decryptedString);
// å¯ä»¥è¿›ä¸€æ­¥å°†ç»“æœå†™å…¥æ–‡ä»¶
// send({ decrypted: decryptedString });
}
});
</code></pre>
<h4 id="å†…å­˜æ¼«æ¸¸ä¸æœç´¢">å†…å­˜æ¼«æ¸¸ä¸æœç´¢</h4>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒApp
å¯èƒ½ä¼šåœ¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§è§£å¯†å¤§é‡å­—ç¬¦ä¸²ï¼Œå¹¶å°†å®ƒä»¬å­˜æ”¾åœ¨ä¸€ä¸ªç‰¹å®šçš„å†…å­˜åŒºåŸŸã€‚</p>
<ul>
<li><strong>æ–¹æ³•</strong>:</li>
</ul>
<ol type="1">
<li>è®© App è¿è¡Œä¸€æ®µæ—¶é—´ã€‚</li>
<li>ä½¿ç”¨ Frida çš„ <code>Memory.scan</code> API
åœ¨è¿›ç¨‹çš„æ•´ä¸ªå†…å­˜ç©ºé—´ä¸­æœç´¢ä½ æ„Ÿå…´è¶£çš„å­—ç¬¦ä¸²æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œ<code>https://</code>ï¼‰ã€‚
```javascript
Memory.scan(Process.findModuleByName(â€œlibnative-lib.soâ€).base,
Process.findModuleByName(â€œlibnative-lib.soâ€).size, â€œ68 74 74 70 73 3a 2f
2fâ€, { // åå…­è¿›åˆ¶è¡¨ç¤º â€œhttps://â€ onMatch: function(address, size) {
console.log(â€œåœ¨ä»¥ä¸‹åœ°å€æ‰¾åˆ°æ¨¡å¼:â€ + address); //
å¯èƒ½éœ€è¦å›é€€ä¸€äº›å­—èŠ‚æ¥æ‰¾åˆ°å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®
console.log(address.readCString()); }, onComplete: function() {
console.log(â€œå†…å­˜æ‰«æå®Œæˆã€‚â€); } });</li>
</ol>
<pre><code>
### æ€»ç»“ï¼šæœ€é«˜æ•ˆçš„åˆ†ææµç¨‹
å¯¹äºå­—ç¬¦ä¸²æ··æ·†ï¼Œæœ€é«˜æ•ˆçš„å·¥ä½œæµç¨‹æ˜¯ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æï¼š
1. **é™æ€åˆ†æå®šä½**: ä½¿ç”¨ IDA Pro æˆ– Ghidra å¿«é€Ÿæµè§ˆ SO æ–‡ä»¶ï¼Œè¯†åˆ«å‡ºå¯èƒ½çš„è§£å¯†/è§£æ··æ·†å‡½æ•°ã€‚
2. **åŠ¨æ€åˆ†æéªŒè¯/è·å–**: ä½¿ç”¨ Frida å¯¹ä¸Šä¸€æ­¥å®šä½åˆ°çš„å‡½æ•°åœ°å€è¿›è¡Œ Hookï¼Œè¿è¡Œ App å¹¶è§‚å¯Ÿ `onLeave` çš„è¿”å›å€¼ï¼Œå¿«é€Ÿè·å–æ‰€æœ‰è§£å¯†åçš„å­—ç¬¦ä¸²ã€‚
3. **(å¯é€‰) é™æ€åˆ†æè„šæœ¬åŒ–**: å¦‚æœéœ€è¦å¯¹å¤§é‡å­—ç¬¦ä¸²è¿›è¡Œç¦»çº¿åˆ†ææˆ–å¸Œæœ›å¾—åˆ°ä¸€ä¸ªå¸¦æ³¨é‡Šçš„ã€æ›´æ˜“è¯»çš„åæ±‡ç¼–æ–‡ä»¶ï¼Œå†å›åˆ°é™æ€åˆ†æå·¥å…·ä¸­ï¼Œæ ¹æ®å·²çŸ¥çš„ç®—æ³•ç¼–å†™è‡ªåŠ¨åŒ–è§£å¯†è„šæœ¬ã€‚ 


&lt;!-- 01-Recipes/Unpacking/un-packing.md --&gt;

# Recipe: è„±å£³åˆ†æåŠ å›ºçš„ android åº”ç”¨

## é—®é¢˜åœºæ™¯

ä½ åœ¨é€†å‘åˆ†æä¸€ä¸ª App æ—¶é‡åˆ°äº†ä»¥ä¸‹æƒ…å†µï¼š

- âŒ **Jadx æ‰“å¼€ APK åä»£ç å®Œå…¨ä¸å¯è¯»**ï¼Œå…¨æ˜¯æ··æ·†çš„ç±»åæˆ–ç©ºæ–¹æ³•
- âŒ **classes.dex æ–‡ä»¶å¼‚å¸¸å°** (å‡ å KB)ï¼Œä¸ç¬¦åˆåº”ç”¨å®é™…è§„æ¨¡
- âŒ **åº”ç”¨å¯åŠ¨æ—¶æ£€æµ‹åˆ° Frida å¹¶é—ªé€€**ï¼Œå¸¸è§„ Hook æ— æ³•ç”Ÿæ•ˆ
- âŒ **AndroidManifest.xml ä¸­çš„ Application å…¥å£è¢«æ›¿æ¢**æˆå¯ç–‘çš„å£³ç±»å
- âŒ **`assets` æˆ– `lib` ç›®å½•ä¸­å­˜åœ¨åŠ å¯†æ–‡ä»¶**ï¼Œå¦‚ `.dat`ã€`.bin` æˆ–å¥‡æ€ªå‘½åçš„ `.so` æ–‡ä»¶

è¿™äº›éƒ½æ˜¯åº”ç”¨è¢«**åŠ å›º(åŠ å£³)**çš„å…¸å‹ç‰¹å¾ã€‚åŠ å›ºæŠ€æœ¯é€šè¿‡åŠ å¯† DEX æ–‡ä»¶ã€æŠ½å–æ–¹æ³•ä½“ã€è™šæ‹ŸåŒ–æŒ‡ä»¤ç­‰æ‰‹æ®µï¼Œè®©é™æ€åˆ†æå·¥å…·æ— æ³•ç›´æ¥è¯»å–åŸå§‹ä»£ç ã€‚æœ¬é…æ–¹å°†æ•™ä½ å¦‚ä½•è¯†åˆ«ã€è„±å£³å¹¶æ¢å¤è¢«åŠ å›ºçš„åº”ç”¨ã€‚

- --

## å·¥å…·æ¸…å•

## # å¿…éœ€å·¥å…·

- [x] **Frida** - åŠ¨æ€æ’æ¡©æ¡†æ¶
- [x] **frida-dexdump** - è‡ªåŠ¨åŒ– DEX dumper ([GitHub](https://github.com/hluwa/frida-dexdump))
- [x] **ADB** - è®¾å¤‡é€šä¿¡å·¥å…·
- [x] **Root æƒé™è®¾å¤‡** æˆ–æ¨¡æ‹Ÿå™¨ (å¿…é¡»)

## # å¯é€‰å·¥å…·

- â˜ **FUPK3** - é’ˆå¯¹ç‰¹å®šå£³çš„ä¸“ç”¨è„±å£³å·¥å…·
- â˜ **Youpk** - è¾ƒæ–°çš„è„±å£³å·¥å…·
- â˜ **PKid/ApkTool-Plus** - åŠ å›ºç±»å‹è¯†åˆ«å·¥å…·
- â˜ **MT ç®¡ç†å™¨** - Android ç«¯ APK åˆ†æå·¥å…·
- â˜ **IDA Pro/Ghidra** - Native å±‚åˆ†æ (SO åŠ å›ºæ—¶éœ€è¦)

- --

## å‰ç½®æ¡ä»¶

åœ¨å¼€å§‹å‰è¯·ç¡®è®¤ï¼š

âœ… **è®¾å¤‡å·² Root** å¹¶å®‰è£… Frida Server
âœ… **äº†è§£ DEX æ–‡ä»¶åŸºæœ¬ç»“æ„** (è‡³å°‘çŸ¥é“ magic number `0x6465780A`)
âœ… **åº”ç”¨å·²å®‰è£…**å¹¶èƒ½æ­£å¸¸å¯åŠ¨ (å³ä½¿æœ‰åè°ƒè¯•)
âœ… **ç£ç›˜ç©ºé—´å……è¶³** (è„±å£³å¯èƒ½äº§ç”Ÿå¤§é‡æ–‡ä»¶)

- --

## è§£å†³æ–¹æ¡ˆ

## # æ ¸å¿ƒåŸç†

&gt; **&quot;ä»£ç è¿è¡Œå¿…è§£å¯†&quot;**
&gt;
&gt; æ— è®ºåŠ å›ºæŠ€æœ¯å¤šä¹ˆå¤æ‚ï¼ŒåŠ å¯†åçš„ä»£ç æœ€ç»ˆéƒ½å¿…é¡»åœ¨å†…å­˜ä¸­æ¢å¤æˆå¯æ‰§è¡Œçš„ DEX æ ¼å¼ï¼Œæ‰èƒ½è¢« ART æ‰§è¡Œã€‚è„±å£³çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**åœ¨ä»£ç è¢«è§£å¯†åã€æ‰§è¡Œå‰çš„é‚£ä¸€åˆ»ï¼Œä»å†…å­˜ä¸­å°†å…¶ dump å‡ºæ¥ã€‚**

- --

## # ç¬¬ 1 æ­¥: è¯†åˆ«åŠ å›ºç±»å‹ ( 5-10 åˆ†é’Ÿ)

ä¸åŒä»£é™…çš„åŠ å›ºæŠ€æœ¯éœ€è¦ä¸åŒçš„è„±å£³ç­–ç•¥ï¼Œå…ˆè¯†åˆ«ç›®æ ‡åº”ç”¨ä½¿ç”¨äº†ä»€ä¹ˆåŠ å›ºæŠ€æœ¯ã€‚

### æ–¹æ³• A: ä½¿ç”¨å·¥å…·å¿«é€Ÿè¯†åˆ«

```bash
# ä½¿ç”¨ PKid (ApkTool-Plus) æ£€æµ‹
# ä¸‹è½½: https://github.com/rover12421/ApkToolPlus
java -jar ApkToolPlus.jar -pkid target.apk

# è¾“å‡ºç¤ºä¾‹:
# [+] æ£€æµ‹åˆ°åŠ å›ºå‚å•†: è…¾è®¯ä¹å›º (Tencent Legu)
# [+] åŠ å›ºç±»å‹: ç¬¬äºŒä»£å£³ (æ–¹æ³•æŠ½å–)
</code></pre>
<h1 id="å¯ç–‘ç±»å">å¯ç–‘ç±»å:</h1>
<h1
id="com.tencent.stubshell.txappentry-è…¾è®¯ä¹å›º">com.tencent.StubShell.TxAppEntry
(è…¾è®¯ä¹å›º)</h1>
<h1
id="com.secneo.apkwrapper.applicationwrapper-æ¢†æ¢†-security">com.secneo.apkwrapper.ApplicationWrapper
(æ¢†æ¢† Security)</h1>
<h1
id="com.baidu.protect.stubapplication-ç™¾åº¦åŠ å›º">com.baidu.protect.StubApplication
(ç™¾åº¦åŠ å›º)</h1>
<h1 id="æ£€æŸ¥-dex-æ–‡ä»¶å¤§å°">2. æ£€æŸ¥ DEX æ–‡ä»¶å¤§å°</h1>
<p>unzip -l target.apk | grep classes.dex</p>
<h1 id="å¦‚æœ-classes.dex-100kb-ä¸”-app-åŠŸèƒ½å¤æ‚å¾ˆå¯èƒ½åŠ å£³">å¦‚æœ
classes.dex &lt; 100KB ä¸” App åŠŸèƒ½å¤æ‚ï¼Œå¾ˆå¯èƒ½åŠ å£³</h1>
<h1 id="æ£€æŸ¥å¯ç–‘æ–‡ä»¶">3. æ£€æŸ¥å¯ç–‘æ–‡ä»¶</h1>
<p>unzip -l target.apk | grep -E â€œ.dat|.bin|ijm_lib|secdataâ€</p>
<h1 id="è¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«åŠ å¯†çš„åŸå§‹-dex">è¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«åŠ å¯†çš„åŸå§‹
DEX</h1>
<h1 id="æ£€æŸ¥-lib-ç›®å½•ä¸­çš„å¯ç–‘-so">4. æ£€æŸ¥ lib ç›®å½•ä¸­çš„å¯ç–‘ SO</h1>
<p>unzip -l target.apk | grep â€œlib/.*.soâ€ | grep -E
â€œ(exec|vmp|protect)â€</p>
<pre><code>| **ç¬¬ä¸€ä»£** | 2010-2015 | æ•´ä½“ DEX åŠ å¯† | æ—©æœŸçˆ±åŠ å¯†ã€360 | Application å…¥å£è¢«æ›¿æ¢ | (ç®€å•) |
| **ç¬¬äºŒä»£** | 2015-2018 | æ–¹æ³•æŠ½å– (Stolen Code) | è…¾è®¯ä¹å›ºã€é˜¿é‡Œèšå®‰å…¨ | å¤§é‡ç©ºæ–¹æ³•ã€libexec.so | (ä¸­ç­‰) |
| **ç¬¬ä¸‰ä»£** | 2018-2021 | æŒ‡ä»¤è™šæ‹ŸåŒ– (VMP) | æ¢†æ¢†VMPã€é¡¶è±¡ç§‘æŠ€ | è‡ªå®šä¹‰VMå¼•æ“ã€ç§æœ‰æŒ‡ä»¤ | (å›°éš¾) |
| **ç¬¬å››ä»£** | 2021-è‡³ä»Š | äº‘ç«¯+å¤šé‡ä¿æŠ¤ | è…¾è®¯å¾¡å®‰å…¨ã€é˜¿é‡Œäº‘ | äº‘ç«¯ä¸‹å‘ä»£ç ã€å¤šå±‚åŠ å£³ | (æéš¾) |

- --

## # ç¬¬ 2 æ­¥: é€‰æ‹©è„±å£³ç­–ç•¥ ( 5 åˆ†é’Ÿ)

æ ¹æ®è¯†åˆ«å‡ºçš„åŠ å›ºç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„è„±å£³æ–¹æ³•ï¼š

### ç¬¬ä¸€ä»£å£³ (æ•´ä½“åŠ å¯†)
* *ç­–ç•¥**: Hook ClassLoaderï¼Œåœ¨ DEX åŠ è½½æ—¶ dump
* *æ¨èå·¥å…·**: æ‰‹å†™ Frida è„šæœ¬æˆ– frida-dexdump
* *æˆåŠŸç‡**: 95%+

### ç¬¬äºŒä»£å£³ (æ–¹æ³•æŠ½å–)
* *ç­–ç•¥**: Hook ArtMethod çš„ invokeï¼Œåœ¨æ–¹æ³•é¦–æ¬¡è°ƒç”¨æ—¶ dump CodeItem
* *æ¨èå·¥å…·**: FART æŠ€æœ¯ (Frida ART Hook) + frida-dexdump
* *æˆåŠŸç‡**: 80%+ (å–å†³äºä»£ç è¦†ç›–ç‡)

### ç¬¬ä¸‰ä»£å£³ (è™šæ‹ŸåŒ–)
* *ç­–ç•¥**: Hook è™šæ‹Ÿæœºå¼•æ“ï¼Œè·å–æŒ‡ä»¤æµ + æ˜ å°„è¡¨é€†å‘
* *æ¨èå·¥å…·**: IDA Pro + è‡ªå®šä¹‰è„šæœ¬
* *æˆåŠŸç‡**: 50% (éœ€è¦æ·±å…¥åˆ†æè™šæ‹Ÿæœºå®ç°)

### ç¬¬å››ä»£å£³ (äº‘ç«¯)
* *ç­–ç•¥**: ç½‘ç»œæŠ“åŒ… + å†…å­˜æ‰«æ + å¤šå±‚ dump
* *æ¨èå·¥å…·**: mitmproxy + frida-dexdump + è‡ªå®šä¹‰è„šæœ¬
* *æˆåŠŸç‡**: 30% (éƒ¨åˆ†é€»è¾‘å¯èƒ½æ— æ³•è·å–)

- --

## # ç¬¬ 3 æ­¥: æ‰§è¡Œè„±å£³ ( 10-60 åˆ†é’Ÿ)

ä»¥ä¸‹æä¾›é’ˆå¯¹ä¸åŒä»£é™…çš„è„±å£³è„šæœ¬ã€‚

### æ–¹æ³• A: ä½¿ç”¨ frida-dexdump (é€šç”¨ï¼Œæ¨èé¦–é€‰)

```bash
# 1. å¯åŠ¨ Frida Server
adb push frida-server /data/local/tmp/
adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;
adb shell &quot;/data/local/tmp/frida-server &amp;&quot;

# 2. å®‰è£… frida-dexdump
pip3 install frida-dexdump

# 3. è¿è¡Œè„±å£³ (Spawn æ¨¡å¼ï¼Œåœ¨ App å¯åŠ¨æ—¶æ‹¦æˆª)
python3 -m frida_dexdump -U -f com.target.app -o ./output

# è¾“å‡ºç¤ºä¾‹:
# [+] Hooking ClassLoader...
# [+] Dumped DEX: /output/com.target.app_1234567890.dex (5.2 MB)
# [+] Dumped DEX: /output/com.target.app_0987654321.dex (1.8 MB)
# [+] Total: 2 DEX files dumped

# 4. å°† DEX æ–‡ä»¶æ‹‰å–åˆ°æœ¬åœ°
adb pull /data/data/com.target.app/files/*.dex ./dumped_dex/
</code></pre>
<ul>
<li><code>-o ./output</code>: è¾“å‡ºç›®å½•</li>
</ul>
<hr />
<h3 id="æ–¹æ³•-b-æ‰‹å†™-hook-è„šæœ¬-ç¬¬ä¸€ä»£å£³"># æ–¹æ³• B: æ‰‹å†™ Hook è„šæœ¬
(ç¬¬ä¸€ä»£å£³)</h3>
<p>é€‚ç”¨äºç®€å•çš„æ•´ä½“åŠ å¯†å£³ã€‚</p>
<div class="sourceCode" id="cb380"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co">// unpacker_gen1.js - ç¬¬ä¸€ä»£å£³é€šç”¨è„šæœ¬</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span> () {</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] å¼€å§‹ Hook ClassLoader...&quot;</span>)<span class="op">;</span></span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a><span class="co">// æ‹¦æˆª 1: DexClassLoader (æœ€å¸¸è§)</span></span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DexClassLoader <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;dalvik.system.DexClassLoader&quot;</span>)<span class="op">;</span></span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a>DexClassLoader<span class="op">.</span><span class="at">$init</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (</span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a>dexPath<span class="op">,</span></span>
<span id="cb380-10"><a href="#cb380-10" aria-hidden="true" tabindex="-1"></a>optimizedDirectory<span class="op">,</span></span>
<span id="cb380-11"><a href="#cb380-11" aria-hidden="true" tabindex="-1"></a>librarySearchPath<span class="op">,</span></span>
<span id="cb380-12"><a href="#cb380-12" aria-hidden="true" tabindex="-1"></a>parent</span>
<span id="cb380-13"><a href="#cb380-13" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb380-14"><a href="#cb380-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] DexClassLoader åŠ è½½ DEX:&quot;</span>)<span class="op">;</span></span>
<span id="cb380-15"><a href="#cb380-15" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; è·¯å¾„: &quot;</span> <span class="op">+</span> dexPath)<span class="op">;</span></span>
<span id="cb380-16"><a href="#cb380-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-17"><a href="#cb380-17" aria-hidden="true" tabindex="-1"></a><span class="co">// å°è¯•å¤åˆ¶ DEX æ–‡ä»¶</span></span>
<span id="cb380-18"><a href="#cb380-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (dexPath <span class="op">&amp;&amp;</span> dexPath<span class="op">.</span><span class="fu">indexOf</span>(<span class="st">&quot;/data/data/&quot;</span>) <span class="op">!==</span> <span class="op">-</span><span class="dv">1</span>) {</span>
<span id="cb380-19"><a href="#cb380-19" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb380-20"><a href="#cb380-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="bu">File</span> <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.File&quot;</span>)<span class="op">;</span></span>
<span id="cb380-21"><a href="#cb380-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> FileInputStream <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.FileInputStream&quot;</span>)<span class="op">;</span></span>
<span id="cb380-22"><a href="#cb380-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> FileOutputStream <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.FileOutputStream&quot;</span>)<span class="op">;</span></span>
<span id="cb380-23"><a href="#cb380-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-24"><a href="#cb380-24" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> srcFile <span class="op">=</span> <span class="bu">File</span><span class="op">.</span><span class="fu">$new</span>(dexPath)<span class="op">;</span></span>
<span id="cb380-25"><a href="#cb380-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (srcFile<span class="op">.</span><span class="fu">exists</span>()) {</span>
<span id="cb380-26"><a href="#cb380-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timestamp <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb380-27"><a href="#cb380-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dstPath <span class="op">=</span></span>
<span id="cb380-28"><a href="#cb380-28" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;/data/data/com.target.app/dumped_&quot;</span> <span class="op">+</span> timestamp <span class="op">+</span> <span class="st">&quot;.dex&quot;</span><span class="op">;</span></span>
<span id="cb380-29"><a href="#cb380-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dstFile <span class="op">=</span> <span class="bu">File</span><span class="op">.</span><span class="fu">$new</span>(dstPath)<span class="op">;</span></span>
<span id="cb380-30"><a href="#cb380-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-31"><a href="#cb380-31" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fis <span class="op">=</span> FileInputStream<span class="op">.</span><span class="fu">$new</span>(srcFile)<span class="op">;</span></span>
<span id="cb380-32"><a href="#cb380-32" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fos <span class="op">=</span> FileOutputStream<span class="op">.</span><span class="fu">$new</span>(dstFile)<span class="op">;</span></span>
<span id="cb380-33"><a href="#cb380-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-34"><a href="#cb380-34" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buffer <span class="op">=</span> Java<span class="op">.</span><span class="fu">array</span>(<span class="st">&quot;byte&quot;</span><span class="op">,</span> [<span class="dv">1024</span>])<span class="op">;</span></span>
<span id="cb380-35"><a href="#cb380-35" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> len<span class="op">;</span></span>
<span id="cb380-36"><a href="#cb380-36" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> ((len <span class="op">=</span> fis<span class="op">.</span><span class="fu">read</span>(buffer)) <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb380-37"><a href="#cb380-37" aria-hidden="true" tabindex="-1"></a>fos<span class="op">.</span><span class="fu">write</span>(buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> len)<span class="op">;</span></span>
<span id="cb380-38"><a href="#cb380-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-39"><a href="#cb380-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-40"><a href="#cb380-40" aria-hidden="true" tabindex="-1"></a>fis<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb380-41"><a href="#cb380-41" aria-hidden="true" tabindex="-1"></a>fos<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb380-42"><a href="#cb380-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-43"><a href="#cb380-43" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [å·²å¯¼å‡º] &quot;</span> <span class="op">+</span> dstPath)<span class="op">;</span></span>
<span id="cb380-44"><a href="#cb380-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-45"><a href="#cb380-45" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb380-46"><a href="#cb380-46" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] å¤åˆ¶å¤±è´¥: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb380-47"><a href="#cb380-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-48"><a href="#cb380-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-49"><a href="#cb380-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-50"><a href="#cb380-50" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$init</span>(dexPath<span class="op">,</span> optimizedDirectory<span class="op">,</span> librarySearchPath<span class="op">,</span> parent)<span class="op">;</span></span>
<span id="cb380-51"><a href="#cb380-51" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb380-52"><a href="#cb380-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-53"><a href="#cb380-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook 2: InMemoryDexClassLoader (å†…å­˜åŠ è½½)</span></span>
<span id="cb380-54"><a href="#cb380-54" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb380-55"><a href="#cb380-55" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> InMemoryDexClassLoader <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb380-56"><a href="#cb380-56" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;dalvik.system.InMemoryDexClassLoader&quot;</span></span>
<span id="cb380-57"><a href="#cb380-57" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb380-58"><a href="#cb380-58" aria-hidden="true" tabindex="-1"></a>InMemoryDexClassLoader<span class="op">.</span><span class="at">$init</span><span class="op">.</span><span class="fu">overload</span>(</span>
<span id="cb380-59"><a href="#cb380-59" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.nio.ByteBuffer&quot;</span><span class="op">,</span></span>
<span id="cb380-60"><a href="#cb380-60" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;java.lang.ClassLoader&quot;</span></span>
<span id="cb380-61"><a href="#cb380-61" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span> (byteBuffer<span class="op">,</span> classLoader) {</span>
<span id="cb380-62"><a href="#cb380-62" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] InMemoryDexClassLoader åŠ è½½å†…å­˜ DEX&quot;</span>)<span class="op">;</span></span>
<span id="cb380-63"><a href="#cb380-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-64"><a href="#cb380-64" aria-hidden="true" tabindex="-1"></a><span class="co">// ä» ByteBuffer æå– DEX</span></span>
<span id="cb380-65"><a href="#cb380-65" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb380-66"><a href="#cb380-66" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> remaining <span class="op">=</span> byteBuffer<span class="op">.</span><span class="fu">remaining</span>()<span class="op">;</span></span>
<span id="cb380-67"><a href="#cb380-67" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot; DEX å¤§å°: &quot;</span> <span class="op">+</span> remaining <span class="op">+</span> <span class="st">&quot; bytes&quot;</span>)<span class="op">;</span></span>
<span id="cb380-68"><a href="#cb380-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-69"><a href="#cb380-69" aria-hidden="true" tabindex="-1"></a><span class="co">// è·å–å­—èŠ‚æ•°ç»„</span></span>
<span id="cb380-70"><a href="#cb380-70" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bytes <span class="op">=</span> Java<span class="op">.</span><span class="fu">array</span>(<span class="st">&quot;byte&quot;</span><span class="op">,</span> [remaining])<span class="op">;</span></span>
<span id="cb380-71"><a href="#cb380-71" aria-hidden="true" tabindex="-1"></a>byteBuffer<span class="op">.</span><span class="fu">get</span>(bytes)<span class="op">;</span></span>
<span id="cb380-72"><a href="#cb380-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-73"><a href="#cb380-73" aria-hidden="true" tabindex="-1"></a><span class="co">// å†™å…¥æ–‡ä»¶</span></span>
<span id="cb380-74"><a href="#cb380-74" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timestamp <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb380-75"><a href="#cb380-75" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dstPath <span class="op">=</span> <span class="st">&quot;/data/data/com.target.app/memory_&quot;</span> <span class="op">+</span> timestamp <span class="op">+</span> <span class="st">&quot;.dex&quot;</span><span class="op">;</span></span>
<span id="cb380-76"><a href="#cb380-76" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="bu">File</span> <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.File&quot;</span>)<span class="op">;</span></span>
<span id="cb380-77"><a href="#cb380-77" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> FileOutputStream <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;java.io.FileOutputStream&quot;</span>)<span class="op">;</span></span>
<span id="cb380-78"><a href="#cb380-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-79"><a href="#cb380-79" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dstFile <span class="op">=</span> <span class="bu">File</span><span class="op">.</span><span class="fu">$new</span>(dstPath)<span class="op">;</span></span>
<span id="cb380-80"><a href="#cb380-80" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fos <span class="op">=</span> FileOutputStream<span class="op">.</span><span class="fu">$new</span>(dstFile)<span class="op">;</span></span>
<span id="cb380-81"><a href="#cb380-81" aria-hidden="true" tabindex="-1"></a>fos<span class="op">.</span><span class="fu">write</span>(bytes)<span class="op">;</span></span>
<span id="cb380-82"><a href="#cb380-82" aria-hidden="true" tabindex="-1"></a>fos<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb380-83"><a href="#cb380-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-84"><a href="#cb380-84" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [å·²å¯¼å‡º] &quot;</span> <span class="op">+</span> dstPath)<span class="op">;</span></span>
<span id="cb380-85"><a href="#cb380-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-86"><a href="#cb380-86" aria-hidden="true" tabindex="-1"></a><span class="co">// é‡ç½® ByteBuffer ä½ç½®</span></span>
<span id="cb380-87"><a href="#cb380-87" aria-hidden="true" tabindex="-1"></a>byteBuffer<span class="op">.</span><span class="fu">position</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb380-88"><a href="#cb380-88" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb380-89"><a href="#cb380-89" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] å¯¼å‡ºå¤±è´¥: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb380-90"><a href="#cb380-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-91"><a href="#cb380-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-92"><a href="#cb380-92" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$init</span>(byteBuffer<span class="op">,</span> classLoader)<span class="op">;</span></span>
<span id="cb380-93"><a href="#cb380-93" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb380-94"><a href="#cb380-94" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb380-95"><a href="#cb380-95" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] InMemoryDexClassLoader ä¸å­˜åœ¨ (Android &lt; 8.0)&quot;</span>)<span class="op">;</span></span>
<span id="cb380-96"><a href="#cb380-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-97"><a href="#cb380-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-98"><a href="#cb380-98" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] Hook å®Œæˆï¼Œç­‰å¾… DEX åŠ è½½...&quot;</span>)<span class="op">;</span></span>
<span id="cb380-99"><a href="#cb380-99" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h1 id="attach-æ¨¡å¼">Attach æ¨¡å¼</h1>
<p>frida -U com.target.app -l unpacker_gen1.js</p>
<pre><code>
```javascript
// unpacker_fart.js - FART (Frida-ART-Hook) è„šæœ¬

// è­¦å‘Š: æ­¤è„šæœ¬éœ€è¦æ·±å…¥ç†è§£ ART å†…éƒ¨æœºåˆ¶ï¼Œä¸åŒ Android ç‰ˆæœ¬å¯èƒ½éœ€è¦è°ƒæ•´åç§»

var artMethodInvokeAddr = null;

// æ ¹æ® Android ç‰ˆæœ¬æŸ¥æ‰¾ ArtMethod::Invoke ç¬¦å·
var symbols = [
&quot;_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjjPNS_6JValueEPKc&quot;, // Android 7.0+
&quot;_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjmPNS_6JValueEPKc&quot;, // Android 8.0+
];

for (var i = 0; i &lt; symbols.length; i++) {
artMethodInvokeAddr = Module.findExportByName(&quot;libart.so&quot;, symbols[i]);
if (artMethodInvokeAddr) {
console.log(&quot;[+] æ‰¾åˆ° ArtMethod::Invoke: &quot; + artMethodInvokeAddr);
break;
}
}

if (!artMethodInvokeAddr) {
console.log(&quot;[-] æœªæ‰¾åˆ° ArtMethod::Invokeï¼Œæ— æ³•ç»§ç»­&quot;);
} else {
Interceptor.attach(artMethodInvokeAddr, {
onEnter: function(args) {
var artMethod = args[0];

// è¯»å– ArtMethod ç»“æ„ä¸­çš„ CodeItem (åç§»å› ç‰ˆæœ¬è€Œå¼‚)
// è¿™é‡Œä»¥ Android 7.0 ä¸ºä¾‹ï¼Œå®é™…ä½¿ç”¨éœ€è¦æ ¹æ®ç‰ˆæœ¬è°ƒæ•´
try {
// è·å–æ–¹æ³•å (é€šè¿‡ PrettyMethod)
var prettyMethodAddr = Module.findExportByName(&quot;libart.so&quot;, &quot;_ZN3art9ArtMethod12PrettyMethodEv&quot;);
if (prettyMethodAddr) {
var prettyMethod = new NativeFunction(prettyMethodAddr, &#39;pointer&#39;, [&#39;pointer&#39;]);
var methodName = prettyMethod(artMethod).readCString();

// åªå…³æ³¨ App è‡ªèº«æ–¹æ³•ï¼Œå¿½ç•¥ç³»ç»Ÿæ–¹æ³•
if (methodName &amp;&amp; methodName.indexOf(&quot;com.target.app&quot;) !== -1) {
console.log(&quot;[+] è°ƒç”¨æ–¹æ³•: &quot; + methodName);

// å°è¯•è·å– CodeItem
// æ³¨æ„: CodeItem åç§»åœ¨ä¸åŒç‰ˆæœ¬ä¸­ä¸åŒ
// Android 7.0: offset 24
// Android 8.0+: offset 16
var codeItemOffset = 24; // éœ€è¦æ ¹æ®å®é™…ç‰ˆæœ¬è°ƒæ•´
var codeItemPtr = artMethod.add(codeItemOffset).readPointer();

if (codeItemPtr &amp;&amp; !codeItemPtr.isNull()) {
// è¯»å– CodeItem ç»“æ„
var registersSize = codeItemPtr.readU16();
var insSize = codeItemPtr.add(2).readU16();
var outsSize = codeItemPtr.add(4).readU16();
var triesSize = codeItemPtr.add(6).readU16();
var insnsSize = codeItemPtr.add(12).readU32();

if (insnsSize &gt; 0 &amp;&amp; insnsSize &lt; 100000) {
console.log(&quot; æ‰¾åˆ° CodeItem: insnsSize = &quot; + insnsSize);

// å¯¼å‡ºå­—èŠ‚ç 
var insnsPtr = codeItemPtr.add(16);
var codeData = Memory.readByteArray(insnsPtr, insnsSize * 2);

// ä¿å­˜åˆ°æ–‡ä»¶
var safeMethodName = methodName.replace(/[^a-zA-Z0-9]/g, &quot;_&quot;);
var filename = &quot;/data/data/com.target.app/code_&quot; + safeMethodName + &quot;.bin&quot;;
var file = new File(filename, &quot;wb&quot;);
file.write(codeData);
file.close();

console.log(&quot;âœ“ [å·²å¯¼å‡º CodeItem] &quot; + filename);
}
}
}
}
} catch (e) {
// å¿½ç•¥è¯»å–é”™è¯¯
}
}
});

console.log(&quot;[+] FART Hook å·²æ¿€æ´»ï¼Œå¼€å§‹ç›‘æ§æ–¹æ³•è°ƒç”¨...&quot;);
}
</code></pre>
<ul>
<li>åªèƒ½ dump <strong>è¢«è°ƒç”¨è¿‡çš„æ–¹æ³•</strong>ï¼Œæœªè§¦å‘çš„æ–¹æ³•æ— æ³•æ¢å¤</li>
</ul>
<hr />
<h3 id="æ–¹æ³•-d-å†…å­˜æ‰«æ-é€šç”¨å…œåº•æ–¹æ¡ˆ"># æ–¹æ³• D: å†…å­˜æ‰«æ
(é€šç”¨å…œåº•æ–¹æ¡ˆ)</h3>
<p>å½“å…¶ä»–æ–¹æ³•å¤±æ•ˆæ—¶ï¼Œå¯ä»¥å®šæœŸæ‰«æå†…å­˜ä¸­çš„ DEX magic numberã€‚</p>
<div class="sourceCode" id="cb382"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co">// unpacker_memscan.js - å†…å­˜æ‰«æè„šæœ¬</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">scanMemoryForDex</span>() {</span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] å¼€å§‹æ‰«æå†…å­˜ä¸­çš„ DEX æ–‡ä»¶...&quot;</span>)<span class="op">;</span></span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ranges <span class="op">=</span> Process<span class="op">.</span><span class="fu">enumerateRanges</span>(<span class="st">&quot;r--&quot;</span>)<span class="op">;</span> <span class="co">// ä»…æ‰«æå¯è¯»åŒºåŸŸ</span></span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> found <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a>ranges<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (range) {</span>
<span id="cb382-10"><a href="#cb382-10" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb382-11"><a href="#cb382-11" aria-hidden="true" tabindex="-1"></a><span class="co">// DEX magic: &quot;dex\n&quot; = 0x6465780A</span></span>
<span id="cb382-12"><a href="#cb382-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pattern <span class="op">=</span> <span class="st">&quot;64 65 78 0a&quot;</span><span class="op">;</span></span>
<span id="cb382-13"><a href="#cb382-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-14"><a href="#cb382-14" aria-hidden="true" tabindex="-1"></a>Memory<span class="op">.</span><span class="fu">scan</span>(range<span class="op">.</span><span class="at">base</span><span class="op">,</span> range<span class="op">.</span><span class="at">size</span><span class="op">,</span> pattern<span class="op">,</span> {</span>
<span id="cb382-15"><a href="#cb382-15" aria-hidden="true" tabindex="-1"></a><span class="dt">onMatch</span><span class="op">:</span> <span class="kw">function</span> (address<span class="op">,</span> size) {</span>
<span id="cb382-16"><a href="#cb382-16" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] å‘ç°æ½œåœ¨ DEX: &quot;</span> <span class="op">+</span> address)<span class="op">;</span></span>
<span id="cb382-17"><a href="#cb382-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-18"><a href="#cb382-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb382-19"><a href="#cb382-19" aria-hidden="true" tabindex="-1"></a><span class="co">// è¯»å– DEX æ–‡ä»¶å¤§å° (åç§» 32 å­—èŠ‚å¤„)</span></span>
<span id="cb382-20"><a href="#cb382-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dexSize <span class="op">=</span> address<span class="op">.</span><span class="fu">add</span>(<span class="dv">32</span>)<span class="op">.</span><span class="fu">readU32</span>()<span class="op">;</span></span>
<span id="cb382-21"><a href="#cb382-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-22"><a href="#cb382-22" aria-hidden="true" tabindex="-1"></a><span class="co">// åˆç†æ€§æ£€æŸ¥</span></span>
<span id="cb382-23"><a href="#cb382-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (dexSize <span class="op">&gt;</span> <span class="bn">0x1000</span> <span class="op">&amp;&amp;</span> dexSize <span class="op">&lt;</span> <span class="dv">50</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>) {</span>
<span id="cb382-24"><a href="#cb382-24" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb382-25"><a href="#cb382-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot; DEX Size: &quot;</span> <span class="op">+</span> (dexSize <span class="op">/</span> <span class="dv">1024</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">&quot; KB&quot;</span></span>
<span id="cb382-26"><a href="#cb382-26" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb382-27"><a href="#cb382-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-28"><a href="#cb382-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Dump DEX</span></span>
<span id="cb382-29"><a href="#cb382-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dexData <span class="op">=</span> Memory<span class="op">.</span><span class="fu">readByteArray</span>(address<span class="op">,</span> dexSize)<span class="op">;</span></span>
<span id="cb382-30"><a href="#cb382-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filename <span class="op">=</span></span>
<span id="cb382-31"><a href="#cb382-31" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;/data/data/com.target.app/memdump_&quot;</span> <span class="op">+</span></span>
<span id="cb382-32"><a href="#cb382-32" aria-hidden="true" tabindex="-1"></a>address<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">replace</span>(<span class="st">&quot;0x&quot;</span><span class="op">,</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb382-33"><a href="#cb382-33" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;.dex&quot;</span><span class="op">;</span></span>
<span id="cb382-34"><a href="#cb382-34" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> file <span class="op">=</span> <span class="kw">new</span> <span class="bu">File</span>(filename<span class="op">,</span> <span class="st">&quot;wb&quot;</span>)<span class="op">;</span></span>
<span id="cb382-35"><a href="#cb382-35" aria-hidden="true" tabindex="-1"></a>file<span class="op">.</span><span class="fu">write</span>(dexData)<span class="op">;</span></span>
<span id="cb382-36"><a href="#cb382-36" aria-hidden="true" tabindex="-1"></a>file<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb382-37"><a href="#cb382-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-38"><a href="#cb382-38" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;âœ“ [Dumped] &quot;</span> <span class="op">+</span> filename)<span class="op">;</span></span>
<span id="cb382-39"><a href="#cb382-39" aria-hidden="true" tabindex="-1"></a>found<span class="op">++;</span></span>
<span id="cb382-40"><a href="#cb382-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb382-41"><a href="#cb382-41" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb382-42"><a href="#cb382-42" aria-hidden="true" tabindex="-1"></a><span class="co">// è¯»å–å¤±è´¥ï¼Œè·³è¿‡</span></span>
<span id="cb382-43"><a href="#cb382-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb382-44"><a href="#cb382-44" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb382-45"><a href="#cb382-45" aria-hidden="true" tabindex="-1"></a><span class="dt">onComplete</span><span class="op">:</span> <span class="kw">function</span> () {}<span class="op">,</span></span>
<span id="cb382-46"><a href="#cb382-46" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb382-47"><a href="#cb382-47" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb382-48"><a href="#cb382-48" aria-hidden="true" tabindex="-1"></a><span class="co">// å¿½ç•¥æ— æ³•è®¿é—®çš„å†…å­˜åŒºåŸŸ</span></span>
<span id="cb382-49"><a href="#cb382-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb382-50"><a href="#cb382-50" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb382-51"><a href="#cb382-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-52"><a href="#cb382-52" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] æ‰«æå®Œæˆï¼Œæ‰¾åˆ° &quot;</span> <span class="op">+</span> found <span class="op">+</span> <span class="st">&quot; ä¸ª DEX æ–‡ä»¶&quot;</span>)<span class="op">;</span></span>
<span id="cb382-53"><a href="#cb382-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb382-54"><a href="#cb382-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-55"><a href="#cb382-55" aria-hidden="true" tabindex="-1"></a><span class="co">// æ¯ 5 ç§’æ‰«æä¸€æ¬¡</span></span>
<span id="cb382-56"><a href="#cb382-56" aria-hidden="true" tabindex="-1"></a><span class="pp">setInterval</span>(<span class="kw">function</span> () {</span>
<span id="cb382-57"><a href="#cb382-57" aria-hidden="true" tabindex="-1"></a><span class="fu">scanMemoryForDex</span>()<span class="op">;</span></span>
<span id="cb382-58"><a href="#cb382-58" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="dv">5000</span>)<span class="op">;</span></span>
<span id="cb382-59"><a href="#cb382-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-60"><a href="#cb382-60" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[+] å†…å­˜æ‰«æå·²å¯åŠ¨&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>adb pull /data/data/com.target.app/ ./dumped_files/</p>
<h1 id="æŸ¥çœ‹æå–åˆ°çš„-dex-æ–‡ä»¶">2. æŸ¥çœ‹æå–åˆ°çš„ DEX æ–‡ä»¶</h1>
<p>ls -lh ./dumped_files/*.dex</p>
<h1 id="è¾“å‡ºç¤ºä¾‹-1">è¾“å‡ºç¤ºä¾‹:</h1>
<h1 id="rw-rr-1-user-user-5.2m-dumped_1234567890.dex">-rw-râ€“râ€“ 1 user
user 5.2M dumped_1234567890.dex</h1>
<h1 id="rw-rr-1-user-user-1.8m-dumped_0987654321.dex">-rw-râ€“râ€“ 1 user
user 1.8M dumped_0987654321.dex</h1>
<h1 id="éªŒè¯-dex-æ–‡ä»¶å®Œæ•´æ€§">3. éªŒè¯ DEX æ–‡ä»¶å®Œæ•´æ€§</h1>
<p>xxd ./dumped_files/dumped_1234567890.dex | head -n 2</p>
<h1 id="åº”è¯¥çœ‹åˆ°-dex-magic-64-65-78-0a-dex">åº”è¯¥çœ‹åˆ° DEX magic: 64 65 78
0a (dex)</h1>
<h1 id="ä½¿ç”¨-jadx-æ‰“å¼€éªŒè¯">4. ä½¿ç”¨ Jadx æ‰“å¼€éªŒè¯</h1>
<p>jadx ./dumped_files/dumped_1234567890.dex</p>
<h1
id="å¦‚æœèƒ½æ­£å¸¸åç¼–è¯‘è¡¨ç¤ºè„±å£³æˆåŠŸ">å¦‚æœèƒ½æ­£å¸¸åç¼–è¯‘ï¼Œè¡¨ç¤ºè„±å£³æˆåŠŸ</h1>
<pre><code>
### å¸¸è§éœ€è¦ä¿®å¤çš„æƒ…å†µ:

1. **æ–¹æ³•ä½“è¢« NOP å¡«å……**:
- ç—‡çŠ¶: Jadx åç¼–è¯‘åçœ‹åˆ°å¤§é‡ç©ºæ–¹æ³•æˆ–åªæœ‰ `return` çš„æ–¹æ³•
- åŸå› : å£³ç”¨å ä½ç¬¦æ›¿æ¢äº†çœŸå®ä»£ç 
- è§£å†³: å¦‚æœç”¨ FART dump äº† CodeItemï¼Œéœ€è¦æ‰‹åŠ¨æ›¿æ¢å›å»

2. **å­—ç¬¦ä¸²æ± æŸå**:
- ç—‡çŠ¶: åç¼–è¯‘åå­—ç¬¦ä¸²æ˜¾ç¤ºä¸ºä¹±ç æˆ–ç¼ºå¤±
- è§£å†³: ä½¿ç”¨ `dex-repair` å·¥å…·é‡å»ºå­—ç¬¦ä¸²æ± 

3. **ç±»/æ–¹æ³•ç´¢å¼•é”™ä¹±**:
- ç—‡çŠ¶: æ–¹æ³•è°ƒç”¨å…³ç³»ä¸æ­£ç¡®
- è§£å†³: ä½¿ç”¨ `smali/baksmali` é‡æ–°ç»„è£…

### è‡ªåŠ¨åŒ–ä¿®å¤å·¥å…·

```bash
# ä½¿ç”¨ dex-repair (å¼€æºå·¥å…·)
git clone https://github.com/F8LEFT/dex-repair
cd dex-repair
python3 repair.py ./dumped_files/dumped_1234567890.dex -o ./fixed.dex

# éªŒè¯ä¿®å¤ç»“æœ
jadx ./fixed.dex
</code></pre>
<h1 id="è¿™éœ€è¦ä½¿ç”¨-dexpatcher-æˆ–è‡ªå®šä¹‰è„šæœ¬">è¿™éœ€è¦ä½¿ç”¨ DexPatcher
æˆ–è‡ªå®šä¹‰è„šæœ¬</h1>
<h1 id="åæ±‡ç¼–-dex">2. åæ±‡ç¼– DEX</h1>
<p>baksmali d dumped_1234567890.dex -o ./smali_output</p>
<h1 id="æŸ¥æ‰¾ç©ºæ–¹æ³•å¹¶æ›¿æ¢">3. æŸ¥æ‰¾ç©ºæ–¹æ³•å¹¶æ›¿æ¢</h1>
<h1 id="åœ¨-smali_output-ä¸­æ‰¾åˆ°æ–¹æ³•ä½“ä¸ºç©ºçš„-.smali-æ–‡ä»¶">åœ¨ smali_output
ä¸­ï¼Œæ‰¾åˆ°æ–¹æ³•ä½“ä¸ºç©ºçš„ .smali æ–‡ä»¶</h1>
<h1 id="å°†å¯¼å‡ºçš„-codeitem-åæ±‡ç¼–åçš„å†…å®¹å¤åˆ¶è¿›å»">å°†å¯¼å‡ºçš„ CodeItem
åæ±‡ç¼–åçš„å†…å®¹å¤åˆ¶è¿›å»</h1>
<h1 id="é‡æ–°ç»„è£…">4. é‡æ–°ç»„è£…</h1>
<p>smali a ./smali_output -o ./repacked.dex</p>
<h1 id="éªŒè¯">5. éªŒè¯</h1>
<p>jadx ./repacked.dex</p>
<pre><code>
â”‚ 1. DEX åŠ å¯† â”‚ å°† classes.dex åŠ å¯†ä¸º encrypted.dat
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å£³ä»£æ›¿æ¢ â”‚ ç”¨å£³ DEX æ›¿æ¢ classes.dex
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. é‡æ–°æ‰“åŒ…ç­¾å â”‚ ç”ŸæˆåŠ å›ºåçš„ APK
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿è¡Œæ—¶è§£å¯†æµç¨‹:
Application.onCreate()
â†“
å£³ä»£ç æ‰§è¡Œ
â†“
è§£å¯† encrypted.dat
â†“
DexClassLoader.load(è§£å¯†åçš„ DEX)
â†“
è·³è½¬åˆ°åŸå§‹ Application å…¥å£
</code></pre>
<p>â†“ å£³ä»£ç è¿è¡Œ â†“ è§£å¯†åŸå§‹ DEX â† Hookç‚¹1: ClassLoader â†“ ART åŠ è½½ DEX
åˆ°å†…å­˜ â† Hookç‚¹2: libart.so â†“ ç¼–è¯‘ä¸º OAT æ ¼å¼ â†“ ç±»åˆå§‹åŒ–å’Œæ–¹æ³•è°ƒç”¨ â†
Hookç‚¹3: ArtMethod::Invoke â†“ åŸå§‹ä»£ç æ‰§è¡Œ</p>
<pre><code>
* *å¯èƒ½åŸå› **:

1. å£³æ£€æµ‹åˆ° Frida å¹¶æå‰é€€å‡º
2. Hook æ—¶æœºå¤ªæ™šï¼ŒDEX å·²ç»åŠ è½½å®Œæ¯•
3. ä½¿ç”¨äº†éæ ‡å‡†çš„åŠ è½½æ–¹å¼

* *è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. å…ˆç»•è¿‡ Frida æ£€æµ‹
frida -U -f com.target.app -l bypass_frida_detection.js --no-pause

# ç­‰å¾…åº”ç”¨å¯åŠ¨åï¼Œå†è¿è¡Œ dexdump (åˆ†ä¸¤æ­¥)
frida -U com.target.app -l frida_dexdump_manual.js

# 2. å°è¯•æ›´æ—©çš„æ‹¦æˆªç‚¹
# ä¿®æ”¹ frida-dexdump æºç ï¼Œåœ¨ libc.so fork() ä¹‹å‰å°±æ³¨å…¥

# 3. ä½¿ç”¨å†…å­˜æ‰«æä½œä¸ºå…œåº•æ–¹æ¡ˆ
frida -U com.target.app -l unpacker_memscan.js
</code></pre>
<ol type="1">
<li>Dump çš„æ—¶æœºä¸å¯¹ï¼ŒDEX è¿˜æœªå®Œå…¨è§£å¯†</li>
<li>DEX æ–‡ä»¶è¢«æˆªæ–­</li>
<li>å†…å­˜ä¸­çš„ DEX å·²è¢«ä¿®æ”¹ (å¦‚æ–¹æ³•æŠ½å–)</li>
</ol>
<ul>
<li>*è§£å†³æ–¹æ¡ˆ**:</li>
</ul>
<div class="sourceCode" id="cb386"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. æ£€æŸ¥ DEX æ–‡ä»¶å¤´</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="ex">xxd</span> dumped.dex <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 5</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="co"># å‰ 4 å­—èŠ‚å¿…é¡»æ˜¯: 64 65 78 0a (dex\n)</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="co"># å 4 å­—èŠ‚æ˜¯ç‰ˆæœ¬å·: 30 33 35 00 (035) æˆ– 30 33 38 00 (038)</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. éªŒè¯æ–‡ä»¶å¤§å°</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a><span class="co"># åç§» 32 å­—èŠ‚å¤„è®°å½•æ–‡ä»¶å¤§å°</span></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dd</span> if=dumped.dex bs=1 skip=32 count=4 <span class="kw">|</span> <span class="ex">xxd</span></span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ä¸å®é™…æ–‡ä»¶å¤§å°å¯¹æ¯”</span></span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-11"><a href="#cb386-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. å°è¯•ä¿®å¤å·¥å…·</span></span>
<span id="cb386-12"><a href="#cb386-12" aria-hidden="true" tabindex="-1"></a><span class="ex">dex-repair</span> dumped.dex <span class="at">-o</span> fixed.dex</span>
<span id="cb386-13"><a href="#cb386-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-14"><a href="#cb386-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. å¦‚æœæ˜¯æ–¹æ³•æŠ½å–å£³ï¼Œéœ€è¦ç”¨ FART è¡¥å…¨æ–¹æ³•ä½“</span></span></code></pre></div>
<ol type="1">
<li>ArtMethod ç»“æ„åç§»é”™è¯¯ (Android ç‰ˆæœ¬ä¸åŒ¹é…)</li>
<li>è¯»å–äº†æ— æ•ˆçš„å†…å­˜åœ°å€</li>
<li>Hook ç¬¦å·é”™è¯¯</li>
</ol>
<ul>
<li>*è§£å†³æ–¹æ¡ˆ**:</li>
</ul>
<div class="sourceCode" id="cb387"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. æ·»åŠ å¼‚å¸¸ä¿æŠ¤</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(artMethodInvokeAddr<span class="op">,</span> {</span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> artMethod <span class="op">=</span> args[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ... ä½ çš„ä»£ç </span></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] æ•è·å¼‚å¸¸: &quot;</span> <span class="op">+</span> e)<span class="op">;</span></span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a><span class="co">// ä¸è¦é‡æ–°æŠ›å‡ºï¼Œé¿å…å´©æºƒ</span></span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-14"><a href="#cb387-14" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. æ ¹æ® Android ç‰ˆæœ¬åŠ¨æ€è°ƒæ•´åç§»</span></span>
<span id="cb387-15"><a href="#cb387-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> androidVersion <span class="op">=</span> Java<span class="op">.</span><span class="at">androidVersion</span><span class="op">;</span></span>
<span id="cb387-16"><a href="#cb387-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> codeItemOffset<span class="op">;</span></span>
<span id="cb387-17"><a href="#cb387-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (androidVersion <span class="op">&gt;=</span> <span class="dv">10</span>) {</span>
<span id="cb387-18"><a href="#cb387-18" aria-hidden="true" tabindex="-1"></a>codeItemOffset <span class="op">=</span> <span class="dv">16</span><span class="op">;</span> <span class="co">// Android 10+</span></span>
<span id="cb387-19"><a href="#cb387-19" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (androidVersion <span class="op">&gt;=</span> <span class="dv">8</span>) {</span>
<span id="cb387-20"><a href="#cb387-20" aria-hidden="true" tabindex="-1"></a>codeItemOffset <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> <span class="co">// Android 8-9</span></span>
<span id="cb387-21"><a href="#cb387-21" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb387-22"><a href="#cb387-22" aria-hidden="true" tabindex="-1"></a>codeItemOffset <span class="op">=</span> <span class="dv">24</span><span class="op">;</span> <span class="co">// Android 7</span></span>
<span id="cb387-23"><a href="#cb387-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-24"><a href="#cb387-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-25"><a href="#cb387-25" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. æ£€æŸ¥æŒ‡é’ˆæœ‰æ•ˆæ€§</span></span>
<span id="cb387-26"><a href="#cb387-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (codeItemPtr <span class="op">&amp;&amp;</span> <span class="op">!</span>codeItemPtr<span class="op">.</span><span class="fu">isNull</span>()) {</span>
<span id="cb387-27"><a href="#cb387-27" aria-hidden="true" tabindex="-1"></a><span class="co">// å°è¯•è¯»å–å‰å…ˆæ£€æŸ¥æ˜¯å¦å¯è¯»</span></span>
<span id="cb387-28"><a href="#cb387-28" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb387-29"><a href="#cb387-29" aria-hidden="true" tabindex="-1"></a>Process<span class="op">.</span><span class="fu">findRangeByAddress</span>(codeItemPtr)<span class="op">;</span> <span class="co">// ä¼šæŠ›å‡ºå¼‚å¸¸å¦‚æœåœ°å€æ— æ•ˆ</span></span>
<span id="cb387-30"><a href="#cb387-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> insnsSize <span class="op">=</span> codeItemPtr<span class="op">.</span><span class="fu">add</span>(<span class="dv">12</span>)<span class="op">.</span><span class="fu">readU32</span>()<span class="op">;</span></span>
<span id="cb387-31"><a href="#cb387-31" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb387-32"><a href="#cb387-32" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (e) {</span>
<span id="cb387-33"><a href="#cb387-33" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;[-] æ— æ•ˆåœ°å€: &quot;</span> <span class="op">+</span> codeItemPtr)<span class="op">;</span></span>
<span id="cb387-34"><a href="#cb387-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-35"><a href="#cb387-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>*è§£å†³æ–¹æ¡ˆ**:</li>
</ul>
<div class="sourceCode" id="cb388"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ä½¿ç”¨ FART æŠ€æœ¯ (è§ç¬¬ 3 æ­¥æ–¹æ³• C)</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="co"># å¿…é¡»è§¦å‘æ‰€æœ‰å…³é”®æ–¹æ³•è°ƒç”¨æ‰èƒ½å®Œæ•´å¯¼å‡º</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. æ‰‹åŠ¨è§¦å‘æ–¹æ³•è°ƒç”¨</span></span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a><span class="co"># å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼Œéå†æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•å¹¶è°ƒç”¨</span></span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ä½¿ç”¨ä¸“ç”¨å·¥å…·</span></span>
<span id="cb388-8"><a href="#cb388-8" aria-hidden="true" tabindex="-1"></a><span class="co"># FUPK3ã€Youpk ç­‰å·¥å…·å·²å†…ç½®æ–¹æ³•ä¸»åŠ¨è°ƒç”¨é€»è¾‘</span></span></code></pre></div>
<p>Java.enumerateLoadedClasses({ onMatch: function(className) { if
(className.indexOf(â€œcom.target.appâ€) !== -1) { try { var clazz =
Java.use(className); var methods = clazz.class.getDeclaredMethods();</p>
<p>methods.forEach(function(method) { try { // å°è¯•è°ƒç”¨é™æ€æ–¹æ³•
(ä¼ ç©ºå‚æ•°) console.log(â€œ[+] å°è¯•è°ƒç”¨:â€ + method.getName());
method.invoke(null, []); } catch (e) { // å¿½ç•¥è°ƒç”¨å¤±è´¥ } }); } catch (e)
{} } }, onComplete: function() { console.log(â€œ[+] æ–¹æ³•è§¦å‘å®Œæˆâ€); }
});</p>
<p>});</p>
<pre><code>
| é¡¹ç›® | è¯´æ˜ |
|------|------|
| [Recipe | ç»•è¿‡ App å¯¹ Frida çš„æ£€æµ‹](../Anti-Detection/frida_anti_debugging.md) - è„±å£³å‰é€šå¸¸éœ€è¦å…ˆè¿‡åè°ƒè¯• |
| [Recipe | æŠ“åŒ…åˆ†æ Android åº”ç”¨çš„ç½‘ç»œæµé‡](../Network/network_sniffing.md) - è„±å£³åæŠ“åŒ…åˆ†æåŠ å¯†é€»è¾‘ |
| [Recipe | SO æ··æ·†ä¸åæ··æ·†](./so_obfuscation_deobfuscation.md) - Native å±‚åŠ å›ºçš„å¤„ç† |


## # å·¥å…·æ·±å…¥
- [Frida å†…éƒ¨åŸç†](../../02-Tools/Dynamic/frida_internals.md) - ç†è§£ Frida Hook æœºåˆ¶
- [Unidbg ä½¿ç”¨æŒ‡å—](../../02-Tools/Dynamic/unidbg_guide.md) - ä»¿çœŸæ‰§è¡Œ Native è§£å¯†å‡½æ•°

## # æ¡ˆä¾‹åˆ†æ
- [æ¡ˆä¾‹: æŸéŸ³ä¹ App çš„åŠ å›ºåˆ†æ](../../03-Case-Studies/case_music_apps.md)

## # å‚è€ƒèµ„æ–™
- [DEX æ–‡ä»¶æ ¼å¼è¯¦è§£](../../04-Reference/Foundations/dex_format.md)
- [ART è¿è¡Œæ—¶æœºåˆ¶](../../04-Reference/Foundations/art_runtime.md)

- --

## å¿«é€Ÿå‚è€ƒ

## # åŠ å›ºæ£€æµ‹é€ŸæŸ¥è¡¨

| æ£€æµ‹é¡¹ | å‘½ä»¤ | å¯ç–‘ç‰¹å¾ |
|--------|------|----------|
| **Application å…¥å£** | `unzip -p app.apk AndroidManifest.xml \| grep android:name` | `StubShell`, `ApplicationWrapper`, `StubApplication` |
| **DEX æ–‡ä»¶å¤§å°** | `unzip -l app.apk \| grep classes.dex` | &lt; 100 KB (å¤æ‚åº”ç”¨) |
| **åŠ å¯†æ•°æ®æ–‡ä»¶** | `unzip -l app.apk \| grep -E &quot;\.dat\|\.bin&quot;` | `assets/` ä¸‹çš„ .dat/.bin æ–‡ä»¶ |
| **å¯ç–‘ SO åº“** | `unzip -l app.apk \| grep &quot;lib/.*\.so&quot;` | `libexec.so`, `libvmp.so`, `libprotect.so` |
| **ä½¿ç”¨ PKid** | `java -jar ApkToolPlus.jar -pkid app.apk` | ç›´æ¥è¾“å‡ºåŠ å›ºå‚å•† |

## # å¸¸ç”¨è„±å£³å‘½ä»¤

```bash
# 1. ä½¿ç”¨ frida-dexdump (æ¨è)
python3 -m frida_dexdump -U -f com.target.app -o ./output

# 2. æ‰‹å†™è„šæœ¬ (Spawn æ¨¡å¼)
frida -U -f com.target.app -l unpacker.js --no-pause

# 3. å†…å­˜æ‰«æ
frida -U com.target.app -l memscan.js

# 4. æ‹‰å–å¯¼å‡ºæ–‡ä»¶
adb pull /data/data/com.target.app/ ./dumped/

# 5. éªŒè¯ DEX æ–‡ä»¶
xxd dumped.dex | head -n 2 # æ£€æŸ¥ magic number
jadx dumped.dex # å°è¯•åç¼–è¯‘
</code></pre>
<div class="line-block"><strong>frida-dexdump</strong> | è‡ªåŠ¨åŒ– DEX
dumper | <a href="https://github.com/hluwa/frida-dexdump">GitHub</a>
|<br />
<strong>FUPK3</strong> | é’ˆå¯¹ç‰¹å®šå£³çš„è„±å£³æœº | <a
href="https://github.com/F8LEFT/FUPK3">GitHub</a> |<br />
<strong>Youpk</strong> | è¾ƒæ–°çš„è„±å£³å·¥å…· | <a
href="https://github.com/Youlor/Youpk">GitHub</a> |<br />
<strong>PKid</strong> | åŠ å›ºè¯†åˆ«å·¥å…· | <a
href="https://github.com/rover12421/ApkToolPlus">GitHub</a> |<br />
<strong>dex-repair</strong> | DEX æ–‡ä»¶ä¿®å¤å·¥å…· | <a
href="https://github.com/F8LEFT/dex-repair">GitHub</a> |</div>
<hr />
<p>*ğŸ’¡ æç¤º<strong>:
è„±å£³æ˜¯ä¸€ä¸ªéœ€è¦è€å¿ƒå’Œç»éªŒçš„è¿‡ç¨‹ã€‚å¦‚æœä¸€ç§æ–¹æ³•ä¸å¥æ•ˆï¼Œå°è¯•ç»„åˆå¤šç§æŠ€æœ¯ã€‚è®°ä½ï¼Œ</strong>ä»£ç è¿è¡Œå¿…è§£å¯†*
- åªè¦åº”ç”¨èƒ½æ­£å¸¸è¿è¡Œ,ç†è®ºä¸Šå°±èƒ½è„±å£³ã€‚</p>
<pre><code>


&lt;!-- 02-Tools/Cheatsheets/adb_cheatsheet.md --&gt;

# å¸¸ç”¨ ADB å‘½ä»¤å¤§å…¨

ADB (Android Debug Bridge) æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯è®©æ‚¨ä¸æ¨¡æ‹Ÿå™¨å®ä¾‹æˆ–è¿æ¥çš„ Android è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚

- --

## ç›®å½•
- [å¸¸ç”¨ ADB å‘½ä»¤å¤§å…¨](#å¸¸ç”¨-adb-å‘½ä»¤å¤§å…¨)
- [ç›®å½•](#ç›®å½•)
- [è®¾å¤‡ç®¡ç†](#è®¾å¤‡ç®¡ç†)

- [æ–‡ä»¶ç®¡ç†](#æ–‡ä»¶ç®¡ç†)

- [åº”ç”¨ç®¡ç†](#åº”ç”¨ç®¡ç†)

- [ç½‘ç»œ](#ç½‘ç»œ)

- [ç³»ç»Ÿä¸è°ƒè¯•](#ç³»ç»Ÿä¸è°ƒè¯•)

- [Logcat æ—¥å¿—æŸ¥çœ‹](#logcat-æ—¥å¿—æŸ¥çœ‹)

- [é«˜çº§ Shell å‘½ä»¤](#é«˜çº§-shell-å‘½ä»¤)

- --

### è®¾å¤‡ç®¡ç†

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb devices -l` | åˆ—å‡ºæ‰€æœ‰è¿æ¥çš„è®¾å¤‡åŠå…¶è¯¦ç»†ä¿¡æ¯ |
| `adb reboot` | é‡å¯è®¾å¤‡ |
| `adb reboot bootloader` | é‡å¯åˆ°å¼•å¯¼åŠ è½½ç¨‹åº (Bootloader) |
| `adb reboot recovery` | é‡å¯åˆ°æ¢å¤æ¨¡å¼ (Recovery) |
| `adb root` | ä»¥ root æƒé™é‡å¯ adbd æœåŠ¡ |
| `adb shell getprop ro.product.model` | è·å–è®¾å¤‡å‹å· |
| `adb shell getprop ro.build.version.release` | è·å– Android ç³»ç»Ÿç‰ˆæœ¬ |
| `adb shell wm size` | è·å–å±å¹•åˆ†è¾¨ç‡ |
| `adb shell wm density` | è·å–å±å¹•åƒç´ å¯†åº¦ (DPI) |

- --

### æ–‡ä»¶ç®¡ç†

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb push &lt;æœ¬åœ°è·¯å¾„&gt; &lt;è¿œç¨‹è·¯å¾„&gt;` | å°†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä»ç”µè„‘æ¨é€åˆ°è®¾å¤‡ |
| `adb pull &lt;è¿œç¨‹è·¯å¾„&gt; [æœ¬åœ°è·¯å¾„]` | å°†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä»è®¾å¤‡æ‹‰å–åˆ°ç”µè„‘ |
| `adb shell ls &lt;è·¯å¾„&gt;` | åˆ—å‡ºè®¾å¤‡æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ |
| `adb shell cd &lt;è·¯å¾„&gt;` | åˆ‡æ¢è®¾å¤‡ä¸Šçš„å½“å‰ç›®å½• |
| `adb shell pwd` | æ˜¾ç¤ºè®¾å¤‡ä¸Šçš„å½“å‰å·¥ä½œç›®å½• |
| `adb shell cp &lt;æºè·¯å¾„&gt; &lt;ç›®æ ‡è·¯å¾„&gt;` | åœ¨è®¾å¤‡ä¸Šå¤åˆ¶æ–‡ä»¶ |
| `adb shell mv &lt;æºè·¯å¾„&gt; &lt;ç›®æ ‡è·¯å¾„&gt;` | åœ¨è®¾å¤‡ä¸Šç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶ |
| `adb shell rm &lt;æ–‡ä»¶è·¯å¾„&gt;` | åœ¨è®¾å¤‡ä¸Šåˆ é™¤æ–‡ä»¶ |
| `adb shell mkdir &lt;è·¯å¾„&gt;` | åœ¨è®¾å¤‡ä¸Šåˆ›å»ºæ–°ç›®å½• |

- --

### åº”ç”¨ç®¡ç†

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb install &lt;apkè·¯å¾„&gt;` | å®‰è£…åº”ç”¨ |
| `adb install -r &lt;apkè·¯å¾„&gt;` | é‡æ–°å®‰è£…åº”ç”¨ï¼ˆä¿ç•™æ•°æ®ï¼‰ |
| `adb install -g &lt;apkè·¯å¾„&gt;` | ä¸ºåº”ç”¨æˆäºˆæ‰€æœ‰è¿è¡Œæ—¶æƒé™ |
| `adb uninstall &lt;åŒ…å&gt;` | å¸è½½åº”ç”¨ |
| `adb shell pm list packages` | åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨åŒ…å |
| `adb shell pm list packages -f` | åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨åŒ…ååŠå…¶ APK è·¯å¾„ |
| `adb shell pm list packages -3` | åˆ—å‡ºæ‰€æœ‰ç¬¬ä¸‰æ–¹åº”ç”¨åŒ…å |
| `adb shell pm path &lt;åŒ…å&gt;` | è·å–æŒ‡å®šåº”ç”¨çš„ APK è·¯å¾„ |
| `adb shell am start -n &lt;åŒ…å&gt;/&lt;Activityå&gt;` | å¯åŠ¨ä¸€ä¸ª Activity |
| `adb shell am force-stop &lt;åŒ…å&gt;` | å¼ºåˆ¶åœæ­¢åº”ç”¨ |
| `adb shell pm clear &lt;åŒ…å&gt;` | æ¸…é™¤åº”ç”¨æ•°æ®å’Œç¼“å­˜ |
| `adb shell dumpsys activity | grep mFocusedActivity` | è·å–å½“å‰å‰å° Activity |

- --

### ç½‘ç»œ

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb forward tcp:&lt;PCç«¯å£&gt; tcp:&lt;è®¾å¤‡ç«¯å£&gt;` | å°†ç”µè„‘ç«¯å£çš„è¯·æ±‚è½¬å‘åˆ°è®¾å¤‡ç«¯å£ |
| `adb forward --list` | åˆ—å‡ºæ‰€æœ‰ç«¯å£è½¬å‘è§„åˆ™ |
| `adb forward --remove-all` | ç§»é™¤æ‰€æœ‰ç«¯å£è½¬å‘è§„åˆ™ |
| `adb shell netstat` | æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ï¼ˆç›‘å¬çš„ç«¯å£ã€è¿æ¥ç­‰ï¼‰ |
| `adb shell ifconfig` or `adb shell ip addr` | æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯å’Œ IP åœ°å€ |

- --

### ç³»ç»Ÿä¸è°ƒè¯•

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb shell ps` | æŸ¥çœ‹è®¾å¤‡ä¸Šçš„è¿›ç¨‹åˆ—è¡¨ |
| `adb shell top` | æŸ¥çœ‹å®æ—¶èµ„æºå ç”¨æƒ…å†µ |
| `adb shell dumpsys &lt;æœåŠ¡å&gt;` | Dump æŒ‡å®šç³»ç»ŸæœåŠ¡çš„ä¿¡æ¯ (å¦‚ `activity`, `battery`, `wifi`) |
| `adb shell screencap /sdcard/screenshot.png` | æˆªå±å¹¶ä¿å­˜åˆ°è®¾å¤‡ |
| `adb shell screenrecord /sdcard/demo.mp4` | å½•åˆ¶å±å¹•ï¼ˆCtrl+C åœæ­¢ï¼‰ |
| `adb bugreport [è·¯å¾„]` | ç”Ÿæˆå¹¶æ‹‰å–å®Œæ•´çš„ bug æŠ¥å‘Š |
| `adb jdwp` | åˆ—å‡ºè®¾å¤‡ä¸Šå¯ä¾›è°ƒè¯•çš„ Java è¿›ç¨‹ ID (JDWP) |

- --

### Logcat æ—¥å¿—æŸ¥çœ‹

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb logcat` | å®æ—¶æ‰“å°è®¾å¤‡æ—¥å¿— |
| `adb logcat -c` | æ¸…é™¤æ—§çš„æ—¥å¿—ç¼“å­˜ |
| `adb logcat -d` | Dump å½“å‰æ—¥å¿—åˆ°å±å¹•å¹¶é€€å‡º |
| `adb logcat -f /sdcard/log.txt` | å°†æ—¥å¿—è¾“å‡ºåˆ°è®¾å¤‡ä¸Šçš„æ–‡ä»¶ |
| `adb logcat *:S &lt;æ ‡ç­¾&gt;:&lt;ä¼˜å…ˆçº§&gt;` | æŒ‰æ ‡ç­¾å’Œä¼˜å…ˆçº§è¿‡æ»¤æ—¥å¿— |
| `adb logcat | grep &lt;å…³é”®è¯&gt;` | åœ¨æ—¥å¿—ä¸­æœç´¢å…³é”®è¯ (åŒºåˆ†å¤§å°å†™) |

* *æ—¥å¿—ä¼˜å…ˆçº§:**

* `V` â€” Verbose (æœ€ä½)

* `D` â€” Debug

* `I` â€” Info

* `W` â€” Warning

* `E` â€” Error

* `F` â€” Fatal

* `S` â€” Silent (æœ€é«˜)

* *ç¤ºä¾‹:** `adb logcat *:S MyApp:D` åªæ˜¾ç¤ºæ ‡ç­¾ä¸º &quot;MyApp&quot; ä¸”ä¼˜å…ˆçº§ä¸º Debug æˆ–æ›´é«˜çš„æ—¥å¿—ã€‚

- --

### é«˜çº§ Shell å‘½ä»¤

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `adb shell input text &#39;&lt;æ–‡æœ¬&gt;&#39;` | å‘å½“å‰è¾“å…¥æ¡†è¾“å…¥æ–‡æœ¬ï¼ˆä¸æ”¯æŒä¸­æ–‡ï¼‰ |
| `adb shell input keyevent &lt;æŒ‰é”®ç &gt;` | å‘é€ä¸€ä¸ªæŒ‰é”®äº‹ä»¶ (ä¾‹å¦‚ `3`=HOME, `4`=BACK, `26`=POWER) |
| `adb shell input tap &lt;x&gt; &lt;y&gt;` | æ¨¡æ‹Ÿåœ¨å±å¹•æŒ‡å®šåæ ‡çš„å•å‡»äº‹ä»¶ |
| `adb shell input swipe &lt;x1&gt; &lt;y1&gt; &lt;x2&gt; &lt;y2&gt; [æ—¶é•¿ms]` | æ¨¡æ‹Ÿæ»‘åŠ¨äº‹ä»¶ |
| `adb shell settings get &lt;å‘½åç©ºé—´&gt; &lt;é”®&gt;` | è·å–ç³»ç»Ÿè®¾ç½®é¡¹çš„å€¼ |
| `adb shell settings put &lt;å‘½åç©ºé—´&gt; &lt;é”®&gt; &lt;å€¼&gt;` | ä¿®æ”¹ç³»ç»Ÿè®¾ç½®é¡¹çš„å€¼ |
| `adb shell content query --uri &lt;URI&gt;` | æŸ¥è¯¢ Content Provider ä¸­çš„æ•°æ® |
| `adb shell ime list -s` | åˆ—å‡ºå¯ç”¨çš„è¾“å…¥æ³• |
| `adb shell ime set &lt;è¾“å…¥æ³•ID&gt;` | è®¾ç½®é»˜è®¤è¾“å…¥æ³• |



&lt;!-- 02-Tools/Dynamic/frida_guide.md --&gt;

# Frida å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬ API å¤§å…¨

Frida æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç æ’æ¡©å·¥å…·åŒ…ï¼Œå®ƒå…è®¸æ‚¨å°†è‡ªå·±çš„è„šæœ¬æ³¨å…¥åˆ°é»‘ç›’è¿›ç¨‹ä¸­ã€‚å®ƒå¯¹äºé€†å‘å·¥ç¨‹ã€å®‰å…¨ç ”ç©¶å’Œåº”ç”¨è°ƒè¯•éå¸¸æœ‰ç”¨ã€‚

- --

## ç›®å½•
- [Frida å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬ API å¤§å…¨](#frida-å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬-api-å¤§å…¨)
- [ç›®å½•](#ç›®å½•)
- [Frida å·¥å…·é›†](#frida-å·¥å…·é›†)

- [è¿æ¥ä¸é™„åŠ æ¨¡å¼](#è¿æ¥ä¸é™„åŠ æ¨¡å¼)

- [JavaScript API (æ ¸å¿ƒ)](#javascript-api-æ ¸å¿ƒ)
- [Java (Android)](#java-android)

- [Objective-C (iOS)](#objective-c-ios)

- [é€šç”¨/åŸç”Ÿ (Native)](#é€šç”¨åŸç”Ÿ-native)
- [å¸¸ç”¨è„šæœ¬åœºæ™¯ä¸ç¤ºä¾‹](#å¸¸ç”¨è„šæœ¬åœºæ™¯ä¸ç¤ºä¾‹)
- [1. Hook ä¸€ä¸ªç®€å•æ–¹æ³•å¹¶æ‰“å°å‚æ•°](#1-hook-ä¸€ä¸ªç®€å•æ–¹æ³•å¹¶æ‰“å°å‚æ•°)

- [2. ä¿®æ”¹æ–¹æ³•è¿”å›å€¼](#2-ä¿®æ”¹æ–¹æ³•è¿”å›å€¼)

- [3. æŸ¥æ‰¾å®ä¾‹å¹¶è°ƒç”¨å…¶æ–¹æ³•](#3-æŸ¥æ‰¾å®ä¾‹å¹¶è°ƒç”¨å…¶æ–¹æ³•)

- [4. Hook æ„é€ å‡½æ•°](#4-hook-æ„é€ å‡½æ•°)

- [5. è·Ÿè¸ªåŸç”Ÿå‡½æ•°è°ƒç”¨ (SSL Pinning ç»•è¿‡å¸¸è§ç›®æ ‡)](#5-è·Ÿè¸ªåŸç”Ÿå‡½æ•°è°ƒç”¨-ssl-pinning-ç»•è¿‡å¸¸è§ç›®æ ‡)
- [RPC (è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)](#rpc-è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)

- --

## # Frida å·¥å…·é›†

è¿™äº›æ˜¯åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨çš„æ ¸å¿ƒ Frida å‘½ä»¤è¡Œå·¥å…·ã€‚

| å‘½ä»¤ | æè¿° |
| --- | --- |
| `frida --version` | æŸ¥çœ‹ Frida ç‰ˆæœ¬ |
| `frida-ps -U` | åˆ—å‡º USB è¿æ¥è®¾å¤‡ä¸Šçš„æ‰€æœ‰è¿›ç¨‹ |
| `frida-ps -Ua` | åˆ—å‡º USB è¿æ¥è®¾å¤‡ä¸Šæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº |
| `frida-ps -Uai` | åˆ—å‡º USB è¿æ¥è®¾å¤‡ä¸Šæ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨ç¨‹åºåŠå…¶æ ‡è¯†ç¬¦ |
| `frida-trace -U -f &lt;åŒ…å&gt; -i &quot;&lt;æ–¹æ³•&gt;&quot;` | è·Ÿè¸ªæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ï¼ˆé™„åŠ åˆ°æ–°è¿›ç¨‹ï¼‰|
| `frida-trace -U -p &lt;PID&gt; -i &quot;&lt;æ–¹æ³•&gt;&quot;` | è·Ÿè¸ªæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ï¼ˆé™„åŠ åˆ°ç°æœ‰è¿›ç¨‹ï¼‰|
| `frida -U -f &lt;åŒ…å&gt; -l &lt;è„šæœ¬.js&gt;` | Spawn ä¸€ä¸ªæ–°è¿›ç¨‹å¹¶æ³¨å…¥è„šæœ¬ |
| `frida -U -p &lt;PID&gt; -l &lt;è„šæœ¬.js&gt;` | é™„åŠ åˆ°ç°æœ‰è¿›ç¨‹å¹¶æ³¨å…¥è„šæœ¬ |
| `frida -U --no-pause -f &lt;åŒ…å&gt; -l &lt;è„šæœ¬.js&gt;` | Spawn æ–°è¿›ç¨‹å¹¶æ³¨å…¥è„šæœ¬ï¼Œä¸”ä¸æš‚åœä¸»çº¿ç¨‹ |

- --

## # è¿æ¥ä¸é™„åŠ æ¨¡å¼

Frida æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹å¼æ¥ hook åº”ç”¨ï¼š

* **Spawn (Spawning)**: Frida å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶ç«‹å³æš‚åœä¸»çº¿ç¨‹ï¼Œä»¥ä¾¿æ‚¨åœ¨åº”ç”¨ä»£ç æ‰§è¡Œå‰æ³¨å…¥è„šæœ¬ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—©æœŸè¿›è¡Œ Hook çš„åœºæ™¯ã€‚ä½¿ç”¨ `-f &lt;åŒ…å&gt;` å‚æ•°ã€‚

* **Attach (Attaching)**: Frida é™„åŠ åˆ°å·²ç»åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸Šã€‚è¿™å¯¹äº hook é‚£äº›åœ¨åº”ç”¨è¿è¡Œä¸­é€”æ‰ä¼šè§¦å‘çš„åŠŸèƒ½å¾ˆæœ‰ç”¨ã€‚ä½¿ç”¨ `-p &lt;PID&gt;` æˆ–åº”ç”¨åç§°ã€‚

- --

## # JavaScript API (æ ¸å¿ƒ)

è¿™æ˜¯ Frida è„šæœ¬çš„æ ¸å¿ƒã€‚æ‰€æœ‰é€»è¾‘éƒ½åœ¨ JavaScript è„šæœ¬ä¸­å®ç°ã€‚

### Java (android)

è¿™äº› API ç”¨äºä¸ Android çš„ Java è¿è¡Œæ—¶è¿›è¡Œäº¤äº’ã€‚æ‰€æœ‰ Java ç›¸å…³ä»£ç éƒ½å¿…é¡»åŒ…è£¹åœ¨ `Java.perform(function() { ... });` ä¸­ã€‚

| API/ä»£ç ç‰‡æ®µ | æè¿° |
| --- | --- |
| `Java.perform(function() { ... });` | Frida ä¸­ä¸ Java äº¤äº’çš„å…¥å£ç‚¹å’Œä½œç”¨åŸŸ |
| `Java.available` | æ£€æŸ¥ Java VM æ˜¯å¦å¯ç”¨ |
| `var MyClass = Java.use(&#39;com.example.MyClass&#39;);` | è·å–ä¸€ä¸ªç±»çš„åŒ…è£…å™¨ï¼Œç”¨äºæ–¹æ³• Hook æˆ–åˆ›å»ºå®ä¾‹ |
| `MyClass.myMethod.implementation = function(...) { ... }` | æ›¿æ¢ï¼ˆHookï¼‰ä¸€ä¸ªæ–¹æ³•çš„å®ç° |
| `this.myMethod(...)` | åœ¨ Hook çš„å®ç°ä¸­è°ƒç”¨åŸå§‹æ–¹æ³• |
| `MyClass.$new()` | åˆ›å»ºä¸€ä¸ªç±»çš„æ–°å®ä¾‹ |
| `Java.choose(&#39;com.example.MyClass&#39;, { onMatch: ..., onComplete: ... })` | æŸ¥æ‰¾å †ä¸Šç‰¹å®šç±»çš„æ‰€æœ‰æ´»åŠ¨å®ä¾‹ |
| `Java.cast(obj, MyClass)` | å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºç‰¹å®šçš„ç±»ç±»å‹ |
| `Java.backtrace(this.context, true)` | è·å–å½“å‰çº¿ç¨‹çš„ Java è°ƒç”¨å †æ ˆ |
| `send(data)` | ä»è„šæœ¬å‘ Python/Node.js å·¥å…·å‘é€æ¶ˆæ¯ |
| `recv(callback)` | ä» Python/Node.js å·¥å…·æ¥æ”¶æ¶ˆæ¯ |

### Objective-C (iOS)

è¿™äº› API ç”¨äºä¸ iOS çš„ Objective-C è¿è¡Œæ—¶è¿›è¡Œäº¤äº’ã€‚

| API/ä»£ç ç‰‡æ®µ | æè¿° |
| --- | --- |
| `ObjC.classes.MyClass` | è·å–ä¸€ä¸ªç±»çš„å¼•ç”¨ |
| `Interceptor.attach(ObjC.classes.MyClass[&#39;- myMethod&#39;], { ... })` | é™„åŠ åˆ°æ–¹æ³•çš„å®ç° (Native Interceptor) |
| `ObjC.choose(ObjC.classes.MyClass, { ... })` | æŸ¥æ‰¾ç‰¹å®šç±»çš„æ‰€æœ‰æ´»åŠ¨å®ä¾‹ |
| `ObjC.available` | æ£€æŸ¥ Objective-C è¿è¡Œæ—¶æ˜¯å¦å¯ç”¨ |

### é€šç”¨/åŸç”Ÿ (Native)

è¿™äº› API ç”¨äºä¸åŸç”Ÿä»£ç ï¼ˆC/C++ï¼‰è¿›è¡Œäº¤äº’ï¼Œè·¨å¹³å°é€šç”¨ã€‚

| API/ä»£ç ç‰‡æ®µ | æè¿° |
| --- | --- |
| `Interceptor.attach(ptr(&quot;...&quot;), { onEnter: ..., onLeave: ... })` | æ‹¦æˆªæŒ‡å®šåœ°å€çš„åŸç”Ÿå‡½æ•°è°ƒç”¨ |
| `Module.findExportByName(&quot;libname.so&quot;, &quot;function_name&quot;)` | æŒ‰åç§°æŸ¥æ‰¾æ¨¡å—ï¼ˆåº“ï¼‰çš„å¯¼å‡ºå‡½æ•°åœ°å€ |
| `Module.findBaseAddress(&quot;libname.so&quot;)` | è·å–æ¨¡å—åŠ è½½çš„åŸºåœ°å€ |
| `Memory.readByteArray(address, size)` | ä»æŒ‡å®šåœ°å€è¯»å–å­—èŠ‚æ•°ç»„ |
| `Memory.writeByteArray(address, bytes)` | å‘æŒ‡å®šåœ°å€å†™å…¥å­—èŠ‚æ•°ç»„ |
| `NativeFunction(address, returnType, argTypes)` | åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨çš„åŸç”Ÿå‡½æ•°å¯¹è±¡ |
| `ptr(&quot;0x...&quot;)` | åˆ›å»ºä¸€ä¸ªåŸç”ŸæŒ‡é’ˆ |
| `Thread.backtrace(this.context, Backtracer.ACCURATE)` | è·å–å½“å‰çº¿ç¨‹çš„åŸç”Ÿè°ƒç”¨å †æ ˆ |

### JNI (Java Native Interface)

JNI æ˜¯ Android é€†å‘ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒFrida æä¾›äº†å¼ºå¤§çš„ JNI Hook èƒ½åŠ›ã€‚

| API/ä»£ç ç‰‡æ®µ | æè¿° |
| --- | --- |
| `Module.findExportByName(&quot;lib.so&quot;, &quot;Java_com_pkg_Class_method&quot;)` | æŸ¥æ‰¾ JNI å‡½æ•°åœ°å€ |
| `Java.vm.getEnv()` | è·å–å½“å‰çº¿ç¨‹çš„ JNIEnv æŒ‡é’ˆ |
| `Java.vm.tryGetEnv()` | å°è¯•è·å– JNIEnvï¼ˆä¸ä¼šæŠ›å¼‚å¸¸ï¼‰ |
| `Java.vm.perform(callback)` | åœ¨ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¸­æ‰§è¡Œå›è°ƒ |

* *JNI Hook ç¤ºä¾‹**ï¼š

```javascript
// Hook JNI Function
var jni_func = Module.findExportByName(&quot;libnative.so&quot;, 
&quot;Java_com_example_app_Crypto_encrypt&quot;);

if (jni_func) {
Interceptor.attach(jni_func, {
onEnter: function(args) {
console.log(&quot;[JNI Hook] encrypt() called&quot;);

// args[0] = JNIEnv*
// args[1] = jclass/jobject
// args[2] = first Java parameter

// Read jstring parameter
if (args[2]) {
var env = Java.vm.getEnv();
var jstr = args[2];
var cstr = env.getStringUtfChars(jstr, null);
console.log(&quot;Input: &quot; + cstr.readCString());
env.releaseStringUtfChars(jstr, cstr);
}
},
onLeave: function(retval) {
// Read returned jstring
if (retval &amp;&amp; !retval.isNull()) {
var env = Java.vm.getEnv();
var cstr = env.getStringUtfChars(retval, null);
console.log(&quot;Output: &quot; + cstr.readCString());
env.releaseStringUtfChars(retval, cstr);
}
}
});
}

// Also hook the native method call from Java layer
Java.perform(function() {
var Crypto = Java.use(&quot;com.example.app.Crypto&quot;);

Crypto.encrypt.implementation = function(input) {
console.log(&quot;[Java Hook] encrypt called with: &quot; + input);
var result = this.encrypt(input);
console.log(&quot;[Java Hook] encrypt returned: &quot; + result);
return result;
};
});
</code></pre>
<p>var module = Process.getModuleByName(moduleName); var exports =
module.enumerateExports();</p>
<p>console.log(â€œ[JNI Enumeration]â€ + moduleName);
exports.forEach(function(exp) { if (exp.name.startsWith(â€œJava_â€)) {
console.log(â€ â€ + exp.name + â€ @ â€ + exp.address); } }); }</p>
<p>// Usage example enumerateJNIFunctions(â€œlibnative.soâ€);</p>
<pre><code>Java.perform(function() {
var MyClass = Java.use(&#39;com.example.SecretClass&#39;);

MyClass.secretMethod.implementation = function(arg1, arg2) {
console.log(&#39;secretMethod called with:&#39;, arg1, arg2);

// Call original method and get return value
var retval = this.secretMethod(arg1, arg2);
console.log(&#39;Original return value:&#39;, retval);

return retval; // Return original value
};
});
</code></pre>
<p>PremiumUtils.isUserPremium.implementation = function() {
console.log(â€˜Bypassing isUserPremium checkâ€¦â€™); return true; // Always
return true to bypass VIP check }; });</p>
<pre><code>onMatch: function(instance) {
console.log(&#39;Found UserManager instance:&#39;, instance);
console.log(&#39;User ID:&#39;, instance.getUserId());
},
onComplete: function() {
console.log(&#39;Search complete.&#39;);
}
});
});
</code></pre>
<p>User.$init.implementation = function(name, age) { console.log(â€˜User
object created with name:â€™, name, â€˜and age:â€™, age);</p>
<p>// Call original constructor this.$init(name, age); }; });</p>
<pre><code>// args[0] is the SSL context
// args[1] is the buffer
// args[2] is the size
console.log(&quot;Intercepted SSL_write, size:&quot;, args[2].toInt32());
// You can use hexdump(args[1]) to view the data
},
onLeave: function(retval) {
// retval is the original return value
console.log(&quot;SSL_write returned:&quot;, retval.toInt32());
}
});
</code></pre>
<div class="sourceCode" id="cb394"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSecretValueFromApp</span>() {</span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> secret <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Assume there&#39;s a method to get the secret value</span></span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Utils <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;com.example.Utils&#39;</span>)<span class="op">;</span></span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>secret <span class="op">=</span> Utils<span class="op">.</span><span class="fu">getSecret</span>()<span class="op">;</span></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> secret<span class="op">;</span></span>
<span id="cb394-9"><a href="#cb394-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb394-10"><a href="#cb394-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-11"><a href="#cb394-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Export function</span></span>
<span id="cb394-12"><a href="#cb394-12" aria-hidden="true" tabindex="-1"></a>rpc<span class="op">.</span><span class="at">exports</span><span class="op">.</span><span class="at">getsecret</span> <span class="op">=</span> getSecretValueFromApp<span class="op">;</span></span></code></pre></div>
<h1 id="connect-to-device-and-attach-to-process">â€¦ Connect to device and
attach to process â€¦</h1>
<h1 id="script-session.create_scriptjs_code">script =
session.create_script(js_code)</h1>
<h1 id="section-16">â€¦</h1>
<h1 id="script.load">script.load()</h1>
<h1 id="call-the-exported-function-from-the-script">Call the exported
function from the script</h1>
<p>secret = script.exports.getsecret() print(â€œSecret from app:â€,
secret)</p>
<pre><code></code></pre>
<!-- 02-Tools/Dynamic/frida_internals.md -->
<h1 id="frida-æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†">Frida æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†</h1>
<p>Frida
æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åŠ¨æ€æ’æ¡©æ¡†æ¶ï¼Œä½†è¦å……åˆ†åˆ©ç”¨å®ƒï¼Œç†è§£å…¶å†…éƒ¨å·¥ä½œåŸç†è‡³å…³é‡è¦ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨æ„æˆ
Frida çš„å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ã€å®ƒä»¬çš„ä½œç”¨ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚</p>
<hr />
<h2 id="ç›®å½•-5">ç›®å½•</h2>
<ul>
<li><p><a href="#frida-æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†">Frida
æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#frida-çš„æ¶æ„æ¦‚è§ˆ">Frida çš„æ¶æ„æ¦‚è§ˆ</a></p></li>
<li><p><a href="#æ ¸å¿ƒç»„ä»¶è¯¦è§£">æ ¸å¿ƒç»„ä»¶è¯¦è§£</a></p></li>
<li><p><a
href="#frida-server-è®¾å¤‡ç«¯çš„å®ˆæŠ¤è¿›ç¨‹"><strong>Frida-Server</strong>:
è®¾å¤‡ç«¯çš„å®ˆæŠ¤è¿›ç¨‹</a></p></li>
<li><p><a
href="#frida-core-æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„æ ¸å¿ƒå¼•æ“"><strong>Frida-Core</strong>:
æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„æ ¸å¿ƒå¼•æ“</a></p></li>
<li><p><a
href="#frida-gum-å®ç°-hook-çš„é­”æ³•æ£’"><strong>Frida-Gum</strong>: å®ç°
Hook çš„é­”æ³•æ£’</a></p></li>
<li><p><a href="#interceptor-å‡½æ•°æ‹¦æˆªå™¨"><code>Interceptor</code>:
å‡½æ•°æ‹¦æˆªå™¨</a></p></li>
<li><p><a href="#stalker-æŒ‡ä»¤çº§è·Ÿè¸ªå™¨"><code>Stalker</code>:
æŒ‡ä»¤çº§è·Ÿè¸ªå™¨</a></p></li>
<li><p><a href="#javascript-v8-è¿è¡Œæ—¶-è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒ"><strong>JavaScript
(V8) è¿è¡Œæ—¶</strong>: è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒ</a></p></li>
<li><p><a href="#è¯­è¨€ç»‘å®š-bindings-ä½ çš„æ§åˆ¶å°"><strong>è¯­è¨€ç»‘å®š
(Bindings)</strong>: ä½ çš„æ§åˆ¶å°</a></p></li>
<li><p><a href="#å·¥ä½œæµç¨‹ä¸²è®²">å·¥ä½œæµç¨‹ä¸²è®²</a></p></li>
</ul>
<hr />
<h3 id="frida-çš„architectureæ¦‚è§ˆ">Frida çš„architectureæ¦‚è§ˆ</h3>
<p>Frida é‡‡ç”¨çš„æ˜¯ä¸€ç§<strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨ (Client-Server)</strong>
æ¶æ„ã€‚</p>
<p>!!! question â€œæ€è€ƒï¼šä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å¤æ‚çš„æ¶æ„ï¼Ÿâ€ Frida
ä¸ºä»€ä¹ˆä¸è®¾è®¡æˆä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œè€Œè¦åˆ†æˆå®¢æˆ·ç«¯ã€æœåŠ¡å™¨ã€Agent ä¸‰å±‚ï¼Ÿ</p>
<ul>
<li>*è·¨å¹³å°çš„å¿…ç„¶é€‰æ‹©**ï¼š</li>
<li><strong>éš”ç¦»æ€§</strong>ï¼šä½ çš„åˆ†æè„šæœ¬ï¼ˆPythonï¼‰è¿è¡Œåœ¨
PCï¼Œä¸ä¼šå½±å“ç›®æ ‡è®¾å¤‡çš„æ€§èƒ½</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šServer
åªè´Ÿè´£è¿›ç¨‹ç®¡ç†å’Œæ³¨å…¥ï¼ŒçœŸæ­£çš„â€å±é™©æ“ä½œâ€åœ¨éš”ç¦»çš„è¿›ç¨‹å†…</li>
<li><strong>çµæ´»æ€§</strong>ï¼šåŒä¸€ä¸ª Server
å¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡ï¼Œæ”¯æŒå›¢é˜Ÿåä½œ</li>
<li><strong>è·¨è¯­è¨€</strong>ï¼šPC ç«¯ç”¨ Python/Node.js
ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œç›®æ ‡è¿›ç¨‹å†…ç”¨ JavaScript æ“ä½œå†…å­˜ï¼Œå„å–æ‰€é•¿</li>
</ul>
<p>è¿™ç§æ¶æ„çš„æœ¬è´¨æ˜¯ï¼š<strong>æŠŠâ€æ§åˆ¶â€å’Œâ€æ‰§è¡Œâ€åˆ†ç¦»</strong>ï¼Œå°±åƒé¥æ§æ— äººæœºâ€”â€”é¥æ§å™¨åœ¨ä½ æ‰‹ä¸Šï¼Œä½†é£è¡Œé€»è¾‘åœ¨æœºä¸Šã€‚</p>
<ul>
<li><p><strong>å®¢æˆ·ç«¯ (Client)</strong>: è¿è¡Œåœ¨ä½  PC
ä¸Šçš„éƒ¨åˆ†ã€‚è¿™åŒ…æ‹¬ä½ ç¼–å†™çš„ Python æˆ– Node.js è„šæœ¬ï¼Œä»¥åŠä½ ä½¿ç”¨çš„ Frida
å‘½ä»¤è¡Œå·¥å…· (<code>frida</code>, <code>frida-trace</code> ç­‰)ã€‚</p></li>
<li><p><strong>æœåŠ¡å™¨ (Server)</strong>: åœ¨ç›®æ ‡è®¾å¤‡ï¼ˆå¦‚ Android
æ‰‹æœºï¼‰ä¸Šä»¥åå°å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œçš„ <code>frida-server</code>ã€‚</p></li>
<li><p><strong>Agent</strong>: å½“ä½ é™„åŠ åˆ°ä¸€ä¸ªç›®æ ‡è¿›ç¨‹æ—¶ï¼ŒFrida
ä¼šå°†ä¸€ä¸ªåŠ¨æ€åº“ (<code>frida-agent.so</code>)
<strong>æ³¨å…¥</strong>åˆ°è¯¥è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ã€‚è¿™ä¸ª Agent
è´Ÿè´£æ‰§è¡Œä½ åœ¨å®¢æˆ·ç«¯è„šæœ¬ä¸­å®šä¹‰çš„é€»è¾‘ã€‚</p></li>
</ul>
<p><img src="https://frida.re/static/images/frida-architecture.png"
alt="Frida Architecture" /> * å›¾ç‰‡æ¥æº: frida.re*</p>
<hr />
<h3 id="æ ¸å¿ƒç»„ä»¶è¯¦è§£">æ ¸å¿ƒç»„ä»¶è¯¦è§£</h3>
<h4 id="frida-server-è®¾å¤‡ç«¯çš„å®ˆæŠ¤è¿›ç¨‹"><strong>Frida-Server</strong>:
è®¾å¤‡ç«¯çš„å®ˆæŠ¤è¿›ç¨‹</h4>
<p><code>frida-server</code>
æ˜¯ä¸€ä¸ªåœ¨ç›®æ ‡è®¾å¤‡ä¸Šè¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒçš„ä¸»è¦èŒè´£æ˜¯ï¼š 1.
<strong>ç›‘å¬è¿æ¥</strong>: ç›‘å¬æ¥è‡ªä½  PC ä¸Š Frida å®¢æˆ·ç«¯çš„ TCP è¿æ¥ã€‚ 2.
<strong>è¿›ç¨‹ç®¡ç†</strong>: æšä¸¾ç›®æ ‡è®¾å¤‡ä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè·å–åº”ç”¨ä¿¡æ¯ã€‚
3. <strong>æ³¨å…¥ Agent</strong>: å½“å®¢æˆ·ç«¯æŒ‡å®šè¦é™„åŠ  (attach) æˆ–å¯åŠ¨
(spawn) ä¸€ä¸ªåº”ç”¨æ—¶ï¼Œ<code>frida-server</code> è´Ÿè´£å°†
<code>frida-agent.so</code> æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹ä¸­ã€‚åœ¨ Android ä¸Šï¼Œå®ƒé€šå¸¸é€šè¿‡
<code>ptrace</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<h4 id="frida-core-æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„æ ¸å¿ƒå¼•æ“"><strong>Frida-Core</strong>:
æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„æ ¸å¿ƒå¼•æ“</h4>
<p><code>frida-core</code> æ˜¯ Frida çš„æ ¸å¿ƒï¼Œå®ƒè¢«ç¼–è¯‘æˆ
<code>frida-agent.so</code> å¹¶æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨ C
è¯­è¨€ç¼–å†™çš„å¤šå¹³å°åº“ï¼Œä¸»è¦è´Ÿè´£ï¼š 1. <strong>è¿›ç¨‹å†…é€šä¿¡</strong>:
å»ºç«‹ä¸€ä¸ªä¸ <code>frida-server</code> çš„é€šä¿¡æ¸ é“ï¼Œä»è€Œé—´æ¥åœ°ä¸ä½ çš„ PC
å®¢æˆ·ç«¯é€šä¿¡ã€‚ 2. <strong>åŠ è½½ JavaScript å¼•æ“</strong>: å®ƒå†…éƒ¨åµŒå…¥äº†ä¸€ä¸ª
Google V8 JavaScript å¼•æ“ã€‚ 3. <strong>æš´éœ²åŸç”Ÿ API</strong>: å°†åº•å±‚çš„
<code>frida-gum</code> åŠŸèƒ½é€šè¿‡ JavaScript API (å¦‚
<code>Interceptor</code>, <code>Memory</code>,
<code>NativePointer</code>) æš´éœ²ç»™ç”¨æˆ·è„šæœ¬ã€‚</p>
<h4 id="frida-gum-å®ç°-hook-çš„é­”æ³•æ£’"><strong>Frida-Gum</strong>: å®ç°
Hook çš„é­”æ³•æ£’</h4>
<p><code>frida-gum</code> æ˜¯ <code>frida-core</code>
ä¸­æœ€å…·é­”åŠ›çš„éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ä»£ç æ’æ¡©å·¥å…·åŒ…ã€‚æ‰€æœ‰ Hook
å’Œä»£ç è·Ÿè¸ªåŠŸèƒ½éƒ½ç”±å®ƒæä¾›ã€‚</p>
<h5 id="interceptor-å‡½æ•°æ‹¦æˆªå™¨"><code>Interceptor</code>:
å‡½æ•°æ‹¦æˆªå™¨</h5>
<p><code>Interceptor</code> æ˜¯ä½ æœ€å¸¸ä½¿ç”¨çš„åŠŸèƒ½ï¼Œç”¨äº
Hook/Trace/æ›¿æ¢ä»»æ„å‡½æ•°ã€‚</p>
<p>!!! tip â€œæ·±å…¥ç†è§£ï¼šHook çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿâ€ å¾ˆå¤šäººæŠŠ Hook
å½“æˆâ€é»‘é­”æ³•â€ï¼Œä½†å…¶å®åŸç†å¾ˆæœ´ç´ ï¼š</p>
<ul>
<li>*Hook = åŠ«æŒç¨‹åºçš„æ‰§è¡Œæµ**</li>
</ul>
<p>æƒ³è±¡ä½ åœ¨é«˜é€Ÿå…¬è·¯ä¸Šè®¾ç½®äº†ä¸€ä¸ªæ”¶è´¹ç«™ï¼š 1.
<strong>åŸå§‹é“è·¯</strong>ï¼šå‡½æ•°çš„æ­£å¸¸æ‰§è¡Œæµç¨‹ 2.
<strong>æ”¶è´¹ç«™ï¼ˆTrampolineï¼‰</strong>ï¼šä½ æ’å…¥çš„ä»£ç  3.
<strong>æ”¹é“æ ‡å¿—ï¼ˆJMPï¼‰</strong>ï¼šä¿®æ”¹å‡½æ•°å…¥å£çš„è·³è½¬æŒ‡ä»¤ 4.
<strong>æ¢å¤é€šè¡Œ</strong>ï¼šæ‰§è¡ŒåŸå§‹æŒ‡ä»¤åç»§ç»­</p>
<p>ç†è§£äº†è¿™ä¸ªæœ¬è´¨ï¼Œä½ å°±èƒ½ï¼š - åˆ¤æ–­å“ªäº› Hook
ä¼šç›¸äº’å†²çªï¼ˆéƒ½ä¿®æ”¹åŒä¸€ä¸ªå‡½æ•°å…¥å£ï¼‰ - ç†è§£ä¸ºä»€ä¹ˆæœ‰äº›å Hook
æ£€æµ‹èƒ½å‘ç°ä½ ï¼ˆæ£€æŸ¥å‡½æ•°å¤´çš„ä¿®æ”¹ï¼‰ - çŸ¥é“å¦‚ä½•å†™æ›´éšè”½çš„ Hookï¼ˆinline hook
vs.Â PLT/GOT hookï¼‰</p>
<ul>
<li><strong>å®ç°åŸç†</strong>:</li>
</ul>
<ol type="1">
<li><strong>åŠ¨æ€ä»£ç ç”Ÿæˆ</strong>: å½“ä½  <code>Interceptor.attach</code>
ä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒFrida-Gum
ä¼šåœ¨å†…å­˜ä¸­åŠ¨æ€åœ°ç”Ÿæˆä¸€å°æ®µæ±‡ç¼–ä»£ç ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>è¹¦åºŠ
(Trampoline)</strong>ã€‚</li>
<li><strong>å‡½æ•°å¤´é‡å†™ (Prologue Rewriting)</strong>: Frida-Gum
ä¼šä¿®æ”¹ç›®æ ‡å‡½æ•°å…¥å£ç‚¹ï¼ˆå‡½æ•°å¤´ï¼‰çš„å‡ æ¡æŒ‡ä»¤ï¼Œå°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ª<strong>æ— æ¡ä»¶è·³è½¬
(<code>JMP</code>) æŒ‡ä»¤</strong>ï¼Œè¯¥æŒ‡ä»¤æŒ‡å‘åˆšåˆšåˆ›å»ºçš„è¹¦åºŠã€‚Frida
ä¼šéå¸¸å°å¿ƒåœ°ä¿å­˜è¢«å®ƒè¦†ç›–æ‰çš„åŸå§‹æŒ‡ä»¤ã€‚</li>
<li><strong>æ‰§è¡Œæµç¨‹</strong>:</li>
</ol>
<ul>
<li><p>å½“åº”ç”¨è°ƒç”¨ç›®æ ‡å‡½æ•°æ—¶ï¼Œå®ƒä¼šé¦–å…ˆè·³è½¬åˆ°è¹¦åºŠã€‚</p></li>
<li><p>è¹¦åºŠä»£ç ä¼šä¿å­˜å½“å‰çš„ CPU ä¸Šä¸‹æ–‡ï¼ˆå¯„å­˜å™¨çŠ¶æ€ï¼‰ï¼Œç„¶åè°ƒç”¨ä½ åœ¨
JavaScript ä¸­å®šä¹‰çš„ <code>onEnter</code> å›è°ƒã€‚</p></li>
<li><p><code>onEnter</code>
æ‰§è¡Œå®Œæ¯•åï¼Œè¹¦åºŠä¼šæ‰§è¡Œè¢«å®ƒè¦†ç›–æ‰çš„åŸå§‹å‡½æ•°æŒ‡ä»¤ï¼Œç„¶åè·³è½¬å›åŸå§‹å‡½æ•°çš„å‰©ä½™éƒ¨åˆ†ç»§ç»­æ‰§è¡Œã€‚</p></li>
<li><p>å½“åŸå§‹å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œæ§åˆ¶æƒè¿”å›ç»™è¹¦åºŠï¼Œè¹¦åºŠå†è°ƒç”¨ä½ çš„
<code>onLeave</code> å›è°ƒã€‚</p></li>
<li><p>æœ€åï¼Œè¹¦åºŠæ¢å¤ä¹‹å‰ä¿å­˜çš„ CPU
ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†è¿”å›å€¼ä¼ é€’ç»™åŸå§‹çš„è°ƒç”¨è€…ã€‚</p></li>
</ul>
<h5 id="stalker-æŒ‡ä»¤çº§è·Ÿè¸ªå™¨"><code>Stalker</code>: æŒ‡ä»¤çº§è·Ÿè¸ªå™¨</h5>
<p><code>Stalker</code> æ˜¯ Frida
çš„ä»£ç è·Ÿè¸ªå¼•æ“ï¼ŒåŠŸèƒ½æå…¶å¼ºå¤§ä½†ä½¿ç”¨ä¹Ÿæ›´å¤æ‚ã€‚å®ƒå¯ä»¥ç”¨æ¥è®°å½•ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡çš„<strong>æ¯ä¸€æ¡</strong>æ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<ul>
<li><strong>å®ç°åŸç† (åŸºäºåŠ¨æ€é‡æ–°ç¼–è¯‘)</strong>:</li>
</ul>
<ol type="1">
<li><strong>åŸºæœ¬å— (Basic Block)</strong>: Stalker
å°†ä»£ç åˆ†è§£ä¸ºâ€œåŸºæœ¬å—â€ã€‚ä¸€ä¸ªåŸºæœ¬å—æ˜¯ä¸€ç³»åˆ—è¿ç»­çš„æŒ‡ä»¤ï¼Œåªæœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œä¸€ä¸ªå‡ºå£ç‚¹ï¼ˆé€šå¸¸æ˜¯è·³è½¬æˆ–è¿”å›æŒ‡ä»¤ï¼‰ã€‚</li>
<li><strong>ä»£ç æ‹·è´ä¸æ’æ¡©</strong>:
å½“ä¸€ä¸ªçº¿ç¨‹å°†è¦æ‰§è¡ŒæŸä¸ªåŸºæœ¬å—æ—¶ï¼ŒStalker ä¼šï¼š</li>
</ol>
<ol type="a">
<li>å°†è¿™ä¸ªåŸºæœ¬å—çš„æ‰€æœ‰æŒ‡ä»¤<strong>æ‹·è´</strong>åˆ°ä¸€å—æ–°çš„å†…å­˜åŒºåŸŸã€‚</li>
<li>åœ¨è¿™ä»½æ‹·è´ä¸­<strong>æ’å…¥</strong>ä½ çš„åˆ†æä»£ç ï¼ˆä¾‹å¦‚ï¼Œè®°å½•æŒ‡ä»¤åœ°å€ã€å¯„å­˜å™¨å€¼çš„ä»£ç ï¼‰ã€‚</li>
<li>æ‰§è¡Œè¿™ä»½è¢«æ’æ¡©åçš„ä»£ç å‰¯æœ¬ã€‚</li>
</ol>
<ol start="4" type="1">
<li><strong>ä»£ç ç¼“å­˜ (Code Cache)</strong>: Stalker
ä¼šç¼“å­˜è¿™äº›è¢«ä¿®æ”¹è¿‡çš„åŸºæœ¬å—ã€‚ä¸‹æ¬¡å†æ‰§è¡Œåˆ°åŒä¸€ä¸ªåŸºæœ¬å—æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„ç‰ˆæœ¬ï¼Œæå¤§åœ°æé«˜äº†æ€§èƒ½ã€‚</li>
<li><strong>é“¾æ¥ (Chaining)</strong>: Stalker
ä¼šä¿®æ”¹æ¯ä¸ªæ’æ¡©ååŸºæœ¬å—çš„æœ«å°¾ï¼Œä½¿å…¶è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå³å°†æ‰§è¡Œçš„åŸå§‹åŸºæœ¬å—å¯¹åº”çš„â€œæ’æ¡©ç‰ˆæœ¬â€ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è·Ÿè¸ªé“¾ã€‚</li>
</ol>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>Stalker</code>
é€šè¿‡åˆ›å»ºå’Œæ‰§è¡ŒåŸå§‹ä»£ç çš„â€œå¸¦ç›‘æ§çš„å‰¯æœ¬â€æ¥å®ç°æ— æ­»è§’çš„æŒ‡ä»¤çº§è·Ÿè¸ªã€‚</p>
<h4 id="javascript-v8-è¿è¡Œæ—¶-è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒ"><strong>JavaScript (V8)
è¿è¡Œæ—¶</strong>: è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒ</h4>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨ JavaScript å†™ Hook é€»è¾‘ï¼Ÿå› ä¸º
<code>frida-agent.so</code> åœ¨æ³¨å…¥ç›®æ ‡è¿›ç¨‹åï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ª V8
å¼•æ“å®ä¾‹ã€‚ä½ çš„ JS è„šæœ¬è¢«å®Œæ•´åœ°åŠ è½½åˆ°è¿™ä¸ª V8 å¼•æ“ä¸­æ‰§è¡Œã€‚</p>
<p>è¿™å¸¦æ¥äº†å·¨å¤§çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li><p><strong>é«˜çº§è¯­è¨€çš„ä¾¿åˆ©æ€§</strong>:
ä½ å¯ä»¥åœ¨ç›®æ ‡è¿›ç¨‹çš„åœ°å€ç©ºé—´å†…ï¼Œç”¨ JavaScript
çš„ä¾¿åˆ©æ€§æ¥æ“ä½œå†…å­˜ã€è°ƒç”¨å‡½æ•°ã€‚</p></li>
<li><p><strong>JIT ç¼–è¯‘</strong>: V8 çš„å³æ—¶ç¼–è¯‘ (JIT) ç‰¹æ€§ä½¿å¾—ä½ çš„ JS
è„šæœ¬èƒ½ä»¥æ¥è¿‘åŸç”Ÿçš„é€Ÿåº¦è¿è¡Œï¼Œæ€§èƒ½è¿œè¶…è§£é‡Šæ‰§è¡Œã€‚</p></li>
<li><p><strong>å¼ºå¤§çš„ç”Ÿæ€</strong>: å¯ä»¥åˆ©ç”¨ç°æœ‰çš„ JS åº“ã€‚</p></li>
</ul>
<h4 id="è¯­è¨€ç»‘å®š-bindings-ä½ çš„æ§åˆ¶å°"><strong>è¯­è¨€ç»‘å®š
(Bindings)</strong>: ä½ çš„æ§åˆ¶å°</h4>
<p><code>frida-python</code>, <code>frida-node</code>
ç­‰åº“æ˜¯ä½ çš„â€œæ§åˆ¶ç«¯â€ã€‚å®ƒä»¬è´Ÿè´£ï¼š</p>
<ul>
<li><p><strong>è¿æ¥ Server</strong>: ä¸è®¾å¤‡ä¸Šçš„
<code>frida-server</code> å»ºç«‹é€šä¿¡ã€‚</p></li>
<li><p><strong>å‘é€æŒ‡ä»¤</strong>: å°†ä½ çš„æŒ‡ä»¤ï¼ˆå¦‚â€œé™„åŠ åˆ° PID
1234â€ï¼‰å‘é€ç»™ <code>frida-server</code>ã€‚</p></li>
<li><p><strong>åŠ è½½è„šæœ¬</strong>: å°†ä½ çš„ <code>.js</code>
è„šæœ¬æ–‡ä»¶å†…å®¹å‘é€ç»™ <code>frida-agent.so</code> é‡Œçš„ V8
å¼•æ“å»æ‰§è¡Œã€‚</p></li>
<li><p><strong>åŒå‘é€šä¿¡ (RPC)</strong>: å»ºç«‹ä¸€ä¸ªåŒå‘çš„ RPC
é€šé“ã€‚è¿™ä½¿å¾—ä½ åœ¨ JS ä¸­è°ƒç”¨ <code>send()</code> çš„æ•°æ®èƒ½è¢« Python çš„
<code>on_message</code> å›è°ƒæ¥æ”¶ï¼Œåä¹‹äº¦ç„¶ã€‚</p></li>
</ul>
<hr />
<h3 id="å·¥ä½œæµç¨‹ä¸²è®²">å·¥ä½œæµç¨‹ä¸²è®²</h3>
<p>å½“ä½ æ‰§è¡Œ <code>frida -U -f com.example.app -l script.js</code>
æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<ol type="1">
<li><strong>[PC]</strong> <code>frida</code> (Python å®¢æˆ·ç«¯)
è§£æå‘½ä»¤ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯é€šè¿‡ USB è¿æ¥åˆ°æ‰‹æœºä¸Šçš„
<code>frida-server</code>ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯å‘ <code>frida-server</code>
å‘é€æŒ‡ä»¤ï¼šâ€œè¯·ä»¥ <code>spawn</code> æ¨¡å¼å¯åŠ¨
<code>com.example.app</code>â€ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-server</code> æ‰¾åˆ°
<code>com.example.app</code>
å¹¶å¯åŠ¨å®ƒï¼Œä½†ä½¿å…¶å¤„äº<strong>æš‚åœ</strong>çŠ¶æ€ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-server</code> å°†
<code>frida-agent.so</code> æ³¨å…¥åˆ°è¿™ä¸ªæ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ä¸­ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-agent.so</code>
åœ¨è¿›ç¨‹å†…åˆå§‹åŒ–ï¼Œå¯åŠ¨ V8 å¼•æ“ï¼Œå¹¶å»ºç«‹ä¸ <code>frida-server</code>
çš„å†…éƒ¨é€šä¿¡ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯è¯»å– <code>script.js</code>
çš„å†…å®¹ï¼Œå¹¶é€šè¿‡ <code>frida-server</code> å°†å…¶å‘é€ç»™
<code>frida-agent.so</code>ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-agent.so</code> ä¸­çš„ V8
å¼•æ“æ‰§è¡Œ <code>script.js</code>
çš„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œ<code>Interceptor.attach(...)</code>ï¼‰ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯å‘é€â€œæ¢å¤è¿›ç¨‹â€çš„æŒ‡ä»¤ã€‚</li>
<li><strong>[Phone]</strong>
åº”ç”¨è¿›ç¨‹ä»æš‚åœçŠ¶æ€ä¸­æ¢å¤ï¼Œå¼€å§‹æ­£å¸¸æ‰§è¡Œã€‚å½“å®ƒè°ƒç”¨è¢« Hook çš„å‡½æ•°æ—¶ï¼Œä½ åœ¨
<code>script.js</code> ä¸­å®šä¹‰çš„é€»è¾‘å°±ä¼šè¢«è§¦å‘ã€‚</li>
<li><strong>[åŒå‘]</strong> è„šæœ¬ä¸­çš„ <code>send()</code> æ¶ˆæ¯ä¼šé€šè¿‡
<code>agent -&gt; server -&gt; client</code> çš„è·¯å¾„å›åˆ°ä½ çš„ PC
ç»ˆç«¯ä¸Šæ˜¾ç¤ºã€‚</li>
</ol>
<!-- 02-Tools/Dynamic/unidbg_guide.md -->
<h1 id="unidbg-æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—</h1>
<p>Unidbg æ˜¯ä¸€ä¸ªåŸºäº Java å¼€å‘çš„ã€å¼€æºçš„ã€åŠŸèƒ½å¼ºå¤§çš„ Android/iOS åŸç”Ÿåº“
(<code>.so</code>/<code>.dylib</code>) æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ã€‚å®ƒèƒ½å¤Ÿåœ¨ PC
(Windows/Linux/macOS) ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ ARM
æ‰§è¡Œç¯å¢ƒï¼Œä½¿å¾—ä½ å¯ä»¥åƒè°ƒç”¨æœ¬åœ° Java
æ–¹æ³•ä¸€æ ·ç›´æ¥è°ƒç”¨å’Œè°ƒè¯•åŸç”Ÿåº“ä¸­çš„å‡½æ•°ã€‚è¿™å¯¹äºåˆ†æé«˜åº¦æ··æ·†ã€åŒ…å«å¤§é‡ç¯å¢ƒä¾èµ–å’Œåè°ƒè¯•æœºåˆ¶çš„åŸç”Ÿç®—æ³•æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªé©å‘½æ€§çš„å·¥å…·ã€‚
___ ## ç›®å½• - <a href="#unidbg-æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—">Unidbg
æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—</a> - <a href="#ç›®å½•">ç›®å½•</a> - <a
href="#æ ¸å¿ƒæ€æƒ³ä¸åº”ç”¨åœºæ™¯">æ ¸å¿ƒæ€æƒ³ä¸åº”ç”¨åœºæ™¯</a></p>
<ul>
<li><p><a href="#unidbg-vs-frida">Unidbg vs.Â Frida</a></p></li>
<li><p><a href="#ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</a></p></li>
<li><p><a href="#åŸºæœ¬ä½¿ç”¨æµç¨‹">åŸºæœ¬ä½¿ç”¨æµç¨‹</a></p></li>
<li><p><a href="#æ ¸å¿ƒ-api-ä¸æ¦‚å¿µ">æ ¸å¿ƒ API ä¸æ¦‚å¿µ</a></p></li>
<li><p><a href="#å®æˆ˜æŠ€å·§">å®æˆ˜æŠ€å·§</a> ___ ## #
æ ¸å¿ƒæ€æƒ³ä¸åº”ç”¨åœºæ™¯</p></li>
</ul>
<p>Unidbg çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>â€œæ¬ºéª—â€</strong>ã€‚å®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼è®©
<code>.so</code> æ–‡ä»¶è®¤ä¸ºè‡ªå·±æ­£è¿è¡Œåœ¨ä¸€ä¸ªçœŸå®çš„ Android è®¾å¤‡ä¸Šï¼š</p>
<ul>
<li><p><strong>æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</strong>:
åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½ å¯ä»¥å°†åº”ç”¨çš„æ•°æ®ã€é…ç½®æ–‡ä»¶ç­‰æ”¾å…¥å…¶ä¸­ã€‚</p></li>
<li><p><strong>æ¨¡æ‹Ÿå†…å­˜ç©ºé—´</strong>: åŠ è½½ <code>.so</code>
æ–‡ä»¶åŠå…¶ä¾èµ–çš„ç³»ç»Ÿåº“ (å¦‚ <code>libc.so</code>, <code>libdl.so</code>)
åˆ°æ¨¡æ‹Ÿçš„å†…å­˜ç©ºé—´ä¸­ã€‚</p></li>
<li><p><strong>æ¨¡æ‹Ÿ JNI ç¯å¢ƒ</strong>: å®ç°äº†å¤§éƒ¨åˆ† JNI å‡½æ•°ï¼Œå½“
<code>.so</code> æ–‡ä»¶è¯•å›¾é€šè¿‡ JNI è°ƒç”¨ Java å±‚ä»£ç æ—¶ï¼ŒUnidbg
ä¼šæ‹¦æˆªå¹¶å¯ä»¥è¿”å›ä½ æŒ‡å®šçš„å€¼ã€‚</p></li>
<li><p><strong>Hook ç³»ç»Ÿè°ƒç”¨ (SVC)</strong>:
æ‹¦æˆªåº•å±‚çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿”å›é¢„è®¾çš„ç»“æœã€‚</p></li>
<li><p>*ä¸»è¦åº”ç”¨åœºæ™¯**:</p></li>
<li><p><strong>ç®—æ³•å¤ç° (ä¸€æŠŠæ¢­)</strong>:
ç›´æ¥è°ƒç”¨ç›®æ ‡åŠ å¯†/è§£å¯†å‡½æ•°ï¼Œè¾“å…¥å‚æ•°å¹¶è·å–è¿”å›å€¼ï¼Œæ— éœ€è´¹åŠ›å»é€†å‘ç®—æ³•æœ¬èº«ã€‚</p></li>
<li><p><strong>ç»•è¿‡ç¯å¢ƒæ£€æµ‹</strong>: ç›®æ ‡å‡½æ•°å¯èƒ½åŒ…å«å¯¹
Rootã€æ¨¡æ‹Ÿå™¨ã€è®¾å¤‡ ID ç­‰çš„æ£€æµ‹ã€‚Unidbg å¯ä»¥è½»æ¾ Hook
è¿™äº›æ£€æµ‹ç‚¹ï¼Œè®©å®ƒä»¬å…¨éƒ¨å¤±æ•ˆã€‚</p></li>
<li><p><strong>ç»•è¿‡åè°ƒè¯•</strong>: <code>ptrace</code> ç­‰åè°ƒè¯•æ‰‹æ®µåœ¨
Unidbg çš„æ¨¡æ‹Ÿç¯å¢ƒä¸­å¤©ç„¶æ— æ•ˆã€‚</p></li>
<li><p><strong>æ‰¹é‡è®¡ç®—/çˆ†ç ´</strong>:
ç¼–å†™è„šæœ¬ï¼Œæ‰¹é‡è°ƒç”¨ç›®æ ‡å‡½æ•°ï¼Œç”¨äºå‚æ•°çš„çˆ†ç ´æˆ–ç”Ÿæˆå¤§é‡ç­¾åã€‚</p></li>
<li><p><strong>ä¸»åŠ¨è°ƒç”¨éå¯¼å‡ºå‡½æ•°</strong>: ä¸ Frida
ä¸åŒï¼Œåªè¦çŸ¥é“å‡½æ•°åç§»ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œæ— è®ºå®ƒæ˜¯å¦è¢«å¯¼å‡ºã€‚ ___
## # Unidbg vs.Â Frida</p></li>
</ul>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">Unidbg</th>
<th style="text-align: left;">Frida</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>æ‰§è¡Œç¯å¢ƒ</strong></td>
<td style="text-align: left;"><strong>PC ç«¯ (æ¨¡æ‹Ÿæ‰§è¡Œ)</strong></td>
<td style="text-align: left;"><strong>ç§»åŠ¨è®¾å¤‡ç«¯
(çœŸæœº/æ¨¡æ‹Ÿå™¨)</strong></td>
</tr>
<tr>
<td style="text-align: left;"><strong>å·¥ä½œæ¨¡å¼</strong></td>
<td style="text-align: left;">å°† <code>.so</code>
å½“ä½œä¸€ä¸ªâ€é»‘ç›’â€åº“æ¥è°ƒç”¨</td>
<td style="text-align: left;">ä¾µå…¥æ­£åœ¨è¿è¡Œçš„åº”ç”¨è¿›ç¨‹è¿›è¡Œ Hook</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ä¾èµ–</strong></td>
<td style="text-align: left;">ä»…éœ€è¦ <code>.so</code>
æ–‡ä»¶åŠå…¶ä¾èµ–çš„åº“</td>
<td style="text-align: left;">éœ€è¦ä¸€ä¸ªå®Œæ•´çš„ã€èƒ½è¿è¡Œçš„ APK</td>
</tr>
<tr>
<td style="text-align: left;"><strong>åè°ƒè¯•</strong></td>
<td style="text-align: left;"><strong>å¤©ç„¶å…ç–«</strong></td>
<td style="text-align: left;">éœ€è¦ç¼–å†™è„šæœ¬æ¥å¯¹æŠ—åè°ƒè¯•</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç¯å¢ƒä¾èµ–</strong></td>
<td style="text-align: left;">éœ€è¦æ‰‹åŠ¨æ¨¡æ‹Ÿæˆ– Hook</td>
<td style="text-align: left;">è¿è¡Œåœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œæ— éœ€æ¨¡æ‹Ÿ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ€§èƒ½</strong></td>
<td style="text-align: left;">è¾ƒä½ (å› ä¸ºæ˜¯å…¨æ¨¡æ‹Ÿ)</td>
<td style="text-align: left;">è¾ƒé«˜ (ä»£ç åœ¨è®¾å¤‡ä¸ŠåŸç”Ÿè¿è¡Œ)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>é€‚ç”¨æ€§</strong></td>
<td style="text-align: left;">é€‚åˆçº¯ç®—æ³•åˆ†æï¼Œä¸æ¶‰åŠ UI
å’Œå¤æ‚ä¸šåŠ¡æµ</td>
<td style="text-align: left;">é€‚åˆåˆ†æä¸ Android ç³»ç»Ÿã€UI
å¼ºç›¸å…³çš„ä¸šåŠ¡é€»è¾‘</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ç¯å¢ƒæ­å»º"># ç¯å¢ƒæ­å»º</h2>
<ol type="1">
<li><strong>JDK</strong>: ç¡®ä¿å·²å®‰è£… JDK 8 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
<li><strong>Maven</strong>: ç”¨äºé¡¹ç›®æ„å»ºå’Œä¾èµ–ç®¡ç†ã€‚</li>
<li><strong>IDE</strong>: æ¨èä½¿ç”¨ IntelliJ IDEAã€‚</li>
<li><strong>ä¸‹è½½ Unidbg</strong>: ä»å…¶ GitHub Release
é¡µé¢ä¸‹è½½æœ€æ–°çš„å‘è¡Œç‰ˆ <code>unidbg-dist.zip</code>ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ Maven
ä¾èµ–ã€‚</li>
<li><strong>åˆ›å»º Maven é¡¹ç›®</strong>: åœ¨ IDE ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Maven
é¡¹ç›®ï¼Œå¹¶åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ  Unidbg çš„ä¾èµ–ï¼š ```xml
<dependency> <groupId>com.github.unidbg</groupId>
<artifactId>unidbg-android</artifactId> <version>0.9.7</version>
<!-- Use latest version --> </dependency></li>
</ol>
<pre><code>
## # åŸºæœ¬ä½¿ç”¨æµç¨‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè°ƒç”¨ `.so` ä¸­ç®€å•å‡½æ•°çš„å…¸å‹ä»£ç ç»“æ„ï¼š

```java
import com.github.unidbg.AndroidEmulator;
import com.github.unidbg.Module;
import com.github.unidbg.linux.android.AndroidEmulatorBuilder;
import com.github.unidbg.linux.android.AndroidResolver;
import com.github.unidbg.linux.android.dvm.*;
import com.github.unidbg.memory.Memory;

import java.io.File;

public class MyTest extends DvmObject&lt;String&gt; {

private final AndroidEmulator emulator;
private final Module module;
private final VM vm;

public MyTest() {
// 1. Create emulator instance
emulator = AndroidEmulatorBuilder.for32Bit().build();
final Memory memory = emulator.getMemory();
// 2. Set system library resolver
memory.setLibraryResolver(new AndroidResolver(23)); // API 23

// 3. Create virtual machine instance (DVM)
vm = emulator.createDalvikVM(new File(&quot;target/classes/apk/app-debug.apk&quot;)); // APK can be provided for automatic extraction
vm.setVerbose(true); // Print detailed logs

// 4. Load target .so
DalvikModule dm = vm.loadLibrary(new File(&quot;target/classes/so/libnative-lib.so&quot;), true);
module = dm.getModule();

// 5. Call JNI_OnLoad (optional but recommended)
dm.callJNI_OnLoad(emulator);
}

public void callNativeFunc() {
// 6. Call target function
Number result = module.callFunction(emulator, 0x1234, &quot;hello unidbg&quot;)[0]; // 0x1234 is the function offset
System.out.println(&quot;Result: &quot; + result.intValue());
}

public static void main(String[] args) {
MyTest test = new MyTest();
test.callNativeFunc();
test.emulator.close();
}
}
</code></pre>
<ul>
<li><p><strong><code>VM</code></strong>: è™šæ‹Ÿæœºï¼Œå¯ä»¥æ˜¯
<code>DalvikVM</code> (DVM) æˆ– <code>ART</code>ã€‚è´Ÿè´£ç®¡ç† Java å¯¹è±¡
(<code>DvmObject</code>) å’Œ JNI è°ƒç”¨ã€‚</p></li>
<li><p><strong><code>Module</code></strong>: ä»£è¡¨ä¸€ä¸ªå·²åŠ è½½åˆ°å†…å­˜ä¸­çš„
<code>.so</code> æ¨¡å—ã€‚</p></li>
<li><p><code>callFunction(emulator, address, args...)</code>:
<strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼Œé€šè¿‡ç»å¯¹åœ°å€æˆ–åç§»è°ƒç”¨å‡½æ•°ã€‚</p></li>
<li><p><code>findSymbolByName("...")</code>:
æŒ‰åç§°æŸ¥æ‰¾å¯¼å‡ºå‡½æ•°ã€‚</p></li>
<li><p><strong><code>DvmObject</code></strong>: Java å¯¹è±¡çš„ä»£ç†ã€‚Unidbg
ä½¿ç”¨å®ƒæ¥å‘ native å‡½æ•°ä¼ é€’å­—ç¬¦ä¸²ã€å­—èŠ‚æ•°ç»„ç­‰ã€‚</p></li>
<li><p><strong><code>AbstractJni</code></strong>: å¦‚æœ <code>.so</code>
ä¸­æœ‰å¤æ‚çš„ JNI å›è°ƒï¼Œä½ éœ€è¦ç»§æ‰¿ <code>AbstractJni</code>
å¹¶é‡å†™å¯¹åº”çš„æ–¹æ³•ï¼Œä»¥æ¨¡æ‹Ÿ Java å±‚çš„è¡Œä¸ºã€‚</p></li>
<li><p><strong>Hooking</strong>: Unidbg ä½¿ç”¨
<code>com.github.unidbg.hook.Hooker</code> æ¥å£å’Œ <code>TraceHook</code>
ç­‰å·¥å…·æ¥æä¾›ç±»ä¼¼ Frida çš„ Hooking èƒ½åŠ›ï¼Œå¯ä»¥ç›‘æ§æŒ‡ä»¤ã€å†…å­˜è¯»å†™ç­‰ã€‚ ___
## # å®æˆ˜æŠ€å·§</p></li>
<li><p><strong>è¡¥ç¯å¢ƒ</strong>: å¦‚æœ <code>.so</code>
ä¾èµ–ç‰¹å®šçš„è®¾å¤‡ä¿¡æ¯æˆ–æ–‡ä»¶ï¼Œä½ éœ€è¦ï¼š</p></li>
<li><p>åœ¨è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å’Œå†…å®¹ã€‚</p></li>
<li><p>Hook <code>open</code>, <code>read</code>, <code>access</code> ç­‰
libc å‡½æ•°ï¼Œè¿”å›é¢„æœŸçš„ç»“æœã€‚</p></li>
<li><p>Hook JNI è°ƒç”¨ï¼Œå¦‚ <code>getSystemService</code>ï¼Œè¿”å›ä¸€ä¸ªæ¨¡æ‹Ÿçš„
<code>TelephonyManager</code> å¯¹è±¡ã€‚</p></li>
<li><p><strong>å®šä½å‡½æ•°åœ°å€</strong>: å‡½æ•°åœ°å€æ˜¯
<code>åŸºåœ°å€ (module.base) + åç§»</code>ã€‚åç§»å¯ä»¥ä» IDA/Ghidra
ä¸­è·å¾—ã€‚</p></li>
<li><p><strong>è®¾ç½®æ–­ç‚¹</strong>: ä½¿ç”¨
<code>emulator.attach().addBreakPoint(address, ...)</code>
å¯ä»¥åœ¨æŒ‡å®šåœ°å€è®¾ç½®æ–­ç‚¹ï¼Œè¿›è¡Œè°ƒè¯•ã€‚</p></li>
<li><p><strong>æ—¥å¿—åˆ†æ</strong>: <code>vm.setVerbose(true)</code>
ä¼šæ‰“å°éå¸¸è¯¦ç»†çš„ JNI è°ƒç”¨å’Œ SVC æ—¥å¿—ï¼Œè¿™æ˜¯è§£å†³ç¯å¢ƒé—®é¢˜çš„å…³é”®ã€‚</p></li>
<li><p><strong>å‚è€ƒå®˜æ–¹æµ‹è¯•ç”¨ä¾‹</strong>: Unidbg é¡¹ç›®çš„
<code>unidbg-android/src/test/java</code> ç›®å½•ä¸‹æœ‰å¤§é‡é’ˆå¯¹ä¸»æµ App
çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ˜¯å­¦ä¹  Unidbg çš„æœ€ä½³èµ„æ–™ã€‚</p></li>
</ul>
<pre><code>


&lt;!-- 02-Tools/Dynamic/unidbg_internals.md --&gt;

# Unidbg å®ç°åŸç†å‰–æ

Unidbg æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Android åŸç”Ÿåº“ (`.so`) æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ã€‚å®ƒå…è®¸ä½ åœ¨æ²¡æœ‰ Android çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨ PC (macOS, Windows, Linux) ä¸Šè¿è¡Œå’Œè°ƒè¯• JNI å‡½æ•°ã€‚ç†è§£å…¶å·¥ä½œåŸç†ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆåœ°è§£å†³å¤æ‚çš„åŠ å¯†ç®—æ³•é€†å‘ã€åè®®åˆ†æç­‰é—®é¢˜ã€‚
___
## ç›®å½•
- [Unidbg å®ç°åŸç†å‰–æ](#unidbg-å®ç°åŸç†å‰–æ)
- [ç›®å½•](#ç›®å½•)
- [æ ¸å¿ƒæ€æƒ³ï¼šåœ¨ PC ä¸Šæ¨¡æ‹Ÿä¸€ä¸ª Android æ‰§è¡Œç¯å¢ƒ](#æ ¸å¿ƒæ€æƒ³åœ¨-pc-ä¸Šæ¨¡æ‹Ÿä¸€ä¸ª-android-æ‰§è¡Œç¯å¢ƒ)

- [å…³é”®ç»„ä»¶è¯¦è§£](#å…³é”®ç»„ä»¶è¯¦è§£)
- [**Unicorn Engine**: CPU æ¨¡æ‹Ÿå™¨](#unicorn-engine-cpu-æ¨¡æ‹Ÿå™¨)

- [**å†…å­˜ç®¡ç†ä¸æ˜ å°„ (Memory Management)**](#å†…å­˜ç®¡ç†ä¸æ˜ å°„-memory-management)

- [**åŠ¨æ€åº“åŠ è½½å™¨ (Dynamic Linker)**](#åŠ¨æ€åº“åŠ è½½å™¨-dynamic-linker)

- [**ç³»ç»Ÿè°ƒç”¨å¤„ç† (Syscall Handler)**](#ç³»ç»Ÿè°ƒç”¨å¤„ç†-syscall-handler)

- [**JNI å‡½æ•°æ¨¡æ‹Ÿ (JNI Emulation)**](#jni-å‡½æ•°æ¨¡æ‹Ÿ-jni-emulation)
- [å·¥ä½œæµç¨‹ï¼š`unidbg` æ˜¯å¦‚ä½•è¿è¡Œä¸€ä¸ª `.so` çš„ï¼Ÿ](#å·¥ä½œæµç¨‹unidbg-æ˜¯å¦‚ä½•è¿è¡Œä¸€ä¸ª-so-çš„)

- [Unidbg çš„ä¼˜åŠ¿ä¸å±€é™](#unidbg-çš„ä¼˜åŠ¿ä¸å±€é™)
___
### æ ¸å¿ƒæ€æƒ³ï¼šåœ¨ PC ä¸Šæ¨¡æ‹Ÿä¸€ä¸ª android æ‰§è¡Œç¯å¢ƒ

`.so` æ–‡ä»¶æ˜¯ä¸ºç‰¹å®š CPU æ¶æ„ï¼ˆå¦‚ ARMï¼‰å’Œæ“ä½œç³»ç»Ÿï¼ˆå¦‚ Androidï¼‰ç¼–è¯‘çš„ã€‚å®ƒä¸èƒ½ç›´æ¥åœ¨ä½ çš„ x86 æ¶æ„çš„ PC ä¸Šè¿è¡Œã€‚

Unidbg çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼š**ç”¨çº¯ Java åœ¨ PC ä¸Šæ„å»ºä¸€ä¸ªè™šæ‹Ÿçš„ã€é«˜åº¦ä»¿çœŸçš„ Android ç”¨æˆ·æ€ (User-Mode) ç¯å¢ƒ**ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå™¨ï¼Œè€Œæ˜¯ä¸“æ³¨äºæ¨¡æ‹Ÿä¸€ä¸ª Android *è¿›ç¨‹* æ‰€éœ€çš„ä¸€åˆ‡ï¼Œè®© `.so` æ–‡ä»¶â€œæ„Ÿè§‰â€è‡ªå·±æ­£è¿è¡Œåœ¨ä¸€ä¸ªçœŸå®çš„ Android è®¾å¤‡é‡Œã€‚
___
### å…³é”®ç»„ä»¶è¯¦è§£

#### **Unicorn Engine**: CPU æ¨¡æ‹Ÿå™¨

Unicorn æ˜¯ Unidbg çš„åŸºçŸ³ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäº QEMU çš„è½»é‡çº§ã€å¤šå¹³å°ã€å¤šæ¶æ„çš„ CPU æ¨¡æ‹Ÿå™¨åº“ã€‚

* **ä½œç”¨**: è´Ÿè´£**é€æ¡è§£é‡Šå’Œæ‰§è¡Œ** `.so` æ–‡ä»¶ä¸­çš„ ARM æˆ– AArch64 (ARM64) æ±‡ç¼–æŒ‡ä»¤ã€‚

* **åŸç†**: å½“ Unidbg åŠ è½½ `.so` çš„ä»£ç æ®µåˆ°è™šæ‹Ÿå†…å­˜åï¼Œå®ƒä¼šè®¾ç½®ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ (PC) æŒ‡å‘è¦æ‰§è¡Œçš„å‡½æ•°åœ°å€ï¼Œç„¶åå‘½ä»¤ Unicorn ä»è¯¥åœ°å€å¼€å§‹æ‰§è¡Œã€‚Unicorn ä¼šè¯»å–æŒ‡ä»¤ã€è§£ç ã€æ¨¡æ‹Ÿå¯„å­˜å™¨å’Œå†…å­˜çš„è¯»å†™ï¼Œå¹¶æ›´æ–° CPU çŠ¶æ€ï¼Œå°±åƒä¸€ä¸ªçœŸå®çš„ ARM èŠ¯ç‰‡ä¸€æ ·ã€‚

#### **å†…å­˜ç®¡ç†ä¸æ˜ å°„ (Memory Management)**

Unidbg å†…éƒ¨å®ç°äº†ä¸€å¥—å®Œæ•´çš„å†…å­˜ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºæ¨¡æ‹Ÿä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚

* **ä½œç”¨**:
1. ä¸ºåŠ è½½çš„ `.so` æ–‡ä»¶åˆ†é…è™šæ‹Ÿå†…å­˜ï¼ˆä»£ç æ®µã€æ•°æ®æ®µã€BSSæ®µç­‰ï¼‰ã€‚
2. ç®¡ç†å‡½æ•°çš„æ ˆç©ºé—´ (Stack)ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€ã€‚
3. å¤„ç† `malloc`, `free` ç­‰å†…å­˜åˆ†é…è¯·æ±‚ã€‚

* **åŸç†**: å®ƒé€šè¿‡ Java çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ `byte[]` æˆ– `ByteBuffer`ï¼‰æ¥è¡¨ç¤ºå†…å­˜å—ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæ˜ å°„è¡¨ï¼ˆ`Map&lt;Long, MemoryBlock&gt;`ï¼‰æ¥ç®¡ç†è™šæ‹Ÿåœ°å€å’Œè¿™äº›å®é™…å†…å­˜å—ä¹‹é—´çš„å…³ç³»ã€‚å½“ Unicorn éœ€è¦è¯»å†™æŸä¸ªè™šæ‹Ÿåœ°å€æ—¶ï¼ŒUnidbg ä¼šæŸ¥è¯¢è¿™ä¸ªè¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„ Java å†…å­˜å—å¹¶è¿›è¡Œæ“ä½œã€‚

#### **åŠ¨æ€åº“åŠ è½½å™¨ (Dynamic Linker)**

Android åº”ç”¨çš„ `.so` æ–‡ä»¶é€šå¸¸ä¼šä¾èµ–å…¶ä»–çš„ç³»ç»Ÿåº“ï¼Œå¦‚ `libc.so` (æ ‡å‡† C åº“), `liblog.so` (æ—¥å¿—åº“), `libz.so` (å‹ç¼©åº“) ç­‰ã€‚

* **ä½œç”¨**: Unidbg å†…ç½®äº†ä¸€ä¸ªç®€æ˜“çš„ `linker`ï¼Œè´Ÿè´£è§£æ `.so` æ–‡ä»¶çš„ä¾èµ–é¡¹ï¼Œå¹¶åŠ è½½è¿™äº›ä¾èµ–åº“ã€‚

* **åŸç†**:
1. **è§£æ ELF**: Unidbg ä¼šè¯»å– `.so` æ–‡ä»¶çš„ ELF å¤´ï¼Œæ‰¾åˆ°å…¶ `.dynamic` sectionï¼Œè¿™é‡Œè®°å½•äº†æ‰€æœ‰ä¾èµ–åº“çš„åç§°ã€‚
2. **åŠ è½½ä¾èµ–**: Unidbg ä¼šåœ¨é¢„è®¾çš„è·¯å¾„ä¸­æŸ¥æ‰¾è¿™äº›ä¾èµ–åº“ï¼ˆå®ƒè‡ªå¸¦äº†ä¸€äº›æ ¸å¿ƒçš„ Android ç³»ç»Ÿåº“ï¼‰ï¼Œç„¶ååƒåŠ è½½ä¸» `.so` ä¸€æ ·ï¼Œå°†å®ƒä»¬ä¹ŸåŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­ã€‚
3. **ç¬¦å·é‡å®šä½ (Relocation)**: åŠ è½½å™¨æœ€é‡è¦çš„å·¥ä½œæ˜¯å¤„ç†**é‡å®šä½**ã€‚å¦‚æœ A.so è°ƒç”¨äº† B.so ä¸­çš„å‡½æ•° `foo`ï¼ŒA.so ä¸­åªå­˜äº†ä¸€ä¸ªå¯¹ `foo` çš„â€œç¬¦å·å¼•ç”¨â€ã€‚åŠ è½½å™¨éœ€è¦åœ¨ B.so ä¸­æ‰¾åˆ° `foo` çš„å®é™…åœ°å€ï¼Œç„¶åå°†è¿™ä¸ªåœ°å€å¡«å›åˆ° A.so çš„è°ƒç”¨æŒ‡ä»¤ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ `.so` æ–‡ä»¶èƒ½å¤Ÿè·¨åº“è°ƒç”¨çš„å…³é”®ã€‚

#### **ç³»ç»Ÿè°ƒç”¨å¤„ç† (Syscall Handler)**

å½“ `.so` æ–‡ä»¶éœ€è¦æ‰§è¡Œä¸€äº›éœ€è¦æ“ä½œç³»ç»Ÿå†…æ ¸å‚ä¸çš„æ“ä½œæ—¶ï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ï¼‰ï¼Œå®ƒä¼šå‘èµ·ä¸€ä¸ª**ç³»ç»Ÿè°ƒç”¨ (syscall)**ï¼Œè¿™é€šè¿‡ `SVC` æˆ– `SWI` æŒ‡ä»¤å®ç°ã€‚

* **ä½œç”¨**: æ‹¦æˆªå¹¶å¤„ç† `.so` å‘å‡ºçš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ã€‚

* **åŸç†**: Unicorn å¼•æ“åœ¨æ‰§è¡Œ `SVC` æŒ‡ä»¤æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªâ€œä¸­æ–­â€ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤è¿˜ç»™ Unidbgã€‚Unidbg ä¼šæ£€æŸ¥ç‰¹å®šçš„å¯„å­˜å™¨ï¼ˆå¦‚ `r7`ï¼‰æ¥è·å–ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ï¼Œç„¶ååœ¨å…¶ `SyscallHandler` ä¸­æ‰¾åˆ°å¯¹åº”çš„ Java å®ç°å¹¶æ‰§è¡Œã€‚
* ä¾‹å¦‚ï¼Œå¦‚æœ `.so` å°è¯•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼ŒUnidbg ä¼šæ‹¦æˆªè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ç”¨ Java çš„ `FileInputStream` åœ¨ PC ä¸Šå®é™…æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™ `.so`ã€‚

#### **JNI å‡½æ•°æ¨¡æ‹Ÿ (JNI Emulation)**

è¿™æ˜¯ Unidbg æœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ã€‚JNI (Java Native Interface) æ˜¯ `.so` æ–‡ä»¶ä¸ Java å±‚ä»£ç äº¤äº’çš„æ¡¥æ¢ã€‚

* **ä½œç”¨**: æ¨¡æ‹Ÿ Android ART/Dalvik è™šæ‹Ÿæœºæä¾›çš„æ‰€æœ‰ JNI å‡½æ•°ï¼Œå¦‚ `FindClass`, `GetMethodID`, `CallObjectMethod` ç­‰ã€‚

* **åŸç†**: Unidbg åœ¨å…¶è™šæ‹Ÿç¯å¢ƒä¸­é¢„å…ˆæ³¨å†Œäº†æ‰€æœ‰ JNI å‡½æ•°çš„ Java å®ç°ã€‚
* å½“ `.so` è°ƒç”¨ `FindClass(&quot;java/lang/String&quot;)` æ—¶ï¼ŒUnidbg çš„ JNI æ¨¡å—ä¼šæ¥ç®¡è¿™ä¸ªè°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªä»£è¡¨ `java.lang.String` ç±»çš„è™šæ‹Ÿå¯¹è±¡ï¼ˆä¸€ä¸ª Java `DvmClass` å®ä¾‹ï¼‰ã€‚

* å½“ `.so` è°ƒç”¨ `CallObjectMethod` æ—¶ï¼ŒUnidbg ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œå®é™…åœ°åœ¨ PC ç«¯çš„ JVM ä¸­æ‰§è¡Œå¯¹åº” Java å¯¹è±¡çš„ç›¸åº”æ–¹æ³•ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ `.so`ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒUnidbg å·§å¦™åœ°å°† `.so` å¯¹ Android è™šæ‹Ÿæœºçš„è°ƒç”¨â€œå«æ¥â€åˆ°äº† PC ç«¯çš„ JVM ä¸Šã€‚
___
### å·¥ä½œæµç¨‹ï¼š`unidbg` æ˜¯å¦‚ä½•è¿è¡Œä¸€ä¸ª `.so` çš„ï¼Ÿ

1. **åˆ›å»ºæ¨¡æ‹Ÿå™¨å®ä¾‹**: `AndroidARMEmulator emulator = new AndroidARMEmulator(&quot;com.example.app&quot;);`
2. **å†…å­˜åˆå§‹åŒ–**: `Memory memory = emulator.getMemory();` Unidbg åˆå§‹åŒ–å†…å­˜ç®¡ç†å™¨å’Œ Unicorn å¼•æ“ã€‚
3. **åŠ è½½åŠ¨æ€åº“**: `Module module = emulator.loadLibrary(new File(&quot;libnative-lib.so&quot;));`
a. Unidbg çš„ `linker` è§£æ `libnative-lib.so` çš„ ELF ç»“æ„ã€‚
b. æ ¹æ® `PT_LOAD` æ®µï¼Œå°† `.so` çš„å†…å®¹æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ã€‚
c. è§£æå…¶ä¾èµ–åº“ï¼ˆå¦‚ `libc.so`ï¼‰ï¼Œé€’å½’åŠ è½½å®ƒä»¬ã€‚
d. è¿›è¡Œç¬¦å·é‡å®šä½ï¼Œä¿®å¤å‡½æ•°è°ƒç”¨åœ°å€ã€‚
4. **è°ƒç”¨ JNI å‡½æ•°**: `module.callJNI_OnLoad(emulator);` æˆ– `DvmObject&lt;?&gt; obj = module.callJniMethod(...);`
a. Unidbg æ‰¾åˆ°ç›®æ ‡ JNI å‡½æ•°åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„åœ°å€ã€‚
b. è®¾ç½®å‡½æ•°å‚æ•°ï¼Œä¸»è¦æ˜¯å°† `JNIEnv` å’Œ `jobject` ç­‰ JNI å¯¹è±¡ä½œä¸ºæŒ‡é’ˆï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ä¼ å…¥ã€‚
c. å¯åŠ¨ Unicorn å¼•æ“ï¼Œä»ç›®æ ‡å‡½æ•°åœ°å€å¼€å§‹æ‰§è¡Œ ARM æ±‡ç¼–æŒ‡ä»¤ã€‚
5. **æ‰§è¡Œä¸äº¤äº’**:
* æ±‡ç¼–æŒ‡ä»¤ç”± Unicorn è§£é‡Šæ‰§è¡Œã€‚

* é‡åˆ°ç³»ç»Ÿè°ƒç”¨ï¼ŒUnicorn ä¸­æ–­ï¼Œç”± Unidbg çš„ `SyscallHandler` å¤„ç†ã€‚

* é‡åˆ°è°ƒç”¨ JNI å‡½æ•°ï¼Œç”± Unidbg çš„ JNI æ¨¡æ‹Ÿå±‚å¤„ç†ï¼Œå¯èƒ½ä¼šåœ¨ PC çš„ JVM ä¸Šæ‰§è¡ŒçœŸå®çš„ Java ä»£ç ã€‚
6. **è¿”å›ç»“æœ**: å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œä»æ¨¡æ‹Ÿçš„å¯„å­˜å™¨ï¼ˆå¦‚ `r0`ï¼‰æˆ–æ ˆä¸Šè·å–è¿”å›å€¼ï¼Œå¹¶è½¬æ¢ä¸º Java å¯¹è±¡ã€‚
___
### Unidbg çš„ä¼˜åŠ¿ä¸å±€é™

* **ä¼˜åŠ¿**:
* **æ‘†è„±ç¯å¢ƒé™åˆ¶**: æ— éœ€çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ï¼Œæ—  root æƒé™è¦æ±‚ã€‚

* **é«˜å¯æ§æ€§**: å¯ä»¥å®Œå…¨æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä»»æ„ä¿®æ”¹å†…å­˜ã€å¯„å­˜å™¨ã€‚

* **è‡ªåŠ¨åŒ–ä¸é›†æˆ**: æ˜“äºä¸ Java/Python é¡¹ç›®é›†æˆï¼Œè¿›è¡Œå¤§è§„æ¨¡çš„è‡ªåŠ¨åŒ–æµ‹è¯•å’Œåˆ†æã€‚

* **ååè°ƒè¯•**: ç”±äºæ²¡æœ‰å®é™…çš„è°ƒè¯•å™¨è¿›ç¨‹ (`ptrace`)ï¼Œå¯ä»¥ç»•è¿‡å¤§å¤šæ•°åŸºäº `ptrace` çš„åè°ƒè¯•æ£€æµ‹ã€‚

* **å±€é™**:
* **ç¯å¢ƒä¸å®Œæ•´**: å¹¶é 100% å®Œæ•´çš„ Android ç¯å¢ƒã€‚å¯¹äºå¼ºä¾èµ–ç‰¹å®šç³»ç»Ÿè¡Œä¸ºã€ç¡¬ä»¶ç‰¹æ€§æˆ–å¤§é‡ UI æ“ä½œçš„ `.so` æ–‡ä»¶ï¼Œæ¨¡æ‹Ÿå¯èƒ½ä¼šå¤±è´¥ã€‚

* **æ€§èƒ½å¼€é”€**: æ¯•ç«Ÿæ˜¯é€æ¡æŒ‡ä»¤æ¨¡æ‹Ÿï¼Œæ€§èƒ½è¿œä½äºåŸç”Ÿæ‰§è¡Œã€‚

* **ç³»ç»Ÿè°ƒç”¨å’Œ JNI è¦†ç›–**: å¦‚æœ `.so` ç”¨åˆ°äº† Unidbg å°šæœªå®ç°çš„ç³»ç»Ÿè°ƒç”¨æˆ– JNI å‡½æ•°ï¼Œæ‰§è¡Œä¼šä¸­æ–­ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥å……å®ç°ã€‚



&lt;!-- 02-Tools/Dynamic/xposed_guide.md --&gt;

# Xposed æ¡†æ¶å…¥é—¨

Xposed æ˜¯ä¸€ä¸ªåœ¨ Android å¹³å°ä¸Šå¹¿å—æ¬¢è¿çš„åŠ¨æ€ä»£ç  Hook æ¡†æ¶ã€‚ä¸ Frida ä¸»è¦ç”¨äºå®æ—¶ã€ä¸´æ—¶çš„åˆ†æä¸åŒï¼ŒXposed æ—¨åœ¨å¯¹ç³»ç»Ÿå’Œåº”ç”¨è¿›è¡Œ**æ°¸ä¹…æ€§**çš„ä¿®æ”¹ã€‚å®ƒé€šè¿‡æ›¿æ¢ä¸€ä¸ªæ ¸å¿ƒç³»ç»Ÿè¿›ç¨‹ (`app_process`)ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½è‡ªå®šä¹‰æ¨¡å—ï¼Œä»è€Œå®ç°å¯¹ä»»æ„æ–¹æ³•çš„é«˜æ•ˆ Hookã€‚
___
## ç›®å½•
- [Xposed æ¡†æ¶å…¥é—¨](#xposed-æ¡†æ¶å…¥é—¨)
- [ç›®å½•](#ç›®å½•)
- [æ ¸å¿ƒåŸç†](#æ ¸å¿ƒåŸç†)

- [Xposed vs. Frida](#xposed-vs-frida)

- [ç¯å¢ƒæ­å»º (ä»¥ LSPosed ä¸ºä¾‹)](#ç¯å¢ƒæ­å»º-ä»¥-lsposed-ä¸ºä¾‹)

- [å¼€å‘ç¬¬ä¸€ä¸ª Xposed æ¨¡å—](#å¼€å‘ç¬¬ä¸€ä¸ª-xposed-æ¨¡å—)
- [1. é¡¹ç›®ç»“æ„](#1-é¡¹ç›®ç»“æ„)

- [2. å®ç° Hook é€»è¾‘](#2-å®ç°-hook-é€»è¾‘)

- [3. å£°æ˜æ¨¡å—å…¥å£](#3-å£°æ˜æ¨¡å—å…¥å£)

- [4. æ¿€æ´»æ¨¡å—](#4-æ¿€æ´»æ¨¡å—)
- [æ ¸å¿ƒ API è¯¦è§£](#æ ¸å¿ƒ-api-è¯¦è§£)
- [`IXposedHookLoadPackage`](#ixposedhookloadpackage)

- [`XposedHelpers`](#xposedhelpers)

- [`XC_MethodHook`](#xc_methodhook)
- [å¸¸è§åº”ç”¨åœºæ™¯](#å¸¸è§åº”ç”¨åœºæ™¯)
___
### æ ¸å¿ƒåŸç†

Xposed çš„å·¥ä½œåŸºç¡€æ˜¯å®ƒèƒ½å¤Ÿåœ¨ Android ç³»ç»Ÿå¯åŠ¨çš„æ ¸å¿ƒé˜¶æ®µä»‹å…¥ï¼Œå¹¶å°†è‡ªå·±çš„ä»£ç æ³¨å…¥åˆ°æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚

1. **Zygote æ³¨å…¥**: Xposed é€šè¿‡æ›¿æ¢ç³»ç»ŸåŸç”Ÿçš„ `/system/bin/app_process` å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ç°äº†å¯¹ Zygote è¿›ç¨‹ï¼ˆæ‰€æœ‰ App è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼‰çš„æ§åˆ¶ã€‚å½“ Zygote å¯åŠ¨æ—¶ï¼Œä¼šåŠ è½½ Xposed çš„æ ¸å¿ƒ Jar åŒ…ï¼ˆXposed Bridgeï¼‰ã€‚
2. **æ–¹æ³• Hook**: å½“æ¨¡å—éœ€è¦ Hook ä¸€ä¸ªæ–¹æ³•æ—¶ï¼ŒXposed ä¼šåœ¨è¿è¡Œæ—¶æ·±å…¥è™šæ‹Ÿæœºï¼ˆARTï¼‰å†…éƒ¨ï¼Œç›´æ¥ä¿®æ”¹è¯¥æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„ã€‚å®ƒå°†ç›®æ ‡æ–¹æ³•&quot;ä¼ªè£…&quot;æˆä¸€ä¸ª Native æ–¹æ³•ï¼Œå¹¶å°†å…¶æ‰§è¡Œå…¥å£æŒ‡å‘ Xposed çš„ä¸€ä¸ªé€šç”¨æ¡¥æ¥å‡½æ•°ã€‚
3. **æ‰§è¡Œæµé‡å®šå‘**: å½“ App è°ƒç”¨è¢« Hook çš„æ–¹æ³•æ—¶ï¼Œæ‰§è¡Œæµä¼šå…ˆè¿›å…¥ Xposed çš„æ¡¥æ¥å‡½æ•°ï¼Œåœ¨è¿™é‡Œ Xposed ä¾æ¬¡è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ `beforeHookedMethod`ï¼Œç„¶åè°ƒç”¨åŸæ–¹æ³•ï¼Œæœ€åå†è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ `afterHookedMethod`ï¼Œä»è€Œå®ç°å¯¹æ–¹æ³•è°ƒç”¨çš„å®Œå…¨æ§åˆ¶ã€‚

&gt; æƒ³è¦æ›´æ·±å…¥åœ°äº†è§£å…¶å®ç°ç»†èŠ‚ï¼Œè¯·å‚è€ƒ [**Xposed Internals: A Deep Dive**](./xposed_internals.md)ã€‚
___
### Xposed vs. Frida

| ç‰¹æ€§ | Xposed | Frida |
| :--- | :--- | :--- |
| **æ ¸å¿ƒç›®æ ‡** | **æ°¸ä¹…æ€§ä¿®æ”¹**: å¯¹åº”ç”¨æˆ–ç³»ç»ŸåŠŸèƒ½è¿›è¡Œé•¿æœŸã€ç¨³å®šçš„ä¿®æ”¹ã€‚ | **åŠ¨æ€åˆ†æ**: ç”¨äºå®æ—¶ã€ä¸´æ—¶çš„åˆ†æã€é€†å‘å’Œå¿«é€ŸåŸå‹éªŒè¯ã€‚ |
| **è¿è¡Œç¯å¢ƒ** | éœ€è¦ Rootï¼Œé€šè¿‡åˆ·å…¥æ¡†æ¶ä¿®æ”¹ç³»ç»Ÿï¼Œ**éœ€è¦é‡å¯**ã€‚ | é€šå¸¸éœ€è¦ Rootï¼Œä½†æ— éœ€é‡å¯ï¼Œé€šè¿‡ `frida-server` åŠ¨æ€é™„åŠ ã€‚ |
| **å¼€å‘è¯­è¨€** | **Java**: æ¨¡å—æ˜¯æ ‡å‡†çš„ Android APKã€‚ | **JavaScript**: ä¸»è¦ä½¿ç”¨ JS ç¼–å†™è„šæœ¬ï¼Œä¹Ÿæ”¯æŒå…¶ä»–è¯­è¨€ç»‘å®šã€‚ |
| **å¼€å‘å‘¨æœŸ** | è¾ƒæ…¢ï¼šç¼–ç  â†’ ç¼–è¯‘ APK â†’ å®‰è£… â†’ æ¿€æ´» â†’ é‡å¯ App/è®¾å¤‡ â†’ æµ‹è¯•ã€‚ | æå¿«ï¼šç¼–å†™/ä¿®æ”¹è„šæœ¬ â†’ é™„åŠ è¿›ç¨‹ â†’ ç«‹å³çœ‹åˆ°ç»“æœã€‚ |
| **ç¨³å®šæ€§** | æé«˜ã€‚ä¸ºé•¿æœŸè¿è¡Œè®¾è®¡ï¼Œä¸€æ—¦æ¿€æ´»ï¼Œéš App å¯åŠ¨è‡ªåŠ¨ç”Ÿæ•ˆã€‚ | è¾ƒä½ã€‚ä¾èµ–äº `frida-server` å’Œé™„åŠ ä¼šè¯ï¼ŒApp é‡å¯åå¤±æ•ˆã€‚ |
| **é€‚ç”¨åœºæ™¯** | UI å®šåˆ¶ã€åŠŸèƒ½å¢å¼ºã€å»å¹¿å‘Šã€éšç§æ§åˆ¶ï¼ˆå¦‚ä¼ªé€ æ•°æ®ï¼‰ã€‚ | SSL Pinning ç»•è¿‡ã€ç®—æ³•é€†å‘ã€åè®®åˆ†æã€æ¼æ´æŒ–æ˜ã€‚ |

* *æ€»ç»“**: å¦‚æœä½ æƒ³å†™ä¸€ä¸ª&quot;æ’ä»¶&quot;æ¥æ°¸ä¹…æ€§åœ°æ”¹å˜ä¸€ä¸ª App çš„åŠŸèƒ½ï¼Œç”¨ Xposedï¼›å¦‚æœä½ æƒ³åˆ†æä¸€ä¸ª App çš„å†…éƒ¨è¡Œä¸ºï¼Œç”¨ Fridaã€‚
___
### ç¯å¢ƒæ­å»º (ä»¥ LSPosed ä¸ºä¾‹)

å½“å‰ï¼ŒLSPosed æ˜¯ç¤¾åŒºä¸­æœ€ä¸»æµã€å…¼å®¹æ€§æœ€å¥½çš„ Xposed æ¡†æ¶å®ç°ï¼Œå®ƒåŸºäº Riru/Zygiskï¼Œä»¥ Magisk æ¨¡å—çš„å½¢å¼å·¥ä½œã€‚

1. **å‰ææ¡ä»¶**:
* ä¸€å°å·²è§£é”å¹¶åˆ·å…¥ Magisk çš„ Android è®¾å¤‡ï¼ˆAndroid 8.1+ï¼‰ã€‚
2. **å®‰è£… Riru æˆ–å¯ç”¨ Zygisk**:
* **Zygisk (æ¨è)**: åœ¨ Magisk Manager ä¸­ï¼Œè¿›å…¥è®¾ç½®ï¼Œå¼€å¯ `Zygisk` é€‰é¡¹ã€‚

* **Riru (å¤‡é€‰)**: åœ¨ Magisk Manager çš„&quot;æ¨¡å—&quot;éƒ¨åˆ†ï¼Œæœç´¢å¹¶å®‰è£… `Riru` æ¨¡å—ã€‚
3. **å®‰è£… LSPosed**:
* ä» [LSPosed çš„ GitHub Releases](https://github.com/LSPosed/LSPosed/releases) é¡µé¢ä¸‹è½½æœ€æ–°çš„ Zygisk ç‰ˆæœ¬ ZIP åŒ…ã€‚

* åœ¨ Magisk Manager çš„&quot;æ¨¡å—&quot;é¡µï¼Œé€‰æ‹©&quot;ä»æœ¬åœ°å®‰è£…&quot;ï¼Œç„¶åé€‰ä¸­ä¸‹è½½çš„ LSPosed ZIP åŒ…ã€‚

* å®‰è£…å®Œæˆåï¼Œç‚¹å‡»å³ä¸‹è§’çš„&quot;é‡å¯&quot;æŒ‰é’®ã€‚
4. **éªŒè¯å®‰è£…**:
* é‡å¯åï¼Œæ¡Œé¢ä¸Šä¼šå‡ºç° LSPosed çš„ç®¡ç†ç¨‹åºå›¾æ ‡ã€‚

* æ‰“å¼€ LSPosedï¼Œå¦‚æœçŠ¶æ€æ˜¾ç¤ºä¸º&quot;å·²æ¿€æ´»&quot;ï¼Œåˆ™è¡¨ç¤ºæ¡†æ¶å®‰è£…æˆåŠŸã€‚
___
### å¼€å‘ç¬¬ä¸€ä¸ª Xposed æ¨¡å—

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œæ¥ Hook ç³»ç»Ÿçš„æ—¶é’Ÿï¼Œåœ¨åé¢åŠ ä¸Šä¸€ä¸ªå°å°¾å·´ã€‚

#### 1. é¡¹ç›®ç»“æ„

* åœ¨ Android Studio ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç©ºçš„ Android é¡¹ç›®ã€‚

* åœ¨ app çš„ `build.gradle` æ–‡ä»¶ä¸­æ·»åŠ  Xposed API ä¾èµ–ï¼š
    ```groovy
dependencies {
// ... other dependencies
compileOnly &#39;de.robv.android.xposed:api:82&#39;
// &#39;compileOnly&#39; is used because the framework is already provided by the system, only needed at compile time
}
</code></pre>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ Java ç±»ï¼Œä¾‹å¦‚ <code>ClockHook</code>ï¼Œå¹¶è®©å®ƒå®ç°
<code>IXposedHookLoadPackage</code> æ¥å£ã€‚</li>
</ul>
<div class="sourceCode" id="cb398"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">example</span><span class="op">.</span><span class="im">myxposedmodule</span><span class="op">;</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">IXposedHookLoadPackage</span><span class="op">;</span></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">XC_MethodHook</span><span class="op">;</span></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">XposedBridge</span><span class="op">;</span></span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">XposedHelpers</span><span class="op">;</span></span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">de</span><span class="op">.</span><span class="im">robv</span><span class="op">.</span><span class="im">android</span><span class="op">.</span><span class="im">xposed</span><span class="op">.</span><span class="im">callbacks</span><span class="op">.</span><span class="im">XC_LoadPackage</span><span class="op">.</span><span class="im">LoadPackageParam</span><span class="op">;</span></span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">android</span><span class="op">.</span><span class="im">widget</span><span class="op">.</span><span class="im">TextView</span><span class="op">;</span></span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ClockHook <span class="kw">implements</span> IXposedHookLoadPackage <span class="op">{</span></span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb398-12"><a href="#cb398-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleLoadPackage</span><span class="op">(</span><span class="dt">final</span> LoadPackageParam lpparam<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb398-13"><a href="#cb398-13" aria-hidden="true" tabindex="-1"></a><span class="co">// We only care about system UI</span></span>
<span id="cb398-14"><a href="#cb398-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>lpparam<span class="op">.</span><span class="fu">packageName</span><span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;com.android.systemui&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb398-15"><a href="#cb398-15" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb398-16"><a href="#cb398-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb398-17"><a href="#cb398-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-18"><a href="#cb398-18" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;Loaded app: &quot;</span> <span class="op">+</span> lpparam<span class="op">.</span><span class="fu">packageName</span><span class="op">);</span></span>
<span id="cb398-19"><a href="#cb398-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-20"><a href="#cb398-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Find and Hook the clock update class and method</span></span>
<span id="cb398-21"><a href="#cb398-21" aria-hidden="true" tabindex="-1"></a><span class="co">// (Note: class names and method names may differ across Android versions)</span></span>
<span id="cb398-22"><a href="#cb398-22" aria-hidden="true" tabindex="-1"></a>XposedHelpers<span class="op">.</span><span class="fu">findAndHookMethod</span><span class="op">(</span></span>
<span id="cb398-23"><a href="#cb398-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;com.android.systemui.statusbar.policy.Clock&quot;</span><span class="op">,</span> <span class="co">// Class name</span></span>
<span id="cb398-24"><a href="#cb398-24" aria-hidden="true" tabindex="-1"></a>lpparam<span class="op">.</span><span class="fu">classLoader</span><span class="op">,</span> <span class="co">// ClassLoader</span></span>
<span id="cb398-25"><a href="#cb398-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;updateClock&quot;</span><span class="op">,</span> <span class="co">// Method name</span></span>
<span id="cb398-26"><a href="#cb398-26" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span> <span class="co">// Hook callback</span></span>
<span id="cb398-27"><a href="#cb398-27" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb398-28"><a href="#cb398-28" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">afterHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb398-29"><a href="#cb398-29" aria-hidden="true" tabindex="-1"></a><span class="kw">super</span><span class="op">.</span><span class="fu">afterHookedMethod</span><span class="op">(</span>param<span class="op">);</span></span>
<span id="cb398-30"><a href="#cb398-30" aria-hidden="true" tabindex="-1"></a>TextView clockView <span class="op">=</span> <span class="op">(</span>TextView<span class="op">)</span> param<span class="op">.</span><span class="fu">thisObject</span><span class="op">;</span></span>
<span id="cb398-31"><a href="#cb398-31" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> originalTime <span class="op">=</span> clockView<span class="op">.</span><span class="fu">getText</span><span class="op">().</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb398-32"><a href="#cb398-32" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> newTime <span class="op">=</span> originalTime <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">;</span></span>
<span id="cb398-33"><a href="#cb398-33" aria-hidden="true" tabindex="-1"></a>clockView<span class="op">.</span><span class="fu">setText</span><span class="op">(</span>newTime<span class="op">);</span></span>
<span id="cb398-34"><a href="#cb398-34" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;Clock hooked! New time: &quot;</span> <span class="op">+</span> newTime<span class="op">);</span></span>
<span id="cb398-35"><a href="#cb398-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb398-36"><a href="#cb398-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb398-37"><a href="#cb398-37" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb398-38"><a href="#cb398-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb398-39"><a href="#cb398-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>åœ¨ <code>app/src/main/AndroidManifest.xml</code> çš„
<code>&lt;application&gt;</code> æ ‡ç­¾å†…ï¼Œæ·»åŠ  meta-data æ¥å£°æ˜è¿™æ˜¯ä¸€ä¸ª
Xposed æ¨¡å—ã€‚</li>
</ul>
<div class="sourceCode" id="cb399"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">meta-data</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a><span class="ot">android:name=</span><span class="st">&quot;xposedmodule&quot;</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a><span class="ot">android:value=</span><span class="st">&quot;true&quot;</span> /&gt;</span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">meta-data</span></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a><span class="ot">android:name=</span><span class="st">&quot;xposeddescription&quot;</span></span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a><span class="ot">android:value=</span><span class="st">&quot;This is an example module that adds a tail to system clock&quot;</span> /&gt;</span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">meta-data</span></span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a><span class="ot">android:name=</span><span class="st">&quot;xposedminversion&quot;</span></span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a><span class="ot">android:value=</span><span class="st">&quot;52&quot;</span> /&gt;</span></code></pre></div>
<ul>
<li><p>åœ¨ <code>assets</code> æ–‡ä»¶å¤¹å†…ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º
<code>xposed_init</code> çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p></li>
<li><p>åœ¨ <code>xposed_init</code> æ–‡ä»¶ä¸­ï¼Œå†™å…¥ä½ çš„ Hook ç±»çš„å®Œæ•´è·¯å¾„ï¼š
```</p></li>
</ul>
<p>com.example.myxposedmodule.ClockHook</p>
<pre><code>
1. **æ„å»º APK**: åœ¨ Android Studio ä¸­æ„å»ºä½ çš„é¡¹ç›®ï¼Œç”Ÿæˆ APKã€‚
2. **å®‰è£… APK**: å°† APK å®‰è£…åˆ°ä½ çš„æµ‹è¯•è®¾å¤‡ä¸Šã€‚
3. **æ¿€æ´»æ¨¡å—**:
* æ‰“å¼€ LSPosed Managerã€‚

* è¿›å…¥&quot;æ¨¡å—&quot;éƒ¨åˆ†ï¼Œæ‰¾åˆ°ä½ åˆšåˆšå®‰è£…çš„æ¨¡å—ã€‚

* ç‚¹å‡»å®ƒï¼Œç„¶å**å¯ç”¨**æ¨¡å—ã€‚

* åœ¨ä½œç”¨åŸŸåˆ—è¡¨ä¸­ï¼Œå‹¾é€‰&quot;**SystemUI**&quot;ã€‚
4. **é‡å¯ç›®æ ‡è¿›ç¨‹**:
* åœ¨ LSPosed çš„çŠ¶æ€é¡µå³ä¸Šè§’ï¼Œç‚¹å‡»ä¸‰ä¸ªç‚¹èœå•ï¼Œé€‰æ‹©&quot;è½¯é‡å¯&quot;æˆ–&quot;é‡å¯ SystemUI&quot;ï¼Œæˆ–è€…ç›´æ¥é‡å¯æ‰‹æœºã€‚
5. **æŸ¥çœ‹æ•ˆæœ**: æŸ¥çœ‹ä½ çš„çŠ¶æ€æ æ—¶é’Ÿï¼Œå®ƒç°åœ¨åº”è¯¥å¸¦æœ‰ä¸€ä¸ª å°å°¾å·´äº†ï¼ä½ ä¹Ÿå¯ä»¥åœ¨ LSPosed çš„æ—¥å¿—ä¸­çœ‹åˆ° `XposedBridge.log` è¾“å‡ºçš„ä¿¡æ¯ã€‚
___
### æ ¸å¿ƒ API è¯¦è§£

#### `IXposedHookLoadPackage`
è¿™æ˜¯æ‰€æœ‰æ¨¡å—çš„å…¥å£ç‚¹ã€‚å®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³• `handleLoadPackage(LoadPackageParam lpparam)`ã€‚å½“ä»»ä½•ä¸€ä¸ª App å¯åŠ¨æ—¶ï¼ŒXposed éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¼ å…¥ `lpparam` å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ï¼š

* `lpparam.packageName`: å½“å‰åŠ è½½çš„ App çš„åŒ…åã€‚

* `lpparam.processName`: å½“å‰è¿›ç¨‹åã€‚

* `lpparam.classLoader`: å½“å‰ App çš„ ClassLoaderï¼Œè¿™æ˜¯ Hook App å†…éƒ¨ç±»çš„**å¿…éœ€å“**ã€‚

#### `XposedHelpers`
ä¸€ä¸ªåŒ…å«å¤§é‡é™æ€è¾…åŠ©æ–¹æ³•çš„å·¥å…·ç±»ï¼Œæå¤§ç®€åŒ–äº†åå°„æ“ä½œã€‚

* `findAndHookMethod(String className, ClassLoader classLoader, String methodName, Object... parameterTypesAndCallback)`: æœ€æ ¸å¿ƒçš„ Hook æ–¹æ³•ã€‚æœ€åä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ `XC_MethodHook` å›è°ƒã€‚

* `findClass(String className, ClassLoader classLoader)`: æŸ¥æ‰¾ä¸€ä¸ªç±»ã€‚

* `getObjectField(Object obj, String fieldName)` / `setObjectField(Object obj, String fieldName, Object value)`: è·å–/è®¾ç½®å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚

* `callMethod(Object obj, String methodName, Object... args)`: è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚

* `getStaticObjectField(...)` / `callStaticMethod(...)`: ç”¨äºæ“ä½œé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ã€‚

#### `XC_MethodHook`
è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½ éœ€è¦ç»§æ‰¿å®ƒå¹¶é‡å†™å®ƒçš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ã€‚

* `beforeHookedMethod(MethodHookParam param)`: åœ¨åŸæ–¹æ³•æ‰§è¡Œ**å‰**è¢«è°ƒç”¨ã€‚

* `afterHookedMethod(MethodHookParam param)`: åœ¨åŸæ–¹æ³•æ‰§è¡Œ**å**è¢«è°ƒç”¨ã€‚

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ª `MethodHookParam` å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æœ¬æ¬¡æ–¹æ³•è°ƒç”¨çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

* `param.thisObject`: `this` æŒ‡é’ˆï¼Œå³æ–¹æ³•æ‰€å±çš„å¯¹è±¡å®ä¾‹ã€‚

* `param.args`: `Object[]` æ•°ç»„ï¼ŒåŒ…å«äº†æ–¹æ³•è¢«è°ƒç”¨æ—¶çš„æ‰€æœ‰å‚æ•°ã€‚ä½ å¯ä»¥åœ¨ `beforeHookedMethod` ä¸­ä¿®æ”¹å®ƒã€‚

* `param.getResult()`: è·å–åŸæ–¹æ³•çš„è¿”å›å€¼ã€‚åªèƒ½åœ¨ `afterHookedMethod` ä¸­è°ƒç”¨ã€‚

* `param.setResult(Object result)`: è®¾ç½®ä¸€ä¸ªæ–°çš„è¿”å›å€¼ã€‚å¦‚æœåœ¨ `beforeHookedMethod` ä¸­è°ƒç”¨ï¼ŒåŸæ–¹æ³•å°†**ä¸ä¼šè¢«æ‰§è¡Œ**ã€‚å¦‚æœåœ¨ `afterHookedMethod` ä¸­è°ƒç”¨ï¼Œå®ƒä¼šè¦†ç›–åŸæ–¹æ³•çš„è¿”å›å€¼ã€‚

* `param.getThrowable()` / `param.setThrowable(Throwable t)`: ç”¨äºè·å–/è®¾ç½®æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ã€‚
___
### å¸¸è§åº”ç”¨åœºæ™¯

* **UI å®šåˆ¶**: ä¿®æ”¹ç³»ç»Ÿæˆ–åº”ç”¨çš„å¤–è§‚ï¼Œå¦‚çŠ¶æ€æ ã€é€šçŸ¥ã€é”å±ç­‰ï¼ˆä»£è¡¨ä½œï¼š`GravityBox`ï¼‰ã€‚

* **åŠŸèƒ½å¢å¼º**: ä¸ºåº”ç”¨æ·»åŠ åŸç”Ÿä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œå¦‚ä¸ºå¾®ä¿¡æ·»åŠ é˜²æ’¤å›ã€è‡ªåŠ¨æŠ¢çº¢åŒ…åŠŸèƒ½ã€‚

* **å»é™¤é™åˆ¶**: ç ´è§£åº”ç”¨çš„ä»˜è´¹åŠŸèƒ½ã€å»é™¤æˆªå›¾é™åˆ¶ã€å»é™¤å¹¿å‘Šç­‰ã€‚

* **éšç§ä¿æŠ¤**: æ‹¦æˆªåº”ç”¨è·å–æ•æ„Ÿä¿¡æ¯çš„è¯·æ±‚ï¼ˆå¦‚å®šä½ã€è”ç³»äººã€è®¾å¤‡IDï¼‰ï¼Œå¹¶è¿”å›è™šå‡æˆ–ç©ºæ•°æ®ï¼ˆä»£è¡¨ä½œï¼š`XPrivacyLua`ï¼‰ã€‚

* **å®‰å…¨åˆ†æ**:
* ç»•è¿‡ SSL Pinningï¼ˆå°½ç®¡ Frida æ›´çµæ´»ï¼‰ã€‚

* ç¦ç”¨ Root æ£€æµ‹æˆ–åè°ƒè¯•æœºåˆ¶ã€‚

* æ—¥å¿—è®°å½•ï¼šæ‰“å°å…³é”®æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œåˆ†æåº”ç”¨è¡Œä¸ºã€‚





&lt;!-- 02-Tools/Dynamic/xposed_internals.md --&gt;

# Xposed å†…éƒ¨åŸç†ï¼šæ·±åº¦å‰–æ

Xposed æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Android æ¡†æ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨è¿è¡Œæ—¶ä¿®æ”¹ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿›ç¨‹çš„è¡Œä¸ºï¼Œè€Œæ— éœ€ä¿®æ”¹ä»»ä½• APK æ–‡ä»¶ã€‚æœ¬æ–‡æ¡£æ·±å…¥æ¢è®¨äº† Xposed å·¥ä½œçš„æ ¸å¿ƒåŸç†ã€‚
___
## 1. å…¥å£ç‚¹ï¼šZygote è¿›ç¨‹æ³¨å…¥

Xposed çš„åŸºç¡€åœ¨äºå®ƒèƒ½å¤Ÿå°†è‡ªå®šä¹‰ä»£ç æ³¨å…¥åˆ°æ¯ä¸ª Android åº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚å®ƒé€šè¿‡é’ˆå¯¹ **Zygote** è¿›ç¨‹æ¥å®ç°è¿™ä¸€ç‚¹ï¼ŒZygote æ˜¯ Android OS ä¸­çš„åŸå§‹è¿›ç¨‹ï¼Œæ‰€æœ‰åº”ç”¨ç¨‹åºè¿›ç¨‹éƒ½ä»å®ƒ fork è€Œæ¥ã€‚

### å·¥ä½œåŸç†ï¼š

1. **æ›¿æ¢ `app_process`**ï¼šåœ¨å®‰è£…æœŸé—´ï¼ŒXposed ç”¨è‡ªå·±ä¿®æ”¹åçš„ç‰ˆæœ¬æ›¿æ¢åŸå§‹çš„ `/system/bin/app_process` å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ˜¯ Zygote è¿›ç¨‹å¯åŠ¨çš„ç¬¬ä¸€ä¸ªç¨‹åºã€‚

2. **åŠ è½½æ¡¥æ¥å™¨**ï¼šå½“ Zygote å¯åŠ¨æ—¶ï¼Œå®ƒè¿è¡Œ Xposed ç‰ˆæœ¬çš„ `app_process`ã€‚è¿™ä¸ªè‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸»è¦ä»»åŠ¡æ˜¯å°†ä¸€ä¸ªç‰¹æ®Šçš„ JAR æ–‡ä»¶ï¼ˆé€šå¸¸ç§°ä¸º **Xposed Bridge**ï¼Œå³ `XposedBridge.jar`ï¼‰åŠ è½½åˆ° Zygote çš„åœ°å€ç©ºé—´ä¸­ã€‚

3. **é€šè¿‡ Fork ç»§æ‰¿**ï¼šç”±äºæ¯ä¸ª Android åº”ç”¨ç¨‹åºéƒ½æ˜¯ Zygote è¿›ç¨‹çš„ forkï¼Œå®ƒä»¬éƒ½ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚è¿™æ„å‘³ç€ Xposed Bridge JAR ä»åˆ›å»ºæ—¶åˆ»èµ·å°±è‡ªåŠ¨åŠ è½½åˆ°æ¯ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚

è¿™ç§å·§å¦™çš„æ–¹æ³•ç¡®ä¿ Xposed çš„æ ¸å¿ƒé€»è¾‘åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­éƒ½å­˜åœ¨å¹¶å‡†å¤‡å¥½æ‰§è¡Œï¼Œä¸ºæ–¹æ³• Hook æä¾›äº†ä¸€ä¸ªé€šç”¨å¹³å°ã€‚

## 2. æ ¸å¿ƒé­”æ³•ï¼šæ–¹æ³• Hook

Xposed æœ€è‘—åçš„åŠŸèƒ½æ˜¯å…¶&quot;Hook&quot;Java æ–¹æ³•çš„èƒ½åŠ›ã€‚è¿™ä¸æ˜¯ç®€å•çš„åå°„ï¼›å®ƒæ˜¯å¯¹åº•å±‚è™šæ‹Ÿæœºæ•°æ®ç»“æ„çš„æ·±åº¦æ“çºµã€‚

### `Method` ç»“æ„è½¬æ¢ï¼š

æ ¸å¿ƒæ€æƒ³æ˜¯æ”¹å˜è™šæ‹Ÿæœºä¸­ç›®æ ‡ Java æ–¹æ³•çš„ç±»å‹ç­¾åï¼Œä½¿è™šæ‹Ÿæœºè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ª `native` æ–¹æ³•ã€‚

1. **æŸ¥æ‰¾ç›®æ ‡**ï¼šæ¨¡å—ä½¿ç”¨ `findAndHookMethod` ç­‰è¾…åŠ©å‡½æ•°æ¥æŒ‡å®šå®ƒä»¬å¸Œæœ› Hook çš„ç±»å’Œæ–¹æ³•ã€‚

2. **ä¿®æ”¹ `Method` å¯¹è±¡**ï¼šåœ¨å†…éƒ¨ï¼ŒXposed ä½¿ç”¨åå°„å’Œæœ¬åœ°ä»£ç æ¥è·å–ä¸ç›®æ ‡å¯¹åº”çš„ Java `java.lang.reflect.Method` å¯¹è±¡çš„å¥æŸ„ã€‚

3. **&quot;Native&quot;ä¼ªè£…**ï¼š

- Xposed ä¿®æ”¹ `Method` å¯¹è±¡çš„ `accessFlags`ï¼Œæ·»åŠ  `ACC_NATIVE` æ ‡å¿—ã€‚

- ç„¶åå®ƒè¦†ç›–æ–¹æ³•çš„å…¥å£ç‚¹æŒ‡é’ˆã€‚åœ¨ ART è¿è¡Œæ—¶ä¸­ï¼Œè¿™æ„å‘³ç€æ›¿æ¢å†…éƒ¨ `ArtMethod` ç»“æ„ä¸­çš„ `entry_point_from_quick_compiled_code_` å­—æ®µã€‚

- è¿™ä¸ªæ–°çš„å…¥å£ç‚¹ç°åœ¨æŒ‡å‘ Xposed æä¾›çš„é€šç”¨åŸç”Ÿæ¡¥æ¥å‡½æ•°ã€‚

4. **ä¿å­˜åŸå§‹æ–¹æ³•**ï¼šåœ¨è¦†ç›–ä¹‹å‰ï¼ŒXposed ä»”ç»†åœ°å°†åŸå§‹æ–¹æ³•çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬å…¶åŸå§‹å…¥å£ç‚¹å’Œè®¿é—®æ ‡å¿—ï¼‰ä¿å­˜åˆ°å•ç‹¬çš„å¤‡ä»½ç»“æ„ä¸­ã€‚

### Hooked æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼š

å½“åº”ç”¨ç¨‹åºè°ƒç”¨è¢« Xposed Hook çš„æ–¹æ³•æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹åºåˆ—ï¼š

1. **ç»•é“åˆ°åŸç”Ÿæ¡¥æ¥å™¨**ï¼šè™šæ‹Ÿæœºç°åœ¨è®¤ä¸ºè¯¥æ–¹æ³•æ˜¯åŸç”Ÿæ–¹æ³•ï¼Œå°†è°ƒç”¨å®šå‘åˆ° Xposed çš„é€šç”¨åŸç”Ÿæ¡¥æ¥å‡½æ•°ã€‚

2. **å›è°ƒåˆ° Java æ¡¥æ¥å™¨**ï¼šåŸç”Ÿå‡½æ•°åšçš„äº‹æƒ…å¾ˆå°‘ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯å›è°ƒåˆ° Java ä¸–ç•Œï¼Œè°ƒç”¨ Xposed Bridge ä¸­çš„æ ¸å¿ƒ Java æ–¹æ³•ï¼š`handleHookedMethod`ã€‚

3. **`handleHookedMethod` åè°ƒ**ï¼šè¿™ä¸ªå¼ºå¤§çš„ Java æ–¹æ³•åè°ƒæ•´ä¸ª Hook ç”Ÿå‘½å‘¨æœŸï¼š

a. å®ƒå°†æ–¹æ³•çš„å‚æ•°å’Œ `this` å¼•ç”¨å‡†å¤‡åˆ°ä¸€ä¸ª `MethodHookParam` å¯¹è±¡ä¸­ã€‚

b. **`beforeHookedMethod`**ï¼šå®ƒéå†æ¨¡å—ä¸­æ‰€æœ‰æ³¨å†Œçš„å›è°ƒï¼Œå¹¶è°ƒç”¨å®ƒä»¬çš„ `beforeHookedMethod` æ–¹æ³•ã€‚è¿™äº›å›è°ƒå¯ä»¥æ£€æŸ¥æˆ–ä¿®æ”¹å‚æ•°ã€‚å…³é”®çš„æ˜¯ï¼Œ&quot;before&quot;å›è°ƒå¯ä»¥é€‰æ‹©é€šè¿‡ç›´æ¥åœ¨ `param` å¯¹è±¡ä¸Šè®¾ç½®ç»“æœæ¥å®Œå…¨è·³è¿‡åŸå§‹æ–¹æ³•ã€‚

c. **è°ƒç”¨åŸå§‹æ–¹æ³•**ï¼šå¦‚æœæ–¹æ³•æ²¡æœ‰è¢«è·³è¿‡ï¼Œ`handleHookedMethod` ä½¿ç”¨ä¿å­˜çš„å¤‡ä»½ä¿¡æ¯æ¥è°ƒç”¨åŸå§‹æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ï¼ˆå¯èƒ½å·²ä¿®æ”¹çš„ï¼‰å‚æ•°ã€‚

d. **`afterHookedMethod`**ï¼šåœ¨åŸå§‹æ–¹æ³•å®Œæˆåï¼Œå®ƒå†æ¬¡éå†å›è°ƒï¼Œè¿™æ¬¡è°ƒç”¨å®ƒä»¬çš„ `afterHookedMethod` æ–¹æ³•ã€‚è¿™äº›å›è°ƒå¯ä»¥æ£€æŸ¥æˆ–ä¿®æ”¹æ–¹æ³•çš„è¿”å›å€¼ã€‚

4. **è¿”å›ç»™è°ƒç”¨è€…**ï¼šæœ€åï¼Œ`handleHookedMethod` å°†æœ€ç»ˆç»“æœï¼ˆæ¥è‡ª&quot;before&quot;å›è°ƒæˆ–åŸå§‹æ–¹æ³•çš„ï¼ˆå·²ä¿®æ”¹çš„ï¼‰ç»“æœï¼‰è¿”å›ç»™åº”ç”¨ç¨‹åºçš„åŸå§‹è°ƒç”¨ç‚¹ã€‚

æ•´ä¸ªè¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºä»£ç æ˜¯é€æ˜çš„ï¼Œåº”ç”¨ç¨‹åºåªæ˜¯çœ‹åˆ°ä¸€ä¸ªè¿”å›å€¼çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸çŸ¥é“å®ƒç»å†äº†å¤æ‚çš„ç»•é“ã€‚

## 3. æ¨¡å—åŠ è½½æœºåˆ¶

Xposed æ¨¡å—æ˜¯æ ‡å‡†çš„ Android APKï¼Œå®ƒä»¬å‘æ¡†æ¶è¡¨æ˜è‡ªå·±çš„æ€§è´¨ã€‚

- **`AndroidManifest.xml`**ï¼šæ¨¡å—çš„æ¸…å•æ–‡ä»¶å¿…é¡»åŒ…å«ä¸€ä¸ª `&lt;meta-data&gt;` æ ‡ç­¾ï¼Œå…¶ä¸­ `android:name=&quot;xposedmodule&quot;` è®¾ç½®ä¸º `true`ã€‚

- **`assets/xposed_init`**ï¼šæ¨¡å— assets ç›®å½•ä¸­çš„è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ–‡ä»¶ã€‚æ¯è¡ŒæŒ‡å‘ä¸€ä¸ªå®Œå…¨é™å®šçš„ç±»åã€‚

- **`IXposedHookLoadPackage`**ï¼š`xposed_init` ä¸­åˆ—å‡ºçš„ç±»å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ã€‚Xposed æ¡†æ¶å°†å®ä¾‹åŒ–è¿™äº›ç±»ï¼Œå¹¶ä¸ºæ¯ä¸ªåŠ è½½çš„åº”ç”¨ç¨‹åºåŒ…è°ƒç”¨å®ƒä»¬çš„ `handleLoadPackage` æ–¹æ³•ï¼Œå…è®¸æ¨¡å—å†³å®šæ˜¯å¦åº”ç”¨å…¶ Hookã€‚
___
## æ¶æ„å›¾è§£

### Xposed å·¥ä½œæµç¨‹å›¾
</code></pre>
<p>â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å¯åŠ¨ Zygote è¿›ç¨‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ è¿è¡Œä¿®æ”¹çš„
app_process â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ åŠ è½½ XposedBridge.jar â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Fork
åº”ç”¨è¿›ç¨‹ â”‚ â”‚ (ç»§æ‰¿ Xposed Bridge) â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ åº”ç”¨å¯åŠ¨ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ åŠ è½½ Xposed æ¨¡å— â”‚ â”‚ (è°ƒç”¨
handleLoadPackage)â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Hook ç›®æ ‡æ–¹æ³• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VM æŸ¥æ‰¾æ–¹æ³•å…¥å£ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æµ‹åˆ° ACC_NATIVE æ ‡å¿— â”‚
â”‚ (å·²è¢« Xposed ä¿®æ”¹) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·³è½¬åˆ° Xposed Native Bridge â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ handleHookedMethod â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€â”€â–º è°ƒç”¨ beforeHookedMethod å›è°ƒ
â”‚ (å¯ä»¥ä¿®æ”¹å‚æ•°æˆ–è·³è¿‡åŸæ–¹æ³•)
â”‚
â”œâ”€â”€â–º è°ƒç”¨åŸå§‹æ–¹æ³• (å¦‚æœæœªè·³è¿‡)
â”‚ (ä½¿ç”¨å¤‡ä»½çš„åŸå§‹å…¥å£ç‚¹)
â”‚
â”œâ”€â”€â–º è°ƒç”¨ afterHookedMethod å›è°ƒ
â”‚ (å¯ä»¥ä¿®æ”¹è¿”å›å€¼)
â”‚
â–¼
è¿”å›ç»™è°ƒç”¨è€…
</code></pre>
<p><strong>å…³é”®å­—æ®µä¿®æ”¹ï¼š</strong></p>
<ul>
<li><code>access_flags_</code>: æ·»åŠ  <code>ACC_NATIVE</code> æ ‡å¿—</li>
<li><code>entry_point_from_quick_compiled_code_</code>: æ›¿æ¢ä¸º Xposed
æ¡¥æ¥å‡½æ•°åœ°å€</li>
<li>å¤‡ä»½åŸå§‹å­—æ®µå€¼ä»¥ä¾¿åç»­æ¢å¤</li>
</ul>
<p><strong>ä¼ªä»£ç ç¤ºä¾‹ï¼š</strong></p>
<div class="sourceCode" id="cb402"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Xposed å†…éƒ¨ç®€åŒ–é€»è¾‘</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hookMethod<span class="op">(</span>ArtMethod<span class="op">*</span> method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ä¿å­˜åŸå§‹ä¿¡æ¯</span></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>backup<span class="op">.</span>original_flags <span class="op">=</span> method<span class="op">-&gt;</span><span class="va">access_flags_</span><span class="op">;</span></span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a>backup<span class="op">.</span>original_entry <span class="op">=</span> method<span class="op">-&gt;</span><span class="va">entry_point_from_quick_compiled_code_</span><span class="op">;</span></span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a><span class="co">// ä¿®æ”¹ä¸º native æ–¹æ³•</span></span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a>method<span class="op">-&gt;</span><span class="va">access_flags_</span> <span class="op">|=</span> ACC_NATIVE<span class="op">;</span></span>
<span id="cb402-9"><a href="#cb402-9" aria-hidden="true" tabindex="-1"></a>method<span class="op">-&gt;</span><span class="va">entry_point_from_quick_compiled_code_</span> <span class="op">=</span> xposed_bridge_entry<span class="op">;</span></span>
<span id="cb402-10"><a href="#cb402-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>æ¨¡å— A - beforeHookedMethod â”‚ â–¼ æ¨¡å— B - beforeHookedMethod â”‚ â–¼
åŸå§‹æ–¹æ³•æ‰§è¡Œ â”‚ â–¼ æ¨¡å— B - afterHookedMethod â”‚ â–¼ æ¨¡å— A -
afterHookedMethod â”‚ â–¼ è¿”å›ç»“æœ</p>
<pre><code>
### 3. æ€§èƒ½ä¼˜åŒ–æœºåˆ¶

* *JIT/AOT ç¼–è¯‘å½±å“ï¼š**

- Hooked æ–¹æ³•è¢«æ ‡è®°ä¸º nativeï¼Œé¿å… JIT ç¼–è¯‘
- é€šè¿‡ native æ¡¥æ¥çš„é¢å¤–å¼€é”€ï¼ˆçº¦ 10-50Î¼s æ¯æ¬¡è°ƒç”¨ï¼‰
- å¤§é‡ Hook å¯èƒ½å½±å“åº”ç”¨å¯åŠ¨æ—¶é—´

* *æœ€ä½³å®è·µï¼š**

- åª Hook å¿…è¦çš„æ–¹æ³•
- åœ¨å›è°ƒä¸­é¿å…è€—æ—¶æ“ä½œ
- ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å‡å°‘ä¸å¿…è¦çš„å¤„ç†
___
## ä¸å…¶ä»– Hook æ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | Xposed | Frida | VirtualXposed |
| ------------- | ------------ | --------------------- | ------------- |
| **éœ€è¦ Root** | æ˜¯ | å¦ï¼ˆGadget æ¨¡å¼é™¤å¤–ï¼‰ | å¦ |
| **æ³¨å…¥æ–¹å¼** | Zygote çº§åˆ« | è¿›ç¨‹çº§åˆ« | è™šæ‹ŸåŒ–å®¹å™¨ |
| **æ€§èƒ½å¼€é”€** | ä½-ä¸­ | ä¸­-é«˜ | ä¸­ |
| **å¼€å‘è¯­è¨€** | Java | JavaScript/Python | Java |
| **åŠ¨æ€æ€§** | é‡å¯åº”ç”¨ç”Ÿæ•ˆ | å®æ—¶ç”Ÿæ•ˆ | é‡å¯åº”ç”¨ç”Ÿæ•ˆ |
| **ç¨³å®šæ€§** | é«˜ | ä¸­ | ä¸­-ä½ |
| **é€‚ç”¨åœºæ™¯** | é•¿æœŸä¿®æ”¹ | åŠ¨æ€åˆ†æ/è°ƒè¯• | æ—  Root æµ‹è¯• |
___
## å®‰å…¨å½±å“ä¸æ£€æµ‹

### åº”ç”¨å±‚æ£€æµ‹æ–¹æ³•

* *1. æ£€æŸ¥ Xposed ç‰¹å¾æ–‡ä»¶ï¼š**

```java
private boolean isXposedInstalled() {
try {
// æ£€æŸ¥ XposedBridge ç±»
Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;);
return true;
} catch (ClassNotFoundException e) {
return false;
}
}
</code></pre>
<p>int modifiers = method.getModifiers(); return
Modifier.isNative(modifiers) &amp;&amp; !shouldBeNative(method); }</p>
<pre><code>for (StackTraceElement trace : traces) {
if (trace.getClassName().contains(&quot;XposedBridge&quot;)) {
return true;
}
}
return false;
}
</code></pre>
<ol start="3" type="1">
<li>æ¸…ç†å †æ ˆè·Ÿè¸ªä¿¡æ¯</li>
<li>ä½¿ç”¨å®šåˆ¶ç‰ˆ Xposedï¼ˆä¿®æ”¹ç‰¹å¾å­—ç¬¦ä¸²ï¼‰ ___ ## å®é™…åº”ç”¨åœºæ™¯</li>
</ol>
<h3 id="éšç§ä¿æŠ¤">1. éšç§ä¿æŠ¤</h3>
<ul>
<li>ä¼ªé€ è®¾å¤‡ä¿¡æ¯ï¼ˆIMEIã€MAC åœ°å€ç­‰ï¼‰</li>
<li>é˜»æ­¢æƒé™è¯·æ±‚</li>
<li>æ‹¦æˆªæ•æ„Ÿæ•°æ®ä¸Šä¼ </li>
</ul>
<h3 id="åŠŸèƒ½å¢å¼º">2. åŠŸèƒ½å¢å¼º</h3>
<ul>
<li>ç§»é™¤å¹¿å‘Š</li>
<li>è§£é” VIP åŠŸèƒ½</li>
<li>ä¿®æ”¹åº”ç”¨è¡Œä¸º</li>
</ul>
<h3 id="é€†å‘åˆ†æ">3. é€†å‘åˆ†æ</h3>
<ul>
<li>ç›‘æ§æ–¹æ³•è°ƒç”¨</li>
<li>æå–åŠ å¯†å¯†é’¥</li>
<li>åˆ†æç®—æ³•é€»è¾‘</li>
</ul>
<h3 id="è‡ªåŠ¨åŒ–æµ‹è¯•">4. è‡ªåŠ¨åŒ–æµ‹è¯•</h3>
<ul>
<li>æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸º</li>
<li>æ³¨å…¥æµ‹è¯•æ•°æ®</li>
<li>ç»•è¿‡éªŒè¯ç  ___ ## æ¨¡å—å¼€å‘ç¤ºä¾‹</li>
</ul>
<h3 id="åŸºç¡€-hook-ç¤ºä¾‹">åŸºç¡€ Hook ç¤ºä¾‹</h3>
<div class="sourceCode" id="cb405"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyXposedModule <span class="kw">implements</span> IXposedHookLoadPackage <span class="op">{</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleLoadPackage</span><span class="op">(</span>XC_LoadPackage<span class="op">.</span><span class="fu">LoadPackageParam</span> lpparam<span class="op">)</span></span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a><span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a><span class="co">// åª Hook ç›®æ ‡åº”ç”¨</span></span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>lpparam<span class="op">.</span><span class="fu">packageName</span><span class="op">.</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;com.example.target&quot;</span><span class="op">))</span></span>
<span id="cb405-9"><a href="#cb405-9" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb405-10"><a href="#cb405-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-11"><a href="#cb405-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook æ–¹æ³•</span></span>
<span id="cb405-12"><a href="#cb405-12" aria-hidden="true" tabindex="-1"></a><span class="fu">findAndHookMethod</span><span class="op">(</span></span>
<span id="cb405-13"><a href="#cb405-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;com.example.target.MainActivity&quot;</span><span class="op">,</span></span>
<span id="cb405-14"><a href="#cb405-14" aria-hidden="true" tabindex="-1"></a>lpparam<span class="op">.</span><span class="fu">classLoader</span><span class="op">,</span></span>
<span id="cb405-15"><a href="#cb405-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;getUserInfo&quot;</span><span class="op">,</span> <span class="co">// æ–¹æ³•å</span></span>
<span id="cb405-16"><a href="#cb405-16" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">XC_MethodHook</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb405-17"><a href="#cb405-17" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb405-18"><a href="#cb405-18" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">beforeHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span></span>
<span id="cb405-19"><a href="#cb405-19" aria-hidden="true" tabindex="-1"></a><span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb405-20"><a href="#cb405-20" aria-hidden="true" tabindex="-1"></a><span class="co">// åœ¨æ–¹æ³•æ‰§è¡Œå‰</span></span>
<span id="cb405-21"><a href="#cb405-21" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;getUserInfo å³å°†è¢«è°ƒç”¨&quot;</span><span class="op">);</span></span>
<span id="cb405-22"><a href="#cb405-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb405-23"><a href="#cb405-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-24"><a href="#cb405-24" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb405-25"><a href="#cb405-25" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">afterHookedMethod</span><span class="op">(</span>MethodHookParam param<span class="op">)</span></span>
<span id="cb405-26"><a href="#cb405-26" aria-hidden="true" tabindex="-1"></a><span class="kw">throws</span> <span class="bu">Throwable</span> <span class="op">{</span></span>
<span id="cb405-27"><a href="#cb405-27" aria-hidden="true" tabindex="-1"></a><span class="co">// åœ¨æ–¹æ³•æ‰§è¡Œå</span></span>
<span id="cb405-28"><a href="#cb405-28" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> result <span class="op">=</span> <span class="op">(</span><span class="bu">String</span><span class="op">)</span> param<span class="op">.</span><span class="fu">getResult</span><span class="op">();</span></span>
<span id="cb405-29"><a href="#cb405-29" aria-hidden="true" tabindex="-1"></a>XposedBridge<span class="op">.</span><span class="fu">log</span><span class="op">(</span><span class="st">&quot;getUserInfo è¿”å›: &quot;</span> <span class="op">+</span> result<span class="op">);</span></span>
<span id="cb405-30"><a href="#cb405-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-31"><a href="#cb405-31" aria-hidden="true" tabindex="-1"></a><span class="co">// ä¿®æ”¹è¿”å›å€¼</span></span>
<span id="cb405-32"><a href="#cb405-32" aria-hidden="true" tabindex="-1"></a>param<span class="op">.</span><span class="fu">setResult</span><span class="op">(</span><span class="st">&quot;Fake User Info&quot;</span><span class="op">);</span></span>
<span id="cb405-33"><a href="#cb405-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb405-34"><a href="#cb405-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb405-35"><a href="#cb405-35" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb405-36"><a href="#cb405-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb405-37"><a href="#cb405-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>lpparam.classLoader, byte[].class, // å‚æ•°ç±»å‹ String.class, new
XC_MethodHook() { <span class="citation"
data-cites="Override">@Override</span> protected void
afterHookedMethod(MethodHookParam param) throws Throwable { byte[] key =
(byte[]) param.args[0]; String algorithm = (String) param.args[1];</p>
<p>XposedBridge.log(â€œæ•è·å¯†é’¥!â€); XposedBridge.log(â€œç®—æ³•:â€ + algorithm);
XposedBridge.log(â€œå¯†é’¥:â€ + bytesToHex(key)); } } );</p>
<ol type="1">
<li><strong>ä¾èµ– Root æƒé™</strong>ï¼šéœ€è¦ç³»ç»Ÿçº§è®¿é—®</li>
<li><strong>ç¨³å®šæ€§é—®é¢˜</strong>ï¼šä¸å½“ä½¿ç”¨å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ</li>
<li><strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong>ï¼šéœ€è¦é’ˆå¯¹ä¸åŒ Android ç‰ˆæœ¬é€‚é…</li>
<li><strong>æ£€æµ‹ä¸å¯¹æŠ—</strong>ï¼šè¶Šæ¥è¶Šå¤šåº”ç”¨å®æ–½å Xposed æ£€æµ‹</li>
</ol>
<h3 id="æœªæ¥è¶‹åŠ¿">æœªæ¥è¶‹åŠ¿</h3>
<ol type="1">
<li><strong>EdXposed/LSPosed</strong>ï¼šåŸºäº Riru/Zygisk çš„æ–°å®ç°</li>
<li><strong>è™šæ‹ŸåŒ–æ–¹æ¡ˆ</strong>ï¼šVirtualXposedã€å¤ªæç­‰æ— éœ€ Root
çš„æ–¹æ¡ˆ</li>
<li><strong>å¯¹æŠ—å‡çº§</strong>ï¼šæ›´å¤æ‚çš„æ£€æµ‹ä¸åæ£€æµ‹æŠ€æœ¯ ___ ## æ€»ç»“</li>
</ol>
<p>Xposed é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯å®ç°äº†å¼ºå¤§çš„è¿è¡Œæ—¶ä¿®æ”¹èƒ½åŠ›ï¼š</p>
<ol type="1">
<li><strong>Zygote æ³¨å…¥</strong>ï¼šç¡®ä¿æ¯ä¸ªåº”ç”¨éƒ½åŠ è½½ Xposed Bridge</li>
<li><strong>æ–¹æ³•ä¼ªè£…</strong>ï¼šå°† Java æ–¹æ³•è½¬æ¢ä¸º
nativeï¼Œé‡å®šå‘å…¥å£ç‚¹</li>
<li><strong>å›è°ƒæœºåˆ¶</strong>ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘</li>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šçµæ´»çš„ APK æ’ä»¶ç³»ç»Ÿ</li>
</ol>
<p>è¿™ç§è®¾è®¡ä½¿ Xposed æˆä¸º Android
å¹³å°ä¸Šæœ€å¼ºå¤§çš„è¿è¡Œæ—¶ä¿®æ”¹æ¡†æ¶ä¹‹ä¸€ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†å®‰å…¨é£é™©å’Œæ£€æµ‹å¯¹æŠ—çš„æŒ‘æˆ˜ã€‚</p>
<p>ç†è§£ Xposed
çš„å†…éƒ¨åŸç†ä¸ä»…æœ‰åŠ©äºå¼€å‘æ›´å¥½çš„æ¨¡å—ï¼Œä¹Ÿä¸ºé€†å‘å·¥ç¨‹ã€å®‰å…¨ç ”ç©¶å’Œåº”ç”¨ä¿æŠ¤æä¾›äº†é‡è¦çš„æŠ€æœ¯æ´å¯Ÿã€‚</p>
<!-- 02-Tools/Static/ghidra_guide.md -->
<h1 id="ghidra-å…¥é—¨">Ghidra å…¥é—¨</h1>
<p>Ghidra æ˜¯ç”±ç¾å›½å›½å®¶å®‰å…¨å±€ (NSA) å¼€å‘å¹¶å¼€æºçš„ä¸€æ¬¾è½¯ä»¶é€†å‘å·¥ç¨‹ (SRE)
å¥—ä»¶ã€‚å®ƒä»¥åŠŸèƒ½å…¨é¢ã€å…è´¹å¼€æºã€è·¨å¹³å°ç­‰ç‰¹æ€§ï¼Œè¿…é€Ÿæˆä¸º IDA Pro
ä¹‹å¤–é€†å‘å·¥ç¨‹å¸ˆä»¬çš„å¦ä¸€ä¸ªé‡è¦é€‰æ‹©ï¼Œå°¤å…¶åœ¨å­¦æœ¯ç•Œå’Œç‹¬ç«‹ç ”ç©¶è€…ä¸­å¹¿å—æ¬¢è¿ã€‚
___ ## ç›®å½• 1. <a href="#æ ¸å¿ƒç‰¹æ€§"><strong>æ ¸å¿ƒç‰¹æ€§</strong></a> 2. <a
href="#ghidra-vs-ida-pro-vs-radare2"><strong>Ghidra vs.Â IDA Pro
vs.Â Radare2</strong></a> 3. <a
href="#å®‰è£…ä¸é…ç½®"><strong>å®‰è£…ä¸é…ç½®</strong></a> 4. <a
href="#åŸºæœ¬å·¥ä½œæµç¨‹"><strong>åŸºæœ¬å·¥ä½œæµç¨‹</strong></a> 5. <a
href="#å…³é”®çª—å£ä¸æ¦‚å¿µ"><strong>å…³é”®çª—å£ä¸æ¦‚å¿µ</strong></a></p>
<ul>
<li><p><a href="#code-browser-ä»£ç æµè§ˆå™¨">Code Browser
(ä»£ç æµè§ˆå™¨)</a></p></li>
<li><p><a href="#decompiler-åç¼–è¯‘å™¨">Decompiler (åç¼–è¯‘å™¨)</a></p></li>
<li><p><a href="#symbol-tree-ç¬¦å·æ ‘">Symbol Tree (ç¬¦å·æ ‘)</a></p></li>
<li><p><a href="#data-type-manager-æ•°æ®ç±»å‹ç®¡ç†å™¨">Data Type Manager
(æ•°æ®ç±»å‹ç®¡ç†å™¨)</a></p></li>
<li><p><a href="#code-browser-ä»£ç æµè§ˆå™¨">Code Browser
(ä»£ç æµè§ˆå™¨)</a></p></li>
<li><p><a href="#decompiler-åç¼–è¯‘å™¨">Decompiler (åç¼–è¯‘å™¨)</a></p></li>
<li><p><a href="#symbol-tree-ç¬¦å·æ ‘">Symbol Tree (ç¬¦å·æ ‘)</a></p></li>
<li><p><a href="#data-type-manager-æ•°æ®ç±»å‹ç®¡ç†å™¨">Data Type Manager
(æ•°æ®ç±»å‹ç®¡ç†å™¨)</a></p></li>
</ul>
<ol start="6" type="1">
<li><a href="#è„šæœ¬åŒ–ä¸è‡ªåŠ¨åŒ–"><strong>è„šæœ¬åŒ–ä¸è‡ªåŠ¨åŒ–</strong></a></li>
<li><a href="#ä¼˜ç¼ºç‚¹åˆ†æ"><strong>ä¼˜ç¼ºç‚¹åˆ†æ</strong></a> ___ ## #
æ ¸å¿ƒç‰¹æ€§</li>
</ol>
<ul>
<li><p><strong>å¼ºå¤§çš„åç¼–è¯‘å™¨ (Decompiler)</strong>: è¿™æ˜¯ Ghidra
çš„ç‹ç‰ŒåŠŸèƒ½ã€‚å®ƒå†…ç½®äº†ä¸€ä¸ªé«˜è´¨é‡çš„ã€æ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„çš„å…è´¹åç¼–è¯‘å™¨ï¼Œèƒ½å¤Ÿå°†æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºç±»ä¼¼
C/C++ çš„é«˜çº§è¯­è¨€ä¼ªä»£ç ï¼Œæå¤§åœ°æé«˜äº†ä»£ç ç†è§£æ•ˆç‡ã€‚</p></li>
<li><p><strong>å…¨é¢çš„åˆ†æèƒ½åŠ›</strong>:
æ”¯æŒå¯¹å¤šç§å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œåæ±‡ç¼–ã€åˆ†æã€åç¼–è¯‘ã€å›¾è¡¨ç»˜åˆ¶å’Œè„šæœ¬åŒ–ï¼ŒåŒ…æ‹¬
Windows, macOS, Linux, Android, iOS ç­‰ã€‚</p></li>
<li><p><strong>å¼ºå¤§çš„è„šæœ¬å¼•æ“</strong>: å†…ç½®å¯¹ Java å’Œ Python (é€šè¿‡
Jython)
çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·ç¼–å†™å¤æ‚çš„è„šæœ¬æ¥è‡ªåŠ¨åŒ–åˆ†æä»»åŠ¡ï¼Œä»ç®€å•çš„é‡å‘½ååˆ°å¤æ‚çš„æ¼æ´æ¨¡å¼åŒ¹é…ã€‚</p></li>
<li><p><strong>äº¤äº’å¼ä¸è‡ªåŠ¨åŒ–æ“ä½œ</strong>: æ—¢æ”¯æŒåƒ IDA Pro
é‚£æ ·çš„äº¤äº’å¼æ‰‹åŠ¨åˆ†æï¼Œä¹Ÿæä¾›äº†å¼ºå¤§çš„â€æ— å¤´åˆ†æå™¨â€(Headless
Analyzer)ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæ‰¹é‡ã€è‡ªåŠ¨åŒ–çš„åˆ†æã€‚</p></li>
<li><p><strong>å¤šç”¨æˆ·åä½œ</strong>: Ghidra Server
ç»„ä»¶æ”¯æŒå¤šååˆ†æå¸ˆå¯¹åŒä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡ŒååŒé€†å‘ï¼Œå¹¶èƒ½æ–¹ä¾¿åœ°è¿›è¡Œç‰ˆæœ¬è¿½è¸ªå’Œåˆå¹¶ã€‚</p></li>
<li><p><strong>å¯æ‰©å±•æ€§</strong>: ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å’Œæ‰©å±• Ghidra
çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¼–å†™æ–°çš„å¤„ç†å™¨æ¨¡å—ã€åŠ è½½å™¨å’Œåˆ†æå™¨æ’ä»¶ã€‚ ___ ## # Ghidra
vs.Â IDA Pro vs.Â Radare2</p></li>
</ul>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">Ghidra</th>
<th style="text-align: left;">IDA Pro</th>
<th style="text-align: left;">Radare2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>ä»·æ ¼</strong></td>
<td style="text-align: left;"><strong>å®Œå…¨å…è´¹</strong></td>
<td style="text-align: left;">éå¸¸æ˜‚è´µ</td>
<td style="text-align: left;">å®Œå…¨å…è´¹</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¼€æº</strong></td>
<td style="text-align: left;"><strong>æ˜¯</strong> (Java)</td>
<td style="text-align: left;">å¦</td>
<td style="text-align: left;">æ˜¯ (C)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td>
<td style="text-align: left;"><strong>é«˜è´¨é‡çš„å…è´¹åç¼–è¯‘å™¨</strong></td>
<td style="text-align: left;"><strong>æœ€å¼ºçš„äº¤äº’å¼åæ±‡ç¼–</strong></td>
<td style="text-align: left;"><strong>æè‡´çš„è„šæœ¬åŒ–å’Œå‘½ä»¤è¡Œ</strong></td>
</tr>
<tr>
<td style="text-align: left;"><strong>UI</strong></td>
<td style="text-align: left;">Java Swingï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ç•¥æ˜¾ç¬¨é‡</td>
<td style="text-align: left;">Qtï¼Œä¸šç•Œæ ‡å‡†ï¼Œæˆç†Ÿç¨³å®š</td>
<td style="text-align: left;">å‘½ä»¤è¡Œï¼Œæˆ–é€šè¿‡ Cutter æä¾› GUI</td>
</tr>
<tr>
<td style="text-align: left;"><strong>è‡ªåŠ¨åŒ–</strong></td>
<td style="text-align: left;">å¼ºå¤§çš„ Headless æ¨¡å¼å’Œè„šæœ¬</td>
<td style="text-align: left;">ä¸»è¦é€šè¿‡ IDC/IDAPython è„šæœ¬</td>
<td style="text-align: left;">è®¾è®¡å“²å­¦æ ¸å¿ƒï¼Œè‡ªåŠ¨åŒ–èƒ½åŠ›æå¼º</td>
</tr>
<tr>
<td style="text-align: left;"><strong>åä½œ</strong></td>
<td style="text-align: left;">å†…ç½® Ghidra Server æ”¯æŒ</td>
<td style="text-align: left;">ç¬¬ä¸‰æ–¹æ’ä»¶ (å¦‚ BinSync)</td>
<td style="text-align: left;">è„šæœ¬åŒ–åä½œï¼Œæˆ–é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å­¦ä¹ æ›²çº¿</strong></td>
<td style="text-align: left;">ä¸­ç­‰ï¼ŒUI ç›´è§‚</td>
<td style="text-align: left;">ä¸­ç­‰ï¼ŒåŠŸèƒ½ç¹å¤š</td>
<td style="text-align: left;"><strong>éå¸¸é™¡å³­</strong>ï¼Œå‘½ä»¤ç¹æ‚</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="å®‰è£…ä¸é…ç½®"># å®‰è£…ä¸é…ç½®</h2>
<ol type="1">
<li><strong>å‰æ</strong>: ç¡®ä¿å·²å®‰è£… Java Development Kit (JDK) 11
æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
<li><strong>ä¸‹è½½</strong>: ä» <a href="https://ghidra-sre.org/">Ghidra
å®˜æ–¹ç½‘ç«™</a> ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆ ZIP åŒ…ã€‚</li>
<li><strong>è§£å‹</strong>: å°† ZIP åŒ…è§£å‹åˆ°ä»»æ„ç›®å½•ã€‚</li>
<li><strong>è¿è¡Œ</strong>:</li>
</ol>
<ul>
<li><p><strong>Windows</strong>: åŒå‡»è¿è¡Œ
<code>ghidraRun.bat</code>ã€‚</p></li>
<li><p><strong>Linux / macOS</strong>: åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ
<code>sh ghidraRun</code>ã€‚</p></li>
<li><p><strong>Windows</strong>: åŒå‡»è¿è¡Œ
<code>ghidraRun.bat</code>ã€‚</p></li>
<li><p><strong>Linux / macOS</strong>: åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ
<code>sh ghidraRun</code>ã€‚</p></li>
</ul>
<ol start="5" type="1">
<li><p><strong>(å¯é€‰) Ghidra Dark Theme</strong>: Ghidra
çš„é»˜è®¤ä¸»é¢˜æ¯”è¾ƒåˆºçœ¼ï¼Œå¯ä»¥é€šè¿‡å®‰è£… <code>Ghidra-dark-theme</code>
æ’ä»¶æ¥è·å¾—æ›´å¥½çš„è§†è§‰ä½“éªŒã€‚ ___ ## # åŸºæœ¬å·¥ä½œæµç¨‹</p></li>
<li><p><strong>åˆ›å»ºé¡¹ç›®</strong>:</p></li>
</ol>
<ul>
<li><p><code>File -&gt; New Project...</code></p></li>
<li><p>é€‰æ‹© <code>Non-Shared Project</code> (å•ç”¨æˆ·é¡¹ç›®)ã€‚</p></li>
<li><p>æŒ‡å®šé¡¹ç›®è·¯å¾„å’Œåç§°ã€‚</p></li>
<li><p><code>File -&gt; New Project...</code></p></li>
<li><p>é€‰æ‹© <code>Non-Shared Project</code> (å•ç”¨æˆ·é¡¹ç›®)ã€‚</p></li>
<li><p>æŒ‡å®šé¡¹ç›®è·¯å¾„å’Œåç§°ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>å¯¼å…¥æ–‡ä»¶</strong>:</li>
</ol>
<ul>
<li><p><code>File -&gt; Import File...</code></p></li>
<li><p>é€‰æ‹©ä½ æƒ³è¦åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ (å¦‚ <code>.exe</code>,
<code>.dll</code>, <code>.so</code>, <code>.apk</code>)ã€‚</p></li>
<li><p>Ghidra ä¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶æ ¼å¼ã€å¤„ç†å™¨æ¶æ„ç­‰ï¼Œç›´æ¥ç‚¹å‡»
<code>OK</code>ã€‚</p></li>
<li><p><code>File -&gt; Import File...</code></p></li>
<li><p>é€‰æ‹©ä½ æƒ³è¦åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ (å¦‚ <code>.exe</code>,
<code>.dll</code>, <code>.so</code>, <code>.apk</code>)ã€‚</p></li>
<li><p>Ghidra ä¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶æ ¼å¼ã€å¤„ç†å™¨æ¶æ„ç­‰ï¼Œç›´æ¥ç‚¹å‡»
<code>OK</code>ã€‚</p></li>
</ul>
<ol start="3" type="1">
<li><strong>åˆ†ææ–‡ä»¶</strong>:</li>
</ol>
<ul>
<li><p>åœ¨å¼¹å‡ºçš„åˆ†æé€‰é¡¹æ¡†ä¸­ï¼Œä¿ç•™é»˜è®¤å‹¾é€‰çš„åˆ†æå™¨å³å¯ï¼Œç‚¹å‡»
<code>Analyze</code>ã€‚</p></li>
<li><p>Ghidra
ä¼šå¼€å§‹å¯¹æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨åˆ†æï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå–å†³äºæ–‡ä»¶å¤§å°å’Œå¤æ‚åº¦ã€‚</p></li>
<li><p>åœ¨å¼¹å‡ºçš„åˆ†æé€‰é¡¹æ¡†ä¸­ï¼Œä¿ç•™é»˜è®¤å‹¾é€‰çš„åˆ†æå™¨å³å¯ï¼Œç‚¹å‡»
<code>Analyze</code>ã€‚</p></li>
<li><p>Ghidra
ä¼šå¼€å§‹å¯¹æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨åˆ†æï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå–å†³äºæ–‡ä»¶å¤§å°å’Œå¤æ‚åº¦ã€‚</p></li>
</ul>
<ol start="4" type="1">
<li><strong>å¼€å§‹æ¢ç´¢</strong>:</li>
</ol>
<ul>
<li><p>åˆ†æå®Œæˆåï¼ŒåŒå‡»é¡¹ç›®çª—å£ä¸­çš„æ–‡ä»¶åï¼Œæ‰“å¼€ Ghidra çš„æ ¸å¿ƒå·¥å…·
<strong>Code Browser</strong>ã€‚</p></li>
<li><p>ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½ çš„é€†å‘ä¹‹æ—…äº†ï¼</p></li>
<li><p>åˆ†æå®Œæˆåï¼ŒåŒå‡»é¡¹ç›®çª—å£ä¸­çš„æ–‡ä»¶åï¼Œæ‰“å¼€ Ghidra çš„æ ¸å¿ƒå·¥å…·
<strong>Code Browser</strong>ã€‚</p></li>
<li><p>ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½ çš„é€†å‘ä¹‹æ—…äº†ï¼ ___ ## # å…³é”®çª—å£ä¸æ¦‚å¿µ</p></li>
</ul>
<h3 id="code-browser-ä»£ç æµè§ˆå™¨"># Code Browser (ä»£ç æµè§ˆå™¨)</h3>
<p>è¿™æ˜¯ Ghidra çš„ä¸»ç•Œé¢ï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒå­çª—å£ï¼š</p>
<ul>
<li><p><strong>Listing (æ¸…å•/åæ±‡ç¼–çª—å£)</strong>:
å·¦ä¾§æ˜¾ç¤ºåæ±‡ç¼–ä»£ç ï¼Œæ˜¯åˆ†æçš„ä¸»è¦åŒºåŸŸã€‚</p></li>
<li><p><strong>Functions (å‡½æ•°çª—å£)</strong>:
å·¦ä¸‹è§’ï¼Œåˆ—å‡ºæ‰€æœ‰å·²è¯†åˆ«çš„å‡½æ•°ã€‚ç‚¹å‡»å‡½æ•°åå¯ä»¥åœ¨åæ±‡ç¼–çª—å£ä¸­è·³è½¬ã€‚</p></li>
<li><p><strong>Program Trees (ç¨‹åºæ ‘)</strong>:
å·¦ä¸Šè§’ï¼Œä»¥æ ‘çŠ¶ç»“æ„å±•ç¤ºç¨‹åºçš„æ®µ (sections)ã€‚</p></li>
</ul>
<h3 id="decompiler-åç¼–è¯‘å™¨"># Decompiler (åç¼–è¯‘å™¨)</h3>
<ul>
<li><p>é€šå¸¸ä½äºåæ±‡ç¼–çª—å£çš„å³ä¾§ã€‚</p></li>
<li><p>å®ƒä¼šè‡ªåŠ¨æ˜¾ç¤ºå½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°çš„ C ä¼ªä»£ç ã€‚</p></li>
<li><p>è¿™æ˜¯ Ghidra
æœ€æœ‰ä»·å€¼çš„çª—å£ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ä¼ªä»£ç ä¸­å¯¹å˜é‡ã€å‡½æ•°è¿›è¡Œé‡å‘½åã€ä¿®æ”¹ç±»å‹ï¼Œè¿™äº›æ”¹åŠ¨ä¼š<strong>åŒå‘åŒæ­¥</strong>åˆ°åæ±‡ç¼–çª—å£ã€‚</p></li>
</ul>
<h3 id="symbol-tree-ç¬¦å·æ ‘"># Symbol Tree (ç¬¦å·æ ‘)</h3>
<ul>
<li><p>ä½äºå·¦ä¾§ï¼Œ<code>Functions</code> çª—å£æ—è¾¹ã€‚</p></li>
<li><p>å®ƒä»¥æ ‘çŠ¶ç»“æ„åˆ—å‡ºäº†ç¨‹åºä¸­æ‰€æœ‰çš„ç¬¦å·ï¼ŒåŒ…æ‹¬å‡½æ•°ã€æ ‡ç­¾ã€å¯¼å…¥/å¯¼å‡ºå‡½æ•°ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨å¿«é€ŸæŸ¥æ‰¾ç‰¹å®šå‡½æ•°ã€‚</p></li>
</ul>
<h3 id="data-type-manager-æ•°æ®ç±»å‹ç®¡ç†å™¨"># Data Type Manager
(æ•°æ®ç±»å‹ç®¡ç†å™¨)</h3>
<ul>
<li><p>å·¦ä¸‹è§’ï¼Œ<code>Functions</code> çª—å£ä¸‹æ–¹ã€‚</p></li>
<li><p>è¿™é‡Œç®¡ç†ç€ç¨‹åºä¸­æ‰€æœ‰çš„æ•°æ®ç±»å‹ (struct, union, enum
ç­‰)ã€‚ä½ å¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€å¯¼å…¥å’Œå¯¼å‡ºæ•°æ®ç±»å‹å®šä¹‰ã€‚è¿™å¯¹äºåˆ†æå¤æ‚çš„æ•°æ®ç»“æ„è‡³å…³é‡è¦ã€‚
___ ## # è„šæœ¬åŒ–ä¸è‡ªåŠ¨åŒ–</p></li>
</ul>
<p>Ghidra å¼ºå¤§çš„è„šæœ¬èƒ½åŠ›æ˜¯å…¶æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚</p>
<ol type="1">
<li><strong>æ‰“å¼€ Script Manager</strong>: åœ¨ Code Browser
ä¸­ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•æ çš„ç»¿è‰²æ’­æ”¾æŒ‰é’®å›¾æ ‡ï¼Œæ‰“å¼€ <strong>Script
Manager</strong>ã€‚</li>
<li><strong>é€‰æ‹©ä¸è¿è¡Œè„šæœ¬</strong>: è¿™é‡Œæœ‰å¤§é‡ NSA
å®˜æ–¹å’Œç¤¾åŒºè´¡çŒ®çš„é¢„ç½®è„šæœ¬ï¼Œè¦†ç›–äº†ä»æŸ¥æ‰¾å¯†ç ã€è§£å¯†æ•°æ®åˆ°è¯†åˆ«ç‰¹å®šä»£ç æ¨¡å¼ç­‰å„ç§ä»»åŠ¡ã€‚</li>
<li><strong>ç¼–å†™è‡ªå·±çš„è„šæœ¬</strong>:</li>
</ol>
<ul>
<li><p>ä½ å¯ä»¥é€šè¿‡ <code>Create New Script</code> æŒ‰é’®åˆ›å»ºæ–°çš„ Java æˆ–
Python è„šæœ¬ã€‚</p></li>
<li><p>Ghidra æä¾›äº†ä¸°å¯Œçš„ API (ç§°ä¸º
<code>FlatAPI</code>)ï¼Œè®©ä½ å¯ä»¥åœ¨è„šæœ¬ä¸­è®¿é—®å’Œä¿®æ”¹ç¨‹åºçš„å‡ ä¹æ‰€æœ‰ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š
```python # A simple Python script example that prints all function
names and addresses from ghidra.program.model.symbol import
SymbolType</p></li>
</ul>
<p>print(â€œâ€” All Functions â€”â€) func_manager =
currentProgram.getFunctionManager() funcs =
func_manager.getFunctions(True) # True means iterate in address order
for func in funcs: print(â€œ{} at {}â€.format(func.getName(),
func.getEntryPoint()))</p>
<pre><code>
## # ä¼˜ç¼ºç‚¹åˆ†æ

### ä¼˜ç‚¹

* **å…è´¹ä¸å¼€æº**: æ— ä»»ä½•è´¹ç”¨ï¼Œç¤¾åŒºå¯ä»¥å®¡æŸ¥å’Œè´¡çŒ®ä»£ç ã€‚


* **å¼ºå¤§çš„åç¼–è¯‘å™¨**: å†…ç½®çš„é«˜è´¨é‡åç¼–è¯‘å™¨æ˜¯å…¶æœ€å¤§çš„å–ç‚¹ï¼Œè¶³ä»¥åª²ç¾ç”šè‡³åœ¨æŸäº›æ–¹é¢è¶…è¶Šæ˜‚è´µçš„å•†ä¸šè½¯ä»¶ã€‚


* **è·¨å¹³å°**: åŸºäº Javaï¼Œå¯ä»¥åœ¨ Windows, macOS, Linux ä¸Šæ— å·®åˆ«è¿è¡Œã€‚


* **ä¼˜ç§€çš„åä½œåŠŸèƒ½**: Ghidra Server çš„å­˜åœ¨ä½¿å¾—å›¢é˜Ÿåä½œå˜å¾—éå¸¸å®¹æ˜“ã€‚


### ç¼ºç‚¹

* **æ€§èƒ½**: åŸºäº Java Swing çš„ UI åœ¨å¤„ç†è¶…å¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šæ„Ÿåˆ°å¡é¡¿ï¼Œæ€§èƒ½ä¸å¦‚ IDA Proã€‚


* **ç”Ÿæ€ç³»ç»Ÿ**: è™½ç„¶æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œä½†æ’ä»¶å’Œç¤¾åŒºæ”¯æŒçš„æˆç†Ÿåº¦ä»ç„¶ä¸åŠ IDA Pro ç»è¥å¤šå¹´çš„ç”Ÿæ€ã€‚


* **åŸç”Ÿè°ƒè¯•å™¨**: Ghidra çš„è°ƒè¯•å™¨åŠŸèƒ½ç›¸å¯¹è¾ƒå¼±ï¼Œä¸å¦‚ IDA Pro å’Œ x64dbg ç­‰ä¸“ç”¨è°ƒè¯•å™¨æˆç†Ÿã€‚ </code></pre>
<!-- 02-Tools/Static/ida_pro_guide.md -->
<h1 id="ida-pro-å…¥é—¨">IDA Pro å…¥é—¨</h1>
<p>IDA Pro (Interactive Disassembler Professional) æ˜¯ç”± Hex-Rays
å…¬å¸å¼€å‘çš„ä¸€æ¬¾ä¸šç•Œé—»åçš„äº¤äº’å¼åæ±‡ç¼–å™¨ã€‚åœ¨é€†å‘å·¥ç¨‹é¢†åŸŸï¼ŒIDA Pro
è¢«å¹¿æ³›è®¤ä¸ºæ˜¯<strong>é»„é‡‘æ ‡å‡†</strong>ï¼Œä»¥å…¶æœ€å¼ºå¤§çš„åæ±‡ç¼–å¼•æ“ã€æ— ä¸ä¼¦æ¯”çš„å¤„ç†å™¨æ”¯æŒå’Œæå…¶æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿï¼Œæˆä¸ºä¸“ä¸šäººå£«è¿›è¡Œè½¯ä»¶åˆ†æã€æ¼æ´æŒ–æ˜å’Œæ¶æ„è½¯ä»¶ç ”ç©¶çš„é¦–é€‰å·¥å…·ã€‚
___ ## ç›®å½• - <a href="#ida-pro-å…¥é—¨">IDA Pro å…¥é—¨</a> - <a
href="#ç›®å½•">ç›®å½•</a> - <a href="#æ ¸å¿ƒç‰¹æ€§">æ ¸å¿ƒç‰¹æ€§</a></p>
<ul>
<li><p><a href="#ida-pro-vs-ghidra-vs-radare2">IDA Pro vs.Â Ghidra
vs.Â Radare2</a></p></li>
<li><p><a href="#ç‰ˆæœ¬ä¸å®‰è£…">ç‰ˆæœ¬ä¸å®‰è£…</a></p></li>
<li><p><a href="#åŸºæœ¬å·¥ä½œæµç¨‹">åŸºæœ¬å·¥ä½œæµç¨‹</a></p></li>
<li><p><a href="#å…³é”®è§†å›¾ä¸å¿«æ·é”®">å…³é”®è§†å›¾ä¸å¿«æ·é”®</a></p></li>
<li><p><a href="#ida-view-åæ±‡ç¼–è§†å›¾">IDA View (åæ±‡ç¼–è§†å›¾)</a></p></li>
<li><p><a href="#hex-view-åå…­è¿›åˆ¶è§†å›¾">Hex View
(åå…­è¿›åˆ¶è§†å›¾)</a></p></li>
<li><p><a href="#structures-ç»“æ„ä½“è§†å›¾">Structures
(ç»“æ„ä½“è§†å›¾)</a></p></li>
<li><p><a href="#enums-æšä¸¾è§†å›¾">Enums (æšä¸¾è§†å›¾)</a></p></li>
<li><p><a href="#æ ¸å¿ƒå¿«æ·é”®">æ ¸å¿ƒå¿«æ·é”®</a></p></li>
<li><p><a href="#è„šæœ¬ä¸æ’ä»¶">è„šæœ¬ä¸æ’ä»¶</a></p></li>
<li><p><a href="#ä¼˜ç¼ºç‚¹åˆ†æ">ä¼˜ç¼ºç‚¹åˆ†æ</a></p></li>
<li><p><a href="#ä¼˜ç‚¹">ä¼˜ç‚¹</a></p></li>
<li><p><a href="#ç¼ºç‚¹">ç¼ºç‚¹</a> ___ ### æ ¸å¿ƒç‰¹æ€§</p></li>
<li><p><strong>é¡¶çº§çš„åæ±‡ç¼–å¼•æ“</strong>: IDA Pro
çš„æ ¸å¿ƒç«äº‰åŠ›åœ¨äºå…¶æ— ä¸ä¼¦æ¯”çš„é™æ€åæ±‡ç¼–èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿæ™ºèƒ½åœ°ã€é€’å½’åœ°éå†ä»£ç ï¼ŒåŒºåˆ†ä»£ç ä¸æ•°æ®ï¼Œè¯†åˆ«å‡½æ•°è¾¹ç•Œï¼Œå…¶åˆ†æç»“æœçš„å‡†ç¡®æ€§æ˜¯ä¸šç•Œå…¬è®¤çš„æœ€é«˜æ°´å‡†ã€‚</p></li>
<li><p><strong>FLIRT æŠ€æœ¯</strong>: <strong>F</strong>ast
<strong>L</strong>ibrary <strong>I</strong>dentification and
<strong>R</strong>ecognition <strong>T</strong>echnologyã€‚è¿™æ˜¯ IDA
çš„æ ‡å¿—æ€§æŠ€æœ¯ï¼Œé€šè¿‡å¯¹æ ‡å‡†ç¼–è¯‘å™¨åº“å‡½æ•°çš„ç­¾åè¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶å‘½åå¤§é‡çš„åº“å‡½æ•°ï¼Œæå¤§åœ°å‡å°‘äº†é€†å‘å·¥ç¨‹å¸ˆçš„é‡å¤å·¥ä½œã€‚</p></li>
<li><p><strong>å¼ºå¤§çš„äº¤äº’æ€§</strong>: IDA
çš„è®¾è®¡å“²å­¦é¼“åŠ±ç”¨æˆ·ä¸åæ±‡ç¼–ç»“æœè¿›è¡Œäº¤äº’ã€‚ç”¨æˆ·å¯ä»¥éšæ—¶é‡å‘½åå˜é‡ã€ä¿®æ”¹ç±»å‹ã€æ·»åŠ æ³¨é‡Šã€è½¬æ¢æ•°æ®æ ¼å¼ï¼Œè¿™äº›äº¤äº’æ“ä½œä¼šå®æ—¶åœ°å½±å“æ•´ä¸ªåˆ†ææ•°æ®åº“ã€‚</p></li>
<li><p><strong>Hex-Rays åç¼–è¯‘å™¨ (ä»˜è´¹æ’ä»¶)</strong>: IDA Pro
çš„æ€æ‰‹çº§åº”ç”¨æ˜¯å…¶é…å¥—çš„ Hex-Rays
åç¼–è¯‘å™¨ã€‚è™½ç„¶éœ€è¦é¢å¤–ä»˜è´¹ï¼Œä½†å®ƒè¢«å…¬è®¤ä¸ºç›®å‰å¸‚é¢ä¸Šæœ€å¼ºå¤§çš„ C/C++
åç¼–è¯‘å™¨ï¼Œç”Ÿæˆçš„ä¼ªä»£ç è´¨é‡æé«˜ï¼Œå¯è¯»æ€§æå¼ºã€‚</p></li>
<li><p><strong>å¤šå¹³å°è°ƒè¯•å™¨</strong>:
å†…ç½®äº†å¼ºå¤§çš„è·¨å¹³å°è°ƒè¯•å™¨ï¼Œæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹è°ƒè¯•ï¼Œå…è®¸åŠ¨æ€åˆ†æå’Œä¿®æ”¹ç¨‹åºè¡Œä¸ºã€‚</p></li>
<li><p><strong>æå…¶ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€</strong>: ç»è¿‡æ•°åå¹´çš„å‘å±•ï¼ŒIDA Pro
ç§¯ç´¯äº†æµ·é‡çš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œè¦†ç›–äº†ä»æ¼æ´æ‰«æã€ä»£ç ç€è‰²ã€æ•°æ®è§£å¯†åˆ°ä¸å…¶ä»–å·¥å…·è”åŠ¨çš„æ–¹æ–¹é¢é¢ï¼Œæå¤§åœ°æ‰©å±•äº†å…¶åŠŸèƒ½è¾¹ç•Œã€‚
___ ### IDA Pro vs.Â Ghidra vs.Â Radare2</p></li>
</ul>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">IDA Pro</th>
<th style="text-align: left;">Ghidra</th>
<th style="text-align: left;">Radare2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>ä»·æ ¼</strong></td>
<td style="text-align: left;"><strong>éå¸¸æ˜‚è´µ</strong></td>
<td style="text-align: left;">å®Œå…¨å…è´¹</td>
<td style="text-align: left;">å®Œå…¨å…è´¹</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¼€æº</strong></td>
<td style="text-align: left;"><strong>å¦</strong></td>
<td style="text-align: left;">æ˜¯ (Java)</td>
<td style="text-align: left;">æ˜¯ (C)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td>
<td style="text-align: left;"><strong>æœ€å¼ºçš„äº¤äº’å¼åæ±‡ç¼–</strong></td>
<td style="text-align: left;">é«˜è´¨é‡çš„å…è´¹åç¼–è¯‘å™¨</td>
<td style="text-align: left;">æè‡´çš„è„šæœ¬åŒ–å’Œå‘½ä»¤è¡Œ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>UI</strong></td>
<td
style="text-align: left;"><strong>Qtï¼Œä¸šç•Œæ ‡å‡†ï¼Œæˆç†Ÿç¨³å®š</strong></td>
<td style="text-align: left;">Java Swingï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ç•¥æ˜¾ç¬¨é‡</td>
<td style="text-align: left;">å‘½ä»¤è¡Œï¼Œæˆ–é€šè¿‡ Cutter æä¾› GUI</td>
</tr>
<tr>
<td style="text-align: left;"><strong>åç¼–è¯‘å™¨</strong></td>
<td style="text-align: left;"><strong>Hex-Rays
(ä¸šç•Œé¡¶å°–ï¼Œéœ€ä»˜è´¹)</strong></td>
<td style="text-align: left;">å†…ç½®å…è´¹ï¼Œè´¨é‡éå¸¸é«˜</td>
<td style="text-align: left;">å†…ç½®å…è´¹ (ghidra-dec)ï¼Œæˆ–æ”¯æŒå…¶ä»–</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç”Ÿæ€ç³»ç»Ÿ</strong></td>
<td style="text-align: left;"><strong>æå…¶æˆç†Ÿï¼Œæ’ä»¶æµ·é‡</strong></td>
<td style="text-align: left;">å¿«é€Ÿå‘å±•ä¸­</td>
<td style="text-align: left;">é«˜åº¦å¯å®šåˆ¶ï¼Œä½†æ’ä»¶è¾ƒå°‘</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¤„ç†å™¨æ”¯æŒ</strong></td>
<td style="text-align: left;"><strong>æœ€å¹¿æ³›</strong></td>
<td style="text-align: left;">å¹¿æ³›ï¼Œä½†ç•¥å°‘äº IDA</td>
<td style="text-align: left;">æå¹¿ï¼Œè¦†ç›–å¾ˆå¤šå°ä¼—æ¶æ„</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="ç‰ˆæœ¬ä¸å®‰è£…">ç‰ˆæœ¬ä¸å®‰è£…</h3>
<ul>
<li><p><strong>ç‰ˆæœ¬</strong>: IDA Pro
æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ”¯æŒçš„å¤„ç†å™¨æ¶æ„å’Œæ˜¯å¦åŒ…å«åç¼–è¯‘å™¨ã€‚<code>IDA Pro</code>
ç‰ˆæœ¬é€šå¸¸åŒ…å«æ‰€æœ‰å¤„ç†å™¨æ¨¡å—å’Œè°ƒè¯•å™¨ï¼Œè€Œ <code>IDA Home</code>
æ˜¯é’ˆå¯¹ä¸ªäººçˆ±å¥½è€…çš„å»‰ä»·ç‰ˆï¼ŒåŠŸèƒ½å—é™ã€‚</p></li>
<li><p><strong>è´­ä¹°ä¸å®‰è£…</strong>:
éœ€è¦é€šè¿‡å®˜æ–¹æˆ–æˆæƒç»é”€å•†è´­ä¹°ã€‚å®‰è£…è¿‡ç¨‹æ˜¯æ ‡å‡†çš„ä¸‹ä¸€æ­¥å¼å®‰è£…ã€‚</p></li>
<li><p><strong>å…è´¹ç‰ˆ</strong>: Hex-Rays æä¾›ä¸€ä¸ªå…è´¹ç‰ˆæœ¬çš„
IDAï¼Œä½†åŠŸèƒ½ä¸¥é‡å—é™ï¼Œä»…æ”¯æŒ
x86/x64ï¼Œä¸”ä¸èƒ½ä¿å­˜æ•°æ®åº“ï¼Œä»…é€‚åˆéå¸¸åˆçº§çš„å­¦ä¹ ã€‚ ___ ###
åŸºæœ¬å·¥ä½œæµç¨‹</p></li>
</ul>
<ol type="1">
<li><strong>å¯åŠ¨ IDA</strong>: æ‰“å¼€ IDA Proã€‚</li>
<li><strong>åŠ è½½æ–‡ä»¶</strong>: åœ¨å¯åŠ¨ç•Œé¢ç‚¹å‡»
<code>New</code>ï¼Œæˆ–å°†äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥æ‹–å…¥ä¸»çª—å£ã€‚</li>
<li><strong>åŠ è½½é€‰é¡¹</strong>: IDA
ä¼šå¼¹å‡ºä¸€ä¸ªåŠ è½½å¯¹è¯æ¡†ï¼Œè®©ä½ ç¡®è®¤æ–‡ä»¶ç±»å‹ã€å¤„ç†å™¨ç±»å‹ç­‰ã€‚é€šå¸¸ï¼ŒIDA
çš„è‡ªåŠ¨åˆ†æéå¸¸å‡†ç¡®ï¼Œç›´æ¥ç‚¹å‡» <code>OK</code> å³å¯ã€‚</li>
<li><strong>è‡ªåŠ¨åˆ†æ</strong>: IDA
ä¼šè¿›è¡Œé•¿æ—¶é—´çš„è‡ªåŠ¨åˆ†æã€‚åˆ†æè¿‡ç¨‹å¯ä»¥åœ¨åº•éƒ¨çš„è¾“å‡ºçª—å£çœ‹åˆ°ã€‚<strong>è€å¿ƒç­‰å¾…åˆ†æå®Œæˆ</strong>æ˜¯ä½¿ç”¨
IDA çš„å¥½ä¹ æƒ¯ï¼Œå¦åˆ™å¾ˆå¤šåŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚</li>
<li><strong>å¼€å§‹åˆ†æ</strong>: åˆ†æå®Œæˆåï¼Œå³å¯å¼€å§‹äº¤äº’å¼åˆ†æã€‚ ___ ###
å…³é”®è§†å›¾ä¸å¿«æ·é”®</li>
</ol>
<h4 id="ida-view-åæ±‡ç¼–è§†å›¾">IDA View (åæ±‡ç¼–è§†å›¾)</h4>
<ul>
<li><p>è¿™æ˜¯ IDA
çš„ä¸»è§†å›¾ã€‚æŒ‰<strong>ç©ºæ ¼é”®</strong>å¯ä»¥åœ¨<strong>å›¾å½¢è§†å›¾</strong>ï¼ˆæµç¨‹å›¾ï¼‰å’Œ<strong>æ–‡æœ¬è§†å›¾</strong>ï¼ˆçº¿æ€§åæ±‡ç¼–ï¼‰ä¹‹é—´åˆ‡æ¢ã€‚</p></li>
<li><p><strong>å›¾å½¢è§†å›¾</strong>éå¸¸é€‚åˆç†è§£å‡½æ•°å†…çš„é€»è¾‘åˆ†æ”¯å’Œå¾ªç¯ã€‚</p></li>
</ul>
<h4 id="hex-view-åå…­è¿›åˆ¶è§†å›¾">Hex View (åå…­è¿›åˆ¶è§†å›¾)</h4>
<ul>
<li>ä»¥ç»å…¸çš„åå…­è¿›åˆ¶ç¼–è¾‘å™¨å½¢å¼å±•ç¤ºæ–‡ä»¶å†…å®¹ï¼Œä¸åæ±‡ç¼–è§†å›¾åŒæ­¥é«˜äº®ã€‚</li>
</ul>
<h4 id="structures-ç»“æ„ä½“è§†å›¾">Structures (ç»“æ„ä½“è§†å›¾)</h4>
<ul>
<li><p>å¿«æ·é”® <code>Shift+F9</code>ã€‚</p></li>
<li><p>ç”¨äºå®šä¹‰å’Œç®¡ç† C è¯­è¨€é£æ ¼çš„ç»“æ„ä½“ã€‚ä½ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä» C
å¤´æ–‡ä»¶å¯¼å…¥ã€‚æ­£ç¡®åœ°å®šä¹‰æ•°æ®ç»“æ„æ˜¯é€†å‘å·¥ç¨‹çš„å…³é”®ä¸€æ­¥ã€‚</p></li>
</ul>
<h4 id="enums-æšä¸¾è§†å›¾">Enums (æšä¸¾è§†å›¾)</h4>
<ul>
<li><p>å¿«æ·é”® <code>Shift+F10</code>ã€‚</p></li>
<li><p>ç”¨äºå®šä¹‰å’Œç®¡ç†æšä¸¾ç±»å‹ï¼Œå¯ä»¥æå¤§åœ°æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œä¾‹å¦‚å°†
<code>mov eax, 2</code> å˜ä¸º <code>mov eax, MODE_READ</code>ã€‚</p></li>
</ul>
<h4 id="æ ¸å¿ƒå¿«æ·é”®">æ ¸å¿ƒå¿«æ·é”®</h4>
<ul>
<li><p><code>G</code>: è·³è½¬åˆ°æŒ‡å®šåœ°å€ã€‚</p></li>
<li><p><code>N</code>: é‡å‘½åå˜é‡ã€å‡½æ•°ã€æ ‡ç­¾ã€‚</p></li>
<li><p><code>Y</code>: ä¿®æ”¹å˜é‡ç±»å‹ã€‚</p></li>
<li><p><code>X</code>: æŸ¥çœ‹äº¤å‰å¼•ç”¨
(cross-references)ï¼Œå³å“ªäº›åœ°æ–¹è°ƒç”¨/å¼•ç”¨äº†å½“å‰ç¬¦å·ã€‚</p></li>
<li><p><code>P</code>: åˆ›å»ºä¸€ä¸ªå‡½æ•°ã€‚</p></li>
<li><p><code>U</code>: å–æ¶ˆå®šä¹‰ï¼ˆå¦‚å°†ä»£ç å˜ä¸ºæœªå®šä¹‰æ•°æ®ï¼‰ã€‚</p></li>
<li><p><code>;</code>: æ·»åŠ è¡Œæ³¨é‡Šã€‚</p></li>
<li><p><code>:</code>: æ·»åŠ å¯é‡å¤æ³¨é‡Šã€‚</p></li>
<li><p><code>F5</code>: (å¦‚æœå·²è´­ä¹°) å¯åŠ¨ Hex-Rays åç¼–è¯‘å™¨ã€‚ ___ ###
è„šæœ¬ä¸æ’ä»¶</p></li>
</ul>
<p>IDA çš„å¼ºå¤§èƒ½åŠ›æœ‰ä¸€åŠæ¥è‡ªäºå…¶è„šæœ¬å’Œæ’ä»¶ç³»ç»Ÿã€‚</p>
<ul>
<li><p><strong>IDAPython</strong>: è¿™æ˜¯ç›®å‰æœ€ä¸»æµçš„è„šæœ¬è¯­è¨€ã€‚IDA
å†…ç½®äº†ä¸€ä¸ªå®Œæ•´çš„ Python è§£é‡Šå™¨å’Œä¸°å¯Œçš„ APIï¼Œå…è®¸ä½ ç”¨ Python è„šæœ¬ä¸ IDA
æ•°æ®åº“è¿›è¡Œæ·±åº¦äº¤äº’ã€‚å‡ ä¹æ‰€æœ‰é‡å¤æ€§å·¥ä½œéƒ½å¯ä»¥é€šè¿‡ IDAPython
è‡ªåŠ¨åŒ–ã€‚</p></li>
<li><p><strong>IDC</strong>: IDA è‡ªå¸¦çš„ç±» C è„šæœ¬è¯­è¨€ã€‚è¯­æ³•å¤è€ï¼ŒåŠŸèƒ½ä¸å¦‚
IDAPython å¼ºå¤§ï¼Œä½†å¯¹äºä¸€äº›ç®€å•çš„ä»»åŠ¡ä»ç„¶æœ‰ç”¨ã€‚</p></li>
<li><p><strong>æ’ä»¶</strong>: IDA çš„æ’ä»¶æœºåˆ¶å…è®¸å¼€å‘è€…ä½¿ç”¨ C++
ç¼–å†™é«˜æ€§èƒ½æ’ä»¶ï¼Œå¹¶å°†å…¶æ·±åº¦é›†æˆåˆ° IDA çš„ UI
å’Œæ ¸å¿ƒä¸­ã€‚ç¤¾åŒºä¸­æœ‰å¤§é‡ä¼˜ç§€çš„å¼€æºæ’ä»¶ï¼Œå¦‚ <code>FindCrypt</code>,
<code>Keypatch</code> ç­‰ã€‚ ___ ### ä¼˜ç¼ºç‚¹åˆ†æ</p></li>
</ul>
<h4 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h4>
<ul>
<li><p><strong>æœ€å¼ºçš„åæ±‡ç¼–è´¨é‡</strong>:
ä¸šç•Œå…¬è®¤çš„ã€æœ€å¯é çš„é™æ€åˆ†æç»“æœã€‚</p></li>
<li><p><strong>FLIRT å’Œç±»å‹ç³»ç»Ÿ</strong>:
æå¤§åœ°è‡ªåŠ¨åŒ–äº†åº“å‡½æ•°å’Œæ•°æ®ç»“æ„çš„è¯†åˆ«è¿‡ç¨‹ã€‚</p></li>
<li><p><strong>æˆç†Ÿå’Œç¨³å®š</strong>:
ç»è¿‡æ•°åå¹´æ‰“ç£¨ï¼Œè½¯ä»¶æœ¬èº«æä¸ºç¨³å®šï¼Œç”¨æˆ·ä½“éªŒæµç•…ã€‚</p></li>
<li><p><strong>å¼ºå¤§çš„ç”Ÿæ€</strong>:
æµ·é‡çš„æ’ä»¶ã€æ•™ç¨‹å’Œç¤¾åŒºæ”¯æŒï¼Œé‡åˆ°ä»»ä½•é—®é¢˜å‡ ä¹éƒ½èƒ½æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p></li>
<li><p><strong>é¡¶çº§çš„åç¼–è¯‘å™¨</strong>: Hex-Rays
åç¼–è¯‘å™¨æ˜¯å…¶æœ€å¼ºå¤§çš„æŠ¤åŸæ²³ã€‚</p></li>
</ul>
<h4 id="ç¼ºç‚¹">ç¼ºç‚¹</h4>
<ul>
<li><p><strong>ä»·æ ¼æ˜‚è´µ</strong>:
å¯¹äºä¸ªäººå¼€å‘è€…æˆ–å°å‹å›¢é˜Ÿæ¥è¯´ï¼Œä»·æ ¼æ˜¯æœ€å¤§çš„é—¨æ§›ã€‚</p></li>
<li><p><strong>é—­æº</strong>: æ ¸å¿ƒåŠŸèƒ½æ˜¯é»‘ç›’ï¼Œæ— æ³•å®¡æŸ¥æˆ–ä¿®æ”¹ã€‚</p></li>
<li><p><strong>åä½œä¸ä¾¿</strong>:
åŸç”Ÿä¸æ”¯æŒå¤šäººåä½œï¼Œéœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚</p></li>
</ul>
<!-- 02-Tools/Static/radare2_guide.md -->
<h1 id="radare2-å…¥é—¨">Radare2 å…¥é—¨</h1>
<p>Radare2 (é€šå¸¸ç®€ç§°ä¸º r2)
æ˜¯ä¸€æ¬¾å¼€æºã€å…è´¹ã€å‘½ä»¤è¡Œé©±åŠ¨çš„é€†å‘å·¥ç¨‹æ¡†æ¶ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªåæ±‡ç¼–å™¨ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªåŠŸèƒ½æå…¶ä¸°å¯Œçš„â€ç‘å£«å†›åˆ€â€ï¼Œé›†æˆäº†åå…­è¿›åˆ¶ç¼–è¾‘ã€åæ±‡ç¼–ã€è°ƒè¯•ã€ä»£ç åˆ†æã€æ¼æ´åˆ©ç”¨ã€æ•°æ®å¯è§†åŒ–ç­‰å¤šç§åŠŸèƒ½ã€‚Radare2
ä»¥å…¶é«˜åº¦çš„å¯è„šæœ¬åŒ–å’Œå¯æ‰©å±•æ€§è€Œé—»åï¼Œæ·±å—å¯»æ±‚è‡ªåŠ¨åŒ–å’Œæ·±åº¦å®šåˆ¶çš„é»‘å®¢ã€CTF
é€‰æ‰‹å’Œå®‰å…¨ç ”ç©¶å‘˜çš„å–œçˆ±ã€‚ ___ ## ç›®å½• - <a
href="#radare2-å…¥é—¨">Radare2 å…¥é—¨</a> - <a href="#ç›®å½•">ç›®å½•</a>
- <a href="#æ ¸å¿ƒç†å¿µä¸ç‰¹æ€§">æ ¸å¿ƒç†å¿µä¸ç‰¹æ€§</a></p>
<ul>
<li><p><a href="#radare2-vs-ida-pro-vs-ghidra">Radare2 vs.Â IDA Pro
vs.Â Ghidra</a></p></li>
<li><p><a href="#å®‰è£…ä¸å…¥é—¨">å®‰è£…ä¸å…¥é—¨</a></p></li>
<li><p><a href="#åŸºæœ¬å‘½ä»¤ä¸å·¥ä½œæµç¨‹">åŸºæœ¬å‘½ä»¤ä¸å·¥ä½œæµç¨‹</a></p></li>
<li><p><a href="#æ ¸å¿ƒæ¦‚å¿µä¸‡ç‰©çš†-">æ ¸å¿ƒæ¦‚å¿µï¼šä¸‡ç‰©çš†
<code>?</code></a></p></li>
<li><p><a href="#åˆ†æ-a">åˆ†æ (<code>a</code>)</a></p></li>
<li><p><a href="#æ‰“å°-p">æ‰“å° (<code>p</code>)</a></p></li>
<li><p><a href="#ä¿¡æ¯-i">ä¿¡æ¯ (<code>i</code>)</a></p></li>
<li><p><a href="#seek-s">Seek (<code>s</code>)</a></p></li>
<li><p><a href="#å¯è§†åŒ–-v">å¯è§†åŒ– (<code>V</code>)</a></p></li>
<li><p><a href="#cutter---radare2-çš„-gui">Cutter - Radare2 çš„
GUI</a></p></li>
<li><p><a href="#è„šæœ¬åŒ–">è„šæœ¬åŒ–</a></p></li>
<li><p><a href="#ä¼˜ç¼ºç‚¹åˆ†æ">ä¼˜ç¼ºç‚¹åˆ†æ</a></p></li>
<li><p><a href="#ä¼˜ç‚¹">ä¼˜ç‚¹</a></p></li>
<li><p><a href="#ç¼ºç‚¹">ç¼ºç‚¹</a> ___ ### æ ¸å¿ƒç†å¿µä¸ç‰¹æ€§</p></li>
<li><p><strong>å‘½ä»¤è¡Œé©±åŠ¨</strong>: Radare2
çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½é€šè¿‡å‘½ä»¤è¡Œæ¥å£æš´éœ²ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆåœ¨ç»ˆç«¯ã€SSH
ä¼šè¯æˆ–è„šæœ¬ä¸­è¿è¡Œï¼Œæ˜“äºå®ç°è‡ªåŠ¨åŒ–ã€‚</p></li>
<li><p><strong>æ¨¡å—åŒ–è®¾è®¡</strong>:
å…¶åŠŸèƒ½ç”±ä¸€ç³»åˆ—å•å­—æ¯å‘½ä»¤å’Œå­å‘½ä»¤æ„æˆï¼Œä¾‹å¦‚ <code>p</code> ç”¨äºæ‰“å°
(print)ï¼Œ<code>a</code> ç”¨äºåˆ†æ (analyze)ï¼Œ<code>d</code> ç”¨äºè°ƒè¯•
(debug)ã€‚è¿™ç§è®¾è®¡éµå¾ªäº† Unix å“²å­¦ã€‚</p></li>
<li><p><strong>æµ·é‡æ¶æ„æ”¯æŒ</strong>: Radare2
æ”¯æŒæ•°é‡æƒŠäººçš„å¤„ç†å™¨æ¶æ„ï¼ŒåŒ…æ‹¬è®¸å¤šéå¸¸å°ä¼—å’Œå¤è€çš„åµŒå…¥å¼æ¶æ„ï¼Œè¿™æ–¹é¢ç”šè‡³è¶…è¿‡äº†
IDA Proã€‚</p></li>
<li><p><strong>é«˜åº¦å¯è„šæœ¬åŒ–</strong>:
ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„è¯­è¨€ï¼ˆPython, Go, JavaScript, Rust ç­‰ï¼‰é€šè¿‡ r2pipe
ä¸ Radare2 å®ä¾‹è¿›è¡Œäº¤äº’ï¼Œå®ç°å¤æ‚çš„è‡ªåŠ¨åŒ–åˆ†ææµç¨‹ã€‚</p></li>
<li><p><strong>å†…ç½®è°ƒè¯•å™¨</strong>:
é›†æˆäº†åŠŸèƒ½å¼ºå¤§çš„å¤šå¹³å°è°ƒè¯•å™¨ï¼Œæ”¯æŒç¡¬ä»¶æ–­ç‚¹ã€è·Ÿè¸ªç­‰é«˜çº§åŠŸèƒ½ã€‚</p></li>
<li><p><strong>å¼ºå¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶è§£æ</strong>: ä¸ä»…æ”¯æŒ ELF, PE, Mach-O
ç­‰æ ‡å‡†æ ¼å¼ï¼Œè¿˜èƒ½è§£ææ–‡ä»¶ç³»ç»Ÿã€å›¾ç‰‡ã€æ–‡æ¡£ç­‰å„ç§äºŒè¿›åˆ¶ blobã€‚ ___ ###
Radare2 vs.Â IDA Pro vs.Â Ghidra</p></li>
</ul>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">Radare2</th>
<th style="text-align: left;">IDA Pro</th>
<th style="text-align: left;">Ghidra</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>ä»·æ ¼</strong></td>
<td style="text-align: left;"><strong>å®Œå…¨å…è´¹</strong></td>
<td style="text-align: left;">éå¸¸æ˜‚è´µ</td>
<td style="text-align: left;">å®Œå…¨å…è´¹</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¼€æº</strong></td>
<td style="text-align: left;"><strong>æ˜¯ (C)</strong></td>
<td style="text-align: left;">å¦</td>
<td style="text-align: left;">æ˜¯ (Java)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td>
<td style="text-align: left;"><strong>æè‡´çš„è„šæœ¬åŒ–å’Œå‘½ä»¤è¡Œ</strong></td>
<td style="text-align: left;">æœ€å¼ºçš„äº¤äº’å¼åæ±‡ç¼–</td>
<td style="text-align: left;">é«˜è´¨é‡çš„å…è´¹åç¼–è¯‘å™¨</td>
</tr>
<tr>
<td style="text-align: left;"><strong>UI</strong></td>
<td style="text-align: left;"><strong>å‘½ä»¤è¡Œ</strong> (æˆ– Cutter
GUI)</td>
<td style="text-align: left;">Qtï¼Œä¸šç•Œæ ‡å‡†ï¼Œæˆç†Ÿç¨³å®š</td>
<td style="text-align: left;">Java Swingï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ç•¥æ˜¾ç¬¨é‡</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å­¦ä¹ æ›²çº¿</strong></td>
<td style="text-align: left;"><strong>éå¸¸é™¡å³­</strong></td>
<td style="text-align: left;">ä¸­ç­‰</td>
<td style="text-align: left;">ä¸­ç­‰</td>
</tr>
<tr>
<td style="text-align: left;"><strong>è‡ªåŠ¨åŒ–</strong></td>
<td
style="text-align: left;"><strong>è®¾è®¡å“²å­¦æ ¸å¿ƒï¼Œèƒ½åŠ›æå¼º</strong></td>
<td style="text-align: left;">ä¸»è¦é€šè¿‡ IDC/IDAPython</td>
<td style="text-align: left;">å¼ºå¤§çš„ Headless æ¨¡å¼</td>
</tr>
<tr>
<td style="text-align: left;"><strong>çµæ´»æ€§</strong></td>
<td style="text-align: left;"><strong>æœ€é«˜</strong>ï¼Œä¸€åˆ‡çš†å¯å®šåˆ¶</td>
<td style="text-align: left;">è¾ƒä½ï¼Œä¾èµ–æ’ä»¶</td>
<td style="text-align: left;">è¾ƒé«˜ï¼Œå¯é€šè¿‡æ’ä»¶æ‰©å±•</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="å®‰è£…ä¸å…¥é—¨">å®‰è£…ä¸å…¥é—¨</h3>
<ul>
<li><strong>å®‰è£…</strong>: æœ€æ¨èçš„å®‰è£…æ–¹å¼æ˜¯é€šè¿‡ <code>git</code>
å…‹éš†å®˜æ–¹ä»“åº“å¹¶è¿è¡Œå®‰è£…è„šæœ¬ï¼š ```bash git clone
https://github.com/radareorg/radare2 cd radare2 sys/install.sh</li>
</ul>
<pre><code>
* **å¯åŠ¨**:
    ```bash
# Open file and perform analysis
r2 /bin/ls

# Open file and perform debug
r2 -d /bin/ls
</code></pre>
<hr />
<h3 id="åŸºæœ¬å‘½ä»¤ä¸å·¥ä½œæµç¨‹">åŸºæœ¬å‘½ä»¤ä¸å·¥ä½œæµç¨‹</h3>
<p>Radare2 çš„å‘½ä»¤ç»“æ„æ˜¯ <code>[å‘½ä»¤][å­å‘½ä»¤][å‚æ•°]</code>ã€‚ä¾‹å¦‚
<code>pdf</code> æ˜¯ <code>p</code> (print) -&gt; <code>d</code>
(disassemble) -&gt; <code>f</code> (function)
çš„ç»„åˆï¼Œæ„ä¸ºâ€æ‰“å°å‡½æ•°åæ±‡ç¼–â€ã€‚</p>
<h4 id="æ ¸å¿ƒæ¦‚å¿µä¸‡ç‰©çš†">æ ¸å¿ƒæ¦‚å¿µï¼šä¸‡ç‰©çš† <code>?</code></h4>
<p>åœ¨ä»»ä½•å‘½ä»¤åé¢åŠ ä¸Š <code>?</code>
éƒ½å¯ä»¥æŸ¥çœ‹è¯¥å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£ã€‚è¿™æ˜¯å­¦ä¹  Radare2 æœ€é‡è¦çš„æ–¹æ³•ã€‚</p>
<ul>
<li><p><code>?</code>: æ˜¾ç¤ºé¡¶çº§å¸®åŠ©ã€‚</p></li>
<li><p><code>a?</code>: æ˜¾ç¤ºåˆ†æ (analyze) å‘½ä»¤çš„å¸®åŠ©ã€‚</p></li>
<li><p><code>pdf?</code>: æ˜¾ç¤ºæ‰“å°å‡½æ•°åæ±‡ç¼–å‘½ä»¤çš„å¸®åŠ©ã€‚</p></li>
</ul>
<h4 id="åˆ†æ-a">åˆ†æ (<code>a</code>)</h4>
<p>åœ¨ä½ å¯¹ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶åšä»»ä½•äº‹æƒ…ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦å…ˆåˆ†æå®ƒã€‚</p>
<ul>
<li><p><code>aaa</code>:
è‡ªåŠ¨åˆ†ææ‰€æœ‰ï¼ˆå‡½æ•°ã€ç¬¦å·ç­‰ï¼‰ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„èµ·æ‰‹å‘½ä»¤ã€‚</p></li>
<li><p><code>afl</code>: åˆ—å‡ºæ‰€æœ‰å·²è¯†åˆ«çš„å‡½æ•° (Analyze Function
List)ã€‚</p></li>
<li><p><code>af</code>: åˆ†æå‡½æ•°ã€‚</p></li>
</ul>
<h4 id="æ‰“å°-p">æ‰“å° (<code>p</code>)</h4>
<p>ç”¨äºä»¥ä¸åŒæ ¼å¼æ˜¾ç¤ºæ•°æ®ã€‚</p>
<ul>
<li><p><code>px</code>: ä»¥åå…­è¿›åˆ¶æ ¼å¼æ‰“å° (Print
heXadecimal)ã€‚</p></li>
<li><p><code>ps</code>: æ‰“å°å­—ç¬¦ä¸² (Print String)ã€‚</p></li>
<li><p><code>pd N</code>: åæ±‡ç¼– N æ¡æŒ‡ä»¤ (Print Disassembly)ã€‚</p></li>
<li><p><code>pdf</code>: æ‰“å°å½“å‰å‡½æ•°çš„åæ±‡ç¼– (Print Disassembly
Function)ã€‚</p></li>
</ul>
<h4 id="ä¿¡æ¯-i">ä¿¡æ¯ (<code>i</code>)</h4>
<p>ç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚</p>
<ul>
<li><p><code>iI</code>: æ˜¾ç¤ºæ–‡ä»¶åŸºæœ¬ä¿¡æ¯ (å…¥å£ç‚¹ã€æ¶æ„ç­‰)ã€‚</p></li>
<li><p><code>is</code>: æ˜¾ç¤ºç¬¦å·ã€‚</p></li>
<li><p><code>iS</code>: æ˜¾ç¤ºæ®µ (sections)ã€‚</p></li>
</ul>
<h4 id="seek-s">Seek (<code>s</code>)</h4>
<p>ç”¨äºåœ¨æ–‡ä»¶ä¸­è·³è½¬ã€‚</p>
<ul>
<li><p><code>s main</code>: è·³è½¬åˆ° <code>main</code>
å‡½æ•°çš„åœ°å€ã€‚</p></li>
<li><p><code>s 0x8048400</code>: è·³è½¬åˆ°æŒ‡å®šåœ°å€ã€‚</p></li>
<li><p><code>s-</code>: æ’¤é”€ä¸Šä¸€æ¬¡è·³è½¬ã€‚</p></li>
</ul>
<h4 id="å¯è§†åŒ–-v">å¯è§†åŒ– (<code>V</code>)</h4>
<p>Radare2 æä¾›äº†å¼ºå¤§çš„æ–‡æœ¬æ¨¡å¼å¯è§†åŒ–åŠŸèƒ½ã€‚</p>
<ul>
<li><p><strong>è¿›å…¥/é€€å‡º</strong>: æŒ‰ <code>V</code> è¿›å…¥å¯è§†åŒ–æ¨¡å¼ï¼ŒæŒ‰
<code>q</code> é€€å‡ºã€‚</p></li>
<li><p><strong>åˆ‡æ¢è§†å›¾</strong>: åœ¨å¯è§†åŒ–æ¨¡å¼ä¸‹ï¼ŒæŒ‰ <code>p</code> å’Œ
<code>P</code>
å¯ä»¥åœ¨ä¸åŒè§†å›¾ï¼ˆåæ±‡ç¼–ã€åå…­è¿›åˆ¶ã€è°ƒè¯•å¯„å­˜å™¨ç­‰ï¼‰ä¹‹é—´åˆ‡æ¢ã€‚</p></li>
<li><p><strong>å›¾å½¢è§†å›¾</strong>: å¯è§†åŒ–æ¨¡å¼ä¸‹çš„ <code>v</code>
é”®å¯ä»¥å±•ç¤ºå‡½æ•°çš„ ASCII-art æµç¨‹å›¾ï¼Œéå¸¸é…·ã€‚ ___ ### Cutter - Radare2 çš„
GUI</p></li>
</ul>
<p>å¯¹äºä¸ä¹ æƒ¯çº¯å‘½ä»¤è¡Œçš„ç”¨æˆ·ï¼Œç¤¾åŒºå¼€å‘äº† <strong>Cutter</strong>ã€‚Cutter
æ˜¯ä¸€ä¸ªåŸºäº Qt C++ çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œåç«¯ç”± Radare2 é©±åŠ¨ã€‚</p>
<ul>
<li><p>å®ƒæä¾›äº†ç±»ä¼¼ IDA Pro å’Œ Ghidra
çš„å›¾å½¢åŒ–ç•Œé¢ï¼ŒåŒ…æ‹¬åæ±‡ç¼–çª—å£ã€åç¼–è¯‘çª—å£ï¼ˆé›†æˆäº† Ghidra
Decompilerï¼‰ã€å‡½æ•°åˆ—è¡¨ã€Hexdump ç­‰ã€‚</p></li>
<li><p>æ‰€æœ‰åœ¨ Cutter ä¸­è¿›è¡Œçš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯åœ¨åå°è°ƒç”¨ Radare2
çš„å‘½ä»¤å®Œæˆçš„ã€‚</p></li>
<li><p>å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œä» Cutter å…¥æ‰‹å¯ä»¥æå¤§åœ°é™ä½å­¦ä¹  Radare2 çš„é—¨æ§›ã€‚
___ ### è„šæœ¬åŒ–</p></li>
</ul>
<p>Radare2 çš„ç²¾é«“åœ¨äºè‡ªåŠ¨åŒ–ã€‚<code>r2pipe</code>
æ˜¯å…¶å®˜æ–¹çš„è„šæœ¬åº“ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª Python
è„šæœ¬ç¤ºä¾‹ï¼Œç”¨äºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ†æå®ƒï¼Œå¹¶æ‰“å°æ‰€æœ‰å‡½æ•°çš„åç§°ï¼š</p>
<div class="sourceCode" id="cb408"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> r2pipe</span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Open file</span></span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2pipe.<span class="bu">open</span>(<span class="st">&quot;/bin/ls&quot;</span>)</span>
<span id="cb408-5"><a href="#cb408-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-6"><a href="#cb408-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Run &#39;aaa&#39; command to perform analysis</span></span>
<span id="cb408-7"><a href="#cb408-7" aria-hidden="true" tabindex="-1"></a>r2.cmd(<span class="st">&#39;aaa&#39;</span>)</span>
<span id="cb408-8"><a href="#cb408-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-9"><a href="#cb408-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Run &#39;aflj&#39; command to get JSON format function list and parse</span></span>
<span id="cb408-10"><a href="#cb408-10" aria-hidden="true" tabindex="-1"></a>functions <span class="op">=</span> r2.cmdj(<span class="st">&#39;aflj&#39;</span>)</span>
<span id="cb408-11"><a href="#cb408-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-12"><a href="#cb408-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each function name</span></span>
<span id="cb408-13"><a href="#cb408-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> functions:</span>
<span id="cb408-14"><a href="#cb408-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> func <span class="kw">in</span> functions:</span>
<span id="cb408-15"><a href="#cb408-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Function found: </span><span class="sc">{</span>func[<span class="st">&#39;name&#39;</span>]<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span><span class="bu">hex</span>(func[<span class="st">&#39;offset&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<ul>
<li><p><strong>æ— ä¸ä¼¦æ¯”çš„è„šæœ¬åŒ–èƒ½åŠ›</strong>:
è®¾è®¡å“²å­¦ä½¿å…¶æˆä¸ºè‡ªåŠ¨åŒ–é€†å‘åˆ†æçš„ç†æƒ³é€‰æ‹©ã€‚</p></li>
<li><p><strong>æé«˜çš„çµæ´»æ€§å’Œå®šåˆ¶æ€§</strong>:
ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ç»„åˆå‘½ä»¤ï¼Œæ„å»ºå·¥ä½œæµã€‚</p></li>
<li><p><strong>è½»é‡ä¸å¿«é€Ÿ</strong>:
æ ¸å¿ƒç¨‹åºéå¸¸å°ï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨å°‘ã€‚</p></li>
<li><p><strong>æµ·é‡æ¶æ„æ”¯æŒ</strong>:
å¯¹å„ç§å¥‡å¼‚æ¶æ„çš„æ”¯æŒæ˜¯å…¶ä¸€å¤§ç‰¹è‰²ã€‚</p></li>
</ul>
<h4 id="ç¼ºç‚¹-1">ç¼ºç‚¹</h4>
<ul>
<li><p><strong>é™¡å³­çš„å­¦ä¹ æ›²çº¿</strong>:
å‘½ä»¤ç¹å¤šï¼Œè¯­æ³•ç‰¹æ®Šï¼Œå¯¹æ–°æ‰‹éå¸¸ä¸å‹å¥½ã€‚</p></li>
<li><p><strong>æ–‡æ¡£ç›¸å¯¹æ··ä¹±</strong>:
è™½ç„¶æœ‰å¸®åŠ©ç³»ç»Ÿï¼Œä½†å®˜æ–¹æ–‡æ¡£çš„ç»“æ„æ€§å’Œå®Œæ•´æ€§ä¸å¦‚å•†ä¸šè½¯ä»¶ã€‚</p></li>
<li><p><strong>é»˜è®¤åç¼–è¯‘å™¨</strong>: å†…ç½®çš„åç¼–è¯‘å™¨è´¨é‡ä¸å¦‚ Ghidra æˆ–
Hex-Raysï¼Œä½†å¯ä»¥é€šè¿‡æ’ä»¶é›†æˆ Ghidra Decompilerã€‚</p></li>
</ul>
<!-- 03-Case-Studies/case_anti_analysis_techniques.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶ååˆ†ææŠ€æœ¯">æ¡ˆä¾‹ç ”ç©¶ï¼šååˆ†ææŠ€æœ¯</h1>
<p>ä¸ºäº†ä¿æŠ¤å…¶æ ¸å¿ƒä»£ç å’Œæ•°æ®ä¸è¢«è½»æ˜“åˆ†æï¼Œç°ä»£ App
æ™®éé‡‡ç”¨äº†ä¸€ç³»åˆ—çš„ååˆ†ææŠ€æœ¯ã€‚è¿™äº›æŠ€æœ¯æ—¨åœ¨æ£€æµ‹å’Œé˜»æ­¢è°ƒè¯•å™¨ã€Hook
æ¡†æ¶ï¼ˆå¦‚
Fridaï¼‰å’Œæ¨¡æ‹Ÿå™¨çš„è¿è¡Œã€‚æœ¬æ¡ˆä¾‹å°†åˆ†ç±»ä»‹ç»è¿™äº›æŠ€æœ¯çš„å®ç°åŸç†å’Œå¸¸è§çš„ç»•è¿‡ç­–ç•¥ã€‚</p>
<hr />
<h2 id="åè°ƒè¯•-anti-debugging">1. åè°ƒè¯• (Anti-Debugging)</h2>
<ul>
<li>*ç›®æ ‡**: æ£€æµ‹ App æ˜¯å¦æ­£è¢«è°ƒè¯•å™¨é™„åŠ ã€‚</li>
</ul>
<h3 id="æ¡ˆä¾‹åŸºäº-tracerpid-çš„æ£€æµ‹">æ¡ˆä¾‹ï¼šåŸºäº <code>TracerPid</code>
çš„æ£€æµ‹</h3>
<p>è¿™æ˜¯æœ€å¸¸è§çš„ä¸€ç§åè°ƒè¯•æ–¹æ³•ã€‚åœ¨ Linux å†…æ ¸ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹çš„
<code>/proc/&lt;pid&gt;/status</code> æ–‡ä»¶éƒ½è®°å½•äº†å…¶çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ä¸­
<code>TracerPid</code> å­—æ®µè¡¨ç¤ºæ­£åœ¨è¿½è¸ªï¼ˆè°ƒè¯•ï¼‰è¯¥è¿›ç¨‹çš„è¿›ç¨‹
PIDã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¢«è°ƒè¯•ï¼Œè¯¥å€¼ä¸º 0ã€‚</p>
<ul>
<li>*å®ç°åŸç†**: App
åœ¨è¿è¡Œæ—¶ä¼šå¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æˆ–å­è¿›ç¨‹ï¼Œå‘¨æœŸæ€§åœ°è¯»å–è‡ªèº«çš„
<code>TracerPid</code>ã€‚</li>
</ul>
<div class="sourceCode" id="cb409"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Native (C/C++) implementation</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> check_tracer_pid<span class="op">()</span> <span class="op">{</span></span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;/proc/self/status&quot;</span><span class="op">,</span> <span class="st">&quot;r&quot;</span><span class="op">);</span></span>
<span id="cb409-7"><a href="#cb409-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb409-8"><a href="#cb409-8" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb409-9"><a href="#cb409-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb409-10"><a href="#cb409-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-11"><a href="#cb409-11" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> line<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb409-12"><a href="#cb409-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> fp<span class="op">))</span> <span class="op">{</span></span>
<span id="cb409-13"><a href="#cb409-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>strncmp<span class="op">(</span>line<span class="op">,</span> <span class="st">&quot;TracerPid:&quot;</span><span class="op">,</span> <span class="dv">10</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb409-14"><a href="#cb409-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tracer_pid <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb409-15"><a href="#cb409-15" aria-hidden="true" tabindex="-1"></a>sscanf<span class="op">(</span>line<span class="op">,</span> <span class="st">&quot;TracerPid:</span><span class="sc">\t%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>tracer_pid<span class="op">);</span></span>
<span id="cb409-16"><a href="#cb409-16" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb409-17"><a href="#cb409-17" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> tracer_pid<span class="op">;</span></span>
<span id="cb409-18"><a href="#cb409-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb409-19"><a href="#cb409-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb409-20"><a href="#cb409-20" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb409-21"><a href="#cb409-21" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb409-22"><a href="#cb409-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb409-23"><a href="#cb409-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-24"><a href="#cb409-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Call this in a loop somewhere in the App</span></span>
<span id="cb409-25"><a href="#cb409-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>check_tracer_pid<span class="op">()</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb409-26"><a href="#cb409-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Debugger detected, execute exit or crash logic</span></span>
<span id="cb409-27"><a href="#cb409-27" aria-hidden="true" tabindex="-1"></a>exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb409-28"><a href="#cb409-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="å-hook-anti-hooking">2. å Hook (Anti-Hooking)</h2>
<ul>
<li>*ç›®æ ‡**: æ£€æµ‹å’Œé˜»æ­¢ Frida ç­‰ Hook æ¡†æ¶çš„æ³¨å…¥å’ŒåŠŸèƒ½ã€‚</li>
</ul>
<h3 id="æ¡ˆä¾‹æ‰«æå†…å­˜ä¸­çš„-frida-ç‰¹å¾">æ¡ˆä¾‹ï¼šæ‰«æå†…å­˜ä¸­çš„ Frida ç‰¹å¾</h3>
<p>Frida åœ¨æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹åï¼Œä¼šåœ¨å†…å­˜ä¸­ç•™ä¸‹ä¸€äº›ç‰¹å¾ï¼Œå¦‚å…¶æ ¸å¿ƒåº“
<code>frida-agent.so</code>ã€‚</p>
<ul>
<li>*å®ç°åŸç†**: App
ä¼šæ‰«æè‡ªèº«çš„å†…å­˜æ˜ å°„ï¼ˆ<code>/proc/self/maps</code>ï¼‰ï¼Œå¯»æ‰¾æ˜¯å¦å­˜åœ¨åŒ…å«
<code>frida</code> æˆ– <code>gumjs</code> ç­‰å…³é”®è¯çš„åº“ã€‚</li>
</ul>
<div class="sourceCode" id="cb410"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Native (C/C++) implementation</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> check_for_frida_in_maps<span class="op">()</span> <span class="op">{</span></span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;/proc/self/maps&quot;</span><span class="op">,</span> <span class="st">&quot;r&quot;</span><span class="op">);</span></span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb410-7"><a href="#cb410-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-8"><a href="#cb410-8" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> line<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span>
<span id="cb410-9"><a href="#cb410-9" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> fp<span class="op">))</span> <span class="op">{</span></span>
<span id="cb410-10"><a href="#cb410-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>strstr<span class="op">(</span>line<span class="op">,</span> <span class="st">&quot;frida-agent&quot;</span><span class="op">)</span> <span class="op">||</span> strstr<span class="op">(</span>line<span class="op">,</span> <span class="st">&quot;gumjs&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb410-11"><a href="#cb410-11" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb410-12"><a href="#cb410-12" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// Frida detected</span></span>
<span id="cb410-13"><a href="#cb410-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb410-14"><a href="#cb410-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb410-15"><a href="#cb410-15" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb410-16"><a href="#cb410-16" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb410-17"><a href="#cb410-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="åæ¨¡æ‹Ÿå™¨-anti-emulator">3. åæ¨¡æ‹Ÿå™¨ (Anti-Emulator)</h2>
<ul>
<li>*ç›®æ ‡**: æ£€æµ‹ App æ˜¯å¦è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ï¼ˆå¦‚ Genymotion, Android SDK
Emulatorï¼‰è€ŒéçœŸå®è®¾å¤‡ä¸Šã€‚</li>
</ul>
<h3 id="æ¡ˆä¾‹æ£€æµ‹è®¾å¤‡ç‰¹æœ‰æ–‡ä»¶æˆ–å±æ€§">æ¡ˆä¾‹ï¼šæ£€æµ‹è®¾å¤‡ç‰¹æœ‰æ–‡ä»¶æˆ–å±æ€§</h3>
<p>æ¨¡æ‹Ÿå™¨é€šå¸¸ä¼šç•™ä¸‹ä¸€äº›åŒºåˆ«äºçœŸæœºçš„ç‰¹æœ‰æ–‡ä»¶ã€é©±åŠ¨æˆ–ç³»ç»Ÿå±æ€§ã€‚</p>
<ul>
<li><p>*å®ç°åŸç†**:</p></li>
<li><p><strong>æ£€æŸ¥ç³»ç»Ÿå±æ€§</strong>: é€šè¿‡ <code>getprop</code>
æˆ–ç›´æ¥è¯»å– <code>build.prop</code> æ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨
<code>ro.kernel.qemu</code>, <code>ro.hardware.goldfish</code>
ç­‰æ¨¡æ‹Ÿå™¨ç‰¹æœ‰çš„å±æ€§ã€‚</p></li>
<li><p><strong>æ£€æŸ¥æ–‡ä»¶</strong>: æ£€æŸ¥æ˜¯å¦å­˜åœ¨
<code>/system/lib/libc_malloc_debug_qemu.so</code> æˆ–
<code>/sys/qemu_trace</code> ç­‰æ–‡ä»¶ã€‚</p></li>
<li><p><strong>æ£€æŸ¥ CPU ä¿¡æ¯</strong>: è¯»å–
<code>/proc/cpuinfo</code>ï¼Œæ£€æŸ¥ <code>Hardware</code> å­—æ®µæ˜¯å¦åŒ…å«
<code>Goldfish</code> æˆ– <code>Intel</code> ç­‰ï¼Œè€Œé
<code>Qualcomm</code>, <code>MediaTek</code>
ç­‰ç§»åŠ¨ç«¯å¤„ç†å™¨å‚å•†ã€‚</p></li>
<li><p>*ç»•è¿‡ç­–ç•¥**:</p></li>
<li><p><strong>Hook <code>System.getProperty</code></strong>: åœ¨ Java å±‚
Hook è¯¥æ–¹æ³•ï¼Œå½“è¯·æ±‚ç‰¹å®šå±æ€§æ—¶è¿”å›ä¸€ä¸ªä¼ªé€ çš„ã€çœ‹èµ·æ¥åƒçœŸæœºçš„å€¼ã€‚</p></li>
<li><p><strong>Hook æ–‡ä»¶ API</strong>: Hook <code>File.exists()</code>
æˆ– Native å±‚çš„ <code>access()</code>, <code>stat()</code>
ç­‰å‡½æ•°ï¼Œå¯¹ç‰¹å®šçš„æ¨¡æ‹Ÿå™¨æ–‡ä»¶è·¯å¾„è¿”å› <code>false</code>ã€‚</p></li>
<li><p><strong>ä½¿ç”¨å®šåˆ¶ ROM</strong>: åœ¨ä¸€ä¸ªä¿®æ”¹è¿‡çš„ Android ROM
ä¸­ï¼Œå¯ä»¥ä»ç³»ç»Ÿå±‚é¢ç§»é™¤æˆ–ä¼ªé€ è¿™äº›æ¨¡æ‹Ÿå™¨ç‰¹å¾ã€‚</p></li>
<li><p><strong>é€‰æ‹©æ›´é€¼çœŸçš„æ¨¡æ‹Ÿå™¨</strong>:
ä¸€äº›å•†ä¸šæˆ–å¼€æºçš„ã€é«˜åº¦å®šåˆ¶åŒ–çš„æ¨¡æ‹Ÿå™¨åœ¨éšè—è‡ªèº«ç‰¹å¾æ–¹é¢åšå¾—æ›´å¥½ï¼Œæ›´éš¾è¢«æ£€æµ‹ã€‚</p></li>
</ul>
<hr />
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ååˆ†ææŠ€æœ¯çš„æ”»é˜²æ˜¯ä¸€ä¸ªä¸æ–­å‡çº§çš„â€çŒ«é¼ æ¸¸æˆâ€ã€‚</p>
<ul>
<li><p><strong>æ£€æµ‹æ–¹</strong>:
åŠªåŠ›å¯»æ‰¾åˆ†æå·¥å…·ï¼ˆè°ƒè¯•å™¨ã€Fridaï¼‰åœ¨ç›®æ ‡ç³»ç»Ÿä¸­ç•™ä¸‹çš„ä»»ä½•è››ä¸é©¬è¿¹ã€‚</p></li>
<li><p><strong>ç»•è¿‡æ–¹</strong>: åŠªåŠ›æŠ¹å»æˆ–ä¼ªé€ è¿™äº›ç—•è¿¹ï¼Œè®© App
è®¤ä¸ºè‡ªå·±è¿è¡Œåœ¨ä¸€ä¸ªâ€å¹²å‡€â€çš„ç¯å¢ƒä¸­ã€‚</p></li>
</ul>
<p>æˆåŠŸçš„ç»•è¿‡å¾€å¾€éœ€è¦å¤šé¡¹æŠ€æœ¯çš„ç»„åˆï¼Œä» Java å±‚çš„ Hookï¼Œåˆ° Native å±‚çš„
Patchingï¼Œå†åˆ°å¯¹æ“ä½œç³»ç»Ÿå’Œå·¥å…·é“¾æœ¬èº«çš„å®šåˆ¶ã€‚</p>
<!-- 03-Case-Studies/case_flutter_apps.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶flutter-åº”ç”¨é€†å‘">æ¡ˆä¾‹ç ”ç©¶ï¼šFlutter åº”ç”¨é€†å‘</h1>
<p>Flutter æ˜¯ Google æ¨å‡ºçš„è·¨å¹³å° UI æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Dart
è¯­è¨€å¼€å‘ã€‚ä¸ä¼ ç»Ÿçš„ Android App (Java/Kotlin) æˆ– Unity (C#) ä¸åŒï¼ŒRelease
æ¨¡å¼ä¸‹çš„ Flutter åº”ç”¨å°† Dart ä»£ç é¢„ç¼–è¯‘ (AOT) æˆäº†åŸç”Ÿæœºå™¨ç ï¼Œæ‰“åŒ…åœ¨
<code>libapp.so</code> ä¸­ï¼Œè¿™ä½¿å¾—é€†å‘éš¾åº¦å¤§å¤§å¢åŠ ã€‚</p>
<hr />
<h2 id="æ ¸å¿ƒæ¶æ„">æ ¸å¿ƒæ¶æ„</h2>
<ol type="1">
<li><strong><code>lib/armeabi-v7a/libflutter.so</code></strong>: Flutter
å¼•æ“ï¼Œè´Ÿè´£æ¸²æŸ“ã€é€šä¿¡å’Œè¿è¡Œæ—¶æ”¯æŒã€‚é€šå¸¸ä¸éœ€è¦é€†å‘ï¼Œä½†å¯ä»¥ç”¨å®ƒæ¥å®šä½å…³é”®çš„å†…éƒ¨å‡½æ•°ã€‚</li>
<li><strong><code>lib/armeabi-v7a/libapp.so</code></strong>:
<strong>é€†å‘çš„æ ¸å¿ƒç›®æ ‡</strong>ã€‚åŒ…å«äº†å¼€å‘è€…çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆDart
ä»£ç ç¼–è¯‘åçš„äº§ç‰©ï¼‰ã€‚</li>
<li><strong>Snapshot æ ¼å¼</strong>: <code>libapp.so</code>
å®é™…ä¸Šä¸ä»…ä»…æ˜¯ä»£ç ï¼Œè¿˜åŒ…å«äº†ä¸€ä¸ª Dart VM Snapshotã€‚å®ƒæ²¡æœ‰æ ‡å‡†çš„ ELF
ç¬¦å·è¡¨ï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼ Java çš„ç±»ç»“æ„å…ƒæ•°æ®ã€‚</li>
</ol>
<hr />
<h2 id="é€†å‘æµç¨‹">é€†å‘æµç¨‹</h2>
<h2 id="ç¬¬-1-æ­¥è¯†åˆ«-flutter-åº”ç”¨"># ç¬¬ 1 æ­¥ï¼šè¯†åˆ« Flutter åº”ç”¨</h2>
<p>è§£å‹ APKï¼ŒæŸ¥çœ‹ <code>lib</code> ç›®å½•ã€‚å¦‚æœçœ‹åˆ°
<code>libflutter.so</code> å’Œ <code>libapp.so</code>ï¼Œé‚£ä¹ˆè¿™è‚¯å®šæ˜¯ä¸€ä¸ª
Flutter åº”ç”¨ã€‚</p>
<h2 id="ç¬¬-2-æ­¥ä½¿ç”¨-reflutter-æ¡†æ¶"># ç¬¬ 2 æ­¥ï¼šä½¿ç”¨ reFlutter æ¡†æ¶</h2>
<p>ç”±äº Dart AOT çš„ç‰¹æ®Šæ€§ï¼Œç›´æ¥ç”¨ IDA åˆ†æ <code>libapp.so</code>
éå¸¸å›°éš¾ï¼Œå› ä¸ºæ‰€æœ‰å‡½æ•°åéƒ½è¢«å‰¥ç¦»äº†ï¼Œä¸” Dart
çš„è°ƒç”¨çº¦å®šå’Œå¯„å­˜å™¨ä½¿ç”¨æ–¹å¼ä¸æ ‡å‡† C/C++ ä¸åŒã€‚</p>
<ul>
<li><p>*reFlutter** æ˜¯ç›®å‰æœ€å¼ºå¤§çš„ Flutter é€†å‘è¾…åŠ©å·¥å…·ã€‚å®ƒé€šè¿‡ä¿®æ”¹
Flutter å¼•æ“ (<code>libflutter.so</code>)ï¼Œåœ¨åº”ç”¨è¿è¡Œæ—¶åˆ©ç”¨ Dart VM
çš„å†…éƒ¨æœºåˆ¶æ¥ Dump ç±»ã€å‡½æ•°å’Œåç§»ä¿¡æ¯ã€‚</p></li>
<li><p>*å·¥å…·**: <a
href="https://github.com/Impact-I/reFlutter">reFlutter</a></p></li>
<li><p>*æ“ä½œæ­¥éª¤**:</p></li>
</ul>
<ol type="1">
<li><strong>é‡æ‰“åŒ…</strong>: ä½¿ç”¨ reFlutter å¤„ç†ç›®æ ‡ APKã€‚ ```bash
reflutter target.apk</li>
</ol>
<pre><code>2. **å®‰è£…è¿è¡Œ**: å®‰è£…ç”Ÿæˆçš„ `release.RE.apk` åˆ°æ‰‹æœºã€‚
3. **è·å–åç§»**: åº”ç”¨å¯åŠ¨åï¼ŒreFlutter ä¼šåœ¨ Logcat ä¸­è¾“å‡ºå…³é”®çš„ Dart åº“å‡½æ•°çš„åç§»åœ°å€ï¼Œæˆ–è€…ç”Ÿæˆä¸€ä¸ª `dump.dart` æ–‡ä»¶ã€‚

## # ç¬¬ 3 æ­¥ï¼šæµé‡æ‹¦æˆª (SSL Pinning Bypass)

Flutter åº”ç”¨ä¸ä½¿ç”¨ç³»ç»Ÿçš„ä»£ç†è®¾ç½®ï¼Œä¹Ÿä¸ä½¿ç”¨ Java å±‚çš„ HTTP å®¢æˆ·ç«¯ (OkHttp)ï¼Œè€Œæ˜¯ä½¿ç”¨ Dart è‡ªå·±çš„ `HttpClient`ã€‚å› æ­¤ï¼Œä¼ ç»Ÿçš„æŠ“åŒ…è®¾ç½®ï¼ˆWi-Fi ä»£ç†ï¼‰å’Œ Frida SSL Pinning è„šæœ¬é€šå¸¸æ— æ•ˆã€‚

* *reFlutter çš„æ–¹æ¡ˆ**:
reFlutter åœ¨é‡æ‰“åŒ…æ—¶ï¼Œä¼šè‡ªåŠ¨ Patch `libflutter.so` ä¸­çš„ç½‘ç»œæ ¡éªŒé€»è¾‘ï¼Œå¹¶å¼ºåˆ¶å°†æµé‡è½¬å‘åˆ°æŒ‡å®šçš„ä»£ç† IPï¼ˆéœ€è¦åœ¨ reFlutter é…ç½®é˜¶æ®µè¾“å…¥ä½ çš„ Burp/Charles IPï¼‰ã€‚è¿™æ˜¯ç›®å‰æ‹¦æˆª Flutter æµé‡æœ€ç¨³å®šçš„æ–¹æ³•ã€‚

* *Frida æ–¹æ¡ˆ (Hook éªŒè¯å‡½æ•°)**:
å¦‚æœä½ ä¸æƒ³é‡æ‰“åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ Frida Hook `libflutter.so` ä¸­è´Ÿè´£éªŒè¯è¯ä¹¦çš„å‡½æ•°ã€‚
* å‡½æ•°åé€šå¸¸åŒ…å« `SessionVerifyCertificateChain`ã€‚
* ä½ éœ€è¦ä¸‹è½½å¯¹åº” Flutter ç‰ˆæœ¬çš„ `libflutter.so` ç¬¦å·æ–‡ä»¶ï¼Œæˆ–è€…é€šè¿‡ç‰¹å¾ç æœç´¢è¯¥å‡½æ•°ã€‚
* Hook è¯¥å‡½æ•°å¹¶ä½¿å…¶ç›´æ¥è¿”å›éªŒè¯æˆåŠŸã€‚

## # ç¬¬ 4 æ­¥ï¼šä½¿ç”¨ Doldrums è¿˜åŸä»£ç 

* *Doldrums** æ˜¯ä¸€ä¸ªé’ˆå¯¹ Flutter Android åº”ç”¨çš„é™æ€åˆ†æå·¥å…·ï¼Œè¯•å›¾å°† `libapp.so` åç¼–è¯‘å› Dart ä¼ªä»£ç ã€‚

* *å·¥å…·**: [Doldrums](https://github.com/rscloura/Doldrums)

* æ³¨æ„ï¼šç”±äº Flutter ç‰ˆæœ¬æ›´æ–°æå¿«ï¼ŒSnapshot æ ¼å¼ç»å¸¸å˜åŠ¨ï¼ŒDoldrums å¯èƒ½ä¸æ”¯æŒæœ€æ–°çš„ Flutter ç‰ˆæœ¬ã€‚

## # ç¬¬ 5 æ­¥ï¼šåŠ¨æ€åˆ†æ (Dart VM Hook)

å¦‚æœæ— æ³•é™æ€è¿˜åŸä»£ç ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œ Hookã€‚ç”±äºæ²¡æœ‰ç¬¦å·ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆ reFlutter å¯¼å‡ºçš„åç§»åœ°å€ã€‚

```javascript
// Frida Script Example: Hook Dart Function
// Assume reFlutter tells us the function offset to hook is 0x1a2b3c

var appBase = Module.findBaseAddress(&#39;libapp.so&#39;);
var targetOffset = 0x1a2b3c;
var targetFunc = appBase.add(targetOffset);

Interceptor.attach(targetFunc, {
onEnter: function(args) {
// Dart function parameter passing is special
// args[0] may not be the first parameter, but a Closure or other VM structure
// Parameters are usually stored in specific registers or stack locations, depending on Dart version and ABI
console.log(&quot;Dart function called!&quot;);

// Print parameters (try reading first 4 parameters)
console.log(&quot;Arg1: &quot; + args[0]);
console.log(&quot;Arg2: &quot; + args[1]);
console.log(&quot;Arg3: &quot; + args[2]);
},
onLeave: function(retval) {
console.log(&quot;Dart function returned: &quot; + retval);
}
});
</code></pre>
<ol start="2" type="1">
<li><strong>ä»£ç åˆ†æ</strong>: é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚
Doldrumsï¼‰å…¼å®¹æ€§è¾ƒå·®ï¼Œä¸»è¦ä¾èµ– <strong>reFlutter</strong> æå–åç§» +
<strong>Frida</strong> åŠ¨æ€è°ƒè¯•ã€‚</li>
<li><strong>æ ¸å¿ƒ</strong>: ç†è§£ Dart VM çš„å·¥ä½œåŸç†ï¼ˆSnapshot
ç»“æ„ã€Object Poolã€Dispatch Tableï¼‰æ˜¯æ·±å…¥é€†å‘ Flutter çš„åŸºç¡€ã€‚</li>
</ol>
<pre><code>


&lt;!-- 03-Case-Studies/case_malware_analysis.md --&gt;

# æ¡ˆä¾‹ç ”ç©¶ï¼šå®‰å“é“¶è¡Œæœ¨é©¬åˆ†æ

æ¶æ„è½¯ä»¶åˆ†ææ˜¯é€†å‘å·¥ç¨‹çš„ä¸€ä¸ªé‡è¦åº”ç”¨é¢†åŸŸã€‚ä¸å¸¸è§„ App åˆ†æä¸åŒï¼Œåˆ†ææ¶æ„è½¯ä»¶æ›´å…³æ³¨å…¶**éšè—è¡Œä¸º**ã€**æŒä¹…åŒ–æœºåˆ¶**ã€**çªƒå¯†æ‰‹æ®µ**ä»¥åŠ**C2 (Command &amp; Control) é€šä¿¡**ã€‚

æœ¬æ¡ˆä¾‹å°†æ¨¡æ‹Ÿåˆ†æä¸€ä¸ªå…¸å‹çš„ **Android é“¶è¡Œæœ¨é©¬ (Banking Trojan)**ã€‚
___
## æ ·æœ¬æ¦‚å†µ

* **ä¼ªè£…**: è¯¥æœ¨é©¬ä¼ªè£…æˆ &quot;Flash Player&quot; æˆ– &quot;ç³»ç»Ÿæ›´æ–°&quot; åº”ç”¨ã€‚
* **è¡Œä¸º**: è¯±å¯¼ç”¨æˆ·å¼€å¯â€œæ— éšœç¢æœåŠ¡â€ï¼Œç„¶ååˆ©ç”¨è¯¥æƒé™è¿›è¡Œç‚¹å‡»åŠ«æŒã€è¦†ç›–æ”»å‡» (Overlay Attack)ï¼Œçªƒå–é“¶è¡Œ App çš„è´¦å·å¯†ç ï¼Œå¹¶æ‹¦æˆªçŸ­ä¿¡éªŒè¯ç ã€‚
___
## è¯¦ç»†åˆ†ææµç¨‹

## # ç¬¬ 1 æ­¥ï¼šé™æ€åˆ†æ (Manifest &amp; æƒé™)

ä½¿ç”¨ `jadx` æ‰“å¼€ APKï¼Œé¦–å…ˆæŸ¥çœ‹ `AndroidManifest.xml`ã€‚

* *å…³é”®å‘ç°**:
1. **æ•æ„Ÿæƒé™**:
* `android.permission.BIND_ACCESSIBILITY_SERVICE` (æ— éšœç¢æœåŠ¡ - æ ¸å¿ƒæƒé™)
* `android.permission.RECEIVE_SMS` (æ¥æ”¶çŸ­ä¿¡)
* `android.permission.READ_SMS` (è¯»å–çŸ­ä¿¡)
* `android.permission.SYSTEM_ALERT_WINDOW` (æ‚¬æµ®çª— - ç”¨äºè¦†ç›–æ”»å‡»)
* `android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS` (å¿½ç•¥ç”µæ± ä¼˜åŒ– - ä¿æ´»)

2. **å…¥å£ç‚¹ (Entry Points)**:
* å‘ç°ä¸€ä¸ª `MainActivity`ï¼Œä½†ä»£ç å¾ˆç®€å•ï¼Œåªæ˜¯è¯·æ±‚æƒé™ã€‚
* å‘ç°ä¸€ä¸ª `MyAccessibilityService`ï¼Œç»§æ‰¿è‡ª `AccessibilityService`ï¼Œè¿™æ˜¯æ ¸å¿ƒé€»è¾‘æ‰€åœ¨ã€‚

## # ç¬¬ 2 æ­¥ï¼šåˆ†ææ— éšœç¢æœåŠ¡ (Accessibility Service)

å®šä½åˆ° `MyAccessibilityService` ç±»ï¼Œé‡ç‚¹åˆ†æ `onAccessibilityEvent` æ–¹æ³•ã€‚

```java
public void onAccessibilityEvent(AccessibilityEvent event) {
String packageName = event.getPackageName().toString();

// 1. Auto grant permissions (Self-Protection &amp; Persistence)
if (packageName.equals(&quot;com.android.settings&quot;)) {
// If user opens settings page to uninstall or disable permissions, malware will auto click &quot;Back&quot; or &quot;Cancel&quot;
performGlobalAction(GLOBAL_ACTION_BACK);
}

// 2. Monitor target banking apps
if (TARGET_BANK_APPS.contains(packageName)) {
// Detected victim opened banking app
showOverlay(packageName);
}

// 3. Keyboard recording (Keylogging)
if (event.getEventType() == AccessibilityEvent.TYPE_VIEW_TEXT_CHANGED) {
String text = event.getText().toString();
logKey(text);
}
}
</code></pre>
<ul>
<li><strong>çªƒå–</strong>: ç”¨æˆ·ä»¥ä¸ºè‡ªå·±åœ¨ç™»å½•é“¶è¡Œï¼Œå®é™…ä¸Šæ˜¯åœ¨æœ¨é©¬çš„
WebView ä¸­è¾“å…¥äº†è´¦å·å¯†ç ã€‚æœ¨é©¬é€šè¿‡ JavaScript Interface å°†è¾“å…¥çš„æ•°æ®ä¼ å›
Java å±‚ï¼Œç„¶åä¸Šä¼ æœåŠ¡å™¨ã€‚</li>
</ul>
<h2 id="ç¬¬-4-æ­¥çŸ­ä¿¡æ‹¦æˆª-sms-stealing"># ç¬¬ 4 æ­¥ï¼šçŸ­ä¿¡æ‹¦æˆª (SMS
Stealing)</h2>
<p>åˆ†æ <code>SmsReceiver</code> ç±»ã€‚</p>
<div class="sourceCode" id="cb413"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SmsReceiver <span class="kw">extends</span> BroadcastReceiver <span class="op">{</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">onReceive</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">,</span> Intent intent<span class="op">)</span> <span class="op">{</span></span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Object</span><span class="op">[]</span> pdus <span class="op">=</span> <span class="op">(</span><span class="bu">Object</span><span class="op">[])</span> intent<span class="op">.</span><span class="fu">getExtras</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;pdus&quot;</span><span class="op">);</span></span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="bu">Object</span> pdu <span class="op">:</span> pdus<span class="op">)</span> <span class="op">{</span></span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true" tabindex="-1"></a>SmsMessage sms <span class="op">=</span> SmsMessage<span class="op">.</span><span class="fu">createFromPdu</span><span class="op">((</span><span class="dt">byte</span><span class="op">[])</span> pdu<span class="op">);</span></span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> body <span class="op">=</span> sms<span class="op">.</span><span class="fu">getMessageBody</span><span class="op">();</span></span>
<span id="cb413-8"><a href="#cb413-8" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> sender <span class="op">=</span> sms<span class="op">.</span><span class="fu">getOriginatingAddress</span><span class="op">();</span></span>
<span id="cb413-9"><a href="#cb413-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-10"><a href="#cb413-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Upload SMS to C2 Server</span></span>
<span id="cb413-11"><a href="#cb413-11" aria-hidden="true" tabindex="-1"></a><span class="fu">uploadSmsToC2</span><span class="op">(</span>sender<span class="op">,</span> body<span class="op">);</span></span>
<span id="cb413-12"><a href="#cb413-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-13"><a href="#cb413-13" aria-hidden="true" tabindex="-1"></a><span class="co">// If SMS contains &quot;verification code&quot; or other key words, intercept the broadcast so user cannot see it</span></span>
<span id="cb413-14"><a href="#cb413-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span><span class="fu">is2FACode</span><span class="op">(</span>body<span class="op">))</span> <span class="op">{</span></span>
<span id="cb413-15"><a href="#cb413-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abortBroadcast</span><span class="op">();</span></span>
<span id="cb413-16"><a href="#cb413-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb413-17"><a href="#cb413-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb413-18"><a href="#cb413-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb413-19"><a href="#cb413-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li><strong>èµ„æºè§£å¯†</strong>: æœ‰æ—¶ C2 åœ°å€è¢«åŠ å¯†å­˜å‚¨åœ¨
<code>assets</code> ä¸‹çš„å›¾ç‰‡æˆ–æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ DGA (åŸŸåç”Ÿæˆç®—æ³•)
åŠ¨æ€ç”Ÿæˆã€‚</li>
<li><strong>Native åˆ†æ</strong>: è¶Šæ¥è¶Šå¤šçš„æœ¨é©¬å°† C2
åœ°å€å’Œé€šä¿¡é€»è¾‘éšè—åœ¨ SO åº“ä¸­ã€‚</li>
</ul>
<ol start="2" type="1">
<li><strong>é€šä¿¡åè®®</strong>:</li>
</ol>
<ul>
<li><p><strong>HTTP/HTTPS</strong>: æŠ“åŒ…åˆ†æ POST è¯·æ±‚ã€‚</p></li>
<li><p><strong>WebSocket</strong>: ç”¨äºå®æ—¶æ§åˆ¶ã€‚</p></li>
<li><p><strong>Telegram Bot API</strong>: å¾ˆå¤šæ–°å‹æœ¨é©¬åˆ©ç”¨ Telegram Bot
ä½œä¸º C2ï¼Œå› ä¸º Telegram çš„æµé‡é€šå¸¸ä¸ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªï¼Œä¸” HTTPS
éš¾ä»¥è§£å¯†ã€‚</p></li>
<li><p>*Frida Hook ç¤ºä¾‹ (æ‹¦æˆª Telegram API)**: ```javascript // Assume
malware uses OkHttp var OkHttpClient = Java.use(â€œokhttp3.OkHttpClientâ€);
OkHttpClient.newCall.implementation = function(request) { var url =
request.url().toString(); if (url.includes(â€œapi.telegram.orgâ€)) {
console.log(â€œ[!] Detected Telegram C2 Communication:â€ + url); } return
this.newCall(request); };</p></li>
</ul>
<pre><code>
æœ¨é©¬ä½œè€…ä¹Ÿä¼šä½¿ç”¨å„ç§æ‰‹æ®µé˜²æ­¢è¢«é€†å‘ï¼š
* **æ¨¡æ‹Ÿå™¨æ£€æµ‹**: æ£€æŸ¥ `Build.FINGERPRINT`, `Build.MODEL` ç­‰ã€‚
* **åŠ å£³**: ä½¿ç”¨å…è´¹æˆ–å•†ä¸šçš„åŠ å›ºæœåŠ¡ã€‚
* **åŠ¨æ€åŠ è½½**: æ ¸å¿ƒ `dex` æ–‡ä»¶è¢«åŠ å¯†å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†åŠ è½½ (DexClassLoader)ã€‚
___
## æ€»ç»“

åˆ†æé“¶è¡Œæœ¨é©¬çš„å…³é”®åœ¨äºç†è§£å…¶**æ”»å‡»é“¾ (Kill Chain)**ï¼š
1. **Infection**: è¯±å¯¼å®‰è£…ã€‚
2. **Persistence**: è·å–æ— éšœç¢æƒé™ã€ä¿æ´»ã€‚
3. **Stealing**: è¦†ç›–æ”»å‡»çªƒå–å‡­è¯ã€æ‹¦æˆªçŸ­ä¿¡ã€‚
4. **Exfiltration**: å°†æ•°æ®å›ä¼  C2ã€‚

é€†å‘å·¥ç¨‹å¸ˆçš„ä»»åŠ¡æ˜¯é˜»æ–­è¿™ä¸€é“¾æ¡ï¼Œæå– IOC (Indicators of Compromiseï¼Œå¦‚ C2 åŸŸåã€æ–‡ä»¶ Hash)ï¼Œå¹¶ååŠ©å¼€å‘æŸ¥æ€ç­–ç•¥ã€‚</code></pre>
<!-- 03-Case-Studies/case_music_apps.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶éŸ³ä¹-app">æ¡ˆä¾‹ç ”ç©¶ï¼šéŸ³ä¹ App</h1>
<p>éŸ³ä¹ç±» App æ˜¯éå¸¸å…¸å‹çš„é€†å‘åˆ†æç›®æ ‡ã€‚å…¶æ ¸å¿ƒåœºæ™¯é€šå¸¸å›´ç»•ç€ VIP
ä¼šå‘˜ç‰¹æƒã€éŸ³é¢‘æ•°æ®åŠ å¯†å’Œå®¢æˆ·ç«¯é£æ§ç­–ç•¥ã€‚æœ¬æ¡ˆä¾‹å°†æ¨¡æ‹Ÿå¯¹ä¸€ä¸ªå…¸å‹éŸ³ä¹ App
çš„åˆ†æè¿‡ç¨‹ã€‚ ___ ## æ ¸å¿ƒåˆ†æç›®æ ‡</p>
<ol type="1">
<li><strong>è§£é” VIP åŠŸèƒ½</strong>:
å…è´¹æ”¶å¬ä»˜è´¹æ­Œæ›²ã€ä¸‹è½½æ— æŸéŸ³è´¨ã€å»é™¤å¹¿å‘Šã€ä½¿ç”¨ä¸“å±çš®è‚¤ç­‰ã€‚</li>
<li><strong>éŸ³é¢‘æ•°æ®æå–</strong>: åˆ†æåŠ å¯†çš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚
<code>ncm</code>, <code>qmcflac</code>ï¼‰ï¼Œæå–å‡ºå¯æ’­æ”¾çš„
<code>mp3</code> æˆ– <code>flac</code> æ–‡ä»¶ã€‚</li>
<li><strong>API åˆ†æ</strong>: åˆ†æå…¶æ­Œæ›²æœç´¢ã€æ­Œå•è·å–ã€è¯„è®ºåŒºç­‰
APIï¼Œä¸ºç¬¬ä¸‰æ–¹å·¥å…·æˆ–çˆ¬è™«æä¾›æ”¯æŒã€‚ ___ ## æ¡ˆä¾‹ï¼šåˆ†æ VIP
æ­Œæ›²çš„æ’­æ”¾æµç¨‹</li>
</ol>
<h3 id="ç¬¬-1-æ­¥å®šä½åˆ‡å…¥ç‚¹">ç¬¬ 1 æ­¥ï¼šå®šä½åˆ‡å…¥ç‚¹</h3>
<ul>
<li>*ç›®æ ‡**: æ‰¾åˆ°åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸º VIP
ä»¥åŠæ­Œæ›²æ˜¯å¦ä¸ºä»˜è´¹æ­Œæ›²çš„å…³é”®ä»£ç ã€‚</li>
</ul>
<ol type="1">
<li><strong>ç•Œé¢åˆ†æ</strong>: åœ¨ App ä¸­æ’­æ”¾ä¸€é¦–éœ€è¦ VIP
çš„æ­Œæ›²ï¼Œé€šå¸¸ä¼šå¼¹å‡ºä¸€ä¸ªâ€å¼€é€š
VIPâ€çš„æç¤ºæ¡†ã€‚è¿™ä¸ªæç¤ºæ¡†æ˜¯ç»ä½³çš„åˆ‡å…¥ç‚¹ã€‚</li>
<li><strong>å¯»æ‰¾å…³é”®è¯</strong>: ä½¿ç”¨ <code>jadx-gui</code> åç¼–è¯‘
APKï¼Œæœç´¢ä¸å¼¹çª—å†…å®¹ç›¸å…³çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚â€ä»…é™VIPâ€ã€â€œå¼€é€šä¼šå‘˜â€ç­‰ã€‚</li>
<li><strong>äº¤å‰å¼•ç”¨</strong>:
å¯¹æ‰¾åˆ°çš„å­—ç¬¦ä¸²è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œå®šä½åˆ°æ˜¾ç¤ºè¿™ä¸ªå¼¹çª—çš„ä»£ç ã€‚ä½ å¾ˆå¯èƒ½ä¼šæ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼
<code>showVipDialog()</code> çš„æ–¹æ³•ã€‚</li>
<li><strong>å›æº¯è°ƒç”¨æ ˆ</strong>: ç»§ç»­å¯¹ <code>showVipDialog()</code>
è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œå‘ä¸Šå›æº¯ã€‚é€šå¸¸ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªåŒ…å«äº†æ ¸å¿ƒåˆ¤æ–­é€»è¾‘çš„å‡½æ•°ï¼Œå…¶ä¼ªä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</li>
</ol>
<div class="sourceCode" id="cb415"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">onPlayButtonClick</span><span class="op">(</span>Song song<span class="op">)</span> <span class="op">{</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="co">// isVip() determines from user information</span></span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a><span class="co">// song.isPaywalled() determines from song information</span></span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span><span class="fu">isVip</span><span class="op">()</span> <span class="op">&amp;&amp;</span> song<span class="op">.</span><span class="fu">isPaywalled</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a><span class="fu">showVipDialog</span><span class="op">();</span></span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb415-8"><a href="#cb415-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ...execute playback logic...</span></span>
<span id="cb415-9"><a href="#cb415-9" aria-hidden="true" tabindex="-1"></a><span class="fu">startPlayback</span><span class="op">(</span>song<span class="op">);</span></span>
<span id="cb415-10"><a href="#cb415-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>*ç›®æ ‡**: ç»•è¿‡ VIP åˆ¤æ–­ï¼Œè®© App è®¤ä¸ºæˆ‘ä»¬æ˜¯ VIP ç”¨æˆ·ã€‚</li>
</ul>
<p>æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ Hook è´Ÿè´£åˆ¤æ–­ç”¨æˆ·èº«ä»½çš„å‡½æ•°ã€‚</p>
<div class="sourceCode" id="cb416"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Assume UserInfo class manages user information</span></span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> UserInfo <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;com.example.music.model.UserInfo&#39;</span>)<span class="op">;</span></span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Directly hook isVip method to always return true</span></span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a>UserInfo<span class="op">.</span><span class="at">isVip</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb416-7"><a href="#cb416-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Bypassing VIP check, returning true.&#39;</span>)<span class="op">;</span></span>
<span id="cb416-8"><a href="#cb416-8" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb416-9"><a href="#cb416-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb416-10"><a href="#cb416-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-11"><a href="#cb416-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Some apps may also verify VIP expiration time</span></span>
<span id="cb416-12"><a href="#cb416-12" aria-hidden="true" tabindex="-1"></a>UserInfo<span class="op">.</span><span class="at">getVipExpireTime</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb416-13"><a href="#cb416-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Return a timestamp far in the future</span></span>
<span id="cb416-14"><a href="#cb416-14" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2099</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">31</span>)<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb416-15"><a href="#cb416-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb416-16"><a href="#cb416-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>è¯·æ±‚çš„ URL ä¸­å¸¦æœ‰ <code>quality=flac</code> æˆ– <code>hires</code>
ç­‰å‚æ•°ã€‚</p></li>
<li><p>æœåŠ¡å™¨è¿”å›çš„å“åº” <code>Content-Type</code> å¯èƒ½ä¸æ˜¯
<code>audio/mpeg</code>ï¼Œè€Œæ˜¯ä¸€äº›è‡ªå®šä¹‰çš„ç±»å‹å¦‚
<code>application/octet-stream</code>ã€‚</p></li>
<li><p>ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œ<code>song.ncm</code>ï¼‰æ— æ³•ç”¨æ ‡å‡†æ’­æ”¾å™¨æ’­æ”¾ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>å®šä½è§£å¯†ä»£ç </strong>: è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚æ•°æ®è§£å¯†é€»è¾‘é€šå¸¸åœ¨
Native å±‚ï¼ˆ<code>.so</code> æ–‡ä»¶ï¼‰ä»¥æé«˜æ€§èƒ½å’Œé€†å‘éš¾åº¦ã€‚</li>
</ol>
<ul>
<li><p><strong>å…³é”®è¯æœç´¢</strong>: åœ¨ IDA Pro æˆ– Ghidra ä¸­æ‰“å¼€ç›¸å…³çš„
<code>.so</code> æ–‡ä»¶ï¼Œæœç´¢ <code>aes</code>, <code>cbc</code>,
<code>decrypt</code>, <code>RC4</code> ç­‰åŠ å¯†ç®—æ³•ç›¸å…³çš„å­—ç¬¦ä¸²ã€‚</p></li>
<li><p><strong>JNI å…¥å£</strong>: ä» Java å±‚è°ƒç”¨ Native ä»£ç éœ€è¦é€šè¿‡ JNI
(Java Native Interface)ã€‚åœ¨ Java ä»£ç ä¸­å¯»æ‰¾ <code>native</code>
å…³é”®å­—å£°æ˜çš„å‡½æ•°ï¼Œä¾‹å¦‚
<code>private native byte[] decryptAudio(byte[] encryptedData, int core);</code>ã€‚è¿™ä¸ªå‡½æ•°åå°±æ˜¯ä½ åœ¨
<code>.so</code> æ–‡ä»¶ä¸­è¦æ‰¾çš„ç¬¦å·ã€‚</p></li>
<li><p><strong>Hook Native å‡½æ•°</strong>: ä¸€æ—¦å®šä½åˆ° JNI å‡½æ•°ï¼ˆå¦‚
<code>Java_com_example_music_player_NativeDecoder_decryptAudio</code>ï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨
Frida è¿›è¡Œ Hookï¼Œè§‚å¯Ÿå…¶è¾“å…¥å’Œè¾“å‡ºã€‚</p></li>
</ul>
<div class="sourceCode" id="cb417"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&#39;libaudiodecrypt.so&#39;</span><span class="op">,</span> <span class="st">&#39;Java_com_example_music_player_NativeDecoder_decryptAudio&#39;</span>)<span class="op">,</span> {</span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span>(args) {</span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a><span class="co">// args[0] is JNIEnv*, args[1] is jclass, args[2] is encrypted data jbyteArray</span></span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Entering decryptAudio...&#39;</span>)<span class="op">;</span></span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Can save encrypted data for subsequent offline analysis</span></span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">encryptedBuffer</span> <span class="op">=</span> args[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb417-7"><a href="#cb417-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb417-8"><a href="#cb417-8" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span>(retval) {</span>
<span id="cb417-9"><a href="#cb417-9" aria-hidden="true" tabindex="-1"></a><span class="co">// retval is the decrypted jbyteArray</span></span>
<span id="cb417-10"><a href="#cb417-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Leaving decryptAudio. Decrypted data pointer: &#39;</span> <span class="op">+</span> retval)<span class="op">;</span></span>
<span id="cb417-11"><a href="#cb417-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Here you can read the memory pointed to by retval to get the decrypted PCM or MP3 data</span></span>
<span id="cb417-12"><a href="#cb417-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb417-13"><a href="#cb417-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>é€šè¿‡åŠ¨æ€åˆ†æï¼Œä½ å·²ç»èƒ½å¤Ÿè·å–åˆ°è§£å¯†åçš„éŸ³é¢‘æ•°æ®ã€‚ä½†å¦‚æœæƒ³å¼€å‘ä¸€ä¸ªç‹¬ç«‹çš„ã€ç¦»çº¿çš„æ ¼å¼è½¬æ¢å·¥å…·ï¼Œå°±éœ€è¦å½»åº•ç†è§£å…¶åŠ å¯†æ–¹æ¡ˆã€‚</p>
<ul>
<li><p><strong>é™æ€åˆ†æ Native ä»£ç </strong>: åœ¨ Ghidra/IDA ä¸­ä»”ç»†åˆ†æ
<code>decryptAudio</code> å‡½æ•°çš„é€»è¾‘ã€‚å®ƒå¯èƒ½åŒ…å«ï¼š</p></li>
<li><p><strong>å…ƒæ•°æ®è§£æ</strong>: ä»åŠ å¯†æ–‡ä»¶å¤´éƒ¨è¯»å–æ­Œæ›²
IDã€ä¸“è¾‘å°é¢ã€æ¯”ç‰¹ç‡ç­‰ä¿¡æ¯ã€‚</p></li>
<li><p><strong>å¯†é’¥æ´¾ç”Ÿ</strong>: ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ Core Key
å’Œä»æ–‡ä»¶å…ƒæ•°æ®ä¸­æå–çš„ Nonce æ¥æ´¾ç”Ÿå‡ºæ¯ä¸ªæ–‡ä»¶å”¯ä¸€çš„ AES Keyã€‚</p></li>
<li><p><strong>è§£å¯†å¾ªç¯</strong>: å¾ªç¯è¯»å–åŠ å¯†çš„éŸ³é¢‘å¸§ï¼Œä½¿ç”¨ AES
æˆ–å…¶ä»–ç®—æ³•è¿›è¡Œè§£å¯†ã€‚</p></li>
<li><p><strong>ä»£ç å®ç°</strong>: ä½¿ç”¨ Python çš„
<code>cryptography</code> ç­‰åº“ï¼Œå°†ä½ åœ¨ Native
ä»£ç ä¸­çœ‹åˆ°çš„é€»è¾‘é‡æ–°å®ç°ä¸€éã€‚æœ€ç»ˆï¼Œä½ å°±èƒ½å¼€å‘å‡ºä¸€ä¸ªå¯ä»¥å°†
<code>.ncm</code> æ‰¹é‡è½¬æ¢ä¸º <code>.flac</code> çš„å·¥å…·ã€‚ ___ ##
ä¸»æµå¹³å°åŠ å¯†æ–¹æ¡ˆå®ä¾‹</p></li>
</ul>
<p>è™½ç„¶é€šç”¨çš„åˆ†ææ€è·¯æ˜¯ä¸€è‡´çš„ï¼Œä½†ä¸åŒå¹³å°çš„å…·ä½“å®ç°ç»†èŠ‚å„ä¸ç›¸åŒã€‚äº†è§£è¿™äº›ç‰¹å¾æœ‰åŠ©äºæ›´å¿«åœ°å®šä½é—®é¢˜ã€‚</p>
<h3 id="ç½‘æ˜“äº‘éŸ³ä¹-.ncm">ç½‘æ˜“äº‘éŸ³ä¹ (<code>.ncm</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.ncm</code> (Netease Cloud
Music)</p></li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>: é‡‡ç”¨ <strong>AES + RC4</strong>
çš„æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚</p></li>
</ul>
<ol type="1">
<li><strong>å…ƒæ•°æ® (Meta)</strong>:
æ–‡ä»¶ä¸­åŒ…å«ä¸€å—åŠ å¯†çš„å…ƒæ•°æ®åŒºåŸŸï¼Œå…¶ä¸­å«æœ‰æ­Œæ›²åã€ä¸“è¾‘å°é¢ã€AES Key
ç­‰ä¿¡æ¯ã€‚è¿™å—åŒºåŸŸæœ¬èº«ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ Meta Key è¿›è¡Œ AES-ECB è§£å¯†ã€‚</li>
<li><strong>éŸ³é¢‘æ•°æ® (Audio)</strong>: éŸ³é¢‘å¸§æ•°æ®ä½¿ç”¨ AES-ECB
åŠ å¯†ã€‚è§£å¯†æ‰€éœ€çš„ AES Key
å°±å­˜åœ¨äºä¸Šä¸€æ­¥è§£å¯†åçš„å…ƒæ•°æ®ä¸­ã€‚ç„¶è€Œï¼Œæœ€ç»ˆçš„è§£å¯†å¯†é’¥æµæ˜¯é€šè¿‡ä¸€ä¸ªç±»ä¼¼
RC4-KSA çš„ç®—æ³•ï¼ŒåŸºäºè¿™ä¸ª AES Key ç”Ÿæˆçš„ã€‚</li>
</ol>
<ul>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p></li>
<li><p>åœ¨ SO åº“ä¸­æœç´¢å­—ç¬¦ä¸² <code>ncm</code>, <code>core</code>,
<code>meta</code>, <code>AES</code>, <code>RC4</code>ã€‚</p></li>
<li><p>å…¶è§£å¯†é€»è¾‘é€šå¸¸è¢«å°è£…åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªä¸“é—¨çš„ Native å‡½æ•°ä¸­ã€‚</p></li>
</ul>
<h3 id="qq-éŸ³ä¹-.qmcflac-.mflac-.qmc0">QQ éŸ³ä¹ (<code>.qmcflac</code>,
<code>.mflac</code>, <code>.qmc0</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.qmcflac</code>,
<code>.qmc0</code>, <code>.qmc3</code>, <code>.mflac</code>
ç­‰ã€‚</p></li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>:
<strong>æœªä½¿ç”¨æ ‡å‡†åŠ å¯†ç®—æ³•</strong>ï¼Œè€Œæ˜¯ä¸€å¥—è‡ªå®šä¹‰çš„å­—èŠ‚<strong>ç½®ä¹±
(Scramble)</strong> æ–¹æ¡ˆã€‚</p></li>
<li><p>å…¶æ ¸å¿ƒæ˜¯ä¾èµ–ä¸€ä¸ªå·¨å¤§çš„<strong>é™æ€æ˜ å°„è¡¨ (Seed
Map)</strong>ï¼Œè¿™ä¸ªè¡¨ç¡¬ç¼–ç åœ¨ SO æ–‡ä»¶ä¸­ã€‚</p></li>
<li><p>è§£å¯†æ—¶ï¼Œæ ¹æ®å½“å‰å­—èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ï¼Œé€šè¿‡ä¸€ä¸ªå¤æ‚çš„å…¬å¼è®¡ç®—å‡ºåœ¨æ˜ å°„è¡¨ä¸­çš„ç´¢å¼•ï¼Œç„¶åå–å‡ºè¡¨ä¸­çš„å€¼ä¸åŠ å¯†å­—èŠ‚è¿›è¡Œè¿ç®—ï¼ˆé€šå¸¸æ˜¯å¼‚æˆ–ï¼‰ã€‚</p></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p></li>
<li><p>ç”±äºæ²¡æœ‰ä½¿ç”¨æ ‡å‡†ç®—æ³•ï¼Œæœç´¢åŠ å¯†å…³é”®è¯æ˜¯æ— æ•ˆçš„ã€‚</p></li>
<li><p>é€†å‘çš„å…³é”®æ˜¯åœ¨ SO
æ–‡ä»¶ä¸­<strong>æ‰¾åˆ°é‚£ä¸ªå·¨å¤§çš„é™æ€æ•°ç»„ï¼ˆæ˜ å°„è¡¨ï¼‰</strong>ã€‚</p></li>
<li><p>å®šä½ä¸€ä¸ªç´§å‡‘çš„å¾ªç¯ï¼Œè¯¥å¾ªç¯ä½“å†…éƒ¨åŒ…å«äº†å¤æ‚çš„åç§»é‡è®¡ç®—å’ŒæŸ¥è¡¨æ“ä½œã€‚</p></li>
</ul>
<h3 id="é…·ç‹—éŸ³ä¹-.kgm-.vpr">é…·ç‹—éŸ³ä¹ (<code>.kgm</code>,
<code>.vpr</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.kgm</code> (Kugou Music),
<code>.vpr</code>ã€‚</p></li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>:
åŒæ ·æ˜¯<strong>è‡ªå®šä¹‰çš„ç½®ä¹±ç®—æ³•</strong>ï¼Œä¸ QQ
éŸ³ä¹æ€è·¯ç›¸ä¼¼ï¼Œä½†å®ç°ä¸åŒã€‚</p></li>
<li><p>ä¾èµ–å¤šä¸ªé™æ€è¡¨ï¼ˆé€šå¸¸åœ¨å¼€æºé¡¹ç›®ä¸­è¢«ç§°ä¸º <code>table1</code>,
<code>table2</code>ï¼‰ã€‚</p></li>
<li><p>æ–‡ä»¶å¤´åŒ…å«äº†è§£å¯†æ‰€éœ€çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚å¯†é’¥é•¿åº¦ç­‰ã€‚è§£å¯†å¯†é’¥ç”±æ–‡ä»¶å¤´ä¿¡æ¯å’Œé™æ€è¡¨å…±åŒæ´¾ç”Ÿã€‚</p></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p></li>
<li><p>åˆ†ææ–‡ä»¶å¤´çš„è§£æé€»è¾‘ã€‚</p></li>
<li><p>å®šä½å¤šä¸ªé™æ€è¡¨ï¼Œå¹¶è¿˜åŸå…¶æŸ¥è¡¨å’Œå¯†é’¥ç”Ÿæˆçš„ç®—æ³•ã€‚</p></li>
</ul>
<h3 id="é…·æˆ‘éŸ³ä¹-.kwm">é…·æˆ‘éŸ³ä¹ (<code>.kwm</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.kwm</code> (Kuwo
Music)ã€‚</p></li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>: é‡‡ç”¨ç›¸å¯¹ç®€å•çš„ <strong>XOR
å¼‚æˆ–åŠ å¯†</strong>ã€‚</p></li>
<li><p>è§£å¯†å¯†é’¥ç”±ä¸€ä¸ª<strong>ç¡¬ç¼–ç åœ¨ SO ä¸­çš„é™æ€å¯†é’¥ (Base
Key)</strong> ä¸è¯¥æ­Œæ›²çš„<strong>èµ„æº ID (<code>rid</code>)</strong>
è¿›è¡Œè¿ç®—åå¾—å‡ºã€‚<code>rid</code> æ˜¯ä¸€ä¸ª uin64_t ç±»å‹çš„æ•°å­—ã€‚</p></li>
<li><p>å¾—åˆ°æœ€ç»ˆå¯†é’¥åï¼Œå¯¹åŠ å¯†çš„éŸ³é¢‘æ•°æ®è¿›è¡Œé€å­—èŠ‚å¼‚æˆ–å³å¯å®Œæˆè§£å¯†ã€‚</p></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p></li>
<li><p>æœç´¢å…³é”®è¯ <code>rid</code>, <code>kwm</code>ã€‚</p></li>
<li><p>å®šä½ä¸€ä¸ªé€»è¾‘ç›¸å¯¹ç®€å•çš„å‡½æ•°ï¼Œå…¶åŒ…å«äº†è·å–
<code>rid</code>ã€ä¸é™æ€å¯†é’¥è¿›è¡Œè¿ç®—ã€ç„¶åå¾ªç¯å¼‚æˆ–çš„è¿‡ç¨‹ã€‚</p></li>
</ul>
<h2 id="æ€»ç»“-1">æ€»ç»“</h2>
<p>è¿™ä¸ªæ¡ˆä¾‹å±•ç¤ºäº†ä»å®¢æˆ·ç«¯åŠŸèƒ½ç»•è¿‡ï¼Œåˆ°ç½‘ç»œåè®®åˆ†æï¼Œå†åˆ°æ ¸å¿ƒåŠ å¯†ç®—æ³•é€†å‘çš„å®Œæ•´æµç¨‹ã€‚å®ƒç»“åˆäº†
Java å±‚çš„ Hook å’Œ Native
å±‚çš„åˆ†æï¼Œæ˜¯ç§»åŠ¨ç«¯é€†å‘ä¸­éå¸¸å…·æœ‰ä»£è¡¨æ€§çš„åœºæ™¯ã€‚</p>
<!-- 03-Case-Studies/case_social_media_and_anti_bot.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶ç¤¾äº¤åª’ä½“-app-ä¸é£æ§">æ¡ˆä¾‹ç ”ç©¶ï¼šç¤¾äº¤åª’ä½“ App ä¸é£æ§</h1>
<p>ç¤¾äº¤åª’ä½“ Appï¼ˆå¦‚
Xã€Instagramã€TikTokï¼‰æ˜¯çˆ¬è™«å’Œè‡ªåŠ¨åŒ–å·¥å…·æœ€å¸¸å…‰é¡¾çš„åœ°æ–¹ã€‚å› æ­¤ï¼Œè¿™äº› App
çš„å¼€å‘è€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½éƒ¨ç½²äº†æå…¶å¤æ‚çš„å®‰å…¨ä¸é£æ§ç³»ç»Ÿï¼Œä»¥ä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œå¹³å°ç”Ÿæ€ã€‚æœ¬æ¡ˆä¾‹å°†èšç„¦äºè¿™äº›
App ä¸­å¸¸è§çš„é£æ§å¯¹æŠ—æŠ€æœ¯ã€‚ ___ ## æ ¸å¿ƒåˆ†æç›®æ ‡</p>
<ol type="1">
<li><strong>API ç­¾åç®—æ³•é€†å‘</strong>: å‡ ä¹æ‰€æœ‰ç¤¾äº¤ App çš„æ ¸å¿ƒ API
è¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç­¾åå‚æ•°ï¼ˆå¦‚ <code>X-Signature</code>,
<code>X-Gorgon</code>ï¼‰ã€‚è¿™äº›ç­¾åæ˜¯è¯·æ±‚åˆæ³•æ€§çš„è¯æ˜ï¼Œä¹Ÿæ˜¯é€†å‘çš„ä¸»è¦ç›®æ ‡ã€‚</li>
<li><strong>è®¾å¤‡æŒ‡çº¹åˆ†æ</strong>: ç†è§£ App
å¦‚ä½•æ”¶é›†è®¾å¤‡ä¿¡æ¯ï¼ˆç¡¬ä»¶ã€è½¯ä»¶ã€ç½‘ç»œç¯å¢ƒç­‰ï¼‰æ¥ç”Ÿæˆå”¯ä¸€çš„è®¾å¤‡ ID
(<code>device_id</code>)ï¼Œå¹¶ç”¨äºé£æ§å†³ç­–ã€‚</li>
<li><strong>ä¸šåŠ¡é£æ§é€»è¾‘åˆ†æ</strong>: åˆ†æ App
åœ¨å…³é”®ä¸šåŠ¡ç‚¹ï¼ˆå¦‚æ³¨å†Œã€ç™»å½•ã€ç‚¹èµã€è¯„è®ºï¼‰çš„é£æ§ç­–ç•¥ï¼Œä¾‹å¦‚äººæœºéªŒè¯ï¼ˆæ»‘å—éªŒè¯ç ã€ç‚¹å›¾éªŒè¯ç­‰ï¼‰ã€‚
___ ## æ¡ˆä¾‹ï¼šåˆ†æä¸€ä¸ªå…¸å‹ç¤¾äº¤ App çš„ API ç­¾åæµç¨‹</li>
</ol>
<h2 id="ç¬¬-1-æ­¥å®šä½ç­¾åå‚æ•°"># ç¬¬ 1 æ­¥ï¼šå®šä½ç­¾åå‚æ•°</h2>
<ul>
<li>*ç›®æ ‡**: è¯†åˆ«å‡º API è¯·æ±‚ä¸­å“ªä¸ªå‚æ•°æ˜¯ç­¾åã€‚</li>
</ul>
<ol type="1">
<li><strong>ç½‘ç»œæŠ“åŒ…</strong>: ä½¿ç”¨ Charles æˆ– Mitmproxy æ‹¦æˆª App
çš„ç½‘ç»œæµé‡ã€‚åˆ·æ–°é¦–é¡µåŠ¨æ€ï¼ˆtimelineï¼‰çš„è¯·æ±‚æ˜¯æœ€å¥½çš„åˆ†æå¯¹è±¡ï¼Œå› ä¸ºå®ƒé€šå¸¸åŒ…å«äº†æœ€å¤æ‚çš„ç­¾åã€‚</li>
<li><strong>è§‚å¯Ÿè¯·æ±‚</strong>: æŸ¥çœ‹ä¸€ä¸ªå…¸å‹çš„ API è¯·æ±‚ï¼Œä¾‹å¦‚
<code>/api/v2/feed</code>ã€‚ä½ ä¼šæ³¨æ„åˆ°å…¶ URL å‚æ•°æˆ–è¯·æ±‚å¤´ (Headers)
ä¸­å­˜åœ¨ä¸€äº›çœ‹èµ·æ¥åƒå“ˆå¸Œå€¼çš„ã€æ— æ˜æ˜¾è¯­ä¹‰çš„å‚æ•°ã€‚</li>
</ol>
<ul>
<li><p><strong>URL å‚æ•°</strong>:
<code>...&amp;mas=01&amp;as=a1...&amp;ts=166...&amp;ssmix=a...</code></p></li>
<li><p><strong>è¯·æ±‚å¤´</strong>: <code>X-Gorgon: 0404...</code>,
<code>X-Khronos: 166...</code></p></li>
<li><p><strong>URL å‚æ•°</strong>:
<code>...&amp;mas=01&amp;as=a1...&amp;ts=166...&amp;ssmix=a...</code></p></li>
<li><p><strong>è¯·æ±‚å¤´</strong>: <code>X-Gorgon: 0404...</code>,
<code>X-Khronos: 166...</code></p></li>
</ul>
<ol start="3" type="1">
<li><strong>å‚æ•°ç­›é€‰</strong>:
é€šè¿‡å¤šæ¬¡é‡å¤è¯·æ±‚ï¼Œæ¯”è¾ƒå‚æ•°çš„å˜åŒ–è§„å¾‹ã€‚</li>
</ol>
<ul>
<li><p><strong>ä¸å˜çš„</strong>: <code>device_id</code>,
<code>os_version</code> ç­‰ï¼Œé€šå¸¸æ˜¯è®¾å¤‡æŒ‡çº¹çš„ä¸€éƒ¨åˆ†ã€‚</p></li>
<li><p><strong>éšæ—¶é—´å˜åŒ–çš„</strong>: <code>ts</code>,
<code>X-Khronos</code> ç­‰ï¼Œé€šå¸¸æ˜¯æ—¶é—´æˆ³ã€‚</p></li>
<li><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½éšæœºå˜åŒ–çš„</strong>: <code>mas</code>,
<code>as</code>, <code>X-Gorgon</code>
ç­‰ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ ¸å¿ƒç­¾åã€‚</p></li>
<li><p><strong>ä¸å˜çš„</strong>: <code>device_id</code>,
<code>os_version</code> ç­‰ï¼Œé€šå¸¸æ˜¯è®¾å¤‡æŒ‡çº¹çš„ä¸€éƒ¨åˆ†ã€‚</p></li>
<li><p><strong>éšæ—¶é—´å˜åŒ–çš„</strong>: <code>ts</code>,
<code>X-Khronos</code> ç­‰ï¼Œé€šå¸¸æ˜¯æ—¶é—´æˆ³ã€‚</p></li>
<li><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½éšæœºå˜åŒ–çš„</strong>: <code>mas</code>,
<code>as</code>, <code>X-Gorgon</code>
ç­‰ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ ¸å¿ƒç­¾åã€‚</p></li>
</ul>
<h2 id="ç¬¬-2-æ­¥å®šä½ç­¾åç”Ÿæˆä»£ç "># ç¬¬ 2 æ­¥ï¼šå®šä½ç­¾åç”Ÿæˆä»£ç </h2>
<ul>
<li>*ç›®æ ‡**:
æ‰¾åˆ°åœ¨å®¢æˆ·ç«¯ç”Ÿæˆè¿™äº›ç­¾åçš„ä»£ç ã€‚è¿™æ˜¯æ•´ä¸ªæµç¨‹ä¸­æœ€å…³é”®ã€ä¹Ÿæœ€å›°éš¾çš„ä¸€æ­¥ã€‚</li>
</ul>
<ol type="1">
<li><strong>å…¨å±€æœç´¢</strong>: åœ¨ <code>jadx-gui</code>
ä¸­ï¼Œå…¨å±€æœç´¢ä¸Šä¸€æ­¥è¯†åˆ«å‡ºçš„å‚æ•°åï¼Œå¦‚
<code>X-Gorgon</code>ã€‚å¦‚æœè¿æ°”å¥½ï¼Œä½ èƒ½ç›´æ¥å®šä½åˆ°æ„å»ºç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ã€‚</li>
<li><strong>Hookå¤§æ³•</strong>:
å¦‚æœæœç´¢æ— æœï¼ˆé€šå¸¸æ˜¯å› ä¸ºå‚æ•°ååœ¨ä»£ç ä¸­è¢«åŠ å¯†æˆ–æ··æ·†äº†ï¼‰ï¼ŒFrida Hook
å°†æ˜¯ä½ çš„ä¸»åŠ›æ­¦å™¨ã€‚</li>
</ol>
<ul>
<li><strong>Hook ç½‘ç»œåº“</strong>: ä»ç½‘ç»œè¯·æ±‚çš„æºå¤´å…¥æ‰‹ã€‚Hook
<code>OkHttp</code> çš„ <code>Request.Builder.addHeader</code> æˆ–
<code>url()</code> æ–¹æ³•ï¼Œæ‰“å°å‡ºè°ƒç”¨æ ˆã€‚ ```javascript
Java.perform(function() { var Builder = Java.use(â€™okhttp3.Request<span
class="math inline">$Builder');
Builder.addHeader.implementation = function(name, value) {
if (name === 'X-Gorgon') {
// Found it! Print call stack
console.log('Found X-Gorgon being added: ' + value);
console.log(Java.use('android.util.Log').getStackTraceString(Java.use('java.lang.Exception').$</span>new()));
} return this.addHeader(name, value); }; });</li>
</ul>
<pre><code>3. **é™æ€åˆ†æç­¾åå‡½æ•°**: å®šä½åˆ°å…·ä½“çš„ç­¾åå‡½æ•°åï¼ˆä¾‹å¦‚ï¼Œ`SignHelper.getSign(params)`ï¼‰ï¼Œåœ¨ Ghidra æˆ– IDA ä¸­ä»”ç»†åˆ†æå…¶é€»è¾‘ã€‚

* **è¾“å…¥**: å®ƒçš„è¾“å…¥é€šå¸¸æ˜¯ä¸€ä¸ª `Map` æˆ– `List`ï¼ŒåŒ…å«äº†æ‰€æœ‰è¦å‚ä¸ç­¾åçš„ä¸šåŠ¡å‚æ•°ï¼ˆå¦‚ `user_id`ï¼‰å’Œè®¾å¤‡æŒ‡çº¹å‚æ•°ã€‚

* **é€»è¾‘**: å‡½æ•°å†…éƒ¨é€»è¾‘é€šå¸¸æ˜¯ï¼š
1. å¯¹æ‰€æœ‰å‚æ•°æŒ‰ key è¿›è¡Œå­—å…¸åºæ’åºã€‚
2. å°†æ’åºåçš„ key-value å¯¹æ‹¼æ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ã€‚
3. å°†å›ºå®šçš„ç›ï¼ˆsaltï¼Œå¯èƒ½ç¡¬ç¼–ç æˆ–ä» Native è·å–ï¼‰æ‹¼æ¥åˆ°å­—ç¬¦ä¸²çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚
4. å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œã€‚
5. æœ‰æ—¶è¿˜ä¼šè¿›è¡Œé¢å¤–çš„å˜æ¢ï¼Œå¦‚ Base64 ç¼–ç æˆ–è‡ªå®šä¹‰çš„å­—èŠ‚æ“ä½œã€‚

* **Native æ··æ·†**: è¶Šæ¥è¶Šå¤šçš„ App å°†æ ¸å¿ƒçš„ç­¾åç®—æ³•ï¼ˆç‰¹åˆ«æ˜¯ç›ï¼‰æ”¾åˆ° `.so` æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ OLLVM æˆ– VMP ç­‰æŠ€æœ¯è¿›è¡Œæ··æ·†ï¼Œä»¥å¯¹æŠ—é™æ€åˆ†æã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ç»“åˆåŠ¨æ€è°ƒè¯•æ¥ä¸€æ­¥æ­¥è·Ÿè¸ªå…¶æ‰§è¡Œæµç¨‹ã€‚


* **è¾“å…¥**: å®ƒçš„è¾“å…¥é€šå¸¸æ˜¯ä¸€ä¸ª `Map` æˆ– `List`ï¼ŒåŒ…å«äº†æ‰€æœ‰è¦å‚ä¸ç­¾åçš„ä¸šåŠ¡å‚æ•°ï¼ˆå¦‚ `user_id`ï¼‰å’Œè®¾å¤‡æŒ‡çº¹å‚æ•°ã€‚


* **é€»è¾‘**: å‡½æ•°å†…éƒ¨é€»è¾‘é€šå¸¸æ˜¯ï¼š
1. å¯¹æ‰€æœ‰å‚æ•°æŒ‰ key è¿›è¡Œå­—å…¸åºæ’åºã€‚
2. å°†æ’åºåçš„ key-value å¯¹æ‹¼æ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ã€‚
3. å°†å›ºå®šçš„ç›ï¼ˆsaltï¼Œå¯èƒ½ç¡¬ç¼–ç æˆ–ä» Native è·å–ï¼‰æ‹¼æ¥åˆ°å­—ç¬¦ä¸²çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚
4. å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œã€‚
5. æœ‰æ—¶è¿˜ä¼šè¿›è¡Œé¢å¤–çš„å˜æ¢ï¼Œå¦‚ Base64 ç¼–ç æˆ–è‡ªå®šä¹‰çš„å­—èŠ‚æ“ä½œã€‚

1. å¯¹æ‰€æœ‰å‚æ•°æŒ‰ key è¿›è¡Œå­—å…¸åºæ’åºã€‚
2. å°†æ’åºåçš„ key-value å¯¹æ‹¼æ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ã€‚
3. å°†å›ºå®šçš„ç›ï¼ˆsaltï¼Œå¯èƒ½ç¡¬ç¼–ç æˆ–ä» Native è·å–ï¼‰æ‹¼æ¥åˆ°å­—ç¬¦ä¸²çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚
4. å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œã€‚
5. æœ‰æ—¶è¿˜ä¼šè¿›è¡Œé¢å¤–çš„å˜æ¢ï¼Œå¦‚ Base64 ç¼–ç æˆ–è‡ªå®šä¹‰çš„å­—èŠ‚æ“ä½œã€‚


* **Native æ··æ·†**: è¶Šæ¥è¶Šå¤šçš„ App å°†æ ¸å¿ƒçš„ç­¾åç®—æ³•ï¼ˆç‰¹åˆ«æ˜¯ç›ï¼‰æ”¾åˆ° `.so` æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ OLLVM æˆ– VMP ç­‰æŠ€æœ¯è¿›è¡Œæ··æ·†ï¼Œä»¥å¯¹æŠ—é™æ€åˆ†æã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ç»“åˆåŠ¨æ€è°ƒè¯•æ¥ä¸€æ­¥æ­¥è·Ÿè¸ªå…¶æ‰§è¡Œæµç¨‹ã€‚


## # ç¬¬ 3 æ­¥ï¼šæ¨¡æ‹Ÿç­¾åä¸è‡ªåŠ¨åŒ–

* *ç›®æ ‡**: åœ¨ä½ è‡ªå·±çš„ Python æˆ–å…¶ä»–è¯­è¨€è„šæœ¬ä¸­ï¼Œé‡æ–°å®ç°ç­¾åç®—æ³•ï¼Œä»è€Œå¯ä»¥è„±ç¦» App ç‹¬ç«‹å‘èµ·åˆæ³•çš„ API è¯·æ±‚ã€‚

1. **ä»£ç å¤ç°**: æ ¹æ®é™æ€åˆ†æçš„ç»“æœï¼Œç”¨ Python å®Œæ•´åœ°å¤ç°æ•´ä¸ªç­¾åæµç¨‹ã€‚æ¯ä¸€ä¸ªç»†èŠ‚éƒ½è¦ç²¾ç¡®åŒ¹é…ï¼ŒåŒ…æ‹¬å‚æ•°çš„æ’åºã€æ‹¼æ¥æ–¹å¼ã€å“ˆå¸Œç®—æ³•ç­‰ã€‚
2. **è·å–è®¾å¤‡å‚æ•°**: ç­¾åä¾èµ–çš„è®¾å¤‡æŒ‡çº¹å‚æ•°ï¼ˆ`device_id`, `install_id` ç­‰ï¼‰é€šå¸¸åœ¨ App é¦–æ¬¡å¯åŠ¨æ—¶ç”Ÿæˆå¹¶å­˜å‚¨åœ¨æœ¬åœ°ã€‚ä½ éœ€è¦ Hook ç›¸å…³çš„å‡½æ•°æ¥è·å–ä¸€å¥—åˆæ³•çš„è®¾å¤‡å‚æ•°ï¼Œå¹¶åœ¨ä½ çš„è„šæœ¬ä¸­ä½¿ç”¨å®ƒä»¬ã€‚
3. **é£æ§å¯¹æŠ—**:
* **æ»‘å—éªŒè¯ç **: å½“æœåŠ¡å™¨æ£€æµ‹åˆ°ä½ çš„è¯·æ±‚å¼‚å¸¸æ—¶ï¼ˆä¾‹å¦‚ï¼ŒIP åœ°å€å¼‚å¸¸ã€è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªéœ€è¦è¿›è¡ŒäººæœºéªŒè¯çš„å“åº”ã€‚ä½ éœ€è¦åˆ†æéªŒè¯ç çš„é€»è¾‘ï¼Œè¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹ä¸€ä¸ª `JavaScript` æ–‡ä»¶çš„é€†å‘ï¼Œåˆ†æå…¶æ»‘å—è½¨è¿¹åŠ å¯†ç®—æ³•ã€‚

* **è¯·æ±‚é¢‘ç‡**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„è¡Œä¸ºï¼Œåœ¨è¯·æ±‚ä¹‹é—´åŠ å…¥éšæœºçš„å»¶è¿Ÿã€‚

* **ä»£ç† IP**: ä½¿ç”¨é«˜è´¨é‡çš„ä»£ç† IP æ± æ¥é¿å…å•ä¸ª IP è¢«å°ç¦ã€‚

* **æ»‘å—éªŒè¯ç **: å½“æœåŠ¡å™¨æ£€æµ‹åˆ°ä½ çš„è¯·æ±‚å¼‚å¸¸æ—¶ï¼ˆä¾‹å¦‚ï¼ŒIP åœ°å€å¼‚å¸¸ã€è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªéœ€è¦è¿›è¡ŒäººæœºéªŒè¯çš„å“åº”ã€‚ä½ éœ€è¦åˆ†æéªŒè¯ç çš„é€»è¾‘ï¼Œè¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹ä¸€ä¸ª `JavaScript` æ–‡ä»¶çš„é€†å‘ï¼Œåˆ†æå…¶æ»‘å—è½¨è¿¹åŠ å¯†ç®—æ³•ã€‚


* **è¯·æ±‚é¢‘ç‡**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„è¡Œä¸ºï¼Œåœ¨è¯·æ±‚ä¹‹é—´åŠ å…¥éšæœºçš„å»¶è¿Ÿã€‚


* **ä»£ç† IP**: ä½¿ç”¨é«˜è´¨é‡çš„ä»£ç† IP æ± æ¥é¿å…å•ä¸ª IP è¢«å°ç¦ã€‚
___
## æ€»ç»“

ç¤¾äº¤åª’ä½“ App çš„é€†å‘æ˜¯å…¸å‹çš„&quot;æ•°æ®åœ¨å®¢æˆ·ç«¯ï¼Œä½†ç”±æœåŠ¡å™¨è§„åˆ™æ ¡éªŒ&quot;çš„åœºæ™¯ã€‚å…¶æ ¸å¿ƒæ˜¯å¯¹æŠ—ï¼Œè€Œä¸åªæ˜¯è§£å¯†ã€‚

* **ç­¾åæ˜¯æ ¸å¿ƒ**: é€†å‘ç­¾åç®—æ³•æ˜¯æ‰€æœ‰å·¥ä½œçš„åŸºç¡€ã€‚


* **åŠ¨é™ç»“åˆ**: éœ€è¦åå¤åœ¨é™æ€åˆ†æï¼ˆGhidra/IDAï¼‰å’ŒåŠ¨æ€éªŒè¯ï¼ˆFridaï¼‰ä¹‹é—´åˆ‡æ¢ã€‚


* **é£æ§æ˜¯æŒç»­çš„æ–—äº‰**: å³ä½¿ä½ æˆåŠŸé€†å‘äº†ç­¾åï¼ŒæœåŠ¡å™¨ç«¯çš„é£æ§ç­–ç•¥ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚è¿™æ˜¯ä¸€ä¸ªé•¿æœŸçš„ã€åŠ¨æ€çš„æ”»é˜²è¿‡ç¨‹ã€‚ </code></pre>
<!-- 03-Case-Studies/case_study_app_encryption.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶ä¸»æµ-app-çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ">æ¡ˆä¾‹ç ”ç©¶ï¼šä¸»æµ App
çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ</h1>
<p>å¯¹ä¸»æµ App çš„ API
åŠ å¯†æœºåˆ¶è¿›è¡Œé€†å‘åˆ†æï¼Œæ˜¯æ£€éªŒå’Œåº”ç”¨é€†å‘å·¥ç¨‹ç»¼åˆèƒ½åŠ›çš„æœ€ä½³å®æˆ˜ã€‚æœ¬æ¡ˆä¾‹ç ”ç©¶å°†ä»¥å¸¸è§çš„ç”µå•†å’Œç¤¾äº¤ç±»
App
ä¸ºä¾‹ï¼Œå‰–æå…¶ç½‘ç»œè¯·æ±‚ä¸­æ ¸å¿ƒåŠ å¯†å­—æ®µå’Œç­¾åçš„ç”Ÿæˆé€»è¾‘ï¼Œå±•ç¤ºç†è®ºçŸ¥è¯†åœ¨å®æˆ˜ä¸­çš„åº”ç”¨ã€‚</p>
<blockquote>
<p><strong>å…è´£å£°æ˜</strong>:
æœ¬æ–‡å†…å®¹åŸºäºå…¬å¼€æŠ€æœ¯å’Œè¿‡å¾€åˆ†æç»éªŒçš„æ€»ç»“ï¼Œæ—¨åœ¨æŠ€æœ¯äº¤æµä¸å­¦ä¹ ã€‚å…·ä½“çš„åŠ å¯†å®ç°ä¼šé¢‘ç¹æ›´æ–°ï¼Œæœ¬æ–‡ä¸ä¿è¯ä¸çº¿ä¸Šæœ€æ–°ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚
___ ## ç›®å½• - <a
href="#æ¡ˆä¾‹ç ”ç©¶ä¸»æµ-app-çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ">æ¡ˆä¾‹ç ”ç©¶ï¼šä¸»æµ App
çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ</a> - <a href="#ç›®å½•">ç›®å½•</a></p>
</blockquote>
<ul>
<li><p><a href="#é€šç”¨åŠ å¯†ä¸ç­¾åæ¨¡å¼">é€šç”¨åŠ å¯†ä¸ç­¾åæ¨¡å¼</a></p></li>
<li><p><a href="#æ¡ˆä¾‹åˆ†æ-1ç”µå•†-app-ç±»æ‹¼å¤šå¤šæ¨¡å¼">æ¡ˆä¾‹åˆ†æ 1ï¼šç”µå•† App
(ç±»æ‹¼å¤šå¤šæ¨¡å¼)</a></p></li>
<li><p><a href="#æ ¸å¿ƒé£æ§å­—æ®µ-anti_content">æ ¸å¿ƒé£æ§å­—æ®µ
(<code>anti_content</code>)</a></p></li>
<li><p><a href="#api-è®¤è¯ç­¾å-sign">API è®¤è¯ç­¾å
(<code>sign</code>)</a></p></li>
<li><p><a href="#æ¡ˆä¾‹åˆ†æ-2ç¤¾äº¤-app-ç±»å°çº¢ä¹¦æ¨¡å¼">æ¡ˆä¾‹åˆ†æ 2ï¼šç¤¾äº¤ App
(ç±»å°çº¢ä¹¦æ¨¡å¼)</a></p></li>
<li><p><a href="#å¤æ‚çš„è¯·æ±‚å¤´ç­¾å-x-sign">å¤æ‚çš„è¯·æ±‚å¤´ç­¾å
(<code>X-Sign</code>)</a></p></li>
<li><p><a href="#è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥-x-deviceinfo">è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥
(<code>X-DeviceInfo</code>)</a></p></li>
<li><p><a href="#æ¡ˆä¾‹åˆ†æ-3å­—èŠ‚è·³åŠ¨ç³»-æŠ–éŸ³tiktok">æ¡ˆä¾‹åˆ†æ 3ï¼šå­—èŠ‚è·³åŠ¨ç³»
(æŠ–éŸ³/TikTok)</a></p></li>
<li><p><a href="#æ¡ˆä¾‹åˆ†æ-4å¿«æ‰‹">æ¡ˆä¾‹åˆ†æ 4ï¼šå¿«æ‰‹</a></p></li>
<li><p><a href="#æ¡ˆä¾‹åˆ†æ-5ç¾å›¢">æ¡ˆä¾‹åˆ†æ 5ï¼šç¾å›¢</a></p></li>
<li><p><a href="#æ¡ˆä¾‹åˆ†æ-6é˜¿é‡Œç³»-æ·˜å®æ”¯ä»˜å®">æ¡ˆä¾‹åˆ†æ 6ï¼šé˜¿é‡Œç³»
(æ·˜å®ã€æ”¯ä»˜å®)</a></p></li>
<li><p><a href="#é€†å‘åˆ†æé€šç”¨ç­–ç•¥">é€†å‘åˆ†æé€šç”¨ç­–ç•¥</a></p></li>
<li><p><a href="#é«˜çº§ç­–ç•¥é»‘ç›’-rpc-è°ƒç”¨è¯¦è§£">é«˜çº§ç­–ç•¥ï¼šé»‘ç›’ RPC
è°ƒç”¨è¯¦è§£</a></p></li>
<li><p><a href="#ä»€ä¹ˆæ˜¯é»‘ç›’-rpc-è°ƒç”¨">ä»€ä¹ˆæ˜¯é»‘ç›’ RPC è°ƒç”¨ï¼Ÿ</a></p></li>
<li><p><a href="#å®ç°é»‘ç›’-rpc-çš„æ ¸å¿ƒæ­¥éª¤">å®ç°é»‘ç›’ RPC
çš„æ ¸å¿ƒæ­¥éª¤</a></p></li>
<li><p><a
href="#ç¬¬ä¸€æ­¥å®šä½ç›®æ ‡å‡½æ•°åœ°å€-finding-the-function-pointer">ç¬¬ä¸€æ­¥ï¼šå®šä½ç›®æ ‡å‡½æ•°åœ°å€
(Finding the Function Pointer)</a></p></li>
<li><p><a
href="#ç¬¬äºŒæ­¥åˆ†æå‡½æ•°åŸå‹-analyzing-the-prototype">ç¬¬äºŒæ­¥ï¼šåˆ†æå‡½æ•°åŸå‹
(Analyzing the Prototype)</a></p></li>
<li><p><a href="#ç¬¬ä¸‰æ­¥æ„å»º-rpc-æœåŠ¡ç«¯-frida-agent">ç¬¬ä¸‰æ­¥ï¼šæ„å»º RPC
æœåŠ¡ç«¯ (Frida Agent)</a></p></li>
<li><p><a href="#ç¬¬å››æ­¥ç¼–å†™-rpc-å®¢æˆ·ç«¯-python">ç¬¬å››æ­¥ï¼šç¼–å†™ RPC å®¢æˆ·ç«¯
(Python)</a></p></li>
<li><p><a href="#æŒ‘æˆ˜ä¸æ€»ç»“">æŒ‘æˆ˜ä¸æ€»ç»“</a> ___ ##
é€šç”¨åŠ å¯†ä¸ç­¾åæ¨¡å¼</p></li>
</ul>
<p>åœ¨åˆ†æå…·ä½“æ¡ˆä¾‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ç§è¡Œä¸šå†…é€šç”¨çš„ API ä¿æŠ¤æ¨¡å¼ï¼š</p>
<ul>
<li><p><strong>è¯·æ±‚ä½“åŠ å¯†</strong>ï¼šå¯¹æ•´ä¸ª POST Body
è¿›è¡Œå¯¹ç§°ï¼ˆAESï¼‰æˆ–éå¯¹ç§°ï¼ˆRSAï¼‰åŠ å¯†ï¼Œä¿æŠ¤æ•°æ®å†…å®¹éšç§ã€‚</p></li>
<li><p><strong>å‚æ•°çº§åŠ å¯†</strong>ï¼šä»…å¯¹è¯·æ±‚ä¸­çš„ä¸ªåˆ«æ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç ã€æ‰‹æœºå·ï¼‰è¿›è¡ŒåŠ å¯†ã€‚</p></li>
<li><p><strong><code>sign</code>
ç­¾åæœºåˆ¶</strong>ï¼š<strong>æœ€æ ¸å¿ƒã€æœ€æ™®éçš„æ¨¡å¼</strong>ã€‚é€šè¿‡å¯¹è¯·æ±‚å‚æ•°ã€æ—¶é—´æˆ³ã€éšæœºæ•°ç­‰è¿›è¡Œç»„åˆå’Œå“ˆå¸Œï¼Œç”Ÿæˆä¸€ä¸ªç­¾åå€¼ã€‚æœåŠ¡å™¨ç«¯ä¼šä»¥åŒæ ·çš„æ–¹å¼è®¡ç®—ç­¾åå¹¶è¿›è¡Œæ¯”å¯¹ï¼Œç”¨äºï¼š</p></li>
<li><p><strong>é˜²ç¯¡æ”¹</strong>ï¼šç¡®ä¿ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®æœªè¢«ä¿®æ”¹ã€‚</p></li>
<li><p><strong>é˜²é‡æ”¾</strong>ï¼šé€šè¿‡åŠ å…¥æ—¶é—´æˆ³æˆ–
Nonceï¼Œè®©ç­¾åä¸€æ¬¡æœ‰æ•ˆã€‚</p></li>
<li><p><strong>èº«ä»½è®¤è¯</strong>ï¼šéªŒè¯è¯·æ±‚æ˜¯å¦ç”±åˆæ³•çš„å®¢æˆ·ç«¯å‘å‡ºã€‚</p></li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-1ç”µå•†-app-ç±»æ‹¼å¤šå¤šæ¨¡å¼">æ¡ˆä¾‹åˆ†æ 1ï¼šç”µå•† App
(ç±»æ‹¼å¤šå¤šæ¨¡å¼)</h2>
<h2 id="æ ¸å¿ƒé£æ§å­—æ®µ-anti_content"># æ ¸å¿ƒé£æ§å­—æ®µ
(<code>anti_content</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: åœ¨å…¶ API è¯·æ±‚ä¸­ï¼Œç»å¸¸èƒ½çœ‹åˆ°ä¸€ä¸ªåä¸º
<code>anti_content</code> çš„ã€å†…å®¹æé•¿çš„åŠ å¯†å­—æ®µã€‚</p></li>
<li><p><strong>æœ¬è´¨</strong>: å®ƒå¹¶éç®€å•çš„ API
å‚æ•°ç­¾åï¼Œè€Œæ˜¯ä¸€ä¸ªç”±å®¢æˆ·ç«¯ SDK
ç”Ÿæˆçš„ã€é«˜åº¦å¤æ‚çš„<strong>é£æ§æ•°æ®åŒ…</strong>ã€‚å®ƒæ›´ä¾§é‡äº<strong>è¯†åˆ«â€äººâ€ä¸â€æœºå™¨â€</strong>ï¼Œè€Œéè®¤è¯
API è°ƒç”¨æœ¬èº«ã€‚</p></li>
<li><p><strong>å¯èƒ½åŒ…å«çš„å†…å®¹</strong>:</p></li>
<li><p><strong>è®¾å¤‡æŒ‡çº¹</strong>:
åŒ…å«ä¹‹å‰æ–‡æ¡£ä¸­æåˆ°çš„å‡ ä¹æ‰€æœ‰ç¡¬ä»¶ã€è½¯ä»¶å’Œç³»ç»Ÿç‰¹å¾ã€‚</p></li>
<li><p><strong>ç¯å¢ƒæ£€æµ‹</strong>: æ˜¯å¦ Rootã€æ˜¯å¦è¶Šç‹±ã€æ˜¯å¦ä½¿ç”¨äº† Hook
æ¡†æ¶ (Frida/Xposed)ã€æ˜¯å¦åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œã€‚</p></li>
<li><p><strong>ä¼ æ„Ÿå™¨æ•°æ®</strong>:
åœ¨ç‰¹å®šæ—¶é—´æ®µå†…é‡‡é›†çš„åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªæ•°æ®ï¼Œç”¨äºåˆ¤æ–­è®¾å¤‡æ˜¯å¦åœ¨æ­£å¸¸ç‰©ç†çŠ¶æ€ä¸‹ã€‚</p></li>
<li><p><strong>è¡Œä¸ºæ•°æ®</strong>ï¼šç”¨æˆ·çš„ç‚¹å‡»åæ ‡ã€æ»‘åŠ¨è½¨è¿¹ç­‰ã€‚</p></li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>: <code>anti_content</code>
çš„ç”Ÿæˆé€»è¾‘é€šå¸¸è¢«å°è£…åœ¨é«˜åº¦æ··æ·†çš„åŸç”Ÿ SO åº“ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å«
<code>SVC</code>
ç³»ç»Ÿè°ƒç”¨ç­‰ååˆ†ææŠ€æœ¯ã€‚å®Œæ•´å¤ç°å…¶ç®—æ³•çš„éš¾åº¦æé«˜ã€‚</p></li>
</ul>
<h2 id="api-è®¤è¯ç­¾å-sign"># API è®¤è¯ç­¾å (<code>sign</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: é™¤äº†
<code>anti_content</code>ï¼Œè¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„
<code>sign</code> å­—æ®µã€‚</p></li>
<li><p><strong>ç›®çš„</strong>: è¿™ä¸ªå­—æ®µæ‰æ˜¯çœŸæ­£ç”¨äº API
çº§åˆ«è®¤è¯çš„ç­¾åã€‚</p></li>
<li><p><strong>å…¸å‹ç”Ÿæˆé€»è¾‘</strong>:</p></li>
</ul>
<ol type="1">
<li>æ”¶é›†æ‰€æœ‰è¯·æ±‚å‚æ•°ï¼ˆGET Query Params å’Œ POST Form Body Paramsï¼‰ã€‚</li>
<li>å‰”é™¤ <code>sign</code> å­—æ®µæœ¬èº«ã€‚</li>
<li>æŒ‰å‚æ•°åçš„ ASCII å­—æ¯é¡ºåºè¿›è¡Œæ’åºã€‚</li>
<li>å°†æ’åºåçš„å‚æ•°æ‹¼æ¥æˆ <code>key=value&amp;...</code>
çš„å­—ç¬¦ä¸²ï¼ˆç©ºå€¼å‚æ•°å¯èƒ½ä¸å‚ä¸æ‹¼æ¥ï¼‰ã€‚</li>
<li>åœ¨æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²<strong>å‰å</strong>æˆ–<strong>ä¸­é—´</strong>æ’å…¥ä¸€ä¸ªå›ºå®šçš„å¯†é’¥ï¼ˆApp
Secret / Saltï¼‰ï¼Œè¿™ä¸ªå¯†é’¥é€šå¸¸ç¡¬ç¼–ç åœ¨ SO æ–‡ä»¶ä¸­ã€‚</li>
<li>å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œï¼Œå¾—åˆ°ç­¾åå€¼ã€‚</li>
</ol>
<h2 id="æ¡ˆä¾‹åˆ†æ-2ç¤¾äº¤-app-ç±»å°çº¢ä¹¦æ¨¡å¼">æ¡ˆä¾‹åˆ†æ 2ï¼šç¤¾äº¤ App
(ç±»å°çº¢ä¹¦æ¨¡å¼)</h2>
<h2 id="å¤æ‚çš„è¯·æ±‚å¤´ç­¾å-x-sign"># å¤æ‚çš„è¯·æ±‚å¤´ç­¾å
(<code>X-Sign</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: è®¤è¯ä¿¡æ¯ä¸æ”¾åœ¨ URL å‚æ•°ä¸­ï¼Œè€Œæ˜¯ä½äº HTTP
è¯·æ±‚å¤´ï¼Œå¦‚ <code>X-Sign</code>, <code>X-T</code> (æ—¶é—´æˆ³),
<code>X-B3-TraceId</code> ç­‰ã€‚</p></li>
<li><p><strong><code>X-Sign</code> çš„æ„æˆ</strong>:</p></li>
<li><p><strong>æ ¼å¼</strong>: é€šå¸¸æ˜¯ <code>MD5(some_string)</code>
çš„å½¢å¼ã€‚</p></li>
<li><p><strong><code>some_string</code> çš„æ‹¼æ¥æ–¹å¼</strong>:
<code>URL Path + Sorted Query Params + (POST Body Hash) + Token/Salt</code>ã€‚</p></li>
<li><p>è¿™æ„å‘³ç€ï¼Œä¸ä»… URL å‚æ•°ï¼Œè¿ POST
çš„å†…å®¹ä¹Ÿå‚ä¸äº†ç­¾åè®¡ç®—ã€‚</p></li>
<li><p>æœ‰æ—¶è¿˜ä¼šåŒ…å«å…¶ä»–è¯·æ±‚å¤´çš„å€¼ã€‚</p></li>
<li><p><strong>åŠ¨æ€ Salt</strong>:
å…¶ç­¾åç”¨çš„å¯†é’¥å¯èƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯éƒ¨åˆ†ç”±æœåŠ¡å™¨ä¸‹å‘ï¼Œæˆ–ä¸æ—¶é—´æˆ³ã€è®¾å¤‡ä¿¡æ¯åŠ¨æ€ç”Ÿæˆï¼Œè¿™ä½¿å¾—æš´åŠ›ç ´è§£å’Œç®€å•æ¨¡æ‹Ÿè¯·æ±‚å˜å¾—éå¸¸å›°éš¾ã€‚</p></li>
</ul>
<h2 id="è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥-x-deviceinfo"># è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥
(<code>X-DeviceInfo</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: æœ‰ä¸€ä¸ªä¸“é—¨çš„è¯·æ±‚å¤´ï¼Œå¦‚
<code>X-DeviceInfo</code>ï¼Œå…¶å†…å®¹æ˜¯åŠ å¯†æˆ– Base64 ç¼–ç åçš„ JSON
å­—ç¬¦ä¸²ï¼Œé‡Œé¢æ˜¯è¯¦ç»†çš„è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ã€‚</p></li>
<li><p><strong>å…³è”æ€§</strong>: æœåŠ¡ç«¯çš„é£æ§ç³»ç»Ÿä¼šå°† <code>X-Sign</code>
å’Œ <code>X-DeviceInfo</code> è¿›è¡Œå¼ºå…³è”æ ¡éªŒã€‚</p></li>
<li><p>é¦–å…ˆéªŒè¯ <code>X-Sign</code> æ˜¯å¦åˆæ³•ã€‚</p></li>
<li><p>ç„¶åè§£ç  <code>X-DeviceInfo</code>ï¼Œåˆ†æè®¾å¤‡æ˜¯å¦å¯ä¿¡ã€‚</p></li>
<li><p>æœ€åï¼Œå¯èƒ½ä¼šäº¤å‰éªŒè¯ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªç‰ˆæœ¬çš„ App
æ˜¯å¦å¯èƒ½è¿è¡Œåœ¨æŸä¸ªç‰¹å®šçš„ Android SDK
ç‰ˆæœ¬ä¸Šï¼Œå¦‚æœä¸åŒ¹é…ï¼Œåˆ™åˆ¤å®šä¸ºå¼‚å¸¸ã€‚</p></li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-3å­—èŠ‚è·³åŠ¨ç³»-æŠ–éŸ³tiktok">æ¡ˆä¾‹åˆ†æ 3ï¼šå­—èŠ‚è·³åŠ¨ç³»
(æŠ–éŸ³/TikTok)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: å…¶ API
è¯·æ±‚ä¸­åŒ…å«å¤šä¸ªå¤æ‚çš„è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œå¦‚ <code>X-Gorgon</code>,
<code>X-Khronos</code>, <code>X-Argus</code>,
<code>X-Ladon</code>ã€‚è¯·æ±‚ä½“é€šå¸¸æ˜¯ç»è¿‡ Protobuf
åºåˆ—åŒ–åå†åŠ å¯†çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p></li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p></li>
<li><p><strong>è®¾å¤‡æ³¨å†Œ</strong>: App é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè¿›è¡Œè®¾å¤‡æ³¨å†Œ
(<code>/service/2/device_register/</code>)ï¼Œè·å–æœåŠ¡å™¨ä¸‹å‘çš„
<code>device_id</code> å’Œ <code>install_id</code>ã€‚è¿™ä¸¤ä¸ª ID
æ˜¯åç»­æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚çš„èº«ä»½åŸºç¡€ã€‚</p></li>
<li><p><strong>å¤šé‡ç­¾åç³»ç»Ÿ</strong>: <code>X-Gorgon</code> æ˜¯æœ€æ ¸å¿ƒçš„
API è¯·æ±‚ç­¾åï¼Œå®ƒå°† URLã€Cookieã€POST Body
çš„å“ˆå¸Œã€è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ç­‰å¤šç§å› ç´ æ··åˆè®¡ç®—è€Œæˆã€‚<code>X-Khronos</code>
æ˜¯åŠ å¯†è¿‡çš„æ—¶é—´æˆ³ã€‚è¿™å¥—ä½“ç³»ç¡®ä¿äº†è¯·æ±‚çš„æ¥æºã€æ—¶æ•ˆå’Œå®Œæ•´æ€§éƒ½å¯è¢«éªŒè¯ã€‚</p></li>
<li><p><strong>Protobuf åºåˆ—åŒ–</strong>: å¤§é‡ä½¿ç”¨ Protobuf
è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œç›¸æ¯”
JSONï¼Œå®ƒæ›´é«˜æ•ˆï¼Œä½†ä¹Ÿå¢åŠ äº†é€†å‘éš¾åº¦ï¼Œå› ä¸ºåˆ†æè€…éœ€è¦å…ˆæ‰¾åˆ°æˆ–è¿˜åŸ
<code>.proto</code> æ–‡ä»¶æ‰èƒ½ç†è§£æ•°æ®ç»“æ„ã€‚</p></li>
<li><p><strong>Cronet ç½‘ç»œåº“</strong>: ä½¿ç”¨ Google çš„ Cronet
ç½‘ç»œåº“è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œè¿™ä½¿å¾—å¸¸è§„çš„ OkHttp Hook
æ–¹æ³•å¤±æ•ˆï¼Œå¿…é¡»æ·±å…¥åˆ°æ›´åº•å±‚çš„ <code>cronet.so</code>
æˆ–ç³»ç»Ÿç½‘ç»œè°ƒç”¨å±‚é¢å»è¿›è¡Œ Hookã€‚</p></li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p></li>
<li><p><strong>è™šæ‹Ÿæœºä¿æŠ¤ (VMP)</strong>: å…¶æ ¸å¿ƒ SO åº“ï¼ˆå¦‚
<code>libmetasec_ml.so</code>,
<code>libmsaoaidsec.so</code>ï¼‰ä½¿ç”¨äº†è¡Œä¸šé¡¶çº§çš„ VMP
æˆ–å…¶è‡ªç ”çš„è™šæ‹Ÿæœºä¿æŠ¤æŠ€æœ¯ã€‚è¿™ä¼šå°†åŸå§‹çš„ ARM
æŒ‡ä»¤è½¬æ¢æˆè™šæ‹Ÿæœºè‡ªå®šä¹‰çš„å­—èŠ‚ç ï¼Œå¯¼è‡´ IDA
ç­‰å·¥å…·æ— æ³•è¿›è¡Œé™æ€åˆ†æã€‚</p></li>
<li><p><strong>ç®—æ³•å¿«é€Ÿè¿­ä»£</strong>:
ç­¾åç®—æ³•å‡ ä¹æ¯ä¸ªç‰ˆæœ¬éƒ½åœ¨å˜åŒ–ï¼Œå¢åŠ äº†é•¿æœŸç»´æŠ¤çš„éš¾åº¦ã€‚</p></li>
<li><p><strong>åˆ†æç­–ç•¥</strong>: é‰´äº VMP
çš„å­˜åœ¨ï¼Œå®Œå…¨è¿˜åŸç­¾åç®—æ³•å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ä¸šç•Œä¸»æµçš„ç­–ç•¥æ˜¯<strong>æ”¾å¼ƒç®—æ³•è¿˜åŸï¼Œè½¬å‘
RPC è°ƒç”¨</strong>ã€‚å³é€šè¿‡ Frida ç­‰å·¥å…·æ‰¾åˆ° SO
ä¸­è´Ÿè´£è®¡ç®—ç­¾åçš„å‡½æ•°ï¼ˆæ— è®ºæ˜¯å¯¼å‡ºè¿˜æ˜¯éå¯¼å‡ºå‡½æ•°ï¼‰ï¼Œæ¨¡æ‹Ÿå…¶è¿è¡Œç¯å¢ƒå’Œå‚æ•°ï¼Œç›´æ¥è°ƒç”¨å®ƒæ¥è·å–ç­¾åç»“æœã€‚</p></li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-4å¿«æ‰‹">æ¡ˆä¾‹åˆ†æ 4ï¼šå¿«æ‰‹</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: API è¯·æ±‚å‚æ•°ä¸­åŒ…å« <code>sig</code> å’Œ
<code>__NS_sig</code> å­—æ®µã€‚è¯·æ±‚ä½“åŒæ ·å¯èƒ½ä½¿ç”¨ Protobuf
åºåˆ—åŒ–å¹¶åŠ å¯†ã€‚</p></li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p></li>
<li><p><strong>åŒç­¾åä½“ç³»</strong>:</p></li>
<li><p><code>sig</code>: ä¸€ä¸ªç›¸å¯¹ä¼ ç»Ÿçš„ API
ç­¾åï¼Œé€šå¸¸æ˜¯å¯¹æ‰€æœ‰è¯·æ±‚å‚æ•°è¿›è¡Œæ’åºã€æ‹¼æ¥ã€åŠ ç›åè¿›è¡Œ MD5 æˆ– HMAC
å“ˆå¸Œã€‚</p></li>
<li><p><code>__NS_sig</code> (New Signature):
è¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„é£æ§ç­¾åï¼Œå…¶è®¡ç®—è¿‡ç¨‹èå…¥äº†å¤§é‡çš„è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ï¼Œç”¨äºå¯¹æŠ—æ¨¡æ‹Ÿå™¨å’Œè„šæœ¬ã€‚</p></li>
<li><p><strong>åŠ¨æ€ Salt</strong>: åœ¨åŠ å¯†å’Œç­¾åè¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°ä¸€ä¸ª
<code>client_salt</code>ï¼Œè¿™ä¸ªç›å€¼å¹¶éå›ºå®šï¼Œè€Œæ˜¯å¯èƒ½ä» Protobuf
æ•°æ®ä¸­åŠ¨æ€è·å–ï¼Œæˆ–è€…é€šè¿‡ JNI è°ƒç”¨ SO
åº“åŠ¨æ€ç”Ÿæˆï¼Œè¿™å¢åŠ äº†æ¨¡æ‹Ÿè¯·æ±‚çš„éš¾åº¦ã€‚</p></li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p></li>
<li><p>å…¶æ ¸å¿ƒ SO åº“ï¼ˆå¦‚
<code>libcore.so</code>ï¼‰ç»è¿‡äº†æ·±åº¦æ··æ·†ï¼Œè™½ç„¶å¯èƒ½ä¸æ˜¯ VMP
çº§åˆ«ï¼Œä½†é™æ€åˆ†æä¾ç„¶å›°éš¾é‡é‡ã€‚</p></li>
<li><p>åŒæ ·å¤§é‡ä½¿ç”¨äº† Protobufï¼Œéœ€è¦æŠ•å…¥ç²¾åŠ›å»é€†å‘å…¶æ•°æ®ç»“æ„ã€‚</p></li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-5ç¾å›¢">æ¡ˆä¾‹åˆ†æ 5ï¼šç¾å›¢</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: API è¯·æ±‚ä¸­åŒ…å«å¤§é‡è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œå¦‚
<code>M-TraceId</code>ã€‚è¯·æ±‚ä½“è¢«åŠ å¯†ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ° <code>rohr</code> å’Œ
<code>mtgsig</code> ç­‰æ–°ä¸€ä»£çš„é£æ§åŠç­¾åå­—æ®µã€‚</p></li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p></li>
<li><p><strong>ä¸­å¿ƒåŒ–é£æ§åº“</strong>: æ ¸å¿ƒä¿æŠ¤é€»è¾‘é«˜åº¦é›†ä¸­åœ¨
<code>libmtguard.so</code>
ä¸­ï¼Œè¯¥åº“è´Ÿè´£ç”Ÿæˆå‡ ä¹æ‰€æœ‰çš„ç­¾åå’Œé£æ§æ•°æ®ã€‚</p></li>
<li><p><strong>è¯·æ±‚å‹ç¼©ä¸åŠ å¯†</strong>: è¯·æ±‚ä½“å¯èƒ½ä¼šå…ˆç”¨
<code>zlib</code> æˆ– <code>gzip</code> è¿›è¡Œå‹ç¼©ï¼Œç„¶åå†é€šè¿‡ AES
è¿›è¡ŒåŠ å¯†ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦å…ˆè§£å¯†å†è§£å‹ã€‚</p></li>
<li><p><strong><code>rohr</code> &amp; <code>mtgsig</code></strong>:
è¿™æ˜¯å…¶æ–°ä¸€ä»£çš„é£æ§ç­¾åä½“ç³»ã€‚<code>rohr</code>
æ˜¯ä¸€ä¸ªé£æ§ä»¤ç‰Œï¼ŒåŒ…å«äº†åŠ å¯†çš„è®¾å¤‡å’Œç¯å¢ƒä¿¡æ¯ï¼›<code>mtgsig</code> æ˜¯ API
ç­¾åï¼Œå®ƒåœ¨è®¡ç®—æ—¶ä¼šä¾èµ– <code>rohr</code>
çš„éƒ¨åˆ†æ•°æ®ï¼Œä¸¤è€…å¼ºå…³è”ã€‚</p></li>
<li><p><strong>ç»Ÿä¸€è¯·æ±‚ç½‘å…³</strong>: æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ API
ç½‘å…³ï¼ŒåŠ å¯†å’Œç­¾åé€»è¾‘ç›¸å¯¹é›†ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†å’Œè¿­ä»£ã€‚</p></li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p></li>
<li><p><code>libmtguard.so</code>
æ˜¯é€†å‘çš„é‡ä¸­ä¹‹é‡ï¼Œå…¶å†…éƒ¨é€»è¾‘å¤æ‚ä¸”ç»è¿‡æ··æ·†ã€‚</p></li>
<li><p>é£æ§ç»´åº¦æå¹¿ï¼Œé™¤äº†å¸¸è§„çš„è®¾å¤‡æŒ‡çº¹ï¼Œè¿˜å¯èƒ½åŒ…æ‹¬åœ°ç†ä½ç½®ã€å†å²è¡Œä¸ºã€ç½‘ç»œç¯å¢ƒç­‰ï¼Œå¯¹ä¼ªé€ è®¾å¤‡ç”»åƒçš„ä¸€è‡´æ€§è¦æ±‚éå¸¸é«˜ã€‚</p></li>
</ul>
<h2 id="æ¡ˆä¾‹åˆ†æ-6é˜¿é‡Œç³»-æ·˜å®æ”¯ä»˜å®">æ¡ˆä¾‹åˆ†æ 6ï¼šé˜¿é‡Œç³»
(æ·˜å®ã€æ”¯ä»˜å®)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: API è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ª <code>sign</code>
å­—æ®µï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªåä¸º <code>wua</code> çš„ç¥ç§˜å‚æ•°ã€‚ç½‘ç»œè¯·æ±‚é€šè¿‡è‡ªæœ‰çš„
MTop ç½‘å…³è¿›è¡Œåˆ†å‘ã€‚</p></li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p></li>
<li><p><strong>ç»Ÿä¸€ç½‘å…³ (MTop)</strong>: é˜¿é‡Œç³» App ä½¿ç”¨è‡ªç ”çš„ MTop
(Mobile Taobao Open Platform) ä½œä¸ºç»Ÿä¸€æ— çº¿ç½‘å…³ã€‚æ‰€æœ‰çš„ API
è¯·æ±‚éƒ½ç»è¿‡è¿™ä¸ªç½‘å…³ï¼Œä¾¿äºç»Ÿä¸€è¿›è¡Œç­¾åæ ¡éªŒã€å®‰å…¨é£æ§å’Œæµé‡è°ƒåº¦ã€‚</p></li>
<li><p><strong>å®‰å…¨æ ¸å¿ƒ (<code>libsgmain.so</code>)</strong>:
æ‰€æœ‰çš„å®‰å…¨é€»è¾‘éƒ½é«˜åº¦é›†æˆåœ¨ <code>libsgmain.so</code> ä»¥åŠä¸€ç³»åˆ—
<code>libsgxxx.so</code> (å¦‚ <code>libsgsecuritybody.so</code>)
çš„å®‰å…¨ç»„ä»¶ä¸­ã€‚è¿™æ˜¯é˜¿é‡Œå®‰å…¨çš„æ ¸å¿ƒæŠ€æœ¯ç»“æ™¶ï¼Œè´Ÿè´£ç­¾å <code>sign</code>
å’Œé£æ§å‚æ•° <code>wua</code> çš„ç”Ÿæˆã€‚</p></li>
<li><p><strong><code>sign</code> ç­¾å</strong>:
ç­¾åç®—æ³•æå…¶å¤æ‚ã€‚å®ƒä¸ä»…åŒ…å« API çš„ä¸šåŠ¡å‚æ•°ï¼Œè¿˜ä¼šå°†æ—¶é—´æˆ³ã€App
ç‰ˆæœ¬ã€Token ä»¥åŠä»å®‰å…¨ SDK
ä¸­è·å–çš„å¤§é‡è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ä¸€åŒå‚ä¸è®¡ç®—ã€‚å…¶æ‹¼æ¥å’ŒåŠ å¯†æ–¹å¼éå¸¸è§„æ•´ã€‚</p></li>
<li><p><strong><code>wua</code> é£æ§å‚æ•°</strong>: è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äº
<code>anti_content</code> çš„é»‘ç›’é£æ§å‚æ•°ã€‚å®ƒç”± <code>libsgmain.so</code>
é‡‡é›†æµ·é‡çš„è®¾å¤‡ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç¡¬ä»¶ã€ç³»ç»Ÿã€ç½‘ç»œã€ä¼ æ„Ÿå™¨ã€ç¯å¢ƒæ£€æµ‹ç­‰ï¼‰åï¼Œç»è¿‡é«˜åº¦æ··æ·†çš„ç®—æ³•åŠ å¯†ç”Ÿæˆã€‚<code>wua</code>
çš„ç”Ÿæˆéš¾åº¦å’Œé‡è¦æ€§ç”šè‡³é«˜äº <code>sign</code>ã€‚æœåŠ¡ç«¯ä¼šå°†
<code>sign</code> å’Œ <code>wua</code> è¿›è¡Œå¼ºå…³è”æ ¡éªŒã€‚</p></li>
<li><p><strong>ACCS é€šé“</strong>: ä½¿ç”¨è‡ªç ”çš„ ACCS (Alibaba Cloud
Channel Service) é•¿è¿æ¥é€šé“ï¼ŒåŸºäº
HTTP/2ï¼Œè¿›ä¸€æ­¥å°è£…äº†ç½‘ç»œè¯·æ±‚ï¼Œä½¿å¾—å¸¸è§„æŠ“åŒ…å’Œåˆ†æå˜å¾—æ›´åŠ å›°éš¾ã€‚</p></li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p></li>
<li><p><strong>é¡¶çº§æ··æ·†</strong>: <code>libsgmain.so</code>
åŠå…¶ä¾èµ–åº“ä½¿ç”¨äº†è‡ªç ”çš„ã€å¤šå±‚æ¬¡çš„å¤æ‚æ··æ·†æŠ€æœ¯ï¼Œé™æ€åˆ†æå‡ ä¹æ— æ³•ä¸‹æ‰‹ï¼Œæ˜¯ä¸šç•Œå…¬è®¤çš„æœ€éš¾é€†å‘çš„
SO åº“ä¹‹ä¸€ã€‚</p></li>
<li><p><strong>åŠ¨æ€åŠ è½½ä¸åè°ƒè¯•</strong>:
å®‰å…¨ç»„ä»¶çš„åŠ è½½å’Œåˆå§‹åŒ–è¿‡ç¨‹éå¸¸éšæ™¦ï¼Œå¹¶ä¼´æœ‰å¤§é‡çš„åè°ƒè¯•å’Œç¯å¢ƒæ£€æµ‹æ‰‹æ®µï¼Œç»™åŠ¨æ€è°ƒè¯•å’Œåˆ†æè®¾ç½®äº†æé«˜çš„é—¨æ§›ã€‚</p></li>
<li><p><strong>é»‘ç›’ RPC è°ƒç”¨</strong>:
ä¸å­—èŠ‚ç³»ç±»ä¼¼ï¼Œä¸šç•Œçš„ä¸»æµç­–ç•¥æ˜¯æ”¾å¼ƒç®—æ³•è¿˜åŸã€‚é€†å‘çš„ç»ˆæç›®æ ‡æ˜¯åœ¨ SO
æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼ <code>main</code> çš„å‡½æ•°å…¥å£ï¼Œé€šè¿‡ RPC
è°ƒç”¨çš„æ–¹å¼ï¼Œä¼ å…¥è¯·æ±‚å‚æ•°ï¼Œè·å–è®¡ç®—å¥½çš„ <code>sign</code> å’Œ
<code>wua</code>
å€¼ã€‚å®šä½è¿™ä¸ªå…¥å£éœ€è¦æå…¶æ·±åšçš„åŠ¨æ€è°ƒè¯•å’ŒäºŒè¿›åˆ¶åˆ†æåŠŸåº•ã€‚</p></li>
</ul>
<h2 id="é€†å‘åˆ†æé€šç”¨ç­–ç•¥">é€†å‘åˆ†æé€šç”¨ç­–ç•¥</h2>
<ol type="1">
<li><strong>é™æ€åˆ†æ (Jadx/Ghidra)</strong>:</li>
</ol>
<ul>
<li><p><strong>å…¨å±€æœç´¢</strong>ï¼šæœç´¢å…³é”®è¯ï¼Œå¦‚ <code>sign</code>,
<code>encrypt</code>, ä»¥åŠä¸Šè¿°æ¡ˆä¾‹ä¸­çš„ <code>anti_content</code>,
<code>X-Sign</code>, <code>X-Gorgon</code>, <code>mtgsig</code>,
<code>wua</code> ç­‰ã€‚</p></li>
<li><p><strong>å®šä½ç½‘ç»œåº“</strong>: ç°ä»£ App å¤§å¤šä½¿ç”¨ OkHttpã€‚æœç´¢
<code>okhttp3.Interceptor</code>
çš„å®ç°ç±»ï¼Œå› ä¸ºåŠ å¯†å’Œç­¾åçš„é€»è¾‘å¸¸å¸¸åœ¨è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸­ç»Ÿä¸€å¤„ç†ã€‚</p></li>
<li><p><strong>è¿½è¸ª JNI è°ƒç”¨</strong>: æ‰¾åˆ° Java å±‚è°ƒç”¨ Native
æ–¹æ³•çš„åœ°æ–¹ï¼Œé‡ç‚¹å…³æ³¨é‚£äº›å‡½æ•°åå¯ç–‘ï¼ˆå¦‚
<code>getSignFromC</code>ï¼‰ã€å‚æ•°å¤šä¸”åŒ…å«å­—èŠ‚æ•°ç»„çš„å‡½æ•°ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>åŠ¨æ€åˆ†æ (Frida)</strong>:</li>
</ol>
<ul>
<li><p><strong>Hook åŠ å¯†ç®—æ³•</strong>: è¿™æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚Hook
<code>java.security.MessageDigest.digest</code> å’Œ
<code>javax.crypto.Mac.doFinal</code>ï¼Œæ‰“å°å®ƒä»¬çš„è¾“å…¥ï¼ˆå³è¢«ç­¾åçš„æ˜æ–‡ï¼‰å’Œè°ƒç”¨å †æ ˆï¼Œå¯ä»¥ç¬é—´å®šä½åˆ°ç”Ÿæˆç­¾åçš„ä»£ç ä½ç½®ã€‚</p></li>
<li><p><strong>Hook ç½‘ç»œè¯·æ±‚</strong>: Hook
<code>okhttp3.Request.Builder</code> çš„ <code>build()</code> æ–¹æ³•ï¼Œæˆ–
<code>okhttp3.OkHttpClient</code> çš„ <code>newCall</code> æ–¹æ³•ï¼Œå¯ä»¥
dump å‡ºæ‰€æœ‰å³å°†å‘å‡ºçš„ç½‘ç»œè¯·æ±‚çš„å®Œæ•´ä¿¡æ¯ï¼ˆURL, Headers,
Bodyï¼‰ï¼Œç”¨äºå’ŒæŠ“åŒ…ç»“æœå¯¹æ¯”ã€‚</p></li>
<li><p><strong>Hook SO å‡½æ•°</strong>: å®šä½åˆ°æ ¸å¿ƒ SO åº“åï¼Œç”¨ Frida
<code>Interceptor.attach</code> ç›´æ¥ Hook
ç›®æ ‡å¯¼å‡ºå‡½æ•°ï¼Œè§‚å¯Ÿå…¶è¾“å…¥å’Œè¾“å‡ºã€‚å¯¹äºéå¯¼å‡ºå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡åŸºåœ°å€åŠ åç§»çš„æ–¹å¼è¿›è¡Œ
Hookã€‚ ___ ## é«˜çº§ç­–ç•¥ï¼šé»‘ç›’ RPC è°ƒç”¨è¯¦è§£</p></li>
</ul>
<p>åœ¨åˆ†æå­—èŠ‚ã€é˜¿é‡Œç­‰é¡¶çº§å‚å•†çš„åŠ å›º SO æ—¶ï¼Œä¼šå‘ç°å…¶æ ¸å¿ƒé€»è¾‘å— VMP
(è™šæ‹Ÿæœºä¿æŠ¤) æˆ–è‡ªç ”è™šæ‹Ÿæœºä¿æŠ¤ã€‚è¿™æ„å‘³ç€åŸå§‹çš„ ARM
æŒ‡ä»¤è¢«è½¬æ¢æˆäº†ä¸€å¥—è‡ªå®šä¹‰çš„ã€æ— æ³•è¢«å¸¸è§„åæ±‡ç¼–å·¥å…·è§£æçš„å­—èŠ‚ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯•å›¾å®Œå…¨ç†è§£å¹¶â€ç™½ç›’â€åœ°è¿˜åŸç­¾åç®—æ³•ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>å› æ­¤ï¼Œä¸šç•Œçš„åˆ†ææ€è·¯ä»â€ç®—æ³•è¿˜åŸâ€è½¬å‘â€ç®—æ³•åˆ©ç”¨â€ï¼Œè¿™ä¾¿æ˜¯<strong>é»‘ç›’
RPC (Remote Procedure Call) è°ƒç”¨</strong>ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯é»‘ç›’-rpc-è°ƒç”¨"># ä»€ä¹ˆæ˜¯é»‘ç›’ RPC è°ƒç”¨ï¼Ÿ</h2>
<p>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ä¸å†å…³å¿ƒå‡½æ•°å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¸€ä¸ªé»‘ç›’å­ã€‚æˆ‘ä»¬åªå…³å¿ƒå®ƒçš„è¾“å…¥å’Œè¾“å‡ºã€‚</strong>
æˆ‘ä»¬å°†é€šè¿‡ Frida ç­‰å·¥å…·ï¼Œåœ¨ App
çš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ï¼Œå¼ºè¡Œè°ƒç”¨è¿™ä¸ªé»‘ç›’å‡½æ•°ï¼Œè®©å®ƒä¸ºæˆ‘ä»¬è®¡ç®—å‡ºæ‰€éœ€çš„ç»“æœï¼ˆå¦‚
<code>sign</code>,
<code>wua</code>ï¼‰ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™å¤–éƒ¨çš„è‡ªåŠ¨åŒ–ç¨‹åºã€‚</p>
<p>è¿™å°±å¥½æ¯”æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç½‘ç«™çš„ APIï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ƒçš„æºç ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„
URLã€å‚æ•°å’Œè¿”å›å€¼æ ¼å¼å°±èƒ½ä½¿ç”¨å®ƒã€‚åœ¨è¿™é‡Œï¼ŒSO é‡Œçš„å‡½æ•°å°±æ˜¯é‚£ä¸ªâ€APIâ€ã€‚</p>
<h2 id="å®ç°é»‘ç›’-rpc-çš„æ ¸å¿ƒæ­¥éª¤"># å®ç°é»‘ç›’ RPC çš„æ ¸å¿ƒæ­¥éª¤</h2>
<h3 id="ç¬¬ä¸€æ­¥å®šä½ç›®æ ‡å‡½æ•°åœ°å€-finding-the-function-pointer">#
ç¬¬ä¸€æ­¥ï¼šå®šä½ç›®æ ‡å‡½æ•°åœ°å€ (Finding the Function Pointer)</h3>
<p>è¿™æ˜¯æœ€å›°éš¾ã€æœ€è€—æ—¶çš„ä¸€æ­¥ï¼Œéœ€è¦æ·±åšçš„åŠ¨æ€è°ƒè¯•åŠŸåº•ã€‚ 1. <strong>ä» JNI
å…¥å£å¼€å§‹</strong>: ä» Java å±‚è°ƒç”¨ Native æ–¹æ³•çš„åœ°æ–¹ï¼ˆ<code>JNI</code>
å‡½æ•°ï¼‰ä½œä¸ºèµ·ç‚¹ã€‚ 2. <strong>ä¸»åŠ¨è°ƒç”¨ä¸æ’æ¡©</strong>: ä½¿ç”¨ Frida
ä¸»åŠ¨è°ƒç”¨è¯¥ JNI å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ <code>Stalker</code>
ç­‰æŒ‡ä»¤çº§è·Ÿè¸ªå·¥å…·ï¼Œè®°å½•ä¸‹æ‰§è¡Œè½¨è¿¹ã€‚ 3. <strong>æ‰§è¡Œæµåˆ†æ</strong>: åˆ†æ
Stalker äº§ç”Ÿçš„å·¨å¤§æ—¥å¿—ï¼Œæˆ–ä½¿ç”¨ <code>Unicorn Engine</code>
ç­‰æ¨¡æ‹Ÿæ‰§è¡Œå·¥å…·è¿›è¡Œåˆ†æï¼Œç†æ¸…å¤æ‚çš„è·³è½¬å’Œè®¡ç®—é€»è¾‘ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªâ€å¹²å‡€â€çš„å‡½æ•°å…¥å£â€”â€”å®ƒæ¥æ”¶ç›¸å¯¹åŸå§‹çš„ä¸šåŠ¡å‚æ•°ï¼Œè¿”å›æœ€ç»ˆçš„ç­¾åç»“æœã€‚è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼ˆé€šå¸¸æ˜¯
SO åŸºå€ + åç§»é‡ï¼‰å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥åˆ†æå‡½æ•°åŸå‹-analyzing-the-prototype">#
ç¬¬äºŒæ­¥ï¼šåˆ†æå‡½æ•°åŸå‹ (Analyzing the Prototype)</h3>
<p>ç¡®å®šç›®æ ‡å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºã€‚</p>
<ul>
<li><p><strong>è¾“å…¥å‚æ•°</strong>:
åœ¨ä¸Šä¸€æ­¥æ‰¾åˆ°çš„å‡½æ•°è°ƒç”¨ç‚¹ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿè°ƒç”¨å‰å„å¯„å­˜å™¨ï¼ˆARM32 ä¸‹é‡ç‚¹å…³æ³¨
R0-R3ï¼‰å’Œæ ˆä¸Šçš„å€¼ï¼Œæ¨æ–­å‡ºå‡½æ•°çš„å‚æ•°ç±»å‹ã€æ•°é‡å’Œé¡ºåºã€‚å‚æ•°å¯èƒ½æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚æ•°ç»„ã€ç»“æ„ä½“æŒ‡é’ˆç­‰ã€‚</p></li>
<li><p><strong>è¿”å›å€¼</strong>: åœ¨å‡½æ•°è¿”å›ç‚¹ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿ R0
å¯„å­˜å™¨çš„å€¼ï¼Œç¡®å®šå‡½æ•°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æœå­—ç¬¦ä¸²çš„æŒ‡é’ˆæˆ–ä¸€ä¸ªçŠ¶æ€ç ï¼‰ã€‚</p></li>
</ul>
<h3 id="ç¬¬ä¸‰æ­¥æ„å»º-rpc-æœåŠ¡ç«¯-frida-agent"># ç¬¬ä¸‰æ­¥ï¼šæ„å»º RPC æœåŠ¡ç«¯
(Frida Agent)</h3>
<p>ç¼–å†™ä¸€ä¸ª Frida
è„šæœ¬ï¼Œå°†å®šä½åˆ°çš„åŸç”Ÿå‡½æ•°å°è£…æˆä¸€ä¸ªå¯ä¾›è¿œç¨‹è°ƒç”¨çš„æœåŠ¡ã€‚</p>
<div class="sourceCode" id="cb419"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co">// agent.js</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Get SO base address</span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> baseAddr <span class="op">=</span> Module<span class="op">.</span><span class="fu">findBaseAddress</span>(<span class="st">&quot;libsgmain.so&quot;</span>)<span class="op">;</span></span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Calculate target function absolute address</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This 0x123456 is the function offset found through great effort in step one</span></span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> targetFuncPtr <span class="op">=</span> baseAddr<span class="op">.</span><span class="fu">add</span>(<span class="bn">0x123456</span>)<span class="op">;</span></span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-8"><a href="#cb419-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Define function based on the prototype analyzed in step two</span></span>
<span id="cb419-9"><a href="#cb419-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Assume function prototype is: char* func(char* input1, int input2)</span></span>
<span id="cb419-10"><a href="#cb419-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nativeFunc <span class="op">=</span> <span class="kw">new</span> <span class="fu">NativeFunction</span>(targetFuncPtr<span class="op">,</span> <span class="st">&#39;pointer&#39;</span><span class="op">,</span> [<span class="st">&#39;pointer&#39;</span><span class="op">,</span> <span class="st">&#39;int&#39;</span>])<span class="op">;</span></span>
<span id="cb419-11"><a href="#cb419-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-12"><a href="#cb419-12" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Expose interface using rpc.exports</span></span>
<span id="cb419-13"><a href="#cb419-13" aria-hidden="true" tabindex="-1"></a>rpc<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> {</span>
<span id="cb419-14"><a href="#cb419-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a remote call interface named getSign</span></span>
<span id="cb419-15"><a href="#cb419-15" aria-hidden="true" tabindex="-1"></a><span class="dt">getSign</span><span class="op">:</span> <span class="kw">function</span> (param1<span class="op">,</span> param2) {</span>
<span id="cb419-16"><a href="#cb419-16" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;RPC call received, invoking native function...&quot;</span>)<span class="op">;</span></span>
<span id="cb419-17"><a href="#cb419-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Prepare parameters for native function</span></span>
<span id="cb419-18"><a href="#cb419-18" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> input1Ptr <span class="op">=</span> Memory<span class="op">.</span><span class="fu">allocUtf8String</span>(param1)<span class="op">;</span></span>
<span id="cb419-19"><a href="#cb419-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-20"><a href="#cb419-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Call native function</span></span>
<span id="cb419-21"><a href="#cb419-21" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> resultPtr <span class="op">=</span> <span class="fu">nativeFunc</span>(input1Ptr<span class="op">,</span> param2)<span class="op">;</span></span>
<span id="cb419-22"><a href="#cb419-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-23"><a href="#cb419-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Read and return result</span></span>
<span id="cb419-24"><a href="#cb419-24" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> resultPtr<span class="op">.</span><span class="fu">readUtf8String</span>()<span class="op">;</span></span>
<span id="cb419-25"><a href="#cb419-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb419-26"><a href="#cb419-26" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h1 id="client.py">client.py</h1>
<p>import frida import sys</p>
<p>def main(): # Connect to frida-server on device device =
frida.get_usb_device() # Attach to target App process pid =
device.spawn([â€œcom.example.appâ€]) session = device.attach(pid)</p>
<h1 id="load-frida-agent-script">Load Frida Agent script</h1>
<p>with open(â€œagent.jsâ€) as f: script_code = f.read() script =
session.create_script(script_code) script.load()</p>
<h1 id="prepare-parameters">Prepare parameters</h1>
<p>api_params_str = â€œparam1=value1&amp;param2=value2â€ some_int_value =
123</p>
<h1 id="call-rpc-interface-like-calling-a-local-function">Call RPC
interface like calling a local function</h1>
<p>print(â€œCalling RPC function: getSignâ€¦â€) result_sign =
script.exports.get_sign(api_params_str, some_int_value)</p>
<p>print(fâ€Successfully got sign: {result_sign}â€œ)</p>
<h1
id="can-use-the-obtained-sign-to-construct-and-send-network-requests-here">Can
use the obtained sign to construct and send network requests here</h1>
<h1 id="section-17">â€¦</h1>
<p>session.detach()</p>
<p>if <strong>name</strong> == â€˜<strong>main</strong>â€™: main()</p>
<pre><code>
é€šè¿‡é»‘ç›’ RPCï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡å¯¹ VMP ç­‰å¤æ‚æŠ€æœ¯çš„ç›´æ¥å¯¹æŠ—ï¼Œå°†é€†å‘çš„é‡ç‚¹æ”¾åœ¨å¯»æ‰¾å’Œè°ƒç”¨å…³é”®å‡½æ•°ä¸Šï¼Œè¿™åœ¨å½“ä»Šçš„é«˜çº§ç§»åŠ¨å®‰å…¨æ”»é˜²ä¸­æ˜¯ä¸€ç§åŠ¡å®ä¸”é«˜æ•ˆçš„ç­–ç•¥ã€‚ </code></pre>
<!-- 03-Case-Studies/case_unity_games.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶unity-æ¸¸æˆé€†å‘-il2cpp">æ¡ˆä¾‹ç ”ç©¶ï¼šUnity æ¸¸æˆé€†å‘
(Il2Cpp)</h1>
<p>Unity æ˜¯ç›®å‰æœ€æµè¡Œçš„ç§»åŠ¨æ¸¸æˆå¼•æ“ä¹‹ä¸€ã€‚ç°ä»£ Unity æ¸¸æˆé€šå¸¸ä½¿ç”¨ Il2Cpp
è„šæœ¬åç«¯ï¼Œå°† C# ä»£ç è½¬æ¢ä¸º C++ ä»£ç å¹¶ç¼–è¯‘ä¸º Native åº“
(<code>libil2cpp.so</code>)ã€‚è¿™ä½¿å¾—ä¼ ç»Ÿçš„ Java/Smali
é€†å‘æ–¹æ³•å¤±æ•ˆï¼Œéœ€è¦å…¨æ–°çš„å·¥å…·å’Œæ€è·¯ã€‚ ___ ##
æ ¸å¿ƒarchitectureä¸æ–‡ä»¶ç»“æ„</p>
<p>ä¸€ä¸ªå…¸å‹çš„ Unity Il2Cpp æ¸¸æˆåŒ…å«ä»¥ä¸‹å…³é”®æ–‡ä»¶ï¼š</p>
<ol type="1">
<li><strong><code>lib/armeabi-v7a/libil2cpp.so</code></strong>:
è¿™æ˜¯æ¸¸æˆçš„æ ¸å¿ƒé€»è¾‘åº“ã€‚æ‰€æœ‰çš„ C#
è„šæœ¬ï¼ˆç©å®¶æ§åˆ¶ã€æ¸¸æˆé€»è¾‘ã€ç½‘ç»œé€šä¿¡ï¼‰éƒ½è¢«ç¼–è¯‘åˆ°äº†è¿™é‡Œã€‚</li>
<li><strong><code>assets/bin/Data/Managed/global-metadata.dat</code></strong>:
è¿™æ˜¯ Il2Cpp çš„å…ƒæ•°æ®æ–‡ä»¶ã€‚å®ƒåŒ…å«äº†è¢«è½¬æ¢å‰çš„ C#
ç±»åã€æ–¹æ³•åã€å­—æ®µåä»¥åŠå®ƒä»¬åœ¨ <code>libil2cpp.so</code>
ä¸­çš„åç§»åœ°å€ã€‚<strong>è¿™æ˜¯é€†å‘çš„å…³é”®é’¥åŒ™</strong>ã€‚</li>
<li><strong><code>lib/armeabi-v7a/libmain.so</code></strong> (æˆ–
<code>libunity.so</code>): Unity å¼•æ“çš„è¿è¡Œæ—¶åº“ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹ã€‚ ___ ##
é€†å‘æµç¨‹</li>
</ol>
<h3 id="ç¬¬-1-æ­¥å…ƒæ•°æ®æå–-metadata-dumping">ç¬¬ 1 æ­¥ï¼šå…ƒæ•°æ®æå–
(Metadata Dumping)</h3>
<p>ç”±äº <code>libil2cpp.so</code> æ˜¯å‰¥ç¦»äº†ç¬¦å·è¡¨ (stripped)
çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç›´æ¥ç”¨ IDA æ‰“å¼€åªèƒ½çœ‹åˆ°æˆåƒä¸Šä¸‡ä¸ªæ— åå‡½æ•°
(<code>sub_xxxx</code>)ã€‚æˆ‘ä»¬éœ€è¦ç»“åˆ <code>global-metadata.dat</code>
æ¥è¿˜åŸè¿™äº›å‡½æ•°çš„çœŸå®åç§°ã€‚</p>
<ul>
<li>*å·¥å…·**: <a
href="https://github.com/Perfare/Il2CppDumper">Il2CppDumper</a></li>
</ul>
<ol type="1">
<li>å°† APK è§£å‹ï¼Œæå–å‡º <code>libil2cpp.so</code> å’Œ
<code>global-metadata.dat</code>ã€‚</li>
<li>è¿è¡Œ
<code>Il2CppDumper.exe &lt;libil2cpp.so&gt; &lt;global-metadata.dat&gt;</code>ã€‚</li>
<li>å·¥å…·ä¼šç”Ÿæˆï¼š</li>
</ol>
<ul>
<li><strong><code>dump.cs</code></strong>: è¿˜åŸåçš„ C#
ä¼ªä»£ç ï¼Œå±•ç¤ºäº†æ‰€æœ‰ç±»ã€å­—æ®µå’Œæ–¹æ³•ç»“æ„ã€‚</li>
<li><strong><code>script.py</code></strong>: ç”¨äº IDA Pro çš„ Python
è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨é‡å‘½å IDA ä¸­çš„å‡½æ•°ã€‚</li>
<li><strong><code>ghidra.py</code></strong>: ç”¨äº Ghidra çš„è„šæœ¬ã€‚</li>
<li><strong><code>DummyDll/</code></strong>: ç”Ÿæˆçš„ç©º DLL æ–‡ä»¶ï¼Œå¯ä»¥ç”¨
dnSpy æ‰“å¼€æŸ¥çœ‹ç±»ç»“æ„ã€‚</li>
</ul>
<h3 id="ç¬¬-2-æ­¥é™æ€åˆ†æä¸å®šä½">ç¬¬ 2 æ­¥ï¼šé™æ€åˆ†æä¸å®šä½</h3>
<p>ä½¿ç”¨ <code>dnSpy</code> æ‰“å¼€ç”Ÿæˆçš„ Dummy DLLï¼Œæˆ–æ˜¯ç›´æ¥é˜…è¯»
<code>dump.cs</code>ï¼Œæˆ‘ä»¬å¯ä»¥åƒé˜…è¯»æºç ä¸€æ ·æµè§ˆæ¸¸æˆçš„ç±»ç»“æ„ã€‚</p>
<ul>
<li><p>*å¯»æ‰¾åˆ‡å…¥ç‚¹**:</p></li>
<li><p><strong>è´§å¸ä¿®æ”¹</strong>: æœç´¢ <code>Coin</code>,
<code>Gem</code>, <code>Money</code>, <code>Currency</code>
ç­‰å…³é”®è¯ã€‚å¯»æ‰¾ <code>AddCoin()</code>, <code>GetMoney()</code>,
<code>UpdateCurrency()</code> ç­‰æ–¹æ³•ã€‚</p></li>
<li><p><strong>æ— æ•Œ/é«˜ä¼¤å®³</strong>: æœç´¢ <code>PlayerController</code>,
<code>BattleManager</code>, <code>Health</code>,
<code>Damage</code>ã€‚å¯»æ‰¾ <code>TakeDamage()</code>,
<code>OnHit()</code> ç­‰æ–¹æ³•ã€‚</p></li>
<li><p><strong>å†…è´­ç ´è§£</strong>: æœç´¢ <code>IAP</code>,
<code>Purchase</code>, <code>Store</code>, <code>Payment</code>ã€‚å¯»æ‰¾
<code>OnPurchaseSuccess()</code>, <code>VerifyReceipt()</code>
ç­‰æ–¹æ³•ã€‚</p></li>
<li><p>*ç¤ºä¾‹**: åœ¨ <code>dump.cs</code> ä¸­æ‰¾åˆ°å¦‚ä¸‹ç±»ï¼š</p></li>
</ul>
<div class="sourceCode" id="cb421"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PlayerData <span class="op">{</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> coin<span class="op">;</span></span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> gem<span class="op">;</span></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">AddCoin</span><span class="op">(</span><span class="dt">int</span> amount<span class="op">);</span> <span class="co">// Address: 0x123456</span></span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">SubCoin</span><span class="op">(</span><span class="dt">int</span> amount<span class="op">);</span> <span class="co">// Address: 0x123460</span></span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>// Il2Cpp Hook Template</p>
<p>var soName = â€œlibil2cpp.soâ€; var baseAddr =
Module.findBaseAddress(soName);</p>
<p>if (baseAddr) { // Target function offset: 0x123456 (AddCoin) var
addCoinFunc = baseAddr.add(0x123456);</p>
<p>Interceptor.attach(addCoinFunc, { onEnter: function(args) { //
args[0] is â€˜thisâ€™ pointer (PlayerData instance) // args[1] is amount
(coin count to add)</p>
<p>console.log(â€œ[*] AddCoin calledâ€); console.log(â€ Amount: â€ +
args[1].toInt32());</p>
<p>// Modify parameter: force add 99999 regardless of game logic args[1]
= ptr(99999); }, onLeave: function(retval) { console.log(â€œ[*] AddCoin
finishedâ€); } }); } else { console.log(â€œ[-] libil2cpp.so not found!â€);
}</p>
<pre><code>// Use frida-il2cpp-bridge
Il2Cpp.perform(() =&gt; {
// 1. Find class
const PlayerData = Il2Cpp.domain.assembly(&quot;Assembly-CSharp&quot;).image.class(&quot;PlayerData&quot;);

// 2. Hook method (auto process offset, no need to calculate manually)
PlayerData.method(&quot;SubCoin&quot;).implementation = function (amount) {
console.log(&quot;[*] SubCoin called with amount: &quot; + amount);
// Prevent coin deduction (do nothing)
return;
};

// 3. Manually call method
// Assume we want to call PlayerData.Instance.AddCoin(1000)
// Need to find static instance or current instance first

// Trace all PlayerData instance creation
Il2Cpp.traceClass(PlayerData);
});
</code></pre>
<ul>
<li>*å¯¹æŠ—**:</li>
<li><strong>Hook åŠ è½½å‡½æ•°</strong>: æ¸¸æˆå¿…é¡»åœ¨è¿è¡Œæ—¶è§£å¯† metadata
æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚Hook <code>libil2cpp.so</code> ä¸­åŠ è½½ metadata
çš„å‡½æ•°ï¼ˆé€šå¸¸æ˜¯ <code>il2cpp::vm::MetadataCache::Register</code>
æˆ–ç›¸å…³åˆå§‹åŒ–å‡½æ•°ï¼‰ï¼ŒDump å‡ºè§£å¯†åçš„å†…å­˜å†…å®¹ã€‚</li>
<li><strong>åˆ†æè§£å¯†é€»è¾‘</strong>: é€†å‘ <code>libil2cpp.so</code>
çš„åˆå§‹åŒ–æµç¨‹ï¼Œæ‰¾åˆ°è§£å¯† metadata çš„ç®—æ³•ï¼ˆé€šå¸¸æ˜¯ XOR æˆ–
AESï¼‰ï¼Œå†™è„šæœ¬è¿˜åŸã€‚</li>
</ul>
<h3 id="å‡½æ•°åœ°å€æ··æ·†-åŠ¨æ€è®¡ç®—">2. å‡½æ•°åœ°å€æ··æ·† / åŠ¨æ€è®¡ç®—</h3>
<ul>
<li>*ç°è±¡**: Il2CppDumper å¯¼å‡ºçš„åœ°å€ä¸å†…å­˜ä¸­çš„å®é™…åœ°å€ä¸ç¬¦ã€‚</li>
<li>*å¯¹æŠ—**:</li>
<li>è¿™é€šå¸¸æ˜¯å› ä¸ºæ¸¸æˆåœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹äº†å‡½æ•°æŒ‡é’ˆã€‚</li>
<li>ä½¿ç”¨ <strong>Frida çš„æ‰«æåŠŸèƒ½</strong>ï¼Œæ ¹æ®æœºå™¨ç ç‰¹å¾ï¼ˆPattern
Scanningï¼‰æ¥å®šä½å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¾èµ–å›ºå®šçš„åç§»ã€‚</li>
</ul>
<h3 id="åè°ƒè¯•ä¸å®Œæ•´æ€§æ ¡éªŒ">3. åè°ƒè¯•ä¸å®Œæ•´æ€§æ ¡éªŒ</h3>
<ul>
<li>*ç°è±¡**: é™„åŠ  Frida åæ¸¸æˆå´©æºƒæˆ–é—ªé€€ã€‚</li>
<li>*å¯¹æŠ—**:</li>
<li>å‚è€ƒ â€œAnti-Debuggingâ€ ç« èŠ‚ï¼Œéšè— Frida ç‰¹å¾ï¼ŒBypass TracerPid
æ£€æµ‹ã€‚</li>
<li>ä½¿ç”¨ Magisk + Riru + Il2CppDumper (Zygiskç‰ˆ) åœ¨ç³»ç»Ÿå±‚é¢è¿›è¡Œ
Dumpï¼Œè§„é¿åº”ç”¨å±‚æ£€æµ‹ã€‚ ___ ## æ€»ç»“</li>
</ul>
<p>Unity Il2Cpp
é€†å‘çš„æ ¸å¿ƒåœ¨äº<strong>è¿˜åŸç¬¦å·</strong>ã€‚åªè¦æ‹¿åˆ°äº†æ­£ç¡®çš„
<code>global-metadata.dat</code> å’Œ <code>libil2cpp.so</code>
çš„æ˜ å°„å…³ç³»ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±å˜æˆäº†æ ‡å‡†çš„é€»è¾‘åˆ†æå’Œ Native Hookã€‚ç†Ÿç»ƒæŒæ¡
Il2CppDumper å’Œ Frida æ˜¯æå®šè¿™ç±»æ¸¸æˆçš„å…³é”®ã€‚</p>
<!-- 03-Case-Studies/case_video_apps_and_drm.md -->
<h1 id="æ¡ˆä¾‹ç ”ç©¶è§†é¢‘-app-ä¸-drm">æ¡ˆä¾‹ç ”ç©¶ï¼šè§†é¢‘ App ä¸ DRM</h1>
<p>è§†é¢‘ç±» App
çš„é€†å‘åˆ†ææ˜¯ç§»åŠ¨ç«¯å®‰å…¨é¢†åŸŸæœ€å…·æŒ‘æˆ˜æ€§çš„æ–¹å‘ä¹‹ä¸€ï¼Œå…¶æ ¸å¿ƒéš¾ç‚¹åœ¨äºæ•°å­—ç‰ˆæƒç®¡ç†ï¼ˆDRMï¼‰æŠ€æœ¯çš„å¯¹æŠ—ã€‚æœ¬æ¡ˆä¾‹å°†æ·±å…¥æ¢è®¨è§†é¢‘
Appï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠ DRM çš„åˆ†ææ€è·¯ã€‚ ___ ## æ ¸å¿ƒåˆ†æç›®æ ‡</p>
<ol type="1">
<li><strong>è§†é¢‘æµåˆ†æ</strong>: è§£æè§†é¢‘æ’­æ”¾çš„ç½‘ç»œåè®®ï¼Œå¦‚
<code>HLS</code> (<code>.m3u8</code>) å’Œ <code>DASH</code>
(<code>.mpd</code>)ï¼Œå¹¶æå–è§†é¢‘åˆ†ç‰‡ã€‚</li>
<li><strong>è§£é” VIP åŠŸèƒ½</strong>: ç»•è¿‡ä»˜è´¹å¢™ï¼Œè§‚çœ‹ VIP
ä¸“å±å½±ç‰‡æˆ–è§£é”æ›´é«˜æ¸…æ™°åº¦ï¼ˆå¦‚ 1080p, 4Kï¼‰ã€‚</li>
<li><strong>DRM å¯¹æŠ—</strong>: ç†è§£ DRM
çš„å·¥ä½œåŸç†ï¼Œå¹¶å°è¯•è·å–è§£å¯†è§†é¢‘æ‰€éœ€çš„å¯†é’¥ã€‚<strong>ï¼ˆæ³¨æ„ï¼šè¿™é€šå¸¸æ˜¯æå…¶å›°éš¾çš„ï¼Œä¸”å¯èƒ½æ¶‰åŠæ³•å¾‹é£é™©ã€‚ï¼‰</strong>
___ ## æ¡ˆä¾‹ï¼šåˆ†æä¸€ä¸ªä½¿ç”¨ Widevine DRM çš„è§†é¢‘æ’­æ”¾æµç¨‹</li>
</ol>
<h3 id="ç¬¬-1-æ­¥è§†é¢‘æµåè®®åˆ†æ">ç¬¬ 1 æ­¥ï¼šè§†é¢‘æµåè®®åˆ†æ</h3>
<ul>
<li>*ç›®æ ‡**: æ‰¾åˆ°æè¿°è§†é¢‘ä¿¡æ¯çš„æ¸…å•æ–‡ä»¶ (<code>.m3u8</code> æˆ–
<code>.mpd</code>)ã€‚</li>
</ul>
<ol type="1">
<li><strong>ç½‘ç»œæŠ“åŒ…</strong>: æ‰“å¼€ Charles æˆ– Mitmproxyï¼Œå¯åŠ¨ç›®æ ‡è§†é¢‘
App å¹¶æ’­æ”¾ä¸€ä¸ªå½±ç‰‡ã€‚</li>
<li><strong>è¿‡æ»¤è¯·æ±‚</strong>: åœ¨æŠ“åŒ…ç»“æœä¸­ï¼Œä½¿ç”¨å…³é”®è¯
<code>m3u8</code> æˆ– <code>mpd</code>
è¿›è¡Œè¿‡æ»¤ã€‚ä½ å¾ˆå¿«å°±èƒ½å®šä½åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶ URL ç±»ä¼¼äº
<code>https://.../video.mpd</code>ã€‚</li>
<li><strong>åˆ†ææ¸…å•æ–‡ä»¶</strong>:</li>
</ol>
<ul>
<li><p><strong>DASH (<code>.mpd</code>)</strong>: è¿™æ˜¯ä¸€ä¸ª XML
æ–‡ä»¶ï¼Œæè¿°äº†è§†é¢‘çš„å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸åŒçš„åˆ†è¾¨ç‡ã€éŸ³è½¨ã€å­—å¹•è½¨é“ä»¥åŠåŠ å¯†ä¿¡æ¯ã€‚</p></li>
<li><p><strong>HLS (<code>.m3u8</code>)</strong>: è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚ä¸»
<code>m3u8</code> æ–‡ä»¶å¯èƒ½æŒ‡å‘å¤šä¸ªå­ <code>m3u8</code>
æ–‡ä»¶ï¼Œæ¯ä¸ªå­æ–‡ä»¶ä»£è¡¨ä¸€ç§ç‰¹å®šçš„ç ç‡ï¼ˆæ¸…æ™°åº¦ï¼‰ï¼Œå¹¶åŒ…å«äº†è¯¥ç ç‡ä¸‹æ‰€æœ‰è§†é¢‘åˆ†ç‰‡ï¼ˆ<code>.ts</code>
æ–‡ä»¶ï¼‰çš„ URLã€‚</p></li>
</ul>
<p>åœ¨æ¸…å•æ–‡ä»¶ä¸­ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªå…³é”®çš„æ ‡ç­¾ï¼Œè¡¨æ˜å†…å®¹æ˜¯å—ä¿æŠ¤çš„ï¼Œä¾‹å¦‚ï¼š</p>
<div class="sourceCode" id="cb423"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- DASH MPD inEncryptInformation --&gt;</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">ContentProtection</span> <span class="ot">schemeIdUri=</span><span class="st">&quot;urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed&quot;</span> <span class="ot">cenc:default_KID=</span><span class="st">&quot;...value...&quot;</span>&gt;</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">cenc:pssh</span>&gt;...&lt;/<span class="kw">cenc:pssh</span>&gt;</span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">ContentProtection</span>&gt;</span></code></pre></div>
<h3 id="ç¬¬-2-æ­¥ç†è§£-drm-å·¥ä½œæµç¨‹-widevine">ç¬¬ 2 æ­¥ï¼šç†è§£ DRM å·¥ä½œæµç¨‹
(Widevine)</h3>
<p>Google çš„ Widevine æ˜¯ Android å¹³å°ä¸Šæœ€ä¸»æµçš„ DRM
æ–¹æ¡ˆã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªå®‰å…¨çº§åˆ« (L1, L2, L3)ï¼Œå…¶ä¸­ L1 å®‰å…¨æ€§æœ€é«˜ã€‚</p>
<ol type="1">
<li><strong>App è¯·æ±‚æ’­æ”¾</strong>: App ä»è§†é¢‘æ¸…å•ä¸­è§£æå‡º
<code>pssh</code> æ•°æ®ã€‚</li>
<li><strong>è·å–è®¸å¯è¯ (License)</strong>: App å°† <code>pssh</code>
æ•°æ®å‘é€ç»™ç³»ç»Ÿçš„ <code>MediaDrm</code> APIï¼Œç”Ÿæˆä¸€ä¸ªè®¸å¯è¯è¯·æ±‚ï¼ˆLicense
Requestï¼‰ã€‚ç„¶åï¼ŒApp å°†è¿™ä¸ªè¯·æ±‚å‘é€åˆ°è§†é¢‘æœåŠ¡æä¾›å•†çš„è®¸å¯è¯æœåŠ¡å™¨ã€‚</li>
<li><strong>æœåŠ¡å™¨éªŒè¯</strong>:
è®¸å¯è¯æœåŠ¡å™¨éªŒè¯è¯·æ±‚çš„åˆæ³•æ€§ï¼ˆä¾‹å¦‚ï¼ŒéªŒè¯ç”¨æˆ·çš„ VIP
èº«ä»½ï¼‰ï¼Œç„¶åè¿”å›ä¸€ä¸ªåŠ å¯†çš„è®¸å¯è¯ï¼ˆEncrypted Licenseï¼‰ã€‚</li>
<li><strong>è§£å¯†å¯†é’¥</strong>: App å°†åŠ å¯†çš„è®¸å¯è¯æä¾›ç»™
<code>MediaDrm</code> APIã€‚è¿™ä¸€æ­¥æ˜¯å…³é”®ï¼š</li>
</ol>
<ul>
<li><p><strong>L1 å®‰å…¨çº§åˆ«</strong>:
è®¸å¯è¯çš„å¤„ç†å’Œå†…å®¹å¯†é’¥çš„è§£å¯†å®Œå…¨åœ¨å¤„ç†å™¨çš„å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ä¸­è¿›è¡Œã€‚Android
æ“ä½œç³»ç»Ÿå’Œ App æœ¬èº«éƒ½æ— æ³•è®¿é—®åˆ°è§£å¯†åçš„å¯†é’¥ã€‚è§†é¢‘å¸§çš„è§£å¯†ä¹Ÿåœ¨ TEE
ä¸­å®Œæˆï¼Œç„¶åç›´æ¥è¾“å‡ºåˆ°å±å¹•ï¼Œä¸ä¼šåœ¨ App çš„å†…å­˜ä¸­æš´éœ²ã€‚</p></li>
<li><p><strong>L3 å®‰å…¨çº§åˆ«</strong>: åœ¨æ²¡æœ‰ TEE
æ”¯æŒçš„è®¾å¤‡ä¸Šï¼Œè¿™äº›æ“ä½œéƒ½åœ¨è½¯ä»¶å±‚é¢å®Œæˆã€‚å› æ­¤ï¼ŒL3
æ˜¯ç†è®ºä¸Šæœ€å®¹æ˜“è¢«æ”»å‡»çš„ã€‚</p></li>
</ul>
<h3 id="ç¬¬-3-æ­¥é€†å‘åˆ†æä¸ä¿¡æ¯è·å–">ç¬¬ 3 æ­¥ï¼šé€†å‘åˆ†æä¸ä¿¡æ¯è·å–</h3>
<p>ç”±äº L1 çš„ç¡¬ä»¶çº§ä¿æŠ¤ï¼Œç›´æ¥è·å–å†…å®¹å¯†é’¥ï¼ˆContent
Keyï¼‰å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œåˆ†æçš„é‡ç‚¹è½¬å‘äº†è®¸å¯è¯çš„è·å–è¿‡ç¨‹ã€‚</p>
<ul>
<li>*ç›®æ ‡**: æ‹¦æˆª App
ä¸è®¸å¯è¯æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œè·å–è®¸å¯è¯è¯·æ±‚å’Œå“åº”ã€‚</li>
</ul>
<ol type="1">
<li><strong>å®šä½è®¸å¯è¯è¯·æ±‚ä»£ç </strong>:</li>
</ol>
<ul>
<li><p>æœç´¢ <code>MediaDrm</code>, <code>getKeyRequest</code>,
<code>provideKeyResponse</code> ç­‰ <code>android.media</code> åŒ…ä¸­çš„ DRM
ç›¸å…³ APIã€‚</p></li>
<li><p>ä½¿ç”¨ Frida Hook è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥æ‰“å°å‡º
<code>pssh</code>ã€è®¸å¯è¯è¯·æ±‚å’ŒåŠ å¯†çš„è®¸å¯è¯å“åº”ã€‚</p></li>
</ul>
<div class="sourceCode" id="cb424"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>Java<span class="op">.</span><span class="fu">perform</span>(<span class="kw">function</span>() {</span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MediaDrm <span class="op">=</span> Java<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;android.media.MediaDrm&#39;</span>)<span class="op">;</span></span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook getKeyRequest method to capture license requests</span></span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>MediaDrm<span class="op">.</span><span class="at">getKeyRequest</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(scope<span class="op">,</span> initData<span class="op">,</span> mimeType<span class="op">,</span> keyType<span class="op">,</span> optionalParameters) {</span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Intercepting getKeyRequest...&#39;</span>)<span class="op">;</span></span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a><span class="co">// initData is the pssh</span></span>
<span id="cb424-8"><a href="#cb424-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;PSSH (initData):&#39;</span><span class="op">,</span> <span class="fu">bytesToHex</span>(initData))<span class="op">;</span></span>
<span id="cb424-9"><a href="#cb424-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-10"><a href="#cb424-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> keyRequest <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getKeyRequest</span>(scope<span class="op">,</span> initData<span class="op">,</span> mimeType<span class="op">,</span> keyType<span class="op">,</span> optionalParameters)<span class="op">;</span></span>
<span id="cb424-11"><a href="#cb424-11" aria-hidden="true" tabindex="-1"></a><span class="co">// keyRequest is a complex object, needs further parsing</span></span>
<span id="cb424-12"><a href="#cb424-12" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb424-13"><a href="#cb424-13" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> keyRequest<span class="op">;</span></span>
<span id="cb424-14"><a href="#cb424-14" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-15"><a href="#cb424-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-16"><a href="#cb424-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook provideKeyResponse method to capture encrypted license</span></span>
<span id="cb424-17"><a href="#cb424-17" aria-hidden="true" tabindex="-1"></a>MediaDrm<span class="op">.</span><span class="at">provideKeyResponse</span><span class="op">.</span><span class="at">implementation</span> <span class="op">=</span> <span class="kw">function</span>(scope<span class="op">,</span> response) {</span>
<span id="cb424-18"><a href="#cb424-18" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Intercepting provideKeyResponse...&#39;</span>)<span class="op">;</span></span>
<span id="cb424-19"><a href="#cb424-19" aria-hidden="true" tabindex="-1"></a><span class="co">// response is the encrypted license obtained from the server</span></span>
<span id="cb424-20"><a href="#cb424-20" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Encrypted License (response):&#39;</span><span class="op">,</span> <span class="fu">bytesToHex</span>(response))<span class="op">;</span></span>
<span id="cb424-21"><a href="#cb424-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-22"><a href="#cb424-22" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">provideKeyResponse</span>(scope<span class="op">,</span> response)<span class="op">;</span></span>
<span id="cb424-23"><a href="#cb424-23" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-24"><a href="#cb424-24" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb424-25"><a href="#cb424-25" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bytesToHex</span>(arr) { <span class="co">/* ... a function to convert byte array to hex string ... */</span> }</span></code></pre></div>
<ol start="3" type="1">
<li><strong>CDM (å†…å®¹è§£å¯†æ¨¡å—) åˆ†æ</strong>: Widevine çš„ L3 çº§ CDM
æ˜¯ä¸€ä¸ªåŸç”Ÿåº“ï¼ˆ<code>.so</code> æ–‡ä»¶ï¼‰ï¼Œè´Ÿè´£å¤„ç†ç™½ç›’åŠ å¯†çš„é€»è¾‘ã€‚å¯¹è¿™ä¸ª
<code>.so</code>
æ–‡ä»¶è¿›è¡Œæ·±å…¥çš„é™æ€å’ŒåŠ¨æ€åˆ†æï¼Œæ˜¯ç†è®ºä¸Šè¿˜åŸå‡ºè®¾å¤‡å¯†é’¥ï¼ˆDevice
Keyï¼‰çš„å”¯ä¸€é€”å¾„ï¼Œè¿™ä¹Ÿæ˜¯ CDM Challenge
ç­‰æ¯”èµ›çš„æ ¸å¿ƒã€‚è¿™æ˜¯ä¸€ä¸ªæå…¶å¤æ‚å’Œè€—æ—¶çš„è¿‡ç¨‹ã€‚ ___ ## ä¸»æµå¹³å° DRM
ä¸åŠ å¯†æ–¹æ¡ˆå®ä¾‹</li>
</ol>
<h3 id="å›½å†…å¹³å°-ä¼˜é…·çˆ±å¥‡è‰ºè…¾è®¯è§†é¢‘èŠ’æœtv">å›½å†…å¹³å°
(ä¼˜é…·ã€çˆ±å¥‡è‰ºã€è…¾è®¯è§†é¢‘ã€èŠ’æœTV)</h3>
<p>å›½å†…ä¸»æµè§†é¢‘å¹³å°åœ¨åŠ å¯†ç­–ç•¥ä¸Šé€šå¸¸é‡‡ç”¨<strong>â€œè‡ªç ”åŠ å¯†æ–¹æ¡ˆ + æ ‡å‡†
DRMâ€</strong>çš„æ··åˆæ¨¡å¼ã€‚</p>
<ul>
<li><p>å¯¹äºæ‹¥æœ‰å…¨çƒç‰ˆæƒçš„å½±è§†å‰§ï¼ˆå¦‚å¥½è±åå¤§ç‰‡ï¼‰ï¼Œå®ƒä»¬ä¼šä½¿ç”¨è¡Œä¸šæ ‡å‡†çš„
Widevine DRMã€‚</p></li>
<li><p>å¯¹äºå¤§é‡çš„è‡ªåˆ¶å‰§ã€ç»¼è‰ºç­‰å†…å®¹ï¼Œå®ƒä»¬æ›´å€¾å‘äºä½¿ç”¨è‡ªç ”çš„åŠ å¯†æ–¹æ¡ˆï¼Œå…¶æ ¸å¿ƒæ˜¯å¯¹
HLS åè®®è¿›è¡Œæ”¹é€ ã€‚</p></li>
<li><p>*é€šç”¨æ¨¡å¼ï¼šä¿æŠ¤ HLS å¯†é’¥çš„è·å–è¿‡ç¨‹**</p></li>
</ul>
<ol type="1">
<li><strong>è§†é¢‘æµ</strong>: æ™®éä½¿ç”¨ HLS (<code>.m3u8</code>)
åè®®ã€‚</li>
<li><strong>åŠ å¯†ç®—æ³•</strong>: <code>.m3u8</code>
æ–‡ä»¶ä¸­ä¼šå£°æ˜è§†é¢‘åˆ†ç‰‡ï¼ˆ<code>.ts</code> æ–‡ä»¶ï¼‰ä½¿ç”¨
<code>AES-128-CBC</code> åŠ å¯†ã€‚</li>
<li><strong>æ ¸å¿ƒä¿æŠ¤</strong>:
<strong>è§†é¢‘æ•°æ®æœ¬èº«çš„åŠ å¯†ç®—æ³•æ˜¯æ ‡å‡†çš„ï¼Œä½†è·å–è§£å¯†å¯†é’¥ï¼ˆKeyï¼‰çš„è¿‡ç¨‹æ˜¯é«˜åº¦å®šåˆ¶å’Œä¿æŠ¤çš„ã€‚</strong></li>
</ol>
<ul>
<li><p><code>.m3u8</code> æ–‡ä»¶æœ¬èº«ä¸æ˜¯é™æ€çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªéœ€è¦å¤æ‚ç­¾åçš„
API åŠ¨æ€ç”Ÿæˆçš„ã€‚</p></li>
<li><p><code>#EXT-X-KEY</code> æ ‡ç­¾ä¸­æŒ‡å‘çš„å¯†é’¥ URL
(<code>key.key</code>) ä¹Ÿä¸æ˜¯ä¸€ä¸ªèƒ½ç›´æ¥è®¿é—®çš„åœ°å€ï¼Œè®¿é—®å®ƒåŒæ ·éœ€è¦æ­£ç¡®çš„
Cookieã€Referer å’ŒåŠ å¯†å‚æ•°ã€‚</p></li>
</ul>
<ol start="4" type="1">
<li><strong>é€†å‘å…³é”®</strong>:</li>
</ol>
<ul>
<li><p><strong>å®šä½æ’­æ”¾ API</strong>: é€†å‘çš„é‡ç‚¹æ˜¯æ‰¾åˆ° App
ä¸­è´Ÿè´£è¯·æ±‚è§†é¢‘æ’­æ”¾ä¿¡æ¯çš„ APIã€‚è¿™ä¸ª API çš„è¯·æ±‚å‚æ•°é€šå¸¸åŒ…å«è§†é¢‘
IDã€æ¸…æ™°åº¦ã€ä»¥åŠä¸€ä¸ªç±»ä¼¼æˆ‘ä»¬åœ¨ä¸Šä¸€ç« åˆ†æè¿‡çš„ã€åŒ…å«è®¾å¤‡æŒ‡çº¹å’Œæ—¶é—´æˆ³çš„
<code>sign</code> æˆ– <code>token</code>ã€‚</p></li>
<li><p><strong>æ¨¡æ‹Ÿåˆæ³•è¯·æ±‚</strong>: åªè¦èƒ½å¤ŸæˆåŠŸæ¨¡æ‹Ÿè¿™ä¸ª API
çš„è°ƒç”¨ï¼Œå°±èƒ½è·å–åˆ°ä¸€ä¸ªåŒ…å«äº†æœ‰æ•ˆå¯†é’¥ URL çš„ <code>.m3u8</code>
æ–‡ä»¶ã€‚æ‹¿åˆ°å¯†é’¥åï¼Œå°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ <code>AES-128</code> ç®—æ³•è§£å¯†
<code>.ts</code> æ–‡ä»¶å¹¶åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„è§†é¢‘ã€‚</p></li>
<li><p><strong>è…¾è®¯è§†é¢‘çš„ <code>vkey</code></strong>:
ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯è…¾è®¯è§†é¢‘ï¼Œå…¶æ’­æ”¾ API ä¸­éœ€è¦ä¸€ä¸ªè‡³å…³é‡è¦çš„
<code>vkey</code> å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ç”Ÿæˆç®—æ³•å°±å°è£…åœ¨å®¢æˆ·ç«¯çš„ SO
åº“ä¸­ã€‚</p></li>
</ul>
<h3 id="å›½å¤–å¹³å°-netflix-youtube-hulu-hbo-max">å›½å¤–å¹³å° (Netflix,
YouTube, Hulu, HBO Max)</h3>
<p>å›½å¤–ä¸»æµè§†é¢‘å¹³å°ï¼Œç‰¹åˆ«æ˜¯å†…å®¹æä¾›å•†ï¼Œä¸¥æ ¼ä¸”æ·±åº¦åœ°ä¾èµ–æ ‡å‡†åŒ–çš„ DRM
ä½“ç³»ã€‚é€†å‘çš„ç„¦ç‚¹<strong>å®Œå…¨ä¸åœ¨äºåˆ†æè§†é¢‘æ–‡ä»¶æ ¼å¼æˆ–ç®—æ³•ï¼Œè€Œåœ¨äº DRM
è®¸å¯è¯çš„è·å–æµç¨‹</strong>ã€‚</p>
<h4 id="netflix-hulu-hbo-max">Netflix / Hulu / HBO Max</h4>
<ul>
<li><p><strong>DRM æ–¹æ¡ˆ</strong>: åœ¨ Android ä¸Šæ— ä¸€ä¾‹å¤–åœ°ä½¿ç”¨ Google
Widevineï¼Œåœ¨è‹¹æœè®¾å¤‡ä¸Šä½¿ç”¨ FairPlayã€‚</p></li>
<li><p><strong>å®‰å…¨çº§åˆ«</strong>: å¯¹äºé«˜æ¸…å†…å®¹ï¼ˆHD, 4Kï¼‰ï¼Œå¼ºåˆ¶è¦æ±‚è®¾å¤‡çš„
Widevine å®‰å…¨çº§åˆ«ä¸º L1ã€‚è¿™æ„å‘³ç€å¯†é’¥äº¤æ¢å’Œå†…å®¹è§£å¯†å…¨ç¨‹åœ¨ç¡¬ä»¶ TEE
ä¸­å®Œæˆï¼ŒApp å’Œæ“ä½œç³»ç»Ÿå‡æ— æ³•è§¦åŠæ˜æ–‡å¯†é’¥ã€‚</p></li>
<li><p><strong>è®¸å¯è¯è¯·æ±‚ä¿æŠ¤</strong>: é€†å‘çš„å”¯ä¸€ç€çœ¼ç‚¹æ˜¯ App
å‘èµ·è®¸å¯è¯è¯·æ±‚çš„è¿‡ç¨‹ã€‚</p></li>
<li><p>è¿™ä¸ªè¯·æ±‚è¢«å¤šç§æ–¹å¼ä¿æŠ¤ï¼Œä¾‹å¦‚ Netflix ä½¿ç”¨è‡ªç ”çš„ <strong>MSL
(Message Security Layer)</strong>
åè®®å¯¹è®¸å¯è¯è¯·æ±‚æœ¬èº«è¿›è¡ŒäºŒæ¬¡å°è£…å’ŒåŠ å¯†ã€‚</p></li>
<li><p>App
ä¼šé‡‡é›†å¤§é‡è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ï¼Œè¿åŒç”¨æˆ·çš„èº«ä»½å‡­è¯ä¸€èµ·ï¼Œç”¨äºç”Ÿæˆè®¸å¯è¯è¯·æ±‚ã€‚æœåŠ¡ç«¯çš„é£æ§ç³»ç»Ÿä¼šä¸¥æ ¼æ ¡éªŒè¿™äº›ä¿¡æ¯ï¼Œä»¥ç¡®ä¿è¯·æ±‚æ¥è‡ªäºä¸€ä¸ªåˆæ³•çš„ã€æœªè¢«ç¯¡æ”¹çš„å®˜æ–¹
App å®¢æˆ·ç«¯ã€‚</p></li>
<li><p><strong>é€†å‘ç»“è®º</strong>: åœ¨ L1 ä¿æŠ¤ä¸‹ï¼Œé€šè¿‡é€†å‘ App
æ¥è·å–è§†é¢‘è§£å¯†å¯†é’¥ä»¥è¿›è¡Œç¦»çº¿ä¸‹è½½æ˜¯<strong>å‡ ä¹ä¸å¯èƒ½</strong>çš„ã€‚åˆ†æçš„ä¸»è¦æ„ä¹‰åœ¨äºç†è§£å…¶æ¶æ„å’Œå®‰å…¨å¼ºåº¦ã€‚</p></li>
</ul>
<h4 id="youtube">YouTube</h4>
<p>YouTube çš„æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒéœ€è¦åŒºåˆ†å¯¹å¾…ï¼š</p>
<ul>
<li><p><strong>ä»˜è´¹å†…å®¹ (YouTube Premium / ç”µå½±)</strong>: ä¸ Netflix
ç±»ä¼¼ï¼Œä½¿ç”¨æ ‡å‡†çš„ Widevine DRM è¿›è¡Œä¿æŠ¤ã€‚</p></li>
<li><p><strong>æ™®é€š UGC å†…å®¹</strong>: å¤§éƒ¨åˆ†è§†é¢‘æ²¡æœ‰ä½¿ç”¨ DRM
åŠ å¯†ï¼Œä½†ä½¿ç”¨äº†å¦ä¸€ç§å·§å¦™çš„ä¿æŠ¤æ–¹å¼â€”â€”<strong>åŠ¨æ€ URL
ç­¾å</strong>ã€‚</p></li>
<li><p><strong>ç°è±¡</strong>: ä½¿ç”¨ <code>youtube-dl</code>
ç­‰å·¥å…·ä¸‹è½½è§†é¢‘æ—¶ï¼Œä¼šçœ‹åˆ°å®ƒæœ‰ä¸€ä¸ªâ€deciphering signatureâ€çš„è¿‡ç¨‹ã€‚</p></li>
<li><p><strong>åŸç†</strong>: è§†é¢‘æµçš„ URL ä¸­åŒ…å«ä¸€ä¸ª <code>s</code> æˆ–
<code>sig</code> å‚æ•°ï¼Œè¿™ä¸ªç­¾åæ˜¯ç”±ä¸€æ®µæ··æ·†è¿‡çš„ JavaScript ä»£ç ï¼ˆåœ¨ Web
ç«¯ï¼‰æˆ– Native ä»£ç ï¼ˆåœ¨ App ç«¯ï¼‰åŠ¨æ€ç”Ÿæˆçš„ã€‚è¯¥ç®—æ³•å°†è§†é¢‘çš„
<code>cipher</code> (ä¸€æ®µåŠ å¯†å­—ç¬¦ä¸²)
å’Œå…¶ä»–å‚æ•°ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€ä¸ªè§£å¯†çš„ç­¾åã€‚</p></li>
<li><p><strong>é€†å‘å…³é”®</strong>: é€†å‘çš„é‡ç‚¹ä¸å†æ˜¯
DRMï¼Œè€Œæ˜¯<strong>æ‰¾åˆ°å¹¶è¿˜åŸé‚£æ®µè´Ÿè´£è®¡ç®—ç­¾åçš„ JavaScript/Native
å‡½æ•°</strong>ã€‚ç”±äºä»£ç ç»è¿‡äº†é«˜åº¦æ··æ·†ï¼Œè¿™ä¾ç„¶æ˜¯ä¸€é¡¹å…·æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œã€‚</p></li>
</ul>
<h2 id="æ€»ç»“-2">æ€»ç»“</h2>
<p>è§†é¢‘ App çš„ DRM é€†å‘æ˜¯ä¸€åœºä¸ç¡¬ä»¶å’Œå¤æ‚å¯†ç å­¦åè®®çš„è‰°è‹¦æ–—äº‰ã€‚ä¸éŸ³ä¹
App
ä¸åŒï¼Œå…¶æ ¸å¿ƒç›®æ ‡é€šå¸¸ä¸æ˜¯å¼€å‘ä¸€ä¸ªâ€ä¸‹è½½å™¨â€ï¼Œè€Œæ˜¯ç†è§£å…¶å®‰å…¨ä½“ç³»çš„å¼ºåº¦å’Œå¼±ç‚¹ã€‚</p>
<ul>
<li><p>å¯¹äºæ™®é€šåˆ†æï¼Œé‡ç‚¹æ˜¯<strong>æ‹¦æˆªå’Œç†è§£ä¿¡ä»¤</strong>ï¼ˆæ¸…å•æ–‡ä»¶ã€è®¸å¯è¯è¯·æ±‚/å“åº”ï¼‰ã€‚</p></li>
<li><p>å¯¹äºé«˜çº§ç ”ç©¶ï¼Œæ ¸å¿ƒæ˜¯<strong>æ”»å‡» L3 çš„ CDM
å®ç°</strong>ï¼Œä½†è¿™éœ€è¦æé«˜çš„é€†å‘å·¥ç¨‹å’Œå¯†ç å­¦çŸ¥è¯†ã€‚</p></li>
</ul>
<p>è¿™ä¸ªé¢†åŸŸçš„æ”»é˜²æ°´å¹³ä»£è¡¨äº†æ•´ä¸ªè¡Œä¸šå®‰å…¨å¯¹æŠ—çš„é¡¶å³°ã€‚</p>
<!-- 04-Reference/Advanced/android_sandbox_implementation.md -->
<h1 id="android-æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—">android æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—</h1>
<p>Android æ²™ç®±æŠ€æœ¯ï¼Œé€šå¸¸ä¹Ÿè¢«ç§°ä¸ºâ€è™šæ‹ŸåŒ–å¼•æ“â€æˆ–â€App
å¤šå¼€æ¡†æ¶â€ï¼Œæ˜¯ä¸€ç§åœ¨å•ä¸ª Android
è®¾å¤‡ä¸Šåˆ›å»ºéš”ç¦»ç¯å¢ƒä»¥è¿è¡Œå…¶ä»–åº”ç”¨ç¨‹åºçš„æŠ€æœ¯ã€‚å®ƒå…è®¸ä¸€ä¸ªâ€å®¿ä¸»â€åº”ç”¨ç¨‹åºåœ¨è‡ªå·±çš„è¿›ç¨‹ç©ºé—´å†…åŠ è½½å¹¶è¿è¡Œä¸€ä¸ªâ€æ’ä»¶â€åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å¯¹æ’ä»¶åº”ç”¨çš„æ‰€æœ‰ç³»ç»Ÿäº¤äº’è¿›è¡Œæ‹¦æˆªå’Œç®¡ç†ã€‚</p>
<p>è¿™é¡¹æŠ€æœ¯çš„æ ¸å¿ƒåº”ç”¨åŒ…æ‹¬ï¼šåº”ç”¨å¤šå¼€ã€æ— æ„ŸçŸ¥éšç§ä¿æŠ¤ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»¥åŠå…å®‰è£…è¿è¡Œ
Appã€‚ ___ ## ç›®å½• 1. <a
href="#æ ¸å¿ƒæ¦‚å¿µæ²™ç®±-vs-è™šæ‹Ÿæœº"><strong>æ ¸å¿ƒæ¦‚å¿µï¼šæ²™ç®±
vs.Â è™šæ‹Ÿæœº</strong></a> 2. <a
href="#æ²™ç®±å®ç°åŸç†è¯¦è§£"><strong>æ²™ç®±å®ç°åŸç†è¯¦è§£</strong></a></p>
<ul>
<li><p><a href="#1-ç±»åŠ è½½-class-loading"><strong>1. ç±»åŠ è½½ (Class
Loading)</strong></a></p></li>
<li><p><a href="#2-ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†-component-lifecycle"><strong>2.
ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç† (Component Lifecycle)</strong></a></p></li>
<li><p><a
href="#3-ç³»ç»ŸæœåŠ¡-hook-api-hooking-via-binder-proxy"><strong>3. ç³»ç»ŸæœåŠ¡
Hook (API Hooking via Binder Proxy)</strong></a></p></li>
<li><p><a href="#4-èµ„æºç®¡ç†-resource-management"><strong>4. èµ„æºç®¡ç†
(Resource Management)</strong></a></p></li>
</ul>
<ol start="3" type="1">
<li><a
href="#å®ç°ä¸€ä¸ªæœ€å°åŒ–æ²™ç®±çš„æ­¥éª¤"><strong>å®ç°ä¸€ä¸ªæœ€å°åŒ–æ²™ç®±çš„æ­¥éª¤</strong></a></li>
<li><a
href="#çŸ¥åå¼€æºé¡¹ç›®å‚è€ƒ"><strong>çŸ¥åå¼€æºé¡¹ç›®å‚è€ƒ</strong></a></li>
<li><a href="#æŒ‘æˆ˜ä¸å±€é™"><strong>æŒ‘æˆ˜ä¸å±€é™</strong></a> ___ ###
æ ¸å¿ƒæ¦‚å¿µï¼šæ²™ç®± vs.Â è™šæ‹Ÿæœº</li>
</ol>
<ul>
<li><p><strong>è™šæ‹Ÿæœº (VM)</strong>:
åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ã€ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿï¼Œæ‹¥æœ‰è‡ªå·±çš„å†…æ ¸å’Œç³»ç»ŸæœåŠ¡ï¼Œèµ„æºå¼€é”€å·¨å¤§ã€‚</p></li>
<li><p><strong>Android æ²™ç®±</strong>: ä¸åˆ›å»ºç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿã€‚å®ƒè¿è¡Œåœ¨å®¿ä¸»
App çš„è¿›ç¨‹ä¸­ï¼Œä¸å®¿ä¸»å…±äº«åŒä¸€ä¸ª Android
ç³»ç»Ÿå†…æ ¸å’Œè¿è¡Œæ—¶ã€‚å®ƒé€šè¿‡<strong>API Hooking</strong>çš„æ–¹å¼ï¼Œä¸ºæ’ä»¶ App
åˆ›é€ äº†ä¸€ä¸ªâ€è™šæ‹Ÿçš„â€è¿è¡Œç¯å¢ƒï¼Œæ‹¦æˆªå’Œé‡å®šå‘å…¶å¯¹ç³»ç»ŸæœåŠ¡çš„è¯·æ±‚ã€‚æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>è¿›ç¨‹å†…è™šæ‹ŸåŒ–</strong>ã€‚
___ ### æ²™ç®±å®ç°åŸç†è¯¦è§£</p></li>
</ul>
<p>å®ç°ä¸€ä¸ª Android æ²™ç®±éœ€è¦è§£å†³å››å¤§æ ¸å¿ƒé—®é¢˜ï¼š</p>
<h4 id="ç±»åŠ è½½-class-loading">1. ç±»åŠ è½½ (Class Loading)</h4>
<p>ç”±äºæ’ä»¶ App å¹¶æœªè¢«ç³»ç»Ÿâ€å®‰è£…â€ï¼Œå…¶ä»£ç ä¸èƒ½é€šè¿‡å¸¸è§„çš„
<code>PathClassLoader</code> åŠ è½½ã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: ä½¿ç”¨ <code>DexClassLoader</code>ã€‚å®¿ä¸»
App éœ€è¦åˆ›å»ºä¸€ä¸ª <code>DexClassLoader</code> å®ä¾‹ï¼Œå°†æ’ä»¶ APK
çš„è·¯å¾„å’Œå®¿ä¸» App çš„ç§æœ‰æ•°æ®ç›®å½•ï¼ˆç”¨äºå­˜æ”¾ä¼˜åŒ–åçš„ ODEX
æ–‡ä»¶ï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™æ ·ï¼Œå®¿ä¸» App å°±èƒ½åŠ è½½å¹¶å®ä¾‹åŒ–æ’ä»¶ App
ä¸­çš„ä»»æ„ç±»ã€‚</li>
</ul>
<h4 id="ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†-component-lifecycle">2. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
(Component Lifecycle)</h4>
<p>æ’ä»¶ App çš„ç»„ä»¶ï¼ˆActivity, Service ç­‰ï¼‰å¹¶æ²¡æœ‰åœ¨å®¿ä¸» App çš„
<code>AndroidManifest.xml</code> ä¸­æ³¨å†Œï¼Œå› æ­¤æ— æ³•è¢«ç³»ç»Ÿç›´æ¥å¯åŠ¨ã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: <strong>å å‘ (Stub/Proxy
Component)</strong>ã€‚</li>
</ul>
<ol type="1">
<li><strong>åœ¨å®¿ä¸»ä¸­é¢„æ³¨å†Œ</strong>: åœ¨å®¿ä¸» App çš„
<code>AndroidManifest.xml</code> ä¸­é¢„å…ˆæ³¨å†Œä¸€ç³»åˆ—â€å å‘â€çš„ç»„ä»¶ï¼Œä¾‹å¦‚
<code>StubActivity1</code>, <code>StubActivity2</code>,
<code>StubService1</code>â€¦</li>
<li><strong>è¯·æ±‚æ‹¦æˆªä¸æ›¿æ¢</strong>: å½“æ’ä»¶ App æƒ³è¦å¯åŠ¨ä¸€ä¸ªç»„ä»¶æ—¶ï¼ˆä¾‹å¦‚
<code>startActivity(intentToPluginActivity)</code>ï¼‰ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè¢«æˆ‘ä»¬ä¸‹ä¸€æ­¥è¦è®²çš„ç³»ç»ŸæœåŠ¡
Hook æ‹¦æˆªåˆ°ã€‚</li>
<li><strong>ç§»èŠ±æ¥æœ¨</strong>:
æ‹¦æˆªåˆ°è¯·æ±‚åï¼Œæ²™ç®±æ¡†æ¶ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å‘â€å å‘â€Activity çš„æ–°
<code>Intent</code> (<code>intentToStubActivity</code>)ï¼Œå¹¶å°†åŸå§‹çš„
<code>Intent</code> ä½œä¸º extra æ•°æ®é™„åŠ åˆ°æ–° <code>Intent</code>
ä¸Šã€‚ç„¶åï¼Œå®ƒä¼šç”¨è¿™ä¸ªæ–°çš„ <code>Intent</code> å»è°ƒç”¨åŸå§‹çš„ç³»ç»ŸæœåŠ¡ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸå§”æ‰˜</strong>: ç³»ç»Ÿå¯åŠ¨äº†
<code>StubActivity</code>ã€‚åœ¨ <code>StubActivity</code> çš„
<code>onCreate</code> æ–¹æ³•ä¸­ï¼Œå®ƒä¼šä» extra ä¸­æ¢å¤å‡ºåŸå§‹
<code>Intent</code>ï¼Œå¾—çŸ¥è‡ªå·±éœ€è¦æ‰®æ¼”å“ªä¸ªæ’ä»¶ Activity
çš„è§’è‰²ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨ç¬¬ä¸€æ­¥çš„ <code>DexClassLoader</code>
å®ä¾‹åŒ–çœŸæ­£çš„æ’ä»¶ Activityï¼Œå¹¶æ‰‹åŠ¨è°ƒç”¨å…¶ <code>onCreate</code>,
<code>onStart</code>, <code>onResume</code>
ç­‰æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå°†è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸâ€å§”æ‰˜â€ç»™æ’ä»¶ Activityã€‚</li>
</ol>
<h4 id="ç³»ç»ŸæœåŠ¡-hook-api-hooking-via-binder-proxy">3. ç³»ç»ŸæœåŠ¡ Hook
(API Hooking via Binder Proxy)</h4>
<p>è¿™æ˜¯æ•´ä¸ªæ²™ç®±æŠ€æœ¯<strong>æœ€æ ¸å¿ƒã€æœ€å¤æ‚</strong>çš„éƒ¨åˆ†ã€‚æ’ä»¶ App
çš„æ‰€æœ‰è¡Œä¸ºï¼Œå¦‚å¯åŠ¨
Activityã€å‘é€å¹¿æ’­ã€è®¿é—®æ•°æ®åº“ï¼Œéƒ½æ˜¯é€šè¿‡è°ƒç”¨ç³»ç»ŸæœåŠ¡å®Œæˆçš„ã€‚æˆ‘ä»¬å¿…é¡»æ‹¦æˆªè¿™äº›è°ƒç”¨ã€‚</p>
<ul>
<li><p><strong>ç›®æ ‡</strong>: Android çš„å„ç§ <code>XXXManager</code>ï¼ˆå¦‚
<code>ActivityManager</code>,
<code>PackageManager</code>ï¼‰å®é™…ä¸Šéƒ½æ˜¯é€šè¿‡ Binder IPC ä¸ç³»ç»ŸæœåŠ¡
(<code>ActivityManagerService</code>,
<code>PackageManagerService</code>) é€šä¿¡çš„ã€‚æˆ‘ä»¬éœ€è¦ Hook
çš„å°±æ˜¯è¿™ä¸ªé€šä¿¡çš„æ¥å£ã€‚</p></li>
<li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>: <strong>åŠ¨æ€ä»£ç† (Dynamic
Proxy)</strong>ã€‚</p></li>
</ul>
<ol type="1">
<li><strong>å®šä½ Binder æ¥å£</strong>: ä½¿ç”¨ Java åå°„æ‰¾åˆ°
<code>ActivityManager</code> ç­‰ç±»ä¸­æŒæœ‰çš„ <code>IActivityManager</code>
ç±»å‹çš„ Binder ä»£ç†å¯¹è±¡ã€‚</li>
<li><strong>åˆ›å»ºä»£ç†å¯¹è±¡</strong>: ä½¿ç”¨
<code>java.lang.reflect.Proxy.newProxyInstance()</code> æ–¹æ³•ï¼Œä¸ºåŸå§‹çš„
<code>IActivityManager</code> Binder ä»£ç†å¯¹è±¡åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ã€‚</li>
<li><strong>å®ç° <code>InvocationHandler</code></strong>: åœ¨
<code>InvocationHandler</code> çš„ <code>invoke</code>
æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ‰€æœ‰å¯¹ <code>IActivityManager</code>
æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼ˆå¦‚ <code>startActivity</code>,
<code>getRunningAppProcesses</code> ç­‰ï¼‰ã€‚</li>
<li><strong>è¯·æ±‚é‡å®šå‘</strong>: åœ¨ <code>invoke</code>
æ–¹æ³•ä¸­ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ¥è‡ªæ’ä»¶
Appã€‚å¦‚æœæ˜¯ï¼Œå°±ä¸æ‰§è¡ŒåŸå§‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯å°†å…¶é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±çš„æ²™ç®±ç®¡ç†é€»è¾‘ä¸­ï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œä¸Šè¿°çš„â€å å‘â€æµç¨‹ï¼‰ã€‚å¦‚æœä¸æ˜¯ï¼Œå°±è°ƒç”¨åŸå§‹çš„
Binder æ–¹æ³•ï¼Œä¿è¯å®¿ä¸» App è‡ªèº«åŠŸèƒ½æ­£å¸¸ã€‚</li>
</ol>
<h4 id="èµ„æºç®¡ç†-resource-management">4. èµ„æºç®¡ç† (Resource
Management)</h4>
<p>æ’ä»¶ App éœ€è¦åŠ è½½è‡ªå·±çš„å¸ƒå±€ã€å­—ç¬¦ä¸²ã€å›¾ç‰‡ç­‰èµ„æºã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Resources</code>
å¯¹è±¡ã€‚</li>
</ul>
<ol type="1">
<li>é€šè¿‡ <code>AssetManager</code> çš„éšè—æ–¹æ³•
<code>addAssetPath()</code>ï¼Œå°†æ’ä»¶ APK çš„è·¯å¾„æ·»åŠ åˆ°
<code>AssetManager</code> ä¸­ã€‚</li>
<li>åŸºäºè¿™ä¸ª <code>AssetManager</code> åˆ›å»ºä¸€ä¸ªæ–°çš„
<code>Resources</code> å¯¹è±¡ã€‚</li>
<li>åœ¨åˆ›å»ºæ’ä»¶ Activity ç­‰ç»„ä»¶æ—¶ï¼Œå°†è¿™ä¸ªè‡ªå®šä¹‰çš„ <code>Resources</code>
å¯¹è±¡æ³¨å…¥åˆ°å…¶ <code>Context</code> ä¸­ï¼Œä»è€Œè®©å®ƒå¯ä»¥è®¿é—®åˆ°è‡ªå·±çš„èµ„æºã€‚ ___
### å®ç°ä¸€ä¸ªæœ€å°åŒ–æ²™ç®±çš„æ­¥éª¤</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯åŠ¨æ’ä»¶ Activity çš„æç®€æµç¨‹ï¼š</p>
<ol type="1">
<li><strong>å‡†å¤‡</strong>:</li>
</ol>
<ul>
<li><p>ä¸€ä¸ªå®¿ä¸» Appã€‚</p></li>
<li><p>ä¸€ä¸ªæ’ä»¶ App çš„ APK æ–‡ä»¶ã€‚</p></li>
<li><p>åœ¨å®¿ä¸» App çš„ <code>AndroidManifest.xml</code> ä¸­æ³¨å†Œä¸€ä¸ª
<code>StubActivity</code>ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>Hook AMS</strong>: åœ¨å®¿ä¸» App å¯åŠ¨æ—¶ï¼ˆå¦‚
<code>Application.onCreate</code>ï¼‰ï¼Œé€šè¿‡åå°„å’ŒåŠ¨æ€ä»£ç†ï¼ŒHook
<code>IActivityManager</code>ã€‚</li>
<li><strong>åŠ è½½æ’ä»¶</strong>: å½“ç”¨æˆ·è§¦å‘â€å¯åŠ¨æ’ä»¶â€æ“ä½œæ—¶ï¼š</li>
</ol>
<ul>
<li><p>åˆ›å»º <code>DexClassLoader</code> å’Œè‡ªå®šä¹‰ <code>Resources</code>
å¯¹è±¡ã€‚</p></li>
<li><p>æ„é€ ä¸€ä¸ªæŒ‡å‘æ’ä»¶ä¸» Activity çš„ <code>Intent</code>ã€‚</p></li>
<li><p>è°ƒç”¨ <code>startActivity(pluginIntent)</code>ã€‚</p></li>
</ul>
<ol start="4" type="1">
<li><strong>æ‹¦æˆªä¸æ›¿æ¢</strong>:</li>
</ol>
<ul>
<li><p><code>IActivityManager</code> çš„åŠ¨æ€ä»£ç† <code>invoke</code>
æ–¹æ³•æ‹¦æˆªåˆ°è¿™ä¸ª <code>startActivity</code> è°ƒç”¨ã€‚</p></li>
<li><p><code>invoke</code> æ–¹æ³•å‘ç°è¿™æ˜¯ä¸€ä¸ªæ’ä»¶
<code>Intent</code>ï¼Œäºæ˜¯å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ <code>StubActivity</code> çš„
<code>Intent</code>ï¼Œå¹¶å°†åŸ <code>Intent</code> å­˜å…¥ extraã€‚</p></li>
</ul>
<ol start="5" type="1">
<li><strong>å¯åŠ¨ä¸è¿˜åŸ</strong>:</li>
</ol>
<ul>
<li><p>ç³»ç»Ÿæ­£å¸¸å¯åŠ¨ <code>StubActivity</code>ã€‚</p></li>
<li><p><code>StubActivity</code> åœ¨ <code>onCreate</code> ä¸­ï¼Œè§£æå‡ºæ’ä»¶
Activity çš„ç±»åã€‚</p></li>
<li><p>ä½¿ç”¨ <code>DexClassLoader</code> åå°„åˆ›å»ºæ’ä»¶ Activity
å®ä¾‹ã€‚</p></li>
<li><p>å°†è‡ªå®šä¹‰ <code>Resources</code> ç­‰æ³¨å…¥æ’ä»¶ Activity çš„
<code>Context</code>ã€‚</p></li>
<li><p>æ‰‹åŠ¨è°ƒç”¨æ’ä»¶ Activity çš„ <code>onCreate()</code>
ç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p></li>
</ul>
<p>è‡³æ­¤ï¼Œæ’ä»¶ Activity çš„ç•Œé¢å°±æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯è¿è¡Œåœ¨
<code>StubActivity</code> çš„â€å£³â€é‡Œã€‚ ___ ### çŸ¥åå¼€æºé¡¹ç›®å‚è€ƒ</p>
<p>ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªå®Œæ•´çš„æ²™ç®±æ¡†æ¶éå¸¸å›°éš¾ï¼Œä»¥ä¸‹é¡¹ç›®æ˜¯æä½³çš„å­¦ä¹ èµ„æºï¼š</p>
<ul>
<li><p><strong>VirtualApp</strong>: æœ€è‘—åçš„ Android
æ²™ç®±é¡¹ç›®ä¹‹ä¸€ï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜¯å­¦ä¹ åŸç†çš„ç»ä½³èŒƒä¾‹ã€‚</p></li>
<li><p><strong>DroidPlugin</strong>: ç”± 360
å¼€å‘çš„æ—©æœŸæ²™ç®±é¡¹ç›®ï¼Œå¯¹å››å¤§ç»„ä»¶çš„æ”¯æŒéå¸¸å®Œæ•´ã€‚ ___ ###
æŒ‘æˆ˜ä¸å±€é™</p></li>
<li><p><strong>å…¼å®¹æ€§</strong>: Android
ç‰ˆæœ¬æ¯æ¬¡å¤§æ›´æ–°ï¼Œå¤§é‡ç³»ç»ŸæœåŠ¡å†…éƒ¨å®ç°ä¼šæ”¹å˜ï¼Œéœ€è¦æŒç»­é€‚é…ã€‚</p></li>
<li><p><strong>å¤æ‚æ€§</strong>: éœ€è¦å¤„ç†å››å¤§ç»„ä»¶ã€æ–‡ä»¶ç³»ç»Ÿã€Content
Providerã€ç³»ç»Ÿå¹¿æ’­ç­‰æ–¹æ–¹é¢é¢çš„è™šæ‹ŸåŒ–ã€‚</p></li>
<li><p><strong>Native Code</strong>: å¯¹åŒ…å« JNI/Native ä»£ç çš„ App
æ”¯æŒèµ·æ¥æ›´å¤æ‚ï¼Œå¯èƒ½éœ€è¦å¯¹ so æ–‡ä»¶çš„åŠ è½½å’Œç¬¦å·è§£æè¿›è¡Œ Hookã€‚</p></li>
<li><p><strong>å‚å•† ROM</strong>: ä¸åŒæ‰‹æœºå‚å•†å¯¹ Android
ç³»ç»Ÿçš„é­”æ”¹ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ²™ç®±åœ¨æŸäº›è®¾å¤‡ä¸Šå¤±æ•ˆã€‚</p></li>
</ul>
<!-- 04-Reference/Advanced/aosp_and_system_customization.md -->
<h1 id="aosp-ä¸-android-ç³»ç»Ÿè£å‰ª">AOSP ä¸ android ç³»ç»Ÿè£å‰ª</h1>
<p>Android å¼€æºé¡¹ç›®ï¼ˆAOSPï¼‰æ˜¯ Android æ“ä½œç³»ç»Ÿçš„å¼€æºåŸºç¡€ã€‚èƒ½å¤Ÿç¼–è¯‘å’Œä¿®æ”¹
AOSP æ˜¯è¿›è¡Œæ·±åº¦ç³»ç»Ÿçº§å®šåˆ¶ã€å®‰å…¨ç ”ç©¶å’Œ ROM å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æœ¬èŠ‚å°†ä»‹ç»
AOSP çš„åŸºæœ¬æ¦‚å¿µã€ç¼–è¯‘æµç¨‹ä»¥åŠå¸¸è§çš„ç³»ç»Ÿè£å‰ªæŠ€æœ¯ã€‚ ___ ## 1. AOSP
åŸºç¡€ä¸ç¼–è¯‘</p>
<h3 id="a-aosp-æºç åŒæ­¥">a) AOSP æºç åŒæ­¥</h3>
<p>ç¼–è¯‘ AOSP çš„ç¬¬ä¸€æ­¥æ˜¯è·å–å…¶åºå¤§çš„æºä»£ç æ ‘ã€‚</p>
<ol type="1">
<li><strong>ç¯å¢ƒå‡†å¤‡</strong>:</li>
</ol>
<ul>
<li><p>ä¸€ä¸ªå¼ºå¤§çš„ Linux æ„å»ºæœåŠ¡å™¨ï¼ˆæ¨è Ubuntu LTSï¼‰ï¼Œè‡³å°‘éœ€è¦ 16GB RAM
å’Œ 300GB çš„å¯ç”¨ç£ç›˜ç©ºé—´ã€‚</p></li>
<li><p>å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…ï¼Œå¦‚ <code>git</code>, <code>curl</code>,
<code>python</code>, <code>Java SDK</code> ç­‰ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>è·å– Repo å·¥å…·</strong>: <code>Repo</code> æ˜¯ Google
å¼€å‘çš„ã€åŸºäº Git çš„ä»£ç åº“ç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç† AOSP ä¸­æ•°ç™¾ä¸ªä¸åŒçš„ Git
ä»“åº“ã€‚ ```bash # Download Repo Tool mkdir -p ~/.bin curl
https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/.bin/repo
chmod a+x ~/.bin/repo export PATH=~/.bin:$PATH</li>
</ol>
<pre><code>    ```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir aosp &amp;&amp; cd aosp

# åˆå§‹åŒ–æºç ä»“åº“ï¼ŒæŒ‡å®šåˆ†æ”¯ï¼ˆFor exampleï¼Œandroid-12.0.0_r1ï¼‰
repo init -u https://android.googlesource.com/platform/manifest -b android-12.0.0_r1 --depth=1

# StartSynchronizationæºç ï¼ˆThisWillisä¸€Long processï¼‰
repo sync -c -j8
</code></pre>
<ul>
<li><p><code>--depth=1</code>: åªåŒæ­¥æœ€æ–°çš„
commitï¼Œå¤§å¹…å‡å°‘ä¸‹è½½é‡ã€‚</p></li>
<li><p><code>-c</code>: åªåŒæ­¥å½“å‰åˆ†æ”¯ã€‚</p></li>
<li><p><code>-j8</code>: ä½¿ç”¨ 8 ä¸ªçº¿ç¨‹å¹¶è¡ŒåŒæ­¥ã€‚</p></li>
</ul>
<h3 id="b-ç¼–è¯‘æµç¨‹">b) ç¼–è¯‘æµç¨‹</h3>
<ol type="1">
<li><strong>è®¾ç½®ç¯å¢ƒ</strong>: ```bash source build/envsetup.sh</li>
</ol>
<pre><code>
2. **é€‰æ‹©ç›®æ ‡ (Lunch)**:
    ```bash
lunch
</code></pre>
<ul>
<li><p><code>aosp_arm64</code>: ç›®æ ‡è®¾å¤‡æ¶æ„ï¼ˆ64ä½ ARMï¼‰ã€‚</p></li>
<li><p><code>eng</code>:
æ„å»ºå˜ä½“ï¼ˆEngineeringï¼‰ï¼ŒåŒ…å«æœ€å¤šçš„è°ƒè¯•å·¥å…·ï¼Œæƒé™ä¸º
rootï¼Œé€‚åˆå¼€å‘å’Œé€†å‘ã€‚å…¶ä»–è¿˜æœ‰ <code>user</code>ï¼ˆå‘å¸ƒç‰ˆï¼‰å’Œ
<code>userdebug</code>ï¼ˆå¸¦ root å’Œè°ƒè¯•åŠŸèƒ½çš„ç”¨æˆ·ç‰ˆï¼‰ã€‚</p></li>
</ul>
<ol start="3" type="1">
<li><strong>å¼€å§‹ç¼–è¯‘ (Make)</strong>: ```bash m</li>
</ol>
<pre><code>
4. **ç¼–è¯‘äº§ç‰©**:
ç¼–è¯‘å®Œæˆåï¼Œæ‰€æœ‰çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶éƒ½å­˜æ”¾åœ¨ `out/target/product/&lt;device_name&gt;/` ç›®å½•ä¸‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

* `system.img`: ç³»ç»Ÿåˆ†åŒºé•œåƒã€‚

* `vendor.img`: å‚å•†åˆ†åŒºé•œåƒã€‚

* `boot.img`: å¯åŠ¨åˆ†åŒºé•œåƒï¼ŒåŒ…å«å†…æ ¸å’Œ ramdiskã€‚

* `userdata.img`: ç”¨æˆ·æ•°æ®åˆ†åŒºé•œåƒã€‚
___
## 2. ç³»ç»Ÿè£å‰ªä¸å®šåˆ¶æŠ€æœ¯

æ‹¥æœ‰äº†ç¼–è¯‘ AOSP çš„èƒ½åŠ›åï¼Œä½ å°±å¯ä»¥å¯¹ç³»ç»Ÿè¿›è¡Œä»»æ„çš„ä¿®æ”¹ã€‚

### a) é¢„ç½®ä¸åˆ é™¤ App

* **è·¯å¾„**: App é€šå¸¸å®šä¹‰åœ¨ `packages/apps/` ç›®å½•ä¸‹ã€‚

* **ä¿®æ”¹ `PRODUCT_PACKAGES`**: åœ¨ç‰¹å®šè®¾å¤‡çš„ `device.mk` æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ `device/&lt;vendor&gt;/&lt;device_name&gt;/device.mk`ï¼‰ï¼Œæœ‰ä¸€ä¸ªåä¸º `PRODUCT_PACKAGES` çš„å˜é‡ã€‚
* **å¢åŠ  App**: å°†ä½ æƒ³è¦é¢„ç½®çš„ App çš„æ¨¡å—åæ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚

* **åˆ é™¤ App**: ä»è¿™ä¸ªåˆ—è¡¨ä¸­ç§»é™¤ä½ ä¸æƒ³è¦çš„ç³»ç»Ÿ Appï¼ˆå¦‚ `Calendar`, `Camera2`ï¼‰çš„æ¨¡å—åã€‚

### b) ä¿®æ”¹ Framework å±‚

è¿™æ˜¯æ›´æ·±åº¦çš„å®šåˆ¶ï¼Œå¯ä»¥æ”¹å˜ Android ç³»ç»Ÿçš„æ ¸å¿ƒè¡Œä¸ºã€‚

* **è·¯å¾„**: Framework æ ¸å¿ƒä»£ç ä½äº `frameworks/base/`ã€‚

* **ç¤ºä¾‹ï¼šä¿®æ”¹çŠ¶æ€æ é€»è¾‘**:
1. æ‰¾åˆ°è´Ÿè´£çŠ¶æ€æ ç®¡ç†çš„ `SystemUI` App (`frameworks/base/packages/SystemUI/`)ã€‚
2. ä¿®æ”¹å…¶ä¸­çš„ Java æˆ– XML æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œæ”¹å˜æ—¶é’Ÿçš„æ˜¾ç¤ºæ ¼å¼æˆ–ç”µæ± å›¾æ ‡ã€‚
3. é‡æ–°ç¼–è¯‘ `SystemUI` æ¨¡å—ï¼š`m SystemUI`ã€‚
4. åªç¼–è¯‘æ¨¡å—å¹¶ç”Ÿæˆæ–°çš„ `system.img`ï¼š`m snod` (`make systemimage-nodeps`)ã€‚

### c) å®šåˆ¶å†…æ ¸ (Kernel)

AOSP é»˜è®¤ä¸åŒ…å«å†…æ ¸æºç ã€‚ä½ éœ€è¦ä» Google çš„å†…æ ¸æºç ä»“åº“æˆ–è®¾å¤‡å‚å•†çš„å¼€æºç«™ç‚¹å•ç‹¬ä¸‹è½½å†…æ ¸æºç ï¼Œå¹¶è¿›è¡Œç¼–è¯‘ã€‚

1. **è·å–å†…æ ¸æºç **: `git clone https://android.googlesource.com/kernel/common.git`
2. **é…ç½®ä¸ç¼–è¯‘**:
    ```bash
# ä½¿ç”¨ä¸ AOSP åŒ¹é…çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾
export CROSS_COMPILE=.../aarch64-linux-android-4.9/bin/aarch64-linux-android-
# é…ç½®å†…æ ¸
make defconfig
# ç¼–è¯‘å†…æ ¸é•œåƒ
make
</code></pre>
<h3 id="d-åˆ¶ä½œå®Œæ•´çš„è‡ªå®šä¹‰-rom">d) åˆ¶ä½œå®Œæ•´çš„è‡ªå®šä¹‰ ROM</h3>
<p>ä¸€ä¸ªå®Œæ•´çš„è‡ªå®šä¹‰ ROMï¼ˆå¦‚
LineageOSï¼‰çš„åˆ¶ä½œè¿‡ç¨‹ï¼Œå°±æ˜¯ä¸Šè¿°æ‰€æœ‰æŠ€æœ¯çš„ç»¼åˆåº”ç”¨ï¼š 1. åŒæ­¥ AOSP
åŸºç¡€ä»£ç ã€‚ 2. é›†æˆç‰¹å®šè®¾å¤‡çš„é©±åŠ¨å’Œé…ç½®æ–‡ä»¶ï¼ˆDevice Treeï¼‰ã€‚ 3. ä¿®æ”¹
Frameworkï¼Œæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ï¼ˆå¦‚é«˜çº§é‡å¯èœå•ï¼‰ã€‚ 4. ç§»é™¤æˆ–æ›¿æ¢ç³»ç»Ÿ Appã€‚ 5.
é›†æˆå®šåˆ¶çš„å†…æ ¸ã€‚ 6. ç¼–è¯‘å¹¶æ‰“åŒ…æˆä¸€ä¸ªå¯ä¾›ç”¨æˆ·åˆ·å†™çš„ <code>zip</code>
æ–‡ä»¶ã€‚ ___ ## android Linker ä¸ SO åŠ è½½åŸç†</p>
<h3 id="linker-architectureä¸å·¥ä½œåŸç†">Linker
architectureä¸å·¥ä½œåŸç†</h3>
<p>Android ç³»ç»Ÿä½¿ç”¨åŠ¨æ€é“¾æ¥å™¨ (<code>/system/bin/linker</code> æˆ–
<code>/system/bin/linker64</code>) æ¥åŠ è½½å’Œé“¾æ¥å…±äº«åº“ (.so æ–‡ä»¶)ã€‚</p>
<h4 id="ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</h4>
<pre><code>Runtime.loadLibrary()
â†“
DexPathList.loadLibrary()
â†“
nativeLoad() [JNI]
â†“
android_dlopen_ext()
â†“
do_dlopen() [linker]
â†“
find_library_internal()
â†“
load_library() â†’ link_image()
</code></pre>
<p>static soinfo* find_library_internal(android_namespace_t* ns, const
char* name, int rtld_flags, const android_dlextinfo* extinfo, soinfo*
needed_by) { // 1. CheckisNoå·²Load soinfo* si =
find_loaded_library_by_soname(ns, name); if (si != nullptr) { return si;
}</p>
<p>// 2. in/atNamespaceInSearch std::string realpath; if
(!find_library_in_namespace(ns, name, &amp;realpath)) { return nullptr;
}</p>
<p>// 3. LoadLibraryFile return load_library(ns, realpath.c_str(),
rtld_flags, extinfo, needed_by); }</p>
<pre><code>const char* name,
int rtld_flags,
const android_dlextinfo* extinfo,
soinfo* needed_by) {
// 1. OpenELFFile
int fd = open(name, O_RDONLY | O_CLOEXEC);

// 2. ParseELFå¤´
ElfReader elf_reader(name, fd, file_offset, file_size);
if (!elf_reader.Load(extinfo)) {
return nullptr;
}

// 3. Createsoinfoç»“æ„
soinfo* si = soinfo_alloc(ns, realpath, &amp;file_stat, rtld_flags, extinfo);

// 4. MapMemoryæ®µ
if (!si-&gt;prelink_image()) {
return nullptr;
}

return si;
}
</code></pre>
<p>const soinfo_list_t&amp; local_group, const android_dlextinfo*
extinfo) { // 1. ParseåŠ¨æ€æ®µ if (!phdr_table_get_dynamic_section(phdr,
phnum, load_bias, &amp;dynamic, &amp;dynamic_flags)) { return false;
}</p>
<p>// 2. Processä¾èµ–Library for (ElfW(Dyn)* d = dynamic; d-&gt;d_tag !=
DT_NULL; ++d) { if (d-&gt;d_tag == DT_NEEDED) { const char* library_name
= get_string(d-&gt;d_un.d_val); soinfo* lsi = find_library(library_name,
â€¦); } }</p>
<p>// 3. é‡å®šä½Process if (!relocate(global_group, local_group)) {
return false; }</p>
<p>// 4. Callæ„é€ Function call_constructors();</p>
<p>return true; }</p>
<pre><code>0x7001000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .rodata (R) â”‚ Onlyè¯»Dataæ®µ
0x7002000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 
â”‚ .data (RW) â”‚ å¯è¯»å†™Dataæ®µ
0x7003000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .bss (RW) â”‚ æœªInitializeDataæ®µ
0x7004000000 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>size_t phdr_count, ElfW(Addr) load_bias) { for (size_t i = 0; i &lt;
phdr_count; ++i) { const ElfW(Phdr)* phdr = &amp;phdr_table<a
href="#i">i</a>; if (phdr-&gt;p_type != PT_LOAD) continue;</p>
<p>int prot = PFLAGS_TO_PROT(phdr-&gt;p_flags); if
(mprotect(reinterpret_cast&lt;void*&gt;(seg_page_start + load_bias),
seg_page_end - seg_page_start, prot) &lt; 0) { return -1; } } return 0;
}</p>
<pre><code>__attribute__((constructor))
void anti_debug_check() {
// DetectionFrida
if (access(&quot;/data/local/tmp/frida-server&quot;, F_OK) == 0) {
_exit(1);
}

// DetectionDebugå™¨
if (ptrace(PTRACE_TRACEME, 0, 1, 0) == -1) {
_exit(1);
}

// Detectionè™šæ‹Ÿæœºç¯å¢ƒ
check_emulator_files();
}
</code></pre>
<p>void* handle = dlopen(NULL, RTLD_NOW);</p>
<p>// DetectionFridaç¬¦å· if (dlsym(handle, â€œfrida_agent_mainâ€) != NULL)
{ _exit(1); }</p>
<p>// DetectionXposedç¬¦å· if (dlsym(handle, â€œxposed_bridgeâ€) != NULL) {
_exit(1); } }</p>
<pre><code>Dl_info info;
dladdr((void*)check_code_integrity, &amp;info);

// CalculateCodeæ®µå“ˆå¸Œ
uint32_t current_hash = calculate_hash(info.dli_fbase, TEXT_SIZE);
if (current_hash != EXPECTED_HASH) {
_exit(1);
}
}
</code></pre>
<p>var ptrace = Module.findExportByName(â€œlibc.soâ€, â€œptraceâ€); if
(ptrace) { Interceptor.attach(ptrace, { onEnter: function(args) { var
request = args[0].toInt32(); if (request === 0) { // PTRACE_TRACEME
console.log(â€œ[+] ptrace(PTRACE_TRACEME) blockedâ€); args[0] = ptr(-1); //
Modify parameter to make it fail } }, onLeave: function(retval) {
retval.replace(ptr(0)); // Return success } }); }</p>
<pre><code>Interceptor.attach(dlsym, {
onEnter: function(args) {
this.symbol_name = args[1].readCString();
},
onLeave: function(retval) {
var blocked_symbols = [&quot;frida_agent_main&quot;, &quot;xposed_bridge&quot;];
if (blocked_symbols.includes(this.symbol_name)) {
console.log(&quot;[+] Hiding symbol: &quot; + this.symbol_name);
retval.replace(ptr(0));
}
}
});
</code></pre>
<p>Interceptor.attach(mprotect, { onEnter: function(args) { var addr =
args[0]; var size = args[1].toInt32(); var prot = args[2].toInt32();</p>
<p>console.log(â€œ[+] mprotect called:â€ + addr + â€œ, size:â€ + size + â€œ,
prot:â€ + prot);</p>
<p>// Prevent removal of execute permission if ((prot &amp; 0x4) == 0) {
// PROT_EXEC args[2] = ptr(prot | 0x4); } } });</p>
<pre><code>Interceptor.attach(access, {
onEnter: function(args) {
var path = args[0].readCString();
var sensitive_paths = [
&quot;/data/local/tmp/frida-server&quot;,
&quot;/system/xbin/su&quot;,
&quot;/system/app/Superuser.apk&quot;
];

if (sensitive_paths.some(p =&gt; path.includes(p))) {
console.log(&quot;[+] Blocking access to: &quot; + path);
args[0] = Memory.allocUtf8String(&quot;/non/existent/path&quot;);
}
}
});
</code></pre>
<p>from elftools.elf.elffile import ELFFile</p>
<p>def inject_init_array(elf_path, hook_function_addr): with
open(elf_path, â€˜r+bâ€™) as f: elf = ELFFile(f)</p>
<h1 id="æŸ¥æ‰¾.init_arrayæ®µ">æŸ¥æ‰¾.init_arrayæ®µ</h1>
<p>init_array = elf.get_section_by_name(â€˜.init_arrayâ€™) if init_array: #
in/atExistingFunctionæŒ‡é’ˆAfterAddNewFunctionAddress
f.seek(init_array[â€˜sh_offsetâ€™] + init_array[â€˜sh_sizeâ€™])
f.write(hook_function_addr.to_bytes(8, â€˜littleâ€™))</p>
<pre><code>// 1. æ‰¾åˆ°TargetsoLoadåŸºå€
void* base_addr = dlopen(&quot;target.so&quot;, RTLD_NOLOAD);

// 2. ParseELFå¤´æ‰¾åˆ°.init_arrayæ®µ
ElfW(Ehdr)* ehdr = (ElfW(Ehdr)*)base_addr;
ElfW(Shdr)* shdr = (ElfW(Shdr)*)((char*)base_addr + ehdr-&gt;e_shoff);

// 3. ModifyMemoryProtected
mprotect(init_array_addr, init_array_size, PROT_READ | PROT_WRITE);

// 4. AddFunctionæŒ‡é’ˆ
*(void**)(init_array_addr + init_array_size) = target_function;

// 5. RestoreProtected
mprotect(init_array_addr, init_array_size, PROT_READ);
}
</code></pre>
<p>class AntiDebugChecker { private: static bool
check_debugger_presence() { return ptrace(PTRACE_TRACEME, 0, 1, 0) ==
-1; }</p>
<p>static bool check_frida_artifacts() { const char* frida_files[] = {
â€œ/data/local/tmp/frida-serverâ€, â€œ/data/local/tmp/frida-agent-64.soâ€
};</p>
<p>for (auto file : frida_files) { if (access(file, F_OK) == 0) return
true; } return false; }</p>
<p>static bool check_memory_maps() { FILE* fp = fopen(â€œ/proc/self/mapsâ€,
â€œrâ€); char line[512]; while (fgets(line, sizeof(line), fp)) { if
(strstr(line, â€œfridaâ€) || strstr(line, â€œgum-js-loopâ€)) { fclose(fp);
return true; } } fclose(fp); return false; }</p>
<p>public: static void comprehensive_check() { if
(check_debugger_presence() || check_frida_artifacts() ||
check_memory_maps()) {</p>
<p>// Executeå¯¹æŠ—Measure execute_countermeasures(); } } };</p>
<pre><code>std::thread([]{
while (true) {
std::this_thread::sleep_for(std::chrono::seconds(5));
AntiDebugChecker::comprehensive_check();
}
}).detach();
}
</code></pre>
<ul>
<li><p>æ·±å…¥ç†è§£ Android Framework çš„å·¥ä½œåŸç†ï¼Œä¸º Hook
å’Œé€†å‘æä¾›æ›´åº•å±‚çš„è§†è§’ã€‚</p></li>
<li><p>é€šè¿‡ä¿®æ”¹ç³»ç»Ÿæ¥ç»•è¿‡åº”ç”¨å±‚çš„ååˆ†ææŠ€æœ¯ï¼Œå®ç°â€é™ç»´æ‰“å‡»â€ã€‚</p></li>
</ul>
<!-- 04-Reference/Advanced/aosp_device_modification.md -->
<h1 id="åŸºäº-aosp-çš„æ·±åº¦æ”¹æœºæŠ€æœ¯æŒ‡å—">åŸºäº AOSP çš„æ·±åº¦æ”¹æœºæŠ€æœ¯æŒ‡å—</h1>
<p>åœ¨ Android
å®‰å…¨å’Œé€†å‘å·¥ç¨‹é¢†åŸŸï¼Œâ€œæ”¹æœºâ€æŒ‡çš„æ˜¯ä¿®æ”¹è®¾å¤‡çš„å„ç§ç¡¬ä»¶å’Œè½¯ä»¶æ ‡è¯†ç¬¦ï¼Œä»¥ç»•è¿‡åº”ç”¨ç¨‹åºçš„å®‰å…¨æ£€æµ‹æˆ–å®ç°éšç§ä¿æŠ¤ã€‚è™½ç„¶ä½¿ç”¨
Xposed æˆ– Frida ç­‰ Hook
æ¡†æ¶å¯ä»¥åœ¨åº”ç”¨å±‚å®ç°æ”¹æœºï¼Œä½†è¿™äº›æ–¹æ³•å®¹æ˜“è¢«æ£€æµ‹ã€‚<strong>åŸºäº AOSP
(Android Open Source Project)
æºç è¿›è¡Œä¿®æ”¹ï¼Œæ˜¯ä»ç³»ç»Ÿå±‚é¢ä¼ªé€ è®¾å¤‡æŒ‡çº¹çš„ç»ˆææ‰‹æ®µ</strong>ï¼Œå› ä¸º App
è·å–åˆ°çš„ä¿¡æ¯æ˜¯ç”±ç³»ç»Ÿæœ¬èº«â€çœŸå®â€åœ°æä¾›çš„ã€‚</p>
<p>æœ¬æ–‡æ—¨åœ¨æä¾›ä¸€ä¸ªå…³äºå¦‚ä½•é€šè¿‡ä¿®æ”¹ AOSP
æºç æ¥å®ç°æ·±åº¦æ”¹æœºçš„æŠ€æœ¯æ¡†æ¶å’Œæ€è·¯ã€‚ ___ ## ç›®å½• 1. <a
href="#æ ¸å¿ƒæ€æƒ³åº”ç”¨å±‚-hook-vs-ç³»ç»Ÿå±‚ä¿®æ”¹"><strong>æ ¸å¿ƒæ€æƒ³ï¼šåº”ç”¨å±‚ Hook
vs.Â ç³»ç»Ÿå±‚ä¿®æ”¹</strong></a> 2. <a
href="#å‡†å¤‡å·¥ä½œ"><strong>å‡†å¤‡å·¥ä½œ</strong></a> 3. <a
href="#å…³é”®å‚æ•°å®šä½ä¸ä¿®æ”¹"><strong>å…³é”®å‚æ•°å®šä½ä¸ä¿®æ”¹</strong></a></p>
<ul>
<li><p><a href="#build-info-buildprop"><strong>Build Info
(build.prop)</strong></a></p></li>
<li><p><a href="#ç¡¬ä»¶å‚æ•°-imei-mac-android-id"><strong>ç¡¬ä»¶å‚æ•° (IMEI,
MAC, Android ID)</strong></a></p></li>
<li><p><a href="#ç³»ç»Ÿå±æ€§-system-properties"><strong>ç³»ç»Ÿå±æ€§ (System
Properties)</strong></a></p></li>
<li><p><a href="#å†…æ ¸å‚æ•°-serial-number"><strong>å†…æ ¸å‚æ•° (Serial
Number)</strong></a></p></li>
<li><p><a href="#build-info-buildprop"><strong>Build Info
(build.prop)</strong></a></p></li>
<li><p><a href="#ç¡¬ä»¶å‚æ•°-imei-mac-android-id"><strong>ç¡¬ä»¶å‚æ•° (IMEI,
MAC, Android ID)</strong></a></p></li>
<li><p><a href="#ç³»ç»Ÿå±æ€§-system-properties"><strong>ç³»ç»Ÿå±æ€§ (System
Properties)</strong></a></p></li>
<li><p><a href="#å†…æ ¸å‚æ•°-serial-number"><strong>å†…æ ¸å‚æ•° (Serial
Number)</strong></a></p></li>
</ul>
<ol start="4" type="1">
<li><a href="#ç¼–è¯‘ä¸åˆ·æœº"><strong>ç¼–è¯‘ä¸åˆ·æœº</strong></a></li>
<li><a href="#ä¼˜åŠ¿ä¸æŒ‘æˆ˜"><strong>ä¼˜åŠ¿ä¸æŒ‘æˆ˜</strong></a> ___ ## #
æ ¸å¿ƒæ€æƒ³ï¼šåº”ç”¨å±‚ Hook vs.Â ç³»ç»Ÿå±‚ä¿®æ”¹</li>
</ol>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">åº”ç”¨å±‚ Hook (Xposed/Frida)</th>
<th style="text-align: left;">AOSP ç³»ç»Ÿå±‚ä¿®æ”¹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>åŸç†</strong></td>
<td style="text-align: left;">åœ¨ App è¿è¡Œæ—¶ï¼Œæ‹¦æˆª API
è°ƒç”¨ï¼Œè¿”å›ä¼ªé€ ç»“æœã€‚</td>
<td style="text-align: left;">ç›´æ¥ä¿®æ”¹ Android æ¡†æ¶å±‚æºç ï¼Œä½¿ API
<strong>æœ¬èº«</strong>å°±è¿”å›ä¼ªé€ çš„å€¼ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ•ˆæœ</strong></td>
<td style="text-align: left;">è¾ƒå¥½ï¼Œä½†å¯è¢«æ£€æµ‹ã€‚</td>
<td style="text-align: left;"><strong>æå¥½</strong>ï¼Œæ•ˆæœå½»åº•ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ£€æµ‹éš¾åº¦</strong></td>
<td style="text-align: left;">å®¹æ˜“è¢«å Hookã€åè°ƒè¯•æŠ€æœ¯æ£€æµ‹åˆ°ã€‚</td>
<td style="text-align: left;">æéš¾è¢«æ£€æµ‹ï¼Œå› ä¸ºå¯¹ App
æ¥è¯´ç³»ç»Ÿè¡Œä¸ºæ˜¯â€åŸç”Ÿâ€çš„ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å®ç°éš¾åº¦</strong></td>
<td style="text-align: left;">ç›¸å¯¹è¾ƒä½ï¼Œåªéœ€ç¼–å†™ Hook è„šæœ¬ã€‚</td>
<td style="text-align: left;"><strong>éå¸¸é«˜</strong>ï¼Œéœ€è¦ç¼–è¯‘æ•´ä¸ª
Android ç³»ç»Ÿã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>é€‚ç”¨æ€§</strong></td>
<td style="text-align: left;">é€šç”¨æ€§å¼ºï¼Œé€‚ç”¨äºå¤§å¤šæ•°è®¾å¤‡ã€‚</td>
<td style="text-align: left;">é€šå¸¸åªé€‚ç”¨äº AOSP æ”¯æŒè‰¯å¥½çš„è®¾å¤‡ï¼ˆå¦‚
Google Pixelï¼‰ã€‚</td>
</tr>
</tbody>
</table>
<ul>
<li>*ç»“è®º<strong>: AOSP
æ”¹æœºçš„æœ¬è´¨æ˜¯</strong>æ„å»ºä¸€ä¸ªâ€å‡ºå‚è®¾ç½®â€å°±æ˜¯ä¼ªè£…çŠ¶æ€çš„è‡ªå®šä¹‰æ“ä½œç³»ç»Ÿ**ã€‚
___ ## # å‡†å¤‡å·¥ä½œ</li>
</ul>
<ol type="1">
<li><strong>ç¡¬ä»¶è¦æ±‚</strong>:</li>
</ol>
<ul>
<li><p>ä¸€å°é«˜æ€§èƒ½çš„ PCï¼ˆè‡³å°‘ 16GB RAMï¼Œæ¨è 32GB æˆ–æ›´é«˜ï¼‰ã€‚</p></li>
<li><p>å¤§å®¹é‡é«˜é€Ÿç¡¬ç›˜ï¼ˆSSDï¼Œè‡³å°‘ 500GB å¯ç”¨ç©ºé—´ï¼‰ã€‚</p></li>
<li><p>ä¸€å°å— AOSP å®˜æ–¹æ”¯æŒçš„è®¾å¤‡ï¼ˆå¦‚ Google Pixel
ç³»åˆ—ï¼‰ï¼Œç”¨äºåˆ·æœºéªŒè¯ã€‚</p></li>
<li><p>ä¸€å°é«˜æ€§èƒ½çš„ PCï¼ˆè‡³å°‘ 16GB RAMï¼Œæ¨è 32GB æˆ–æ›´é«˜ï¼‰ã€‚</p></li>
<li><p>å¤§å®¹é‡é«˜é€Ÿç¡¬ç›˜ï¼ˆSSDï¼Œè‡³å°‘ 500GB å¯ç”¨ç©ºé—´ï¼‰ã€‚</p></li>
<li><p>ä¸€å°å— AOSP å®˜æ–¹æ”¯æŒçš„è®¾å¤‡ï¼ˆå¦‚ Google Pixel
ç³»åˆ—ï¼‰ï¼Œç”¨äºåˆ·æœºéªŒè¯ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>è½¯ä»¶ç¯å¢ƒ</strong>:</li>
</ol>
<ul>
<li><p>Linux æ“ä½œç³»ç»Ÿï¼ˆæ¨è Ubuntu LTS ç‰ˆæœ¬ï¼‰ã€‚</p></li>
<li><p>ç†Ÿæ‚‰ Android ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…å¥½ <code>repo</code>
å’Œæ‰€æœ‰å¿…éœ€çš„ä¾èµ–åº“ã€‚</p></li>
<li><p>Linux æ“ä½œç³»ç»Ÿï¼ˆæ¨è Ubuntu LTS ç‰ˆæœ¬ï¼‰ã€‚</p></li>
<li><p>ç†Ÿæ‚‰ Android ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…å¥½ <code>repo</code>
å’Œæ‰€æœ‰å¿…éœ€çš„ä¾èµ–åº“ã€‚</p></li>
</ul>
<ol start="3" type="1">
<li><strong>AOSP æºç </strong>:</li>
</ol>
<ul>
<li><p>æ ¹æ®ä½ çš„ç›®æ ‡è®¾å¤‡å’Œ Android ç‰ˆæœ¬ï¼Œåˆå§‹åŒ–å¹¶åŒæ­¥å¯¹åº”çš„ AOSP
æºç ä»“åº“ã€‚</p></li>
<li><p>æ ¹æ®ä½ çš„ç›®æ ‡è®¾å¤‡å’Œ Android ç‰ˆæœ¬ï¼Œåˆå§‹åŒ–å¹¶åŒæ­¥å¯¹åº”çš„ AOSP
æºç ä»“åº“ã€‚ ___ ## # å…³é”®å‚æ•°å®šä½ä¸ä¿®æ”¹</p></li>
</ul>
<h3 id="build-info-build.prop"># Build Info (build.prop)</h3>
<p>è¿™äº›æ˜¯æè¿°è®¾å¤‡å‹å·ã€å“ç‰Œã€åˆ¶é€ å•†ç­‰æœ€åŸºç¡€çš„ä¿¡æ¯ã€‚</p>
<ul>
<li><p><strong>å®šä½</strong>: è¿™äº›å€¼é€šå¸¸å®šä¹‰åœ¨ <code>device/</code>
ç›®å½•ä¸‹çš„ç‰¹å®šäºè®¾å¤‡çš„ <code>*.mk</code> makefile æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨
<code>build/make/target/product/</code>
ä¸‹çš„é€šç”¨äº§å“å®šä¹‰æ–‡ä»¶ä¸­ã€‚</p></li>
<li><p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>:</p></li>
<li><p>æ‰“å¼€
<code>device/&lt;vendor&gt;/&lt;product_name&gt;/device.mk</code>
æˆ–ç±»ä¼¼æ–‡ä»¶ã€‚</p></li>
<li><p>æ‰¾åˆ°å¹¶ä¿®æ”¹ä»¥ä¸‹å˜é‡ï¼š ```makefile PRODUCT_MODEL := Pixel 8 Pro
PRODUCT_BRAND := Google PRODUCT_NAME := my_custom_device PRODUCT_DEVICE
:= generic PRODUCT_MANUFACTURER := MyCompany</p></li>
</ul>
<pre><code>

### ç¡¬ä»¶å‚æ•° (IMEI, MAC, android ID)
è¿™äº›æ˜¯æ›´æ•æ„Ÿã€æ›´æ ¸å¿ƒçš„è®¾å¤‡æ ‡è¯†ç¬¦ã€‚ä¿®æ”¹å®ƒä»¬éœ€è¦æ·±å…¥åˆ° Framework å±‚çš„ Java ä»£ç å’Œ JNIã€‚

* **IMEI (Telephony)**:
* **å®šä½**: `frameworks/opt/telephony/src/java/com/android/internal/telephony/Phone.java` æˆ–ç›¸å…³çš„ `*SubInfo.java` æ–‡ä»¶ã€‚

* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getImei()` æˆ–ç±»ä¼¼æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ç¡¬ç¼–ç æˆ–è¿”å›ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ä¼ªé€  IMEIã€‚
* **å®šä½**: `frameworks/opt/telephony/src/java/com/android/internal/telephony/Phone.java` æˆ–ç›¸å…³çš„ `*SubInfo.java` æ–‡ä»¶ã€‚


* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getImei()` æˆ–ç±»ä¼¼æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ç¡¬ç¼–ç æˆ–è¿”å›ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ä¼ªé€  IMEIã€‚
* **MAC Address (Wi-Fi)**:
* **å®šä½**: `frameworks/base/wifi/java/android/net/wifi/WifiInfo.java`ã€‚

* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getMacAddress()` æ–¹æ³•ã€‚æ³¨æ„ï¼Œåœ¨é«˜ç‰ˆæœ¬ Android ä¸­ï¼Œè¯¥æ–¹æ³•å¯èƒ½è¿”å›ä¸€ä¸ªå›ºå®šçš„ã€éçœŸå®çš„ MAC åœ°å€ã€‚éœ€è¦æ‰¾åˆ°å…¶æ›´åº•å±‚çš„å®ç°ï¼Œå¯èƒ½åœ¨ `wpa_supplicant` æˆ– Wi-Fi é©±åŠ¨çš„ JNI æ¥å£ä¸­ã€‚
* **å®šä½**: `frameworks/base/wifi/java/android/net/wifi/WifiInfo.java`ã€‚


* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getMacAddress()` æ–¹æ³•ã€‚æ³¨æ„ï¼Œåœ¨é«˜ç‰ˆæœ¬ Android ä¸­ï¼Œè¯¥æ–¹æ³•å¯èƒ½è¿”å›ä¸€ä¸ªå›ºå®šçš„ã€éçœŸå®çš„ MAC åœ°å€ã€‚éœ€è¦æ‰¾åˆ°å…¶æ›´åº•å±‚çš„å®ç°ï¼Œå¯èƒ½åœ¨ `wpa_supplicant` æˆ– Wi-Fi é©±åŠ¨çš„ JNI æ¥å£ä¸­ã€‚
* **Android ID**:
* **å®šä½**: `frameworks/base/services/core/java/com/android/server/pm/Settings.java` ä¸­çš„ `getStringForUser()` æ–¹æ³•ï¼Œç»“åˆ `android.provider.Settings.Secure.ANDROID_ID` çš„å®ç°ã€‚

* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ°ç”Ÿæˆå’Œå­˜å‚¨ Android ID çš„é€»è¾‘ï¼Œå°†å…¶æ›¿æ¢ä¸ºè¿”å›ä¸€ä¸ªå›ºå®šçš„æˆ–æ¯æ¬¡å¯åŠ¨éƒ½éšæœºç”Ÿæˆçš„å€¼ã€‚

* **å®šä½**: `frameworks/base/services/core/java/com/android/server/pm/Settings.java` ä¸­çš„ `getStringForUser()` æ–¹æ³•ï¼Œç»“åˆ `android.provider.Settings.Secure.ANDROID_ID` çš„å®ç°ã€‚


* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ°ç”Ÿæˆå’Œå­˜å‚¨ Android ID çš„é€»è¾‘ï¼Œå°†å…¶æ›¿æ¢ä¸ºè¿”å›ä¸€ä¸ªå›ºå®šçš„æˆ–æ¯æ¬¡å¯åŠ¨éƒ½éšæœºç”Ÿæˆçš„å€¼ã€‚


### ç³»ç»Ÿå±æ€§ (System Properties)
App é€šè¿‡ `android.os.SystemProperties.get()` è·å–å„ç§ç³»ç»Ÿå±æ€§ã€‚

* **å®šä½**: `frameworks/base/core/java/android/os/SystemProperties.java` åŠå…¶å¯¹åº”çš„ JNI å®ç° `frameworks/base/core/jni/android_os_SystemProperties.cpp`ã€‚


* **ä¿®æ”¹æ€è·¯**: ç›´æ¥åœ¨ `SystemProperties.cpp` çš„ `native_get` æ–¹æ³•ä¸­è¿›è¡Œæ‹¦æˆªã€‚åˆ¤æ–­ä¼ å…¥çš„å±æ€§åï¼Œå¦‚æœæ˜¯ç›®æ ‡å±æ€§ï¼ˆå¦‚ `ro.serialno`ï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªä¼ªé€ çš„å€¼ï¼Œå¦åˆ™æ‰§è¡ŒåŸå§‹é€»è¾‘ã€‚


### å†…æ ¸å‚æ•° (Serial Number)
ä¸€äº›åº•å±‚ä¿¡æ¯ï¼ˆå¦‚ CPU åºåˆ—å·ï¼‰ç›´æ¥ç”± Linux å†…æ ¸é€šè¿‡ `/proc` æ–‡ä»¶ç³»ç»Ÿæš´éœ²ã€‚

* **å®šä½**: å†…æ ¸æºç ä¸­çš„ `arch/&lt;arch&gt;/kernel/setup.c` æˆ–ç›¸å…³é©±åŠ¨æ–‡ä»¶ã€‚


* **ä¿®æ”¹æ€è·¯**:
1. ä¸‹è½½ä¸ AOSP ç‰ˆæœ¬åŒ¹é…çš„å†…æ ¸æºç ã€‚
2. æ‰¾åˆ°å‘ `/proc/cpuinfo` æˆ– `/proc/serial` ç­‰æ–‡ä»¶å†™å…¥ä¿¡æ¯çš„ä»£ç ã€‚
3. ä¿®æ”¹è¿™éƒ¨åˆ†é€»è¾‘ï¼Œä½¿å…¶è¾“å‡ºä¼ªé€ çš„ä¿¡æ¯ã€‚
4. é‡æ–°ç¼–è¯‘å†…æ ¸ (`boot.img`)ã€‚

1. ä¸‹è½½ä¸ AOSP ç‰ˆæœ¬åŒ¹é…çš„å†…æ ¸æºç ã€‚
2. æ‰¾åˆ°å‘ `/proc/cpuinfo` æˆ– `/proc/serial` ç­‰æ–‡ä»¶å†™å…¥ä¿¡æ¯çš„ä»£ç ã€‚
3. ä¿®æ”¹è¿™éƒ¨åˆ†é€»è¾‘ï¼Œä½¿å…¶è¾“å‡ºä¼ªé€ çš„ä¿¡æ¯ã€‚
4. é‡æ–°ç¼–è¯‘å†…æ ¸ (`boot.img`)ã€‚
___
## # ç¼–è¯‘ä¸åˆ·æœº

1. **è®¾ç½®ç¯å¢ƒ**: `source build/envsetup.sh`
2. **é€‰æ‹©ç›®æ ‡**: `lunch aosp_&lt;device_name&gt;-userdebug` (ä¾‹å¦‚ `lunch aosp_husky-userdebug` å¯¹åº” Pixel 8 Pro)
3. **å¼€å§‹ç¼–è¯‘**: `make -j$(nproc)` (è¿™ä¼šèŠ±è´¹æ•°å°æ—¶)
4. **åˆ·æœº**:
* å°†è®¾å¤‡ç½®äº `fastboot` æ¨¡å¼ã€‚

* æ‰§è¡Œ `fastboot flashall -w`ï¼Œè¿™å°†åˆ·å†™æ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„é•œåƒ (`system.img`, `boot.img`, `vendor.img` ç­‰)ã€‚

* å°†è®¾å¤‡ç½®äº `fastboot` æ¨¡å¼ã€‚


* æ‰§è¡Œ `fastboot flashall -w`ï¼Œè¿™å°†åˆ·å†™æ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„é•œåƒ (`system.img`, `boot.img`, `vendor.img` ç­‰)ã€‚
___
## # ä¼˜åŠ¿ä¸æŒ‘æˆ˜

### ä¼˜åŠ¿
* **å½»åº•æ€§**: ä»ç³»ç»Ÿæ ¹æºä¸Šæ”¹å˜è®¾å¤‡æŒ‡çº¹ï¼Œå‡ ä¹æ— æ³•è¢«åº”ç”¨å±‚æŠ€æœ¯æ£€æµ‹ã€‚


* **ç¨³å®šæ€§**: ä¸ä¼šåƒ Hook æ¡†æ¶é‚£æ ·å› ä¸ºåº”ç”¨æ›´æ–°æˆ–åŠ å›ºè€Œå¤±æ•ˆã€‚


* **æ€§èƒ½å¥½**: æ²¡æœ‰é¢å¤–çš„ Hook å¼€é”€ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½æ˜¯åŸç”Ÿä»£ç ã€‚


### æŒ‘æˆ˜
* **æŠ€æœ¯é—¨æ§›æé«˜**: éœ€è¦æ·±å…¥ç†è§£ AOSP æºç ç»“æ„ã€ç¼–è¯‘ç³»ç»Ÿå’Œ Linux å†…æ ¸ã€‚


* **æ—¶é—´æˆæœ¬é«˜**: å…¨é‡ç¼–è¯‘ä¸€æ¬¡ AOSP é€šå¸¸éœ€è¦æ•°å°æ—¶ã€‚


* **è®¾å¤‡é™åˆ¶**: å¼ºä¾èµ–äºæœ‰è‰¯å¥½ AOSP æ”¯æŒå’Œå¼€æ”¾é©±åŠ¨çš„è®¾å¤‡ã€‚


* **ç»´æŠ¤å›°éš¾**: æ¯æ¬¡ Android ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ½éœ€è¦é‡æ–°è¿›è¡Œæºç é€‚é…å’Œä¿®æ”¹ã€‚ </code></pre>
<!-- 04-Reference/Advanced/minimal_android_rootfs.md -->
<h1 id="æ„å»ºæœ€å°åŒ–-android-ç³»ç»Ÿ-rootfs-æŒ‡å—">æ„å»ºæœ€å°åŒ– android ç³»ç»Ÿ
(RootFS) æŒ‡å—</h1>
<p>æ„å»ºä¸€ä¸ªå®Œæ•´çš„ AOSP (Android Open Source Project)
è€—æ—¶å·¨å¤§ä¸”å¯¹ç¡¬ä»¶è¦æ±‚è‹›åˆ»ã€‚è€Œæ„å»ºä¸€ä¸ªæœ€å°åŒ–çš„ Android RootFS (Root File
System) æ˜¯ä¸€ä¸ªèƒ½è®©æˆ‘ä»¬æ·±åˆ»ç†è§£ Android
å¯åŠ¨æµç¨‹å’Œæ ¸å¿ƒç»„ä»¶çš„ç»ä½³å®è·µã€‚å…¶ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªä»…åŒ…å«æœ€åŸºæœ¬ç»„ä»¶ã€èƒ½å¤Ÿå¼•å¯¼
Linux å†…æ ¸å¹¶æœ€ç»ˆå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ Shell çš„ç³»ç»Ÿã€‚</p>
<p>æœ¬æ–‡å°†æŒ‡å¯¼ä½ å®Œæˆè¿™ä¸€è¿‡ç¨‹ï¼Œä¸»è¦ä½¿ç”¨ QEMU ä½œä¸ºç›®æ ‡å¹³å°ã€‚ ___ ## ç›®å½• -
<a href="#æ„å»ºæœ€å°åŒ–-android-ç³»ç»Ÿ-rootfs-æŒ‡å—">æ„å»ºæœ€å°åŒ– Android ç³»ç»Ÿ
(RootFS) æŒ‡å—</a> - <a href="#ç›®å½•">ç›®å½•</a> - <a
href="#æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹">æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</a></p>
<ul>
<li><p><a href="#æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶">æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></p></li>
<li><p><a href="#æ„å»ºæ­¥éª¤è¯¦è§£">æ„å»ºæ­¥éª¤è¯¦è§£</a></p></li>
<li><p><a href="#step-1-å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾">Step 1:
å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p></li>
<li><p><a href="#step-2-è·å–å¹¶ç¼–è¯‘-linux-å†…æ ¸">Step 2: è·å–å¹¶ç¼–è¯‘ Linux
å†…æ ¸</a></p></li>
<li><p><a href="#step-3-æ„å»ºæœ€å°åŒ–-rootfs">Step 3: æ„å»ºæœ€å°åŒ–
RootFS</a></p></li>
<li><p><a href="#step-4-æ‰“åŒ…å¹¶è¿è¡Œ">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p></li>
<li><p><a href="#ä»-shell-åˆ°-zygoteä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ">ä» Shell åˆ°
Zygoteï¼šä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹">æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</a></p></li>
<li><p><a href="#æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶">æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></p></li>
<li><p><a href="#æ„å»ºæ­¥éª¤è¯¦è§£">æ„å»ºæ­¥éª¤è¯¦è§£</a></p></li>
<li><p><a href="#step-1-å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾">Step 1:
å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p></li>
<li><p><a href="#step-2-è·å–å¹¶ç¼–è¯‘-linux-å†…æ ¸">Step 2: è·å–å¹¶ç¼–è¯‘ Linux
å†…æ ¸</a></p></li>
<li><p><a href="#step-3-æ„å»ºæœ€å°åŒ–-rootfs">Step 3: æ„å»ºæœ€å°åŒ–
RootFS</a></p></li>
<li><p><a href="#step-4-æ‰“åŒ…å¹¶è¿è¡Œ">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p></li>
<li><p><a href="#ä»-shell-åˆ°-zygoteä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ">ä» Shell åˆ°
Zygoteï¼šä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</a></p></li>
<li><p><a href="#æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹">æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</a></p></li>
<li><p><a href="#æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶">æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></p></li>
<li><p><a href="#æ„å»ºæ­¥éª¤è¯¦è§£">æ„å»ºæ­¥éª¤è¯¦è§£</a></p></li>
<li><p><a href="#step-1-å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾">Step 1:
å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p></li>
<li><p><a href="#step-2-è·å–å¹¶ç¼–è¯‘-linux-å†…æ ¸">Step 2: è·å–å¹¶ç¼–è¯‘ Linux
å†…æ ¸</a></p></li>
<li><p><a href="#step-3-æ„å»ºæœ€å°åŒ–-rootfs">Step 3: æ„å»ºæœ€å°åŒ–
RootFS</a></p></li>
<li><p><a href="#step-4-æ‰“åŒ…å¹¶è¿è¡Œ">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p></li>
<li><p><a href="#step-1-å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾">Step 1:
å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p></li>
<li><p><a href="#step-2-è·å–å¹¶ç¼–è¯‘-linux-å†…æ ¸">Step 2: è·å–å¹¶ç¼–è¯‘ Linux
å†…æ ¸</a></p></li>
<li><p><a href="#step-3-æ„å»ºæœ€å°åŒ–-rootfs">Step 3: æ„å»ºæœ€å°åŒ–
RootFS</a></p></li>
<li><p><a href="#step-4-æ‰“åŒ…å¹¶è¿è¡Œ">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p></li>
<li><p><a href="#ä»-shell-åˆ°-zygoteä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ">ä» Shell åˆ°
Zygoteï¼šä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</a> ___ ## # æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</p></li>
</ul>
<ol type="1">
<li><strong>Bootloader</strong>:
è®¾å¤‡ä¸Šç”µåæ‰§è¡Œçš„ç¬¬ä¸€æ®µä»£ç ï¼Œè´Ÿè´£åˆå§‹åŒ–ç¡¬ä»¶å¹¶åŠ è½½ Linux å†…æ ¸åˆ°å†…å­˜ã€‚</li>
<li><strong>Kernel</strong>:
å†…æ ¸è¢«åŠ è½½åï¼Œå¼€å§‹åˆå§‹åŒ–å„ç§é©±åŠ¨ã€å†…å­˜ç®¡ç†ç­‰ï¼Œç„¶åæŒ‚è½½ä¸€ä¸ªä¸´æ—¶çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ
(ramdisk)ã€‚</li>
<li><strong><code>init</code> è¿›ç¨‹</strong>:
å†…æ ¸åœ¨ç”¨æˆ·ç©ºé—´å¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶ PID ä¸º
1ã€‚å®ƒæ˜¯æ‰€æœ‰å…¶ä»–ç”¨æˆ·ç©ºé—´è¿›ç¨‹çš„ç¥–å…ˆã€‚</li>
<li><strong><code>init.rc</code></strong>: <code>init</code>
è¿›ç¨‹ä¼šè§£æè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ ¹æ®å…¶ä¸­çš„æŒ‡ä»¤æ‰§è¡ŒåŠ¨ä½œï¼Œå¦‚æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€è®¾ç½®ç³»ç»Ÿå±æ€§ã€å¯åŠ¨æœåŠ¡ç­‰ã€‚</li>
</ol>
<p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åˆ›å»ºä¸€ä¸ªæç®€çš„ RootFSï¼Œå…¶ä¸­åŒ…å« <code>init</code>
ç¨‹åºå’Œä¸€ä¸ªèƒ½è¢«å®ƒå¯åŠ¨çš„ Shellã€‚</p>
<h2 id="æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶"># æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</h2>
<p>ä¸€ä¸ªèƒ½å¯åŠ¨åˆ° Shell çš„æœ€å° Android ç³»ç»Ÿï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li><p><strong>Linux Kernel</strong>: æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒã€‚</p></li>
<li><p><strong><code>init</code></strong>: ç”¨æˆ·ç©ºé—´çš„å®ˆæŠ¤ç¥ï¼Œæ¥è‡ª AOSP
æºç  <code>system/core/init</code>ã€‚</p></li>
<li><p><strong>C åº“</strong>: <code>libc.so</code> (C æ ‡å‡†åº“),
<code>libm.so</code> (æ•°å­¦åº“)ã€‚æ‰€æœ‰åŸç”Ÿç¨‹åºéƒ½ä¾èµ–å®ƒã€‚</p></li>
<li><p><strong>åŠ¨æ€é“¾æ¥å™¨</strong>: <code>linker</code> æˆ–
<code>linker64</code>ï¼Œç”¨äºåŠ è½½ <code>.so</code> åŠ¨æ€åº“ã€‚</p></li>
<li><p><strong>Shell</strong>: <code>sh</code>ï¼Œæˆ‘ä»¬çš„äº¤äº’ç•Œé¢ï¼Œé€šå¸¸ç”±
<code>toybox</code> æˆ– <code>toolbox</code> æä¾›ã€‚</p></li>
<li><p><strong><code>init.rc</code></strong>:
ä¸€ä¸ªæœ€ç®€å•çš„é…ç½®æ–‡ä»¶ã€‚</p></li>
<li><p><strong>åŸºæœ¬ç›®å½•ç»“æ„</strong>: <code>/dev</code>,
<code>/proc</code>, <code>/sys</code>, <code>/system/bin</code>ã€‚ ___ ##
# æ„å»ºæ­¥éª¤è¯¦è§£</p></li>
</ul>
<h3 id="step-1-å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾"># Step 1: å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</h3>
<p>ä½ éœ€è¦ä¸€ä¸ª Linux ç¯å¢ƒï¼ˆå¦‚
Ubuntuï¼‰å’Œç”¨äºäº¤å‰ç¼–è¯‘çš„å·¥å…·é“¾ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä» AOSP
é¢„ç¼–è¯‘åº“ä¸­è·å–ã€‚</p>
<div class="sourceCode" id="cb438"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download AOSP prebuilt aarch64 (ARM64) Toolchain</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9</span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a><span class="co"># WillToolchainPathAdd toEnvironment variables</span></span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/aarch64-linux-android-4.9/bin:<span class="va">$PATH</span></span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CROSS_COMPILE</span><span class="op">=</span>aarch64-linux-android-</span></code></pre></div>
<p>git clone https://android.googlesource.com/kernel/common.git cd
common</p>
<h1 id="switch-toä¸€stable-branch">Switch toä¸€Stable branch</h1>
<p>git checkout android-4.14</p>
<h1 id="é…ç½®å†…æ ¸">é…ç½®å†…æ ¸</h1>
<p>export ARCH=arm64 make defconfig</p>
<h1 id="ç¼–è¯‘å†…æ ¸">ç¼–è¯‘å†…æ ¸</h1>
<p>make -j$(nproc)</p>
<h1
id="compilesuccessafterä¼šinat-archarm64boot-directoryä¸‹generate-image.gz-å†…æ ¸file">CompileSuccessAfterï¼Œä¼šin/at
arch/arm64/boot/ Directoryä¸‹Generate Image.gz å†…æ ¸File</h1>
<pre><code>mkdir -p my_rootfs/{dev,proc,sys,system/bin,system/lib64}
cd my_rootfs
</code></pre>
<p>è¿™ä¸€æ­¥æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºéœ€è¦ä»å®Œæ•´çš„ AOSP
æºç ä¸­å•ç‹¬ç¼–è¯‘ã€‚ä¸€ä¸ªç®€åŒ–çš„æ–¹æ³•æ˜¯<strong>ç›´æ¥ä»ä¸€ä¸ªç°æœ‰çš„ Android ç³»ç»Ÿæˆ–
AOSP ç¼–è¯‘äº§ç‰©ä¸­æå–è¿™äº›é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ã€‚</p>
<ul>
<li><p>ä» AOSP ç¼–è¯‘äº§ç‰©
<code>out/target/product/&lt;device&gt;/system/</code>
ä¸­æ‰¾åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š</p></li>
<li><p><code>bin/linker64</code> -&gt; å¤åˆ¶åˆ°
<code>my_rootfs/system/bin/</code></p></li>
<li><p><code>bin/init</code> -&gt; å¤åˆ¶åˆ°
<code>my_rootfs/</code></p></li>
<li><p><code>bin/toybox</code> -&gt; å¤åˆ¶åˆ°
<code>my_rootfs/system/bin/</code></p></li>
<li><p><code>lib64/libc.so</code>, <code>lib64/libm.so</code> -&gt;
å¤åˆ¶åˆ° <code>my_rootfs/system/lib64/</code></p></li>
<li><p>ä¸º <code>toybox</code> åˆ›å»ºå„ç§å‘½ä»¤çš„è½¯é“¾æ¥ï¼š ```bash cd
my_rootfs/system/bin for cmd in $(./toybox); do ln -s toybox $cmd done
cd ../../</p></li>
</ul>
<pre><code>åœ¨ `my_rootfs/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `init.rc` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```rc
# init.rc for minimal android

on early-init
mount tmpfs tmpfs /dev
mkdir /dev/pts
mount devpts devpts /dev/pts
mount proc proc /proc
mount sysfs sysfs /sys

on init
export PATH /system/bin
export LD_LIBRARY_PATH /system/lib64

on post-fs
# In a real system, we would mount /data, /cache, etc.
# Here we just start the shell.

service shell /system/bin/sh
class core
console
disabled
user shell
group shell
seclabel u:r:shell:s0

on property:sys.boot_completed=1
start shell
</code></pre>
<ol type="1">
<li><strong>æ‰“åŒ… RootFS</strong>: æˆ‘ä»¬éœ€è¦å°† <code>my_rootfs</code>
ç›®å½•æ‰“åŒ…æˆä¸€ä¸ª <code>cpio</code> å½’æ¡£ï¼Œå¹¶ç”¨ <code>gzip</code>
å‹ç¼©ï¼Œä½œä¸ºå†…æ ¸çš„ <code>initramfs</code>ã€‚</li>
</ol>
<div class="sourceCode" id="cb441"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> my_rootfs</span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span> . <span class="kw">|</span> <span class="fu">cpio</span> <span class="at">-o</span> <span class="at">-H</span> newc <span class="kw">|</span> <span class="fu">gzip</span> <span class="op">&gt;</span> ../rootfs.cpio.gz</span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span></code></pre></div>
<h1
id="ç¡®ä¿-commonarcharm64bootimage.gz-and-rootfs.cpio.gz-inatcurrentdirectory">ç¡®ä¿
common/arch/arm64/boot/Image.gz and rootfs.cpio.gz
in/atCurrentDirectory</h1>
<p>qemu-system-aarch64<br />
- M virt<br />
- cpu cortex-a57<br />
- m 2048<br />
- kernel common/arch/arm64/boot/Image.gz<br />
- initrd rootfs.cpio.gz<br />
- nographic<br />
- append â€œconsole=ttyAMA0â€</p>
<p>æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªæœ€å°çš„ Linux ç¯å¢ƒï¼Œä½†å®ƒè¿˜ä¸æ˜¯â€Androidâ€ã€‚è¦è®©å®ƒæˆä¸º
Androidï¼Œè¿˜éœ€è¦ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š</p>
<ol type="1">
<li><strong>å¯åŠ¨ <code>servicemanager</code></strong>:
ç¼–è¯‘å¹¶è¿è¡Œå®ƒï¼Œå®ƒæ˜¯ Android Binder IPC æœºåˆ¶çš„æ ¸å¿ƒã€‚</li>
<li><strong>å¯åŠ¨ Zygote</strong>: ç¼–è¯‘ <code>app_process</code> å¹¶é€šè¿‡
<code>init.rc</code> å¯åŠ¨å®ƒã€‚Zygote ä¼šé¢„åŠ è½½ Android æ¡†æ¶çš„æ ¸å¿ƒç±»
(<code>framework.jar</code>) å¹¶ç›‘å¬ä¸€ä¸ª socketï¼Œç­‰å¾…å­µåŒ–æ–°çš„ App
è¿›ç¨‹ã€‚</li>
<li><strong>å¯åŠ¨ <code>system_server</code></strong>: Zygote
å¯åŠ¨çš„ç¬¬ä¸€ä¸ª Java è¿›ç¨‹ï¼Œå®ƒä¼šåˆ›å»ºæ‰€æœ‰çš„ Android ç³»ç»ŸæœåŠ¡ (AMS, WMS, PMS
ç­‰)ã€‚</li>
</ol>
<p>å®Œæˆè¿™äº›åï¼Œç³»ç»Ÿæ‰èƒ½çœŸæ­£åœ°è¿è¡Œ Android åº”ç”¨ã€‚ä½†è¿™å·²ç»è¶…å‡ºäº†â€æœ€å°åŒ–
RootFSâ€çš„èŒƒç•´ï¼Œè¿›å…¥äº†å®Œæ•´çš„ç³»ç»Ÿç§»æ¤å’Œå¼€å‘é¢†åŸŸã€‚</p>
<pre><code>


&lt;!-- 04-Reference/Advanced/so_anti_debugging_and_obfuscation.md --&gt;

# SOæ–‡ä»¶åè°ƒè¯•ä¸å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯

åœ¨Android Nativeå±‚å®‰å…¨å¯¹æŠ—ä¸­ï¼ŒSOæ–‡ä»¶æ˜¯å®ç°é«˜å¼ºåº¦ä¿æŠ¤çš„é‡è¦è½½ä½“ã€‚é€šè¿‡init_arrayæœºåˆ¶ã€å­—ç¬¦ä¸²æ··æ·†å’Œåè°ƒè¯•æŠ€æœ¯çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥æ˜¾è‘—æé«˜é€†å‘åˆ†æçš„éš¾åº¦ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æè¿™äº›æŠ€æœ¯çš„å®ç°åŸç†åŠå¯¹åº”çš„åˆ†æç»•è¿‡æ–¹æ³•ã€‚
___
## 1. init_arrayè°ƒç”¨æµç¨‹åŸç†

## # 1.1 ELFåŠ è½½ä¸init_arrayæ‰§è¡Œæ—¶æœº
</code></pre>
<pre><code>// 1. First call DT_INIT initialization function
if (init_func_ != nullptr) {
init_func_();
}

// 2. Then iterate through .init_array section function pointers
if (init_array_ != nullptr) {
for (size_t i = 0; i &lt; init_array_count_; ++i) {
// Call each constructor function
((void (*)())init_array_[i])();
}
}
}
</code></pre>
<p>â†“ nativeLoad() [art/runtime/native/java_lang_Runtime.cc] â†“
android_dlopen_ext() [bionic/libdl/libdl.cpp] â†“ do_dlopen()
[bionic/linker/linker.cpp] â†“ find_library() â†’ load_library() â†’
link_image() â†“ call_constructors() â†’ init_arrayFunctionExecute</p>
<pre><code>readelf -d target.so | grep INIT

# Use objdump for analysis
objdump -s -j .init_array target.so
</code></pre>
<p>Elf64_Addr *init_array; // Function pointer array size_t
init_array_count; // Array size } init_array_info;</p>
<p>// Anti-debugging function declaration
<strong>attribute</strong>((constructor)) void anti_debug_init() { //
Anti-debugging logic }</p>
<p>// After compilation, function pointers are generated in .init_array
section</p>
<pre><code>
```cpp
// String encryption macro definition
# define ENCRYPT_STRING(str) encrypt_string_xor(str, sizeof(str)-1, 0xAA)

constexpr char* encrypt_string_xor(const char* str, size_t len, char key) {
static char encrypted[256];
for (size_t i = 0; i &lt; len; i++) {
encrypted[i] = str[i] ^ key;
}
encrypted[len] = &#39;\0&#39;;
return encrypted;
}

// Usage example
void check_frida() {
// Original string: &quot;/data/local/tmp/frida-server&quot;
const char* encrypted = ENCRYPT_STRING(&quot;\xc4\xae\xa8\xa8\xe4\xe6\xe8\xe0\xe4\xe6\xe4\xa8\xe3\xed\xe4\xa0\xd7\xd9\xd6\xae\xa4\xd7\xd9\xe5\xd9&quot;);

char decrypted[256];
decrypt_string(encrypted, decrypted, strlen(encrypted), 0xAA);

if (access(decrypted, F_OK) == 0) {
exit(1);
}
}
</code></pre>
<p>private: static constexpr uint8_t AES_KEY[16] = { 0x2b, 0x7e, 0x15,
0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f,
0x3c };</p>
<p>static void aes_decrypt(const uint8_t* encrypted, uint8_t* decrypted,
size_t len) { AES_KEY aes_key; AES_set_decrypt_key(AES_KEY, 128,
&amp;aes_key);</p>
<p>for (size_t i = 0; i &lt; len; i += 16) { AES_decrypt(encrypted + i,
decrypted + i, &amp;aes_key); } }</p>
<p>public: static std::string decrypt_string(const uint8_t*
encrypted_data, size_t len) { std::vector<uint8_t> decrypted(len);
aes_decrypt(encrypted_data, decrypted.data(), len);</p>
<p>// ç§»é™¤padding size_t actual_len = len; while (actual_len &gt; 0
&amp;&amp; decrypted[actual_len - 1] == 0) { actual_lenâ€“; }</p>
<p>return std::string(reinterpret_cast&lt;char*&gt;(decrypted.data()),
actual_len); } };</p>
<p>// Use encrypted strings void advanced_anti_debug() { // Encrypted
â€œ/proc/self/statusâ€ string const uint8_t encrypted_proc_status[] = {
0x8a, 0x2d, 0x5e, 0x1f, 0x9b, 0x7c, 0x85, 0xa3, 0x4e, 0x92, 0x67, 0xc1,
0x55, 0x98, 0x33, 0x2a };</p>
<p>std::string proc_status = StringObfuscator::decrypt_string(
encrypted_proc_status, sizeof(encrypted_proc_status) );</p>
<p>check_debugger_via_status(proc_status.c_str()); }</p>
<pre><code>void construct_string_on_stack() {
char target_path[64];

// åˆ†æ®µæ„é€ String
strcpy(target_path, &quot;/data/&quot;);
strcat(target_path, &quot;local/&quot;);
strcat(target_path, &quot;tmp/&quot;);
strcat(target_path, &quot;frida-&quot;);
strcat(target_path, &quot;server&quot;);

if (access(target_path, F_OK) == 0) {
exit(1);
}

// æ¸…ç†æ ˆä¸Šæ•æ„ŸString
memset(target_path, 0, sizeof(target_path));
}
</code></pre>
<p>std::vector<std::string> fragments;</p>
<p>public: void add_fragment(const char* encrypted, size_t len, uint8_t
key) { std::string decrypted; for (size_t i = 0; i &lt; len; i++) {
decrypted += static_cast<char>(encrypted<a href="#i">i</a> ^ key); }
fragments.push_back(decrypted); }</p>
<p>std::string build() { std::string result; for (const auto&amp;
fragment : fragments) { result += fragment; }</p>
<p>// ç«‹å³æ¸…ç†fragments fragments.clear();</p>
<p>return result; } };</p>
<p>void dynamic_string_detection() { DynamicStringBuilder builder;</p>
<p>// åˆ†æ®µEncryptStringç‰‡æ®µ const char frag1[] = {0x8f, 0x9e, 0x9a,
0x9a, 0x8f}; // â€œ/dataâ€ const char frag2[] = {0x8f, 0x93, 0x91, 0x9d,
0x9e, 0x93}; // â€œ/localâ€ const char frag3[] = {0x8f, 0x9a, 0x94, 0x92};
// â€œ/tmpâ€</p>
<p>builder.add_fragment(frag1, 5, 0xEE); builder.add_fragment(frag2, 6,
0xEE); builder.add_fragment(frag3, 4, 0xEE);</p>
<p>std::string path = builder.build();</p>
<p>// Useæ„é€ PathPerformDetection perform_detection(path.c_str()); }</p>
<pre><code>import re
from elftools.elf.elffile import ELFFile

def detect_string_obfuscation(so_path):
with open(so_path, &#39;rb&#39;) as f:
elf = ELFFile(f)

# Check if .rodata section contains suspicious encrypted data
rodata_section = elf.get_section_by_name(&#39;.rodata&#39;)
if rodata_section:
data = rodata_section.data()

# Detect Xor pattern (high entropy)
entropy = calculate_entropy(data)
if entropy &gt; 7.5:
print(f&quot;[+] Possible XOR encrypted strings, entropy: {entropy}&quot;)

# Detect AES block pattern (16-byte aligned data blocks)
aes_patterns = find_aes_patterns(data)
if aes_patterns:
print(f&quot;[+] Possible AES encrypted strings: {len(aes_patterns)} blocks&quot;)

def calculate_entropy(data):
import math
byte_counts = [0] * 256
for byte in data:
byte_counts[byte] += 1

entropy = 0
for count in byte_counts:
if count &gt; 0:
freq = count / len(data)
entropy -= freq * math.log2(freq)

return entropy
</code></pre>
<p>// Hook common string decryption functions var decrypt_func =
Module.findExportByName(â€œlibtarget.soâ€, â€œ_Z15decrypt_stringPKcS0_hâ€); if
(decrypt_func) { Interceptor.attach(decrypt_func, { onEnter:
function(args) { this.encrypted = args[0]; this.output = args[1]; },
onLeave: function(retval) { var decrypted = this.output.readCString();
console.log(â€œ[+] Decrypted string:â€ + decrypted);</p>
<p>// Save the decrypted string send({ type: â€œdecrypted_stringâ€, data:
decrypted }); } }); }</p>
<p>// Hook Xor decryption var xor_decrypt =
Module.findExportByName(â€œlibtarget.soâ€, â€œdecrypt_stringâ€); if
(xor_decrypt) { Interceptor.attach(xor_decrypt, { onLeave:
function(retval) { var result = retval.readCString(); console.log(â€œ[+]
XOR decrypted:â€ + result); } }); } }</p>
<p>// Hook dynamic string construction function
hook_string_construction() { var strcat =
Module.findExportByName(â€œlibc.soâ€, â€œstrcatâ€); var strcpy =
Module.findExportByName(â€œlibc.soâ€, â€œstrcpyâ€);</p>
<p>var string_tracker = new Map();</p>
<p>Interceptor.attach(strcpy, { onEnter: function(args) { this.dest =
args[0]; this.src = args[1].readCString(); }, onLeave: function(retval)
{ string_tracker.set(this.dest.toString(), this.src); } });</p>
<p>Interceptor.attach(strcat, { onEnter: function(args) { this.dest =
args[0]; this.src = args[1].readCString(); }, onLeave: function(retval)
{ var dest_key = this.dest.toString(); var current =
string_tracker.get(dest_key) || â€œâ€œ; var new_string = current + this.src;
string_tracker.set(dest_key, new_string);</p>
<p>// Detect sensitive string construction if
(new_string.includes(â€œfridaâ€) || new_string.includes(â€œ/proc/â€) ||
new_string.includes(â€œgdbâ€)) { console.log(â€œ[!] Sensitive string
constructed:â€ + new_string); } } }); }</p>
<pre><code>
```cpp
// in/at.init_arrayInExecuteAnti-DebuggingFunction
__attribute__((constructor(101))) // Specifiedä¼˜å…ˆçº§
void init_anti_debug_level1() {
// 1. ptraceè‡ªèº«Protected
if (ptrace(PTRACE_TRACEME, 0, 1, 0) == -1) {
_exit(1);
}

// 2. DetectionDebugå™¨Process
check_debugger_processes();

// 3. DetectionFridaFile
check_frida_artifacts();
}

__attribute__((constructor(102))) 
void init_anti_debug_level2() {
// 4. DetectionMemoryMap
check_suspicious_mappings();

// 5. Detectionhookç—•è¿¹
check_hook_signatures();

// 6. TimeDetection
timing_attack_detection();
}

void check_debugger_processes() {
const char* debugger_names[] = {
&quot;gdb&quot;, &quot;lldb&quot;, &quot;strace&quot;, &quot;ida&quot;, &quot;x64dbg&quot;
};

for (const char* name : debugger_names) {
if (process_exists(name)) {
execute_anti_debug_response();
}
}
}

void check_frida_artifacts() {
const char* frida_indicators[] = {
&quot;/data/local/tmp/frida-server&quot;,
&quot;/data/local/tmp/frida-agent-64.so&quot;,
&quot;/system/lib64/libfrida-gum.so&quot;
};

for (const char* indicator : frida_indicators) {
if (file_exists(indicator)) {
execute_anti_debug_response();
}
}
}
</code></pre>
<p>// æ£€æµ‹ä»£ç æ®µå®Œæ•´æ€§ verify_code_integrity();</p>
<p>// Detectionanomalyå‘é‡table check_exception_handlers();</p>
<p>// SetMemoryProtected setup_memory_protection(); }</p>
<p>void check_suspicious_mappings() { FILE* maps =
fopen(â€œ/proc/self/mapsâ€, â€œrâ€); char line[512];</p>
<p>while (fgets(line, sizeof(line), maps)) { // Detectionå¯ç–‘LibraryMap
if (strstr(line, â€œfridaâ€) || strstr(line, â€œgum-js-loopâ€) || strstr(line,
â€œxposedâ€)) { fclose(maps); execute_anti_debug_response(); }</p>
<p>// Detectionå¯ç–‘æƒé™ç»„åˆ if (strstr(line, â€œrwxpâ€)) { //
å¯è¯»å†™æ‰§è¡Œé¡µé¢ analyze_rwx_mapping(line); } }</p>
<p>fclose(maps); }</p>
<p>void verify_code_integrity() { // CalculateCodeæ®µå“ˆå¸ŒValue Dl_info
info; dladdr((void*)verify_code_integrity, &amp;info);</p>
<p>const char* base = (const char*)info.dli_fbase; size_t text_size =
get_text_section_size(base);</p>
<p>uint32_t current_hash = calculate_crc32(base, text_size); uint32_t
expected_hash = get_expected_hash();</p>
<p>if (current_hash != expected_hash) { //
Codeè¢«Modifyï¼ŒExecuteå¯¹æŠ—Measure code_tampering_detected(); } }</p>
<pre><code>void init_timing_checks() {
// å¯åŠ¨å®šæ—¶å™¨æ£€æµ‹
start_timing_monitor();

// Detectionå•æ­¥Execute
detect_single_stepping();
}

void detect_single_stepping() {
struct timespec start, end;
clock_gettime(CLOCK_MONOTONIC, &amp;start);

// Executeä¸€äº›SimpleOperation
volatile int dummy = 0;
for (int i = 0; i &lt; 1000; i++) {
dummy += i;
}

clock_gettime(CLOCK_MONOTONIC, &amp;end);

long duration = (end.tv_sec - start.tv_sec) * 1000000000 + 
(end.tv_nsec - start.tv_nsec);

// IfExecuteTimeanomalyï¼Œå¯èƒ½in/atå•æ­¥Debug
if (duration &gt; NORMAL_EXECUTION_TIME * 10) {
single_step_detected();
}
}

void start_timing_monitor() {
std::thread([]() {
while (true) {
std::this_thread::sleep_for(std::chrono::seconds(5));

// å®šæœŸæ£€æµ‹ç³»ç»Ÿè°ƒç”¨æ—¶é—´
struct timespec start, end;
clock_gettime(CLOCK_MONOTONIC, &amp;start);
getpid(); // Simpleç³»ç»ŸCall
clock_gettime(CLOCK_MONOTONIC, &amp;end);

long syscall_time = (end.tv_sec - start.tv_sec) * 1000000000 + 
(end.tv_nsec - start.tv_nsec);

if (syscall_time &gt; NORMAL_SYSCALL_TIME * 5) {
// ç³»ç»Ÿè°ƒç”¨è¢«æ‹¦æˆªæˆ–è°ƒè¯•
syscall_hooking_detected();
}
}
}).detach();
}
</code></pre>
<p>EXIT_SILENTLY, CORRUPT_DATA, FAKE_EXECUTION, CRASH_GRACEFULLY,
REPORT_TO_SERVER };</p>
<p>void execute_anti_debug_response() { static int detection_count = 0;
detection_count++;</p>
<p>// æ ¹æ®æ£€æµ‹æ¬¡æ•°é€‰æ‹©ä¸åŒå“åº”ç­–ç•¥ AntiDebugResponse response =
select_response_strategy(detection_count);</p>
<p>switch (response) { case AntiDebugResponse::EXIT_SILENTLY: _exit(0);
break;</p>
<p>case AntiDebugResponse::CORRUPT_DATA: corrupt_critical_data();
break;</p>
<p>case AntiDebugResponse::FAKE_EXECUTION: enter_fake_execution_mode();
break;</p>
<p>case AntiDebugResponse::CRASH_GRACEFULLY: trigger_controlled_crash();
break;</p>
<p>case AntiDebugResponse::REPORT_TO_SERVER: report_debug_attempt();
_exit(1); break; } }</p>
<p>void corrupt_critical_data() { //
ç ´åå…³KeyDataç»“æ„ï¼Œä½¿AnalysisResultNoæ•ˆ extern char
critical_data_start[]; extern char critical_data_end[];</p>
<p>size_t size = critical_data_end - critical_data_start; for (size_t i
= 0; i &lt; size; i++) { critical_data_start<a href="#i">i</a> ^= 0xFF;
} }</p>
<p>void enter_fake_execution_mode() { //
è¿›å…¥è™šFalseExecuteæ¨¡å¼ï¼ŒReturnErrorAnalysisResult global_fake_mode =
true;</p>
<p>// ModifyFunctionæŒ‡é’ˆï¼ŒæŒ‡å‘è™šFalseImplement
redirect_function_calls(); }</p>
<pre><code>
```python
# Tool to analyze init_array section
import subprocess
from elftools.elf.elffile import ELFFile

class InitArrayAnalyzer:
def __init__(self, so_path):
self.so_path = so_path
self.init_functions = []

def analyze_init_array(self):
# Use readelf to get init_array information
result = subprocess.run([&#39;readelf&#39;, &#39;-d&#39;, self.so_path],
capture_output=True, text=True)

for line in result.stdout.split(&#39;\n&#39;):
if &#39;INIT_ARRAY&#39; in line:
# Parse init_array address and size
self.parse_init_array_info(line)

def extract_function_addresses(self):
with open(self.so_path, &#39;rb&#39;) as f:
elf = ELFFile(f)

# Find .init_array section
init_array_section = elf.get_section_by_name(&#39;.init_array&#39;)
if init_array_section:
data = init_array_section.data()

# Parse function pointers (8-byte aligned)
for i in range(0, len(data), 8):
if i + 8 &lt;= len(data):
func_addr = int.from_bytes(data[i:i+8], &#39;little&#39;)
self.init_functions.append(func_addr)
print(f&quot;[+] Init function at: 0x{func_addr:x}&quot;)

def disassemble_functions(self):
# Use objdump to disassemble each initialization function
for addr in self.init_functions:
print(f&quot;\n[+] Disassembling function at 0x{addr:x}&quot;)
subprocess.run([&#39;objdump&#39;, &#39;-d&#39;, &#39;--start-address&#39;, hex(addr),
&#39;--stop-address&#39;, hex(addr + 0x100), self.so_path])

# Usage example
analyzer = InitArrayAnalyzer(&#39;target.so&#39;)
analyzer.analyze_init_array()
analyzer.extract_function_addresses()
analyzer.disassemble_functions()
</code></pre>
<p>// Hook constructor function calls var call_constructors =
Module.findExportByName(â€œlinker64â€, â€œ_ZN6soinfo17call_constructorsEvâ€);
if (call_constructors) { Interceptor.attach(call_constructors, {
onEnter: function(args) { var soinfo = args[0]; var soname =
get_soname(soinfo); console.log(â€œ[+] Calling constructors for:â€ +
soname);</p>
<p>this.soname = soname; this.start_time = Date.now(); }, onLeave:
function(retval) { var duration = Date.now() - this.start_time;
console.log(â€œ[+] Constructors completed forâ€ + this.soname + â€ in â€ +
duration + â€œmsâ€); } }); }</p>
<p>// Hook each function in init_array var target_module =
Process.findModuleByName(â€œlibtarget.soâ€); if (target_module) {
analyze_init_array_section(target_module); } }</p>
<p>function analyze_init_array_section(module) { //
ParseELFFileæ‰¾åˆ°init_arrayæ®µ var elf_base = module.base; var elf_header
= elf_base.readByteArray(64); // ELF header</p>
<p>// GetProgramå¤´tableåç§» var phoff = elf_base.add(0x20).readU64();
var phnum = elf_base.add(0x38).readU16();</p>
<p>// IterateProgramå¤´ï¼ŒæŸ¥æ‰¾PT_DYNAMIC for (var i = 0; i &lt; phnum;
i++) { var ph_addr = elf_base.add(phoff).add(i * 56); var p_type =
ph_addr.readU32();</p>
<p>if (p_type === 2) { // PT_DYNAMIC var p_vaddr =
ph_addr.add(16).readU64(); var dynamic_addr = elf_base.add(p_vaddr);</p>
<p>parse_dynamic_section(dynamic_addr, module); break; } } }</p>
<p>function parse_dynamic_section(dynamic_addr, module) { var addr =
dynamic_addr;</p>
<p>while (true) { var tag = addr.readU64(); var val =
addr.add(8).readU64();</p>
<p>if (tag === 0) break; // DT_NULL</p>
<p>if (tag === 25) { // DT_INIT_ARRAY var init_array_addr =
module.base.add(val); console.log(â€œ[+] Found init_array at:â€ +
init_array_addr);</p>
<p>// Hook init_arrayinæ¯Function
hook_init_array_functions(init_array_addr, module); } else if (tag ===
27) { // DT_INIT_ARRAYSZ var array_size = val; console.log(â€œ[+]
Init_array size:â€ + array_size); }</p>
<p>addr = addr.add(16); } }</p>
<p>function hook_init_array_functions(init_array_addr, module) { var
num_functions = 10; // Falseè®¾æœ€å¤š10Function</p>
<p>for (var i = 0; i &lt; num_functions; i++) { var func_ptr_addr =
init_array_addr.add(i * 8); var func_addr =
func_ptr_addr.readPointer();</p>
<p>if (func_addr.isNull()) break;</p>
<p>console.log(â€œ[+] Hooking init functionâ€ + i + â€ at: â€ +
func_addr);</p>
<p>Interceptor.attach(func_addr, { onEnter: function(args) {
console.log(â€œ[!] Init functionâ€ + this.func_index + â€ calledâ€);</p>
<p>// PrintCallæ ˆ console.log(Thread.backtrace(this.context,
Backtracer.ACCURATE) .map(DebugSymbol.fromAddress).join(â€˜â€™)); },
onLeave: function(retval) { console.log(â€œ[!] Init functionâ€ +
this.func_index + â€ completedâ€); } }); } }</p>
<pre><code>function bypass_ptrace() {
var ptrace = Module.findExportByName(&quot;libc.so&quot;, &quot;ptrace&quot;);
if (ptrace) {
Interceptor.attach(ptrace, {
onEnter: function(args) {
var request = args[0].toInt32();
if (request === 0) { // PTRACE_TRACEME
console.log(&quot;[+] Blocking PTRACE_TRACEME&quot;);
args[0] = ptr(-1);
}
},
onLeave: function(retval) {
// å§‹ç»ˆReturnSuccess
retval.replace(ptr(0));
}
});
}
}

// BypassFileDetection
function bypass_file_detection() {
var access = Module.findExportByName(&quot;libc.so&quot;, &quot;access&quot;);
var openat = Module.findExportByName(&quot;libc.so&quot;, &quot;openat&quot;);

var blocked_paths = [
&quot;/data/local/tmp/frida-server&quot;,
&quot;/proc/self/maps&quot;, 
&quot;/proc/self/status&quot;
];

if (access) {
Interceptor.attach(access, {
onEnter: function(args) {
var path = args[0].readCString();
if (blocked_paths.some(p =&gt; path.includes(p))) {
console.log(&quot;[+] Blocking access to: &quot; + path);
args[0] = Memory.allocUtf8String(&quot;/dev/null&quot;);
}
}
});
}

if (openat) {
Interceptor.attach(openat, {
onEnter: function(args) {
var path = args[1].readCString();
if (blocked_paths.some(p =&gt; path.includes(p))) {
console.log(&quot;[+] Blocking openat for: &quot; + path);
args[1] = Memory.allocUtf8String(&quot;/dev/null&quot;);
}
}
});
}
}

// BypassTimeDetection
function bypass_timing_detection() {
var clock_gettime = Module.findExportByName(&quot;libc.so&quot;, &quot;clock_gettime&quot;);
if (clock_gettime) {
var fake_time = {
sec: 1640995200, // å›ºå®šæ—¶é—´æˆ³
nsec: 0
};

Interceptor.attach(clock_gettime, {
onLeave: function(retval) {
var timespec = this.context.x1; // SecondParameter
if (!timespec.isNull()) {
// Writeå›ºå®šTimeValue
timespec.writeU64(fake_time.sec);
timespec.add(8).writeU64(fake_time.nsec);

// æ¯æ¬¡è°ƒç”¨ç•¥å¾®å¢åŠ çº³ç§’
fake_time.nsec += 1000;
}
}
});
}
}
</code></pre>
<p>var mprotect = Module.findExportByName(â€œlibc.soâ€, â€œmprotectâ€); if
(mprotect) { Interceptor.attach(mprotect, { onEnter: function(args) {
var addr = args[0]; var size = args[1].toInt32(); var prot =
args[2].toInt32();</p>
<p>console.log(â€œ[+] mprotect:â€ + addr + â€œ, size:â€ + size + â€œ, prot: 0xâ€
+ prot.toString(16));</p>
<p>// é˜»æ­¢ç§»é™¤execute permission if ((prot &amp; 0x4) === 0) { args[2] =
ptr(prot | 0x4); // AddPROT_EXEC } } }); } }</p>
<p>// HookStringDecryptFunction function hook_string_decryption() { var
module = Process.findModuleByName(â€œlibtarget.soâ€); if (!module)
return;</p>
<p>// æ‰«æDecryptFunctionæ¨¡å¼ var pattern = â€œ48 89 ?? 48 89 ?? 48 83 ??
?? 8B ?? ??â€; // x64DecryptFunctionæ¨¡å¼</p>
<p>Memory.scan(module.base, module.size, pattern, { onMatch:
function(address, size) { console.log(â€œ[+] Found potential decryption
function at:â€ + address);</p>
<p>Interceptor.attach(address, { onEnter: function(args) {
console.log(â€œ[+] Decryption function calledâ€); this.args =
Array.prototype.slice.call(args); }, onLeave: function(retval) { //
å°è¯•ReadDecryptResult try { var result = retval.readCString(); if
(result &amp;&amp; result.length &gt; 0 &amp;&amp; result.length &lt;
256) { console.log(â€œ[+] Decrypted string:â€ + result); } } catch (e) { //
å¯èƒ½ä¸isString } } }); }, onComplete: function() { console.log(â€œ[+]
Decryption function scan completedâ€); } }); }</p>
<p>// æ™ºèƒ½Anti-DebuggingBypass function intelligent_anti_debug_bypass()
{ // 1. è‡ªåŠ¨æ£€æµ‹å¹¶ç»•è¿‡å¸¸è§åè°ƒè¯•æŠ€æœ¯ bypass_ptrace();
bypass_file_detection(); bypass_timing_detection();
bypass_memory_protection();</p>
<p>// 2. Monitorinit_arrayExecute monitor_init_array();</p>
<p>// 3. HookStringDecrypt hook_string_decryption();</p>
<p>// 4. Setå®šæœŸCheckï¼ŒProcessNewAnti-Debuggingæœºåˆ¶
setInterval(function() { check_new_anti_debug_mechanisms(); }, 5000);
}</p>
<p>function check_new_anti_debug_mechanisms() { //
DetectionNewAnti-DebuggingThread var threads =
Process.enumerateThreads(); threads.forEach(function(thread) { // Check
if ThreadCallæ ˆ is ContainsAnti-DebuggingFunction var backtrace =
Thread.backtrace(thread.context, Backtracer.ACCURATE); //
Analysiså¹¶Processâ€¦ }); }</p>
<pre><code>// å®ç°å¤šå±‚çº§ä¿æŠ¤æœºåˆ¶
class ComprehensiveProtection {
private:
static bool stage1_passed;
static bool stage2_passed;
static bool stage3_passed;

public:
// ç¬¬ä¸€Stageï¼šBasicDetection
__attribute__((constructor(101)))
static void protection_stage1() {
if (basic_anti_debug_check()) {
stage1_passed = true;
decrypt_stage2_key();
} else {
enter_decoy_mode();
}
}

// SecondStageï¼šæ·±åº¦Detection
__attribute__((constructor(102)))
static void protection_stage2() {
if (!stage1_passed) return;

if (advanced_detection()) {
stage2_passed = true;
unlock_critical_functions();
} else {
corrupt_stage2_data();
}
}

// ç¬¬ä¸‰Stageï¼šRunWhenProtected
__attribute__((constructor(103)))
static void protection_stage3() {
if (!stage2_passed) return;

start_runtime_protection();
stage3_passed = true;
}

// å…³é”®å‡½æ•°åªæœ‰åœ¨æ‰€æœ‰æ£€æµ‹é€šè¿‡åæ‰èƒ½æ­£å¸¸æ‰§è¡Œ
static bool is_protection_active() {
return stage1_passed &amp;&amp; stage2_passed &amp;&amp; stage3_passed;
}
};
</code></pre>
<p>private: enum ThreatLevel { NO_THREAT = 0, LOW_THREAT = 1,
MEDIUM_THREAT = 2, HIGH_THREAT = 3, CRITICAL_THREAT = 4 };</p>
<p>static ThreatLevel assess_threat_level() { int threat_score = 0;</p>
<p>// å„ç§æ£€æµ‹æƒé‡è¯„åˆ† if (detect_frida()) threat_score += 30; if
(detect_debugger()) threat_score += 25; if (detect_hook()) threat_score
+= 20; if (detect_emulator()) threat_score += 15; if (detect_root())
threat_score += 10;</p>
<p>if (threat_score &gt;= 80) return CRITICAL_THREAT; if (threat_score
&gt;= 60) return HIGH_THREAT; if (threat_score &gt;= 40) return
MEDIUM_THREAT; if (threat_score &gt;= 20) return LOW_THREAT; return
NO_THREAT; }</p>
<p>public: static void adaptive_response() { ThreatLevel level =
assess_threat_level();</p>
<p>switch (level) { case CRITICAL_THREAT: immediate_termination();
break; case HIGH_THREAT: data_corruption_and_exit(); break; case
MEDIUM_THREAT: fake_execution_mode(); break; case LOW_THREAT:
increased_monitoring(); break; case NO_THREAT: normal_execution();
break; } } };</p>
<pre><code>1. å¤šå±‚çº§æ£€æµ‹æœºåˆ¶ï¼Œåˆ†é˜¶æ®µéªŒè¯
2. å­—ç¬¦ä¸²åŠ¨æ€è§£å¯†ï¼Œé¿å…é™æ€åˆ†æ 
3. æ—¶é—´å’Œè¡Œä¸ºæ£€æµ‹ï¼Œè¯†åˆ«è°ƒè¯•ç¯å¢ƒ
4. è‡ªé€‚åº”å“åº”ç­–ç•¥ï¼Œæ ¹æ®å¨èƒç­‰çº§è°ƒæ•´

* *åˆ†ææ–¹çš„åº”å¯¹ç­–ç•¥**ï¼š
1. é™æ€åˆ†æç»“åˆåŠ¨æ€Hook
2. å…¨é¢çš„APIæ‹¦æˆªå’Œé‡å®šå‘
3. æ—¶é—´å’Œç¯å¢ƒæ¨¡æ‹Ÿ
4. è‡ªåŠ¨åŒ–ç»•è¿‡è„šæœ¬å¼€å‘

è¿™ä¸€æŠ€æœ¯å¯¹æŠ—å°†æŒç»­æ¼”è¿›ï¼ŒåŒæ–¹éƒ½éœ€è¦ä¸æ–­æå‡æŠ€æœ¯æ°´å¹³ä»¥åº”å¯¹æ–°çš„æŒ‘æˆ˜ã€‚</code></pre>
<!-- 04-Reference/Advanced/so_runtime_emulation.md -->
<h1 id="so-è¿è¡Œæ—¶ä»¿çœŸè„±ç¦»è®¾å¤‡çš„-native-ä»£ç æ‰§è¡Œ">SO
è¿è¡Œæ—¶ä»¿çœŸï¼šè„±ç¦»è®¾å¤‡çš„ Native ä»£ç æ‰§è¡Œ</h1>
<p>åœ¨é«˜çº§ Android é€†å‘å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è‡ªåŠ¨åŒ–åœ°è°ƒç”¨ SO
æ–‡ä»¶ä¸­çš„åŠ å¯†ã€ç­¾åæˆ–æ ¡éªŒå‡½æ•°ã€‚ç„¶è€Œï¼Œåœ¨çœŸå®çš„è®¾å¤‡ä¸Šé€šè¿‡ Frida Hook
æ¥åšè¿™ä»¶äº‹ï¼Œä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°åè°ƒè¯•å’Œç¯å¢ƒæ£€æµ‹çš„é˜»ç¢ã€‚</p>
<ul>
<li>*SO
è¿è¡Œæ—¶ä»¿çœŸ**ï¼ˆæœ‰æ—¶è¢«ç§°ä¸ºâ€ç¬¦å·æ‰§è¡Œâ€çš„å·¥ç¨‹åŒ–åº”ç”¨ï¼‰æ˜¯ä¸€ç§é©å‘½æ€§çš„æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åœ¨
PC ä¸Šåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„ Android Native è¿è¡Œç¯å¢ƒï¼Œç›´æ¥åŠ è½½å¹¶æ‰§è¡Œ SO
æ–‡ä»¶ï¼Œä»è€Œæ‘†è„±å¯¹çœŸå®è®¾å¤‡çš„ä¾èµ–ã€‚</li>
</ul>
<h2 id="æ ¸å¿ƒæ¶æ„-1">æ ¸å¿ƒæ¶æ„</h2>
<p>ä¸€ä¸ªå…¸å‹çš„ SO ä»¿çœŸæ¡†æ¶ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†æ„æˆï¼š</p>
<h2 id="elf-åŠ è½½å™¨-elf-loader"># 1. ELF åŠ è½½å™¨ (ELF Loader)</h2>
<p>è¿™æ˜¯ä»¿çœŸçš„åŸºç¡€ã€‚å®ƒè´Ÿè´£åƒ Android çš„ <code>linker</code>
ä¸€æ ·å·¥ä½œï¼š</p>
<ul>
<li><p><strong>è§£æ ELF</strong>: è¯»å– SO
æ–‡ä»¶çš„å¤´éƒ¨ã€ç¨‹åºå¤´ã€æ®µè¡¨ç­‰ä¿¡æ¯ã€‚</p></li>
<li><p><strong>å†…å­˜æ˜ å°„</strong>: æ ¹æ®ç¨‹åºå¤´ï¼ˆ<code>PT_LOAD</code>ï¼‰å°†
SO çš„ä»£ç æ®µï¼ˆ<code>.text</code>ï¼‰å’Œæ•°æ®æ®µï¼ˆ<code>.data</code>,
<code>.bss</code>ï¼‰åŠ è½½åˆ°æ¨¡æ‹Ÿçš„å†…å­˜ç©ºé—´ä¸­ã€‚</p></li>
<li><p><strong>å¤„ç†é‡å®šä½</strong>: è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚SO
æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“å®ƒä¼šè¢«åŠ è½½åˆ°å“ªä¸ªåŸºåœ°å€ï¼Œä¹Ÿä¸çŸ¥é“å¤–éƒ¨å‡½æ•°ï¼ˆå¦‚
<code>memcpy</code>ï¼‰çš„å…·ä½“åœ°å€ã€‚åŠ è½½å™¨éœ€è¦è§£æé‡å®šä½è¡¨ï¼ˆ<code>.rel.dyn</code>,
<code>.rela.dyn</code>ï¼‰ï¼Œå¹¶å°†ä»£ç ä¸­æ‰€æœ‰å¯¹å†…éƒ¨åœ°å€å’Œå¤–éƒ¨ç¬¦å·çš„å¼•ç”¨è¿›è¡Œä¿®æ­£ï¼Œå¡«å†™æ­£ç¡®çš„è¿è¡Œæ—¶åœ°å€ã€‚</p></li>
</ul>
<h2 id="cpu-æ¨¡æ‹Ÿå™¨-cpu-emulator"># 2. CPU æ¨¡æ‹Ÿå™¨ (CPU Emulator)</h2>
<ul>
<li><p><strong>Unicorn Engine</strong>: è¿™æ˜¯ç›®å‰æœ€ä¸»æµçš„é€‰æ‹©ã€‚Unicorn
æ˜¯ä¸€ä¸ªåŸºäº QEMU çš„è½»é‡çº§ã€å¤šå¹³å°çš„ CPU
æ¨¡æ‹Ÿå™¨åº“ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥æ‰§è¡ŒåŠ è½½åˆ°å†…å­˜ä¸­çš„ ARM æˆ– ARM64
æœºå™¨ç ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤çº§æ§åˆ¶</strong>: Unicorn
å…è®¸æˆ‘ä»¬ç²¾ç»†åœ°æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼ŒåŒ…æ‹¬è®¾ç½®å¯„å­˜å™¨ã€è¯»å†™å†…å­˜ã€ä»¥åŠé€šè¿‡ Hook
æœºåˆ¶åœ¨æ‰§è¡Œåˆ°ç‰¹å®šæŒ‡ä»¤æˆ–åœ°å€æ—¶è§¦å‘å›è°ƒã€‚</p></li>
</ul>
<h2 id="ç³»ç»Ÿåº“ä¸ç¯å¢ƒæ¨¡æ‹Ÿ-library-environment-mocking"># 3.
ç³»ç»Ÿåº“ä¸ç¯å¢ƒæ¨¡æ‹Ÿ (Library &amp; Environment Mocking)</h2>
<p>SO
æ–‡ä»¶ä¸ä¼šç‹¬ç«‹å­˜åœ¨ï¼Œå®ƒæ€»æ˜¯ä¼šè°ƒç”¨å¤–éƒ¨å‡½æ•°ã€‚ä»¿çœŸæ¡†æ¶å¿…é¡»èƒ½å¤Ÿâ€å‡è£…â€è‡ªå·±æ˜¯
Android ç³»ç»Ÿï¼Œæä¾›è¿™äº›å‡½æ•°ã€‚</p>
<ul>
<li><p><strong>Mock <code>libc.so</code></strong>: æä¾›
<code>malloc</code>, <code>free</code>, <code>memcpy</code>,
<code>strlen</code>, <code>printf</code> ç­‰æ ‡å‡† C åº“å‡½æ•°çš„å®ç°ã€‚å½“ SO
è°ƒç”¨è¿™äº›å‡½æ•°æ—¶ï¼Œä¼šè¢«é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±å®ç°çš„ç‰ˆæœ¬ã€‚</p></li>
<li><p><strong>Mock Android Framework Libraries</strong>: æä¾›
<code>liblog.so</code>
(<code>__android_log_print</code>)ã€<code>libz.so</code>
(å‹ç¼©åº“)ã€<code>libcrypto.so</code> (OpenSSL)
ç­‰å¸¸ç”¨ç³»ç»Ÿåº“çš„å‡½æ•°å®ç°ã€‚</p></li>
<li><p><strong>Mock JNI ç¯å¢ƒ</strong>: å¦‚æœè¦è°ƒç”¨çš„å‡½æ•°æ˜¯ JNI
å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜éœ€è¦æ¨¡æ‹Ÿ <code>JNIEnv</code>
æŒ‡é’ˆå’Œç›¸å…³çš„å‡½æ•°è¡¨ï¼ˆ<code>NewStringUTF</code>, <code>GetFieldID</code>
ç­‰ï¼‰ã€‚è¿™æ˜¯ä¸ Java ä¸–ç•Œäº¤äº’çš„å…³é”®ã€‚</p></li>
</ul>
<h2 id="æ¨èé¡¹ç›®unidbg">æ¨èé¡¹ç›®ï¼š<code>unidbg</code></h2>
<p><code>unidbg</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œæˆç†Ÿçš„ã€ä¸“é—¨ç”¨äº Android SO
ä»¿çœŸå’Œç¬¦å·æ‰§è¡Œçš„ Java å¼€æºé¡¹ç›®ã€‚å®ƒæå¤§åœ°ç®€åŒ–äº†ä¸Šè¿°å¤æ‚çš„å·¥ä½œã€‚</p>
<ul>
<li><p>*<code>unidbg</code> çš„ä¼˜ç‚¹**:</p></li>
<li><p><strong>é«˜åº¦è‡ªåŠ¨åŒ–</strong>: å†…ç½®äº†å®Œå–„çš„ ELF
åŠ è½½å™¨å’Œå¸¸ç”¨ç³»ç»Ÿåº“çš„ Mock å®ç°ã€‚</p></li>
<li><p><strong>æ˜“äºä½¿ç”¨</strong>: æä¾›äº†ç®€æ´çš„
APIï¼Œç”¨æˆ·åªéœ€å‡ è¡Œä»£ç å°±å¯ä»¥åŠ è½½ SOã€è°ƒç”¨å‡½æ•°ã€‚</p></li>
<li><p><strong>JNI æ¨¡æ‹Ÿ</strong>: æ‹¥æœ‰å¼ºå¤§çš„ JNI
æ¨¡æ‹Ÿèƒ½åŠ›ï¼Œç”šè‡³å¯ä»¥è°ƒç”¨å’Œ Mock Java å¯¹è±¡çš„æ–¹æ³•ã€‚</p></li>
<li><p><strong>è°ƒè¯•ä¸è·Ÿè¸ª</strong>: æ”¯æŒä¸ GDB
è¿æ¥è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Hook æœºåˆ¶æ‰“å°è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ã€‚</p></li>
</ul>
<h2 id="unidbg-ä½¿ç”¨èŒƒä¾‹-æ¦‚å¿µä»£ç "># <code>unidbg</code> ä½¿ç”¨èŒƒä¾‹
(æ¦‚å¿µä»£ç )</h2>
<div class="sourceCode" id="cb454"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use unidbg Callä¸€ SO inSignatureFunction</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SignatureCalculator <span class="op">{</span></span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Createä¸€ android ARM64 æ¨¡æ‹Ÿå™¨Instance</span></span>
<span id="cb454-5"><a href="#cb454-5" aria-hidden="true" tabindex="-1"></a>Emulator<span class="op">&lt;?&gt;</span> emulator <span class="op">=</span> AndroidEmulatorBuilder<span class="op">.</span><span class="fu">for64Bit</span><span class="op">().</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb454-6"><a href="#cb454-6" aria-hidden="true" tabindex="-1"></a>Memory memory <span class="op">=</span> emulator<span class="op">.</span><span class="fu">getMemory</span><span class="op">();</span></span>
<span id="cb454-7"><a href="#cb454-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-8"><a href="#cb454-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. LoadTarget SO FileåŠå…¶ä¾èµ–</span></span>
<span id="cb454-9"><a href="#cb454-9" aria-hidden="true" tabindex="-1"></a><span class="co">// unidbg ä¼šAutoProcessé‡å®šä½andä¾èµ–Load</span></span>
<span id="cb454-10"><a href="#cb454-10" aria-hidden="true" tabindex="-1"></a>Module module <span class="op">=</span> emulator<span class="op">.</span><span class="fu">loadLibrary</span><span class="op">(</span><span class="kw">new</span> <span class="bu">File</span><span class="op">(</span><span class="st">&quot;libnative-lib.so&quot;</span><span class="op">));</span></span>
<span id="cb454-11"><a href="#cb454-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-12"><a href="#cb454-12" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. å‡†å¤‡InputData</span></span>
<span id="cb454-13"><a href="#cb454-13" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> input <span class="op">=</span> <span class="st">&quot;this is my data to sign&quot;</span><span class="op">;</span></span>
<span id="cb454-14"><a href="#cb454-14" aria-hidden="true" tabindex="-1"></a><span class="co">// WillInputStringWriteæ¨¡æ‹Ÿå™¨MemoryIn</span></span>
<span id="cb454-15"><a href="#cb454-15" aria-hidden="true" tabindex="-1"></a>Pointer inputPtr <span class="op">=</span> memory<span class="op">.</span><span class="fu">allocateString</span><span class="op">(</span>input<span class="op">);</span></span>
<span id="cb454-16"><a href="#cb454-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-17"><a href="#cb454-17" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. CallTargetFunction</span></span>
<span id="cb454-18"><a href="#cb454-18" aria-hidden="true" tabindex="-1"></a><span class="co">// d.callFunction() ä¼šAutoProcesså¯„å‚¨å™¨andStackSet</span></span>
<span id="cb454-19"><a href="#cb454-19" aria-hidden="true" tabindex="-1"></a><span class="bu">Number</span> result <span class="op">=</span> module<span class="op">.</span><span class="fu">callFunction</span><span class="op">(</span>emulator<span class="op">,</span> <span class="co">/* function offset */</span> <span class="bn">0x1234</span><span class="op">,</span> inputPtr<span class="op">,</span> input<span class="op">.</span><span class="fu">length</span><span class="op">());</span></span>
<span id="cb454-20"><a href="#cb454-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-21"><a href="#cb454-21" aria-hidden="true" tabindex="-1"></a><span class="co">// 5. ä»æ¨¡æ‹Ÿå™¨MemoryInReadResult</span></span>
<span id="cb454-22"><a href="#cb454-22" aria-hidden="true" tabindex="-1"></a>Pointer resultPtr <span class="op">=</span> Pointer<span class="op">.</span><span class="fu">pointer</span><span class="op">(</span>emulator<span class="op">,</span> result<span class="op">.</span><span class="fu">intValue</span><span class="op">());</span></span>
<span id="cb454-23"><a href="#cb454-23" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> signature <span class="op">=</span> resultPtr<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb454-24"><a href="#cb454-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-25"><a href="#cb454-25" aria-hidden="true" tabindex="-1"></a><span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;Input: &quot;</span> <span class="op">+</span> input<span class="op">);</span></span>
<span id="cb454-26"><a href="#cb454-26" aria-hidden="true" tabindex="-1"></a><span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;Signature: &quot;</span> <span class="op">+</span> signature<span class="op">);</span></span>
<span id="cb454-27"><a href="#cb454-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-28"><a href="#cb454-28" aria-hidden="true" tabindex="-1"></a><span class="co">// 6. å…³é—­æ¨¡æ‹Ÿå™¨</span></span>
<span id="cb454-29"><a href="#cb454-29" aria-hidden="true" tabindex="-1"></a>emulator<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb454-30"><a href="#cb454-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb454-31"><a href="#cb454-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li><p><strong>pyelftools</strong>: ç”¨äºè§£æ ELF
æ–‡ä»¶ï¼Œè·å–åŠ è½½ä¿¡æ¯ã€‚</p></li>
<li><p><strong>Python</strong>: èƒ¶æ°´è¯­è¨€ï¼Œç”¨äºç¼–å†™åŠ è½½å™¨å’Œ Mock
å‡½æ•°ã€‚</p></li>
</ul>
<h2 id="å®ç°æ­¥éª¤"># 2. å®ç°æ­¥éª¤</h2>
<h3 id="a.-åˆå§‹åŒ–-unicorn-ç¯å¢ƒ"># a. åˆå§‹åŒ– Unicorn ç¯å¢ƒ</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šæ¶æ„çš„æ¨¡æ‹Ÿå™¨ï¼Œå¹¶åˆ†é…å†…å­˜ç”¨äºåŠ è½½ SO
å’Œå †æ ˆã€‚</p>
<div class="sourceCode" id="cb455"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> unicorn <span class="im">import</span> <span class="op">*</span></span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> unicorn.arm64_const <span class="im">import</span> <span class="op">*</span></span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize ARM64 æ¨¡æ‹Ÿå™¨</span></span>
<span id="cb455-5"><a href="#cb455-5" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> Uc(UC_ARCH_ARM64, UC_MODE_ARM)</span>
<span id="cb455-6"><a href="#cb455-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-7"><a href="#cb455-7" aria-hidden="true" tabindex="-1"></a><span class="co"># DefineMemoryåŒºåŸŸ</span></span>
<span id="cb455-8"><a href="#cb455-8" aria-hidden="true" tabindex="-1"></a>BASE_ADDRESS <span class="op">=</span> <span class="bn">0x40000000</span></span>
<span id="cb455-9"><a href="#cb455-9" aria-hidden="true" tabindex="-1"></a>STACK_ADDRESS <span class="op">=</span> <span class="bn">0x70000000</span></span>
<span id="cb455-10"><a href="#cb455-10" aria-hidden="true" tabindex="-1"></a>STACK_SIZE <span class="op">=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span> <span class="co"># 1MB Stack</span></span>
<span id="cb455-11"><a href="#cb455-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-12"><a href="#cb455-12" aria-hidden="true" tabindex="-1"></a><span class="co"># MapMemory</span></span>
<span id="cb455-13"><a href="#cb455-13" aria-hidden="true" tabindex="-1"></a>mu.mem_map(BASE_ADDRESS, <span class="dv">2</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>) <span class="co"># 2MB for SO</span></span>
<span id="cb455-14"><a href="#cb455-14" aria-hidden="true" tabindex="-1"></a>mu.mem_map(STACK_ADDRESS, STACK_SIZE)</span>
<span id="cb455-15"><a href="#cb455-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-16"><a href="#cb455-16" aria-hidden="true" tabindex="-1"></a><span class="co"># SetStackæŒ‡é’ˆ (SP)</span></span>
<span id="cb455-17"><a href="#cb455-17" aria-hidden="true" tabindex="-1"></a>mu.reg_write(UC_ARM64_REG_SP, STACK_ADDRESS <span class="op">+</span> STACK_SIZE)</span></code></pre></div>
<p>def load_so(mu, so_path): with open(so_path, â€˜rbâ€™) as f: elffile =
ELFFile(f) for segment in elffile.iter_segments(): if
segment.header.p_type == â€˜PT_LOADâ€™: vaddr = segment.header.p_vaddr
mem_size = segment.header.p_memsz file_size = segment.header.p_filesz
data = segment.data()</p>
<h1 id="å°†æ®µå†™å…¥æ¨¡æ‹Ÿå™¨å†…å­˜">å°†æ®µå†™å…¥æ¨¡æ‹Ÿå™¨å†…å­˜</h1>
<p>mu.mem_write(BASE_ADDRESS + vaddr, data) print(fâ€Loaded segment at
{hex(BASE_ADDRESS + vaddr)} size {hex(mem_size)}â€œ) return
BASE_ADDRESS</p>
<h1 id="section-18">â€¦</h1>
<h1 id="load_somu-libnative-lib.so">load_so(mu, â€˜libnative-lib.soâ€™)</h1>
<pre><code># æ¨¡æ‹Ÿå¤–éƒ¨å‡½æ•°åœ°å€
MOCK_PUTS_ADDR = 0xFFFFFFFF00001000

# è®°å½•è¢« Hook çš„æŒ‡ä»¤ï¼Œé˜²æ­¢é‡å¤å¤„ç†
hooked_instructions = set()

def hook_code(mu, address, size, user_data):
# OnlyProcessè·³è½¬æŒ‡ä»¤
if address in hooked_instructions:
return

instruction = mu.mem_read(address, size)
# ç®€åŒ– BL æŒ‡ä»¤Check
if instruction[3] == 0x94: # BL instruction in ARM64
# è®¡ç®—è·³è½¬ç›®æ ‡åœ°å€ (ç®€åŒ–)
# å®é™…éœ€è¦å®Œæ•´è§£ç æŒ‡ä»¤
target_addr = ... 

if target_addr == MOCK_PUTS_ADDR:
# 1. ReadParameter (ARM64Inç¬¬ä¸€Parameterin/at X0 å¯„å­˜å™¨)
str_ptr = mu.reg_read(UC_ARM64_REG_X0)
# 2. ä»æ¨¡æ‹Ÿå™¨MemoryInReadString
str_val = mu.mem_read(str_ptr, 50).split(b&#39;\x00&#39;)[0]
# 3. Execute Mock åŠŸèƒ½
print(f&quot;[+] puts called with: &#39;{str_val.decode()}&#39;&quot;)
# 4. æ¨¡æ‹ŸFunctionReturnï¼ŒSetReturnAddress (LR) åˆ° PC
mu.reg_write(UC_ARM64_REG_PC, mu.reg_read(UC_ARM64_REG_LR))
else:
print(f&quot;Warning: Unhandled call to {hex(target_addr)}&quot;)

hooked_instructions.add(address)

# in/atæ•´ SO LoadåŒºåŸŸSet Hook
mu.hook_add(UC_HOOK_CODE, hook_code, begin=BASE_ADDRESS, end=BASE_ADDRESS + 0x100000) # Adjust size
</code></pre>
<ul>
<li><p><strong>Mock <code>fopen</code></strong>: åœ¨ Hook
ä¸­ï¼Œå½“ä½ è¯†åˆ«å‡ºå¯¹ <code>fopen</code> çš„è°ƒç”¨æ—¶ï¼Œä½ çš„ Python Mock
å‡½æ•°ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªè·¯å¾„å‚æ•°ï¼ˆå¦‚
<code>/data/local/tmp/config.txt</code>ï¼‰ã€‚ä½ çš„ Mock
å‡½æ•°é€»è¾‘å°±æ˜¯å°†è¿™ä¸ªæ¨¡æ‹Ÿå™¨å†…çš„è·¯å¾„æ‹¼æ¥ä¸Šä½ çš„ PC Rootfs è·¯å¾„
(<code>./my_rootfs</code> +
<code>/data/local/tmp/config.txt</code>)ï¼Œç„¶åç”¨ Python çš„
<code>open()</code> å‡½æ•°æ‰“å¼€çœŸå®æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„æ¨¡æ‹Ÿå€¼ç»™
SOã€‚</p></li>
<li><p><strong>Mock <code>fread</code>/<code>fwrite</code></strong>:
åç»­å¯¹ <code>fread</code> çš„è°ƒç”¨ï¼Œéƒ½ä¼šæ ¹æ®æ¨¡æ‹Ÿçš„æ–‡ä»¶å¥æŸ„ï¼Œåœ¨ä½ çš„ Python
Mock å‡½æ•°ä¸­æ“ä½œå¯¹åº”çš„çœŸå®æ–‡ä»¶ã€‚</p></li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥å®Œå…¨æ§åˆ¶ SO
çš„æ–‡ä»¶è®¿é—®ï¼Œä¸ºå…¶æä¾›å®šåˆ¶çš„è¾“å…¥æˆ–è®°å½•å…¶è¾“å‡ºã€‚</p>
<h2 id="åŸºäº-chroot-ä¸-linker-çš„é«˜çº§ä»¿çœŸ-cè¯­è¨€">åŸºäº <code>chroot</code>
ä¸ <code>linker</code> çš„é«˜çº§ä»¿çœŸ (Cè¯­è¨€)</h2>
<p>è¿™æ˜¯æœ€æ¥è¿‘â€çœŸå®â€çš„ä»¿çœŸæ–¹å¼ã€‚æˆ‘ä»¬ä¸å†ç”¨ <code>pyelftools</code> å»æ¨¡æ‹Ÿ
ELF åŠ è½½ï¼Œè€Œæ˜¯ç›´æ¥åˆ©ç”¨ä» Android ç³»ç»Ÿä¸­æå–å‡ºçš„ <code>linker64</code>
ç¨‹åºï¼Œè®©å®ƒåœ¨ä¸€ä¸ªå—æ§çš„ <code>chroot</code> ç¯å¢ƒä¸­ä¸ºæˆ‘ä»¬åŠ è½½ç›®æ ‡ SOã€‚</p>
<h2 id="æ ¸å¿ƒæ€è·¯"># 1. æ ¸å¿ƒæ€è·¯</h2>
<ol type="1">
<li><strong>æ„å»º Android Rootfs</strong>: åœ¨ Linux
ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªæœ€å°åŒ–çš„ Android æ–‡ä»¶ç³»ç»Ÿã€‚</li>
<li><strong>ç¼–å†™åŠ è½½å™¨ (Loader)</strong>: ç”¨ C
ç¼–å†™ä¸€ä¸ªåŠ è½½å™¨ç¨‹åºï¼Œå®ƒçš„å”¯ä¸€ä½¿å‘½å°±æ˜¯ <code>chroot</code> åˆ°æˆ‘ä»¬æ„å»ºçš„
Rootfs ä¸­ï¼Œç„¶åé€šè¿‡ <code>execve</code> å¯åŠ¨
<code>linker64</code>ã€‚</li>
<li><strong>ç¼–å†™æµ‹è¯•æ¡© (Test Harness)</strong>: ç”±äº
<code>linker64</code> éœ€è¦æ‰§è¡Œä¸€ä¸ªå¸¦æœ‰ <code>main</code>
å‡½æ•°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªâ€æµ‹è¯•æ¡©â€ç¨‹åºã€‚å®ƒçš„å”¯ä¸€ä½œç”¨å°±æ˜¯åŠ è½½ç›®æ ‡
SOï¼Œè°ƒç”¨æŒ‡å®šå‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœã€‚</li>
</ol>
<h2 id="å®ç°æ­¥éª¤-1"># 2. å®ç°æ­¥éª¤</h2>
<h3 id="a.-å‡†å¤‡-android-rootfs"># a. å‡†å¤‡ android Rootfs</h3>
<p>åœ¨ä½ çš„ Linux ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚
<code>~/android_rootfs/</code>ï¼Œå¹¶ä»¿ç…§çœŸå®è®¾å¤‡åˆ›å»ºç›®å½•ç»“æ„ã€‚ç„¶åä»ä¸€ä¸ªçœŸå®çš„
Android è®¾å¤‡ï¼ˆæˆ– AOSP ç¼–è¯‘äº§ç‰©ï¼‰ä¸­ <code>adb pull</code>
å‡ºå¿…è¦çš„ç³»ç»Ÿæ–‡ä»¶ï¼š</p>
<div class="sourceCode" id="cb457"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in/atä½  PC ä¸Š</span></span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/android_rootfs/system/lib64</span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/android_rootfs/system/bin</span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/android_rootfs/data/local/tmp</span>
<span id="cb457-5"><a href="#cb457-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-6"><a href="#cb457-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ä»è®¾å¤‡ä¸Šæ‹‰å–æ–‡ä»¶ (ä»¥ arm64 ä¸ºä¾‹)</span></span>
<span id="cb457-7"><a href="#cb457-7" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /system/bin/linker64 ~/android_rootfs/system/bin/</span>
<span id="cb457-8"><a href="#cb457-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /system/lib64/libc.so ~/android_rootfs/system/lib64/</span>
<span id="cb457-9"><a href="#cb457-9" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /system/lib64/libdl.so ~/android_rootfs/system/lib64/</span>
<span id="cb457-10"><a href="#cb457-10" aria-hidden="true" tabindex="-1"></a><span class="ex">adb</span> pull /system/lib64/libm.so ~/android_rootfs/system/lib64/</span>
<span id="cb457-11"><a href="#cb457-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-12"><a href="#cb457-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ... ä»¥åŠTargetSOå¯èƒ½ä¾èµ–å…¶ä»–Library</span></span>
<span id="cb457-13"><a href="#cb457-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-14"><a href="#cb457-14" aria-hidden="true" tabindex="-1"></a><span class="co"># å°†ä½ çš„ç›®æ ‡ SO å’Œæµ‹è¯•æ¡©ç¨‹åºä¹Ÿæ”¾è¿›å»</span></span>
<span id="cb457-15"><a href="#cb457-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> your_target.so ~/android_rootfs/data/local/tmp/</span>
<span id="cb457-16"><a href="#cb457-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> your_harness ~/android_rootfs/data/local/tmp/</span></code></pre></div>
<h1 id="include-dlfcn.h">include &lt;dlfcn.h&gt;</h1>
<p>// Falseè®¾TargetSOæœ‰ä¸€ExportFunction: char* process_data(const char*
input); typedef const char* (<em>process_data_func)(const
char</em>);</p>
<p>int main(int argc, char **argv) { // in/at chroot
ç¯å¢ƒInï¼ŒPathisç›¸å¯¹äºæ–°æ ¹Directory void* handle =
dlopen(â€œ/data/local/tmp/your_target.soâ€, RTLD_LAZY); if (!handle) {
fprintf(stderr, â€œCannot open library: %sâ€, dlerror()); return -1; }</p>
<p>// GetFunctionæŒ‡é’ˆ process_data_func func =
(process_data_func)dlsym(handle, â€œprocess_dataâ€); if (!func) {
fprintf(stderr, â€œCannot find symbol: %sâ€, dlerror()); dlclose(handle);
return -1; }</p>
<p>// CallFunctionå¹¶PrintResult const char* input = â€œhello from
harnessâ€; const char* result = func(input); printf(â€œResult from SO: %sâ€,
result);</p>
<p>dlclose(handle); return 0; }</p>
<pre><code></code></pre>
<h1 id="include-unistd.h">include &lt;unistd.h&gt;</h1>
<h1 id="include-stdlib.h">include &lt;stdlib.h&gt;</h1>
<p>int main(int argc, char **argv) { const char* root_dir =
â€œ/home/user/android_rootfsâ€; // Modifyä¸ºä½  rootfs Path</p>
<p>if (chroot(root_dir) != 0) { perror(â€œchroot failedâ€); return 1; }</p>
<p>// è¿›å…¥ chroot Afterï¼Œâ€˜/â€™ å°±isä¹‹Before root_dir chdir(â€œ/â€);</p>
<p>// å‡†å¤‡ execve Parameter char <em>new_argv[] = {
â€œ/data/local/tmp/harnessâ€, // è¦ExecuteProgram NULL }; char
</em>new_envp[] = { â€œLD_LIBRARY_PATH=/system/lib64â€, // å‘Šè¯‰ linker
in/atWhereæ‰¾ .so NULL };</p>
<p>// ä½¿ç”¨ linker64 æ¥æ‰§è¡Œæˆ‘ä»¬çš„æµ‹è¯•æ¡©ç¨‹åº // linker64 ä¼šProcess harness
AllLoadandé“¾æ¥å·¥ä½œ execve(â€œ/system/bin/linker64â€, new_argv,
new_envp);</p>
<p>// å¦‚æœ execve æˆåŠŸï¼Œè¿™è¡Œä»£ç æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ perror(â€œexecve failedâ€);
return 1; }</p>
<pre><code>| **Python + Unicorn** | çµæ´»ï¼Œå¯å®šåˆ¶æ€§å¼ºï¼Œå¯å®Œå…¨æ§åˆ¶æ‰§è¡Œæµç¨‹å’Œå†…å­˜å¸ƒå±€ï¼Œè·¨å¹³å°ã€‚å¸®åŠ©æ·±å…¥ç†è§£åŸç†ã€‚ | **ä¸­** | çº¯ Native ç®—æ³•é€†å‘ã€å®‰å…¨ç ”ç©¶ã€Fuzzingã€å­¦ä¹  ELF åŠ è½½å’Œ CPU ä»¿çœŸã€æ— å¤æ‚ç³»ç»Ÿæˆ– JNI ä¾èµ–çš„å‡½æ•°ã€‚ |
| **C + chroot + Test Harness** | ä¿çœŸåº¦æœ€é«˜ï¼Œæ€§èƒ½æœ€å¥½ï¼Œç›´æ¥åˆ©ç”¨ç³»ç»ŸåŸç”Ÿ `linker` å’Œåº“ï¼Œç¯å¢ƒä¸çœŸæœºå‡ ä¹ä¸€è‡´ã€‚ | **é«˜** | å¯¹è¿è¡Œç¯å¢ƒè¦æ±‚è‹›åˆ»çš„ SOã€éœ€è¦ TLS åˆå§‹åŒ–æˆ–æœ‰å¤æ‚ä¾èµ–çš„åœºæ™¯ã€è¿½æ±‚æè‡´çš„æ‰§è¡Œæ€§èƒ½ã€‚ |

## æ€»ç»“

SO è¿è¡Œæ—¶ä»¿çœŸæ˜¯ä¸€é¡¹é«˜çº§ä½†å›æŠ¥å·¨å¤§çš„æŠ€æœ¯ã€‚å®ƒå°†é€†å‘åˆ†æä»ç¹ççš„æ‰‹å·¥è°ƒè¯•å’Œ Hook ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¸¦å…¥äº†è‡ªåŠ¨åŒ–ã€å¯å¤§è§„æ¨¡æ‰©å±•çš„æ–°é˜¶æ®µã€‚å¯¹äºéœ€è¦é¢‘ç¹è°ƒç”¨ Native å‡½æ•°ã€åˆ†æå¤æ‚ç®—æ³•çš„åœºæ™¯ï¼ŒæŒæ¡å¦‚ `unidbg` è¿™æ ·çš„ä»¿çœŸæ¡†æ¶æ˜¯å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚

* **é€šä¿¡å›°éš¾**: ä¸»æœºä¸è¢«ä»¿çœŸè¿›ç¨‹çš„é€šä¿¡éœ€è¦å€ŸåŠ©æ–‡ä»¶ã€ç®¡é“æˆ– Socket ç­‰ IPC æœºåˆ¶ï¼Œä¸å¦‚ `unidbg` çš„ API è°ƒç”¨æ–¹ä¾¿ã€‚

* **æƒé™è¦æ±‚**: `chroot` æ“ä½œéœ€è¦ root æƒé™ã€‚</code></pre>
<!-- 04-Reference/Engineering/frameworks_and_middleware.md -->
<h1 id="å·¥ç¨‹åŒ–æ¡†æ¶å·¥å…·ä¸ä¸­é—´ä»¶">å·¥ç¨‹åŒ–ï¼šæ¡†æ¶ã€å·¥å…·ä¸ä¸­é—´ä»¶</h1>
<p>åœ¨å¤æ‚çš„é€†å‘å·¥ç¨‹å’Œæ•°æ®é‡‡é›†ä¸­ï¼Œå•çº¯ä¾é åŸºç¡€å·¥å…·å¾€å¾€æ•ˆç‡ä½ä¸‹ã€‚ä¸ºäº†å¤„ç†å¤§è§„æ¨¡çš„ä»»åŠ¡ã€ç®¡ç†å¤æ‚çš„ä¾èµ–å’Œä¿è¯æµç¨‹çš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥â€œå·¥ç¨‹åŒ–â€çš„æ€ç»´ï¼Œåˆ©ç”¨æˆç†Ÿçš„æ¡†æ¶å’Œä¸­é—´ä»¶æ¥æ„å»ºå¥å£®ã€å¯æ‰©å±•çš„åˆ†æç³»ç»Ÿã€‚</p>
<p>æœ¬èŠ‚å†…å®¹å°†èšç„¦äºé‚£äº›èƒ½å°†å•ä¸ªè„šæœ¬æå‡ä¸ºå·¥ä¸šçº§è§£å†³æ–¹æ¡ˆçš„å…³é”®æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p><strong>æ¶ˆæ¯é˜Ÿåˆ— (Message Queues)</strong>: å¦‚
RabbitMQï¼Œç”¨äºè§£è€¦ä»»åŠ¡çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œå®ç°å¼‚æ­¥å¤„ç†å’Œå‰Šå³°å¡«è°·ã€‚</p></li>
<li><p><strong>æ•°æ®å­˜å‚¨ (Data Storage)</strong>: å¦‚ MongoDB æˆ–
PostgreSQLï¼Œç”¨äºç»“æ„åŒ–åœ°å­˜å‚¨åˆ†æç»“æœï¼Œæ–¹ä¾¿åç»­çš„æŸ¥è¯¢å’ŒäºŒæ¬¡å¼€å‘ã€‚</p></li>
<li><p><strong>ç¼“å­˜ç³»ç»Ÿ (Caching Systems)</strong>: å¦‚
Redisï¼Œç”¨äºç¼“å­˜å¸¸ç”¨æ•°æ®ï¼ŒåŠ é€Ÿçƒ­ç‚¹è·¯å¾„çš„è®¿é—®ã€‚</p></li>
<li><p><strong>çˆ¬è™«æ¡†æ¶ (Crawling Frameworks)</strong>: å¦‚
Scrapyï¼Œæä¾›äº†ä¸€æ•´å¥—ç”¨äºç½‘ç»œæ•°æ®æå–çš„æ¶æ„ï¼ŒåŒ…æ‹¬è¯·æ±‚è°ƒåº¦ã€ä¸­é—´ä»¶å¤„ç†å’Œæ•°æ®ç®¡é“ã€‚</p></li>
</ul>
<p>é€šè¿‡ç»„åˆè¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ­å»ºèµ·ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†æµ·é‡è®¾å¤‡ã€æ‰§è¡Œå¤æ‚ä»»åŠ¡å¹¶é«˜æ•ˆå­˜å‚¨ç»“æœçš„å¼ºå¤§å¹³å°ã€‚</p>
<!-- 04-Reference/Engineering/message_queues.md -->
<hr />
<h1 id="å·¥ç¨‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—-message-queue">å·¥ç¨‹åŒ–ï¼šæ¶ˆæ¯é˜Ÿåˆ— (Message
Queue)</h1>
<p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”¨äºæœåŠ¡é—´å¼‚æ­¥é€šä¿¡çš„æ ¸å¿ƒç»„ä»¶ã€‚åœ¨è§„æ¨¡åŒ–çš„é€†å‘åˆ†æå’Œæ•°æ®é‡‡é›†ä¸­ï¼Œå®ƒæ‰®æ¼”ç€â€ç¼“å†²æ± â€å’Œâ€è§£è€¦å™¨â€çš„å…³é”®è§’è‰²ï¼Œç¡®ä¿æ•°æ®æµçš„ç¨³å®šã€é«˜æ•ˆå’Œå¯é ã€‚</p>
<hr />
<h2 id="æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨">1. æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨</h2>
<h3 id="a-ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—">a) ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h3>
<p>æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼šä½ æœ‰ 100 å°çˆ¬è™«èŠ‚ç‚¹ï¼ˆç”Ÿäº§è€…ï¼‰åœ¨é«˜é€ŸæŠ“å–æ•°æ®ï¼ŒåŒæ—¶æœ‰ 10
ä¸ªæ•°æ®å¤„ç†èŠ‚ç‚¹ï¼ˆæ¶ˆè´¹è€…ï¼‰è´Ÿè´£æ¸…æ´—å’Œå…¥åº“ã€‚å¦‚æœè®©ç”Ÿäº§è€…ç›´æ¥è°ƒç”¨æ¶ˆè´¹è€…çš„
APIï¼Œä¼šäº§ç”Ÿå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><strong>æ€§èƒ½è€¦åˆ</strong>:
æ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦ä¼šç›´æ¥é™åˆ¶ç”Ÿäº§è€…çš„æŠ“å–é€Ÿåº¦ã€‚å¦‚æœæ•°æ®åº“å†™å…¥ç¼“æ…¢ï¼Œæ•´ä¸ªçˆ¬è™«é›†ç¾¤éƒ½å¾—ç­‰ã€‚</li>
<li><strong>å³°å€¼å‹åŠ›</strong>:
å¦‚æœçŸ­æ—¶é—´å†…æŠ“å–åˆ°å¤§é‡æ•°æ®ï¼ˆæµé‡æ´ªå³°ï¼‰ï¼Œå¯èƒ½ä¼šç¬é—´å‹å®æ¶ˆè´¹è€…æœåŠ¡ã€‚</li>
<li><strong>æœåŠ¡ä¾èµ–</strong>:
å¦‚æœæ¶ˆè´¹è€…æœåŠ¡å®•æœºï¼Œæ‰€æœ‰ç”Ÿäº§è€…éƒ½ä¼šå¤±è´¥ï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚</li>
</ul>
<h3 id="b-æ¶ˆæ¯é˜Ÿåˆ—çš„è§£å†³æ–¹æ¡ˆ">b) æ¶ˆæ¯é˜Ÿåˆ—çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>MQ åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´å¢åŠ äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œè§£å†³äº†ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼š</p>
<ul>
<li><strong>å¼‚æ­¥è§£è€¦</strong>:
ç”Ÿäº§è€…åªéœ€å°†æ¶ˆæ¯ï¼ˆå¦‚â€ä¸€ä¸ªå¾…å¤„ç†çš„æ•°æ®åŒ…â€ï¼‰æ‰”è¿›é˜Ÿåˆ—å³å¯ï¼Œæ— éœ€å…³å¿ƒè°åœ¨æ¶ˆè´¹ã€ä½•æ—¶æ¶ˆè´¹ã€‚</li>
<li><strong>å‰Šå³°å¡«è°·</strong>:
æµé‡æ´ªå³°åˆ°æ¥æ—¶ï¼Œæ¶ˆæ¯ä¼šå…ˆåœ¨é˜Ÿåˆ—ä¸­ç§¯å‹ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„èŠ‚å¥å¹³ç¨³åœ°è¿›è¡Œå¤„ç†ï¼Œé¿å…äº†ç³»ç»Ÿå´©æºƒã€‚</li>
<li><strong>å¯é æ€§ä¸å†—ä½™</strong>:
å³ä½¿æ¶ˆè´¹è€…å®•æœºï¼Œæ¶ˆæ¯ä»ç„¶å®‰å…¨åœ°å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚å½“æ¶ˆè´¹è€…æ¢å¤åï¼Œå¯ä»¥ç»§ç»­å¤„ç†ï¼Œä¿è¯äº†æ•°æ®ä¸ä¸¢å¤±ã€‚</li>
</ul>
<hr />
<h2 id="ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ">2. ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ</h2>
<h3 id="a-kafka">a) Kafka</h3>
<ul>
<li><strong>å®šä½</strong>: ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€åˆ†åŒºçš„ã€å¤šå‰¯æœ¬çš„ã€åŸºäº
Zookeeper çš„<strong>æ—¥å¿—æäº¤ç³»ç»Ÿ (Commit Log)</strong>ã€‚</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:
<ul>
<li><strong>æè‡´çš„ååé‡</strong>:
è®¾è®¡ç›®æ ‡å°±æ˜¯ä¸ºäº†å¤„ç†æµ·é‡æ—¥å¿—æ•°æ®ï¼Œæ‹¥æœ‰æ— ä¸ä¼¦æ¯”çš„å†™å…¥å’Œè¯»å–æ€§èƒ½ï¼Œæ˜¯å¤§æ•°æ®é¢†åŸŸçš„é¦–é€‰ã€‚</li>
<li><strong>å‘å¸ƒ-è®¢é˜…æ¨¡å‹</strong>: æ¶ˆæ¯ä»¥â€ä¸»é¢˜
(Topic)â€œè¿›è¡Œåˆ†ç±»ã€‚ç”Ÿäº§è€…å‘ä¸€ä¸ª Topic å‘é€æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ç»„ (Consumer
Group) å¯ä»¥ç‹¬ç«‹åœ°è®¢é˜…å’Œæ¶ˆè´¹åŒä¸€ä¸ª Topic çš„æ¶ˆæ¯ï¼Œäº’ä¸å¹²æ‰°ã€‚</li>
<li><strong>æŒä¹…åŒ–ä¸å›æº¯</strong>: æ¶ˆæ¯åœ¨ Kafka
ä¸­æ˜¯æŒä¹…åŒ–å­˜å‚¨çš„ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®éœ€è¦â€å›æº¯â€åˆ°ä»»æ„æ—¶é—´ç‚¹ï¼ˆOffsetï¼‰é‡æ–°æ¶ˆè´¹æ•°æ®ï¼Œè¿™å¯¹äºæ•°æ®é‡å¤„ç†å’Œæ•…éšœæ¢å¤éå¸¸æœ‰ç”¨ã€‚</li>
</ul></li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:
<ul>
<li>éœ€è¦å¤„ç†æµ·é‡æ•°æ®æµçš„æ—¥å¿—æ”¶é›†ï¼ˆLog Ingestionï¼‰ã€‚</li>
<li>ä½œä¸º Spark Streaming æˆ– Flink ç­‰å®æ—¶è®¡ç®—æ¡†æ¶çš„æ•°æ®æºã€‚</li>
<li>æ„å»ºå¤§è§„æ¨¡æ•°æ®ç®¡é“çš„æ€»çº¿ã€‚</li>
</ul></li>
</ul>
<h3 id="b-rabbitmq">b) RabbitMQ</h3>
<ul>
<li><strong>å®šä½</strong>: ä¸€ä¸ªå®ç°äº† AMQP (é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)
çš„ã€åŠŸèƒ½ä¸°å¯Œçš„<strong>æ¶ˆæ¯ä»£ç† (Message Broker)</strong>ã€‚</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:
<ul>
<li><strong>çµæ´»çš„è·¯ç”±</strong>: æ‹¥æœ‰å¼ºå¤§çš„äº¤æ¢æœº (Exchange) å’Œè·¯ç”±é”®
(Routing Key) æœºåˆ¶ï¼Œå¯ä»¥å®ç°éå¸¸å¤æ‚çš„è·¯ç”±é€»è¾‘ï¼ˆå¦‚ fanout, direct,
topic, headersï¼‰ã€‚</li>
<li><strong>åŠŸèƒ½å…¨é¢</strong>:
æ”¯æŒæ¶ˆæ¯ç¡®è®¤ã€ä¼˜å…ˆçº§é˜Ÿåˆ—ã€å»¶è¿Ÿé˜Ÿåˆ—ã€æ­»ä¿¡é˜Ÿåˆ—ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚</li>
<li><strong>å¯é æ€§</strong>:
æä¾›äº†å¼ºå¤§çš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œèƒ½ç¡®ä¿æ¶ˆæ¯â€è‡³å°‘è¢«æˆåŠŸæ¶ˆè´¹ä¸€æ¬¡â€ã€‚</li>
</ul></li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:
<ul>
<li>ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œéœ€è¦ç²¾ç»†åŒ–æ§åˆ¶æ¶ˆæ¯è·¯ç”±çš„åœºæ™¯ã€‚</li>
<li>å¯¹æ¶ˆæ¯æŠ•é€’çš„å¯é æ€§è¦æ±‚æé«˜çš„é‡‘èæˆ–äº‹åŠ¡æ€§ç³»ç»Ÿã€‚</li>
<li>éœ€è¦ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—ç­‰é«˜çº§ç‰¹æ€§çš„ä¸šåŠ¡ã€‚</li>
</ul></li>
</ul>
<h3 id="c-redis">c) Redis</h3>
<ul>
<li><strong>å®šä½</strong>: ä¸€ä¸ªé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œä½†å…¶
<code>List</code> å’Œ <code>Pub/Sub</code>
åŠŸèƒ½ä½¿å…¶å¯ä»¥ä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ã€‚</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:
<ul>
<li><strong>ç®€å•å¿«é€Ÿ</strong>: é…ç½®ç®€å•ï¼Œè¯»å†™æ€§èƒ½æé«˜ï¼ˆåŸºäºå†…å­˜ï¼‰ã€‚</li>
<li><strong>åŠŸèƒ½æœ‰é™</strong>: ä¸æ”¯æŒå¤æ‚è·¯ç”±ï¼Œå¯é æ€§ä¿è¯è¾ƒå¼±ï¼ˆå¦‚
<code>Pub/Sub</code> ä¸ä¿è¯æ¶ˆæ¯å¿…è¾¾ï¼‰ï¼Œæ¶ˆæ¯ç§¯å‹èƒ½åŠ›å—å†…å­˜é™åˆ¶ã€‚</li>
</ul></li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:
<ul>
<li>ç³»ç»Ÿè§„æ¨¡ä¸å¤§ï¼Œå¯¹å¯é æ€§è¦æ±‚ä¸é«˜ï¼Œä½†å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚</li>
<li>ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚ Celery çš„ Brokerï¼‰ã€‚</li>
<li>å®ç°ç®€å•çš„å®æ—¶é€šçŸ¥æˆ–èŠå¤©åŠŸèƒ½ã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="æ€»ç»“-3">æ€»ç»“</h2>
<p>åœ¨å·¥ç¨‹åŒ–ä½“ç³»ä¸­ï¼Œé€‰æ‹©å“ªç§ MQ å–å†³äºå…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ï¼š</p>
<ul>
<li>è¿½æ±‚<strong>æè‡´çš„ååé‡å’Œå¤§æ•°æ®ç”Ÿæ€å…¼å®¹æ€§</strong>ï¼Œé€‰æ‹©
<code>Kafka</code>ã€‚</li>
<li>è¿½æ±‚<strong>çµæ´»çš„è·¯ç”±å’Œä¸šåŠ¡åŠŸèƒ½çš„ä¸°å¯Œæ€§</strong>ï¼Œé€‰æ‹©
<code>RabbitMQ</code>ã€‚</li>
<li>è¿½æ±‚<strong>ç®€å•ã€è½»é‡å’Œæè‡´çš„ä½å»¶è¿Ÿ</strong>ï¼Œ<code>Redis</code>
æ˜¯ä¸€ä¸ªä¸é”™çš„å¤‡é€‰é¡¹ã€‚</li>
</ul>
<hr />
<!-- 04-Reference/Engineering/redis.md -->
<h1 id="redis-å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•">Redis å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•</h1>
<p>Redis
æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸºäºå†…å­˜çš„ã€é«˜æ€§èƒ½çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆã€‚æœ¬å¤‡å¿˜å½•æ—¨åœ¨æä¾›å¸¸ç”¨å‘½ä»¤çš„å¿«é€Ÿå‚è€ƒã€‚
___ ## ç›®å½• - <a href="#redis-å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•">Redis å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•</a> -
<a href="#ç›®å½•">ç›®å½•</a> - <a
href="#è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†">è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</a></p>
<ul>
<li><p><a href="#é”®-key-æ“ä½œ">é”® (Key) æ“ä½œ</a></p></li>
<li><p><a href="#å­—ç¬¦ä¸²-string">å­—ç¬¦ä¸² (String)</a></p></li>
<li><p><a href="#å“ˆå¸Œ-hash">å“ˆå¸Œ (Hash)</a></p></li>
<li><p><a href="#åˆ—è¡¨-list">åˆ—è¡¨ (List)</a></p></li>
<li><p><a href="#é›†åˆ-set">é›†åˆ (Set)</a></p></li>
<li><p><a href="#æœ‰åºé›†åˆ-sorted-set--zset">æœ‰åºé›†åˆ (Sorted Set /
ZSet)</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†">è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</a></p></li>
<li><p><a href="#é”®-key-æ“ä½œ">é”® (Key) æ“ä½œ</a></p></li>
<li><p><a href="#å­—ç¬¦ä¸²-string">å­—ç¬¦ä¸² (String)</a></p></li>
<li><p><a href="#å“ˆå¸Œ-hash">å“ˆå¸Œ (Hash)</a></p></li>
<li><p><a href="#åˆ—è¡¨-list">åˆ—è¡¨ (List)</a></p></li>
<li><p><a href="#é›†åˆ-set">é›†åˆ (Set)</a></p></li>
<li><p><a href="#æœ‰åºé›†åˆ-sorted-set--zset">æœ‰åºé›†åˆ (Sorted Set /
ZSet)</a></p></li>
<li><p><a href="#è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†">è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</a></p></li>
<li><p><a href="#é”®-key-æ“ä½œ">é”® (Key) æ“ä½œ</a></p></li>
<li><p><a href="#å­—ç¬¦ä¸²-string">å­—ç¬¦ä¸² (String)</a></p></li>
<li><p><a href="#å“ˆå¸Œ-hash">å“ˆå¸Œ (Hash)</a></p></li>
<li><p><a href="#åˆ—è¡¨-list">åˆ—è¡¨ (List)</a></p></li>
<li><p><a href="#é›†åˆ-set">é›†åˆ (Set)</a></p></li>
<li><p><a href="#æœ‰åºé›†åˆ-sorted-set--zset">æœ‰åºé›†åˆ (Sorted Set /
ZSet)</a> ___ ## # è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</p></li>
</ul>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>redis-cli</code></td>
<td style="text-align: left;">å¯åŠ¨ Redis å‘½ä»¤è¡Œå®¢æˆ·ç«¯</td>
</tr>
<tr>
<td
style="text-align: left;"><code>redis-cli -h &lt;host&gt; -p &lt;port&gt; -a &lt;password&gt;</code></td>
<td style="text-align: left;">è¿æ¥åˆ°æŒ‡å®šçš„ Redis å®ä¾‹</td>
</tr>
<tr>
<td style="text-align: left;"><code>PING</code></td>
<td style="text-align: left;">æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦ä»åœ¨è¿è¡Œï¼Œè¿”å›
<code>PONG</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>AUTH &lt;password&gt;</code></td>
<td style="text-align: left;">éªŒè¯è¿æ¥å¯†ç </td>
</tr>
<tr>
<td style="text-align: left;"><code>SELECT &lt;index&gt;</code></td>
<td style="text-align: left;">é€‰æ‹©æ•°æ®åº“ (é»˜è®¤ 0-15)</td>
</tr>
<tr>
<td style="text-align: left;"><code>FLUSHDB</code></td>
<td style="text-align: left;">æ¸…ç©ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰é”®</td>
</tr>
<tr>
<td style="text-align: left;"><code>FLUSHALL</code></td>
<td style="text-align: left;">æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰é”®</td>
</tr>
<tr>
<td style="text-align: left;"><code>INFO</code></td>
<td style="text-align: left;">è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="é”®-key-æ“ä½œ"># é”® (Key) æ“ä½œ</h2>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>KEYS &lt;pattern&gt;</code></td>
<td style="text-align: left;">æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼çš„é”® (å¦‚
<code>KEYS *</code>, <code>KEYS user:*</code>)
<strong>(æ…ç”¨ï¼Œä¼šé˜»å¡)</strong></td>
</tr>
<tr>
<td
style="text-align: left;"><code>SCAN &lt;cursor&gt; [MATCH pattern] [COUNT count]</code></td>
<td style="text-align: left;">è¿­ä»£æ•°æ®åº“ä¸­çš„é”®ï¼Œæ¯” <code>KEYS</code>
æ›´å®‰å…¨</td>
</tr>
<tr>
<td style="text-align: left;"><code>EXISTS &lt;key&gt;</code></td>
<td style="text-align: left;">æ£€æŸ¥ç»™å®šé”®æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td
style="text-align: left;"><code>DEL &lt;key&gt; [key ...]</code></td>
<td style="text-align: left;">åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”®</td>
</tr>
<tr>
<td style="text-align: left;"><code>TYPE &lt;key&gt;</code></td>
<td style="text-align: left;">è¿”å›é”®æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹ (string, hash,
list, set, zset)</td>
</tr>
<tr>
<td style="text-align: left;"><code>TTL &lt;key&gt;</code></td>
<td style="text-align: left;">ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›ç»™å®šé”®çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ (Time
To Live)</td>
</tr>
<tr>
<td
style="text-align: left;"><code>EXPIRE &lt;key&gt; &lt;seconds&gt;</code></td>
<td style="text-align: left;">ä¸ºç»™å®šé”®è®¾ç½®ç”Ÿå­˜æ—¶é—´</td>
</tr>
<tr>
<td style="text-align: left;"><code>PERSIST &lt;key&gt;</code></td>
<td style="text-align: left;">ç§»é™¤ç»™å®šé”®çš„ç”Ÿå­˜æ—¶é—´ï¼Œä½¿å…¶æ°¸ä¹…ä¿å­˜</td>
</tr>
<tr>
<td
style="text-align: left;"><code>RENAME &lt;key&gt; &lt;newkey&gt;</code></td>
<td style="text-align: left;">ä¿®æ”¹é”®çš„åç§°</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="å­—ç¬¦ä¸²-string"># å­—ç¬¦ä¸² (String)</h2>
<p>å­—ç¬¦ä¸²æ˜¯ Redis
æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå¦‚æ–‡æœ¬ã€åºåˆ—åŒ–çš„ JSON
æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><code>SET &lt;key&gt; &lt;value&gt;</code></td>
<td style="text-align: left;">è®¾ç½®æŒ‡å®šé”®çš„å€¼</td>
</tr>
<tr>
<td style="text-align: left;"><code>GET &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–æŒ‡å®šé”®çš„å€¼</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SETEX &lt;key&gt; &lt;seconds&gt; &lt;value&gt;</code></td>
<td style="text-align: left;">è®¾ç½®é”®å€¼å¯¹å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SETNX &lt;key&gt; &lt;value&gt;</code></td>
<td style="text-align: left;">åªæœ‰åœ¨é”®ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®é”®çš„å€¼ (SET if Not
eXists)</td>
</tr>
<tr>
<td
style="text-align: left;"><code>MSET &lt;key1&gt; &lt;value1&gt; [key2 value2 ...]</code></td>
<td style="text-align: left;">åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹</td>
</tr>
<tr>
<td
style="text-align: left;"><code>MGET &lt;key1&gt; [key2 ...]</code></td>
<td style="text-align: left;">è·å–æ‰€æœ‰ç»™å®šé”®çš„å€¼</td>
</tr>
<tr>
<td style="text-align: left;"><code>INCR &lt;key&gt;</code></td>
<td style="text-align: left;">å°†é”®ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ (åŸå­æ“ä½œ)</td>
</tr>
<tr>
<td style="text-align: left;"><code>DECR &lt;key&gt;</code></td>
<td style="text-align: left;">å°†é”®ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ (åŸå­æ“ä½œ)</td>
</tr>
<tr>
<td
style="text-align: left;"><code>INCRBY &lt;key&gt; &lt;increment&gt;</code></td>
<td style="text-align: left;">å°†é”®æ‰€å‚¨å­˜çš„å€¼åŠ ä¸ŠæŒ‡å®šçš„å¢é‡å€¼</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="å“ˆå¸Œ-hash"># å“ˆå¸Œ (Hash)</h2>
<p>å“ˆå¸Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆï¼Œéå¸¸é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><code>HSET &lt;key&gt; &lt;field&gt; &lt;value&gt;</code></td>
<td style="text-align: left;">å°†å“ˆå¸Œè¡¨ <code>key</code> ä¸­çš„å­—æ®µ
<code>field</code> çš„å€¼è®¾ä¸º <code>value</code></td>
</tr>
<tr>
<td
style="text-align: left;"><code>HGET &lt;key&gt; &lt;field&gt;</code></td>
<td style="text-align: left;">è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼</td>
</tr>
<tr>
<td
style="text-align: left;"><code>HMSET &lt;key&gt; &lt;field1&gt; &lt;value1&gt; [field2 value2 ...]</code></td>
<td style="text-align: left;">åŒæ—¶å°†å¤šä¸ª <code>field-value</code>
å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨ä¸­</td>
</tr>
<tr>
<td
style="text-align: left;"><code>HMGET &lt;key&gt; &lt;field1&gt; [field2 ...]</code></td>
<td style="text-align: left;">è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼</td>
</tr>
<tr>
<td style="text-align: left;"><code>HGETALL &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šé”®çš„æ‰€æœ‰å­—æ®µå’Œå€¼</td>
</tr>
<tr>
<td style="text-align: left;"><code>HKEYS &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å­—æ®µ</td>
</tr>
<tr>
<td style="text-align: left;"><code>HVALS &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å€¼</td>
</tr>
<tr>
<td
style="text-align: left;"><code>HDEL &lt;key&gt; &lt;field1&gt; [field2 ...]</code></td>
<td style="text-align: left;">åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ</td>
</tr>
<tr>
<td
style="text-align: left;"><code>HEXISTS &lt;key&gt; &lt;field&gt;</code></td>
<td style="text-align: left;">æŸ¥çœ‹å“ˆå¸Œè¡¨çš„æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="åˆ—è¡¨-list"># åˆ—è¡¨ (List)</h2>
<p>åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><code>LPUSH &lt;key&gt; &lt;value1&gt; [value2 ...]</code></td>
<td style="text-align: left;">å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</td>
</tr>
<tr>
<td
style="text-align: left;"><code>RPUSH &lt;key&gt; &lt;value1&gt; [value2 ...]</code></td>
<td style="text-align: left;">å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å°¾éƒ¨</td>
</tr>
<tr>
<td style="text-align: left;"><code>LPOP &lt;key&gt;</code></td>
<td style="text-align: left;">ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td style="text-align: left;"><code>RPOP &lt;key&gt;</code></td>
<td style="text-align: left;">ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td style="text-align: left;"><code>LLEN &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–åˆ—è¡¨çš„é•¿åº¦</td>
</tr>
<tr>
<td
style="text-align: left;"><code>LRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt;</code></td>
<td style="text-align: left;">è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´  (-1
è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ )</td>
</tr>
<tr>
<td
style="text-align: left;"><code>LINDEX &lt;key&gt; &lt;index&gt;</code></td>
<td style="text-align: left;">é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </td>
</tr>
<tr>
<td
style="text-align: left;"><code>LSET &lt;key&gt; &lt;index&gt; &lt;value&gt;</code></td>
<td style="text-align: left;">é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼</td>
</tr>
<tr>
<td
style="text-align: left;"><code>LTRIM &lt;key&gt; &lt;start&gt; &lt;stop&gt;</code></td>
<td
style="text-align: left;">å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ </td>
</tr>
</tbody>
</table>
<hr />
<h2 id="é›†åˆ-set"># é›†åˆ (Set)</h2>
<p>é›†åˆæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„<strong>æ— åº</strong>é›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><code>SADD &lt;key&gt; &lt;member1&gt; [member2 ...]</code></td>
<td style="text-align: left;">å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td style="text-align: left;"><code>SMEMBERS &lt;key&gt;</code></td>
<td style="text-align: left;">è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SISMEMBER &lt;key&gt; &lt;member&gt;</code></td>
<td style="text-align: left;">åˆ¤æ–­ <code>member</code>
å…ƒç´ æ˜¯å¦æ˜¯é›†åˆçš„æˆå‘˜</td>
</tr>
<tr>
<td style="text-align: left;"><code>SCARD &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–é›†åˆçš„æˆå‘˜æ•°</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SREM &lt;key&gt; &lt;member1&gt; [member2 ...]</code></td>
<td style="text-align: left;">ç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td style="text-align: left;"><code>SPOP &lt;key&gt; [count]</code></td>
<td style="text-align: left;">éšæœºç§»é™¤å¹¶è¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SUNION &lt;key1&gt; [key2 ...]</code></td>
<td style="text-align: left;">è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SINTER &lt;key1&gt; [key2 ...]</code></td>
<td style="text-align: left;">è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„äº¤é›†</td>
</tr>
<tr>
<td
style="text-align: left;"><code>SDIFF &lt;key1&gt; [key2 ...]</code></td>
<td style="text-align: left;">è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å·®é›†</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="æœ‰åºé›†åˆ-sorted-set-zset"># æœ‰åºé›†åˆ (Sorted Set / ZSet)</h2>
<p>æœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ª
<code>double</code> ç±»å‹çš„<strong>åˆ†æ•° (score)</strong>ã€‚Redis
æ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å‘½ä»¤</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><code>ZADD &lt;key&gt; &lt;score1&gt; &lt;member1&gt; [score2 member2 ...]</code></td>
<td
style="text-align: left;">å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°</td>
</tr>
<tr>
<td
style="text-align: left;"><code>ZRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES]</code></td>
<td style="text-align: left;">é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆæˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜
(æŒ‰åˆ†æ•°å€¼é€’å¢)</td>
</tr>
<tr>
<td
style="text-align: left;"><code>ZREVRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES]</code></td>
<td style="text-align: left;">è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜
(æŒ‰åˆ†æ•°å€¼é€’å‡)</td>
</tr>
<tr>
<td
style="text-align: left;"><code>ZRANGEBYSCORE &lt;key&gt; &lt;min&gt; &lt;max&gt; [WITHSCORES]</code></td>
<td style="text-align: left;">é€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</td>
</tr>
<tr>
<td style="text-align: left;"><code>ZCARD &lt;key&gt;</code></td>
<td style="text-align: left;">è·å–æœ‰åºé›†åˆçš„æˆå‘˜æ•°</td>
</tr>
<tr>
<td
style="text-align: left;"><code>ZSCORE &lt;key&gt; &lt;member&gt;</code></td>
<td style="text-align: left;">è¿”å›æœ‰åºé›†ä¸­ï¼Œæˆå‘˜çš„ score å€¼</td>
</tr>
<tr>
<td
style="text-align: left;"><code>ZREM &lt;key&gt; &lt;member1&gt; [member2 ...]</code></td>
<td style="text-align: left;">ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td
style="text-align: left;"><code>ZCOUNT &lt;key&gt; &lt;min&gt; &lt;max&gt;</code></td>
<td style="text-align: left;">è®¡ç®—åœ¨æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´çš„æˆå‘˜æ•°</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="redis-å‘å±•å†ç¨‹ä¸architectureæ¼”è¿›">Redis
å‘å±•å†ç¨‹ä¸architectureæ¼”è¿›</h2>
<h2 id="ç‰ˆæœ¬å‘å±•"># ç‰ˆæœ¬å‘å±•</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">ç‰ˆæœ¬</th>
<th style="text-align: left;">å‘å¸ƒæ—¶é—´</th>
<th style="text-align: left;">ä¸»è¦ç‰¹æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Redis 1.0</td>
<td style="text-align: left;">2009å¹´</td>
<td style="text-align: left;">åŸºç¡€é”®å€¼å­˜å‚¨ï¼Œ5ç§åŸºæœ¬æ•°æ®ç»“æ„</td>
</tr>
<tr>
<td style="text-align: left;">Redis 2.0</td>
<td style="text-align: left;">2010å¹´</td>
<td style="text-align: left;">å¼•å…¥è™šæ‹Ÿå†…å­˜ã€å‘å¸ƒè®¢é˜…</td>
</tr>
<tr>
<td style="text-align: left;">Redis 2.2</td>
<td style="text-align: left;">2010å¹´</td>
<td style="text-align: left;">æŒä¹…åŒ–æ”¹è¿›ã€ä¸»ä»å¤åˆ¶</td>
</tr>
<tr>
<td style="text-align: left;">Redis 2.6</td>
<td style="text-align: left;">2012å¹´</td>
<td style="text-align: left;">Luaè„šæœ¬æ”¯æŒã€è¿‡æœŸé”®å¤„ç†ä¼˜åŒ–</td>
</tr>
<tr>
<td style="text-align: left;">Redis 2.8</td>
<td style="text-align: left;">2013å¹´</td>
<td style="text-align: left;">éƒ¨åˆ†é‡åŒæ­¥ã€Sentinelé«˜å¯ç”¨</td>
</tr>
<tr>
<td style="text-align: left;">Redis 3.0</td>
<td style="text-align: left;">2015å¹´</td>
<td style="text-align: left;"><strong>Redis
Clusteré›†ç¾¤æ”¯æŒ</strong></td>
</tr>
<tr>
<td style="text-align: left;">Redis 4.0</td>
<td style="text-align: left;">2017å¹´</td>
<td style="text-align: left;">æ¨¡å—ç³»ç»Ÿã€å†…å­˜ä¼˜åŒ–ã€æ··åˆæŒä¹…åŒ–</td>
</tr>
<tr>
<td style="text-align: left;">Redis 5.0</td>
<td style="text-align: left;">2018å¹´</td>
<td
style="text-align: left;"><strong>Streamæ•°æ®ç»“æ„</strong>ã€åŠ¨æ€HZ</td>
</tr>
<tr>
<td style="text-align: left;">Redis 6.0</td>
<td style="text-align: left;">2020å¹´</td>
<td style="text-align: left;">å¤šçº¿ç¨‹I/Oã€ACLæƒé™æ§åˆ¶ã€SSL</td>
</tr>
<tr>
<td style="text-align: left;">Redis 7.0</td>
<td style="text-align: left;">2022å¹´</td>
<td style="text-align: left;">Redis
Functionsã€å¤šACLç”¨æˆ·ã€Clusteråˆ†ç‰‡</td>
</tr>
</tbody>
</table>
<h2 id="architectureæ¼”è¿›è·¯å¾„"># architectureæ¼”è¿›è·¯å¾„</h2>
<h3 id="å•æœºæ¨¡å¼-single-instance"># 1. å•æœºæ¨¡å¼ (Single Instance)</h3>
<pre><code>

### 2. ä¸»ä»å¤åˆ¶ (Master-Slave)
</code></pre>
<h3 id="sentinel-é«˜å¯ç”¨-redis-sentinel"># 3. Sentinel é«˜å¯ç”¨ (Redis
Sentinel)</h3>
<pre><code>

### è„‘è£‚é—®é¢˜ (Split-Brain)

* *å®šä¹‰**: è„‘è£‚æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºç½‘ç»œåˆ†åŒºæˆ–èŠ‚ç‚¹æ•…éšœï¼Œå¯¼è‡´ç³»ç»Ÿä¸­å‡ºç°å¤šä¸ª&quot;å¤§è„‘&quot;ï¼ˆå¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºè‡ªå·±æ˜¯ä¸»èŠ‚ç‚¹ï¼‰çš„æƒ…å†µã€‚

* *Redisä¸­çš„è„‘è£‚åœºæ™¯**:
</code></pre>
<p>PartitionB: Sentinel2,3 â†â†’ Slave1 â†â†’ Slave2 (ElectNew master)</p>
<pre><code>

* *Redisè„‘è£‚é¢„é˜²æœºåˆ¶**:

1. **Sentinelå¥‡æ•°éƒ¨ç½²**: ç¡®ä¿æ•…éšœè½¬ç§»æ—¶æœ‰æ˜ç¡®çš„å¤šæ•°æ´¾

```bash
# Recommended configurationï¼šAt least3Sentinel
Sentinel1, Sentinel2, Sentinel3
</code></pre>
<h1 id="at-leastneed2slave-nodemaximum-delay10second">At leastNeed2Slave
Nodeï¼Œmaximum delay10Second</h1>
<p>min-slaves-to-write 2 min-slaves-max-lag 10</p>
<pre><code>
sentinel = Sentinel([(&#39;localhost&#39;, 26379), (&#39;localhost&#39;, 26380), (&#39;localhost&#39;, 26381)])
master = sentinel.master_for(&#39;mymaster&#39;, socket_timeout=0.1)
</code></pre>
<h3 id="é›†ç¾¤æ¨¡å¼-redis-cluster"># 4. é›†ç¾¤æ¨¡å¼ (Redis Cluster)</h3>
<pre><code>___
## Redis é›†ç¾¤è¯¦è§£

## # Sentinel æ¨¡å¼

### æ ¸å¿ƒåŠŸèƒ½
1. **ç›‘æ§ (Monitoring)**: ç›‘æ§masterå’Œslaveå¥åº·çŠ¶æ€
2. **é€šçŸ¥ (Notification)**: æ•…éšœæ—¶é€šçŸ¥ç®¡ç†å‘˜
3. **è‡ªåŠ¨æ•…éšœè½¬ç§» (Automatic Failover)**: è‡ªåŠ¨é€‰ä¸¾æ–°master
4. **é…ç½®æä¾› (Configuration Provider)**: ä¸ºå®¢æˆ·ç«¯æä¾›å½“å‰masteråœ°å€


### å·¥ä½œåŸç†

```bash
# SentinelConfigFile
sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 30000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 180000
</code></pre>
<ol start="4" type="1">
<li><strong>æ–°ä¸»é€‰æ‹©</strong>: é€‰æ‹©æœ€ä¼˜slaveæå‡ä¸ºmaster</li>
<li><strong>é…ç½®æ›´æ–°</strong>: æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹é…ç½®</li>
</ol>
<h2 id="cluster-é›†ç¾¤æ¨¡å¼"># Cluster é›†ç¾¤æ¨¡å¼</h2>
<h3 id="é›†ç¾¤ç‰¹æ€§"># é›†ç¾¤ç‰¹æ€§</h3>
<ul>
<li><p><strong>å»ä¸­å¿ƒåŒ–</strong>: æ— å•ç‚¹æ•…éšœ</p></li>
<li><p><strong>æ•°æ®åˆ†ç‰‡</strong>: è‡ªåŠ¨æ•°æ®åˆ†å¸ƒ</p></li>
<li><p><strong>é«˜å¯ç”¨</strong>: masteræ•…éšœè‡ªåŠ¨åˆ‡æ¢</p></li>
<li><p><strong>åœ¨çº¿æ‰©ç¼©å®¹</strong>: æ”¯æŒåŠ¨æ€æ·»åŠ /åˆ é™¤èŠ‚ç‚¹</p></li>
</ul>
<h3 id="æ•°æ®åˆ†ç‰‡ç®—æ³•"># æ•°æ®åˆ†ç‰‡ç®—æ³•</h3>
<div class="sourceCode" id="cb465"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CalculateKeyå“ˆå¸ŒSlot</span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="ex">HASH_SLOT</span> = CRC16<span class="er">(</span><span class="ex">key</span><span class="kw">)</span> <span class="ex">%</span> 16384</span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a><span class="co"># SlotAllocationExampleï¼ˆ3Master Nodeï¼‰</span></span>
<span id="cb465-5"><a href="#cb465-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Master1:</span> 0-5461 <span class="er">(</span><span class="ex">5462Slot</span><span class="kw">)</span></span>
<span id="cb465-6"><a href="#cb465-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Master2:</span> 5462-10923 <span class="er">(</span><span class="ex">5462Slot</span><span class="kw">)</span> </span>
<span id="cb465-7"><a href="#cb465-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Master3:</span> 10924-16383 <span class="er">(</span><span class="ex">5460Slot</span><span class="kw">)</span></span></code></pre></div>
<ol start="127" type="1">
<li>0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005<br />
</li>
</ol>
<ul>
<li>-cluster-replicas 1</li>
</ul>
<h1 id="viewclusterinformation">ViewClusterInformation</h1>
<p>CLUSTER INFO CLUSTER NODES</p>
<h1 id="re-sharding">Re-Sharding</h1>
<p>redis-cli â€“cluster reshard 127.0.0.1:7000</p>
<h1 id="addnode">AddNode</h1>
<p>redis-cli â€“cluster add-node 127.0.0.1:7006 127.0.0.1:7000</p>
<pre><code>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ¦‚ç‡æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **è¯¯æŠ¥ç‡**: å¯èƒ½è¯¯åˆ¤å­˜åœ¨ï¼Œä½†ä¸ä¼šè¯¯åˆ¤ä¸å­˜åœ¨


- **ç©ºé—´æ•ˆç‡**: ä½¿ç”¨ä½æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦ä½


- **æ—¶é—´å¤æ‚åº¦**: O(k) æŸ¥è¯¢æ—¶é—´ï¼Œkä¸ºå“ˆå¸Œå‡½æ•°æ•°é‡


### å®ç°åŸç†

```python
# åŸºæœ¬æµç¨‹
1. Initialize: Createmä½ä½Arrayï¼Œkå“ˆå¸ŒFunction
2. æ·»åŠ å…ƒç´ : å¯¹å…ƒç´ è®¡ç®— k ä¸ªå“ˆå¸Œå€¼ï¼Œè®¾ç½®å¯¹åº”ä½ä¸º1
3. Queryå…ƒç´ : Calculatekå“ˆå¸ŒValueï¼ŒCheckå¯¹åº”ä½isNoéƒ½ä¸º1
</code></pre>
<h1 id="æœ€ä¼˜ä½æ•°ç»„å¤§å°">æœ€ä¼˜ä½æ•°ç»„å¤§å°</h1>
<p>m = -n * ln(p) / (ln(2))^2</p>
<h1 id="æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡">æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡</h1>
<p>k = (m/n) * ln(2)</p>
<h1
id="å…¶ä¸­nå…ƒç´ æ•°é‡pè¯¯æŠ¥ç‡mä½æ•°ç»„å¤§å°kå“ˆå¸Œå‡½æ•°æ•°é‡">å…¶ä¸­ï¼šn=å…ƒç´ æ•°é‡ï¼Œp=è¯¯æŠ¥ç‡ï¼Œm=ä½æ•°ç»„å¤§å°ï¼Œk=å“ˆå¸Œå‡½æ•°æ•°é‡</h1>
<pre><code>
```bash
# åŠ è½½ RedisBloom æ¨¡å—
MODULE LOAD /path/to/redisbloom.so
</code></pre>
<h1 id="æ·»åŠ å…ƒç´ ">æ·»åŠ å…ƒç´ </h1>
<p>BF.ADD myfilter â€œuser123â€ BF.MADD myfilter â€œuser1â€ â€œuser2â€
â€œuser3â€</p>
<h1 id="æ£€æŸ¥å…ƒç´ ">æ£€æŸ¥å…ƒç´ </h1>
<p>BF.EXISTS myfilter â€œuser123â€ BF.MEXISTS myfilter â€œuser1â€ â€œuser2â€</p>
<h1 id="getinformation">GetInformation</h1>
<p>BF.INFO myfilter</p>
<pre><code>4. **æ¨èç³»ç»Ÿ**: å·²æ¨èå†…å®¹è¿‡æ»¤
___
## Stream æµæ•°æ®ç»“æ„

## # åŸºæœ¬æ¦‚å¿µ

Streamæ˜¯Redis 5.0å¼•å…¥çš„æ–°æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶æµå¤„ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **æŒä¹…åŒ–æ¶ˆæ¯é˜Ÿåˆ—**: æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨


- **æ¶ˆè´¹è€…ç»„**: æ”¯æŒå¤šæ¶ˆè´¹è€…åä½œ


- **æ¶ˆæ¯ç¡®è®¤**: æ”¯æŒæ¶ˆæ¯ç¡®è®¤æœºåˆ¶


- **å†å²æ¶ˆæ¯**: å¯ä»¥æŸ¥è¯¢å†å²æ¶ˆæ¯


### æ¶ˆæ¯IDç»“æ„
</code></pre>
<h1 id="æ·»åŠ æ¶ˆæ¯">æ·»åŠ æ¶ˆæ¯</h1>
<p>XADD mystream * field1 value1 field2 value2 XADD mystream
1609459200000-0 user â€œjohnâ€ action â€œloginâ€</p>
<h1 id="è¯»å–æ¶ˆæ¯">è¯»å–æ¶ˆæ¯</h1>
<p>XREAD COUNT 2 STREAMS mystream 0 XREAD BLOCK 1000 STREAMS mystream $
# é˜»å¡è¯»å–æ–°æ¶ˆæ¯</p>
<h1 id="viewstreaminformation">ViewStreamInformation</h1>
<p>XINFO STREAM mystream XLEN mystream</p>
<h1 id="èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢</h1>
<p>XRANGE mystream - + XRANGE mystream 1609459200000 1609459300000</p>
<pre><code>
# æ¶ˆè´¹è€…è¯»å–
XREADGROUP GROUP mygroup consumer1 COUNT 1 STREAMS mystream &gt;

# ç¡®è®¤æ¶ˆæ¯
XACK mystream mygroup 1609459200000-0

# æŸ¥çœ‹æ¶ˆè´¹è€…ç»„ä¿¡æ¯
XINFO GROUPS mystream
XINFO CONSUMERS mystream mygroup

# å¤„ç† pending æ¶ˆæ¯
XPENDING mystream mygroup
XCLAIM mystream mygroup consumer2 1800000 1609459200000-0
</code></pre>
<h1 id="ä¿®å‰ª-stream">ä¿®å‰ª Stream</h1>
<p>XTRIM mystream MAXLEN 1000 XTRIM mystream MAXLEN ~ 1000 #
è¿‘ä¼¼ä¿®å‰ªï¼ŒPerformanceæ›´å¥½</p>
<pre><code>| å¤šæ¶ˆè´¹è€… | âŒ | âœ… | âœ… |
| æ¶ˆæ¯ç¡®è®¤ | âŒ | âŒ | âœ… |
| å†å²æ¶ˆæ¯ | âœ… | âŒ | âœ… |
| æ¶ˆè´¹è€…ç»„ | âŒ | âŒ | âœ… |
___
## é¢è¯•é«˜é¢‘è€ƒç‚¹

## # æŒä¹…åŒ–æœºåˆ¶

### RDB (Redis Database)

```bash
# ConfigFileSet
save 900 1 # 900seconds with at least1keyå˜åŒ–
save 300 10 # 300seconds with at least10keyå˜åŒ– 
save 60 10000 # 60seconds with at least10000keyå˜åŒ–

# æ‰‹åŠ¨è§¦å‘
SAVE # SynchronizationSaveï¼ˆé˜»å¡ï¼‰
BGSAVE # AsyncSaveï¼ˆAfterå°ï¼‰
</code></pre>
<h3 id="aof-append-only-file"># AOF (Append Only File)</h3>
<div class="sourceCode" id="cb471"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ConfigOption</span></span>
<span id="cb471-2"><a href="#cb471-2" aria-hidden="true" tabindex="-1"></a><span class="ex">appendonly</span> yes</span>
<span id="cb471-3"><a href="#cb471-3" aria-hidden="true" tabindex="-1"></a><span class="ex">appendfsync</span> always <span class="co"># æ¯æ¬¡å†™å…¥ç«‹å³åŒæ­¥</span></span>
<span id="cb471-4"><a href="#cb471-4" aria-hidden="true" tabindex="-1"></a><span class="ex">appendfsync</span> everysec <span class="co"># æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæ¨èï¼‰</span></span>
<span id="cb471-5"><a href="#cb471-5" aria-hidden="true" tabindex="-1"></a><span class="ex">appendfsync</span> no <span class="co"># ç”±OSå†³å®šSynchronizationWhenæœº</span></span></code></pre></div>
<h3 id="æ··åˆæŒä¹…åŒ–-redis-4.0"># æ··åˆæŒä¹…åŒ– (Redis 4.0+)</h3>
<div class="sourceCode" id="cb472"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="ex">aof-use-rdb-preamble</span> yes</span></code></pre></div>
<div class="sourceCode" id="cb473"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># é…ç½®æœ€å¤§å†…å­˜</span></span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a><span class="ex">maxmemory</span> 2gb</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æ·˜æ±°ç­–ç•¥</span></span>
<span id="cb473-5"><a href="#cb473-5" aria-hidden="true" tabindex="-1"></a><span class="ex">maxmemory-policy</span> allkeys-lru</span></code></pre></div>
<div class="line-block"><code>allkeys-lfu</code> |
æ‰€æœ‰keyä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡çš„ |<br />
<code>volatile-lru</code> | æœ‰è¿‡æœŸæ—¶é—´çš„keyä¸­æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„ |<br />
<code>volatile-lfu</code> | æœ‰è¿‡æœŸæ—¶é—´çš„keyä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡çš„ |<br />
<code>volatile-random</code> | æœ‰è¿‡æœŸæ—¶é—´çš„keyä¸­éšæœºæ·˜æ±° |<br />
<code>volatile-ttl</code> | æ·˜æ±°å³å°†è¿‡æœŸçš„key |</div>
<h2 id="ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ"># ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="ç¼“å­˜ç©¿é€"># 1. ç¼“å­˜ç©¿é€</h3>
<ul>
<li><p>*é—®é¢˜**: æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç»•è¿‡ç¼“å­˜ç›´æ¥æŸ¥æ•°æ®åº“</p></li>
<li><p>*è§£å†³æ–¹æ¡ˆ**:</p></li>
<li><p>å¸ƒéš†è¿‡æ»¤å™¨é¢„è¿‡æ»¤</p></li>
<li><p>ç©ºå€¼ç¼“å­˜ï¼ˆè®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´ï¼‰</p></li>
<li><p>å‚æ•°æ ¡éªŒ</p></li>
</ul>
<h3 id="ç¼“å­˜é›ªå´©"># 2. ç¼“å­˜é›ªå´©</h3>
<ul>
<li><p>*é—®é¢˜**: å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œæ•°æ®åº“å‹åŠ›æ¿€å¢</p></li>
<li><p>*è§£å†³æ–¹æ¡ˆ**:</p></li>
<li><p>éšæœºè¿‡æœŸæ—¶é—´</p></li>
<li><p>ç¼“å­˜é¢„çƒ­</p></li>
<li><p>å¤šçº§ç¼“å­˜</p></li>
<li><p>é™æµé™çº§</p></li>
</ul>
<h3 id="ç¼“å­˜å‡»ç©¿"># 3. ç¼“å­˜å‡»ç©¿</h3>
<ul>
<li><p>*é—®é¢˜**: çƒ­ç‚¹æ•°æ®è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚ç›´è¾¾æ•°æ®åº“</p></li>
<li><p>*è§£å†³æ–¹æ¡ˆ**:</p></li>
<li><p>äº’æ–¥é”é‡å»ºç¼“å­˜</p></li>
<li><p>å¼‚æ­¥æ›´æ–°ç¼“å­˜</p></li>
<li><p>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</p></li>
</ul>
<h2 id="åˆ†å¸ƒå¼é”å®ç°"># åˆ†å¸ƒå¼é”å®ç°</h2>
<h3 id="åŸºäºsetnxçš„ç®€å•é”"># åŸºäºSETNXçš„ç®€å•é”</h3>
<div class="sourceCode" id="cb474"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># åŠ é”</span></span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a><span class="ex">SET</span> lock_key unique_value PX 30000 NX</span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-4"><a href="#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="co"># é‡Šæ”¾é”ï¼ˆLuaScriptä¿è¯åŸå­æ€§ï¼‰</span></span>
<span id="cb474-5"><a href="#cb474-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">redis.call</span><span class="er">(</span><span class="st">&quot;get&quot;</span><span class="ex">,</span> KEYS<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span><span class="kw">)</span> <span class="ex">==</span> ARGV<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span> then</span>
<span id="cb474-6"><a href="#cb474-6" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="ex">redis.call</span><span class="er">(</span><span class="st">&quot;del&quot;</span><span class="ex">,</span> KEYS<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span><span class="kw">)</span></span>
<span id="cb474-7"><a href="#cb474-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb474-8"><a href="#cb474-8" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb474-9"><a href="#cb474-9" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span></code></pre></div>
<ol start="2" type="1">
<li>è¶…è¿‡ N/2+1 ä¸ªå®ä¾‹åŠ é”æˆåŠŸæ‰ç®—æˆåŠŸ</li>
<li>åŠ é”æ€»æ—¶é—´è¦å°äºé”è¿‡æœŸæ—¶é—´</li>
<li>é‡Šæ”¾æ‰€æœ‰å®ä¾‹ä¸Šçš„é”</li>
</ol>
<pre><code>- å°æ•°æ®é‡ä½¿ç”¨ziplistç¼–ç ï¼ˆèŠ‚çœå†…å­˜ï¼‰

- å¤§æ•°æ®é‡ä½¿ç”¨hashtableç¼–ç ï¼ˆæé«˜æ€§èƒ½ï¼‰

### 2. æ‰¹é‡æ“ä½œ

```bash
# ä½¿ç”¨ pipeline å‡å°‘ç½‘ç»œå¾€è¿”
PIPELINE
SET key1 value1
SET key2 value2
EXEC

# UseMGET/MSETBatchOperation
MSET key1 value1 key2 value2
MGET key1 key2
</code></pre>
<h1 id="configoptimize">ConfigOptimize</h1>
<p>hash-max-ziplist-entries 512 hash-max-ziplist-value 64
list-max-ziplist-size -2 set-max-intset-entries 512</p>
<pre><code>___
## æ•°æ®åº“æŠ€æœ¯é€‰å‹å¯¹æ¯”

## # å…³ç³»å‹æ•°æ®åº“ (RDBMS)

### MySQL
* *ç‰¹ç‚¹**: å¼€æºã€æˆç†Ÿã€ç¤¾åŒºæ´»è·ƒ

| æ–¹é¢ | æè¿° |
|:---|:---|
| **å­˜å‚¨å¼•æ“** | InnoDB(äº‹åŠ¡)ã€MyISAM(æ€§èƒ½) |
| **äº‹åŠ¡æ”¯æŒ** | å®Œæ•´ACIDæ”¯æŒ |
| **å¤åˆ¶** | ä¸»ä»å¤åˆ¶ã€ä¸»ä¸»å¤åˆ¶ |
| **åˆ†ç‰‡** | åº”ç”¨å±‚åˆ†ç‰‡ |
| **é€‚ç”¨åœºæ™¯** | Webåº”ç”¨ã€ç”µå•†ç³»ç»Ÿã€é‡‘èç³»ç»Ÿ |

```sql
- - IndexOptimize
CREATE INDEX idx_user_email ON users(email);
EXPLAIN SELECT * FROM users WHERE email = &#39;test@example.com&#39;;

- - PartitionTable
CREATE TABLE orders (
id INT,
order_date DATE,
amount DECIMAL(10,2)
) PARTITION BY RANGE (YEAR(order_date)) (
PARTITION p2022 VALUES LESS THAN (2023),
PARTITION p2023 VALUES LESS THAN (2024)
);
</code></pre>
<div class="line-block"><strong>æ•°æ®ç±»å‹</strong> |
ä¸°å¯Œçš„å†…ç½®ç±»å‹(JSONã€æ•°ç»„ã€åœ°ç†) |<br />
<strong>ç´¢å¼•ç±»å‹</strong> | B-treeã€Hashã€GiSTã€SP-GiSTã€GINã€BRIN
|<br />
<strong>å¹¶å‘æ§åˆ¶</strong> | MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ |<br />
<strong>æ‰©å±•æ€§</strong> | ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ |<br />
<strong>é€‚ç”¨åœºæ™¯</strong> | å¤æ‚æŸ¥è¯¢ã€æ•°æ®åˆ†æã€åœ°ç†ä¿¡æ¯ç³»ç»Ÿ |</div>
<div class="sourceCode" id="cb477"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> JSONOperation</span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">data</span><span class="op">-&gt;&gt;</span><span class="st">&#39;name&#39;</span> <span class="kw">FROM</span> users <span class="kw">WHERE</span> <span class="kw">data</span> @<span class="op">&gt;</span> <span class="st">&#39;{&quot;age&quot;: 25}&#39;</span>;</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> ArrayClassType</span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> posts (</span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true" tabindex="-1"></a><span class="kw">id</span> SERIAL,</span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true" tabindex="-1"></a>tags TEXT[]</span>
<span id="cb477-8"><a href="#cb477-8" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb477-9"><a href="#cb477-9" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts (tags) <span class="kw">VALUES</span> (<span class="dt">ARRAY</span>[<span class="st">&#39;postgres&#39;</span>, <span class="st">&#39;database&#39;</span>]);</span>
<span id="cb477-10"><a href="#cb477-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-11"><a href="#cb477-11" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> çª—å£Function</span>
<span id="cb477-12"><a href="#cb477-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> name, salary, </span>
<span id="cb477-13"><a href="#cb477-13" aria-hidden="true" tabindex="-1"></a><span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> salary <span class="kw">DESC</span>) <span class="kw">as</span> <span class="fu">rank</span></span>
<span id="cb477-14"><a href="#cb477-14" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> employees;</span></code></pre></div>
<p>|:â€”|:â€”| | <strong>æ•°æ®æ¨¡å‹</strong> | BSONæ–‡æ¡£ | |
<strong>æŸ¥è¯¢è¯­è¨€</strong> | MongoDB Query Language | |
<strong>åˆ†ç‰‡</strong> | è‡ªåŠ¨åˆ†ç‰‡(Auto-Sharding) | |
<strong>å¤åˆ¶</strong> | å‰¯æœ¬é›†(Replica Set) | |
<strong>é€‚ç”¨åœºæ™¯</strong> | å†…å®¹ç®¡ç†ã€å®æ—¶åˆ†æã€ç‰©è”ç½‘ |</p>
<div class="sourceCode" id="cb478"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co">// DocumentationOperation</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb478-3"><a href="#cb478-3" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;John&quot;</span><span class="op">,</span></span>
<span id="cb478-4"><a href="#cb478-4" aria-hidden="true" tabindex="-1"></a><span class="dt">age</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb478-5"><a href="#cb478-5" aria-hidden="true" tabindex="-1"></a><span class="dt">address</span><span class="op">:</span> {</span>
<span id="cb478-6"><a href="#cb478-6" aria-hidden="true" tabindex="-1"></a><span class="dt">city</span><span class="op">:</span> <span class="st">&quot;New York&quot;</span><span class="op">,</span></span>
<span id="cb478-7"><a href="#cb478-7" aria-hidden="true" tabindex="-1"></a><span class="dt">state</span><span class="op">:</span> <span class="st">&quot;NY&quot;</span></span>
<span id="cb478-8"><a href="#cb478-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb478-9"><a href="#cb478-9" aria-hidden="true" tabindex="-1"></a><span class="dt">hobbies</span><span class="op">:</span> [<span class="st">&quot;reading&quot;</span><span class="op">,</span> <span class="st">&quot;swimming&quot;</span>]</span>
<span id="cb478-10"><a href="#cb478-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb478-11"><a href="#cb478-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-12"><a href="#cb478-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Aggregateç®¡é“</span></span>
<span id="cb478-13"><a href="#cb478-13" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">orders</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb478-14"><a href="#cb478-14" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> { <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;completed&quot;</span> } }<span class="op">,</span></span>
<span id="cb478-15"><a href="#cb478-15" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$group</span><span class="op">:</span> { <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$customer_id&quot;</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> } } }<span class="op">,</span></span>
<span id="cb478-16"><a href="#cb478-16" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">total</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }</span>
<span id="cb478-17"><a href="#cb478-17" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb478-18"><a href="#cb478-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-19"><a href="#cb478-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Index</span></span>
<span id="cb478-20"><a href="#cb478-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">createIndex</span>({ <span class="dt">email</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span> { <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb478-21"><a href="#cb478-21" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">posts</span><span class="op">.</span><span class="fu">createIndex</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;text&quot;</span><span class="op">,</span> <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;text&quot;</span> })<span class="op">;</span> <span class="co">// å…¨æ–‡Index</span></span></code></pre></div>
<div class="line-block"><strong>æ•°æ®æ¨¡å‹</strong> | å®½åˆ—å­˜å‚¨ |<br />
<strong>ä¸€è‡´æ€§</strong> | å¯è°ƒä¸€è‡´æ€§ |<br />
<strong>åˆ†åŒº</strong> | ä¸€è‡´æ€§å“ˆå¸Œ |<br />
<strong>å®¹é”™</strong> | æ— å•ç‚¹æ•…éšœ |<br />
<strong>é€‚ç”¨åœºæ™¯</strong> | æ—¶åºæ•°æ®ã€æ—¥å¿—ç³»ç»Ÿã€æ¨èç³»ç»Ÿ |</div>
<div class="sourceCode" id="cb479"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> Tableè®¾è®¡ï¼ˆByQueryè®¾è®¡ï¼‰</span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> user_posts (</span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a>user_id UUID,</span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a>post_time <span class="dt">TIMESTAMP</span>,</span>
<span id="cb479-5"><a href="#cb479-5" aria-hidden="true" tabindex="-1"></a>post_id UUID,</span>
<span id="cb479-6"><a href="#cb479-6" aria-hidden="true" tabindex="-1"></a>content TEXT,</span>
<span id="cb479-7"><a href="#cb479-7" aria-hidden="true" tabindex="-1"></a><span class="kw">PRIMARY</span> <span class="kw">KEY</span> (user_id, post_time, post_id)</span>
<span id="cb479-8"><a href="#cb479-8" aria-hidden="true" tabindex="-1"></a>) <span class="kw">WITH</span> CLUSTERING <span class="kw">ORDER</span> <span class="kw">BY</span> (post_time <span class="kw">DESC</span>);</span>
<span id="cb479-9"><a href="#cb479-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-10"><a href="#cb479-10" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> <span class="kw">Query</span></span>
<span id="cb479-11"><a href="#cb479-11" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> user_posts </span>
<span id="cb479-12"><a href="#cb479-12" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> user_id <span class="op">=</span> <span class="fl">123e4567</span><span class="op">-</span>e89b<span class="op">-</span><span class="dv">12</span>d3<span class="op">-</span>a456<span class="op">-</span><span class="dv">426614174000</span></span>
<span id="cb479-13"><a href="#cb479-13" aria-hidden="true" tabindex="-1"></a><span class="kw">AND</span> post_time <span class="op">&gt;=</span> <span class="st">&#39;2023-01-01&#39;</span>;</span></code></pre></div>
<div class="line-block"><strong>PostgreSQL</strong> | å…³ç³»å‹ | å¼ºä¸€è‡´ |
å‚ç›´æ‰©å±• | âœ… å¾ˆå¼º | ä¸­ | å¤æ‚ä¸šåŠ¡ã€åˆ†æ |<br />
<strong>Redis</strong> | é”®å€¼ | æœ€ç»ˆä¸€è‡´ | æ°´å¹³æ‰©å±• | âŒ å¼± | ä½ |
ç¼“å­˜ã€ä¼šè¯ |<br />
<strong>MongoDB</strong> | æ–‡æ¡£ | å¼ºä¸€è‡´ | æ°´å¹³æ‰©å±• | âœ… ä¸­ç­‰ | ä¸­ |
å†…å®¹ç®¡ç†ã€å¿«é€Ÿå¼€å‘ |<br />
<strong>Cassandra</strong> | åˆ—æ— | å¯è°ƒä¸€è‡´ | çº¿æ€§æ‰©å±• | âŒ å¼± | é«˜ |
å¤§æ•°æ®ã€é«˜å¹¶å‘å†™å…¥ |<br />
<strong>HBase</strong> | åˆ—æ— | å¼ºä¸€è‡´ | æ°´å¹³æ‰©å±• | âŒ å¼± | é«˜ |
å¤§æ•°æ®å­˜å‚¨ã€å®æ—¶è¯»å†™ |</div>
<h2 id="capç†è®ºä¸é€‰æ‹©"># CAPç†è®ºä¸é€‰æ‹©</h2>
<h3 id="capç†è®º"># CAPç†è®º</h3>
<ul>
<li><p><strong>C (Consistency)</strong>: ä¸€è‡´æ€§</p></li>
<li><p><strong>A (Availability)</strong>: å¯ç”¨æ€§</p></li>
<li><p><strong>P (Partition tolerance)</strong>: åˆ†åŒºå®¹é”™æ€§</p></li>
</ul>
<h3 id="æ•°æ®åº“åœ¨capä¸­çš„å®šä½"># æ•°æ®åº“åœ¨CAPä¸­çš„å®šä½</h3>
<pre><code>
APç³»ç»Ÿ (é«˜å¯ç”¨æ€§)
â”œâ”€â”€ Cassandra
â”œâ”€â”€ DynamoDB
â””â”€â”€ CouchDB

CAç³»ç»Ÿ (NetworkPartitionå°‘è§)
â”œâ”€â”€ ä¼ ç»ŸRDBMS (å•æœº)
â””â”€â”€ Redis (å•æœºæ¨¡å¼)
</code></pre>
<p>â”‚ â”‚ â”œâ”€â”€ is â†’ PostgreSQL â”‚ â”‚ â””â”€â”€ No â†’ MySQL â”‚ â””â”€â”€ ç®€å•é”®å€¼è®¿é—®ï¼Ÿ â†’
Redis â”œâ”€â”€ ä¸­å‹ (1TB - 10TB) â”‚ â”œâ”€â”€ ç»“æ„åŒ–æ•°æ®ï¼Ÿ â”‚ â”‚ â”œâ”€â”€ å…³ç³»å‹éœ€æ±‚ â†’
MySQL/PostgreSQL + åˆ†åº“åˆ†è¡¨ â”‚ â”‚ â””â”€â”€ æ–‡æ¡£ç±»å‹éœ€æ±‚ â†’ MongoDB â”‚ â””â”€â”€
ç¼“å­˜éœ€æ±‚ï¼Ÿ â†’ Redis Cluster â””â”€â”€ å¤§å‹ (&gt; 10TB) â”œâ”€â”€ å®æ—¶è¯»å†™ â†’ HBase â”œâ”€â”€
é«˜å¹¶å‘å†™ â†’ Cassandra â””â”€â”€ å¤æ‚åˆ†æ â†’ Hadoopç”Ÿæ€ + Hive</p>
<pre><code>â†“
MySQL (TransactionLayer)
â†“
MongoDB (DocumentationStorage)
â†“
HBase (å¤§Data storage)
</code></pre>
<p>def <strong>init</strong>(self): self.redis = Redis() self.mysql =
MySQL() self.mongodb = MongoDB()</p>
<p>def get_user_profile(self, user_id): # 1. å…ˆæŸ¥RedisCache cached =
self.redis.get(fâ€user:{user_id}â€œ) if cached: return
json.loads(cached)</p>
<h1 id="æŸ¥mysqlgetbasic-information">2. æŸ¥MySQLGetBasic information</h1>
<p>user_basic = self.mysql.query( â€œSELECT * FROM users WHERE id = %sâ€,
user_id )</p>
<h1 id="æŸ¥mongodbgetextensioninformation">3.
æŸ¥MongoDBGetExtensionInformation</h1>
<p>user_extended = self.mongodb.find_one( {â€œuser_idâ€: user_id},
collection=â€œuser_profilesâ€ )</p>
<h1 id="åˆå¹¶æ•°æ®å¹¶ç¼“å­˜">4. åˆå¹¶æ•°æ®å¹¶ç¼“å­˜</h1>
<p>user_data = {<strong>user_basic, </strong>user_extended}
self.redis.setex(fâ€user:{user_id}â€œ, 3600, json.dumps(user_data))</p>
<p>return user_data</p>
<ul>
<li><p><strong>MySQL</strong>: 10K+ (SSD + ç´¢å¼•)</p></li>
<li><p><strong>MongoDB</strong>: 20K+ (å†…å­˜ + ç´¢å¼•)</p></li>
<li><p><strong>PostgreSQL</strong>: 15K+ (ä¼˜åŒ–å)</p></li>
<li><p><strong>Cassandra</strong>: 50K+ (åˆ†å¸ƒå¼)</p></li>
</ul>
<h3 id="å†™æ€§èƒ½-tps"># å†™æ€§èƒ½ (TPS)</h3>
<ul>
<li><p><strong>Redis</strong>: 80K+ (å†…å­˜)</p></li>
<li><p><strong>MySQL</strong>: 5K+ (InnoDB)</p></li>
<li><p><strong>MongoDB</strong>: 15K+ (å¼‚æ­¥å†™å…¥)</p></li>
<li><p><strong>Cassandra</strong>: 100K+ (LSMæ ‘)</p></li>
<li><p><strong>HBase</strong>: 50K+ (WAL + MemStore)</p></li>
</ul>
<h3 id="å­˜å‚¨æˆæœ¬"># å­˜å‚¨æˆæœ¬</h3>
<ul>
<li><p><strong>å†…å­˜æ•°æ®åº“</strong>: $100/GB/æœˆ (Redis)</p></li>
<li><p><strong>SSDå­˜å‚¨</strong>: $1/GB/æœˆ (MySQL/PostgreSQL)</p></li>
<li><p><strong>HDDå­˜å‚¨</strong>: $0.1/GB/æœˆ (MongoDB/Cassandra) ___ ##
æ€»ç»“ä¸å»ºè®®</p></li>
</ul>
<h2 id="é€‰å‹åŸåˆ™"># é€‰å‹åŸåˆ™</h2>
<ol type="1">
<li><strong>ä¸šåŠ¡éœ€æ±‚ä¼˜å…ˆ</strong>: æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©</li>
<li><strong>å›¢é˜Ÿèƒ½åŠ›</strong>: è€ƒè™‘å›¢é˜Ÿçš„æŠ€æœ¯æ ˆå’Œç»´æŠ¤èƒ½åŠ›</li>
<li><strong>æˆæœ¬æ§åˆ¶</strong>: ç»¼åˆè€ƒè™‘å¼€å‘ã€è¿ç»´ã€ç¡¬ä»¶æˆæœ¬</li>
<li><strong>æœªæ¥æ‰©å±•</strong>: é¢„ç•™æŠ€æœ¯æ¼”è¿›ç©ºé—´</li>
</ol>
<h2 id="æœ€ä½³å®è·µ"># æœ€ä½³å®è·µ</h2>
<ul>
<li><p><strong>è¯»å¤šå†™å°‘</strong>: MySQL/PostgreSQL + Redis</p></li>
<li><p><strong>å†™å¤šè¯»å°‘</strong>: Cassandra/MongoDB + Redis</p></li>
<li><p><strong>å¤æ‚æŸ¥è¯¢</strong>: PostgreSQL + æ•°æ®ä»“åº“</p></li>
<li><p><strong>å®æ—¶åˆ†æ</strong>: HBase + Spark/Flink</p></li>
<li><p><strong>æ··åˆè´Ÿè½½</strong>: å¤šæ•°æ®åº“æ¶æ„ + æ•°æ®åŒæ­¥</p></li>
</ul>
<pre><code>


&lt;!-- 04-Reference/Engineering/risk_control_sdk_build_guide.md --&gt;

# Risk Control SDK ç¼–è¯‘æŒ‡å—

Risk Control SDK æ˜¯ä¸€ä¸ªç”¨äºç§»åŠ¨åº”ç”¨çš„è®¾å¤‡æŒ‡çº¹è¯†åˆ«å’Œå®‰å…¨è¯„ä¼°ç³»ç»Ÿï¼ŒåŸºäº JNI æ¶æ„å®ç°ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†è¯´æ˜å¦‚ä½•ç¼–è¯‘å’Œæ„å»ºè¯¥ SDKã€‚
___
## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
3. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„) 
4. [ç¼–è¯‘æ­¥éª¤](#ç¼–è¯‘æ­¥éª¤)
5. [æ„å»ºé€‰é¡¹](#æ„å»ºé€‰é¡¹)
6. [å¤šå¹³å°ç¼–è¯‘](#å¤šå¹³å°ç¼–è¯‘)
7. [é—®é¢˜æ’æŸ¥](#é—®é¢˜æ’æŸ¥)
___
## é¡¹ç›®æ¦‚è¿°

Risk Control SDK æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **è®¾å¤‡æŒ‡çº¹è¯†åˆ«**: ç¡¬ä»¶ã€è½¯ä»¶ã€ç½‘ç»œã€è¡Œä¸ºæŒ‡çº¹é‡‡é›†


- **å®‰å…¨æ£€æµ‹**: æ¨¡æ‹Ÿå™¨ã€Rootã€è°ƒè¯•å™¨ã€Hookæ¡†æ¶æ£€æµ‹ 


- **åé€†å‘å·¥ç¨‹**: ä»£ç æ··æ·†ã€å­—ç¬¦ä¸²åŠ å¯†ã€è¿è¡Œæ—¶å®Œæ•´æ€§ç›‘æ§


- **é£é™©è¯„ä¼°**: åŸºäºå¤šç»´åº¦æ•°æ®çš„é£é™©è¯„åˆ†ç®—æ³•


### æŠ€æœ¯æ¶æ„
</code></pre>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Native Layer â”‚ â† C/C++ CoreImplement
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code>
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y build-essential cmake git

# macOS
brew install cmake
xcode-select --install

# Windows (Use MSYS2)
pacman -S base-devel cmake git
</code></pre>
<h1 id="verifyinstall">VerifyInstall</h1>
<p>java -version javac -version</p>
<pre><code>unzip android-ndk-r25c-linux.zip
export ANDROID_NDK=/path/to/android-ndk-r25c

# Download android SDK (optional, Used forTest)
wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip
</code></pre>
<h1 id="memorycheck-only-linux">MemoryCheck (Only Linux)</h1>
<p>sudo apt install -y valgrind</p>
<pre><code>export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH
</code></pre>
<p>â”œâ”€â”€ docs/ # DocumentationDirectory â”‚ â”œâ”€â”€
ArtMethod_Direct_Registration.md â”‚ â””â”€â”€ diagrams/ # Architecture
Diagramtable â”œâ”€â”€ examples/ # Example code â”‚ â”œâ”€â”€ ArtMethodDemo.java â”‚ â””â”€â”€
RiskControlDemo.java â”œâ”€â”€ include/ # Header file directory â”œâ”€â”€ scripts/ #
Build scripts â”‚ â”œâ”€â”€ build.sh.in # Generic build script template â”‚ â””â”€â”€
build-android.sh.in # Android build script template â””â”€â”€ src/ # Source
code â”œâ”€â”€ java/ # Java layer implementation â”‚ â””â”€â”€ com/riskcontrol/ â”‚ â”œâ”€â”€
DeviceFingerprint.java â”‚ â”œâ”€â”€ RiskControlSDK.java â”‚ â”œâ”€â”€ RiskScore.java â”‚
â””â”€â”€ SecurityResult.java â””â”€â”€ native/ # Native layer implementation â”œâ”€â”€
anti_reverse.c/.h # Anti-reverse engineering protection â”œâ”€â”€
art_method_hook.c/.h # ART method hooking â”œâ”€â”€ risk_control.c/.h # Main
risk control logic â””â”€â”€ svc_syscall.c/.h # System call handling</p>
<pre><code>
```bash
cd /path/to/android_reversing/playground
git clone &lt;repository-url&gt; risk-control-sdk # orUseExistingCode
cd risk-control-sdk
</code></pre>
<pre><code>
# orSpecifiedDetailedOption
cmake -DCMAKE_BUILD_TYPE=Release \
- DENABLE_DEBUG=OFF \
- DENABLE_ANTI_REVERSE=ON \
- DENABLE_SVC_SYSCALLS=ON \
..
</code></pre>
<h1 id="orcompilespecifictarget">orCompileSpecificTarget</h1>
<p>make riskcontrol # Compile Native Library make compile_java # Compile
Java Code make create_jar # Create JAR Package make example #
CompileExampleProgram</p>
<pre><code>
# Should see:

# - libriskcontrol.so (Linux) or libriskcontrol.jnilib (macOS)

# - RiskControlSDK.jar

# - examples/

# Run tests
./examples/RiskControlDemo
</code></pre>
<p>echo $ANDROID_NDK</p>
<h1 id="shouldoutput-pathtoandroid-ndk-r25c">ShouldOutput:
/path/to/android-ndk-r25c</h1>
<h1 id="verify-ndk-toolchain">Verify NDK Toolchain</h1>
<p>$ANDROID_NDK/ndk-build â€“version</p>
<pre><code>cmake -P scripts/generate_build_scripts.cmake

# Execute android Build
chmod +x build-android.sh
./build-android.sh
</code></pre>
<p>cd build-android</p>
<h1 id="config-android-toolchain">Config android Toolchain</h1>
<p>cmake -DCMAKE_TOOLCHAIN_FILE=<span
class="math inline"><em>A</em><em>N</em><em>D</em><em>R</em><em>O</em><em>I</em><em>D</em><sub><em>N</em></sub><em>D</em><em>K</em>/<em>b</em><em>u</em><em>i</em><em>l</em><em>d</em>/<em>c</em><em>m</em><em>a</em><em>k</em><em>e</em>/<em>a</em><em>n</em><em>d</em><em>r</em><em>o</em><em>i</em><em>d</em>.<em>t</em><em>o</em><em>o</em><em>l</em><em>c</em><em>h</em><em>a</em><em>i</em><em>n</em>.<em>c</em><em>m</em><em>a</em><em>k</em><em>e</em>Â â€…âˆ’â€…<em>D</em><em>A</em><em>N</em><em>D</em><em>R</em><em>O</em><em>I</em><em>D</em><sub><em>A</em></sub><em>B</em><em>I</em>â€„=â€„<em>a</em><em>r</em><em>m</em>64â€…âˆ’â€…<em>v</em>8<em>a</em>Â â€…âˆ’â€…<em>D</em><em>A</em><em>N</em><em>D</em><em>R</em><em>O</em><em>I</em><em>D</em><sub><em>P</em></sub><em>L</em><em>A</em><em>T</em><em>F</em><em>O</em><em>R</em><em>M</em>â€„=â€„<em>a</em><em>n</em><em>d</em><em>r</em><em>o</em><em>i</em><em>d</em>â€…âˆ’â€…21Â â€…âˆ’â€…<em>D</em><em>A</em><em>N</em><em>D</em><em>R</em><em>O</em><em>I</em><em>D</em><sub><em>N</em></sub><em>D</em><em>K</em>=</span>ANDROID_NDK<br />
-DBUILD_ANDROID=ON<br />
-DCMAKE_BUILD_TYPE=Release<br />
..</p>
<h1 id="compile">Compile</h1>
<p>make -j$(nproc)</p>
<pre><code>
for ARCH in &quot;${ARCHITECTURES[@]}&quot;; do
echo &quot;Building for $ARCH...&quot;
mkdir -p build-android-$ARCH
cd build-android-$ARCH

cmake -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK/build/cmake/android.toolchain.cmake \
- DANDROID_ABI=$ARCH \
- DANDROID_PLATFORM=android-21 \
- DANDROID_NDK=$ANDROID_NDK \
- DBUILD_ANDROID=ON \
- DCMAKE_BUILD_TYPE=Release \
..

make -j$(nproc)
cd ..
done
</code></pre>
<p>|â€”â€”â€”|â€”â€”â€“|â€”â€”| | <code>CMAKE_BUILD_TYPE</code> | <code>Release</code> |
æ„å»ºç±»å‹: Debug/Release/RelWithDebInfo | | <code>ENABLE_DEBUG</code> |
<code>OFF</code> | å¯ç”¨è°ƒè¯•æ¨¡å¼å’Œæ—¥å¿—è¾“å‡º | |
<code>ENABLE_ANTI_REVERSE</code> | <code>ON</code> | å¯ç”¨åé€†å‘å·¥ç¨‹ä¿æŠ¤
| | <code>ENABLE_SVC_SYSCALLS</code> | <code>ON</code> | å¯ç”¨ SVC
ç³»ç»Ÿè°ƒç”¨æ”¯æŒ | | <code>BUILD_ANDROID</code> | <code>OFF</code> | Android
å¹³å°æ„å»ºæ¨¡å¼ | | <code>BUILD_EXAMPLES</code> | <code>ON</code> |
æ„å»ºç¤ºä¾‹ç¨‹åº | | <code>BUILD_DOCS</code> | <code>OFF</code> | ç”Ÿæˆ
Doxygen æ–‡æ¡£ |</p>
<h3 id="ä½¿ç”¨ç¤ºä¾‹-2">ä½¿ç”¨ç¤ºä¾‹</h3>
<div class="sourceCode" id="cb491"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DebugBuild</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="at">-DENABLE_DEBUG</span><span class="op">=</span>ON ..</span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true" tabindex="-1"></a><span class="co"># æœ€å°åŒ–æ„å»º (ç¦ç”¨ä¿æŠ¤åŠŸèƒ½)</span></span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DENABLE_ANTI_REVERSE</span><span class="op">=</span>OFF <span class="at">-DENABLE_SVC_SYSCALLS</span><span class="op">=</span>OFF ..</span>
<span id="cb491-6"><a href="#cb491-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-7"><a href="#cb491-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ReleaseBuild (å…¨åŠŸèƒ½)</span></span>
<span id="cb491-8"><a href="#cb491-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Release <span class="dt">\</span></span>
<span id="cb491-9"><a href="#cb491-9" aria-hidden="true" tabindex="-1"></a>- DENABLE_ANTI_REVERSE=ON <span class="dt">\</span></span>
<span id="cb491-10"><a href="#cb491-10" aria-hidden="true" tabindex="-1"></a>- DENABLE_SVC_SYSCALLS=ON <span class="dt">\</span></span>
<span id="cb491-11"><a href="#cb491-11" aria-hidden="true" tabindex="-1"></a>- DBUILD_EXAMPLES=OFF <span class="dt">\</span></span>
<span id="cb491-12"><a href="#cb491-12" aria-hidden="true" tabindex="-1"></a>..</span></code></pre></div>
<p>|â€”â€”|â€”â€”|â€”â€”â€“|â€”â€”â€“| | Linux | x86_64 | GCC/Clang |
<code>libriskcontrol.so</code> | | macOS | x86_64/arm64 | Clang |
<code>libriskcontrol.jnilib</code> | | Windows | x86_64 | MinGW/MSVC |
<code>riskcontrol.dll</code> | | Android | arm64-v8a | Android NDK |
<code>libriskcontrol.so</code> | | Android | armeabi-v7a | Android NDK |
<code>libriskcontrol.so</code> | | Android | x86/x86_64 | Android NDK |
<code>libriskcontrol.so</code> |</p>
<h3 id="å¹³å°ç‰¹å®šé…ç½®">å¹³å°ç‰¹å®šé…ç½®</h3>
<h4 id="linux-ç¼–è¯‘">Linux ç¼–è¯‘</h4>
<div class="sourceCode" id="cb492"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ubuntu/Debian ä¾èµ–</span></span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> build-essential cmake openjdk-8-jdk</span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-4"><a href="#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile</span></span>
<span id="cb492-5"><a href="#cb492-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> build-linux <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> build-linux</span>
<span id="cb492-6"><a href="#cb492-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Release ..</span>
<span id="cb492-7"><a href="#cb492-7" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> <span class="at">-j</span><span class="va">$(</span><span class="fu">nproc</span><span class="va">)</span></span></code></pre></div>
<h1 id="compile-support-universal-binary">Compile (Support Universal
Binary)</h1>
<p>mkdir build-macos &amp;&amp; cd build-macos cmake
-DCMAKE_BUILD_TYPE=Release<br />
-DCMAKE_OSX_ARCHITECTURES=â€œx86_64;arm64â€<br />
.. make -j$(sysctl -n hw.ncpu)</p>
<pre><code>
mkdir build-windows &amp;&amp; cd build-windows
cmake -G &quot;MinGW Makefiles&quot; -DCMAKE_BUILD_TYPE=Release ..
mingw32-make -j$(nproc)
</code></pre>
<pre><code>java -version
javac -version

2. æŸ¥æ‰¾æ­£ç¡® JDK Path


# macOS Homebrew Install OpenJDK
ls /usr/local/Cellar/openjdk/

# Ubuntu/Debian
ls /usr/lib/jvm/

# æ‰‹åŠ¨æŸ¥æ‰¾ JNI å¤´æ–‡ä»¶
find /usr -name &quot;jni.h&quot; 2&gt;/dev/null

3. è®¾ç½®æ­£ç¡®çš„ JAVA_HOME


# macOS Homebrew OpenJDK Example
export JAVA_HOME=/usr/local/Cellar/openjdk/24.0.1/libexec/openjdk.jdk/Contents/Home

# Ubuntu/Debian Example
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64

4. éªŒè¯ JNI å¤´æ–‡ä»¶å­˜åœ¨
ls -la $JAVA_HOME/include/jni.h

5. Re-Run CMake
cmake .
</code></pre>
<p>è§£å†³: Addå¹³å°å…¼å®¹æ€§Process</p>
<p>in/at art_method_hook.c InModify: // originalCode # include
&lt;sys/system_properties.h&gt;</p>
<p>// Modifyä¸ºå¹³å°å…¼å®¹ # ifdef <strong>andROID</strong> # include
&lt;sys/system_properties.h&gt; # else // Not android å¹³å°æ›¿ä»£Implement
# define PROP_VALUE_MAX 256 static int __system_property_get(const char*
name, char* value) { if (strcmp(name, â€œro.build.version.sdkâ€) == 0) {
strcpy(value, â€œ28â€); // æ¨¡æ‹Ÿ Android API 28 return strlen(value); }
value[0] = â€˜\0â€™; return 0; } # endif</p>
<pre><code>#include &lt;stdint.h&gt; // Addæ ‡å‡†IntegerClassTypeSupport
</code></pre>
<p>// Addç»“æ„ä½“Define typedef struct { const char* name; const char*
signature; void* fnPtr; } native_method_t;</p>
<p>// UpdateFunctionå£°æ˜ int register_native_methods_direct(JNIEnv* env,
const char* class_name, const native_method_t* methods, int
method_count);</p>
<pre><code>// originalCodeï¼ˆDeleteï¼‰
typedef struct {
const char* name;
const char* signature;
void* fnPtr;
} native_method_t;

// ä¿®æ”¹ä¸ºå‰å‘å£°æ˜
typedef struct native_method_t native_method_t;
</code></pre>
<p>uint32_t calculate_string_hash(const char* str); // åŸ calculate_hash
char* decrypt_raw_string(const unsigned char* encrypted, size_t len); //
åŸ decrypt_string</p>
<p>// MeanwhileUpdate .c FileinFunctionImplementandCall</p>
<pre><code>#else
// Not ARM architectureæ¨¡æ‹ŸImplementï¼ˆUsed foræ¡Œé¢å¹³å°Testï¼‰
static inline long svc_call(long number, long arg1, long arg2, long arg3, long arg4, long arg5, long arg6) {
switch (number) {
case __NR_getpid: return getpid();
case __NR_getuid: return getuid();
default: return -1;
}
}
#endif
</code></pre>
<p>if (!env-&gt;functions-&gt;FindClass ||</p>
<p>// Modifyä¸º if (!(*env)-&gt;FindClass ||</p>
<pre><code>

- Check JDK InstallCompleteæ€§


- å¯¹äº Android: ç¡®è®¤ NDK Version &gt;= r20
</code></pre>
<p>æœ€ä½³è§£å†³æ–¹æ¡ˆ: CreatePublicClassTypeDefineFile</p>
<ol type="1">
<li><p>Create src/native/common_types.h: #ifndef COMMON_TYPES_H #define
COMMON_TYPES_H typedef struct { const char* name; const char* signature;
void* fnPtr; } native_method_t; #endif</p></li>
<li><p>in/atAllNeedæ­¤ClassTypeå¤´FileInContains: #include
â€œcommon_types.hâ€</p></li>
<li><p>åˆ é™¤å…¶ä»–æ–‡ä»¶ä¸­çš„é‡å¤å®šä¹‰</p></li>
</ol>
<pre><code>
Error: implicit declaration of function &#39;dladdr&#39;
è§£å†³: Enabled GNU Extensionå¹¶Add dl Libraryé“¾æ¥

1. åœ¨ art_method_hook.c å¼€å¤´æ·»åŠ ï¼ˆå¿…é¡»åœ¨æ‰€æœ‰ #include ä¹‹Beforeï¼‰:
// Enabled GNU ExtensionåŠŸèƒ½ä»¥ç¡®ä¿ dladdr å¯ç”¨
#ifndef _GNU_SOURCE
#define _GNU_SOURCE
#endif

#include &quot;art_method_hook.h&quot;
// ... å…¶ä»– includes ...
#include &lt;dlfcn.h&gt;

2. in/at CMakeLists.txt InAdd dl Libraryé“¾æ¥:


# é“¾æ¥åº“
target_link_libraries(riskcontrol ${JNI_LIBRARIES})

# in/atNot android å¹³å°ä¸Šé“¾æ¥ dl Library
if(NOT BUILD_ANDROID)
target_link_libraries(riskcontrol dl)
endif()

3. Re-ConfigProject:
rm -f CMakeCache.txt
cmake .
make clean
make -j8
</code></pre>
<pre><code>sudo chown -R $USER:$USER build/
</code></pre>
<p>make -j<span class="math inline">$(nproc) # Linux
make -j$</span>(sysctl -n hw.ncpu) # macOS</p>
<pre><code>
# Use Ninja Buildç³»ç»Ÿ (æ›´å¿«)
cmake -G Ninja ..
ninja
</code></pre>
<p>export CC=â€œccache gccâ€ export CXX=â€œccache g++â€</p>
<pre><code>cmake --verbose ..

# Make DetailedOutput 
make VERBOSE=1
</code></pre>
<p>otool -L libriskcontrol.jnilib # macOS</p>
<h1 id="æ£€æŸ¥ç¬¦å·">æ£€æŸ¥ç¬¦å·</h1>
<p>nm -D libriskcontrol.so objdump -T libriskcontrol.so</p>
<pre><code>
# Java JNI Debug
java -Djava.library.path=./build -verbose:jni RiskControlDemo
</code></pre>
<p>// Load SDK System.loadLibrary(â€œriskcontrolâ€);</p>
<p>// Use SDK RiskControlSDK sdk = RiskControlSDK.getInstance();
SecurityResult result = sdk.performSecurityCheck(); DeviceFingerprint
fingerprint = sdk.getDeviceFingerprint(); RiskScore score =
sdk.calculateRiskScore(fingerprint, result);</p>
<pre><code>// ...
sourceSets {
main {
jniLibs.srcDirs = [&#39;libs&#39;]
}
}
}

dependencies {
implementation files(&#39;libs/RiskControlSDK.jar&#39;)
}
</code></pre>
<p>cp build/RiskControlSDK.jar /target/project/libs/</p>
<pre><code>2. **æ„å»ºé€‰é¡¹**: æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„åŠŸèƒ½å¼€å…³å’Œä¼˜åŒ–çº§åˆ«
3. **å¤šå¹³å°æ”¯æŒ**: ä½¿ç”¨ç»Ÿä¸€çš„ CMake é…ç½®æ”¯æŒå¤šç§ç›®æ ‡å¹³å°
4. **é—®é¢˜æ’æŸ¥**: é‡åˆ°é—®é¢˜æ—¶ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡ã€ä¾èµ–åº“å’Œæƒé™è®¾ç½®


é€šè¿‡éµå¾ªæœ¬æŒ‡å—ï¼Œä½ åº”è¯¥èƒ½å¤ŸæˆåŠŸç¼–è¯‘å’Œé›†æˆ Risk Control SDK åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚


&lt;!-- 04-Reference/Engineering/Data-Analysis/data_warehousing_and_processing.md --&gt;

___
# æ•°æ®åˆ†æï¼šæ•°æ®ä»“åº“ä¸è®¡ç®—å¼•æ“

å½“é€šè¿‡é€†å‘å’Œçˆ¬è™«é‡‡é›†åˆ°æµ·é‡æ•°æ®åï¼ˆä¾‹å¦‚ï¼Œæ•°äº¿æ¡ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€å•†å“ä¿¡æ¯ï¼‰ï¼Œå¦‚ä½•å­˜å‚¨ã€ç®¡ç†å’Œåˆ†æè¿™äº›æ•°æ®ï¼Œå°±æˆäº†å¤§æ•°æ®é¢†åŸŸçš„æ ¸å¿ƒé—®é¢˜ã€‚æœ¬èŠ‚å°†ä»‹ç»ä¸»æµçš„æ•°æ®ä»“åº“å’Œåˆ†å¸ƒå¼è®¡ç®—å¼•æ“æŠ€æœ¯ã€‚

___

## 1. æ•°æ®ä»“åº“ (Data Warehouse)

æ•°æ®ä»“åº“æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†ææµ·é‡ç»“æ„åŒ–ã€åŠç»“æ„åŒ–æ•°æ®çš„ç³»ç»Ÿã€‚å®ƒä¸ä¸šåŠ¡æ•°æ®åº“ï¼ˆOLTPï¼‰ä¸åŒï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯æ”¯æŒå¤æ‚çš„åˆ†ææŸ¥è¯¢ï¼ˆOLAPï¼‰ã€‚

### a) Hive

* **å®šä½**: åŸºäº Hadoop çš„ä¸€ä¸ª**æ•°æ®ä»“åº“åŸºç¡€æ¶æ„**ã€‚

* **æ ¸å¿ƒæ€æƒ³**: Hive å…è®¸ä½ ä½¿ç”¨æ ‡å‡†çš„ **SQL è¯­è¨€** æ¥æŸ¥è¯¢å­˜å‚¨åœ¨ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHDFSï¼‰ä¸Šçš„å¤§è§„æ¨¡æ•°æ®é›†ã€‚å®ƒå°† SQL æŸ¥è¯¢ç¿»è¯‘æˆ MapReduceã€Tez æˆ– Spark ä»»åŠ¡æ¥æ‰§è¡Œã€‚

* **å…ƒæ•°æ® (Metastore)**: Hive çš„æ ¸å¿ƒæ˜¯å…¶å…ƒæ•°æ®å­˜å‚¨ã€‚å®ƒè®°å½•äº†&quot;è¡¨&quot;çš„ç»“æ„ï¼ˆåˆ—åã€æ•°æ®ç±»å‹ï¼‰ä¸ HDFS ä¸Šçš„æ–‡ä»¶ï¼ˆå¦‚ CSV, Parquet, ORC æ–‡ä»¶ï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚æœ¬è´¨ä¸Šï¼ŒHive æä¾›äº†ä¸€ç§&quot;ç»™æ–‡ä»¶ç³»ç»Ÿå¥—ä¸Šä¸€ä¸ªç»“æ„åŒ–å¤–å£³&quot;çš„èƒ½åŠ›ã€‚

* **é€‚ç”¨åœºæ™¯**:
    * å¯¹æµ·é‡ï¼ˆTB/PB çº§ï¼‰çš„ã€éå®æ—¶çš„æ•°æ®è¿›è¡Œç¦»çº¿åˆ†æå’Œ ETLï¼ˆæå–ã€è½¬æ¢ã€åŠ è½½ï¼‰ã€‚
    * æ„å»ºä¼ä¸šçº§çš„æ•°æ®ä»“åº“ï¼Œä¸ºæ•°æ®åˆ†æå¸ˆå’Œ BI æŠ¥è¡¨æä¾›ç»Ÿä¸€çš„ SQL æŸ¥è¯¢å…¥å£ã€‚

### b) HBase

* **å®šä½**: ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å¯ä¼¸ç¼©çš„ã€é¢å‘åˆ—çš„ **NoSQL æ•°æ®åº“**ã€‚å®ƒæ„å»ºåœ¨ HDFS ä¹‹ä¸Šï¼Œå¹¶æ¨¡ä»¿ Google Bigtable çš„è®¾è®¡ã€‚

* **æ ¸å¿ƒç‰¹ç‚¹**:
    * **æµ·é‡å­˜å‚¨**: ä¸“ä¸ºå­˜å‚¨æ•°åäº¿è¡Œã€æ•°ç™¾ä¸‡åˆ—çš„è¶…å¤§è§„æ¨¡ç¨€ç–æ•°æ®é›†è€Œè®¾è®¡ã€‚
    * **å®æ—¶è¯»å†™**: ä¸ Hive ä¸»è¦ç”¨äºç¦»çº¿æ‰¹é‡åˆ†æä¸åŒï¼ŒHBase çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ”¯æŒå¯¹æµ·é‡æ•°æ®çš„**ä½å»¶è¿Ÿéšæœºè¯»å†™**ã€‚
    * **é¢å‘åˆ—**: æ•°æ®æŒ‰åˆ—æ—ï¼ˆColumn Familyï¼‰ç»„ç»‡ã€‚ä¸€ä¸ªåˆ—æ—ä¸­çš„æ‰€æœ‰åˆ—åœ¨ç‰©ç†ä¸Šå­˜å‚¨åœ¨ä¸€èµ·ï¼Œè¿™ä½¿å¾—å¯¹ç‰¹å®šåˆ—çš„è¯»å–éå¸¸é«˜æ•ˆã€‚
    * **æ— æ¨¡å¼ (Schemaless)**: ä½ å¯ä»¥éšæ—¶å‘ä¸€ä¸ªåˆ—æ—ä¸­æ·»åŠ æ–°çš„åˆ—ï¼Œè€Œæ— éœ€é¢„å…ˆå®šä¹‰è¡¨ç»“æ„ã€‚
* **é€‚ç”¨åœºæ™¯**:
    * éœ€è¦å¯¹æµ·é‡æ•°æ®è¿›è¡Œå®æ—¶ã€éšæœºè®¿é—®çš„åœºæ™¯ï¼Œä¾‹å¦‚ç”¨æˆ·ç”»åƒç³»ç»Ÿã€å®æ—¶æ¨èå¼•æ“çš„ç‰¹å¾åº“ã€ç›‘æ§æ•°æ®çš„å­˜å‚¨ã€‚
    * ä½œä¸ºæ•°æ®é‡‡é›†ç³»ç»Ÿçš„&quot;è½åœ°å±‚&quot;ï¼Œæ¥æ”¶å®æ—¶å†™å…¥çš„æ•°æ®æµï¼Œç„¶åç”± Hive æˆ– Spark è¿›è¡Œåç»­çš„æ‰¹é‡åˆ†æã€‚

### Hive vs. HBase

| ç‰¹æ€§ | Hive | HBase |
| --- | --- | --- |
| **æ•°æ®åº“ç±»å‹** | æ•°æ®ä»“åº“ (SQL on Hadoop) | NoSQL æ•°æ®åº“ (é¢å‘åˆ—) |
| **æ ¸å¿ƒç”¨é€”** | æ‰¹é‡åˆ†æ (OLAP) | å®æ—¶éšæœºè¯»å†™ (OLTP) |
| **å»¶è¿Ÿ** | é«˜ï¼ˆåˆ†é’Ÿçº§ï¼‰ | ä½ï¼ˆæ¯«ç§’çº§ï¼‰ |
| **æ•°æ®æ¨¡å‹** | ç»“æ„åŒ– | åŠç»“æ„åŒ–/æ— æ¨¡å¼ (ç¨€ç–è¡¨) |
| **è¯­è¨€** | SQL (HiveQL) | Java API, Shell, Thrift/REST |

___

## 2. åˆ†å¸ƒå¼è®¡ç®—å¼•æ“

è®¡ç®—å¼•æ“è´Ÿè´£å®é™…æ‰§è¡Œæ•°æ®å¤„ç†ä»»åŠ¡ã€‚ç°ä»£è®¡ç®—å¼•æ“é€šè¿‡åœ¨å†…å­˜ä¸­è¿›è¡Œè®¡ç®—ï¼Œæå¤§åœ°æå‡äº†å¤„ç†é€Ÿåº¦ã€‚

### a) Spark

* **å®šä½**: ä¸€ä¸ªå¿«é€Ÿã€é€šç”¨ã€å¯æ‰©å±•çš„**åˆ†å¸ƒå¼è®¡ç®—å¼•æ“**ã€‚

* **æ ¸å¿ƒæ¦‚å¿µ: RDD (å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)**: Spark çš„åŸºç¡€æ•°æ®ç»“æ„ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸å¯å˜çš„ã€è¢«åˆ†åŒºåˆ°é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„å…ƒç´ é›†åˆï¼Œæ”¯æŒä¸°å¯Œçš„è½¬æ¢ï¼ˆ`map`, `filter`, `join`ï¼‰å’Œè¡ŒåŠ¨ï¼ˆ`count`, `collect`, `save`ï¼‰æ“ä½œã€‚RDD çš„&quot;å¼¹æ€§&quot;ä½“ç°åœ¨å…¶è¡€ç¼˜å…³ç³»ï¼ˆLineageï¼‰ï¼Œä»»ä½•åˆ†åŒºçš„ä¸¢å¤±éƒ½å¯ä»¥æ ¹æ®å…¶è½¬æ¢å†å²è¢«é‡æ–°è®¡ç®—å‡ºæ¥ã€‚

* **DataFrame &amp; Spark SQL**: åœ¨ RDD ä¹‹ä¸Šï¼ŒSpark æä¾›äº†æ›´é«˜çº§çš„ DataFrame APIï¼Œå®ƒå°†æ•°æ®ç»„ç»‡æˆå¸¦æœ‰å‘½ååˆ—çš„äºŒç»´è¡¨ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„è¡¨ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥ä½¿ç”¨ Spark SQL æ¥è¿›è¡Œç»“æ„åŒ–æ•°æ®å¤„ç†ï¼Œå¹¶ä¸” Spark çš„ Catalyst ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨å¯¹ä½ çš„æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚

* **ç”Ÿæ€ç³»ç»Ÿ**:
    * **Spark Streaming**: ç”¨äºå¤„ç†å®æ—¶æ•°æ®æµï¼ˆMicro-batchingï¼‰ã€‚
    * **MLlib**: æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„æœºå™¨å­¦ä¹ ç®—æ³•åº“ã€‚
    * **GraphX**: ç”¨äºå›¾è®¡ç®—ã€‚
* **é€‚ç”¨åœºæ™¯**:
    * éœ€è¦é«˜æ€§èƒ½çš„ã€è¿­ä»£å¼çš„æ‰¹é‡æ•°æ®å¤„ç†å’Œæœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚
    * ç»Ÿä¸€æ‰¹å¤„ç†å’Œæµå¤„ç†ã€‚

### b) Flink

* **å®šä½**: ä¸€ä¸ªä»¥**çœŸæ­£çš„æµå¤„ç† (True Streaming)**ä¸ºæ ¸å¿ƒçš„åˆ†å¸ƒå¼è®¡ç®—å¼•æ“ã€‚

* **æ ¸å¿ƒç‰¹ç‚¹**:
    * **æµä¸ºæ ¸å¿ƒ**: Flink çš„è®¾è®¡å“²å­¦æ˜¯&quot;ä¸€åˆ‡çš†æ˜¯æµ&quot;ï¼Œæ‰¹é‡è®¡ç®—è¢«çœ‹ä½œæ˜¯æµè®¡ç®—çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚å®ƒèƒ½å¤Ÿä»¥äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œé€æ¡å¤„ç†æ•°æ®ï¼Œå®ç°æä½çš„å»¶è¿Ÿã€‚
    * **çŠ¶æ€ç®¡ç†ä¸çª—å£**: Flink æä¾›äº†å¼ºå¤§çš„çŠ¶æ€ç®¡ç†èƒ½åŠ›ï¼Œå…è®¸ä½ åœ¨æµå¤„ç†ä¸­ç»´æŠ¤å’Œæ›´æ–°çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·çš„ç´¯è®¡æ¶ˆè´¹é‡‘é¢ï¼‰ã€‚å®ƒè¿˜æ”¯æŒçµæ´»çš„çª—å£æ“ä½œï¼ˆå¦‚æ»šåŠ¨çª—å£ã€æ»‘åŠ¨çª—å£ã€ä¼šè¯çª—å£ï¼‰ï¼Œç”¨äºå¯¹æ— ç•Œæ•°æ®æµè¿›è¡Œèšåˆåˆ†æã€‚
    * **é«˜ååä¸ä½å»¶è¿Ÿ**: ä¸“ä¸ºä½å»¶è¿Ÿã€é«˜ååçš„å®æ—¶è®¡ç®—åœºæ™¯è®¾è®¡ã€‚
* **é€‚ç”¨åœºæ™¯**:
    * å¯¹å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼Œå¦‚å®æ—¶é£æ§ã€å®æ—¶æ¨èã€å®æ—¶ç›‘æ§å¤§ç›˜ã€‚
    * éœ€è¦è¿›è¡Œå¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰çš„åœºæ™¯ã€‚

___

## Spark vs. Flink

| ç‰¹æ€§ | Spark | Flink |
| --- | --- | --- |
| **æ ¸å¿ƒæ¨¡å‹** | æ‰¹å¤„ç† (Batch) | æµå¤„ç† (Streaming) |
| **æµå¤„ç†æ–¹å¼** | å¾®æ‰¹æ¬¡ (Micro-batch) | é€æ¡å¤„ç† (Per-event) |
| **å»¶è¿Ÿ** | ç§’çº§ | æ¯«ç§’çº§ |
| **çª—å£** | åŸºäºæ—¶é—´çš„çª—å£ | çµæ´»çš„çª—å£ï¼ˆæ—¶é—´ã€è®¡æ•°ã€ä¼šè¯ï¼‰ |
| **ç”Ÿæ€** | æ›´æˆç†Ÿï¼Œç¤¾åŒºæ›´åºå¤§ | å¿«é€Ÿå‘å±•ï¼Œåœ¨å®æ—¶è®¡ç®—é¢†åŸŸæ˜¯äº‹å®æ ‡å‡† |

**æ€»ç»“**: å¦‚æœä½ çš„ä¸»è¦ä»»åŠ¡æ˜¯ç¦»çº¿åˆ†æå’Œæœºå™¨å­¦ä¹ ï¼Œ`Spark` æ˜¯ä¸€ä¸ªæ›´é€šç”¨ã€æ›´æˆç†Ÿçš„é€‰æ‹©ã€‚å¦‚æœä½ çš„æ ¸å¿ƒæ˜¯éœ€è¦äºšç§’çº§å“åº”çš„å®æ—¶è®¡ç®—ï¼Œ`Flink` åˆ™æ˜¯æ›´ä¸“ä¸šçš„å·¥å…·ã€‚åœ¨è®¸å¤šç°ä»£æ•°æ®å¹³å°ä¸­ï¼ŒäºŒè€…å¾€å¾€ä¼šå…±å­˜ï¼Œåˆ†åˆ«å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚
___


&lt;!-- 04-Reference/Engineering/Data-Analysis/flink.md --&gt;

# Apache Flink å®æ—¶æµå¤„ç†

Apache Flink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†æ¡†æ¶ï¼Œä¸“ä¸ºä½å»¶è¿Ÿã€é«˜ååé‡çš„å®æ—¶æ•°æ®å¤„ç†è€Œè®¾è®¡ã€‚
___
## ç›®å½•
1. [**Flink æ¶æ„**](#flink-æ¶æ„)
2. [**æ ¸å¿ƒæ¦‚å¿µ**](#æ ¸å¿ƒæ¦‚å¿µ)
3. [**DataStream API**](#datastream-api)
4. [**çŠ¶æ€ç®¡ç†**](#çŠ¶æ€ç®¡ç†)
5. [**æ—¶é—´ä¸çª—å£**](#æ—¶é—´ä¸çª—å£)
6. [**å®¹é”™æœºåˆ¶**](#å®¹é”™æœºåˆ¶)
7. [**æ€§èƒ½è°ƒä¼˜**](#æ€§èƒ½è°ƒä¼˜)
8. [**çŸ¥è¯†è¦ç‚¹**](#çŸ¥è¯†è¦ç‚¹)
___
## Flink æ¶æ„

## # é›†ç¾¤æ¶æ„
</code></pre>
<p>â”œâ”€â”€ ResourceManager â””â”€â”€ JobMaster â†“ TaskManager1 TaskManager2
TaskManager3 â”œâ”€â”€ Task Slot1 â”œâ”€â”€ Task Slot1 â”œâ”€â”€ Task Slot1 â”œâ”€â”€ Task Slot2
â”œâ”€â”€ Task Slot2 â”œâ”€â”€ Task Slot2 â””â”€â”€ Task Slot3 â””â”€â”€ Task Slot3 â””â”€â”€ Task
Slot3</p>
<pre><code>| **TaskManager** | æ‰§è¡Œå…·ä½“ä»»åŠ¡ï¼Œç®¡ç†å†…å­˜å’Œç½‘ç»œ |
| **Dispatcher** | æ¥æ”¶ä½œä¸šæäº¤ï¼Œå¯åŠ¨JobMaster |
| **ResourceManager** | ç®¡ç†TaskManagerèµ„æº |
| **JobMaster** | ç®¡ç†å•ä¸ªä½œä¸šçš„æ‰§è¡Œ |

## # è¿è¡Œæ—¶æ¶æ„
</code></pre>
<p>Operator1 â†’ Operator2 â†’ Operator3</p>
<pre><code>
```java
StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

DataStream&lt;String&gt; stream = env
.socketTextStream(&quot;localhost&quot;, 9999)
.flatMap(new Tokenizer())
.keyBy(value -&gt; value.f0)
.window(TumblingProcessingTimeWindows.of(Time.seconds(5)))
.sum(1);

env.execute(&quot;Word Count&quot;);
</code></pre>
<pre><code>DataStream&lt;Integer&gt; intStream;

// 2. å…ƒç»„ç±»å‹
DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; tupleStream;

// 3. POJO ç±»å‹
public class WordCount {
public String word;
public int count;
// constructors, getters, setters
}
DataStream&lt;WordCount&gt; pojoStream;

// 4. Row ç±»å‹ï¼ˆåŠ¨æ€ï¼‰
DataStream&lt;Row&gt; rowStream;
</code></pre>
<p>StreamExecutionEnvironment env =
StreamExecutionEnvironment.getExecutionEnvironment();</p>
<p>// 1. Create from collection DataStream<String> fromCollection =
env.fromCollection(Arrays.asList(â€œaâ€, â€œbâ€, â€œcâ€));</p>
<p>// 2. ä»æ–‡ä»¶ç³»ç»Ÿ DataStream<String> fromFile =
env.readTextFile(â€œpath/to/fileâ€);</p>
<p>// 3. ä»Kafka Properties props = new Properties();
props.setProperty(â€œbootstrap.serversâ€, â€œlocalhost:9092â€);
props.setProperty(â€œgroup.idâ€, â€œtestâ€);</p>
<p>DataStream<String> fromKafka = env.addSource( new
FlinkKafkaConsumer&lt;&gt;(â€œtopicâ€, new SimpleStringSchema(),
props));</p>
<p>// 4. è‡ªå®šä¹‰æ•°æ®æº DataStream<String> customSource =
env.addSource(new CustomSourceFunction());</p>
<p>public class CustomSourceFunction implements SourceFunction<String> {
private volatile boolean running = true;</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void run(SourceContext<String> ctx) throws Exception { while (running) {
ctx.collect(â€œdata-â€ + System.currentTimeMillis()); Thread.sleep(1000); }
}</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void cancel() { running = false; } }</p>
<pre><code>DataStream&lt;String&gt; mapped = input.map(String::toUpperCase);

// 2. FlatMap - ä¸€å¯¹å¤šConvert
DataStream&lt;String&gt; flatMapped = input.flatMap(
(String line, Collector&lt;String&gt; out) -&gt; {
for (String word : line.split(&quot; &quot;)) {
out.collect(word);
}
});

// 3. Filter - Filter
DataStream&lt;String&gt; filtered = input.filter(s -&gt; s.startsWith(&quot;error&quot;));

// 4. KeyBy - Group
KeyedStream&lt;Tuple2&lt;String, Integer&gt;, String&gt; keyed = 
tupleStream.keyBy(value -&gt; value.f0);

// 5. Reduce - Aggregate
DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; reduced =
keyed.reduce((a, b) -&gt; new Tuple2&lt;&gt;(a.f0, a.f1 + b.f1));

// 6. Aggregate - è‡ªå®šä¹‰èšåˆ
DataStream&lt;Double&gt; aggregated = keyed
.aggregate(new AverageAggregate());

public class AverageAggregate implements AggregateFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple2&lt;Long, Long&gt;, Double&gt; {
@Override
public Tuple2&lt;Long, Long&gt; createAccumulator() {
return new Tuple2&lt;&gt;(0L, 0L);
}

@Override
public Tuple2&lt;Long, Long&gt; add(Tuple2&lt;String, Integer&gt; value, Tuple2&lt;Long, Long&gt; accumulator) {
return new Tuple2&lt;&gt;(accumulator.f0 + value.f1, accumulator.f1 + 1L);
}

@Override
public Double getResult(Tuple2&lt;Long, Long&gt; accumulator) {
return ((double) accumulator.f0) / accumulator.f1;
}

@Override
public Tuple2&lt;Long, Long&gt; merge(Tuple2&lt;Long, Long&gt; a, Tuple2&lt;Long, Long&gt; b) {
return new Tuple2&lt;&gt;(a.f0 + b.f0, a.f1 + b.f1);
}
}
</code></pre>
<p>// 2. å†™å…¥æ–‡ä»¶ stream.writeAsText(â€œpath/to/outputâ€);</p>
<p>// 3. å†™å…¥ Kafka Properties props = new Properties();
props.setProperty(â€œbootstrap.serversâ€, â€œlocalhost:9092â€);</p>
<p>stream.addSink(new FlinkKafkaProducer&lt;&gt;(â€œoutput-topicâ€, new
SimpleStringSchema(), props));</p>
<p>// 4. å†™å…¥æ•°æ®åº“ stream.addSink(new CustomSinkFunction());</p>
<p>public class CustomSinkFunction extends RichSinkFunction<String> {
private Connection connection;</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void open(Configuration parameters) throws Exception { //
åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ connection =
DriverManager.getConnection(â€œjdbc:mysql://localhost:3306/testâ€, â€œuserâ€,
â€œpasswordâ€); }</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void invoke(String value, Context context) throws Exception { //
æ‰§è¡Œæ’å…¥æ“ä½œ PreparedStatement stmt =
connection.prepareStatement(â€œINSERT INTO table VALUES (?)â€);
stmt.setString(1, value); stmt.executeUpdate(); }</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void close() throws Exception { if (connection != null) {
connection.close(); } } }</p>
<pre><code>
```java
public class StatefulMap extends RichMapFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple2&lt;String, Integer&gt;&gt; {
private ValueState&lt;Integer&gt; sumState;

@Override
public void open(Configuration config) {
ValueStateDescriptor&lt;Integer&gt; descriptor = 
new ValueStateDescriptor&lt;&gt;(&quot;sum&quot;, Integer.class);
sumState = getRuntimeContext().getState(descriptor);
}

@Override
public Tuple2&lt;String, Integer&gt; map(Tuple2&lt;String, Integer&gt; input) throws Exception {
Integer currentSum = sumState.value();
if (currentSum == null) {
currentSum = 0;
}
currentSum += input.f1;
sumState.update(currentSum);

return new Tuple2&lt;&gt;(input.f0, currentSum);
}
}
</code></pre>
<p>private ListState<String> checkpointedState;</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void snapshotState(FunctionSnapshotContext context) throws Exception {
checkpointedState.clear(); for (String element : bufferedElements) {
checkpointedState.add(element); } }</p>
<p><span class="citation" data-cites="Override">@Override</span> public
void initializeState(FunctionInitializationContext context) throws
Exception { ListStateDescriptor<String> descriptor = new
ListStateDescriptor&lt;&gt;(â€œbuffered-elementsâ€, String.class);</p>
<p>checkpointedState =
context.getOperatorStateStore().getListState(descriptor);</p>
<p>if (context.isRestored()) { for (String element :
checkpointedState.get()) { bufferedElements.add(element); } } } }</p>
<pre><code>
// 2. FsStateBackend (ç”Ÿäº§æ¨è)
env.setStateBackend(new FsStateBackend(&quot;hdfs://namenode:port/flink-checkpoints&quot;));

// 3. RocksDBStateBackend (å¤§çŠ¶æ€)
env.setStateBackend(new RocksDBStateBackend(&quot;hdfs://namenode:port/flink-checkpoints&quot;));

// é…ç½®
env.enableCheckpointing(60000); // 60 ç§’ checkpoint ä¸€æ¬¡
env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);
env.getCheckpointConfig().setMinPauseBetweenCheckpoints(30000);
env.getCheckpointConfig().setCheckpointTimeout(600000);
</code></pre>
<p>// 1. Processing Time (å¤„ç†æ—¶é—´)
env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime);</p>
<p>// 2. Event Time (äº‹ä»¶æ—¶é—´)
env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</p>
<p>// 3. Watermark (æ°´ä½çº¿) stream.assignTimestampsAndWatermarks(
WatermarkStrategy.<Event>forBoundedOutOfOrderness(Duration.ofSeconds(10))
.withTimestampAssigner((event, timestamp) -&gt;
event.getTimestamp()));</p>
<pre><code>stream.keyBy(...)
.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.sum(1);

// æ»‘åŠ¨çª—å£ (Sliding Window) 
stream.keyBy(...)
.window(SlidingEventTimeWindows.of(Time.minutes(10), Time.minutes(2)))
.sum(1);

// ä¼šè¯çª—å£ (Session Window)
stream.keyBy(...)
.window(EventTimeSessionWindows.withGap(Time.minutes(30)))
.sum(1);
</code></pre>
<p>.countWindow(100) .sum(1);</p>
<p>// æ»‘åŠ¨è®¡æ•°çª—å£ stream.keyBy(â€¦) .countWindow(100, 10) .sum(1);</p>
<pre><code>.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.reduce(new SumReduceFunction());

// 2. AggregateFunction 
stream.keyBy(...)
.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.aggregate(new AverageAggregateFunction());

// 3. ProcessWindowFunction
stream.keyBy(...)
.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.process(new MyProcessWindowFunction());

public class MyProcessWindowFunction extends ProcessWindowFunction&lt;Tuple2&lt;String, Integer&gt;, String, String, TimeWindow&gt; {
@Override
public void process(String key, Context context, Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; elements, Collector&lt;String&gt; out) {
int count = 0;
for (Tuple2&lt;String, Integer&gt; element : elements) {
count++;
}
out.collect(&quot;Window: &quot; + context.window() + &quot; count: &quot; + count);
}
}
</code></pre>
<p>// EnabledCheckpoint env.enableCheckpointing(60000,
CheckpointingMode.EXACTLY_ONCE);</p>
<p>// ConfigCheckpoint CheckpointConfig config =
env.getCheckpointConfig(); config.setMinPauseBetweenCheckpoints(30000);
config.setCheckpointTimeout(600000);
config.setMaxConcurrentCheckpoints(1);
config.enableExternalizedCheckpoints(ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);</p>
<p>// é‡å¯Strategy
env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 3, //
é‡å¯æ¬¡æ•° Time.of(10, TimeUnit.SECONDS) // é‡å¯é—´éš” ));</p>
<p>env.setRestartStrategy(RestartStrategies.exponentialDelayRestart(
Time.milliseconds(1), Time.milliseconds(1000), 1. 2, // æŒ‡æ•°åŸºæ•°
Time.milliseconds(5000), // æœ€å¤§Latency 0. 1 // æŠ–åŠ¨å› å­ ));</p>
<pre><code>
# ä» Savepoint æ¢å¤
bin/flink run -s &lt;savepointPath&gt; &lt;jarFile&gt;

# DeleteSavepoint
bin/flink savepoint -d &lt;savepointPath&gt;
</code></pre>
<p>// 1. å…¨å±€å¹¶è¡Œåº¦ env.setParallelism(4);</p>
<p>// 2. ç®—å­å¹¶è¡Œåº¦ stream.map(â€¦).setParallelism(2);</p>
<p>// 3. Slotå…±äº«ç»„ stream.map(â€¦).slotSharingGroup(â€œgroup1â€);</p>
<pre><code>taskmanager.memory.flink.size: 3g
taskmanager.memory.network.fraction: 0.1
taskmanager.memory.managed.fraction: 0.4
</code></pre>
<p>// æ‰¹é‡ä¼ è¾“ env.setBufferTimeout(100);</p>
<pre><code>backend.setPredefinedOptions(PredefinedOptions.SPINNING_DISK_OPTIMIZED);
backend.setDbStoragePath(&quot;/tmp/rocksdb&quot;);
env.setStateBackend(backend);
</code></pre>
<p>|:â€”|:â€”|:â€”| | <strong>å¤„ç†æ¨¡å‹</strong> | çœŸæ­£çš„æµå¤„ç† | å¾®æ‰¹å¤„ç† | |
<strong>å»¶è¿Ÿ</strong> | æ¯«ç§’çº§ | ç§’çº§ | | <strong>ååé‡</strong> | é«˜ |
å¾ˆé«˜ | | <strong>çŠ¶æ€ç®¡ç†</strong> | åŸç”Ÿæ”¯æŒ | æœ‰é™æ”¯æŒ | |
<strong>å®¹é”™</strong> | Checkpoint | RDD lineage | |
<strong>åå‹</strong> | åŸç”Ÿæ”¯æŒ | æœ‰é™æ”¯æŒ |</p>
<h2 id="åå‹-backpressure-æœºåˆ¶"># 2. åå‹ (Backpressure) æœºåˆ¶</h2>
<ul>
<li><p>*é—®é¢˜**: ä¸‹æ¸¸å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä¸Šæ¸¸äº§ç”Ÿé€Ÿåº¦</p></li>
<li><p>*Flinkè§£å†³æ–¹æ¡ˆ**:</p></li>
</ul>
<ol type="1">
<li><strong>ä¿¡ç”¨æœºåˆ¶</strong>: åŸºäºä¿¡ç”¨çš„æµé‡æ§åˆ¶</li>
<li><strong>ç¼“å†²æ± </strong>: åŠ¨æ€è°ƒæ•´ç¼“å†²æ± å¤§å°</li>
<li><strong>ç½‘ç»œæ ˆ</strong>: TCPæµé‡æ§åˆ¶</li>
<li><strong>ç›‘æ§</strong>: Web UIæ˜¾ç¤ºåå‹æƒ…å†µ</li>
</ol>
<h2 id="exactly-onceè¯­ä¹‰ä¿è¯"># 3. Exactly-Onceè¯­ä¹‰ä¿è¯</h2>
<ul>
<li>*ç»„ä»¶**:</li>
</ul>
<ol type="1">
<li><strong>Source</strong>: å¯é‡æ”¾ï¼ˆå¦‚Kafka offsetï¼‰</li>
<li><strong>å†…éƒ¨å¤„ç†</strong>: Checkpointæœºåˆ¶</li>
<li><strong>Sink</strong>: ä¸¤é˜¶æ®µæäº¤æˆ–å¹‚ç­‰å†™å…¥</li>
</ol>
<div class="sourceCode" id="cb517"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ä¸¤é˜¶æ®µæäº¤ Sink ç¤ºä¾‹</span></span>
<span id="cb517-2"><a href="#cb517-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TwoPhaseCommitSink <span class="kw">extends</span> TwoPhaseCommitSinkFunction<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> Transaction<span class="op">,</span> <span class="bu">Void</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb517-3"><a href="#cb517-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb517-4"><a href="#cb517-4" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> Transaction <span class="fu">beginTransaction</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb517-5"><a href="#cb517-5" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">new</span> <span class="fu">Transaction</span><span class="op">();</span></span>
<span id="cb517-6"><a href="#cb517-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb517-7"><a href="#cb517-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-8"><a href="#cb517-8" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb517-9"><a href="#cb517-9" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">invoke</span><span class="op">(</span>Transaction transaction<span class="op">,</span> <span class="bu">String</span> value<span class="op">,</span> <span class="bu">Context</span> context<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb517-10"><a href="#cb517-10" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">add</span><span class="op">(</span>value<span class="op">);</span></span>
<span id="cb517-11"><a href="#cb517-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb517-12"><a href="#cb517-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-13"><a href="#cb517-13" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb517-14"><a href="#cb517-14" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">preCommit</span><span class="op">(</span>Transaction transaction<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb517-15"><a href="#cb517-15" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">flush</span><span class="op">();</span></span>
<span id="cb517-16"><a href="#cb517-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb517-17"><a href="#cb517-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-18"><a href="#cb517-18" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb517-19"><a href="#cb517-19" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">commit</span><span class="op">(</span>Transaction transaction<span class="op">)</span> <span class="op">{</span></span>
<span id="cb517-20"><a href="#cb517-20" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">commit</span><span class="op">();</span></span>
<span id="cb517-21"><a href="#cb517-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb517-22"><a href="#cb517-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-23"><a href="#cb517-23" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb517-24"><a href="#cb517-24" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">abort</span><span class="op">(</span>Transaction transaction<span class="op">)</span> <span class="op">{</span></span>
<span id="cb517-25"><a href="#cb517-25" aria-hidden="true" tabindex="-1"></a>transaction<span class="op">.</span><span class="fu">rollback</span><span class="op">();</span></span>
<span id="cb517-26"><a href="#cb517-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb517-27"><a href="#cb517-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ol type="1">
<li><strong>Watermark</strong>: äº‹ä»¶æ—¶é—´çª—å£</li>
<li><strong>Processing Time</strong>: å¤„ç†æ—¶é—´çª—å£</li>
<li><strong>å…ƒç´ è®¡æ•°</strong>: è®¡æ•°çª—å£</li>
<li><strong>è‡ªå®šä¹‰</strong>: ç”¨æˆ·å®šä¹‰çš„è§¦å‘å™¨</li>
</ol>
<h2 id="çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ"># 5. çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ</h2>
<ol type="1">
<li><strong>é€‰æ‹©åˆé€‚çš„çŠ¶æ€ç±»å‹</strong>: ValueState vs ListState vs
MapState</li>
<li><strong>è®¾ç½®çŠ¶æ€TTL</strong>: é¿å…çŠ¶æ€æ— é™å¢é•¿</li>
<li><strong>é€‰æ‹©åˆé€‚çš„çŠ¶æ€åç«¯</strong>: å†…å­˜ vs æ–‡ä»¶ç³»ç»Ÿ vs
RocksDB</li>
<li><strong>çŠ¶æ€å¤§å°ç›‘æ§</strong>: åŠæ—¶å‘ç°çŠ¶æ€è†¨èƒ€</li>
</ol>
<div class="sourceCode" id="cb518"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co">// SetStatusTTL</span></span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>StateTtlConfig ttlConfig <span class="op">=</span> StateTtlConfig</span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">newBuilder</span><span class="op">(</span><span class="bu">Time</span><span class="op">.</span><span class="fu">days</span><span class="op">(</span><span class="dv">7</span><span class="op">))</span></span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">setUpdateType</span><span class="op">(</span>StateTtlConfig<span class="op">.</span><span class="fu">UpdateType</span><span class="op">.</span><span class="fu">OnCreateAndWrite</span><span class="op">)</span></span>
<span id="cb518-5"><a href="#cb518-5" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">setStateVisibility</span><span class="op">(</span>StateTtlConfig<span class="op">.</span><span class="fu">StateVisibility</span><span class="op">.</span><span class="fu">NeverReturnExpired</span><span class="op">)</span></span>
<span id="cb518-6"><a href="#cb518-6" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb518-7"><a href="#cb518-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-8"><a href="#cb518-8" aria-hidden="true" tabindex="-1"></a>ValueStateDescriptor<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> descriptor <span class="op">=</span> <span class="kw">new</span> ValueStateDescriptor<span class="op">&lt;&gt;(</span><span class="st">&quot;my-state&quot;</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb518-9"><a href="#cb518-9" aria-hidden="true" tabindex="-1"></a>descriptor<span class="op">.</span><span class="fu">enableTimeToLive</span><span class="op">(</span>ttlConfig<span class="op">);</span></span>
<span id="cb518-10"><a href="#cb518-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-11"><a href="#cb518-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-12"><a href="#cb518-12" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>æ£€æµ‹æ•…éšœ<span class="op">**:</span> JobManagerç›‘æ§TaskManagerå¿ƒè·³</span>
<span id="cb518-13"><a href="#cb518-13" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>é‡å¯ä»»åŠ¡<span class="op">**:</span> æ ¹æ®é‡å¯ç­–ç•¥é‡å¯å¤±è´¥ä»»åŠ¡</span>
<span id="cb518-14"><a href="#cb518-14" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>æ¢å¤çŠ¶æ€<span class="op">**:</span> ä»æœ€è¿‘çš„ Checkpoint æ¢å¤çŠ¶æ€</span>
<span id="cb518-15"><a href="#cb518-15" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">**</span>é‡æ”¾æ•°æ®<span class="op">**:</span> <span class="bu">Source</span> é‡æ”¾ Checkpoint ä¹‹åçš„æ•°æ®</span>
<span id="cb518-16"><a href="#cb518-16" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> <span class="op">**</span>ç»§ç»­å¤„ç†<span class="op">**:</span> æ¢å¤æ­£å¸¸å¤„ç†æµç¨‹</span>
<span id="cb518-17"><a href="#cb518-17" aria-hidden="true" tabindex="-1"></a>    ```</span>
<span id="cb518-18"><a href="#cb518-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-19"><a href="#cb518-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-20"><a href="#cb518-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-21"><a href="#cb518-21" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> <span class="bn">04</span><span class="op">-</span><span class="bu">Reference</span><span class="op">/</span>Engineering<span class="op">/</span><span class="bu">Data</span><span class="op">-</span>Analysis<span class="op">/</span>hbase<span class="op">.</span><span class="fu">md</span> <span class="op">--&gt;</span></span>
<span id="cb518-22"><a href="#cb518-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-23"><a href="#cb518-23" aria-hidden="true" tabindex="-1"></a># HBase åˆ†å¸ƒå¼NoSQLæ•°æ®åº“</span>
<span id="cb518-24"><a href="#cb518-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-25"><a href="#cb518-25" aria-hidden="true" tabindex="-1"></a>Apache HBase æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ï¼ŒåŸºäº Google Bigtable è®ºæ–‡å®ç°ï¼Œè¿è¡Œåœ¨ HDFS ä¹‹ä¸Šã€‚</span>
<span id="cb518-26"><a href="#cb518-26" aria-hidden="true" tabindex="-1"></a>___</span>
<span id="cb518-27"><a href="#cb518-27" aria-hidden="true" tabindex="-1"></a>## ç›®å½•</span>
<span id="cb518-28"><a href="#cb518-28" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">[**</span>HBase æ¶æ„<span class="op">**](</span>#hbase<span class="op">-</span>æ¶æ„<span class="op">)</span></span>
<span id="cb518-29"><a href="#cb518-29" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">[**</span>æ•°æ®æ¨¡å‹<span class="op">**](</span>#æ•°æ®æ¨¡å‹<span class="op">)</span></span>
<span id="cb518-30"><a href="#cb518-30" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">[**</span>Shell æ“ä½œ<span class="op">**](</span>#shell<span class="op">-</span>æ“ä½œ<span class="op">)</span></span>
<span id="cb518-31"><a href="#cb518-31" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">[**</span>Java API<span class="op">**](</span>#java<span class="op">-</span>api<span class="op">)</span></span>
<span id="cb518-32"><a href="#cb518-32" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> <span class="op">[**</span>æ€§èƒ½ä¼˜åŒ–<span class="op">**](</span>#æ€§èƒ½ä¼˜åŒ–<span class="op">)</span></span>
<span id="cb518-33"><a href="#cb518-33" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span> <span class="op">[**</span>é›†ç¾¤ç®¡ç†<span class="op">**](</span>#é›†ç¾¤ç®¡ç†<span class="op">)</span></span>
<span id="cb518-34"><a href="#cb518-34" aria-hidden="true" tabindex="-1"></a><span class="fl">7.</span> <span class="op">[**</span>çŸ¥è¯†è¦ç‚¹<span class="op">**](</span>#çŸ¥è¯†è¦ç‚¹<span class="op">)</span></span>
<span id="cb518-35"><a href="#cb518-35" aria-hidden="true" tabindex="-1"></a>___</span>
<span id="cb518-36"><a href="#cb518-36" aria-hidden="true" tabindex="-1"></a>## HBase æ¶æ„</span>
<span id="cb518-37"><a href="#cb518-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-38"><a href="#cb518-38" aria-hidden="true" tabindex="-1"></a>## # æ ¸å¿ƒç»„ä»¶</span></code></pre></div>
<p>RegionServer1 RegionServer2 RegionServer3 â†“ â†“ â†“ Region1,2 Region3,4
Region5,6 â†“ â†“ â†“ HDFS DataNode HDFS DataNode HDFS DataNode</p>
<pre><code>| **Region** | è¡¨çš„æ°´å¹³åˆ†ç‰‡ï¼ŒåŒ…å«ä¸€å®šèŒƒå›´çš„è¡Œ |
| **ZooKeeper** | åè°ƒæœåŠ¡ï¼Œå­˜å‚¨å…ƒæ•°æ®ï¼Œæ•…éšœæ£€æµ‹ |
| **HDFS** | åº•å±‚å­˜å‚¨ç³»ç»Ÿ |

## # Region è¯¦ç»†ç»“æ„
</code></pre>
<p>â”‚ â”œâ”€â”€ Index Block â”‚ â””â”€â”€ Bloom Filter â””â”€â”€ WAL (Write-Ahead Log)</p>
<pre><code>3. **MemStore**: æ•°æ®å†™å…¥å†…å­˜
4. **Flush**: MemStoreè¾¾åˆ°é˜ˆå€¼æ—¶åˆ·å†™åˆ°HFile
5. **Compaction**: å®šæœŸåˆå¹¶HFile


### è¯»å–æµç¨‹
1. **Client** â†’ **RegionServer**: è¯»è¯·æ±‚
2. **MemStore**: å…ˆæŸ¥å†…å­˜ä¸­çš„æ•°æ®
3. **BlockCache**: æŸ¥è¯¢ç¼“å­˜çš„HFileå—
4. **HFile**: ä»ç£ç›˜è¯»å–æ•°æ®
5. **Merge**: åˆå¹¶å¤šä¸ªæ¥æºçš„æ•°æ®è¿”å›
___
## æ•°æ®æ¨¡å‹

## # é€»è¾‘è§†å›¾
</code></pre>
<p>â”‚ â”‚ â””â”€â”€ age:25 (timestamp:1234567891) â”‚ â””â”€â”€ Column Family:
contact_info â”‚ â”œâ”€â”€ email:zhang@example.com (timestamp:1234567892) â”‚ â””â”€â”€
phone:13800138000 (timestamp:1234567893) â””â”€â”€ Row Key: user002 â””â”€â”€ â€¦</p>
<pre><code>user002:name:1234567900 â†’ li_si

contact_info Store:
user001:email:1234567892 â†’ zhang@example.com
user001:phone:1234567893 â†’ 13800138000
</code></pre>
<div class="line-block"><strong>Column Family</strong> |
åˆ—æ—ï¼Œåˆ—çš„é€»è¾‘åˆ†ç»„ |<br />
<strong>Column Qualifier</strong> | åˆ—é™å®šç¬¦ï¼Œåˆ—æ—ä¸‹çš„å…·ä½“åˆ— |<br />
<strong>Cell</strong> | å•å…ƒæ ¼ï¼Œç”±(row, column family, column qualifier,
timestamp)ç¡®å®š |<br />
<strong>Timestamp</strong> | æ—¶é—´æˆ³ï¼ŒåŒä¸€ Cell çš„å¤šä¸ªç‰ˆæœ¬ |</div>
<hr />
<h2 id="shell-æ“ä½œ">Shell æ“ä½œ</h2>
<h2 id="è¿æ¥ä¸åŸºæœ¬æ“ä½œ"># è¿æ¥ä¸åŸºæœ¬æ“ä½œ</h2>
<div class="sourceCode" id="cb522"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="co"># StartHBase Shell</span></span>
<span id="cb522-2"><a href="#cb522-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hbase</span> shell</span>
<span id="cb522-3"><a href="#cb522-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-4"><a href="#cb522-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ViewStatus</span></span>
<span id="cb522-5"><a href="#cb522-5" aria-hidden="true" tabindex="-1"></a><span class="ex">status</span></span>
<span id="cb522-6"><a href="#cb522-6" aria-hidden="true" tabindex="-1"></a><span class="ex">version</span></span>
<span id="cb522-7"><a href="#cb522-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-8"><a href="#cb522-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ViewClusterInformation</span></span>
<span id="cb522-9"><a href="#cb522-9" aria-hidden="true" tabindex="-1"></a><span class="fu">whoami</span></span></code></pre></div>
<h1 id="listnamespace">ListNamespace</h1>
<p>list_namespace</p>
<h1 id="deletenamespace">DeleteNamespace</h1>
<p>drop_namespace â€˜my_namespaceâ€™</p>
<pre><code>
# Createtableï¼ˆå¸¦Configï¼‰
create &#39;user_info&#39;, 
{NAME =&gt; &#39;basic_info&#39;, VERSIONS =&gt; 3, TTL =&gt; 2592000},
{NAME =&gt; &#39;contact_info&#39;, COMPRESSION =&gt; &#39;SNAPPY&#39;}

# Listtable
list

# View tableç»“æ„
describe &#39;user_info&#39;

# ç¦ç”¨table
disable &#39;user_info&#39;

# Enabledtable
enable &#39;user_info&#39;

# Deletetable
drop &#39;user_info&#39;

# ä¿®æ”¹è¡¨ç»“æ„
alter &#39;user_info&#39;, {NAME =&gt; &#39;basic_info&#39;, VERSIONS =&gt; 5}
</code></pre>
<p>put â€˜user_infoâ€™, â€˜user001â€™, â€˜basic_info:ageâ€™, â€˜25â€™ put â€˜user_infoâ€™,
â€˜user001â€™, â€˜contact_info:emailâ€™, â€˜zhang@example.comâ€™</p>
<h1 id="æŸ¥è¯¢å•è¡Œ">æŸ¥è¯¢å•è¡Œ</h1>
<p>get â€˜user_infoâ€™, â€˜user001â€™</p>
<h1 id="æŸ¥è¯¢æŒ‡å®šåˆ—æ—">æŸ¥è¯¢æŒ‡å®šåˆ—æ—</h1>
<p>get â€˜user_infoâ€™, â€˜user001â€™, â€˜basic_infoâ€™</p>
<h1 id="æŸ¥è¯¢æŒ‡å®šåˆ—">æŸ¥è¯¢æŒ‡å®šåˆ—</h1>
<p>get â€˜user_infoâ€™, â€˜user001â€™, â€˜basic_info:nameâ€™</p>
<h1 id="æ‰«æè¡¨">æ‰«æè¡¨</h1>
<p>scan â€˜user_infoâ€™</p>
<h1 id="æ¡ä»¶æ‰«æ">æ¡ä»¶æ‰«æ</h1>
<p>scan â€˜user_infoâ€™, {STARTROW =&gt; â€˜user001â€™, ENDROW =&gt; â€˜user999â€™}
scan â€˜user_infoâ€™, {FILTER =&gt; â€œSingleColumnValueFilter(â€˜basic_infoâ€™,
â€˜ageâ€™, &gt;=, â€˜binary:18â€™)â€}</p>
<h1 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h1>
<p>delete â€˜user_infoâ€™, â€˜user001â€™, â€˜basic_info:ageâ€™</p>
<h1 id="åˆ é™¤è¡Œ">åˆ é™¤è¡Œ</h1>
<p>deleteall â€˜user_infoâ€™, â€˜user001â€™</p>
<h1 id="è®¡æ•°">è®¡æ•°</h1>
<p>count â€˜user_infoâ€™</p>
<pre><code>// ConfigConnect
Configuration conf = HBaseConfiguration.create();
conf.set(&quot;hbase.zookeeper.quorum&quot;, &quot;node1,node2,node3&quot;);
conf.set(&quot;hbase.zookeeper.property.clientPort&quot;, &quot;2181&quot;);

// CreateConnect
Connection connection = ConnectionFactory.createConnection(conf);
Admin admin = connection.getAdmin();
</code></pre>
<p>HTableDescriptor tableDesc = new HTableDescriptor(tableName);</p>
<p>// Addåˆ—æ— HColumnDescriptor basicInfo = new
HColumnDescriptor(â€œbasic_infoâ€); basicInfo.setMaxVersions(3);
basicInfo.setTimeToLive(30 * 24 * 60 * 60); // 30å¤©TTL</p>
<p>HColumnDescriptor contactInfo = new
HColumnDescriptor(â€œcontact_infoâ€);
contactInfo.setCompressionType(Compression.Algorithm.SNAPPY);</p>
<p>tableDesc.addFamily(basicInfo); tableDesc.addFamily(contactInfo);</p>
<p>// Createtable admin.createTable(tableDesc);</p>
<pre><code>Put put = new Put(Bytes.toBytes(&quot;user001&quot;));
put.addColumn(Bytes.toBytes(&quot;basic_info&quot;), Bytes.toBytes(&quot;name&quot;), Bytes.toBytes(&quot;zhang_san&quot;));
put.addColumn(Bytes.toBytes(&quot;basic_info&quot;), Bytes.toBytes(&quot;age&quot;), Bytes.toBytes(&quot;25&quot;));
table.put(put);

// æ‰¹é‡æ’å…¥
List&lt;Put&gt; puts = new ArrayList&lt;&gt;();
for (int i = 0; i &lt; 1000; i++) {
Put batchPut = new Put(Bytes.toBytes(&quot;user&quot; + String.format(&quot;%03d&quot;, i)));
batchPut.addColumn(Bytes.toBytes(&quot;basic_info&quot;), Bytes.toBytes(&quot;name&quot;), Bytes.toBytes(&quot;user&quot; + i));
puts.add(batchPut);
}
table.put(puts);

// æŸ¥è¯¢æ•°æ®
Get get = new Get(Bytes.toBytes(&quot;user001&quot;));
get.addFamily(Bytes.toBytes(&quot;basic_info&quot;));
Result result = table.get(get);

// è§£æç»“æœ
for (Cell cell : result.listCells()) {
String family = Bytes.toString(CellUtil.cloneFamily(cell));
String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
String value = Bytes.toString(CellUtil.cloneValue(cell));
System.out.println(family + &quot;:&quot; + qualifier + &quot; = &quot; + value);
}

// æ‰«ææ•°æ®
Scan scan = new Scan();
scan.setStartRow(Bytes.toBytes(&quot;user001&quot;));
scan.setStopRow(Bytes.toBytes(&quot;user999&quot;));
scan.addFamily(Bytes.toBytes(&quot;basic_info&quot;));

ResultScanner scanner = table.getScanner(scan);
for (Result res : scanner) {
// ProcessResult
}
scanner.close();
</code></pre>
<p>Bytes.toBytes(â€œbasic_infoâ€), Bytes.toBytes(â€œageâ€),
CompareFilter.CompareOp.GREATER_OR_EQUAL, Bytes.toBytes(â€œ18â€) );</p>
<p>// å‰ç¼€è¿‡æ»¤å™¨ PrefixFilter prefixFilter = new
PrefixFilter(Bytes.toBytes(â€œuser00â€));</p>
<p>// ç»„åˆè¿‡æ»¤å™¨ FilterList filterList = new
FilterList(FilterList.Operator.MUST_PASS_ALL);
filterList.addFilter(filter); filterList.addFilter(prefixFilter);</p>
<p>scan.setFilter(filterList);</p>
<pre><code>// 1. é¿å…çƒ­ç‚¹ï¼šä½¿ç”¨æ•£åˆ—å‰ç¼€
String rowKey = MD5Hash.digest(userId).toString().substring(0, 2) + &quot;_&quot; + userId;

// 2. æ—¶é—´å€’åºï¼šä¾¿äºæŸ¥è¯¢æœ€æ–°æ•°æ®
String rowKey = userId + &quot;_&quot; + (Long.MAX_VALUE - timestamp);

// 3. ç»„åˆKeyï¼šSupportå¤šç»´Query
String rowKey = region + &quot;_&quot; + userId + &quot;_&quot; + timestamp;
</code></pre>
<p>{NAME =&gt; â€˜profileâ€™, COMPRESSION =&gt; â€˜SNAPPYâ€™}, // ç”¨æˆ·Basic
information {NAME =&gt; â€˜behaviorâ€™, TTL =&gt; 604800} //
ç”¨æˆ·è¡Œä¸ºData(7å¤©TTL)</p>
<p>// é¿å…ï¼šåˆ—æ—è¿‡å¤š // é¿å…ï¼šä¸åŒè®¿é—®æ¨¡å¼åˆ—æ”¾in/atåŒä¸€åˆ—æ—</p>
<pre><code>for (UserData user : userData) {
Put put = createPut(user);
puts.add(put);

// æ‰¹é‡æäº¤
if (puts.size() &gt;= 1000) {
table.put(puts);
puts.clear();
}
}
// æäº¤å‰©ä½™æ•°æ®
if (!puts.isEmpty()) {
table.put(puts);
}
</code></pre>
<p>family.setBlockCacheEnabled(true);
family.setCacheBloomsOnWrite(true); family.setCacheDataOnWrite(true);
family.setCacheIndexesOnWrite(true);</p>
<pre><code># æ‰‹åŠ¨åˆ†è£‚ Region
split &#39;user_info&#39;, &#39;user500&#39;

# åˆå¹¶ Region
merge_region &#39;region1_encoded_name&#39;, &#39;region2_encoded_name&#39;

# ViewRegionInformation
list_regions &#39;user_info&#39;
</code></pre>
<p>balancer</p>
<h1 id="æŸ¥çœ‹è´Ÿè½½å‡è¡¡çŠ¶æ€">æŸ¥çœ‹è´Ÿè½½å‡è¡¡çŠ¶æ€</h1>
<p>balancer_enabled</p>
<pre><code>
# æ‰‹åŠ¨è§¦å‘ Minor Compaction 
compact &#39;user_info&#39;

# ViewCompressStatus
compaction_state &#39;user_info&#39;
</code></pre>
<h1 id="viewregionserverinformation">ViewRegionServerInformation</h1>
<p>list_regionservers</p>
<h1 id="view-tablestatisticsinformation">View
tableStatisticsInformation</h1>
<p>list_table_stats â€˜user_infoâ€™</p>
<pre><code>|:---|:---|:---|
| **æ•°æ®æ¨¡å‹** | åˆ—æ—æ¨¡å‹ | å…³ç³»æ¨¡å‹ |
| **ACID** | è¡Œçº§åŸå­æ€§ | å®Œæ•´ACID |
| **æ‰©å±•æ€§** | æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±• |
| **æŸ¥è¯¢è¯­è¨€** | NoSQL API | SQL |
| **é€‚ç”¨åœºæ™¯** | å¤§æ•°æ®è¯»å†™ | å¤æ‚äº‹åŠ¡ |

## # 2. æ•°æ®å€¾æ–œé—®é¢˜

* *é—®é¢˜**: Region çƒ­ç‚¹ï¼ŒæŸäº›Regionè®¿é—®é‡è¿‡å¤§

* *è§£å†³æ–¹æ¡ˆ**:
1. **Row Keyè®¾è®¡**: é¿å…å•è°ƒé€’å¢ï¼Œä½¿ç”¨æ•£åˆ—å‰ç¼€
2. **é¢„åˆ†åŒº**: åˆ›å»ºè¡¨æ—¶é¢„å…ˆåˆ†åŒº
3. **è´Ÿè½½å‡è¡¡**: å®šæœŸæ‰§è¡Œbalanceæ“ä½œ

```java
// é¢„PartitionExample
byte[][] splits = new byte[10][];
for (int i = 0; i &lt; 10; i++) {
splits[i] = Bytes.toBytes(String.format(&quot;%02d&quot;, i));
}
admin.createTable(tableDesc, splits);
</code></pre>
<ol start="2" type="1">
<li><strong>Block Cache</strong>: ç¼“å­˜çƒ­ç‚¹æ•°æ®</li>
<li><strong>å‹ç¼©</strong>: å‡å°‘å­˜å‚¨ç©ºé—´å’ŒIO</li>
<li><strong>é¢„è¯»</strong>: è®¾ç½®åˆç†çš„æ‰«æç¼“å­˜</li>
</ol>
<div class="sourceCode" id="cb531"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ConfigBloom Filter</span></span>
<span id="cb531-2"><a href="#cb531-2" aria-hidden="true" tabindex="-1"></a>HColumnDescriptor family <span class="op">=</span> <span class="kw">new</span> <span class="fu">HColumnDescriptor</span><span class="op">(</span><span class="st">&quot;data&quot;</span><span class="op">);</span></span>
<span id="cb531-3"><a href="#cb531-3" aria-hidden="true" tabindex="-1"></a>family<span class="op">.</span><span class="fu">setBloomFilterType</span><span class="op">(</span>BloomType<span class="op">.</span><span class="fu">ROW</span><span class="op">);</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>WAL</strong>: æ ¹æ®éœ€è¦å…³é—­WAL</li>
<li><strong>MemStore</strong>: è°ƒæ•´å†…å­˜å¤§å°</li>
<li><strong>å‹ç¼©</strong>: å¼‚æ­¥å‹ç¼©</li>
</ol>
<div class="sourceCode" id="cb532"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="co">// å…³é—­WALï¼ˆDataSecurityæ€§é™ä½ï¼‰</span></span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a>put<span class="op">.</span><span class="fu">setDurability</span><span class="op">(</span>Durability<span class="op">.</span><span class="fu">SKIP_WAL</span><span class="op">);</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>Regionè¿ç§»</strong>: è‡ªåŠ¨è¿ç§»æ•…éšœèŠ‚ç‚¹çš„Region</li>
<li><strong>ZooKeeper</strong>: ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œåè°ƒæ•…éšœæ¢å¤</li>
<li><strong>æ•°æ®å‰¯æœ¬</strong>: ä¾èµ–HDFSçš„æ•°æ®å‰¯æœ¬æœºåˆ¶</li>
</ol>
<h2 id="çƒ­ç‚¹é—®é¢˜è¯Šæ–­"># 6. çƒ­ç‚¹é—®é¢˜è¯Šæ–­</h2>
<div class="sourceCode" id="cb533"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ViewRegionåˆ†å¸ƒ</span></span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="ex">list_regions</span> <span class="st">&#39;table_name&#39;</span></span>
<span id="cb533-3"><a href="#cb533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-4"><a href="#cb533-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ViewRegionServerè´Ÿè½½</span></span>
<span id="cb533-5"><a href="#cb533-5" aria-hidden="true" tabindex="-1"></a><span class="ex">status</span> <span class="st">&#39;detailed&#39;</span></span>
<span id="cb533-6"><a href="#cb533-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-7"><a href="#cb533-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Analysisè®¿é—®æ¨¡å¼</span></span>
<span id="cb533-8"><a href="#cb533-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-9"><a href="#cb533-9" aria-hidden="true" tabindex="-1"></a><span class="co"># é€šè¿‡æ—¥å¿—åˆ†æçƒ­ç‚¹ Row Key</span></span>
<span id="cb533-10"><a href="#cb533-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-11"><a href="#cb533-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Re-è®¾è®¡Row Key</span></span>
<span id="cb533-12"><a href="#cb533-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-13"><a href="#cb533-13" aria-hidden="true" tabindex="-1"></a><span class="co"># æ·»åŠ æ•£åˆ—å‰ç¼€æˆ–ä½¿ç”¨åå‘æ—¶é—´æˆ³</span></span></code></pre></div>
<!-- 04-Reference/Engineering/Data-Analysis/hive.md -->
<h1 id="hive-æ•°æ®ä»“åº“">Hive æ•°æ®ä»“åº“</h1>
<p>Apache Hive æ˜¯åŸºäº Hadoop
çš„æ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºæ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç±» SQL
æŸ¥è¯¢åŠŸèƒ½ã€‚ <strong><em> ## ç›®å½• 1. <a href="#hive-æ¶æ„"><strong>Hive
æ¶æ„</strong></a> 2. <a
href="#æ•°æ®ç±»å‹ä¸å­˜å‚¨æ ¼å¼"><strong>æ•°æ®ç±»å‹ä¸å­˜å‚¨æ ¼å¼</strong></a> 3. <a
href="#ddl-æ“ä½œ"><strong>DDL æ“ä½œ</strong></a> 4. <a
href="#dml-æ“ä½œ"><strong>DML æ“ä½œ</strong></a> 5. <a
href="#åˆ†åŒºä¸åˆ†æ¡¶"><strong>åˆ†åŒºä¸åˆ†æ¡¶</strong></a> 6. <a
href="#å‡½æ•°ä¸udf"><strong>å‡½æ•°ä¸UDF</strong></a> 7. <a
href="#æ€§èƒ½ä¼˜åŒ–"><strong>æ€§èƒ½ä¼˜åŒ–</strong></a> 8. <a
href="#çŸ¥è¯†è¦ç‚¹"><strong>çŸ¥è¯†è¦ç‚¹</strong></a> </em></strong> ## Hive
æ¶æ„</p>
<h2 id="æ ¸å¿ƒç»„ä»¶"># æ ¸å¿ƒç»„ä»¶</h2>
<pre><code>Metastore (Metadata storage)
â†“
HDFS (Data storage) + MapReduce/Tez/Spark (Compute engine)
</code></pre>
<div class="line-block"><strong>Driver</strong> |
è§£æSQLã€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€åè°ƒæ‰§è¡Œ |<br />
<strong>Execution Engine</strong> | æ‰§è¡Œå¼•æ“ï¼ˆMapReduce/Tez/Sparkï¼‰
|</div>
<h2 id="å·¥ä½œæµç¨‹"># å·¥ä½œæµç¨‹</h2>
<ol type="1">
<li><strong>SQLè§£æ</strong>: è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ è¯­ä¹‰åˆ†æ</li>
<li><strong>é€»è¾‘è®¡åˆ’</strong>: ç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’</li>
<li><strong>ç‰©ç†è®¡åˆ’</strong>: è½¬æ¢ä¸ºMapReduce/Tez/Sparkä»»åŠ¡</li>
<li><strong>æ‰§è¡Œ</strong>: æäº¤åˆ° Hadoop é›†ç¾¤æ‰§è¡Œ ___ ##
æ•°æ®ç±»å‹ä¸å­˜å‚¨æ ¼å¼</li>
</ol>
<h2 id="åŸºæœ¬æ•°æ®ç±»å‹"># åŸºæœ¬æ•°æ®ç±»å‹</h2>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç±»å‹</th>
<th style="text-align: left;">æè¿°</th>
<th style="text-align: left;">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>TINYINT</code></td>
<td style="text-align: left;">1å­—èŠ‚æ•´æ•°</td>
<td style="text-align: left;">-128 åˆ° 127</td>
</tr>
<tr>
<td style="text-align: left;"><code>SMALLINT</code></td>
<td style="text-align: left;">2å­—èŠ‚æ•´æ•°</td>
<td style="text-align: left;">-32,768 åˆ° 32,767</td>
</tr>
<tr>
<td style="text-align: left;"><code>INT</code></td>
<td style="text-align: left;">4å­—èŠ‚æ•´æ•°</td>
<td style="text-align: left;">-2,147,483,648 åˆ° 2,147,483,647</td>
</tr>
<tr>
<td style="text-align: left;"><code>BIGINT</code></td>
<td style="text-align: left;">8å­—èŠ‚æ•´æ•°</td>
<td style="text-align: left;">-9,223,372,036,854,775,808 åˆ°
9,223,372,036,854,775,807</td>
</tr>
<tr>
<td style="text-align: left;"><code>FLOAT</code></td>
<td style="text-align: left;">4å­—èŠ‚æµ®ç‚¹æ•°</td>
<td style="text-align: left;">3.14159</td>
</tr>
<tr>
<td style="text-align: left;"><code>DOUBLE</code></td>
<td style="text-align: left;">8å­—èŠ‚æµ®ç‚¹æ•°</td>
<td style="text-align: left;">3.141592653589793</td>
</tr>
<tr>
<td style="text-align: left;"><code>STRING</code></td>
<td style="text-align: left;">å­—ç¬¦ä¸²</td>
<td style="text-align: left;">â€˜Hello Worldâ€™</td>
</tr>
<tr>
<td style="text-align: left;"><code>BOOLEAN</code></td>
<td style="text-align: left;">å¸ƒå°”å€¼</td>
<td style="text-align: left;">TRUE/FALSE</td>
</tr>
<tr>
<td style="text-align: left;"><code>TIMESTAMP</code></td>
<td style="text-align: left;">æ—¶é—´æˆ³</td>
<td style="text-align: left;">â€˜2023-01-01 12:00:00â€™</td>
</tr>
<tr>
<td style="text-align: left;"><code>DATE</code></td>
<td style="text-align: left;">æ—¥æœŸ</td>
<td style="text-align: left;">â€˜2023-01-01â€™</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚æ•°æ®ç±»å‹"># å¤æ‚æ•°æ®ç±»å‹</h2>
<div class="sourceCode" id="cb535"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> <span class="dt">Array</span></span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ARRAY</span><span class="op">&lt;</span>data_type<span class="op">&gt;</span></span>
<span id="cb535-3"><a href="#cb535-3" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> ç¤ºä¾‹ï¼šARRAY<span class="op">&lt;</span>STRING<span class="op">&gt;</span></span>
<span id="cb535-4"><a href="#cb535-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-5"><a href="#cb535-5" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> Map</span>
<span id="cb535-6"><a href="#cb535-6" aria-hidden="true" tabindex="-1"></a>MAP<span class="op">&lt;</span>primitive_type, data_type<span class="op">&gt;</span></span>
<span id="cb535-7"><a href="#cb535-7" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> ç¤ºä¾‹ï¼šMAP<span class="op">&lt;</span>STRING, <span class="dt">INT</span><span class="op">&gt;</span></span>
<span id="cb535-8"><a href="#cb535-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-9"><a href="#cb535-9" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> ç»“æ„ä½“</span>
<span id="cb535-10"><a href="#cb535-10" aria-hidden="true" tabindex="-1"></a>STRUCT<span class="op">&lt;</span>col_name<span class="ch">:data_type</span> [<span class="kw">COMMENT</span> col_comment], <span class="op">..</span>.<span class="op">&gt;</span></span>
<span id="cb535-11"><a href="#cb535-11" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> ç¤ºä¾‹ï¼šSTRUCT<span class="op">&lt;</span>name<span class="ch">:STRING</span>, age<span class="ch">:INT</span><span class="op">&gt;</span></span>
<span id="cb535-12"><a href="#cb535-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-13"><a href="#cb535-13" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> è”åˆä½“</span>
<span id="cb535-14"><a href="#cb535-14" aria-hidden="true" tabindex="-1"></a>UNIONTYPE<span class="op">&lt;</span>data_type, data_type, <span class="op">..</span>.<span class="op">&gt;</span></span></code></pre></div>
<div class="line-block"><strong>SequenceFile</strong> | ä¸­ | ä¸­ | ä¸­ |
ä¸­é—´æ•°æ® |<br />
<strong>RCFile</strong> | é«˜ | ä¸­ | ä½ | åˆ—å¼åˆ†æ |<br />
<strong>ORC</strong> | å¾ˆé«˜ | å¾ˆé«˜ | ä½ | OLAPåˆ†æ |<br />
<strong>Parquet</strong> | å¾ˆé«˜ | å¾ˆé«˜ | ä½ | è·¨å¹³å°åˆ†æ |</div>
<hr />
<h2 id="ddl-æ“ä½œ">DDL æ“ä½œ</h2>
<h2 id="æ•°æ®åº“æ“ä½œ"># æ•°æ®åº“æ“ä½œ</h2>
<div class="sourceCode" id="cb536"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> åˆ›å»ºæ•°æ®åº“</span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> mydb</span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMENT</span> <span class="st">&#39;My database&#39;</span></span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>LOCATION <span class="st">&#39;/user/hive/warehouse/mydb.db&#39;</span>;</span>
<span id="cb536-5"><a href="#cb536-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-6"><a href="#cb536-6" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> ä½¿ç”¨æ•°æ®åº“</span>
<span id="cb536-7"><a href="#cb536-7" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> mydb;</span>
<span id="cb536-8"><a href="#cb536-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-9"><a href="#cb536-9" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> æ˜¾ç¤ºæ•°æ®åº“</span>
<span id="cb536-10"><a href="#cb536-10" aria-hidden="true" tabindex="-1"></a>SHOW DATABASES;</span>
<span id="cb536-11"><a href="#cb536-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-12"><a href="#cb536-12" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> åˆ é™¤æ•°æ®åº“</span>
<span id="cb536-13"><a href="#cb536-13" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">DATABASE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> mydb <span class="kw">CASCADE</span>;</span></code></pre></div>
<p>id INT, name STRING, salary DOUBLE, department STRING ) STORED AS ORC
TBLPROPERTIES (â€˜orc.compressâ€™=â€˜SNAPPYâ€™);</p>
<pre><code>name STRING,
salary DOUBLE,
department STRING
)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY &#39;,&#39;
STORED AS TEXTFILE
LOCATION &#39;/data/employee/&#39;;
</code></pre>
<p>name STRING, salary DOUBLE ) PARTITIONED BY (department STRING, year
INT) STORED AS ORC;</p>
<pre><code>
- - ä¿®æ”¹åˆ—
ALTER TABLE employee CHANGE salary salary DECIMAL(10,2);

- - æ·»åŠ åˆ†åŒº
ALTER TABLE partitioned_employee ADD PARTITION (department=&#39;IT&#39;, year=2023);

- - åˆ é™¤åˆ†åŒº
ALTER TABLE partitioned_employee DROP PARTITION (department=&#39;IT&#39;, year=2023);

- - é‡å‘½åè¡¨
ALTER TABLE employee RENAME TO emp;
</code></pre>
<ul>
<li><ul>
<li>æ’å…¥æ•°æ® INSERT INTO employee VALUES (1, â€˜Johnâ€™, 5000.0, â€˜ITâ€™);</li>
</ul></li>
<li><ul>
<li>ä»æŸ¥è¯¢æ’å…¥ INSERT INTO employee SELECT id, name, salary, department
FROM temp_employee;</li>
</ul></li>
<li><ul>
<li>è¦†ç›–æ’å…¥ INSERT OVERWRITE TABLE employee SELECT * FROM
temp_employee;</li>
</ul></li>
<li><ul>
<li>åˆ†åŒºæ’å…¥ INSERT INTO partitioned_employee PARTITION(department=â€˜ITâ€™,
year=2023) SELECT id, name, salary FROM temp_employee;</li>
</ul></li>
<li><ul>
<li>åŠ¨æ€åˆ†åŒºæ’å…¥ SET hive.exec.dynamic.partition=true; SET
hive.exec.dynamic.partition.mode=nonstrict;</li>
</ul></li>
</ul>
<p>INSERT INTO partitioned_employee PARTITION(department, year) SELECT
id, name, salary, department, year FROM temp_employee;</p>
<pre><code>
- - èšåˆæŸ¥è¯¢
SELECT department, AVG(salary) as avg_salary
FROM employee
GROUP BY department
HAVING AVG(salary) &gt; 6000;

- - è¿æ¥æŸ¥è¯¢
SELECT e.name, d.dept_name
FROM employee e
JOIN department d ON e.department = d.dept_id;

- - çª—å£å‡½æ•°
SELECT name, salary,
ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) as rank
FROM employee;
</code></pre>
<div class="sourceCode" id="cb540"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> é™æ€åˆ†åŒº</span>
<span id="cb540-2"><a href="#cb540-2" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> partitioned_employee <span class="kw">PARTITION</span>(department<span class="op">=</span><span class="st">&#39;IT&#39;</span>, <span class="dt">year</span><span class="op">=</span><span class="dv">2023</span>)</span>
<span id="cb540-3"><a href="#cb540-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, name, salary <span class="kw">FROM</span> source_table;</span>
<span id="cb540-4"><a href="#cb540-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-5"><a href="#cb540-5" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> åŠ¨æ€åˆ†åŒº</span>
<span id="cb540-6"><a href="#cb540-6" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> partitioned_employee <span class="kw">PARTITION</span>(department, <span class="dt">year</span>)</span>
<span id="cb540-7"><a href="#cb540-7" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, name, salary, department, <span class="dt">year</span> <span class="kw">FROM</span> source_table;</span>
<span id="cb540-8"><a href="#cb540-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-9"><a href="#cb540-9" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">-</span> æŸ¥è¯¢ç‰¹å®šåˆ†åŒº</span>
<span id="cb540-10"><a href="#cb540-10" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> partitioned_employee</span>
<span id="cb540-11"><a href="#cb540-11" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> department<span class="op">=</span><span class="st">&#39;IT&#39;</span> <span class="kw">AND</span> <span class="dt">year</span><span class="op">=</span><span class="dv">2023</span>;</span></code></pre></div>
<p>CREATE TABLE bucketed_employee ( id INT, name STRING, salary DOUBLE,
department STRING ) CLUSTERED BY (id) INTO 4 BUCKETS STORED AS ORC;</p>
<ul>
<li><ul>
<li>å¯ç”¨åˆ†æ¡¶ SET hive.enforce.bucketing=true;</li>
</ul></li>
<li><ul>
<li>æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨åˆ†æ¡¶ï¼‰ INSERT INTO bucketed_employee SELECT * FROM
employee;</li>
</ul></li>
</ul>
<pre><code>
```sql
- - å­—ç¬¦ä¸²æ“ä½œ
SELECT
CONCAT(first_name, &#39; &#39;, last_name) as full_name,
UPPER(name) as upper_name,
LENGTH(name) as name_length,
SUBSTR(name, 1, 3) as name_prefix
FROM employee;
</code></pre>
<p>FROM_UNIXTIME(UNIX_TIMESTAMP()) as current_time, YEAR(hire_date) as
hire_year, DATEDIFF(CURRENT_DATE, hire_date) as days_since_hire FROM
employee;</p>
<pre><code>COUNT(*) as total_count,
SUM(salary) as total_salary,
AVG(salary) as avg_salary,
MAX(salary) as max_salary,
MIN(salary) as min_salary,
STDDEV(salary) as salary_stddev
FROM employee;
</code></pre>
<p>public String evaluate(String input) { if (input == null) return
null; return input.toUpperCase(); } }</p>
<pre><code>
- - ä½¿ç”¨ UDF
SELECT my_upper(name) FROM employee;
</code></pre>
<ul>
<li><ul>
<li>é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ ¼å¼ CREATE TABLE optimized_table ( col1 STRING, col2
INT ) STORED AS ORC TBLPROPERTIES ( â€˜orc.compressâ€™=â€˜SNAPPYâ€™,
â€˜orc.create.indexâ€™=â€˜trueâ€™ );</li>
</ul></li>
</ul>
<pre><code>SELECT * FROM partitioned_table
WHERE partition_col = &#39;value&#39;;

- - é¿å…ï¼šå…¨è¡¨æ‰«æ
SELECT * FROM partitioned_table
WHERE non_partition_col = &#39;value&#39;;
</code></pre>
<ul>
<li><ul>
<li>é¿å…ï¼šSELECT <em> SELECT </em> FROM employee;</li>
</ul></li>
</ul>
<pre><code>FROM employee e
JOIN department d ON e.dept_id = d.id
WHERE e.salary &gt; 5000;
</code></pre>
<ul>
<li><ul>
<li>å¯ç”¨ä»£ä»·ä¼˜åŒ–å™¨ SET hive.cbo.enable=true;</li>
</ul></li>
<li><ul>
<li>è®¾ç½®åˆç†çš„ MapReduce å‚æ•° SET mapreduce.job.reduces=10; SET
hive.exec.reducers.bytes.per.reducer=1000000000;</li>
</ul></li>
<li><ul>
<li>å¯ç”¨å¹¶è¡Œæ‰§è¡Œ SET hive.exec.parallel=true; SET
hive.exec.parallel.thread.number=8;</li>
</ul></li>
</ul>
<pre><code>|:---|:---|:---|
| **æ•°æ®é‡** | PBçº§ | GB-TBçº§ |
| **å»¶è¿Ÿ** | é«˜ï¼ˆç§’-åˆ†é’Ÿï¼‰ | ä½ï¼ˆæ¯«ç§’ï¼‰ |
| **ACID** | æœ‰é™æ”¯æŒ | å®Œå…¨æ”¯æŒ |
| **ç´¢å¼•** | æœ‰é™ | ä¸°å¯Œ |
| **æ‰©å±•æ€§** | æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±• |
| **é€‚ç”¨åœºæ™¯** | ç¦»çº¿åˆ†æ | åœ¨çº¿äº‹åŠ¡ |

## # 2. å†…éƒ¨è¡¨ vs å¤–éƒ¨è¡¨

| ç‰¹æ€§ | å†…éƒ¨è¡¨ | å¤–éƒ¨è¡¨ |
|:---|:---|:---|
| **æ•°æ®ç®¡ç†** | Hiveç®¡ç† | ç”¨æˆ·ç®¡ç† |
| **åˆ é™¤è¡¨** | åˆ é™¤å…ƒæ•°æ®å’Œæ•°æ® | åªåˆ é™¤å…ƒæ•°æ® |
| **æ•°æ®ä½ç½®** | Hiveä»“åº“ç›®å½• | ç”¨æˆ·æŒ‡å®šä½ç½® |
| **ä½¿ç”¨åœºæ™¯** | ä¸´æ—¶æ•°æ®ã€ä¸­é—´ç»“æœ | å…±äº«æ•°æ®ã€å¤–éƒ¨æ•°æ®æº |

## # 3. æ•°æ®å€¾æ–œè§£å†³æ–¹æ¡ˆ

```sql
- - 1. å¢åŠ  Reduce ä»»åŠ¡æ•°
SET mapreduce.job.reduces=100;

- - 2. å¯ç”¨è´Ÿè½½å‡è¡¡
SET hive.groupby.skewindata=true;

- - 3. ä½¿ç”¨éšæœºå‰ç¼€
SELECT /*+ MAPJOIN(b) */ *
FROM (
SELECT CONCAT(CAST(RAND() * 100 AS INT), &#39;_&#39;, key) as new_key, value
FROM skewed_table
) a
JOIN small_table b ON a.key = b.key;
</code></pre>
<ul>
<li><ul>
<li><ol type="1">
<li>åˆå¹¶å°æ–‡ä»¶ SET hive.merge.mapfiles=true; SET
hive.merge.mapredfiles=true; SET
hive.merge.size.per.task=256000000;</li>
</ol></li>
</ul></li>
<li><ul>
<li><ol start="2" type="1">
<li>ä½¿ç”¨ Concatenate ALTER TABLE table_name CONCATENATE;</li>
</ol></li>
</ul></li>
<li><ul>
<li><ol start="3" type="1">
<li>é‡æ–°ç»„ç»‡æ•°æ® INSERT OVERWRITE TABLE new_table SELECT * FROM
old_table;</li>
</ol></li>
</ul></li>
</ul>
<pre><code>4. **åˆ†æ¡¶**: å¯¹å¤§è¡¨ä½¿ç”¨åˆ†æ¡¶
5. **ç´¢å¼•**: åˆ›å»ºé€‚å½“çš„ç´¢å¼•
6. **ç¼“å­˜**: ç¼“å­˜çƒ­ç‚¹æ•°æ®
7. **å¹¶è¡Œåº¦**: è°ƒæ•´Map/Reduceä»»åŠ¡æ•°
8. **èµ„æº**: åˆç†åˆ†é…å†…å­˜å’ŒCPU</code></pre>
<!-- 04-Reference/Engineering/Data-Analysis/spark.md -->
<h1 id="apache-spark-å¤§æ•°æ®å¤„ç†">Apache Spark å¤§æ•°æ®å¤„ç†</h1>
<p>Apache Spark
æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å¤§æ•°æ®å¤„ç†å¼•æ“ï¼Œæ”¯æŒæ‰¹å¤„ç†ã€æµå¤„ç†ã€æœºå™¨å­¦ä¹ å’Œå›¾è®¡ç®—ã€‚
<strong><em> ## ç›®å½• 1. <a href="#spark-æ¶æ„"><strong>Spark
æ¶æ„</strong></a> 2. <a href="#rdd-ç¼–ç¨‹"><strong>RDD ç¼–ç¨‹</strong></a>
3. <a href="#dataframe--dataset"><strong>DataFrame &amp;
Dataset</strong></a> 4. <a href="#spark-sql"><strong>Spark
SQL</strong></a> 5. <a href="#spark-streaming"><strong>Spark
Streaming</strong></a> 6. <a
href="#æ€§èƒ½ä¼˜åŒ–"><strong>æ€§èƒ½ä¼˜åŒ–</strong></a> 7. <a
href="#çŸ¥è¯†è¦ç‚¹"><strong>çŸ¥è¯†è¦ç‚¹</strong></a> </em></strong> ## Spark
æ¶æ„</p>
<h2 id="é›†ç¾¤æ¶æ„"># é›†ç¾¤æ¶æ„</h2>
<pre><code>Cluster Manager (YARN/Mesos/Standalone)
â†“
Worker Node1 Worker Node2 Worker Node3
â”œâ”€â”€ Executor1 â”œâ”€â”€ Executor1 â”œâ”€â”€ Executor1
â”‚ â”œâ”€â”€ Task1 â”‚ â”œâ”€â”€ Task1 â”‚ â”œâ”€â”€ Task1
â”‚ â””â”€â”€ Task2 â”‚ â””â”€â”€ Task2 â”‚ â””â”€â”€ Task2
â””â”€â”€ Cache â””â”€â”€ Cache â””â”€â”€ Cache
</code></pre>
<div class="line-block"><strong>SparkContext</strong> |
Sparkç¨‹åºå…¥å£ï¼Œåè°ƒé›†ç¾¤èµ„æº |<br />
<strong>Cluster Manager</strong> | é›†ç¾¤èµ„æºç®¡ç†å™¨ |<br />
<strong>Worker Node</strong> | é›†ç¾¤ä¸­çš„å·¥ä½œèŠ‚ç‚¹ |<br />
<strong>Executor</strong> | è¿è¡Œåœ¨Workerä¸Šçš„è¿›ç¨‹ï¼Œæ‰§è¡ŒTask |<br />
<strong>Task</strong> | æœ€å°çš„å·¥ä½œå•å…ƒ |</div>
<h2 id="è¿è¡Œæµç¨‹"># è¿è¡Œæµç¨‹</h2>
<ol type="1">
<li><strong>Driveråˆ›å»ºSparkContext</strong></li>
<li><strong>èµ„æºç”³è¯·</strong>: å‘Cluster Managerç”³è¯·èµ„æº</li>
<li><strong>ä»»åŠ¡è°ƒåº¦</strong>: DAG Schedulerå°†Jobåˆ†è§£ä¸ºStageå’ŒTask</li>
<li><strong>ä»»åŠ¡åˆ†å‘</strong>: Task Schedulerå°†Taskåˆ†å‘åˆ°Executor</li>
<li><strong>ä»»åŠ¡æ‰§è¡Œ</strong>: Executoræ‰§è¡ŒTaskå¹¶è¿”å›ç»“æœ ___ ## RDD
ç¼–ç¨‹</li>
</ol>
<h2 id="rddåŸºæœ¬æ¦‚å¿µ"># RDDåŸºæœ¬æ¦‚å¿µ</h2>
<ul>
<li>*RDD (Resilient Distributed Dataset)**: å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†</li>
</ul>
<h3 id="ç‰¹æ€§"># ç‰¹æ€§</h3>
<ul>
<li><p><strong>ä¸å¯å˜æ€§</strong>: RDDä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹</p></li>
<li><p><strong>åˆ†åŒºæ€§</strong>: æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªåˆ†åŒº</p></li>
<li><p><strong>å®¹é”™æ€§</strong>: é€šè¿‡è¡€ç»Ÿ(Lineage)æ¢å¤ä¸¢å¤±æ•°æ®</p></li>
<li><p><strong>æƒ°æ€§æ±‚å€¼</strong>: åªæœ‰åœ¨Actionæ“ä½œæ—¶æ‰ä¼šæ‰§è¡Œ</p></li>
</ul>
<h2 id="rddåˆ›å»º"># RDDåˆ›å»º</h2>
<div class="sourceCode" id="cb549"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> org<span class="op">.</span>apache<span class="op">.</span>spark<span class="op">.{</span>SparkConf<span class="op">,</span> SparkContext<span class="op">}</span></span>
<span id="cb549-2"><a href="#cb549-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-3"><a href="#cb549-3" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> conf <span class="op">=</span> <span class="kw">new</span> <span class="fu">SparkConf</span><span class="op">().</span><span class="fu">setAppName</span><span class="op">(</span><span class="st">&quot;SparkExample&quot;</span><span class="op">).</span><span class="fu">setMaster</span><span class="op">(</span><span class="st">&quot;local[*]&quot;</span><span class="op">)</span></span>
<span id="cb549-4"><a href="#cb549-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> sc <span class="op">=</span> <span class="kw">new</span> <span class="fu">SparkContext</span><span class="op">(</span>conf<span class="op">)</span></span>
<span id="cb549-5"><a href="#cb549-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-6"><a href="#cb549-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. ä»é›†åˆåˆ›å»º</span></span>
<span id="cb549-7"><a href="#cb549-7" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> rdd1 <span class="op">=</span> sc<span class="op">.</span><span class="fu">parallelize</span><span class="op">(</span><span class="ex">List</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">))</span></span>
<span id="cb549-8"><a href="#cb549-8" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> rdd2 <span class="op">=</span> sc<span class="op">.</span><span class="fu">makeRDD</span><span class="op">(</span><span class="ex">Array</span><span class="op">(</span><span class="st">&quot;a&quot;</span><span class="op">,</span> <span class="st">&quot;b&quot;</span><span class="op">,</span> <span class="st">&quot;c&quot;</span><span class="op">))</span></span>
<span id="cb549-9"><a href="#cb549-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-10"><a href="#cb549-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. ä»å¤–éƒ¨å­˜å‚¨åˆ›å»º</span></span>
<span id="cb549-11"><a href="#cb549-11" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> rdd3 <span class="op">=</span> sc<span class="op">.</span><span class="fu">textFile</span><span class="op">(</span><span class="st">&quot;hdfs://path/to/file&quot;</span><span class="op">)</span></span>
<span id="cb549-12"><a href="#cb549-12" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> rdd4 <span class="op">=</span> sc<span class="op">.</span><span class="fu">wholeTextFiles</span><span class="op">(</span><span class="st">&quot;hdfs://path/to/directory&quot;</span><span class="op">)</span></span>
<span id="cb549-13"><a href="#cb549-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-14"><a href="#cb549-14" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. ä»å…¶ä»– RDD åˆ›å»º</span></span>
<span id="cb549-15"><a href="#cb549-15" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> rdd5 <span class="op">=</span> rdd1<span class="op">.</span><span class="fu">map</span><span class="op">(</span>_ <span class="op">*</span> <span class="dv">2</span><span class="op">)</span></span></code></pre></div>
<p>val mapped = data.map(_ * 2)</p>
<p>// 2. filter - Filter val filtered = data.filter(_ % 2 == 0)</p>
<p>// 3. flatMap - ä¸€å¯¹å¤šè½¬æ¢ val words = sc.parallelize(List(â€œhello
worldâ€, â€œspark scalaâ€)) val flatMapped = words.flatMap(_.split(â€ â€œ))</p>
<p>// 4. distinct - å»é‡ val distincted = data.distinct()</p>
<p>// 5. union - åˆå¹¶ val rdd1 = sc.parallelize(List(1, 2, 3)) val rdd2
= sc.parallelize(List(4, 5, 6)) val unioned = rdd1.union(rdd2)</p>
<p>// 6. intersection - äº¤é›† val intersected =
rdd1.intersection(rdd2)</p>
<p>// 7. groupByKey - æŒ‰é”®åˆ†ç»„ val pairs = sc.parallelize(List((â€œaâ€, 1),
(â€œbâ€, 2), (â€œaâ€, 3))) val grouped = pairs.groupByKey()</p>
<p>// 8. reduceByKey - æŒ‰é”®èšåˆ val reduced = pairs.reduceByKey(_ +
_)</p>
<p>// 9. sortByKey - æŒ‰é”®æ’åº val sorted = pairs.sortByKey()</p>
<p>// 10. join - è¿æ¥ val rdd3 = sc.parallelize(List((â€œaâ€, â€œxâ€), (â€œbâ€,
â€œyâ€))) val joined = pairs.join(rdd3)</p>
<pre><code>val collected = data.collect()

// 2. count - è®¡ç®—å…ƒç´ æ•°
val count = data.count()

// 3. first - è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
val first = data.first()

// 4. take - è·å–å‰ n ä¸ªå…ƒç´ 
val taken = data.take(3)

// 5. reduce - èšåˆæ‰€æœ‰å…ƒç´ 
val sum = data.reduce(_ + _)

// 6. fold - å¸¦åˆå§‹å€¼çš„èšåˆ
val folded = data.fold(0)(_ + _)

// 7. aggregate - å¤æ‚èšåˆ
val (sum, count) = data.aggregate((0, 0))(
(acc, value) =&gt; (acc._1 + value, acc._2 + 1),
(acc1, acc2) =&gt; (acc1._1 + acc2._1, acc1._2 + acc2._2)
)

// 8. foreach - å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œæ“ä½œ
data.foreach(println)

// 9. saveAsTextFile - ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶
data.saveAsTextFile(&quot;hdfs://path/to/output&quot;)
</code></pre>
<div class="sourceCode" id="cb551"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb551-1"><a href="#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> org<span class="op">.</span>apache<span class="op">.</span>spark<span class="op">.</span>sql<span class="op">.{</span>SparkSession<span class="op">,</span> DataFrame<span class="op">}</span></span>
<span id="cb551-2"><a href="#cb551-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-3"><a href="#cb551-3" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> spark <span class="op">=</span> SparkSession<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb551-4"><a href="#cb551-4" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">appName</span><span class="op">(</span><span class="st">&quot;DataFrameExample&quot;</span><span class="op">)</span></span>
<span id="cb551-5"><a href="#cb551-5" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">master</span><span class="op">(</span><span class="st">&quot;local[*]&quot;</span><span class="op">)</span></span>
<span id="cb551-6"><a href="#cb551-6" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">getOrCreate</span><span class="op">()</span></span>
<span id="cb551-7"><a href="#cb551-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-8"><a href="#cb551-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> spark<span class="op">.</span>implicits<span class="op">.</span>_</span>
<span id="cb551-9"><a href="#cb551-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-10"><a href="#cb551-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. ä» RDD åˆ›å»º DataFrame</span></span>
<span id="cb551-11"><a href="#cb551-11" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">Person</span><span class="op">(</span>name<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> age<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> city<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span>
<span id="cb551-12"><a href="#cb551-12" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> peopleRDD <span class="op">=</span> spark<span class="op">.</span>sparkContext<span class="op">.</span><span class="fu">parallelize</span><span class="op">(</span><span class="ex">List</span><span class="op">(</span></span>
<span id="cb551-13"><a href="#cb551-13" aria-hidden="true" tabindex="-1"></a><span class="fu">Person</span><span class="op">(</span><span class="st">&quot;Alice&quot;</span><span class="op">,</span> <span class="dv">25</span><span class="op">,</span> <span class="st">&quot;NYC&quot;</span><span class="op">),</span></span>
<span id="cb551-14"><a href="#cb551-14" aria-hidden="true" tabindex="-1"></a><span class="fu">Person</span><span class="op">(</span><span class="st">&quot;Bob&quot;</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="st">&quot;LA&quot;</span><span class="op">),</span></span>
<span id="cb551-15"><a href="#cb551-15" aria-hidden="true" tabindex="-1"></a><span class="fu">Person</span><span class="op">(</span><span class="st">&quot;Charlie&quot;</span><span class="op">,</span> <span class="dv">35</span><span class="op">,</span> <span class="st">&quot;Chicago&quot;</span><span class="op">)</span></span>
<span id="cb551-16"><a href="#cb551-16" aria-hidden="true" tabindex="-1"></a><span class="op">))</span></span>
<span id="cb551-17"><a href="#cb551-17" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> peopleDF <span class="op">=</span> peopleRDD<span class="op">.</span><span class="fu">toDF</span><span class="op">()</span></span>
<span id="cb551-18"><a href="#cb551-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-19"><a href="#cb551-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. ä»æ–‡ä»¶åˆ›å»º DataFrame</span></span>
<span id="cb551-20"><a href="#cb551-20" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> df <span class="op">=</span> spark<span class="op">.</span>read</span>
<span id="cb551-21"><a href="#cb551-21" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">option</span><span class="op">(</span><span class="st">&quot;header&quot;</span><span class="op">,</span> <span class="st">&quot;true&quot;</span><span class="op">)</span></span>
<span id="cb551-22"><a href="#cb551-22" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">option</span><span class="op">(</span><span class="st">&quot;inferSchema&quot;</span><span class="op">,</span> <span class="st">&quot;true&quot;</span><span class="op">)</span></span>
<span id="cb551-23"><a href="#cb551-23" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">csv</span><span class="op">(</span><span class="st">&quot;path/to/file.csv&quot;</span><span class="op">)</span></span>
<span id="cb551-24"><a href="#cb551-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-25"><a href="#cb551-25" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. ä» JSON åˆ›å»º</span></span>
<span id="cb551-26"><a href="#cb551-26" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> jsonDF <span class="op">=</span> spark<span class="op">.</span>read<span class="op">.</span><span class="fu">json</span><span class="op">(</span><span class="st">&quot;path/to/file.json&quot;</span><span class="op">)</span></span></code></pre></div>
<p>df.show() df.describe().show()</p>
<p>// 2. é€‰æ‹©åˆ— df.select(â€œnameâ€, â€œageâ€).show() df.select($â€œnameâ€,
$â€œageâ€ + 1).show()</p>
<p>// 3. è¿‡æ»¤ df.filter($â€œageâ€ &gt; 25).show() df.where(â€œage &gt;
25â€).show()</p>
<p>// 4. åˆ†ç»„èšåˆ df.groupBy(â€œcityâ€).count().show()
df.groupBy(â€œcityâ€).agg(avg(â€œageâ€), max(â€œageâ€)).show()</p>
<p>// 5. æ’åº df.orderBy($â€œageâ€.desc).show() df.sort(â€œnameâ€).show()</p>
<p>// 6. Connect val df2 = spark.createDataFrame(List( (â€œNYCâ€, â€œNYâ€),
(â€œLAâ€, â€œCAâ€), (â€œChicagoâ€, â€œILâ€) )).toDF(â€œcityâ€, â€œstateâ€)</p>
<p>df.join(df2, â€œcityâ€).show()</p>
<p>// 7. çª—å£Function import org.apache.spark.sql.expressions.Window
import org.apache.spark.sql.functions._</p>
<p>val windowSpec = Window.partitionBy(â€œcityâ€).orderBy($â€œageâ€.desc)
df.withColumn(â€œrankâ€, row_number().over(windowSpec)).show()</p>
<pre><code>
val ds: Dataset[Person] = df.as[Person]

// ç±»å‹å®‰å…¨æ“ä½œ
val adults = ds.filter(_.age &gt;= 18)
val names = ds.map(_.name)

// ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
// ds.filter(_.salary &gt; 1000) // ç¼–è¯‘é”™è¯¯ï¼ŒPerson æ²¡æœ‰ salary å­—æ®µ
</code></pre>
<p>// æ³¨å†Œä¸´æ—¶è§†å›¾ df.createOrReplaceTempView(â€œpeopleâ€)</p>
<p>// SQL æŸ¥è¯¢ val result = spark.sql(â€œâ€œâ€ SELECT city, COUNT(*) as
count, AVG(age) as avg_age FROM people WHERE age &gt; 20 GROUP BY city
ORDER BY count DESC â€œâ€œâ€œ)</p>
<p>result.show()</p>
<p>// å¤æ‚æŸ¥è¯¢ val complexQuery = spark.sql(â€œâ€œâ€ SELECT name, age, city,
ROW_NUMBER() OVER (PARTITION BY city ORDER BY age DESC) as rank FROM
people â€œâ€œâ€œ)</p>
<pre><code>spark.catalog.listTables().show()

// ç¼“å­˜è¡¨
spark.catalog.cacheTable(&quot;people&quot;)
spark.catalog.uncacheTable(&quot;people&quot;)

// åˆ é™¤ä¸´æ—¶è§†å›¾
spark.catalog.dropTempView(&quot;people&quot;)
</code></pre>
<p>import org.apache.spark.streaming.{StreamingContext, Seconds}</p>
<p>val ssc = new StreamingContext(spark.sparkContext, Seconds(1))</p>
<p>// 1. ä» socket åˆ›å»ºæµ val lines = ssc.socketTextStream(â€œlocalhostâ€,
9999)</p>
<p>// 2. è½¬æ¢æ“ä½œ val words = lines.flatMap(<em>.split(â€ â€œ)) val pairs =
words.map(word =&gt; (word, 1)) val wordCounts = pairs.reduceByKey(</em>
+ _)</p>
<p>// 3. è¾“å‡ºæ“ä½œ wordCounts.print()</p>
<p>// å¯åŠ¨æµå¤„ç† ssc.start() ssc.awaitTermination()</p>
<pre><code>(a: Int, b: Int) =&gt; a + b, // reduce å‡½æ•°
(a: Int, b: Int) =&gt; a - b, // inverse reduce å‡½æ•°
Seconds(30), // çª—å£é•¿åº¦
Seconds(10) // æ»‘åŠ¨é—´éš”
)

// çŠ¶æ€æ›´æ–°
def updateFunction(newValues: Seq[Int], runningCount: Option[Int]): Option[Int] = {
val newCount = newValues.sum + runningCount.getOrElse(0)
Some(newCount)
}

val stateDstream = pairs.updateStateByKey[Int](updateFunction)
</code></pre>
<p>val df = spark .readStream .format(â€œsocketâ€) .option(â€œhostâ€,
â€œlocalhostâ€) .option(â€œportâ€, 9999) .load()</p>
<p>// å¤„ç†æµæ•°æ® val words = df.as[String].flatMap(_.split(â€ â€œ)) val
wordCounts = words.groupBy(â€valueâ€).count()</p>
<p>// è¾“å‡ºç»“æœ val query = wordCounts.writeStream
.outputMode(â€œcompleteâ€) .format(â€œconsoleâ€)
.trigger(Trigger.ProcessingTime(â€œ10 secondsâ€)) .start()</p>
<p>query.awaitTermination()</p>
<pre><code>import org.apache.spark.storage.StorageLevel

// 1. åŸºæœ¬Cache
val cachedRDD = rdd.cache() // MEMORY_ONLY
val persistedRDD = rdd.persist(StorageLevel.MEMORY_AND_DISK)

// 2. DataFrame ç¼“å­˜
df.cache()
df.persist(StorageLevel.MEMORY_AND_DISK_SER)

// 3. ä¸åŒå­˜å‚¨çº§åˆ«
StorageLevel.MEMORY_ONLY // ä»…å†…å­˜
StorageLevel.MEMORY_AND_DISK // å†…å­˜+ç£ç›˜
StorageLevel.MEMORY_ONLY_SER // å†…å­˜åºåˆ—åŒ–
StorageLevel.DISK_ONLY // ä»…ç£ç›˜
StorageLevel.MEMORY_AND_DISK_2 // å†…å­˜+ç£ç›˜ï¼Œ2å‰¯æœ¬
</code></pre>
<p>val coalesced = rdd.coalesce(2) // å‡å°‘åˆ†åŒº</p>
<p>// 2. è‡ªå®šä¹‰åˆ†åŒºå™¨ class CustomPartitioner(numPartitions: Int)
extends Partitioner { override def numPartitions: Int =
numPartitions</p>
<p>override def getPartition(key: Any): Int = { key.hashCode() %
numPartitions } }</p>
<p>val partitioned = pairs.partitionBy(new CustomPartitioner(4))</p>
<p>// 3. æ•°æ®æœ¬åœ°æ€§ val localData = sc.textFile(â€œhdfs://pathâ€,
minPartitions = 4)</p>
<pre><code>val result = rdd.map(x =&gt; x * broadcastVar.value.sum)

// 2. ç´¯åŠ å™¨
val accum = sc.longAccumulator(&quot;My Accumulator&quot;)
rdd.foreach(x =&gt; accum.add(x))
println(s&quot;Accumulator value: ${accum.value}&quot;)

// 3. è‡ªå®šä¹‰ç´¯åŠ å™¨
class VectorAccumulator extends AccumulatorV2[Vector, Vector] {
private var _sum = Vector.zeros(3)

override def isZero: Boolean = _sum == Vector.zeros(3)
override def copy(): VectorAccumulator = new VectorAccumulator
override def reset(): Unit = _sum = Vector.zeros(3)
override def add(v: Vector): Unit = _sum += v
override def merge(other: AccumulatorV2[Vector, Vector]): Unit = {
_sum += other.asInstanceOf[VectorAccumulator]._sum
}
override def value: Vector = _sum
}
</code></pre>
<p>// 2. å¯ç”¨ä»£ç ç”Ÿæˆ spark.conf.set(â€œspark.sql.codegen.wholeStageâ€,
â€œtrueâ€)</p>
<p>// 3. å¹¿æ’­ Join ä¼˜åŒ– spark.conf.set(â€œspark.sql.adaptive.enabledâ€,
â€œtrueâ€) spark.conf.set(â€œspark.sql.adaptive.coalescePartitions.enabledâ€,
â€œtrueâ€)</p>
<p>// 4. è°“è¯ä¸‹æ¨ val optimizedDF = df.filter($â€œageâ€ &gt; 18) // Filter
ä¸‹æ¨åˆ°æ•°æ®æº</p>
<pre><code>|:---|:---|:---|:---|
| **ç±»å‹å®‰å…¨** | ç¼–è¯‘æ—¶ | è¿è¡Œæ—¶ | ç¼–è¯‘æ—¶ |
| **æ€§èƒ½ä¼˜åŒ–** | æ—  | Catalystä¼˜åŒ–å™¨ | Catalystä¼˜åŒ–å™¨ |
| **APIé£æ ¼** | å‡½æ•°å¼ | å…³ç³»å‹ | ç±»å‹å®‰å…¨çš„å…³ç³»å‹ |
| **å†…å­˜ä½¿ç”¨** | Javaå¯¹è±¡ | äºŒè¿›åˆ¶æ ¼å¼ | äºŒè¿›åˆ¶æ ¼å¼ |
| **åºåˆ—åŒ–** | Javaåºåˆ—åŒ– | è‡ªå®šä¹‰ç¼–ç å™¨ | è‡ªå®šä¹‰ç¼–ç å™¨ |

## # 2. Sparkå†…å­˜ç®¡ç†

### å†…å­˜åˆ†é…
</code></pre>
<p>â”‚ â””â”€â”€ æ‰§è¡Œå†…å­˜ (Execution) Ã— 0.5 â””â”€â”€ ç”¨æˆ·å†…å­˜ (å‰©ä½™éƒ¨åˆ†)</p>
<pre><code>- -executor-memory 4g

# 2. å†…å­˜åˆ†é…æ¯”ä¾‹
- -conf spark.sql.execution.memory.fraction=0.6
- -conf spark.sql.execution.memory.storageFraction=0.5

# 3. åºåˆ—åŒ–
- -conf spark.serializer=org.apache.spark.serializer.KryoSerializer
</code></pre>
<h3 id="shuffle-ä¼˜åŒ–"># Shuffle ä¼˜åŒ–</h3>
<div class="sourceCode" id="cb559"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. é¢„åˆ†åŒº</span></span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> partitioned <span class="op">=</span> rdd<span class="op">.</span><span class="fu">partitionBy</span><span class="op">(</span><span class="kw">new</span> <span class="fu">HashPartitioner</span><span class="op">(</span><span class="dv">100</span><span class="op">))</span></span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. è°ƒæ•´å¹¶è¡Œåº¦</span></span>
<span id="cb559-5"><a href="#cb559-5" aria-hidden="true" tabindex="-1"></a>spark<span class="op">.</span>conf<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="st">&quot;spark.sql.shuffle.partitions&quot;</span><span class="op">,</span> <span class="st">&quot;400&quot;</span><span class="op">)</span></span>
<span id="cb559-6"><a href="#cb559-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-7"><a href="#cb559-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. å¯ç”¨å¤–éƒ¨æ’åº</span></span>
<span id="cb559-8"><a href="#cb559-8" aria-hidden="true" tabindex="-1"></a>spark<span class="op">.</span>conf<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="st">&quot;spark.sql.execution.useObjectHashAggregateExec&quot;</span><span class="op">,</span> <span class="st">&quot;false&quot;</span><span class="op">)</span></span></code></pre></div>
<p>val skewedRDD = sc.parallelize(List((â€œkey1â€, 1), (â€œkey1â€, 1),
/<em>å¾ˆå¤škey1</em>/, (â€œkey2â€, 1)))</p>
<p>// åŠ ç›å¤„ç† val saltedRDD = skewedRDD.map { case (key, value) =&gt;
val salt = Random.nextInt(10) (sâ€<span
class="math inline">${key}_$</span>saltâ€, value) }</p>
<p>val result = saltedRDD.reduceByKey(_ + <em>) .map { case (saltedKey,
value) =&gt; val originalKey = saltedKey.split(â€œ</em>â€)(0) (originalKey,
value) } .reduceByKey(_ + _)</p>
<pre><code>iter.toList.groupBy(_._1).map { case (key, values) =&gt;
(key, values.map(_._2).sum)
}.toIterator
}

// ç¬¬äºŒé˜¶æ®µï¼šå…¨å±€èšåˆ
val globalAgg = localAgg.reduceByKey(_ + _)
</code></pre>
<ul>
<li>-num-executors 10 â€“executor-cores 5 â€“executor-memory 2g</li>
</ul>
<h1 id="å†…å­˜å¯†é›†å‹">å†…å­˜å¯†é›†å‹</h1>
<ul>
<li>-num-executors 5 â€“executor-cores 2 â€“executor-memory 8g</li>
</ul>
<h1 id="å¹³è¡¡å‹">å¹³è¡¡å‹</h1>
<ul>
<li>-num-executors 15 â€“executor-cores 3 â€“executor-memory 4g</li>
</ul>
<pre><code>
// é¿å…
rdd.map(...).filter(...) // å…ˆè½¬æ¢å†è¿‡æ»¤

// å‡å°‘Shuffle
val broadcastVar = sc.broadcast(smallData)
largeRDD.map(x =&gt; x + broadcastVar.value) // ä½¿ç”¨å¹¿æ’­å˜é‡ä»£æ›¿ join
</code></pre>
<p>.mode(â€œoverwriteâ€) .option(â€œcompressionâ€, â€œsnappyâ€)
.parquet(â€œpath/to/outputâ€) // Parquet æ ¼å¼</p>
<p>// åˆ†åŒºå­˜å‚¨ df.write .partitionBy(â€œyearâ€, â€œmonthâ€)
.parquet(â€œpath/to/partitioned/outputâ€)</p>
<pre><code></code></pre>
<!-- 04-Reference/Foundations/android_components.md -->
<hr />
<h1 id="android-å››å¤§ç»„ä»¶">android å››å¤§ç»„ä»¶</h1>
<p>Android
çš„åº”ç”¨æ¡†æ¶æ ¸å¿ƒç”±å››ä¸ªåŸºæœ¬ç»„ä»¶æ„æˆã€‚æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œç³»ç»Ÿå’Œåº”ç”¨å¯ä»¥é€šè¿‡å®ƒè¿›å…¥ä½ çš„
Appã€‚ç†è§£è¿™å››ä¸ªç»„ä»¶çš„èŒè´£å’Œç”Ÿå‘½å‘¨æœŸæ˜¯è¿›è¡Œä»»ä½• Android
å¼€å‘æˆ–é€†å‘åˆ†æçš„åŸºç¡€ã€‚</p>
<hr />
<h2 id="æ´»åŠ¨-activity">1. æ´»åŠ¨ (Activity)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: Activity
æ˜¯ç”¨æˆ·ç•Œé¢çš„å•ä¸€å±å¹•ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå¯ä»¥è¿›è¡Œäº¤äº’çš„æ“ä½œç•Œé¢ã€‚ä¸€ä¸ª App
é€šå¸¸ç”±å¤šä¸ªç›¸äº’å…³è”çš„ Activity ç»„æˆã€‚</p></li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>UI æ‰¿è½½</strong>: è´Ÿè´£ç»˜åˆ¶ç”¨æˆ·ç•Œé¢ã€æ‰¿è½½ <code>View</code>
å’Œ <code>ViewGroup</code>ã€‚</li>
<li><strong>ç”¨æˆ·äº¤äº’</strong>: å“åº”ç”¨æˆ·çš„ç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥ç­‰äº‹ä»¶ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>:
ç®¡ç†ä»åˆ›å»ºåˆ°é”€æ¯çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä»¥å“åº”ç³»ç»ŸçŠ¶æ€çš„å˜åŒ–ï¼ˆå¦‚æ¥ç”µã€å±å¹•æ—‹è½¬ï¼‰ã€‚</li>
</ul></li>
<li><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>:</p>
<p>ä¸€ä¸ª Activity
å…·æœ‰æ¸…æ™°çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ï¼Œè¿™å¯¹äºé€†å‘åˆ†æè‡³å…³é‡è¦ï¼Œå› ä¸ºæ ¸å¿ƒé€»è¾‘ï¼ˆå¦‚æ•°æ®åŠ è½½ã€UI
æ›´æ–°ï¼‰å¸¸å¸¸åœ¨è¿™äº›æ–¹æ³•ä¸­è¢«è§¦å‘ã€‚</p>
<ul>
<li><code>onCreate()</code>: <strong>Activity
è¢«åˆ›å»º</strong>ã€‚è¿™æ˜¯æœ€é‡è¦çš„å›è°ƒï¼Œé€šå¸¸åœ¨è¿™é‡Œè¿›è¡Œå¸ƒå±€åŠ è½½
(<code>setContentView</code>)ã€æ•°æ®åˆå§‹åŒ–ã€äº‹ä»¶ç»‘å®šç­‰ã€‚</li>
<li><code>onStart()</code>: Activity å˜å¾—å¯è§ï¼Œä½†è¿˜ä¸èƒ½ä¸ç”¨æˆ·äº¤äº’ã€‚</li>
<li><code>onResume()</code>: <strong>Activity
åˆ°è¾¾å‰å°</strong>ï¼Œå¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ Hook UI
ç›¸å…³é€»è¾‘çš„ç»ä½³ä½ç½®ã€‚</li>
<li><code>onPause()</code>: Activity
å³å°†è¿›å…¥åå°ï¼Œä¸å†æ˜¯ç„¦ç‚¹ã€‚é€šå¸¸åœ¨è¿™é‡Œä¿å­˜æœªæäº¤çš„æ•°æ®ã€‚</li>
<li><code>onStop()</code>: Activity å®Œå…¨ä¸å¯è§ã€‚</li>
<li><code>onDestroy()</code>: Activity å³å°†è¢«é”€æ¯ã€‚</li>
<li><code>onRestart()</code>: Activity ä»åœæ­¢çŠ¶æ€é‡æ–°å¯åŠ¨ã€‚</li>
</ul></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>Hook <code>onCreate()</code> æˆ– <code>onResume()</code>
æ˜¯åˆ†æä¸€ä¸ªæ–°é¡µé¢çš„æ ‡å‡†èµ·ç‚¹ã€‚</li>
<li>é€šè¿‡ <code>adb shell dumpsys activity top</code>
å¯ä»¥æŸ¥çœ‹å½“å‰ä½äºå‰å°çš„ Activity
çš„ç±»åï¼Œè¿™æ˜¯å¿«é€Ÿå®šä½ç›®æ ‡é¡µé¢çš„å…³é”®å‘½ä»¤ã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="æœåŠ¡-service">2. æœåŠ¡ (Service)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: Service
æ˜¯ä¸€ä¸ªåœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„ç»„ä»¶ã€‚å³ä½¿ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ï¼ŒæœåŠ¡ä»ç„¶å¯ä»¥ç»§ç»­å·¥ä½œã€‚</p></li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>åå°ä»»åŠ¡</strong>: æ‰§è¡Œä¸éœ€è¦ UI
çš„ä»»åŠ¡ï¼Œå¦‚æ’­æ”¾éŸ³ä¹ã€ä¸‹è½½æ–‡ä»¶ã€åŒæ­¥æ•°æ®ã€‚</li>
<li><strong>è¿›ç¨‹é—´é€šä¿¡ (IPC)</strong>: å¯ä»¥ä½œä¸ºæœåŠ¡ç«¯ï¼Œä¸ºå…¶ä»– App
æä¾›åŠŸèƒ½ã€‚</li>
</ul></li>
<li><p><strong>ç±»å‹</strong>:</p>
<ul>
<li><strong>å¯åŠ¨æœåŠ¡ (Started Service)</strong>: é€šè¿‡
<code>startService()</code>
å¯åŠ¨ï¼Œä¸€æ—¦å¯åŠ¨ï¼ŒæœåŠ¡å°±å¯ä»¥æ— é™æœŸåœ°åœ¨åå°è¿è¡Œï¼Œç›´åˆ°å®ƒè‡ªå·±åœæ­¢æˆ–è¢«ç³»ç»Ÿé”€æ¯ã€‚</li>
<li><strong>ç»‘å®šæœåŠ¡ (Bound Service)</strong>: é€šè¿‡
<code>bindService()</code>
å¯åŠ¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¥å£ï¼Œå…è®¸ç»„ä»¶ï¼ˆå¦‚
Activityï¼‰ä¸æœåŠ¡è¿›è¡Œäº¤äº’ã€å‘é€è¯·æ±‚ã€è·å–ç»“æœã€‚å½“æ‰€æœ‰ç»‘å®šçš„ç»„ä»¶éƒ½è§£ç»‘åï¼ŒæœåŠ¡å°±ä¼šè¢«é”€æ¯ã€‚</li>
<li><strong>å‰å°æœåŠ¡ (Foreground Service)</strong>:
ä¸ºäº†é˜²æ­¢è¢«ç³»ç»Ÿè½»æ˜“æ€æ­»ï¼ŒService å¯ä»¥é€šè¿‡ <code>startForeground()</code>
å°†è‡ªå·±æå‡ä¸ºå‰å°æœåŠ¡ï¼Œæ­¤æ—¶å¿…é¡»åœ¨çŠ¶æ€æ æ˜¾ç¤ºä¸€ä¸ªæŒç»­çš„é€šçŸ¥ï¼ˆä¾‹å¦‚éŸ³ä¹æ’­æ”¾é€šçŸ¥ï¼‰ã€‚</li>
</ul></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>å¾ˆå¤š App çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ¶ˆæ¯æ¨é€ã€ä½ç½®ä¸ŠæŠ¥ã€æ•°æ®åŒæ­¥ï¼‰éƒ½æ”¾åœ¨
Service ä¸­ã€‚</li>
<li>Hook Service çš„ <code>onStartCommand()</code> æˆ–
<code>onBind()</code> æ–¹æ³•å¯ä»¥å¸®åŠ©ç†è§£å…¶åå°è¡Œä¸ºã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="å¹¿æ’­æ¥æ”¶å™¨-broadcast-receiver">3. å¹¿æ’­æ¥æ”¶å™¨ (Broadcast
Receiver)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>:
å¹¿æ’­æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªç”¨äºå“åº”ç³»ç»ŸèŒƒå›´å¹¿æ’­é€šçŸ¥çš„ç»„ä»¶ã€‚è®¸å¤šå¹¿æ’­æºè‡ªç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œå±å¹•å…³é—­ã€ç½‘ç»œçŠ¶æ€æ”¹å˜ã€ç”µæ± ç”µé‡ä½ï¼‰ï¼Œä½†åº”ç”¨ä¹Ÿå¯ä»¥å‘èµ·è‡ªå®šä¹‰å¹¿æ’­ã€‚</p></li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>ç›‘å¬ç³»ç»Ÿäº‹ä»¶</strong>: è®© App
èƒ½å¤Ÿå¯¹è®¾å¤‡çŠ¶æ€çš„å˜åŒ–åšå‡ºååº”ã€‚</li>
<li><strong>åº”ç”¨é—´é€šä¿¡</strong>: ä¸€ä¸ª App å¯ä»¥å‘å…¶ä»– App
å‘é€å¹¿æ’­ï¼Œå®ç°ç®€å•çš„æ¶ˆæ¯é€šçŸ¥ã€‚</li>
</ul></li>
<li><p><strong>ç±»å‹</strong>:</p>
<ul>
<li><strong>é™æ€æ³¨å†Œ</strong>: åœ¨ <code>AndroidManifest.xml</code>
ä¸­ä½¿ç”¨ <code>&lt;receiver&gt;</code> æ ‡ç­¾å£°æ˜ã€‚å³ä½¿ App
æ²¡æœ‰è¿è¡Œï¼Œå½“å¹¿æ’­äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¹Ÿä¼šå”¤é†’ App æ¥å¤„ç†å®ƒã€‚</li>
<li><strong>åŠ¨æ€æ³¨å†Œ</strong>: åœ¨ä»£ç ä¸­é€šè¿‡
<code>Context.registerReceiver()</code>
æ³¨å†Œã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸æ³¨å†Œå®ƒçš„ç»„ä»¶ï¼ˆå¦‚ Activityï¼‰ç›¸å…³è”ã€‚</li>
</ul></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>åˆ†æ <code>AndroidManifest.xml</code> ä¸­çš„é™æ€å¹¿æ’­æ¥æ”¶å™¨ï¼Œå¯ä»¥äº†è§£
App å…³å¿ƒå“ªäº›ç³»ç»Ÿäº‹ä»¶ã€‚</li>
<li>Hook <code>onReceive()</code>
æ–¹æ³•æ˜¯æ•è·å’Œåˆ†æå¹¿æ’­å†…å®¹ï¼ˆIntentï¼‰çš„å…³é”®ã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="å†…å®¹æä¾›å™¨-content-provider">4. å†…å®¹æä¾›å™¨ (Content
Provider)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>:
å†…å®¹æä¾›å™¨ç”¨äºç®¡ç†ä¸€ç»„å…±äº«çš„åº”ç”¨æ•°æ®ã€‚å®ƒä»¥ä¸€ç§æ ‡å‡†åŒ–çš„æ¥å£ï¼Œå°†æ•°æ®æš´éœ²ç»™å…¶ä»–åº”ç”¨ã€‚æ•°æ®å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿã€SQLite
æ•°æ®åº“æˆ–ä»»ä½•å…¶ä»–æŒä¹…åŒ–å­˜å‚¨ä½ç½®ã€‚</p></li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>æ•°æ®å…±äº«</strong>:
æä¾›ä¸€ä¸ªå®‰å…¨ã€ç»Ÿä¸€çš„æ¥å£ï¼Œè®©å…¶ä»–åº”ç”¨å¯ä»¥æŸ¥è¯¢æˆ–ä¿®æ”¹æœ¬åº”ç”¨çš„æ•°æ®ã€‚</li>
<li><strong>æ•°æ®æŠ½è±¡</strong>:
éšè—äº†åº•å±‚æ•°æ®çš„å­˜å‚¨ç»†èŠ‚ã€‚æ— è®ºæ•°æ®æ˜¯å­˜åœ¨æ•°æ®åº“è¿˜æ˜¯æ–‡ä»¶ä¸­ï¼Œå¯¹å¤–çš„æ¥å£éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li>
<li><strong>æƒé™æ§åˆ¶</strong>:
å¯ä»¥ç²¾ç»†åœ°æ§åˆ¶å…¶ä»–åº”ç”¨å¯¹æ•°æ®çš„è¯»å†™æƒé™ã€‚</li>
</ul></li>
<li><p><strong>å·¥ä½œæ–¹å¼</strong>:</p>
<ul>
<li>é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„ <code>URI</code> (Uniform Resource Identifier)
æ¥æ ‡è¯†æ•°æ®ã€‚ä¾‹å¦‚
<code>content://com.example.app.provider/users/10</code>ã€‚</li>
<li>å…¶ä»–åº”ç”¨ä½¿ç”¨ <code>ContentResolver</code> å¯¹è±¡ï¼Œé€šè¿‡
<code>query()</code>, <code>insert()</code>, <code>update()</code>,
<code>delete()</code> ç­‰æ–¹æ³•ä¸ Content Provider è¿›è¡Œäº¤äº’ã€‚</li>
</ul></li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>App çš„è”ç³»äººã€çŸ­ä¿¡ã€åª’ä½“åº“ç­‰éƒ½æ˜¯é€šè¿‡ Content Provider è®¿é—®çš„ã€‚</li>
<li>åˆ†æ <code>AndroidManifest.xml</code> ä¸­å£°æ˜çš„
<code>provider</code>ï¼Œå¯ä»¥æ‰¾åˆ° App å¯¹å¤–æš´éœ²äº†å“ªäº›æ•°æ®ã€‚</li>
<li>é€†å‘ App æ—¶ï¼Œå¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ª App æ¥è°ƒç”¨ç›®æ ‡ App çš„ Content
Providerï¼Œä»è€Œè¯»å–æˆ–æ“çºµå…¶å†…éƒ¨æ•°æ®ã€‚ ___</li>
</ul></li>
</ul>
<!-- 04-Reference/Foundations/android_manifest.md -->
<h1 id="androidmanifest.xml-æ·±åº¦è§£æ">androidManifest.xml æ·±åº¦è§£æ</h1>
<p><code>AndroidManifest.xml</code> æ˜¯ Android
åº”ç”¨çš„â€å¤§è„‘â€å’Œâ€è“å›¾â€ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„é…ç½®æ–‡ä»¶ï¼Œä½äºæ¯ä¸ª APK
çš„æ ¹ç›®å½•ä¸­ã€‚è¯¥æ–‡ä»¶å‘ Android æ„å»ºå·¥å…·ã€æ“ä½œç³»ç»Ÿå’Œ Google Play
æè¿°äº†åº”ç”¨çš„åŸºæœ¬ä¿¡æ¯ã€ç»„ä»¶ã€æƒé™å’Œç¡¬ä»¶è¦æ±‚ã€‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™æ˜¯äº†è§£åº”ç”¨åŠŸèƒ½ã€å…¥å£ç‚¹å’Œå®‰å…¨è¾¹ç•Œçš„é¦–è¦åˆ‡å…¥ç‚¹ã€‚
___ ## # æ ¸å¿ƒä½œç”¨ä¸ç‰¹æ€§</p>
<ul>
<li><p><strong>å”¯ä¸€æ ‡è¯†</strong>: å®šä¹‰äº†åº”ç”¨çš„ Java åŒ…åï¼Œè¿™æ˜¯å®ƒåœ¨è®¾å¤‡å’Œ
Google Play ä¸Šçš„å”¯ä¸€æ ‡è¯†ã€‚</p></li>
<li><p><strong>ç»„ä»¶å£°æ˜</strong>:
å£°æ˜åº”ç”¨çš„æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼ˆå››å¤§ç»„ä»¶ï¼‰ã€‚ä»»ä½•æœªåœ¨æ­¤æ–‡ä»¶ä¸­å£°æ˜çš„ç»„ä»¶éƒ½å¯¹ç³»ç»Ÿä¸å¯è§ï¼Œä¹Ÿæ— æ³•è¿è¡Œã€‚</p></li>
<li><p><strong>æƒé™è¯·æ±‚</strong>: åˆ—å‡ºåº”ç”¨éœ€è¦è®¿é—®çš„å—ä¿æŠ¤éƒ¨åˆ† API
æˆ–ç³»ç»Ÿèµ„æºæ‰€éœ€çš„æƒé™ã€‚</p></li>
<li><p><strong>ç¡¬ä»¶/è½¯ä»¶è¦æ±‚</strong>:
å£°æ˜åº”ç”¨è¿è¡Œæ‰€éœ€çš„ç¡¬ä»¶åŠŸèƒ½ï¼ˆå¦‚æ‘„åƒå¤´ã€è“ç‰™ï¼‰å’Œæœ€ä½ Android API
çº§åˆ«ã€‚</p></li>
<li><p><strong>å…¥å£ç‚¹å®šä¹‰</strong>: é€šè¿‡ <code>intent-filter</code>
æŒ‡å®šå“ªä¸ª Activity æ˜¯åº”ç”¨çš„å¯åŠ¨å™¨ã€‚</p></li>
<li><p>*é‡è¦æç¤º**: åŸå§‹çš„ <code>AndroidManifest.xml</code>
æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚å¿…é¡»ä½¿ç”¨ <code>apktool</code>, <code>jadx</code>,
<code>aapt</code> ç­‰å·¥å…·è§£ç åæ‰èƒ½é˜…è¯»ã€‚ ___ ## # å…³é”®æ ‡ç­¾ (Tags)
è¯¦è§£</p></li>
</ul>
<h3 id="manifest"># <code>&lt;manifest&gt;</code></h3>
<p>æ ¹å…ƒç´ ã€‚å®ƒå¿…é¡»åŒ…å« <code>package</code>
å±æ€§æ¥å®šä¹‰åº”ç”¨çš„å”¯ä¸€åŒ…åã€‚</p>
<div class="sourceCode" id="cb563"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">manifest</span> <span class="ot">xmlns:android=</span><span class="st">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a><span class="ot">package=</span><span class="st">&quot;com.example.myapp&quot;</span>&gt;</span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb563-4"><a href="#cb563-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">manifest</span>&gt;</span></code></pre></div>
<ul>
<li><p><code>android:theme</code>: åº”ç”¨çš„å…¨å±€ä¸»é¢˜ã€‚</p></li>
<li><p><code>android:name</code>: æŒ‡å®š <code>Application</code>
å­ç±»çš„åç§°ï¼Œå¸¸ç”¨äºåº”ç”¨åˆå§‹åŒ–ã€‚è¿™æ˜¯ Hook çš„ç»ä½³ç›®æ ‡ã€‚</p></li>
<li><p><code>android:debuggable</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong>
<code>true</code> è¡¨ç¤ºåº”ç”¨æ˜¯å¯è°ƒè¯•çš„ï¼Œå…è®¸ <code>adb</code>
è¿æ¥å’Œä»»æ„ä»£ç æ‰§è¡Œã€‚å‘å¸ƒçš„ Release ç‰ˆæœ¬å¿…é¡»ä¸º
<code>false</code>ã€‚</p></li>
<li><p><code>android:allowBackup</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong>
<code>true</code> å…è®¸ç”¨æˆ·é€šè¿‡ <code>adb backup</code>
å¤‡ä»½åº”ç”¨æ•°æ®ã€‚å¦‚æœåº”ç”¨æ•°æ®æ•æ„Ÿï¼Œåº”è®¾ä¸º <code>false</code>ã€‚</p></li>
<li><p><code>android:networkSecurityConfig</code>:
<strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> æŒ‡å‘ç½‘ç»œå®‰å…¨é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ SSL
Pinningã€è‡ªå®šä¹‰ CA ç­‰é«˜çº§ç½‘ç»œç­–ç•¥ã€‚</p></li>
</ul>
<h3 id="activity"># <code>&lt;activity&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª Activity (UI ç•Œé¢)ã€‚</p>
<ul>
<li><p><code>android:name</code>: Activity
ç±»çš„åç§°ã€‚<code>.MyActivity</code> æ˜¯ <code>package.MyActivity</code>
çš„ç®€å†™ã€‚</p></li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong>
<code>true</code> è¡¨ç¤ºè¯¥ Activity å¯ä»¥è¢«å…¶ä»–åº”ç”¨å¯åŠ¨ã€‚å¦‚æœè¯¥ Activity
å¤„ç†æ•æ„Ÿæ•°æ®ä¸”æ— éœ€å¤–éƒ¨è°ƒç”¨ï¼Œåº”è®¾ä¸º
<code>false</code>ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç»„ä»¶åŠ«æŒå’Œæ•°æ®æ³„éœ²ã€‚å¯¹äºåŒ…å«
<code>LAUNCHER</code> intent-filter çš„ Activityï¼Œ<code>exported</code>
é»˜è®¤ä¸º <code>true</code>ã€‚</p></li>
</ul>
<h3 id="service"># <code>&lt;service&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª Service (åå°æœåŠ¡)ã€‚</p>
<ul>
<li><p><code>android:name</code>: Service ç±»çš„åç§°ã€‚</p></li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong>
<code>true</code> è¡¨ç¤ºè¯¥ Service å¯ä»¥è¢«å…¶ä»–åº”ç”¨ç»‘å®šæˆ–å¯åŠ¨ã€‚è§„åˆ™åŒ
Activityã€‚</p></li>
</ul>
<h3 id="receiver"># <code>&lt;receiver&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª BroadcastReceiver (å¹¿æ’­æ¥æ”¶å™¨)ã€‚</p>
<ul>
<li><p><code>android:name</code>: Receiver ç±»çš„åç§°ã€‚</p></li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong>
<code>true</code> è¡¨ç¤ºå®ƒå¯ä»¥æ¥æ”¶æ¥è‡ªç³»ç»Ÿæˆ–å…¶ä»–åº”ç”¨çš„å¹¿æ’­ã€‚</p></li>
</ul>
<h3 id="provider"># <code>&lt;provider&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª ContentProvider (å†…å®¹æä¾›è€…)ï¼Œç”¨äºè·¨åº”ç”¨å…±äº«æ•°æ®ã€‚</p>
<ul>
<li><p><code>android:name</code>: Provider ç±»çš„åç§°ã€‚</p></li>
<li><p><code>android:authorities</code>: Provider
çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯åŒ…ååŠ ä¸Šæè¿°æ€§åç¼€ã€‚</p></li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong>
<code>true</code> è¡¨ç¤ºå…¶ä»–åº”ç”¨å¯ä»¥è®¿é—®å…¶æ•°æ®ã€‚å¦‚æœ
<code>minSdkVersion</code> æˆ– <code>targetSdkVersion</code> &gt;=
17ï¼Œé»˜è®¤å€¼ä¸º <code>false</code>ã€‚ä¸æ­£ç¡®çš„ <code>exported</code>
è®¾ç½®å¯èƒ½å¯¼è‡´ SQL æ³¨å…¥æˆ–æ–‡ä»¶éå†æ¼æ´ã€‚</p></li>
</ul>
<h3 id="uses-permission"># <code>&lt;uses-permission&gt;</code></h3>
<p>è¯·æ±‚åº”ç”¨è¿è¡Œæ‰€éœ€çš„æƒé™ã€‚è¿™æ˜¯åˆ†æåº”ç”¨è¡Œä¸ºçš„å…³é”®ã€‚</p>
<div class="sourceCode" id="cb564"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span> <span class="ot">android:name=</span><span class="st">&quot;android.permission.INTERNET&quot;</span> /&gt;</span>
<span id="cb564-2"><a href="#cb564-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span> <span class="ot">android:name=</span><span class="st">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span>
<span id="cb564-3"><a href="#cb564-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">uses-permission</span> <span class="ot">android:name=</span><span class="st">&quot;android.permission.CAMERA&quot;</span> /&gt;</span></code></pre></div>
<p><activity android:name=".MainActivity" android:exported="true">
<intent-filter> <action android:name="android.intent.action.MAIN" />
<category android:name="android.intent.category.LAUNCHER" />
</intent-filter> <intent-filter>
<action android:name="android.intent.action.VIEW" />
<category android:name="android.intent.category.DEFAULT" />
<data android:scheme="http" android:host="example.com" />
</intent-filter> </activity></p>
<pre><code>
1. **ç¡®å®šå…¥å£ç‚¹**:

* å¯»æ‰¾ `MAIN/LAUNCHER` çš„ Activityã€‚

* å¯»æ‰¾ `android:name` å±æ€§å®šä¹‰çš„ `Application` å­ç±»ï¼Œè¿™æ˜¯æœ€æ—©æ‰§è¡Œä»£ç çš„åœ°æ–¹ã€‚

2. **è¯†åˆ«æ ¸å¿ƒåŠŸèƒ½**:

* é˜…è¯»æƒé™åˆ—è¡¨ (`&lt;uses-permission&gt;`)ï¼Œå¿«é€Ÿäº†è§£åº”ç”¨èƒ½åŠ›ã€‚

* æŸ¥çœ‹å£°æ˜çš„ Activitiesã€Servicesï¼Œæ¨æµ‹å…¶åŠŸèƒ½æ¨¡å—ã€‚

3. **å¯»æ‰¾æ”»å‡»é¢**:

* æ£€æŸ¥æ‰€æœ‰ç»„ä»¶çš„ `android:exported=&quot;true&quot;` å±æ€§ï¼Œè¿™äº›æ˜¯æ½œåœ¨çš„æ”»å‡»å…¥å£ã€‚

* åˆ†æ `intent-filter`ï¼Œç‰¹åˆ«æ˜¯è‡ªå®šä¹‰çš„ `scheme`ï¼Œå¯»æ‰¾ URL Scheme æ¼æ´ã€‚

* æ£€æŸ¥ `android:debuggable=&quot;true&quot;`ï¼Œå¦‚æœä¸º `true`ï¼Œå¯ä»¥ç›´æ¥é™„åŠ è°ƒè¯•å™¨ã€‚

* æ£€æŸ¥ `android:allowBackup=&quot;true&quot;`ï¼Œå°è¯• `adb backup` å¯¼å‡ºæ•°æ®ã€‚
___
## # å®‰å…¨é£é™©ä¸é…ç½®

* **ç»„ä»¶å¯¼å‡ºé£é™©**: é”™è¯¯åœ°å°†å†…éƒ¨ç»„ä»¶è®¾ç½®ä¸º `exported=&quot;true&quot;` æ˜¯æœ€å¸¸è§çš„ Android æ¼æ´ä¹‹ä¸€ã€‚

* **Webview é£é™©**: æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `WebView`ï¼Œå¹¶ç¡®è®¤æ˜¯å¦å¼€å¯äº† `setJavaScriptEnabled(true)`ï¼Œè¿™å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

* **File Provider è·¯å¾„éå†**: å¦‚æœ `ContentProvider` æ˜¯ `FileProvider`ï¼Œä¸æ­£ç¡®çš„é…ç½®å¯èƒ½å¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚

* **ç¡¬ç¼–ç å¯†é’¥**: è™½ç„¶ä¸åœ¨ Manifest ä¸­ï¼Œä½†åˆ†æååº”åœ¨ `res/values/strings.xml` æˆ–ä»£ç ä¸­å¯»æ‰¾ç¡¬ç¼–ç çš„ API å¯†é’¥æˆ– URLã€‚</code></pre>
<!-- 04-Reference/Foundations/android_studio_debug_tools.md -->
<hr />
<h1 id="android-studio-è°ƒè¯•å·¥å…·é›†">android Studio è°ƒè¯•å·¥å…·é›†</h1>
<p>Android Studio
ä¸ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨ï¼Œå®ƒè¿˜é›†æˆäº†ä¸€å¥—å¼ºå¤§ã€å¯è§†åŒ–çš„è°ƒè¯•å’Œåˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿæå¤§åœ°æå‡å¼€å‘å’Œé€†å‘åˆ†æçš„æ•ˆç‡ã€‚ç†Ÿæ‚‰è¿™äº›å·¥å…·æ˜¯æ¯ä¸ª
Android å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ã€‚</p>
<hr />
<h2 id="æ—¥å¿—çŒ«-logcat">1. æ—¥å¿—çŒ« (Logcat)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>: Logcat æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæŸ¥çœ‹ Android
ç³»ç»Ÿçš„æ—¥å¿—è¾“å‡ºã€‚Android Studio
å°†å…¶å°è£…åœ¨ä¸€ä¸ªä¾¿æ·çš„çª—å£ä¸­ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹æ¥è‡ªç³»ç»Ÿå’Œæ‰€æœ‰åº”ç”¨çš„æ—¥å¿—ä¿¡æ¯ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:
<ul>
<li><strong>å®æ—¶æ—¥å¿—æµ</strong>: æ˜¾ç¤ºæ¥è‡ªè®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨çš„è¿ç»­æ—¥å¿—ã€‚</li>
<li><strong>æ—¥å¿—çº§åˆ«è¿‡æ»¤</strong>: å¯ä»¥æŒ‰ Verbose, Debug, Info, Warn,
Error, Assert ç­‰çº§åˆ«è¿›è¡Œè¿‡æ»¤ã€‚åœ¨è°ƒè¯•æ—¶ï¼Œé€šå¸¸å…³æ³¨ Error å’Œ Warn
çº§åˆ«ã€‚</li>
<li><strong>è¿›ç¨‹/åº”ç”¨è¿‡æ»¤</strong>:
å¯ä»¥åªæ˜¾ç¤ºå½“å‰æ­£åœ¨è°ƒè¯•çš„åº”ç”¨ï¼Œæˆ–ç‰¹å®šè¿›ç¨‹çš„æ—¥å¿—ã€‚</li>
<li><strong>å…³é”®è¯æœç´¢</strong>:
å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾åˆ°ä½ å…³å¿ƒçš„æ—¥å¿—æ¡ç›®ã€‚</li>
<li><strong>å †æ ˆè·Ÿè¸ªç‚¹å‡»</strong>:
å½“æ—¥å¿—ä¸­åŒ…å«å¼‚å¸¸å †æ ˆæ—¶ï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡»ç±»åå’Œè¡Œå·ï¼Œè·³è½¬åˆ°æºç çš„å¯¹åº”ä½ç½®ã€‚</li>
</ul></li>
<li><em>é€†å‘åº”ç”¨</em>:
<ul>
<li>å¾ˆå¤š App
åœ¨å¼€å‘é˜¶æ®µä¼šç•™ä¸‹å¤§é‡çš„è°ƒè¯•æ—¥å¿—ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚åŠ å¯†å‰çš„è¯·æ±‚å‚æ•°ã€æœåŠ¡å™¨è¿”å›çš„æ˜æ–‡ç­‰ã€‚</li>
<li>é€šè¿‡è§‚å¯Ÿ App åœ¨ç‰¹å®šæ“ä½œä¸‹çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥æ¨æ–­å…¶å†…éƒ¨çš„å·¥ä½œæµç¨‹ã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="å¸ƒå±€æ£€æŸ¥å™¨-layout-inspector">2. å¸ƒå±€æ£€æŸ¥å™¨ (Layout
Inspector)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>:
è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¯è§†åŒ–å·¥å…·ï¼Œå…è®¸ä½ å®æ—¶æ£€æŸ¥å’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„åº”ç”¨çš„è§†å›¾å±‚æ¬¡ç»“æ„ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:
<ul>
<li><strong>3D è§†å›¾å±‚æ¬¡</strong>: ä»¥ 3D å¯æ—‹è½¬çš„è§†å›¾å±•ç¤ºå½“å‰ Activity
çš„æ‰€æœ‰ <code>View</code> ç»„ä»¶æ˜¯å¦‚ä½•åµŒå¥—çš„ã€‚</li>
<li><strong>å±æ€§æŸ¥çœ‹</strong>: ç‚¹å‡»ä»»ä½•ä¸€ä¸ª
<code>View</code>ï¼Œéƒ½å¯ä»¥å®æ—¶æŸ¥çœ‹å…¶æ‰€æœ‰çš„å±æ€§ï¼Œå¦‚ <code>ID</code>,
<code>text</code>, <code>width</code>, <code>height</code>,
<code>padding</code>, <code>color</code> ç­‰ã€‚</li>
<li><strong>å®æ—¶æ›´æ–°</strong>: åœ¨è®¾å¤‡ä¸Šæ“ä½œ
UIï¼Œå¸ƒå±€æ£€æŸ¥å™¨ä¸­çš„è§†å›¾ä¼šå®æ—¶åŒæ­¥æ›´æ–°ã€‚</li>
<li><strong>å®šä½é‡å è§†å›¾</strong>: å¯ä»¥è½»æ¾å‘ç°è¢«å…¶ä»–è§†å›¾é®æŒ¡æˆ–å°ºå¯¸ä¸º 0
çš„ä¸å¯è§è§†å›¾ã€‚</li>
</ul></li>
<li><em>é€†å‘åº”ç”¨</em>:
<ul>
<li>å¿«é€Ÿå®šä½ä¸€ä¸ªæŒ‰é’®æˆ–æ–‡æœ¬æ¡†çš„ <code>resource-id</code>ï¼Œè¿™æ˜¯ç¼–å†™
UIAutomator2 ç­‰è‡ªåŠ¨åŒ–è„šæœ¬çš„å…³é”®ã€‚</li>
<li>åˆ†æè‡ªå®šä¹‰ <code>View</code> çš„ç»˜åˆ¶æ–¹å¼å’Œå†…éƒ¨ç»“æ„ã€‚</li>
<li>ç†è§£ä¸€äº›åæˆªå›¾ã€åå½•å±æŠ€æœ¯æ˜¯å¦‚ä½•é€šè¿‡æ·»åŠ ä¸€ä¸ªé€æ˜çš„
<code>FLAG_SECURE</code> çª—å£æ¥å®ç°çš„ã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="åº”ç”¨åˆ†æå™¨-profiler">3. åº”ç”¨åˆ†æå™¨ (Profiler)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>: Profiler æ˜¯ä¸€å¥—ç”¨äºå®æ—¶åˆ†æåº”ç”¨æ€§èƒ½çš„å·¥å…·ï¼Œä¸»è¦å…³æ³¨
CPUã€å†…å­˜ã€ç½‘ç»œå’Œç”µé‡å››ä¸ªæ–¹é¢ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:
<ul>
<li><strong>CPU Profiler</strong>:
<ul>
<li><strong>æ–¹æ³•è¿½è¸ª (Method Tracing)</strong>:
å¯ä»¥è®°å½•ä¸‹åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…æ‰€æœ‰å‡½æ•°çš„è°ƒç”¨æ ˆå’Œæ‰§è¡Œæ—¶é—´ï¼Œç”Ÿæˆç«ç„°å›¾ã€‚è¿™å¯¹äºå¯»æ‰¾æ€§èƒ½ç“¶é¢ˆè‡³å…³é‡è¦ã€‚</li>
<li><strong>ç³»ç»Ÿè°ƒç”¨è¿½è¸ª</strong>: å¯ä»¥æŸ¥çœ‹ App
ä¸ç³»ç»Ÿå†…æ ¸çš„äº¤äº’æƒ…å†µã€‚</li>
</ul></li>
<li><strong>Memory Profiler</strong>:
<ul>
<li><strong>å®æ—¶å†…å­˜å ç”¨</strong>: æ˜¾ç¤º App çš„ Java å †ã€Native
å †å’Œå›¾å½¢å†…å­˜çš„å®æ—¶ä½¿ç”¨æƒ…å†µã€‚</li>
<li><strong>å †è½¬å‚¨ (Heap Dump)</strong>:
å¯ä»¥æ•è·æŸä¸€æ—¶åˆ»çš„å†…å­˜å¿«ç…§ï¼Œå¹¶åˆ†æå…¶ä¸­æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ã€å¼•ç”¨å…³ç³»ã€‚</li>
<li><strong>å†…å­˜æ³„æ¼æ£€æµ‹</strong>:
é•¿æœŸè¿è¡Œå¹¶è§‚å¯Ÿå†…å­˜æ›²çº¿ï¼Œå¯ä»¥å¸®åŠ©å®šä½å†…å­˜æ³„æ¼é—®é¢˜ã€‚</li>
</ul></li>
<li><strong>Network Profiler</strong>:
<ul>
<li><strong>ç½‘ç»œè¯·æ±‚æ—¶é—´çº¿</strong>: ä»¥æ—¶é—´çº¿çš„å½¢å¼å±•ç¤º App
å‘èµ·çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„å»ºç«‹æ—¶é—´ã€å‘é€æ—¶é—´å’Œæ¥æ”¶æ—¶é—´ã€‚</li>
<li><strong>è¯·æ±‚è¯¦æƒ…</strong>: å¯ä»¥æŸ¥çœ‹æ¯ä¸ªè¯·æ±‚çš„ URLã€è¯·æ±‚å¤´ã€å“åº”å¤´å’Œ
Payloadã€‚<strong>ï¼ˆæ³¨æ„ï¼šå¯¹äº HTTPS
æµé‡ï¼Œé»˜è®¤åªèƒ½çœ‹åˆ°åŠ å¯†åçš„å†…å®¹ï¼Œéœ€è¦é…åˆå…¶ä»–æŠ“åŒ…å·¥å…·ä½¿ç”¨ï¼‰</strong>ã€‚</li>
</ul></li>
</ul></li>
<li><em>é€†å‘åº”ç”¨</em>:
<ul>
<li><strong>æ–¹æ³•è¿½è¸ª</strong>:
é€šè¿‡å¯¹ä¸€ä¸ªåŠ å¯†å‡½æ•°è¿›è¡Œè¿½è¸ªï¼Œå¯ä»¥å®Œæ•´åœ°äº†è§£å…¶å†…éƒ¨éƒ½è°ƒç”¨äº†å“ªäº›å­å‡½æ•°ï¼Œå¸®åŠ©ç†è§£å¤æ‚ç®—æ³•ã€‚</li>
<li><strong>å †è½¬å‚¨</strong>: åœ¨ App
è§£å¯†å¹¶åŠ è½½äº†æŸäº›æ ¸å¿ƒæ•°æ®åˆ°å†…å­˜åï¼Œé€šè¿‡ Heap Dump
å¯èƒ½ä¼šæ‰¾åˆ°è¿™äº›æ•°æ®å¯¹è±¡ï¼Œç”šè‡³æ˜¯å¯†é’¥å¯¹è±¡ã€‚</li>
<li><strong>ç½‘ç»œåˆ†æ</strong>: è™½ç„¶ä¸èƒ½è§£å¯† HTTPSï¼Œä½†å¯ä»¥å¿«é€Ÿäº†è§£ App
åœ¨ä½•æ—¶ã€å‘å“ªäº›åŸŸåå‘èµ·äº†ç½‘ç»œè¯·æ±‚ï¼Œä¸ºç½‘ç»œæŠ“åŒ…æä¾›ç›®æ ‡ã€‚</li>
</ul></li>
</ul>
<hr />
<h2 id="æ•°æ®åº“æ£€æŸ¥å™¨-database-inspector">4. æ•°æ®åº“æ£€æŸ¥å™¨ (Database
Inspector)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>:
å…è®¸ä½ å®æ—¶æ£€æŸ¥ã€æŸ¥è¯¢å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ä¸­çš„æ•°æ®åº“ï¼ˆSQLiteï¼‰ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:
<ul>
<li><strong>å®æ—¶æ•°æ®æŸ¥çœ‹</strong>: å®æ—¶æ˜¾ç¤ºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨çš„å†…å®¹ã€‚</li>
<li><strong>è‡ªå®šä¹‰æŸ¥è¯¢</strong>: å¯ä»¥ç›´æ¥è¿è¡Œ SQL
æŸ¥è¯¢è¯­å¥æ¥æ£€ç´¢æˆ–ä¿®æ”¹æ•°æ®ã€‚</li>
<li><strong>æ•°æ®ä¿®æ”¹</strong>: å¯ä»¥ç›´æ¥åœ¨å›¾å½¢ç•Œé¢ä¸­ä¿®æ”¹å­—æ®µçš„å€¼ã€‚</li>
<li><strong>ä¿æŒè¿æ¥</strong>: å³ä½¿ App
è¿›ç¨‹è¢«æ€æ­»åé‡å¯ï¼Œæ£€æŸ¥å™¨ä¹Ÿèƒ½ä¿æŒè¿æ¥ã€‚</li>
</ul></li>
<li><em>é€†å‘åº”ç”¨</em>:
<ul>
<li>å¾ˆå¤š App ä¼šå°†ç”¨æˆ·ä¿¡æ¯ã€é…ç½®ã€èŠå¤©è®°å½•ç­‰é‡è¦æ•°æ®å­˜å‚¨åœ¨ SQLite
æ•°æ®åº“ä¸­ã€‚é€šè¿‡æ•°æ®åº“æ£€æŸ¥å™¨ï¼Œå¯ä»¥ä¸€ç›®äº†ç„¶åœ°åˆ†æå…¶æ•°æ®ç»“æ„å’Œå†…å®¹ã€‚</li>
<li>é€šè¿‡ä¿®æ”¹æ•°æ®åº“ä¸­çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œå°†ä¼šå‘˜çŠ¶æ€å­—æ®µä» 0 æ”¹ä¸º
1ï¼‰ï¼Œå¯ä»¥æµ‹è¯•å’ŒéªŒè¯ä¸€äº›æœ¬åœ°çš„ VIP åŠŸèƒ½ç»•è¿‡ã€‚ ___</li>
</ul></li>
</ul>
<!-- 04-Reference/Foundations/apk_structure.md -->
<h1 id="apk-æ–‡ä»¶ç»“æ„è¯¦è§£">APK æ–‡ä»¶ç»“æ„è¯¦è§£</h1>
<p>APK (Android Package) æ˜¯ Android
æ“ä½œç³»ç»Ÿç”¨äºåˆ†å‘å’Œå®‰è£…ç§»åŠ¨åº”ç”¨çš„æ–‡ä»¶æ ¼å¼ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP
å½’æ¡£æ–‡ä»¶ï¼ŒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä»£ç ã€èµ„æºã€è¯ä¹¦ç­‰ã€‚ç†è§£å…¶å†…éƒ¨ç»“æ„æ˜¯é€†å‘å·¥ç¨‹å’Œå®‰å…¨åˆ†æçš„ç¬¬ä¸€æ­¥ã€‚
___ ## ç›®å½• - <a href="#apk-æ–‡ä»¶ç»“æ„è¯¦è§£">APK æ–‡ä»¶ç»“æ„è¯¦è§£</a> - <a
href="#ç›®å½•">ç›®å½•</a> - <a href="#apk-æ¦‚è§ˆ">APK æ¦‚è§ˆ</a></p>
<ul>
<li><p><a href="#æ ¸å¿ƒæ–‡ä»¶ä¸ç›®å½•è¯¦è§£">æ ¸å¿ƒæ–‡ä»¶ä¸ç›®å½•è¯¦è§£</a></p></li>
<li><p><a
href="#androidmanifestxml"><code>AndroidManifest.xml</code></a></p></li>
<li><p><a href="#classesdex"><code>classes.dex</code></a></p></li>
<li><p><a href="#resourcesarsc"><code>resources.arsc</code></a></p></li>
<li><p><a href="#res"><code>res/</code></a></p></li>
<li><p><a href="#lib"><code>lib/</code></a></p></li>
<li><p><a href="#assets"><code>assets/</code></a></p></li>
<li><p><a href="#meta-inf"><code>META-INF/</code></a></p></li>
<li><p><a href="#apk-åˆ†ææµç¨‹">APK åˆ†ææµç¨‹</a> ___ ### APK
æ¦‚è§ˆ</p></li>
</ul>
<p>ä¸€ä¸ªæ ‡å‡†çš„ APK
æ–‡ä»¶ï¼Œå½“ç”¨è§£å‹ç¼©å·¥å…·æ‰“å¼€æ—¶ï¼Œé€šå¸¸ä¼šçœ‹åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<pre><code>â”œâ”€â”€ resources.arsc # [Required] Pre-compiled resource file, index for strings, layouts, etc.
â”œâ”€â”€ res/ # [Required] Uncompiled resource directory for icons, layout XMLs, etc.
â”œâ”€â”€ lib/ # [Optional] Directory for native libraries (.so files)
â”œâ”€â”€ assets/ # [Optional] Directory for raw app assets
â””â”€â”€ META-INF/ # [Required] Directory for app signature and certificate information
</code></pre>
<ul>
<li><p><strong>åŒ…å (Package Name)</strong>: åº”ç”¨åœ¨ç³»ç»Ÿä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦
(e.g., <code>com.example.app</code>)ã€‚</p></li>
<li><p><strong>ç»„ä»¶ (Components)</strong>: å£°æ˜æ‰€æœ‰çš„å››å¤§ç»„ä»¶ï¼š</p></li>
<li><p><code>Activity</code>: ç”¨æˆ·ç•Œé¢ã€‚</p></li>
<li><p><code>Service</code>: åå°æœåŠ¡ã€‚</p></li>
<li><p><code>BroadcastReceiver</code>: å¹¿æ’­æ¥æ”¶å™¨ã€‚</p></li>
<li><p><code>ContentProvider</code>: å†…å®¹æä¾›è€…ã€‚</p></li>
<li><p><strong>æƒé™ (Permissions)</strong>: å£°æ˜åº”ç”¨éœ€è¦å‘ç³»ç»Ÿç”³è¯·çš„æƒé™
(e.g., <code>android.permission.INTERNET</code>)ã€‚</p></li>
<li><p><strong>å…¥å£ç‚¹ (Entry Point)</strong>: æŒ‡å®šå“ªä¸ª Activity
æ˜¯åº”ç”¨çš„å¯åŠ¨å…¥å£ï¼ˆ<code>LAUNCHER</code> Activityï¼‰ã€‚</p></li>
<li><p><strong>SDK ç‰ˆæœ¬</strong>: æŒ‡å®šæœ€ä½æ”¯æŒçš„ SDK ç‰ˆæœ¬å’Œç›®æ ‡ SDK
ç‰ˆæœ¬ã€‚</p></li>
<li><p>åˆ†ææç¤º*: å¿…é¡»ä½¿ç”¨ <code>apktool</code> æˆ– <code>jadx</code>
ç­‰å·¥å…·å°†å…¶è§£ç ä¸ºäººç±»å¯è¯»çš„ XML
æ ¼å¼ã€‚ç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ˜¯ä¹±ç ã€‚</p></li>
</ul>
<h4 id="classes.dex"><code>classes.dex</code></h4>
<p>æˆ‘ä»¬å·²ç»åœ¨ <code>dex.md</code> ä¸­è¯¦ç»†è®¨è®ºè¿‡ã€‚è¿™æ˜¯ç”± Java/Kotlin
ä»£ç ç¼–è¯‘ã€è½¬æ¢åç”Ÿæˆçš„ Dalvik
è™šæ‹Ÿæœºå­—èŠ‚ç ã€‚åº”ç”¨çš„æ‰€æœ‰é€»è¾‘éƒ½åœ¨è¿™é‡Œã€‚å¦‚æœåº”ç”¨æ–¹æ³•æ•°è¶…è¿‡ 65536
ä¸ªï¼Œå°±ä¼šæœ‰ <code>classes2.dex</code>, <code>classes3.dex</code>
ç­‰æ–‡ä»¶ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: ä½¿ç”¨ <code>jadx</code> å¯ä»¥å°†å…¶åç¼–è¯‘ä¸º Java ä»£ç ï¼Œä½¿ç”¨
<code>baksmali</code> å¯ä»¥åæ±‡ç¼–ä¸º Smali ä»£ç ã€‚</li>
</ul>
<h4 id="resources.arsc"><code>resources.arsc</code></h4>
<p>è¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶èµ„æºç´¢å¼•è¡¨ã€‚Android
ç³»ç»Ÿä½¿ç”¨å®ƒæ¥å¿«é€ŸæŸ¥æ‰¾å’ŒåŒ¹é…èµ„æºã€‚å®ƒåŒ…å«äº†ä¸€ä¸ªä»èµ„æº ID
åˆ°å…·ä½“èµ„æºæ–‡ä»¶ï¼ˆæˆ–å­—ç¬¦ä¸²å€¼ï¼‰çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ä»£ç ä¸­è°ƒç”¨ <code>R.string.app_name</code> æ—¶ï¼Œç³»ç»Ÿé€šè¿‡
<code>resources.arsc</code> æ‰¾åˆ° <code>app_name</code>
å¯¹åº”çš„å­—ç¬¦ä¸²å€¼ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: <code>apktool</code>
å¯ä»¥è§£ç æ­¤æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å­—ç¬¦ä¸²ç­‰èµ„æºè¿˜åŸåˆ°
<code>res/values/strings.xml</code>
ç­‰æ–‡ä»¶ä¸­ã€‚ç›´æ¥æŸ¥çœ‹æ˜¯äºŒè¿›åˆ¶æ ¼å¼ã€‚</li>
</ul>
<h4 id="res"><code>res/</code></h4>
<p>å­˜æ”¾<strong>æœªç¼–è¯‘</strong>çš„èµ„æºæ–‡ä»¶ï¼Œè¿™äº›èµ„æºåœ¨æ‰“åŒ…æ—¶å¤§å¤šä¿æŒåŸæ ·æˆ–åªè¿›è¡Œç®€å•å¤„ç†ã€‚ç›®å½•ç»“æ„ä¸
Android Studio é¡¹ç›®ä¸­çš„ <code>res</code> ç›®å½•ç±»ä¼¼ã€‚</p>
<ul>
<li><p><code>res/drawable/</code>: å›¾ç‰‡èµ„æºã€‚</p></li>
<li><p><code>res/layout/</code>: å¸ƒå±€ XML æ–‡ä»¶ã€‚</p></li>
<li><p><code>res/xml/</code>: ä»»æ„ XML æ–‡ä»¶ã€‚</p></li>
<li><p><code>res/raw/</code>: ä»»æ„åŸå§‹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></li>
<li><p>åˆ†ææç¤º*: è¿™é‡Œçš„å¸ƒå±€ XML
æ–‡ä»¶è™½ç„¶å¯è¯»ï¼Œä½†å®ƒä»¬å¼•ç”¨çš„å­—ç¬¦ä¸²ç­‰èµ„æºæ˜¯ä»¥ <code>@string/app_name</code>
çš„å½¢å¼å­˜åœ¨çš„ï¼Œéœ€è¦ç»“åˆ <code>resources.arsc</code>
æ‰èƒ½å®Œå…¨ç†è§£ã€‚</p></li>
</ul>
<h4 id="lib"><code>lib/</code></h4>
<p>å­˜æ”¾åº”ç”¨ä½¿ç”¨çš„ C/C++ åŸç”Ÿåº“ï¼ˆ<code>.so</code> æ–‡ä»¶ï¼‰ã€‚ä¸ºäº†é€‚é…ä¸åŒçš„
CPU æ¶æ„ï¼Œå®ƒé€šå¸¸åŒ…å«å¤šä¸ªå­ç›®å½•ã€‚</p>
<ul>
<li><p><code>armeabi-v7a</code>: é€‚ç”¨äº 32 ä½çš„ ARM æ¶æ„ã€‚</p></li>
<li><p><code>arm64-v8a</code>: é€‚ç”¨äº 64 ä½çš„ ARM æ¶æ„
(ç›®å‰ä¸»æµ)ã€‚</p></li>
<li><p><code>x86</code>: é€‚ç”¨äº 32 ä½çš„ x86
æ¶æ„ï¼ˆå¸¸è§äºæ¨¡æ‹Ÿå™¨ï¼‰ã€‚</p></li>
<li><p><code>x86_64</code>: é€‚ç”¨äº 64 ä½çš„ x86
æ¶æ„ï¼ˆå¸¸è§äºæ¨¡æ‹Ÿå™¨ï¼‰ã€‚</p></li>
<li><p>åˆ†ææç¤º*:
æ ¸å¿ƒçš„åŠ å¯†ã€è§£å¯†ã€æ ¸å¿ƒç®—æ³•æˆ–æ¸¸æˆå¼•æ“å¸¸å¸¸åœ¨è¿™é‡Œå®ç°ã€‚éœ€è¦ä½¿ç”¨
<code>IDA Pro</code>, <code>Ghidra</code>, <code>Binary Ninja</code>
ç­‰å·¥å…·è¿›è¡Œé€†å‘åˆ†æã€‚</p></li>
</ul>
<h4 id="assets"><code>assets/</code></h4>
<p>è¿™æ˜¯ä¸€ä¸ªâ€åŸå°ä¸åŠ¨â€çš„èµ„æºç›®å½•ã€‚ä¸ <code>res/raw</code>
ç±»ä¼¼ï¼Œè¿™é‡Œçš„ä»»ä½•æ–‡ä»¶åœ¨æ‰“åŒ…æ—¶éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå¤„ç†ã€‚å¼€å‘è€…é€šå¸¸ç”¨å®ƒæ¥å­˜æ”¾æ¸¸æˆèµ„æºã€é…ç½®æ–‡ä»¶ã€å­—ä½“ã€HTML/JS/CSS
ç­‰ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: æ£€æŸ¥æ­¤ç›®å½•æ˜¯å¦æœ‰æ•æ„Ÿçš„é…ç½®æ–‡ä»¶ã€å¯†é’¥æˆ– Web èµ„æºã€‚</li>
</ul>
<h4 id="meta-inf"><code>META-INF/</code></h4>
<p>å­˜æ”¾åº”ç”¨çš„ç­¾åä¿¡æ¯ï¼Œç”¨äºéªŒè¯ APK çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</p>
<ul>
<li><p><code>CERT.SF</code>: APK ä¸­æ¯ä¸ªæ–‡ä»¶çš„æ‘˜è¦ï¼ˆå“ˆå¸Œå€¼ï¼‰ã€‚</p></li>
<li><p><code>CERT.RSA</code>: åŒ…å«ç”¨äºç­¾ç½² <code>CERT.SF</code>
çš„å…¬é’¥å’Œè¯ä¹¦ã€‚</p></li>
<li><p><code>MANIFESF.MF</code>: åŒ…å« APK ä¸­æ¯ä¸ªæ–‡ä»¶çš„åç§°åŠå…¶ SHA-256
å“ˆå¸Œå€¼ã€‚</p></li>
<li><p>*ç­¾åæœºåˆ¶**:</p></li>
</ul>
<ol type="1">
<li>è®¡ç®— APK ä¸­æ¯ä¸ªæ–‡ä»¶çš„å“ˆå¸Œï¼Œå¹¶è®°å½•åœ¨ <code>MANIFESF.MF</code>ã€‚</li>
<li>è®¡ç®— <code>MANIFESF.MF</code> æ•´ä¸ªæ–‡ä»¶çš„å“ˆå¸Œï¼Œå¹¶è®°å½•åœ¨
<code>CERT.SF</code>ã€‚</li>
<li>ç”¨å¼€å‘è€…çš„ç§é’¥å¯¹ <code>CERT.SF</code> è¿›è¡Œç­¾åï¼Œç”Ÿæˆ
<code>CERT.RSA</code>ã€‚</li>
</ol>
<p>å½“ç³»ç»Ÿå®‰è£… APK æ—¶ï¼Œä¼šç”¨ <code>CERT.RSA</code>
ä¸­çš„å…¬é’¥æ¥éªŒè¯ç­¾åï¼Œç¡®ä¿æ–‡ä»¶è‡ªç­¾ååæœªè¢«ç¯¡æ”¹ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: å¯¹ APK
è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼ˆåŒ…æ‹¬é‡æ‰“åŒ…ï¼‰åï¼Œéƒ½å¿…é¡»ç”¨è‡ªå·±çš„å¯†é’¥é‡æ–°ç­¾åï¼Œå¦åˆ™å®‰è£…ä¼šå¤±è´¥ã€‚
___ ### APK åˆ†ææµç¨‹</li>
</ul>
<ol type="1">
<li><strong>è§£åŒ…</strong>: ä½¿ç”¨ <code>apktool d myapp.apk</code>
æˆ–ç›´æ¥ç”¨ <code>unzip</code> å‘½ä»¤è§£å‹ã€‚<code>apktool</code>
æ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒèƒ½æ­£ç¡®è§£ç  <code>AndroidManifest.xml</code> å’Œ
<code>resources.arsc</code>ã€‚</li>
<li><strong>é™æ€åˆ†æ</strong>:</li>
</ol>
<ul>
<li><p>ç”¨ <code>jadx-gui myapp.apk</code> æ‰“å¼€ï¼Œç›´æ¥æµè§ˆåç¼–è¯‘çš„ Java
ä»£ç å’Œèµ„æºã€‚</p></li>
<li><p>é˜…è¯»
<code>AndroidManifest.xml</code>ï¼Œäº†è§£å…¶ä¸»è¦ç»„ä»¶ã€æƒé™å’Œå…¥å£ç‚¹ã€‚</p></li>
<li><p>æ£€æŸ¥ <code>assets/</code> å’Œ <code>lib/</code>
ç›®å½•ï¼Œå¯»æ‰¾å…³é”®é…ç½®æ–‡ä»¶æˆ–åŸç”Ÿåº“ã€‚</p></li>
</ul>
<ol start="3" type="1">
<li><strong>åŠ¨æ€åˆ†æ</strong>: ä½¿ç”¨ <code>adb</code> å®‰è£…åº”ç”¨ï¼Œå¹¶ç”¨
<code>frida</code> æˆ– <code>Xposed</code> è¿›è¡Œ
Hookï¼Œè§‚å¯Ÿå…¶è¿è¡Œæ—¶è¡Œä¸ºã€‚</li>
</ol>
<!-- 04-Reference/Foundations/arm_assembly.md -->
<h1 id="arm-æ±‡ç¼–å…¥é—¨-android-native">ARM æ±‡ç¼–å…¥é—¨ (android Native)</h1>
<p>å½“åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘ã€åŠ å¯†ç®—æ³•æˆ–æ€§èƒ½å¯†é›†å‹ä»»åŠ¡ç”¨ C/C++
ç¼–å†™æ—¶ï¼Œå®ƒä»¬ä¼šè¢«ç¼–è¯‘æˆåŸç”Ÿåº“ (<code>.so</code> æ–‡ä»¶)ã€‚åœ¨ Android
ä¸Šï¼Œè¿™äº›åº“ä¸»è¦æ˜¯ ARM æ¶æ„çš„ã€‚ç†è§£ ARM æ±‡ç¼–æ˜¯åˆ†æ <code>.so</code>
æ–‡ä»¶çš„åŸºç¡€ã€‚æœ¬æŒ‡å—å°†ä»‹ç»é€†å‘å·¥ç¨‹å¸ˆéœ€è¦äº†è§£çš„ ARMv7 (32-bit) å’Œ ARMv8
(64-bit/A64) çš„åŸºç¡€çŸ¥è¯†ã€‚</p>
<p>!!! question â€œæ€è€ƒï¼šä¸ºä»€ä¹ˆå¿…é¡»å­¦ä¹ æ±‡ç¼–ï¼Ÿâ€
å½“ä½ é‡åˆ°ä»¥ä¸‹åœºæ™¯æ—¶ï¼Œè¯¥å¦‚ä½•åº”å¯¹ï¼Ÿ</p>
<ul>
<li>ç”¨ Jadx æ‰“å¼€ APKï¼Œå‘ç°å…³é”®çš„åŠ å¯†é€»è¾‘éƒ½åœ¨ <code>native</code>
æ–¹æ³•ä¸­</li>
<li>Frida Hook åˆ°äº†æŸä¸ª JNI å‡½æ•°ï¼Œä½†å‚æ•°æ˜¯æŒ‡é’ˆï¼Œä¸çŸ¥é“å¦‚ä½•è¯»å–</li>
<li>IDA æ‰“å¼€ <code>.so</code> æ–‡ä»¶ï¼Œæ»¡å±çš„æ±‡ç¼–æŒ‡ä»¤è®©ä½ æ— ä»ä¸‹æ‰‹</li>
</ul>
<p>è¿™äº›åœºæ™¯çš„å…±åŒç‚¹æ˜¯ï¼š<strong>æ ¸å¿ƒé€»è¾‘è¢«ç¼–è¯‘æˆäº†æœºå™¨ç </strong>ã€‚ä¸ç†è§£æ±‡ç¼–ï¼Œå°±åƒè¯•å›¾åœ¨ä¸æ‡‚å¤–è¯­çš„æƒ…å†µä¸‹é˜…è¯»å¤–æ–‡ä¹¦ç±â€”â€”ä½ åªèƒ½é çŒœã€‚
___ ## ç›®å½• 1. <a href="#åŸºæœ¬æ¦‚å¿µarm-vs-x86"><strong>åŸºæœ¬æ¦‚å¿µï¼šARM vs
x86</strong></a> 2. <a href="#å¯„å­˜å™¨-registers"><strong>å¯„å­˜å™¨
(Registers)</strong></a></p>
<ul>
<li><p><a href="#arm-32-bit-armv7">ARM 32-bit (ARMv7)</a></p></li>
<li><p><a href="#arm-64-bit-aarch64">ARM 64-bit (AArch64)</a></p></li>
</ul>
<ol start="3" type="1">
<li><a href="#æ ¸å¿ƒæŒ‡ä»¤é›†"><strong>æ ¸å¿ƒæŒ‡ä»¤é›†</strong></a></li>
</ol>
<ul>
<li><p><a href="#æ•°æ®ç§»åŠ¨æŒ‡ä»¤">æ•°æ®ç§»åŠ¨æŒ‡ä»¤</a></p></li>
<li><p><a href="#ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤">ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤</a></p></li>
<li><p><a href="#åˆ†æ”¯ä¸æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤">åˆ†æ”¯ä¸æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤</a></p></li>
<li><p><a href="#æ ˆæ“ä½œæŒ‡ä»¤">æ ˆæ“ä½œæŒ‡ä»¤</a></p></li>
</ul>
<ol start="4" type="1">
<li><a href="#å‡½æ•°è°ƒç”¨çº¦å®š"><strong>å‡½æ•°è°ƒç”¨çº¦å®š (Procedure Call
Standard)</strong></a></li>
<li><a href="#ä»-c-ä»£ç åˆ°æ±‡ç¼–"><strong>ä» C ä»£ç åˆ°æ±‡ç¼–</strong></a></li>
<li><a href="#ida-proghidra-ä¸­çš„è§†å›¾"><strong>IDA Pro/Ghidra
ä¸­çš„è§†å›¾</strong></a> ___ ### åŸºæœ¬æ¦‚å¿µï¼šARM vs x86</li>
</ol>
<ul>
<li><p><strong>RISC vs CISC</strong>: ARM æ˜¯<strong>ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœº
(RISC)</strong>ï¼ŒæŒ‡ä»¤é•¿åº¦å›ºå®šï¼Œç§ç±»è¾ƒå°‘ï¼Œæ“ä½œç®€å•ã€‚x86
æ˜¯<strong>å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœº (CISC)</strong>ã€‚</p></li>
<li><p><strong>Load/Store æ¶æ„</strong>: ARM
æ˜¯ä¸€ç§â€åŠ è½½/å­˜å‚¨â€æ¶æ„ã€‚è¿™æ„å‘³ç€æ•°æ®å¤„ç†ï¼ˆå¦‚åŠ æ³•ã€å‡æ³•ï¼‰<strong>åªèƒ½åœ¨å¯„å­˜å™¨ä¹‹é—´</strong>è¿›è¡Œã€‚ä½ å¿…é¡»å…ˆç”¨åŠ è½½æŒ‡ä»¤
(<code>LDR</code>) å°†å†…å­˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨ï¼Œè®¡ç®—å®Œæˆåå†ç”¨å­˜å‚¨æŒ‡ä»¤
(<code>STR</code>) å°†ç»“æœå­˜å›å†…å­˜ã€‚</p></li>
<li><p><strong>æŒ‡ä»¤æ¨¡å¼</strong>: ARMv7 (32-bit)
æ”¯æŒä¸¤ç§æŒ‡ä»¤é›†ï¼š</p></li>
<li><p><strong>ARM</strong>: 32-bit å®šé•¿æŒ‡ä»¤ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</p></li>
<li><p><strong>Thumb</strong>: 16-bit/32-bit
å˜é•¿æŒ‡ä»¤ï¼Œä»£ç å¯†åº¦æ›´é«˜ï¼Œæ˜¯ç§»åŠ¨è®¾å¤‡ä¸Šçš„ä¸»æµã€‚åœ¨ IDA
ç­‰å·¥å…·ä¸­ï¼Œä½ é€šå¸¸ä¼šåˆ†æ Thumb æ¨¡å¼ä¸‹çš„ä»£ç ã€‚ ___ ### å¯„å­˜å™¨
(Registers)</p></li>
</ul>
<p>å¯„å­˜å™¨æ˜¯ CPU å†…çš„é«˜é€Ÿå­˜å‚¨å•å…ƒã€‚</p>
<p>!!! tip â€œå¿«é€Ÿå®šä½å…³é”®å¯„å­˜å™¨â€
åœ¨åˆ†æä¸€ä¸ªé™Œç”Ÿå‡½æ•°æ—¶ï¼Œå¦‚ä½•å¿«é€ŸæŠ“ä½é‡ç‚¹ï¼Ÿ</p>
<ul>
<li><strong>å‡½æ•°å…¥å£</strong>ï¼šå…ˆçœ‹ <code>R0-R3</code> (32ä½) æˆ–
<code>X0-X7</code> (64ä½)ï¼Œè¿™äº›æ˜¯å‚æ•°</li>
<li><strong>å‡½æ•°è¿”å›</strong>ï¼šå…³æ³¨
<code>R0/X0</code>ï¼Œè¿™æ˜¯è¿”å›å€¼å­˜æ”¾çš„åœ°æ–¹</li>
<li><strong>å‡½æ•°è°ƒç”¨</strong>ï¼š<code>BL</code>
æŒ‡ä»¤å‰åï¼Œæ£€æŸ¥å‚æ•°å¯„å­˜å™¨çš„å˜åŒ–</li>
<li><strong>æ ˆæ“ä½œ</strong>ï¼š<code>SP</code>
çš„å˜åŒ–åæ˜ äº†å±€éƒ¨å˜é‡çš„åˆ†é…</li>
</ul>
<p>è¿™ç§â€é‡ç‚¹ä¼˜å…ˆâ€çš„é˜…è¯»ç­–ç•¥ï¼Œèƒ½è®©ä½ å¿«é€Ÿç†è§£å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œè€Œä¸å¿…é€è¡Œåˆ†ææ¯æ¡æŒ‡ä»¤ã€‚</p>
<h4 id="arm-32-bit-armv7">ARM 32-bit (ARMv7)</h4>
<p>å…±æœ‰ 16 ä¸ªé€šç”¨å¯„å­˜å™¨ (<code>R0</code> - <code>R15</code>)ã€‚</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å¯„å­˜å™¨</th>
<th style="text-align: left;">åˆ«å</th>
<th style="text-align: left;">ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>R0</code> - <code>R3</code></td>
<td style="text-align: left;"><code>A1</code> - <code>A4</code></td>
<td style="text-align: left;"><strong>å‚æ•°å¯„å­˜å™¨</strong>
(Argument)ã€‚ç”¨äºä¼ é€’å‡½æ•°çš„å‰ 4 ä¸ªå‚æ•°ã€‚<code>R0</code>
ä¹Ÿç”¨ä½œ<strong>è¿”å›å€¼å¯„å­˜å™¨</strong>ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>R4</code> - <code>R11</code></td>
<td style="text-align: left;"><code>V1</code> - <code>V8</code></td>
<td style="text-align: left;"><strong>å˜é‡å¯„å­˜å™¨</strong>
(Variable)ã€‚ç”¨äºä¿å­˜å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>R12</code></td>
<td style="text-align: left;"><code>IP</code></td>
<td style="text-align: left;">è¿‡ç¨‹è°ƒç”¨é—´ä¸´æ—¶å¯„å­˜å™¨ (Intra-Procedure call
scratch register)ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>R13</code></td>
<td style="text-align: left;"><code>SP</code></td>
<td style="text-align: left;"><strong>æ ˆæŒ‡é’ˆ</strong> (Stack
Pointer)ã€‚æŒ‡å‘æ ˆé¡¶ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>R14</code></td>
<td style="text-align: left;"><code>LR</code></td>
<td style="text-align: left;"><strong>é“¾æ¥å¯„å­˜å™¨</strong> (Link
Register)ã€‚å­˜å‚¨å‡½æ•°è°ƒç”¨çš„è¿”å›åœ°å€ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>R15</code></td>
<td style="text-align: left;"><code>PC</code></td>
<td style="text-align: left;"><strong>ç¨‹åºè®¡æ•°å™¨</strong> (Program
Counter)ã€‚æŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</td>
</tr>
</tbody>
</table>
<h4 id="arm-64-bit-aarch64">ARM 64-bit (AArch64)</h4>
<p>å¯„å­˜å™¨æ•°é‡æ›´å¤šï¼Œä¸”åŠŸèƒ½æ›´æ˜ç¡®ã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å¯„å­˜å™¨</th>
<th style="text-align: left;">ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>X0</code> - <code>X7</code></td>
<td
style="text-align: left;"><strong>å‚æ•°å¯„å­˜å™¨</strong>ã€‚ç”¨äºä¼ é€’å‡½æ•°çš„å‰
8 ä¸ªå‚æ•°ã€‚<code>X0</code> åŒæ ·ç”¨ä½œ<strong>è¿”å›å€¼å¯„å­˜å™¨</strong>ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>X8</code> - <code>X18</code></td>
<td style="text-align: left;">è°ƒç”¨è€…/è¢«è°ƒç”¨è€…ä¿å­˜çš„ä¸´æ—¶å¯„å­˜å™¨ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>X19</code> - <code>X28</code></td>
<td style="text-align: left;">è¢«è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨ (Callee-saved)ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>X29</code></td>
<td style="text-align: left;"><code>FP</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>X30</code></td>
<td style="text-align: left;"><code>LR</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>SP</code></td>
<td style="text-align: left;"><strong>æ ˆæŒ‡é’ˆ</strong> (Stack
Pointer)ã€‚</td>
</tr>
</tbody>
</table>
<ul>
<li>æ³¨*: <code>W</code> å¯„å­˜å™¨ (<code>W0</code>, <code>W1</code>â€¦) æ˜¯
<code>X</code> å¯„å­˜å™¨çš„ä½ 32 ä½ã€‚ä¾‹å¦‚ï¼Œå¯¹ <code>W0</code> çš„æ“ä½œå°±æ˜¯å¯¹
<code>X0</code> çš„ä½ 32 ä½è¿›è¡Œæ“ä½œã€‚ ___ ### æ ¸å¿ƒæŒ‡ä»¤é›†</li>
</ul>
<h4 id="æ•°æ®ç§»åŠ¨æŒ‡ä»¤">æ•°æ®ç§»åŠ¨æŒ‡ä»¤</h4>
<ul>
<li><p><code>MOV R1, R2</code> (32-bit) / <code>MOV X1, X2</code>
(64-bit): å°†å¯„å­˜å™¨ <code>R2</code> çš„å€¼ç§»åŠ¨åˆ° <code>R1</code>ã€‚</p></li>
<li><p><code>LDR R0, [SP, #4]</code> (32-bit) /
<code>LDR X0, [SP, #8]</code> (64-bit): <strong>åŠ è½½</strong>ã€‚ä»æ ˆæŒ‡é’ˆ
<code>SP</code> åç§» 4 (æˆ– 8) å­—èŠ‚çš„ä½ç½®è¯»å–æ•°æ®ï¼Œå¹¶å­˜å…¥ <code>R0</code>
(æˆ– <code>X0</code>)ã€‚</p></li>
<li><p><code>STR R0, [SP, #4]</code> (32-bit) /
<code>STR X0, [SP, #8]</code> (64-bit): <strong>å­˜å‚¨</strong>ã€‚å°†
<code>R0</code> (æˆ– <code>X0</code>) çš„å€¼å†™å…¥åˆ° <code>SP</code> åç§» 4
(æˆ– 8) å­—èŠ‚çš„å†…å­˜åœ°å€ã€‚</p></li>
<li><p><code>ADR X0, aHelloWorld</code> (64-bit, PC-relative):
<code>ADR</code> (Address PC-Relative) æŒ‡ä»¤å°†ä¸€ä¸ªç›¸å¯¹äº PC
çš„åœ°å€ï¼ˆå¦‚å­—ç¬¦ä¸² â€œHello Worldâ€ çš„åœ°å€ï¼‰åŠ è½½åˆ° <code>X0</code>ã€‚</p></li>
</ul>
<h4 id="ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤">ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤</h4>
<ul>
<li><p><code>ADD R0, R1, R2</code>: <code>R0 = R1 + R2</code>ã€‚</p></li>
<li><p><code>SUB R0, R1, #1</code>: <code>R0 = R1 - 1</code>ã€‚</p></li>
<li><p><code>and R0, R0, #0xFF</code>: æŒ‰ä½ä¸ã€‚</p></li>
<li><p><code>CMP R0, #10</code>: <strong>æ¯”è¾ƒ</strong> <code>R0</code>
å’Œ 10ã€‚è¯¥æŒ‡ä»¤ä¼šæ›´æ–°çŠ¶æ€å¯„å­˜å™¨
(CPSR)ï¼Œä½†ä¸å­˜å‚¨ç»“æœã€‚å®ƒæ€»æ˜¯ç´§è·Ÿåœ¨æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ä¹‹å‰ã€‚</p></li>
</ul>
<h4 id="åˆ†æ”¯ä¸æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤">åˆ†æ”¯ä¸æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤</h4>
<ul>
<li><p><code>B label</code>: <strong>åˆ†æ”¯</strong>
(Branch)ã€‚æ— æ¡ä»¶è·³è½¬åˆ° <code>label</code>ã€‚</p></li>
<li><p><code>BL label</code>: <strong>å¸¦é“¾æ¥çš„åˆ†æ”¯</strong> (Branch with
Link)ã€‚è·³è½¬åˆ° <code>label</code> ä¹‹å‰ï¼Œå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜å…¥
<code>LR</code>
(é“¾æ¥å¯„å­˜å™¨)ã€‚è¿™æ˜¯<strong>å‡½æ•°è°ƒç”¨</strong>çš„æ ¸å¿ƒæŒ‡ä»¤ã€‚</p></li>
<li><p><code>BX LR</code> / <code>RET</code>:
<strong>å¸¦äº¤æ¢çš„åˆ†æ”¯</strong> (Branch with Exchange) /
<strong>è¿”å›</strong>ã€‚è·³è½¬åˆ° <code>LR</code>
ä¸­çš„åœ°å€ï¼Œå®ç°å‡½æ•°è¿”å›ã€‚<code>RET</code> æ˜¯ <code>BX LR</code>
çš„åˆ«åã€‚</p></li>
<li><p><code>B.EQ label</code>: <strong>æ¡ä»¶åˆ†æ”¯</strong>ã€‚å¦‚æœå‰ä¸€ä¸ª
<code>CMP</code> æŒ‡ä»¤çš„ç»“æœæ˜¯ç›¸ç­‰ (Equal)ï¼Œåˆ™è·³è½¬ã€‚</p></li>
<li><p><code>B.NE label</code>: ä¸ç›¸ç­‰ (Not Equal)ã€‚</p></li>
<li><p><code>B.GT label</code>: å¤§äº (Greater Than)ã€‚</p></li>
<li><p><code>B.LT label</code>: å°äº (Less Than)ã€‚</p></li>
<li><p><code>B.GE label</code>: å¤§äºæˆ–ç­‰äº (Greater or Equal)ã€‚</p></li>
<li><p><code>B.LE label</code>: å°äºæˆ–ç­‰äº (Less or Equal)ã€‚</p></li>
</ul>
<h4 id="æ ˆæ“ä½œæŒ‡ä»¤">æ ˆæ“ä½œæŒ‡ä»¤</h4>
<ul>
<li><p><code>PUSH {R4, LR}</code>: å°† <code>R4</code> å’Œ <code>LR</code>
å¯„å­˜å™¨å‹å…¥æ ˆã€‚é€šå¸¸åœ¨å‡½æ•°å¼€å¤´ï¼Œç”¨äºä¿å­˜éœ€è¦ä½¿ç”¨çš„å¯„å­˜å™¨å’Œè¿”å›åœ°å€ã€‚</p></li>
<li><p><code>POP {R4, PC}</code>: å°†æ ˆé¡¶æ•°æ®å¼¹å‡ºåˆ° <code>R4</code> å’Œ
<code>PC</code>ã€‚<code>POP {..., PC}</code>
æ˜¯ä¸€ç§å¸¸è§çš„å‡½æ•°è¿”å›æ–¹å¼ï¼Œå®ƒå°†ä¿å­˜åœ¨æ ˆä¸Šçš„ <code>LR</code> å€¼ç›´æ¥å¼¹å‡ºåˆ°
<code>PC</code>ï¼Œå®ç°äº†è·³è½¬è¿”å›ã€‚</p></li>
<li><p><code>STP X29, X30, [SP, #-16]!</code> (A64): <code>STP</code>
(Store Pair) æŒ‡ä»¤ï¼Œå°†ä¸€å¯¹å¯„å­˜å™¨ (<code>X29</code>/<code>FP</code>,
<code>X30</code>/<code>LR</code>) å­˜å…¥ <code>SP</code>
æŒ‡å‘çš„åœ°å€ï¼Œ<code>!</code> è¡¨ç¤º <code>SP</code> ä¼šé¢„å…ˆå‡å» 16ã€‚</p></li>
<li><p><code>LDP X29, X30, [SP], #16</code> (A64): <code>LDP</code>
(Load Pair) æŒ‡ä»¤ï¼Œä» <code>SP</code> åœ°å€åŠ è½½æ•°æ®åˆ° <code>X29</code> å’Œ
<code>X30</code>ï¼Œç„¶å <code>SP</code> å†å¢åŠ  16ã€‚ ___ ### å‡½æ•°è°ƒç”¨çº¦å®š
(Procedure Call Standard)</p></li>
</ul>
<ol type="1">
<li><strong>å‚æ•°ä¼ é€’</strong>:</li>
</ol>
<ul>
<li><p><strong>32-bit</strong>: å‰ 4 ä¸ªå‚æ•°é€šè¿‡ <code>R0</code> -
<code>R3</code> ä¼ é€’ã€‚</p></li>
<li><p><strong>64-bit</strong>: å‰ 8 ä¸ªå‚æ•°é€šè¿‡ <code>X0</code> -
<code>X7</code> ä¼ é€’ã€‚</p></li>
<li><p>è¶…å‡ºæ•°é‡çš„å‚æ•°é€šè¿‡<strong>æ ˆ</strong>ä¼ é€’ã€‚</p></li>
</ul>
<ol start="2" type="1">
<li><strong>å‡½æ•°è°ƒç”¨</strong>: è°ƒç”¨è€…ä½¿ç”¨ <code>BL</code> æŒ‡ä»¤ã€‚</li>
<li><strong>å‡½æ•°åºè¨€ (Prologue)</strong>:</li>
</ol>
<ul>
<li><p>è¢«è°ƒç”¨å‡½æ•°ï¼ˆå­å‡½æ•°ï¼‰é¦–å…ˆè¦åšçš„æ˜¯ä¿å­˜ç°åœºã€‚</p></li>
<li><p>ä½¿ç”¨ <code>PUSH</code> æˆ– <code>STP</code>
å°†éœ€è¦åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„å¯„å­˜å™¨ï¼ˆå¦‚ <code>R4-R11</code>, <code>FP</code>,
<code>LR</code>) å‹å…¥æ ˆä¸­ã€‚</p></li>
<li><p>åˆ†é…æ ˆç©ºé—´ç»™å±€éƒ¨å˜é‡ (<code>SUB SP, SP, #...</code>)ã€‚</p></li>
</ul>
<ol start="4" type="1">
<li><strong>å‡½æ•°ç»“è¯­ (Epilogue)</strong>:</li>
</ol>
<ul>
<li><p>å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå‡†å¤‡è¿”å›ã€‚</p></li>
<li><p>é‡Šæ”¾å±€éƒ¨å˜é‡çš„æ ˆç©ºé—´ (<code>ADD SP, SP, #...</code>)ã€‚</p></li>
<li><p>ä½¿ç”¨ <code>POP</code> æˆ– <code>LDP</code>
ä»æ ˆä¸­æ¢å¤ä¹‹å‰ä¿å­˜çš„å¯„å­˜å™¨ã€‚</p></li>
<li><p>ä½¿ç”¨ <code>BX LR</code> æˆ– <code>RET</code> æˆ–
<code>POP {PC}</code> è¿”å›ã€‚</p></li>
</ul>
<ol start="5" type="1">
<li><strong>è¿”å›å€¼</strong>:</li>
</ol>
<ul>
<li><p>ç®€å•çš„è¿”å›å€¼ï¼ˆæ•´æ•°ã€æŒ‡é’ˆï¼‰å­˜æ”¾åœ¨ <code>R0</code> (32-bit) æˆ–
<code>X0</code> (64-bit) ä¸­ã€‚ ___ ### ä» C ä»£ç åˆ°æ±‡ç¼–</p></li>
<li><p>*C ä»£ç :**</p></li>
</ul>
<div class="sourceCode" id="cb567"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add_one<span class="op">(</span><span class="dt">int</span> a<span class="op">)</span> <span class="op">{</span></span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> a <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>BX LR ; return</p>
<pre><code>RET ; return
</code></pre>
<ul>
<li><strong>ä¼ªä»£ç è§†å›¾ (Pseudocode View)</strong>: IDA Pro (F5 é”®) å’Œ
Ghidra çš„åç¼–è¯‘å™¨å¯ä»¥ç›´æ¥å°†æ±‡ç¼–ä»£ç è½¬æ¢æˆå¯è¯»æ€§å¾ˆé«˜çš„ C
ä¼ªä»£ç ï¼Œè¿™æ˜¯é™æ€åˆ†æçš„åˆ©å™¨ã€‚é€šå¸¸å…ˆçœ‹ä¼ªä»£ç ï¼Œé‡åˆ°ä¸ç†è§£çš„åœ°æ–¹å†å›å¤´çœ‹æ±‡ç¼–ã€‚</li>
</ul>
<!-- 04-Reference/Foundations/art_runtime.md -->
<h1 id="android-è¿è¡Œæ—¶-art-æ·±åº¦è§£æ">android è¿è¡Œæ—¶ (ART) æ·±åº¦è§£æ</h1>
<p>ART (Android Runtime) æ˜¯ Android 5.0 (Lollipop)
ä¹‹åé»˜è®¤çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ç¯å¢ƒï¼Œå–ä»£äº†æ—§çš„ Dalvik è™šæ‹Ÿæœº (DVM)ã€‚ART
çš„å¼•å…¥æ˜¾è‘—æ”¹å˜äº† Android
åº”ç”¨çš„æ‰§è¡Œæ–¹å¼ï¼Œæ—¨åœ¨æé«˜åº”ç”¨çš„æ€§èƒ½ã€å¯åŠ¨é€Ÿåº¦å’Œç”µæ± ç»­èˆªã€‚ ___ ## ç›®å½• -
<a href="#android-è¿è¡Œæ—¶-art-æ·±åº¦è§£æ">Android è¿è¡Œæ—¶ (ART) æ·±åº¦è§£æ</a>
- <a href="#ç›®å½•">ç›®å½•</a> - <a href="#æ ¸å¿ƒæœºåˆ¶aot-vs-jit">æ ¸å¿ƒæœºåˆ¶ï¼šAOT
vs JIT</a> - <a href="#dalvik-çš„-jit-just-in-time">Dalvik çš„ JIT
(Just-In-Time)</a></p>
<ul>
<li><p><a href="#art-çš„-aot-ahead-of-time">ART çš„ AOT
(Ahead-Of-Time)</a></p></li>
<li><p><a href="#æ··åˆç¼–è¯‘-aot--jit">æ··åˆç¼–è¯‘ (AOT + JIT)</a></p></li>
<li><p><a href="#art-ç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼">ART ç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼</a></p></li>
<li><p><a href="#oat-æ–‡ä»¶-oat">OAT æ–‡ä»¶ (<code>.oat</code>)</a></p></li>
<li><p><a href="#vdex-æ–‡ä»¶-vdex">VDEX æ–‡ä»¶
(<code>.vdex</code>)</a></p></li>
<li><p><a href="#art-æ–‡ä»¶-art-image">ART æ–‡ä»¶ (<code>.art</code>)
(Image)</a></p></li>
<li><p><a href="#art-vs-dalvik">ART vs.Â Dalvik</a></p></li>
<li><p><a href="#å¯¹é€†å‘å·¥ç¨‹çš„å½±å“">å¯¹é€†å‘å·¥ç¨‹çš„å½±å“</a> ___ ###
æ ¸å¿ƒæœºåˆ¶ï¼šAOT vs JIT</p></li>
</ul>
<p>!!! question â€œæ€è€ƒï¼šä¸ºä»€ä¹ˆé€†å‘å·¥ç¨‹å¸ˆå¿…é¡»ç†è§£ ARTï¼Ÿâ€
ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œæˆ‘åªå…³å¿ƒåº”ç”¨çš„ Java ä»£ç å’ŒåŠ å¯†ç®—æ³•ï¼ŒART
çš„ç¼–è¯‘æœºåˆ¶ä¸æˆ‘æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿâ€</p>
<ul>
<li><p>*å®é™…åœºæ™¯å‘Šè¯‰ä½ ç­”æ¡ˆ**ï¼š</p></li>
<li><p><strong>Frida Hook å¤±è´¥</strong>ï¼šä½ å†™çš„ Hook è„šæœ¬åœ¨ Android 4.x
ä¸Šå¥½ç”¨ï¼Œåœ¨ 8.0+ ä¸Šå°±ä¸å·¥ä½œäº†â€”â€”å› ä¸º ART çš„ AOT
ç¼–è¯‘æ”¹å˜äº†æ–¹æ³•çš„æ‰§è¡Œæ–¹å¼</p></li>
<li><p><strong>è„±å£³å›°å¢ƒ</strong>ï¼šä½ ç”¨ä¼ ç»Ÿæ–¹æ³• dump
DEXï¼Œç»“æœå‘ç°å…³é”®ç±»æ ¹æœ¬ä¸åœ¨ DEX é‡Œâ€”â€”å®ƒä»¬åœ¨è¿è¡Œæ—¶è¢«è§£å¯†åç›´æ¥ç¼–è¯‘æˆäº†
OAT</p></li>
<li><p><strong>æ€§èƒ½åˆ†æ</strong>ï¼šä¸ºä»€ä¹ˆåŒæ ·çš„ä»£ç åœ¨ä¸åŒ Android
ç‰ˆæœ¬ä¸Šæ€§èƒ½å·®å¼‚å·¨å¤§ï¼Ÿæ··åˆç¼–è¯‘æ¨¡å¼æ˜¯å…³é”®</p></li>
<li><p><strong>åè°ƒè¯•å¯¹æŠ—</strong>ï¼šæŸäº› App ä¼šæ£€æµ‹ OAT
æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œæˆ–è€…åˆ©ç”¨ <code>dex2oat</code> çš„æ—¶æœºæ¥è¿›è¡Œåè°ƒè¯•</p></li>
<li><p>*æ ¸å¿ƒè¦ç‚¹**ï¼š</p></li>
<li><p>Android 5.0+ çš„åº”ç”¨ä¸å†æ˜¯ç®€å•çš„â€DEX å­—èŠ‚ç â€æ‰§è¡Œ</p></li>
<li><p>çœŸæ­£æ‰§è¡Œçš„æ˜¯ <strong>æœ¬åœ°æœºå™¨ç </strong>ï¼ˆOAT æ–‡ä»¶ï¼‰</p></li>
<li><p>ç†è§£ DEX â†’ VDEX â†’ OAT çš„è½¬æ¢æµç¨‹ï¼Œæ‰èƒ½åº”å¯¹ç°ä»£ Android
é€†å‘</p></li>
</ul>
<h4 id="dalvik-çš„-jit-just-in-time">Dalvik çš„ JIT (Just-In-Time)</h4>
<p>åœ¨ Android 4.4 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ï¼ŒDalvik è™šæ‹Ÿæœºä½¿ç”¨ JIT ç¼–è¯‘ã€‚</p>
<ul>
<li><p><strong>å·¥ä½œæ–¹å¼</strong>: åº”ç”¨æ¯æ¬¡è¿è¡Œæ—¶ï¼ŒDalvik ä¼šè§£é‡Šæ‰§è¡Œ DEX
å­—èŠ‚ç ã€‚å¯¹äºé¢‘ç¹æ‰§è¡Œçš„â€çƒ­ç‚¹ä»£ç â€ (hotspot)ï¼ŒJIT
ç¼–è¯‘å™¨ä¼šå°†å…¶åŠ¨æ€åœ°ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç å¹¶ç¼“å­˜ã€‚</p></li>
<li><p><strong>ä¼˜ç‚¹</strong>: å®‰è£…é€Ÿåº¦å¿«ï¼Œä¸å ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€‚</p></li>
<li><p><strong>ç¼ºç‚¹</strong>:
åº”ç”¨å¯åŠ¨å’Œè¿è¡ŒæœŸé—´éœ€è¦æŒç»­è¿›è¡Œè§£é‡Šå’Œç¼–è¯‘ï¼Œå¯¼è‡´å¯åŠ¨æ…¢ã€è€—ç”µå¤šã€‚</p></li>
</ul>
<h4 id="art-çš„-aot-ahead-of-time">ART çš„ AOT (Ahead-Of-Time)</h4>
<p>ART æœ€åˆçš„è®¾è®¡æ˜¯çº¯ AOT ç¼–è¯‘ã€‚</p>
<ul>
<li><p><strong>å·¥ä½œæ–¹å¼</strong>:
åœ¨åº”ç”¨<strong>å®‰è£…æ—¶</strong>ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ <code>dex2oat</code> å·¥å…·ï¼Œå°†
APK ä¸­çš„ <code>classes.dex</code> æ–‡ä»¶å®Œæ•´åœ°ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œå¹¶ä»¥ OAT
æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ã€‚</p></li>
<li><p><strong>ä¼˜ç‚¹</strong>:</p></li>
<li><p><strong>è¿è¡Œé€Ÿåº¦å¿«</strong>:
åº”ç”¨ç›´æ¥æ‰§è¡Œæœ¬åœ°æœºå™¨ç ï¼Œæ— éœ€å®æ—¶ç¼–è¯‘ï¼Œæ€§èƒ½å’Œå¯åŠ¨é€Ÿåº¦éƒ½å¤§å¤§æå‡ã€‚</p></li>
<li><p><strong>æ›´çœç”µ</strong>: CPU åœ¨è¿è¡Œæ—¶è´Ÿæ‹…æ›´è½»ã€‚</p></li>
<li><p><strong>ç¼ºç‚¹</strong>:</p></li>
<li><p><strong>å®‰è£…æ—¶é—´é•¿</strong>:
åº”ç”¨å®‰è£…è¿‡ç¨‹éœ€è¦é¢å¤–çš„ç¼–è¯‘æ—¶é—´ã€‚</p></li>
<li><p><strong>å ç”¨ç©ºé—´å¤§</strong>: é¢„ç¼–è¯‘çš„ OAT
æ–‡ä»¶ä¼šå ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´ã€‚</p></li>
</ul>
<h4 id="æ··åˆç¼–è¯‘-aot-jit">æ··åˆç¼–è¯‘ (AOT + JIT)</h4>
<p>ä» Android 7.0 (Nougat) å¼€å§‹ï¼ŒART å¼•å…¥äº†ç»“åˆ JIT
çš„æ··åˆç¼–è¯‘æ¨¡å¼ï¼Œä»¥å¹³è¡¡ä¸Šè¿°ä¼˜ç¼ºç‚¹ã€‚</p>
<ul>
<li><strong>å·¥ä½œæµç¨‹</strong>:</li>
</ul>
<ol type="1">
<li><p><strong>åˆæ¬¡å®‰è£…</strong>: åº”ç”¨å®‰è£…é€Ÿåº¦å¾ˆå¿«ï¼Œä¸è¿›è¡Œ AOT
ç¼–è¯‘ã€‚</p></li>
<li><p><strong>é¦–æ¬¡è¿è¡Œ</strong>: åº”ç”¨ä»£ç ç”±è§£é‡Šå™¨æ‰§è¡Œï¼ŒåŒæ—¶ JIT
ç¼–è¯‘å™¨ä¼šä»‹å…¥ï¼Œç¼–è¯‘çƒ­ç‚¹ä»£ç ã€‚åœ¨æ­¤æœŸé—´ï¼ŒART
ä¼šç”Ÿæˆä¸€ä»½<strong>ä»£ç æ‰§è¡Œé¢‘ç‡çš„åˆ†ææ–‡ä»¶ (Profile)</strong>ã€‚</p></li>
<li><p><strong>è®¾å¤‡ç©ºé—²æ—¶</strong>:
å½“è®¾å¤‡å¤„äºç©ºé—²çŠ¶æ€å¹¶æ­£åœ¨å……ç”µæ—¶ï¼ŒAndroid
ç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ªåå°ä¼˜åŒ–ä»»åŠ¡ã€‚è¯¥ä»»åŠ¡ä¼šæ ¹æ®ä¹‹å‰æ”¶é›†çš„ Profile
ä¿¡æ¯ï¼Œ<strong>åªå¯¹é‚£äº›é¢‘ç¹æ‰§è¡Œçš„çƒ­ç‚¹æ–¹æ³•è¿›è¡Œ AOT
ç¼–è¯‘</strong>ï¼Œå¹¶ç”Ÿæˆæ–°çš„ OAT æ–‡ä»¶ã€‚</p></li>
</ol>
<ul>
<li><strong>ä¼˜ç‚¹</strong>: å…¼é¡¾äº†å®‰è£…é€Ÿåº¦ã€è¿è¡Œæ€§èƒ½å’Œå­˜å‚¨å ç”¨ï¼Œæ˜¯ç›®å‰
Android çš„æ ‡å‡†æ‰§è¡Œæ¨¡å¼ã€‚ ___ ### ART ç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼</li>
</ul>
<p>å½“ ART å¤„ç†ä¸€ä¸ª APK æ—¶ï¼Œä¼šåœ¨
<code>/data/dalvik-cache/&lt;arch&gt;/</code>
ç›®å½•ä¸‹ç”Ÿæˆä¸€äº›ä¼˜åŒ–åçš„æ–‡ä»¶ã€‚</p>
<h4 id="oat-æ–‡ä»¶-.oat">OAT æ–‡ä»¶ (<code>.oat</code>)</h4>
<p>OAT (Optimized Android file format) æ–‡ä»¶æ˜¯æ ¸å¿ƒã€‚å®ƒåŒ…å«äº†ç”±
<code>dex2oat</code> ä» DEX å­—èŠ‚ç ç¼–è¯‘è€Œæ¥çš„<strong>æœ¬åœ°æœºå™¨ç </strong>
(ARM æ±‡ç¼–)ã€‚ä¸€ä¸ª OAT æ–‡ä»¶é€šå¸¸åŒ…å«ï¼š</p>
<ul>
<li><p><strong>oatdata</strong>: åŒ…å«å·²ç¼–è¯‘çš„æœ¬åœ°ä»£ç ã€‚</p></li>
<li><p><strong>oatexec</strong>: åŒ…å«å¯æ‰§è¡Œçš„æœ¬åœ°ä»£ç ã€‚</p></li>
<li><p><strong>oatlastword</strong>: æ ‡è¯† OAT æ–‡ä»¶çš„ç»“æŸã€‚</p></li>
</ul>
<h4 id="vdex-æ–‡ä»¶-.vdex">VDEX æ–‡ä»¶ (<code>.vdex</code>)</h4>
<p>ä» Android 8.0 (Oreo) å¼€å§‹å¼•å…¥ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œç³»ç»Ÿä¼šå°†åŸå§‹çš„
<code>classes.dex</code> æ–‡ä»¶è¿›è¡Œâ€è§£å‹ç¼©â€å’Œâ€éªŒè¯â€ï¼Œç”Ÿæˆä¸€ä¸ª VDEX
(<code>Verified DEX</code>) æ–‡ä»¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li><p><strong>å¿«é€ŸéªŒè¯</strong>: ç³»ç»Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ VDEX
æ–‡ä»¶ï¼Œè·³è¿‡äº†å¯¹åŸå§‹ DEX çš„éªŒè¯æ­¥éª¤ï¼ŒåŠ å¿«äº†åŠ è½½é€Ÿåº¦ã€‚</p></li>
<li><p><strong>å†…å®¹</strong>: VDEX
æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœªå‹ç¼©çš„ã€å¸¦æœ‰é¢å¤–ä¾èµ–å’ŒéªŒè¯ä¿¡æ¯çš„ DEX
æ–‡ä»¶ã€‚<code>dex2oat</code> ä¼šç›´æ¥ä½¿ç”¨ VDEX æ–‡ä»¶ä½œä¸ºè¾“å…¥æ¥ç”Ÿæˆ OAT
æ–‡ä»¶ã€‚</p></li>
</ul>
<h4 id="art-æ–‡ä»¶-.art-image">ART æ–‡ä»¶ (<code>.art</code>) (Image)</h4>
<p>è¿™æ˜¯ä¸€ä¸ªé¢„åŠ è½½çš„é•œåƒæ–‡ä»¶ï¼ŒåŒ…å«äº†ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦é¢„åŠ è½½çš„ä¸€äº›æ ¸å¿ƒç±»ï¼ˆå¦‚
<code>java.lang.Object</code>ï¼‰ã€‚å½“ Zygote
è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šç›´æ¥å°†è¿™ä¸ªé•œåƒæ˜ å°„åˆ°å†…å­˜ï¼Œä»è€Œé¿å…äº†å¯¹è¿™äº›å¸¸ç”¨ç±»è¿›è¡Œé‡å¤çš„åˆå§‹åŒ–ï¼ŒåŠ å¿«äº†æ‰€æœ‰åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ã€‚</p>
<ul>
<li>*æ€»ç»“**: åœ¨ç°ä»£ Android ç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œæµç¨‹æ˜¯ï¼š<code>classes.dex</code>
-&gt; (å®‰è£…æ—¶) <code>.vdex</code> -&gt; (åå°ä¼˜åŒ–æ—¶) <code>.oat</code>ã€‚
___ ### ART vs.Â Dalvik</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">ART</th>
<th style="text-align: left;">Dalvik</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>ç¼–è¯‘æ¨¡å¼</strong></td>
<td style="text-align: left;">AOT + JIT æ··åˆç¼–è¯‘</td>
<td style="text-align: left;">JIT</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ‰§è¡Œå•å…ƒ</strong></td>
<td style="text-align: left;">æœ¬åœ°æœºå™¨ç  (ä¸»è¦)</td>
<td style="text-align: left;">DEX å­—èŠ‚ç </td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ€§èƒ½</strong></td>
<td style="text-align: left;">æ›´é«˜</td>
<td style="text-align: left;">è¾ƒä½</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¯åŠ¨é€Ÿåº¦</strong></td>
<td style="text-align: left;">æ›´å¿«</td>
<td style="text-align: left;">è¾ƒæ…¢</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å®‰è£…æ—¶é—´</strong></td>
<td style="text-align: left;">æ›´å¿« (æ··åˆæ¨¡å¼ä¸‹)</td>
<td style="text-align: left;">å¿«</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å­˜å‚¨å ç”¨</strong></td>
<td style="text-align: left;">æ›´é«˜ (å›  OAT æ–‡ä»¶)</td>
<td style="text-align: left;">è¾ƒä½</td>
</tr>
<tr>
<td style="text-align: left;"><strong>åƒåœ¾å›æ”¶ (GC)</strong></td>
<td style="text-align: left;">ä¼˜åŒ–æ›´å¥½ï¼Œæš‚åœæ—¶é—´æ›´çŸ­</td>
<td style="text-align: left;">æ•ˆç‡è¾ƒä½</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="å¯¹é€†å‘å·¥ç¨‹çš„å½±å“">å¯¹é€†å‘å·¥ç¨‹çš„å½±å“</h3>
<p>!!! tip â€œå®æˆ˜æŠ€å·§ï¼šä» ART æœºåˆ¶æ‰¾åˆ°çªç ´å£â€ ç†è§£ ART
çš„å·¥ä½œåŸç†ï¼Œèƒ½è®©ä½ æ‰¾åˆ°å¾ˆå¤šâ€éå¸¸è§„â€çš„é€†å‘æ€è·¯ï¼š</p>
<ul>
<li>*è„±å£³æ–°æ€è·¯**ï¼š</li>
</ul>
<ol type="1">
<li><strong>ç›‘æ§ <code>dex2oat</code>
è°ƒç”¨</strong>ï¼šæŸäº›å£³ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨
<code>dex2oat</code>ï¼Œç›‘æ§å…¶å‘½ä»¤è¡Œå‚æ•°èƒ½å‘ç°éšè—çš„ DEX</li>
<li><strong>ä» VDEX æå– DEX</strong>ï¼šAndroid 8.0+ çš„ VDEX
æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ DEXï¼Œç”¨ <code>vdexExtractor</code> å¯ä»¥å¿«é€Ÿæå–</li>
<li><strong>ä» OAT è¿˜åŸ DEX</strong>ï¼šä½¿ç”¨ <code>oat2dex</code>
ç­‰å·¥å…·ä»ç¼–è¯‘åçš„ OAT æ–‡ä»¶åæ¨åŸå§‹ DEX</li>
</ol>
<ul>
<li><p>*Hook ä¼˜åŒ–ç­–ç•¥**ï¼š</p></li>
<li><p><strong>Java æ–¹æ³• Hook</strong>ï¼šä¼˜å…ˆ Hook Java å±‚
APIï¼Œæ›´ç¨³å®šé€šç”¨</p></li>
<li><p><strong>Native Hook</strong>ï¼šå½“ Java Hook å¤±æ•ˆæ—¶ï¼Œæ‰¾åˆ° ART
ç¼–è¯‘åçš„æœºå™¨ç åœ°å€è¿›è¡Œ inline hook</p></li>
<li><p><strong>GOT/PLT Hook</strong>ï¼šHook
åŠ¨æ€é“¾æ¥åº“çš„å¯¼å…¥è¡¨ï¼Œç»•è¿‡ä»£ç å®Œæ•´æ€§æ£€æŸ¥</p></li>
<li><p><strong>Hook ç‚¹çš„å˜åŒ–</strong>: ç”±äºå­˜åœ¨ AOT ç¼–è¯‘ï¼ŒFrida/Xposed
ç­‰æ¡†æ¶çš„ Hook åŸç†ä¹Ÿéœ€è¦é€‚åº”ã€‚å®ƒä»¬ä¸ä»…ä»…æ˜¯ Hook Java
æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯æ‰¾åˆ°äº†è¯¥æ–¹æ³•ç¼–è¯‘åçš„æœ¬åœ°æœºå™¨ç åœ°å€ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼ˆinline
hookï¼‰ã€‚</p></li>
<li><p><strong>è„±å£³çš„å¤æ‚æ€§</strong>: è®¸å¤šåŠ å›ºå‚å•†åˆ©ç”¨ ART çš„ AOT
æœºåˆ¶ã€‚ä»–ä»¬å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†å¹¶åŠ è½½ DEXï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨
<code>dex2oat</code> ç”Ÿæˆ OAT æ–‡ä»¶æ¥æ‰§è¡Œã€‚è¿™ä½¿å¾—ä¼ ç»Ÿçš„ DEX Dump
æ–¹æ³•å¤±æ•ˆï¼Œéœ€è¦å¯¹ OAT æ–‡ä»¶æ ¼å¼å’Œ <code>dex2oat</code>
çš„è°ƒç”¨æ—¶æœºè¿›è¡Œç›‘æ§ã€‚</p></li>
<li><p><strong>OAT æ–‡ä»¶åˆ†æ</strong>: é«˜çº§é€†å‘åˆ†ææœ‰æ—¶éœ€è¦ç›´æ¥åˆ†æ OAT
æ–‡ä»¶ã€‚æœ‰ä¸€äº›å·¥å…·ï¼ˆå¦‚ <code>oatdump</code>ï¼‰å¯ä»¥ä» OAT æ–‡ä»¶ä¸­æå–å‡ºåŸå§‹çš„
DEX æ•°æ®æˆ–æŸ¥çœ‹ç¼–è¯‘åçš„æ±‡ç¼–ä»£ç ã€‚</p></li>
<li><p><strong>å¯»æ‰¾ä»£ç çš„æºå¤´</strong>: å³ä½¿ä»£ç è¢« AOT
ç¼–è¯‘ï¼Œå…¶å…ƒæ•°æ®ä¾ç„¶ä¸åŸå§‹çš„ DEX
æ–‡ä»¶ç›¸å…³è”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„åˆ†æèµ·ç‚¹é€šå¸¸è¿˜æ˜¯ä» <code>classes.dex</code>
åç¼–è¯‘å‡ºçš„ Java ä»£ç å¼€å§‹ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸€å¤´æ‰è¿› OAT
æ–‡ä»¶çš„æ±‡ç¼–ä»£ç ä¸­ã€‚</p></li>
</ul>
<!-- 04-Reference/Foundations/dex_format.md -->
<h1 id="dex-æ–‡ä»¶æƒå¨æŒ‡å—">DEX æ–‡ä»¶æƒå¨æŒ‡å—</h1>
<p>DEX (Dalvik Executable) æ–‡ä»¶æ˜¯ Android
æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚å®ƒä»¬æ˜¯ä¸“é—¨ä¸ºåœ¨å†…å­˜å’Œå¤„ç†å™¨é€Ÿåº¦å—é™çš„è®¾å¤‡ä¸Šé«˜æ•ˆè¿è¡Œè€Œè®¾è®¡çš„ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨
DEX æ–‡ä»¶çš„å®šä¹‰ã€æ ¼å¼ã€è¿è¡ŒåŸç†ä»¥åŠç›¸å…³å·¥å…·ã€‚</p>
<p>!!! question â€œæ€è€ƒï¼šç†è§£ DEX æ ¼å¼çš„å®æˆ˜ä»·å€¼â€ å¾ˆå¤šåˆå­¦è€…ä¼šé—®ï¼šâ€œDEX
æ ¼å¼è¿™ä¹ˆå¤æ‚ï¼Œæˆ‘çœŸçš„éœ€è¦äº†è§£è¿™äº›åº•å±‚ç»†èŠ‚å—ï¼Ÿâ€</p>
<p>è€ƒè™‘è¿™äº›å®é™…åœºæ™¯ï¼š</p>
<ul>
<li><strong>åŠ å›ºå¯¹æŠ—</strong>ï¼šå½“ App ä½¿ç”¨äº† DEX
åŠ å£³ï¼ˆå¦‚æ¢†æ¢†ã€360ï¼‰ï¼Œä½ éœ€è¦çŸ¥é“ DEX
çš„é­”æ•°ã€ç­¾åå­—æ®µåœ¨å“ªï¼Œæ‰èƒ½åˆ¤æ–­è„±å£³æ˜¯å¦å®Œæ•´</li>
<li><strong>åŠ¨æ€åŠ è½½åˆ†æ</strong>ï¼šå¾ˆå¤š App ä¼šåœ¨è¿è¡Œæ—¶è§£å¯†å¹¶åŠ è½½éšè—çš„
DEXï¼Œç†è§£ <code>Class Defs</code>
ç»“æ„èƒ½å¸®ä½ å¿«é€Ÿå®šä½è¢«éšè—çš„æ¶æ„ä»£ç </li>
<li><strong>Multi-DEX å®šä½</strong>ï¼šå½“ä½ æƒ³ Hook
æŸä¸ªç±»ï¼Œä½†ä¸çŸ¥é“å®ƒåœ¨å“ªä¸ª <code>classes.dex</code> ä¸­æ—¶ï¼Œç†è§£ String IDs
å’Œ Type IDs èƒ½å¸®ä½ å¿«é€Ÿæœç´¢</li>
<li><strong>æ–¹æ³•æ•°ä¼˜åŒ–</strong>ï¼šç†è§£ 65536 æ–¹æ³•æ•°é™åˆ¶çš„æ ¹æœ¬åŸå› ï¼ˆMethod
IDs ç´¢å¼•ç”¨ 16 ä½ï¼‰ï¼Œèƒ½å¸®ä½ æ›´å¥½åœ°è¿›è¡Œæ¨¡å—åŒ–è®¾è®¡</li>
</ul>
<p>DEX
æ ¼å¼ä¸æ˜¯å­¦æœ¯çŸ¥è¯†ï¼Œè€Œæ˜¯ä½ ç ´è§£åŠ å›ºã€åˆ†ææ¶æ„ä»£ç çš„<strong>æ‰‹æœ¯åˆ€</strong>ã€‚
<strong><em> ## ç›®å½• 1. <a
href="#å®šä¹‰ä¸è§’è‰²"><strong>å®šä¹‰ä¸è§’è‰²</strong>ï¼šä»€ä¹ˆæ˜¯ DEX æ–‡ä»¶ï¼Ÿ</a> 2.
<a href="#dex-vs-class"><strong>DEX vs.Â CLASS</strong>ï¼šä¸ Java
å­—èŠ‚ç çš„å¯¹æ¯”</a> 3. <a href="#dex-æ–‡ä»¶ç»“æ„"><strong>DEX
æ–‡ä»¶ç»“æ„</strong>ï¼šæ·±å…¥å‰–ææ ¼å¼</a> 4. <a
href="#è¿è¡ŒåŸç†"><strong>è¿è¡ŒåŸç†</strong>ï¼šDEX æ–‡ä»¶å¦‚ä½•è¢«æ‰§è¡Œï¼Ÿ</a> 5.
<a href="#multi-dex"><strong>Multi-DEX</strong>ï¼šåº”å¯¹æ–¹æ³•æ•°é™åˆ¶</a> 6.
<a href="#dex-åˆ†æä¸å¤„ç†å·¥å…·"><strong>DEX åˆ†æä¸å¤„ç†å·¥å…·</strong></a>
</em></strong> ### å®šä¹‰ä¸è§’è‰²</p>
<ul>
<li>*DEX æ–‡ä»¶<strong>æ˜¯åŒ…å«äº† Android
åº”ç”¨ä»£ç çš„å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨æ‰“åŒ…ï¼ˆBuildï¼‰è¿‡ç¨‹ä¸­ï¼ŒJava ç¼–è¯‘å™¨é¦–å…ˆå°†
<code>.java</code> æºç æ–‡ä»¶ç¼–è¯‘æˆæ ‡å‡†çš„ Java å­—èŠ‚ç  <code>.class</code>
æ–‡ä»¶ã€‚ç„¶åï¼ŒAndroid SDK ä¸­çš„ <code>d8</code> å·¥å…·ï¼ˆæ—§ç‰ˆæœ¬ä¸º
<code>dx</code>ï¼‰ä¼šå°†æ‰€æœ‰çš„ <code>.class</code>
æ–‡ä»¶ï¼ˆåŒ…æ‹¬é¡¹ç›®ä»£ç å’Œä¾èµ–åº“ï¼‰ä¼˜åŒ–å¹¶åˆå¹¶æˆ </strong>ä¸€ä¸ªæˆ–å¤šä¸ª**
<code>classes.dex</code> æ–‡ä»¶ã€‚</li>
</ul>
<p>è¿™ä¸ª <code>classes.dex</code> æ–‡ä»¶æœ€ç»ˆè¢«æ‰“åŒ…è¿› APK (Android Package)
ä¸­ã€‚å½“ç”¨æˆ·å®‰è£…å¹¶è¿è¡Œåº”ç”¨æ—¶ï¼ŒAndroid ç³»ç»Ÿï¼ˆç‰¹åˆ«æ˜¯ ARTï¼‰ä¼šç›´æ¥æ‰§è¡Œ DEX
æ–‡ä»¶ä¸­çš„ä»£ç ã€‚</p>
<ul>
<li><p>*æ ¸å¿ƒè§’è‰²**ï¼š</p></li>
<li><p><strong>ç´§å‡‘æ€§</strong>:
å°†æ‰€æœ‰ç±»æ–‡ä»¶åˆå¹¶ï¼Œå¹¶å…±äº«å­—ç¬¦ä¸²å’Œå¸¸é‡ï¼Œå¤§å¤§å‡å°‘äº†æ–‡ä»¶ä½“ç§¯å’Œ I/O
å¼€é”€ã€‚</p></li>
<li><p><strong>é«˜æ•ˆæ€§</strong>:
é‡‡ç”¨åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†ï¼Œæ›´æ¥è¿‘åº•å±‚ç¡¬ä»¶ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”åŸºäºæ ˆçš„ JVM
æ›´é«˜ã€‚</p></li>
<li><p><strong>ç§»åŠ¨ä¼˜åŒ–</strong>: ä¸“ä¸ºå†…å­˜æœ‰é™çš„ç§»åŠ¨è®¾å¤‡è®¾è®¡ã€‚</p></li>
</ul>
<p>æœ¬æ–‡æ¡£å‚è€ƒäº† Android å®˜æ–¹å…³äº <a
href="https://source.android.com/docs/core/dalvik/dex-format">DEX
æ–‡ä»¶æ ¼å¼</a> çš„è¯´æ˜ã€‚ ___ ### DEX vs.Â CLASS</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th><code>.class</code> æ–‡ä»¶ (JVM)</th>
<th><code>.dex</code> æ–‡ä»¶ (ART/Dalvik)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ–‡ä»¶æ•°é‡</strong></td>
<td>æ¯ä¸ªæºæ–‡ä»¶å¯¹åº”ä¸€ä¸ª <code>.class</code> æ–‡ä»¶</td>
<td>æ‰€æœ‰ <code>.class</code> æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæˆ–å¤šä¸ª <code>.dex</code>
æ–‡ä»¶</td>
</tr>
<tr>
<td><strong>æŒ‡ä»¤é›†æ¶æ„</strong></td>
<td><strong>åŸºäºæ ˆ (Stack-based)</strong></td>
<td><strong>åŸºäºå¯„å­˜å™¨ (Register-based)</strong></td>
</tr>
<tr>
<td><strong>å¸¸é‡æ± </strong></td>
<td>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å¸¸é‡æ± </td>
<td>æ‰€æœ‰ç±»å…±äº«ä¸€ä¸ªå…¨å±€çš„å­—ç¬¦ä¸²å’Œå¸¸é‡æ± </td>
</tr>
<tr>
<td><strong>å†—ä½™ä¿¡æ¯</strong></td>
<td>å¤§é‡å†—ä½™å­—ç¬¦ä¸²ï¼ˆå¦‚ç±»åã€æ–¹æ³•åï¼‰</td>
<td>å­—ç¬¦ä¸²å’Œå¸¸é‡å»é‡ï¼Œé€šè¿‡ç´¢å¼•å¼•ç”¨ï¼Œå†—ä½™å°‘</td>
</tr>
<tr>
<td><strong>å¹³å°</strong></td>
<td>ä»»ä½•æœ‰ JVM çš„åœ°æ–¹</td>
<td>Android å¹³å°</td>
</tr>
<tr>
<td><strong>è½¬æ¢å·¥å…·</strong></td>
<td><code>javac</code></td>
<td><code>javac</code> -&gt; <code>d8</code>/<code>dx</code></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="dex-æ–‡ä»¶ç»“æ„">DEX æ–‡ä»¶ç»“æ„</h3>
<p>DEX æ–‡ä»¶æ ¼å¼éå¸¸ç´§å‡‘å’Œé«˜æ•ˆï¼Œå…¶ç»“æ„å¯ä»¥å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼Œå¹¶ç”±ä¸€ä¸ª
<code>header</code> æ¥æè¿°æ•´ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®å’Œåç§»é‡ã€‚</p>
<p>!!! tip â€œé€†å‘æŠ€å·§ï¼šä»ç»“æ„å…¥æ‰‹å¿«é€Ÿå®šä½â€ é¢å¯¹ä¸€ä¸ªé™Œç”Ÿçš„ DEX
æ–‡ä»¶ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ä½ æ„Ÿå…´è¶£çš„ä»£ç ï¼Ÿ</p>
<ul>
<li>*è‡ªé¡¶å‘ä¸‹çš„åˆ†æç­–ç•¥**ï¼š</li>
</ul>
<ol type="1">
<li><strong>çœ‹ Header</strong>ï¼šæ£€æŸ¥é­”æ•°ç¡®è®¤æ–‡ä»¶å®Œæ•´æ€§ï¼ŒæŸ¥çœ‹
<code>class_defs_size</code> äº†è§£æœ‰å¤šå°‘ä¸ªç±»</li>
<li><strong>æœ String IDs</strong>ï¼šç”¨ <code>dexdump</code> æˆ–
<code>strings</code> æœç´¢å…³é”®å­—ç¬¦ä¸²ï¼ˆå¦‚ â€œencryptâ€,
â€œhttp://â€ï¼‰ï¼Œå®šä½å¯ç–‘ä»£ç </li>
<li><strong>æŸ¥ Method IDs</strong>ï¼šé€šè¿‡æ–¹æ³•åç´¢å¼•æ‰¾åˆ°å…·ä½“å®ç°</li>
<li><strong>è·³ Class Defs</strong>ï¼šç›´æ¥å®šä½åˆ°ç›®æ ‡ç±»çš„å®Œæ•´å®šä¹‰</li>
<li><strong>è¯» Code Item</strong>ï¼šæœ€åæ‰æ·±å…¥å­—èŠ‚ç ç»†èŠ‚</li>
</ol>
<p>è¿™ç§â€çº¿ç´¢é©±åŠ¨â€çš„æ–¹æ³•ï¼Œæ¯”æ¼«æ— ç›®çš„åœ°æµè§ˆä»£ç é«˜æ•ˆå¾—å¤šã€‚</p>
<!-- ![DEX File Structure](../images/dex-format.png) -->
<p>A DEX file consists of several main sections:</p>
<h3 id="å¤´éƒ¨-header">1. å¤´éƒ¨ (Header)</h3>
<ul>
<li><p><strong>Header</strong>:
æ–‡ä»¶å¤´ï¼ŒåŒ…å«é­”æ•°ï¼ˆ<code>dex\n035\0</code>ï¼‰ã€æ ¡éªŒå’Œã€ç­¾åï¼Œä»¥åŠæŒ‡å‘å…¶ä»–æ•°æ®ç»“æ„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€ç±»å®šä¹‰ç­‰ï¼‰çš„åç§»é‡å’Œå¤§å°ã€‚</p></li>
<li><p><strong>String IDs</strong>: å­—ç¬¦ä¸²æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚åŒ…å« DEX
æ–‡ä»¶ä¸­ç”¨åˆ°çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼ˆå¦‚ç±»åã€æ–¹æ³•åã€å˜é‡åã€å­—ç¬¦ä¸²å¸¸é‡ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªå­—ç¬¦ä¸²åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„
IDã€‚</p></li>
<li><p><strong>Type IDs</strong>:
ç±»å‹æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚åŒ…å«ä»£ç ä¸­ç”¨åˆ°çš„æ‰€æœ‰ç±»å‹ï¼ˆç±»ã€æ¥å£ã€æ•°ç»„ã€åŸºæœ¬ç±»å‹ï¼‰ï¼Œå¹¶æŒ‡å‘
<code>String IDs</code> ä¸­çš„ç›¸åº”å­—ç¬¦ä¸²ã€‚</p></li>
<li><p><strong>Proto IDs</strong>:
æ–¹æ³•åŸå‹æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚å®šä¹‰äº†æ–¹æ³•çš„è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹ã€‚</p></li>
<li><p><strong>Field IDs</strong>:
å­—æ®µæ ‡è¯†ç¬¦åˆ—è¡¨ã€‚å®šä¹‰äº†ç±»çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬å…¶æ‰€å±ç±»ã€ç±»å‹å’Œåç§°ã€‚</p></li>
<li><p><strong>Method IDs</strong>:
æ–¹æ³•æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚å®šä¹‰äº†æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¶æ‰€å±ç±»ã€åŸå‹ (Proto ID)
å’Œåç§°ã€‚</p></li>
<li><p><strong>Class Defs</strong>:
ç±»å®šä¹‰åˆ—è¡¨ã€‚è¿™æ˜¯æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŒ…å«äº†æ¯ä¸ªç±»çš„è¯¦ç»†ä¿¡æ¯ï¼šè®¿é—®æ ‡å¿—ã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æºç æ–‡ä»¶åã€æ³¨è§£ã€ä»¥åŠæŒ‡å‘å…¶å­—æ®µå’Œæ–¹æ³•çš„æŒ‡é’ˆã€‚</p></li>
<li><p><strong>Data Section</strong>:
æ•°æ®åŒºï¼ŒåŒ…å«äº†æ‰€æœ‰ç±»çš„å®é™…å†…å®¹ï¼Œä¾‹å¦‚ï¼š</p></li>
<li><p><strong>Code Item</strong>: å®é™…çš„æ–¹æ³•å­—èŠ‚ç ï¼ˆDalvik
æŒ‡ä»¤ï¼‰ã€‚</p></li>
<li><p><strong>Class Data</strong>:
ç±»çš„å­—æ®µå’Œæ–¹æ³•åˆ—è¡¨çš„å…·ä½“æ•°æ®ã€‚</p></li>
<li><p><strong>Map List</strong>: æè¿°æ•´ä¸ª DEX
æ–‡ä»¶æ•°æ®å¸ƒå±€çš„æ˜ å°„è¡¨ï¼Œ<code>dexdump</code> ç­‰å·¥å…·ä½¿ç”¨å®ƒæ¥è§£ææ–‡ä»¶ã€‚ ___
### è¿è¡ŒåŸç†</p></li>
</ul>
<p>DEX æ–‡ä»¶çš„æ‰§è¡Œç”± Android è¿è¡Œæ—¶ (ART) è´Ÿè´£ï¼Œåœ¨ Android 5.0 ä¹‹å‰ç”±
Dalvik è™šæ‹Ÿæœº (DVM) è´Ÿè´£ã€‚</p>
<h4 id="dalvik-è™šæ‹Ÿæœº-dvm---android-4.4-åŠæ›´æ—©ç‰ˆæœ¬">1. Dalvik è™šæ‹Ÿæœº
(DVM) - android 4.4 åŠæ›´æ—©ç‰ˆæœ¬</h4>
<ul>
<li><p><strong>JIT (Just-In-Time) ç¼–è¯‘</strong>: å½“åº”ç”¨è¿è¡Œæ—¶ï¼ŒDVM
ä¼šè§£é‡Šæ‰§è¡Œ DEX å­—èŠ‚ç ã€‚å¯¹äºé¢‘ç¹æ‰§è¡Œçš„â€çƒ­ç‚¹â€ä»£ç è·¯å¾„ï¼ŒJIT
ç¼–è¯‘å™¨ä¼šå°†å…¶åŠ¨æ€ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œä»¥æé«˜åç»­æ‰§è¡Œé€Ÿåº¦ã€‚</p></li>
<li><p><strong>ç¼ºç‚¹</strong>: æ¯æ¬¡å¯åŠ¨åº”ç”¨éƒ½éœ€è¦è¿›è¡Œè§£é‡Šå’Œ JIT
ç¼–è¯‘ï¼Œå¯¼è‡´åº”ç”¨å¯åŠ¨é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸”è¿è¡Œæ—¶æ¶ˆè€—æ›´å¤šè®¡ç®—èµ„æºã€‚</p></li>
</ul>
<h4 id="android-è¿è¡Œæ—¶-art---android-5.0-åŠæ›´é«˜ç‰ˆæœ¬">2. android è¿è¡Œæ—¶
(ART) - Android 5.0 åŠæ›´é«˜ç‰ˆæœ¬</h4>
<ul>
<li><p><strong>AOT (Ahead-Of-Time) ç¼–è¯‘</strong>:
åœ¨åº”ç”¨<strong>å®‰è£…æ—¶</strong>ï¼ŒART ä¼šä½¿ç”¨ <code>dex2oat</code> å·¥å…·å°†
DEX æ–‡ä»¶ä¸­çš„å­—èŠ‚ç é¢„ç¼–è¯‘æˆè®¾å¤‡åŸç”Ÿçš„æœºå™¨ç ï¼Œå¹¶ä¿å­˜ä¸º OAT (Optimized
Android file format) æ–‡ä»¶ã€‚</p></li>
<li><p><strong>ä¼˜ç‚¹</strong>:</p></li>
<li><p><strong>å¯åŠ¨é€Ÿåº¦å¿«</strong>:
åº”ç”¨ç›´æ¥æ‰§è¡Œé¢„ç¼–è¯‘çš„æœ¬åœ°ä»£ç ï¼Œæ— éœ€å®æ—¶ç¼–è¯‘ï¼Œå¤§å¤§åŠ å¿«äº†å¯åŠ¨é€Ÿåº¦ã€‚</p></li>
<li><p><strong>æ€§èƒ½æ›´é«˜</strong>: AOT å¯ä»¥è¿›è¡Œæ›´æ·±åº¦çš„ä¼˜åŒ–ï¼Œæ€§èƒ½é€šå¸¸ä¼˜äº
JITã€‚</p></li>
<li><p><strong>æ›´çœç”µ</strong>: å‡å°‘äº†è¿è¡Œæ—¶çš„ CPU è®¡ç®—è´Ÿæ‹…ã€‚</p></li>
<li><p><strong>AOT + JIT æ··åˆæ¨¡å¼ (Android 7.0+ )</strong>:</p></li>
<li><p>ä¸ºäº†å¹³è¡¡å®‰è£…é€Ÿåº¦/ç©ºé—´å ç”¨å’Œæ€§èƒ½ï¼ŒART å¼•å…¥äº†æ··åˆæ¨¡å¼ã€‚</p></li>
<li><p><strong>å®‰è£…æ—¶</strong>: ä¸è¿›è¡Œå®Œå…¨ AOT
ç¼–è¯‘ï¼Œæˆ–åªç¼–è¯‘éƒ¨åˆ†å…³é”®ä»£ç ã€‚</p></li>
<li><p><strong>é¦–æ¬¡è¿è¡Œ</strong>: è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ JIT
ç¼–è¯‘çƒ­ç‚¹ä»£ç ï¼ŒåŒæ—¶æ”¶é›†åˆ†æä¿¡æ¯ (Profile)ã€‚</p></li>
<li><p><strong>è®¾å¤‡ç©ºé—²æ—¶</strong>:
å½“è®¾å¤‡å……ç”µä¸”ç©ºé—²æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®æ”¶é›†åˆ°çš„åˆ†æä¿¡æ¯ï¼Œå¯¹å¸¸ç”¨ä»£ç è¿›è¡Œ AOT
ç¼–è¯‘ï¼Œå®ç°æœ€ä½³æ€§èƒ½ã€‚ ___ ### Multi-DEX</p></li>
</ul>
<p>å•ä¸ª DEX æ–‡ä»¶æœ‰ä¸€ä¸ªæ–¹æ³•å¼•ç”¨æ•°ä¸Šé™ï¼ˆ65,536
ä¸ªï¼‰ï¼Œå½“åº”ç”¨ï¼ˆåŒ…æ‹¬å…¶ä¾èµ–åº“ï¼‰çš„æ–¹æ³•æ€»æ•°è¶…è¿‡è¿™ä¸ªé™åˆ¶æ—¶ï¼Œç¼–è¯‘ä¼šå¤±è´¥ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAndroid å¼•å…¥äº† <strong>Multi-DEX</strong>
æœºåˆ¶ã€‚æ‰“åŒ…å·¥å…·ä¼šå°†åº”ç”¨ä»£ç åˆ†å‰²åˆ°å¤šä¸ª DEX æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚
<code>classes.dex</code>, <code>classes2.dex</code>,
<code>classes3.dex</code> ç­‰ã€‚ä¸» <code>classes.dex</code>
æ–‡ä»¶ä¼šä¼˜å…ˆåŠ è½½ï¼Œç„¶ååº”ç”¨ä»£ç ä¼šè´Ÿè´£åŠ è½½å…¶ä½™çš„ DEX æ–‡ä»¶ã€‚</p>
<p>ä» Android 5.0 (API 21) å¼€å§‹ï¼ŒART åŸç”Ÿæ”¯æŒåŠ è½½å¤šä¸ª DEX
æ–‡ä»¶ï¼Œæ— éœ€é¢å¤–çš„åº“ã€‚å¯¹äºæ›´æ—©çš„ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦ä½¿ç”¨å®˜æ–¹çš„
<code>multidex-support-library</code>ã€‚ ___ ### DEX åˆ†æä¸å¤„ç†å·¥å…·</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>å·¥å…·</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>d8 / dx</strong></td>
<td>Google å®˜æ–¹å·¥å…·ï¼Œç”¨äºå°† <code>.class</code> æ–‡ä»¶è½¬æ¢ä¸º
<code>.dex</code> æ–‡ä»¶ã€‚<code>d8</code> æ˜¯æ–°ä¸€ä»£çš„è½¬æ¢å™¨ã€‚</td>
</tr>
<tr>
<td><strong>dexdump</strong></td>
<td>ä½äº Android SDK <code>build-tools</code> ä¸­ï¼Œç”¨äºæ‰“å° DEX
æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€ç±»ã€æ–¹æ³•å’Œå­—èŠ‚ç ã€‚</td>
</tr>
<tr>
<td><strong>baksmali</strong></td>
<td>å°† <code>.dex</code> æ–‡ä»¶åæ±‡ç¼–æˆ <code>.smali</code> æ–‡ä»¶ã€‚Smali
æ˜¯ä¸€ç§äººç±»å¯è¯»çš„ Dalvik å­—èŠ‚ç è¡¨ç¤ºå½¢å¼ã€‚</td>
</tr>
<tr>
<td><strong>smali</strong></td>
<td>å°† <code>.smali</code> æ–‡ä»¶é‡æ–°æ±‡ç¼–æˆ <code>.dex</code>
æ–‡ä»¶ã€‚å¸¸ç”¨äºä¿®æ”¹åº”ç”¨é€»è¾‘åé‡æ–°æ‰“åŒ…ã€‚</td>
</tr>
<tr>
<td><strong>Jadx</strong></td>
<td>éå¸¸å¼ºå¤§çš„åç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥ç›´æ¥å°† APK/DEX æ–‡ä»¶åç¼–è¯‘æˆå¯è¯»çš„ Java
ä»£ç ï¼Œå¹¶æä¾›å›¾å½¢åŒ–ç•Œé¢ã€‚</td>
</tr>
<tr>
<td><strong>Ghidra / IDA Pro</strong></td>
<td>é«˜çº§é€†å‘å·¥ç¨‹å·¥å…·ï¼Œæ”¯æŒå¯¹ DEX
æ–‡ä»¶å’ŒåŸç”Ÿåº“è¿›è¡Œæ·±åº¦é™æ€å’ŒåŠ¨æ€åˆ†æã€‚</td>
</tr>
</tbody>
</table>
<!-- 04-Reference/Foundations/smali_syntax.md -->
<h1 id="smali-è¯­æ³•å…¥é—¨">Smali è¯­æ³•å…¥é—¨</h1>
<p>Smali/Baksmali æ˜¯ Dalvik è™šæ‹Ÿæœºå­—èŠ‚ç çš„æ±‡ç¼–å™¨/åæ±‡ç¼–å™¨ã€‚Smali æ˜¯å¯¹
DEX æ ¼å¼çš„ä¸€ç§äººç±»å¯è¯»çš„è¡¨ç¤ºï¼Œå…è®¸æˆ‘ä»¬ç²¾ç¡®åœ°æŸ¥çœ‹å’Œä¿®æ”¹åº”ç”¨çš„è¡Œä¸ºã€‚ç†è§£
Smali æ˜¯è¿›è¡Œ Android åº”ç”¨é™æ€ patchingï¼ˆä¿®æ”¹åé‡æ‰“åŒ…ï¼‰çš„å…³é”®ã€‚ ___ ##
ç›®å½•</p>
<ul>
<li><p><a href="#smali-è¯­æ³•å…¥é—¨">Smali è¯­æ³•å…¥é—¨</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></p></li>
<li><p><a href="#æ•°æ®ç±»å‹ä¸è¡¨ç¤º">æ•°æ®ç±»å‹ä¸è¡¨ç¤º</a></p></li>
<li><p><a href="#æ–‡ä»¶ä¸ç±»ç»“æ„">æ–‡ä»¶ä¸ç±»ç»“æ„</a></p></li>
<li><p><a href="#å­—æ®µ-fields">å­—æ®µ (Fields)</a></p></li>
<li><p><a href="#æ–¹æ³•-methods">æ–¹æ³• (Methods)</a></p></li>
<li><p><a href="#æ ¸å¿ƒæŒ‡ä»¤">æ ¸å¿ƒæŒ‡ä»¤</a></p></li>
<li><p><a href="#å˜é‡æ“ä½œæŒ‡ä»¤">å˜é‡æ“ä½œæŒ‡ä»¤</a></p></li>
<li><p><a href="#å¯¹è±¡æ“ä½œæŒ‡ä»¤">å¯¹è±¡æ“ä½œæŒ‡ä»¤</a></p></li>
<li><p><a href="#æ–¹æ³•è°ƒç”¨æŒ‡ä»¤">æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</a></p></li>
<li><p><a href="#è·³è½¬æ¡ä»¶æŒ‡ä»¤">è·³è½¬/æ¡ä»¶æŒ‡ä»¤</a></p></li>
<li><p><a href="#è¿ç®—æŒ‡ä»¤">è¿ç®—æŒ‡ä»¤</a></p></li>
<li><p><a href="#smali-å®æˆ˜ä¿®æ”¹æ–¹æ³•">Smali å®æˆ˜ï¼šä¿®æ”¹æ–¹æ³•</a> ___ ###
åŸºæœ¬æ¦‚å¿µ</p></li>
<li><p><strong>å¯„å­˜å™¨ (Registers)</strong>: Dalvik VM
æ˜¯åŸºäºå¯„å­˜å™¨çš„ã€‚æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚</p></li>
<li><p><code>v</code> å¼€å¤´çš„å¯„å­˜å™¨ç”¨äºå­˜æ”¾æœ¬åœ°å˜é‡ï¼Œå¦‚ <code>v0</code>,
<code>v1</code>, <code>v2</code>â€¦</p></li>
<li><p><code>p</code> å¼€å¤´çš„å¯„å­˜å™¨ç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°ï¼Œå¦‚ <code>p0</code>,
<code>p1</code>, <code>p2</code>â€¦</p></li>
<li><p>å¯¹äºéé™æ€æ–¹æ³•ï¼Œ<code>p0</code> æ€»æ˜¯æŒ‡å‘ <code>this</code>
(å½“å‰å¯¹è±¡å®ä¾‹)ã€‚</p></li>
<li><p>å‚æ•°ä» <code>p1</code>
å¼€å§‹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°çš„éé™æ€æ–¹æ³•ï¼Œ<code>p0</code> æ˜¯
<code>this</code>ï¼Œ<code>p1</code> æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>p2</code>
æ˜¯ç¬¬äºŒä¸ªå‚æ•°ã€‚å¯¹äºé™æ€æ–¹æ³•ï¼Œå‚æ•°ä» <code>p0</code> å¼€å§‹ã€‚</p></li>
<li><p><strong><code>.locals</code></strong>:
å£°æ˜ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨äº†å¤šå°‘ä¸ªæœ¬åœ°å˜é‡å¯„å­˜å™¨ã€‚</p></li>
<li><p><strong><code>.prologue</code></strong>:
æ–¹æ³•ä½“çš„åºè¨€éƒ¨åˆ†ã€‚</p></li>
<li><p><strong><code>.line</code></strong>: å¯¹åº”åŸå§‹ Java
ä»£ç çš„è¡Œå·ï¼Œç”¨äºè°ƒè¯•ã€‚ ___ ### æ•°æ®ç±»å‹ä¸è¡¨ç¤º</p></li>
</ul>
<p>Smali ä½¿ç”¨ç‰¹å®šçš„æè¿°ç¬¦æ¥è¡¨ç¤º Java ä¸­çš„æ•°æ®ç±»å‹ã€‚</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 28%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Smali ç±»å‹</th>
<th style="text-align: left;">Java ç±»å‹</th>
<th style="text-align: left;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>V</code></td>
<td style="text-align: left;"><code>void</code></td>
<td style="text-align: left;">ç©ºè¿”å›ç±»å‹</td>
</tr>
<tr>
<td style="text-align: left;"><code>Z</code></td>
<td style="text-align: left;"><code>boolean</code></td>
<td style="text-align: left;">å¸ƒå°”å€¼</td>
</tr>
<tr>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: left;"><code>byte</code></td>
<td style="text-align: left;">å­—èŠ‚</td>
</tr>
<tr>
<td style="text-align: left;"><code>S</code></td>
<td style="text-align: left;"><code>short</code></td>
<td style="text-align: left;">çŸ­æ•´å‹</td>
</tr>
<tr>
<td style="text-align: left;"><code>C</code></td>
<td style="text-align: left;"><code>char</code></td>
<td style="text-align: left;">å­—ç¬¦</td>
</tr>
<tr>
<td style="text-align: left;"><code>I</code></td>
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: left;">æ•´å‹</td>
</tr>
<tr>
<td style="text-align: left;"><code>J</code></td>
<td style="text-align: left;"><code>long</code></td>
<td style="text-align: left;">é•¿æ•´å‹ (å ç”¨ä¸¤ä¸ªå¯„å­˜å™¨)</td>
</tr>
<tr>
<td style="text-align: left;"><code>F</code></td>
<td style="text-align: left;"><code>float</code></td>
<td style="text-align: left;">æµ®ç‚¹å‹</td>
</tr>
<tr>
<td style="text-align: left;"><code>D</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">åŒç²¾åº¦æµ®ç‚¹å‹ (å ç”¨ä¸¤ä¸ªå¯„å­˜å™¨)</td>
</tr>
<tr>
<td
style="text-align: left;"><code>L&lt;åŒ…å&gt;/&lt;ç±»å&gt;;</code></td>
<td style="text-align: left;"><code>package.ClassName</code></td>
<td style="text-align: left;">å¯¹è±¡ç±»å‹ï¼Œä»¥ <code>L</code>
å¼€å¤´ï¼Œ<code>;</code> ç»“å°¾</td>
</tr>
<tr>
<td style="text-align: left;"><code>[&lt;ç±»å‹&gt;</code></td>
<td style="text-align: left;"><code>type[]</code></td>
<td style="text-align: left;">æ•°ç»„ç±»å‹ï¼Œ<code>[I</code> ä»£è¡¨
<code>int[]</code></td>
</tr>
</tbody>
</table>
<ul>
<li><p>*ç¤ºä¾‹**:</p></li>
<li><p><code>Ljava/lang/String;</code> -&gt;
<code>java.lang.String</code></p></li>
<li><p><code>[I</code> -&gt; <code>int[]</code></p></li>
<li><p><code>[[Ljava/lang/Object;</code> -&gt;
<code>java.lang.Object[][]</code> ___ ### æ–‡ä»¶ä¸ç±»ç»“æ„</p></li>
</ul>
<p>æ¯ä¸ª <code>.smali</code> æ–‡ä»¶å¯¹åº”ä¸€ä¸ª Java ç±»ã€‚</p>
<pre class="smali"><code># Define class, access modifiers, and complete class path
.class public Lcom/example/app/MainActivity;

# Define superclass
.super Landroid/app/Activity;

# Define source file name, optional
.source &quot;MainActivity.java&quot;

# ... Field definitions ...

# ... Method definitions ...
</code></pre>
<h1 id="format-.field-static-final">Format: .field <access_modifier>
[static] [final] <field_name>:<field_type></h1>
<p>.field private TAG:Ljava/lang/String; .field public static final
MY_CONSTANT:I = 0x1</p>
<pre><code># Format: .method &lt;access_modifier&gt; [static] [final] &lt;method_name&gt;(&lt;parameter_types&gt;)&lt;return_type&gt;
.method public onCreate(Landroid/os/Bundle;)V
# Declare number of local variable registers
.locals 3

# Declare parameter registers
.param p1, &quot;savedInstanceState&quot; # p1 is savedInstanceState

# Method body begins
.prologue
.line 15

# ... Smali instructions ...

# Method return
return-void
.end method
</code></pre>
<ul>
<li><p><code>const-string v1, "Hello"</code>: å°†å­—ç¬¦ä¸² â€œHelloâ€ èµ‹å€¼ç»™
<code>v1</code>ã€‚</p></li>
<li><p><code>move-result-object v0</code>: å°†ä¸Šä¸€ä¸ª <code>invoke</code>
æŒ‡ä»¤è¿”å›çš„å¯¹è±¡ç»“æœç§»åŠ¨åˆ° <code>v0</code>ã€‚</p></li>
<li><p><code>move-result v0</code>: å°†ä¸Šä¸€ä¸ª <code>invoke</code>
æŒ‡ä»¤è¿”å›çš„éå¯¹è±¡ç»“æœç§»åŠ¨åˆ° <code>v0</code>ã€‚</p></li>
<li><p><code>move-exception v0</code>: åœ¨ <code>catch</code>
å—ä¸­ï¼Œå°†æ•è·çš„å¼‚å¸¸å¯¹è±¡ç§»åŠ¨åˆ° <code>v0</code>ã€‚</p></li>
</ul>
<h4 id="å¯¹è±¡æ“ä½œæŒ‡ä»¤">å¯¹è±¡æ“ä½œæŒ‡ä»¤</h4>
<ul>
<li><p><code>new-instance v0, Ljava/lang/StringBuilder;</code>: åˆ›å»ºä¸€ä¸ª
<code>StringBuilder</code> çš„æ–°å®ä¾‹ï¼Œå¹¶å°†å…¶å¼•ç”¨å­˜å…¥
<code>v0</code>ã€‚</p></li>
<li><p><code>iget-object v0, p0, Lcom/example/app/MyClass;-&gt;myField:Ljava/lang/String;</code>:
è·å–å®ä¾‹å­—æ®µ (iget) çš„å€¼ã€‚ä» <code>p0</code> (this) å¯¹è±¡ä¸­è¯»å–
<code>myField</code> å­—æ®µï¼Œå¹¶å­˜å…¥ <code>v0</code>ã€‚</p></li>
<li><p><code>iput-object v1, p0, Lcom/example/app/MyClass;-&gt;myField:Ljava/lang/String;</code>:
è®¾ç½®å®ä¾‹å­—æ®µ (iput) çš„å€¼ã€‚å°† <code>v1</code> çš„å€¼èµ‹ç»™ <code>p0</code>
(this) å¯¹è±¡çš„ <code>myField</code> å­—æ®µã€‚</p></li>
<li><p><code>sget-object v0, Lcom/example/app/Constants;-&gt;SOME_STRING:Ljava/lang/String;</code>:
è·å–é™æ€å­—æ®µ (sget) çš„å€¼ã€‚</p></li>
<li><p><code>sput-object v0, Lcom/example/app/Constants;-&gt;SOME_STRING:Ljava/lang/String;</code>:
è®¾ç½®é™æ€å­—æ®µ (sput) çš„å€¼ã€‚</p></li>
</ul>
<h4 id="æ–¹æ³•è°ƒç”¨æŒ‡ä»¤">æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</h4>
<ul>
<li><p><code>invoke-virtual {p0, p1}, Lcom/example/app/MyClass;-&gt;myMethod(I)V</code>:
è°ƒç”¨ä¸€ä¸ª <code>virtual</code>
æ–¹æ³•ï¼ˆæœ€å¸¸è§çš„å…¬æœ‰/ä¿æŠ¤æ–¹æ³•ï¼‰ã€‚<code>{p0, p1}</code>
æ˜¯å‚æ•°åˆ—è¡¨ï¼Œ<code>p0</code> æ˜¯ <code>this</code>ï¼Œ<code>p1</code>
æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p></li>
<li><p><code>invoke-direct {p0}, Ljava/lang/Object;-&gt;&lt;init&gt;()V</code>:
è°ƒç”¨ä¸€ä¸ª <code>direct</code>
æ–¹æ³•ï¼ˆç§æœ‰æ–¹æ³•æˆ–æ„é€ å‡½æ•°ï¼‰ã€‚è¿™é‡Œæ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</p></li>
<li><p><code>invoke-static {v0}, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I</code>:
è°ƒç”¨ä¸€ä¸ª <code>static</code> æ–¹æ³•ã€‚</p></li>
<li><p><code>invoke-super {p0, p1}, Landroid/app/Activity;-&gt;onCreate(Landroid/os/Bundle;)V</code>:
è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚</p></li>
<li><p><code>invoke-interface {p0, v0}, Ljava/util/List;-&gt;add(Ljava/lang/Object;)Z</code>:
è°ƒç”¨æ¥å£æ–¹æ³•ã€‚</p></li>
</ul>
<h4 id="è·³è½¬æ¡ä»¶æŒ‡ä»¤">è·³è½¬/æ¡ä»¶æŒ‡ä»¤</h4>
<ul>
<li><p><code>goto :label_10</code>: æ— æ¡ä»¶è·³è½¬åˆ° <code>:label_10</code>
æ ‡ç­¾ã€‚</p></li>
<li><p><code>if-eqz v0, :label_10</code>: å¦‚æœ <code>v0</code> ç­‰äº 0
(æˆ– <code>false</code>/<code>null</code>)ï¼Œåˆ™è·³è½¬åˆ°
<code>:label_10</code>ã€‚<code>eqz</code> (equal zero)ã€‚</p></li>
<li><p><code>if-nez v0, :label_10</code>: å¦‚æœ <code>v0</code> ä¸ç­‰äº 0
(æˆ– <code>true</code>/<code>not null</code>)ï¼Œåˆ™è·³è½¬ã€‚<code>nez</code>
(not equal zero)ã€‚</p></li>
<li><p><code>if-eq v0, v1, :label_10</code>: å¦‚æœ <code>v0</code> ç­‰äº
<code>v1</code>ï¼Œåˆ™è·³è½¬ã€‚</p></li>
</ul>
<h4 id="è¿ç®—æŒ‡ä»¤">è¿ç®—æŒ‡ä»¤</h4>
<ul>
<li><p><code>add-int v0, v1, v2</code>: <code>v0 = v1 + v2</code>
(æ•´å‹åŠ æ³•)ã€‚</p></li>
<li><p><code>sub-int v0, v1, v2</code>: <code>v0 = v1 - v2</code>
(æ•´å‹å‡æ³•)ã€‚</p></li>
<li><p><code>mul-int/2addr v0, v1</code>: <code>v0 = v0 * v1</code>
(<code>/2addr</code> è¡¨ç¤ºç»“æœå­˜å›ç¬¬ä¸€ä¸ªæºå¯„å­˜å™¨)ã€‚ ___ ### Smali
å®æˆ˜ï¼šä¿®æ”¹æ–¹æ³•</p></li>
</ul>
<p>å‡è®¾æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•ï¼Œè®©å®ƒæ€»æ˜¯è¿”å› <code>true</code>ã€‚</p>
<ul>
<li>*åŸå§‹ Java ä»£ç :**</li>
</ul>
<div class="sourceCode" id="cb571"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> LicenseCheck <span class="op">{</span></span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isLicensed</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ...ComplexCheckLogic...</span></span>
<span id="cb571-4"><a href="#cb571-4" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb571-5"><a href="#cb571-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb571-6"><a href="#cb571-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="complex-check-logic-corresponding-smali-instructions">Complex
check logic corresponding smali instructionsâ€¦</h1>
<p>const/4 v0, 0x0 # v0 = 0 (false) return v0 .end method</p>
<pre><code>
# Remove all complex check logic

const/4 v0, 0x1 # v0 = 1 (true)
return v0
.end method
</code></pre>
<ul>
<li>ä½¿ç”¨ <code>apktool b myapp -o new_app.apk</code> é‡æ–°æ‰“åŒ…ã€‚</li>
<li>ç”¨ <code>jarsigner</code> æˆ– <code>apksigner</code> å¯¹
<code>new_app.apk</code> è¿›è¡Œç­¾åã€‚</li>
</ul>
<!-- 04-Reference/Foundations/so_elf_format.md -->
<h1 id="android-.so-æ–‡ä»¶è¯¦è§£-elf-format">android .so æ–‡ä»¶è¯¦è§£ (ELF
Format)</h1>
<p><code>.so</code> æ–‡ä»¶ï¼ˆShared Objectï¼‰æ˜¯ Android
å¹³å°ä¸Šçš„åŸç”Ÿå…±äº«åº“ï¼Œç­‰åŒäº Windows ä¸Šçš„ <code>.dll</code> æˆ– Linux ä¸Šçš„
<code>.so</code>ã€‚å®ƒä»¬åŒ…å«äº†ç”± C/C++ ç­‰åŸç”Ÿä»£ç ç¼–è¯‘è€Œæˆçš„æœºå™¨ç ã€‚åœ¨
Android é€†å‘å·¥ç¨‹ä¸­ï¼Œåˆ†æ <code>.so</code>
æ–‡ä»¶æ˜¯ç†è§£åº”ç”¨æ ¸å¿ƒé€»è¾‘ã€ç ´è§£åŠ å¯†ç®—æ³•å’Œç»•è¿‡å®‰å…¨æœºåˆ¶çš„å…³é”®ä¸€æ­¥ã€‚ ___ ##
ç›®å½•</p>
<ol type="1">
<li><a href="#elf-æ–‡ä»¶æ ¼å¼"><strong>ELF æ–‡ä»¶æ ¼å¼</strong></a></li>
</ol>
<ul>
<li><p><a href="#elf-header">ELF Header</a></p></li>
<li><p><a href="#program-header-table">Program Header Table</a></p></li>
<li><p><a href="#section-header-table">Section Header Table</a></p></li>
<li><p><a href="#å…³é”®-section">å…³é”® Section</a></p></li>
<li><p><a href="#elf-header">ELF Header</a></p></li>
<li><p><a href="#program-header-table">Program Header Table</a></p></li>
<li><p><a href="#section-header-table">Section Header Table</a></p></li>
<li><p><a href="#å…³é”®-section">å…³é”® Section</a></p></li>
</ul>
<ol start="2" type="1">
<li><a href="#åŠ è½½ä¸é“¾æ¥"><strong>åŠ è½½ä¸é“¾æ¥</strong></a></li>
</ol>
<ul>
<li><p><a
href="#systemloadlibrary"><code>System.loadLibrary()</code></a></p></li>
<li><p><a href="#jni-java-native-interface">JNI (Java Native
Interface)</a></p></li>
<li><p><a href="#åŠ¨æ€é“¾æ¥å™¨-systembinlinker">åŠ¨æ€é“¾æ¥å™¨
(<code>/system/bin/linker</code>)</a></p></li>
<li><p><a
href="#systemloadlibrary"><code>System.loadLibrary()</code></a></p></li>
<li><p><a href="#jni-java-native-interface">JNI (Java Native
Interface)</a></p></li>
<li><p><a href="#åŠ¨æ€é“¾æ¥å™¨-systembinlinker">åŠ¨æ€é“¾æ¥å™¨
(<code>/system/bin/linker</code>)</a></p></li>
</ul>
<ol start="3" type="1">
<li><a href="#é™æ€åˆ†æ"><strong>é™æ€åˆ†æ</strong></a></li>
</ol>
<ul>
<li><p><a href="#è¯†åˆ«å…³é”®å‡½æ•°">è¯†åˆ«å…³é”®å‡½æ•°</a></p></li>
<li><p><a href="#ä½¿ç”¨-ida-pro--ghidra">ä½¿ç”¨ IDA Pro /
Ghidra</a></p></li>
<li><p><a href="#è¯†åˆ«å…³é”®å‡½æ•°">è¯†åˆ«å…³é”®å‡½æ•°</a></p></li>
<li><p><a href="#ä½¿ç”¨-ida-pro--ghidra">ä½¿ç”¨ IDA Pro /
Ghidra</a></p></li>
</ul>
<ol start="4" type="1">
<li><a href="#åŠ¨æ€åˆ†æ"><strong>åŠ¨æ€åˆ†æ</strong></a></li>
</ol>
<ul>
<li><p><a href="#frida-hook-åŸç”Ÿå‡½æ•°">Frida Hook åŸç”Ÿå‡½æ•°</a></p></li>
<li><p><a href="#unidbg-æ¨¡æ‹Ÿæ‰§è¡Œ">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œ</a></p></li>
<li><p><a href="#frida-hook-åŸç”Ÿå‡½æ•°">Frida Hook åŸç”Ÿå‡½æ•°</a></p></li>
<li><p><a href="#unidbg-æ¨¡æ‹Ÿæ‰§è¡Œ">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œ</a></p></li>
</ul>
<ol start="5" type="1">
<li><a href="#å¸¸è§ä¿æŠ¤æ‰‹æ®µ"><strong>å¸¸è§ä¿æŠ¤æ‰‹æ®µ</strong></a> ___ ###
ELF æ–‡ä»¶æ ¼å¼</li>
</ol>
<p><code>.so</code> æ–‡ä»¶éµå¾ª <strong>ELF (Executable and Linkable
Format)</strong>
æ ¼å¼ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡ä»£ç ã€å…±äº«åº“å’Œæ ¸å¿ƒè½¬å‚¨çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚</p>
<h4 id="elf-header">ELF Header</h4>
<p>ä½äºæ–‡ä»¶å¼€å¤´ï¼Œæè¿°äº†æ•´ä¸ªæ–‡ä»¶çš„â€æ¡£æ¡ˆâ€ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><p><strong>Magic Number</strong>: æ–‡ä»¶çš„å‰ 16
ä¸ªå­—èŠ‚ï¼Œç”¨äºè¯†åˆ«è¿™æ˜¯ä¸€ä¸ª ELF æ–‡ä»¶ã€‚</p></li>
<li><p><strong>Architecture</strong>: æ ‡è¯†æ–‡ä»¶æ˜¯ä¸ºå“ªç§ CPU
æ¶æ„ç¼–è¯‘çš„ï¼ˆå¦‚ ARM, ARM64, x86ï¼‰ã€‚</p></li>
<li><p><strong>Type</strong>:
æ–‡ä»¶ç±»å‹ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ã€å…±äº«åº“ç­‰ï¼‰ã€‚</p></li>
<li><p><strong>Entry Point Address</strong>:
å¦‚æœæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™æ˜¯ç¨‹åºå¯åŠ¨çš„åœ°å€ã€‚</p></li>
<li><p><strong>Program Header Table Offset</strong>:
æŒ‡å‘ç¨‹åºå¤´è¡¨çš„åç§»ã€‚</p></li>
<li><p><strong>Section Header Table Offset</strong>:
æŒ‡å‘èŠ‚å¤´è¡¨çš„åç§»ã€‚</p></li>
</ul>
<h4 id="program-header-table">Program Header table</h4>
<p>æè¿°äº†ç³»ç»Ÿå¦‚ä½•å°†æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†ï¼ˆæ®µï¼ŒSegmentsï¼‰åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ¯ä¸ªæ¡ç›®éƒ½å®šä¹‰äº†ä¸€ä¸ªæ®µçš„ç±»å‹ï¼ˆå¦‚
<code>LOAD</code>ï¼Œè¡¨ç¤ºéœ€è¦åŠ è½½åˆ°å†…å­˜ï¼‰ã€è™šæ‹Ÿåœ°å€ã€ç‰©ç†åœ°å€ã€å¤§å°å’Œæƒé™ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰ã€‚åŠ¨æ€é“¾æ¥å™¨
(<code>linker</code>) ä¾èµ–è¿™ä¸ªè¡¨æ¥æ­£ç¡®æ˜ å°„ <code>.so</code> æ–‡ä»¶ã€‚</p>
<h4 id="section-header-table">Section Header table</h4>
<p>æè¿°äº†æ–‡ä»¶ä¸­å„ä¸ªâ€èŠ‚â€ï¼ˆSectionsï¼‰çš„ä¿¡æ¯ã€‚èŠ‚æ˜¯é“¾æ¥å™¨ç”¨æ¥ç»„ç»‡å’Œå¤„ç†æ•°æ®çš„å•ä½ã€‚</p>
<h4 id="å…³é”®-section">å…³é”® Section</h4>
<ul>
<li><p><strong>.text</strong>:
åŒ…å«å·²ç¼–è¯‘çš„ç¨‹åºæœºå™¨ç ï¼ˆæ±‡ç¼–æŒ‡ä»¤ï¼‰ã€‚è¿™æ˜¯åˆ†æçš„æ ¸å¿ƒåŒºåŸŸã€‚</p></li>
<li><p><strong>.rodata</strong>: åªè¯»æ•°æ®åŒºï¼Œé€šå¸¸å­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡ã€const
å˜é‡ç­‰ã€‚</p></li>
<li><p><strong>.data</strong>:
å·²åˆå§‹åŒ–çš„å¯è¯»å¯å†™æ•°æ®åŒºï¼ˆå…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼‰ã€‚</p></li>
<li><p><strong>.bss</strong>:
æœªåˆå§‹åŒ–çš„æ•°æ®åŒºã€‚åœ¨æ–‡ä»¶ä¸­ä¸å ç©ºé—´ï¼Œä½†åœ¨åŠ è½½åˆ°å†…å­˜æ—¶ä¼šè¢«åˆ†é…å¹¶æ¸…é›¶ã€‚</p></li>
<li><p><strong>.init_array</strong> / <strong>.fini_array</strong>:
å­˜æ”¾ä¸€ç³»åˆ—å‡½æ•°æŒ‡é’ˆï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨åº“è¢«åŠ è½½ (<code>dlopen</code>)
æ—¶ï¼ˆ<code>.init_array</code>ï¼‰æˆ–å¸è½½ (<code>dlclose</code>)
æ—¶ï¼ˆ<code>.fini_array</code>ï¼‰è‡ªåŠ¨æ‰§è¡Œã€‚<strong>è¿™æ˜¯åˆ†æ
<code>.so</code> æ–‡ä»¶è‡ªå¯åŠ¨é€»è¾‘å’Œåè°ƒè¯•çš„ç»ä½³å…¥å£ç‚¹</strong>ã€‚</p></li>
<li><p><strong>.dynsym</strong> (Dynamic Symbol Table):
åŠ¨æ€ç¬¦å·è¡¨ï¼ŒåŒ…å«äº†åº“ä¸­å¯¼å‡ºï¼ˆæä¾›ç»™å¤–éƒ¨ä½¿ç”¨ï¼‰å’Œå¯¼å…¥ï¼ˆéœ€è¦ä»å…¶ä»–åº“å¼•ç”¨ï¼‰çš„å‡½æ•°å’Œå˜é‡åã€‚</p></li>
<li><p><strong>.dynstr</strong> (Dynamic String Table):
å­—ç¬¦ä¸²è¡¨ï¼Œ<code>.dynsym</code> ä¸­çš„ç¬¦å·åç§°å°±å­˜å‚¨åœ¨è¿™é‡Œã€‚ ___ ###
åŠ è½½ä¸é“¾æ¥</p></li>
</ul>
<h4 id="system.loadlibrary"><code>System.loadLibrary()</code></h4>
<p>åœ¨ Java/Kotlin ä»£ç ä¸­ï¼Œå¼€å‘è€…é€šè¿‡
<code>System.loadLibrary("mylib")</code> æ¥åŠ è½½ä¸€ä¸ªåä¸º
<code>libmylib.so</code> çš„åŸç”Ÿåº“ã€‚ç³»ç»Ÿä¼šåœ¨ <code>lib/</code>
ç›®å½•ä¸‹çš„ç›¸åº” ABI æ–‡ä»¶å¤¹ï¼ˆå¦‚
<code>arm64-v8a</code>ï¼‰ä¸­æŸ¥æ‰¾å¹¶åŠ è½½è¯¥åº“ã€‚</p>
<h4 id="jni-java-native-interface">JNI (Java Native Interface)</h4>
<p>JNI æ˜¯è¿æ¥ Java ä¸–ç•Œå’Œ Native (C/C++) ä¸–ç•Œçš„æ¡¥æ¢ï¼Œæ˜¯ Android
é€†å‘åˆ†æä¸­çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚</p>
<h5 id="jni-åŸºç¡€æ¦‚å¿µ">JNI åŸºç¡€æ¦‚å¿µ</h5>
<ul>
<li>*Java ä¾§å£°æ˜**:</li>
</ul>
<div class="sourceCode" id="cb573"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> NativeHelper <span class="op">{</span></span>
<span id="cb573-2"><a href="#cb573-2" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="op">{</span></span>
<span id="cb573-3"><a href="#cb573-3" aria-hidden="true" tabindex="-1"></a><span class="bu">System</span><span class="op">.</span><span class="fu">loadLibrary</span><span class="op">(</span><span class="st">&quot;native-lib&quot;</span><span class="op">);</span> <span class="co">// Load libnative-lib.so</span></span>
<span id="cb573-4"><a href="#cb573-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb573-5"><a href="#cb573-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-6"><a href="#cb573-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Static native method</span></span>
<span id="cb573-7"><a href="#cb573-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="kw">native</span> <span class="bu">String</span> <span class="fu">doEncrypt</span><span class="op">(</span><span class="bu">String</span> input<span class="op">);</span></span>
<span id="cb573-8"><a href="#cb573-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-9"><a href="#cb573-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Instance native method</span></span>
<span id="cb573-10"><a href="#cb573-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">native</span> <span class="dt">byte</span><span class="op">[]</span> <span class="fu">processData</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> data<span class="op">,</span> <span class="dt">int</span> flag<span class="op">);</span></span>
<span id="cb573-11"><a href="#cb573-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-12"><a href="#cb573-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiple parameter native method</span></span>
<span id="cb573-13"><a href="#cb573-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">native</span> <span class="dt">int</span> <span class="fu">complexOperation</span><span class="op">(</span><span class="bu">String</span> str<span class="op">,</span> <span class="dt">int</span><span class="op">[]</span> array<span class="op">,</span> <span class="dt">boolean</span> flag<span class="op">);</span></span>
<span id="cb573-14"><a href="#cb573-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>// Static method JNI function signature: second parameter is jclass
JNIEXPORT jstring JNICALL
Java_com_example_app_NativeHelper_doEncrypt(JNIEnv <em>env, jclass
clazz, jstring input) { const char </em>nativeString =
(<em>env)-&gt;GetStringUTFChars(env, input, 0); // Execute encryption
logicâ€¦ jstring result = (</em>env)-&gt;NewStringUTF(env,
encrypted_result); (*env)-&gt;ReleaseStringUTFChars(env, input,
nativeString); return result; }</p>
<p>// Instance method JNI function signature: second parameter is
jobject JNIEXPORT jbyteArray JNICALL
Java_com_example_app_NativeHelper_processData(JNIEnv <em>env, jobject
thiz, jbyteArray data, jint flag) { jsize len =
(</em>env)-&gt;GetArrayLength(env, data); jbyte <em>body =
(</em>env)-&gt;GetByteArrayElements(env, data, 0);</p>
<p>// Process dataâ€¦</p>
<p>jbyteArray result = (<em>env)-&gt;NewByteArray(env, len);
(</em>env)-&gt;SetByteArrayRegion(env, result, 0, len, processed_data);
(*env)-&gt;ReleaseByteArrayElements(env, data, body, 0); return result;
}</p>
<pre><code>

- å¸¸ç”¨å‡½æ•°åˆ†ç±»ï¼š

- **å­—ç¬¦ä¸²æ“ä½œ**: `NewStringUTF()`, `GetStringUTFChars()`, `ReleaseStringUTFChars()`

- **æ•°ç»„æ“ä½œ**: `NewByteArray()`, `GetByteArrayElements()`, `SetByteArrayRegion()`

- **å¯¹è±¡æ“ä½œ**: `NewObject()`, `GetObjectClass()`, `CallObjectMethod()`

- **å­—æ®µè®¿é—®**: `GetFieldID()`, `GetIntField()`, `SetIntField()`

- **æ–¹æ³•è°ƒç”¨**: `GetMethodID()`, `CallVoidMethod()`, `CallIntMethod()`


- **å­—ç¬¦ä¸²æ“ä½œ**: `NewStringUTF()`, `GetStringUTFChars()`, `ReleaseStringUTFChars()`


- **æ•°ç»„æ“ä½œ**: `NewByteArray()`, `GetByteArrayElements()`, `SetByteArrayRegion()`


- **å¯¹è±¡æ“ä½œ**: `NewObject()`, `GetObjectClass()`, `CallObjectMethod()`


- **å­—æ®µè®¿é—®**: `GetFieldID()`, `GetIntField()`, `SetIntField()`


- **æ–¹æ³•è°ƒç”¨**: `GetMethodID()`, `CallVoidMethod()`, `CallIntMethod()`


**2. æ•°æ®ç±»å‹æ˜ å°„**

```c
// Java type -&gt; JNI type
boolean -&gt; jboolean
byte -&gt; jbyte
char -&gt; jchar
short -&gt; jshort
int -&gt; jint
long -&gt; jlong
float -&gt; jfloat
double -&gt; jdouble
String -&gt; jstring
Object -&gt; jobject
Class -&gt; jclass
Array -&gt; jarray (jintArray, jbyteArray etc.)
</code></pre>
<ul>
<li>ç¤ºä¾‹ï¼š<code>Java_com_example_myapp_crypto_AESUtil_encrypt</code></li>
</ul>
<h5 id="jni-æ–¹æ³•æ³¨å†Œ">JNI æ–¹æ³•æ³¨å†Œ</h5>
<p><strong>é™æ€æ³¨å†Œ</strong>ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰ï¼š</p>
<div class="sourceCode" id="cb575"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Function name must strictly follow naming rules</span></span>
<span id="cb575-2"><a href="#cb575-2" aria-hidden="true" tabindex="-1"></a>JNIEXPORT jstring JNICALL</span>
<span id="cb575-3"><a href="#cb575-3" aria-hidden="true" tabindex="-1"></a>Java_com_example_app_MainActivity_stringFromJNI<span class="op">(</span>JNIEnv <span class="op">*</span>env<span class="op">,</span> jobject thiz<span class="op">)</span> <span class="op">{</span></span>
<span id="cb575-4"><a href="#cb575-4" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="op">(*</span>env<span class="op">)-&gt;</span>NewStringUTF<span class="op">(</span>env<span class="op">,</span> <span class="st">&quot;Hello from JNI!&quot;</span><span class="op">);</span></span>
<span id="cb575-5"><a href="#cb575-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>{â€œencryptâ€, â€œ(Ljava/lang/String;)Ljava/lang/String;â€,
(void<em>)native_encrypt}, {â€œdecryptâ€, â€œ([B)[Bâ€,
(void</em>)native_decrypt}, {â€œinitâ€, â€œ(I)Vâ€, (void*)native_init} };</p>
<p>// JNI_OnLoad function will be automatically called when library is
loaded JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM* vm, void* reserved) {
JNIEnv* env; if ((*vm)-&gt;GetEnv(vm, (void**)&amp;env, JNI_VERSION_1_6)
!= JNI_OK) { return JNI_ERR; }</p>
<p>jclass clazz = (*env)-&gt;FindClass(env,
â€œcom/example/app/NativeHelperâ€); if (clazz == NULL) { return JNI_ERR;
}</p>
<p>// Register native methods if ((*env)-&gt;RegisterNatives(env, clazz,
gMethods, sizeof(gMethods)/sizeof(gMethods[0])) &lt; 0) { return
JNI_ERR; }</p>
<p>return JNI_VERSION_1_6; }</p>
<pre><code>
S - short
I - int
J - long
F - float
D - double
V - void
</code></pre>
<p>[[Ljava/lang/String; - String[][]</p>
<pre><code>
// Java: public native void processArray(int[] data, boolean flag);
// JNI Signature: ([IZ)V
</code></pre>
<p>nm -D libexample.so | grep Java_</p>
<h1 id="or-use-objdump">Or use objdump</h1>
<p>objdump -T libexample.so | grep Java_</p>
<pre><code>&quot;libnative.so&quot;,
&quot;Java_com_example_app_NativeHelper_doEncrypt&quot;
);

Interceptor.attach(encrypt_func, {
onEnter: function (args) {
// args[0] = JNIEnv*
// args[1] = jclass/jobject
// args[2] = first parameter (jstring)
var jstring_ptr = args[2];
var str_content = Java.vm.getEnv().getStringUtfChars(jstring_ptr, null);
console.log(&quot;Input: &quot; + str_content.readCString());
},
onLeave: function (retval) {
var result = Java.vm.getEnv().getStringUtfChars(retval, null);
console.log(&quot;Output: &quot; + result.readCString());
},
});
</code></pre>
<p>var NativeHelper = Java.use(â€œcom.example.app.NativeHelperâ€);</p>
<p>NativeHelper.doEncrypt.implementation = function (input) {
console.log(â€œJava -&gt; Native:â€ + input); var result =
this.doEncrypt(input); console.log(â€œNative -&gt; Java:â€ + result);
return result; }; });</p>
<pre><code>JNIEXPORT void JNICALL
Java_com_example_app_Security_checkDebugger(JNIEnv *env, jclass clazz) {
if (ptrace(PTRACE_TRACEME, 0, 1, 0) == -1) {
// Debugger detected, execute countermeasure
exit(1);
}
}
</code></pre>
<p>// XOR decryption example static char decrypted[256]; int key = 0x42;
for (int i = 0; encrypted<a href="#i">i</a>; i++) { decrypted<a
href="#i">i</a> = encrypted<a href="#i">i</a> ^ key; } return decrypted;
}</p>
<pre><code>Java_com_example_app_Security_isEmulator(JNIEnv *env, jclass clazz) {
// Check system property
char prop_value[256];
__system_property_get(&quot;ro.kernel.qemu&quot;, prop_value);
return strcmp(prop_value, &quot;1&quot;) == 0;
}
</code></pre>
<ol start="3" type="1">
<li>è§£æè¯¥åº“çš„ä¾èµ–é¡¹ï¼ˆå³å®ƒéœ€è¦ä»å…¶ä»–åº“ï¼Œå¦‚
<code>libc.so</code>ï¼Œå¯¼å…¥çš„å‡½æ•°ï¼‰ï¼Œå¹¶å¡«å……å¯¼å…¥å‡½æ•°çš„åœ°å€ã€‚</li>
<li>æ‰§è¡Œ <code>.init_array</code> ä¸­çš„åˆå§‹åŒ–å‡½æ•°ã€‚ ___ ### é™æ€åˆ†æ</li>
</ol>
<h4 id="è¯†åˆ«å…³é”®å‡½æ•°">è¯†åˆ«å…³é”®å‡½æ•°</h4>
<ul>
<li><p><strong>JNI å‡½æ•°</strong>: åœ¨ IDA/Ghidra ä¸­ï¼Œç›´æ¥åœ¨ç¬¦å·åˆ—è¡¨ä¸­æœç´¢
<code>Java_</code> å‰ç¼€ï¼Œå¯ä»¥å¿«é€Ÿå®šä½æ‰€æœ‰ Java å’Œ Native
çš„äº¤äº’ç‚¹ã€‚</p></li>
<li><p><strong>å¯¼å‡ºå‡½æ•°</strong>: æŸ¥çœ‹ <code>Exports</code>
åˆ—è¡¨ï¼Œå¯»æ‰¾æœ‰æ„ä¹‰çš„å‡½æ•°åï¼Œå¦‚ <code>encrypt</code>, <code>decrypt</code>,
<code>checkSignature</code> ç­‰ã€‚</p></li>
<li><p><strong><code>.init_array</code> å‡½æ•°</strong>: æŸ¥çœ‹
<code>.init_array</code>
sectionï¼Œåˆ†æåœ¨åº“åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ç»å¸¸è¢«ç”¨æ¥å®ç°åè°ƒè¯•æˆ–åˆå§‹åŒ–åŠ å¯†å¯†é’¥ã€‚</p></li>
</ul>
<h4 id="ä½¿ç”¨-ida-pro-ghidra">ä½¿ç”¨ IDA Pro / Ghidra</h4>
<ol type="1">
<li><strong>åŠ è½½æ–‡ä»¶</strong>: å°† <code>.so</code> æ–‡ä»¶æ‹–å…¥ IDA æˆ–
Ghidraã€‚</li>
<li><strong>æŸ¥çœ‹ä¼ªä»£ç </strong>: æŒ‰ <code>F5</code> (IDA) æˆ–ç­‰å¾… Ghidra
çš„è‡ªåŠ¨åˆ†æï¼Œç›´æ¥é˜…è¯»åç¼–è¯‘å‡ºçš„ C ä¼ªä»£ç ã€‚è¿™æ˜¯æœ€é«˜æ•ˆçš„åˆ†ææ–¹å¼ã€‚</li>
<li><strong>äº¤å‰å¼•ç”¨ (Cross-References)</strong>:
å¯¹ä¸€ä¸ªå‡½æ•°åæˆ–å­—ç¬¦ä¸²å¸¸é‡æŒ‰ <code>X</code>
é”®ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¼•ç”¨äº†å®ƒçš„åœ°æ–¹ï¼Œä»è€Œè¿½è¸ªæ•°æ®æµå’Œè°ƒç”¨å…³ç³»ã€‚</li>
<li><strong>å›¾å½¢æ¨¡å¼</strong>:
ä½¿ç”¨å›¾å½¢è§†å›¾æ¥ç†è§£å¤æ‚çš„å‡½æ•°è°ƒç”¨æµç¨‹å’Œæ¡ä»¶åˆ†æ”¯ã€‚ ___ ### åŠ¨æ€åˆ†æ</li>
</ol>
<h4 id="frida-hook-åŸç”Ÿå‡½æ•°">Frida Hook åŸç”Ÿå‡½æ•°</h4>
<p>å½“é™æ€åˆ†æå›°éš¾ï¼ˆå¦‚ä»£ç è¢«æ··æ·†æˆ–ç®—æ³•å¤æ‚ï¼‰æ—¶ï¼ŒåŠ¨æ€ Hook
æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p>
<div class="sourceCode" id="cb581"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="co">// frida script</span></span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> baseAddr <span class="op">=</span> Module<span class="op">.</span><span class="fu">findBaseAddress</span>(<span class="st">&quot;libnative-lib.so&quot;</span>)<span class="op">;</span></span>
<span id="cb581-3"><a href="#cb581-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> targetFuncPtr <span class="op">=</span> baseAddr<span class="op">.</span><span class="fu">add</span>(<span class="bn">0x1234</span>)<span class="op">;</span> <span class="co">// 0x1234 is function offset from IDA/Ghidra</span></span>
<span id="cb581-4"><a href="#cb581-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-5"><a href="#cb581-5" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(targetFuncPtr<span class="op">,</span> {</span>
<span id="cb581-6"><a href="#cb581-6" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb581-7"><a href="#cb581-7" aria-hidden="true" tabindex="-1"></a><span class="co">// args[0], args[1]... are function parameters (pointers)</span></span>
<span id="cb581-8"><a href="#cb581-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Hooked function called!&quot;</span>)<span class="op">;</span></span>
<span id="cb581-9"><a href="#cb581-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Can use Memory.readCString(args[0]) etc. to read parameter content</span></span>
<span id="cb581-10"><a href="#cb581-10" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb581-11"><a href="#cb581-11" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span> (retval) {</span>
<span id="cb581-12"><a href="#cb581-12" aria-hidden="true" tabindex="-1"></a><span class="co">// retval is function return value</span></span>
<span id="cb581-13"><a href="#cb581-13" aria-hidden="true" tabindex="-1"></a><span class="co">// retval.replace(0x1); // Can modify return value</span></span>
<span id="cb581-14"><a href="#cb581-14" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb581-15"><a href="#cb581-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="å­—ç¬¦ä¸²åŠ å¯†">å­—ç¬¦ä¸²åŠ å¯†</h4>
<ul>
<li><p>*ä¿æŠ¤æœºåˆ¶**: <code>.so</code>
æ–‡ä»¶ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¸²ï¼ˆå¦‚å¯†é’¥ã€URLï¼‰è¢«åŠ å¯†å­˜æ”¾ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†ä½¿ç”¨ã€‚é™æ€åˆ†ææ—¶æ— æ³•ç›´æ¥çœ‹åˆ°ã€‚</p></li>
<li><p>*æ”»å‡»æ–¹æ³•**:</p></li>
<li><p>Hook è§£å¯†å‡½æ•°: æ‰¾åˆ°è§£å¯†å‡½æ•°å…¥å£ï¼Œæ‰“å°è§£å¯†åçš„å­—ç¬¦ä¸²</p></li>
<li><p>å†…å­˜ Dump: åœ¨è§£å¯†å Hook å†…å­˜è¯»å–æ“ä½œï¼Œè·å–æ˜æ–‡å­—ç¬¦ä¸²</p></li>
<li><p>äº¤å‰å¼•ç”¨åˆ†æ: ä½¿ç”¨ <code>axt</code>
æŸ¥çœ‹è°ƒç”¨æœ€å¤šçš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è§£å¯†å‡½æ•°</p></li>
</ul>
<div class="sourceCode" id="cb582"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Frida Hook example</span></span>
<span id="cb582-2"><a href="#cb582-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> decrypt_func <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libnative.so&quot;</span><span class="op">,</span> <span class="st">&quot;decrypt_string&quot;</span>)<span class="op">;</span></span>
<span id="cb582-3"><a href="#cb582-3" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(decrypt_func<span class="op">,</span> {</span>
<span id="cb582-4"><a href="#cb582-4" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span> (retval) {</span>
<span id="cb582-5"><a href="#cb582-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Decrypted string:&quot;</span><span class="op">,</span> Memory<span class="op">.</span><span class="fu">readCString</span>(retval))<span class="op">;</span></span>
<span id="cb582-6"><a href="#cb582-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb582-7"><a href="#cb582-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>*æ”»å‡»æ–¹æ³•**:</p></li>
<li><p>åŠ¨æ€åˆ†æä¸ºä¸»: ç»•è¿‡é™æ€åˆ†æå›°éš¾ï¼Œç›´æ¥ Hook å…³é”®å‡½æ•°</p></li>
<li><p>å»æ··æ·†å·¥å…·: ä½¿ç”¨ d810 (IDA æ’ä»¶) ç­‰å·¥å…·å»é™¤æ§åˆ¶æµå¹³å¦åŒ–</p></li>
<li><p>æ¨¡æ‹Ÿæ‰§è¡Œ: ä½¿ç”¨ Unidbg æ¨¡æ‹Ÿæ‰§è¡Œï¼Œè·å–ç®—æ³•è¾“å…¥è¾“å‡º</p></li>
<li><p>æŒ‡ä»¤çº§ Hook: Hook æ±‡ç¼–æŒ‡ä»¤çº§åˆ«ï¼Œè§‚å¯Ÿå¯„å­˜å™¨å˜åŒ–</p></li>
</ul>
<div class="sourceCode" id="cb583"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook instruction-level example</span></span>
<span id="cb583-2"><a href="#cb583-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> baseAddr <span class="op">=</span> Module<span class="op">.</span><span class="fu">findBaseAddress</span>(<span class="st">&quot;libnative.so&quot;</span>)<span class="op">;</span></span>
<span id="cb583-3"><a href="#cb583-3" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(baseAddr<span class="op">.</span><span class="fu">add</span>(<span class="bn">0x1000</span>)<span class="op">,</span> {</span>
<span id="cb583-4"><a href="#cb583-4" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb583-5"><a href="#cb583-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Register state:&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">context</span>)<span class="op">;</span></span>
<span id="cb583-6"><a href="#cb583-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb583-7"><a href="#cb583-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>*æ”»å‡»æ–¹æ³•**:</p></li>
<li><p>Hook åè°ƒè¯•å‡½æ•°: ç›´æ¥è¿”å›æ­£å¸¸å€¼ï¼Œç»•è¿‡æ£€æµ‹</p></li>
<li><p>ä¿®æ”¹æ£€æµ‹é€»è¾‘: ä½¿ç”¨ Frida ä¿®æ”¹å†…å­˜ä¸­çš„åè°ƒè¯•ä»£ç </p></li>
<li><p>ç¯å¢ƒä¼ªè£…: ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼ï¼Œä¼ªè£…æ­£å¸¸ç¯å¢ƒ</p></li>
<li><p>Spawn æ¨¡å¼: ä½¿ç”¨ Frida çš„ spawn æ¨¡å¼ï¼Œåœ¨åº”ç”¨å¯åŠ¨å‰æ³¨å…¥</p></li>
</ul>
<div class="sourceCode" id="cb584"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Bypass anti-debugging example</span></span>
<span id="cb584-2"><a href="#cb584-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> anti_debug <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libnative.so&quot;</span><span class="op">,</span> <span class="st">&quot;check_debug&quot;</span>)<span class="op">;</span></span>
<span id="cb584-3"><a href="#cb584-3" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(anti_debug<span class="op">,</span> {</span>
<span id="cb584-4"><a href="#cb584-4" aria-hidden="true" tabindex="-1"></a><span class="dt">onLeave</span><span class="op">:</span> <span class="kw">function</span> (retval) {</span>
<span id="cb584-5"><a href="#cb584-5" aria-hidden="true" tabindex="-1"></a>retval<span class="op">.</span><span class="fu">replace</span>(<span class="dv">0</span>)<span class="op">;</span> <span class="co">// Return 0 to indicate no debugging detected</span></span>
<span id="cb584-6"><a href="#cb584-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb584-7"><a href="#cb584-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb584-8"><a href="#cb584-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb584-9"><a href="#cb584-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Hook ptrace system call</span></span>
<span id="cb584-10"><a href="#cb584-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ptrace <span class="op">=</span> Module<span class="op">.</span><span class="fu">findExportByName</span>(<span class="st">&quot;libc.so&quot;</span><span class="op">,</span> <span class="st">&quot;ptrace&quot;</span>)<span class="op">;</span></span>
<span id="cb584-11"><a href="#cb584-11" aria-hidden="true" tabindex="-1"></a>Interceptor<span class="op">.</span><span class="fu">attach</span>(ptrace<span class="op">,</span> {</span>
<span id="cb584-12"><a href="#cb584-12" aria-hidden="true" tabindex="-1"></a><span class="dt">onEnter</span><span class="op">:</span> <span class="kw">function</span> (args) {</span>
<span id="cb584-13"><a href="#cb584-13" aria-hidden="true" tabindex="-1"></a>args[<span class="dv">0</span>] <span class="op">=</span> <span class="fu">ptr</span>(<span class="dv">0</span>)<span class="op">;</span> <span class="co">// Modify ptrace arguments</span></span>
<span id="cb584-14"><a href="#cb584-14" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb584-15"><a href="#cb584-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="è°ƒç”¨æ—¶æœºè¯¦è§£">è°ƒç”¨æ—¶æœºè¯¦è§£</h3>
<p><code>.init_array</code> ä¸­çš„å‡½æ•°åœ¨ <strong>ELF
åº“åŠ è½½è¿‡ç¨‹ä¸­çš„æ—©æœŸé˜¶æ®µ</strong> è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶æœºéå¸¸å…³é”®ï¼Œå‘ç”Ÿåœ¨
JNI_OnLoad ä¹‹å‰ã€‚</p>
<h4 id="å®Œæ•´çš„è°ƒç”¨æµç¨‹">å®Œæ•´çš„è°ƒç”¨æµç¨‹</h4>
<pre><code></code></pre>
<p>â†“ nativeLoad() [art/runtime/native/java_lang_Runtime.cc] â†“
android_dlopen_ext() [bionic/libdl/libdl.cpp] â†“ do_dlopen()
[bionic/linker/linker.cpp] â†“ find_library() â†’ load_library() â†’
link_image() â†“ call_constructors() â†’ init_arrayFunctionExecute</p>
<pre><code>// 1. First call DT_INIT initialization function
if (init_func_ != nullptr) {
init_func_();
}

// 2. Then iterate through .init_array section function pointers
if (init_array_ != nullptr) {
for (size_t i = 0; i &lt; init_array_count_; ++i) {
// Call each constructor function, including init_string_obfuscation
((void (*)())init_array_[i])();
}
}
}
</code></pre>
<p>// String obfuscation initialization function declaration
<strong>attribute</strong>((constructor)) void init_string_obfuscation()
{ // String decryption and anti-debugging logic
decrypt_critical_strings(); setup_anti_debug_measures(); }</p>
<p>// Can also specify priority (lower number = higher priority)
<strong>attribute</strong>((constructor(101))) void
init_anti_debug_level1() { // First level anti-debugging detection
basic_environment_check(); }</p>
<p><strong>attribute</strong>((constructor(102))) void
init_string_decryption() { // String decryption, depends on first level
detection passing if (environment_safe) { decrypt_strings(); } }</p>
<pre><code>4. **è¿è¡Œæ—¶è°ƒç”¨**: åŠ¨æ€é“¾æ¥å™¨æŒ‰é¡ºåºè°ƒç”¨æ‰€æœ‰å‡½æ•°æŒ‡é’ˆ


#### å®é™…åº”ç”¨ç¤ºä¾‹

```cpp
// Actual string obfuscation initialization function example
__attribute__((constructor(100)))
void init_string_obfuscation() {
// 1. Environment security check
if (detect_debug_environment()) {
// Debug environment detected, execute countermeasures
execute_anti_debug_response();
return;
}

// 2. Decrypt critical strings
decrypt_api_strings();
decrypt_config_strings();
decrypt_url_strings();

// 3. Mark initialization complete
string_obfuscation_initialized = true;
}

// String decryption function
void decrypt_api_strings() {
// Decrypt API name strings
for (int i = 0; i &lt; API_STRING_COUNT; i++) {
decrypt_string_xor(encrypted_api_names[i],
decrypted_api_names[i],
API_XOR_KEY);
}
}

// XOR decryption implementation
void decrypt_string_xor(const char* encrypted, char* decrypted, uint8_t key) {
int len = strlen(encrypted);
for (int i = 0; i &lt; len; i++) {
decrypted[i] = encrypted[i] ^ key;
}
decrypted[len] = &#39;\0&#39;;
}
</code></pre>
<ul>
<li><strong>ä¼˜å…ˆçº§æ§åˆ¶</strong>:
å¯ä»¥é€šè¿‡å‚æ•°æ§åˆ¶å¤šä¸ªåˆå§‹åŒ–å‡½æ•°çš„æ‰§è¡Œé¡ºåº</li>
</ul>
<h4 id="å®‰å…¨é˜²æŠ¤ä¼˜åŠ¿">2. å®‰å…¨é˜²æŠ¤ä¼˜åŠ¿</h4>
<ul>
<li><p><strong>é™æ€åˆ†æå›°æ‰°</strong>:
åŠ å¯†å­—ç¬¦ä¸²åœ¨é™æ€åˆ†ææ—¶ä¸å¯è§</p></li>
<li><p><strong>è¿è¡Œæ—¶è§£å¯†</strong>:
åªåœ¨è¿è¡Œæ—¶ä¸´æ—¶è§£å¯†ï¼Œå¢åŠ åˆ†æéš¾åº¦</p></li>
<li><p><strong>åè°ƒè¯•é›†æˆ</strong>: å¯åœ¨åˆå§‹åŒ–é˜¶æ®µè¿›è¡Œç¯å¢ƒæ£€æµ‹</p></li>
</ul>
<h4 id="é€†å‘åˆ†ææŒ‘æˆ˜">3. é€†å‘åˆ†ææŒ‘æˆ˜</h4>
<ul>
<li><p><strong>æ—¶æœºæŠŠæ¡å›°éš¾</strong>: Hook éœ€è¦åœ¨ init_array
æ‰§è¡Œå‰å®Œæˆ</p></li>
<li><p><strong>å‡½æ•°å®šä½å¤æ‚</strong>: éœ€è¦åˆ†æ ELF
ç»“æ„æ‰èƒ½å‡†ç¡®å®šä½</p></li>
<li><p><strong>è°ƒè¯•æ—¶æœºçª—å£çŸ­</strong>:
æ‰§è¡Œæ—¶é—´çŸ­ï¼Œéš¾ä»¥åŠæ—¶ä»‹å…¥</p></li>
</ul>
<h3 id="é€†å‘åˆ†æå¯¹ç­–">é€†å‘åˆ†æå¯¹ç­–</h3>
<h4 id="é™æ€åˆ†ææ–¹æ³•">é™æ€åˆ†ææ–¹æ³•</h4>
<div class="sourceCode" id="cb588"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python script to analyze .init_array section</span></span>
<span id="cb588-2"><a href="#cb588-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elftools.elf.elffile <span class="im">import</span> ELFFile</span>
<span id="cb588-3"><a href="#cb588-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb588-4"><a href="#cb588-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_init_array(so_path):</span>
<span id="cb588-5"><a href="#cb588-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(so_path, <span class="st">&#39;rb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb588-6"><a href="#cb588-6" aria-hidden="true" tabindex="-1"></a>elf <span class="op">=</span> ELFFile(f)</span>
<span id="cb588-7"><a href="#cb588-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb588-8"><a href="#cb588-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find .init_array section</span></span>
<span id="cb588-9"><a href="#cb588-9" aria-hidden="true" tabindex="-1"></a>init_array_section <span class="op">=</span> elf.get_section_by_name(<span class="st">&#39;.init_array&#39;</span>)</span>
<span id="cb588-10"><a href="#cb588-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> init_array_section:</span>
<span id="cb588-11"><a href="#cb588-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> init_array_section.data()</span>
<span id="cb588-12"><a href="#cb588-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb588-13"><a href="#cb588-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;[+] Found .init_array section, size: </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> bytes&quot;</span>)</span>
<span id="cb588-14"><a href="#cb588-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb588-15"><a href="#cb588-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse function pointers (8-byte aligned, 64-bit system)</span></span>
<span id="cb588-16"><a href="#cb588-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(data), <span class="dv">8</span>):</span>
<span id="cb588-17"><a href="#cb588-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> i <span class="op">+</span> <span class="dv">8</span> <span class="op">&lt;=</span> <span class="bu">len</span>(data):</span>
<span id="cb588-18"><a href="#cb588-18" aria-hidden="true" tabindex="-1"></a>func_addr <span class="op">=</span> <span class="bu">int</span>.from_bytes(data[i:i<span class="op">+</span><span class="dv">8</span>], <span class="st">&#39;little&#39;</span>)</span>
<span id="cb588-19"><a href="#cb588-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;[+] Init function </span><span class="sc">{</span>i<span class="op">//</span><span class="dv">8</span><span class="sc">}</span><span class="ss">: 0x</span><span class="sc">{</span>func_addr<span class="sc">:x}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<p>// Hook constructor call function var call_constructors =
Module.findExportByName( â€œlinker64â€, â€œ_ZN6soinfo17call_constructorsEvâ€
); if (call_constructors) { Interceptor.attach(call_constructors, {
onEnter: function (args) { var soinfo = args[0]; console.log(â€œ[+]
Calling constructors for SOâ€); this.start_time = Date.now(); }, onLeave:
function (retval) { var duration = Date.now() - this.start_time;
console.log(â€œ[+] Constructors completed inâ€ + duration + â€œmsâ€); }, });
}</p>
<p>// Directly hook init_array functions of target SO
hook_target_init_functions(); }</p>
<p>function hook_target_init_functions() { var target_module =
Process.findModuleByName(â€œlibtarget.soâ€); if (target_module) { // Hook
function at specific address based on static analysis results var
init_func_addr = target_module.base.add(0x2000); // Example address</p>
<p>Interceptor.attach(init_func_addr, { onEnter: function (args) {
console.log(â€œ[!] init_string_obfuscation calledâ€); console.log(â€œ[+] Call
stack:â€); console.log( Thread.backtrace(this.context,
Backtracer.ACCURATE) .map(DebugSymbol.fromAddress) .join(â€œâ€) ); },
onLeave: function (retval) { console.log(â€œ[!] init_string_obfuscation
completedâ€); }, }); } }</p>
<!-- 04-Reference/Foundations/x86_and_arm_assembly_basics.md -->
<h1 id="x86-ä¸-arm-æ±‡ç¼–åŸºç¡€æŒ‡å—">x86 ä¸ ARM æ±‡ç¼–åŸºç¡€æŒ‡å—</h1>
<p>æ±‡ç¼–è¯­è¨€æ˜¯ä¸è®¡ç®—æœºç¡¬ä»¶ç›´æ¥å¯¹è¯çš„ä½çº§ç¼–ç¨‹è¯­è¨€ï¼Œæ˜¯é€†å‘å·¥ç¨‹ã€ç³»ç»Ÿç¼–ç¨‹å’Œæ€§èƒ½ä¼˜åŒ–çš„åŸºçŸ³ã€‚åœ¨å½“ä»Šä¸–ç•Œï¼Œx86
å’Œ ARM æ˜¯ä¸¤ç§æœ€ä¸»æµçš„æŒ‡ä»¤é›†æ¶æ„
(ISA)ã€‚ç†è§£å®ƒä»¬çš„æ ¸å¿ƒæ¦‚å¿µä¸å·®å¼‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆè‡³å…³é‡è¦ã€‚</p>
<ul>
<li><p><strong>x86</strong>: ç”± Intel ä¸»å¯¼ï¼Œé‡‡ç”¨<strong>CISC
(å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœº)</strong>
è®¾è®¡ã€‚æŒ‡ä»¤é•¿åº¦å¯å˜ï¼ŒåŠŸèƒ½å¼ºå¤§ä½†å¤æ‚ï¼Œä¸»è¦ç”¨äºæ¡Œé¢å’ŒæœåŠ¡å™¨ã€‚</p></li>
<li><p><strong>ARM</strong>: ç”± ARM Holdings è®¾è®¡ï¼Œé‡‡ç”¨<strong>RISC
(ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœº)</strong>
è®¾è®¡ã€‚æŒ‡ä»¤é•¿åº¦å›ºå®šï¼Œè®¾è®¡ç®€æ´ä¼˜é›…ï¼ŒåŠŸè€—ä½ï¼Œä¸»å®°äº†ç§»åŠ¨å’ŒåµŒå…¥å¼è®¾å¤‡é¢†åŸŸã€‚
___ ## ç›®å½•</p></li>
<li><p><a href="#x86-ä¸-arm-æ±‡ç¼–åŸºç¡€æŒ‡å—">x86 ä¸ ARM
æ±‡ç¼–åŸºç¡€æŒ‡å—</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#x86-æ±‡ç¼–-ia-32">x86 æ±‡ç¼– (IA-32)</a></p></li>
<li><p><a href="#æ ¸å¿ƒå¯„å­˜å™¨">æ ¸å¿ƒå¯„å­˜å™¨</a></p></li>
<li><p><a href="#å¸¸ç”¨æŒ‡ä»¤">å¸¸ç”¨æŒ‡ä»¤</a></p></li>
<li><p><a href="#è°ƒç”¨çº¦å®š-calling-convention">è°ƒç”¨çº¦å®š (Calling
Convention)</a></p></li>
<li><p><a href="#arm-æ±‡ç¼–-armv7">ARM æ±‡ç¼– (ARMv7)</a></p></li>
<li><p><a href="#æ ¸å¿ƒå¯„å­˜å™¨-1">æ ¸å¿ƒå¯„å­˜å™¨</a></p></li>
<li><p><a href="#åŠ è½½å­˜å‚¨-loadstore-æ¶æ„">åŠ è½½/å­˜å‚¨ (Load/Store)
æ¶æ„</a></p></li>
<li><p><a href="#å¸¸ç”¨æŒ‡ä»¤-1">å¸¸ç”¨æŒ‡ä»¤</a></p></li>
<li><p><a href="#è°ƒç”¨çº¦å®š-aapcs">è°ƒç”¨çº¦å®š (AAPCS)</a></p></li>
<li><p><a href="#x86-vs-arm-æ ¸å¿ƒå·®å¼‚å¯¹æ¯”">x86 vs.Â ARM æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</a>
___ ## x86 æ±‡ç¼– (IA-32) ä»¥ 32 ä½ x86
æ¶æ„ä¸ºä¾‹ï¼Œå…¶è®¾è®¡å¤æ‚è€Œçµæ´»ã€‚</p></li>
</ul>
<h3 id="æ ¸å¿ƒå¯„å­˜å™¨">æ ¸å¿ƒå¯„å­˜å™¨</h3>
<p>8 ä¸ª 32 ä½é€šç”¨å¯„å­˜å™¨ï¼Œå®ƒä»¬æœ‰ä¸»è¦ç”¨é€”ï¼Œä½†åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥é€šç”¨ã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å¯„å­˜å™¨</th>
<th style="text-align: left;">ä¸»è¦ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>EAX</strong></td>
<td style="text-align: left;"><strong>ç´¯åŠ å™¨ (Accumulator)</strong>:
é€šå¸¸ç”¨äºå­˜æ”¾å‡½æ•°è¿”å›å€¼å’Œç®—æœ¯è¿ç®—ç»“æœã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>EBX</strong></td>
<td style="text-align: left;"><strong>åŸºå€ (Base)</strong>:
å¸¸ä½œä¸ºæ•°æ®æ®µçš„åŸºå€æŒ‡é’ˆã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ECX</strong></td>
<td style="text-align: left;"><strong>è®¡æ•°å™¨ (Counter)</strong>:
å¸¸ç”¨äºå¾ªç¯è®¡æ•°ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>EDX</strong></td>
<td style="text-align: left;"><strong>æ•°æ® (Data)</strong>:
å¸¸ç”¨äºå­˜æ”¾æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¹˜é™¤æ³•ä¸­ä¸ EAX é…åˆã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ESP</strong></td>
<td style="text-align: left;"><strong>æ ˆæŒ‡é’ˆ (Stack Pointer)</strong>:
<strong>æ°¸è¿œæŒ‡å‘æ ˆé¡¶</strong>ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>EBP</strong></td>
<td style="text-align: left;"><strong>åŸºå€æŒ‡é’ˆ (Base Pointer)</strong>:
<strong>æ°¸è¿œæŒ‡å‘å½“å‰å‡½æ•°æ ˆå¸§çš„åº•éƒ¨</strong>ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ESI</strong></td>
<td style="text-align: left;"><strong>æºå˜å€ (Source Index)</strong>:
å­—ç¬¦ä¸²å’Œå†…å­˜æ“ä½œä¸­çš„æºåœ°å€ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>EDI</strong></td>
<td style="text-align: left;"><strong>ç›®çš„å˜å€ (Destination
Index)</strong>: å­—ç¬¦ä¸²å’Œå†…å­˜æ“ä½œä¸­çš„ç›®çš„åœ°å€ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>EIP</strong></td>
<td style="text-align: left;"><strong>æŒ‡ä»¤æŒ‡é’ˆ (Instruction
Pointer)</strong>:
<strong>æ°¸è¿œæŒ‡å‘ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</strong>ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="å¸¸ç”¨æŒ‡ä»¤">å¸¸ç”¨æŒ‡ä»¤</h3>
<ul>
<li><p><strong>æ•°æ®ä¼ é€</strong>:</p></li>
<li><p><code>MOV dest, src</code>: å°† <code>src</code> çš„å€¼èµ‹ç»™
<code>dest</code>ã€‚ (e.g., <code>MOV EAX, EBX</code>)</p></li>
<li><p><code>PUSH val</code>: å°† <code>val</code>
å‹å…¥æ ˆé¡¶ï¼Œ<code>ESP</code> å‡ 4ã€‚</p></li>
<li><p><code>POP reg</code>: ä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå€¼åˆ°
<code>reg</code>ï¼Œ<code>ESP</code> åŠ  4ã€‚</p></li>
<li><p><code>LEA reg, [mem]</code>: å°† <code>mem</code>
çš„<strong>æœ‰æ•ˆåœ°å€</strong>åŠ è½½åˆ°
<code>reg</code>ï¼Œè€Œä¸æ˜¯å…¶å†…å®¹ã€‚</p></li>
<li><p><strong>ç®—æœ¯è¿ç®—</strong>:</p></li>
<li><p><code>ADD dest, src</code>:
<code>dest = dest + src</code></p></li>
<li><p><code>SUB dest, src</code>:
<code>dest = dest - src</code></p></li>
<li><p><code>INC reg</code>: <code>reg = reg + 1</code></p></li>
<li><p><code>DEC reg</code>: <code>reg = reg - 1</code></p></li>
<li><p><strong>é€»è¾‘ä¸è·³è½¬</strong>:</p></li>
<li><p><code>CMP reg1, reg2</code>: æ¯”è¾ƒ <code>reg1</code> å’Œ
<code>reg2</code> (å®é™…æ˜¯åšå‡æ³•)ï¼Œå¹¶æ ¹æ®ç»“æœè®¾ç½®æ ‡å¿—ä½ã€‚</p></li>
<li><p><code>JMP target</code>: æ— æ¡ä»¶è·³è½¬åˆ° <code>target</code>
åœ°å€ã€‚</p></li>
<li><p><code>JE target</code>: å¦‚æœç›¸ç­‰ (Zero Flag=1) åˆ™è·³è½¬ã€‚</p></li>
<li><p><code>JNE target</code>: å¦‚æœä¸ç›¸ç­‰ (Zero Flag=0)
åˆ™è·³è½¬ã€‚</p></li>
<li><p><code>JG/JL/JGE/JLE</code>:
å¤§äº/å°äº/å¤§äºç­‰äº/å°äºç­‰äºæ—¶è·³è½¬ã€‚</p></li>
<li><p><strong>å‡½æ•°è°ƒç”¨</strong>:</p></li>
<li><p><code>CALL target</code>: å°† <code>EIP</code>
çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹æ ˆï¼Œç„¶åè·³è½¬åˆ° <code>target</code>ã€‚</p></li>
<li><p><code>RET</code>: ä»æ ˆé¡¶å¼¹å‡ºåœ°å€ï¼Œå¹¶è·³è½¬åˆ°è¯¥åœ°å€ã€‚</p></li>
</ul>
<h3 id="è°ƒç”¨çº¦å®š-calling-convention">è°ƒç”¨çº¦å®š (Calling Convention)</h3>
<p>è§„å®šäº†å‡½æ•°å¦‚ä½•ä¼ é€’å‚æ•°å’Œè¿”å›ç»“æœã€‚å¸¸è§äº 32 ä½ Windows çš„æ˜¯
<code>stdcall</code>ï¼Œè€Œ Linux/macOS ä¸Šå¸¸è§ <code>cdecl</code>ã€‚</p>
<ul>
<li><p><strong><code>cdecl</code></strong>:</p></li>
<li><p>å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­ã€‚</p></li>
<li><p><strong>è°ƒç”¨è€…</strong>è´Ÿè´£åœ¨å‡½æ•°è¿”å›åæ¸…ç†æ ˆã€‚</p></li>
<li><p><strong><code>stdcall</code></strong>:</p></li>
<li><p>å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­ã€‚</p></li>
<li><p><strong>è¢«è°ƒç”¨è€…</strong>è‡ªå·±è´Ÿè´£åœ¨è¿”å›å‰æ¸…ç†æ ˆã€‚ ___ ## ARM æ±‡ç¼–
(ARMv7) ä»¥ 32 ä½ ARM æ¶æ„ä¸ºä¾‹ï¼Œå…¶è®¾è®¡ç®€æ´è€Œé«˜æ•ˆã€‚</p></li>
</ul>
<h3 id="æ ¸å¿ƒå¯„å­˜å™¨-1">æ ¸å¿ƒå¯„å­˜å™¨</h3>
<p>å…±æœ‰ 16 ä¸ª 32 ä½é€šç”¨å¯„å­˜å™¨ (R0-R15)ã€‚</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">å¯„å­˜å™¨</th>
<th style="text-align: left;">åˆ«å</th>
<th style="text-align: left;">ä¸»è¦ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>R0 - R3</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>å‚æ•°/è¿”å›å€¼</strong>:
ç”¨äºä¼ é€’å‡½æ•°çš„å‰ 4 ä¸ªå‚æ•°ï¼Œ<code>R0</code> ä¹Ÿç”¨äºå­˜æ”¾å‡½æ•°è¿”å›å€¼ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>R4 - R12</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">é€šç”¨å¯„å­˜å™¨ï¼Œç”¨äºä¿å­˜å±€éƒ¨å˜é‡ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>R13</strong></td>
<td style="text-align: left;"><strong>SP</strong></td>
<td style="text-align: left;"><strong>æ ˆæŒ‡é’ˆ (Stack Pointer)</strong>:
æŒ‡å‘æ ˆé¡¶ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>R14</strong></td>
<td style="text-align: left;"><strong>LR</strong></td>
<td style="text-align: left;"><strong>é“¾æ¥å¯„å­˜å™¨ (Link
Register)</strong>: <strong>å­˜å‚¨å‡½æ•°çš„è¿”å›åœ°å€</strong>ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>R15</strong></td>
<td style="text-align: left;"><strong>PC</strong></td>
<td style="text-align: left;"><strong>ç¨‹åºè®¡æ•°å™¨ (Program
Counter)</strong>: <strong>æŒ‡å‘ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤</strong>ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="åŠ è½½å­˜å‚¨-loadstore-æ¶æ„">åŠ è½½/å­˜å‚¨ (Load/Store) æ¶æ„</h3>
<p>è¿™æ˜¯ RISC çš„æ ¸å¿ƒæ€æƒ³ã€‚<strong>CPU
ä¸èƒ½ç›´æ¥å¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œè¿ç®—</strong>ã€‚ 1. å¿…é¡»å…ˆç”¨ <code>LDR</code>
(Load Register) æŒ‡ä»¤å°†å†…å­˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ã€‚ 2.
åœ¨å¯„å­˜å™¨ä¹‹é—´å®Œæˆæ‰€æœ‰ç®—æœ¯å’Œé€»è¾‘è¿ç®—ã€‚ 3. å†ç”¨ <code>STR</code> (Store
Register) æŒ‡ä»¤å°†ç»“æœå­˜å›å†…å­˜ã€‚</p>
<h3 id="å¸¸ç”¨æŒ‡ä»¤-1">å¸¸ç”¨æŒ‡ä»¤</h3>
<ul>
<li><p><strong>æ•°æ®ä¼ é€</strong>:</p></li>
<li><p><code>MOV Rd, Rn</code>: å°† <code>Rn</code> çš„å€¼èµ‹ç»™
<code>Rd</code>ã€‚ (e.g., <code>MOV R0, R1</code>)</p></li>
<li><p><strong>ç®—æœ¯è¿ç®—</strong>:</p></li>
<li><p><code>ADD Rd, Rn, Rm</code>: <code>Rd = Rn + Rm</code></p></li>
<li><p><code>SUB Rd, Rn, Rm</code>: <code>Rd = Rn - Rm</code></p></li>
<li><p><strong>å†…å­˜æ“ä½œ</strong>:</p></li>
<li><p><code>LDR Rd, [Rn, #offset]</code>: ä»åœ°å€
<code>Rn + offset</code> åŠ è½½ä¸€ä¸ªå­—åˆ° <code>Rd</code>ã€‚</p></li>
<li><p><code>STR Rd, [Rn, #offset]</code>: å°† <code>Rd</code>
çš„å€¼å­˜å‚¨åˆ°ä¸€ä¸ªå­—åˆ°åœ°å€ <code>Rn + offset</code>ã€‚</p></li>
<li><p><strong>æ ˆæ“ä½œ</strong>:</p></li>
<li><p><code>PUSH {reg_list}</code>: å°†å¯„å­˜å™¨åˆ—è¡¨å‹å…¥æ ˆã€‚</p></li>
<li><p><code>POP {reg_list}</code>:
å°†å€¼ä»æ ˆä¸­å¼¹å‡ºåˆ°å¯„å­˜å™¨åˆ—è¡¨ã€‚</p></li>
<li><p><strong>è·³è½¬ä¸æ¯”è¾ƒ</strong>:</p></li>
<li><p><code>CMP Rn, Rm</code>: æ¯”è¾ƒ <code>Rn</code> å’Œ
<code>Rm</code>ï¼Œå¹¶è®¾ç½®æ ‡å¿—ä½ã€‚</p></li>
<li><p><code>B target</code>: æ— æ¡ä»¶è·³è½¬åˆ°
<code>target</code>ã€‚</p></li>
<li><p><code>BEQ target</code>: å¦‚æœç›¸ç­‰åˆ™è·³è½¬ã€‚</p></li>
<li><p><code>BNE target</code>: å¦‚æœä¸ç›¸ç­‰åˆ™è·³è½¬ã€‚</p></li>
<li><p><code>BL target</code>: <strong>(Branch with Link)</strong>
â€œè°ƒç”¨å‡½æ•°â€ã€‚å®ƒä¼š<strong>è‡ªåŠ¨å°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜å…¥ LR
å¯„å­˜å™¨</strong>ï¼Œç„¶åè·³è½¬åˆ° <code>target</code>ã€‚</p></li>
<li><p>å‡½æ•°è¿”å›æ—¶ï¼Œåªéœ€æ‰§è¡Œ <code>MOV PC, LR</code> æˆ–
<code>BX LR</code> å³å¯ã€‚</p></li>
</ul>
<h3 id="è°ƒç”¨çº¦å®š-aapcs">è°ƒç”¨çº¦å®š (AAPCS)</h3>
<p>ARM Procedure Call Standardã€‚</p>
<ul>
<li><p><strong>å‚æ•°ä¼ é€’</strong>:</p></li>
<li><p>å‰ 4 ä¸ªå‚æ•°é€šè¿‡ <strong>R0, R1, R2, R3</strong> ä¼ é€’ã€‚</p></li>
<li><p>å‰©ä½™çš„å‚æ•°é€šè¿‡æ ˆä¼ é€’ã€‚</p></li>
<li><p><strong>è¿”å›å€¼</strong>:</p></li>
<li><p>è¿”å›å€¼å­˜å‚¨åœ¨ <strong>R0</strong> ä¸­ã€‚</p></li>
<li><p><strong>è¿”å›åœ°å€</strong>:</p></li>
<li><p>é€šè¿‡ <strong>LR</strong> å¯„å­˜å™¨ç®¡ç†ã€‚ ___ ## x86 vs.Â ARM
æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</p></li>
</ul>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">x86 (CISC)</th>
<th style="text-align: left;">ARM (RISC)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>æŒ‡ä»¤é›†</strong></td>
<td style="text-align: left;">å¤æ‚ï¼Œé•¿åº¦å¯å˜</td>
<td style="text-align: left;">ç²¾ç®€ï¼Œé•¿åº¦å›ºå®š</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å†…å­˜è®¿é—®</strong></td>
<td style="text-align: left;"><strong>å¯ä»¥ç›´æ¥å¯¹å†…å­˜æ“ä½œ</strong> (e.g.,
<code>ADD [mem], EAX</code>)</td>
<td style="text-align: left;"><strong>åŠ è½½/å­˜å‚¨æ¶æ„</strong> (å¿…é¡»å…ˆ
<code>LDR</code>ï¼Œå† <code>STR</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å¯„å­˜å™¨</strong></td>
<td style="text-align: left;">è¾ƒå°‘ï¼Œä¸”æœ‰ç‰¹å®šç”¨é€”</td>
<td style="text-align: left;">è¾ƒå¤šï¼Œå¤§å¤šä¸ºé€šç”¨å¯„å­˜å™¨</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å‡½æ•°è°ƒç”¨</strong></td>
<td style="text-align: left;"><code>CALL</code> æŒ‡ä»¤å‹æ ˆ
<code>EIP</code></td>
<td style="text-align: left;"><code>BL</code> æŒ‡ä»¤å°†è¿”å›åœ°å€å­˜å…¥
<code>LR</code> å¯„å­˜å™¨</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å‚æ•°ä¼ é€’</strong></td>
<td style="text-align: left;">ä¸»è¦é€šè¿‡<strong>æ ˆ</strong></td>
<td style="text-align: left;">ä¸»è¦é€šè¿‡<strong>å¯„å­˜å™¨</strong>
(R0-R3)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ¡ä»¶æ‰§è¡Œ</strong></td>
<td style="text-align: left;">é€šè¿‡ <code>CMP</code> å’Œ <code>Jcc</code>
è·³è½¬æŒ‡ä»¤</td>
<td
style="text-align: left;"><strong>æ‰€æœ‰æŒ‡ä»¤éƒ½å¯ä»¥æ˜¯æ¡ä»¶æ‰§è¡Œçš„</strong>
(e.g., <code>MOVEQ R0, R1</code>)</td>
</tr>
</tbody>
</table>
<!-- 05-Appendix/ctf_platforms.md -->
<hr />
<h1 id="ctf-ä¸-ç»ƒä¹ å¹³å°-ctf-practice-platforms">CTF ä¸ ç»ƒä¹ å¹³å° (CTF
&amp; Practice Platforms)</h1>
<p>å®è·µæ˜¯æŒæ¡é€†å‘å·¥ç¨‹æŠ€æœ¯çš„å…³é”®ã€‚æœ¬é¡µé¢æ•´ç†äº†æä¾› Android é€†å‘æŒ‘æˆ˜çš„ CTF
å¹³å°å’Œ CrackMe ç½‘ç«™ã€‚</p>
<hr />
<h2 id="ç§»åŠ¨å®‰å…¨ä¸“é¡¹æŒ‘æˆ˜-mobile-specific-challenges">ç§»åŠ¨å®‰å…¨ä¸“é¡¹æŒ‘æˆ˜
(Mobile Specific Challenges)</h2>
<h3 id="owasp-uncrackable-apps">OWASP UnCrackable Apps</h3>
<ul>
<li><strong>æè¿°</strong>: OWASP å®˜æ–¹æä¾›çš„ä¸€ç³»åˆ— Android å’Œ iOS
é€†å‘æŒ‘æˆ˜åº”ç”¨ï¼Œåˆ†ä¸º Level 1 åˆ° Level 4 ä¸åŒéš¾åº¦ã€‚æ˜¯å­¦ä¹ ç§»åŠ¨å®‰å…¨æµ‹è¯•æ ‡å‡†
(MSTG) çš„æœ€ä½³é…å¥—ç»ƒä¹ ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://github.com/OWASP/owasp-mastg/tree/master/Crackmes">OWASP
MSTG Repo</a></li>
</ul>
<h3 id="google-ctf-mobile-category">Google CTF (Mobile Category)</h3>
<ul>
<li><strong>æè¿°</strong>: Google æ¯å¹´ä¸¾åŠçš„ CTF æ¯”èµ›ä¸­çš„ Mobile
ç±»ç›®é¢˜ç›®ã€‚è¿™äº›é¢˜ç›®é€šå¸¸è´¨é‡å¾ˆé«˜ï¼Œæ¶‰åŠå„ç§ Android
ç‰¹æ€§å’Œæ–°é¢–çš„ä¿æŠ¤æœºåˆ¶ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://capturetheflag.withgoogle.com/">Google CTF Archives</a>
(æŸ¥çœ‹å†å¹´é¢˜ç›®)</li>
</ul>
<h3 id="android-app-reverse-engineering-101-crackmes">android App
Reverse Engineering 101 Crackmes</h3>
<ul>
<li><strong>æè¿°</strong>: Maddie Stone åœ¨å¥¹çš„ Workshop
ä¸­ä½¿ç”¨çš„ç»ƒä¹ é¢˜ç›®ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://github.com/maddiestone/AndroidAppRE">GitHub Repo</a></li>
</ul>
<hr />
<h2 id="ç»¼åˆ-ctf-å¹³å°-general-ctf-platforms">ç»¼åˆ CTF å¹³å° (General CTF
Platforms)</h2>
<h3 id="hack-the-box-htb">Hack The Box (HTB)</h3>
<ul>
<li><strong>æè¿°</strong>: è‘—åçš„æ¸—é€æµ‹è¯•ç»ƒä¹ å¹³å°ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸å°‘ Android
é€†å‘ç›¸å…³çš„ Challenge (é€šå¸¸åœ¨ Mobile æˆ– Reversing åˆ†ç±»ä¸‹) å’Œ
Machineã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://www.hackthebox.com/">https://www.hackthebox.com/</a></li>
</ul>
<h3 id="tryhackme">TryHackMe</h3>
<ul>
<li><strong>æè¿°</strong>:
å¯¹åˆå­¦è€…æ›´å‹å¥½çš„ç½‘ç»œå®‰å…¨å­¦ä¹ å¹³å°ï¼Œæä¾›æœ‰å¼•å¯¼æ€§çš„ Android é€†å‘æˆ¿é—´
(Rooms)ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://tryhackme.com/">https://tryhackme.com/</a></li>
</ul>
<h3 id="ctftime">CTFtime</h3>
<ul>
<li><strong>æè¿°</strong>: å…¨çƒ CTF
èµ›äº‹èšåˆå¹³å°ã€‚å¯ä»¥åœ¨è¿™é‡Œå…³æ³¨å³å°†å¼€å§‹çš„æ¯”èµ›ï¼Œå¾ˆå¤šç»¼åˆæ€§æ¯”èµ›éƒ½ä¼šåŒ…å«
Reverse å’Œ Mobile æ–¹å‘çš„é¢˜ç›®ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://ctftime.org/">https://ctftime.org/</a></li>
</ul>
<hr />
<h2 id="crackme-ç½‘ç«™">CrackMe ç½‘ç«™</h2>
<h3 id="crackmes.one">Crackmes.one</h3>
<ul>
<li><strong>æè¿°</strong>: å…¨çƒæœ€å¤§çš„ CrackMe æ”¶é›†ç½‘ç«™ã€‚ä½ å¯ä»¥é€šè¿‡æœç´¢
â€œAndroidâ€ æˆ– â€œAPKâ€ æ ‡ç­¾æ‰¾åˆ°å¤§é‡çš„ Android
é€†å‘ç»ƒä¹ ç¨‹åºï¼Œéš¾åº¦ä»ç®€å•åˆ°æéš¾éƒ½æœ‰ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://crackmes.one/">https://crackmes.one/</a></li>
</ul>
<h3 id="root-me">Root Me</h3>
<ul>
<li><strong>æè¿°</strong>: ä¸€ä¸ªæ¶µç›–å„ç§å®‰å…¨é¢†åŸŸçš„ç»ƒä¹ å¹³å°ï¼Œå…¶ â€œCrackingâ€
å’Œ â€œApp - Scriptâ€ åˆ†ç±»ä¸‹æœ‰ä¸€äº›é’ˆå¯¹ç§»åŠ¨åº”ç”¨çš„æŒ‘æˆ˜ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a
href="https://www.root-me.org/">https://www.root-me.org/</a></li>
</ul>
<hr />
<h2 id="æ¨èç»ƒä¹ è·¯çº¿">æ¨èç»ƒä¹ è·¯çº¿</h2>
<ol type="1">
<li><strong>å…¥é—¨</strong>: ä» <strong>OWASP UnCrackable Level 1</strong>
å¼€å§‹ï¼Œå­¦ä¹ åŸºæœ¬çš„åç¼–è¯‘ã€ä»£ç åˆ†æå’Œç®€å•çš„é€»è¾‘ç»•è¿‡ã€‚</li>
<li><strong>è¿›é˜¶</strong>: å°è¯• <strong>Crackmes.one</strong>
ä¸Šè¯„åˆ†è¾ƒé«˜çš„ Android é¢˜ç›®ï¼Œæˆ–è€… <strong>Hack The Box</strong> çš„ç®€å•
Mobile æŒ‘æˆ˜ã€‚</li>
<li><strong>é«˜çº§</strong>: æŒ‘æˆ˜ <strong>Google CTF</strong>
çš„å†å²é¢˜ç›®ï¼Œæˆ–è€… <strong>OWASP UnCrackable Level
3/4</strong>ï¼Œä¸»è¦æ¶‰åŠå„ç§åè°ƒè¯•ã€Native å±‚æ··æ·†ã€å£³åˆ†æç­‰ã€‚</li>
</ol>
<hr />
<!-- 05-Appendix/github_projects.md -->
<h1 id="é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„-github-å¼€æºé¡¹ç›®">é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„ GitHub
å¼€æºé¡¹ç›®</h1>
<p>æœ¬åˆ—è¡¨æ—¨åœ¨æ”¶é›†å’Œåˆ†ç±»é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜ç§€å¼€æºé¡¹ç›®ï¼Œæ–¹ä¾¿æŸ¥é˜…å’Œå­¦ä¹ ã€‚ ___
## ç›®å½•</p>
<ul>
<li><p><a href="#é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„-github-å¼€æºé¡¹ç›®">é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„
GitHub å¼€æºé¡¹ç›®</a></p></li>
<li><p><a href="#ç›®å½•">ç›®å½•</a></p></li>
<li><p><a href="#1-åŠ¨æ€åˆ†æä¸æ’æ¡©å·¥å…·">1.
åŠ¨æ€åˆ†æä¸æ’æ¡©å·¥å…·</a></p></li>
<li><p><a href="#2-åæ±‡ç¼–å™¨ä¸åç¼–è¯‘å™¨">2.
åæ±‡ç¼–å™¨ä¸åç¼–è¯‘å™¨</a></p></li>
<li><p><a href="#3-è°ƒè¯•å™¨">3. è°ƒè¯•å™¨</a></p></li>
<li><p><a href="#4-é™æ€åˆ†æä¸äºŒè¿›åˆ¶åˆ†æ">4.
é™æ€åˆ†æä¸äºŒè¿›åˆ¶åˆ†æ</a></p></li>
<li><p><a href="#5-android-å¹³å°">5. Android å¹³å°</a></p></li>
<li><p><a href="#6-å¤šå¹³å°ä¸é€šç”¨å·¥å…·">6. å¤šå¹³å°ä¸é€šç”¨å·¥å…·</a></p></li>
<li><p><a href="#7-hex-ç¼–è¾‘å™¨">7. Hex ç¼–è¾‘å™¨</a></p></li>
<li><p><a href="#8-è„±å£³ä¸åæ··æ·†">8. è„±å£³ä¸åæ··æ·†</a></p></li>
<li><p><a href="#9-å›ºä»¶åˆ†æ">9. å›ºä»¶åˆ†æ</a></p></li>
<li><p><a href="#10-apple-å¹³å°-iosmacos">10. Apple å¹³å°
(iOS/macOS)</a></p></li>
<li><p><a href="#11-å…¶ä»–ä¸èµ„æº">11. å…¶ä»–ä¸èµ„æº</a> ___ ### 1.
åŠ¨æ€åˆ†æä¸æ’æ¡©å·¥å…·</p></li>
</ul>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/frida/frida">frida/frida</a></td>
<td>14.5k</td>
<td>è·¨å¹³å°åŠ¨æ€æ’æ¡©æ¡†æ¶ï¼Œæ”¯æŒ Windows, macOS, Linux, iOS, Android, å’Œ
QNXã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/DynamoRIO/dynamorio">DynamoRIO/dynamorio</a></td>
<td>1.8k</td>
<td>Google å‡ºå“çš„è·¨å¹³å°åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://www.intel.com/content/www/us/en/developer/articles/tool/pin-a-dynamic-binary-instrumentation-tool.html">intel/pin</a></td>
<td>N/A</td>
<td>Intel å‡ºå“çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/googleprojectzero/winafl">googleprojectzero/winafl</a></td>
<td>2.1k</td>
<td>AFL çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œç”¨äºå¯¹ Windows äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/processhacker/processhacker">processhacker/processhacker</a></td>
<td>3.2k</td>
<td>å¼ºå¤§çš„å¤šç”¨é€”å·¥å…·ï¼Œç”¨äºç›‘æ§ç³»ç»Ÿèµ„æºã€è°ƒè¯•è½¯ä»¶å’Œæ£€æµ‹æ¶æ„è½¯ä»¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/dsincl/procmon-parser">dsincl/procmon-parser</a></td>
<td>170</td>
<td>Sysinternals Process Monitor (Procmon) çš„æ—¥å¿—è§£æå™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/microsoft/detours">microsoft/Detours</a></td>
<td>1.9k</td>
<td>å¾®è½¯å®˜æ–¹çš„ API Hooking å·¥å…·åº“ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/easyhook/EasyHook">easyhook/EasyHook</a></td>
<td>1.8k</td>
<td>å¼ºå¤§çš„ Windows API Hooking åº“ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/tmate-io/tmate">tmate-io/tmate</a></td>
<td>3.5k</td>
<td>å³æ—¶ç»ˆç«¯å…±äº«å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/lief-project/LIEF">lief-project/LIEF</a></td>
<td>4k</td>
<td>ç”¨äºè§£æã€ä¿®æ”¹å’ŒæŠ½è±¡ ELF, PE, MachO æ ¼å¼çš„åº“ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/qbdi/QBDI">qbdi/QBDI</a></td>
<td>680</td>
<td>åŸºäº LLVM çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/jmpews/dobby">jmpews/dobby</a></td>
<td>1.6k</td>
<td>è½»é‡çº§ã€å¤šå¹³å°ã€å¤šæ¶æ„çš„ Hook æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/aslody/whale">aslody/whale</a></td>
<td>880</td>
<td>è·¨å¹³å°çš„ Hook æ¡†æ¶ (Android/iOS/Linux/macOS)ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/iqiyi/xHook">iqiyi/xHook</a></td>
<td>1.6k</td>
<td>ç”¨äº Android aarch64/arm/x86 å¹³å°çš„ PLT hook åº“ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/facebook/fishhook">facebook/fishhook</a></td>
<td>3.8k</td>
<td>åœ¨ iOS/macOS ä¸ŠåŠ¨æ€é‡ç»‘å®š Mach-O äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ç¬¦å·ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="åæ±‡ç¼–å™¨ä¸åç¼–è¯‘å™¨">2. åæ±‡ç¼–å™¨ä¸åç¼–è¯‘å™¨</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://github.com/NationalSecurityAgency/ghidra">NationalSecurityAgency/ghidra</a></td>
<td>47.9k</td>
<td>NSA å‡ºå“çš„è½¯ä»¶é€†å‘å·¥ç¨‹æ¡†æ¶ï¼ŒåŒ…å«åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/radareorg/radare2">radareorg/radare2</a></td>
<td>19.8k</td>
<td>å¼€æºçš„é€†å‘å·¥ç¨‹æ¡†æ¶å’Œå‘½ä»¤è¡Œå·¥å…·é›†ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/rizin-re/rizin">rizin-re/rizin</a></td>
<td>2.5k</td>
<td>radare2 çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸“æ³¨äºå¯ç”¨æ€§å’Œç¤¾åŒºã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/avast/retdec">avast/retdec</a></td>
<td>8.2k</td>
<td>åŸºäº LLVM çš„å¯é‡å®šå‘æœºå™¨ç åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/yegord/snowman">yegord/snowman</a></td>
<td>1.8k</td>
<td>æ”¯æŒ x86, ARM å’Œ x86-64 çš„åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/aquynh/capstone">aquynh/capstone</a></td>
<td>7.4k</td>
<td>å¼ºå¤§çš„å¤šæ¶æ„åæ±‡ç¼–æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/keystone-engine/keystone">keystone-engine/keystone</a></td>
<td>3.9k</td>
<td>è½»é‡çº§å¤šæ¶æ„æ±‡ç¼–å™¨æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/unicorn-engine/unicorn">unicorn-engine/unicorn</a></td>
<td>7.5k</td>
<td>åŸºäº QEMU çš„å¤šæ¶æ„ CPU æ¨¡æ‹Ÿå™¨æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/lifting-bits/mcsema">lifting-bits/mcsema</a></td>
<td>1.7k</td>
<td>å°† x86/64, aarch64 äºŒè¿›åˆ¶æ–‡ä»¶æå‡åˆ° LLVM IRã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/maji-cat/redress">maji-cat/redress</a></td>
<td>680</td>
<td>åŸºäº Triton çš„äºŒè¿›åˆ¶åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/wtdcode/retdec-idaplugin">wtdcode/retdec-idaplugin</a></td>
<td>500+</td>
<td>RetDec åç¼–è¯‘å™¨çš„ IDA æ’ä»¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/airbus-seclab/bincat">airbus-seclab/bincat</a></td>
<td>1k</td>
<td>äºŒè¿›åˆ¶ä»£ç é™æ€åˆ†æå·¥å…·ï¼Œæ”¯æŒå€¼åˆ†æã€æ±¡ç‚¹åˆ†æå’Œç±»å‹æ¨æ–­ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="è°ƒè¯•å™¨">3. è°ƒè¯•å™¨</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/x64dbg/x64dbg">x64dbg/x64dbg</a></td>
<td>45.3k</td>
<td>Windows å¹³å°å¼€æºçš„ x64/x32 è°ƒè¯•å™¨ã€‚</td>
</tr>
<tr>
<td><a href="https://www.gnu.org/software/gdb/">gdb/gdb</a></td>
<td>N/A</td>
<td>GNU é¡¹ç›®è°ƒè¯•å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/radareorg/cutter">radareorg/cutter</a></td>
<td>15.6k</td>
<td>radare2 çš„ GUI ç•Œé¢ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/hugsy/gef">hugsy/gef</a></td>
<td>6.4k</td>
<td>GDB çš„ç°ä»£åŒ–æ’ä»¶ï¼Œç”¨äºæ¼æ´åˆ©ç”¨å’Œé€†å‘ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/pwndbg/pwndbg">pwndbg/pwndbg</a></td>
<td>6.7k</td>
<td>GDB çš„ä¸€ä¸ªæ’ä»¶ï¼Œè¾…åŠ© pwnã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/longld/peda">longld/peda</a></td>
<td>5.7k</td>
<td>GDB PEDA - Python Exploit Development Assistance for GDB.</td>
</tr>
<tr>
<td><a href="https://github.com/snare/voltron">voltron/voltron</a></td>
<td>5.3k</td>
<td>ä¸€ä¸ªå¯æ‰©å±•çš„ã€è·¨å¹³å°çš„è°ƒè¯•å™¨ UI å·¥å…·åŒ…ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/microsoft/WinDbg-Samples">microsoft/WinDbg-Samples</a></td>
<td>300+</td>
<td>WinDbg çš„ç¤ºä¾‹æ‰©å±•ã€è„šæœ¬å’Œ API ç”¨æ³•ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/moyix/pdbpp">moyix/pdbpp</a></td>
<td>1.4k</td>
<td>Python è°ƒè¯•å™¨ (pdb) çš„ä¸€ä¸ªå¢å¼ºç‰ˆã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/deroko/x64dbg-python">deroko/x64dbg-python</a></td>
<td>300+</td>
<td>ç”¨äº x64dbg çš„ Python è„šæœ¬æ’ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="é™æ€åˆ†æä¸äºŒè¿›åˆ¶åˆ†æ">4. é™æ€åˆ†æä¸äºŒè¿›åˆ¶åˆ†æ</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/angr/angr">angr/angr</a></td>
<td>7.3k</td>
<td>å¼ºå¤§çš„äºŒè¿›åˆ¶åˆ†æå¹³å°ï¼Œæ”¯æŒç¬¦å·æ‰§è¡Œã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/trailofbits/manticore">trailofbits/manticore</a></td>
<td>2k</td>
<td>åŠ¨æ€äºŒè¿›åˆ¶åˆ†æå·¥å…·ï¼Œæ”¯æŒç¬¦å·æ‰§è¡Œã€æ±¡ç‚¹åˆ†æã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/JonathanSalwan/triton">JonathanSalwan/triton</a></td>
<td>2.7k</td>
<td>åŠ¨æ€äºŒè¿›åˆ¶åˆ†æ (DBA) æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/google/binexport">google/binexport</a></td>
<td>450+</td>
<td>å°†åæ±‡ç¼–ä» IDA Pro, Binary Ninja, Ghidra å¯¼å‡ºåˆ° BinNaviã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/google/binnavi">google/binnavi</a></td>
<td>2.8k</td>
<td>äºŒè¿›åˆ¶ä»£ç é€†å‘å·¥ç¨‹å’Œåˆ†æçš„å›¾å½¢åŒ–å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/Gallopsled/pwntools">Gallopsled/pwntools</a></td>
<td>11.2k</td>
<td>CTF æ¡†æ¶å’Œæ¼æ´åˆ©ç”¨å¼€å‘åº“ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/erocarrera/pefile">erocarrera/pefile</a></td>
<td>1.3k</td>
<td>ç”¨äºè§£æå’Œæ“ä½œ PE æ–‡ä»¶çš„ Python æ¨¡å—ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/eliben/pyelftools">eliben/pyelftools</a></td>
<td>1k</td>
<td>ç”¨äºè§£æå’Œåˆ†æ ELF æ–‡ä»¶å’Œ DWARF è°ƒè¯•ä¿¡æ¯çš„ Python åº“ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/s-c-repo/vtable-dumper">s-c-repo/vtable-dumper</a></td>
<td>250</td>
<td>ç”¨äºä» PE/ELF æ–‡ä»¶ä¸­ dump è™šå‡½æ•°è¡¨çš„å·¥å…·ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="android-å¹³å°">5. android å¹³å°</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://github.com/iBotPeaches/Apktool">iBotPeaches/Apktool</a></td>
<td>18.2k</td>
<td>ç”¨äºé€†å‘ Android apk æ–‡ä»¶çš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/pxb1988/dex2jar">pxb1988/dex2jar</a></td>
<td>12k</td>
<td>ç”¨äºå¤„ç† .dex å’Œ .class æ–‡ä»¶çš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/skylot/jadx">skylot/jadx</a></td>
<td>38.6k</td>
<td>Dex åˆ° Java çš„åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/JesusFreke/smali">JesusFreke/smali</a></td>
<td>4.4k</td>
<td>Android çš„ smali/baksmali æ±‡ç¼–å™¨/åæ±‡ç¼–å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF/Mobile-Security-Framework-MobSF</a></td>
<td>16.4k</td>
<td>è‡ªåŠ¨åŒ–çš„ç§»åŠ¨åº”ç”¨ (Android/iOS/Windows)
å®‰å…¨æµ‹è¯•å’Œæ¶æ„è½¯ä»¶åˆ†ææ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/sensepost/objection">sensepost/objection</a></td>
<td>8.3k</td>
<td>è¿è¡Œæ—¶ç§»åŠ¨å®‰å…¨è¯„ä¼°æ¡†æ¶ï¼ŒåŸºäº Fridaã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/Fuzion24/JustTrustMe">Fuzion24/JustTrustMe</a></td>
<td>2.2k</td>
<td>ç¦ç”¨ SSL è¯ä¹¦æ£€æŸ¥çš„ Xposed æ¨¡å—ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/ac-pm/Inspeckage">ac-pm/Inspeckage</a></td>
<td>1.8k</td>
<td>Android åŒ…åŠ¨æ€åˆ†æå·¥å…·ï¼Œå¸¦ API hook åŠŸèƒ½ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/rednaga/APKiD">rednaga/APKiD</a></td>
<td>850</td>
<td>ç”¨äºè¯†åˆ« Android å®‰è£…åŒ…ä¸­åŠ å£³ã€æ··æ·†å’Œå…¶å®ƒå¼‚å¸¸çš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/CalebFenton/simplify">CalebFenton/simplify</a></td>
<td>3.2k</td>
<td>é€šç”¨ Android åæ··æ·†å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/strazzere/android-unpacker">strazzere/android-unpacker</a></td>
<td>900+</td>
<td>Defcon 22 ä¸Šæ¼”ç¤ºçš„ Android è„±å£³å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/asLody/AndHook">asLody/AndHook</a></td>
<td>600+</td>
<td>Android åŠ¨æ€æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/turing-technician/fasthook">turing-technician/fasthook</a></td>
<td>400+</td>
<td>Android ART Hook æ¡†æ¶ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/wrbug/dumpdex">wrbug/dumpdex</a></td>
<td>1.9k</td>
<td>Android è„±å£³å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/topjohnwu/Magisk">topjohnwu/Magisk</a></td>
<td>35k+</td>
<td>Android ç³»ç»Ÿæ— æ„ŸçŸ¥ Root å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/LSPosed/LSPosed">LSPosed/LSPosed</a></td>
<td>15k+</td>
<td>åŸºäº Riru/Zygisk çš„ ART Hook æ¡†æ¶ (Xposed æ›¿ä»£å“)ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/Genymobile/scrcpy">Genymobile/scrcpy</a></td>
<td>90k+</td>
<td>é«˜æ€§èƒ½çš„ Android æŠ•å±ä¸æ§åˆ¶å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/shroudedcode/apk-mitm">shroudedcode/apk-mitm</a></td>
<td>3k+</td>
<td>è‡ªåŠ¨ä¿®æ”¹ APK ä»¥ä¾¿è¿›è¡Œ HTTPS æŠ“åŒ…çš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/r0ysue/r0capture">r0ysue/r0capture</a></td>
<td>4k+</td>
<td>åŸºäº Frida çš„å®‰å“åº”ç”¨å±‚æŠ“åŒ…é€šæ€è„šæœ¬ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="å¤šå¹³å°ä¸é€šç”¨å·¥å…·">6. å¤šå¹³å°ä¸é€šç”¨å·¥å…·</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/upx/upx">upx/upx</a></td>
<td>4.9k</td>
<td>æè‡´çš„å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/horsicq/Detect-It-Easy">horsicq/Detect-It-Easy</a></td>
<td>5.8k</td>
<td>ç”¨äºåˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ç¨‹åºï¼Œæ”¯æŒ Windows, Linux, macOSã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/wbenny/xorsearch">wbenny/xorsearch</a></td>
<td>450+</td>
<td>åœ¨æ–‡ä»¶ä¸­æœç´¢ç»è¿‡ XOR, ROL, ROT æˆ– SHIFT ç¼–ç çš„å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/balena-io/etason">balena-io/etason</a></td>
<td>200+</td>
<td>JSON è§£æå™¨ï¼Œèƒ½å®¹å¿è¯­æ³•é”™è¯¯ã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/google/santa">google/santa</a></td>
<td>3.1k</td>
<td>ç”¨äº macOS çš„äºŒè¿›åˆ¶æ–‡ä»¶ç™½åå•/é»‘åå•ç³»ç»Ÿã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/trailofbits/osquery-extensions">trailofbits/osquery-extensions</a></td>
<td>300+</td>
<td>osquery çš„æ‰©å±•ï¼Œç”¨äºå¢å¼ºå®‰å…¨åˆ†æã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/checkra1n/pongoOS">checkra1n/pongoOS</a></td>
<td>1.2k</td>
<td>checkra1n ä½¿ç”¨çš„ Pre-boot eXecution Environmentã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/mitmproxy/mitmproxy">mitmproxy/mitmproxy</a></td>
<td>33k+</td>
<td>äº¤äº’å¼çš„ HTTPS ä»£ç†ï¼Œç”¨äºè°ƒè¯•ã€æµ‹è¯•å’Œæ¸—é€ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="hex-ç¼–è¾‘å™¨">7. Hex ç¼–è¾‘å™¨</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://github.com/codepainters/distorm">codepainters/distorm</a></td>
<td>500+</td>
<td>x86/AMD64 çš„å¿«é€Ÿåæ±‡ç¼–åº“ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/radareorg/hex-lib">radareorg/hex-lib</a></td>
<td>100+</td>
<td>Hex a go go.</td>
</tr>
<tr>
<td><a href="https://github.com/WerWolv/ImHex">WerWolv/ImHex</a></td>
<td>3k</td>
<td>ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ç°ä»£ Hex ç¼–è¾‘å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/chrystianvieira/hexcute">chrystianvieira/hexcute</a></td>
<td>100+</td>
<td>ä¸€ä¸ªç®€å•çš„åå…­è¿›åˆ¶ç¼–è¾‘å™¨ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="è„±å£³ä¸åæ··æ·†">8. è„±å£³ä¸åæ··æ·†</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/de4dot/de4dot">de4dot/de4dot</a></td>
<td>6.5k</td>
<td>.NET åæ··æ·†å™¨å’Œè„±å£³å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/fireeye/flare-floss">fireeye/flare-floss</a></td>
<td>1.5k</td>
<td>è‡ªåŠ¨ä»æ¶æ„è½¯ä»¶ä¸­æå–æ··æ·†åçš„å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/ioncodes/dnpatch">ioncodes/dnpatch</a></td>
<td>500+</td>
<td>ç”¨äºä¿®è¡¥ .NET ç¨‹åºé›†çš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/rolfrolles/deobfuscator">rolfrolles/deobfuscator</a></td>
<td>400+</td>
<td>åŸºäº QEMU çš„ x86 åæ··æ·†å™¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/hluwa/frida-dexdump">hluwa/frida-dexdump</a></td>
<td>3k+</td>
<td>åŸºäº Frida çš„å¿«é€Ÿ Dex å†…å­˜å¯¼å‡ºå·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/Perfare/Il2CppDumper">Perfare/Il2CppDumper</a></td>
<td>7k+</td>
<td>Unity Il2Cpp é€†å‘å·¥å…·ï¼Œè¿˜åŸ DLL å’Œå¤´æ–‡ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="å›ºä»¶åˆ†æ">9. å›ºä»¶åˆ†æ</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://github.com/ReFirmLabs/binwalk">ReFirmLabs/binwalk</a></td>
<td>10.1k</td>
<td>ç”¨äºåˆ†æã€é€†å‘å’Œæå–å›ºä»¶é•œåƒçš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/craigz/firmwalker">craigz/firmwalker</a></td>
<td>1k</td>
<td>è‡ªåŠ¨åœ¨å›ºä»¶ä¸­æœç´¢æ•æ„Ÿä¿¡æ¯çš„è„šæœ¬ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/attify/firmware-analysis-toolkit">attify/firmware-analysis-toolkit</a></td>
<td>1k</td>
<td>ç”¨äºå›ºä»¶å®‰å…¨æµ‹è¯•çš„å·¥å…·åŒ…ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/scriptingx/IoTSecurity101">scriptingx/IoTSecurity101</a></td>
<td>500+</td>
<td>ç‰©è”ç½‘å®‰å…¨å…¥é—¨ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="apple-å¹³å°-iosmacos">10. Apple å¹³å° (iOS/macOS)</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://github.com/nygard/class-dump">nygard/class-dump</a></td>
<td>2.6k</td>
<td>ä» Mach-O æ–‡ä»¶ç”Ÿæˆ Objective-C å¤´æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/KJCracks/Clutch">KJCracks/Clutch</a></td>
<td>2.8k</td>
<td>å¿«é€Ÿçš„ iOS å¯æ‰§è¡Œæ–‡ä»¶ dumperã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/alonemonkey/MonkeyDev">alonemonkey/MonkeyDev</a></td>
<td>4.5k</td>
<td>iOS Tweak å¼€å‘å·¥å…·ï¼Œæ— éœ€è¶Šç‹±ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/facebook/chisel">facebook/chisel</a></td>
<td>8.3k</td>
<td>è¾…åŠ©è°ƒè¯• iOS åº”ç”¨çš„ LLDB å‘½ä»¤é›†åˆã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/nabla-c0d3/ssl-kill-switch2">nabla-c0d3/ssl-kill-switch2</a></td>
<td>1.6k</td>
<td>é»‘ç›’å·¥å…·ï¼Œç”¨äºåœ¨ iOS å’Œ macOS åº”ç”¨ä¸­ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/ptoomey3/Keychain-Dumper">ptoomey3/Keychain-Dumper</a></td>
<td>1k</td>
<td>åœ¨è¶Šç‹±è®¾å¤‡ä¸Šæ£€æŸ¥å“ªäº›é’¥åŒ™ä¸²é¡¹å¯è¢«è®¿é—®ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/limneos/classdump-dyld">limneos/classdump-dyld</a></td>
<td>450+</td>
<td>æ— éœ€ä» dyld_shared_cache ä¸­æå–å³å¯ class-dump ä»»ä½• Mach-O
æ–‡ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="å…¶ä»–ä¸èµ„æº">11. å…¶ä»–ä¸èµ„æº</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>Star æ•°é‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://github.com/firmianay/security-paper">firmianay/security-paper</a></td>
<td>1.7k</td>
<td>å®‰å…¨é¢†åŸŸçš„ä¸€äº›ç»å…¸è®ºæ–‡ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/endgameinc/RSOI">endgameinc/RSOI</a></td>
<td>200+</td>
<td>é€†å‘å·¥ç¨‹é¢†åŸŸçš„èµ„æºå’Œä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/enaqx/awesome-pentest">enaqx/awesome-pentest</a></td>
<td>18k+</td>
<td>ç²¾é€‰çš„æ¸—é€æµ‹è¯•èµ„æºã€å·¥å…·å’Œå…¶å®ƒå¾ˆæ£’çš„ä¸œè¥¿ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/carpedm20/awesome-hacking">carpedm20/awesome-hacking</a></td>
<td>9k+</td>
<td>ç²¾é€‰çš„é»‘å®¢èµ„æºã€å·¥å…·å’Œæ•™ç¨‹ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/onethawt/idaplugins-list">onethawt/idaplugins-list</a></td>
<td>1.9k</td>
<td>IDA Pro æ’ä»¶åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/Siguza/ios-resources">Siguza/ios-resources</a></td>
<td>700+</td>
<td>iOS é»‘å®¢ç›¸å…³çš„æœ‰ç”¨èµ„æºã€‚</td>
</tr>
<tr>
<td><a
href="https://github.com/michalmalik/osx-re-101">michalmalik/osx-re-101</a></td>
<td>1.4k</td>
<td>OSX/iOS é€†å‘èµ„æºã€‚</td>
</tr>
</tbody>
</table>
<!-- 05-Appendix/glossary.md -->
<h1 id="æœ¯è¯­è¡¨-glossary">æœ¯è¯­è¡¨ (Glossary)</h1>
<p>æ”¶é›†äº† Android é€†å‘å·¥ç¨‹ä¸­å¸¸è§çš„æœ¯è¯­å’Œç¼©å†™ã€‚</p>
<h2 id="a">A</h2>
<ul>
<li><strong>ADB (Android Debug Bridge)</strong>: Android
è°ƒè¯•æ¡¥ï¼Œä¸€ä¸ªé€šç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ä½ ä¸æ¨¡æ‹Ÿå™¨å®ä¾‹æˆ–è¿æ¥çš„ Android
è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</li>
<li><strong>AOSP (Android Open Source Project)</strong>: Android
å¼€æºé¡¹ç›®ï¼Œå³ Android ç³»ç»Ÿçš„æºä»£ç ã€‚</li>
<li><strong>APK (Android Package)</strong>: Android åº”ç”¨ç¨‹åºåŒ…ï¼ŒAndroid
æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ä¸€ç§åº”ç”¨ç¨‹åºåŒ…æ–‡ä»¶æ ¼å¼ã€‚</li>
<li><strong>ART (Android Runtime)</strong>: Android è¿è¡Œæ—¶ï¼ŒAndroid 5.0
å¼•å…¥çš„æ–°çš„åº”ç”¨è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®Œå…¨å–ä»£äº† Dalvikã€‚å®ƒä½¿ç”¨ AOT (Ahead-Of-Time)
ç¼–è¯‘æŠ€æœ¯ã€‚</li>
<li><strong>ARM</strong>: ä¸€ç§ç²¾ç®€æŒ‡ä»¤é›† (RISC)
å¤„ç†å™¨æ¶æ„ï¼Œå¹¿æ³›ç”¨äºç§»åŠ¨è®¾å¤‡ã€‚</li>
</ul>
<h2 id="b">B</h2>
<ul>
<li><strong>Bootloader</strong>:
å¼•å¯¼åŠ è½½ç¨‹åºï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œä¹‹å‰è¿è¡Œçš„ä¸€æ®µå°ç¨‹åºï¼Œè´Ÿè´£åŠ è½½æ“ä½œç³»ç»Ÿã€‚</li>
<li><strong>Baksmali</strong>: ä¸€ä¸ªå°† dex æ–‡ä»¶åæ±‡ç¼–æˆ smali
æ–‡ä»¶çš„å·¥å…·ã€‚</li>
</ul>
<h2 id="d">D</h2>
<ul>
<li><strong>Dalvik</strong>: Google æ—©æœŸä¸º Android è®¾è®¡çš„è™šæ‹Ÿæœºï¼Œä½¿ç”¨
JIT (Just-In-Time) ç¼–è¯‘ã€‚åœ¨ Android 5.0 åè¢« ART å–ä»£ã€‚</li>
<li><strong>DEX (Dalvik Executable)</strong>: Android
å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼ŒåŒ…å«ç¼–è¯‘åçš„ä»£ç ã€‚</li>
<li><strong>Dynamic Analysis (åŠ¨æ€åˆ†æ)</strong>:
åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹å…¶è¿›è¡Œåˆ†æçš„æŠ€æœ¯ï¼Œé€šå¸¸æ¶‰åŠè°ƒè¯•ã€Hook ç­‰ã€‚</li>
</ul>
<h2 id="e">E</h2>
<ul>
<li><strong>ELF (Executable and Linkable Format)</strong>:
å¯æ‰§è¡Œä¸å¯é“¾æ¥æ ¼å¼ï¼ŒLinux ç³»ç»Ÿï¼ˆåŒ…æ‹¬ Android Native
å±‚ï¼‰ä½¿ç”¨çš„æ ‡å‡†äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ã€‚</li>
</ul>
<h2 id="f">F</h2>
<ul>
<li><strong>Frida</strong>:
ä¸€ä¸ªåŠ¨æ€æ’æ¡©å·¥å…·åŒ…ï¼Œå…è®¸å¼€å‘è€…ã€é€†å‘å·¥ç¨‹å¸ˆå’Œå®‰å…¨ç ”ç©¶äººå‘˜åœ¨è¿è¡Œæ—¶ç›‘è§†å’Œä¿®æ”¹åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚</li>
</ul>
<h2 id="g">G</h2>
<ul>
<li><strong>Ghidra</strong>: NSA å¼€æºçš„è½¯ä»¶é€†å‘å·¥ç¨‹ (SRE) æ¡†æ¶ã€‚</li>
</ul>
<h2 id="h">H</h2>
<ul>
<li><strong>Hooking (æŒ‚é’©)</strong>:
ä¸€ç§æ‹¦æˆªè½¯ä»¶ç»„ä»¶ä¹‹é—´å‡½æ•°è°ƒç”¨ã€æ¶ˆæ¯æˆ–äº‹ä»¶çš„æŠ€æœ¯ï¼Œç”¨äºæ”¹å˜æˆ–ç›‘è§†ç³»ç»Ÿçš„è¡Œä¸ºã€‚</li>
</ul>
<h2 id="i">I</h2>
<ul>
<li><strong>IDA Pro (Interactive DisAssembler)</strong>:
ä¸šç•Œæ ‡å‡†çš„äº¤äº’å¼åæ±‡ç¼–å™¨å’Œè°ƒè¯•å™¨ã€‚</li>
<li><strong>IL2CPP</strong>: Unity æ¸¸æˆå¼•æ“çš„ä¸€ç§è„šæœ¬åç«¯ï¼Œå°† C#
ä»£ç è½¬æ¢ä¸º C++ ä»£ç ï¼Œå¢åŠ äº†é€†å‘éš¾åº¦ã€‚</li>
</ul>
<h2 id="j">J</h2>
<ul>
<li><strong>JADX</strong>: ä¸€ä¸ªå°† DEX æ–‡ä»¶åç¼–è¯‘ä¸º Java
ä»£ç çš„å·¥å…·ã€‚</li>
<li><strong>JNI (Java Native Interface)</strong>: Java æœ¬åœ°æ¥å£ï¼Œå…è®¸
Java ä»£ç å’Œå…¶ä»–è¯­è¨€ï¼ˆä¸»è¦æ˜¯ C/C++ï¼‰å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚</li>
</ul>
<h2 id="m">M</h2>
<ul>
<li><strong>Magisk</strong>: ä¸€ä¸ªå¼€æºçš„ Android Root è§£å†³æ–¹æ¡ˆï¼Œä»¥
â€œSystemlessâ€ï¼ˆä¸ä¿®æ”¹ç³»ç»Ÿåˆ†åŒºï¼‰è‘—ç§°ã€‚</li>
<li><strong>Manifest (AndroidManifest.xml)</strong>: æ¯ä¸ª Android
åº”ç”¨éƒ½å¿…é¡»åŒ…å«çš„æ–‡ä»¶ï¼Œæè¿°äº†åº”ç”¨çš„åŒ…åã€ç»„ä»¶ã€æƒé™ç­‰åŸºæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<h2 id="n">N</h2>
<ul>
<li><strong>Native Code</strong>: é€šå¸¸æŒ‡ä½¿ç”¨ C/C++
ç¼–å†™çš„ï¼Œç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨ç çš„ä»£ç ï¼ˆç›¸å¯¹äº Java/Kotlin å­—èŠ‚ç ï¼‰ã€‚</li>
<li><strong>NDK (Native Development Kit)</strong>:
ä¸€ä¸ªå·¥å…·é›†ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ C å’Œ C++ å®ç°åº”ç”¨çš„ä¸€éƒ¨åˆ†ã€‚</li>
</ul>
<h2 id="o">O</h2>
<ul>
<li><strong>Obfuscation (æ··æ·†)</strong>:
ä½¿ä»£ç éš¾ä»¥ç†è§£ä½†ä¿æŒå…¶åŠŸèƒ½ä¸å˜çš„æŠ€æœ¯ï¼Œç”¨äºä¿æŠ¤çŸ¥è¯†äº§æƒæˆ–éšè—æ¶æ„è¡Œä¸ºã€‚</li>
<li><strong>OLLVM (Obfuscator-LLVM)</strong>: åŸºäº LLVM
çš„ä»£ç æ··æ·†é¡¹ç›®ï¼Œå¸¸ç”¨äº Native ä»£ç æ··æ·†ã€‚</li>
<li><strong>OAT</strong>: ART è¿è¡Œæ—¶ä½¿ç”¨çš„ç§æœ‰ ELF æ–‡ä»¶æ ¼å¼ï¼ŒåŒ…å« AOT
ç¼–è¯‘åçš„æœºå™¨ç ã€‚</li>
</ul>
<h2 id="r">R</h2>
<ul>
<li><strong>Recovery</strong>: Android
è®¾å¤‡çš„æ¢å¤æ¨¡å¼ï¼Œç”¨äºæ¢å¤å‡ºå‚è®¾ç½®ã€åˆ·å…¥æ›´æ–°åŒ…ç­‰ã€‚</li>
<li><strong>Rooting</strong>: è·å– Android è®¾å¤‡è¶…çº§ç”¨æˆ· (Root)
æƒé™çš„è¿‡ç¨‹ã€‚</li>
<li><strong>Riru</strong>: ä¸€ä¸ªç”¨äºæ³¨å…¥ Zygote
è¿›ç¨‹çš„æ¨¡å—ï¼Œå¸¸ä½œä¸ºå…¶ä»–æ¨¡å—ï¼ˆå¦‚ LSPosedï¼‰çš„åŸºç¡€ã€‚</li>
</ul>
<h2 id="s">S</h2>
<ul>
<li><strong>Smali</strong>: Android çš„ Dalvik
å­—èŠ‚ç çš„äººç±»å¯è¯»æ±‡ç¼–è¯­è¨€ã€‚</li>
<li><strong>Static Analysis (é™æ€åˆ†æ)</strong>:
åœ¨ä¸è¿è¡Œç¨‹åºçš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œåˆ†æçš„æŠ€æœ¯ã€‚</li>
<li><strong>So (Shared Object)</strong>: Linux/Android
ä¸‹çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œé€šå¸¸ç”± C/C++ ç¼–å†™ã€‚</li>
</ul>
<h2 id="v">V</h2>
<ul>
<li><strong>VMP (Virtual Machine Protection)</strong>:
è™šæ‹Ÿæœºä¿æŠ¤ï¼Œä¸€ç§é«˜çº§æ··æ·†æŠ€æœ¯ï¼Œå°†åŸå§‹ä»£ç è½¬æ¢ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç å¹¶åœ¨è‡ªå®šä¹‰è§£é‡Šå™¨ä¸­è¿è¡Œã€‚</li>
</ul>
<h2 id="x">X</h2>
<ul>
<li><strong>Xposed</strong>: ä¸€ä¸ªå¼ºå¤§çš„ Android æ¡†æ¶ï¼Œå…è®¸åœ¨ä¸ä¿®æ”¹ APK
çš„æƒ…å†µä¸‹é€šè¿‡æ¨¡å—æ”¹å˜ç³»ç»Ÿå’Œåº”ç”¨çš„è¡Œä¸ºã€‚</li>
</ul>
<h2 id="z">Z</h2>
<ul>
<li><strong>Zygote</strong>: Android ç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚</li>
</ul>
<!-- 05-Appendix/learning_resources.md -->
<hr />
<h1 id="å­¦ä¹ èµ„æº-learning-resources">å­¦ä¹ èµ„æº (Learning Resources)</h1>
<p>æœ¬é¡µé¢æ”¶é›†äº† Android
é€†å‘å·¥ç¨‹é¢†åŸŸçš„é«˜è´¨é‡å­¦ä¹ èµ„æºï¼ŒåŒ…æ‹¬ä¹¦ç±ã€åšå®¢ã€è®ºå›ã€ç¤¾åŒºå’Œè¯¾ç¨‹ã€‚</p>
<hr />
<h2 id="ä¹¦ç±-books">ä¹¦ç± (Books)</h2>
<h3 id="å…¥é—¨ä¸åŸºç¡€">å…¥é—¨ä¸åŸºç¡€</h3>
<ul>
<li><strong>ã€ŠAndroid è½¯ä»¶å®‰å…¨ä¸é€†å‘åˆ†æã€‹</strong> (ä¸°ç”Ÿå¼º / éè™«)
ç»å…¸çš„å…¥é—¨ä¹¦ç±ï¼Œæ¶µç›–äº† Android ç³»ç»Ÿæ¶æ„ã€Smali
è¯­æ³•ã€é™æ€åˆ†æã€åŠ¨æ€è°ƒè¯•ç­‰åŸºç¡€çŸ¥è¯†ã€‚</li>
<li><strong>ã€ŠAndroid å®‰å…¨æ”»é˜²å®æˆ˜ã€‹</strong> (EaaLaboratory)
åå‘å®æˆ˜ï¼ŒåŒ…å«å¾ˆå¤šæ¡ˆä¾‹åˆ†æã€‚</li>
</ul>
<h3 id="è¿›é˜¶ä¸æ·±å…¥">è¿›é˜¶ä¸æ·±å…¥</h3>
<ul>
<li><strong>ã€ŠAndroid Internals: A Confectionerâ€™s Cookbookã€‹</strong>
(Jonathan Levin) <a href="http://newandroidbook.com/">é“¾æ¥</a> æ·±å…¥å‰–æ
Android ç³»ç»Ÿå†…éƒ¨åŸç†ï¼Œæ˜¯ç†è§£ Android åº•å±‚æœºåˆ¶çš„å¿…è¯»ä¹‹ä½œã€‚</li>
<li><strong>ã€ŠAndroid Hackerâ€™s Handbookã€‹</strong> (Joshua J. Drake et
al.) å…¨é¢ä»‹ç» Android å®‰å…¨æ¶æ„ã€æ¼æ´æŒ–æ˜å’Œåˆ©ç”¨æŠ€æœ¯ã€‚</li>
<li><strong>ã€ŠMASTG - Mobile App Security Testing Guideã€‹</strong>
(OWASP) <a href="https://mas.owasp.org/MASTG/">é“¾æ¥</a> OWASP
å‘å¸ƒçš„ç§»åŠ¨åº”ç”¨å®‰å…¨æµ‹è¯•æŒ‡å—ï¼Œæ¶µç›–äº† iOS å’Œ Android
å¹³å°çš„å®‰å…¨æµ‹è¯•æ–¹æ³•è®ºå’ŒæŠ€æœ¯ç»†èŠ‚ï¼Œæ˜¯è¡Œä¸šæ ‡å‡†å‚è€ƒæ–‡æ¡£ã€‚</li>
</ul>
<hr />
<h2 id="åšå®¢ä¸ç½‘ç«™-blogs-websites">åšå®¢ä¸ç½‘ç«™ (Blogs &amp;
Websites)</h2>
<h3 id="ä¸ªäººåšå®¢">ä¸ªäººåšå®¢</h3>
<ul>
<li><strong>Maddie Stone</strong> (<a
href="https://googleprojectzero.blogspot.com/">Project Zero</a>) ä¸“æ³¨äº
Android æ¶æ„è½¯ä»¶åˆ†æå’Œæ¼æ´æŒ–æ˜ï¼Œæ–‡ç« è´¨é‡æé«˜ã€‚</li>
<li><strong>R0ysue (è‚‰ä¸)</strong> å›½å†…çŸ¥åçš„ Android é€†å‘ä¸“å®¶ï¼ŒFrida
é¢†åŸŸçš„é¢†å†›äººç‰©ã€‚</li>
<li><strong>Wei (LSPosed Developer)</strong> æ·±å…¥ç ”ç©¶ Android Runtime
(ART) å’Œ Hook æŠ€æœ¯ã€‚</li>
<li><strong>Orange Tsai</strong> Web
å’Œç§»åŠ¨å®‰å…¨é¢†åŸŸçš„çŸ¥åç ”ç©¶å‘˜ï¼Œå¸¸æœ‰ç²¾å½©çš„åˆ©ç”¨æ€è·¯ã€‚</li>
</ul>
<h3 id="æŠ€æœ¯å›¢é˜Ÿä¸å‚å•†">æŠ€æœ¯å›¢é˜Ÿä¸å‚å•†</h3>
<ul>
<li><strong>Google Project Zero</strong> <a
href="https://googleprojectzero.blogspot.com/">é“¾æ¥</a> Google
çš„å®‰å…¨ç ”ç©¶å›¢é˜Ÿï¼Œå‘å¸ƒäº†å¤§é‡å…³äº Android
å†…æ ¸ã€é©±åŠ¨å’Œæ¡†æ¶å±‚çš„é«˜è´¨é‡æ¼æ´åˆ†ææŠ¥å‘Šã€‚</li>
<li><strong>Quarkslab Blog</strong> <a
href="https://blog.quarkslab.com/">é“¾æ¥</a>
å‘å¸ƒäº†è®¸å¤šå…³äºæ··æ·†ã€åæ··æ·†å’Œåº•å±‚é€†å‘å·¥å…·ï¼ˆå¦‚ Tritonï¼‰çš„ç ”ç©¶æ–‡ç« ã€‚</li>
<li><strong>Check Point Research</strong> ç»å¸¸æŠ«éœ² Android
æ¶æ„è½¯ä»¶å’Œé«˜å±æ¼æ´ã€‚</li>
</ul>
<hr />
<h2 id="è®ºå›ä¸ç¤¾åŒº-forums-communities">è®ºå›ä¸ç¤¾åŒº (Forums &amp;
Communities)</h2>
<ul>
<li><strong>52pojie (å¾çˆ±ç ´è§£)</strong> <a
href="https://www.52pojie.cn/">é“¾æ¥</a>
å›½å†…æœ€å¤§çš„ç ´è§£å’Œé€†å‘æŠ€æœ¯äº¤æµè®ºå›ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æ•™ç¨‹ã€å·¥å…·å’Œæ´»è·ƒçš„ç¤¾åŒºæ°›å›´ã€‚</li>
<li><strong>Kanxue (çœ‹é›ªè®ºå›)</strong> <a
href="https://bbs.kanxue.com/">é“¾æ¥</a>
å›½å†…è€ç‰Œçš„å®‰å…¨æŠ€æœ¯ç¤¾åŒºï¼Œä¸“æ³¨äºäºŒè¿›åˆ¶å®‰å…¨ã€æ¼æ´æŒ–æ˜å’Œå†…æ ¸å®‰å…¨ï¼ŒæŠ€æœ¯æ·±åº¦è¾ƒé«˜ã€‚</li>
<li><strong>XDA Developers</strong> <a
href="https://forum.xda-developers.com/">é“¾æ¥</a> å…¨çƒæœ€å¤§çš„ Android
å¼€å‘è€…ç¤¾åŒºï¼Œå…³äº ROM å®šåˆ¶ã€Rootã€Xposed/Magisk æ¨¡å—çš„èµ„æºéå¸¸ä¸°å¯Œã€‚</li>
<li><strong>Reddit r/ReverseEngineering</strong> <a
href="https://www.reddit.com/r/ReverseEngineering/">é“¾æ¥</a>
å›½é™…é€†å‘å·¥ç¨‹æŠ€æœ¯è®¨è®ºåŒºï¼Œæ±‡é›†äº†å…¨çƒçš„é€†å‘çˆ±å¥½è€…å’Œä¸“å®¶ã€‚</li>
<li><strong>Reddit r/androiddev</strong> <a
href="https://www.reddit.com/r/androiddev/">é“¾æ¥</a>
è™½ç„¶ä¾§é‡å¼€å‘ï¼Œä½†äº†è§£å¼€å‘è€…çš„æ€ç»´å¯¹äºé€†å‘å·¥ç¨‹ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚</li>
</ul>
<hr />
<h2 id="è¯¾ç¨‹ä¸æ•™ç¨‹-courses-tutorials">è¯¾ç¨‹ä¸æ•™ç¨‹ (Courses &amp;
Tutorials)</h2>
<ul>
<li><strong>Frida å®˜æ–¹æ–‡æ¡£ä¸æ•™ç¨‹</strong> <a
href="https://frida.re/docs/home/">é“¾æ¥</a> å­¦ä¹  Frida
æœ€æƒå¨çš„èµ„æ–™ã€‚</li>
<li><strong>Android App Reverse Engineering 101</strong> (Maddie Stone)
<a
href="https://www.r00t0k.com/course/android-app-reverse-engineering-101">é“¾æ¥</a>
(éœ€æŸ¥æ‰¾æœ‰æ•ˆé“¾æ¥æˆ–å­˜æ¡£) Workshops å½¢å¼çš„å…¥é—¨æ•™ç¨‹ï¼Œéå¸¸é€‚åˆåˆå­¦è€…ã€‚</li>
<li><strong>OWASP Mobile Security Testing Guide (MSTG) Hacking
Playground</strong> é…åˆ MSTG ä¹¦ç±çš„ç»ƒä¹ ç¯å¢ƒã€‚</li>
</ul>
<hr />
<h2 id="å…¶ä»–èµ„æº">å…¶ä»–èµ„æº</h2>
<ul>
<li><strong>Android Open Source Project (AOSP)</strong> <a
href="https://source.android.com/">é“¾æ¥</a> é˜…è¯»æºç æ˜¯ç†è§£ Android
æœ€æ ¹æœ¬çš„æ–¹æ³•ã€‚ä½¿ç”¨ <a href="https://cs.android.com/">cs.android.com</a>
è¿›è¡Œåœ¨çº¿æºç æœç´¢éå¸¸æ–¹ä¾¿ã€‚</li>
<li><strong>Android Developers Documentation</strong> <a
href="https://developer.android.com/docs">é“¾æ¥</a>
å®˜æ–¹å¼€å‘æ–‡æ¡£ï¼Œé€†å‘æ—¶é‡åˆ°ä¸æ‡‚çš„ API é¦–å…ˆåº”è¯¥æŸ¥é˜…çš„åœ°æ–¹ã€‚</li>
</ul>
<hr />
</body>
</html>
