
        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Android Reverse Engineering Cookbook</title>
        </head>
        <body>
        
        <div class="cover-page">
            <div style="margin-top: 150pt;">
                <h1 style="font-size: 36pt; color: #1a1a1a; margin-bottom: 30pt; border: none; page-break-before: auto;" class="no-page-break">
                    Android Reverse Engineering Cookbook
                </h1>
                <h2 style="font-size: 20pt; color: #666; font-weight: 400; border: none; padding: 0;">
                    Complete Guide to Android Security Analysis
                </h2>
                <div style="margin-top: 80pt; font-size: 14pt; color: #888;">
                    <p>Foundations, Tools, Techniques, and Advanced Topics</p>
                    <p>Covers Frida, Unidbg, Xposed, IDA Pro and More</p>
                    <p>Including Data Analysis, Engineering and Case Studies</p>
                </div>
            </div>
        </div>
        <div style="page-break-before: always; text-align: center; margin-top: 80pt;">
            <div style="font-size: 12pt; color: #aaa;">
                <p style="font-size: 48pt; margin-bottom: 15pt;">ğŸ§‘â€ğŸ’»</p>
                <p style="font-size: 16pt; color: #666; margin-bottom: 20pt;"><strong>Authors: +5, Gemini Pro 3.0, Claude Code Opus 4.5</strong></p>
                <p>ğŸ“§ Email: overkazaf@gmail.com</p>
                <p>ğŸ’¬ WeChat: _0xAF_</p>
                <p style="margin-top: 30pt;">ğŸ“… Date: 2025-12-19</p>
                <p>ğŸ“Œ Version: v2.0</p>
            </div>
            <div style="margin-top: 40pt; padding: 25pt 40pt; background-color: #fff8e1; border-radius: 8pt; border-left: 4px solid #ffa726;">
                <p style="font-size: 13pt; color: #e65100; font-weight: 600; margin-bottom: 15pt; text-align: center;">
                    ğŸ“– å…³äºè¿™æœ¬é£Ÿè°±çš„è¯ç”Ÿ | About This Cookbook
                </p>
                <p style="font-size: 10.5pt; color: #444; line-height: 1.9; text-align: justify; margin-bottom: 12pt;">
                    è¿™æœ¬é£Ÿè°±çš„è¯ç”Ÿï¼Œæ˜¯ä¸€æ¬¡æœ‰è¶£çš„<strong>äººæœºåä½œ</strong>å®éªŒã€‚é™¤äº†ç¬”è€…ï¼ˆ<strong>+5</strong>ï¼‰åœ¨Androidé€†å‘å·¥ç¨‹é¢†åŸŸçš„æ—¥å¸¸è®°å½•å’Œå®æˆ˜ç»éªŒç§¯ç´¯ï¼Œ
                    æœ¬ä¹¦è¿˜å¾—åˆ°äº†ä¸¤ä½AIåŠ©æ‰‹çš„é¼åŠ›æ”¯æŒâ€”â€”<strong>Gemini Pro 3.0</strong>å’Œ<strong>Claude Code Opus 4.5</strong>ã€‚
                    è¿™ä¸ªåä½œè¿‡ç¨‹å°±åƒä¸€ä¸ªçœŸå®çš„æŠ€æœ¯å›¢é˜Ÿï¼š
                </p>
                <div style="margin-left: 20pt; margin-bottom: 12pt;">
                    <p style="font-size: 10pt; color: #444; line-height: 1.7; margin-bottom: 8pt;">
                        ğŸ“š <strong>Gemini Pro 3.0</strong>ï¼ˆç ”ç©¶å‘˜ & çŸ¥è¯†æ¶æ„å¸ˆï¼‰ï¼šè´Ÿè´£æŠ€æœ¯è°ƒç ”ã€èµ„æ–™æœé›†ã€çŸ¥è¯†ä½“ç³»æ•´ç†ï¼Œ
                        ä»¥åŠæä¾›æŠ€æœ¯æ€è·¯å’Œè§£å†³æ–¹æ¡ˆå»ºè®®ï¼Œå°±åƒå›¢é˜Ÿä¸­çš„æŠ€æœ¯é¡¾é—®å’ŒçŸ¥è¯†ç®¡å®¶ã€‚
                    </p>
                    <p style="font-size: 10pt; color: #444; line-height: 1.7; margin-bottom: 8pt;">
                        ğŸ’» <strong>Claude Code Opus 4.5</strong>ï¼ˆè½¯ä»¶å·¥ç¨‹å¸ˆ & è‡ªåŠ¨åŒ–ä¸“å®¶ï¼‰ï¼šè´Ÿè´£ç¼–å†™å’Œä¼˜åŒ–ä»£ç ç¤ºä¾‹ã€
                        æ‰¹é‡å¤„ç†Markdownæ ¼å¼é—®é¢˜ã€è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆæµç¨‹ï¼Œä»¥åŠä»£ç è´¨é‡æŠŠå…³ï¼Œå°±åƒå›¢é˜Ÿä¸­çš„å…¨æ ˆå¼€å‘å’ŒDevOpså·¥ç¨‹å¸ˆã€‚
                    </p>
                    <p style="font-size: 10pt; color: #444; line-height: 1.7; margin-bottom: 8pt;">
                        ğŸ¯ <strong>+5</strong>ï¼ˆæŠ€æœ¯è´Ÿè´£äºº & æ€»ç¼–è¾‘ï¼‰ï¼šè´Ÿè´£æ•´ä½“æ¶æ„è®¾è®¡ã€æŠ€æœ¯æ–¹å‘æŠŠæ§ã€å†…å®¹å®¡æ ¸ä¿®è®¢ã€
                        ä»¥åŠæœ€ç»ˆè´¨é‡ä¿éšœï¼Œå°±åƒå›¢é˜Ÿä¸­çš„Tech Leadå’ŒEditor-in-Chiefã€‚
                    </p>
                </div>
                <p style="font-size: 10pt; color: #666; line-height: 1.8; text-align: justify; font-style: italic; margin-bottom: 12pt;">
                    This cookbook is born from an intriguing <strong>human-AI collaboration</strong>, like a real tech team:
                    <strong>Gemini Pro 3.0</strong> (Research Engineer & Knowledge Architect) handles technical research,
                    resource gathering, knowledge organization, and solution consulting;
                    <strong>Claude Code Opus 4.5</strong> (Software Engineer & Automation Expert) crafts code examples,
                    batch-processes Markdown formatting, automates documentation workflows, and ensures code quality;
                    <strong>+5</strong> (Tech Lead & Editor-in-Chief) steers the architecture, technical direction,
                    content revision, and final quality assurance.
                </p>
                <p style="font-size: 10pt; color: #555; line-height: 1.8; text-align: justify; margin-bottom: 12pt;">
                    ğŸ¤ æˆ‘ç›¸ä¿¡ï¼Œäººç±»çš„å®è·µæ™ºæ…§ä¸AIçš„çŸ¥è¯†æ•´åˆèƒ½åŠ›ç›¸ç»“åˆï¼Œèƒ½å¤Ÿåˆ›é€ å‡ºæ›´ä¼˜è´¨çš„å­¦ä¹ èµ„æºã€‚
                    å¸Œæœ›è¿™ç§è·¨è¶Šäººæœºè¾¹ç•Œçš„åä½œæ–¹å¼ï¼Œèƒ½ä¸ºå¤§å®¶å¸¦æ¥<strong>ä¸ä¸€æ ·çš„é˜…è¯»ä½“éªŒ</strong>ï¼Œ
                    ä¹Ÿä¸ºæŠ€æœ¯æ–‡æ¡£çš„åˆ›ä½œå¼€è¾Ÿæ–°çš„å¯èƒ½æ€§ã€‚
                </p>
                <p style="font-size: 10pt; color: #444; line-height: 1.8; text-align: justify; border-top: 1px dashed #ffa726; padding-top: 12pt;">
                    âœˆï¸ <strong>åˆ›ä½œåˆè¡·</strong>ï¼šè¿™æœ¬é£Ÿè°±æœ€åˆæ˜¯ä¸ºäº†è®°å½•ç¬”è€…æ—¥å¸¸çš„é€†å‘å·¥ä½œå’ŒæŠ€æœ¯ç§¯ç´¯ã€‚
                    åœ¨æ¼«é•¿çš„é£æœºæ—…é€”ä¸­ï¼Œæˆ–æ˜¯åœ¨å’–å•¡é¦†å°æ†©æ—¶ï¼Œç¿»é˜…è¿™äº›ç²¾å¿ƒæ•´ç†çš„æŠ€æœ¯ç¬”è®°ï¼Œ
                    å›é¡¾é‚£äº›æœ‰æ„æ€çš„é€†å‘çŸ¥è¯†ç‚¹å’Œè§£é¢˜æ€è·¯ï¼Œæ—¢æ˜¯ä¸€ç§æ”¾æ¾ï¼Œä¹Ÿæ˜¯ä¸€ç§å­¦ä¹ ã€‚
                    å¸Œæœ›è¿™æœ¬ä¹¦ä¹Ÿèƒ½æˆä¸ºä½ æ—…é€”ä¸­çš„è‰¯ä¼´ï¼Œè®©æŠ€æœ¯å­¦ä¹ å˜å¾—æ›´åŠ è½»æ¾æ„‰å¿«ã€‚
                </p>
            </div>
            <div style="margin-top: 30pt; padding: 25pt 40pt; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd;">
                <p style="font-size: 11pt; color: #555; font-style: italic; line-height: 1.8; text-align: center;">
                    "If the highest aim of a captain were to preserve his ship,<br/>
                    he would keep it in port forever."
                </p>
                <p style="font-size: 9pt; color: #888; text-align: right; margin-top: 10pt;">
                    â€” St. Thomas Aquinas, <em>Summa Theologica</em> (1265-1274)
                </p>
            </div>
            <div style="margin-top: 30pt; padding: 25pt 40pt; background-color: #f9f9f9; border-radius: 8pt;">
                <p style="font-size: 10.5pt; color: #444; line-height: 1.9; text-align: justify; margin-bottom: 15pt;">
                    The journey begins with the thrill of solving puzzlesâ€”that exhilarating rush when code
                    finally yields its secrets. Yet seasoned reverse engineers walk a different path. They
                    remain humble, ever-curious, and deeply reflective. In time, they all return to first
                    principles: understanding how systems are <em>built</em> is the only true way to understand
                    how they can be <em>unraveled</em>.
                </p>
                <p style="font-size: 10pt; color: #666; line-height: 1.8; text-align: justify; font-style: italic;">
                    åˆæ¶‰æ­¤é“ï¼Œå¤šä¸ºç ´è§£ä¹‹æ—¶çš„å¿«æ„ã€‚è€Œè¡Œè‡³æ·±å¤„è€…ï¼Œæ—©å·²è¶…è¶Šè¿™ä»½æ¬£å–œã€‚ä»–ä»¬æ€€è°¦å‘ä¹‹å¿ƒï¼Œ
                    æŒæ±‚çŸ¥ä¹‹å¿µï¼Œå–„äºæ€è€ƒï¼Œæœ€ç»ˆéƒ½ä¼šå›å½’æŠ€æœ¯çš„æœ¬è´¨â€”â€”å”¯æœ‰æ´æ‚‰ç³»ç»Ÿ<strong>æ„å»º</strong>ä¹‹é“ï¼Œ
                    æ–¹èƒ½å‚é€å…¶<strong>æ‹†è§£</strong>ä¹‹æ³•ã€‚çŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†ã€‚
                </p>
            </div>
        </div>
        
        <div class="toc-page">
            <h1 class="toc-title no-page-break">ğŸ“š ç›®å½•</h1>
            <p style="text-align: center; color: #666; font-size: 12pt; margin-top: 20pt;">
                æœ¬ä¹¦æ¶µç›–Androidé€†å‘å·¥ç¨‹çš„å®Œæ•´çŸ¥è¯†ä½“ç³»<br/>
                åŒ…æ‹¬åŸºç¡€ç†è®ºã€å·¥å…·ä½¿ç”¨ã€å®æˆ˜æŠ€å·§å’Œé«˜çº§ä¸»é¢˜
            </p>
        </div>
        
                    <div class="chapter">
                        <h1 class="no-page-break">ğŸ“„ Quick Start</h1>
                    
                                            <div class="section" id="section-1">
                                                <h2>1. 10åˆ†é’Ÿå…¥é—¨</h2>
                                                <h1>å¿«é€Ÿå…¥é—¨</h1>
<p>æ¬¢è¿ï¼è¿™ä¸ªæŒ‡å—å°†å¸®åŠ©ä½ åœ¨ <strong>10 åˆ†é’Ÿå†…</strong>å®Œæˆç¬¬ä¸€æ¬¡ Android é€†å‘åˆ†æã€‚</p>
<hr />
<h2>ä½ å°†å­¦åˆ°ä»€ä¹ˆ</h2>
<p>å®Œæˆæœ¬æŒ‡å—åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>âœ… åœ¨çœŸæœº/æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ Frida</li>
<li>âœ… Hook ä¸€ä¸ª Android åº”ç”¨çš„ Java æ–¹æ³•</li>
<li>âœ… æŸ¥çœ‹å’Œä¿®æ”¹æ–¹æ³•çš„å‚æ•°ä¸è¿”å›å€¼</li>
<li>âœ… ç†è§£åŸºæœ¬çš„é€†å‘åˆ†ææµç¨‹</li>
</ul>
<p><strong>é¢„è®¡ç”¨æ—¶</strong>: 10-15 åˆ†é’Ÿ</p>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td>â˜ Android è®¾å¤‡</td>
  <td>å·² Root çš„çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ï¼ˆæ¨è Genymotion / Android Studio AVDï¼‰</td>
</tr>
<tr>
  <td>â˜ ADB</td>
  <td>Android Debug Bridge</td>
</tr>
<tr>
  <td>â˜ Python</td>
  <td>ç‰ˆæœ¬ 3.8+</td>
</tr>
<tr>
  <td>â˜ æµ‹è¯• App</td>
  <td>æœ¬æŒ‡å—ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„è®¾ç½®åº”ç”¨</td>
</tr>
</tbody>
</table>
<h3>æ£€æŸ¥æ¸…å•</h3>
<pre><code class="language-bash"># 1. Check if ADB is installed
adb version

# 2. Check if Python is installed
python3 --version

# 3. Check device connection
adb devices
# Should display your device

</code></pre>
<h2>æ“ä½œæ­¥éª¤</h2>
<h3>ç¬¬ 1 æ­¥ï¼šå®‰è£… Fridaï¼ˆ2 åˆ†é’Ÿï¼‰</h3>
<p><strong>åœ¨ç”µè„‘ä¸Šå®‰è£… Frida å·¥å…·</strong>ï¼š</p>
<pre><code class="language-bash">pip install frida-tools

</code></pre>
<pre><code class="language-bash"># Visit https://github.com/frida/frida/releases
# Download frida-server matching your Python frida version

# View your frida version
frida --version

# View device architecture
adb shell getprop ro.product.cpu.abi
# Common output: arm64-v8a, armeabi-v7a, x86_64

# 2. Decompress and push to device
unzip frida-server-*.zip
adb push frida-server-*-android-* /data/local/tmp/frida-server

# 3. grant execute permission and run
adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;
adb shell &quot;/data/local/tmp/frida-server &amp;&quot;

</code></pre>
<pre><code class="language-bash">frida-ps -U
# Should see output like:
# PID Name
# ---- ---------------
# 1234 com.android.settings
# 5678 com.android.systemui
# ...

</code></pre>
<p>æˆ‘ä»¬å°† Hook Android è®¾ç½®åº”ç”¨ï¼Œç›‘æ§å…¶æ–¹æ³•è°ƒç”¨ã€‚</p>
<p><strong>åˆ›å»º Hook è„šæœ¬</strong> <code>first_hook.js</code>ï¼š</p>
<pre><code class="language-javascript">// first_hook.js - your first Frida script

Java.perform(function () {
  console.log(&quot;\n[*] Frida hook started!&quot;);
  console.log(&quot;[*] Finding TargetClass...\n&quot;);

  // Hook Android system Log class
  var Log = Java.use(&quot;android.util.Log&quot;);

  // Hook Log.d method (debug log)
  Log.d.overload(&quot;java.lang.String&quot;, &quot;java.lang.String&quot;).implementation =
    function (tag, msg) {
      console.log(&quot;\n[+] Captured LogCall:&quot;);
      console.log(&quot; Tag: &quot; + tag);
      console.log(&quot; Message: &quot; + msg);

      // Call original method
      return this.d(tag, msg);
    };

  console.log(&quot;[*] Hook setup completed! Now open Settings app...\n&quot;);
});
</code></pre>
<pre><code class="language-bash"># Method 1: attach to running app
frida -U -n com.android.settings -l first_hook.js

# Method 2: inject at app startup
frida -U -f com.android.settings -l first_hook.js --no-pause

</code></pre>
<pre><code>
[+] Captured LogCall:
Tag: SettingsActivity
Message: onCreate called

[+] Captured LogCall:
Tag: SettingsFragment
Message: Loading preferences...

</code></pre>
<p>âœ… <strong>çœ‹åˆ°æ—¥å¿—è¾“å‡ºäº†å—ï¼Ÿæ­å–œï¼ä½ å·²ç»æˆåŠŸ Hook äº†ä¸€ä¸ª Android åº”ç”¨ï¼</strong></p>
<hr />
<h3>ç¬¬ 3 æ­¥ï¼šä¿®æ”¹åº”ç”¨è¡Œä¸ºï¼ˆ3 åˆ†é’Ÿï¼‰</h3>
<p>ç°åœ¨è®©æˆ‘ä»¬åšç‚¹æ›´æœ‰è¶£çš„ â€”â€” <strong>ä¿®æ”¹åº”ç”¨çš„è¿”å›å€¼</strong>ã€‚</p>
<p><strong>åˆ›å»ºè„šæœ¬</strong> <code>modify_behavior.js</code>ï¼š</p>
<pre><code class="language-javascript">// modify_behavior.js - Modify App behavior

Java.perform(function () {
  console.log(&quot;\n[*] Start Hook...\n&quot;);

  // Hook String Class equals Method
  var String = Java.use(&quot;java.lang.String&quot;);

  String.equals.implementation = function (other) {
    // get original result
    var result = this.equals(other);

    // if string is &quot;WiFi&quot;, modify result
    if (this.toString() === &quot;WiFi&quot; || other.toString() === &quot;WiFi&quot;) {
      console.log(&quot;\n[!] detected WiFi String comparison&quot;);
      console.log(&quot; Original: '&quot; + this + &quot;' == '&quot; + other + &quot;' =&gt; &quot; + result);
      console.log(&quot; Modified: true\n&quot;);
      return true; // return true
    }

    return result;
  };

  console.log(
    &quot;[*] Hook completed! All 'WiFi' String comparison will return true\n&quot;
  );
});
</code></pre>
<pre><code class="language-bash">frida -U -f com.android.settings -l modify_behavior.js --no-pause

</code></pre>
<ul>
<li>ä¿®æ”¹åŠ å¯†å‚æ•°</li>
<li>ç»•è¿‡ç­¾åéªŒè¯</li>
<li>ç¯¡æ”¹ç½‘ç»œè¯·æ±‚</li>
</ul>
<hr />
<h2>æ­å–œï¼ä½ å·²å®Œæˆå¿«é€Ÿå…¥é—¨</h2>
<h3>ä½ å­¦ä¼šäº†ä»€ä¹ˆ</h3>
<p>âœ… å®‰è£…å’Œè¿è¡Œ Frida
âœ… ç¼–å†™åŸºæœ¬çš„ Hook è„šæœ¬
âœ… ç›‘æ§æ–¹æ³•è°ƒç”¨
âœ… ä¿®æ”¹æ–¹æ³•è¿”å›å€¼</p>
<h3>ä¸‹ä¸€æ­¥å­¦ä¹ </h3>
<p>æ ¹æ®ä½ çš„å…´è¶£é€‰æ‹©ï¼š</p>
<h4><strong>æˆ‘æƒ³æ·±å…¥å­¦ä¹ å·¥å…·</strong></h4>
<ul>
<li><a href="#section-40">Frida å®Œæ•´æŒ‡å—</a> - å­¦ä¹  Frida çš„æ‰€æœ‰ API</li>
<li><a href="#section-41">Frida å†…éƒ¨åŸç†</a> - ç†è§£ Frida å¦‚ä½•å·¥ä½œ</li>
<li><a href="#section-49">ADB å‘½ä»¤é€ŸæŸ¥</a> - æŒæ¡ ADB å¸¸ç”¨å‘½ä»¤</li>
</ul>
<h4><strong>æˆ‘æƒ³è§£å†³å…·ä½“é—®é¢˜</strong></h4>
<p><strong>åœºæ™¯ 1: æŠ“åŒ…åˆ†æ</strong>
â†’ <a href="#section-3">ç½‘ç»œæŠ“åŒ… Recipe</a></p>
<p><strong>åœºæ™¯ 2: ç»•è¿‡åè°ƒè¯•</strong>
â†’ <a href="#section-8">åè°ƒè¯•ç»•è¿‡ Recipe</a></p>
<p><strong>åœºæ™¯ 3: åˆ†æåŠ å¯†ç®—æ³•</strong>
â†’ <a href="#section-4">å¯†ç å­¦åˆ†æ Recipe</a></p>
<p><strong>åœºæ™¯ 4: è„±å£³åŠ å›º App</strong>
â†’ <a href="#section-14">åº”ç”¨è„±å£³ Recipe</a></p>
<h4><strong>æˆ‘æƒ³çœ‹å®æˆ˜æ¡ˆä¾‹</strong></h4>
<ul>
<li><a href="#section-51">éŸ³ä¹ App åˆ†æ</a> - VIP ç ´è§£ã€éŸ³é¢‘è§£å¯†</li>
<li><a href="#section-52">ç¤¾äº¤ App é£æ§</a> - API ç­¾åã€è®¾å¤‡æŒ‡çº¹</li>
</ul>
<h4><strong>æˆ‘æƒ³ç†è§£åŸºç¡€åŸç†</strong></h4>
<ul>
<li><a href="#section-58">APK æ–‡ä»¶ç»“æ„</a></li>
<li><a href="#section-59">Android å››å¤§ç»„ä»¶</a></li>
<li><a href="#section-62">DEX æ–‡ä»¶æ ¼å¼</a></li>
</ul>
<hr />
<h2>ğŸ’¡ å¸¸è§é—®é¢˜</h2>
<h3>Q: Frida è¿æ¥ä¸ä¸Šè®¾å¤‡ï¼Ÿ</h3>
<pre><code class="language-bash"># 1. Confirm frida-server is running
adb shell &quot;ps | grep frida&quot;

# 2. é‡å¯ frida-server
adb shell &quot;pkill frida-server&quot;
adb shell &quot;/data/local/tmp/frida-server &amp;&quot;

# 3. Check port forwarding (if needed)
adb forward tcp:27042 tcp:27042

</code></pre>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li><strong>ç¡®è®¤åº”ç”¨æ­£åœ¨è¿è¡Œ</strong>ï¼š</li>
</ol>
<pre><code class="language-bash">frida-ps -U | grep YourAppPackageName

</code></pre>
<ul>
<li>ä½¿ç”¨ jadx-gui åç¼–è¯‘æŸ¥çœ‹å‡†ç¡®çš„ç±»å</li>
<li>æ³¨æ„å†…éƒ¨ç±»çš„ <code>$</code> ç¬¦å·ï¼ˆå¦‚ <code>OuterClass$InnerClass</code>ï¼‰</li>
</ul>
<ol start="3">
<li><strong>å¤„ç†æ–¹æ³•é‡è½½</strong>ï¼š</li>
</ol>
<pre><code class="language-javascript">// If method has multiple overloads, need to specify parameter class type
YourClass.yourMethod.overload('java.lang.String').implementation = ...

</code></pre>
<p>â†’ æŸ¥çœ‹ <a href="#section-8">Frida åè°ƒè¯•ç»•è¿‡</a></p>
<hr />
<h2>æ›´å¤šèµ„æº</h2>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Frida å®˜æ–¹æ–‡æ¡£</strong></td>
  <td>https://frida.re/docs/</td>
</tr>
<tr>
  <td><strong>Frida CodeShare</strong></td>
  <td>https://codeshare.frida.re/ ï¼ˆç¤¾åŒºè„šæœ¬ï¼‰</td>
</tr>
<tr>
  <td><strong>æœ¬ Cookbook è„šæœ¬åº“</strong></td>
  <td><a href="#section-34">Frida è„šæœ¬ç¤ºä¾‹</a></td>
</tr>
</tbody>
</table>
<hr />
<p><strong>å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹ä½ çš„é€†å‘ä¹‹æ—…å§ï¼</strong></p>

                                            </div>
                                            
                                            <div class="section" id="section-2">
                                                <h2>2. ç¯å¢ƒé…ç½®</h2>
                                                <h1>ç¯å¢ƒé…ç½®æŒ‡å—</h1>
<p>æœ¬æŒ‡å—å¸®åŠ©ä½ ä»é›¶å¼€å§‹æ­å»º Android é€†å‘åˆ†æç¯å¢ƒã€‚</p>
<hr />
<h2>æ‰€éœ€å·¥å…·æ¦‚è§ˆ</h2>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç”¨é€”</th>
  <th>å¿…éœ€ç¨‹åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ADB</td>
  <td>ä¸ Android è®¾å¤‡é€šä¿¡</td>
  <td>å¿…éœ€</td>
</tr>
<tr>
  <td>Python 3.8+</td>
  <td>è¿è¡Œ Frida å·¥å…·</td>
  <td>å¿…éœ€</td>
</tr>
<tr>
  <td>Frida</td>
  <td>åŠ¨æ€æ’æ¡©æ¡†æ¶</td>
  <td>å¿…éœ€</td>
</tr>
<tr>
  <td>Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</td>
  <td>è¿è¡Œç›®æ ‡åº”ç”¨</td>
  <td>å¿…éœ€</td>
</tr>
<tr>
  <td>jadx-gui</td>
  <td>åç¼–è¯‘ APK</td>
  <td>æ¨è</td>
</tr>
<tr>
  <td>Burp Suite</td>
  <td>æŠ“åŒ…åˆ†æ</td>
  <td>å¯é€‰</td>
</tr>
<tr>
  <td>IDA Pro / Ghidra</td>
  <td>é™æ€åˆ†æ Native ä»£ç </td>
  <td>å¯é€‰</td>
</tr>
</tbody>
</table>
<hr />
<h2>é€‰æ‹©ä½ çš„ç³»ç»Ÿ</h2>
<details>
<summary><b>Windows ç”¨æˆ·</b></summary>

<h3>1. å®‰è£… Python</h3>
<p><strong>ä¸‹è½½å®‰è£…åŒ…</strong>ï¼š</p>
<ul>
<li>è®¿é—® https://www.python.org/downloads/</li>
<li>ä¸‹è½½ Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li>å®‰è£…æ—¶<strong>å‹¾é€‰</strong> &quot;Add Python to PATH&quot;</li>
</ul>
<p><strong>éªŒè¯å®‰è£…</strong>ï¼š</p>
<pre><code class="language-cmd">python --version
pip --version

</code></pre>
<p><strong>æ–¹æ³• 1: é€šè¿‡ Android Studio</strong></p>
<ul>
<li>ä¸‹è½½ Android Studio: https://developer.android.com/studio</li>
<li>å®‰è£…åï¼ŒSDK Manager ä¼šè‡ªåŠ¨å®‰è£… ADB</li>
<li>è·¯å¾„é€šå¸¸åœ¨: <code>C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Android\Sdk\platform-tools\</code></li>
</ul>
<p><strong>æ–¹æ³• 2: ç‹¬ç«‹å®‰è£… platform-tools</strong></p>
<ul>
<li>ä¸‹è½½: https://developer.android.com/studio/releases/platform-tools</li>
<li>è§£å‹åˆ° <code>C:\adb\</code></li>
<li>æ·»åŠ åˆ°ç³»ç»Ÿ PATH ç¯å¢ƒå˜é‡</li>
</ul>
<p><strong>éªŒè¯å®‰è£…</strong>ï¼š</p>
<pre><code class="language-cmd">adb version

</code></pre>
<pre><code class="language-cmd">pip install frida-tools
frida --version

</code></pre>
<details>
<summary><b>macOS ç”¨æˆ·</b></summary>

<h3>1. å®‰è£… Homebrewï¼ˆå¦‚æœæ²¡æœ‰ï¼‰</h3>
<pre><code class="language-bash">/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;

</code></pre>
<pre><code class="language-bash">brew install python3
brew install android-platform-tools
pip3 install frida-tools

</code></pre>
<pre><code class="language-bash">python3 --version
adb version
frida --version

</code></pre>
<details>
<summary><b>Linux ç”¨æˆ·</b></summary>

<h3>1. å®‰è£… Python</h3>
<pre><code class="language-bash">sudo apt update
sudo apt install python3 python3-pip

</code></pre>
<pre><code class="language-bash">sudo apt install android-tools-adb
pip3 install frida-tools

</code></pre>
<pre><code class="language-bash">python3 --version
adb version
frida --version

</code></pre>
<hr />
<h2>é…ç½® Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</h2>
<h3>é€‰é¡¹ 1: ä½¿ç”¨çœŸæœºï¼ˆæ¨èç”¨äºå®æˆ˜ï¼‰</h3>
<h4>æ­¥éª¤ 1: å¯ç”¨å¼€å‘è€…é€‰é¡¹</h4>
<ol>
<li>æ‰“å¼€ <strong>è®¾ç½®</strong> â†’ <strong>å…³äºæ‰‹æœº</strong></li>
<li>è¿ç»­ç‚¹å‡» <strong>&quot;ç‰ˆæœ¬å·&quot;</strong> 7 æ¬¡</li>
<li>è¿”å›è®¾ç½®ï¼Œæ‰¾åˆ° <strong>å¼€å‘è€…é€‰é¡¹</strong></li>
</ol>
<h4>æ­¥éª¤ 2: å¯ç”¨ USB è°ƒè¯•</h4>
<p>åœ¨å¼€å‘è€…é€‰é¡¹ä¸­ï¼š</p>
<ul>
<li>âœ… å¯ç”¨ <strong>USB è°ƒè¯•</strong></li>
<li>âœ… å¯ç”¨ <strong>USB å®‰è£…</strong>ï¼ˆå…è®¸é€šè¿‡ ADB å®‰è£…åº”ç”¨ï¼‰</li>
</ul>
<h4>æ­¥éª¤ 3: è¿æ¥è®¾å¤‡</h4>
<pre><code class="language-bash"># Connect device to PC via USB
# Device will pop up an authorization prompt, click &quot;Allow&quot;

# Verify connection
adb devices

# Should see:
# List of devices attached
# ABC123456789 device

</code></pre>
<p><strong>æ–¹æ³• 1: ä½¿ç”¨ Magisk</strong></p>
<ol>
<li>è§£é” Bootloaderï¼ˆå‚å•†ç‰¹å®šï¼‰</li>
<li>å®‰è£… Magisk: https://github.com/topjohnwu/Magisk</li>
<li>å‚è€ƒå®˜æ–¹æ–‡æ¡£</li>
</ol>
<p><strong>æ–¹æ³• 2: ä½¿ç”¨å·² Root çš„æµ‹è¯•æœº</strong></p>
<ul>
<li>Google Pixel ç³»åˆ—ï¼ˆå®¹æ˜“è§£é”ï¼‰</li>
<li>ä¸€åŠ è®¾å¤‡</li>
<li>æˆ–è´­ä¹°ä¸“é—¨çš„æµ‹è¯•æœº</li>
</ul>
<p><strong>âš ï¸ è­¦å‘Š</strong>: Root ä¼šå¤±å»ä¿ä¿®ï¼Œä»…åœ¨æµ‹è¯•è®¾å¤‡ä¸Šæ“ä½œï¼</p>
<hr />
<h3>é€‰é¡¹ 2: ä½¿ç”¨ android æ¨¡æ‹Ÿå™¨ï¼ˆæ¨èæ–°æ‰‹ï¼‰</h3>
<h4>æ–¹æ¡ˆ A: Genymotionï¼ˆæœ€ç¨³å®šï¼‰</h4>
<p><strong>ä¼˜ç‚¹</strong>: è‡ªå¸¦ Rootï¼Œæ€§èƒ½å¥½
<strong>ç¼ºç‚¹</strong>: ä¸ªäººç‰ˆå…è´¹ä½†åŠŸèƒ½å—é™</p>
<ol>
<li>ä¸‹è½½ Genymotion: https://www.genymotion.com/download/</li>
<li>å®‰è£…å¹¶æ³¨å†Œè´¦å·</li>
<li>åˆ›å»ºè™šæ‹Ÿè®¾å¤‡ï¼ˆæ¨è Google Pixel 3, Android 9.0ï¼‰</li>
<li>å¯åŠ¨è™šæ‹Ÿè®¾å¤‡</li>
</ol>
<p><strong>éªŒè¯</strong>ï¼š</p>
<pre><code class="language-bash">adb devices
# Should see Genymotion device

</code></pre>
<p><strong>æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ‰“å¼€ Android Studio</li>
<li>Tools â†’ Device Manager â†’ Create Device</li>
<li>é€‰æ‹©è®¾å¤‡ï¼ˆå¦‚ Pixel 5ï¼‰</li>
<li>é€‰æ‹©ç³»ç»Ÿé•œåƒï¼ˆâš ï¸ å¿…é¡»é€‰æ‹© <strong>ä¸å¸¦ Google Play</strong> çš„é•œåƒï¼Œå¦‚ &quot;x86_64 API 30&quot;ï¼‰</li>
<li>å¯åŠ¨æ¨¡æ‹Ÿå™¨</li>
</ol>
<p><strong>å¯ç”¨ Root</strong>ï¼š</p>
<pre><code class="language-bash">adb root
adb remount

</code></pre>
<p><strong>æ¨è</strong>ï¼š</p>
<ul>
<li>å¤œç¥: https://www.yeshen.com/</li>
<li>é›·ç”µ: https://www.ldmnq.com/</li>
</ul>
<p><strong>æ³¨æ„</strong>: éƒ¨åˆ†æ¨¡æ‹Ÿå™¨å¯èƒ½ä¸æ”¯æŒæŸäº›åº”ç”¨</p>
<hr />
<h2>å®‰è£… Frida Server åˆ°è®¾å¤‡</h2>
<h3>æ­¥éª¤ 1: ç¡®å®šè®¾å¤‡æ¶æ„</h3>
<pre><code class="language-bash">adb shell getprop ro.product.cpu.abi

</code></pre>
<ul>
<li><code>arm64-v8a</code> â†’ ä¸‹è½½ <strong>frida-server-*-android-arm64</strong>ï¼ˆçœŸæœºå¸¸ç”¨ï¼‰</li>
<li><code>armeabi-v7a</code> â†’ ä¸‹è½½ <strong>frida-server-*-android-arm</strong></li>
<li><code>x86_64</code> â†’ ä¸‹è½½ <strong>frida-server-*-android-x86_64</strong>ï¼ˆæ¨¡æ‹Ÿå™¨å¸¸ç”¨ï¼‰</li>
<li><code>x86</code> â†’ ä¸‹è½½ <strong>frida-server-*-android-x86</strong></li>
</ul>
<h3>æ­¥éª¤ 2: ä¸‹è½½ Frida Server</h3>
<ol>
<li>è®¿é—®: https://github.com/frida/frida/releases</li>
<li>æ‰¾åˆ°ä¸ä½ ç”µè„‘ Frida ç‰ˆæœ¬ä¸€è‡´çš„ release</li>
</ol>
<p><strong>æ£€æŸ¥æœ¬åœ° Frida ç‰ˆæœ¬</strong>ï¼š</p>
<pre><code class="language-bash">frida --version
# E.g.: 16.1.4

</code></pre>
<pre><code class="language-bash"># Decompress
unxz frida-server-16.1.4-android-arm64.xz
# or Windows: Use 7-Zip Decompress

# Rename (optional, easier to manage)
mv frida-server-16.1.4-android-arm64 frida-server

# push to device
adb push frida-server /data/local/tmp/

# Grant Execute permission
adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;

</code></pre>
<pre><code class="language-bash">adb shell &quot;/data/local/tmp/frida-server &amp;&quot;

# Verify it is running
adb shell &quot;ps | grep frida-server&quot;

</code></pre>
<pre><code class="language-bash"># Add to /data/adb/service.d/ (Need Root)

</code></pre>
<pre><code class="language-bash">frida-ps -U

# Should see process list
# PID Name
# ---- ---------------
# 1234 com.android.settings
# ...

</code></pre>
<h2>å®‰è£…å…¶ä»–å·¥å…·ï¼ˆå¯é€‰ï¼‰</h2>
<h3>jadx-guiï¼ˆå¼ºçƒˆæ¨èï¼‰</h3>
<p>ç”¨äºåç¼–è¯‘ APK æŸ¥çœ‹ Java ä»£ç ã€‚</p>
<p><strong>å®‰è£…</strong>ï¼š</p>
<ol>
<li>ä¸‹è½½: https://github.com/skylot/jadx/releases</li>
<li>è§£å‹å¹¶è¿è¡Œ <code>jadx-gui</code>ï¼ˆæˆ– Windows ä¸Šè¿è¡Œ <code>jadx-gui.bat</code>ï¼‰</li>
</ol>
<p><strong>ä½¿ç”¨</strong>ï¼š</p>
<pre><code class="language-bash"># command line
jadx -d output_dir app.apk

# or use GUI: Open APK File

</code></pre>
<p><strong>IDA Pro</strong>:</p>
<ul>
<li>å•†ä¸šè½¯ä»¶ï¼ŒåŠŸèƒ½å¼ºå¤§</li>
<li>å®˜ç½‘: https://hex-rays.com/ida-pro/</li>
</ul>
<p><strong>Ghidra</strong>ï¼ˆå…è´¹å¼€æºï¼‰:</p>
<ul>
<li>NSA å¼€æºå·¥å…·</li>
<li>ä¸‹è½½: https://github.com/NationalSecurityAgency/ghidra/releases</li>
<li>éœ€è¦ JDK 11+</li>
</ul>
<hr />
<h2>âœ… ç¯å¢ƒæ£€æŸ¥æ¸…å•</h2>
<p>å®Œæˆé…ç½®åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š</p>
<pre><code class="language-bash"># 1. Python
python3 --version # Should &gt;= 3.8

# 2. Pip
pip3 --version

# 3. ADB
adb version

# 4. Verify device connection
adb devices # Should display device

# 5. Frida native tool
frida --version

# 6. Frida Server
frida-ps -U # Should list processes

# 7. jadx (Optional)
jadx --version

</code></pre>
<hr />
<h2>â“ å¸¸è§é—®é¢˜</h2>
<h3>Q: <code>adb devices</code> æ˜¾ç¤º &quot;unauthorized&quot;ï¼Ÿ</h3>
<p><strong>è§£å†³</strong>ï¼š</p>
<ol>
<li>è®¾å¤‡ä¸Šæ²¡æœ‰å¼¹å‡ºæˆæƒæç¤ºï¼Ÿé‡æ–°æ’æ‹” USB</li>
<li>æ’¤é”€æˆæƒå¹¶é‡è¯•ï¼š</li>
</ol>
<pre><code class="language-bash">adb kill-server
adb start-server

</code></pre>
<h3>Q: <code>adb devices</code> ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤ºï¼Ÿ</h3>
<p><strong>Windows</strong>:</p>
<ol>
<li>å®‰è£…è®¾å¤‡é©±åŠ¨ï¼ˆå‚å•†ç½‘ç«™ä¸‹è½½ï¼‰</li>
<li>æˆ–å®‰è£… Universal ADB Driver</li>
</ol>
<p><strong>Linux</strong>:</p>
<ol>
<li>æ£€æŸ¥ udev è§„åˆ™æ˜¯å¦é…ç½®</li>
<li>å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ <code>plugdev</code> ç»„ï¼š</li>
</ol>
<pre><code class="language-bash">sudo usermod -aG plugdev $USER
# Need to re-login for changes to take effect

</code></pre>
<ol>
<li><strong>ç¡®è®¤è®¾å¤‡å·² Root</strong>ï¼š</li>
</ol>
<pre><code class="language-bash">adb shell su
# If shows &quot;not found&quot;, indicates no Root

</code></pre>
<pre><code class="language-bash">adb shell &quot;setenforce 0&quot; # Temporarily disable SELinux

</code></pre>
<pre><code class="language-bash"># Re-verify architecture
adb shell getprop ro.product.cpu.abi
# Download matching frida-server

</code></pre>
<pre><code class="language-bash"># Native Frida Version
frida --version

# Make sure frida-server version matches
# Re-download corresponding version frida-server

</code></pre>
<p><strong>Android Studio AVD</strong>:</p>
<ul>
<li>ä½¿ç”¨ x86_64 é•œåƒï¼ˆè€Œé ARMï¼‰</li>
<li>å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆIntel HAXM / AMD Hypervisorï¼‰</li>
</ul>
<hr />
<h2>ä¸‹ä¸€æ­¥</h2>
<p>ç¯å¢ƒé…ç½®å®Œæˆï¼æ¥ä¸‹æ¥ï¼š</p>
<ol>
<li><strong>å®Œæˆå¿«é€Ÿå…¥é—¨</strong> â†’ <a href="#section-1">10 åˆ†é’Ÿç¬¬ä¸€æ¬¡ Hook</a></li>
<li><strong>å­¦ä¹  Frida å·¥å…·</strong> â†’ <a href="#section-40">Frida å®Œæ•´æŒ‡å—</a></li>
<li><strong>æŸ¥çœ‹å®æˆ˜è„šæœ¬</strong> â†’ <a href="#section-34">Frida è„šæœ¬ç¤ºä¾‹</a></li>
</ol>
<hr />
<p><strong>ç¥é…ç½®é¡ºåˆ©ï¼</strong></p>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">ğŸ“– Recipes</h1>
                    
                                            <div class="section" id="section-3">
                                                <h2>3. R01: Network Sniffing</h2>
                                                <h1>R01: Recipe: æŠ“åŒ…åˆ†æ android åº”ç”¨çš„ç½‘ç»œæµé‡</h1>
<h1># é—®é¢˜åœºæ™¯</h1>
<ul>
<li><em>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</em></li>
</ul>
<ul>
<li>â“ æƒ³çŸ¥é“æŸä¸ª App è°ƒç”¨äº†å“ªäº› API æ¥å£</li>
<li>â“ éœ€è¦åˆ†æ API çš„è¯·æ±‚å‚æ•°å’Œå“åº”æ•°æ®</li>
<li>â“ æƒ³æŸ¥çœ‹ App å‘é€äº†å“ªäº›æ•æ„Ÿä¿¡æ¯ï¼ˆè®¾å¤‡ä¿¡æ¯ã€å®šä½ç­‰ï¼‰</li>
<li>â“ éœ€è¦æ‰¾åˆ°åŠ å¯†ç­¾åçš„ç”Ÿæˆé€»è¾‘</li>
<li>â“ æƒ³é‡æ”¾æˆ–ä¿®æ”¹ API è¯·æ±‚</li>
</ul>
<ul>
<li><p><em>æœ¬é…æ–¹æ•™ä½ </em>ï¼šé…ç½®æŠ“åŒ…ç¯å¢ƒï¼Œæ‹¦æˆªå¹¶åˆ†æ HTTPS æµé‡ï¼Œç»•è¿‡ SSL Pinning é™åˆ¶ã€‚</p>
</li>
<li><p><em>é¢„è®¡ç”¨æ—¶</em>: 15-30 åˆ†é’Ÿï¼ˆé¦–æ¬¡é…ç½®ï¼‰</p>
</li>
</ul>
<hr />
<h1># å·¥å…·æ¸…å•</h1>
<h2># å¿…éœ€å·¥å…·</h2>
<ul>
<li>â˜ <em>Android è®¾å¤‡/æ¨¡æ‹Ÿå™¨</em>ï¼ˆå·² Rootï¼Œæˆ–å¯å®‰è£…è¯ä¹¦ï¼‰</li>
<li>â˜ <em>æŠ“åŒ…ä»£ç†å·¥å…·</em>ï¼ˆé€‰æ‹©å…¶ä¸€ï¼‰ï¼š<ul>
<li>Burp Suiteï¼ˆæ¨èï¼ŒåŠŸèƒ½æœ€å¼ºï¼‰</li>
<li>Charlesï¼ˆUI å‹å¥½ï¼‰</li>
<li>mitmproxyï¼ˆå¼€æºï¼Œå¯ç¼–ç¨‹ï¼‰</li>
</ul>
</li>
<li>â˜ <em>Frida</em>ï¼ˆç”¨äºç»•è¿‡ SSL Pinningï¼‰</li>
</ul>
<h2># å¯é€‰å·¥å…·</h2>
<ul>
<li>â˜ <em>Wireshark</em>ï¼ˆåˆ†æåº•å±‚ TCP/UDP æµé‡ï¼‰</li>
<li>â˜ <em>HttpCanary</em>ï¼ˆAndroid ä¸Šçš„æŠ“åŒ…å·¥å…·ï¼Œæ— éœ€ PCï¼‰</li>
</ul>
<hr />
<h1># å‰ç½®æ¡ä»¶</h1>
<h2># âœ… ç¡®è®¤æ¸…å•</h2>
<pre><code class="language-bash"># 1. Verify device connection
adb devices

# 2. Frida å¯ç”¨
frida-ps -U

# 3. PC and phone on the same Wi-Fi network
# Record PC IP addressï¼ˆused below as YOUR_PC_IPï¼‰
# Windows: ipconfig
# macOS/Linux: ifconfig or ip addr

</code></pre>
<ul>
<li><em>Android 7.0+</em>ï¼šéœ€è¦ Root æƒé™å®‰è£…ç³»ç»Ÿè¯ä¹¦</li>
<li><em>Android 6.0-</em>ï¼šå¯ç›´æ¥å®‰è£…ç”¨æˆ·è¯ä¹¦ï¼Œæ— éœ€ Root</li>
<li>æˆ–ä½¿ç”¨æ”¯æŒç”¨æˆ·è¯ä¹¦çš„ Appï¼ˆTarget SDK &lt; 24ï¼‰</li>
</ul>
<hr />
<h1># è§£å†³æ–¹æ¡ˆ</h1>
<h2># ç¬¬ 1 æ­¥ï¼šé…ç½®æŠ“åŒ…å·¥å…·ï¼ˆ5 åˆ†é’Ÿï¼‰</h2>
<details>
<summary><b>ä½¿ç”¨ Burp Suiteï¼ˆæ¨èï¼‰</b></summary>

<h3># 1.1 å¯åŠ¨ Burp Suite</h3>
<pre><code class="language-bash"># Download Burp Suite Community Edition (free)
# https://portswigger.net/burp/communitydownload

# Run the command
java -jar burpsuite_community.jar

</code></pre>
<ol>
<li>æ‰“å¼€ <em>Proxy</em> â†’ <em>Options</em></li>
<li>åœ¨ <em>Proxy Listeners</em> éƒ¨åˆ†</li>
<li>ç‚¹å‡» <em>Add</em>ï¼Œé…ç½®ï¼š</li>
</ol>
<ul>
<li><em>Bind to port</em>: <code>8888</code></li>
<li><em>Bind to address</em>: <code>All interfaces</code>ï¼ˆæˆ–é€‰æ‹©ä½ çš„ Wi-Fi ç½‘å¡ï¼‰</li>
</ul>
<ol start="4">
<li>ç‚¹å‡» <em>OK</em> ä¿å­˜</li>
</ol>
<p><img src="../../images/burp_proxy_config.png" alt="Burp Proxyé…ç½®" /></p>
<p>âœ… <em>éªŒè¯</em>ï¼šæµè§ˆå™¨è®¿é—® <code>http://YOUR_PC_IP:8888</code>ï¼Œåº”è¯¥çœ‹åˆ° Burp çš„é”™è¯¯é¡µé¢ï¼ˆè¡¨ç¤ºä»£ç†å·¥ä½œæ­£å¸¸ï¼‰</p>
</details>

<details>
<summary><b>ä½¿ç”¨ Charles</b></summary>

<h3># 1.1 å¯åŠ¨ Charles</h3>
<p>ä¸‹è½½ï¼šhttps://www.charlesproxy.com/download/</p>
<h3># 1.2 é…ç½®ä»£ç†</h3>
<ol>
<li><em>Proxy</em> â†’ <em>Proxy Settings</em></li>
<li>è®¾ç½® Port ä¸º <code>8888</code></li>
<li>å‹¾é€‰ <em>Enable transparent HTTP proxying</em></li>
</ol>
</details>

<details>
<summary><b>ä½¿ç”¨ mitmproxy</b></summary>

<pre><code class="language-bash"># Install
pip install mitmproxy

# startupï¼ˆç›‘å¬ 8888 ç«¯å£ï¼‰
mitmproxy -p 8888 --listen-host 0.0.0.0

# æˆ–ä½¿ç”¨ Web ç•Œé¢
mitmweb -p 8888 --listen-host 0.0.0.0
# è®¿é—® http://127.0.0.1:8081 æŸ¥çœ‹æµé‡

</code></pre>
<hr />
<h2># ç¬¬ 2 æ­¥ï¼šé…ç½®æ‰‹æœºä»£ç†ï¼ˆ2 åˆ†é’Ÿï¼‰</h2>
<h3># 2.1 è¿æ¥åˆ°åŒä¸€ Wi-Fi</h3>
<p>ç¡®ä¿æ‰‹æœºå’Œ PC åœ¨<em>åŒä¸€å±€åŸŸç½‘</em>ã€‚</p>
<h3># 2.2 è®¾ç½®æ‰‹åŠ¨ä»£ç†</h3>
<ol>
<li>æ‰“å¼€æ‰‹æœº <em>è®¾ç½®</em> â†’ <em>Wi-Fi</em></li>
<li><em>é•¿æŒ‰</em>å½“å‰è¿æ¥çš„ Wi-Fi â†’ <em>ä¿®æ”¹ç½‘ç»œ</em></li>
<li>å±•å¼€ <em>é«˜çº§é€‰é¡¹</em></li>
<li>ä»£ç†è®¾ç½®æ”¹ä¸º <em>æ‰‹åŠ¨</em>ï¼š</li>
</ol>
<ul>
<li><em>ä»£ç†æœåŠ¡å™¨ä¸»æœºå</em>: <code>YOUR_PC_IP</code>ï¼ˆå¦‚ <code>192.168.1.100</code>ï¼‰</li>
<li><em>ä»£ç†æœåŠ¡å™¨ç«¯å£</em>: <code>8888</code></li>
</ul>
<ol start="5">
<li>ä¿å­˜</li>
</ol>
<h3># 2.3 éªŒè¯ä»£ç†è¿æ¥</h3>
<pre><code class="language-bash"># æ‰‹æœºæµè§ˆå™¨è®¿é—®ä»»æ„ HTTP ç½‘ç«™ï¼ˆå¦‚ http://example.comï¼‰
# æ­¤æ—¶ Burp/Charles åº”è¯¥æ˜¾ç¤ºæ‹¦æˆªåˆ°çš„è¯·æ±‚

</code></pre>
<h2># ç¬¬ 3 æ­¥ï¼šå®‰è£… HTTPS è¯ä¹¦ï¼ˆ5-10 åˆ†é’Ÿï¼‰</h2>
<p><em>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</em> HTTPS æµé‡ç»è¿‡åŠ å¯†ï¼Œéœ€è¦å®‰è£…è¯ä¹¦æ‰èƒ½è§£å¯†æŸ¥çœ‹ã€‚</p>
<details>
<summary><b>Burp Suite è¯ä¹¦å®‰è£…</b></summary>

<h3># 3.1 ä¸‹è½½è¯ä¹¦</h3>
<ol>
<li>æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://burp</code></li>
<li>ç‚¹å‡» <em>CA Certificate</em> ä¸‹è½½ <code>cacert.der</code></li>
</ol>
<h3># 3.2 å®‰è£…è¯ä¹¦</h3>
<ul>
<li><em>Android 7.0+ ï¼ˆéœ€è¦ Rootï¼‰</em>ï¼š</li>
</ul>
<pre><code class="language-bash"># 1. è½¬æ¢è¯ä¹¦æ ¼å¼
openssl x509 -inform DER -in cacert.der -out cacert.pem

# 2. è®¡ç®—è¯ä¹¦å“ˆå¸Œ
HASH=$(openssl x509 -inform PEM -subject_hash_old -in cacert.pem | head -1)

# 3. é‡å‘½åå¹¶æ¨é€åˆ°ç³»ç»Ÿç›®å½•
cp cacert.pem $HASH.0
adb root
adb remount
adb push $HASH.0 /system/etc/security/cacerts/
adb shell chmod 644 /system/etc/security/cacerts/$HASH.0

# 4. é‡å¯è®¾å¤‡
adb reboot

</code></pre>
<details>
<summary><b>Charles è¯ä¹¦å®‰è£…</b></summary>

<ol>
<li>æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://chls.pro/ssl</code></li>
<li>ä¸‹è½½å¹¶å®‰è£…è¯ä¹¦</li>
<li>Android 7.0+ åŒæ ·éœ€è¦å®‰è£…åˆ°ç³»ç»Ÿç›®å½•ï¼ˆå‚è€ƒ Burp æ­¥éª¤ï¼‰</li>
</ol>
</details>

<details>
<summary><b>mitmproxy è¯ä¹¦å®‰è£…</b></summary>

<ol>
<li>æ‰‹æœºæµè§ˆå™¨è®¿é—® <code>http://mitm.it</code></li>
<li>ç‚¹å‡» Android å›¾æ ‡ä¸‹è½½è¯ä¹¦</li>
<li>å®‰è£…æ­¥éª¤åŒä¸Š</li>
</ol>
</details>

<hr />
<h2># ç¬¬ 4 æ­¥ï¼šå¼€å§‹æŠ“åŒ…ï¼ˆ1 åˆ†é’Ÿï¼‰</h2>
<h3># 4.1 æ¸…ç©ºæ—§è®°å½•</h3>
<ul>
<li><em>Burp</em>: Proxy â†’ HTTP history â†’ å³é”® â†’ <em>Clear history</em></li>
<li><em>Charles</em>: Proxy â†’ <em>Clear Session</em></li>
</ul>
<h3># 4.2 å¯åŠ¨ç›®æ ‡ App</h3>
<p>åœ¨æ‰‹æœºä¸Šæ‰“å¼€è¦åˆ†æçš„åº”ç”¨ï¼Œæ­£å¸¸ä½¿ç”¨ã€‚</p>
<h3># 4.3 æŸ¥çœ‹æµé‡</h3>
<p>åœ¨æŠ“åŒ…å·¥å…·ä¸­ï¼š</p>
<ul>
<li>æŸ¥çœ‹ HTTP history / Sequence</li>
<li>ç­›é€‰ç›®æ ‡ App çš„åŸŸå</li>
<li>åˆ†æ Request/Response å†…å®¹</li>
</ul>
<p><em>ç¤ºä¾‹åˆ†æç‚¹</em>ï¼š</p>
<ul>
<li>è¯·æ±‚ URL å’Œå‚æ•°</li>
<li>Request Headersï¼ˆ<code>User-Agent</code>, <code>Authorization</code>, è‡ªå®šä¹‰ç­¾åå¤´ï¼‰</li>
<li>Request Bodyï¼ˆPOST æ•°æ®ï¼‰</li>
<li>Response Bodyï¼ˆAPI è¿”å›çš„ JSON/XMLï¼‰</li>
</ul>
<hr />
<h2># ç¬¬ 5 æ­¥ï¼šç»•è¿‡ SSL Pinningï¼ˆå¦‚é‡åˆ°ï¼‰</h2>
<p><em>ç—‡çŠ¶</em>ï¼š</p>
<ul>
<li>è¯ä¹¦å·²å®‰è£…ï¼Œä½† HTTPS è¯·æ±‚ä»æ— æ³•æŠ“å–</li>
<li>App æ˜¾ç¤º&quot;ç½‘ç»œé”™è¯¯&quot;æˆ–ç›´æ¥é—ªé€€</li>
<li>æŠ“åŒ…å·¥å…·æ˜¾ç¤º SSL æ¡æ‰‹å¤±è´¥</li>
</ul>
<ul>
<li><em>åŸå› </em>ï¼šApp å¯ç”¨äº† SSL Pinningï¼ˆè¯ä¹¦é”å®šï¼‰ï¼Œæ‹’ç»ä¿¡ä»»ç³»ç»Ÿè¯ä¹¦ã€‚</li>
</ul>
<h3># æ–¹æ³• 1: ä½¿ç”¨ Frida é€šç”¨è„šæœ¬ï¼ˆæ¨èï¼‰</h3>
<p><em>ä¸‹è½½è„šæœ¬</em> <code>bypass_ssl_pinning.js</code>ï¼š</p>
<pre><code class="language-javascript">// Universal android SSL Pinning Bypass
Java.perform(function () {
  console.log(&quot; [SSL Pinning Bypass] å·²Start/Boot&quot;);

  // æ‹¦æˆª TrustManagerImpl (å¸¸ç”¨)
  try {
    var TrustManagerImpl = Java.use(
      &quot;com.android.org.conscrypt.TrustManagerImpl&quot;
    );
    TrustManagerImpl.verifyChain.implementation = function (
      untrustedChain,
      trustAnchorChain,
      host,
      clientAuth,
      ocspData,
      tlsSctData
    ) {
      console.log(&quot;âœ“ [TrustManagerImpl] BypassCertValidate: &quot; + host);
      return untrustedChain;
    };
  } catch (e) {
    console.log(&quot;! TrustManagerImpl ä¸å­˜At&quot;);
  }

  // Hook OkHttp3
  try {
    var CertificatePinner = Java.use(&quot;okhttp3.CertificatePinner&quot;);
    CertificatePinner.check.overload(
      &quot;java.lang.String&quot;,
      &quot;java.util.List&quot;
    ).implementation = function (hostname, peerCertificates) {
      console.log(&quot;âœ“ [OkHttp3] Bypass SSL Pinning: &quot; + hostname);
      return;
    };
  } catch (e) {
    console.log(&quot;! OkHttp3 ä¸å­˜At&quot;);
  }

  // Hook SSLContext
  try {
    var SSLContext = Java.use(&quot;javax.net.ssl.SSLContext&quot;);
    SSLContext.init.overload(
      &quot;[Ljavax.net.ssl.KeyManager;&quot;,
      &quot;[Ljavax.net.ssl.TrustManager;&quot;,
      &quot;java.security.SecureRandom&quot;
    ).implementation = function (keyManager, trustManager, secureRandom) {
      console.log(&quot;âœ“ [SSLContext] Useè‡ªDefine TrustManager&quot;);
      this.init(keyManager, null, secureRandom);
    };
  } catch (e) {
    console.log(&quot;! SSLContext hook Failed&quot;);
  }

  console.log(&quot; [SSL Pinning Bypass] Configå®Œæˆ\n&quot;);
});
</code></pre>
<pre><code class="language-bash"># æ–¹å¼1ï¼šé™„åŠ åˆ°è¿è¡Œä¸­çš„ App
frida -U com.example.app -l bypass_ssl_pinning.js

# æ–¹å¼2ï¼šå¯åŠ¨ App å¹¶æ³¨å…¥
frida -U -f com.example.app -l bypass_ssl_pinning.js --no-pause

</code></pre>
<pre><code>[SSL Pinning Bypass] Configå®Œæˆ

</code></pre>
<h3># æ–¹æ³• 2: ä½¿ç”¨ Xposed æ¨¡å—</h3>
<details>
<summary><b>JustTrustMe å®‰è£…æ­¥éª¤</b></summary>

<ol>
<li>ç¡®ä¿è®¾å¤‡å·²å®‰è£… Xposed Framework</li>
<li>ä¸‹è½½ JustTrustMe æ¨¡å—ï¼šhttps://github.com/Fuzion24/JustTrustMe</li>
<li>åœ¨ Xposed Installer ä¸­æ¿€æ´»</li>
<li>é‡å¯è®¾å¤‡</li>
</ol>
<h3># æ–¹æ³• 3: ä¿®æ”¹ APKï¼ˆé‡æ‰“åŒ…ï¼‰</h3>
<details>
<summary><b>APK é‡æ‰“åŒ…æ­¥éª¤</b></summary>

<p>å¦‚æœ Frida è¢«æ£€æµ‹ï¼Œå¯ä»¥ä¿®æ”¹ APK æ¥ä¿¡ä»»ç”¨æˆ·è¯ä¹¦ï¼š</p>
<ol>
<li>åç¼–è¯‘ APK</li>
<li>ä¿®æ”¹ <code>AndroidManifest.xml</code>ï¼Œæ·»åŠ ï¼š</li>
</ol>
<pre><code class="language-xml">&lt;application android:networkSecurityConfig=&quot;@xml/network_security_config&quot;&gt;

</code></pre>
<pre><code class="language-xml">&lt;network-security-config&gt;
&lt;base-config cleartextTrafficPermitted=&quot;true&quot;&gt;
&lt;trust-anchors&gt;
&lt;certificates src=&quot;system&quot; /&gt;
&lt;certificates src=&quot;user&quot; /&gt;
&lt;/trust-anchors&gt;
&lt;/base-config&gt;
&lt;/network-security-config&gt;

</code></pre>
</details>

<hr />
<h1># å·¥ä½œåŸç†</h1>
<h2># MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰æµç¨‹</h2>
<pre><code>2. ä»£ç†è§£å¯†è¯·æ±‚ï¼ˆä½¿ç”¨å®‰è£…çš„è¯ä¹¦ï¼‰
3. ä»£ç†é‡æ–°åŠ å¯†å¹¶è½¬å‘åˆ°çœŸå®æœåŠ¡å™¨
4. æœåŠ¡å™¨å“åº”ç»è¿‡ä»£ç†è¿”å›ç»™ App
    ```

## # SSL Pinning æ˜¯ä»€ä¹ˆï¼Ÿ

App å†…ç½®äº†æœåŠ¡å™¨è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashï¼‰ï¼Œåªä¿¡ä»»ç‰¹å®šè¯ä¹¦ï¼š

```java
CertificatePinner pinner = new CertificatePinner.Builder()
.add(&quot;api.example.com&quot;, &quot;sha256/AAAAAAAAAA...&quot;)
.build();

</code></pre>
<h2># âŒ é—®é¢˜ 1: æ‰‹æœºæ— æ³•è¿æ¥ä»£ç†</h2>
<p><em>ç—‡çŠ¶</em>ï¼šæµè§ˆå™¨æ˜¾ç¤º&quot;æ— æ³•è¿æ¥åˆ°ä»£ç†æœåŠ¡å™¨&quot;</p>
<p><em>æ£€æŸ¥</em>ï¼š</p>
<ol>
<li>PC å’Œæ‰‹æœºæ˜¯å¦åœ¨åŒä¸€ Wi-Fiï¼Ÿ</li>
<li>PC é˜²ç«å¢™æ˜¯å¦å…è®¸ 8888 ç«¯å£ï¼Ÿ</li>
</ol>
<pre><code class="language-bash"># Windows é˜²ç«å¢™è§„åˆ™ï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰
netsh advfirewall firewall add rule name=&quot;Burp Proxy&quot; dir=in action=allow protocol=TCP localport=8888

# macOS
# ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§ â†’ é˜²ç«å¢™é€‰é¡¹ â†’ å…è®¸ Java

</code></pre>
<pre><code class="language-bash"># æ£€æŸ¥ç«¯å£
netstat -an | grep 8888 # macOS/Linux
netstat -an | findstr 8888 # Windows

</code></pre>
<p><em>ç—‡çŠ¶</em>ï¼šæµè§ˆå™¨æ˜¾ç¤ºè¯ä¹¦æ— æ•ˆ</p>
<p><em>Android 7.0+ é™åˆ¶</em>ï¼š</p>
<ul>
<li>é»˜è®¤åªä¿¡ä»»ç³»ç»Ÿè¯ä¹¦</li>
<li>å¿…é¡»å°†è¯ä¹¦å®‰è£…åˆ° <code>/system/etc/security/cacerts/</code>ï¼ˆéœ€è¦ Rootï¼‰</li>
</ul>
<p><em>æ—  Root è®¾å¤‡çš„è§£å†³æ–¹æ¡ˆ</em>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Magisk + MagiskTrustUserCerts æ¨¡å—</li>
<li>æˆ–ä¿®æ”¹ APKï¼ˆå‚è€ƒæ–¹æ³• 3ï¼‰</li>
</ul>
<h2># âŒ é—®é¢˜ 3: Frida è„šæœ¬ä¸ç”Ÿæ•ˆ</h2>
<p><em>å¯èƒ½åŸå› </em>ï¼š</p>
<ol>
<li><p><em>App ä½¿ç”¨äº†è‡ªå®šä¹‰ç½‘ç»œåº“</em>
â†’ éœ€è¦å®šä½å…·ä½“çš„ç±»åå’Œæ–¹æ³•ï¼Œå®šåˆ¶ Hook è„šæœ¬</p>
</li>
<li><p><em>Frida è¢«æ£€æµ‹</em>
â†’ ä½¿ç”¨é‡å‘½åçš„ frida-serverï¼š</p>
</li>
</ol>
<pre><code class="language-bash">adb push frida-server /data/local/tmp/random_name
adb shell &quot;/data/local/tmp/random_name &amp;&quot;

</code></pre>
<p>â†’ Hook æ‰€æœ‰è¿›ç¨‹ï¼š</p>
<pre><code class="language-bash">frida-ps -U # æ‰¾åˆ°æ‰€æœ‰è¿›ç¨‹
frida -U -p PID1 -p PID2 -l script.js

</code></pre>
<p><em>å¯èƒ½åŸå› </em>ï¼š</p>
<ol>
<li><p><em>ä½¿ç”¨äº† HTTP/2 æˆ– QUIC</em>
â†’ Burp Suite â†’ Proxy â†’ Options â†’ HTTP/2 â†’ å‹¾é€‰&quot;Enable HTTP/2&quot;</p>
</li>
<li><p><em>ç›´æ¥ä½¿ç”¨ Socket é€šä¿¡</em>
â†’ éœ€è¦ä½¿ç”¨ Wireshark æˆ– tcpdump æŠ“å–åŸå§‹ TCP åŒ…</p>
</li>
<li><p><em>åŠ å¯†çš„è‡ªå®šä¹‰åè®®</em>
â†’ éœ€è¦é€†å‘åˆ†æåŠ å¯†ç®—æ³•å¹¶è§£å¯†</p>
</li>
</ol>
<hr />
<h1># å»¶ä¼¸é˜…è¯»</h1>
<h2># ç›¸å…³é…æ–¹</h2>
<ul>
<li><em><a href="#section-4">å¯†ç å­¦åˆ†æ</a></em> - åˆ†æ API ç­¾åå’ŒåŠ å¯†ç®—æ³•</li>
<li><em><a href="#section-8">Frida åè°ƒè¯•ç»•è¿‡</a></em> - å¦‚æœ App æ£€æµ‹åˆ° Frida</li>
<li><em><a href="#section-5">TLS æŒ‡çº¹åˆ†æ</a></em> - ç†è§£ TLS æŒ‡çº¹æŠ€æœ¯</li>
</ul>
<h2># å·¥å…·æ·±å…¥</h2>
<ul>
<li><em><a href="#section-40">Frida å®Œæ•´æŒ‡å—</a></em></li>
<li><em>[Burp Suite ä½¿ç”¨æŠ€å·§]</em> - TODOï¼Œä¸€ä¸ªæ¯”è¾ƒæµæ°“çš„å·¥å…·</li>
</ul>
<h2># æ¡ˆä¾‹åˆ†æ</h2>
<ul>
<li><em><a href="#section-51">éŸ³ä¹ App åˆ†æ</a></em> - API æŠ“åŒ…å®æˆ˜</li>
<li><em><a href="#section-52">ç¤¾äº¤åª’ä½“é£æ§</a></em> - å¤æ‚ç­¾ååˆ†æ</li>
</ul>
<hr />
<h1># å¿«é€Ÿå‚è€ƒ</h1>
<h2># ä¸€é”®å¯åŠ¨è„šæœ¬</h2>
<ul>
<li><em>macOS/Linux</em>:</li>
</ul>
<pre><code class="language-bash"># !/bin/bash
# start_proxy.sh

# è·å–æœ¬æœº IP
IP=$(ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1 | awk '{print $2}' | head -1)

echo &quot;ğŸ“¡ ä»£ç†åœ°å€: $IP:8888&quot;
echo &quot; é…ç½®æ‰‹æœºä»£ç†åˆ°: $IP:8888&quot;
echo &quot; è¯ä¹¦ä¸‹è½½: http://burp (Burp) æˆ– http://mitm.it (mitmproxy)&quot;
echo &quot;&quot;

# å¯åŠ¨ mitmproxy
mitmweb -p 8888 --listen-host 0.0.0.0

</code></pre>
<pre><code class="language-batch">@echo off
REM start_proxy.bat

for /f &quot;tokens=2 delims=:&quot; %%a in ('ipconfig ^| findstr /c:&quot;IPv4&quot;') do set IP=%%a
echo ğŸ“¡ ä»£ç†åœ°å€: %IP%:8888
echo é…ç½®æ‰‹æœºä»£ç†åˆ°: %IP%:8888
pause

java -jar burpsuite_community.jar

</code></pre>
<pre><code class="language-bash"># ä¸‹è½½é€šç”¨ SSL Pinning ç»•è¿‡è„šæœ¬
curl -O https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/

# è¿è¡Œ
frida -U -f com.target.app -l universal-ssl-pinning.js --no-pause

</code></pre>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-4">
                                                <h2>4. R02: Crypto Analysis</h2>
                                                <h1>R02: Recipe: åˆ†æå¹¶æå– Android åº”ç”¨çš„åŠ å¯†å¯†é’¥</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p><em>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</em></p>
<ul>
<li>App çš„ API è¯·æ±‚å‚æ•°è¢«åŠ å¯†äº†ï¼Œçœ‹ä¸æ‡‚å†…å®¹</li>
<li>æƒ³çŸ¥é“ App ä½¿ç”¨äº†ä»€ä¹ˆåŠ å¯†ç®—æ³•</li>
<li>éœ€è¦æå–åŠ å¯†å¯†é’¥æ¥è§£å¯†æ•°æ®</li>
<li>æƒ³é‡ç° App çš„åŠ å¯†/ç­¾åé€»è¾‘ç”¨äºè‡ªåŠ¨åŒ–</li>
<li>éœ€è¦ç»•è¿‡åŠ å¯†éªŒè¯æˆ–ç­¾åæ£€æŸ¥</li>
</ul>
<p><em>æœ¬é…æ–¹æ•™ä½ </em>ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ã€å®šä½å¯†é’¥ä½ç½®ã€ä½¿ç”¨ Frida åŠ¨æ€æå–å¯†é’¥ã€‚</p>
<p><em>æ ¸å¿ƒç†å¿µ</em>ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>å¯†ç å­¦é€†å‘çš„å…³é”®ä¸æ˜¯ç ´è§£ç®—æ³•ï¼Œè€Œæ˜¯æ‰¾åˆ°å¯†é’¥</strong></p>
<ul>
<li>ä¸è¦è¯•å›¾&quot;ç ´è§£&quot; AES/RSA ç­‰æˆç†Ÿç®—æ³•ï¼ˆå‡ ä¹ä¸å¯èƒ½ï¼‰</li>
<li>ç”¨åŠ¨æ€åˆ†æç›´æ¥æå–å¯†é’¥</li>
<li>æˆ–ç›´æ¥è°ƒç”¨ App è‡ªå·±çš„åŠ å¯†å‡½æ•°ï¼ˆåˆ©ç”¨å·²æœ‰å¯†é’¥ï¼‰</li>
</ul>
</blockquote>
<p><em>é¢„è®¡ç”¨æ—¶</em>: 30-60 åˆ†é’Ÿ</p>
<hr />
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<ul>
<li><strong>jadx-gui</strong> - Java å±‚é™æ€åˆ†æ</li>
<li><strong>Frida</strong> - åŠ¨æ€ Hook æå–å¯†é’¥</li>
<li><strong>Android è®¾å¤‡</strong>ï¼ˆå·² Rootï¼‰</li>
</ul>
<h3>å¯é€‰å·¥å…·</h3>
<ul>
<li><strong>IDA Pro / Ghidra</strong> - Native å±‚åˆ†æ</li>
<li><strong>Burp Suite</strong> - æŠ“åŒ…æŸ¥çœ‹åŠ å¯†åçš„æ•°æ®</li>
<li><strong>CyberChef</strong> - åœ¨çº¿åŠ å¯†/è§£å¯†å·¥å…·ï¼ˆ<a href="https://gchq.github.io/CyberChef/%EF%BC%89">https://gchq.github.io/CyberChef/ï¼‰</a></li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h3>âœ… ç¡®è®¤æ¸…å•</h3>
<pre><code class="language-bash"># 1. Frida æ­£å¸¸è¿è¡Œ
frida-ps -U

# 2. jadx-gui å·²å®‰è£…
jadx-gui --version

# 3. æŠ“åŒ…ç¯å¢ƒå·²é…ç½®ï¼ˆå¯é€‰ï¼‰
# å‚è€ƒ: network_sniffing.md
</code></pre>
<hr />
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h3>ç¬¬ 1 æ­¥ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ï¼ˆ5 åˆ†é’Ÿï¼‰</h3>
<h4>1.1 æœç´¢ç‰¹å¾å­—ç¬¦ä¸²</h4>
<p>ç”¨ jadx-gui æ‰“å¼€ APKï¼Œå…¨å±€æœç´¢ï¼š</p>
<pre><code># å¯¹ç§°åŠ å¯†
AES
DES
3DES

# éå¯¹ç§°åŠ å¯†
RSA
ECC

# å“ˆå¸Œç®—æ³•
MD5
SHA
SHA256
HMAC

# åŠ å¯†æ¨¡å¼
ECB
CBC
CTR
GCM

# Padding
PKCS5Padding
PKCS7Padding

# ç¼–ç 
Base64
</code></pre>
<h4>1.2 æœç´¢ Java åŠ å¯† API</h4>
<pre><code class="language-java">// Java å±‚åŠ å¯† API
javax.crypto.Cipher
javax.crypto.spec.SecretKeySpec
javax.crypto.spec.IvParameterSpec
javax.crypto.Mac
java.security.Signature
java.security.MessageDigest

// Base64 ç¼–ç 
android.util.Base64
java.util.Base64
</code></pre>
<h4>1.3 æ£€æŸ¥ Native å±‚åŠ å¯†</h4>
<pre><code class="language-bash"># è§£å‹ APK
unzip app.apk -d app_unzipped

# æœç´¢ .so æ–‡ä»¶ä¸­çš„åŠ å¯†åº“
strings app_unzipped/lib/*/lib*.so | grep -i -E &quot;openssl|crypto|encrypt|aes|rsa&quot;

# æˆ–ä½¿ç”¨ rabin2 åˆ†æ
rabin2 -z app_unzipped/lib/arm64-v8a/libnative.so | grep -i encrypt
</code></pre>
<hr />
<h3>ç¬¬ 2 æ­¥ï¼šå®šä½åŠ å¯†ä»£ç ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<h4>2.1 è·Ÿè¸ªåŠ å¯†å­—ç¬¦ä¸²</h4>
<p>å‡è®¾ä½ æœåˆ°äº† <code>AES/CBC/PKCS5Padding</code>ï¼š</p>
<ol>
<li>åœ¨ jadx ä¸­ç‚¹å‡»è¿™ä¸ªå­—ç¬¦ä¸²</li>
<li>æŸ¥çœ‹äº¤å‰å¼•ç”¨ï¼ˆ<code>X</code> é”®æˆ–å³é”® â†’ Find Usageï¼‰</li>
<li>è·³è½¬åˆ°ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°</li>
</ol>
<p><strong>å…¸å‹ä»£ç æ¨¡å¼</strong>ï¼š</p>
<pre><code class="language-java">// ä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç 
public static String encrypt(String plaintext) {
    Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);
    SecretKeySpec key = new SecretKeySpec(KEY_BYTES, &quot;AES&quot;);
    IvParameterSpec iv = new IvParameterSpec(IV_BYTES);
    cipher.init(Cipher.ENCRYPT_MODE, key, iv);
    byte[] encrypted = cipher.doFinal(plaintext.getBytes());
    return Base64.encodeToString(encrypted, Base64.DEFAULT);
}
</code></pre>
<p><strong>è®°å½•å…³é”®ä¿¡æ¯</strong>ï¼š</p>
<pre><code>å¯†é’¥å˜é‡: KEY_BYTES
IV å˜é‡: IV_BYTES
åŠ å¯†å‡½æ•°: com.example.app.CryptoUtils.encrypt()
</code></pre>
<hr />
<h3>ç¬¬ 3 æ­¥ï¼šæ‰¾åˆ°å¯†é’¥ä½ç½®ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<details>
<summary><b>ğŸ“ ä½ç½® 1: Java ä»£ç ç¡¬ç¼–ç ï¼ˆéš¾åº¦ï¼šä½ï¼‰</b></summary>

<p><strong>æŸ¥æ‰¾æ–¹æ³•</strong>ï¼š</p>
<pre><code class="language-java">// æœç´¢å…³é”®è¯
SecretKeySpec
byte[] key
private static final byte[]
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-java">private static final byte[] KEY = {
    0x12, 0x34, 0x56, 0x78,
    0x9a, 0xbc, 0xde, 0xf0,
    // ... 16/24/32 å­—èŠ‚
};
</code></pre>
<p><strong>å¯†é’¥é•¿åº¦</strong>ï¼š</p>
<ul>
<li>AES-128: 16 å­—èŠ‚</li>
<li>AES-192: 24 å­—èŠ‚</li>
<li>AES-256: 32 å­—èŠ‚</li>
</ul>
</details>

<details>
<summary><b>ğŸ“ ä½ç½® 2: èµ„æºæ–‡ä»¶ï¼ˆéš¾åº¦ï¼šä½ï¼‰</b></summary>

<p><strong>æŸ¥æ‰¾è·¯å¾„</strong>ï¼š</p>
<pre><code class="language-bash"># æ£€æŸ¥ assets ç›®å½•
ls app_unzipped/assets/

# æ£€æŸ¥ res/raw
ls app_unzipped/res/raw/

# æœç´¢äºŒè¿›åˆ¶æ–‡ä»¶
find app_unzipped -type f -exec file {} \; | grep data
</code></pre>
<p><strong>å¸¸è§æ–‡ä»¶å</strong>ï¼š</p>
<ul>
<li><code>secret.key</code></li>
<li><code>config.dat</code></li>
<li><code>license.bin</code></li>
</ul>
</details>

<details>
<summary><b>ğŸ“ ä½ç½® 3: Native (.so) ç¡¬ç¼–ç ï¼ˆéš¾åº¦ï¼šä¸­ï¼‰</b></summary>

<p><strong>IDA Pro åˆ†æ</strong>ï¼š</p>
<ol>
<li>æ‰“å¼€ <code>.so</code> æ–‡ä»¶</li>
<li>è·³è½¬åˆ° <strong>Strings</strong> çª—å£ (<code>Shift+F12</code>)</li>
<li>æœç´¢å…³é”®å­—ç¬¦ä¸²</li>
<li>æŸ¥çœ‹äº¤å‰å¼•ç”¨æ‰¾åˆ°ä½¿ç”¨å¯†é’¥çš„å‡½æ•°</li>
</ol>
<p><strong>Ghidra åˆ†æ</strong>ï¼š</p>
<ol>
<li>å¯¼å…¥ <code>.so</code> æ–‡ä»¶</li>
<li>æœç´¢ â†’ For Strings</li>
<li>ç­›é€‰é•¿åº¦ä¸º 16/24/32 çš„å¯ç–‘å­—ç¬¦ä¸²</li>
</ol>
</details>

<details>
<summary><b>ğŸ“ ä½ç½® 4: åŠ¨æ€ç”Ÿæˆï¼ˆéš¾åº¦ï¼šé«˜ï¼‰</b></summary>

<p><strong>ç‰¹å¾</strong>ï¼šå¯†é’¥é€šè¿‡ç®—æ³•è®¡ç®—ï¼Œå¸¸è§æ–¹å¼ï¼š</p>
<pre><code class="language-java">// åŸºäºè®¾å¤‡ä¿¡æ¯ç”Ÿæˆ
String deviceId = getDeviceId();
byte[] key = MD5(deviceId + SALT);

// åŸºäºæ—¶é—´æˆ³
long timestamp = System.currentTimeMillis();
byte[] key = HMACSHA256(timestamp, SECRET);
</code></pre>
<p><strong>ä»æœåŠ¡å™¨è·å–</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨æ—¶ä»æœåŠ¡å™¨è·å–å¯†é’¥</li>
<li>å¯èƒ½ç»è¿‡ RSA åŠ å¯†ä¼ è¾“</li>
</ul>
<p><strong>å¯¹ç­–</strong>ï¼š</p>
<ol>
<li>æŠ“åŒ…æŸ¥çœ‹å¯†é’¥ä¼ è¾“</li>
<li>Hook ç½‘ç»œè¯·æ±‚è·å–å¯†é’¥</li>
<li>æˆ–ç›´æ¥ Hook åŠ å¯†å‡½æ•°ï¼ˆå¯†é’¥å·²åœ¨å†…å­˜ä¸­ï¼‰</li>
</ol>
</details>

<hr />
<h3>ç¬¬ 4 æ­¥ï¼šåŠ¨æ€æå–å¯†é’¥ï¼ˆ15 åˆ†é’Ÿï¼‰</h3>
<p><em>ç»ˆææ–¹æ³•</em>ï¼šæ— è®ºå¯†é’¥è—åœ¨å“ªï¼Œåªè¦åŠ å¯†å‡½æ•°è¢«è°ƒç”¨ï¼ŒHook å°±èƒ½æŠ“åˆ°</p>
<h4>4.1 Hook Java å±‚åŠ å¯†</h4>
<p><strong>é€šç”¨ AES Hook è„šæœ¬</strong> <code>dump_aes_key.js</code>ï¼š</p>
<pre><code class="language-javascript">Java.perform(function () {
  console.log(&quot;\n[Crypto Hook] å¯åŠ¨\n&quot;);

  // Hook Cipher.init
  var Cipher = Java.use(&quot;javax.crypto.Cipher&quot;);
  Cipher.init.overload(
    &quot;int&quot;,
    &quot;java.security.Key&quot;,
    &quot;java.security.spec.AlgorithmParameterSpec&quot;
  ).implementation = function (opmode, key, spec) {
    console.log(&quot;\nğŸ” [Cipher.init] æ•è·!&quot;);

    // æ¨¡å¼
    var mode = opmode == 1 ? &quot;ENCRYPT&quot; : &quot;DECRYPT&quot;;
    console.log(&quot;    æ¨¡å¼: &quot; + mode);

    // ç®—æ³•
    console.log(&quot;    ç®—æ³•: &quot; + this.getAlgorithm());

    // æå–å¯†é’¥
    try {
      var secretKey = Java.cast(
        key,
        Java.use(&quot;javax.crypto.spec.SecretKeySpec&quot;)
      );
      var keyBytes = secretKey.getEncoded();
      var Base64 = Java.use(&quot;android.util.Base64&quot;);
      console.log(&quot;    å¯†é’¥ (Base64): &quot; + Base64.encodeToString(keyBytes, 0));
      console.log(&quot;    å¯†é’¥ (Hex): &quot; + bytesToHex(keyBytes));
    } catch (e) {
      console.log(&quot;    å¯†é’¥ç±»å‹: &quot; + key.$className);
    }

    // æå– IV
    if (spec) {
      try {
        var ivSpec = Java.cast(
          spec,
          Java.use(&quot;javax.crypto.spec.IvParameterSpec&quot;)
        );
        var ivBytes = ivSpec.getIV();
        console.log(&quot;    IV (Hex): &quot; + bytesToHex(ivBytes));
      } catch (e) {}
    }

    return this.init(opmode, key, spec);
  };

  // Hook Cipher.doFinal
  Cipher.doFinal.overload(&quot;[B&quot;).implementation = function (input) {
    var result = this.doFinal(input);

    console.log(&quot;\nğŸ“¦ [Cipher.doFinal] æ•è·!&quot;);
    console.log(&quot;    è¾“å…¥é•¿åº¦: &quot; + input.length);
    console.log(&quot;    è¾“å‡ºé•¿åº¦: &quot; + result.length);
    console.log(&quot;    è¾“å…¥æ•°æ® (å‰32å­—èŠ‚): &quot; + bytesToHex(input.slice(0, 32)));
    console.log(&quot;    è¾“å‡ºæ•°æ® (å‰32å­—èŠ‚): &quot; + bytesToHex(result.slice(0, 32)));

    return result;
  };

  function bytesToHex(bytes) {
    var hex = [];
    for (var i = 0; i &lt; bytes.length &amp;&amp; i &lt; 32; i++) {
      hex.push((&quot;0&quot; + (bytes[i] &amp; 0xff).toString(16)).slice(-2));
    }
    return hex.join(&quot; &quot;);
  }

  console.log(&quot;âœ… [Crypto Hook] é…ç½®å®Œæˆ\n&quot;);
});
</code></pre>
<p><strong>è¿è¡Œè„šæœ¬</strong>ï¼š</p>
<pre><code class="language-bash">frida -U -f com.example.app -l dump_aes_key.js
</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p>
<pre><code>ğŸ” [Cipher.init] æ•è·!
    æ¨¡å¼: ENCRYPT
    ç®—æ³•: AES/CBC/PKCS5Padding
    å¯†é’¥ (Base64): MTIzNDU2Nzg5MGFiY2RlZg==
    å¯†é’¥ (Hex): 31 32 33 34 35 36 37 38 39 30 61 62 63 64 65 66
    IV (Hex): 66 65 64 63 62 61 30 39 38 37 36 35 34 33 32 31

ğŸ“¦ [Cipher.doFinal] æ•è·!
    è¾“å…¥é•¿åº¦: 128
    è¾“å‡ºé•¿åº¦: 144
    è¾“å…¥æ•°æ® (å‰32å­—èŠ‚): 7b 22 75 73 65 72 6e 61 6d 65 22 3a ...
    è¾“å‡ºæ•°æ® (å‰32å­—èŠ‚): a3 b2 c1 d0 e4 f5 ...
</code></pre>
<h4>4.2 Hook Native å±‚åŠ å¯†</h4>
<p><strong>æŸ¥æ‰¾ Native åŠ å¯†å‡½æ•°</strong>ï¼š</p>
<pre><code class="language-bash"># ä½¿ç”¨ nm æŸ¥çœ‹å‡½æ•°
nm -D libnative.so | grep -i encrypt

# ä½¿ç”¨ Frida
frida -U -f com.example.app
&gt; Module.enumerateExports('libnative.so').filter(e =&gt; e.name.includes('encrypt'))
</code></pre>
<p><strong>Hook Native å‡½æ•°</strong>ï¼š</p>
<pre><code class="language-javascript">Interceptor.attach(
  Module.findExportByName(&quot;libnative.so&quot;, &quot;Java_com_example_Crypto_encrypt&quot;),
  {
    onEnter: function (args) {
      console.log(&quot;\n[Native Encrypt] è°ƒç”¨!&quot;);

      // args[0] = JNIEnv*
      // args[1] = jclass
      // args[2] = ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆé€šå¸¸æ˜¯æ˜æ–‡ï¼‰
      // args[3] = ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯èƒ½æ˜¯å¯†é’¥ï¼‰

      // è¯»å–å­—ç¬¦ä¸²å‚æ•°
      var plaintext = Java.vm
        .getEnv()
        .getStringUtfChars(args[2], null)
        .readCString();
      console.log(&quot;    æ˜æ–‡: &quot; + plaintext);

      // ä¿å­˜æŒ‡é’ˆç”¨äºåç»­è¯»å–
      this.keyPtr = args[3];
    },
    onLeave: function (retval) {
      // retval æ˜¯è¿”å›å€¼ï¼ˆå¯†æ–‡ï¼‰
      console.log(&quot;    è¿”å›å€¼: &quot; + retval);
    },
  }
);
</code></pre>
<hr />
<h3>ç¬¬ 5 æ­¥ï¼šéªŒè¯å¯†é’¥ï¼ˆ5 åˆ†é’Ÿï¼‰</h3>
<h4>5.1 ä½¿ç”¨ CyberChef éªŒè¯</h4>
<ol>
<li>æ‰“å¼€ <a href="https://gchq.github.io/CyberChef/">https://gchq.github.io/CyberChef/</a></li>
<li>é€‰æ‹©æ“ä½œï¼š<code>AES Decrypt</code></li>
<li>è¾“å…¥ï¼š</li>
</ol>
<pre><code class="language-text">| é¡¹ç›® | è¯´æ˜ |
| --- | --- |
| **Key** (Hex) | `31 32 33 34 ...` |
| **IV** (Hex) | `66 65 64 63 ...` |
| **Mode** | `CBC` |
| **Input** | å¯†æ–‡ï¼ˆBase64 æˆ– Hexï¼‰ |
</code></pre>
<ol start="4">
<li>ç‚¹å‡» <strong>Bake!</strong></li>
</ol>
<p>å¦‚æœè§£å¯†æˆåŠŸï¼Œè¯´æ˜å¯†é’¥æ­£ç¡®ï¼</p>
<h4>5.2 Python è„šæœ¬éªŒè¯</h4>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import base64

# ä» Frida è·å–çš„å¯†é’¥å’Œ IVï¼ˆHex è½¬ bytesï¼‰
key = bytes.fromhex('31323334353637383930616263646566')
iv = bytes.fromhex('66656463626130393837363534333231')

# ä»æŠ“åŒ…è·å–çš„å¯†æ–‡
ciphertext = base64.b64decode('YWJjZGVmZ2hpamtsbW5vcA==')

# è§£å¯†
cipher = AES.new(key, AES.MODE_CBC, iv)
plaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)

print(&quot;è§£å¯†ç»“æœ:&quot;, plaintext.decode())
</code></pre>
<h4>5.3 ç›´æ¥è°ƒç”¨ App çš„åŠ å¯†å‡½æ•°</h4>
<pre><code class="language-javascript">Java.perform(function () {
  var CryptoUtils = Java.use(&quot;com.example.app.CryptoUtils&quot;);

  // è°ƒç”¨åŠ å¯†å‡½æ•°
  var encrypted = CryptoUtils.encrypt(&quot;Hello World&quot;);
  console.log(&quot;åŠ å¯†ç»“æœ: &quot; + encrypted);

  // è°ƒç”¨è§£å¯†å‡½æ•°
  var decrypted = CryptoUtils.decrypt(encrypted);
  console.log(&quot;è§£å¯†ç»“æœ: &quot; + decrypted);
});
</code></pre>
<hr />
<h2>å·¥ä½œåŸç†</h2>
<h3>å¸¸è§åŠ å¯†ç®—æ³•å¯¹ç…§è¡¨</h3>
<table>
<thead>
<tr>
  <th>ç®—æ³•ç±»å‹</th>
  <th>ç®—æ³•</th>
  <th>å¯†é’¥é•¿åº¦</th>
  <th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å¯¹ç§°åŠ å¯†</strong></td>
  <td>AES</td>
  <td>128/192/256 bit</td>
  <td>åŠ å¯†æ•°æ®</td>
</tr>
<tr>
  <td></td>
  <td>DES</td>
  <td>56 bit</td>
  <td>æ—§æ ‡å‡†ï¼ˆä¸å®‰å…¨ï¼‰</td>
</tr>
<tr>
  <td></td>
  <td>3DES</td>
  <td>168 bit</td>
  <td>DES å¢å¼ºç‰ˆ</td>
</tr>
<tr>
  <td><strong>éå¯¹ç§°åŠ å¯†</strong></td>
  <td>RSA</td>
  <td>1024/2048/4096 bit</td>
  <td>å¯†é’¥äº¤æ¢ã€ç­¾å</td>
</tr>
<tr>
  <td></td>
  <td>ECC</td>
  <td>256/384/521 bit</td>
  <td>RSA çš„é«˜æ•ˆæ›¿ä»£</td>
</tr>
<tr>
  <td><strong>å“ˆå¸Œ</strong></td>
  <td>MD5</td>
  <td>128 bit è¾“å‡º</td>
  <td>æ ¡éªŒï¼ˆä¸å®‰å…¨ï¼‰</td>
</tr>
<tr>
  <td></td>
  <td>SHA-256</td>
  <td>256 bit è¾“å‡º</td>
  <td>å®‰å…¨å“ˆå¸Œ</td>
</tr>
<tr>
  <td></td>
  <td>HMAC</td>
  <td>å¯å˜</td>
  <td>å¸¦å¯†é’¥çš„å“ˆå¸Œ</td>
</tr>
</tbody>
</table>
<h3>AES åŠ å¯†æµç¨‹</h3>
<pre><code>æ˜æ–‡æ•°æ®
    â†“
[AES Encrypt] â† ä½¿ç”¨å¯†é’¥ + IV
    â†“
å¯†æ–‡æ•°æ®
    â†“
[Base64 Encode] â† ä¾¿äºä¼ è¾“
    â†“
æœ€ç»ˆå¯†æ–‡
</code></pre>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>âŒ é—®é¢˜ 1: Hook è„šæœ¬ä¸ç”Ÿæ•ˆ</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šè¿è¡Œ Frida è„šæœ¬åæ²¡æœ‰ä»»ä½•è¾“å‡º</p>
<p><strong>æ£€æŸ¥</strong>ï¼š</p>
<ol>
<li><strong>ç¡®è®¤åŠ å¯†å‡½æ•°è¢«è°ƒç”¨äº†å—ï¼Ÿ</strong></li>
</ol>
<pre><code class="language-javascript">Java.use(&quot;javax.crypto.Cipher&quot;).$init.overload().implementation = function () {
  console.log(&quot;[TEST] Cipher å®ä¾‹åŒ–&quot;);
  return this.$init();
};
</code></pre>
<ol start="2">
<li><p><strong>åŠ å¯†æ˜¯å¦åœ¨ Native å±‚ï¼Ÿ</strong></p>
<ul>
<li>æ”¹ç”¨ Native Hook</li>
</ul>
</li>
<li><p><strong>ç±»åå¯èƒ½è¢«æ··æ·†</strong></p>
<ul>
<li>æœç´¢æ‰€æœ‰åŒ…å« <code>Cipher</code> çš„ç±»ï¼š</li>
</ul>
</li>
</ol>
<pre><code class="language-javascript">Java.enumerateLoadedClasses({
  onMatch: function (className) {
    if (className.toLowerCase().includes(&quot;cipher&quot;)) {
      console.log(className);
    }
  },
  onComplete: function () {},
});
</code></pre>
<h3>âŒ é—®é¢˜ 2: è§£å¯†å¤±è´¥</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li><p><strong>IV ä¸æ­£ç¡®</strong></p>
<ul>
<li>ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† IV</li>
<li>æŸäº›å®ç°ä¼šå°† IV é™„åŠ åœ¨å¯†æ–‡å¼€å¤´</li>
</ul>
</li>
<li><p><strong>Padding ä¸åŒ¹é…</strong></p>
<ul>
<li>å°è¯•ä¸åŒçš„ Paddingï¼š<code>PKCS5Padding</code>, <code>PKCS7Padding</code>, <code>NoPadding</code></li>
</ul>
</li>
<li><p><strong>ç¼–ç é—®é¢˜</strong></p>
</li>
</ol>
<pre><code class="language-python"># å°è¯•ä¸åŒç¼–ç 
ciphertext = base64.b64decode(data)  # Base64
ciphertext = bytes.fromhex(data)     # Hex
ciphertext = data.encode()           # UTF-8
</code></pre>
<ol start="4">
<li><strong>å¯†é’¥æ´¾ç”Ÿ</strong><ul>
<li>å¯èƒ½ä½¿ç”¨äº† PBKDF2 ç­‰å¯†é’¥æ´¾ç”Ÿå‡½æ•°</li>
<li>Hook <code>SecretKeyFactory.generateSecret()</code> æŸ¥çœ‹</li>
</ul>
</li>
</ol>
<h3>âŒ é—®é¢˜ 3: Native å‡½æ•°æ‰¾ä¸åˆ°</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼š<code>Module.findExportByName()</code> è¿”å› <code>null</code></p>
<p><strong>è§£å†³</strong>ï¼š</p>
<ol>
<li><strong>å‡½æ•°å¯èƒ½æœªå¯¼å‡º</strong></li>
</ol>
<pre><code class="language-bash"># æŸ¥çœ‹æ‰€æœ‰ç¬¦å·ï¼ˆåŒ…æ‹¬æœªå¯¼å‡ºï¼‰
readelf -s libnative.so | grep encrypt
</code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨åœ°å€åç§» Hook</strong></li>
</ol>
<pre><code class="language-javascript">var baseAddr = Module.findBaseAddress('libnative.so');
var funcAddr = baseAddr.add(0x1234);  // ä» IDA è·å–åç§»
Interceptor.attach(funcAddr, { ... });
</code></pre>
<ol start="3">
<li><strong>åŠ¨æ€æ³¨å†Œçš„ JNI æ–¹æ³•</strong></li>
</ol>
<pre><code class="language-javascript">// Hook RegisterNatives
var RegisterNatives = Module.findExportByName(
  &quot;libart.so&quot;,
  &quot;_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi&quot;
);
Interceptor.attach(RegisterNatives, {
  onEnter: function (args) {
    var methods = ptr(args[2]);
    console.log(&quot;Register JNI Method:&quot;, methods.readCString());
  },
});
</code></pre>
<h3>âŒ é—®é¢˜ 4: å¯†é’¥æ˜¯å­—ç¬¦ä¸²è€Œéå­—èŠ‚æ•°ç»„</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼š</p>
<pre><code class="language-java">// çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç 
SecretKeySpec key = new SecretKeySpec(&quot;MyPassword123&quot;.getBytes(), &quot;AES&quot;);
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p><strong>1. ä½¿ç”¨å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆKDFï¼‰</strong></p>
<pre><code class="language-python">from Crypto.Protocol.KDF import PBKDF2

password = &quot;MyPassword123&quot;
salt = b&quot;somesalt&quot;  # éœ€è¦ä»ä»£ç ä¸­æ‰¾åˆ°
key = PBKDF2(password, salt, dkLen=16)  # 16 å­—èŠ‚ AES-128
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>PBKDF2</code> ä¼šå°†ä»»æ„é•¿åº¦çš„å¯†ç æ´¾ç”Ÿä¸ºå›ºå®šé•¿åº¦çš„å¯†é’¥</li>
<li><code>salt</code> é€šå¸¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æˆ–ä»æœåŠ¡å™¨è·å–</li>
<li><code>dkLen</code> å†³å®šè¾“å‡ºå¯†é’¥é•¿åº¦ï¼š16 (AES-128) / 24 (AES-192) / 32 (AES-256)</li>
</ul>
<p><strong>2. Hook å¯†é’¥æ´¾ç”Ÿå‡½æ•°</strong></p>
<pre><code class="language-javascript">var SecretKeyFactory = Java.use(&quot;javax.crypto.SecretKeyFactory&quot;);
SecretKeyFactory.generateSecret.implementation = function (keySpec) {
  var key = this.generateSecret(keySpec);
  console.log(&quot;[å¯†é’¥æ´¾ç”Ÿ] ç®—æ³•:&quot;, this.getAlgorithm());
  console.log(&quot;[å¯†é’¥æ´¾ç”Ÿ] å¯†é’¥ (Hex):&quot;, bytesToHex(key.getEncoded()));

  // å°è¯•è·å– saltï¼ˆå¦‚æœæ˜¯ PBEKeySpecï¼‰
  try {
    var PBEKeySpec = Java.use(&quot;javax.crypto.spec.PBEKeySpec&quot;);
    var pbeSpec = Java.cast(keySpec, PBEKeySpec);
    console.log(&quot;[å¯†é’¥æ´¾ç”Ÿ] Salt:&quot;, bytesToHex(pbeSpec.getSalt()));
    console.log(&quot;[å¯†é’¥æ´¾ç”Ÿ] è¿­ä»£æ¬¡æ•°:&quot;, pbeSpec.getIterationCount());
  } catch (e) {}

  return key;
};
</code></pre>
<p><strong>3. ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²å¯†é’¥</strong></p>
<pre><code class="language-python">from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import hashlib

# ä»ä»£ç ä¸­æ‰¾åˆ°çš„å­—ç¬¦ä¸²å¯†ç 
password = &quot;MyPassword123&quot;

# æ–¹æ³• 1: ç›´æ¥ä½¿ç”¨å‰ 16 å­—èŠ‚
key = password.encode()[:16].ljust(16, b'\0')

# æ–¹æ³• 2: MD5 å“ˆå¸Œï¼ˆå¸¸è§åšæ³•ï¼Œè¾“å‡ºæ­£å¥½ 16 å­—èŠ‚ï¼‰
key = hashlib.md5(password.encode()).digest()

# æ–¹æ³• 3: SHA256 å‰ 16 å­—èŠ‚
key = hashlib.sha256(password.encode()).digest()[:16]

# ç„¶åç”¨äºè§£å¯†
cipher = AES.new(key, AES.MODE_CBC, iv)
plaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)
</code></pre>
<hr />
<h2>å»¶ä¼¸é˜…è¯»</h2>
<h3>ç›¸å…³é…æ–¹</h3>
<ul>
<li><strong><a href="#section-3">ç½‘ç»œæŠ“åŒ…</a></strong> - è·å–åŠ å¯†åçš„æ•°æ®æ ·æœ¬</li>
<li><strong><a href="#section-8">Frida åè°ƒè¯•</a></strong> - å¦‚æœ App æ£€æµ‹åˆ° Hook</li>
<li><strong><a href="#section-37">Native Hook æ¨¡å¼</a></strong> - æ·±å…¥ Native å±‚åˆ†æ</li>
</ul>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><strong><a href="#section-40">Frida å®Œæ•´æŒ‡å—</a></strong></li>
<li><strong><a href="#section-47">IDA Pro ä½¿ç”¨</a></strong></li>
</ul>
<h3>æ¡ˆä¾‹åˆ†æ</h3>
<ul>
<li><strong><a href="#section-51">éŸ³ä¹ App åˆ†æ</a></strong> - åŠ å¯†éŸ³é¢‘æ ¼å¼åˆ†æ</li>
<li><strong><a href="#section-52">ç¤¾äº¤åª’ä½“é£æ§</a></strong> - API ç­¾åç®—æ³•é€†å‘</li>
</ul>
<h3>ç†è®ºåŸºç¡€</h3>
<ul>
<li><strong><a href="../../04-Reference/Foundations/">å¯†ç å­¦åŸºç¡€çŸ¥è¯†</a></strong> - TODO</li>
</ul>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>Hook è„šæœ¬æ¨¡æ¿åº“</h3>
<h4>1. RSA Hook</h4>
<pre><code class="language-javascript">var Cipher = Java.use(&quot;javax.crypto.Cipher&quot;);
Cipher.init.overload(&quot;int&quot;, &quot;java.security.Key&quot;).implementation = function (
  opmode,
  key
) {
  console.log(&quot;[RSA] æ¨¡å¼:&quot;, opmode == 1 ? &quot;ENCRYPT&quot; : &quot;DECRYPT&quot;);
  console.log(&quot;[RSA] å¯†é’¥ç±»å‹:&quot;, key.$className);

  // è·å–å…¬é’¥/ç§é’¥
  if (key.$className.includes(&quot;PublicKey&quot;)) {
    console.log(&quot;[RSA] å…¬é’¥:&quot;, bytesToHex(key.getEncoded()));
  } else if (key.$className.includes(&quot;PrivateKey&quot;)) {
    console.log(&quot;[RSA] ç§é’¥:&quot;, bytesToHex(key.getEncoded()));
  }

  return this.init(opmode, key);
};
</code></pre>
<h4>2. HMAC Hook</h4>
<pre><code class="language-javascript">var Mac = Java.use(&quot;javax.crypto.Mac&quot;);
Mac.init.implementation = function (key) {
  console.log(&quot;[HMAC] ç®—æ³•:&quot;, this.getAlgorithm());

  var secretKey = Java.cast(key, Java.use(&quot;javax.crypto.spec.SecretKeySpec&quot;));
  console.log(&quot;[HMAC] å¯†é’¥:&quot;, bytesToHex(secretKey.getEncoded()));

  return this.init(key);
};

Mac.doFinal.overload(&quot;[B&quot;).implementation = function (data) {
  var result = this.doFinal(data);
  console.log(&quot;[HMAC] è¾“å…¥:&quot;, bytesToHex(data));
  console.log(&quot;[HMAC] è¾“å‡º:&quot;, bytesToHex(result));
  return result;
};
</code></pre>
<h4>3. Base64 Hook</h4>
<pre><code class="language-javascript">var Base64 = Java.use(&quot;android.util.Base64&quot;);
Base64.decode.overload(&quot;java.lang.String&quot;, &quot;int&quot;).implementation = function (
  str,
  flags
) {
  var result = this.decode(str, flags);
  console.log(&quot;[Base64] è§£ç :&quot;);
  console.log(&quot;    è¾“å…¥:&quot;, str.substring(0, 50) + &quot;...&quot;);
  console.log(&quot;    è¾“å‡º (Hex):&quot;, bytesToHex(result));
  return result;
};
</code></pre>
<h3>OpenSSL å‘½ä»¤é€ŸæŸ¥</h3>
<pre><code class="language-bash"># AES åŠ å¯†
echo &quot;Hello&quot; | openssl enc -aes-128-cbc -K 31323334353637383930616263646566 -iv 66656463626130393837363534333231 -base64

# AES è§£å¯†
echo &quot;å¯†æ–‡&quot; | base64 -d | openssl enc -d -aes-128-cbc -K 31323334353637383930616263646566 -iv 66656463626130393837363534333231

# ç”Ÿæˆ MD5
echo -n &quot;text&quot; | openssl md5

# ç”Ÿæˆ SHA256
echo -n &quot;text&quot; | openssl sha256

# RSA å¯†é’¥ç”Ÿæˆ
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -pubout -out public.pem
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-5">
                                                <h2>5. R03: TLS Fingerprinting</h2>
                                                <h1>R03: Recipe: ä½¿ç”¨ TLS æŒ‡çº¹è¯†åˆ«æ£€æµ‹å’Œç»•è¿‡åº”ç”¨æŒ‡çº¹</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p><em>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</em></p>
<ul>
<li>ä½ çš„è‡ªåŠ¨åŒ–è„šæœ¬è¢«æœåŠ¡å™¨è¯†åˆ«å¹¶å°ç¦äº†</li>
<li>ä½ ç”¨ Python/curl è¯·æ±‚ APIï¼Œä½†æœåŠ¡å™¨è¿”å› 403/é£æ§æ‹¦æˆª</li>
<li>ä½ æƒ³ä¼ªè£…æˆçœŸå®æµè§ˆå™¨/å®˜æ–¹ App çš„ TLS æŒ‡çº¹</li>
<li>ä½ æƒ³åˆ†æ App ä½¿ç”¨çš„ TLS åº“å’Œé…ç½®</li>
<li>ä½ æƒ³æ£€æµ‹è‡ªå·±çš„è¯·æ±‚æ˜¯å¦æš´éœ²äº†å¼‚å¸¸çš„ TLS ç‰¹å¾</li>
</ul>
<p><em>æœ¬é…æ–¹æ•™ä½ </em>ï¼šç†è§£ TLS æŒ‡çº¹è¯†åˆ«åŸç†ã€å¦‚ä½•æ£€æµ‹è‡ªå·±çš„ TLS æŒ‡çº¹ã€ä»¥åŠå¦‚ä½•ä¼ªé€ åˆæ³•çš„ TLS æŒ‡çº¹ã€‚</p>
<p><em>æ ¸å¿ƒç†å¿µ</em>ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>TLS æŒ‡çº¹æ˜¯åº”ç”¨çš„&quot;DNA&quot;</strong></p>
<ul>
<li>TLS æ¡æ‰‹é˜¶æ®µæš´éœ²äº†å®¢æˆ·ç«¯ä½¿ç”¨çš„åº“å’Œé…ç½®</li>
<li>ä¸åŒçš„ HTTP å®¢æˆ·ç«¯æœ‰ä¸åŒçš„ TLS æŒ‡çº¹</li>
<li>æœåŠ¡å™¨å¯ä»¥é€šè¿‡ JA3/JA4 æŒ‡çº¹è¯†åˆ«ä½ çš„çœŸå®èº«ä»½</li>
<li>å³ä½¿ä½¿ç”¨ HTTPSï¼ŒTLS æ¡æ‰‹ç‰¹å¾ä¹Ÿæ˜¯æ˜æ–‡çš„</li>
</ul>
</blockquote>
<p><em>é¢„è®¡ç”¨æ—¶</em>: 20-40 åˆ†é’Ÿ</p>
<hr />
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<ul>
<li><ul>
<li><strong>Wireshark</strong> - æŠ“å– TLS æ¡æ‰‹åŒ…</li>
</ul>
</li>
<li><ul>
<li><strong>åœ¨çº¿ JA3 æ£€æµ‹å·¥å…·</strong> - https://ja3er.com æˆ– https://tls.peet.ws</li>
</ul>
</li>
<li><ul>
<li><strong>Python 3.7+</strong> - ç”¨äºè„šæœ¬æµ‹è¯•</li>
</ul>
</li>
</ul>
<h3>å¯é€‰å·¥å…·</h3>
<ul>
<li><ul>
<li><strong>curl-impersonate</strong> - ä¼ªè£…æµè§ˆå™¨ TLS æŒ‡çº¹çš„ curl</li>
</ul>
</li>
<li><ul>
<li><strong>tls-client</strong> (Python) - æ”¯æŒè‡ªå®šä¹‰ TLS æŒ‡çº¹çš„ HTTP åº“</li>
</ul>
</li>
<li><ul>
<li><strong>Burp Suite</strong> - æŠ“åŒ…åˆ†æ</li>
</ul>
</li>
<li><ul>
<li><strong>ja3transport</strong> (Go) - Go è¯­è¨€çš„ TLS ä¼ªè£…åº“</li>
</ul>
</li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h3>âœ… ç¡®è®¤æ¸…å•</h3>
<ol>
<li><strong>Wireshark å·²å®‰è£…å¹¶å¯ç”¨</strong></li>
<li><strong>Python 3.7+ ç¯å¢ƒé…ç½®å®Œæˆ</strong></li>
</ol>
<pre><code class="language-bash"># éªŒè¯ Wireshark å®‰è£…
wireshark --version

# éªŒè¯ Python ç¯å¢ƒ
python3 --version

# å®‰è£…å¿…è¦çš„ Python åº“
pip3 install requests pycurl tls-client

</code></pre>
<hr />
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h3>ç¬¬ 1 æ­¥ï¼šç†è§£ TLS æŒ‡çº¹è¯†åˆ«åŸç†ï¼ˆ5 åˆ†é’Ÿï¼‰</h3>
<h4>1.1 ä»€ä¹ˆæ˜¯ JA3 æŒ‡çº¹ï¼Ÿ</h4>
<p><em>JA3</em> æ˜¯ä¸€ç§é€šè¿‡åˆ†æ TLS <code>Client Hello</code> åŒ…ç”ŸæˆæŒ‡çº¹çš„æŠ€æœ¯ã€‚</p>
<p><em>æå–çš„å­—æ®µ</em>ï¼š</p>
<ol>
<li>TLS ç‰ˆæœ¬ï¼ˆå¦‚ TLS 1.3 = 771ï¼‰</li>
<li>åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ˆCipher Suitesï¼‰</li>
<li>æ‰©å±•åˆ—è¡¨ï¼ˆExtensionsï¼‰</li>
<li>æ¤­åœ†æ›²çº¿åˆ—è¡¨ï¼ˆElliptic Curvesï¼‰</li>
<li>æ¤­åœ†æ›²çº¿ç‚¹æ ¼å¼ï¼ˆEC Point Formatsï¼‰</li>
</ol>
<p><em>ç”Ÿæˆè¿‡ç¨‹</em>ï¼š</p>
<pre><code>æ‹¼æ¥æˆString: &quot;771,4865-4866-4867,0-23-65281,29-23-24,0&quot;
â†“
Calculate MD5 å“ˆå¸Œ
â†“
JA3 æŒ‡çº¹: e7d705a3286e19ea42f587b344ee6865

</code></pre>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>MD5 æŒ‡çº¹</th>
  <th>JA3 æŒ‡çº¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ ¼å¼</strong></td>
  <td>MD5 å“ˆå¸Œ</td>
  <td>ç»“æ„åŒ–å­—ç¬¦ä¸²</td>
</tr>
<tr>
  <td><strong>å¯è¯»æ€§</strong></td>
  <td>æ— </td>
  <td>é«˜ï¼ˆåŒ…å«ç‰ˆæœ¬ã€è®¡æ•°ç­‰ï¼‰</td>
</tr>
<tr>
  <td><strong>ç¤ºä¾‹</strong></td>
  <td><code>e7d705a3286e19ea42f587b344ee6865</code></td>
  <td><code>t13d1516h2_174735a34e8a_b2149a751699</code></td>
</tr>
<tr>
  <td><strong>ä¼˜åŠ¿</strong></td>
  <td>ç®€å•ï¼Œå¹¿æ³›æ”¯æŒ</td>
  <td>å¯æ¨¡ç³ŠåŒ¹é…ï¼ŒæŠ—å¹²æ‰°</td>
</tr>
</tbody>
</table>
<p>âœ… <strong>å…³é”®ç‚¹</strong>ï¼šä¸åŒçš„ HTTP åº“æœ‰ä¸åŒçš„ JA3 æŒ‡çº¹</p>
<table>
<thead>
<tr>
  <th>å®¢æˆ·ç«¯</th>
  <th>JA3 æŒ‡çº¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Chrome 120</td>
  <td><code>579ccef312d18482fc42e2b822ca2430</code></td>
</tr>
<tr>
  <td>Firefox 121</td>
  <td><code>3b5074b1b5d032e5620f69f9f700ff0e</code></td>
</tr>
<tr>
  <td>Python requests</td>
  <td><code>084c44f52a434da89e0b1bc98f8dd159</code></td>
</tr>
<tr>
  <td>curl é»˜è®¤</td>
  <td><code>51c64c77e60f3980eea90869b68c58a8</code></td>
</tr>
</tbody>
</table>
<p><em>é—®é¢˜</em>ï¼šå¦‚æœä½ ç”¨ Python requests è®¿é—®æœåŠ¡å™¨ï¼Œå³ä½¿è®¾ç½®äº† User-Agentï¼ŒæœåŠ¡å™¨ä¹Ÿèƒ½é€šè¿‡ JA3 è¯†åˆ«å‡ºä½ ä¸æ˜¯çœŸå®æµè§ˆå™¨</p>
<hr />
<h3>ç¬¬ 2 æ­¥ï¼šæ£€æµ‹ä½ çš„ TLS æŒ‡çº¹ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<h4>2.1 åœ¨çº¿æ£€æµ‹</h4>
<p><em>æ–¹æ³• 1ï¼šè®¿é—® JA3 æ£€æµ‹ç½‘ç«™</em></p>
<pre><code class="language-bash"># ç”¨ curl æµ‹è¯•
curl https://ja3er.com/json

# ç”¨ Python requests æµ‹è¯•
python3 &lt;&lt; 'EOF'
import requests
r = requests.get('https://ja3er.com/json')
print(r.text)
EOF
</code></pre>
<pre><code class="language-json">{
  &quot;ja3&quot;: &quot;084c44f52a434da89e0b1bc98f8dd159&quot;,
  &quot;ja3_text&quot;: &quot;771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-23-65281-10-11-35-16-5-13-18-51-45-43-27-21,29-23-24,0&quot;,
  &quot;User-Agent&quot;: &quot;python-requests/2.31.0&quot;
}
</code></pre>
<pre><code class="language-bash">curl -s https://tls.peet.ws/api/all | jq .
</code></pre>
<ol>
<li>æ‰“å¼€ Wireshark</li>
<li>è¿‡æ»¤å™¨è¾“å…¥ï¼š<code>tls.handshake.type == 1</code>ï¼ˆåªæ˜¾ç¤º Client Helloï¼‰</li>
<li>åœ¨ç»ˆç«¯æ‰§è¡Œè¯·æ±‚ï¼š</li>
</ol>
<pre><code class="language-bash">curl https://example.com

</code></pre>
<p>æ¥ç€å±•å¼€ <strong>Transport Layer Security â†’ Handshake Protocol: Client Hello</strong></p>
<p><em>æŸ¥çœ‹å…³é”®å­—æ®µ</em>ï¼š</p>
<pre><code class="language-text">- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)
- ...
Extension: supported_groups (len=10)
- secp256r1 (0x0017)
- x25519 (0x001d)
- ...
</code></pre>
<p>âœ… <strong>æˆåŠŸæ ‡å¿—</strong>ï¼šä½ å·²ç»çœ‹åˆ°äº†è‡ªå·±å®¢æˆ·ç«¯çš„ TLS æ¡æ‰‹ç‰¹å¾</p>
<hr />
<h3>ç¬¬ 3 æ­¥ï¼šè·å–ç›®æ ‡æŒ‡çº¹ï¼ˆ5 åˆ†é’Ÿï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šè·å–çœŸå®æµè§ˆå™¨æˆ–å®˜æ–¹ App çš„ JA3 æŒ‡çº¹ç”¨äºä¼ªè£…</p>
<h4>3.1 æµè§ˆå™¨æŒ‡çº¹</h4>
<p><strong>æ–¹æ³• 1ï¼šç›´æ¥æŸ¥è¯¢</strong></p>
<p>Chrome æµè§ˆå™¨è®¿é—® https://ja3er.com/json</p>
<p>è®°å½•æ˜¾ç¤ºçš„ JA3 å“ˆå¸Œå€¼ã€‚</p>
<p><strong>æ–¹æ³• 2ï¼šä» GitHub æ•°æ®åº“æŸ¥è¯¢</strong></p>
<p>è®¿é—® https://github.com/salesforce/ja3/blob/master/lists/osx-nix-ja3.csv</p>
<p>æœç´¢ &quot;Chrome&quot;ã€&quot;Safari&quot;ã€&quot;Firefox&quot; æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ JA3ã€‚</p>
<h4>3.2 android App æŒ‡çº¹</h4>
<p><strong>ä½¿ç”¨ Wireshark æŠ“å–çœŸå® App çš„æµé‡</strong>ï¼š</p>
<ol>
<li>é…ç½®æ‰‹æœºèµ°ç”µè„‘ä»£ç†</li>
<li>Wireshark ç›‘å¬å¯¹åº”ç½‘å¡</li>
<li>æ‰“å¼€ç›®æ ‡ Appï¼Œè§¦å‘ç½‘ç»œè¯·æ±‚</li>
<li>è¿‡æ»¤ <code>tls.handshake.type == 1</code> æ‰¾åˆ° Client Hello åŒ…</li>
<li>è®°å½•æˆ–å¯¼å‡ºè¯¥åŒ…</li>
</ol>
<p><strong>æå– JA3</strong>ï¼š</p>
<pre><code class="language-bash"># Use ja3 Toolï¼ˆNeedInstallï¼‰
pip3 install pyshark
python3 &lt;&lt; 'EOF'
import pyshark
cap = pyshark.FileCapture('capture.pcap', display_filter='tls.handshake.type == 1')
for pkt in cap:
print(pkt.tls.handshake_ciphersuite)
EOF

</code></pre>
<h3>ç¬¬ 4 æ­¥ï¼šä¼ªé€  TLS æŒ‡çº¹ï¼ˆ15 åˆ†é’Ÿï¼‰</h3>
<h4>4.1 ä½¿ç”¨ curl-impersonateï¼ˆæ¨èï¼‰</h4>
<p><strong>curl-impersonate</strong> æ˜¯ä¸€ä¸ªä¿®æ”¹ç‰ˆçš„ curlï¼Œèƒ½å®Œç¾æ¨¡æ‹Ÿæµè§ˆå™¨çš„ TLS æŒ‡çº¹ã€‚</p>
<p><strong>å®‰è£…</strong>ï¼ˆmacOSï¼‰ï¼š</p>
<pre><code class="language-bash"># Use Homebrew
brew install curl-impersonate

# or downloadpre-compiled version
# https://github.com/lwthiker/curl-impersonate/releases

</code></pre>
<pre><code class="language-bash"># ä¼ªè£…æˆ Chrome 120
curl_chrome120 https://ja3er.com/json

# ä¼ªè£…æˆ Firefox 121
curl_ff121 https://ja3er.com/json

# ä¼ªè£…æˆ Safari 17
curl_safari17 https://ja3er.com/json

</code></pre>
<h4>4.2 ä½¿ç”¨ Python tls-client åº“</h4>
<p><strong>å®‰è£…</strong>ï¼š</p>
<pre><code class="language-bash">pip3 install tls-client
</code></pre>
<p><strong>åŸºæœ¬ä½¿ç”¨</strong>ï¼š</p>
<pre><code class="language-python">import tls_client

# åˆ›å»ºä¼šè¯ï¼Œä¼ªè£…æˆ Chrome 120
session = tls_client.Session(
    client_identifier=&quot;chrome_120&quot;,
    random_tls_extension_order=True
)

# å‘é€è¯·æ±‚
response = session.get(&quot;https://ja3er.com/json&quot;)
print(response.json())
</code></pre>
<p><strong>æ”¯æŒçš„å®¢æˆ·ç«¯æ ‡è¯†ç¬¦</strong>ï¼š</p>
<pre><code class="language-python"># æ¡Œé¢æµè§ˆå™¨
&quot;chrome_103&quot;, &quot;chrome_110&quot;, &quot;chrome_120&quot;
&quot;firefox_102&quot;, &quot;firefox_104&quot;, &quot;firefox_121&quot;
&quot;safari_15_3&quot;, &quot;safari_16_0&quot;, &quot;safari_17_0&quot;

# ç§»åŠ¨ç«¯
&quot;okhttp4_android_7&quot;, &quot;okhttp4_android_8&quot;, &quot;okhttp4_android_13&quot;
</code></pre>
<p><strong>è‡ªå®šä¹‰ JA3 å­—ç¬¦ä¸²</strong>ï¼š</p>
<pre><code class="language-python">import tls_client

session = tls_client.Session(
    client_identifier=&quot;custom&quot;,
    ja3_string=&quot;771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-23-65281-10-11-35-16-5-13-18-51-45-43-27-21,29-23-24,0&quot;
)
</code></pre>
<h4>4.3 ä½¿ç”¨ Go ja3transport åº“</h4>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;net/http&quot;
    &quot;github.com/CUCyber/ja3transport&quot;
)

func main() {
    // åˆ›å»ºå¸¦ JA3 æŒ‡çº¹çš„ Transport
    tr, _ := ja3transport.NewTransport(&quot;771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-23-65281-10-11-35-16-5-13-18-51-45-43-27-21,29-23-24,0&quot;)

    client := &amp;http.Client{Transport: tr}

    resp, _ := client.Get(&quot;https://ja3er.com/json&quot;)
    defer resp.Body.Close()

    body, _ := io.ReadAll(resp.Body)
    fmt.Println(string(body))
}
</code></pre>
<h3>ç¬¬ 5 æ­¥ï¼šéªŒè¯ä¼ªè£…æ•ˆæœï¼ˆ5 åˆ†é’Ÿï¼‰</h3>
<p><strong>åˆ›å»ºå¯¹æ¯”è„šæœ¬</strong> <code>compare_ja3.sh</code>ï¼š</p>
<pre><code class="language-bash">#!/bin/bash

echo &quot;=== åŸç”Ÿ curl ===&quot;
curl -s https://ja3er.com/json | jq -r '.ja3'

echo &quot;&quot;
echo &quot;=== curl-impersonate (Chrome) ===&quot;
curl_chrome120 -s https://ja3er.com/json | jq -r '.ja3'

echo &quot;&quot;
echo &quot;=== Python requests ===&quot;
python3 -c &quot;import requests; print(requests.get('https://ja3er.com/json').json()['ja3'])&quot;

echo &quot;&quot;
echo &quot;=== Python tls-client ===&quot;
python3 &lt;&lt; 'EOF'
import tls_client
session = tls_client.Session(client_identifier=&quot;chrome_120&quot;)
print(session.get(&quot;https://ja3er.com/json&quot;).json()['ja3'])
EOF
</code></pre>
<p><strong>è¿è¡Œå¯¹æ¯”</strong>ï¼š</p>
<pre><code class="language-bash">chmod +x compare_ja3.sh
./compare_ja3.sh
</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p>
<pre><code>=== åŸç”Ÿ curl ===
51c64c77e60f3980eea90869b68c58a8

=== curl-impersonate (Chrome) ===
579ccef312d18482fc42e2b822ca2430

=== Python requests ===
084c44f52a434da89e0b1bc98f8dd159

=== Python tls-client ===
579ccef312d18482fc42e2b822ca2430
</code></pre>
<p><strong>å®æˆ˜ç¤ºä¾‹ - è®¿é—®å—ä¿æŠ¤çš„ API</strong>ï¼š</p>
<pre><code class="language-python">import tls_client

# ä½¿ç”¨ä¼ªè£…çš„ TLS æŒ‡çº¹
session = tls_client.Session(client_identifier=&quot;chrome_120&quot;)

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
}

response = session.get('https://api.example.com/protected', headers=headers)
print(response.status_code)
print(response.text)
</code></pre>
<p><strong>ä¼ªè£…æ•ˆæœå¯¹æ¯”</strong>ï¼š</p>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>User-Agent</th>
  <th>TLS æŒ‡çº¹</th>
  <th>æœåŠ¡å™¨å“åº”</th>
</tr>
</thead>
<tbody>
<tr>
  <td>requests</td>
  <td>Chrome</td>
  <td>Python</td>
  <td>âŒ 403 Forbidden</td>
</tr>
<tr>
  <td>tls-client</td>
  <td>Chrome</td>
  <td>Chrome</td>
  <td>âœ… 200 OK</td>
</tr>
</tbody>
</table>
<hr />
<h2>å·¥ä½œåŸç†</h2>
<h3>TLS æ¡æ‰‹è¿‡ç¨‹</h3>
<pre><code>å®¢æˆ·ç«¯                              æœåŠ¡å™¨
   |                                  |
   |--- Client Hello ---------------â†’|
   |    (JA3 æŒ‡çº¹åœ¨æ­¤ç”Ÿæˆ)             |
   |                                  |
   |â†-- Server Hello ----------------|
   |    (Server JA3S æŒ‡çº¹)            |
   |                                  |
   |--- Key Exchange --------------â†’|
   |â†-- Finished -------------------|
   |                                  |
   |â†â†’ åŠ å¯†æ•°æ®ä¼ è¾“ â†â†’|
</code></pre>
<h3>JA3 æŒ‡çº¹ç”Ÿæˆç»†èŠ‚</h3>
<p><strong>åŸå§‹å­—ç¬¦ä¸²ç¤ºä¾‹</strong>ï¼š</p>
<pre><code>771,4865-4866-4867-49195-49199,0-23-65281-10-11,29-23-24,0
 â”‚        â”‚                      â”‚          â”‚      â”‚
 â”‚        â”‚                      â”‚          â”‚      â””â”€ EC Point Formats
 â”‚        â”‚                      â”‚          â””â”€ Supported Groups (æ¤­åœ†æ›²çº¿)
 â”‚        â”‚                      â””â”€ Extensions
 â”‚        â””â”€ Cipher Suites
 â””â”€ TLS ç‰ˆæœ¬ (771 = TLS 1.2)
</code></pre>
<p><strong>JA4 æŒ‡çº¹æ ¼å¼</strong>ï¼š</p>
<pre><code>t13d1516h2_174735a34e8a_b2149a751699
â”‚  â”‚  â”‚  â”‚  â”‚            â”‚
â”‚  â”‚  â”‚  â”‚  â”‚            â””â”€ Signature Algorithms å“ˆå¸Œ
â”‚  â”‚  â”‚  â”‚  â””â”€ Extensions å“ˆå¸Œï¼ˆæˆªæ–­ï¼‰
â”‚  â”‚  â”‚  â””â”€ h2 = HTTP/2
â”‚  â”‚  â””â”€ 16 ä¸ª Extensions
â”‚  â””â”€ 15 ä¸ª Cipher Suites
â””â”€ TLS 1.3
</code></pre>
<ul>
<li>å¯è¯»æ€§å¼ºï¼ˆæ— éœ€æŸ¥è¡¨ï¼‰</li>
</ul>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>âŒ é—®é¢˜ 1: curl-impersonate å®‰è£…å¤±è´¥</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šHomebrew æ‰¾ä¸åˆ° curl-impersonate</p>
<p><strong>è§£å†³</strong>ï¼š</p>
<pre><code class="language-bash"># macOS/Linux: æ‰‹åŠ¨ä¸‹è½½é¢„ç¼–è¯‘ç‰ˆæœ¬
wget https://github.com/lwthiker/curl-impersonate/releases/download/v0.6.1/curl-impersonate-v0.6.1.x86_64-linux-gnu.tar.gz

tar -xzf curl-impersonate-*.tar.gz
cd curl-impersonate-*
sudo cp curl_* /usr/local/bin/
</code></pre>
<h3>âŒ é—®é¢˜ 2: tls-client ä¸æ”¯æŒæŸä¸ªæµè§ˆå™¨ç‰ˆæœ¬</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼š<code>ValueError: Unknown client identifier: chrome_999</code></p>
<p><strong>è§£å†³</strong>ï¼šæŸ¥çœ‹æ”¯æŒçš„å®¢æˆ·ç«¯åˆ—è¡¨</p>
<pre><code class="language-python">import tls_client
print(tls_client.settings.ClientIdentifiers)
</code></pre>
<h3>âŒ é—®é¢˜ 3: ä¼ªè£…åä»è¢«æ£€æµ‹</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li><p><strong>HTTP/2 æŒ‡çº¹ä¸åŒ¹é…</strong></p>
<ul>
<li>JA3 æŒ‡çº¹æ˜¯æµè§ˆå™¨ï¼Œä½† HTTP å¤´é¡ºåº/å€¼ä¸å¯¹</li>
<li><strong>è§£å†³</strong>ï¼šä½¿ç”¨å®Œæ•´çš„æµè§ˆå™¨æ¨¡æ‹Ÿï¼ˆåŒ…æ‹¬ HTTP/2 ç‰¹å¾ï¼‰</li>
</ul>
</li>
<li><p><strong>è¡Œä¸ºç‰¹å¾å¼‚å¸¸</strong></p>
<ul>
<li>è¯·æ±‚é€Ÿåº¦å¤ªå¿«</li>
<li>ç¼ºå°‘ Referer/Cookie</li>
<li><strong>è§£å†³</strong>ï¼šæ·»åŠ å»¶è¿Ÿã€æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º</li>
</ul>
</li>
<li><p><strong>IP ä¿¡èª‰é—®é¢˜</strong></p>
<ul>
<li>IP è¢«æ ‡è®°ä¸ºæ•°æ®ä¸­å¿ƒ/ä»£ç†</li>
<li><strong>è§£å†³</strong>ï¼šä½¿ç”¨ä½å®…ä»£ç†æˆ–è½®æ¢ IP</li>
</ul>
</li>
<li><p><strong>è®¾å¤‡æŒ‡çº¹</strong></p>
<ul>
<li>æœåŠ¡å™¨æ£€æµ‹ Canvas æŒ‡çº¹ã€WebGL æŒ‡çº¹ç­‰</li>
<li><strong>è§£å†³</strong>ï¼šä½¿ç”¨çœŸå®æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆSelenium + undetected-chromedriverï¼‰</li>
</ul>
</li>
</ol>
<h3>âŒ é—®é¢˜ 4: å¦‚ä½•åœ¨ Frida ä¸­ä¿®æ”¹ TLS æŒ‡çº¹ï¼Ÿ</h3>
<p><strong>åœºæ™¯</strong>ï¼šä½ æƒ³ä¿®æ”¹ Android App çš„ TLS æŒ‡çº¹</p>
<p><strong>æ–¹æ³•ï¼šHook Java å±‚ SSLSocket</strong></p>
<pre><code class="language-javascript">Java.perform(function () {
  var SSLSocket = Java.use(&quot;javax.net.ssl.SSLSocket&quot;);

  SSLSocket.setEnabledCipherSuites.implementation = function (suites) {
    console.log(&quot;[*] Original Cipher Suites:&quot;, suites);

    // ä¿®æ”¹ä¸ºç›®æ ‡æŒ‡çº¹åŠ å¯†å¥—ä»¶
    var customSuites = [
      &quot;TLS_AES_128_GCM_SHA256&quot;,
      &quot;TLS_AES_256_GCM_SHA384&quot;,
      &quot;TLS_CHACHA20_POLY1305_SHA256&quot;,
    ];

    console.log(&quot;[*] ModifyAfter:&quot;, customSuites);
    return this.setEnabledCipherSuites(customSuites);
  };
});
</code></pre>
<h2>å»¶ä¼¸é˜…è¯»</h2>
<h3>ç›¸å…³é…æ–¹</h3>
<ul>
<li><strong><a href="#section-3">ç½‘ç»œæŠ“åŒ…</a></strong> - æŠ“å– TLS æ¡æ‰‹åŒ…</li>
<li><strong><a href="#section-4">å¯†ç å­¦åˆ†æ</a></strong> - åˆ†æåŠ å¯†å®ç°</li>
<li><strong><a href="#section-6">JA3 æŒ‡çº¹è¯¦è§£</a></strong> - JA3 æŠ€æœ¯æ·±å…¥</li>
<li><strong><a href="#section-7">JA4 æŒ‡çº¹è¯¦è§£</a></strong> - JA4+ å¥—ä»¶è¯¦è§£</li>
</ul>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><strong>curl-impersonate æ–‡æ¡£</strong> - https://github.com/lwthiker/curl-impersonate</li>
<li><strong>tls-client (Python)</strong> - https://github.com/FlorianREGAZ/Python-Tls-Client</li>
<li><strong>ja3transport (Go)</strong> - https://github.com/CUCyber/ja3transport</li>
</ul>
<h3>åœ¨çº¿èµ„æº</h3>
<ul>
<li><strong>JA3 æ£€æµ‹</strong> - https://ja3er.com</li>
<li><strong>TLS æŒ‡çº¹æ£€æµ‹</strong> - https://tls.peet.ws</li>
<li><strong>JA3 æ•°æ®åº“</strong> - https://github.com/salesforce/ja3</li>
</ul>
<h3>ç†è®ºåŸºç¡€</h3>
<ul>
<li><strong><a href="../../04-Reference/Advanced/">TLS åè®®è¯¦è§£</a></strong> - TODO</li>
<li><strong><a href="../../04-Reference/Advanced/">HTTP/2 æŒ‡çº¹</a></strong> - TODO</li>
</ul>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>å¸¸ç”¨å·¥å…·å¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>è¯­è¨€</th>
  <th>éš¾åº¦</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>curl-impersonate</strong></td>
  <td>Bash</td>
  <td></td>
  <td>æœ€ç®€å•ï¼Œå®Œç¾æ¨¡æ‹Ÿ</td>
</tr>
<tr>
  <td><strong>tls-client</strong></td>
  <td>Python</td>
  <td></td>
  <td>æ˜“ç”¨ï¼Œæ”¯æŒå¤šç§æµè§ˆå™¨</td>
</tr>
<tr>
  <td><strong>ja3transport</strong></td>
  <td>Go</td>
  <td></td>
  <td>é«˜æ€§èƒ½ï¼Œéœ€è¦ Go ç¯å¢ƒ</td>
</tr>
<tr>
  <td><strong>requests + urllib3</strong></td>
  <td>Python</td>
  <td></td>
  <td>å¤æ‚ï¼Œéœ€æ·±åº¦å®šåˆ¶</td>
</tr>
</tbody>
</table>
<h3>å¿«é€Ÿæ£€æµ‹è„šæœ¬</h3>
<p><strong>detect_ja3.sh</strong>ï¼š</p>
<pre><code class="language-bash">#!/bin/bash

echo &quot;æ­£åœ¨æ£€æµ‹ TLS æŒ‡çº¹...&quot;
echo &quot;&quot;

URL=&quot;https://ja3er.com/json&quot;

# æ£€æµ‹å½“å‰å®¢æˆ·ç«¯
JA3=$(curl -s &quot;$URL&quot; | jq -r '.ja3')
echo &quot;ä½ çš„ JA3: $JA3&quot;

# æŸ¥è¯¢å·²çŸ¥æŒ‡çº¹
echo &quot;&quot;
echo &quot;å¸¸è§å®¢æˆ·ç«¯ JA3:&quot;
echo &quot;  Chrome 120:  579ccef312d18482fc42e2b822ca2430&quot;
echo &quot;  Firefox 121: 3b5074b1b5d032e5620f69f9f700ff0e&quot;
echo &quot;  Safari 17:   4e2d5f6c3e8f7a9b0c1d2e3f4a5b6c7d&quot;
echo &quot;  Python req:  084c44f52a434da89e0b1bc98f8dd159&quot;
echo &quot;  curl:        51c64c77e60f3980eea90869b68c58a8&quot;

# å¯¹æ¯”
if [ &quot;$JA3&quot; == &quot;579ccef312d18482fc42e2b822ca2430&quot; ]; then
    echo &quot;&quot;
    echo &quot;âœ… åŒ¹é…: Chrome 120&quot;
elif [ &quot;$JA3&quot; == &quot;084c44f52a434da89e0b1bc98f8dd159&quot; ]; then
    echo &quot;&quot;
    echo &quot;âš ï¸ åŒ¹é…: Python requests (å®¹æ˜“è¢«è¯†åˆ«)&quot;
else
    echo &quot;&quot;
    echo &quot;â“ æœªçŸ¥æŒ‡çº¹&quot;
fi
</code></pre>
<h3>TLS æŒ‡çº¹ä¼ªè£…æ¨¡æ¿</h3>
<p><strong>browser_session.py</strong>ï¼š</p>
<pre><code class="language-python">&quot;&quot;&quot;
TLS æŒ‡çº¹ä¼ªè£…æ¨¡æ¿
&quot;&quot;&quot;
import tls_client


class BrowserSession:
    &quot;&quot;&quot;æ¨¡æ‹Ÿæµè§ˆå™¨ä¼šè¯&quot;&quot;&quot;

    PROFILES = {
        'chrome': 'chrome_120',
        'firefox': 'firefox_121',
        'safari': 'safari_17_0',
        'android': 'okhttp4_android_13'
    }

    def __init__(self, browser='chrome'):
        &quot;&quot;&quot;åˆå§‹åŒ–ä¼šè¯

        Args:
            browser: æµè§ˆå™¨ç±»å‹ ('chrome', 'firefox', 'safari', 'android')
        &quot;&quot;&quot;
        identifier = self.PROFILES.get(browser, 'chrome_120')
        self.session = tls_client.Session(
            client_identifier=identifier,
            random_tls_extension_order=True
        )
        self._set_headers(browser)

    def _set_headers(self, browser):
        &quot;&quot;&quot;è®¾ç½®å¯¹åº” HTTP å¤´&quot;&quot;&quot;
        user_agents = {
            'chrome': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            'firefox': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0',
            'safari': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Safari/605.1.15',
            'android': 'Mozilla/5.0 (Linux; Android 13) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.144 Mobile Safari/537.36'
        }

        self.session.headers.update({
            'User-Agent': user_agents.get(browser, user_agents['chrome']),
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
            'Accept-Language': 'en-US,en;q=0.5',
            'Accept-Encoding': 'gzip, deflate, br',
            'DNT': '1',
            'Connection': 'keep-alive',
            'Upgrade-Insecure-Requests': '1'
        })

    def get(self, url, **kwargs):
        &quot;&quot;&quot;å‘é€ GET è¯·æ±‚&quot;&quot;&quot;
        return self.session.get(url, **kwargs)

    def post(self, url, **kwargs):
        &quot;&quot;&quot;å‘é€ POST è¯·æ±‚&quot;&quot;&quot;
        return self.session.post(url, **kwargs)

    def verify_fingerprint(self):
        &quot;&quot;&quot;éªŒè¯ TLS æŒ‡çº¹&quot;&quot;&quot;
        r = self.get('https://ja3er.com/json')
        return r.json()


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»º Chrome ä¼šè¯
    browser = BrowserSession('chrome')

    # éªŒè¯æŒ‡çº¹
    print(&quot;éªŒè¯ TLS æŒ‡çº¹...&quot;)
    result = browser.verify_fingerprint()
    print(f&quot;JA3: {result['ja3']}&quot;)
    print(f&quot;User-Agent: {result['User-Agent']}&quot;)

    # å‘é€è¯·æ±‚
    response = browser.get('https://api.example.com/data')
    print(f&quot;\nçŠ¶æ€ç : {response.status_code}&quot;)
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-6">
                                                <h2>6. R04: JA3 Fingerprinting</h2>
                                                <h1>R04: JA3 TLS æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</h1>
<p>JA3 æ˜¯ä¸€ç§åˆ›å»º SSL/TLS å®¢æˆ·ç«¯æŒ‡çº¹çš„æ–¹æ³•ï¼Œæ—¨åœ¨è½»æ¾è¯†åˆ«ç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹åŠ å¯†è¿æ¥æ—¶ï¼Œå®ƒé¦–å…ˆä¼šå‘é€ä¸€ä¸ª <code>Client Hello</code> åŒ…ã€‚è¿™ä¸ªåŒ…çš„æ ¼å¼å’Œå†…å®¹åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç”¨äºåˆ›å»ºè¿æ¥çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚æµè§ˆå™¨ã€æ¶æ„è½¯ä»¶ã€ç§»åŠ¨ Appï¼‰ä¸­çš„åº“å’Œæ–¹æ³•ã€‚JA3 é€šè¿‡æ”¶é›† <code>Client Hello</code> åŒ…ä¸­ç‰¹å®šå­—æ®µçš„å€¼ï¼Œå¹¶å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªæ˜“äºå…±äº«å’Œæ¯”è¾ƒçš„ MD5 å“ˆå¸Œå€¼ï¼Œä»è€Œä¸ºå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹çš„&quot;æŒ‡çº¹&quot;ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#ja3-tls-%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3">JA3 TLS æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">å·¥ä½œåŸç†</a></li>
<li><a href="#%E6%8C%87%E7%BA%B9%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B">æŒ‡çº¹ç”Ÿæˆè¿‡ç¨‹</a></li>
<li><a href="#ja3s---%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%8C%87%E7%BA%B9">JA3S - æœåŠ¡å™¨ç«¯æŒ‡çº¹</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">åº”ç”¨åœºæ™¯</a></li>
<li><a href="#%E5%B1%80%E9%99%90%E6%80%A7">å±€é™æ€§</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E6%A3%80%E6%B5%8B-ja3">å¦‚ä½•æ£€æµ‹ JA3</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>å·¥ä½œåŸç†</h3>
<p>JA3 æŒ‡çº¹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å®¢æˆ·ç«¯çš„ <code>Client Hello</code> åŒ…æš´éœ²äº†å…¶èº«ä»½</strong>ã€‚</p>
<p>ä¸€ä¸ª <code>Client Hello</code> åŒ…åŒ…å«äº†å®¢æˆ·ç«¯å¸Œæœ›å¦‚ä½•ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„å„ç§ç»†èŠ‚ã€‚JA3 æ–¹æ³•ç²¾ç¡®åœ°é€‰æ‹©äº†ä»¥ä¸‹ 5 ä¸ªå­—æ®µï¼Œå¹¶æŒ‰ç…§ç‰¹å®šé¡ºåºå°†å®ƒä»¬ä¸²è”èµ·æ¥ï¼š</p>
<ol>
<li><strong>SSL/TLS Version (ç‰ˆæœ¬å·)</strong>: å®¢æˆ·ç«¯æ”¯æŒçš„æœ€é«˜ TLS ç‰ˆæœ¬ã€‚</li>
<li><strong>Accepted Ciphers (åŠ å¯†å¥—ä»¶)</strong>: å®¢æˆ·ç«¯æ„¿æ„æ¥å—çš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ŒæŒ‰å…¶åå¥½é¡ºåºæ’åˆ—ã€‚</li>
<li><strong>List of Extensions (æ‰©å±•åˆ—è¡¨)</strong>: <code>Client Hello</code> ä¸­åŒ…å«çš„æ‰€æœ‰æ‰©å±•ï¼ŒæŒ‰å…¶å‡ºç°é¡ºåºæ’åˆ—ã€‚</li>
<li><strong>Elliptic Curves (æ¤­åœ†æ›²çº¿)</strong>: å®¢æˆ·ç«¯æ”¯æŒçš„æ¤­åœ†æ›²çº¿åˆ—è¡¨ã€‚</li>
<li><strong>Elliptic Curve Point Formats (æ¤­åœ†æ›²çº¿ç‚¹æ ¼å¼)</strong>: æ”¯æŒçš„ç‚¹æ ¼å¼åˆ—è¡¨ã€‚</li>
</ol>
<p>è¿™äº›å­—æ®µçš„ç»„åˆå¯¹äºç‰¹å®šçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆåŠå…¶ç‰ˆæœ¬ï¼‰æ¥è¯´é€šå¸¸æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ä¾‹å¦‚ï¼ŒChrome æµè§ˆå™¨ã€Firefox æµè§ˆå™¨ã€Tor æµè§ˆå™¨å’Œä¸€ä¸ª Golang ç¼–å†™çš„åƒµå°¸ç½‘ç»œç¨‹åºï¼Œå®ƒä»¬ç”Ÿæˆçš„ <code>Client Hello</code> åœ¨è¿™äº›å­—æ®µä¸Šä¼šæœ‰æ˜æ˜¾çš„å·®å¼‚ã€‚</p>
<hr />
<h3>æŒ‡çº¹ç”Ÿæˆè¿‡ç¨‹</h3>
<p>ç”Ÿæˆ JA3 æŒ‡çº¹çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>æ”¶é›†å­—æ®µå€¼</strong>: ä»ä¸€ä¸ª TCP ä¼šè¯çš„ <code>Client Hello</code> åŒ…ä¸­ï¼Œæå–ä¸Šè¿° 5 ä¸ªå­—æ®µçš„åè¿›åˆ¶å€¼ã€‚</li>
<li><strong>æ ¼å¼åŒ–å’Œæ‹¼æ¥</strong>:<ul>
<li>æ¯ä¸ªå­—æ®µå†…çš„å€¼ç”¨ <code>-</code> åˆ†éš”ã€‚</li>
<li>5 ä¸ªä¸»è¦å­—æ®µä¹‹é—´ç”¨ <code>,</code> åˆ†éš”ã€‚</li>
<li>ä¾‹å¦‚ï¼Œä¸€ä¸ª JA3 å­—ç¬¦ä¸²çœ‹èµ·æ¥åƒè¿™æ ·ï¼š<code>771,4865-4866-4867-49195-49199-...,23-65281-10-11-35-16-0-13-18,29-23-24,0</code></li>
</ul>
</li>
<li><strong>è®¡ç®— MD5 å“ˆå¸Œ</strong>: å¯¹ä¸Šè¿°æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²è®¡ç®— MD5 å“ˆå¸Œå€¼ã€‚</li>
<li><strong>æœ€ç»ˆæŒ‡çº¹</strong>: å¾—åˆ°çš„ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²å°±æ˜¯è¯¥å®¢æˆ·ç«¯çš„ JA3 æŒ‡çº¹ã€‚<ul>
<li>ä¾‹å¦‚ï¼Œä¸Šè¿°å­—ç¬¦ä¸²çš„ MD5 å“ˆå¸Œå¯èƒ½æ˜¯ï¼š<code>e7d705a3286e19ea42f587b344ee6865</code>ã€‚</li>
</ul>
</li>
</ol>
<p>è¿™ä¸ªæœ€ç»ˆçš„ MD5 å“ˆå¸Œå°±æ˜¯å¯ç”¨äºè¯†åˆ«ã€å…±äº«å’ŒæŸ¥è¯¢çš„ JA3 æŒ‡çº¹ã€‚</p>
<hr />
<h3>JA3S - æœåŠ¡å™¨ç«¯æŒ‡çº¹</h3>
<p>ä¸ JA3 å¯¹åº”ï¼Œ<strong>JA3S</strong> æ˜¯å¯¹æœåŠ¡å™¨å“åº”çš„æŒ‡çº¹ã€‚å®ƒåŸºäºæœåŠ¡å™¨åœ¨ <code>Server Hello</code> åŒ…ä¸­é€‰æ‹©çš„å‚æ•°ã€‚JA3S æ”¶é›†ä»¥ä¸‹å­—æ®µï¼š</p>
<ol>
<li><strong>SSL/TLS Version</strong></li>
<li><strong>Selected Cipher</strong></li>
<li><strong>List of Extensions</strong></li>
</ol>
<p>å°†è¿™äº›å€¼æ‹¼æ¥å¹¶è¿›è¡Œ MD5 å“ˆå¸Œï¼Œå°±å¾—åˆ°äº† JA3S æŒ‡çº¹ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ JA3S å¾ˆé‡è¦ï¼Ÿ</strong></p>
<p>å°† JA3 å’Œ JA3S ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æä¾›å¯¹åŠ å¯†è¿æ¥çš„æ›´å¼ºæ´å¯ŸåŠ›ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¶æ„è½¯ä»¶ (JA3) å¯èƒ½ä¼šå°è¯•è¿æ¥å¤šä¸ªä¸åŒçš„ C2 æœåŠ¡å™¨ (ä¸åŒçš„ JA3S)ã€‚åä¹‹ï¼Œä¸€ä¸ª C2 æœåŠ¡å™¨ (JA3S) å¯èƒ½ä¼šæ¥å—æ¥è‡ªä¸åŒç±»å‹æ¶æ„è½¯ä»¶ (ä¸åŒçš„ JA3) çš„è¿æ¥ã€‚è¿™ç§ç»„åˆåˆ†æå¯ä»¥æ›´ç²¾ç¡®åœ°æç»˜å‡ºå¨èƒæ´»åŠ¨çš„å…¨è²Œã€‚</p>
<hr />
<h3>åº”ç”¨åœºæ™¯</h3>
<ul>
<li><strong>æ¶æ„è½¯ä»¶å®¶æ—è¯†åˆ«</strong>: è®¸å¤šæ¶æ„è½¯ä»¶å®¶æ—ï¼ˆå¦‚ Trickbot, Emotetï¼‰ä½¿ç”¨ç‰¹å®šçš„ SSL/TLS åº“ï¼Œå¯¼è‡´å®ƒä»¬å…·æœ‰ç‹¬ç‰¹ä¸”ä¸€è‡´çš„ JA3 æŒ‡çº¹ã€‚å®‰å…¨åˆ†æå¸ˆå¯ä»¥åˆ›å»ºè§„åˆ™æ¥æ£€æµ‹æˆ–é˜»æ­¢å·²çŸ¥çš„æ¶æ„ JA3 å“ˆå¸Œã€‚</li>
<li><strong>åƒµå°¸ç½‘ç»œæ£€æµ‹</strong>: åƒµå°¸ç½‘ç»œä¸­çš„å®¢æˆ·ç«¯é€šå¸¸æ˜¯ç›¸åŒçš„ç¨‹åºï¼Œå› æ­¤å®ƒä»¬çš„ JA3 æŒ‡çº¹ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚è¿™ä½¿å¾—å¤§è§„æ¨¡è¯†åˆ«å—æ„ŸæŸ“ä¸»æœºæˆä¸ºå¯èƒ½ã€‚</li>
<li><strong>å¨èƒæƒ…æŠ¥å…±äº«</strong>: JA3 æŒ‡çº¹æ˜¯ä¸€ä¸ªä¼˜ç§€çš„æŠ€æœ¯æ€§&quot;å¤±é™·æŒ‡æ ‡&quot;(IOC)ã€‚å®‰å…¨ç¤¾åŒºå¯ä»¥å…±äº«å·²çŸ¥çš„æ¶æ„ JA3 åˆ—è¡¨ï¼Œå°±åƒå…±äº«æ¶æ„ IP åœ°å€æˆ–åŸŸåä¸€æ ·ã€‚</li>
<li><strong>è¯†åˆ«éæ ‡å‡†åº”ç”¨</strong>: å¯ä»¥ç”¨äºè¯†åˆ«ç»„ç»‡å†…éƒ¨ç½‘ç»œä¸­ä¸åˆè§„æˆ–éæ ‡å‡†çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<hr />
<h3>å±€é™æ€§</h3>
<p>å°½ç®¡ JA3 éå¸¸æœ‰ç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li><strong>æŒ‡çº¹å†²çª</strong>: ä¸åŒçš„åº”ç”¨ç¨‹åºå¯èƒ½å¶ç„¶ä¼šä½¿ç”¨ç›¸åŒçš„åŠ å¯†åº“å’Œé…ç½®ï¼Œä»è€Œäº§ç”Ÿç›¸åŒçš„ JA3 æŒ‡çº¹ã€‚</li>
<li><strong>å®¹æ˜“è¢«è§„é¿ (Spoofing)</strong>: åªè¦æ”»å‡»è€…æœ‰èƒ½åŠ›ä¿®æ”¹å…¶å®¢æˆ·ç«¯çš„ SSL/TLS åº“ï¼Œä»–ä»¬å°±å¯ä»¥åˆ»æ„æ¨¡ä»¿ä¸€ä¸ªå¸¸è§ã€åˆæ³•çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚ Chrome æµè§ˆå™¨ï¼‰çš„ <code>Client Hello</code> åŒ…ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ª&quot;åˆæ³•&quot;çš„ JA3 æŒ‡çº¹æ¥é€ƒé¿æ£€æµ‹ã€‚è¿™ç§æŠ€æœ¯è¢«ç§°ä¸º&quot;JA3 æ¬ºéª—&quot;ã€‚</li>
<li><strong>æŒ‡çº¹éšç‰ˆæœ¬å˜åŒ–</strong>: å½“ä¸€ä¸ªåˆæ³•åº”ç”¨ï¼ˆå¦‚ Chromeï¼‰æ›´æ–°æ—¶ï¼Œå®ƒçš„ TLS å®ç°å¯èƒ½ä¼šæ”¹å˜ï¼Œå¯¼è‡´å…¶ JA3 æŒ‡çº¹ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚è¿™æ„å‘³ç€ç»´æŠ¤ä¸€ä¸ªå‡†ç¡®çš„æŒ‡çº¹æ•°æ®åº“éœ€è¦æŒç»­çš„åŠªåŠ›ã€‚</li>
<li><strong>ä¿¡æ¯æœ‰é™</strong>: ä¸€ä¸ª MD5 å“ˆå¸Œæœ¬èº«ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ã€‚ä½ æ— æ³•ä»ä¸¤ä¸ªä¸åŒçš„å“ˆå¸Œå€¼çœ‹å‡ºå®ƒä»¬å¯¹åº”çš„å®¢æˆ·ç«¯æœ‰å¤šç›¸ä¼¼ã€‚ä¾‹å¦‚ï¼ŒChrome 90 å’Œ Chrome 91 çš„ JA3 å“ˆå¸Œå¯èƒ½å®Œå…¨ä¸åŒï¼Œå³ä½¿å®ƒä»¬çš„ <code>Client Hello</code> åŒ…åªæœ‰å¾®å°çš„å·®å¼‚ã€‚</li>
</ul>
<hr />
<h3>å¦‚ä½•æ£€æµ‹ JA3</h3>
<p>è¦å®ç° JA3 æ£€æµ‹ï¼Œä½ éœ€è¦èƒ½å¤Ÿç›‘æ§ç½‘ç»œæµé‡å¹¶è§£æ TLS æ¡æ‰‹çš„å·¥å…·ã€‚å¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç½‘ç»œå®‰å…¨ç›‘æ§ (NSM) å·¥å…·</strong>: Zeek (åŸå Bro) æ˜¯åŸç”Ÿæ”¯æŒ JA3 å’Œ JA3S æŒ‡çº¹ç”Ÿæˆçš„é»„é‡‘æ ‡å‡†ã€‚</li>
<li><strong>Suricata</strong>: ä» 4.1 ç‰ˆæœ¬å¼€å§‹ï¼ŒSuricata ä¹Ÿå†…ç½®äº† JA3 æŒ‡çº¹åŠŸèƒ½ã€‚</li>
<li><strong>Wireshark</strong>: å¯ä»¥é€šè¿‡ç‰¹å®šçš„æ’ä»¶æˆ–æ‰‹åŠ¨çš„ tshark è„šæœ¬æ¥æå–å’Œè®¡ç®— JA3ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-7">
                                                <h2>7. R05: JA4 Fingerprinting</h2>
                                                <h1>R05: JA4+ TLS/QUIC æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</h1>
<p>JA4+ æ˜¯ç”± FoxIO (åŸ Salesforce çš„ JA3 å›¢é˜Ÿ) å¼€å‘çš„ä¸€å¥—ç½‘ç»œæŒ‡çº¹è¯†åˆ«æ–¹æ³•çš„é›†åˆï¼Œæ—¨åœ¨æˆä¸º JA3 çš„ä¸‹ä¸€ä»£æ¼”è¿›ç‰ˆæœ¬ã€‚å®ƒä¸ä»…ä»…æ˜¯å¯¹ JA3 çš„ç®€å•å‡çº§ï¼Œè€Œæ˜¯ä¸€ä¸ªæ›´å…¨é¢ã€æ›´å…·ç»“æ„åŒ–å’Œå¯æ“ä½œæ€§çš„æŒ‡çº¹å¥—ä»¶ï¼Œæ—¨åœ¨è§£å†³ JA3 çš„æ ¸å¿ƒç—›ç‚¹ï¼Œå¹¶æ‰©å±•åˆ° QUIC å’Œ HTTP ç­‰åè®®ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#ja4-tlsquic-%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3">JA4+ TLS/QUIC æŒ‡çº¹è¯†åˆ«æŠ€æœ¯è¯¦è§£</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-ja4-ja3-%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7">ä¸ºä»€ä¹ˆéœ€è¦ JA4+ (JA3 çš„å±€é™æ€§)</a></li>
<li><a href="#ja4-%E7%9A%84%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1---%E4%B8%8D%E5%86%8D%E6%98%AF%E5%93%88%E5%B8%8C">JA4 çš„æ ¸å¿ƒè®¾è®¡ - ä¸å†æ˜¯å“ˆå¸Œ</a></li>
<li><a href="#ja4-%E5%A5%97%E4%BB%B6%E6%A6%82%E8%A7%88">JA4+ å¥—ä»¶æ¦‚è§ˆ</a><ul>
<li><a href="#ja4-%E5%AE%A2%E6%88%B7%E7%AB%AF-tls">JA4 (å®¢æˆ·ç«¯ TLS)</a></li>
<li><a href="#ja4s-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-tls">JA4S (æœåŠ¡å™¨ç«¯ TLS)</a></li>
<li><a href="#ja4h-http-%E5%AE%A2%E6%88%B7%E7%AB%AF">JA4H (HTTP å®¢æˆ·ç«¯)</a></li>
<li><a href="#ja4x-tls-%E8%AF%81%E4%B9%A6">JA4X (TLS è¯ä¹¦)</a></li>
<li><a href="#ja4l-%E5%AE%9E%E9%AA%8C%E6%80%A7">JA4L (å®éªŒæ€§)</a></li>
</ul>
</li>
<li><a href="#ja4-vs-ja3%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF">JA4 vs JA3ï¼šæ ¸å¿ƒä¼˜åŠ¿</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5">åº”ç”¨ä¸å®è·µ</a></li>
</ul>
</li>
</ul>
<hr />
<h2>ä¸ºä»€ä¹ˆéœ€è¦ JA4+ (JA3 çš„å±€é™æ€§)</h2>
<p>JA3 æ˜¯ä¸€ä¸ªéå¸¸æˆåŠŸçš„æŠ€æœ¯ï¼Œä½†å…¶æ ¸å¿ƒè®¾è®¡â€”â€”ä¸€ä¸ªå•ä¸€çš„ MD5 å“ˆå¸Œâ€”â€”å¸¦æ¥äº†å‡ ä¸ªæ— æ³•å…‹æœçš„æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>ç¼ºä¹ä¸Šä¸‹æ–‡</strong>: ä¸€ä¸ª MD5 å“ˆå¸Œæ˜¯ä¸é€æ˜çš„ã€‚<code>e7d705a3...</code> å’Œ <code>a8d9b1c2...</code> è¿™ä¸¤ä¸ªå“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­å®ƒä»¬ä»£è¡¨çš„å®¢æˆ·ç«¯æœ‰å¤šç›¸ä¼¼ã€‚å¯èƒ½åªæ˜¯ TLS æ‰©å±•é¡ºåºçš„ä¸€ä¸ªå¾®å°å˜åŒ–ï¼Œå°±å¯¼è‡´äº†å®Œå…¨ä¸åŒçš„å“ˆå¸Œã€‚</li>
<li><strong>&quot;é›ªå´©æ•ˆåº”&quot;</strong>: å®¢æˆ·ç«¯çš„ä»»ä½•å¾®å°æ›´æ–°ï¼ˆä¾‹å¦‚ï¼ŒChrome 101 -&gt; 102ï¼‰éƒ½å¯èƒ½å¯¼è‡´ JA3 å“ˆå¸Œå®Œå…¨æ”¹å˜ï¼Œä½¿å¾—åŸºäºç²¾ç¡®åŒ¹é…çš„è§„åˆ™å˜å¾—éå¸¸è„†å¼±ã€‚</li>
<li><strong>éš¾ä»¥è¿›è¡Œæ¨¡ç³Šæœç´¢</strong>: æ— æ³•è¿›è¡Œ&quot;æœç´¢æ‰€æœ‰ä½¿ç”¨ TLS 1.3 ä½†ä¸åŒ…å«æŸä¸ªç‰¹å®šåŠ å¯†å¥—ä»¶çš„å®¢æˆ·ç«¯&quot;è¿™æ ·çš„çµæ´»æŸ¥è¯¢ã€‚</li>
<li><strong>æ˜“äºè¢«æ¨¡ä»¿</strong>: æ”»å‡»è€…åªéœ€è¦ç²¾ç¡®å¤ç° <code>Client Hello</code> çš„ç‰¹å®šå­—æ®µï¼Œå°±èƒ½å®Œå…¨å¤åˆ¶ä¸€ä¸ªåˆæ³•åº”ç”¨çš„ JA3 å“ˆå¸Œã€‚</li>
</ul>
<p>JA4+ çš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<hr />
<h2>JA4 çš„æ ¸å¿ƒè®¾è®¡ - ä¸å†æ˜¯å“ˆå¸Œ</h2>
<p>JA4 æœ€å¤§çš„é©æ–°æ˜¯<strong>æ”¾å¼ƒäº†å•ä¸€ã€ä¸é€æ˜çš„å“ˆå¸Œå€¼</strong>ï¼Œè½¬è€Œé‡‡ç”¨ä¸€ç§<strong>ç»“æ„åŒ–ã€äººç±»å¯è¯»çš„å­—ç¬¦ä¸²æ ¼å¼</strong>ã€‚è¿™ä½¿å¾—æŒ‡çº¹æœ¬èº«å°±æºå¸¦äº†ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
<p>JA4 çš„æŒ‡çº¹æ ¼å¼ä¸ºï¼š<code>Protocol_Version_Ciphers_Extensions_Signature</code>ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰å’Œæ„é€ æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„ JA4 æŒ‡çº¹ä¾‹å­ï¼š<code>t13d1516h2_174735a34e8a_b2149a751699</code></p>
<p>æˆ‘ä»¬æ¥åˆ†è§£å®ƒï¼š</p>
<ul>
<li><strong><code>t</code> (Protocol)</strong>: åè®®ã€‚<code>t</code> ä»£è¡¨ TLS, <code>q</code> ä»£è¡¨ QUICã€‚</li>
<li><strong><code>13</code> (TLS Version)</strong>: <code>Client Hello</code> ä¸­æ”¯æŒçš„æœ€é«˜ TLS ç‰ˆæœ¬ã€‚<code>12</code> = TLS 1.2, <code>13</code> = TLS 1.3ã€‚</li>
<li><strong><code>d1516h2</code> (Ciphers &amp; Extensions Count)</strong>:<ul>
<li><code>d</code>: å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶æ˜¯æœ‰åºçš„ (sorted)ã€‚<code>i</code> è¡¨ç¤ºæ— åº (insipid)ã€‚</li>
<li><code>15</code>: å®¢æˆ·ç«¯æä¾›äº† 15 ä¸ªåŠ å¯†å¥—ä»¶ã€‚</li>
<li><code>16</code>: å®¢æˆ·ç«¯æä¾›äº† 16 ä¸ªæ‰©å±•ã€‚</li>
<li><code>h2</code>: å®¢æˆ·ç«¯åœ¨ <code>Client Hello</code> ä¸­ä½¿ç”¨äº† 2 ä¸ª GREASE (Generate Random Extensions And Sustain Extensibility) å€¼ï¼Œè¿™é€šå¸¸æ˜¯ç°ä»£æµè§ˆå™¨çš„ç‰¹å¾ã€‚</li>
</ul>
</li>
<li><strong><code>_</code> (åˆ†éš”ç¬¦)</strong></li>
<li><strong><code>174735a34e8a</code> (Extensions)</strong>: è¿™æ˜¯å¯¹<strong>æœ‰åºçš„</strong>æ‰©å±•åˆ—è¡¨è¿›è¡Œç‰¹å®šç®—æ³•è®¡ç®—åå¾—åˆ°çš„<strong>éƒ¨åˆ†å“ˆå¸Œ</strong>ã€‚ç›¸ä¼¼çš„æ‰©å±•åˆ—è¡¨ä¼šäº§ç”Ÿç›¸ä¼¼çš„å“ˆå¸Œå‰ç¼€ã€‚</li>
<li><strong><code>_</code> (åˆ†éš”ç¬¦)</strong></li>
<li><strong><code>b2149a751699</code> (Signature Algorithms)</strong>: è¿™æ˜¯å¯¹ç­¾åç®—æ³•å’Œæ”¯æŒçš„ç»„ï¼ˆæ¤­åœ†æ›²çº¿ï¼‰è¿›è¡Œéƒ¨åˆ†å“ˆå¸Œè®¡ç®—åå¾—åˆ°çš„å€¼ã€‚</li>
</ul>
<p>è¿™ç§ç»“æ„ä½¿å¾—æŒ‡çº¹æ—¢èƒ½ç”¨äºç²¾ç¡®åŒ¹é…ï¼Œä¹Ÿèƒ½ç”¨äºå¼ºå¤§çš„æ¨¡ç³ŠåŒ¹é…ã€‚</p>
<hr />
<h2>JA4+ å¥—ä»¶æ¦‚è§ˆ</h2>
<p>JA4+ ä¸æ˜¯å•ä¸€çš„å·¥å…·ï¼Œè€Œæ˜¯ä¸€ä¸ªæ–¹æ³•è®ºé›†åˆã€‚</p>
<h3>JA4 (å®¢æˆ·ç«¯ TLS)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: è¯†åˆ«å‘èµ· TLS è¿æ¥çš„å®¢æˆ·ç«¯åº”ç”¨ã€‚</li>
<li><strong>æ ¼å¼</strong>: å¦‚ä¸Šæ‰€è¿°çš„ <code>p_v_c_e_s</code> ç»“æ„ã€‚</li>
</ul>
<h3>JA4S (æœåŠ¡å™¨ç«¯ TLS)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: è¯†åˆ«å“åº” TLS è¿æ¥çš„æœåŠ¡å™¨åº”ç”¨ã€‚</li>
<li><strong>æ ¼å¼</strong>: <code>p_v_c_e</code>ï¼Œæ¯”å®¢æˆ·ç«¯æŒ‡çº¹ç¨ç®€å•ã€‚<ul>
<li>ä¾‹å¦‚ï¼š<code>t13d03_a06f30d07525</code></li>
<li><code>t</code> = TLS, <code>13</code> = TLS 1.3, <code>d</code> = æœ‰åº, <code>03</code> = 3 ä¸ªæ‰©å±•, <code>a06...</code> = æ‰©å±•çš„éƒ¨åˆ†å“ˆå¸Œã€‚</li>
</ul>
</li>
<li><strong>åº”ç”¨</strong>: å°† JA4 å’Œ JA4S ç»“åˆï¼Œå¯ä»¥è¿›è¡Œæ›´ç²¾å‡†çš„åŒ¹é…ï¼Œä¾‹å¦‚&quot;åªå‘Šè­¦è¿™ä¸ªç‰¹å®š JA4 è¿æ¥åˆ°è¿™ä¸ªç‰¹å®š JA4S çš„è¡Œä¸º&quot;ã€‚</li>
</ul>
<h3>JA4H (HTTP å®¢æˆ·ç«¯)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: å¯¹ HTTP è¯·æ±‚è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œä½œä¸ºå¯¹ JA4 çš„è¡¥å……ã€‚</li>
<li><strong>æ ¼å¼</strong>: <code>p_m_v_h</code><ul>
<li><code>p</code>: åè®® (<code>h</code>=HTTP/1, <code>h2</code>=HTTP/2)ã€‚</li>
<li><code>m</code>: è¯·æ±‚æ–¹æ³• (<code>g</code>=GET, <code>p</code>=POST)ã€‚</li>
<li><code>v</code>: HTTP ç‰ˆæœ¬ã€‚</li>
<li><code>h</code>: å¯¹ HTTP Header çš„ç‰¹å®šç»„åˆè¿›è¡Œå“ˆå¸Œã€‚</li>
</ul>
</li>
<li><strong>åº”ç”¨</strong>: å¯ä»¥ç”¨æ¥æ£€æµ‹ JA4 æ¬ºéª—ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå£°ç§°è‡ªå·±æ˜¯ Chrome çš„ JA4 æŒ‡çº¹ï¼Œå´å‘é€äº†ä¸ç¬¦åˆ Chrome è¡Œä¸ºçš„ JA4H æŒ‡çº¹ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ¶æ„å®¢æˆ·ç«¯ã€‚</li>
</ul>
<h3>JA4X (TLS è¯ä¹¦)</h3>
<ul>
<li><strong>ç›®æ ‡</strong>: å¯¹ TLS è¯ä¹¦é“¾è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ã€‚</li>
<li><strong>åº”ç”¨</strong>: å¿«é€Ÿè¯†åˆ«è‡ªç­¾åè¯ä¹¦ã€ç‰¹å®šæ¶æ„è½¯ä»¶ä½¿ç”¨çš„è¯ä¹¦ç­‰ã€‚</li>
</ul>
<h3>JA4L (å®éªŒæ€§)</h3>
<ul>
<li><strong>L</strong> for <strong>L</strong>ightweightã€‚è¿™æ˜¯ä¸€ä¸ªæ›´ç®€å•çš„ç‰ˆæœ¬ï¼ŒåªåŒ…å«æ•°å­—å’Œè®¡æ•°ï¼Œä¸åŒ…å«å“ˆå¸Œã€‚</li>
<li><strong>åº”ç”¨</strong>: é€‚ç”¨äºæ€§èƒ½æé«˜æˆ–èµ„æºå—é™çš„ç¯å¢ƒï¼Œæä¾›åŸºæœ¬çš„æ¨¡ç³ŠåŒ¹é…èƒ½åŠ›ã€‚</li>
</ul>
<hr />
<h2>JA4 vs JA3ï¼šæ ¸å¿ƒä¼˜åŠ¿</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">JA4+</th>
  <th style="text-align:left">JA3</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>æ ¼å¼</strong></td>
  <td style="text-align:left"><strong>ç»“æ„åŒ–å­—ç¬¦ä¸²</strong></td>
  <td style="text-align:left">å•ä¸€ MD5 å“ˆå¸Œ</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¯è¯»æ€§</strong></td>
  <td style="text-align:left"><strong>é«˜</strong>ï¼ŒæŒ‡çº¹æœ¬èº«åŒ…å«ä¿¡æ¯</td>
  <td style="text-align:left"><strong>æ— </strong></td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ¨¡ç³ŠåŒ¹é…</strong></td>
  <td style="text-align:left"><strong>åŸç”Ÿæ”¯æŒ</strong>ï¼Œå¯æŒ‰éƒ¨åˆ†æŸ¥è¯¢</td>
  <td style="text-align:left">å¦</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ä¸Šä¸‹æ–‡</strong></td>
  <td style="text-align:left"><strong>ä¸°å¯Œ</strong> (åè®®, ç‰ˆæœ¬, è®¡æ•°)</td>
  <td style="text-align:left">æ— </td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ¬ºéª—éš¾åº¦</strong></td>
  <td style="text-align:left"><strong>æ›´é«˜</strong>ï¼Œéœ€åŒ¹é…è¡Œä¸ºé€»è¾‘</td>
  <td style="text-align:left">è¾ƒä½ï¼Œåªéœ€åŒ¹é…å­—æ®µ</td>
</tr>
<tr>
  <td style="text-align:left"><strong>è¦†ç›–èŒƒå›´</strong></td>
  <td style="text-align:left">TLS, QUIC, HTTP, Certificates</td>
  <td style="text-align:left">ä»… TLS</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¥å£®æ€§</strong></td>
  <td style="text-align:left"><strong>é«˜</strong>ï¼Œå¾®å°å˜åŒ–ä¸å½±å“å¤§å±€</td>
  <td style="text-align:left">ä½ï¼Œ&quot;é›ªå´©æ•ˆåº”&quot;</td>
</tr>
</tbody>
</table>
<hr />
<h2>åº”ç”¨ä¸å®è·µ</h2>
<p>JA4+ çš„åº”ç”¨åœºæ™¯æ¯” JA3 æ›´å¹¿æ³›å’Œæ·±å…¥ï¼š</p>
<ul>
<li><strong>é«˜çº§å¨èƒç‹©çŒ</strong>:</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-8">
                                                <h2>8. R06: Frida Anti Debugging</h2>
                                                <h1>R06: Recipe: ç»•è¿‡ App å¯¹ Frida çš„æ£€æµ‹</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p><strong>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>è¿è¡Œ Frida å App ç«‹å³å´©æºƒæˆ–é—ªé€€</li>
<li>App æ˜¾ç¤º&quot;æ£€æµ‹åˆ°è°ƒè¯•å·¥å…·&quot;å¹¶æ‹’ç»è¿è¡Œ</li>
<li>Hook è„šæœ¬åŠ è½½å App æ— å“åº”æˆ–è¿›å…¥å®‰å…¨æ¨¡å¼</li>
<li>æŸäº›åŠŸèƒ½åœ¨ Frida ç¯å¢ƒä¸‹è¢«ç¦ç”¨</li>
<li>App é¢‘ç¹å¼¹çª—æç¤º&quot;è¿è¡Œç¯å¢ƒå¼‚å¸¸&quot;</li>
</ul>
<p><strong>æœ¬é…æ–¹æ•™ä½ </strong>ï¼šè¯†åˆ« Frida æ£€æµ‹æŠ€æœ¯ã€ä½¿ç”¨ Hook ç»•è¿‡æ£€æµ‹ã€å®šåˆ¶ Frida é¿å…ç‰¹å¾ã€‚</p>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š</p>
<blockquote>
<p><strong>ç”¨ Frida å¯¹æŠ—æ£€æµ‹ Frida</strong> - ä»¥å­ä¹‹çŸ›æ”»å­ä¹‹ç›¾</p>
<ul>
<li>åœ¨ App æ£€æµ‹ä¹‹å‰å°± Hook æ£€æµ‹å‡½æ•°</li>
<li>ä¿®æ”¹æ£€æµ‹ç»“æœè®©å®ƒ&quot;çœ‹ä¸è§&quot; Frida</li>
<li>æˆ–å¹²è„†éšè— Frida çš„æ‰€æœ‰ç‰¹å¾</li>
</ul>
</blockquote>
<p><strong>é¢„è®¡ç”¨æ—¶</strong>: 15-45 åˆ†é’Ÿï¼ˆå–å†³äºæ£€æµ‹å¤æ‚åº¦ï¼‰</p>
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<ul>
<li><strong>Frida</strong> - åŠ¨æ€æ’æ¡©æ¡†æ¶</li>
<li><strong>Android è®¾å¤‡</strong>ï¼ˆå·² Rootï¼‰</li>
<li><strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong> - ç¼–å†™ç»•è¿‡è„šæœ¬</li>
</ul>
<h3>å¯é€‰å·¥å…·</h3>
<ul>
<li><strong>jadx-gui</strong> - é™æ€åˆ†ææ£€æµ‹ä»£ç </li>
<li><strong>IDA Pro / Ghidra</strong> - Native å±‚æ£€æµ‹åˆ†æ</li>
<li><strong>å®šåˆ¶ç‰ˆ Frida</strong> - ç»ˆæè§£å†³æ–¹æ¡ˆ</li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h3>ç¡®è®¤æ¸…å•</h3>
<pre><code class="language-bash"># 1. Frida æ­£å¸¸è¿è¡Œ
frida-ps -U

# 2. èƒ½æ­£å¸¸ attachï¼ˆæ— æ£€æµ‹æ—¶ï¼‰
frida -U -f com.example.app

# 3. Root æƒé™å¯ç”¨
adb shell su
</code></pre>
<hr />
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h3>ç¬¬ 1 æ­¥ï¼šè¯†åˆ«æ£€æµ‹ç±»å‹ï¼ˆ5 åˆ†é’Ÿï¼‰</h3>
<h4>1.1 è§¦å‘æ£€æµ‹</h4>
<p><strong>è¿è¡Œ Frida å¹¶è§‚å¯Ÿç°è±¡</strong>ï¼š</p>
<pre><code class="language-bash"># ä½¿ç”¨ spawn æ¨¡å¼å¯åŠ¨ App
frida -U -f com.example.app --no-pause

# è§‚å¯Ÿè¾“å‡ºå’Œ App è¡Œä¸º
</code></pre>
<p><strong>æ£€æµ‹ç°è±¡å¯¹ç…§è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
  <th>ç°è±¡</th>
  <th>å¯èƒ½çš„æ£€æµ‹æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ç«‹å³é—ªé€€</td>
  <td>ç«¯å£æ‰«æã€è¿›ç¨‹åæ£€æµ‹</td>
</tr>
<tr>
  <td>å¼¹çª—&quot;æ£€æµ‹åˆ° Root/è°ƒè¯•&quot;</td>
  <td>æ¨¡å—åæ£€æµ‹ã€çº¿ç¨‹åæ£€æµ‹</td>
</tr>
<tr>
  <td>ç‰¹å®šåŠŸèƒ½è¢«ç¦ç”¨</td>
  <td>Inline Hook æ£€æµ‹</td>
</tr>
<tr>
  <td>éšæœºå´©æºƒ/å¡é¡¿</td>
  <td>å¤šé‡æ£€æµ‹ç»„åˆ</td>
</tr>
</tbody>
</table>
<h4>1.2 é™æ€åˆ†ææ£€æµ‹ä»£ç ï¼ˆå¯é€‰ï¼‰</h4>
<p><strong>ç”¨ jadx æœç´¢å…³é”®è¯</strong>ï¼š</p>
<pre><code class="language-text"># Frida ç‰¹å¾
frida
gum-js
27042

# æ£€æµ‹ç›¸å…³
/proc/self/maps
/proc/*/cmdline
pthread_create
connect
socket
</code></pre>
<p><strong>å…¸å‹æ£€æµ‹ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-java">public static boolean isFridaDetected() {
    // æ£€æŸ¥ç«¯å£
    if (checkPort(27042)) return true;

    // æ£€æŸ¥è¿›ç¨‹
    if (findProcess(&quot;frida-server&quot;)) return true;

    // æ£€æŸ¥æ¨¡å—
    if (checkMaps(&quot;frida-agent&quot;)) return true;

    return false;
}
</code></pre>
<h3>ç¬¬ 2 æ­¥ï¼šåŸºç¡€ç»•è¿‡ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<p><strong>é‡å‘½å frida-server</strong>ï¼š</p>
<pre><code class="language-bash"># ä¸‹è½½ frida-server
# é‡å‘½åä¸ºæ— å®³åå­—
mv frida-server-16.1.4-android-arm64 system_daemon

# æ¨é€åˆ°è®¾å¤‡
adb push system_daemon /data/local/tmp/
adb shell &quot;chmod 755 /data/local/tmp/system_daemon&quot;

# ä½¿ç”¨éæ ‡å‡†ç«¯å£å¯åŠ¨
adb shell &quot;/data/local/tmp/system_daemon -l 0.0.0.0:8888 &amp;&quot;
</code></pre>
<p><strong>ä½¿ç”¨ spawn æ¨¡å¼ï¼ˆé‡è¦ï¼‰</strong>ï¼š</p>
<pre><code class="language-bash"># æ¨èï¼šSpawn æ¨¡å¼ï¼ˆæœ€æ—©æ³¨å…¥ï¼‰
frida -U -f com.example.app -l bypass.js --no-pause

# ä¸æ¨èï¼šAttach æ¨¡å¼ï¼ˆæ£€æµ‹ä»£ç å¯èƒ½å·²è¿è¡Œï¼‰
frida -U com.example.app -l bypass.js
</code></pre>
<h3>ç¬¬ 3 æ­¥ï¼šé€šç”¨ç»•è¿‡è„šæœ¬</h3>
<pre><code class="language-javascript">Java.perform(function () {
    console.log(&quot;\n[Frida Anti-Detection] å·²å¯åŠ¨\n&quot;);

    // =====================================
    // 1. ç»•è¿‡ç«¯å£æ‰«ææ£€æµ‹
    // =====================================
    var connect = Module.findExportByName(&quot;libc.so&quot;, &quot;connect&quot;);
    if (connect) {
        Interceptor.attach(connect, {
            onEnter: function (args) {
                var sockaddr = ptr(args[1]);
                var family = sockaddr.readU16();

                if (family === 2) {
                    // AF_INET
                    var port = (sockaddr.add(2).readU8() &lt;&lt; 8) | sockaddr.add(3).readU8();
                    var ip = sockaddr.add(4).readU32();

                    // æ£€æµ‹æ˜¯å¦åœ¨æ‰«æ Frida é»˜è®¤ç«¯å£
                    if (port === 27042 || port === 27043) {
                        console.log(&quot;[Port] æ‹¦æˆªç«¯å£æ‰«æ: &quot; + port);
                        // ä¿®æ”¹ç«¯å£ä¸ºæ— æ•ˆç«¯å£
                        sockaddr.add(2).writeU8(0xff);
                        sockaddr.add(3).writeU8(0xff);
                    }
                }
            },
        });
        console.log(&quot;[Port] Hook connect() å®Œæˆ&quot;);
    }

    // =====================================
    // 2. ç»•è¿‡ /proc/self/maps æ£€æµ‹
    // =====================================
    var fgets = Module.findExportByName(&quot;libc.so&quot;, &quot;fgets&quot;);

    if (fgets) {
        Interceptor.attach(fgets, {
            onEnter: function (args) {
                this.buffer = args[0];
                this.fp = args[2];
            },
            onLeave: function (retval) {
                if (retval.isNull()) return;

                var line = this.buffer.readCString();
                if (line) {
                    // éšè— Frida ç›¸å…³æ¨¡å—
                    if (
                        line.includes(&quot;frida&quot;) ||
                        line.includes(&quot;gum-js&quot;) ||
                        line.includes(&quot;frida-agent&quot;)
                    ) {
                        console.log(&quot;[Maps] éšè—æ¨¡å—: &quot; + line.substring(0, 50) + &quot;...&quot;);
                        // æ›¿æ¢ä¸ºç©ºè¡Œ
                        this.buffer.writeUtf8String(&quot;\n&quot;);
                    }
                }
            },
        });
        console.log(&quot;[Maps] Hook fgets() å®Œæˆ&quot;);
    }

    // =====================================
    // 3. ç»•è¿‡ strstr å­—ç¬¦ä¸²æ£€æµ‹
    // =====================================
    var strstr = Module.findExportByName(&quot;libc.so&quot;, &quot;strstr&quot;);
    if (strstr) {
        Interceptor.attach(strstr, {
            onEnter: function (args) {
                this.haystack = args[0].readCString();
                this.needle = args[1].readCString();

                if (
                    this.needle &amp;&amp;
                    (this.needle.includes(&quot;frida&quot;) ||
                        this.needle.includes(&quot;gum-js&quot;) ||
                        this.needle === &quot;frida-agent&quot; ||
                        this.needle === &quot;frida-server&quot;)
                ) {
                    this.shouldBypass = true;
                }
            },
            onLeave: function (retval) {
                if (this.shouldBypass) {
                    console.log(&quot;[Strstr] éšè—å­—ç¬¦ä¸²: &quot; + this.needle);
                    retval.replace(ptr(0)); // è¿”å› NULLï¼ˆæœªæ‰¾åˆ°ï¼‰
                }
            },
        });
        console.log(&quot;[Strstr] Hook strstr() å®Œæˆ&quot;);
    }

    // =====================================
    // 4. ç»•è¿‡ Java å±‚æ£€æµ‹å‡½æ•°
    // =====================================
    setTimeout(function () {
        // æœç´¢å¸¸è§æ£€æµ‹å‡½æ•°å
        var detectNames = [
            &quot;isFridaDetected&quot;,
            &quot;checkFrida&quot;,
            &quot;detectDebugger&quot;,
            &quot;isHooked&quot;,
            &quot;checkRoot&quot;,
        ];

        Java.enumerateLoadedClasses({
            onMatch: function (className) {
                try {
                    var clazz = Java.use(className);
                    detectNames.forEach(function (methodName) {
                        if (clazz[methodName]) {
                            console.log(&quot;[Java] æ‰¾åˆ°æ£€æµ‹å‡½æ•°: &quot; + className + &quot;.&quot; + methodName);
                            clazz[methodName].implementation = function () {
                                console.log(&quot;[Java] æ‹¦æˆªè°ƒç”¨: &quot; + className + &quot;.&quot; + methodName);
                                return false; // è¿”å›&quot;æœªæ£€æµ‹åˆ°&quot;
                            };
                        }
                    });
                } catch (e) {}
            },
            onComplete: function () {
                console.log(&quot;[Java] ç±»æšä¸¾å®Œæˆ&quot;);
            },
        });
    }, 500);

    // =====================================
    // 5. ç»•è¿‡çº¿ç¨‹åæ£€æµ‹
    // =====================================
    var pthread_setname_np = Module.findExportByName(&quot;libc.so&quot;, &quot;pthread_setname_np&quot;);
    if (pthread_setname_np) {
        Interceptor.attach(pthread_setname_np, {
            onEnter: function (args) {
                var threadName = args[1].readCString();
                if (
                    threadName &amp;&amp;
                    (threadName.includes(&quot;gum-js&quot;) ||
                        threadName.includes(&quot;gmain&quot;) ||
                        threadName.includes(&quot;pool-&quot;))
                ) {
                    console.log(&quot;[Thread] ä¿®æ”¹çº¿ç¨‹å: &quot; + threadName + &quot; â†’ normal&quot;);
                    args[1].writeUtf8String(&quot;normal&quot;);
                }
            },
        });
        console.log(&quot;[Thread] Hook pthread_setname_np() å®Œæˆ&quot;);
    }

    console.log(&quot;\n[Frida Anti-Detection] æ‰€æœ‰ Hook å·²å°±ç»ª\n&quot;);
});
</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p>
<pre><code class="language-text">[Port] Hook connect() å®Œæˆ
[Maps] Hook fgets() å®Œæˆ
[Strstr] Hook strstr() å®Œæˆ
[Thread] Hook pthread_setname_np() å®Œæˆ
[Java] ç±»æšä¸¾å®Œæˆ
[Java] æ‰¾åˆ°æ£€æµ‹å‡½æ•°: com.example.SecurityCheck.isFridaDetected

[Frida Anti-Detection] æ‰€æœ‰ Hook å·²å°±ç»ª

[Port] æ‹¦æˆªç«¯å£æ‰«æ: 27042
[Strstr] éšè—å­—ç¬¦ä¸²: frida-agent
[Java] æ‹¦æˆªè°ƒç”¨: com.example.SecurityCheck.isFridaDetected
</code></pre>
<h3>ç¬¬ 4 æ­¥ï¼šé’ˆå¯¹æ€§ç»•è¿‡</h3>
<p><strong>å¦‚æœä½ æ‰¾åˆ°äº†æ£€æµ‹å‡½æ•°</strong>ï¼ˆä»ç¬¬ 1 æ­¥ï¼‰ï¼š</p>
<pre><code class="language-javascript">Java.perform(function () {
    var SecurityCheck = Java.use(&quot;com.example.app.SecurityCheck&quot;);

    // Hook æ£€æµ‹å‡½æ•°
    SecurityCheck.isFridaDetected.implementation = function () {
        console.log(&quot;Bypass isFridaDetected()&quot;);
        return false; // å§‹ç»ˆè¿”å›&quot;æœªæ£€æµ‹åˆ°&quot;
    };

    // æ‹¦æˆªå…¶ä»–æ£€æµ‹ç›¸å…³å‡½æ•°
    SecurityCheck.checkPort.implementation = function (port) {
        console.log(&quot;Bypass checkPort(&quot; + port + &quot;)&quot;);
        return false;
    };
});
</code></pre>
<h3>ç¬¬ 5 æ­¥ï¼šå®šåˆ¶ Fridaï¼ˆç»ˆææ–¹æ¡ˆï¼‰</h3>
<h4>5.1 ä¿®æ”¹æºç </h4>
<p><strong>å…‹éš† Frida</strong>ï¼š</p>
<pre><code class="language-bash">git clone --recurse-submodules https://github.com/frida/frida.git
cd frida
</code></pre>
<p><strong>ä¿®æ”¹ç‰¹å¾å­—ç¬¦ä¸²</strong>ï¼š</p>
<pre><code class="language-bash"># æ›¿æ¢æ¨¡å—å
find . -type f -exec sed -i 's/frida-agent/system-agent/g' {} +
find . -type f -exec sed -i 's/frida-server/system-daemon/g' {} +

# æ›¿æ¢çº¿ç¨‹å
find . -type f -exec sed -i 's/gum-js-loop/normal-thread/g' {} +
find . -type f -exec sed -i 's/gmain/worker/g' {} +
</code></pre>
<p><strong>ç¼–è¯‘</strong>ï¼š</p>
<pre><code class="language-bash">make
</code></pre>
<hr />
<h2>åŸç†è§£æ</h2>
<h3>Frida æ£€æµ‹ç‚¹åˆ†å¸ƒ</h3>
<pre><code class="language-text">æ£€æµ‹ç‚¹åˆ†å¸ƒï¼š
â”œâ”€â”€ 1. ç½‘ç»œå±‚
â”‚   â”œâ”€â”€ é»˜è®¤ç«¯å£: 27042, 27043
â”‚   â””â”€â”€ D-Bus åè®®ç‰¹å¾
â”œâ”€â”€ 2. è¿›ç¨‹å±‚
â”‚   â”œâ”€â”€ è¿›ç¨‹å: frida-server
â”‚   â””â”€â”€ å‘½ä»¤è¡Œå‚æ•°åŒ…å« &quot;frida&quot;
â”œâ”€â”€ 3. å†…å­˜å±‚
â”‚   â”œâ”€â”€ æ¨¡å—å: frida-agent.so, frida-gadget.so
â”‚   â”œâ”€â”€ çº¿ç¨‹å: gum-js-loop, gmain, pool-*
â”‚   â””â”€â”€ å‡½æ•° Hook: ä¿®æ”¹ç³»ç»Ÿå‡½æ•°å­—èŠ‚ç 
â””â”€â”€ 4. è¡Œä¸ºå±‚
    â””â”€â”€ D-Bus æ¶ˆæ¯ã€å¼‚å¸¸ç³»ç»Ÿè°ƒç”¨åºåˆ—
</code></pre>
<h3>ç»•è¿‡ç­–ç•¥å¯¹ç…§è¡¨</h3>
<table>
<thead>
<tr>
  <th>æ£€æµ‹æ–¹å¼</th>
  <th>ç»•è¿‡ç­–ç•¥</th>
</tr>
</thead>
<tbody>
<tr>
  <td>è¿›ç¨‹åæ£€æµ‹</td>
  <td>é‡å‘½å frida-server</td>
</tr>
<tr>
  <td>/proc/self/maps</td>
  <td>Hook <code>fgets()</code> è¿‡æ»¤è¾“å‡º</td>
</tr>
<tr>
  <td>å­—ç¬¦ä¸²æ£€æµ‹</td>
  <td>Hook <code>strstr()</code> è¿”å› NULL</td>
</tr>
<tr>
  <td>çº¿ç¨‹åæ£€æµ‹</td>
  <td>Hook <code>pthread_setname_np()</code></td>
</tr>
<tr>
  <td>Inline Hook æ£€æµ‹</td>
  <td>Hook æ£€æµ‹å‡½æ•°æœ¬èº«</td>
</tr>
<tr>
  <td>å¤šé‡ç»„åˆæ£€æµ‹</td>
  <td>å®šåˆ¶ Frida æºç </td>
</tr>
</tbody>
</table>
<h3>Hook æ—¶æœºå¾ˆé‡è¦</h3>
<pre><code class="language-text">App å¯åŠ¨æ—¶åºï¼š
        â†“
[0.5s] App é™æ€åˆå§‹åŒ–ä»£ç è¿è¡Œ
        â†“
[1s] App onCreate() å¼€å§‹
        â†“
[1.5s] âš ï¸ åè°ƒè¯•æ£€æµ‹é€šå¸¸åœ¨æ­¤è¿è¡Œ
        â†“
[2s] âŒ Attach æ¨¡å¼ï¼šFrida åœ¨æ­¤æ—¶æ‰æ³¨å…¥ï¼ˆå¤ªæ™šï¼‰
</code></pre>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>é—®é¢˜ 1: ç»•è¿‡è„šæœ¬ä¸ç”Ÿæ•ˆ</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šHook è„šæœ¬è¿è¡Œäº†ï¼Œä½† App ä»ç„¶æ£€æµ‹åˆ° Frida</p>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li><strong>Hook æ—¶æœºå¤ªæ™š</strong></li>
</ol>
<pre><code class="language-bash"># æ­£ç¡®ï¼š--no-pause ç«‹å³è¿è¡Œ
frida -U -f com.example.app -l bypass.js --no-pause

# é”™è¯¯ï¼šä¼šæš‚åœç­‰å¾…æ‰‹åŠ¨æ¢å¤
frida -U -f com.example.app -l bypass.js
</code></pre>
<ol start="2">
<li><p><strong>Native å±‚æ£€æµ‹æœªè¦†ç›–</strong></p>
<ul>
<li>ä½¿ç”¨ <code>frida-gadget</code> è€Œé <code>frida-server</code>ï¼ˆæ›´æ—©æ³¨å…¥ï¼‰</li>
</ul>
</li>
<li><p><strong>å­˜åœ¨æœªè¦†ç›–çš„æ£€æµ‹ç‚¹</strong></p>
<ul>
<li>ä½¿ç”¨ jadx åˆ†æå®Œæ•´çš„æ£€æµ‹é€»è¾‘</li>
</ul>
</li>
</ol>
<h3>é—®é¢˜ 2: Hook å App å´©æºƒ</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šåŠ è½½ Hook è„šæœ¬å App ç«‹å³å´©æºƒ</p>
<p><strong>æ£€æŸ¥</strong>ï¼š</p>
<ol>
<li><strong>Hook çš„å‡½æ•°ç­¾åé”™è¯¯</strong></li>
</ol>
<pre><code class="language-javascript">// æ£€æŸ¥é‡è½½
Java.use(&quot;ClassName&quot;).methodName.overloads.forEach(function (o) {
    console.log(o);
});
</code></pre>
<ol start="2">
<li><strong>è¿”å›å€¼ç±»å‹ä¸åŒ¹é…</strong></li>
</ol>
<pre><code class="language-javascript">// é”™è¯¯
SomeClass.returnsInt.implementation = function () {
    return &quot;string&quot;; // ç±»å‹é”™è¯¯ï¼
};

// æ­£ç¡®
SomeClass.returnsInt.implementation = function () {
    return 0;
};
</code></pre>
<ol start="3">
<li><strong>Hook å½±å“äº†æ­£å¸¸åŠŸèƒ½</strong><ul>
<li>æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼Œåª Hook ç‰¹å®šæƒ…å†µ</li>
</ul>
</li>
</ol>
<h3>é—®é¢˜ 3: æŸäº›æ£€æµ‹ç»•ä¸è¿‡å»</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šå°è¯•äº†æ‰€æœ‰æ–¹æ³•ï¼Œä»æœ‰æ£€æµ‹æœªç»•è¿‡</p>
<p><strong>é«˜çº§å¯¹ç­–</strong>ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨ frida-gadgetï¼ˆåµŒå…¥å¼ï¼‰</strong></li>
</ol>
<pre><code class="language-bash"># è§£åŒ… APK
apktool d app.apk

# å°† frida-gadget.so æ·»åŠ åˆ° lib/
# ä¿®æ”¹ AndroidManifest.xml å’Œ smali ä»£ç åŠ è½½ gadget
# å‚è€ƒï¼šhttps://frida.re/docs/gadget/

# é‡æ–°æ‰“åŒ…
apktool b app -o app_patched.apk
</code></pre>
<ol start="2">
<li><p><strong>ä½¿ç”¨é¢„ç¼–è¯‘çš„å®šåˆ¶ç‰ˆ</strong></p>
<ul>
<li>ç¤¾åŒºé¡¹ç›®ï¼šhttps://github.com/hluwa/strongR-frida-android</li>
<li>å·²é‡å‘½åæ‰€æœ‰ç‰¹å¾å­—ç¬¦ä¸²</li>
</ul>
</li>
<li><p><strong>ä½¿ç”¨ Docker ç¼–è¯‘ç¯å¢ƒ</strong></p>
</li>
</ol>
<pre><code class="language-bash">docker run --rm -v $(pwd):/work frida/ci
</code></pre>
<hr />
<h2>å»¶ä¼¸é˜…è¯»</h2>
<h3>ç›¸å…³é…æ–¹</h3>
<ul>
<li><strong><a href="#section-12">Root æ£€æµ‹ç»•è¿‡</a></strong> - é€šå¸¸ä¸ Frida æ£€æµ‹ä¸€èµ·å‡ºç°</li>
<li><strong><a href="#section-3-%E7%AC%AC-5-%E6%AD%A5%E7%BB%95%E8%BF%87-ssl-pinning%E5%A6%82%E9%81%87%E5%88%B0">SSL Pinning ç»•è¿‡</a></strong> - å¯èƒ½ä¹Ÿæœ‰å Frida</li>
<li><strong><a href="#section-12">æ¨¡æ‹Ÿå™¨æ£€æµ‹ç»•è¿‡</a></strong> - å¤šé‡æ£€æµ‹ç»„åˆ</li>
</ul>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><strong><a href="#section-40">Frida å®Œæ•´æŒ‡å—</a></strong></li>
<li><strong><a href="#section-41">Frida å†…éƒ¨åŸç†</a></strong> - ç†è§£æ£€æµ‹åŸç†</li>
</ul>
<h3>æ¡ˆä¾‹åˆ†æ</h3>
<ul>
<li><strong><a href="#section-50">ååˆ†ææŠ€æœ¯æ¡ˆä¾‹</a></strong></li>
<li><strong><a href="#section-52">ç¤¾äº¤åª’ä½“é£æ§</a></strong> - é«˜çº§æ£€æµ‹å¯¹æŠ—</li>
</ul>
<h3>è¿›é˜¶èµ„æº</h3>
<ul>
<li><strong>strongR-frida</strong>: https://github.com/hluwa/strongR-frida-android</li>
<li><strong>frida-gadget æ–‡æ¡£</strong>: https://frida.re/docs/gadget/</li>
<li><strong>ç¼–è¯‘ Frida</strong>: https://frida.re/docs/building/</li>
</ul>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>ä¸€é”®ç»•è¿‡è„šæœ¬</h3>
<p><strong>ä¸‹è½½é€šç”¨ç»•è¿‡è„šæœ¬</strong>ï¼š</p>
<pre><code class="language-bash"># ä½¿ç”¨ç¤¾åŒºç»´æŠ¤çš„ç»•è¿‡è„šæœ¬
curl -O https://raw.githubusercontent.com/0xdea/frida-scripts/master/raptor_frida_android_bypass.js

# è¿è¡Œ
frida -U -f com.example.app -l raptor_frida_android_bypass.js --no-pause
</code></pre>
<h3>æ£€æµ‹ç‚¹é€ŸæŸ¥è¡¨</h3>
<table>
<thead>
<tr>
  <th>æ£€æµ‹ç±»å‹</th>
  <th>æ£€æµ‹ä½ç½®</th>
  <th>ç»•è¿‡æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
  <td>è¿›ç¨‹å</td>
  <td><code>/proc/*/cmdline</code></td>
  <td>é‡å‘½å + Hook <code>fopen()</code></td>
</tr>
<tr>
  <td>æ¨¡å—å</td>
  <td><code>/proc/self/maps</code></td>
  <td>Hook <code>fgets()</code> è¿‡æ»¤</td>
</tr>
<tr>
  <td>å­—ç¬¦ä¸²</td>
  <td><code>strstr()</code></td>
  <td>Hook <code>strstr()</code></td>
</tr>
<tr>
  <td>çº¿ç¨‹å</td>
  <td><code>/proc/self/task/*/comm</code></td>
  <td>Hook <code>pthread_setname_np()</code></td>
</tr>
<tr>
  <td>Java æ£€æµ‹</td>
  <td><code>isFridaDetected()</code></td>
  <td>Hook æ£€æµ‹å‡½æ•°</td>
</tr>
</tbody>
</table>
<h3>å¸¸ç”¨å‘½ä»¤</h3>
<pre><code class="language-bash"># éæ ‡å‡†ç«¯å£è¿è¡Œ frida-server
adb shell &quot;/data/local/tmp/frida -l 0.0.0.0:8888 &amp;&quot;

# è¿æ¥åˆ°éæ ‡å‡†ç«¯å£
frida -H 127.0.0.1:8888 -f com.example.app

# Spawn æ¨¡å¼ï¼ˆé‡è¦ï¼‰
frida -U -f com.example.app -l bypass.js --no-pause

# åˆ—å‡ºæ‰€æœ‰æ¨¡å—ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰ frida-agentï¼‰
frida -U -f com.example.app -e 'Process.enumerateModules()'

# åˆ—å‡ºæ‰€æœ‰çº¿ç¨‹ï¼ˆæ£€æŸ¥çº¿ç¨‹åï¼‰
frida -U -f com.example.app -e 'Process.enumerateThreads()'
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-9">
                                                <h2>9. R07: Xposed Anti Debugging</h2>
                                                <h1>R07: Recipe: ç»•è¿‡åº”ç”¨çš„ Xposed æ£€æµ‹</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p>ä½ å¯èƒ½é‡åˆ°ä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li><strong>App å¯åŠ¨å³é€€å‡º</strong>ï¼šApp å¯åŠ¨åå¼¹å‡º&quot;æ£€æµ‹åˆ° Xposed æ¡†æ¶ï¼Œç¦æ­¢è¿è¡Œ&quot;ï¼Œéšå³é—ªé€€</li>
<li><strong>åŠŸèƒ½å—é™</strong>ï¼šé‡‘è/æ”¯ä»˜ç±» App æ£€æµ‹åˆ° Xposed åæ‹’ç»æä¾›æœåŠ¡ï¼ˆæ— æ³•è½¬è´¦ã€æ”¯ä»˜ï¼‰</li>
<li><strong>è´¦å·å°ç¦</strong>ï¼šæ¸¸æˆæ£€æµ‹åˆ° Xposed ç¯å¢ƒåè§¦å‘é£æ§ï¼Œå¯¼è‡´å°å·</li>
<li><strong>åˆ†æå—é˜»</strong>ï¼šéœ€è¦åœ¨ Xposed ç¯å¢ƒä¸‹åˆ†æ App è¡Œä¸ºï¼Œä½†è¢«åè°ƒè¯•æ‹¦æˆª</li>
<li><strong>é€šç”¨æ–¹æ¡ˆå¤±æ•ˆ</strong>ï¼šå·²ç»ä½¿ç”¨ RootCloak Plus ç­‰é€šç”¨éšè—æ¨¡å—ï¼Œä½†ä»è¢«æ£€æµ‹åˆ°</li>
</ol>
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<ul>
<li><strong>Xposed æ¡†æ¶</strong>ï¼šEdXposed æˆ– LSPosedï¼ˆæ¨è LSPosedï¼Œæ›´ç¨³å®šï¼‰</li>
<li><strong>Root è®¾å¤‡</strong>ï¼šå·² Root çš„ Android è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ï¼ˆå¦‚ Genymotionï¼‰</li>
<li><strong>ç›®æ ‡ APK</strong>ï¼šéœ€è¦ç»•è¿‡æ£€æµ‹çš„åº”ç”¨å®‰è£…åŒ…</li>
<li><strong>Xposed æ¨¡å—å¼€å‘ç¯å¢ƒ</strong>ï¼šAndroid Studioï¼ˆç”¨äºç¼–å†™è‡ªå®šä¹‰ç»•è¿‡æ¨¡å—ï¼‰</li>
</ul>
<h3>å¯é€‰å·¥å…·</h3>
<ul>
<li><strong>JEB/Jadx</strong>ï¼šåç¼–è¯‘å·¥å…·ï¼Œç”¨äºåˆ†æ App çš„æ£€æµ‹ä»£ç </li>
<li><strong>RootCloak Plus</strong>ï¼šé€šç”¨ Xposed/Root éšè—æ¨¡å—ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰</li>
<li><strong>Hide My Applist</strong>ï¼šé«˜çº§åº”ç”¨åˆ—è¡¨å’Œæ¡†æ¶éšè—å·¥å…·</li>
<li><strong>MT Manager</strong>ï¼šAndroid æ–‡ä»¶ç®¡ç†å™¨ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ–‡ä»¶</li>
<li><strong>Xposed æºç </strong>ï¼šEdXposed æºç ï¼ˆå®šåˆ¶åŒ–æ¡†æ¶éœ€æ±‚ï¼‰</li>
</ul>
<h2>å‰ç½®æ¡ä»¶</h2>
<p>å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š</p>
<ul>
<li><strong>å·²å®‰è£… Xposed æ¡†æ¶</strong>ï¼šè®¾å¤‡ä¸Šå·²åˆ·å…¥ EdXposed æˆ– LSPosedï¼Œå¹¶èƒ½æ­£å¸¸ä½¿ç”¨</li>
<li><strong>è®¾å¤‡å·² Root</strong>ï¼šæ‹¥æœ‰ Root æƒé™ï¼Œæˆ–ä½¿ç”¨è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ˆå¦‚ VirtualXposedï¼‰</li>
<li><strong>èƒ½åç¼–è¯‘ APK</strong>ï¼šä¼šä½¿ç”¨ Jadx/JEB æŸ¥çœ‹ Java ä»£ç </li>
<li><strong>äº†è§£ Xposed Hook åŸºç¡€</strong>ï¼šçŸ¥é“å¦‚ä½•ç¼–å†™ç®€å•çš„ Xposed æ¨¡å—ï¼ˆå¯å‚è€ƒ <a href="#section-42">Xposed Guide</a>ï¼‰</li>
<li><strong>äº†è§£ Java åå°„æœºåˆ¶</strong>ï¼šç†è§£ <code>Class.forName()</code>, <code>ClassLoader</code> ç­‰æ¦‚å¿µ</li>
</ul>
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h3>ç¬¬ 1 æ­¥ï¼šè¯†åˆ«æ£€æµ‹ç±»å‹ï¼ˆ15-30 åˆ†é’Ÿï¼‰</h3>
<p>é¦–å…ˆéœ€è¦ç¡®å®š App ä½¿ç”¨äº†å“ªç§æ£€æµ‹æ–¹æ³•ï¼Œè¿™å†³å®šäº†åç»­çš„ç»•è¿‡ç­–ç•¥ã€‚</p>
<h4>æ–¹æ³• 1ï¼šè§‚å¯Ÿè¿è¡Œè¡Œä¸º</h4>
<p>è¿è¡Œç›®æ ‡ Appï¼Œè§‚å¯Ÿå¼‚å¸¸è¡Œä¸ºçš„æ—¶æœºå’Œç‰¹å¾ï¼š</p>
<table>
<thead>
<tr>
  <th>å¼‚å¸¸æ—¶æœº</th>
  <th>å¯èƒ½çš„æ£€æµ‹ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å¯åŠ¨é˜¶æ®µç«‹å³å´©æºƒ/é€€å‡º</strong></td>
  <td>è°ƒç”¨æ ˆæ£€æµ‹ï¼ˆApplication.onCreate ä¸­ï¼‰</td>
</tr>
<tr>
  <td><strong>ç‰¹å®šåŠŸèƒ½ï¼ˆç™»å½•ã€æ”¯ä»˜ï¼‰å—é™</strong></td>
  <td>å…³é”®æ–¹æ³•å¤„çš„å®šç‚¹æ£€æµ‹</td>
</tr>
<tr>
  <td><strong>å»¶è¿Ÿå‡ ç§’åå¼¹å‡ºè­¦å‘Š</strong></td>
  <td>å®šæ—¶å™¨æˆ–å¼‚æ­¥çº¿ç¨‹ä¸­çš„æ£€æµ‹</td>
</tr>
<tr>
  <td><strong>éšæœºè§¦å‘</strong></td>
  <td>å¤šç‚¹åˆ†æ•£æ£€æµ‹æˆ–æ··æ·†åçš„æ£€æµ‹</td>
</tr>
</tbody>
</table>
<h4>æ–¹æ³• 2ï¼šé™æ€åˆ†ææ£€æµ‹ä»£ç </h4>
<p>ä½¿ç”¨ Jadx åç¼–è¯‘ APKï¼Œæœç´¢ Xposed æ£€æµ‹çš„ç‰¹å¾å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-bash"># åç¼–è¯‘ APK
jadx -d ./decompiled target.apk

# æœç´¢ Xposed ç›¸å…³ç‰¹å¾
cd decompiled
grep -r &quot;xposed&quot; --include=&quot;*.java&quot; .
grep -r &quot;XposedBridge&quot; --include=&quot;*.java&quot; .
grep -r &quot;de.robv.android&quot; --include=&quot;*.java&quot; .

# æœç´¢æ£€æµ‹æ–¹æ³•è°ƒç”¨
grep -r &quot;getStackTrace&quot; --include=&quot;*.java&quot; .
grep -r &quot;Class.forName&quot; --include=&quot;*.java&quot; .
grep -r &quot;/proc/self/maps&quot; --include=&quot;*.java&quot; .
</code></pre>
<p><strong>å¸¸è§æ£€æµ‹ä»£ç æ¨¡å¼</strong>ï¼š</p>
<p><strong>è°ƒç”¨æ ˆæ£€æµ‹</strong>ï¼š</p>
<pre><code class="language-java">// ç‰¹å¾ä»£ç 
try {
    throw new Exception(&quot;Xposed Detection&quot;);
} catch (Exception e) {
    for (StackTraceElement element : e.getStackTrace()) {
        if (element.getClassName().contains(&quot;de.robv.android.xposed&quot;)) {
            // Xposed æ£€æµ‹åˆ°!
            return true;
        }
    }
}
</code></pre>
<p><strong>ç±»åŠ è½½æ£€æµ‹</strong>ï¼š</p>
<pre><code class="language-java">try {
    Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;);
    // å¦‚æœæ²¡æŠ›å¼‚å¸¸ï¼Œè¯´æ˜ Xposed å­˜åœ¨
    return true;
} catch (ClassNotFoundException e) {
    return false;
}
</code></pre>
<p><strong>æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹</strong>ï¼š</p>
<pre><code class="language-java">File xposedJar = new File(&quot;/system/framework/XposedBridge.jar&quot;);
if (xposedJar.exists()) {
    // Xposed æ£€æµ‹åˆ°!
}
</code></pre>
<p><strong>Native å±‚æ£€æµ‹</strong>ï¼š</p>
<pre><code class="language-c">// maps æ–‡ä»¶æ£€æµ‹
FILE* fp = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
// è¯»å–å†…å®¹å¹¶æŸ¥æ‰¾ &quot;libxposed_art.so&quot; æˆ– &quot;XposedBridge&quot;

// ç¬¦å·åœ°å€æ£€æµ‹
void* handle = dlopen(&quot;libart.so&quot;, RTLD_NOW);
void* sym = dlsym(handle, &quot;_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjjPNS_6JValueEPKc&quot;);
// æ£€æŸ¥åœ°å€æ˜¯å¦åœ¨éæ ‡å‡†å†…å­˜åŒºåŸŸ
</code></pre>
<h4>æ–¹æ³• 3ï¼šé€‰æ‹©ç»•è¿‡ç­–ç•¥</h4>
<p>æ ¹æ®æ£€æµ‹ç±»å‹é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼š</p>
<table>
<thead>
<tr>
  <th>æ£€æµ‹ç±»å‹</th>
  <th>æ¨èç­–ç•¥</th>
  <th>æˆåŠŸç‡</th>
  <th>è€—æ—¶</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Java å±‚è°ƒç”¨æ ˆæ£€æµ‹</td>
  <td>Hook <code>StackTraceElement.getClassName()</code></td>
  <td>90%</td>
  <td>30min</td>
</tr>
<tr>
  <td>Java å±‚ç±»åŠ è½½æ£€æµ‹</td>
  <td>Hook <code>Class.forName()</code></td>
  <td>85%</td>
  <td>20min</td>
</tr>
<tr>
  <td>æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹</td>
  <td>Hook <code>File.exists()</code></td>
  <td>95%</td>
  <td>20min</td>
</tr>
<tr>
  <td>Native å±‚ maps æ£€æµ‹</td>
  <td>Hook <code>fopen()</code> / å®šåˆ¶æ¡†æ¶</td>
  <td>60%</td>
  <td>2-4h</td>
</tr>
<tr>
  <td>ç»¼åˆæ£€æµ‹ï¼ˆå¤šç§æ–¹æ³•ï¼‰</td>
  <td>å®šåˆ¶åŒ– Xposed æ¡†æ¶</td>
  <td>80%</td>
  <td>4h+</td>
</tr>
</tbody>
</table>
<p><strong>å†³ç­–æ ‘</strong>ï¼š</p>
<pre><code class="language-text">æ£€æµ‹ç±»å‹å·²çŸ¥ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ç­–ç•¥ Aï¼šç¼–å†™é’ˆå¯¹æ€§ Hook æ¨¡å—
â””â”€ å¦ â†’ å¿«é€Ÿæµ‹è¯•éœ€æ±‚æˆ–ä¸æƒ³å†™ä»£ç 
         â””â”€â†’ ç­–ç•¥ Bï¼šä½¿ç”¨ç°æˆéšè—æ¨¡å—ï¼ˆæœ€å¿«ï¼‰
</code></pre>
<h3>ç¬¬ 2 æ­¥ï¼šç­–ç•¥ A - ç¼–å†™è‡ªå®šä¹‰ç»•è¿‡æ¨¡å—</h3>
<p>åˆ›å»º <code>AntiXposedDetection.java</code>ï¼š</p>
<pre><code class="language-java">package com.example.antidetect;

import android.os.Bundle;
import de.robv.android.xposed.*;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;
import java.io.File;

public class AntiXposedDetection implements IXposedHookLoadPackage {

    // ä¿®æ”¹ä¸ºä½ çš„ç›®æ ‡ App åŒ…å
    private static final String TARGET_PACKAGE = &quot;com.target.app&quot;;

    @Override
    public void handleLoadPackage(LoadPackageParam lpparam) throws Throwable {
        // åª Hook ç›®æ ‡ App
        if (!lpparam.packageName.equals(TARGET_PACKAGE)) return;

        XposedBridge.log(&quot;[AntiDetect] å¼€å§‹ Hook &quot; + TARGET_PACKAGE);

        // ç»•è¿‡è°ƒç”¨æ ˆæ£€æµ‹
        hookStackTrace();

        // ç»•è¿‡ç±»åŠ è½½æ£€æµ‹
        hookClassForName();

        // ç»•è¿‡æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹
        hookFileExists();

        // ç»•è¿‡ç³»ç»Ÿå±æ€§æ£€æµ‹
        hookSystemProperties();

        XposedBridge.log(&quot;[AntiDetect] æ‰€æœ‰ Hook å·²æ¿€æ´»&quot;);
    }

    /**
     * ç»•è¿‡è°ƒç”¨æ ˆæ£€æµ‹
     * åŸç†ï¼šä¿®æ”¹ StackTraceElement.getClassName() è¿”å›å€¼
     */
    private void hookStackTrace() {
        XposedHelpers.findAndHookMethod(
            StackTraceElement.class,
            &quot;getClassName&quot;,
            new XC_MethodHook() {
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    String originalClassName = (String) param.getResult();

                    // å¦‚æœç±»ååŒ…å« xposed ç‰¹å¾ï¼Œæ›¿æ¢ä¸ºæ— å®³ç³»ç»Ÿç±»
                    if (originalClassName != null &amp;&amp;
                        originalClassName.toLowerCase().contains(&quot;xposed&quot;)) {
                        param.setResult(&quot;com.android.internal.os.ZygoteInit&quot;);
                        XposedBridge.log(&quot;[AntiDetect] éšè—è°ƒç”¨æ ˆ: &quot; + originalClassName);
                    }
                }
            }
        );
    }

    /**
     * ç»•è¿‡ç±»åŠ è½½æ£€æµ‹
     * åŸç†ï¼šæ‹¦æˆª Class.forName() è°ƒç”¨ï¼Œå¯¹ Xposed ç±»æŠ›å‡º ClassNotFoundException
     */
    private void hookClassForName() {
        XposedHelpers.findAndHookMethod(
            Class.class,
            &quot;forName&quot;,
            String.class,
            new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    String className = (String) param.args[0];

                    // å¦‚æœå°è¯•åŠ è½½ Xposed ç›¸å…³ç±»ï¼ŒæŠ›å‡º ClassNotFoundException
                    if (className != null &amp;&amp;
                        (className.contains(&quot;xposed&quot;) ||
                         className.contains(&quot;Xposed&quot;) ||
                         className.contains(&quot;EdXposed&quot;) ||
                         className.contains(&quot;LSPosed&quot;))) {
                        param.setThrowable(new ClassNotFoundException(className));
                        XposedBridge.log(&quot;[AntiDetect] é˜»æ­¢åŠ è½½ç±»: &quot; + className);
                    }
                }
            }
        );

        // ä¹Ÿæ‹¦æˆªä¸‰å‚æ•°ç‰ˆæœ¬ forName
        XposedHelpers.findAndHookMethod(
            Class.class,
            &quot;forName&quot;,
            String.class,
            boolean.class,
            ClassLoader.class,
            new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    String className = (String) param.args[0];
                    if (className != null &amp;&amp; className.toLowerCase().contains(&quot;xposed&quot;)) {
                        param.setThrowable(new ClassNotFoundException(className));
                    }
                }
            }
        );
    }

    /**
     * ç»•è¿‡æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹
     * åŸç†ï¼šä¿®æ”¹ File.exists() è¿”å›å€¼ï¼Œéšè— Xposed ç‰¹å¾æ–‡ä»¶
     */
    private void hookFileExists() {
        XposedHelpers.findAndHookMethod(
            File.class,
            &quot;exists&quot;,
            new XC_MethodHook() {
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    File file = (File) param.thisObject;
                    String path = file.getAbsolutePath();

                    // Xposed ç‰¹å¾æ–‡ä»¶åˆ—è¡¨
                    String[] xposedPaths = {
                        &quot;XposedBridge&quot;,
                        &quot;xposed&quot;,
                        &quot;de.robv.android.xposed&quot;,
                        &quot;EdXposed&quot;,
                        &quot;LSPosed&quot;,
                        &quot;libxposed&quot;,
                        &quot;libedxposed&quot;,
                        &quot;liblspd&quot;
                    };

                    // æ£€æŸ¥è·¯å¾„æ˜¯å¦åŒ…å«ç‰¹å¾
                    for (String keyword : xposedPaths) {
                        if (path.contains(keyword)) {
                            param.setResult(false); // ä¼ªè£…æ–‡ä»¶ä¸å­˜åœ¨
                            XposedBridge.log(&quot;[AntiDetect] éšè—æ–‡ä»¶: &quot; + path);
                            return;
                        }
                    }
                }
            }
        );
    }

    /**
     * ç»•è¿‡ç³»ç»Ÿå±æ€§æ£€æµ‹
     * åŸç†ï¼šæ‹¦æˆª System.getProperty() è°ƒç”¨
     */
    private void hookSystemProperties() {
        XposedHelpers.findAndHookMethod(
            System.class,
            &quot;getProperty&quot;,
            String.class,
            new XC_MethodHook() {
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    String key = (String) param.args[0];

                    // VirtualXposed ç­‰ä¼šè®¾ç½®ç‰¹æ®Šå±æ€§
                    if (key != null &amp;&amp;
                        (key.contains(&quot;xposed&quot;) ||
                         key.contains(&quot;vxp&quot;) ||
                         key.equals(&quot;ro.build.version.xposed&quot;))) {
                        param.setResult(null); // è¿”å› null
                        XposedBridge.log(&quot;[AntiDetect] éšè—ç³»ç»Ÿå±æ€§: &quot; + key);
                    }
                }
            }
        );
    }
}
</code></pre>
<p><strong>é¡¹ç›®ç»“æ„</strong>ï¼š</p>
<pre><code class="language-text">AntiXposedDetection/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ src/main/
â”‚       â”œâ”€â”€ AndroidManifest.xml
â”‚       â”œâ”€â”€ assets/
â”‚       â”‚   â””â”€â”€ xposed_init  # å…¥å£ç±»å£°æ˜
â”‚       â””â”€â”€ java/com/example/antidetect/
â”‚           â””â”€â”€ AntiXposedDetection.java
â”‚   â””â”€â”€ build.gradle
â””â”€â”€ build.gradle
</code></pre>
<p><strong>AndroidManifest.xml</strong>ï¼š</p>
<pre><code class="language-xml">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;com.example.antidetect&quot;&gt;

    &lt;application
        android:allowBackup=&quot;true&quot;
        android:label=&quot;Anti Xposed Detection&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;&gt;

        &lt;!-- Xposed æ¨¡å—å£°æ˜ --&gt;
        &lt;meta-data
            android:name=&quot;xposedmodule&quot;
            android:value=&quot;true&quot; /&gt;
        &lt;meta-data
            android:name=&quot;xposeddescription&quot;
            android:value=&quot;Hide Xposed from target app&quot; /&gt;
        &lt;meta-data
            android:name=&quot;xposedminversion&quot;
            android:value=&quot;54&quot; /&gt;
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre>
<p><strong>ç¼–è¯‘å’Œå®‰è£…</strong>ï¼š</p>
<pre><code class="language-bash"># 1. ç¼–è¯‘æ¨¡å—
./gradlew assembleRelease

# 2. å®‰è£…åˆ°è®¾å¤‡
adb install app/build/outputs/apk/release/app-release.apk

# 3. åœ¨ LSPosed/EdXposed ä¸­æ¿€æ´»æ¨¡å—
# - æ‰“å¼€ LSPosed Manager
# - æ¨¡å— â†’ æ‰¾åˆ° &quot;Anti Xposed æ£€æµ‹&quot;
# - å‹¾é€‰å¯ç”¨ï¼Œå¹¶åœ¨ä½œç”¨åŸŸä¸­æ·»åŠ ç›®æ ‡ App
# - é‡å¯ç›®æ ‡ App

# 4. æŸ¥çœ‹æ—¥å¿—éªŒè¯
adb logcat -s Xposed:V | grep AntiDetect
</code></pre>
<h3>ç¬¬ 3 æ­¥ï¼šç­–ç•¥ B - ä½¿ç”¨ç°æˆéšè—æ¨¡å—</h3>
<ol>
<li><p><strong>Hide My Applist</strong>ï¼ˆæœ€å¼ºå¤§ï¼Œæ¨èï¼‰</p>
<ul>
<li>ä¸‹è½½ï¼š<a href="https://github.com/Dr-TSNG/Hide-My-Applist">GitHub</a></li>
<li>åŠŸèƒ½ï¼šéšè—åº”ç”¨åˆ—è¡¨ã€Xposed æ¡†æ¶ã€Root</li>
<li>æ”¯æŒé»‘ç™½åå•ã€æ¨¡æ¿ç³»ç»Ÿ</li>
</ul>
</li>
<li><p><strong>XposedChecker Bypass</strong></p>
<ul>
<li>ä¸“é—¨é’ˆå¯¹ XposedChecker è¿™ç±»æ£€æµ‹å·¥å…·</li>
<li>è¦†ç›–å¸¸è§æ£€æµ‹ç‚¹</li>
</ul>
</li>
<li><p><strong>RootCloak Plus</strong>ï¼ˆè€ç‰Œæ¨¡å—ï¼‰</p>
<ul>
<li>åŒæ—¶éšè— Root å’Œ Xposed</li>
<li>é…ç½®ç®€å•ï¼Œä½†å¯¹æ–°å‹æ£€æµ‹æ•ˆæœè¾ƒå·®</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼ˆä»¥ Hide My Applist ä¸ºä¾‹ï¼‰</strong>ï¼š</p>
<pre><code class="language-bash"># 1. ä¸‹è½½å¹¶å®‰è£…
# ä» GitHub å‘å¸ƒé¡µä¸‹è½½æœ€æ–° APK
adb install HideMyApplist.apk

# 2. åœ¨ LSPosed ä¸­æ¿€æ´»
# LSPosed ç®¡ç†å™¨ â†’ æ¨¡å— â†’ Hide My Applist â†’ å‹¾é€‰å¯ç”¨

# 3. é…ç½®éšè—è§„åˆ™
# æ‰“å¼€ Hide My Applist App
# â†’ æ¨¡æ¿ç®¡ç† â†’ æ–°å»ºæ¨¡æ¿
# â†’ é€‰æ‹©éšè—å†…å®¹ï¼š
#   é»‘åå•æ¨¡å¼ï¼ˆéšè— Xposed ç›¸å…³ï¼‰
#   éšè— Xposed æ¨¡å—
#   éšè—ç³»ç»Ÿæ¡†æ¶
# â†’ åº”ç”¨ç®¡ç† â†’ é€‰æ‹©ç›®æ ‡ App â†’ åº”ç”¨æ¨¡æ¿

# 4. é‡å¯ç›®æ ‡ App
adb shell am force-stop com.target.app
adb shell am start -n com.target.app/.MainActivity
</code></pre>
<h3>ç¬¬ 4 æ­¥ï¼šç­–ç•¥ C - å®šåˆ¶ Xposed æ¡†æ¶</h3>
<p>å½“ Hook ç»•è¿‡æ— æ•ˆæ—¶ï¼Œå¯èƒ½éœ€è¦ä»æºç å±‚é¢ä¿®æ”¹ Xposed ç‰¹å¾ã€‚</p>
<p><strong>ä¿®æ”¹ç›®æ ‡</strong>ï¼š</p>
<ul>
<li>åŒ…åï¼š<code>de.robv.android.xposed</code> â†’ <code>com.myfw.custom</code></li>
<li>ç±»åï¼š<code>XposedBridge</code> â†’ <code>CustomBridge</code></li>
<li>æ–‡ä»¶åï¼š<code>libxposed_art.so</code> â†’ <code>libcustom_art.so</code></li>
<li>ç³»ç»Ÿå±æ€§ï¼š<code>persist.xposed.*</code> â†’ <code>persist.myfw.*</code></li>
</ul>
<p><strong>è¯¦ç»†æ­¥éª¤</strong>ï¼š</p>
<p><strong>1. è·å– Xposed æºç </strong>ï¼š</p>
<pre><code class="language-bash"># å…‹éš† EdXposed æºç ï¼ˆæ¨èï¼Œæ¯”åŸç‰ˆ Xposed æ›´æ´»è·ƒï¼‰
git clone --recursive https://github.com/ElderDrivers/EdXposed
cd EdXposed

# ä¹Ÿå¯ä»¥å…‹éš† LSPosedï¼ˆæ›´ç°ä»£å®ç°ï¼‰
git clone --recursive https://github.com/LSPosed/LSPosed
</code></pre>
<p><strong>2. ä¿®æ”¹ç‰¹å¾å­—ç¬¦ä¸²</strong>ï¼ˆåˆ›å»ºè„šæœ¬ <code>rename_xposed.sh</code>ï¼‰ï¼š</p>
<pre><code class="language-bash">#!/bin/bash

# å…¨å±€æ›¿æ¢ Xposed ç‰¹å¾ä¸ºè‡ªå®šä¹‰åç§°
OLD_PACKAGE=&quot;de.robv.android.xposed&quot;
NEW_PACKAGE=&quot;com.myframework.custom&quot;

OLD_CLASS=&quot;Xposed&quot;
NEW_CLASS=&quot;Custom&quot;

OLD_LIB=&quot;xposed&quot;
NEW_LIB=&quot;myfw&quot;

echo &quot;å¼€å§‹æ›¿æ¢ Xposed ç‰¹å¾...&quot;

# 1. æ›¿æ¢åŒ…å
echo &quot;æ›¿æ¢åŒ…å...&quot;
find . -type f \( -name &quot;*.java&quot; -o -name &quot;*.cpp&quot; -o -name &quot;*.h&quot; \) \
    -exec sed -i &quot;s/$OLD_PACKAGE/$NEW_PACKAGE/g&quot; {} +

# 2. æ›¿æ¢ç±»å
echo &quot;æ›¿æ¢ç±»å...&quot;
find . -type f -name &quot;*.java&quot; \
    -exec sed -i &quot;s/${OLD_CLASS}Bridge/${NEW_CLASS}Bridge/g&quot; {} +
find . -type f -name &quot;*.java&quot; \
    -exec sed -i &quot;s/${OLD_CLASS}Helpers/${NEW_CLASS}Helpers/g&quot; {} +

# 3. é‡å‘½åæ–‡ä»¶
echo &quot;é‡å‘½åæ–‡ä»¶...&quot;
find . -name &quot;*Xposed*&quot; | while read file; do
    newfile=$(echo &quot;$file&quot; | sed &quot;s/Xposed/Custom/g&quot;)
    mv &quot;$file&quot; &quot;$newfile&quot; 2&gt;/dev/null
done

# 4. æ›¿æ¢åº“æ–‡ä»¶å
echo &quot;æ›¿æ¢ Native åº“å...&quot;
find . -type f \( -name &quot;*.cpp&quot; -o -name &quot;*.mk&quot; -o -name &quot;CMakeLists.txt&quot; \) \
    -exec sed -i &quot;s/lib${OLD_LIB}/lib${NEW_LIB}/g&quot; {} +

# 5. æ›¿æ¢ç³»ç»Ÿå±æ€§å
echo &quot;æ›¿æ¢ç³»ç»Ÿå±æ€§...&quot;
find . -type f \( -name &quot;*.cpp&quot; -o -name &quot;*.java&quot; \) \
    -exec sed -i &quot;s/persist.xposed/persist.myfw/g&quot; {} + \
    -exec sed -i &quot;s/ro.xposed/ro.myfw/g&quot; {} +

echo &quot;ç‰¹å¾æ›¿æ¢å®Œæˆï¼&quot;
echo &quot;è¯·æ‰‹åŠ¨æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š&quot;
echo &quot;  - AndroidManifest.xml&quot;
echo &quot;  - module.prop (Magisk æ¨¡å—é…ç½®)&quot;
echo &quot;  - build.gradle&quot;
</code></pre>
<p><strong>3. ä¿®æ”¹ module.prop</strong>ï¼ˆMagisk æ¨¡å—é…ç½®ï¼‰ï¼š</p>
<pre><code class="language-properties">id=custom_xposed
name=Custom Framework (Xposed)
version=v1.0.0
versionCode=1
author=YourName
description=Customized Xposed Framework with renamed signatures
minMagisk=21000
</code></pre>
<p><strong>4. ç¼–è¯‘å®šåˆ¶ç‰ˆæ¡†æ¶</strong>ï¼š</p>
<pre><code class="language-bash"># æ‰§è¡Œæ›¿æ¢
./rename_xposed.sh

# ç¼–è¯‘ï¼ˆä»¥ EdXposed ä¸ºä¾‹ï¼‰
cd EdXposed
./gradlew :edxp-core:buildAll

# è¾“å‡ºä½äº out/edxp-core/release/
# è·å–ä¸€ä¸ª .zip æ–‡ä»¶ï¼Œå¯åœ¨ Magisk ä¸­åˆ·å…¥
</code></pre>
<p><strong>5. å®‰è£…å®šåˆ¶ç‰ˆæ¡†æ¶</strong>ï¼š</p>
<pre><code class="language-bash"># æ–¹æ³• 1ï¼šé€šè¿‡ Magisk ç®¡ç†å™¨å®‰è£…
# æ‰“å¼€ Magisk ç®¡ç†å™¨ â†’ æ¨¡å— â†’ ä»æœ¬åœ°å®‰è£… â†’ é€‰æ‹© ZIP

# æ–¹æ³• 2ï¼šé€šè¿‡ TWRP Recovery åˆ·å…¥ï¼ˆå¦‚æœ‰ï¼‰
# adb reboot recovery
# åœ¨ TWRP ä¸­é€‰æ‹© Install â†’ é€‰æ‹© ZIP â†’ æ»‘åŠ¨ç¡®è®¤

# é‡å¯è®¾å¤‡
adb reboot
</code></pre>
<h3>ç¬¬ 5 æ­¥ï¼šéªŒè¯ç»•è¿‡æ•ˆæœ</h3>
<p><strong>éªŒè¯æ¸…å•</strong>ï¼š</p>
<ul>
<li><strong>ç›®æ ‡ App æ­£å¸¸è¿è¡Œ</strong>ï¼šä¸å†å¼¹å‡ºæ£€æµ‹è­¦å‘Šï¼Œä¸é—ªé€€</li>
<li><strong>Xposed Hook ä¾ç„¶ç”Ÿæ•ˆ</strong>ï¼šä½ çš„ Hook æ¨¡å—èƒ½æ­£å¸¸ Hook ç›®æ ‡æ–¹æ³•</li>
<li><strong>æ£€æµ‹å·¥å…·æ˜¾ç¤ºå¹²å‡€</strong>ï¼šä½¿ç”¨ XposedChecker ç­‰å·¥å…·æµ‹è¯•ï¼Œæ˜¾ç¤ºæœªæ£€æµ‹åˆ°</li>
</ul>
<p><strong>éªŒè¯æ–¹æ³•</strong>ï¼š</p>
<p><strong>1. ç¼–å†™æµ‹è¯• Xposed æ¨¡å—</strong>ï¼š</p>
<pre><code class="language-java">// éªŒè¯æ‹¦æˆªæ˜¯å¦ç”Ÿæ•ˆ
XposedHelpers.findAndHookMethod(
    &quot;com.target.app.MainActivity&quot;,
    lpparam.classLoader,
    &quot;onCreate&quot;,
    Bundle.class,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            XposedBridge.log(&quot;Hook æˆåŠŸï¼App æœªæ£€æµ‹åˆ° Xposed&quot;);
        }
    }
);
</code></pre>
<p><strong>2. æŸ¥çœ‹æ—¥å¿—</strong>ï¼š</p>
<pre><code class="language-bash"># æŸ¥çœ‹ App æ˜¯å¦æœ‰æ£€æµ‹ç›¸å…³æ—¥å¿—
adb logcat | grep -i &quot;xposed\|detect\|security\|check&quot;

# åº”è¯¥çœ‹åˆ°ï¼š
# - Hook æˆåŠŸæ—¥å¿—
# - æ²¡æœ‰æ£€æµ‹ç›¸å…³é”™è¯¯æ—¥å¿—
</code></pre>
<p><strong>3. ä½¿ç”¨ XposedChecker</strong>ï¼š</p>
<pre><code class="language-bash"># å®‰è£… XposedChecker
adb install XposedChecker.apk

# è¿è¡Œå¹¶æŸ¥çœ‹ç»“æœ
# å¦‚æœç»•è¿‡æˆåŠŸï¼Œåº”è¯¥æ˜¾ç¤º &quot;Xposed: Not Detected&quot;
</code></pre>
<p><strong>4. æµ‹è¯•ç›®æ ‡ App åŠŸèƒ½</strong>ï¼š</p>
<pre><code class="language-text">å®Œæ•´åŠŸèƒ½æµ‹è¯•æµç¨‹ï¼š
â”œâ”€â†’ å¯åŠ¨ Appï¼ˆè§‚å¯Ÿæ˜¯å¦å´©æºƒï¼‰
â”œâ”€â†’ ç™»å½•è´¦å·ï¼ˆè§‚å¯Ÿæ˜¯å¦è¢«æ‹’ç»ï¼‰
â””â”€â†’ æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡ï¼ˆæ”¯ä»˜/æ¸¸æˆ/æŸ¥çœ‹æ•æ„Ÿä¿¡æ¯ï¼‰
    â””â”€â†’ è§‚å¯Ÿæ˜¯å¦è§¦å‘é£æ§æˆ–å¼‚å¸¸
</code></pre>
<hr />
<h2>åŸç†è§£æ</h2>
<h3>Xposed æ£€æµ‹åŸç†</h3>
<p><strong>1. è°ƒç”¨æ ˆç‰¹å¾</strong>ï¼š</p>
<p>å½“ Xposed Hook ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®é™…çš„è°ƒç”¨é“¾æ˜¯ï¼š</p>
<pre><code class="language-text">App.targetMethod()
    â†“
XposedBridge.handleHookedMethod()
    â†“
åŸå§‹æ–¹æ³•/æ›¿æ¢æ–¹æ³•
</code></pre>
<p>App å¯ä»¥é€šè¿‡ <code>Thread.currentThread().getStackTrace()</code> è·å–è°ƒç”¨æ ˆï¼Œå¦‚æœå‘ç° <code>de.robv.android.xposed</code> ç›¸å…³ç±»ï¼Œå°±è¯´æ˜ Xposed å­˜åœ¨ã€‚</p>
<p><strong>2. ç±»åŠ è½½ç‰¹å¾</strong>ï¼š</p>
<p>Xposed åœ¨ Zygote è¿›ç¨‹ä¸­æ³¨å…¥ï¼Œä¼šåŠ è½½ <code>XposedBridge</code> ç­‰ç±»åˆ°æ¯ä¸ª App è¿›ç¨‹ã€‚App å¯ä»¥å°è¯• <code>Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;)</code>ï¼Œå¦‚æœæˆåŠŸåŠ è½½ï¼Œå°±è¯´æ˜ Xposed å­˜åœ¨ã€‚</p>
<p><strong>3. æ–‡ä»¶ç³»ç»Ÿç‰¹å¾</strong>ï¼š</p>
<p>Xposed éœ€è¦åœ¨ç³»ç»Ÿä¸­å®‰è£…æ–‡ä»¶ï¼š</p>
<ul>
<li><code>/system/framework/XposedBridge.jar</code></li>
<li><code>/system/lib/libxposed_art.so</code> æˆ– <code>/system/lib64/libxposed_art.so</code></li>
</ul>
<p><strong>4. å†…å­˜æ˜ å°„ç‰¹å¾</strong>ï¼š</p>
<p>è¿›ç¨‹çš„å†…å­˜æ˜ å°„ï¼ˆ<code>/proc/self/maps</code>ï¼‰ä¸­ä¼šå‡ºç° Xposed ç›¸å…³çš„åº“ã€‚</p>
<h3>ç»•è¿‡åŸç†</h3>
<p>å…³é”®æŠ€æœ¯ç‚¹ï¼š</p>
<ol>
<li><strong>æ‹¦æˆªæ£€æµ‹æ–¹æ³•çš„æ‰§è¡Œ</strong>ï¼šåœ¨æ£€æµ‹ä»£ç æ‰§è¡Œå‰ Hookï¼Œä¿®æ”¹å…¶è¡Œä¸º</li>
<li><strong>ä¿®æ”¹è¿”å›å€¼</strong>ï¼šè®©æ£€æµ‹æ–¹æ³•æ€»æ˜¯è¿”å›&quot;æœªæ£€æµ‹åˆ°&quot;çš„ç»“æœ</li>
<li><strong>è¿‡æ»¤ç‰¹å¾å­—ç¬¦ä¸²</strong>ï¼šå°†åŒ…å« &quot;xposed&quot; çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ— å®³å­—ç¬¦ä¸²</li>
<li><strong>é˜»æ­¢å¼‚å¸¸æŠ›å‡º</strong>ï¼šå¯¹äº <code>Class.forName()</code> è¿™ç±»æ£€æµ‹ï¼Œä¸»åŠ¨æŠ›å‡º <code>ClassNotFoundException</code></li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šè°ƒç”¨æ ˆæ£€æµ‹çš„ç»•è¿‡åŸç†</strong></p>
<pre><code class="language-text">Hook å‰ï¼ˆæ£€æµ‹æˆåŠŸï¼‰ï¼š
App è°ƒç”¨ getStackTrace()
    â†’ è¿”å› [MainActivity, XposedBridge, ZygoteInit, ...]
    â†’ App å‘ç° &quot;XposedBridge&quot;
    â†’ æ£€æµ‹æˆåŠŸï¼ˆXposed å­˜åœ¨ï¼‰

Hook åï¼ˆç»•è¿‡æ£€æµ‹ï¼‰ï¼š
App è°ƒç”¨ getStackTrace()
    â†’ è¿”å› [MainActivity, XposedBridge, ZygoteInit, ...]
    â†’ æˆ‘ä»¬ Hook æ‹¦æˆª getClassName()
    â†’ å°† &quot;XposedBridge&quot; æ›¿æ¢ä¸º &quot;ZygoteInit&quot;
    â†’ App åªçœ‹åˆ° [MainActivity, ZygoteInit, ZygoteInit, ...]
    â†’ æ£€æµ‹å¤±è´¥ï¼ˆæœªå‘ç° Xposedï¼‰
</code></pre>
<h3>å®šåˆ¶æ¡†æ¶æ•ˆæœ</h3>
<table>
<thead>
<tr>
  <th>æ£€æµ‹æ–¹å¼</th>
  <th>æ£€æµ‹ä»£ç </th>
  <th>å®šåˆ¶å</th>
  <th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ç±»åŠ è½½æ£€æµ‹</td>
  <td><code>Class.forName(&quot;de.robv...XposedBridge&quot;)</code></td>
  <td>åŒ…åæ”¹ä¸º <code>com.myfw...CustomBridge</code></td>
  <td>æ£€æµ‹å¤±è´¥</td>
</tr>
<tr>
  <td>æ–‡ä»¶æ£€æµ‹</td>
  <td><code>/system/framework/XposedBridge.jar</code></td>
  <td>æ–‡ä»¶åæ”¹ä¸º <code>CustomBridge.jar</code></td>
  <td>æ£€æµ‹å¤±è´¥</td>
</tr>
<tr>
  <td>maps æ£€æµ‹</td>
  <td>æœç´¢ <code>libxposed_art.so</code></td>
  <td>åº“åæ”¹ä¸º <code>libcustom_art.so</code></td>
  <td>æ£€æµ‹å¤±è´¥</td>
</tr>
</tbody>
</table>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ç»´æŠ¤æˆæœ¬é«˜ï¼Œéœ€è¦è·Ÿéšå®˜æ–¹ Xposed æ›´æ–°</li>
<li>ç¼–è¯‘è¿‡ç¨‹å¤æ‚ï¼Œéœ€è¦é…ç½® Android NDK</li>
<li>éƒ¨åˆ†ä¾èµ–åŸç‰ˆ Xposed API çš„æ¨¡å—å¯èƒ½ä¸å…¼å®¹</li>
</ul>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>é—®é¢˜ 1ï¼šHook æ¨¡å—æ¿€æ´»åï¼ŒApp ä»ç„¶æ£€æµ‹åˆ° Xposed</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li><strong>Hook æ—¶æœºå¤ªæ™š</strong>ï¼šApp åœ¨ <code>Application.onCreate()</code> ä¹‹å‰å°±æ£€æµ‹äº†</li>
<li><strong>Native å±‚æ£€æµ‹</strong>ï¼šApp ä½¿ç”¨ JNI æ£€æµ‹ï¼ŒJava Hook æ— æ³•æ‹¦æˆª</li>
<li><strong>é—æ¼çš„æ£€æµ‹ç‚¹</strong>ï¼šApp ä½¿ç”¨äº†ä½ æ²¡æœ‰è¦†ç›–çš„æ£€æµ‹æ–¹æ³•</li>
<li><strong>Hook ä½œç”¨åŸŸæœªé…ç½®</strong>ï¼šLSPosed ä¸­æœªå°†ç›®æ ‡ App åŠ å…¥ä½œç”¨åŸŸ</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p><strong>æ–¹æ¡ˆ 1ï¼šæå‰ Hook æ—¶æœº</strong></p>
<pre><code class="language-java">// åœ¨ Application.attachBaseContext() ä¸­æå‰æ‹¦æˆª
XposedHelpers.findAndHookMethod(
    &quot;com.target.app.MyApplication&quot;,
    lpparam.classLoader,
    &quot;attachBaseContext&quot;,
    Context.class,
    new XC_MethodHook() {
        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
            // åœ¨ Application åˆå§‹åŒ–å‰å°±æ‹¦æˆªæ‰€æœ‰æ£€æµ‹æ–¹æ³•
            hookAllDetectionMethods(lpparam);
            XposedBridge.log(&quot;[AntiDetect] Early hooks installed&quot;);
        }
    }
);
</code></pre>
<p><strong>æ–¹æ¡ˆ 2ï¼šç»“åˆ Frida å¤„ç† Native å±‚</strong></p>
<pre><code class="language-javascript">// Frida Scriptï¼šHook fopen() æ‹¦æˆª maps æ–‡ä»¶è¯»å–
Interceptor.attach(Module.findExportByName(&quot;libc.so&quot;, &quot;fopen&quot;), {
    onEnter: function(args) {
        var path = Memory.readUtf8String(args[0]);
        if (path === &quot;/proc/self/maps&quot;) {
            console.log(&quot;[*] fopen() called for /proc/self/maps&quot;);
            // é‡å®šå‘åˆ°ä¸€ä¸ªå¹²å‡€çš„ maps æ–‡ä»¶
            args[0] = Memory.allocUtf8String(&quot;/data/local/tmp/fake_maps&quot;);
        }
    }
});
</code></pre>
<p><strong>æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ Xposed è°ƒç”¨ Native Hook</strong></p>
<pre><code class="language-java">// è°ƒç”¨ native æ–¹æ³•åš inline hook
nativeHookFopen();
</code></pre>
<p><strong>æ–¹æ¡ˆ 4ï¼šå…¨é¢åˆ†ææ£€æµ‹ä»£ç </strong></p>
<pre><code class="language-bash">cd decompiled

# æœç´¢æ‰€æœ‰å¯èƒ½æ£€æµ‹æ¨¡å¼
grep -rn &quot;getStackTrace\|forName\|/proc/self/maps\|XposedBridge\|exists()&quot; . \
    --include=&quot;*.java&quot; &gt; detection_points.txt
</code></pre>
<p><strong>æ–¹æ¡ˆ 5ï¼šæ£€æŸ¥ LSPosed ä½œç”¨åŸŸ</strong></p>
<pre><code class="language-bash">adb shell &quot;su -c 'ls /data/adb/lspd/config/modules/'&quot;
# åº”è¯¥çœ‹åˆ°ä½ çš„æ¨¡å— ID

# æ£€æŸ¥ä½œç”¨åŸŸé…ç½®
# LSPosed ç®¡ç†å™¨ â†’ æ¨¡å— â†’ ä½ çš„æ¨¡å— â†’ åº”ç”¨ä½œç”¨åŸŸ
# ç¡®ä¿ç›®æ ‡ App å·²å‹¾é€‰
</code></pre>
<h3>é—®é¢˜ 2ï¼šå®šåˆ¶æ¡†æ¶ç¼–è¯‘å¤±è´¥</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ul>
<li>META-INF ç›®å½•ä¸‹çš„è„šæœ¬ç¼ºå¤±</li>
<li>ç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œç”Ÿæˆçš„ ZIP æŸå</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p><strong>æ–¹æ¡ˆ 1ï¼šæ£€æŸ¥ ZIP ç»“æ„</strong></p>
<pre><code class="language-bash"># è§£å‹æŸ¥çœ‹ç»“æ„
unzip -l edxp-custom.zip

# æ ‡å‡† Magisk æ¨¡å—ç»“æ„ï¼š
# META-INF/
#   com/google/android/
#     update-binary      # å®‰è£…è„šæœ¬
#     updater-script     # ç©ºæ–‡ä»¶å³å¯
# module.prop            # æ¨¡å—é…ç½®
# system/                # ç³»ç»Ÿæ–‡ä»¶
#   framework/
#     CustomBridge.jar
#   lib64/
#     libcustom_art.so
# riru/                  # Riru ç›¸å…³ï¼ˆå¦‚ä½¿ç”¨ Riruï¼‰
</code></pre>
<p><strong>æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨åˆ›å»º module.prop</strong></p>
<pre><code class="language-properties">id=custom_xposed
name=Custom Xposed Framework
version=v1.0.0
versionCode=100
author=YourName
description=Customized Xposed with renamed signatures

# å¯é€‰å­—æ®µ
minMagisk=21000
maxMagisk=99999
</code></pre>
<p><strong>æ–¹æ¡ˆ 3ï¼šæ‰‹åŠ¨æ‰“åŒ…</strong></p>
<pre><code class="language-bash">mkdir -p magisk_module/system/framework
mkdir -p magisk_module/system/lib64

# å¤åˆ¶æ–‡ä»¶
cp update-binary magisk_module/META-INF/com/google/android/
touch magisk_module/META-INF/com/google/android/updater-script
cp module.prop magisk_module/
cp CustomBridge.jar magisk_module/system/framework/
cp libcustom_art.so magisk_module/system/lib64/

# æ‰“åŒ…ï¼ˆæ³¨æ„ï¼šå¿…é¡»åœ¨æ¨¡å—ç›®å½•å†…æ‰“åŒ…ï¼‰
cd magisk_module
zip -r ../custom-xposed-magisk.zip .
cd ..

# æ¨é€å¹¶å®‰è£…
adb push custom-xposed-magisk.zip /sdcard/
# åœ¨ Magisk Manager ä¸­å®‰è£…
</code></pre>
<p><strong>æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ TWRP åˆ·å…¥</strong></p>
<pre><code class="language-bash">adb reboot recovery
# åœ¨ TWRP ä¸­ï¼šInstall â†’ é€‰æ‹© ZIP â†’ æ»‘åŠ¨ç¡®è®¤
</code></pre>
<h3>é—®é¢˜ 3ï¼šHook å App åŠŸèƒ½å¼‚å¸¸æˆ–å´©æºƒ</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ul>
<li>Hook èŒƒå›´å¤ªå¹¿ï¼Œå½±å“äº†æ­£å¸¸åŠŸèƒ½</li>
<li>è¿”å›å€¼ç±»å‹ä¸åŒ¹é…</li>
<li>Hook çš„æ–¹æ³•ç­¾åä¸æ­£ç¡®</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p><strong>æ–¹æ¡ˆ 1ï¼šç²¾å‡† Hookï¼Œç¼©å°ä½œç”¨èŒƒå›´</strong></p>
<p>é”™è¯¯ç¤ºèŒƒï¼šå…¨å±€ Hook</p>
<pre><code class="language-java">// è¿™æ ·ä¼šå½±å“æ‰€æœ‰ç±»åŠ è½½ï¼ŒåŒ…æ‹¬æ­£å¸¸ä¸šåŠ¡
XposedHelpers.findAndHookMethod(Class.class, &quot;forName&quot;, String.class, ...);
</code></pre>
<p>æ­£ç¡®ç¤ºèŒƒï¼šé’ˆå¯¹æ€§ Hook</p>
<pre><code class="language-java">// åª Hook å·²çŸ¥çš„æ£€æµ‹ç±»
XposedHelpers.findAndHookMethod(
    &quot;com.target.app.security.SecurityChecker&quot;,
    lpparam.classLoader,
    &quot;checkXposed&quot;,
    new XC_MethodReplacement() {
        @Override
        protected Object replaceHookedMethod(MethodHookParam param) {
            XposedBridge.log(&quot;[AntiDetect] checkXposed() blocked&quot;);
            return false; // è¿”å›&quot;æœªæ£€æµ‹åˆ°&quot;
        }
    }
);
</code></pre>
<p><strong>æ–¹æ¡ˆ 2ï¼šæ·»åŠ æ¡ä»¶åˆ¤æ–­</strong></p>
<pre><code class="language-java">@Override
protected void afterHookedMethod(MethodHookParam param) throws Throwable {
    String className = (String) param.getResult();

    // åªè¿‡æ»¤ Xposed ç›¸å…³ï¼Œä¸å½±å“å…¶ä»–ç±»
    if (className != null &amp;&amp; className.toLowerCase().contains(&quot;xposed&quot;)) {
        param.setResult(&quot;android.app.Activity&quot;);
    }
    // å…¶ä»–æƒ…å†µä¿æŒåŸæ ·ï¼Œä¸åšä¿®æ”¹
}
</code></pre>
<p><strong>æ–¹æ¡ˆ 3ï¼šé€ä¸ªå¯ç”¨ Hook æµ‹è¯•</strong></p>
<pre><code class="language-java">@Override
public void handleLoadPackage(LoadPackageParam lpparam) throws Throwable {
    // ä¸€æ¬¡åªå¯ç”¨ä¸€ä¸ªæ‹¦æˆªï¼Œæµ‹è¯•æ˜¯å¦å¯¼è‡´å´©æºƒ
    hookStackTrace(); // æµ‹è¯•ï¼šOK
    // hookClassForName(); // æš‚æ—¶æ³¨é‡Šæ‰
    // hookFileExists(); // æš‚æ—¶æ³¨é‡Šæ‰

    // é€ä¸ªå¯ç”¨å¹¶æµ‹è¯•ï¼Œæ‰¾å‡ºå¯¼è‡´å´©æºƒçš„æ‹¦æˆª
}
</code></pre>
<p><strong>æ–¹æ¡ˆ 4ï¼šç¡®ä¿è¿”å›å€¼ç±»å‹æ­£ç¡®</strong></p>
<pre><code class="language-java">// ç¡®ä¿è¿”å›å€¼ç±»å‹åŒ¹é…
@Override
protected void afterHookedMethod(MethodHookParam param) {
    // å¦‚æœåŸæ–¹æ³•è¿”å› booleanï¼Œä½ ä¹Ÿå¿…é¡»è¿”å› boolean
    param.setResult(false); // æ­£ç¡®
    // param.setResult(&quot;false&quot;); // é”™è¯¯ï¼ç±»å‹ä¸åŒ¹é…
}
</code></pre>
<h3>é—®é¢˜ 4ï¼šæ¨¡å—åœ¨ LSPosed ä¸­ä¸æ˜¾ç¤º</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ul>
<li><code>assets/xposed_init</code> æ–‡ä»¶ç¼ºå¤±æˆ–è·¯å¾„é”™è¯¯</li>
<li><code>AndroidManifest.xml</code> ä¸­ç¼ºå°‘ Xposed å…ƒæ•°æ®å£°æ˜</li>
<li>æ¨¡å—å…¥å£ç±»çš„åŒ…å/ç±»åä¸ <code>xposed_init</code> ä¸­ä¸ä¸€è‡´</li>
<li>LSPosed ç¼“å­˜æœªåˆ·æ–°</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p><strong>æ–¹æ¡ˆ 1ï¼šæ£€æŸ¥ <code>assets/xposed_init</code> æ–‡ä»¶</strong></p>
<pre><code class="language-bash"># ç¡®è®¤æ–‡ä»¶å­˜åœ¨
unzip -l app-release.apk | grep xposed_init
# åº”è¯¥çœ‹åˆ°: assets/xposed_init

# æ£€æŸ¥å†…å®¹ï¼ˆå¿…é¡»æ˜¯å®Œæ•´ç±»åï¼Œæ— æ–‡ä»¶æ‰©å±•åï¼‰
unzip -p app-release.apk assets/xposed_init
# è¾“å‡ºåº”è¯¥æ˜¯ï¼šcom.example.antidetect.AntiXposedDetection
</code></pre>
<p><strong>æ–¹æ¡ˆ 2ï¼šç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®</strong></p>
<pre><code class="language-text">æ­£ç¡®è·¯å¾„ï¼š
app/src/main/assets/xposed_init  # æ­£ç¡®

é”™è¯¯è·¯å¾„ï¼š
app/assets/xposed_init           # é”™è¯¯
</code></pre>
<p><strong>æ–¹æ¡ˆ 3ï¼šæ£€æŸ¥ AndroidManifest.xml</strong></p>
<pre><code class="language-xml">&lt;!-- å¿…é¡»æœ‰è¿™ä¸‰ä¸ª meta-data --&gt;
&lt;meta-data
    android:name=&quot;xposedmodule&quot;
    android:value=&quot;true&quot; /&gt;
&lt;meta-data
    android:name=&quot;xposeddescription&quot;
    android:value=&quot;Hide Xposed from detection&quot; /&gt;
&lt;meta-data
    android:name=&quot;xposedminversion&quot;
    android:value=&quot;54&quot; /&gt;
&lt;/application&gt;
</code></pre>
<p><strong>æ–¹æ¡ˆ 4ï¼šç¡®è®¤å…¥å£ç±»å­˜åœ¨</strong></p>
<pre><code class="language-bash"># æ£€æŸ¥å…¥å£ç±»æ˜¯å¦å­˜åœ¨
ls -l ./decompiled/com/example/antidetect/AntiXposedDetection.java

# ç¡®è®¤ç±»å®ç°äº† IXposedHookLoadPackage æ¥å£
grep &quot;implements IXposedHookLoadPackage&quot; \
    ./decompiled/com/example/antidetect/AntiXposedDetection.java
</code></pre>
<p><strong>æ–¹æ¡ˆ 5ï¼šåˆ·æ–° LSPosed ç¼“å­˜</strong></p>
<pre><code class="language-bash"># æ¸…é™¤ LSPosed ç¼“å­˜
adb shell &quot;su -c 'rm -rf /data/adb/lspd/cache/*'&quot;

# é‡æ–°å®‰è£…
adb install app-release.apk

# é‡å¯ LSPosedï¼ˆæˆ–é‡å¯è®¾å¤‡ï¼‰
adb shell &quot;su -c 'killall -9 com.android.systemui'&quot;
# æˆ–
adb reboot

# æ‰“å¼€ LSPosed ç®¡ç†å™¨ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æ¨¡å—
</code></pre>
<hr />
<h2>å»¶ä¼¸é˜…è¯»</h2>
<h3>ç›¸å…³é…æ–¹</h3>
<ul>
<li><a href="#section-18">é€†å‘å·¥ç¨‹å·¥ä½œæµ</a> - å®Œæ•´çš„é€†å‘åˆ†ææµç¨‹</li>
</ul>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><a href="#section-42">Xposed ä½¿ç”¨æŒ‡å—</a> - Xposed æ¡†æ¶åŸºç¡€ä½¿ç”¨</li>
<li><a href="#section-43">Xposed å†…éƒ¨åŸç†</a> - Xposed å·¥ä½œæœºåˆ¶è¯¦è§£</li>
<li><a href="#section-40">Frida ä½¿ç”¨æŒ‡å—</a> - Frida ä¸ Xposed ååŒä½¿ç”¨</li>
</ul>
<h3>å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="#section-68">Android æ²™ç®±å®ç°</a> - è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ä½¿ç”¨ Xposed</li>
<li><a href="#section-65">ART è¿è¡Œæ—¶</a> - ç†è§£ Xposed å¦‚ä½•ä¿®æ”¹ ART</li>
</ul>
<h3>æ¡ˆä¾‹åˆ†æ</h3>
<ul>
<li><a href="#section-50">ååˆ†ææŠ€æœ¯æ¡ˆä¾‹</a> - ç»¼åˆååˆ†ææŠ€æœ¯æ¡ˆä¾‹</li>
<li><a href="#section-52">ç¤¾äº¤åª’ä½“é£æ§</a> - ç¤¾äº¤åº”ç”¨çš„ Xposed æ£€æµ‹</li>
</ul>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>Xposed æ£€æµ‹æ–¹æ³•é€ŸæŸ¥è¡¨</h3>
<table>
<thead>
<tr>
  <th>æ£€æµ‹ç±»å‹</th>
  <th>æ£€æµ‹å±‚çº§</th>
  <th>ç‰¹å¾ä»£ç </th>
  <th>ç»•è¿‡æ–¹æ³•</th>
  <th>Hook ç›®æ ‡</th>
</tr>
</thead>
<tbody>
<tr>
  <td>è°ƒç”¨æ ˆæ£€æµ‹</td>
  <td>Java</td>
  <td><code>getStackTrace()</code> + <code>contains(&quot;xposed&quot;)</code></td>
  <td>Hook è¿”å›å€¼è¿‡æ»¤</td>
  <td><code>StackTraceElement.getClassName()</code></td>
</tr>
<tr>
  <td>ç±»åŠ è½½æ£€æµ‹</td>
  <td>Java</td>
  <td><code>Class.forName(&quot;XposedBridge&quot;)</code></td>
  <td>æŠ›å‡º ClassNotFoundException</td>
  <td><code>Class.forName()</code></td>
</tr>
<tr>
  <td>å·²åŠ è½½ç±»æ£€æµ‹</td>
  <td>Java</td>
  <td><code>ClassLoader.loadClass(...)</code></td>
  <td>åŒä¸Š</td>
  <td><code>ClassLoader.loadClass()</code></td>
</tr>
<tr>
  <td>æ–‡ä»¶æ£€æµ‹</td>
  <td>Java</td>
  <td><code>new File(&quot;/system/.../XposedBridge.jar&quot;).exists()</code></td>
  <td>è¿”å› false</td>
  <td><code>File.exists()</code></td>
</tr>
<tr>
  <td>maps æ£€æµ‹</td>
  <td>Native</td>
  <td><code>fopen(&quot;/proc/self/maps&quot;)</code> + <code>strstr(&quot;libxposed&quot;)</code></td>
  <td>Hook fopen æˆ–å®šåˆ¶æ¡†æ¶</td>
  <td><code>libc.fopen()</code></td>
</tr>
<tr>
  <td>ç³»ç»Ÿå±æ€§æ£€æµ‹</td>
  <td>Java/Native</td>
  <td><code>System.getProperty(&quot;vxp_...&quot;)</code></td>
  <td>è¿”å› null</td>
  <td><code>System.getProperty()</code></td>
</tr>
<tr>
  <td>ç¬¦å·åœ°å€æ£€æµ‹</td>
  <td>Native</td>
  <td><code>dlsym(...)</code> æ£€æŸ¥åœ°å€å¼‚å¸¸</td>
  <td>å®šåˆ¶æ¡†æ¶</td>
  <td>N/Aï¼ˆéœ€æºç ä¿®æ”¹ï¼‰</td>
</tr>
</tbody>
</table>
<h3>å®Œæ•´ç»•è¿‡æ¨¡å—æ¨¡æ¿ï¼ˆä¸€é”®ä½¿ç”¨ï¼‰</h3>
<p>ä¿å­˜ä¸º <code>AntiXposedBypass.java</code>ï¼Œä¿®æ”¹åŒ…åå’Œç›®æ ‡ App å³å¯ä½¿ç”¨ï¼š</p>
<pre><code class="language-java">package com.example.antidetect;

import de.robv.android.xposed.*;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;
import java.io.File;

public class AntiXposedBypass implements IXposedHookLoadPackage {

    private static final String TARGET = &quot;com.target.app&quot;; // æ”¹ä¸ºä½ çš„ç›®æ ‡ App

    @Override
    public void handleLoadPackage(LoadPackageParam lpparam) throws Throwable {
        if (!lpparam.packageName.equals(TARGET)) return;

        XposedBridge.log(&quot;[Bypass] Hooking &quot; + TARGET);

        // 1. ç»•è¿‡è°ƒç”¨æ ˆæ£€æµ‹
        XposedHelpers.findAndHookMethod(StackTraceElement.class, &quot;getClassName&quot;,
            new XC_MethodHook() {
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    String name = (String) param.getResult();
                    if (name != null &amp;&amp; name.toLowerCase().contains(&quot;xposed&quot;)) {
                        param.setResult(&quot;com.android.internal.os.ZygoteInit&quot;);
                    }
                }
            });

        // 2. ç»•è¿‡ç±»åŠ è½½æ£€æµ‹
        XposedHelpers.findAndHookMethod(Class.class, &quot;forName&quot;, String.class,
            new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    String cls = (String) param.args[0];
                    if (cls != null &amp;&amp; cls.toLowerCase().contains(&quot;xposed&quot;)) {
                        param.setThrowable(new ClassNotFoundException(cls));
                    }
                }
            });

        // 3. ç»•è¿‡æ–‡ä»¶æ£€æµ‹
        XposedHelpers.findAndHookMethod(File.class, &quot;exists&quot;,
            new XC_MethodHook() {
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    String path = ((File) param.thisObject).getAbsolutePath();
                    if (path.toLowerCase().contains(&quot;xposed&quot;) ||
                        path.toLowerCase().contains(&quot;edxposed&quot;) ||
                        path.toLowerCase().contains(&quot;lspd&quot;)) {
                        param.setResult(false);
                    }
                }
            });

        XposedBridge.log(&quot;[Bypass] All hooks activated&quot;);
    }
}
</code></pre>
<h3>å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3>
<pre><code class="language-bash"># ========== ç¯å¢ƒæ£€æŸ¥ ==========

# æ£€æŸ¥ Xposed æ¡†æ¶çŠ¶æ€
adb shell &quot;su -c 'ls -l /system/framework/Xposed'&quot;
adb shell &quot;su -c 'ps -A | grep xposed'&quot;

# æŸ¥çœ‹å·²å®‰è£…çš„ Xposed æ¨¡å—
adb shell &quot;su -c 'ls /data/app/ | grep -i xposed'&quot;

# æ£€æŸ¥ LSPosed çŠ¶æ€
adb shell &quot;su -c 'ls -l /data/adb/lspd/'&quot;

# ========== æ—¥å¿—è°ƒè¯• ==========

# æŸ¥çœ‹ Xposed æ¡†æ¶æ—¥å¿—
adb logcat -s Xposed:V

# æŸ¥çœ‹æ¨¡å—æ—¥å¿—ï¼ˆå‡è®¾æ¨¡å—æ ‡ç­¾ä¸º AntiDetectï¼‰
adb logcat | grep AntiDetect

# æŸ¥çœ‹ App æ£€æµ‹ç›¸å…³æ—¥å¿—
adb logcat | grep -iE &quot;detect|xposed|security|check&quot;

# æ¸…ç©ºæ—¥å¿—å¹¶å®æ—¶æŸ¥çœ‹
adb logcat -c &amp;&amp; adb logcat -v time

# ========== æ¨¡å—ç®¡ç† ==========

# ç¼–è¯‘ Xposed æ¨¡å—
./gradlew assembleDebug   # Debug ç‰ˆ
./gradlew assembleRelease # Release ç‰ˆ

# å®‰è£…æ¨¡å—
adb install app/build/outputs/apk/debug/app-debug.apk

# å¸è½½æ¨¡å—
adb uninstall com.example.antidetect

# é‡å¯ç›®æ ‡ Appï¼ˆåº”ç”¨æ›´æ”¹ï¼‰
adb shell am force-stop com.target.app
adb shell am start -n com.target.app/.MainActivity

# ========== å®šåˆ¶æ¡†æ¶ ==========

# æ¨é€è‡ªå®šä¹‰æ¡†æ¶åˆ°è®¾å¤‡
adb push EdXposed-custom.zip /sdcard/

# åœ¨ Magisk ä¸­å®‰è£…ï¼ˆå‘½ä»¤è¡Œæ–¹å¼ï¼‰
adb shell &quot;su -c 'magisk --install-module /sdcard/EdXposed-custom.zip'&quot;

# é‡å¯è®¾å¤‡
adb reboot

# ========== æµ‹è¯•éªŒè¯ ==========

# å®‰è£… XposedChecker æµ‹è¯•å·¥å…·
adb install XposedChecker.apk

# è¿è¡Œç›®æ ‡ App å¹¶è§‚å¯Ÿè¡Œä¸º
adb shell am start -n com.target.app/.MainActivity

# æŠ“å–å´©æºƒæ—¥å¿—
adb logcat -b crash

# æ£€æŸ¥è¿›ç¨‹å†…å­˜æ˜ å°„ï¼ˆæŸ¥æ‰¾ Xposed ç‰¹å¾ï¼‰
adb shell &quot;su -c 'cat /proc/$(pidof com.target.app)/maps | grep -i xposed'&quot;
</code></pre>
<h3>å¸¸è§æ£€æµ‹ä»£ç æ¨¡å¼</h3>
<pre><code class="language-java">// ========== Java å±‚æ£€æµ‹æ¨¡å¼ ==========

// æ¨¡å¼ 1ï¼šè°ƒç”¨æ ˆæ£€æµ‹
if (element.getClassName().contains(&quot;xposed&quot;)) { /* æ£€æµ‹åˆ° */ }

// æ¨¡å¼ 2ï¼šå¼‚å¸¸è°ƒç”¨æ ˆæ£€æµ‹
try { throw new Exception(); } catch (Exception e) {
    for (StackTraceElement elem : e.getStackTrace()) { /* æ£€æŸ¥ */ }
}

// æ¨¡å¼ 3ï¼šç±»åŠ è½½æ£€æµ‹
Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;);

// æ¨¡å¼ 4ï¼šClassLoader æ£€æµ‹
ClassLoader.getSystemClassLoader().loadClass(&quot;de.robv.android.xposed.XposedHelpers&quot;);

// æ¨¡å¼ 5ï¼šæ–‡ä»¶æ£€æµ‹
new File(&quot;/system/framework/XposedBridge.jar&quot;).exists()

// æ¨¡å¼ 6ï¼šç³»ç»Ÿå±æ€§æ£€æµ‹
System.getProperty(&quot;vxp_forbid_status&quot;)
System.getProperty(&quot;ro.xposed.version&quot;)

// ========== Native å±‚æ£€æµ‹æ¨¡å¼ ==========

// æ¨¡å¼ 7ï¼šmaps æ–‡ä»¶æ£€æµ‹ï¼ˆC/C++ï¼‰
FILE* fp = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
// ç„¶åæœç´¢ &quot;xposed&quot; æˆ– &quot;libxposed&quot;

// æ¨¡å¼ 8ï¼šdlopen æ£€æµ‹
void* handle = dlopen(&quot;libxposed_art.so&quot;, RTLD_NOW);
if (handle != NULL) { /* æ£€æµ‹åˆ° */ }
</code></pre>
<h3>æœç´¢æ£€æµ‹ä»£ç çš„å…³é”®è¯</h3>
<pre><code class="language-text">xposed
XposedBridge
de.robv.android.xposed
getStackTrace
Class.forName
/proc/self/maps
libxposed
vxp_forbid
ro.xposed
EdXposed
LSPosed
</code></pre>
<h3>App ç±»å‹ä¸æ¨èç­–ç•¥</h3>
<table>
<thead>
<tr>
  <th>App ç±»å‹</th>
  <th>å¸¸è§æ£€æµ‹æ–¹å¼</th>
  <th>æ¨èç­–ç•¥</th>
  <th>æˆåŠŸç‡</th>
</tr>
</thead>
<tbody>
<tr>
  <td>æ™®é€šåº”ç”¨ï¼ˆç¤¾äº¤ã€å·¥å…·ï¼‰</td>
  <td>Java å±‚è°ƒç”¨æ ˆæ£€æµ‹</td>
  <td>ç­–ç•¥ Aï¼šé€šç”¨ Hook æ¨¡å—</td>
  <td>95%</td>
</tr>
<tr>
  <td>é‡‘è Appï¼ˆé“¶è¡Œã€æ”¯ä»˜ï¼‰</td>
  <td>Java + Native ç»¼åˆæ£€æµ‹</td>
  <td>ç­–ç•¥ Cï¼šå®šåˆ¶æ¡†æ¶ + Hook</td>
  <td>70%</td>
</tr>
<tr>
  <td>å¤§å‹æ¸¸æˆ</td>
  <td>Native å±‚ + å®šæ—¶æ£€æµ‹</td>
  <td>ç­–ç•¥ Cï¼šå®šåˆ¶æ¡†æ¶</td>
  <td>60%</td>
</tr>
<tr>
  <td>å®‰å…¨ç±» Appï¼ˆVPNã€æ€æ¯’ï¼‰</td>
  <td>æ·±åº¦æ£€æµ‹ + å®Œæ•´æ€§æ ¡éªŒ</td>
  <td>ç­–ç•¥ C + è™šæ‹ŸåŒ–</td>
  <td>50%</td>
</tr>
<tr>
  <td>å°ä¼— App</td>
  <td>ç®€å•æ£€æµ‹æˆ–æ— æ£€æµ‹</td>
  <td>ç­–ç•¥ Bï¼šç°æˆæ¨¡å—</td>
  <td>99%</td>
</tr>
</tbody>
</table>
<p><strong>æˆåŠŸç‡è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>95%+</strong>ï¼šé€šç”¨æ–¹æ³•å³å¯ç»•è¿‡</li>
<li><strong>70-90%</strong>ï¼šéœ€è¦é’ˆå¯¹æ€§ç¼–å†™ Hook</li>
<li><strong>50-70%</strong>ï¼šéœ€è¦å®šåˆ¶æ¡†æ¶æˆ–å¤šç§æŠ€æœ¯ç»„åˆ</li>
<li><strong>&lt;50%</strong>ï¼šå¯èƒ½éœ€è¦è™šæ‹ŸåŒ–ã€ç³»ç»Ÿçº§ä¿®æ”¹ç­‰é«˜çº§æŠ€æœ¯</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-10">
                                                <h2>10. R08: Captcha Bypassing</h2>
                                                <h1>R08: éªŒè¯ç ç»•è¿‡æŠ€æœ¯ï¼šæ»‘å—ä¸ç‚¹é€‰ç¯‡</h1>
<p>æ»‘å—å’Œç‚¹é€‰ï¼ˆæˆ–ç§°å›¾æ ‡ï¼‰éªŒè¯ç æ˜¯ç°ä»£ Web åº”ç”¨ä¸­ç”¨äºåŒºåˆ†äººç±»ç”¨æˆ·å’Œè‡ªåŠ¨åŒ–ç¨‹åºï¼ˆæœºå™¨äººï¼‰çš„å¸¸è§æ‰‹æ®µã€‚ä¸ä¼ ç»Ÿçš„å­—ç¬¦è¾“å…¥éªŒè¯ç ç›¸æ¯”ï¼Œå®ƒä»¬æ›´æ³¨é‡äºåˆ†æç”¨æˆ·çš„&quot;è¡Œä¸ºç‰¹å¾&quot;ã€‚æœ¬æ–‡æ—¨åœ¨è¯¦ç»†ä»‹ç»ç»•è¿‡è¿™ä¸¤ç±»éªŒè¯ç çš„ä¸»æµæŠ€æœ¯å’Œæ ¸å¿ƒæ€æƒ³ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF%E6%BB%91%E5%9D%97%E4%B8%8E%E7%82%B9%E9%80%89%E7%AF%87">éªŒè¯ç ç»•è¿‡æŠ€æœ¯ï¼šæ»‘å—ä¸ç‚¹é€‰ç¯‡</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6">éªŒè¯ç æ ¸å¿ƒæœºåˆ¶</a><ul>
<li><a href="#%E6%BB%91%E5%9D%97%E9%AA%8C%E8%AF%81%E7%A0%81">æ»‘å—éªŒè¯ç </a></li>
<li><a href="#%E7%82%B9%E9%80%89%E9%AA%8C%E8%AF%81%E7%A0%81">ç‚¹é€‰éªŒè¯ç </a></li>
</ul>
</li>
<li><a href="#%E7%BB%95%E8%BF%87%E7%AD%96%E7%95%A5%E4%B8%80%E6%A8%A1%E6%8B%9F%E4%BA%BA%E7%B1%BB%E8%A1%8C%E4%B8%BA">ç»•è¿‡ç­–ç•¥ä¸€ï¼šæ¨¡æ‹Ÿäººç±»è¡Œä¸º</a><ul>
<li><a href="#%E6%AD%A5%E9%AA%A4-1-%E7%9B%AE%E6%A0%87%E8%AF%86%E5%88%AB-%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89">æ­¥éª¤ 1: ç›®æ ‡è¯†åˆ« (è®¡ç®—æœºè§†è§‰)</a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-2-%E8%BD%A8%E8%BF%B9%E6%A8%A1%E6%8B%9F-%E6%A0%B8%E5%BF%83%E5%85%B3%E9%94%AE">æ­¥éª¤ 2: è½¨è¿¹æ¨¡æ‹Ÿ (æ ¸å¿ƒå…³é”®)</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%89%93%E7%A0%81%E5%B9%B3%E5%8F%B0">ç¬¬ä¸‰æ–¹æ‰“ç å¹³å°</a></li>
</ul>
</li>
<li><a href="#%E7%BB%95%E8%BF%87%E7%AD%96%E7%95%A5%E4%B8%89%E5%AF%BB%E6%89%BE%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E">ç»•è¿‡ç­–ç•¥ä¸‰ï¼šå¯»æ‰¾é€»è¾‘æ¼æ´</a></li>
<li><a href="#%E9%98%B2%E5%BE%A1%E4%B8%8E%E5%AF%B9%E6%8A%97%E7%9A%84%E6%BC%94%E8%BF%9B">é˜²å¾¡ä¸å¯¹æŠ—çš„æ¼”è¿›</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>éªŒè¯ç æ ¸å¿ƒæœºåˆ¶</h3>
<h4>æ»‘å—éªŒè¯ç </h4>
<ul>
<li><p><strong>ç›®æ ‡</strong>: ç”¨æˆ·éœ€è¦å°†æ»‘å—æ‹–åŠ¨åˆ°èƒŒæ™¯å›¾çš„ç¼ºå£ä½ç½®ã€‚</p>
</li>
<li><p><strong>éªŒè¯é‡ç‚¹</strong>:</p>
</li>
</ul>
<ol>
<li><strong>ç»“æœå‡†ç¡®æ€§</strong>: æ»‘å—æœ€ç»ˆåœç•™çš„ä½ç½®æ˜¯å¦åœ¨ç¼ºå£çš„ç›®æ ‡å®¹å·®èŒƒå›´å†…ã€‚</li>
<li><strong>è¡Œä¸ºå¯ä¿¡åº¦</strong>: <strong>(æ›´é‡è¦)</strong> ç”¨æˆ·çš„é¼ æ ‡è½¨è¿¹æ˜¯å¦åƒäººã€‚ä¸€ä¸ªç”±ç¨‹åºç”Ÿæˆçš„ã€åŒ€é€Ÿçš„ã€å®Œç¾çš„ç›´çº¿è½¨è¿¹å‡ ä¹è‚¯å®šä¼šè¢«åˆ¤å®šä¸ºæœºå™¨äººã€‚</li>
</ol>
<h4>ç‚¹é€‰éªŒè¯ç </h4>
<ul>
<li><p><strong>ç›®æ ‡</strong>: æ ¹æ®æç¤ºï¼ŒæŒ‰é¡ºåºç‚¹å‡»å›¾ç‰‡ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ±‰å­—ã€å›¾æ ‡æˆ–ç‰©ä½“ã€‚</p>
</li>
<li><p><strong>éªŒè¯é‡ç‚¹</strong>:</p>
</li>
</ul>
<ol>
<li><strong>è¯†åˆ«å‡†ç¡®æ€§</strong>: æ˜¯å¦èƒ½æ­£ç¡®è¯†åˆ«å¹¶ç‚¹å‡»ç›®æ ‡ã€‚</li>
<li><strong>è¡Œä¸ºå¯ä¿¡åº¦</strong>: ç‚¹å‡»çš„åæ ‡ã€é—´éš”æ—¶é—´ã€é¼ æ ‡ç§»åŠ¨è½¨è¿¹æ˜¯å¦è‡ªç„¶ã€‚</li>
</ol>
<hr />
<h3>ç»•è¿‡ç­–ç•¥ä¸€ï¼šæ¨¡æ‹Ÿäººç±»è¡Œä¸º</h3>
<p>è¿™æ˜¯æœ€ä¸»æµã€æœ€æ ¹æœ¬çš„ç»•è¿‡æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ˜¯å°½å¯èƒ½åœ°æ¨¡ä»¿äººç±»æ“ä½œçš„ä¸å®Œç¾æ€§ã€‚</p>
<h4>æ­¥éª¤ 1: ç›®æ ‡è¯†åˆ« (è®¡ç®—æœºè§†è§‰)</h4>
<p>åœ¨æ¨¡æ‹Ÿæ“ä½œä¹‹å‰ï¼Œç¨‹åºéœ€è¦å…ˆåƒäººä¸€æ ·&quot;çœ‹æ‡‚&quot;éªŒè¯ç ã€‚</p>
<ul>
<li><p><strong>å¯¹äºæ»‘å—éªŒè¯ç  (ç¼ºå£è¯†åˆ«)</strong>:</p>
</li>
<li><p><strong>å¸¸ç”¨åº“</strong>: OpenCV (Python)ã€‚</p>
</li>
<li><p><strong>æ–¹æ³•ä¸€ï¼šè¾¹ç¼˜æ£€æµ‹</strong>:</p>
</li>
</ul>
<ol>
<li>è·å–å¸¦ç¼ºå£çš„èƒŒæ™¯å›¾å’Œä¸å¸¦ç¼ºå£çš„å®Œæ•´èƒŒæ™¯å›¾ï¼ˆé€šå¸¸å¯ä»¥ä»ç½‘ç»œè¯·æ±‚ä¸­æ‰¾åˆ°ï¼‰ã€‚</li>
<li>ä½¿ç”¨ Canny ç­‰è¾¹ç¼˜æ£€æµ‹ç®—æ³•åˆ†åˆ«å¤„ç†ä¸¤å¼ å›¾ç‰‡ã€‚</li>
<li>å¯¹æ¯”ä¸¤å¼ å›¾çš„è¾¹ç¼˜å·®å¼‚ï¼Œå·®å¼‚æœ€æ˜¾è‘—çš„åŒºåŸŸå°±æ˜¯ç¼ºå£çš„ä½ç½®ã€‚</li>
</ol>
<ul>
<li><strong>æ–¹æ³•äºŒï¼šæ¨¡æ¿åŒ¹é…</strong>:</li>
</ul>
<ol>
<li>ä»ç½‘ç»œè¯·æ±‚æˆ–é¡µé¢å…ƒç´ ä¸­è·å–åˆ°ç‹¬ç«‹çš„&quot;æ»‘å—&quot;å›¾ç‰‡ã€‚</li>
<li>å°†æ»‘å—å›¾ç‰‡ä½œä¸º&quot;æ¨¡æ¿&quot;ï¼Œåœ¨å¸¦ç¼ºå£çš„èƒŒæ™¯å›¾ä¸Šè¿›è¡Œæ¨¡æ¿åŒ¹é… (<code>cv2.matchTemplate</code>)ã€‚åŒ¹é…åº¦æœ€é«˜çš„åœ°æ–¹å°±æ˜¯ç¼ºå£çš„èµ·å§‹ X åæ ‡ã€‚</li>
</ol>
<ul>
<li><p><strong>å¯¹äºç‚¹é€‰éªŒè¯ç  (ç›®æ ‡è¯†åˆ«)</strong>:</p>
</li>
<li><p>å¦‚æœç›®æ ‡æ˜¯å›ºå®šçš„æ–‡å­—æˆ–å›¾æ ‡ï¼Œå¯ä»¥é‡‡ç”¨ä¸æ»‘å—ç±»ä¼¼çš„<strong>æ¨¡æ¿åŒ¹é…</strong>æ–¹æ³•ã€‚</p>
</li>
<li><p>å¦‚æœç›®æ ‡æ˜¯å˜åŒ–çš„ã€å¤æ‚çš„ï¼Œä¾‹å¦‚&quot;è¯·ç‚¹å‡»å›¾ä¸­æ‰€æœ‰çš„å…¬äº¤è½¦&quot;ï¼Œåˆ™éœ€è¦ä¾èµ–æ›´é«˜çº§çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼ˆè§ç­–ç•¥äºŒï¼‰ã€‚</p>
</li>
</ul>
<h4>æ­¥éª¤ 2: è½¨è¿¹æ¨¡æ‹Ÿ (æ ¸å¿ƒå…³é”®)</h4>
<p>è¿™æ˜¯æ•´ä¸ªç»•è¿‡è¿‡ç¨‹çš„çµé­‚ã€‚ä¸€ä¸ªå¥½çš„è½¨è¿¹æ¨¡æ‹Ÿç®—æ³•éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼Œä»¥æ¬ºéª—æœåŠ¡å™¨ç«¯çš„è¡Œä¸ºåˆ†ææ¨¡å‹ï¼š</p>
<ul>
<li><p><strong>éçº¿æ€§ç§»åŠ¨</strong>: ç»å¯¹ä¸èƒ½æ˜¯ <code>(x1, y1)</code> åˆ° <code>(x2, y2)</code> çš„ç›´çº¿ã€‚è·¯å¾„éœ€è¦æ˜¯å¸¦æœ‰å¼§åº¦çš„æ›²çº¿ã€‚</p>
</li>
<li><p><strong>å˜é€Ÿç§»åŠ¨</strong>: æ¨¡æ‹Ÿäººç±»æ“ä½œçš„è‚Œè‚‰æ§åˆ¶ï¼Œè½¨è¿¹åº”è¯¥æ˜¯&quot;æ…¢-å¿«-æ…¢&quot;çš„æ¨¡å¼ã€‚</p>
</li>
<li><p><strong>åˆæ®µåŠ é€Ÿ</strong>: åˆå§‹ç§»åŠ¨é€Ÿåº¦è¾ƒæ…¢ã€‚</p>
</li>
<li><p><strong>ä¸­æ®µåŒ€é€Ÿ/åŠ é€Ÿ</strong>: ä¸­é—´è¿‡ç¨‹é€Ÿåº¦åŠ å¿«ã€‚</p>
</li>
<li><p><strong>æœ«æ®µå‡é€Ÿ</strong>: æ¥è¿‘ç›®æ ‡æ—¶ï¼Œé€Ÿåº¦ä¼šæ˜¾è‘—å‡æ…¢ï¼Œè¿›è¡Œå¾®è°ƒã€‚</p>
</li>
<li><p><strong>éšæœºæŠ–åŠ¨</strong>: åœ¨ä¸»è½¨è¿¹çš„åŸºç¡€ä¸Šï¼Œå åŠ å¾®å°çš„ã€éšæœºçš„ Y è½´ï¼ˆæœ‰æ—¶ä¹ŸåŒ…æ‹¬ X è½´ï¼‰åç§»ï¼Œæ¨¡æ‹Ÿæ‰‹éƒ¨è‡ªç„¶çš„æŠ–åŠ¨ã€‚</p>
</li>
<li><p><strong>è¶…è¶Šä¸å›é€€</strong>: æœ‰æ—¶å¯ä»¥æ¨¡æ‹Ÿ&quot;æ‹–è¿‡å¤´äº†ä¸€ç‚¹ç‚¹ï¼Œå†å¾€å›æ‹‰&quot;çš„è¡Œä¸ºï¼Œè¿™ä¼šæå¤§åœ°å¢åŠ è½¨è¿¹çš„å¯ä¿¡åº¦ã€‚</p>
</li>
<li><p><strong>åœé¡¿</strong>: åœ¨æ‹–åŠ¨è¿‡ç¨‹ä¸­å¯ä»¥åŠ å…¥çŸ­æš‚çš„ã€éšæœºæ—¶é•¿çš„åœé¡¿ã€‚</p>
</li>
<li><p><strong>å®ç°ç¤ºä¾‹ (ä¼ªä»£ç )</strong>:</p>
</li>
</ul>
<pre><code class="language-python">def generate_human_like_track(target_distance):
track = []
current_pos = 0
# Movement pattern: accelerate first, then decelerate
while current_pos &lt; target_distance:
# 1. Calculate movement step size for current phase (non-uniform speed)
if current_pos &lt; target_distance * 0.7:
step = random.uniform(2, 4) # Acceleration phase
else:
step = random.uniform(0.5, 2) # Deceleration and fine-tuning phase

# 2. Add random jitter
y_offset = random.uniform(-1, 1)

# 3. Record trajectory point
track.append((step, y_offset, random.uniform(10, 50))) # (x step, y offset, time interval ms)
current_pos += step

# (Optional) Add &quot;overshoot and pull back&quot; trajectory points
# ...
return track

</code></pre>
<ul>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>: éœ€è¦ä»ä¸€å¼ å¤§å›¾ä¸­è¯†åˆ«å¹¶å®šä½å¤šä¸ªä¸è§„åˆ™ç‰©ä½“çš„ç‚¹é€‰éªŒè¯ç ï¼ˆä¾‹å¦‚ï¼Œ&quot;é€‰å‡ºæ‰€æœ‰çš„çº¢ç»¿ç¯&quot;ï¼‰ã€‚</p>
</li>
<li><p><strong>æ–¹æ³•</strong>:</p>
</li>
</ul>
<ol>
<li><strong>æ•°æ®æ ‡æ³¨</strong>: æ”¶é›†å¤§é‡çš„éªŒè¯ç å›¾ç‰‡ï¼Œå¹¶æ‰‹åŠ¨æ ‡æ³¨å‡ºéœ€è¦è¯†åˆ«çš„ç‰©ä½“ï¼ˆå¦‚&quot;çº¢ç»¿ç¯&quot;ã€&quot;å…¬äº¤è½¦&quot;ï¼‰ã€‚</li>
<li><strong>æ¨¡å‹è®­ç»ƒ</strong>: ä½¿ç”¨æ ‡æ³¨å¥½çš„æ•°æ®é›†è®­ç»ƒä¸€ä¸ªç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œå¦‚ YOLOv5 æˆ– SSDã€‚</li>
<li><strong>æ¨ç†</strong>: åœ¨å®é™…ç»•è¿‡æ—¶ï¼Œå°†éªŒè¯ç å›¾ç‰‡è¾“å…¥åˆ°è®­ç»ƒå¥½çš„æ¨¡å‹ä¸­ï¼Œæ¨¡å‹ä¼šè¿”å›æ‰€æœ‰è¯†åˆ«åˆ°çš„ç›®æ ‡çš„ä½ç½®åæ ‡ã€‚</li>
<li><strong>åç»­æ“ä½œ</strong>: æ‹¿åˆ°åæ ‡åï¼Œå†ç»“åˆä¸Šä¸€èŠ‚çš„&quot;è½¨è¿¹æ¨¡æ‹Ÿ&quot;æ–¹æ³•å»ç‚¹å‡»ã€‚</li>
</ol>
<h4>ç¬¬ä¸‰æ–¹æ‰“ç å¹³å°</h4>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: å°†è¯†åˆ«éªŒè¯ç è¿™ä¸€ä¸“ä¸šä»»åŠ¡å¤–åŒ…ç»™ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚è¿™äº›å¹³å°èƒŒåé€šå¸¸æ˜¯å¤§é‡çš„äººå·¥æˆ–è€…æ›´å¼ºå¤§çš„ AI æ¨¡å‹ã€‚</p>
</li>
<li><p><strong>ä»£è¡¨æœåŠ¡</strong>: 2Captcha, Anti-Captcha ç­‰ã€‚</p>
</li>
<li><p><strong>å·¥ä½œæµç¨‹</strong>:</p>
</li>
</ul>
<ol>
<li>æ³¨å†Œå¹¶å……å€¼ã€‚</li>
<li>é€šè¿‡ API å°†éªŒè¯ç å›¾ç‰‡ï¼ˆæˆ–ä»»åŠ¡æè¿°ï¼‰å‘é€ç»™å¹³å°ã€‚</li>
<li>å¹³å°è¿”å›ç»“æœï¼ˆå¦‚æ»‘å—çš„ X åæ ‡ï¼Œæˆ–ç‚¹é€‰ç›®æ ‡çš„åæ ‡åºåˆ—ï¼‰ã€‚</li>
<li>ä½ çš„ç¨‹åºæ‹¿åˆ°ç»“æœåï¼Œå†æ‰§è¡Œåç»­çš„æ¨¡æ‹Ÿæ“ä½œã€‚</li>
</ol>
<ul>
<li><p><strong>ä¼˜ç‚¹</strong>: æˆåŠŸç‡æé«˜ï¼Œèƒ½è§£å†³å‡ ä¹æ‰€æœ‰ç±»å‹çš„éªŒè¯ç ï¼Œæ— éœ€è‡ªå·±ç»´æŠ¤å¤æ‚çš„è¯†åˆ«æ¨¡å‹ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: éœ€è¦ä»˜è´¹ï¼Œå­˜åœ¨éšç§å’Œå®‰å…¨é£é™©ï¼ˆå°†æ•°æ®å‘ç»™ç¬¬ä¸‰æ–¹ï¼‰ï¼Œæœ‰ç½‘ç»œå»¶è¿Ÿã€‚</p>
</li>
</ul>
<hr />
<h3>ç»•è¿‡ç­–ç•¥ä¸‰ï¼šå¯»æ‰¾é€»è¾‘æ¼æ´</h3>
<p>åœ¨æŠ•å…¥å¤§é‡ç²¾åŠ›ç¼–å†™å¤æ‚çš„æ¨¡æ‹Ÿå’Œè¯†åˆ«ä»£ç å‰ï¼Œå…ˆå°è¯•å¯»æ‰¾&quot;æ·å¾„&quot;æ˜¯ä¸€ç§é«˜æ€§ä»·æ¯”çš„ç­–ç•¥ã€‚</p>
<ul>
<li><p><strong>åˆ†æå‰ç«¯ JS</strong>: ä»”ç»†å®¡æŸ¥é¡µé¢çš„ JavaScript æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸éªŒè¯ç ç›¸å…³çš„é€»è¾‘ã€‚æœ‰æ—¶å¯èƒ½ä¼šå‘ç°ï¼š</p>
</li>
<li><p><strong>ç­”æ¡ˆç¡¬ç¼–ç æˆ–å¼±åŠ å¯†</strong>: ç¼ºå£ä½ç½®ã€ç›®æ ‡åæ ‡ç­‰ä¿¡æ¯ä»¥æ˜æ–‡æˆ–ç®€å•åŠ å¯†çš„æ–¹å¼å­˜åœ¨äºå‰ç«¯ä»£ç ä¸­ã€‚</p>
</li>
<li><p><strong>å¯é¢„æµ‹çš„éšæœºæ•°</strong>: ç”¨äºç”ŸæˆéªŒè¯ç çš„éšæœºç§å­æˆ–ç®—æ³•è¿‡äºç®€å•ï¼Œå¯ä»¥è¢«é¢„æµ‹ã€‚</p>
</li>
<li><p><strong>API æ¼æ´</strong>:</p>
</li>
<li><p><strong>éªŒè¯ç»•è¿‡</strong>: å°è¯•ç›´æ¥è°ƒç”¨æäº¤è¡¨å•çš„ APIï¼Œä½†ä¸å¸¦éªŒè¯ç ç›¸å…³çš„å‚æ•°ï¼Œçœ‹åç«¯æ˜¯å¦å¼ºåˆ¶æ ¡éªŒã€‚</p>
</li>
<li><p><strong>Token é‡æ”¾</strong>: æˆåŠŸé€šè¿‡ä¸€æ¬¡éªŒè¯åï¼Œè·å–åˆ°çš„ <code>session_token</code> æˆ– <code>captcha_id</code> æ˜¯å¦å¯ä»¥è¢«å¤šæ¬¡é‡ç”¨ã€‚</p>
</li>
</ul>
<hr />
<h3>é˜²å¾¡ä¸å¯¹æŠ—çš„æ¼”è¿›</h3>
<p>éªŒè¯ç æä¾›å•†ä¹Ÿåœ¨ä¸æ–­è¿›åŒ–ï¼Œä»¥å¯¹æŠ—ä¸Šè¿°ç»•è¿‡æŠ€æœ¯ï¼š</p>
<ul>
<li><p><strong>ç¯å¢ƒæ£€æµ‹</strong>: æ£€æµ‹ WebDriver ç‰¹å¾ï¼ˆå¦‚ <code>navigator.webdriver</code> æ ‡å¿—ï¼‰ã€æµè§ˆå™¨æŒ‡çº¹ã€å­—ä½“ã€åˆ†è¾¨ç‡ç­‰ã€‚</p>
</li>
<li><p><strong>æ›´å¤æ‚çš„è¡Œä¸ºåˆ†æ</strong>: ä¸ä»…ä»…æ˜¯è½¨è¿¹ï¼Œè¿˜ä¼šåˆ†æç‚¹å‡»å‹åŠ›ã€æ»šè½®è¡Œä¸ºã€é¼ æ ‡åŠ é€Ÿåº¦ç­‰æ›´æ·±å±‚æ¬¡çš„ç”Ÿç‰©ç‰¹å¾ã€‚</p>
</li>
<li><p><strong>å›¾åƒå¹²æ‰°</strong>: åœ¨éªŒè¯ç å›¾ç‰‡ä¸Šå¢åŠ å¹²æ‰°çº¿ã€å™ªç‚¹ã€å½¢å˜ã€é¢œè‰²æŠ–åŠ¨ï¼Œå¢åŠ  CV è¯†åˆ«éš¾åº¦ã€‚</p>
</li>
<li><p><strong>æ— æ„ŸéªŒè¯ (reCAPTCHA v3)</strong>: å®Œå…¨åœ¨åå°æ ¹æ®ç”¨æˆ·çš„ç»¼åˆè¡Œä¸ºè¯„åˆ†ï¼Œåˆ†æ•°è¿‡ä½æ—¶æ‰å¼¹å‡ºæŒ‘æˆ˜ã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-11">
                                                <h2>11. R09: App Hardening Identification</h2>
                                                <h1>R09: ä¸»æµåº”ç”¨åŠ å›ºå‚å•†åŠå…¶ç‰¹å¾è¯†åˆ«</h1>
<p>Android åº”ç”¨åŠ å›ºæ˜¯ä¸€ç§ä¿æŠ¤ App ä¸è¢«è½»æ˜“é€†å‘ã€ç¯¡æ”¹æˆ–æ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µã€‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œåœ¨å¼€å§‹åˆ†æä¸€ä¸ª App ä¹‹å‰ï¼Œ<strong>é¦–è¦ä»»åŠ¡å°±æ˜¯è¯†åˆ«å‡ºå®ƒæ‰€ä½¿ç”¨çš„åŠ å›ºå‚å•†</strong>ï¼Œå› ä¸ºä¸åŒçš„åŠ å›ºæ–¹æ¡ˆéœ€è¦ä¸åŒçš„è„±å£³å’Œåˆ†æç­–ç•¥ã€‚</p>
<p>æœ¬æŒ‡å—æ—¨åœ¨ç³»ç»Ÿæ€§åœ°æ€»ç»“ä¸­å›½å¸‚åœºä¸»æµåŠ å›ºå‚å•†çš„é™æ€ç‰¹å¾&quot;æŒ‡çº¹&quot;ï¼Œå¸®åŠ©åˆ†æäººå‘˜å¿«é€Ÿè¯†åˆ«ç›®æ ‡ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E9%80%9A%E7%94%A8%E8%AF%86%E5%88%AB%E6%80%9D%E8%B7%AF"><strong>é€šç”¨è¯†åˆ«æ€è·¯</strong></a></li>
<li><a href="#%E4%B8%BB%E6%B5%81%E5%8E%82%E5%95%86%E7%89%B9%E5%BE%81%E8%AF%A6%E8%A7%A3"><strong>ä¸»æµå‚å•†ç‰¹å¾è¯¦è§£</strong></a></li>
</ol>
<ul>
<li><a href="#%E4%B8%BB%E6%B5%81%E5%BA%94%E7%94%A8%E5%8A%A0%E5%9B%BA%E5%8E%82%E5%95%86%E5%8F%8A%E5%85%B6%E7%89%B9%E5%BE%81%E8%AF%86%E5%88%AB">ä¸»æµåº”ç”¨åŠ å›ºå‚å•†åŠå…¶ç‰¹å¾è¯†åˆ«</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li>
<li><a href="#%E9%80%9A%E7%94%A8%E8%AF%86%E5%88%AB%E6%80%9D%E8%B7%AF">é€šç”¨è¯†åˆ«æ€è·¯</a></li>
<li><a href="#%E4%B8%BB%E6%B5%81%E5%8E%82%E5%95%86%E7%89%B9%E5%BE%81%E8%AF%A6%E8%A7%A3">ä¸»æµå‚å•†ç‰¹å¾è¯¦è§£</a><ul>
<li><a href="#%E6%A2%86%E6%A2%86%E5%AE%89%E5%85%A8-bangcle">æ¢†æ¢†å®‰å…¨ (Bangcle)</a></li>
<li><a href="#360-%E5%8A%A0%E5%9B%BA-qihoo-360">360 åŠ å›º (Qihoo 360)</a></li>
<li><a href="#%E8%85%BE%E8%AE%AF%E4%B9%90%E5%9B%BA-tencent-legu">è…¾è®¯ä¹å›º (Tencent Legu)</a></li>
<li><a href="#%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE-netease-yidun">ç½‘æ˜“æ˜“ç›¾ (Netease Yidun)</a></li>
<li><a href="#%E7%88%B1%E5%8A%A0%E5%AF%86-ijiami">çˆ±åŠ å¯† (Ijiami)</a></li>
</ul>
</li>
<li><a href="#%E5%BF%AB%E9%80%9F%E8%AF%86%E5%88%AB%E6%91%98%E8%A6%81%E8%A1%A8">å¿«é€Ÿè¯†åˆ«æ‘˜è¦è¡¨</a></li>
</ul>
</li>
</ul>
<ol start="3">
<li><a href="#%E5%BF%AB%E9%80%9F%E8%AF%86%E5%88%AB%E6%91%98%E8%A6%81%E8%A1%A8"><strong>å¿«é€Ÿè¯†åˆ«æ‘˜è¦è¡¨</strong></a></li>
</ol>
<hr />
<h2>é€šç”¨è¯†åˆ«æ€è·¯</h2>
<p>è¯†åˆ«åŠ å›ºå‚å•†é€šå¸¸éµå¾ªä»¥ä¸‹é™æ€åˆ†æè·¯å¾„ï¼š</p>
<ol>
<li><strong>æ£€æŸ¥ DEX æ–‡ä»¶</strong>ï¼šè§£å‹ APKï¼ŒæŸ¥çœ‹ä¸» <code>classes.dex</code> æ–‡ä»¶çš„å¤§å°ã€‚å¦‚æœå®ƒéå¸¸å°ï¼ˆé€šå¸¸å°äº 1MBï¼‰ï¼Œè€Œ APK æœ¬èº«ä½“ç§¯å¾ˆå¤§ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ª&quot;å£³&quot;ï¼Œè´Ÿè´£åŠ è½½çœŸæ­£çš„ã€è¢«åŠ å¯†éšè—èµ·æ¥çš„ DEXã€‚</li>
<li><strong>æ£€æŸ¥ SO åº“</strong>ï¼šæŸ¥çœ‹ <code>lib/[arch]/</code> ç›®å½•ä¸‹çš„ <code>.so</code> æ–‡ä»¶åˆ—è¡¨ã€‚åŠ å›ºå‚å•†é€šå¸¸ä¼šæ”¾å…¥å¸¦æœ‰è‡ªèº«å“ç‰Œæ ‡è¯†çš„ SO åº“ï¼Œè¿™æ˜¯æœ€æ˜æ˜¾çš„ç‰¹å¾ã€‚</li>
<li><strong>æ£€æŸ¥ <code>assets</code> ç›®å½•</strong>ï¼šå¾ˆå¤šåŠ å›ºæ–¹æ¡ˆä¼šå°†åŠ å¯†åçš„ DEX æ–‡ä»¶ã€é…ç½®æ–‡ä»¶æˆ–å…¶ä»–ç»„ä»¶æ”¾å…¥ <code>assets</code> ç›®å½•ã€‚</li>
<li><strong>æ£€æŸ¥ <code>AndroidManifest.xml</code></strong>ï¼šåŠ å›ºæ–¹æ¡ˆé€šå¸¸ä¼šç”¨è‡ªå·±çš„ä»£ç† <code>Application</code> ç±»æ›¿æ¢æ‰åŸå§‹çš„ <code>Application</code> ç±»ã€‚æ£€æŸ¥ <code>application</code> æ ‡ç­¾ä¸‹çš„ <code>android:name</code> å±æ€§ï¼Œå¯ä»¥æ‰¾åˆ°ä»£ç†ç±»çš„åå­—ï¼Œå…¶åŒ…åå¾€å¾€æš´éœ²å‚å•†ä¿¡æ¯ã€‚</li>
</ol>
<h2>ä¸»æµå‚å•†ç‰¹å¾è¯¦è§£</h2>
<h3>æ¢†æ¢†å®‰å…¨ (Bangcle)</h3>
<p>æ¢†æ¢†æ˜¯æœ€æ—©æœŸçš„åŠ å›ºå‚å•†ä¹‹ä¸€ï¼Œç‰¹å¾ç›¸å¯¹æ˜æ˜¾ã€‚</p>
<ul>
<li><p><strong>SO åº“ç‰¹å¾</strong>:</p>
</li>
<li><p><code>libSecShell.so</code></p>
</li>
<li><p><code>libsecexe.so</code></p>
</li>
<li><p><code>libsecmain.so</code></p>
</li>
<li><p><strong>Java å±‚ç‰¹å¾</strong>:</p>
</li>
<li><p>ä»£ç† Application åŒ…åï¼š<code>com.bangcle.protect</code> æˆ– <code>com.secshell.shell</code>ã€‚</p>
</li>
<li><p><strong><code>assets</code> ç›®å½•ç‰¹å¾</strong>:</p>
</li>
<li><p>å¯èƒ½ä¼šæœ‰ <code>bangcle_classes.jar</code> æˆ–ç±»ä¼¼å‘½åçš„åŠ å¯† DEX æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>å…¶ä»–</strong>:</p>
</li>
<li><p><code>AndroidManifest.xml</code> çš„ <code>meta-data</code> ä¸­å¯èƒ½ä¼šåŒ…å«åŸå§‹ Application çš„ä¿¡æ¯ã€‚</p>
</li>
</ul>
<h3>360 åŠ å›º (Qihoo 360)</h3>
<p>360 åŠ å›ºéå¸¸æ™®éï¼Œå…¶ç‰¹å¾ä¹Ÿå¹¿ä¸ºäººçŸ¥ã€‚</p>
<ul>
<li><p><strong>SO åº“ç‰¹å¾</strong>:</p>
</li>
<li><p><code>libjiagu.so</code></p>
</li>
<li><p><code>libprotectClass.so</code></p>
</li>
<li><p><code>libjiagu_x86.so</code> / <code>libjiagu_art.so</code></p>
</li>
<li><p><strong>Java å±‚ç‰¹å¾</strong>:</p>
</li>
<li><p>ä»£ç† Application åŒ…åï¼š<code>com.qihoo.util</code>ã€‚</p>
</li>
<li><p>å¯åŠ¨ç±»ä¸­å¯èƒ½åŒ…å« <code>com.stub.StubApp</code>ã€‚</p>
</li>
<li><p><strong><code>assets</code> ç›®å½•ç‰¹å¾</strong>:</p>
</li>
<li><p><code>libjiagu.so</code> (æ˜¯çš„ï¼Œæœ‰æ—¶ä¹Ÿä¼šæ”¾åœ¨ assets é‡Œ)</p>
</li>
<li><p><code>.jiagu</code> åç¼€çš„åŠ å¯†æ–‡ä»¶ã€‚</p>
</li>
</ul>
<h3>è…¾è®¯ä¹å›º (Tencent Legu)</h3>
<p>è…¾è®¯ä¹å›ºé€šå¸¸ä¸ Bugly SDK ä¸€èµ·å‡ºç°ï¼Œç‰¹å¾æ˜æ˜¾ã€‚</p>
<ul>
<li><p><strong>SO åº“ç‰¹å¾</strong>:</p>
</li>
<li><p><code>liblegu.so</code></p>
</li>
<li><p><code>libshella-xxxx.so</code> (xxxx æ˜¯ç‰ˆæœ¬å·)</p>
</li>
<li><p><strong>Java å±‚ç‰¹å¾</strong>:</p>
</li>
<li><p>ä»£ç† Application åŒ…åï¼š<code>com.tencent.bugly.legu</code>ã€‚</p>
</li>
<li><p><strong><code>assets</code> ç›®å½•ç‰¹å¾</strong>:</p>
</li>
<li><p><code>legu_data.so</code></p>
</li>
<li><p><code>tosversion</code> æ–‡ä»¶</p>
</li>
<li><p><strong>å…¶ä»–</strong>:</p>
</li>
<li><p>DEX æ–‡ä»¶å¤´é€šå¸¸è¢«ä¿®æ”¹ä¸º <code>legu</code>ã€‚</p>
</li>
</ul>
<h3>ç½‘æ˜“æ˜“ç›¾ (Netease Yidun)</h3>
<p>ç½‘æ˜“æ˜“ç›¾æ˜¯è¿‘å¹´æ¥å…´èµ·çš„ä¸€æ¬¾å¼ºå¤§åŠ å›ºï¼Œç‰¹å¾ä¹Ÿæ¯”è¾ƒç‹¬ç‰¹ã€‚</p>
<ul>
<li><p><strong>SO åº“ç‰¹å¾</strong>:</p>
</li>
<li><p><code>libnesec.so</code> (æœ€æ ¸å¿ƒçš„ç‰¹å¾)</p>
</li>
<li><p><strong>Java å±‚ç‰¹å¾</strong>:</p>
</li>
<li><p>ä»£ç† Application åŒ…åï¼š<code>com.netease.nis.wrapper</code>ã€‚</p>
</li>
<li><p><strong><code>assets</code> ç›®å½•ç‰¹å¾</strong>:</p>
</li>
<li><p><code>nesec.dat</code></p>
</li>
<li><p><code>classes.dex.ys</code> (åŠ å¯†çš„ä¸» DEX)</p>
</li>
<li><p><code>xxx.dat</code> æ ¼å¼çš„åŠ å¯† DEX æ–‡ä»¶ã€‚</p>
</li>
</ul>
<h3>çˆ±åŠ å¯† (Ijiami)</h3>
<p>çˆ±åŠ å¯†ä¹Ÿæ˜¯ä¸€æ¬¾å¸¸è§çš„åŠ å›ºäº§å“ã€‚</p>
<ul>
<li><p><strong>SO åº“ç‰¹å¾</strong>:</p>
</li>
<li><p><code>libexec.so</code></p>
</li>
<li><p><code>libexecmain.so</code></p>
</li>
<li><p><code>libijiami.so</code></p>
</li>
<li><p><strong>Java å±‚ç‰¹å¾</strong>:</p>
</li>
<li><p>ä»£ç† Application åŒ…åï¼š<code>com.ijiami.client.protect</code>ã€‚</p>
</li>
<li><p><strong><code>assets</code> ç›®å½•ç‰¹å¾</strong>:</p>
</li>
<li><p><code>ijiami.dat</code></p>
</li>
<li><p><code>ijm_lib</code> ç›®å½•</p>
</li>
</ul>
<hr />
<h2>å¿«é€Ÿè¯†åˆ«æ‘˜è¦è¡¨</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">åŠ å›ºå‚å•†</th>
  <th style="text-align:left">æ ¸å¿ƒ SO ç‰¹å¾</th>
  <th style="text-align:left">Java åŒ…å/ç±»åç‰¹å¾</th>
  <th style="text-align:left"><code>assets</code> ç›®å½•ç‰¹å¾</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>æ¢†æ¢†å®‰å…¨</strong></td>
  <td style="text-align:left"><code>libSecShell.so</code></td>
  <td style="text-align:left"><code>com.bangcle.protect</code></td>
  <td style="text-align:left"><code>bangcle_classes.jar</code></td>
</tr>
<tr>
  <td style="text-align:left"><strong>360 åŠ å›º</strong></td>
  <td style="text-align:left"><code>libjiagu.so</code>, <code>libprotectClass.so</code></td>
  <td style="text-align:left"><code>com.qihoo.util</code></td>
  <td style="text-align:left"><code>.jiagu</code> æ–‡ä»¶</td>
</tr>
<tr>
  <td style="text-align:left"><strong>è…¾è®¯ä¹å›º</strong></td>
  <td style="text-align:left"><code>liblegu.so</code></td>
  <td style="text-align:left"><code>com.tencent.bugly.legu</code></td>
  <td style="text-align:left"><code>legu_data.so</code></td>
</tr>
<tr>
  <td style="text-align:left"><strong>ç½‘æ˜“æ˜“ç›¾</strong></td>
  <td style="text-align:left"><code>libnesec.so</code></td>
  <td style="text-align:left"><code>com.netease.nis.wrapper</code></td>
  <td style="text-align:left"><code>nesec.dat</code>, <code>classes.dex.ys</code></td>
</tr>
<tr>
  <td style="text-align:left"><strong>çˆ±åŠ å¯†</strong></td>
  <td style="text-align:left"><code>libexec.so</code>, <code>libijiami.so</code></td>
  <td style="text-align:left"><code>com.ijiami.client.protect</code></td>
  <td style="text-align:left"><code>ijiami.dat</code></td>
</tr>
</tbody>
</table>

                                            </div>
                                            
                                            <div class="section" id="section-12">
                                                <h2>12. R10: Device Fingerprinting & Bypass</h2>
                                                <h1>R10: è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥</h1>
<ul>
<li><strong>è®¾å¤‡æŒ‡çº¹ (Device Fingerprinting)</strong> æ˜¯æŒ‡é€šè¿‡é‡‡é›†è®¾å¤‡çš„è½¯ç¡¬ä»¶ç‰¹å¾ï¼Œç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿå”¯ä¸€æ ‡è¯†è¯¥è®¾å¤‡çš„ã€å…·æœ‰é«˜ç†µå€¼å’Œç¨³å®šæ€§çš„ ID çš„è¿‡ç¨‹ã€‚åœ¨å½“ä»Šçš„äº’è”ç½‘æœåŠ¡ä¸­ï¼Œå®ƒå·²æˆä¸ºåæ¬ºè¯ˆã€åæœºå™¨äººã€ç”¨æˆ·è¡Œä¸ºè¿½è¸ªå’Œå®‰å…¨é£æ§çš„åŸºçŸ³æŠ€æœ¯ã€‚</li>
</ul>
<p>ç»•è¿‡è®¾å¤‡æŒ‡çº¹å¹¶éç®€å•åœ°ä¿®æ”¹ä¸€ä¸¤ä¸ªå‚æ•°ï¼Œè€Œæ˜¯è¦åˆ›é€ ä¸€ä¸ªå®Œæ•´çš„ã€é€»è¾‘è‡ªæ´½çš„ã€å¯ä¿¡çš„è™šæ‹Ÿè®¾å¤‡&quot;ç”»åƒ&quot;ã€‚æœ¬æŒ‡å—å°†ç³»ç»Ÿæ€§åœ°æ‹†è§£ä¸»æµçš„æŒ‡çº¹é‡‡é›†ç»´åº¦ï¼Œå¹¶æ¢è®¨ä¸ä¹‹å¯¹åº”çš„æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><p><a href="#%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%BB%95%E8%BF%87%E7%AD%96%E7%95%A5">è®¾å¤‡æŒ‡çº¹æŠ€æœ¯æ·±åº¦è§£æä¸ç»•è¿‡ç­–ç•¥</a></p>
</li>
<li><p><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></p>
</li>
<li><p><a href="#%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</a></p>
</li>
<li><p><a href="#%E6%8C%87%E7%BA%B9%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95">æŒ‡çº¹ç”Ÿæˆç®—æ³•</a></p>
</li>
<li><p><a href="#%E7%86%B5%E5%80%BC%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7">ç†µå€¼ä¸ç¨³å®šæ€§</a></p>
</li>
<li><p><a href="#%E6%8C%87%E7%BA%B9%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">æŒ‡çº¹æ›´æ–°ç­–ç•¥</a></p>
</li>
<li><p><a href="#%E4%B8%BB%E6%B5%81%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E9%87%87%E9%9B%86%E7%BB%B4%E5%BA%A6">ä¸»æµè®¾å¤‡æŒ‡çº¹é‡‡é›†ç»´åº¦</a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E5%B1%82%E6%A0%87%E8%AF%86%E7%AC%A6">ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦</a></p>
</li>
<li><p><a href="#%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%BD%AF%E4%BB%B6%E7%89%B9%E5%BE%81">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E7%89%B9%E6%80%A7%E6%8C%87%E7%BA%B9">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E9%80%9A%E8%BF%87-svc-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-%E8%8E%B7%E5%8F%96%E4%BF%A1%E6%81%AF">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨) è·å–ä¿¡æ¯</a></p>
</li>
<li><p><a href="#%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E6%8C%87%E7%BA%B9">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E8%A1%8C%E4%B8%BA%E7%89%B9%E5%BE%81%E6%8C%87%E7%BA%B9">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E6%A0%B8%E5%BF%83%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF%E4%B8%8E%E7%AD%96%E7%95%A5">æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ä¸ç­–ç•¥</a></p>
</li>
<li><p><a href="#hook-%E6%8A%80%E6%9C%AF-fridaxposed">Hook æŠ€æœ¯ (Frida/Xposed)</a></p>
</li>
<li><p><a href="#%E6%B7%B1%E5%BA%A6%E8%AE%BE%E5%A4%87%E4%BF%AE%E6%94%B9-%E6%94%B9%E6%9C%BA">æ·±åº¦è®¾å¤‡ä¿®æ”¹ (&quot;æ”¹æœº&quot;)</a></p>
</li>
<li><p><a href="#%E7%8E%AF%E5%A2%83%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</a></p>
</li>
<li><p><a href="#%E4%BA%91%E6%89%8B%E6%9C%BA%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3">äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£</a></p>
</li>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E8%AE%BE%E5%A4%87%E7%94%BB%E5%83%8F">æ„å»ºä¸€è‡´æ€§çš„&quot;è®¾å¤‡ç”»åƒ&quot;</a></p>
</li>
<li><p><a href="#%E5%95%86%E4%B8%9A%E5%8C%96%E4%BA%A7%E5%93%81%E4%B8%8E%E6%9C%8D%E5%8A%A1">å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡</a></p>
</li>
<li><p><a href="#%E5%9B%BD%E5%86%85%E4%B8%BB%E6%B5%81%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E6%9C%8D%E5%8A%A1%E5%95%86">å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†</a></p>
</li>
<li><p><a href="#%E5%9B%BD%E9%99%85%E7%9F%A5%E5%90%8D%E4%BA%A7%E5%93%81">å›½é™…çŸ¥åäº§å“</a></p>
</li>
<li><p><a href="#%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%E4%B8%8E%E6%A1%86%E6%9E%B6">å¼€æºå·¥å…·ä¸æ¡†æ¶</a></p>
</li>
<li><p><a href="#%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E9%87%87%E9%9B%86%E6%A1%86%E6%9E%B6">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</a></p>
</li>
<li><p><a href="#%E5%8F%8D%E6%8C%87%E7%BA%B9%E5%B7%A5%E5%85%B7">åæŒ‡çº¹å·¥å…·</a></p>
</li>
<li><p><a href="#%E5%AF%B9%E6%8A%97%E4%B8%8E%E6%8C%91%E6%88%98">å¯¹æŠ—ä¸æŒ‘æˆ˜</a></p>
</li>
<li><p><a href="#hook-%E6%A1%86%E6%9E%B6%E6%A3%80%E6%B5%8B">Hook æ¡†æ¶æ£€æµ‹</a></p>
</li>
<li><p><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81">æœåŠ¡ç«¯äº¤å‰éªŒè¯</a></p>
</li>
<li><p><a href="#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A3%80%E6%B5%8B">æœºå™¨å­¦ä¹ æ£€æµ‹</a></p>
</li>
<li><p><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">å®æˆ˜æ¡ˆä¾‹åˆ†æ</a></p>
</li>
<li><p><a href="#%E6%A1%88%E4%BE%8B1%E6%9F%90%E7%94%B5%E5%95%86%E5%B9%B3%E5%8F%B0%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E5%88%86%E6%9E%90">æ¡ˆä¾‹ 1ï¼šæŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ</a></p>
</li>
<li><p><a href="#%E6%A1%88%E4%BE%8B2%E9%87%91%E8%9E%8Dapp%E9%A3%8E%E6%8E%A7%E7%BB%95%E8%BF%87">æ¡ˆä¾‹ 2ï¼šé‡‘è App é£æ§ç»•è¿‡</a></p>
</li>
<li><p><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></p>
</li>
<li><p><a href="#%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</a></p>
</li>
<li><p><a href="#%E6%8C%87%E7%BA%B9%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95">æŒ‡çº¹ç”Ÿæˆç®—æ³•</a></p>
</li>
<li><p><a href="#%E7%86%B5%E5%80%BC%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7">ç†µå€¼ä¸ç¨³å®šæ€§</a></p>
</li>
<li><p><a href="#%E6%8C%87%E7%BA%B9%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">æŒ‡çº¹æ›´æ–°ç­–ç•¥</a></p>
</li>
<li><p><a href="#%E6%8C%87%E7%BA%B9%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95">æŒ‡çº¹ç”Ÿæˆç®—æ³•</a></p>
</li>
<li><p><a href="#%E7%86%B5%E5%80%BC%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7">ç†µå€¼ä¸ç¨³å®šæ€§</a></p>
</li>
<li><p><a href="#%E6%8C%87%E7%BA%B9%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">æŒ‡çº¹æ›´æ–°ç­–ç•¥</a></p>
</li>
<li><p><a href="#%E4%B8%BB%E6%B5%81%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E9%87%87%E9%9B%86%E7%BB%B4%E5%BA%A6">ä¸»æµè®¾å¤‡æŒ‡çº¹é‡‡é›†ç»´åº¦</a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E5%B1%82%E6%A0%87%E8%AF%86%E7%AC%A6">ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦</a></p>
</li>
<li><p><a href="#%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%BD%AF%E4%BB%B6%E7%89%B9%E5%BE%81">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E7%89%B9%E6%80%A7%E6%8C%87%E7%BA%B9">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E9%80%9A%E8%BF%87-svc-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-%E8%8E%B7%E5%8F%96%E4%BF%A1%E6%81%AF">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨) è·å–ä¿¡æ¯</a></p>
</li>
<li><p><a href="#%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E6%8C%87%E7%BA%B9">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E8%A1%8C%E4%B8%BA%E7%89%B9%E5%BE%81%E6%8C%87%E7%BA%B9">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E5%B1%82%E6%A0%87%E8%AF%86%E7%AC%A6">ç¡¬ä»¶å±‚æ ‡è¯†ç¬¦</a></p>
</li>
<li><p><a href="#%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%BD%AF%E4%BB%B6%E7%89%B9%E5%BE%81">ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E7%89%B9%E6%80%A7%E6%8C%87%E7%BA%B9">ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E9%80%9A%E8%BF%87-svc-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-%E8%8E%B7%E5%8F%96%E4%BF%A1%E6%81%AF">é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨) è·å–ä¿¡æ¯</a></p>
</li>
<li><p><a href="#%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E6%8C%87%E7%BA%B9">ç½‘ç»œç¯å¢ƒæŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E8%A1%8C%E4%B8%BA%E7%89%B9%E5%BE%81%E6%8C%87%E7%BA%B9">è¡Œä¸ºç‰¹å¾æŒ‡çº¹</a></p>
</li>
<li><p><a href="#%E6%A0%B8%E5%BF%83%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF%E4%B8%8E%E7%AD%96%E7%95%A5">æ ¸å¿ƒç»•è¿‡æŠ€æœ¯ä¸ç­–ç•¥</a></p>
</li>
<li><p><a href="#hook-%E6%8A%80%E6%9C%AF-fridaxposed">Hook æŠ€æœ¯ (Frida/Xposed)</a></p>
</li>
<li><p><a href="#%E6%B7%B1%E5%BA%A6%E8%AE%BE%E5%A4%87%E4%BF%AE%E6%94%B9-%E6%94%B9%E6%9C%BA">æ·±åº¦è®¾å¤‡ä¿®æ”¹ (&quot;æ”¹æœº&quot;)</a></p>
</li>
<li><p><a href="#%E7%8E%AF%E5%A2%83%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</a></p>
</li>
<li><p><a href="#%E4%BA%91%E6%89%8B%E6%9C%BA%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3">äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£</a></p>
</li>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E8%AE%BE%E5%A4%87%E7%94%BB%E5%83%8F">æ„å»ºä¸€è‡´æ€§çš„&quot;è®¾å¤‡ç”»åƒ&quot;</a></p>
</li>
<li><p><a href="#hook-%E6%8A%80%E6%9C%AF-fridaxposed">Hook æŠ€æœ¯ (Frida/Xposed)</a></p>
</li>
<li><p><a href="#%E6%B7%B1%E5%BA%A6%E8%AE%BE%E5%A4%87%E4%BF%AE%E6%94%B9-%E6%94%B9%E6%9C%BA">æ·±åº¦è®¾å¤‡ä¿®æ”¹ (&quot;æ”¹æœº&quot;)</a></p>
</li>
<li><p><a href="#%E7%8E%AF%E5%A2%83%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF">ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</a></p>
</li>
<li><p><a href="#%E4%BA%91%E6%89%8B%E6%9C%BA%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3">äº‘æ‰‹æœºæŠ€æœ¯è¯¦è§£</a></p>
</li>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E8%AE%BE%E5%A4%87%E7%94%BB%E5%83%8F">æ„å»ºä¸€è‡´æ€§çš„&quot;è®¾å¤‡ç”»åƒ&quot;</a></p>
</li>
<li><p><a href="#%E5%95%86%E4%B8%9A%E5%8C%96%E4%BA%A7%E5%93%81%E4%B8%8E%E6%9C%8D%E5%8A%A1">å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡</a></p>
</li>
<li><p><a href="#%E5%9B%BD%E5%86%85%E4%B8%BB%E6%B5%81%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E6%9C%8D%E5%8A%A1%E5%95%86">å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†</a></p>
</li>
<li><p><a href="#%E5%9B%BD%E9%99%85%E7%9F%A5%E5%90%8D%E4%BA%A7%E5%93%81">å›½é™…çŸ¥åäº§å“</a></p>
</li>
<li><p><a href="#%E5%9B%BD%E5%86%85%E4%B8%BB%E6%B5%81%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E6%9C%8D%E5%8A%A1%E5%95%86">å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†</a></p>
</li>
<li><p><a href="#%E5%9B%BD%E9%99%85%E7%9F%A5%E5%90%8D%E4%BA%A7%E5%93%81">å›½é™…çŸ¥åäº§å“</a></p>
</li>
<li><p><a href="#%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%E4%B8%8E%E6%A1%86%E6%9E%B6">å¼€æºå·¥å…·ä¸æ¡†æ¶</a></p>
</li>
<li><p><a href="#%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E9%87%87%E9%9B%86%E6%A1%86%E6%9E%B6">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</a></p>
</li>
<li><p><a href="#%E5%8F%8D%E6%8C%87%E7%BA%B9%E5%B7%A5%E5%85%B7">åæŒ‡çº¹å·¥å…·</a></p>
</li>
<li><p><a href="#%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E9%87%87%E9%9B%86%E6%A1%86%E6%9E%B6">è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</a></p>
</li>
<li><p><a href="#%E5%8F%8D%E6%8C%87%E7%BA%B9%E5%B7%A5%E5%85%B7">åæŒ‡çº¹å·¥å…·</a></p>
</li>
<li><p><a href="#%E5%AF%B9%E6%8A%97%E4%B8%8E%E6%8C%91%E6%88%98">å¯¹æŠ—ä¸æŒ‘æˆ˜</a></p>
</li>
<li><p><a href="#hook-%E6%A1%86%E6%9E%B6%E6%A3%80%E6%B5%8B">Hook æ¡†æ¶æ£€æµ‹</a></p>
</li>
<li><p><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81">æœåŠ¡ç«¯äº¤å‰éªŒè¯</a></p>
</li>
<li><p><a href="#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A3%80%E6%B5%8B">æœºå™¨å­¦ä¹ æ£€æµ‹</a></p>
</li>
<li><p><a href="#hook-%E6%A1%86%E6%9E%B6%E6%A3%80%E6%B5%8B">Hook æ¡†æ¶æ£€æµ‹</a></p>
</li>
<li><p><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81">æœåŠ¡ç«¯äº¤å‰éªŒè¯</a></p>
</li>
<li><p><a href="#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A3%80%E6%B5%8B">æœºå™¨å­¦ä¹ æ£€æµ‹</a></p>
</li>
<li><p><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">å®æˆ˜æ¡ˆä¾‹åˆ†æ</a></p>
</li>
<li><p><a href="#%E6%A1%88%E4%BE%8B1%E6%9F%90%E7%94%B5%E5%95%86%E5%B9%B3%E5%8F%B0%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E5%88%86%E6%9E%90">æ¡ˆä¾‹ 1ï¼šæŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ</a></p>
</li>
<li><p><a href="#%E6%A1%88%E4%BE%8B2%E9%87%91%E8%9E%8Dapp%E9%A3%8E%E6%8E%A7%E7%BB%95%E8%BF%87">æ¡ˆä¾‹ 2ï¼šé‡‘è App é£æ§ç»•è¿‡</a></p>
</li>
<li><p><a href="#%E6%A1%88%E4%BE%8B1%E6%9F%90%E7%94%B5%E5%95%86%E5%B9%B3%E5%8F%B0%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9%E5%88%86%E6%9E%90">æ¡ˆä¾‹ 1ï¼šæŸç”µå•†å¹³å°è®¾å¤‡æŒ‡çº¹åˆ†æ</a></p>
</li>
<li><p><a href="#%E6%A1%88%E4%BE%8B2%E9%87%91%E8%9E%8Dapp%E9%A3%8E%E6%8E%A7%E7%BB%95%E8%BF%87">æ¡ˆä¾‹ 2ï¼šé‡‘è App é£æ§ç»•è¿‡</a></p>
</li>
</ul>
<hr />
<h2>è®¾å¤‡æŒ‡çº¹çš„å·¥ä½œåŸç†</h2>
<h3>æŒ‡çº¹ç”Ÿæˆç®—æ³•</h3>
<p>è®¾å¤‡æŒ‡çº¹çš„ç”Ÿæˆå¹¶éç®€å•åœ°å°†æ‰€æœ‰é‡‡é›†åˆ°çš„ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯é€šè¿‡å¤æ‚çš„ç®—æ³•å¤„ç†ï¼Œç¡®ä¿ç”Ÿæˆçš„æŒ‡çº¹å…·æœ‰å”¯ä¸€æ€§ã€ç¨³å®šæ€§å’Œä¸å¯é€†æ€§ã€‚</p>
<h4>åŸºæœ¬æµç¨‹</h4>
<pre><code>å¯¹é‡‡é›†åˆ°çš„åŸå§‹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼š
- **æ ¼å¼ç»Ÿä¸€**: å°†ä¸åŒæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼ˆå¦‚MACåœ°å€ç»Ÿä¸€ä¸ºå°å†™ã€å»é™¤åˆ†éš”ç¬¦ï¼‰
- **ç¼ºå¤±å€¼å¤„ç†**: å¯¹æ— æ³•è·å–çš„å­—æ®µä½¿ç”¨é»˜è®¤å€¼æˆ–ç‰¹æ®Šæ ‡è®°
- **æƒé‡åˆ†é…**: æ ¹æ®ç¨³å®šæ€§å’Œå”¯ä¸€æ€§ç»™ä¸åŒç»´åº¦åˆ†é…æƒé‡


**3. ç‰¹å¾ç»„åˆ**
å°†å¤„ç†åçš„æ•°æ®æŒ‰ç…§é¢„å®šè§„åˆ™ç»„åˆï¼š
</code></pre>
<pre><code class="language-python"># æ¦‚å¿µä»£ç 
fingerprint_input = {
'hardware': {
'android_id': 'abc123',
'imei': '867530900000000',
'mac': '00:11:22:33:44:55'
},
'software': {
'model': 'Pixel 6',
'sdk': 33,
'fingerprint': 'google/raven/raven:...'
},
'environment': {
'screen': '1080x2400',
'dpi': 420,
'timezone': 'Asia/Shanghai'
}
}

</code></pre>
<p>import hashlib
import json</p>
<p>def generate_fingerprint(data):</p>
<h1>WillData è½¬ä¸º JSONStringï¼ˆç¡®ä¿é¡ºåºä¸€è‡´ï¼‰</h1>
<p>json_str = json.dumps(data, sort_keys=True)</p>
<h1>CalculateSHA256</h1>
<p>fingerprint = hashlib.sha256(json_str.encode()).hexdigest()</p>
<p>return fingerprint</p>
<pre><code>
| ç®—æ³• | è¾“å‡ºé•¿åº¦ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|----------|
| MD5 | 128ä½ | é€Ÿåº¦å¿«ï¼Œä½†å®‰å…¨æ€§ä½ | ä½å®‰å…¨è¦æ±‚åœºæ™¯ |
| SHA-256 | 256ä½ | å®‰å…¨æ€§é«˜ï¼Œè®¡ç®—ç¨æ…¢ | é‡‘èã€é«˜å®‰å…¨åœºæ™¯ |
| MurmurHash | å¯å˜ | é€Ÿåº¦æå¿«ï¼Œé€‚åˆéåŠ å¯† | å¤§è§„æ¨¡æ•°æ®å¤„ç† |
| xxHash | å¯å˜ | æ€§èƒ½ä¼˜å¼‚ | å®æ—¶è®¡ç®—åœºæ™¯ |

#### é«˜çº§æŠ€æœ¯

* *1. æ¨¡ç³ŠHash (Fuzzy Hashing)**
å…è®¸è®¾å¤‡æŒ‡çº¹åœ¨ç»†å¾®å˜åŒ–æ—¶ä»èƒ½åŒ¹é…ã€‚ä½¿ç”¨ SimHashã€MinHash ç­‰ç®—æ³•ï¼š

```python
# SimHash æ¦‚å¿µImplement
def simhash(features, hash_bits=64):
&quot;&quot;&quot;
å°†ç‰¹å¾å‘é‡è½¬æ¢ä¸º SimHash å€¼
ç›¸ä¼¼ç‰¹å¾ä¼šäº§ç”Ÿç›¸ä¼¼HashValue
&quot;&quot;&quot;
v = [0] * hash_bits

for feature, weight in features.items():
h = hash(feature)
for i in range(hash_bits):
if h &amp; (1 &lt;&lt; i):
v[i] += weight
else:
v[i] -= weight

fingerprint = 0
for i in range(hash_bits):
if v[i] &gt;= 0:
fingerprint |= (1 &lt;&lt; i)

return fingerprint

</code></pre>
<ul>
<li><strong>ä¸‰çº§æŒ‡çº¹ï¼ˆç¯å¢ƒæŒ‡çº¹ï¼‰</strong>: åŸºäºç½‘ç»œã€è¡Œä¸ºç­‰ä¸´æ—¶ç‰¹å¾</li>
</ul>
<pre><code class="language-python">def generate_tiered_fingerprint(data):
# ä¸€çº§æŒ‡çº¹ï¼šç¡¬ä»¶ID
tier1 = hashlib.sha256(
f&quot;{data['imei']}|{data['android_id']}&quot;.encode()
).hexdigest()

# äºŒçº§æŒ‡çº¹ï¼šç³»ç»Ÿç‰¹å¾
tier2 = hashlib.sha256(
f&quot;{tier1}|{data['model']}|{data['sdk']}&quot;.encode()
).hexdigest()

# ä¸‰çº§æŒ‡çº¹ï¼šCompleteç‰¹å¾
tier3 = hashlib.sha256(
json.dumps(data, sort_keys=True).encode()
).hexdigest()

return {
'strong': tier1,
'medium': tier2,
'weak': tier3
}

</code></pre>
<ul>
<li>ä½¿ç”¨ PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰æå–å…³é”®ç‰¹å¾</li>
<li>ä½¿ç”¨èšç±»ç®—æ³•è¯†åˆ«å¼‚å¸¸è®¾å¤‡</li>
<li>ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ç”Ÿæˆè®¾å¤‡åµŒå…¥å‘é‡ï¼ˆEmbeddingï¼‰</li>
</ul>
<h3>ç†µå€¼ä¸ç¨³å®šæ€§</h3>
<p>å¥½çš„è®¾å¤‡æŒ‡çº¹éœ€è¦åœ¨<strong>å”¯ä¸€æ€§ï¼ˆé«˜ç†µå€¼ï¼‰</strong>å’Œ<strong>ç¨³å®šæ€§</strong>ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚</p>
<h4>ç†µå€¼è®¡ç®—</h4>
<p>ç†µå€¼è¡¡é‡ä¸€ä¸ªç‰¹å¾çš„ä¿¡æ¯é‡å’ŒåŒºåˆ†èƒ½åŠ›ï¼š</p>
<pre><code class="language-python">import math
from collections import Counter

def calculate_entropy(values):
&quot;&quot;&quot;
Calculateä¸€ç‰¹å¾é¦™å†œç†µ
ç†µå€¼è¶Šé«˜ï¼Œè¯´æ˜è¯¥ç‰¹å¾åŒºåˆ†èƒ½åŠ›è¶Šå¼º
&quot;&quot;&quot;
total = len(values)
counter = Counter(values)

entropy = 0
for count in counter.values():
p = count / total
entropy -= p * math.log2(p)

return entropy

# Example
android_ids = ['id1', 'id2', 'id3', ...] # é‡‡é›†æ•°æ®
entropy = calculate_entropy(android_ids)
print(f&quot;Android IDç†µValue: {entropy} bits&quot;)

</code></pre>
<p>| Android ID | 60+ bits | é«˜ | ä¸­ï¼ˆæ¢å¤å‡ºå‚ä¼šå˜ï¼‰ |
| MAC åœ°å€ | 48 bits | é«˜ | ä¸­ï¼ˆè¶Šæ¥è¶Šéš¾è·å–ï¼‰ |
| è®¾å¤‡å‹å· | 8-10 bits | ä½ | é«˜ |
| å±å¹•åˆ†è¾¨ç‡ | 6-8 bits | ä½ | é«˜ |
| ä¼ æ„Ÿå™¨åˆ—è¡¨ | 15-20 bits | ä¸­ | é«˜ |</p>
<h4>ç¨³å®šæ€§è¯„ä¼°</h4>
<p>ç¨³å®šæ€§æŒ‡çš„æ˜¯è®¾å¤‡åœ¨ä¸åŒæ—¶é—´ç‚¹ã€ä¸åŒç¯å¢ƒä¸‹ç”Ÿæˆçš„æŒ‡çº¹ä¸€è‡´æ€§ï¼š</p>
<pre><code class="language-python">def stability_score(fingerprints):
&quot;&quot;&quot;
è¯„ä¼°åŒä¸€è®¾å¤‡åœ¨ä¸åŒæ—¶é—´ç”Ÿæˆçš„æŒ‡çº¹Stableæ€§
fingerprints: åŒä¸€è®¾å¤‡å¤šæ¬¡ç”Ÿæˆçš„æŒ‡çº¹åˆ—è¡¨
&quot;&quot;&quot;
if len(fingerprints) &lt; 2:
return 1.0

# è®¡ç®—æŒ‡çº¹ä¹‹é—´ç›¸ä¼¼åº¦
base = fingerprints[0]
similarities = []

for fp in fingerprints[1:]:
# Hamming è·ç¦»
diff = sum(c1 != c2 for c1, c2 in zip(base, fp))
similarity = 1 - (diff / len(base))
similarities.append(similarity)

return sum(similarities) / len(similarities)

</code></pre>
<p>&quot;&quot;&quot;
è®¡ç®—æŒ‡çº¹æ–¹æ¡ˆè´¨é‡åˆ†æ•°
entropy: ç†µ Value (0-100)
stability: Stable æ€§ (0-1)
coverage: è®¾å¤‡è¦†ç›–ç‡ (0-1)
&quot;&quot;&quot;</p>
<h1>åŠ æƒè®¡ç®—</h1>
<p>score = (
entropy * 0.4 +           # å”¯ä¸€æ€§æƒé‡ 40%
stability * 50 * 0.4 +    # ç¨³å®šæ€§æƒé‡ 40%
coverage * 100 * 0.2      # è¦†ç›–ç‡æƒé‡ 20%
)
return score</p>
<pre><code>- è®¾å¤‡ç¡¬ä»¶å˜æ›´ï¼ˆæ¢SIMå¡ã€é‡ç½®è®¾å¤‡ï¼‰
- Appç‰ˆæœ¬å‡çº§ï¼ˆæŒ‡çº¹ç®—æ³•æ›´æ–°ï¼‰
- å®šæœŸåˆ·æ–°ï¼ˆå¦‚æ¯30å¤©ï¼‰


**2. è¢«åŠ¨æ›´æ–°**
- æ£€æµ‹åˆ°æŒ‡çº¹å†²çªï¼ˆå¤šä¸ªè®¾å¤‡å…·æœ‰ç›¸åŒæŒ‡çº¹ï¼‰
- æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼ˆç–‘ä¼¼æ”¹æœºï¼‰
- æœåŠ¡ç«¯è¦æ±‚å¼ºåˆ¶æ›´æ–°


#### æ›´æ–°ç­–ç•¥

```python
class FingerprintManager:
def should_update(self, old_fp, new_data):
&quot;&quot;&quot;
CheckisNoNeedUpdateæŒ‡çº¹
&quot;&quot;&quot;
# è®¡ç®—æ–°æŒ‡çº¹
new_fp = self.generate_fingerprint(new_data)

# 1. å…³KeyFieldå˜æ›´
critical_changed = self._check_critical_fields(old_fp, new_data)
if critical_changed:
return True, &quot;Critical field changed&quot;

# 2. ç›¸ä¼¼åº¦è¿‡ä½
similarity = self._calculate_similarity(old_fp, new_fp)
if similarity &lt; 0.7:
return True, &quot;Low similarity&quot;

# 3. Timeè¿‡æœŸ
if self._is_expired(old_fp):
return True, &quot;Expired&quot;

return False, &quot;No update needed&quot;

def update_fingerprint(self, device_id, new_fp, reason):
&quot;&quot;&quot;
æ›´æ–°æŒ‡çº¹æ—¶ä¿ç•™å†å²è®°å½•
&quot;&quot;&quot;
history = {
'device_id': device_id,
'old_fingerprint': self.current_fp,
'new_fingerprint': new_fp,
'update_reason': reason,
'timestamp': time.time()
}
self._save_history(history)
self.current_fp = new_fp

</code></pre>
<pre><code class="language-python">&quot;&quot;&quot;
ProcessæŒ‡çº¹æ¼‚ç§»
baseline_fp: åŸºçº¿æŒ‡çº¹
current_fp: CurrentæŒ‡çº¹
threshold: ç›¸ä¼¼åº¦é˜ˆValue
&quot;&quot;&quot;
similarity = calculate_similarity(baseline_fp, current_fp)

if similarity &gt;= threshold:
# å¯æ¥å—æ¼‚ç§»ï¼Œè§†ä¸ºåŒä¸€è®¾å¤‡
return &quot;same_device&quot;
elif similarity &gt;= 0.6:
# å¼‚å¸¸æ¼‚ç§»ï¼Œéœ€è¦äºŒæ¬¡éªŒè¯
return &quot;verification_needed&quot;
else:
# é‡å¤§å˜åŒ–ï¼Œç–‘ä¼¼æ–°è®¾å¤‡oræ”¹æœº
return &quot;new_device&quot;

</code></pre>
<p>è¿™äº›æ˜¯ä¼ ç»Ÿçš„ã€æƒé™è¾ƒé«˜çš„è®¾å¤‡ IDã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">æ ‡è¯†ç¬¦</th>
  <th style="text-align:left">è·å–æ–¹å¼ (Java API)</th>
  <th style="text-align:left">ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>Android ID</strong></td>
  <td style="text-align:left"><code>Settings.Secure.getString(resolver, &quot;android_id&quot;)</code></td>
  <td style="text-align:left">Android 8.0 ä»¥ä¸Šï¼Œå¯¹æ¯ä¸ª App å’Œç”¨æˆ·éƒ½ä¸åŒã€‚æ¢å¤å‡ºå‚è®¾ç½®ä¼šæ”¹å˜ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>IMEI/MEID</strong></td>
  <td style="text-align:left"><code>TelephonyManager.getImei()</code></td>
  <td style="text-align:left">æ‰‹æœºçš„å”¯ä¸€èº«ä»½ç ã€‚éœ€è¦ <code>READ_PHONE_STATE</code> æƒé™ï¼Œä¸”è¶Šæ¥è¶Šéš¾è·å–ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>IMSI</strong></td>
  <td style="text-align:left"><code>TelephonyManager.getSubscriberId()</code></td>
  <td style="text-align:left">SIM å¡çš„å”¯ä¸€èº«ä»½ç ã€‚åŒæ ·éœ€è¦é«˜æƒé™ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>MAC åœ°å€</strong></td>
  <td style="text-align:left"><code>WifiInfo.getMacAddress()</code></td>
  <td style="text-align:left">Android 6.0 ä»¥åï¼ŒApp è·å–åˆ°çš„é€šå¸¸æ˜¯ä¸€ä¸ªå›ºå®šçš„å‡å€¼ <code>02:00:00:00:00:00</code>ã€‚</td>
</tr>
</tbody>
</table>
<h3>ç³»ç»Ÿä¸è½¯ä»¶ç‰¹å¾</h3>
<p>è¿™æ˜¯æŒ‡çº¹åº“çš„ä¸»ä½“ï¼Œä¿¡æ¯é‡å¤§ï¼Œè·å–æˆæœ¬ä½ã€‚</p>
<ul>
<li><p><strong>Build å±æ€§</strong>: é€šè¿‡ <code>android.os.Build</code> ç±»æˆ–ç›´æ¥è¯»å– <code>/system/build.prop</code> æ–‡ä»¶è·å–ã€‚</p>
</li>
<li><p><code>Build.MODEL</code>: è®¾å¤‡å‹å· (e.g., &quot;Pixel 6&quot;)</p>
</li>
<li><p><code>Build.BRAND</code>: å“ç‰Œ (e.g., &quot;Google&quot;)</p>
</li>
<li><p><code>Build.MANUFACTURER</code>: åˆ¶é€ å•† (e.g., &quot;Google&quot;)</p>
</li>
<li><p><code>Build.VERSION.SDK_INT</code>: SDK ç‰ˆæœ¬å· (e.g., 33)</p>
</li>
<li><p><code>Build.FINGERPRINT</code>: ç³»ç»Ÿæ„å»ºæŒ‡çº¹ï¼Œä¿¡æ¯é‡å·¨å¤§ã€‚</p>
</li>
<li><p><code>Build.MODEL</code>: è®¾å¤‡å‹å· (e.g., &quot;Pixel 6&quot;)</p>
</li>
<li><p><code>Build.BRAND</code>: å“ç‰Œ (e.g., &quot;Google&quot;)</p>
</li>
<li><p><code>Build.MANUFACTURER</code>: åˆ¶é€ å•† (e.g., &quot;Google&quot;)</p>
</li>
<li><p><code>Build.VERSION.SDK_INT</code>: SDK ç‰ˆæœ¬å· (e.g., 33)</p>
</li>
<li><p><code>Build.FINGERPRINT</code>: ç³»ç»Ÿæ„å»ºæŒ‡çº¹ï¼Œä¿¡æ¯é‡å·¨å¤§ã€‚</p>
</li>
<li><p><strong>ç³»ç»Ÿè®¾ç½®</strong>:</p>
</li>
<li><p>å±å¹•åˆ†è¾¨ç‡ã€DPI (<code>DisplayMetrics</code>)</p>
</li>
<li><p>ç³»ç»Ÿè¯­è¨€ã€æ—¶åŒºã€é»˜è®¤å­—ä½“åˆ—è¡¨ã€‚</p>
</li>
<li><p>å±å¹•åˆ†è¾¨ç‡ã€DPI (<code>DisplayMetrics</code>)</p>
</li>
<li><p>ç³»ç»Ÿè¯­è¨€ã€æ—¶åŒºã€é»˜è®¤å­—ä½“åˆ—è¡¨ã€‚</p>
</li>
<li><p><strong>è½¯ä»¶ç¯å¢ƒ</strong>:</p>
</li>
<li><p>å·²å®‰è£…åº”ç”¨åˆ—è¡¨ (<code>PackageManager.getInstalledPackages</code>)ã€‚</p>
</li>
<li><p>ç‰¹å®š App (å¦‚è¾“å…¥æ³•) çš„ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>å·²å®‰è£…åº”ç”¨åˆ—è¡¨ (<code>PackageManager.getInstalledPackages</code>)ã€‚</p>
</li>
<li><p>ç‰¹å®š App (å¦‚è¾“å…¥æ³•) çš„ç‰ˆæœ¬ã€‚</p>
</li>
</ul>
<h3>ç¡¬ä»¶ç‰¹æ€§æŒ‡çº¹</h3>
<p>åˆ©ç”¨ç¡¬ä»¶çš„ç»†å¾®ç‰©ç†å·®å¼‚æ¥åˆ›å»ºæŒ‡çº¹ã€‚</p>
<ul>
<li><p><strong>ä¼ æ„Ÿå™¨æ•°æ®</strong>: è¯»å–åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªç­‰ä¼ æ„Ÿå™¨çš„æ ¡å‡†æ•°æ®æˆ–åœ¨ç‰¹å®šæ“ä½œä¸‹çš„è¯»æ•°ã€‚ä¸åŒæ‰¹æ¬¡çš„ä¼ æ„Ÿå™¨å­˜åœ¨ç‰©ç†å·®å¼‚ã€‚</p>
</li>
<li><p><strong>CPU/GPU ä¿¡æ¯</strong>:</p>
</li>
<li><p>è¯»å– <code>/proc/cpuinfo</code> è·å– CPU å‹å·ã€æ ¸å¿ƒæ•°ã€ç‰¹æ€§ç­‰ã€‚</p>
</li>
<li><p>é€šè¿‡ OpenGL/WebGL API æŸ¥è¯¢ GPU ä¾›åº”å•†ã€æ¸²æŸ“å™¨ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥æ‰§è¡Œä¸€ä¸ªæ ‡å‡†æ¸²æŸ“ä»»åŠ¡ï¼Œå°†æ¸²æŸ“ç»“æœçš„ Hash ä½œä¸ºæŒ‡çº¹ã€‚</p>
</li>
<li><p>è¯»å– <code>/proc/cpuinfo</code> è·å– CPU å‹å·ã€æ ¸å¿ƒæ•°ã€ç‰¹æ€§ç­‰ã€‚</p>
</li>
<li><p>é€šè¿‡ OpenGL/WebGL API æŸ¥è¯¢ GPU ä¾›åº”å•†ã€æ¸²æŸ“å™¨ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥æ‰§è¡Œä¸€ä¸ªæ ‡å‡†æ¸²æŸ“ä»»åŠ¡ï¼Œå°†æ¸²æŸ“ç»“æœçš„ Hash ä½œä¸ºæŒ‡çº¹ã€‚</p>
</li>
<li><p><strong>æ‘„åƒå¤´å‚æ•°</strong>: <code>CameraCharacteristics</code> ä¸­åŒ…å«çš„è¯¦ç»†å‚æ•°ã€‚</p>
</li>
</ul>
<h3>é€šè¿‡ SVC (ç³»ç»Ÿè°ƒç”¨) è·å–ä¿¡æ¯</h3>
<p>è¿™æ˜¯ä¸€ç§é«˜çº§çš„å Hook æŠ€æœ¯ï¼Œå¸¸è§äºåŠ å›ºæ–¹æ¡ˆä¸­ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>ç»•è¿‡æ‰€æœ‰ä¸Šå±‚ API å’Œ libc å‡½æ•°</strong>ï¼Œé€šè¿‡ <code>SVC</code> æŒ‡ä»¤ç›´æ¥å‘èµ·ç³»ç»Ÿè°ƒç”¨ (<code>syscall</code>) æ¥è·å–ä¿¡æ¯æˆ–æ‰§è¡Œæ“ä½œã€‚</p>
<ul>
<li><p><strong>åŸç†</strong>: <code>SVC</code> æ˜¯ ARM å¤„ç†å™¨çš„ä¸€æ¡æŒ‡ä»¤ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªè½¯ä»¶ä¸­æ–­ï¼Œä½¿ CPU ä»ç”¨æˆ·æ€ï¼ˆUser Modeï¼‰åˆ‡æ¢åˆ°ç®¡ç†æ€ï¼ˆSupervisor Modeï¼‰ï¼Œä»è€Œæ‰§è¡Œå†…æ ¸ä»£ç ã€‚è¿™æ˜¯æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„åŸºç¡€ã€‚åŠ å›ºå‚å•†åœ¨ SO æ–‡ä»¶ä¸­ç›´æ¥åµŒå…¥ <code>SVC</code> æŒ‡ä»¤ï¼Œå¯ä»¥ä¸ç»è¿‡ <code>libc.so</code> ä¸­çš„ <code>read</code>, <code>open</code>, <code>ioctl</code> ç­‰å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å†…æ ¸ä¸­å¯¹åº”çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>:</p>
</li>
<li><p><strong>ç»•è¿‡ API Hook</strong>: è¿™æ˜¯å…¶æœ€ä¸»è¦çš„ç›®çš„ã€‚ç”±äº Fridaã€Xposed ç­‰æ¡†æ¶ä¸»è¦ Hook çš„æ˜¯ App è¿›ç¨‹ç©ºé—´ä¸­çš„å‡½æ•°ï¼ˆJava API æˆ– Native APIï¼‰ï¼Œ<code>SVC</code> æŒ‡ä»¤ç›´æ¥ä¸å†…æ ¸äº¤äº’ï¼Œä½¿å¾—è¿™äº›ä¸Šå±‚ Hook å®Œå…¨å¤±æ•ˆã€‚</p>
</li>
<li><p><strong>è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>: ç›´æ¥ä½¿ç”¨ <code>open</code>/<code>read</code> çš„ç³»ç»Ÿè°ƒç”¨å·æ¥è¯»å– <code>/proc/self/maps</code>, <code>/proc/cpuinfo</code> ç­‰æ–‡ä»¶ï¼Œä»¥æ£€æµ‹ç¯å¢ƒæˆ–æ”¶é›†æŒ‡çº¹ã€‚</p>
</li>
<li><p><strong>æ‰§è¡Œåè°ƒè¯•</strong>: ä½¿ç”¨ <code>ptrace</code> çš„ç³»ç»Ÿè°ƒç”¨å·æ¥æ‰§è¡Œåè°ƒè¯•æ£€æŸ¥ã€‚</p>
</li>
<li><p><strong>ç»•è¿‡ API Hook</strong>: è¿™æ˜¯å…¶æœ€ä¸»è¦çš„ç›®çš„ã€‚ç”±äº Fridaã€Xposed ç­‰æ¡†æ¶ä¸»è¦ Hook çš„æ˜¯ App è¿›ç¨‹ç©ºé—´ä¸­çš„å‡½æ•°ï¼ˆJava API æˆ– Native APIï¼‰ï¼Œ<code>SVC</code> æŒ‡ä»¤ç›´æ¥ä¸å†…æ ¸äº¤äº’ï¼Œä½¿å¾—è¿™äº›ä¸Šå±‚ Hook å®Œå…¨å¤±æ•ˆã€‚</p>
</li>
<li><p><strong>è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>: ç›´æ¥ä½¿ç”¨ <code>open</code>/<code>read</code> çš„ç³»ç»Ÿè°ƒç”¨å·æ¥è¯»å– <code>/proc/self/maps</code>, <code>/proc/cpuinfo</code> ç­‰æ–‡ä»¶ï¼Œä»¥æ£€æµ‹ç¯å¢ƒæˆ–æ”¶é›†æŒ‡çº¹ã€‚</p>
</li>
<li><p><strong>æ‰§è¡Œåè°ƒè¯•</strong>: ä½¿ç”¨ <code>ptrace</code> çš„ç³»ç»Ÿè°ƒç”¨å·æ¥æ‰§è¡Œåè°ƒè¯•æ£€æŸ¥ã€‚</p>
</li>
<li><p><strong>åˆ†æä¸è¯†åˆ«</strong>:</p>
</li>
<li><p><strong>é™æ€åˆ†æ</strong>: åœ¨ IDA ç­‰åæ±‡ç¼–å·¥å…·ä¸­ï¼Œç›´æ¥æœç´¢ <code>SVC</code> æŒ‡ä»¤ã€‚å¦‚æœä¸€ä¸ª SO æ–‡ä»¶ä¸­å«æœ‰å¤§é‡ <code>SVC</code> æŒ‡ä»¤ï¼Œä¸”å…¶ä¸Šä¸‹æ–‡é€»è¾‘å¤æ‚ï¼Œåˆ™ææœ‰å¯èƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚</p>
</li>
<li><p><strong>åŠ¨æ€åˆ†æ</strong>: Hook ç³»ç»Ÿè°ƒç”¨éœ€è¦æ›´åº•å±‚çš„å·¥å…·ã€‚Frida çš„ <code>Stalker</code> å¯ä»¥ç”¨æ¥è·Ÿè¸ªæŒ‡ä»¤çº§çš„æ‰§è¡Œæµç¨‹ï¼Œä»è€Œæ•æ‰åˆ° <code>SVC</code> çš„è°ƒç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Hook <code>libc.so</code> ä¸­ä¸ <code>syscall</code> ç›¸å…³çš„åº•å±‚å‡½æ•°æ¥å°è¯•æ•è·ã€‚</p>
</li>
<li><p><strong>é™æ€åˆ†æ</strong>: åœ¨ IDA ç­‰åæ±‡ç¼–å·¥å…·ä¸­ï¼Œç›´æ¥æœç´¢ <code>SVC</code> æŒ‡ä»¤ã€‚å¦‚æœä¸€ä¸ª SO æ–‡ä»¶ä¸­å«æœ‰å¤§é‡ <code>SVC</code> æŒ‡ä»¤ï¼Œä¸”å…¶ä¸Šä¸‹æ–‡é€»è¾‘å¤æ‚ï¼Œåˆ™ææœ‰å¯èƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚</p>
</li>
<li><p><strong>åŠ¨æ€åˆ†æ</strong>: Hook ç³»ç»Ÿè°ƒç”¨éœ€è¦æ›´åº•å±‚çš„å·¥å…·ã€‚Frida çš„ <code>Stalker</code> å¯ä»¥ç”¨æ¥è·Ÿè¸ªæŒ‡ä»¤çº§çš„æ‰§è¡Œæµç¨‹ï¼Œä»è€Œæ•æ‰åˆ° <code>SVC</code> çš„è°ƒç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Hook <code>libc.so</code> ä¸­ä¸ <code>syscall</code> ç›¸å…³çš„åº•å±‚å‡½æ•°æ¥å°è¯•æ•è·ã€‚</p>
</li>
</ul>
<h3>ç½‘ç»œç¯å¢ƒæŒ‡çº¹</h3>
<ul>
<li><p><strong>IP åœ°å€</strong>: æœ€åŸºç¡€çš„ç»´åº¦ï¼Œç»“åˆåœ°ç†ä½ç½®åº“å¯ä»¥åˆ¤æ–­ç”¨æˆ·ä½ç½®ã€‚</p>
</li>
<li><p><strong>ç½‘ç»œä¿¡æ¯</strong>: è¿è¥å•†åç§° (<code>TelephonyManager.getNetworkOperatorName</code>)ã€Wi-Fi BSSID/SSIDã€‚</p>
</li>
<li><p><strong>TLS/JA3 æŒ‡çº¹</strong>: åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯ <code>Client Hello</code> åŒ…çš„ç‰¹å¾å¯ä»¥æ„æˆä¸€ä¸ªç¨³å®šçš„æŒ‡çº¹ï¼Œç”¨äºè¯†åˆ«ç‰¹å®šçš„ç½‘ç»œåº“å’Œç‰ˆæœ¬ã€‚</p>
</li>
</ul>
<h3>è¡Œä¸ºç‰¹å¾æŒ‡çº¹</h3>
<p>è¡Œä¸ºç‰¹å¾æ˜¯ä¸€ç§åŠ¨æ€æŒ‡çº¹ï¼ŒåŸºäºç”¨æˆ·çš„æ“ä½œæ¨¡å¼å’Œè®¾å¤‡ä½¿ç”¨ä¹ æƒ¯ã€‚</p>
<h4>é‡‡é›†ç»´åº¦</h4>
<ul>
<li><strong>1. è§¦æ‘¸è¡Œä¸º</strong><pre><code class="language-java">// è§¦æ‘¸äº‹ä»¶é‡‡é›†
view.setOnTouchListener(new View.OnTouchListener() {
@Override
public boolean onTouch(View v, MotionEvent event) {
// é‡‡é›†è§¦æ‘¸å‹åŠ›
float pressure = event.getPressure();
// é‡‡é›†è§¦æ‘¸é¢ç§¯
float size = event.getSize();
// é‡‡é›†è§¦æ‘¸åæ ‡ andTime æˆ³
long timestamp = event.getEventTime();
float x = event.getX();
float y = event.getY();
</code></pre>
</li>
</ul>
<p>// Build è§¦æ‘¸ç‰¹å¾å‘é‡
TouchFeature feature = new TouchFeature(
pressure, size, timestamp, x, y
);
return false;
}
});</p>
<pre><code>- æ‰‹æŒ‡æ¥è§¦é¢ç§¯


* *2. ä¼ æ„Ÿå™¨è¡Œä¸º**
    ```java
// åŠ é€Ÿè®¡/é™€èºä»ªæ•°æ®é‡‡é›†
SensorManager sensorManager = (SensorManager) getSystemService(SENSOR_SERVICE);
Sensor accelerometer = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);

sensorManager.registerListener(new SensorEventListener() {
@Override
public void onSensorChanged(SensorEvent event) {
float x = event.values[0];
float y = event.values[1];
float z = event.values[2];

// AnalysisæŒæ¡å§¿æ€ã€æ­¥æ€ç‰¹å¾etc.
analyzeMotionPattern(x, y, z);
}

@Override
public void onAccuracyChanged(Sensor sensor, int accuracy) {}
}, accelerometer, SensorManager.SENSOR_DELAY_NORMAL);

</code></pre>
<ul>
<li><strong>3. åº”ç”¨ä½¿ç”¨æ¨¡å¼</strong></li>
</ul>
<ul>
<li>App å¯åŠ¨æ—¶é—´åˆ†å¸ƒ</li>
<li>å¸¸ç”¨ App åˆ—è¡¨åŠä½¿ç”¨é¢‘ç‡</li>
<li>å‰åå°åˆ‡æ¢æ¨¡å¼</li>
<li>åº”ç”¨å®‰è£…/å¸è½½ä¹ æƒ¯</li>
</ul>
<ul>
<li><strong>4. ç½‘ç»œè¡Œä¸º</strong></li>
</ul>
<ul>
<li>è®¿é—®æ—¶é—´æ¨¡å¼ï¼ˆå·¥ä½œæ—¥ vs å‘¨æœ«ï¼Œç™½å¤© vs æ™šä¸Šï¼‰</li>
<li>è¯·æ±‚é¢‘ç‡å’Œé—´éš”</li>
<li>ç½‘ç»œåˆ‡æ¢ä¹ æƒ¯ï¼ˆWiFi â†” 4G/5Gï¼‰</li>
<li>å¸¸ç”¨åœ°ç†ä½ç½®</li>
</ul>
<h4>è¡Œä¸ºæŒ‡çº¹ç”Ÿæˆ</h4>
<pre><code class="language-python">class BehaviorFingerprint:
def __init__(self):
self.touch_features = []
self.sensor_features = []
self.app_usage = {}
self.network_pattern = {}

def extract_touch_signature(self, touch_events):
&quot;&quot;&quot;
ä»è§¦æ‘¸äº‹ä»¶æå–ç”¨æˆ·Signature
&quot;&quot;&quot;
# CalculateStatisticsç‰¹å¾
pressures = [e.pressure for e in touch_events]
velocities = self._calculate_velocities(touch_events)

signature = {
'avg_pressure': np.mean(pressures),
'std_pressure': np.std(pressures),
'avg_velocity': np.mean(velocities),
'touch_rhythm': self._analyze_rhythm(touch_events)
}
return signature

def generate_behavior_fingerprint(self):
&quot;&quot;&quot;
Generateç»¼åˆè¡Œä¸ºæŒ‡çº¹
&quot;&quot;&quot;
touch_sig = self.extract_touch_signature(self.touch_features)
motion_sig = self.extract_motion_signature(self.sensor_features)
usage_sig = self.extract_usage_signature(self.app_usage)

# ç»„åˆä¸ºè¡Œä¸ºç‰¹å¾å‘é‡
behavior_vector = {
'touch': touch_sig,
'motion': motion_sig,
'usage': usage_sig,
'network': self.network_pattern
}

return hashlib.sha256(
json.dumps(behavior_vector, sort_keys=True).encode()
).hexdigest()

</code></pre>
<p>import numpy as np</p>
<p>class BehaviorClassifier:
def <strong>init</strong>(self):
self.model = RandomForestClassifier(n_estimators=100)</p>
<p>def train(self, features, labels):
&quot;&quot;&quot;
è®­ç»ƒè¡Œä¸ºè¯†åˆ«æ¨¡ Type
features: è¡Œä¸ºç‰¹å¾å‘é‡ Array
labels: è®¾å¤‡/ç”¨æˆ·æ ‡è¯†
&quot;&quot;&quot;
self.model.fit(features, labels)</p>
<p>def predict_device(self, behavior_features):
&quot;&quot;&quot;
æ ¹æ®è¡Œä¸ºç‰¹å¾é¢„æµ‹è®¾å¤‡èº«ä»½
&quot;&quot;&quot;</p>
<h1>ç‰¹å¾å‘é‡åŒ–</h1>
<p>feature_vector = self._vectorize(behavior_features)</p>
<h1>é¢„æµ‹</h1>
<p>device_id = self.model.predict([feature_vector])[0]
confidence = self.model.predict_proba([feature_vector]).max()</p>
<p>return device_id, confidence</p>
<p>def detect_anomaly(self, behavior_features, known_device_id):
&quot;&quot;&quot;
æ£€æµ‹å¼‚å¸¸è¡Œä¸ºï¼ˆå¯èƒ½æ˜¯è´¦å·è¢«ç›—æˆ–è®¾å¤‡è¢«å†’ç”¨ï¼‰
&quot;&quot;&quot;
predicted_id, confidence = self.predict_device(behavior_features)</p>
<p>if predicted_id != known_device_id:
return True, f&quot;Behavior mismatch (confidence: {confidence})&quot;</p>
<p>if confidence &lt; 0.7:
return True, &quot;Low confidence in behavior match&quot;</p>
<p>return False, &quot;Normal behavior&quot;</p>
<pre><code>
**æ ¸å¿ƒæ€è·¯**: è¯†åˆ« -&gt; Hook -&gt; ä¼ªé€ 
1. **è¯†åˆ«**: å®šä½ App è·å–å…³é”®æŒ‡çº¹ä¿¡æ¯çš„ä»£ç ä½ç½®ï¼ˆJava API æˆ– JNI å‡½æ•°ï¼‰ã€‚
2. **Hook**: ä½¿ç”¨ Frida æˆ– Xposed æ‹¦æˆªè¿™äº›å‡½æ•°çš„è°ƒç”¨ã€‚
3. **ä¼ªé€ **: åœ¨å‡½æ•°è¿”å›å‰ï¼Œç”¨ä¸€å¥—é¢„è®¾çš„ã€è‡ªæ´½çš„å‡æ•°æ®æ›¿æ¢çœŸå®è¿”å›å€¼ã€‚


**Frida æ¦‚å¿µè„šæœ¬ (ä¼ªé€  Build.MODEL):**

```javascript
Java.perform(function () {
var Build = Java.use(&quot;android.os.Build&quot;);
Build.MODEL.value = &quot;Pixel 4&quot;; // Modify MODEL Field

var String = Java.use(&quot;java.lang.String&quot;);
var TelephonyManager = Java.use(&quot;android.telephony.TelephonyManager&quot;);
TelephonyManager.getDeviceId.overload().implementation = function () {
console.log(&quot;Hooked getDeviceId(). Returning a fake IMEI.&quot;);
return String.$new(&quot;867530900000000&quot;); // Returnä¼ªé€  IMEI
};
});

</code></pre>
<ul>
<li><p><strong>ä¼˜ç‚¹</strong>: æ— æ³•é€šè¿‡åº”ç”¨å±‚çš„æ£€æµ‹æ‰‹æ®µè¯†ç ´ï¼Œå› ä¸º App è·å–åˆ°çš„å°±æ˜¯ç³»ç»Ÿå±‚è¿”å›çš„&quot;çœŸå®&quot;æ•°æ®ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: æŠ€æœ¯é—¨æ§›é«˜ï¼Œå·¥ä½œé‡å·¨å¤§ã€‚</p>
</li>
</ul>
<h3>ç¯å¢ƒè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</h3>
<p>è™šæ‹ŸåŒ–å’Œå®¹å™¨æŠ€æœ¯æ˜¯è§„æ¨¡åŒ–è®¾å¤‡æŒ‡çº¹ç»•è¿‡çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œèƒ½å¤Ÿåœ¨å•å°ç‰©ç†æœºä¸Šè¿è¡Œæ•°ç™¾ä¸ªç‹¬ç«‹çš„ Android å®ä¾‹ã€‚</p>
<h4>android è™šæ‹ŸåŒ–æŠ€æœ¯æ ˆ</h4>
<p><strong>1. åŸºäº QEMU çš„å®Œæ•´è™šæ‹ŸåŒ–</strong></p>
<p>Android å®˜æ–¹æ¨¡æ‹Ÿå™¨ï¼ˆAVDï¼‰åŸºäº QEMU å®ç°ï¼š</p>
<pre><code class="language-bash"># startupAVDæ¨¡æ‹Ÿå™¨
emulator -avd Pixel_6_API_33 \
- no-snapshot \
- wipe-data \
- gpu swiftshader_indirect

</code></pre>
<p><strong>ä¸»è¦é—®é¢˜</strong>ï¼š</p>
<pre><code class="language-bash"># å®¹æ˜“è¢«æ£€æµ‹çš„ç‰¹å¾
getprop ro.hardware # Return &quot;goldfish&quot; or &quot;ranchu&quot;
getprop ro.product.model # Return &quot;android SDK built for x86&quot;
getprop ro.build.fingerprint # Contains &quot;é€šç”¨&quot; å­—æ ·

# ç¼ºå¤±ä¼ æ„Ÿå™¨
pm list features | grep sensor # å¤§é‡ä¼ æ„Ÿå™¨ç¼ºå¤±

</code></pre>
<p>wget https://osdn.net/projects/android-x86/releases/android-x86_64-9.0-r2.iso</p>
<h1>åœ¨å†… VirtualBox, Create è™šæ‹Ÿæœº</h1>
<p>VBoxManage createvm --name &quot;Android-x86&quot; --ostype &quot;Linux_64&quot; --register
VBoxManage modifyvm &quot;Android-x86&quot; --memory 4096 --vram 128
VBoxManage storagectl &quot;Android-x86&quot; --name &quot;SATA&quot; --add sata
VBoxManage storageattach &quot;Android-x86&quot; --storagectl &quot;SATA&quot; <br />
--port 0 --device 0 --type dvddrive --medium android-x86.iso</p>
<pre><code>

* *ç¼ºç‚¹**ï¼š
- ä»æœ‰è™šæ‹ŸåŒ–ç‰¹å¾
- GPUåŠ é€Ÿæ”¯æŒæœ‰é™
- ARMåº”ç”¨å…¼å®¹æ€§å·®ï¼ˆéœ€è¦ARMè½¬è¯‘å±‚ï¼‰


* *3. åŸºäºå®¹å™¨çš„æ–¹æ¡ˆ (Docker/LXC)**

å®¹å™¨æŠ€æœ¯æä¾›æ›´è½»é‡çš„éš”ç¦»ï¼š

```dockerfile
# Dockerfile for android container
FROM ubuntu:20.04

# å®‰è£… android ç¯å¢ƒ
RUN apt-get update &amp;&amp; apt-get install -y \
openjdk-11-jdk \
android-sdk \
adb \
fastboot

# é…ç½® android ç¯å¢ƒ
ENV ANDROID_HOME=/opt/android-sdk
ENV PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools

# RunADBService
CMD [&quot;adb&quot;, &quot;-a&quot;, &quot;nodaemon&quot;, &quot;server&quot;]

</code></pre>
<p>| LXC/LXD | ç³»ç»Ÿçº§ | é«˜ | å¤šç§Ÿæˆ·ã€äº‘æ‰‹æœº |
| Kubernetes | é›†ç¾¤çº§ | ä¸­ | å¤§è§„æ¨¡éƒ¨ç½² |</p>
<ul>
<li><strong>4. ä¸“ä¸šå®¹å™¨æ–¹æ¡ˆï¼šRedroid</strong></li>
</ul>
<p>Redroid æ˜¯ä¸€ä¸ªåŸºäº Docker çš„ Android å®¹å™¨æ–¹æ¡ˆï¼š</p>
<pre><code class="language-bash"># RunRedroidå®¹å™¨
docker run -d \
--name redroid \
--privileged \
-v ~/data:/data \
-p 5555:5555 \
redroid/redroid:11.0.0-latest

# Connect to to to to to to Redroid
adb connect localhost:5555
adb shell

</code></pre>
<ul>
<li>æ”¯æŒ GPU åŠ é€Ÿï¼ˆé€šè¿‡ mesa/virglï¼‰</li>
</ul>
<h4>è™šæ‹ŸåŒ–æ£€æµ‹å¯¹æŠ—</h4>
<ul>
<li><strong>æ£€æµ‹ç‚¹ 1ï¼šBuild å±æ€§</strong></li>
</ul>
<pre><code class="language-bash"># å®¹æ˜“æš´éœ²çš„å±æ€§
getprop ro.hardware # goldfish/ranchu
getprop ro.product.board # goldfish_x86
getprop ro.product.device # generic
getprop ro.build.product # sdk_gphone_x86
getprop ro.build.tags # test-keys

</code></pre>
<p>ro.hardware=qcom
ro.product.board=msmnile
ro.product.device=OnePlus7Pro
ro.build.product=OnePlus7Pro
ro.build.tags=release-keys
EOF</p>
<pre><code># è™šæ‹Ÿæœºå¯èƒ½æ˜¾ç¤º: Intel Core i7 (ä¸»æœº CPU)
# çœŸæœºåº”è¯¥æ˜¾ç¤º: Qualcomm Snapdragon 888

# DetectionHypervisor
cat /proc/cpuinfo | grep hypervisor
# If exists at, indicatesRunAtè™šæ‹ŸæœºIn

</code></pre>
<p>static int c_show(struct seq_file *m, void *v) {
// ä¼ªé€  CPUInfo
seq_printf(m, &quot;model name\t: %s\n&quot;, fake_cpu_name);
// ...
}</p>
<pre><code>List&lt;Sensor&gt; sensors = sm.getSensorList(Sensor.TYPE_ALL);

// æ¨¡æ‹Ÿå™¨å¯èƒ½åªæœ‰ 3-5 ä¸ªåŸºæœ¬ä¼ æ„Ÿå™¨
if (sensors.size() &lt; 15) {
// å¯èƒ½æ˜¯æ¨¡æ‹Ÿå™¨
}

</code></pre>
<p>&quot;android.hardware.SensorManager&quot;,
lpparam.classLoader,
&quot;getSensorList&quot;,
int.class,
new XC_MethodHook() {
@Override
protected void afterHookedMethod(MethodHookParam param) {
List<Sensor> original = (List<Sensor>) param.getResult();
// Add ä¼ªé€ ä¼ æ„Ÿå™¨
original.add(createFakeSensor(Sensor.TYPE_GYROSCOPE));
original.add(createFakeSensor(Sensor.TYPE_MAGNETIC_FIELD));
// ...
param.setResult(original);
}
}
);</p>
<pre><code>ls -la /dev/ | grep -E &quot;qemu|vbox|vmware&quot;

# æ£€æµ‹ç‰¹å®šè®¾å¤‡èŠ‚ç‚¹
if [ -e &quot;/dev/socket/qemud&quot; ]; then
echo &quot;Emulator detected&quot;
fi

</code></pre>
<h1>!/system/bin/sh</h1>
<h1>åˆ é™¤æˆ–éšè—æ¨¡æ‹Ÿå™¨ç‰¹å¾</h1>
<p>rm -f /dev/socket/qemud
rm -f /dev/qemu_pipe
mount -o bind /dev/null /system/bin/qemu-props
EOF</p>
<pre><code># ConfigGPUç›´é€šï¼ˆNeedIOMMUSupportï¼‰
# ç¼–è¾‘ /etc/é»˜è®¤/grub
GRUB_CMDLINE_LINUX=&quot;intel_iommu=on vfio-pci.ids=10de:1b80&quot;

# åˆ›å»ºå¸¦ GPU çš„è™šæ‹Ÿæœº
virt-install \
- -name android-vm \
- -ram 8192 \
- -vcpus 4 \
- -disk path=/var/lib/libvirt/images/android.qcow2 \
- -hostdev 01:00.0 # GPU PCIAddress

</code></pre>
<p>snap install --devmode --beta anbox</p>
<h1>AnboxUseLXC å®¹å™¨ï¼Œå‡ ä¹ NoPerformance æŸå¤±</h1>
<p>lxc-info -n android</p>
<pre><code>

* *3. åµŒå¥—è™šæ‹ŸåŒ–**

åœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡ŒAndroidè™šæ‹Ÿæœºï¼š

```bash
# AWS EC2ä¸ŠEnabledåµŒå¥—è™šæ‹ŸåŒ–
aws ec2 modify-instance-attribute \
--instance-id i-1234567890abcdef0 \
--cpu-options &quot;CoreCount=4,ThreadsPerCore=2&quot;

# æ£€æŸ¥ if KVM is å¯ç”¨
lsmod | grep kvm

</code></pre>
<p>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Android â”‚ â”‚Android â”‚ â”‚Android â”‚ â”‚
â”‚ â”‚Container â”‚ â”‚Container â”‚ â”‚Container â”‚ ... â”‚
â”‚ â”‚ #1 â”‚ â”‚ #2 â”‚ â”‚ #N â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¹å™¨ç¼–æ’ Layer (Orchestration) â”‚
â”‚ - è°ƒåº¦ (Scheduling) â”‚
â”‚ - è´Ÿè½½å‡è¡¡ (Load Balancing) â”‚
â”‚ - Auto æ‰©ç¼©å®¹ (Auto Scaling) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰©ç† Server / äº‘ Main æœº â”‚
â”‚ - é«˜ PerformanceCPU (å¤š Core) â”‚
â”‚ - å¤§ Memory (128GB+) â”‚
â”‚ - GPU (Optionalï¼ŒUsed for åŠ é€Ÿ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code>kind: Deployment
metadata:
name: android-farm
spec:
replicas: 50 # 50androidInstance
selector:
matchLabels:
app: android
template:
metadata:
labels:
app: android
spec:
containers:
- name: android
image: redroid/redroid:11.0.0
securityContext:
privileged: true
resources:
limits:
memory: &quot;2Gi&quot;
cpu: &quot;2&quot;
ports:
- containerPort: 5555
image: redroid/redroid:11.0.0
securityContext:
privileged: true
resources:
limits:
memory: &quot;2Gi&quot;
cpu: &quot;2&quot;
ports:
- containerPort: 5555
---
apiVersion: v1
kind: Service
metadata:
name: android-service
spec:
type: LoadBalancer
selector:
app: android
ports:
- port: 5555
targetPort: 5555

</code></pre>
<h4>äº‘æ‰‹æœºæ¶æ„</h4>
<p><strong>1. æŠ€æœ¯æ ˆåˆ†å±‚</strong></p>
<pre><code>â”‚ - WebControlå° â”‚
â”‚ - APIService â”‚
â”‚ - AutoåŒ–Script â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº‘æ‰‹æœºInstanceLayer (Instance Layer) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ äº‘æ‰‹æœº1 â”‚ â”‚ äº‘æ‰‹æœº2 â”‚ ... â”‚
â”‚ â”‚ Android â”‚ â”‚ Android â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è™šæ‹ŸåŒ–Layer (Virtualization Layer) â”‚
â”‚ - ARMè™šæ‹ŸåŒ– (KVM/QEMU) â”‚
â”‚ - GPUè™šæ‹ŸåŒ– (vGPU) â”‚
â”‚ - Networkè™šæ‹ŸåŒ– (VPC) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¡¬ä»¶Layer (Hardware Layer) â”‚
â”‚ - ARMServer (åä¸ºé²²é¹/é£è…¾) â”‚
â”‚ - é«˜PerformanceStorage (NVMe SSD) â”‚
â”‚ - ä¸“ç”¨GPU (Mali/Adreno) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
<ul>
<li>AWS Graviton2</li>
</ul>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li><p>åŸç”Ÿ ARM æŒ‡ä»¤é›†ï¼ŒNo éœ€è½¬è¯‘</p>
</li>
<li><p>æ€§èƒ½æ¥è¿‘çœŸå®è®¾å¤‡</p>
</li>
<li><p>å…¼å®¹æ€§æå¥½</p>
<pre><code>
</code></pre>
</li>
</ul>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-bash"># UselibvirtManageKVMè™šæ‹Ÿæœº
virsh define android-vm.xml

# android-vm.xml
&lt;domain type='kvm'&gt;
&lt;name&gt;android-1&lt;/name&gt;
&lt;memory unit='GiB'&gt;4&lt;/memory&gt;
&lt;vcpu&gt;4&lt;/vcpu&gt;
&lt;os&gt;
&lt;type arch='aarch64'&gt;hvm&lt;/type&gt;
&lt;boot dev='hd'/&gt;
&lt;/os&gt;
&lt;devices&gt;
&lt;disk type='file' device='disk'&gt;
&lt;source file='/var/lib/libvirt/images/android.img'/&gt;
&lt;target dev='vda' bus='virtio'/&gt;
&lt;/disk&gt;
&lt;graphics type='vnc' port='5900'/&gt;
&lt;/devices&gt;
&lt;/domain&gt;

</code></pre>
<ul>
<li>è‡ªç ”å®¹å™¨ RunWhen</li>
</ul>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li><p>æé«˜å¯†åº¦ (å•å° ServerRun100+Instance)</p>
</li>
<li><p>å¿«é€Ÿ Start/Boot (&lt;5Second)</p>
</li>
<li><p>Resources å ç”¨ä½</p>
<pre><code>
</code></pre>
</li>
</ul>
<p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-bash"># Use to runandroid
lxc launch ubuntu:20.04 android-base
lxc exec android-base -- bash

# åœ¨å†… å®¹å™¨, Installandroid
apt-get install android-tools-adb android-tools-fastboot

# é…ç½® android ç³»ç»Ÿ
lxc config set android-base raw.lxc &quot;lxc.mount.auto = proc:rw sys:rw&quot;
lxc config device add android-base kmsg unix-char path=/dev/kmsg

</code></pre>
<ul>
<li>è½¯ä»¶æ¸²æŸ“ (SwiftShader, ANGLE)</li>
</ul>
<p>App åœºæ™¯ï¼š</p>
<ul>
<li><p>æ¸¸æˆäº‘æ‰‹æœº</p>
</li>
<li><p>è§†é¢‘ Process</p>
</li>
<li><p>å›¾å½¢æ¸²æŸ“</p>
<pre><code>
</code></pre>
</li>
</ul>
<h4>äº‘æ‰‹æœºå¹³å°å¯¹æ¯”</h4>
<table>
<thead>
<tr>
  <th>å¹³å°</th>
  <th>æ¶æ„</th>
  <th>å¯†åº¦</th>
  <th>æ€§èƒ½</th>
  <th>æˆæœ¬</th>
  <th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
  <td>åä¸ºäº‘æ‰‹æœº</td>
  <td>ARM æœåŠ¡å™¨+KVM</td>
  <td>ä¸­</td>
  <td>é«˜</td>
  <td>é«˜</td>
  <td>ä¼ä¸šçº§åº”ç”¨</td>
</tr>
<tr>
  <td>çº¢æ‰‹æŒ‡</td>
  <td>ARM å®¹å™¨</td>
  <td>é«˜</td>
  <td>ä¸­</td>
  <td>ä¸­</td>
  <td>è‡ªåŠ¨åŒ–ã€æŒ‚æœº</td>
</tr>
<tr>
  <td>å¤šå¤šäº‘æ‰‹æœº</td>
  <td>x86+å®¹å™¨</td>
  <td>é«˜</td>
  <td>ä½</td>
  <td>ä½</td>
  <td>æ‰¹é‡æ³¨å†Œã€å…»å·</td>
</tr>
<tr>
  <td>AWS Device Farm</td>
  <td>çœŸæœº</td>
  <td>ä½</td>
  <td>æé«˜</td>
  <td>æé«˜</td>
  <td>æµ‹è¯•ã€å…¼å®¹æ€§éªŒè¯</td>
</tr>
</tbody>
</table>
<h4>äº‘æ‰‹æœºæŒ‡çº¹ç‰¹å¾</h4>
<p>äº‘æ‰‹æœºè™½ç„¶æ¥è¿‘çœŸæœºï¼Œä½†ä»æœ‰å¯è¢«æ£€æµ‹çš„ç‰¹å¾ï¼š</p>
<p><strong>æ£€æµ‹ç‚¹ 1ï¼šæ€§èƒ½ç‰¹å¾å¼‚å¸¸</strong></p>
<pre><code class="language-java">// äº‘æ‰‹æœºCPUPerformanceå¯èƒ½è¿‡äºä¸€è‡´
long startTime = System.nanoTime();
for (int i = 0; i &lt; 1000000; i++) {
Math.sqrt(i);
}
long duration = System.nanoTime() - startTime;

// Trueæœºä¼šæœ‰æ³¢åŠ¨ï¼Œäº‘æ‰‹æœºå¯èƒ½è¿‡äºStable

</code></pre>
<h1>äº‘æ‰‹æœºé€šå¸¸ä½¿ç”¨æ•°æ®ä¸­å¿ƒ IP</h1>
<p>curl ifconfig.me</p>
<h1>è¿”å›: 42.120.x.x (é˜¿é‡Œäº‘)</h1>
<h1>119.28.x.x (è…¾è®¯äº‘)</h1>
<h1>DetectionIPClassType</h1>
<p>curl https://api.ipgeolocation.io/ipgeo?apiKey=xxx</p>
<h1>organization: &quot;Alibaba Cloud&quot;</h1>
<h1>isp: &quot;China Mobile&quot; # çœŸæœºæ›´å¸¸è§</h1>
<pre><code>
</code></pre>
<ul>
<li>SupportGPU åŠ é€Ÿ</li>
<li>æä¾›åŸç”Ÿ Android ä½“éªŒ</li>
</ul>
<p>APIUseï¼š</p>
<pre><code class="language-python">from huaweicloudsdkcore.auth.credentials import BasicCredentials
from huaweicloudsdkcph.v1 import CphClient, RunCloudPhoneRequest

# åˆ›å»ºäº‘æ‰‹æœºå®ä¾‹
credentials = BasicCredentials(ak, sk)
client = CphClient.new_builder().with_credentials(credentials).build()

request = RunCloudPhoneRequest()
request.body = {
&quot;server_id&quot;: &quot;server-123&quot;,
&quot;phone_model&quot;: &quot;cloudphone.arm.d2.16_64&quot;,
&quot;count&quot;: 10
}
response = client.run_cloud_phone(request)

</code></pre>
<ul>
<li>7x24 å°æ—¶åœ¨çº¿</li>
<li>ä¸»è¦ç”¨äºæ¸¸æˆæŒ‚æœº</li>
</ul>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>ä»·æ ¼ä¾¿å®œ (å‡ å…ƒ/æœˆ)</p>
</li>
<li><p>æ€§èƒ½ä¸€èˆ¬</p>
</li>
<li><p>æœ‰æ˜æ˜¾çš„è™šæ‹ŸåŒ–ç‰¹å¾</p>
<pre><code>
</code></pre>
</li>
</ul>
<p><strong>3. å¤šå¤šäº‘ (DuoduoCloud)</strong></p>
<pre><code>- æä¾›HTTP API
- æ”¯æŒæ‰¹é‡æ§åˆ¶
- é€‚åˆè‡ªåŠ¨åŒ–ä¸šåŠ¡


ä½¿ç”¨ç¤ºä¾‹ï¼š

```bash
# APIControläº‘æ‰‹æœº
curl -X POST https://api.duoduoyun.com/v1/device/control \
- H &quot;Authorization: Bearer $TOKEN&quot; \
- d '{
&quot;device_id&quot;: &quot;12345&quot;,
&quot;action&quot;: &quot;install_app&quot;,
&quot;package&quot;: &quot;com.example.app&quot;
}'

</code></pre>
<ul>
<li>å®šåˆ¶è®¾å¤‡é…ç½®å‚æ•°</li>
</ul>
<p><strong>ç­–ç•¥ 2ï¼šè®¾å¤‡æŒ‡çº¹éšæœºåŒ–</strong></p>
<pre><code class="language-python"># ä¸ºæ¯ä¸ªäº‘æ‰‹æœºå®ä¾‹ç”Ÿæˆå”¯ä¸€æŒ‡çº¹
def customize_cloud_phone(device_id):
fingerprint = generate_realistic_fingerprint()

# é€šè¿‡ ADB ä¿®æ”¹è®¾å¤‡å±æ€§
adb_connect(device_id)
adb_shell(f&quot;setprop ro.product.model {fingerprint['model']}&quot;)
adb_shell(f&quot;setprop ro.build.fingerprint {fingerprint['build_fp']}&quot;)

# å®‰è£…éšæœº App
install_random_apps(device_id, count=random.randint(20, 50))

</code></pre>
<h1>éšæœºæµè§ˆæ—¶é•¿</h1>
<p>browse_time = random.randint(300, 1800) # 5-30Minute</p>
<h1>éšæœºç‚¹å‡»</h1>
<p>for _ in range(random.randint(5, 20)):
x = random.randint(0, device.width)
y = random.randint(0, device.height)
device.tap(x, y)
time.sleep(random.uniform(1, 5))</p>
<h1>æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®</h1>
<p>inject_sensor_data(device)</p>
<pre><code>

- --

## å•†ä¸šåŒ–äº§å“ä¸æœåŠ¡

### å›½å†…ä¸»æµè®¾å¤‡æŒ‡çº¹æœåŠ¡å•†

#### 1. é¡¶è±¡ç§‘æŠ€ (DingXiang)

* *äº§å“**: é¡¶è±¡è®¾å¤‡æŒ‡çº¹ (Device Fingerprint)

* *æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- é‡‡é›†200+è®¾å¤‡ç‰¹å¾ç»´åº¦
- æ”¯æŒAndroidã€iOSã€Webã€å°ç¨‹åº
- 99.9%+è®¾å¤‡å”¯ä¸€æ€§è¯†åˆ«ç‡
- è®¾å¤‡æŒ‡çº¹æœ‰æ•ˆæœŸ90å¤©+
- æ”¯æŒç§æœ‰åŒ–éƒ¨ç½²


* *æ ¸å¿ƒèƒ½åŠ›**ï¼š

</code></pre>
<ul>
<li><p>é»‘åå•ç®¡ç†</p>
<pre><code>
</code></pre>
</li>
</ul>
<p><strong>å®šä»·</strong>ï¼šæŒ‰ API è°ƒç”¨æ¬¡æ•°è®¡è´¹ï¼Œä¼ä¸šç‰ˆçº¦ 0.005-0.01 å…ƒ/æ¬¡</p>
<h4>2. åŒç›¾ç§‘æŠ€ (Tongdun)</h4>
<p><strong>äº§å“</strong>: åŒç›¾è®¾å¤‡æŒ‡çº¹</p>
<p><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ç»“åˆ AI å’Œå¤§æ•°æ®åˆ†æ</li>
<li>è®¾å¤‡è¡Œä¸ºç”»åƒ</li>
<li>å®æ—¶é£é™©å†³ç­–</li>
<li>è¦†ç›–é‡‘èã€ç”µå•†ã€O2O ç­‰åœºæ™¯</li>
</ul>
<p><strong>API ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">import requests
import json

def tongdun_device_risk(device_id, event_type):
&quot;&quot;&quot;
CallåŒç›¾è®¾å¤‡é£é™©è¯„ä¼°API
&quot;&quot;&quot;
url = &quot;https://api.tongdun.cn/riskService&quot;

params = {
&quot;partner_code&quot;: &quot;your_partner_code&quot;,
&quot;device_id&quot;: device_id,
&quot;event_type&quot;: event_type, # å¦‚: login, register, pay
&quot;timestamp&quot;: int(time.time() * 1000)
}

# AddSignature
params[&quot;sign&quot;] = generate_sign(params)

response = requests.post(url, json=params)
result = response.json()

return {
&quot;risk_score&quot;: result[&quot;final_score&quot;], # é£é™©åˆ†æ•° 0-100
&quot;risk_level&quot;: result[&quot;risk_level&quot;], # high/medium/low
&quot;device_labels&quot;: result[&quot;labels&quot;] # è®¾å¤‡æ ‡ç­¾
}

</code></pre>
<ul>
<li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š</li>
</ul>
<ul>
<li>ä¸“æ³¨äºå†…å®¹å®‰å…¨å’Œä¸šåŠ¡å®‰å…¨</li>
<li>è®¾å¤‡æŒ‡çº¹+è¡Œä¸ºåˆ†æ</li>
<li>å®æ—¶é»‘äº§è®¾å¤‡åº“</li>
<li>æ”¯æŒå¤šåœºæ™¯é£æ§</li>
</ul>
<ul>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</li>
</ul>
<ul>
<li>ç¾Šæ¯›å…šè¯†åˆ«</li>
<li>è™šå‡æ³¨å†Œæ‹¦æˆª</li>
<li>åˆ·å•æ£€æµ‹</li>
<li>æ¶æ„çˆ¬è™«è¯†åˆ«</li>
</ul>
<h4>4. ç½‘æ˜“æ˜“ç›¾ (NetEase YiDun)</h4>
<ul>
<li><p><strong>äº§å“</strong>: æ˜“ç›¾è®¾å¤‡æŒ‡çº¹</p>
</li>
<li><p><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š</p>
</li>
</ul>
<ul>
<li>ç½‘æ˜“å†…éƒ¨é£æ§æŠ€æœ¯å¤–åŒ–</li>
<li>æ¸¸æˆã€ç¤¾äº¤åœºæ™¯ä¼˜åŒ–</li>
<li>è®¾å¤‡å”¯ä¸€æ€§è¯†åˆ«</li>
<li>è®¾å¤‡ç¯å¢ƒæ£€æµ‹ï¼ˆRootã€æ¨¡æ‹Ÿå™¨ã€Hook æ¡†æ¶ï¼‰</li>
</ul>
<ul>
<li><strong>SDK é›†æˆç¤ºä¾‹</strong>ï¼ˆAndroidï¼‰ï¼š</li>
</ul>
<pre><code class="language-java">// Initialize
NECaptcha.getInstance()
.init(context, &quot;your_business_id&quot;, new NECaptchaListener() {
@Override
public void onReady() {
// è·å–è®¾å¤‡æŒ‡çº¹
String deviceId = NEDeviceRisk.getDeviceId();
}
});

// è·å–è®¾å¤‡é£é™©ä¿¡æ¯
NEDeviceRisk.check(context, new NEDeviceRiskCallback() {
@Override
public void onResult(NEDeviceRiskResult result) {
int riskLevel = result.getRiskLevel(); // 0-4çº§é£é™©
boolean isEmulator = result.isEmulator();
boolean isRooted = result.isRoot();
boolean isHooked = result.isHook();
}
});

</code></pre>
<ul>
<li>å¾®ä¿¡ã€QQ ç”Ÿæ€æ•°æ®æ”¯æŒ</li>
<li>é»‘äº§è®¾å¤‡åº“å®æ—¶æ›´æ–°</li>
<li>è®¾å¤‡é£é™©è¯„åˆ†</li>
</ul>
<ul>
<li><strong>å®šä»·</strong>ï¼š</li>
</ul>
<ul>
<li>æŒ‰ QPS è®¡è´¹</li>
<li>ä¼ä¸šç‰ˆ: çº¦ 0.01-0.03 å…ƒ/æ¬¡</li>
<li>æ”¯æŒåŒ…å¹´åŒ…æœˆ</li>
</ul>
<h3>å›½é™…çŸ¥åäº§å“</h3>
<h4>1. FingerprintJS</h4>
<ul>
<li><p><strong>ç±»å‹</strong>: å¼€æº + å•†ä¸šç‰ˆ</p>
</li>
<li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
</li>
</ul>
<ul>
<li>ä¸»è¦ç”¨äº Web æµè§ˆå™¨æŒ‡çº¹</li>
<li>å¼€æºç‰ˆæœ¬åŸºç¡€åŠŸèƒ½å…è´¹</li>
<li>Pro ç‰ˆæä¾› 99.5%å‡†ç¡®ç‡</li>
</ul>
<ul>
<li><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-javascript">import FingerprintJS from &quot;@fingerprintjs/fingerprintjs&quot;;

// Initializeagent
const fpPromise = FingerprintJS.load();

// Getè®¿å®¢æ ‡è¯†
fpPromise
  .then((fp) =&gt; fp.get())
  .then((result) =&gt; {
    // ThisIsè®¿å®¢æ ‡è¯†
    const visitorId = result.visitorId;
    console.log(visitorId);

    // æ‰€æœ‰Componentï¼ˆæµè§ˆå™¨ç‰¹å¾ï¼‰
    console.log(result.components);
  });
</code></pre>
<ul>
<li>åŒ…å«æ•°ä¸‡ç§è®¾å¤‡å‹å·</li>
<li>ä¸»è¦ç”¨äºç§»åŠ¨å¹¿å‘Šå’Œåˆ†æ</li>
<li>æ”¯æŒäº‘ç«¯ API å’Œæœ¬åœ°éƒ¨ç½²</li>
</ul>
<ul>
<li><strong>API ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-python">from deviceatlas import DeviceApi

# Initialize
api = DeviceApi(&quot;/path/to/DeviceAtlas.json&quot;)

# æ ¹æ® User-Agent è¯†åˆ«è®¾å¤‡
user_agent = &quot;Mozilla/5.0 (Linux; Android 11; Pixel 5)...&quot;
properties = api.get_properties(user_agent)

print(properties.get('displayWidth')) # å±å¹•å®½åº¦
print(properties.get('model')) # è®¾å¤‡å‹å·
print(properties.get('manufacturer')) # åˆ¶é€ å•†

</code></pre>
<ul>
<li>å¹¿å‘Šå½’å› è¿½è¸ª</li>
<li>é˜²ä½œå¼Šæœºåˆ¶</li>
<li>æ”¯æŒ IDFAã€GAIDã€è®¾å¤‡æŒ‡çº¹</li>
</ul>
<h4>4. AppsFlyer</h4>
<ul>
<li><p><strong>äº§å“</strong>: ç§»åŠ¨å½’å› å’Œè¥é”€åˆ†æ</p>
</li>
<li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
</li>
</ul>
<ul>
<li>è®¾å¤‡æŒ‡çº¹æŠ€æœ¯</li>
<li>é˜²ä½œå¼Šï¼ˆProtect360ï¼‰</li>
<li>æ”¯æŒè·¨å¹³å°è¿½è¸ª</li>
<li>éšç§ä¿æŠ¤æ¨¡å¼</li>
</ul>
<hr />
<h2>å¼€æºå·¥å…·ä¸æ¡†æ¶</h2>
<h3>è®¾å¤‡æŒ‡çº¹é‡‡é›†æ¡†æ¶</h3>
<h4>1. fingerprintjs2 (å·²åºŸå¼ƒï¼Œç”± FingerprintJS å–ä»£)</h4>
<ul>
<li><p><strong>GitHub</strong>: https://github.com/fingerprintjs/fingerprintjs</p>
</li>
<li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
</li>
</ul>
<ul>
<li>è½»é‡çº§æµè§ˆå™¨æŒ‡çº¹åº“</li>
<li>çº¯ JavaScript å®ç°</li>
<li>é‡‡é›† Canvasã€WebGLã€Audio ç­‰ç‰¹å¾</li>
</ul>
<ul>
<li><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-javascript">Fingerprint2.get(function (components) {
  // Component æ˜¯é”®å€¼å¯¹æ•°ç»„
  var values = components.map(function (component) {
    return component.value;
  });

  // è®¡ç®—æŒ‡çº¹å“ˆå¸Œ
  var murmur = Fingerprint2.x64hash128(values.join(&quot;&quot;), 31);
  console.log(murmur); // è®¾å¤‡æŒ‡çº¹
});
</code></pre>
<ul>
<li>æ”¯æŒ 12000+è®¾å¤‡å‹å·</li>
<li>å¯ä»¥æ ¹æ® Build.MODEL è·å–å¸‚åœºåŒ–è®¾å¤‡åç§°</li>
</ul>
<ul>
<li><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-java">DeviceName.with(context).request(new DeviceName.Callback() {
@Override
public void onFinished(DeviceName.DeviceInfo info, Exception error) {
String manufacturer = info.manufacturer; // &quot;Samsung&quot;
String marketName = info.marketName; // &quot;Galaxy S21&quot;
String model = info.model; // &quot;SM-G991B&quot;
String codename = info.codename; // &quot;o1s&quot;
}
});

</code></pre>
<ul>
<li>è§£æ User-Agent</li>
<li>è¯†åˆ«è®¾å¤‡ç±»å‹ã€å“ç‰Œã€å‹å·</li>
</ul>
<ul>
<li><strong>Python ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-python">from device_detector import DeviceDetector

user_agent = &quot;Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X)...&quot;
device = DeviceDetector(user_agent).parse()

print(device.os_name()) # iOS
print(device.device_brand()) # Apple
print(device.device_model()) # iPhone
print(device.is_mobile()) # True

</code></pre>
<pre><code class="language-bash"># ä¿®æ”¹è®¾å¤‡æŒ‡çº¹
props ro.build.fingerprint &quot;google/raven/raven:12/...&quot;
props ro.product.model &quot;Pixel 6&quot;

# åº”ç”¨ä¿®æ”¹
props ro.build.product &quot;raven&quot;

</code></pre>
<h4>2. Xposed æ¨¡å—</h4>
<ul>
<li><p><strong>a) XPrivacyLua</strong></p>
</li>
<li><p><strong>GitHub</strong>: https://github.com/M66B/XPrivacyLua</p>
</li>
<li><p><strong>åŠŸèƒ½</strong>ï¼š</p>
</li>
</ul>
<ul>
<li>ç»†ç²’åº¦æƒé™æ§åˆ¶</li>
<li>API è¿”å›å€¼ Hook</li>
<li>è®¾å¤‡ä¿¡æ¯ä¼ªé€ </li>
</ul>
<ul>
<li><strong>ä½¿ç”¨</strong>ï¼š</li>
</ul>
<pre><code>    ```

**b) VirtualXposed / Taichi**

**åŠŸèƒ½**ï¼š
- å… Root ä½¿ç”¨ Xposed
- åº”ç”¨è™šæ‹ŸåŒ–
- åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä¿®æ”¹è®¾å¤‡ä¿¡æ¯

#### 3. Frida è„šæœ¬åº“

**a) frida-scripts (è®¾å¤‡æŒ‡çº¹ç›¸å…³)**

å¸¸ç”¨çš„è®¾å¤‡ä¿¡æ¯ Hook è„šæœ¬ï¼š

```javascript
// é€šç”¨è®¾å¤‡ä¿¡æ¯ Hook è„šæœ¬
Java.perform(function() {
// æ‹¦æˆª Build ç±»æ‰€æœ‰å­—æ®µ
var Build = Java.use(&quot;android.os.Build&quot;);
Build.BRAND.value = &quot;google&quot;;
Build.MODEL.value = &quot;Pixel 6&quot;;
Build.DEVICE.value = &quot;raven&quot;;
Build.PRODUCT.value = &quot;raven&quot;;
Build.MANUFACTURER.value = &quot;Google&quot;;

// Hook settingsss.Secure
var Settings = Java.use(&quot;android.provider.Settings$Secure&quot;);
Settings.getString.overload(
&quot;android.content.ContentResolver&quot;,
&quot;java.lang.String&quot;
).implementation = function(resolver, name) {
if (name == &quot;android_id&quot;) {
return &quot;fake_android_id_12345678&quot;;
}
return this.getString(resolver, name);
};

// Hook TelephonyManager
var TelephonyManager = Java.use(&quot;android.telephony.TelephonyManager&quot;);
TelephonyManager.getDeviceId.overload().implementation = function() {
return &quot;fake_imei_123456789012345&quot;;
};
});

</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼š</li>
</ul>
<ul>
<li>ä¿®æ”¹ Android ID</li>
<li>ä¿®æ”¹ IMEI/MEID</li>
<li>ä¿®æ”¹ MAC åœ°å€</li>
<li>ä¿®æ”¹æ‰‹æœºå·ç </li>
<li>ä¿®æ”¹è®¾å¤‡åºåˆ—å·</li>
</ul>
<ul>
<li><strong>b) Busybox æ”¹æœº</strong></li>
</ul>
<p>ä½¿ç”¨ busybox å‘½ä»¤ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ï¼š</p>
<pre><code class="language-bash"># Modifybuild.prop
busybox sed -i 's/ro.product.model=.*/ro.product.model=Pixel 6/' /system/build.prop

# ModifyMultipleProperty
cat &gt;&gt; /system/build.prop &lt;&lt; EOF
ro.product.brand=google
ro.product.device=raven
ro.product.manufacturer=Google
EOF

</code></pre>
<p>|------|------|
| <strong>GSMArena API</strong> | è®¾å¤‡è§„æ ¼æ•°æ®åº“ |
| <strong>Device Atlas</strong> | å•†ä¸šè®¾å¤‡å±æ€§ API |
| <strong>WURFL</strong> | è®¾å¤‡æè¿°åº“ |</p>
<ul>
<li><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-python">import requests

def get_device_specs(model):
&quot;&quot;&quot;
ä»GSMArenaGetè®¾å¤‡è§„æ ¼
&quot;&quot;&quot;
api_url = f&quot;https://api.gsmarena.com/devices/{model}&quot;
response = requests.get(api_url)

if response.status_code == 200:
data = response.json()
return {
'model': data['model'],
'display': data['display'],
'chipset': data['chipset'],
'memory': data['memory'],
'camera': data['camera'],
'battery': data['battery'],
'sensors': data['sensors']
}

</code></pre>
<p>def <strong>init</strong>(self, device_pool_db):
self.db = device_pool_db
self.used_fingerprints = set()</p>
<p>def get_unused_fingerprint(self):
&quot;&quot;&quot;
ä»è®¾å¤‡æ± ä¸­è·å–æœªä½¿ç”¨çš„æŒ‡çº¹
&quot;&quot;&quot;
while True:
fp = self.db.get_random_fingerprint()
fp_hash = hashlib.md5(json.dumps(fp).encode()).hexdigest()</p>
<p>if fp_hash not in self.used_fingerprints:
self.used_fingerprints.add(fp_hash)
return fp</p>
<p>def apply_fingerprint(self, adb_device, fingerprint):
&quot;&quot;&quot;
å°†æŒ‡çº¹åº”ç”¨åˆ°è®¾å¤‡
&quot;&quot;&quot;</p>
<h1>ä¿®æ”¹ç³»ç»Ÿå±æ€§</h1>
<p>for key, value in fingerprint['build_props'].items():
adb_device.shell(f&quot;setprop {key} {value}&quot;)</p>
<h1>å®‰è£…é¢„è®¾ App</h1>
<p>for apk in fingerprint['apps']:
adb_device.install(apk)</p>
<h1>settingssssss ä½ç½®</h1>
<p>adb_device.shell(f&quot;settings put secure location_mode 3&quot;)
adb_device.shell(
f&quot;am startservice -a com.example.fakelocation &quot;
f&quot;--es lat {fingerprint['location']['lat']} &quot;
f&quot;--es lng {fingerprint['location']['lng']}&quot;
)</p>
<p>def rotate_fingerprint(self, adb_device, interval_hours=24):
&quot;&quot;&quot;
å®šæœŸè½®æ¢è®¾å¤‡æŒ‡çº¹
&quot;&quot;&quot;
while True:
new_fp = self.get_unused_fingerprint()
self.apply_fingerprint(adb_device, new_fp)</p>
<h1>è®°å½• usage å†å²</h1>
<p>self.db.log_usage(adb_device.serial, new_fp, timestamp=time.time())</p>
<p>time.sleep(interval_hours * 3600)</p>
<pre><code>
* æ£€æŸ¥ `/proc/self/maps` ä¸­æ˜¯å¦åŠ è½½äº† `frida-agent.so` æˆ– `XposedBridge.jar`ã€‚


* æ£€æµ‹ Frida çš„é»˜è®¤ç«¯å£ `27042`ã€‚


* é€šè¿‡ `try-catch` æ‰§è¡Œä¸€ä¸ªä¼šå›  Xposed ä¿®æ”¹è€Œæ”¹å˜è¡Œä¸ºçš„å‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚


### æœåŠ¡ç«¯äº¤å‰éªŒè¯

è¿™æ˜¯è®¾å¤‡æŒ‡ç´‹æŠ€æœ¯æœ€å¼ºå¤§çš„åœ°æ–¹ã€‚
åç«¯æœåŠ¡ä¼šå°†å®¢æˆ·ç«¯ä¸Šä¼ çš„å‡ ç™¾ä¸ªç»´åº¦çš„æŒ‡çº¹æ•°æ®è¿›è¡Œäº¤å‰æ¯”å¯¹ã€‚ä¸€ä¸ª `IMEI` æ˜¾ç¤ºæ˜¯ä¸‰æ˜Ÿè®¾å¤‡ï¼Œä½† `Build.FINGERPRINT` å´å±äºå°ç±³ï¼Œè¿™ç§çŸ›ç›¾ä¼šç«‹åˆ»å¯¼è‡´è¯¥è®¾å¤‡è¢«æ ‡è®°ä¸ºé«˜é£é™©ã€‚ä»»ä½•ä¸&quot;æ­£å¸¸è®¾å¤‡&quot;è¡Œä¸ºæ¨¡å¼ä¸ç¬¦çš„ç‰¹å¾ç»„åˆéƒ½ä¼šè¢«è¯†åˆ«å‡ºæ¥ã€‚

**äº¤å‰éªŒè¯è§„åˆ™ç¤ºä¾‹**ï¼š

```python
class FingerprintValidator:
def __init__(self):
self.device_database = self.load_device_db()
self.inconsistency_rules = self.load_rules()

def validate_fingerprint(self, fingerprint):
&quot;&quot;&quot;
Validateè®¾å¤‡æŒ‡çº¹ä¸€è‡´æ€§
&quot;&quot;&quot;
issues = []

# è§„åˆ™1ï¼šå“ç‰Œä¸å‹å·åŒ¹é…
if not self.check_brand_model_match(
fingerprint['brand'],
fingerprint['model']
):
issues.append({
'type': 'brand_model_mismatch',
'severity': 'high',
'message': f&quot;Brand {fingerprint['brand']} does not match model {fingerprint['model']}&quot;
})

# è§„åˆ™2ï¼šå±å¹•åˆ†è¾¨ç‡ä¸å‹å·åŒ¹é…
expected_resolution = self.device_database.get_resolution(fingerprint['model'])
if fingerprint['screen_resolution'] != expected_resolution:
issues.append({
'type': 'resolution_mismatch',
'severity': 'medium',
'message': f&quot;Unexpected resolution for {fingerprint['model']}&quot;
})

# è§„åˆ™3ï¼šä¼ æ„Ÿå™¨ListCompleteæ€§
expected_sensors = self.device_database.get_sensors(fingerprint['model'])
if len(fingerprint['sensors']) &lt; len(expected_sensors) * 0.8:
issues.append({
'type': 'sensor_missing',
'severity': 'high',
'message': 'Too few sensors for this device model'
})

# è§„åˆ™4ï¼šCPUå‹å·ä¸è®¾å¤‡å‹å·åŒ¹é…
expected_cpu = self.device_database.get_cpu(fingerprint['model'])
if fingerprint['cpu'] != expected_cpu:
issues.append({
'type': 'cpu_mismatch',
'severity': 'high',
'message': f&quot;CPU mismatch: expected {expected_cpu}, got {fingerprint['cpu']}&quot;
})

# è§„åˆ™5ï¼šBuildTimeæˆ³åˆç†æ€§
release_date = self.device_database.get_release_date(fingerprint['model'])
if fingerprint['build_time'] &lt; release_date:
issues.append({
'type': 'build_time_invalid',
'severity': 'critical',
'message': 'Build date earlier than device release date'
})

return {
'is_valid': len(issues) == 0,
'risk_score': self.calculate_risk_score(issues),
'issues': issues
}

</code></pre>
<p>ä½¿ç”¨æ ‡æ³¨æ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œè¯†åˆ«çœŸå®è®¾å¤‡ vs ä¼ªé€ è®¾å¤‡ï¼š</p>
<pre><code class="language-python">from sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier
from sklearn.neural_network import MLPClassifier
import numpy as np

class DeviceAuthenticityClassifier:
def __init__(self):
# é›†æˆå¤šä¸ªæ¨¡å‹
self.models = {
'random_forest': RandomForestClassifier(n_estimators=200, max_depth=15),
'gradient_boosting': GradientBoostingClassifier(n_estimators=100),
'neural_network': MLPClassifier(hidden_layers=(128, 64, 32))
}
self.feature_extractor = FeatureExtractor()

def train(self, X_train, y_train):
&quot;&quot;&quot;
è®­ç»ƒåˆ†ç±»å™¨
X_train: è®¾å¤‡æŒ‡çº¹ç‰¹å¾
y_train: æ ‡ç­¾ (0=ä¼ªé€ , 1=Trueå®)
&quot;&quot;&quot;
for name, model in self.models.items():
print(f&quot;Training {name}...&quot;)
model.fit(X_train, y_train)

def predict(self, fingerprint):
&quot;&quot;&quot;
é¢„æµ‹è®¾å¤‡çœŸå®æ€§
&quot;&quot;&quot;
features = self.feature_extractor.extract(fingerprint)

# é›†æˆæŠ•ç¥¨
votes = []
probabilities = []

for name, model in self.models.items():
pred = model.predict([features])[0]
prob = model.predict_proba([features])[0]
votes.append(pred)
probabilities.append(prob[1]) # çœŸå®è®¾å¤‡æ¦‚ç‡

# åŠ æƒå¹³å‡
avg_probability = np.mean(probabilities)

return {
'is_genuine': avg_probability &gt; 0.5,
'confidence': avg_probability,
'votes': dict(zip(self.models.keys(), votes))
}

class FeatureExtractor:
def extract(self, fingerprint):
&quot;&quot;&quot;
ä»åŸå§‹æŒ‡çº¹æå–æœºå™¨å­¦ä¹ ç‰¹å¾
&quot;&quot;&quot;
features = []

# 1. æ•°å€¼ç‰¹å¾
features.extend([
fingerprint.get('screen_width', 0),
fingerprint.get('screen_height', 0),
fingerprint.get('dpi', 0),
fingerprint.get('memory_mb', 0),
fingerprint.get('cpu_cores', 0),
len(fingerprint.get('sensors', [])),
len(fingerprint.get('installed_apps', []))
])

# 2. åˆ†Classç‰¹å¾ï¼ˆç‹¬çƒ­Encodeï¼‰
features.extend(self.encode_categorical(fingerprint.get('brand', 'unknown')))
features.extend(self.encode_categorical(fingerprint.get('os_version', 'unknown')))

# 3. Statisticsç‰¹å¾
app_list = fingerprint.get('installed_apps', [])
features.append(self.calculate_app_diversity(app_list))

# 4. ä¸€è‡´æ€§ç‰¹å¾
features.append(self.check_brand_model_consistency(fingerprint))
features.append(self.check_hardware_software_consistency(fingerprint))

return np.array(features)

def calculate_app_diversity(self, app_list):
&quot;&quot;&quot;
CalculateAppListå¤šæ ·æ€§
ä¼ªé€ è®¾å¤‡å¯èƒ½AppListè¿‡äºSimpleOrè¿‡äºComplex
&quot;&quot;&quot;
if not app_list:
return 0

# ä½¿ç”¨é¦™å†œç†µè¡¡é‡å¤šæ ·æ€§
from collections import Counter
counts = Counter(app.split('.')[0] for app in app_list) # ByPackageNameBeforeç¼€
total = len(app_list)
entropy = -sum((count/total) * np.log2(count/total) for count in counts.values())

return entropy

</code></pre>
<p>from sklearn.covariance import EllipticEnvelope</p>
<p>class AnomalyDetector:
def <strong>init</strong>(self):
self.isolation_forest = IsolationForest(contamination=0.1, random_state=42)
self.elliptic_envelope = EllipticEnvelope(contamination=0.1)</p>
<p>def fit(self, normal_devices):
&quot;&quot;&quot;
ä½¿ç”¨æ­£å¸¸è®¾å¤‡æ•°æ®è®­ç»ƒ
normal_devices: å·²çŸ¥çœŸå®è®¾å¤‡ç‰¹å¾å‘é‡
&quot;&quot;&quot;
self.isolation_forest.fit(normal_devices)
self.elliptic_envelope.fit(normal_devices)</p>
<p>def detect_anomaly(self, device_features):
&quot;&quot;&quot;
Detection è®¾å¤‡ IsNoException
Return: (is_anomaly, anomaly_score)
&quot;&quot;&quot;</p>
<h1>Isolation Forest Detection</h1>
<p>if_score = self.isolation_forest.score_samples([device_features])[0]
if_pred = self.isolation_forest.predict([device_features])[0] # -1representsanomaly</p>
<h1>Elliptic Envelope Detection</h1>
<p>ee_pred = self.elliptic_envelope.predict([device_features])[0]</p>
<h1>ç»¼åˆæ£€æŸ¥</h1>
<p>is_anomaly = (if_pred == -1) or (ee_pred == -1)
anomaly_score = abs(if_score) # åˆ†æ•°è¶Šä½è¶Š anomaly</p>
<p>return is_anomaly, anomaly_score</p>
<pre><code>from tensorflow.keras import layers, models

class DeepFingerprintDetector:
def __init__(self, input_dim):
self.model = self.build_model(input_dim)

def build_model(self, input_dim):
&quot;&quot;&quot;
Buildæ·±åº¦ç¥ç»Network
&quot;&quot;&quot;
model = models.Sequential([
layers.Dense(256, activation='relu', input_shape=(input_dim,)),
layers.Dropout(0.3),
layers.Dense(128, activation='relu'),
layers.Dropout(0.3),
layers.Dense(64, activation='relu'),
layers.Dropout(0.2),
layers.Dense(32, activation='relu'),
layers.Dense(1, activation='sigmoid') # è¾“å‡º: Trueå®è®¾å¤‡æ¦‚ç‡
])

model.compile(
optimizer='adam',
loss='binary_crossentropy',
metrics=['accuracy', tf.keras.metrics.AUC()]
)

return model

def train(self, X_train, y_train, epochs=50, batch_size=32):
&quot;&quot;&quot;
è®­ç»ƒæ¨¡Type
&quot;&quot;&quot;
self.model.fit(
X_train, y_train,
epochs=epochs,
batch_size=batch_size,
validation_split=0.2
)

def predict(self, device_features):
&quot;&quot;&quot;
é¢„æµ‹è®¾å¤‡çœŸå®æ€§
&quot;&quot;&quot;
probability = self.model.predict([device_features])[0][0]

return {
'is_genuine': probability &gt; 0.5,
'confidence': probability
}

</code></pre>
<p>from tensorflow.keras.layers import LSTM, Dense
from tensorflow.keras.models import Sequential</p>
<p>class BehaviorSequenceDetector:
def <strong>init</strong>(self, sequence_length=100, feature_dim=20):
self.sequence_length = sequence_length
self.model = self.build_lstm_model(sequence_length, feature_dim)</p>
<p>def build_lstm_model(self, sequence_length, feature_dim):
&quot;&quot;&quot;
BuildLSTM æ¨¡ TypeAnalyze è¡Œä¸ºåºåˆ—
&quot;&quot;&quot;
model = Sequential([
LSTM(128, return_sequences=True, input_shape=(sequence_length, feature_dim)),
LSTM(64, return_sequences=False),
Dense(32, activation='relu'),
Dense(1, activation='sigmoid')
])</p>
<p>model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])
return model</p>
<p>def detect_bot_behavior(self, action_sequence):
&quot;&quot;&quot;
Detection æœºå™¨äººè¡Œä¸º
action_sequence: ç”¨æˆ·æ“ä½œåºåˆ— (ç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥ç­‰)
&quot;&quot;&quot;</p>
<h1>æå–ç‰¹å¾</h1>
<p>features = self.extract_sequence_features(action_sequence)</p>
<h1>é¢„æµ‹</h1>
<p>is_bot_probability = self.model.predict([features])[0][0]</p>
<p>return {
'is_bot': is_bot_probability &gt; 0.7,
'confidence': is_bot_probability,
'suspicious_patterns': self.identify_suspicious_patterns(action_sequence)
}</p>
<p>def identify_suspicious_patterns(self, action_sequence):
&quot;&quot;&quot;
è¯†åˆ«å¯ç–‘æ¨¡å¼
&quot;&quot;&quot;
patterns = []</p>
<h1>æ£€æµ‹è¿‡äºè§„å¾‹çš„æ“ä½œ</h1>
<p>if self.is_too_regular(action_sequence):
patterns.append('regular_intervals')</p>
<h1>æ£€æµ‹ä¸è‡ªç„¶çš„é€Ÿåº¦</h1>
<p>if self.is_speed_abnormal(action_sequence):
patterns.append('abnormal_speed')</p>
<h1>æ£€æµ‹ç¼ºå°‘äººç±»ç‰¹å¾ï¼ˆå¦‚å¾®å°æŠ–åŠ¨ï¼‰</h1>
<p>if not self.has_human_jitter(action_sequence):
patterns.append('no_human_jitter')</p>
<p>return patterns</p>
<pre><code>
class DeviceGraphAnalyzer:
def __init__(self):
self.device_graph = nx.Graph()

def add_device_relationships(self, device_id, related_devices, relationship_type):
&quot;&quot;&quot;
Addè®¾å¤‡å…³ç³»åˆ°å›¾In
relationship_type: 'same_ip', 'same_wifi', 'same_behavior', etc.
&quot;&quot;&quot;
self.device_graph.add_node(device_id)

for related_id in related_devices:
self.device_graph.add_edge(
device_id,
related_id,
relationship=relationship_type
)

def detect_device_farm(self, threshold=10):
&quot;&quot;&quot;
æ£€æµ‹è®¾å¤‡å†œåœºï¼ˆå¤§é‡å…³è”è®¾å¤‡ï¼‰
&quot;&quot;&quot;
# å¯»æ‰¾è¿é€šåˆ†é‡
components = list(nx.connected_components(self.device_graph))

suspicious_clusters = []
for component in components:
if len(component) &gt; threshold:
# AnalyzeThisClusterç‰¹å¾
cluster_info = {
'devices': list(component),
'size': len(component),
'density': nx.density(self.device_graph.subgraph(component)),
'risk_score': self.calculate_cluster_risk(component)
}
suspicious_clusters.append(cluster_info)

return suspicious_clusters

def calculate_cluster_risk(self, device_cluster):
&quot;&quot;&quot;
è®¡ç®—è®¾å¤‡ç°‡é£é™©åˆ†æ•°
&quot;&quot;&quot;
subgraph = self.device_graph.subgraph(device_cluster)

# ç‰¹å¾1ï¼šè¿æ¥å¯†åº¦ï¼ˆå¯†åº¦è¶Šé«˜ï¼Œè¶Šå¯èƒ½æ˜¯è®¾å¤‡å†œåœºï¼‰
density = nx.density(subgraph)

# ç‰¹å¾2ï¼šå…±äº«å…³ç³»ç±»å‹
edge_types = [subgraph[u][v]['relationship'] for u, v in subgraph.edges()]
type_diversity = len(set(edge_types)) / len(edge_types) if edge_types else 0

# ç‰¹å¾3ï¼šç°‡å¤§å°
size_score = min(len(device_cluster) / 100, 1.0)

# ç»¼åˆè¯„åˆ†
risk_score = (density * 0.4 + (1 - type_diversity) * 0.3 + size_score * 0.3) * 100

return risk_score

</code></pre>
<p>class FeatureImportanceAnalyzer:
def <strong>init</strong>(self, model, X_train):
self.model = model
self.explainer = shap.TreeExplainer(model)
self.X_train = X_train</p>
<p>def analyze_feature_importance(self, feature_names):
&quot;&quot;&quot;
Analyze å“ªäº›ç‰¹å¾å¯¹è¯†åˆ«ä¼ªé€ è®¾å¤‡æœ€é‡è¦
&quot;&quot;&quot;
shap_values = self.explainer.shap_values(self.X_train)</p>
<h1>ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾</h1>
<p>shap.summary_plot(shap_values, self.X_train, feature_names=feature_names)</p>
<h1>è·å–ç‰¹å¾é‡è¦æ€§æ’å</h1>
<p>feature_importance = np.abs(shap_values).mean(axis=0)
importance_df = pd.DataFrame({
'feature': feature_names,
'importance': feature_importance
}).sort_values('importance', ascending=False)</p>
<p>return importance_df</p>
<p>def explain_prediction(self, device_features, feature_names):
&quot;&quot;&quot;
è§£é‡Šå•ä¸ªè®¾å¤‡é¢„æµ‹ç»“æœ
&quot;&quot;&quot;
shap_values = self.explainer.shap_values(device_features)</p>
<h1>å¯è§†åŒ–</h1>
<p>shap.force_plot(
self.explainer.expected_value,
shap_values,
device_features,
feature_names=feature_names
)</p>
<h1>ReturnContribution æœ€å¤§ç‰¹å¾</h1>
<p>contributions = dict(zip(feature_names, shap_values.flatten()))
top_contributors = sorted(
contributions.items(),
key=lambda x: abs(x[1]),
reverse=True
)[:10]</p>
<p>return top_contributors</p>
<pre><code>æŸå¤§å‹ç”µå•†å¹³å°é¢ä¸´å¤§é‡åˆ·å•ã€è™šå‡è¯„è®ºå’Œè–…ç¾Šæ¯›è¡Œä¸ºï¼Œéœ€è¦é€šè¿‡è®¾å¤‡æŒ‡çº¹è¯†åˆ«æ¶æ„ç”¨æˆ·ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

**1. æŒ‡çº¹é‡‡é›†**

```java
public class EcommerceFingerprintCollector {
public DeviceFingerprint collect(Context context) {
DeviceFingerprint fp = new DeviceFingerprint();

// Basicç¡¬ä»¶Info
fp.setAndroidId(getAndroidId(context));
fp.setModel(Build.MODEL);
fp.setBrand(Build.BRAND);

// NetworkInfo
fp.setIpAddress(getIPAddress());
fp.setMacAddress(getMacAddress(context));

// AppInfo
fp.setInstalledApps(getInstalledApps(context));

// è¡Œä¸ºç‰¹å¾
fp.setTouchPressure(collectTouchPressure());
fp.setTypingSpeed(collectTypingSpeed());

// ç¯å¢ƒDetection
fp.setIsRooted(checkRootStatus());
fp.setIsEmulator(checkEmulatorStatus());
fp.setIsHooked(checkHookStatus());

return fp;
}

private boolean checkHookStatus() {
// DetectionFrida
if (checkFridaPort()) return true;
if (checkFridaLibraries()) return true;

// DetectionXposed
if (checkXposedEnvironment()) return true;

return false;
}
}

</code></pre>
<p>self.fingerprint_db = FingerprintDatabase()
self.ml_detector = DeviceAuthenticityClassifier()
self.behavior_analyzer = BehaviorSequenceDetector()</p>
<p>def check_order_risk(self, user_id, device_fp, order_info):
&quot;&quot;&quot;
è®¢å•é£é™©è¯„ä¼°
&quot;&quot;&quot;
risk_factors = []
risk_score = 0</p>
<h1>1. è®¾å¤‡æŒ‡çº¹ Check</h1>
<p>device_risk = self.check_device_fingerprint(device_fp)
if device_risk['is_suspicious']:
risk_factors.append(device_risk)
risk_score += 30</p>
<h1>2. è®¾å¤‡ AssociationAnalyze</h1>
<p>related_devices = self.fingerprint_db.find_related_devices(device_fp)
if len(related_devices) &gt; 10:
risk_factors.append({
'type': 'device_cluster',
'message': f'Device associated with {len(related_devices)} other devices'
})
risk_score += 25</p>
<h1>3. ç”¨æˆ·è¡Œä¸º Analyze</h1>
<p>user_behavior = self.fingerprint_db.get_user_behavior(user_id)
if self.is_bot_behavior(user_behavior):
risk_factors.append({'type': 'bot_behavior'})
risk_score += 35</p>
<h1>4. è®¢å•ç‰¹å¾ Analyze</h1>
<p>if order_info['amount'] &gt; 10000 and order_info['create_time'] - user_id.register_time &lt; 3600:
risk_factors.append({'type': 'new_user_large_order'})
risk_score += 20</p>
<h1>å†³ç­–</h1>
<p>if risk_score &gt;= 60:
action = 'reject'
elif risk_score &gt;= 40:
action = 'manual_review'
else:
action = 'approve'</p>
<p>return {
'action': action,
'risk_score': risk_score,
'risk_factors': risk_factors
}</p>
<p>def check_device_fingerprint(self, fp):
&quot;&quot;&quot;
è®¾å¤‡æŒ‡çº¹å®Œæ•´æ€§æ£€æŸ¥
&quot;&quot;&quot;
issues = []</p>
<h1>æ£€æµ‹æ¨¡æ‹Ÿå™¨</h1>
<p>if fp.get('is_emulator'):
issues.append('emulator_detected')</p>
<h1>æ£€æµ‹ Hook æ¡†æ¶</h1>
<p>if fp.get('is_hooked'):
issues.append('hook_framework_detected')</p>
<h1>æ£€æµ‹è®¾å¤‡å‚æ•°ä¸€è‡´æ€§</h1>
<p>validator = FingerprintValidator()
validation = validator.validate_fingerprint(fp)
if not validation['is_valid']:
issues.extend([issue['type'] for issue in validation['issues']])</p>
<h1>æœºå™¨å­¦ä¹ æ£€æµ‹</h1>
<p>ml_result = self.ml_detector.predict(fp)
if not ml_result['is_genuine']:
issues.append('ml_fake_device_detected')</p>
<p>return {
'is_suspicious': len(issues) &gt; 0,
'issues': issues,
'risk_level': 'high' if len(issues) &gt;= 3 else 'medium' if len(issues) &gt; 0 else 'low'
}</p>
<pre><code>- Frida Hookè®¾å¤‡ä¿¡æ¯API
- éšæœºåŒ–åº”ç”¨åˆ—è¡¨


* *æ£€æµ‹å¯¹æŠ—**ï¼š

```python
def advanced_detection(device_fp, user_behavior):
&quot;&quot;&quot;
AdvancedDetectionæŠ€æœ¯
&quot;&quot;&quot;
# Detection1ï¼šäº‘æ‰‹æœºç‰¹å¾
if is_cloud_phone(device_fp):
return {'blocked': True, 'reason': 'cloud_phone_detected'}

# Detection2ï¼šä»£ç†/æœºæˆ¿IP
ip_info = get_ip_info(device_fp['ip_address'])
if ip_info['isp'] in ['Alibaba Cloud', 'Tencent Cloud', 'AWS']:
if not is_corporate_user(user_id):
return {'blocked': True, 'reason': 'datacenter_ip'}

# æ£€æµ‹3ï¼šè®¾å¤‡å‚æ•°è¿‡äºå®Œç¾
if all_parameters_perfectly_match(device_fp):
return {'blocked': True, 'reason': 'too_perfect_fingerprint'}

# Detection4ï¼šè¡Œä¸ºæ¨¡å¼æœºå™¨åŒ–
if behavior_too_regular(user_behavior):
return {'blocked': True, 'reason': 'bot_behavior'}

return {'blocked': False}

</code></pre>
<h3>æ¡ˆä¾‹ 2ï¼šé‡‘è App é£æ§ç»•è¿‡</h3>
<ul>
<li><p><strong>èƒŒæ™¯</strong>ï¼š
æŸé‡‘è App ä½¿ç”¨é¡¶è±¡è®¾å¤‡æŒ‡çº¹è¿›è¡Œé£æ§ï¼Œæ”»å‡»è€…å°è¯•ç»•è¿‡è¿›è¡Œæ‰¹é‡æ³¨å†Œå’Œè–…ç¾Šæ¯›ã€‚</p>
</li>
<li><p><strong>App ä¿æŠ¤æªæ–½</strong>ï¼š</p>
</li>
</ul>
<ol>
<li>é›†æˆé¡¶è±¡ SDK é‡‡é›†è®¾å¤‡æŒ‡çº¹</li>
<li>SO å±‚åŠ å›ºï¼ˆ360 åŠ å›ºï¼‰</li>
<li>æ£€æµ‹ Rootã€æ¨¡æ‹Ÿå™¨ã€Hook æ¡†æ¶</li>
<li>ç½‘ç»œè¯·æ±‚ç­¾åéªŒè¯</li>
</ol>
<ul>
<li><p><strong>åˆ†æè¿‡ç¨‹</strong>ï¼š</p>
</li>
<li><p><strong>Step 1: è®¾å¤‡æŒ‡çº¹ SDK å®šä½</strong></p>
</li>
</ul>
<pre><code class="language-bash"># åç¼–è¯‘ APK
apktool d app.apk

# æœç´¢è®¾å¤‡æŒ‡çº¹ç›¸å…³ä»£ç 
grep -r &quot;getDeviceId&quot; .
grep -r &quot;fingerprint&quot; .

# æ‰¾åˆ° SDK åŒ…å
# com.dingxiang.sdk.fingerprint

</code></pre>
<p>// Hook é¡¶è±¡ SDK
var DXFingerprint = Java.use(&quot;com.dingxiang.sdk.fingerprint.DXFingerprint&quot;);</p>
<p>DXFingerprint.getDeviceId.implementation = function() {
console.log(&quot;[*] getDeviceId() called&quot;);</p>
<p>// Return ä¼ªé€ è®¾å¤‡ ID
var fakeDeviceId = &quot;fake<em>dx_device_id</em>&quot; + Math.random().toString(36).substring(7);
console.log(&quot;[*] Returning fake device ID: &quot; + fakeDeviceId);</p>
<p>return fakeDeviceId;
};</p>
<p>// Hook é‡‡é›† Method
DXFingerprint.collect.implementation = function(context) {
console.log(&quot;[*] collect() called&quot;);</p>
<p>// Modify é‡‡é›† Data
var result = this.collect(context);</p>
<p>// ç¯¡æ”¹æŒ‡çº¹ Data
modifyFingerprintData(result);</p>
<p>return result;
};
});</p>
<pre><code>
```python
CompleteBypassFlow
&quot;&quot;&quot;
# 1. å‡†å¤‡ç¯å¢ƒ
device = setup_rooted_device()

# 2. InstallMagiskéšè—Root
install_magisk_modules([
'MagiskHide',
'Universal SafetyNet Fix',
'Device Faker'
])

# 3. ä¿®æ”¹è®¾å¤‡æŒ‡çº¹
fake_fingerprint = generate_realistic_fingerprint()
apply_fingerprint(device, fake_fingerprint)

# 4. éšè— Frida
use_frida_server_rename()
use_frida_gadget_injection()

# 5. å¯åŠ¨ Frida è„šæœ¬
frida_script = load_script('dingxiang_bypass.js')
attach_to_app(device, 'com.financial.app', frida_script)

# 6. ä»£ç†è®¾ç½®ï¼ˆç»•è¿‡ IP é£æ§ï¼‰
setup_proxy(device, get_random_proxy())

# 7. æ¨¡æ‹ŸçœŸå®è¡Œä¸º
simulate_human_behavior(device, duration=300) # 5 åˆ†é’Ÿ

# 8. æ‰§è¡Œç›®æ ‡æ“ä½œ
register_account(device)

</code></pre>
<pre><code class="language-javascript">Java.perform(function () {
  // 1. æ‹¦æˆª Native å±‚è®¾å¤‡æŒ‡çº¹é‡‡é›†
  var libc = Process.getModuleByName(&quot;libc.so&quot;);

  // Hookç³»ç»ŸCallï¼ˆSVCæŒ‡ä»¤ï¼‰
  Interceptor.attach(Module.findExportByName(&quot;libc.so&quot;, &quot;syscall&quot;), {
    onEnter: function (args) {
      var syscall_num = args[0].toInt32();

      // InterceptSpecificç³»ç»ŸCall
      if (syscall_num == 3) {
        // read
        // ModifyReadå†…å®¹
      } else if (syscall_num == 5) {
        // open
        var path = Memory.readUtf8String(args[1]);
        console.log(&quot;[*] Opening file: &quot; + path);

        // Interceptæ•æ„ŸFileRead
        if (path.includes(&quot;/proc/cpuinfo&quot;)) {
          // Returnä¼ªé€ cpuinfo
        }
      }
    },
  });

  // 2. HookåŠ å›ºAfterSO
  var libjiagu = Process.getModuleByName(&quot;libjiagu.so&quot;);

  // å¯»æ‰¾å…³KeyFunction
  var init_array = libjiagu.enumerateSymbols();
  init_array.forEach(function (symbol) {
    if (symbol.name.includes(&quot;fingerprint&quot;)) {
      console.log(&quot;[*] Found fingerprint function: &quot; + symbol.name);

      Interceptor.attach(symbol.address, {
        onEnter: function (args) {
          console.log(&quot;[*] Called: &quot; + symbol.name);
        },
        onLeave: function (retval) {
          // ä¿®æ”¹è¿”å›å€¼
        },
      });
    }
  });
});
</code></pre>
<ul>
<li>æ¯ä¸ªå®ä¾‹é…ç½®ç‹¬ç«‹ä»£ç†</li>
<li>å®ç°å®Œæ•´çš„è®¾å¤‡æŒ‡çº¹æ¨¡æ‹Ÿ</li>
<li>æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºæ¨¡å¼</li>
<li>æˆæœ¬ï¼šçº¦ 2 å…ƒ/è´¦å·</li>
</ul>
<ul>
<li><strong>æ•™è®­</strong>ï¼š</li>
</ul>
<ol>
<li><strong>å•çº¯çš„ Hook ä¸å¤Ÿ</strong>ï¼šéœ€è¦å®Œæ•´çš„ç¯å¢ƒä¼ªè£…</li>
<li><strong>è®¾å¤‡ä¸€è‡´æ€§è‡³å…³é‡è¦</strong>ï¼šæ‰€æœ‰å‚æ•°å¿…é¡»é€»è¾‘è‡ªæ´½</li>
<li><strong>è¡Œä¸ºæ¨¡æ‹Ÿå¿…ä¸å¯å°‘</strong>ï¼šçº¯æŠ€æœ¯ç»•è¿‡å®¹æ˜“è¢«è¡Œä¸ºåˆ†æè¯†ç ´</li>
<li><strong>æˆæœ¬ä¸æ”¶ç›Šå¹³è¡¡</strong>ï¼šé«˜è´¨é‡ç»•è¿‡éœ€è¦è¾ƒé«˜æˆæœ¬</li>
</ol>
<p>å› æ­¤ï¼ŒæˆåŠŸçš„ç»•è¿‡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€åœºå…³äº&quot;ä¼ªé€ ä¸€ä¸ªå¤©è¡£æ— ç¼çš„è®¾å¤‡ç”»åƒ&quot;çš„æŒä¹…æˆ˜ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-13">
                                                <h2>13. R11: Mobile App Security & Anti Bot</h2>
                                                <h1>R11: ç§»åŠ¨ç«¯å®‰å…¨ä¸é£æ§æŠ€æœ¯</h1>
<p>ç°ä»£ç§»åŠ¨åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å¤„ç†æ•æ„Ÿç”¨æˆ·æ•°æ®æˆ–æœ‰ä»·å€¼ä¸šåŠ¡é€»è¾‘çš„åº”ç”¨ï¼Œé€šå¸¸ä¼šå®ç°å¤šå±‚å®‰å…¨æœºåˆ¶æ¥é˜²å¾¡é€†å‘å·¥ç¨‹ã€ç¯¡æ”¹å’Œè‡ªåŠ¨åŒ–æ»¥ç”¨ï¼ˆæœºå™¨äººï¼‰ã€‚è¿™ä¸€é¢†åŸŸé€šå¸¸è¢«ç§°ä¸º&quot;RASP&quot;ï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰æˆ–&quot;åæœºå™¨äººæŠ€æœ¯&quot;ã€‚</p>
<p>æœ¬æ–‡æ¡£æ¦‚è¿°äº†å¸¸è§çš„æŠ€æœ¯ã€‚</p>
<hr />
<h2>å…³é”®é˜²å¾¡ç±»å‹</h2>
<h3>1. åè°ƒè¯•ä¸ååˆ†æ</h3>
<p>è¿™äº›æŠ€æœ¯æ—¨åœ¨æ£€æµ‹å¹¶é˜»æ­¢åƒè°ƒè¯•å™¨å’Œæ’æ¡©æ¡†æ¶è¿™æ ·çš„åˆ†æå·¥å…·ã€‚</p>
<ul>
<li><p><strong>è°ƒè¯•å™¨æ£€æµ‹</strong>:</p>
</li>
<li><p>æ£€æŸ¥ <code>/proc/self/status</code> ä¸­çš„ <code>TracerPid</code>ã€‚ä¸€ä¸ªéé›¶å€¼è¡¨ç¤ºæœ‰è°ƒè¯•å™¨é™„åŠ ã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>ptrace(PTRACE_TRACEME, 0, NULL, NULL)</code> å¹¶æ£€æŸ¥è¿”å›å€¼æ˜¯å¦å°äº 0ã€‚</p>
</li>
<li><p>æ—¶é—´æ£€æŸ¥ï¼šæµ‹é‡æ‰§è¡Œä¸€æ®µä»£ç æ‰€éœ€çš„æ—¶é—´ã€‚å¦‚æœé™„åŠ äº†è°ƒè¯•å™¨ï¼ˆå¸¦æœ‰æ–­ç‚¹ï¼‰ï¼Œæ—¶é—´å°†ä¼šæœ‰æ˜¾è‘—ä¸åŒã€‚</p>
</li>
<li><p><strong>Frida æ£€æµ‹</strong>:</p>
</li>
<li><p>æ‰«æå†…å­˜ä¸­æ˜¯å¦å­˜åœ¨ <code>frida-agent</code> æˆ– <code>frida-gadget</code> åº“ã€‚</p>
</li>
<li><p>é€šè¿‡å°è¯•è¿æ¥å…¶é»˜è®¤ç«¯å£ï¼ˆ27042ï¼‰æ¥æ£€æµ‹ Frida çš„æœåŠ¡å™¨ã€‚</p>
</li>
<li><p>æ£€æŸ¥ Frida ç‰¹æœ‰çš„ç—•è¿¹ï¼Œå¦‚å‘½åç®¡é“ï¼ˆ<code>frida-pipe</code>ï¼‰æˆ–å¯¹ <code>REPL</code> ç¯å¢ƒçš„ä¿®æ”¹ã€‚</p>
</li>
<li><p><strong>æ¨¡æ‹Ÿå™¨/Root æ£€æµ‹</strong>:</p>
</li>
<li><p>æ£€æŸ¥å·²çŸ¥çš„æ¨¡æ‹Ÿå™¨ç‰¹æœ‰æ–‡ä»¶ã€å±æ€§ï¼ˆ<code>ro.kernel.qemu</code>ï¼‰æˆ–è®¾å¤‡é©±åŠ¨ã€‚</p>
</li>
<li><p>æ£€æŸ¥æ˜¯å¦å­˜åœ¨ root ç®¡ç†åº”ç”¨ï¼ˆå¦‚ SuperSUï¼‰æˆ– <code>su</code> äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
</li>
</ul>
<h3>2. åç¯¡æ”¹</h3>
<p>è¿™äº›æŠ€æœ¯ç¡®ä¿åº”ç”¨çš„ä»£ç å’Œæ•°æ®æœªè¢«ä¿®æ”¹ã€‚</p>
<ul>
<li><p><strong>ä»£ç å®Œæ•´æ€§æ ¡éªŒ</strong>: åœ¨è¿è¡Œæ—¶è®¡ç®— <code>classes.dex</code> æ–‡ä»¶æˆ–åŸç”Ÿåº“ï¼ˆ<code>.so</code>ï¼‰çš„æ ¡éªŒå’Œæˆ–å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚ SHA-256ï¼‰ï¼Œå¹¶ä¸å®‰å…¨å­˜å‚¨çš„å·²çŸ¥è‰¯å¥½å€¼è¿›è¡Œæ¯”è¾ƒã€‚</p>
</li>
<li><p><strong>ç­¾åéªŒè¯</strong>: åœ¨è¿è¡Œæ—¶ï¼Œè·å–åº”ç”¨è‡ªèº«çš„ç­¾åå¹¶éªŒè¯å…¶æ˜¯å¦ä¸å®˜æ–¹å¼€å‘è€…ç­¾ååŒ¹é…ã€‚è¿™å¯ä»¥é˜²æ­¢é‡æ‰“åŒ…ã€‚</p>
</li>
<li><p><strong>å†…å­˜å®Œæ•´æ€§æ ¡éªŒ</strong>: å®šæœŸæ‰«æåº”ç”¨è‡ªèº«çš„å†…å­˜ï¼Œä»¥ç¡®ä¿å…³é”®å‡½æ•°æœªè¢« Frida ç­‰å·¥å…·é’©ä½æˆ–ä¿®è¡¥ã€‚</p>
</li>
</ul>
<h3>3. åæœºå™¨äººä¸ä¸šåŠ¡é€»è¾‘ä¿æŠ¤</h3>
<p>è¿™äº›æŠ€æœ¯æ—¨åœ¨é˜²æ­¢è‡ªåŠ¨åŒ–è„šæœ¬æ»¥ç”¨åº”ç”¨çš„ API æˆ–åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºåƒåœ¾è´¦æˆ·ã€æŠ“å–æ•°æ®ï¼‰ã€‚</p>
<ul>
<li><p><strong>è®¾å¤‡è¯æ˜</strong>: ä½¿ç”¨åƒ Android çš„ <code>SafetyNet</code> / <code>Play Integrity</code> API è¿™æ ·çš„æœåŠ¡ï¼Œä»è°·æ­ŒæœåŠ¡å™¨è·å–ä¸€ä¸ªåŠ å¯†è¯æ˜ï¼Œè¯æ˜è®¾å¤‡æ˜¯çœŸå®çš„ã€é root çš„ï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡Œå®˜æ–¹åº”ç”¨ã€‚è¿™éå¸¸éš¾ä»¥ç»•è¿‡ã€‚</p>
</li>
<li><p><strong>è¯·æ±‚ç­¾å</strong>: å…³é”®çš„ API è¯·æ±‚é€šå¸¸å—&quot;ç­¾å&quot;ä¿æŠ¤ã€‚è¿™ä¸ªç­¾åæ˜¯æ ¹æ®è¯·æ±‚å‚æ•°ã€æ—¶é—´æˆ³ã€éšæœºæ•°å’Œä¸€ä¸ªå¯†é’¥è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚ HMAC-SHA256ï¼‰ã€‚å¯†é’¥é€šå¸¸ä½¿ç”¨æ··æ·†ç­‰æŠ€æœ¯éšè—èµ·æ¥ã€‚é€†å‘è¿™ä¸ªç­¾åç®—æ³•æ˜¯åˆ†æå¸ˆçš„ä¸€ä¸ªå¸¸è§ç›®æ ‡ã€‚</p>
</li>
<li><p><strong>è¡Œä¸ºåˆ†æ</strong>: åœ¨æœåŠ¡å™¨ç«¯ï¼Œåˆ†æ API è°ƒç”¨çš„<em>æ—¶é—´</em>å’Œ<em>é¡ºåº</em>ï¼Œä»¥å»ºç«‹çœŸå®ç”¨æˆ·çš„è¡Œä¸ºç”»åƒã€‚æœºå™¨äººé€šå¸¸å…·æœ‰éå¸¸åƒµç¡¬ã€éäººç±»çš„æ—¶é—´æ¨¡å¼ï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹å®ƒä»¬ã€‚</p>
</li>
</ul>
<hr />
<h2>ç»•è¿‡ç­–ç•¥</h2>
<p>ç»•è¿‡è¿™äº›é˜²å¾¡éœ€è¦ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æã€‚</p>
<ul>
<li><p><strong>é’©å­ä¸è¡¥ä¸</strong>: ä½¿ç”¨ Frida é’©ä½è´Ÿè´£è¿™äº›æ£€æŸ¥çš„å‡½æ•°ï¼Œå¹¶å¼ºåˆ¶å®ƒä»¬è¿”å›ä¸€ä¸ª&quot;å®‰å…¨&quot;çš„å€¼ã€‚ä¾‹å¦‚ï¼Œé’©ä½è¯»å– <code>TracerPid</code> çš„å‡½æ•°ï¼Œä½¿å…¶æ€»æ˜¯è¿”å› 0ã€‚</p>
</li>
<li><p><strong>è‡ªå®šä¹‰ Frida ç‰ˆæœ¬</strong>: ä¸ºäº†å¯¹æŠ— Frida æ£€æµ‹ï¼Œä½ å¯ä»¥ç¼–è¯‘ä¸€ä¸ªè‡ªå®šä¹‰åç§°å’Œä¸åŒé»˜è®¤ç«¯å£çš„ <code>frida-server</code> ç‰ˆæœ¬ã€‚</p>
</li>
<li><p><strong>é™æ€åˆ†æ</strong>: åæ±‡ç¼–åº”ç”¨ä»¥æ‰¾åˆ°æ£€æŸ¥é€»è¾‘ã€‚ä¸€æ—¦æ‰¾åˆ°ï¼Œä½ é€šå¸¸å¯ä»¥å°†å…¶&quot;nop&quot;æ‰ï¼ˆç”¨ <code>NOP</code> æŒ‡ä»¤æ›¿æ¢ï¼‰ï¼Œä»¥æ°¸ä¹…ç¦ç”¨å®ƒã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-14">
                                                <h2>14. R12: Unpacking</h2>
                                                <h1>R12: Recipe: è„±å£³åˆ†æåŠ å›ºçš„ android åº”ç”¨</h1>
<h1># é—®é¢˜åœºæ™¯</h1>
<p>ä½ åœ¨é€†å‘åˆ†æä¸€ä¸ª App æ—¶é‡åˆ°äº†ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>âŒ <strong>Jadx æ‰“å¼€ APK åä»£ç å®Œå…¨ä¸å¯è¯»</strong>ï¼Œå…¨æ˜¯æ··æ·†çš„ç±»åæˆ–ç©ºæ–¹æ³•</li>
<li>âŒ <strong>classes.dex æ–‡ä»¶å¼‚å¸¸å°</strong> (å‡ å KB)ï¼Œä¸ç¬¦åˆåº”ç”¨å®é™…è§„æ¨¡</li>
<li>âŒ <strong>åº”ç”¨å¯åŠ¨æ—¶æ£€æµ‹åˆ° Frida å¹¶é—ªé€€</strong>ï¼Œå¸¸è§„ Hook æ— æ³•ç”Ÿæ•ˆ</li>
<li>âŒ <strong>AndroidManifest.xml ä¸­çš„ Application å…¥å£è¢«æ›¿æ¢</strong>æˆå¯ç–‘çš„å£³ç±»å</li>
<li>âŒ <strong><code>assets</code> æˆ– <code>lib</code> ç›®å½•ä¸­å­˜åœ¨åŠ å¯†æ–‡ä»¶</strong>ï¼Œå¦‚ <code>.dat</code>ã€<code>.bin</code> æˆ–å¥‡æ€ªå‘½åçš„ <code>.so</code> æ–‡ä»¶</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯åº”ç”¨è¢«<strong>åŠ å›º(åŠ å£³)</strong>çš„å…¸å‹ç‰¹å¾ã€‚åŠ å›ºæŠ€æœ¯é€šè¿‡åŠ å¯† DEX æ–‡ä»¶ã€æŠ½å–æ–¹æ³•ä½“ã€è™šæ‹ŸåŒ–æŒ‡ä»¤ç­‰æ‰‹æ®µï¼Œè®©é™æ€åˆ†æå·¥å…·æ— æ³•ç›´æ¥è¯»å–åŸå§‹ä»£ç ã€‚æœ¬é…æ–¹å°†æ•™ä½ å¦‚ä½•è¯†åˆ«ã€è„±å£³å¹¶æ¢å¤è¢«åŠ å›ºçš„åº”ç”¨ã€‚</p>
<hr />
<h1># å·¥å…·æ¸…å•</h1>
<h2># å¿…éœ€å·¥å…·</h2>
<ul>
<li>[x] <strong>Frida</strong> - åŠ¨æ€æ’æ¡©æ¡†æ¶</li>
<li>[x] <strong>frida-dexdump</strong> - è‡ªåŠ¨åŒ– DEX dumper (<a href="https://github.com/hluwa/frida-dexdump">GitHub</a>)</li>
<li>[x] <strong>ADB</strong> - è®¾å¤‡é€šä¿¡å·¥å…·</li>
<li>[x] <strong>Root æƒé™è®¾å¤‡</strong> æˆ–æ¨¡æ‹Ÿå™¨ (å¿…é¡»)</li>
</ul>
<h2># å¯é€‰å·¥å…·</h2>
<ul>
<li>â˜ <strong>FUPK3</strong> - é’ˆå¯¹ç‰¹å®šå£³çš„ä¸“ç”¨è„±å£³å·¥å…·</li>
<li>â˜ <strong>Youpk</strong> - è¾ƒæ–°çš„è„±å£³å·¥å…·</li>
<li>â˜ <strong>PKid/ApkTool-Plus</strong> - åŠ å›ºç±»å‹è¯†åˆ«å·¥å…·</li>
<li>â˜ <strong>MT ç®¡ç†å™¨</strong> - Android ç«¯ APK åˆ†æå·¥å…·</li>
<li>â˜ <strong>IDA Pro/Ghidra</strong> - Native å±‚åˆ†æ (SO åŠ å›ºæ—¶éœ€è¦)</li>
</ul>
<hr />
<h1># å‰ç½®æ¡ä»¶</h1>
<p>åœ¨å¼€å§‹å‰è¯·ç¡®è®¤ï¼š</p>
<p>âœ… <strong>è®¾å¤‡å·² Root</strong> å¹¶å®‰è£… Frida Server
âœ… <strong>äº†è§£ DEX æ–‡ä»¶åŸºæœ¬ç»“æ„</strong> (è‡³å°‘çŸ¥é“ magic number <code>0x6465780A</code>)
âœ… <strong>åº”ç”¨å·²å®‰è£…</strong>å¹¶èƒ½æ­£å¸¸å¯åŠ¨ (å³ä½¿æœ‰åè°ƒè¯•)
âœ… <strong>ç£ç›˜ç©ºé—´å……è¶³</strong> (è„±å£³å¯èƒ½äº§ç”Ÿå¤§é‡æ–‡ä»¶)</p>
<hr />
<h1># è§£å†³æ–¹æ¡ˆ</h1>
<h2># æ ¸å¿ƒåŸç†</h2>
<blockquote>
<p><strong>&quot;ä»£ç è¿è¡Œå¿…è§£å¯†&quot;</strong></p>
<p>æ— è®ºåŠ å›ºæŠ€æœ¯å¤šä¹ˆå¤æ‚ï¼ŒåŠ å¯†åçš„ä»£ç æœ€ç»ˆéƒ½å¿…é¡»åœ¨å†…å­˜ä¸­æ¢å¤æˆå¯æ‰§è¡Œçš„ DEX æ ¼å¼ï¼Œæ‰èƒ½è¢« ART æ‰§è¡Œã€‚è„±å£³çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨ä»£ç è¢«è§£å¯†åã€æ‰§è¡Œå‰çš„é‚£ä¸€åˆ»ï¼Œä»å†…å­˜ä¸­å°†å…¶ dump å‡ºæ¥ã€‚</strong></p>
</blockquote>
<hr />
<h2># ç¬¬ 1 æ­¥: è¯†åˆ«åŠ å›ºç±»å‹ ( 5-10 åˆ†é’Ÿ)</h2>
<p>ä¸åŒä»£é™…çš„åŠ å›ºæŠ€æœ¯éœ€è¦ä¸åŒçš„è„±å£³ç­–ç•¥ï¼Œå…ˆè¯†åˆ«ç›®æ ‡åº”ç”¨ä½¿ç”¨äº†ä»€ä¹ˆåŠ å›ºæŠ€æœ¯ã€‚</p>
<h3># æ–¹æ³• A: ä½¿ç”¨å·¥å…·å¿«é€Ÿè¯†åˆ«</h3>
<pre><code class="language-bash"># ä½¿ç”¨ PKid (ApkTool-Plus) æ£€æµ‹
# ä¸‹è½½: https://github.com/rover12421/ApkToolPlus
java -jar ApkToolPlus.jar -pkid target.apk

# è¾“å‡ºç¤ºä¾‹:
# [+] æ£€æµ‹åˆ°åŠ å›ºå‚å•†: è…¾è®¯ä¹å›º (Tencent Legu)
# [+] åŠ å›ºç±»å‹: ç¬¬äºŒä»£å£³ (æ–¹æ³•æŠ½å–)

</code></pre>
<h1>å¯ç–‘ç±»å:</h1>
<h1>com.tencent.StubShell.TxAppEntry (è…¾è®¯ä¹å›º)</h1>
<h1>com.secneo.apkwrapper.ApplicationWrapper (æ¢†æ¢† Security)</h1>
<h1>com.baidu.protect.StubApplication (ç™¾åº¦åŠ å›º)</h1>
<h1>2. æ£€æŸ¥ DEX æ–‡ä»¶å¤§å°</h1>
<p>unzip -l target.apk | grep classes.dex</p>
<h1>å¦‚æœ classes.dex &lt; 100KB ä¸” App åŠŸèƒ½å¤æ‚ï¼Œå¾ˆå¯èƒ½åŠ å£³</h1>
<h1>3. æ£€æŸ¥å¯ç–‘æ–‡ä»¶</h1>
<p>unzip -l target.apk | grep -E &quot;.dat|.bin|ijm_lib|secdata&quot;</p>
<h1>è¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«åŠ å¯†çš„åŸå§‹ DEX</h1>
<h1>4. æ£€æŸ¥ lib ç›®å½•ä¸­çš„å¯ç–‘ SO</h1>
<p>unzip -l target.apk | grep &quot;lib/.*.so&quot; | grep -E &quot;(exec|vmp|protect)&quot;</p>
<pre><code>| **ç¬¬ä¸€ä»£** | 2010-2015 | æ•´ä½“ DEX åŠ å¯† | æ—©æœŸçˆ±åŠ å¯†ã€360 | Application å…¥å£è¢«æ›¿æ¢ | (ç®€å•) |
| **ç¬¬äºŒä»£** | 2015-2018 | æ–¹æ³•æŠ½å– (Stolen Code) | è…¾è®¯ä¹å›ºã€é˜¿é‡Œèšå®‰å…¨ | å¤§é‡ç©ºæ–¹æ³•ã€libexec.so | (ä¸­ç­‰) |
| **ç¬¬ä¸‰ä»£** | 2018-2021 | æŒ‡ä»¤è™šæ‹ŸåŒ– (VMP) | æ¢†æ¢†VMPã€é¡¶è±¡ç§‘æŠ€ | è‡ªå®šä¹‰VMå¼•æ“ã€ç§æœ‰æŒ‡ä»¤ | (å›°éš¾) |
| **ç¬¬å››ä»£** | 2021-è‡³ä»Š | äº‘ç«¯+å¤šé‡ä¿æŠ¤ | è…¾è®¯å¾¡å®‰å…¨ã€é˜¿é‡Œäº‘ | äº‘ç«¯ä¸‹å‘ä»£ç ã€å¤šå±‚åŠ å£³ | (æéš¾) |

- --

## # ç¬¬ 2 æ­¥: é€‰æ‹©è„±å£³ç­–ç•¥ ( 5 åˆ†é’Ÿ)

æ ¹æ®è¯†åˆ«å‡ºçš„åŠ å›ºç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„è„±å£³æ–¹æ³•ï¼š

### ç¬¬ä¸€ä»£å£³ (æ•´ä½“åŠ å¯†)
* *ç­–ç•¥**: Hook ClassLoaderï¼Œåœ¨ DEX åŠ è½½æ—¶ dump
* *æ¨èå·¥å…·**: æ‰‹å†™ Frida è„šæœ¬æˆ– frida-dexdump
* *æˆåŠŸç‡**: 95%+

### ç¬¬äºŒä»£å£³ (æ–¹æ³•æŠ½å–)
* *ç­–ç•¥**: Hook ArtMethod çš„ invokeï¼Œåœ¨æ–¹æ³•é¦–æ¬¡è°ƒç”¨æ—¶ dump CodeItem
* *æ¨èå·¥å…·**: FART æŠ€æœ¯ (Frida ART Hook) + frida-dexdump
* *æˆåŠŸç‡**: 80%+ (å–å†³äºä»£ç è¦†ç›–ç‡)

### ç¬¬ä¸‰ä»£å£³ (è™šæ‹ŸåŒ–)
* *ç­–ç•¥**: Hook è™šæ‹Ÿæœºå¼•æ“ï¼Œè·å–æŒ‡ä»¤æµ + æ˜ å°„è¡¨é€†å‘
* *æ¨èå·¥å…·**: IDA Pro + è‡ªå®šä¹‰è„šæœ¬
* *æˆåŠŸç‡**: 50% (éœ€è¦æ·±å…¥åˆ†æè™šæ‹Ÿæœºå®ç°)

### ç¬¬å››ä»£å£³ (äº‘ç«¯)
* *ç­–ç•¥**: ç½‘ç»œæŠ“åŒ… + å†…å­˜æ‰«æ + å¤šå±‚ dump
* *æ¨èå·¥å…·**: mitmproxy + frida-dexdump + è‡ªå®šä¹‰è„šæœ¬
* *æˆåŠŸç‡**: 30% (éƒ¨åˆ†é€»è¾‘å¯èƒ½æ— æ³•è·å–)

- --

## # ç¬¬ 3 æ­¥: æ‰§è¡Œè„±å£³ ( 10-60 åˆ†é’Ÿ)

ä»¥ä¸‹æä¾›é’ˆå¯¹ä¸åŒä»£é™…çš„è„±å£³è„šæœ¬ã€‚

### æ–¹æ³• A: ä½¿ç”¨ frida-dexdump (é€šç”¨ï¼Œæ¨èé¦–é€‰)

```bash
# 1. å¯åŠ¨ Frida Server
adb push frida-server /data/local/tmp/
adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;
adb shell &quot;/data/local/tmp/frida-server &amp;&quot;

# 2. å®‰è£… frida-dexdump
pip3 install frida-dexdump

# 3. è¿è¡Œè„±å£³ (Spawn æ¨¡å¼ï¼Œåœ¨ App å¯åŠ¨æ—¶æ‹¦æˆª)
python3 -m frida_dexdump -U -f com.target.app -o ./output

# è¾“å‡ºç¤ºä¾‹:
# [+] Hooking ClassLoader...
# [+] Dumped DEX: /output/com.target.app_1234567890.dex (5.2 MB)
# [+] Dumped DEX: /output/com.target.app_0987654321.dex (1.8 MB)
# [+] Total: 2 DEX files dumped

# 4. å°† DEX æ–‡ä»¶æ‹‰å–åˆ°æœ¬åœ°
adb pull /data/data/com.target.app/files/*.dex ./dumped_dex/

</code></pre>
<ul>
<li><code>-o ./output</code>: è¾“å‡ºç›®å½•</li>
</ul>
<hr />
<h3># æ–¹æ³• B: æ‰‹å†™ Hook è„šæœ¬ (ç¬¬ä¸€ä»£å£³)</h3>
<p>é€‚ç”¨äºç®€å•çš„æ•´ä½“åŠ å¯†å£³ã€‚</p>
<pre><code class="language-javascript">// unpacker_gen1.js - ç¬¬ä¸€ä»£å£³é€šç”¨è„šæœ¬

Java.perform(function () {
  console.log(&quot;[+] å¼€å§‹ Hook ClassLoader...&quot;);

  // æ‹¦æˆª 1: DexClassLoader (æœ€å¸¸è§)
  var DexClassLoader = Java.use(&quot;dalvik.system.DexClassLoader&quot;);
  DexClassLoader.$init.implementation = function (
    dexPath,
    optimizedDirectory,
    librarySearchPath,
    parent
  ) {
    console.log(&quot;[+] DexClassLoader åŠ è½½ DEX:&quot;);
    console.log(&quot; è·¯å¾„: &quot; + dexPath);

    // å°è¯•å¤åˆ¶ DEX æ–‡ä»¶
    if (dexPath &amp;&amp; dexPath.indexOf(&quot;/data/data/&quot;) !== -1) {
      try {
        var File = Java.use(&quot;java.io.File&quot;);
        var FileInputStream = Java.use(&quot;java.io.FileInputStream&quot;);
        var FileOutputStream = Java.use(&quot;java.io.FileOutputStream&quot;);

        var srcFile = File.$new(dexPath);
        if (srcFile.exists()) {
          var timestamp = Date.now();
          var dstPath =
            &quot;/data/data/com.target.app/dumped_&quot; + timestamp + &quot;.dex&quot;;
          var dstFile = File.$new(dstPath);

          var fis = FileInputStream.$new(srcFile);
          var fos = FileOutputStream.$new(dstFile);

          var buffer = Java.array(&quot;byte&quot;, [1024]);
          var len;
          while ((len = fis.read(buffer)) &gt; 0) {
            fos.write(buffer, 0, len);
          }

          fis.close();
          fos.close();

          console.log(&quot;âœ“ [å·²å¯¼å‡º] &quot; + dstPath);
        }
      } catch (e) {
        console.log(&quot;[-] å¤åˆ¶å¤±è´¥: &quot; + e);
      }
    }

    return this.$init(dexPath, optimizedDirectory, librarySearchPath, parent);
  };

  // Hook 2: InMemoryDexClassLoader (å†…å­˜åŠ è½½)
  try {
    var InMemoryDexClassLoader = Java.use(
      &quot;dalvik.system.InMemoryDexClassLoader&quot;
    );
    InMemoryDexClassLoader.$init.overload(
      &quot;java.nio.ByteBuffer&quot;,
      &quot;java.lang.ClassLoader&quot;
    ).implementation = function (byteBuffer, classLoader) {
      console.log(&quot;[+] InMemoryDexClassLoader åŠ è½½å†…å­˜ DEX&quot;);

      // ä» ByteBuffer æå– DEX
      try {
        var remaining = byteBuffer.remaining();
        console.log(&quot; DEX å¤§å°: &quot; + remaining + &quot; bytes&quot;);

        // è·å–å­—èŠ‚æ•°ç»„
        var bytes = Java.array(&quot;byte&quot;, [remaining]);
        byteBuffer.get(bytes);

        // å†™å…¥æ–‡ä»¶
        var timestamp = Date.now();
        var dstPath = &quot;/data/data/com.target.app/memory_&quot; + timestamp + &quot;.dex&quot;;
        var File = Java.use(&quot;java.io.File&quot;);
        var FileOutputStream = Java.use(&quot;java.io.FileOutputStream&quot;);

        var dstFile = File.$new(dstPath);
        var fos = FileOutputStream.$new(dstFile);
        fos.write(bytes);
        fos.close();

        console.log(&quot;âœ“ [å·²å¯¼å‡º] &quot; + dstPath);

        // é‡ç½® ByteBuffer ä½ç½®
        byteBuffer.position(0);
      } catch (e) {
        console.log(&quot;[-] å¯¼å‡ºå¤±è´¥: &quot; + e);
      }

      return this.$init(byteBuffer, classLoader);
    };
  } catch (e) {
    console.log(&quot;[-] InMemoryDexClassLoader ä¸å­˜åœ¨ (Android &lt; 8.0)&quot;);
  }

  console.log(&quot;[+] Hook å®Œæˆï¼Œç­‰å¾… DEX åŠ è½½...&quot;);
});
</code></pre>
<h1>Attach æ¨¡å¼</h1>
<p>frida -U com.target.app -l unpacker_gen1.js</p>
<pre><code>
```javascript
// unpacker_fart.js - FART (Frida-ART-Hook) è„šæœ¬

// è­¦å‘Š: æ­¤è„šæœ¬éœ€è¦æ·±å…¥ç†è§£ ART å†…éƒ¨æœºåˆ¶ï¼Œä¸åŒ Android ç‰ˆæœ¬å¯èƒ½éœ€è¦è°ƒæ•´åç§»

var artMethodInvokeAddr = null;

// æ ¹æ® Android ç‰ˆæœ¬æŸ¥æ‰¾ ArtMethod::Invoke ç¬¦å·
var symbols = [
&quot;_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjjPNS_6JValueEPKc&quot;, // Android 7.0+
&quot;_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjmPNS_6JValueEPKc&quot;, // Android 8.0+
];

for (var i = 0; i &lt; symbols.length; i++) {
artMethodInvokeAddr = Module.findExportByName(&quot;libart.so&quot;, symbols[i]);
if (artMethodInvokeAddr) {
console.log(&quot;[+] æ‰¾åˆ° ArtMethod::Invoke: &quot; + artMethodInvokeAddr);
break;
}
}

if (!artMethodInvokeAddr) {
console.log(&quot;[-] æœªæ‰¾åˆ° ArtMethod::Invokeï¼Œæ— æ³•ç»§ç»­&quot;);
} else {
Interceptor.attach(artMethodInvokeAddr, {
onEnter: function(args) {
var artMethod = args[0];

// è¯»å– ArtMethod ç»“æ„ä¸­çš„ CodeItem (åç§»å› ç‰ˆæœ¬è€Œå¼‚)
// è¿™é‡Œä»¥ Android 7.0 ä¸ºä¾‹ï¼Œå®é™…ä½¿ç”¨éœ€è¦æ ¹æ®ç‰ˆæœ¬è°ƒæ•´
try {
// è·å–æ–¹æ³•å (é€šè¿‡ PrettyMethod)
var prettyMethodAddr = Module.findExportByName(&quot;libart.so&quot;, &quot;_ZN3art9ArtMethod12PrettyMethodEv&quot;);
if (prettyMethodAddr) {
var prettyMethod = new NativeFunction(prettyMethodAddr, 'pointer', ['pointer']);
var methodName = prettyMethod(artMethod).readCString();

// åªå…³æ³¨ App è‡ªèº«æ–¹æ³•ï¼Œå¿½ç•¥ç³»ç»Ÿæ–¹æ³•
if (methodName &amp;&amp; methodName.indexOf(&quot;com.target.app&quot;) !== -1) {
console.log(&quot;[+] è°ƒç”¨æ–¹æ³•: &quot; + methodName);

// å°è¯•è·å– CodeItem
// æ³¨æ„: CodeItem åç§»åœ¨ä¸åŒç‰ˆæœ¬ä¸­ä¸åŒ
// Android 7.0: offset 24
// Android 8.0+: offset 16
var codeItemOffset = 24; // éœ€è¦æ ¹æ®å®é™…ç‰ˆæœ¬è°ƒæ•´
var codeItemPtr = artMethod.add(codeItemOffset).readPointer();

if (codeItemPtr &amp;&amp; !codeItemPtr.isNull()) {
// è¯»å– CodeItem ç»“æ„
var registersSize = codeItemPtr.readU16();
var insSize = codeItemPtr.add(2).readU16();
var outsSize = codeItemPtr.add(4).readU16();
var triesSize = codeItemPtr.add(6).readU16();
var insnsSize = codeItemPtr.add(12).readU32();

if (insnsSize &gt; 0 &amp;&amp; insnsSize &lt; 100000) {
console.log(&quot; æ‰¾åˆ° CodeItem: insnsSize = &quot; + insnsSize);

// å¯¼å‡ºå­—èŠ‚ç 
var insnsPtr = codeItemPtr.add(16);
var codeData = Memory.readByteArray(insnsPtr, insnsSize * 2);

// ä¿å­˜åˆ°æ–‡ä»¶
var safeMethodName = methodName.replace(/[^a-zA-Z0-9]/g, &quot;_&quot;);
var filename = &quot;/data/data/com.target.app/code_&quot; + safeMethodName + &quot;.bin&quot;;
var file = new File(filename, &quot;wb&quot;);
file.write(codeData);
file.close();

console.log(&quot;âœ“ [å·²å¯¼å‡º CodeItem] &quot; + filename);
}
}
}
}
} catch (e) {
// å¿½ç•¥è¯»å–é”™è¯¯
}
}
});

console.log(&quot;[+] FART Hook å·²æ¿€æ´»ï¼Œå¼€å§‹ç›‘æ§æ–¹æ³•è°ƒç”¨...&quot;);
}

</code></pre>
<ul>
<li>åªèƒ½ dump <strong>è¢«è°ƒç”¨è¿‡çš„æ–¹æ³•</strong>ï¼Œæœªè§¦å‘çš„æ–¹æ³•æ— æ³•æ¢å¤</li>
</ul>
<hr />
<h3># æ–¹æ³• D: å†…å­˜æ‰«æ (é€šç”¨å…œåº•æ–¹æ¡ˆ)</h3>
<p>å½“å…¶ä»–æ–¹æ³•å¤±æ•ˆæ—¶ï¼Œå¯ä»¥å®šæœŸæ‰«æå†…å­˜ä¸­çš„ DEX magic numberã€‚</p>
<pre><code class="language-javascript">// unpacker_memscan.js - å†…å­˜æ‰«æè„šæœ¬

function scanMemoryForDex() {
  console.log(&quot;[+] å¼€å§‹æ‰«æå†…å­˜ä¸­çš„ DEX æ–‡ä»¶...&quot;);

  var ranges = Process.enumerateRanges(&quot;r--&quot;); // ä»…æ‰«æå¯è¯»åŒºåŸŸ
  var found = 0;

  ranges.forEach(function (range) {
    try {
      // DEX magic: &quot;dex\n&quot; = 0x6465780A
      var pattern = &quot;64 65 78 0a&quot;;

      Memory.scan(range.base, range.size, pattern, {
        onMatch: function (address, size) {
          console.log(&quot;[+] å‘ç°æ½œåœ¨ DEX: &quot; + address);

          try {
            // è¯»å– DEX æ–‡ä»¶å¤§å° (åç§» 32 å­—èŠ‚å¤„)
            var dexSize = address.add(32).readU32();

            // åˆç†æ€§æ£€æŸ¥
            if (dexSize &gt; 0x1000 &amp;&amp; dexSize &lt; 50 * 1024 * 1024) {
              console.log(&quot; DEX Size: &quot; + (dexSize / 1024).toFixed(2) + &quot; KB&quot;);

              // Dump DEX
              var dexData = Memory.readByteArray(address, dexSize);
              var filename =
                &quot;/data/data/com.target.app/memdump_&quot; +
                address.toString().replace(&quot;0x&quot;, &quot;&quot;) +
                &quot;.dex&quot;;
              var file = new File(filename, &quot;wb&quot;);
              file.write(dexData);
              file.close();

              console.log(&quot;âœ“ [Dumped] &quot; + filename);
              found++;
            }
          } catch (e) {
            // è¯»å–å¤±è´¥ï¼Œè·³è¿‡
          }
        },
        onComplete: function () {},
      });
    } catch (e) {
      // å¿½ç•¥æ— æ³•è®¿é—®çš„å†…å­˜åŒºåŸŸ
    }
  });

  console.log(&quot;[+] æ‰«æå®Œæˆï¼Œæ‰¾åˆ° &quot; + found + &quot; ä¸ª DEX æ–‡ä»¶&quot;);
}

// æ¯ 5 ç§’æ‰«æä¸€æ¬¡
setInterval(function () {
  scanMemoryForDex();
}, 5000);

console.log(&quot;[+] å†…å­˜æ‰«æå·²å¯åŠ¨&quot;);
</code></pre>
<p>adb pull /data/data/com.target.app/ ./dumped_files/</p>
<h1>2. æŸ¥çœ‹æå–åˆ°çš„ DEX æ–‡ä»¶</h1>
<p>ls -lh ./dumped_files/*.dex</p>
<h1>è¾“å‡ºç¤ºä¾‹:</h1>
<h1>-rw-r--r-- 1 user user 5.2M dumped_1234567890.dex</h1>
<h1>-rw-r--r-- 1 user user 1.8M dumped_0987654321.dex</h1>
<h1>3. éªŒè¯ DEX æ–‡ä»¶å®Œæ•´æ€§</h1>
<p>xxd ./dumped_files/dumped_1234567890.dex | head -n 2</p>
<h1>åº”è¯¥çœ‹åˆ° DEX magic: 64 65 78 0a (dex\n)</h1>
<h1>4. ä½¿ç”¨ Jadx æ‰“å¼€éªŒè¯</h1>
<p>jadx ./dumped_files/dumped_1234567890.dex</p>
<h1>å¦‚æœèƒ½æ­£å¸¸åç¼–è¯‘ï¼Œè¡¨ç¤ºè„±å£³æˆåŠŸ</h1>
<pre><code>
### å¸¸è§éœ€è¦ä¿®å¤çš„æƒ…å†µ:

1. **æ–¹æ³•ä½“è¢« NOP å¡«å……**:
- ç—‡çŠ¶: Jadx åç¼–è¯‘åçœ‹åˆ°å¤§é‡ç©ºæ–¹æ³•æˆ–åªæœ‰ `return` çš„æ–¹æ³•
- åŸå› : å£³ç”¨å ä½ç¬¦æ›¿æ¢äº†çœŸå®ä»£ç 
- è§£å†³: å¦‚æœç”¨ FART dump äº† CodeItemï¼Œéœ€è¦æ‰‹åŠ¨æ›¿æ¢å›å»

2. **å­—ç¬¦ä¸²æ± æŸå**:
- ç—‡çŠ¶: åç¼–è¯‘åå­—ç¬¦ä¸²æ˜¾ç¤ºä¸ºä¹±ç æˆ–ç¼ºå¤±
- è§£å†³: ä½¿ç”¨ `dex-repair` å·¥å…·é‡å»ºå­—ç¬¦ä¸²æ± 

3. **ç±»/æ–¹æ³•ç´¢å¼•é”™ä¹±**:
- ç—‡çŠ¶: æ–¹æ³•è°ƒç”¨å…³ç³»ä¸æ­£ç¡®
- è§£å†³: ä½¿ç”¨ `smali/baksmali` é‡æ–°ç»„è£…

### è‡ªåŠ¨åŒ–ä¿®å¤å·¥å…·

```bash
# ä½¿ç”¨ dex-repair (å¼€æºå·¥å…·)
git clone https://github.com/F8LEFT/dex-repair
cd dex-repair
python3 repair.py ./dumped_files/dumped_1234567890.dex -o ./fixed.dex

# éªŒè¯ä¿®å¤ç»“æœ
jadx ./fixed.dex

</code></pre>
<h1>è¿™éœ€è¦ä½¿ç”¨ DexPatcher æˆ–è‡ªå®šä¹‰è„šæœ¬</h1>
<h1>2. åæ±‡ç¼– DEX</h1>
<p>baksmali d dumped_1234567890.dex -o ./smali_output</p>
<h1>3. æŸ¥æ‰¾ç©ºæ–¹æ³•å¹¶æ›¿æ¢</h1>
<h1>åœ¨ smali_output ä¸­ï¼Œæ‰¾åˆ°æ–¹æ³•ä½“ä¸ºç©ºçš„ .smali æ–‡ä»¶</h1>
<h1>å°†å¯¼å‡ºçš„ CodeItem åæ±‡ç¼–åçš„å†…å®¹å¤åˆ¶è¿›å»</h1>
<h1>4. é‡æ–°ç»„è£…</h1>
<p>smali a ./smali_output -o ./repacked.dex</p>
<h1>5. éªŒè¯</h1>
<p>jadx ./repacked.dex</p>
<pre><code>
â”‚ 1. DEX åŠ å¯† â”‚ å°† classes.dex åŠ å¯†ä¸º encrypted.dat
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å£³ä»£æ›¿æ¢ â”‚ ç”¨å£³ DEX æ›¿æ¢ classes.dex
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. é‡æ–°æ‰“åŒ…ç­¾å â”‚ ç”ŸæˆåŠ å›ºåçš„ APK
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿è¡Œæ—¶è§£å¯†æµç¨‹:
Application.onCreate()
â†“
å£³ä»£ç æ‰§è¡Œ
â†“
è§£å¯† encrypted.dat
â†“
DexClassLoader.load(è§£å¯†åçš„ DEX)
â†“
è·³è½¬åˆ°åŸå§‹ Application å…¥å£

</code></pre>
<p>â†“
å£³ä»£ç è¿è¡Œ
â†“
è§£å¯†åŸå§‹ DEX â† Hook ç‚¹ 1: ClassLoader
â†“
ART åŠ è½½ DEX åˆ°å†…å­˜ â† Hook ç‚¹ 2: libart.so
â†“
ç¼–è¯‘ä¸º OAT æ ¼å¼
â†“
ç±»åˆå§‹åŒ–å’Œæ–¹æ³•è°ƒç”¨ â† Hook ç‚¹ 3: ArtMethod::Invoke
â†“
åŸå§‹ä»£ç æ‰§è¡Œ</p>
<pre><code>
* *å¯èƒ½åŸå› **:

1. å£³æ£€æµ‹åˆ° Frida å¹¶æå‰é€€å‡º
2. Hook æ—¶æœºå¤ªæ™šï¼ŒDEX å·²ç»åŠ è½½å®Œæ¯•
3. ä½¿ç”¨äº†éæ ‡å‡†çš„åŠ è½½æ–¹å¼

* *è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. å…ˆç»•è¿‡ Frida æ£€æµ‹
frida -U -f com.target.app -l bypass_frida_detection.js --no-pause

# ç­‰å¾…åº”ç”¨å¯åŠ¨åï¼Œå†è¿è¡Œ dexdump (åˆ†ä¸¤æ­¥)
frida -U com.target.app -l frida_dexdump_manual.js

# 2. å°è¯•æ›´æ—©çš„æ‹¦æˆªç‚¹
# ä¿®æ”¹ frida-dexdump æºç ï¼Œåœ¨ libc.so fork() ä¹‹å‰å°±æ³¨å…¥

# 3. ä½¿ç”¨å†…å­˜æ‰«æä½œä¸ºå…œåº•æ–¹æ¡ˆ
frida -U com.target.app -l unpacker_memscan.js

</code></pre>
<ol>
<li>Dump çš„æ—¶æœºä¸å¯¹ï¼ŒDEX è¿˜æœªå®Œå…¨è§£å¯†</li>
<li>DEX æ–‡ä»¶è¢«æˆªæ–­</li>
<li>å†…å­˜ä¸­çš„ DEX å·²è¢«ä¿®æ”¹ (å¦‚æ–¹æ³•æŠ½å–)</li>
</ol>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>:</li>
</ul>
<pre><code class="language-bash"># 1. æ£€æŸ¥ DEX æ–‡ä»¶å¤´
xxd dumped.dex | head -n 5
# å‰ 4 å­—èŠ‚å¿…é¡»æ˜¯: 64 65 78 0a (dex\n)
# å 4 å­—èŠ‚æ˜¯ç‰ˆæœ¬å·: 30 33 35 00 (035) æˆ– 30 33 38 00 (038)

# 2. éªŒè¯æ–‡ä»¶å¤§å°
# åç§» 32 å­—èŠ‚å¤„è®°å½•æ–‡ä»¶å¤§å°
dd if=dumped.dex bs=1 skip=32 count=4 | xxd
# ä¸å®é™…æ–‡ä»¶å¤§å°å¯¹æ¯”

# 3. å°è¯•ä¿®å¤å·¥å…·
dex-repair dumped.dex -o fixed.dex

# 4. å¦‚æœæ˜¯æ–¹æ³•æŠ½å–å£³ï¼Œéœ€è¦ç”¨ FART è¡¥å…¨æ–¹æ³•ä½“

</code></pre>
<ol>
<li>ArtMethod ç»“æ„åç§»é”™è¯¯ (Android ç‰ˆæœ¬ä¸åŒ¹é…)</li>
<li>è¯»å–äº†æ— æ•ˆçš„å†…å­˜åœ°å€</li>
<li>Hook ç¬¦å·é”™è¯¯</li>
</ol>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>:</li>
</ul>
<pre><code class="language-javascript">// 1. æ·»åŠ å¼‚å¸¸ä¿æŠ¤
Interceptor.attach(artMethodInvokeAddr, {
  onEnter: function (args) {
    try {
      var artMethod = args[0];
      // ... ä½ çš„ä»£ç 
    } catch (e) {
      console.log(&quot;[-] æ•è·å¼‚å¸¸: &quot; + e);
      // ä¸è¦é‡æ–°æŠ›å‡ºï¼Œé¿å…å´©æºƒ
    }
  },
});

// 2. æ ¹æ® Android ç‰ˆæœ¬åŠ¨æ€è°ƒæ•´åç§»
var androidVersion = Java.androidVersion;
var codeItemOffset;
if (androidVersion &gt;= 10) {
  codeItemOffset = 16; // Android 10+
} else if (androidVersion &gt;= 8) {
  codeItemOffset = 20; // Android 8-9
} else {
  codeItemOffset = 24; // Android 7
}

// 3. æ£€æŸ¥æŒ‡é’ˆæœ‰æ•ˆæ€§
if (codeItemPtr &amp;&amp; !codeItemPtr.isNull()) {
  // å°è¯•è¯»å–å‰å…ˆæ£€æŸ¥æ˜¯å¦å¯è¯»
  try {
    Process.findRangeByAddress(codeItemPtr); // ä¼šæŠ›å‡ºå¼‚å¸¸å¦‚æœåœ°å€æ— æ•ˆ
    var insnsSize = codeItemPtr.add(12).readU32();
    // ...
  } catch (e) {
    console.log(&quot;[-] æ— æ•ˆåœ°å€: &quot; + codeItemPtr);
  }
}
</code></pre>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>:</li>
</ul>
<pre><code class="language-bash"># 1. ä½¿ç”¨ FART æŠ€æœ¯ (è§ç¬¬ 3 æ­¥æ–¹æ³• C)
# å¿…é¡»è§¦å‘æ‰€æœ‰å…³é”®æ–¹æ³•è°ƒç”¨æ‰èƒ½å®Œæ•´å¯¼å‡º

# 2. æ‰‹åŠ¨è§¦å‘æ–¹æ³•è°ƒç”¨
# å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼Œéå†æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•å¹¶è°ƒç”¨

# 3. ä½¿ç”¨ä¸“ç”¨å·¥å…·
# FUPK3ã€Youpk ç­‰å·¥å…·å·²å†…ç½®æ–¹æ³•ä¸»åŠ¨è°ƒç”¨é€»è¾‘

</code></pre>
<p>Java.enumerateLoadedClasses({
onMatch: function(className) {
if (className.indexOf(&quot;com.target.app&quot;) !== -1) {
try {
var clazz = Java.use(className);
var methods = clazz.class.getDeclaredMethods();</p>
<p>methods.forEach(function(method) {
try {
// å°è¯•è°ƒç”¨é™æ€æ–¹æ³• (ä¼ ç©ºå‚æ•°)
console.log(&quot;[+] å°è¯•è°ƒç”¨: &quot; + method.getName());
method.invoke(null, []);
} catch (e) {
// å¿½ç•¥è°ƒç”¨å¤±è´¥
}
});
} catch (e) {}
}
},
onComplete: function() {
console.log(&quot;[+] æ–¹æ³•è§¦å‘å®Œæˆ&quot;);
}
});</p>
<p>});</p>
<pre><code>
| é¡¹ç›® | è¯´æ˜ |
|------|------|
| [Recipe | ç»•è¿‡ App å¯¹ Frida çš„æ£€æµ‹](#section-8) - è„±å£³å‰é€šå¸¸éœ€è¦å…ˆè¿‡åè°ƒè¯• |
| [Recipe | æŠ“åŒ…åˆ†æ Android åº”ç”¨çš„ç½‘ç»œæµé‡](#section-3) - è„±å£³åæŠ“åŒ…åˆ†æåŠ å¯†é€»è¾‘ |
| [Recipe | SO æ··æ·†ä¸åæ··æ·†](#section-16) - Native å±‚åŠ å›ºçš„å¤„ç† |


## # å·¥å…·æ·±å…¥
- [Frida å†…éƒ¨åŸç†](#section-41) - ç†è§£ Frida Hook æœºåˆ¶
- [Unidbg ä½¿ç”¨æŒ‡å—](#section-44) - ä»¿çœŸæ‰§è¡Œ Native è§£å¯†å‡½æ•°

## # æ¡ˆä¾‹åˆ†æ
- [æ¡ˆä¾‹: æŸéŸ³ä¹ App çš„åŠ å›ºåˆ†æ](#section-51)

## # å‚è€ƒèµ„æ–™
- [DEX æ–‡ä»¶æ ¼å¼è¯¦è§£](#section-62)
- [ART è¿è¡Œæ—¶æœºåˆ¶](#section-65)

- --

# # å¿«é€Ÿå‚è€ƒ

## # åŠ å›ºæ£€æµ‹é€ŸæŸ¥è¡¨

| æ£€æµ‹é¡¹ | å‘½ä»¤ | å¯ç–‘ç‰¹å¾ |
|--------|------|----------|
| **Application å…¥å£** | `unzip -p app.apk AndroidManifest.xml \| grep android:name` | `StubShell`, `ApplicationWrapper`, `StubApplication` |
| **DEX æ–‡ä»¶å¤§å°** | `unzip -l app.apk \| grep classes.dex` | &lt; 100 KB (å¤æ‚åº”ç”¨) |
| **åŠ å¯†æ•°æ®æ–‡ä»¶** | `unzip -l app.apk \| grep -E &quot;\.dat\|\.bin&quot;` | `assets/` ä¸‹çš„ .dat/.bin æ–‡ä»¶ |
| **å¯ç–‘ SO åº“** | `unzip -l app.apk \| grep &quot;lib/.*\.so&quot;` | `libexec.so`, `libvmp.so`, `libprotect.so` |
| **ä½¿ç”¨ PKid** | `java -jar ApkToolPlus.jar -pkid app.apk` | ç›´æ¥è¾“å‡ºåŠ å›ºå‚å•† |

## # å¸¸ç”¨è„±å£³å‘½ä»¤

```bash
# 1. ä½¿ç”¨ frida-dexdump (æ¨è)
python3 -m frida_dexdump -U -f com.target.app -o ./output

# 2. æ‰‹å†™è„šæœ¬ (Spawn æ¨¡å¼)
frida -U -f com.target.app -l unpacker.js --no-pause

# 3. å†…å­˜æ‰«æ
frida -U com.target.app -l memscan.js

# 4. æ‹‰å–å¯¼å‡ºæ–‡ä»¶
adb pull /data/data/com.target.app/ ./dumped/

# 5. éªŒè¯ DEX æ–‡ä»¶
xxd dumped.dex | head -n 2 # æ£€æŸ¥ magic number
jadx dumped.dex # å°è¯•åç¼–è¯‘

</code></pre>
<p>| <strong>frida-dexdump</strong> | è‡ªåŠ¨åŒ– DEX dumper | <a href="https://github.com/hluwa/frida-dexdump">GitHub</a> |
| <strong>FUPK3</strong> | é’ˆå¯¹ç‰¹å®šå£³çš„è„±å£³æœº | <a href="https://github.com/F8LEFT/FUPK3">GitHub</a> |
| <strong>Youpk</strong> | è¾ƒæ–°çš„è„±å£³å·¥å…· | <a href="https://github.com/Youlor/Youpk">GitHub</a> |
| <strong>PKid</strong> | åŠ å›ºè¯†åˆ«å·¥å…· | <a href="https://github.com/rover12421/ApkToolPlus">GitHub</a> |
| <strong>dex-repair</strong> | DEX æ–‡ä»¶ä¿®å¤å·¥å…· | <a href="https://github.com/F8LEFT/dex-repair">GitHub</a> |</p>
<hr />
<p><strong>ğŸ’¡ æç¤º</strong>: è„±å£³æ˜¯ä¸€ä¸ªéœ€è¦è€å¿ƒå’Œç»éªŒçš„è¿‡ç¨‹ã€‚å¦‚æœä¸€ç§æ–¹æ³•ä¸å¥æ•ˆï¼Œå°è¯•ç»„åˆå¤šç§æŠ€æœ¯ã€‚è®°ä½ï¼Œ<strong>ä»£ç è¿è¡Œå¿…è§£å¯†</strong> - åªè¦åº”ç”¨èƒ½æ­£å¸¸è¿è¡Œ,ç†è®ºä¸Šå°±èƒ½è„±å£³ã€‚</p>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-15">
                                                <h2>15. R13: Frida Unpacking & SO Fixing</h2>
                                                <h1>R13: Recipe: ä½¿ç”¨ Frida è„±å£³åŠ å›º App å¹¶ä¿®å¤ SO æ–‡ä»¶</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p><strong>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>ç”¨ jadx æ‰“å¼€ APKï¼Œå‘ç°ä»£ç è¢«æ··æ·†æˆ–çœ‹ä¸åˆ°å…³é”®é€»è¾‘</li>
<li>ğŸ›¡ï¸ APK ä½¿ç”¨äº†åŠ å›ºï¼ˆåŠ å£³ï¼‰ä¿æŠ¤ï¼Œæ— æ³•é™æ€åˆ†æ</li>
<li>ğŸ“¦ SO æ–‡ä»¶è¢«åŠ å¯†ï¼ŒIDA Pro æ— æ³•æ­£ç¡®åŠ è½½</li>
<li>ä½ æƒ³è·å– App è¿è¡Œæ—¶çœŸæ­£çš„ DEX æ–‡ä»¶</li>
<li>ğŸ§© éœ€è¦åˆ†æ Native å±‚ä»£ç ï¼Œä½† SO æ–‡ä»¶å·²è¢«åŠ å£³</li>
</ul>
<p><strong>æœ¬é…æ–¹æ•™ä½ </strong>ï¼šä½¿ç”¨ Frida åŠ¨æ€è„±å£³åŠ å›º Appã€Dump å†…å­˜ä¸­çš„ DEX å’Œ SO æ–‡ä»¶ã€ä¿®å¤æ–‡ä»¶æ ¼å¼ä»¥ä¾›åˆ†æã€‚</p>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>åŠ¨æ€è„±å£³ï¼šåœ¨è¿è¡Œæ—¶è·å–å·²è§£å¯†çš„ä»£ç </strong></p>
<ul>
<li>åŠ å£³åªæ˜¯é™æ€ä¿æŠ¤ï¼Œè¿è¡Œæ—¶å¿…ç„¶ä¼šè§£å¯†</li>
<li>Frida å¯ä»¥åœ¨ DEX/SO åŠ è½½æ—¶ dump å†…å­˜</li>
<li>ä¿®å¤æ–‡ä»¶æ ¼å¼åå³å¯ç”¨ä¼ ç»Ÿå·¥å…·åˆ†æ</li>
<li>ç»•è¿‡æ‰€æœ‰åŠ å›ºæ–¹æ¡ˆçš„é€šç”¨æ–¹æ³•</li>
</ul>
</blockquote>
<p><strong>é¢„è®¡ç”¨æ—¶</strong>: 30-60 åˆ†é’Ÿ</p>
<hr />
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<ul>
<li>â˜ <strong>Frida</strong> - åŠ¨æ€æ’æ¡©æ¡†æ¶</li>
<li>â˜ <strong>Android è®¾å¤‡</strong>ï¼ˆå·² Rootï¼‰æˆ–æ¨¡æ‹Ÿå™¨</li>
<li>â˜ <strong>Python 3.7+</strong> - è¿è¡Œ Frida è„šæœ¬</li>
<li>â˜ <strong>jadx-gui</strong> - åˆ†æè„±å£³åçš„ DEX</li>
</ul>
<h3>å¯é€‰å·¥å…·</h3>
<ul>
<li>â˜ <strong>IDA Pro / Ghidra</strong> - åˆ†æ SO æ–‡ä»¶</li>
<li>â˜ <strong>frida-dexdump</strong> - è‡ªåŠ¨åŒ– DEX è„±å£³</li>
<li>â˜ <strong>FRIDA-DEXDump</strong> - å¦ä¸€ä¸ªæµè¡Œçš„è„±å£³å·¥å…·</li>
<li>â˜ <strong>SoFixer</strong> - ä¿®å¤ dump çš„ SO æ–‡ä»¶</li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h3>âœ… ç¡®è®¤æ¸…å•</h3>
<pre><code class="language-bash"># 1. Frida æ­£å¸¸è¿è¡Œ
frida-ps -U

# 2. Python ç¯å¢ƒ
python3 --version

# 3. jadx-gui å·²å®‰è£…
jadx-gui --version

# 4. æ£€æŸ¥è®¾å¤‡ root çŠ¶æ€
adb shell su -c 'id'
# åº”è¯¥æ˜¾ç¤º uid=0(root)

</code></pre>
<h3>è¯†åˆ« App æ˜¯å¦åŠ å›º</h3>
<p><strong>æ–¹æ³• 1ï¼šjadx æŸ¥çœ‹</strong></p>
<p>æ‰“å¼€ APKï¼Œå¦‚æœçœ‹åˆ°ï¼š</p>
<ul>
<li>åªæœ‰å‡ ä¸ªç±»å’Œæ–¹æ³•</li>
<li>æœ‰ <code>StubApp</code>ã€<code>ProxyApplication</code> ç­‰å­—æ ·</li>
<li>MainActivity é€»è¾‘å¼‚å¸¸ç®€å•</li>
</ul>
<ul>
<li><strong>æ–¹æ³• 2ï¼šæŸ¥çœ‹ SO æ–‡ä»¶</strong></li>
</ul>
<pre><code class="language-bash"># è§£å‹ APK
unzip app.apk -d app_unzipped

# æŸ¥çœ‹ lib ç›®å½•
ls app_unzipped/lib/arm64-v8a/

# å¸¸è§åŠ å›ºå£³ SO æ–‡ä»¶å
# libjiagu.so (360åŠ å›º)
# libDexHelper.so (æ¢†æ¢†åŠ å›º)
# libtup.so (è…¾è®¯åŠ å›º)
# libexec.so (çˆ±åŠ å¯†)

</code></pre>
<h3>ç¬¬ 1 æ­¥ï¼šä½¿ç”¨ frida-dexdump è„±å£³ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<h4>1.1 å®‰è£… frida-dexdump</h4>
<pre><code class="language-bash"># å…‹éš†é¡¹ç›®
git clone https://github.com/hluwa/frida-dexdump.git
cd frida-dexdump

# å®‰è£…ä¾èµ–
pip3 install frida frida-tools

</code></pre>
<h1>-f: å¯åŠ¨åº”ç”¨</h1>
<h1>--no-pause: ä¸æš‚åœï¼Œç«‹å³è¿è¡Œ</h1>
<p>python3 main.py -U -f com.example.app</p>
<h1>è„šæœ¬ä¼šè‡ªåŠ¨ï¼š</h1>
<h1>1. å¯åŠ¨åº”ç”¨</h1>
<h1>2. Hook DEX åŠ è½½å‡½æ•°</h1>
<h1>3. å¯¼å‡ºæ‰€æœ‰å·²åŠ è½½çš„ DEX æ–‡ä»¶</h1>
<h1>4. ä¿å­˜åˆ°å½“å‰ç›®å½•</h1>
<pre><code>[DEXDump] Dumping DEX file: 0x7abc000000, size: 4562314
[DEXDump] Saved: com.example.app_classes.dex
[DEXDump] Found DEX: /data/app/.../base.apk!classes2.dex
[DEXDump] Dumping DEX file: 0x7abc500000, size: 2314567
[DEXDump] Saved: com.example.app_classes2.dex
[DEXDump] Total: 2 DEX files dumped

</code></pre>
<h1>ç„¶ååœ¨åº”ç”¨å†…è§¦å‘éœ€è¦åˆ†æçš„åŠŸèƒ½</h1>
<pre><code>
# ç”¨ jadx æ‰“å¼€
jadx-gui com.example.app_classes.dex

</code></pre>
<h3>ç¬¬ 2 æ­¥ï¼šä½¿ç”¨ FRIDA-DEXDumpï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰ï¼ˆ10 åˆ†é’Ÿï¼‰</h3>
<p>å¦‚æœ frida-dexdump ä¸å·¥ä½œï¼Œå¯ä»¥å°è¯• FRIDA-DEXDumpï¼š</p>
<pre><code class="language-bash"># å®‰è£…
git clone https://github.com/lasting-yang/frida_dump.git
cd frida_dump

# è¿è¡Œå‘½ä»¤
python3 dump_dex.py -U -f com.example.app

</code></pre>
<hr />
<h3>ç¬¬ 3 æ­¥ï¼šæ‰‹åŠ¨è„šæœ¬è„±å£³ï¼ˆé«˜çº§ï¼‰ï¼ˆ15 åˆ†é’Ÿï¼‰</h3>
<p>å¦‚æœè‡ªåŠ¨åŒ–å·¥å…·å¤±è´¥ï¼Œå¯ä»¥ç¼–å†™è‡ªå®šä¹‰ Frida è„šæœ¬ã€‚</p>
<h4>3.1 Hook OpenCommonï¼ˆé€‚ç”¨äº android 8.0+ï¼‰</h4>
<p><strong>dex_dump.js</strong>ï¼š</p>
<pre><code class="language-javascript">function dumpDex() {
  Java.perform(function () {
    console.log(&quot;[*] DEX Dumper started&quot;);

    // æŸ¥æ‰¾ libart.so
    var libart = Process.findModuleByName(&quot;libart.so&quot;);
    if (!libart) {
      console.log(&quot;[-] libart.so not found&quot;);
      return;
    }

    // Hook OpenCommon (android 8.0+)
    // ç¬¦å·åç§°å› ç‰ˆæœ¬è€Œå¼‚ï¼Œéœ€è¦ç”¨ nm æˆ– readelf ç¡®è®¤
    var OpenCommon = null;

    // å°è¯•å¸¸è§ç¬¦å·
    var symbols = [
      &quot;_ZN3art7DexFile10OpenCommonEPKhjS2_jRKNS_10OatDexFileEbbPS1_&quot;,
      &quot;_ZN3art7DexFile10OpenCommonEPKhmS2_jRKNS_10OatDexFileEbbPS1_NS_6Handle&quot;,
    ];

    for (var i = 0; i &lt; symbols.length; i++) {
      OpenCommon = Module.findExportByName(&quot;libart.so&quot;, symbols[i]);
      if (OpenCommon) {
        console.log(&quot;[+] Found OpenCommon:&quot;, OpenCommon);
        break;
      }
    }

    if (!OpenCommon) {
      console.log(&quot;[-] OpenCommon not found&quot;);
      return;
    }

    // Hook
    Interceptor.attach(OpenCommon, {
      onEnter: function (args) {
        // args[0] = base (DEX å†…å­˜åœ°å€)
        // args[1] = size (DEX æ–‡ä»¶å¤§å°)

        var base = args[0];
        var size = args[1].toInt32();

        console.log(&quot;[*] æ£€æµ‹åˆ° DEX!&quot;);
        console.log(&quot; åŸºå€: &quot; + base);
        console.log(&quot; å¤§å°: &quot; + size);

        // è¯»å– DEX æ–‡ä»¶å¤´ï¼ŒéªŒè¯é­”æ•°
        var magic = base.readCString(4);
        if (magic === &quot;dex\n&quot;) {
          console.log(&quot; Magic: &quot; + magic + &quot; âœ“&quot;);

          // Dump DEX
          var dexBytes = base.readByteArray(size);
          var fileName = &quot;/sdcard/&quot; + size + &quot;.dex&quot;;

          var file = new File(fileName, &quot;wb&quot;);
          file.write(dexBytes);
          file.close();

          console.log(&quot;[+] DEX dumped to: &quot; + fileName);
        } else {
          console.log(&quot; Invalid magic: &quot; + magic);
        }
      },
    });

    console.log(&quot;[*] Hooks installed, waiting for DEX load...&quot;);
  });
}

setImmediate(dumpDex);
</code></pre>
<h1>æ‹‰å–åˆ°æœ¬åœ°</h1>
<p>adb pull /sdcard/*.dex .</p>
<pre><code>Module.enumerateExports(&quot;libart.so&quot;).forEach(function(exp) {
if (exp.name.includes(&quot;DexFile&quot;) &amp;&amp; exp.name.includes(&quot;Open&quot;)) {
console.log(exp.name, exp.address);
}
});

</code></pre>
<h1>æŸ¥çœ‹è¿›ç¨‹åŠ è½½çš„ SO æ–‡ä»¶</h1>
<p>frida -U -f com.example.app</p>
<blockquote>
<p>Process.enumerateModules().forEach(function(m) {
if (m.name.includes(&quot;native&quot;) || m.name.includes(&quot;encrypt&quot;)) {
console.log(m.name, m.base, m.size);
}
});</p>
</blockquote>
<h1>è¾“å‡ºç¤ºä¾‹:</h1>
<h1>libnative-lib.so 0x7abc000000 0x50000</h1>
<pre><code>var module = Process.findModuleByName(moduleName);
if (!module) {
console.log(&quot;[-] Module not found: &quot; + moduleName);
return;
}

console.log(&quot;[+] æ‰¾åˆ°æ¨¡å—:&quot;, moduleName);
console.log(&quot; åŸºå€: &quot; + module.base);
console.log(&quot; å¤§å°: &quot; + module.size);

// å¯¼å‡ºæ•´ä¸ªæ¨¡å—
var buffer = module.base.readByteArray(module.size);
var fileName = &quot;/sdcard/&quot; + moduleName;

var file = new File(fileName, &quot;wb&quot;);
file.write(buffer);
file.close();

console.log(&quot;[+] å·²å¯¼å‡ºåˆ°: &quot; + fileName);

}

// ä½¿ç”¨
dumpSo(&quot;libnative-lib.so&quot;);

</code></pre>
<p>adb pull /sdcard/libnative-lib.so .</p>
<pre><code>cd frida-all-in-one

# è¿è¡Œå‘½ä»¤

python3 dump_so.py -U com.example.app libnative-lib.so

# ä¼šè‡ªåŠ¨å¯¼å‡ºå¹¶ä¿®å¤ SO æ–‡ä»¶

</code></pre>
<h4>5.1 ä½¿ç”¨ SoFixer</h4>
<pre><code class="language-bash"># ä¸‹è½½
git clone https://github.com/F8LEFT/SoFixer.git
cd SoFixer

# ç¼–è¯‘ï¼ˆéœ€è¦ CMakeï¼‰
mkdir build &amp;&amp; cd build
cmake ..
make

# ä½¿ç”¨
./SoFixer ../libnative-lib.so ../libnative-lib_fixed.so

</code></pre>
<p>[+] Detected architecture: ARM64
[+] Rebuilding ELF header...
[+] Fixing section table...
[+] Fixing dynamic symbols...
[+] Output file: libnative-lib_fixed.so
[+] Done!</p>
<pre><code># åº”è¯¥æ˜¾ç¤º: ELF 64-bit LSB shared object, ARM aarch64...

# ç”¨ IDA Pro æ‰“å¼€
# æˆ–ç”¨ readelf æŸ¥çœ‹
readelf -h libnative-lib_fixed.so

</code></pre>
<pre><code>è§£å¯†åŸå§‹ DEXï¼ˆåœ¨å†…å­˜ä¸­ï¼‰
â†“
è°ƒç”¨ DexFile::OpenCommon åŠ è½½ DEX â† Frida Hook ç‚¹
â†“
Frida è¯»å–å†…å­˜ä¸­çš„ DEX æ•°æ®
â†“
ä¿å­˜åˆ°æ–‡ä»¶

</code></pre>
<p>size_t size, // DEX å¤§å°
...)</p>
<pre><code>Only dump Thisäº›æ®µOriginalDataï¼Œç¼ºå°‘ ELF Fileç»“æ„

</code></pre>
<p>[.text æ®µ]
[.data æ®µ]
[.rodata æ®µ]
...
[Symbol Table] â† é‡å»º
[String Table] â† é‡å»º</p>
<pre><code>| æ¢†æ¢†åŠ å›º | libDexHelper.so | |
| è…¾è®¯åŠ å›º | libtup.so | |
| çˆ±åŠ å¯† | libexec.so | |
| ç½‘æ˜“æ˜“ç›¾ | libnesec.so | |

* *é€šç”¨ç­–ç•¥**ï¼šæ‰€æœ‰åŠ å›ºéƒ½éœ€è¦åœ¨è¿è¡Œæ—¶è§£å¯†ï¼ŒFrida è„±å£³éƒ½æœ‰æ•ˆï¼

- --

## å¸¸è§é—®é¢˜

### âŒ é—®é¢˜ 1: frida-dexdump æŠ¥é”™ &quot;Failed to spawn&quot;

* *ç—‡çŠ¶**ï¼š

</code></pre>
<p>adb shell pm list packages | grep example</p>
<h1>2. ç¡®è®¤åŒ…åæ­£ç¡®</h1>
<h1>ä» AndroidManifest.xml è·å–å‡†ç¡®åŒ…å</h1>
<h1>3. å°è¯• Attach æ¨¡å¼</h1>
<h1>å…ˆæ‰‹åŠ¨å¯åŠ¨åº”ç”¨</h1>
<p>adb shell am start -n com.example.app/.MainActivity</p>
<h1>å†é™„åŠ </h1>
<p>python3 main.py -U com.example.app</p>
<pre><code>
1. **DEX å¤´éƒ¨æŸå**
    ```bash
# æ£€æŸ¥é­”æ•°
xxd dumped.dex | head -1
# åº”è¯¥çœ‹åˆ°: 64 65 78 0a (dex\n)

```
    ```python
# éªŒè¯ DEX å¤§å°
with open('dumped.dex', 'rb') as f:
f.seek(32) # è·³åˆ° file_size å­—æ®µ
size = int.from_bytes(f.read(4), 'little')
print(f&quot;DEX å£°æ˜çš„å¤§å°: {size}&quot;)

import os
actual_size = os.path.getsize('dumped.dex')
print(f&quot;å®é™…æ–‡ä»¶å¤§å°: {actual_size}&quot;)

```
    ```bash
git clone https://github.com/anestisb/dexrepair.git
python3 dexrepair/dexrepair.py dumped.dex fixed.dex

```

* *æ£€æŸ¥æ­¥éª¤**ï¼š

1. **ç¡®è®¤ libart.so å·²åŠ è½½**
    ```javascript
var libart = Process.findModuleByName(&quot;libart.so&quot;);
console.log(&quot;libart found:&quot;, libart !== null);

```
    ```javascript
Module.enumerateExports(&quot;libart.so&quot;).forEach(function(exp) {
if (exp.name.includes(&quot;OpenCommon&quot;)) {
console.log(exp.name);
}
});

```
    ```javascript
// android 7.0-
var OpenMemory = Module.findExportByName(&quot;libart.so&quot;,
&quot;_ZN3art7DexFile10OpenMemoryEPKhjRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEjPNS_6MemMapEPKNS_10OatDexFileEPS9_&quot;);

```

* *ç—‡çŠ¶**ï¼šIDA æ‰“å¼€ååªæ˜¾ç¤ºæ•°æ®ï¼Œæ²¡æœ‰å‡½æ•°

* *è§£å†³**ï¼š

1. **æ‰‹åŠ¨å®šä¹‰å‡½æ•°**
    ```

IDA Inï¼š
- å…‰æ ‡ç§»åˆ°ç–‘ä¼¼Functionèµ·å§‹å¤„
- By 'P' KeyCreateFunction
- By 'C' KeyConvertä¸ºCode
    ```

2. **ä½¿ç”¨ç¬¦å·æ¢å¤å·¥å…·**
    ```bash
# If åŸå§‹ SO æœ‰ç¬¦å·table
readelf -s original.so &gt; symbols.txt

# ç”¨ IDA ScriptImportç¬¦å·

```
- å¦‚æœçœ‹åˆ°å¤§é‡è·³è½¬å’Œæ— æ„ä¹‰çš„ä»£ç å—
- å¯èƒ½æ˜¯ OLLVM æ§åˆ¶æµå¹³å¦åŒ–
- å‚è€ƒï¼š[OLLVM åæ··æ·†](#section-21)

- å¦‚æœçœ‹åˆ°å¤§é‡è·³è½¬å’Œæ— æ„ä¹‰çš„ä»£ç å—
- å¯èƒ½æ˜¯ OLLVM æ§åˆ¶æµå¹³å¦åŒ–
- å‚è€ƒï¼š[OLLVM åæ··æ·†](#section-21)


### âŒ é—®é¢˜ 5: App æ£€æµ‹åˆ° Frida å¹¶å´©æºƒ

* *ç—‡çŠ¶**ï¼šå¯åŠ¨åç«‹å³é€€å‡ºï¼Œlogcat æ˜¾ç¤ºåè°ƒè¯•æç¤º

* *è§£å†³**ï¼š

å‚è€ƒ [Frida åè°ƒè¯•ç»•è¿‡](#section-8)

å¿«é€Ÿæ–¹æ³•ï¼š

```bash
# ä½¿ç”¨ Magisk Hide
# æˆ–ä½¿ç”¨ä¿®æ”¹ç‰ˆ Frida æœåŠ¡å™¨
wget https://github.com/hluwa/strongR-frida-android/releases/download/xxx/frida-server

</code></pre>
<ul>
<li><strong><a href="#section-14">åº”ç”¨è„±å£³æ€»è§ˆ</a></strong> - å„ç§è„±å£³æŠ€æœ¯å¯¹æ¯”</li>
<li><strong><a href="#section-8">Frida åè°ƒè¯•ç»•è¿‡</a></strong> - å¤„ç†å Frida æ£€æµ‹</li>
<li><strong><a href="#section-16">SO æ··æ·†åˆ†æ</a></strong> - åˆ†ææ··æ·†çš„ SO æ–‡ä»¶</li>
<li><strong><a href="#section-21">OLLVM åæ··æ·†</a></strong> - å¤„ç†æ§åˆ¶æµæ··æ·†</li>
</ul>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><strong><a href="#section-40">Frida å®Œæ•´æŒ‡å—</a></strong></li>
<li><strong><a href="#section-47">IDA Pro ä½¿ç”¨</a></strong></li>
</ul>
<h3>é¡¹ç›®èµ„æº</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>frida-dexdump</strong> - https</td>
  <td>//github.com/hluwa/frida-dexdump</td>
</tr>
<tr>
  <td><strong>FRIDA-DEXDump</strong> - https</td>
  <td>//github.com/lasting-yang/frida_dump</td>
</tr>
<tr>
  <td><strong>SoFixer</strong> - https</td>
  <td>//github.com/F8LEFT/SoFixer</td>
</tr>
<tr>
  <td><strong>frida-all-in-one</strong> - https</td>
  <td>//github.com/hookmaster/frida-all-in-one</td>
</tr>
</tbody>
</table>
<h3>ç†è®ºåŸºç¡€</h3>
<ul>
<li><strong><a href="#section-62">DEX æ–‡ä»¶æ ¼å¼</a></strong></li>
<li><strong><a href="#section-64">SO/ELF æ–‡ä»¶æ ¼å¼</a></strong></li>
<li><strong><a href="#section-65">ART è¿è¡Œæ—¶</a></strong></li>
</ul>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>è„±å£³å·¥å…·å¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>ç±»å‹</th>
  <th>éš¾åº¦</th>
  <th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>frida-dexdump</strong></td>
  <td>è‡ªåŠ¨åŒ–</td>
  <td></td>
  <td>ç®€å•ï¼Œæ”¯æŒå¤šç‰ˆæœ¬</td>
</tr>
<tr>
  <td><strong>FRIDA-DEXDump</strong></td>
  <td>è‡ªåŠ¨åŒ–</td>
  <td></td>
  <td>æ·±åº¦æœç´¢ï¼Œæ›´å…¨é¢</td>
</tr>
<tr>
  <td><strong>æ‰‹åŠ¨è„šæœ¬</strong></td>
  <td>å®šåˆ¶</td>
  <td></td>
  <td>çµæ´»ï¼Œé€‚åˆç‰¹æ®Šæƒ…å†µ</td>
</tr>
<tr>
  <td><strong>objection</strong></td>
  <td>äº¤äº’å¼</td>
  <td></td>
  <td>å¤šåŠŸèƒ½ï¼Œå«è„±å£³</td>
</tr>
</tbody>
</table>
<h3>ä¸€é”®è„±å£³è„šæœ¬</h3>
<p><strong>auto_unpack.sh</strong>ï¼š</p>
<pre><code class="language-bash">#!/bin/bash

PACKAGE=$1

if [ -z &quot;$PACKAGE&quot; ]; then
echo &quot;ç”¨æ³•: $0 &lt;package_name&gt;&quot;
exit 1
fi

echo &quot; å¼€å§‹è„±å£³: $PACKAGE&quot;

# 1. Dump DEX
echo &quot;&quot;
echo &quot;ğŸ“¦ å¯¼å‡º DEX æ–‡ä»¶...&quot;
python3 ~/tools/frida-dexdump/main.py -U -f $PACKAGE

# 2. Dump SO
echo &quot;&quot;
echo &quot; å¯¼å‡º SO æ–‡ä»¶...&quot;
frida -U -f $PACKAGE -l dump_all_so.js --no-pause

sleep 5

# 3. æ‹‰å–æ–‡ä»¶
echo &quot;&quot;
echo &quot;ğŸ“¥ æ‹‰å–æ–‡ä»¶...&quot;
adb pull /sdcard/*.dex .
adb pull /sdcard/*.so .

# 4. æ¸…ç†
adb shell rm /sdcard/*.dex
adb shell rm /sdcard/*.so

echo &quot;&quot;
echo &quot;âœ… å®Œæˆ! æ–‡ä»¶å·²ä¿å­˜åˆ°å½“å‰ç›®å½•&quot;
ls -lh *.dex *.so

</code></pre>
<p>function dumpAllSo() {
var modules = Process.enumerateModules();
console.log(&quot;[*] æ‰¾åˆ° &quot; + modules.length + &quot; ä¸ªæ¨¡å—&quot;);</p>
<p>modules.forEach(function(module) {
// åªå¯¼å‡º .so æ–‡ä»¶
if (!module.name.endsWith('.so')) {
return;
}</p>
<p>// æ’é™¤ç³»ç»Ÿåº“
if (module.path.startsWith('/system') ||
module.path.startsWith('/apex')) {
return;
}</p>
<p>console.log(&quot;[+] å¯¼å‡º: &quot; + module.name);
console.log(&quot; è·¯å¾„: &quot; + module.path);
console.log(&quot; åŸºå€: &quot; + module.base);
console.log(&quot; å¤§å°: &quot; + module.size);</p>
<p>try {
var buffer = module.base.readByteArray(module.size);
var fileName = &quot;/sdcard/&quot; + module.name;
var file = new File(fileName, &quot;wb&quot;);
file.write(buffer);
file.close();
console.log(&quot; å·²ä¿å­˜: &quot; + fileName);
} catch(e) {
console.log(&quot; é”™è¯¯: &quot; + e);
}
});</p>
<p>console.log(&quot;[*] å®Œæˆ!&quot;);</p>
<p>}</p>
<p>setImmediate(dumpAllSo);</p>

                                            </div>
                                            
                                            <div class="section" id="section-16">
                                                <h2>16. R14: SO Obfuscation Deobfuscation</h2>
                                                <h1>R14: SO æ–‡ä»¶åæ··æ·†ï¼šèŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤</h1>
<p>åœ¨ Android SO æ–‡ä»¶é€†å‘å·¥ç¨‹ä¸­ï¼Œ<strong>ä»£ç æ··æ·† (Code Obfuscation)</strong>ï¼Œä¿—ç§°&quot;èŠ±æŒ‡ä»¤&quot;ï¼Œæ˜¯å¼€å‘è€…ä¸ºäº†ä¿æŠ¤æ ¸å¿ƒé€»è¾‘ã€å¢åŠ é€†å‘åˆ†æéš¾åº¦è€Œé‡‡ç”¨çš„ä¸€ç§å¸¸ç”¨æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ä»£ç ä¸­æ’å…¥å¤§é‡å¯¹ç¨‹åºæœ¬èº«é€»è¾‘æ— ç”¨ä½†èƒ½è¿·æƒ‘åæ±‡ç¼–å·¥å…·å’Œåˆ†æäººå‘˜çš„æŒ‡ä»¤ã€‚</p>
<p>æœ¬æŒ‡å—å°†ç³»ç»Ÿä»‹ç»èŠ±æŒ‡ä»¤çš„å¸¸è§ç±»å‹ã€è¯†åˆ«æ–¹æ³•ï¼Œå¹¶é‡ç‚¹é˜è¿°å¦‚ä½•åˆ©ç”¨ <code>IDAPython</code> ç¼–å†™è„šæœ¬ï¼Œå®ç°è‡ªåŠ¨åŒ–&quot;å»èŠ±&quot;ã€‚</p>
<hr />
<h1># ç›®å½•</h1>
<ul>
<li><a href="#so-%E6%96%87%E4%BB%B6%E5%8F%8D%E6%B7%B7%E6%B7%86%E8%8A%B1%E6%8C%87%E4%BB%A4%E8%AF%86%E5%88%AB%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8E%BB%E9%99%A4">SO æ–‡ä»¶åæ··æ·†ï¼šèŠ±æŒ‡ä»¤è¯†åˆ«ä¸è‡ªåŠ¨åŒ–å»é™¤</a></li>
<li><a href="#-%E7%9B%AE%E5%BD%95"># ç›®å½•</a></li>
<li><a href="#-%E8%8A%B1%E6%8C%87%E4%BB%A4%E7%9A%84%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%9E%8B"># èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹</a><ul>
<li><a href="#-%E5%9E%83%E5%9C%BE%E6%8C%87%E4%BB%A4-junk-code"># åƒåœ¾æŒ‡ä»¤ (Junk Code)</a></li>
</ul>
</li>
<li><a href="#%E9%81%8D%E5%8E%86%E4%BB%A3%E7%A0%81%E6%AE%B5">éå†ä»£ç æ®µ</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%98%AF-jmp-%E6%8C%87%E4%BB%A4">æ£€æŸ¥æ˜¯å¦æ˜¯ JMP æŒ‡ä»¤</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E8%B7%B3%E8%BD%AC%E7%9B%AE%E6%A0%87%E5%9C%B0%E5%9D%80">è·å–è·³è½¬ç›®æ ‡åœ°å€</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%8C%87%E4%BB%A4%E9%95%BF%E5%BA%A6">è·å–æŒ‡ä»¤é•¿åº¦</a></li>
<li><a href="#%E5%A6%82%E6%9E%9C%E8%B7%B3%E8%BD%AC%E7%9B%AE%E6%A0%87%E6%98%AF%E4%B8%8B%E4%B8%80%E6%9D%A1%E6%8C%87%E4%BB%A4%E7%9A%84%E5%9C%B0%E5%9D%80">å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</a></li>
<li><a href="#%E7%94%A8-nop-%E4%BF%AE%E8%A1%A5">ç”¨ NOP ä¿®è¡¥</a></li>
<li><a href="#----%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC----">--- æ‰§è¡Œè„šæœ¬ ---</a></li>
<li><a href="#patch_junk_jumps">patch_junk_jumps()</a></li>
</ul>
<hr />
<h1># èŠ±æŒ‡ä»¤çš„æ ¸å¿ƒç±»å‹</h1>
<h2># åƒåœ¾æŒ‡ä»¤ (Junk Code)</h2>
<p>æœ€ç®€å•çš„æ··æ·†å½¢å¼ã€‚åœ¨çœŸå®æŒ‡ä»¤ä¹‹é—´æ’å…¥ä¸ä¼šå½±å“ç¨‹åºçŠ¶æ€ï¼ˆå¯„å­˜å™¨ã€å†…å­˜ã€æ ‡å¿—ä½ï¼‰çš„æŒ‡ä»¤ã€‚</p>
<pre><code class="language-assembly">; çœŸå®ä»£ç 
PUSH EAX

; --- åƒåœ¾ä»£ç  ---
NOP
MOV EBX, EBX
XCHG ECX, ECX
ADD EAX, 0
; --- åƒåœ¾ä»£ç ç»“æŸ ---

; çœŸå®ä»£ç 
POP EAX

</code></pre>
<p>MOV EAX, EDX
XOR EAX, EDX ; æ¸…é›¶ EAX
TEST EAX, EAX ; è®¾ç½® Z æ ‡å¿—</p>
<p>; JZ (ä¸ºé›¶åˆ™è·³è½¬) å°†å§‹ç»ˆè·³è½¬
; JNZ åˆ†æ”¯ä¸‹çš„ä»£ç æ˜¯æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„æ­»ä»£ç 
JZ real_code_path
; --- æ­»ä»£ç  ---
ADD EAX, 1234
CALL some_fake_func
; --- æ­»ä»£ç ç»“æŸ ---</p>
<p>real_code_path:
; ...</p>
<pre><code>
## # æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)
è¿™æ˜¯ä¸€ç§é«˜çº§ä¸”éå¸¸æœ‰æ•ˆçš„æ··æ·†æŠ€æœ¯ã€‚å®ƒå°†ä¸€ä¸ªå‡½æ•°çš„æ­£å¸¸é€»è¾‘å—æ‰“æ•£ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªä¸­å¤®åˆ†å‘å™¨ï¼ˆDispatcherï¼‰å’Œ `switch-case` ç»“æ„æ¥æ§åˆ¶æ‰§è¡Œæµã€‚åŸå§‹çš„è°ƒç”¨å…³ç³»è¢«éšè—åœ¨ä¸€ä¸ªå·¨å¤§çš„å¾ªç¯ä¸­ï¼Œä½¿å¾—å‡½æ•°é€»è¾‘æéš¾è¢«ç†è§£ã€‚

- --

# # å¦‚ä½•è¯†åˆ«èŠ±æŒ‡ä»¤

## # é™æ€åˆ†æç‰¹å¾
åœ¨ IDA Pro æˆ– Ghidra ä¸­è§‚å¯Ÿï¼š

* **æ— æ•ˆè·³è½¬**ï¼š`JMP loc_A` çš„ä¸‹ä¸€æ¡æŒ‡ä»¤å°±æ˜¯ `loc_A`ã€‚

* **è·³è½¬åˆ°æŒ‡ä»¤ä¸­é—´**ï¼š`JMP $+5` è·³è½¬åˆ°ä¸€ä¸ªæ­£å¸¸æŒ‡ä»¤çš„ä¸­é—´ï¼Œç ´ååæ±‡ç¼–ã€‚

* **å¯¹ç§°æ“ä½œ**ï¼šè¿ç»­çš„ `PUSH`/`POP` åŒä¸€ä¸ªå¯„å­˜å™¨ã€‚

* **æ’æˆç«‹/ä¸æˆç«‹çš„æ¡ä»¶**ï¼šåœ¨ `Jcc` æŒ‡ä»¤å‰ï¼Œ`CMP` çš„ä¸¤ä¸ªæ“ä½œæ•°æ˜æ˜¾ç›¸ç­‰æˆ–ä¸ç­‰ã€‚

* **æ— æ„ä¹‰çš„è®¡ç®—**ï¼šè®¡ç®—ç»“æœæ²¡æœ‰è¢«åç»­ä»£ç ä½¿ç”¨ã€‚

* **IDA å›¾å½¢è§†å›¾**ï¼šæ§åˆ¶æµå¹³å¦åŒ–çš„å‡½æ•°ä¼šå‘ˆç°å‡ºä¸€ä¸ªå·¨å¤§çš„ã€èŠ‚ç‚¹ä¼—å¤šçš„ `switch` ç»“æ„ï¼Œæ‰€æœ‰é€»è¾‘å—éƒ½æŒ‡å‘ä¸€ä¸ªä¸­å¿ƒåˆ†å‘å—ã€‚

## # åŠ¨æ€è°ƒè¯•éªŒè¯
æœ€å¯é çš„æ–¹æ³•ã€‚ä½¿ç”¨ `gdb` æˆ– IDA çš„è°ƒè¯•å™¨ï¼š

* åœ¨å¯ç–‘åˆ†æ”¯ä¸‹æ–­ç‚¹ï¼Œå¦‚æœæ–­ç‚¹ä»æœªå‘½ä¸­ï¼Œåˆ™è¯´æ˜è¯¥åˆ†æ”¯æ˜¯æ­»ä»£ç ã€‚

* å•æ­¥æ‰§è¡Œï¼Œè§‚å¯Ÿå¯„å­˜å™¨å’Œå†…å­˜çš„å˜åŒ–ã€‚å¦‚æœä¸€æ®µæŒ‡ä»¤æ‰§è¡Œåï¼Œç›¸å…³çš„çŠ¶æ€æ²¡æœ‰å˜åŒ–ï¼Œåˆ™å¾ˆå¯èƒ½æ˜¯åƒåœ¾ä»£ç ã€‚

- --

# # è‡ªåŠ¨åŒ–&quot;å»èŠ±&quot;è„šæœ¬ (IDAPython å®æˆ˜)

å½“èŠ±æŒ‡ä»¤æ•°é‡åºå¤§æ—¶ï¼Œæ‰‹åŠ¨ä¿®å¤æ˜¯ä¸ç°å®çš„ã€‚ç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–å¤„ç†æ˜¯å”¯ä¸€é«˜æ•ˆçš„é€”å¾„ã€‚ä»¥ä¸‹ä»¥ IDAPython ä¸ºä¾‹ã€‚

## # åœºæ™¯ä¸€ï¼šNOP æ‰æ— æ•ˆè·³è½¬
ä¸€ä¸ªå¸¸è§çš„èŠ±æŒ‡ä»¤æ¨¡å¼æ˜¯ `JMP dest`ï¼Œè€Œ `dest` ç´§æ¥ç€ `JMP` æŒ‡ä»¤ã€‚

```assembly
.text:00001234 JMP short loc_1236 ; è·³è½¬æŒ‡ä»¤æœ¬èº«å  2 å­—èŠ‚
.text:00001236 ; ... çœŸå®ä»£ç 

</code></pre>
<p>import idaapi</p>
<p>def patch_junk_jumps():
&quot;&quot;&quot;
æŸ¥æ‰¾å¹¶å°†å½¢å¼ä¸º <code>JMP next_instruction</code> çš„è·³è½¬ NOP æ‰ã€‚
&quot;&quot;&quot;
print(&quot;æ‰«æåƒåœ¾è·³è½¬...&quot;)
count = 0</p>
<h1>éå†ä»£ç æ®µ</h1>
<p>for seg_ea in idc.get_segm_list():
if idc.get_segm_attr(seg_ea, idc.SEGATTR_TYPE) != idc.SEG_CODE:
continue</p>
<p>seg_start = idc.get_segm_start(seg_ea)
seg_end = idc.get_segm_end(seg_ea)</p>
<p>for head in idautils.Heads(seg_start, seg_end):</p>
<h1>æ£€æŸ¥æ˜¯å¦æ˜¯ JMP æŒ‡ä»¤</h1>
<p>if idaapi.is_jmp_insn(head):</p>
<h1>è·å–è·³è½¬ç›®æ ‡åœ°å€</h1>
<p>target_ea = idc.get_operand_value(head, 0)</p>
<h1>è·å–æŒ‡ä»¤é•¿åº¦</h1>
<p>insn_len = idc.get_item_size(head)</p>
<h1>å¦‚æœè·³è½¬ç›®æ ‡æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</h1>
<p>if target_ea == (head + insn_len):
print(f&quot;åœ¨ 0x{head:X} å¤„æ‰¾åˆ°åƒåœ¾ JMPï¼Œç›®æ ‡: 0x{target_ea:X}&quot;)</p>
<h1>ç”¨ NOP ä¿®è¡¥</h1>
<p>for i in range(insn_len):
idc.patch_byte(head + i, 0x90)
count += 1</p>
<p>print(f&quot;å®Œæˆã€‚ä¿®è¡¥äº† {count} ä¸ªåƒåœ¾è·³è½¬ã€‚&quot;)</p>
<h1>--- æ‰§è¡Œè„šæœ¬ ---</h1>
<h1>patch_junk_jumps()</h1>
<pre><code># ... éå†æŒ‡ä»¤ ...
head = ...

# æ£€æŸ¥æ˜¯å¦æ˜¯ JNE æŒ‡ä»¤ (ä¾‹å¦‚ï¼Œæ“ä½œç  0x75)
if idc.get_byte(head) == 0x75:
# æ£€æŸ¥ JNE ä¹‹å‰çš„æŒ‡ä»¤æ˜¯å¦æ˜¯ CMP
prev_head = idc.prev_head(head)
if idc.print_insn_mnem(prev_head) == &quot;cmp&quot;:
# æ£€æŸ¥ CMP çš„ä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸åŒ
op1 = idc.get_operand_value(prev_head, 0)
op2 = idc.get_operand_value(prev_head, 1)

# è¿™æ˜¯ä¸€ä¸ªç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…çš„æ“ä½œæ•°ç±»å‹æ£€æŸ¥ä¼šæ›´å¤æ‚
# if idc.get_operand_type(prev_head, 0) == o_reg and ...
if op1 == op2: # ä¾‹å¦‚ï¼ŒCMP EAX, EAX
print(f&quot;åœ¨ 0x{head:X} å¤„æ‰¾åˆ°ä¸é€æ˜è°“è¯&quot;)
# å°† JNE æŒ‡ä»¤ NOP æ‰
insn_len = idc.get_item_size(head)
for i in range(insn_len):
idc.patch_byte(head + i, 0x90)

</code></pre>
<ol start="2">
<li><strong>è¯†åˆ«</strong>ï¼šæ‰¾åˆ°è¯¥æ¨¡å¼çš„é€šç”¨æœºå™¨ç æˆ–æŒ‡ä»¤ç‰¹å¾ã€‚</li>
<li><strong>ç¼–ç </strong>ï¼šç¼–å†™è„šæœ¬ï¼Œç²¾ç¡®åœ°å®šä½è¿™äº›ç‰¹å¾å¹¶è¿›è¡Œä¿®å¤ (Patch)ã€‚</li>
</ol>
<p>è™½ç„¶èŠ±æŒ‡ä»¤çš„å˜ç§å±‚å‡ºä¸ç©·ï¼Œä½†å…¶æœ¬è´¨æ˜¯æœ‰é™çš„ã€‚æŒæ¡äº†è‡ªåŠ¨åŒ–çš„è„šæœ¬å»èŠ±èƒ½åŠ›ï¼Œå°±èƒ½æå¤§åœ°æå‡ SO æ–‡ä»¶é€†å‘åˆ†æçš„æ•ˆç‡ã€‚</p>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-17">
                                                <h2>17. R15: SO String Deobfuscation</h2>
                                                <h1>R15: SO æ–‡ä»¶å­—ç¬¦ä¸²æ··æ·†å¯¹æŠ—æŒ‡å—</h1>
<p>åœ¨ Android Native å±‚å®‰å…¨ä¸­ï¼Œå­—ç¬¦ä¸²æ··æ·†æ˜¯ä¸€ç§ç”¨äºéšè—æ•æ„Ÿä¿¡æ¯ã€å¢åŠ é€†å‘åˆ†æéš¾åº¦çš„å¸¸ç”¨æŠ€æœ¯ã€‚å¼€å‘è€…é€šè¿‡å¯¹ SO æ–‡ä»¶ä¸­çš„å…³é”®å­—ç¬¦ä¸²ï¼ˆå¦‚ API URLã€åŠ å¯†å¯†é’¥ã€Shell å‘½ä»¤ã€åŠŸèƒ½å¼€å…³ç­‰ï¼‰è¿›è¡Œç¼–ç æˆ–åŠ å¯†ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ <code>strings</code> å‘½ä»¤æˆ– IDA Pro çš„å­—ç¬¦ä¸²çª—å£ï¼‰ç›´æ¥å‘ç°å®ƒä»¬ã€‚</p>
<p>æœ¬æ–‡æ—¨åœ¨ç³»ç»Ÿæ€§åœ°ä»‹ç» SO æ–‡ä»¶ä¸­å¸¸è§çš„å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯ï¼Œå¹¶æä¾›ä¸€å¥—ä»é™æ€åˆ†æåˆ°åŠ¨æ€åˆ†æçš„å®Œæ•´å¯¹æŠ—ç­–ç•¥ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#so-%E6%96%87%E4%BB%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B7%B7%E6%B7%86%E5%AF%B9%E6%8A%97%E6%8C%87%E5%8D%97">SO æ–‡ä»¶å­—ç¬¦ä¸²æ··æ·†å¯¹æŠ—æŒ‡å—</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B7%B7%E6%B7%86%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3">å­—ç¬¦ä¸²æ··æ·†çš„æ ¸å¿ƒæ€æƒ³</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF">å¸¸è§çš„æ··æ·†æŠ€æœ¯</a></li>
<li><a href="#%E5%AF%B9%E6%8A%97%E7%AD%96%E7%95%A5%E4%B8%80%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90-ida-pro--ghidra">å¯¹æŠ—ç­–ç•¥ä¸€ï¼šé™æ€åˆ†æ (IDA Pro / Ghidra)</a><ul>
<li><a href="#%E8%AF%86%E5%88%AB%E8%A7%A3%E5%AF%86%E8%A7%A3%E6%B7%B7%E6%B7%86%E5%87%BD%E6%95%B0">è¯†åˆ«è§£å¯†/è§£æ··æ·†å‡½æ•°</a></li>
<li><a href="#%E5%AE%9A%E4%BD%8D%E4%BA%A4%E5%8F%89%E5%BC%95%E7%94%A8">å®šä½äº¤å‰å¼•ç”¨</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E8%A7%A3%E5%AF%86">è‡ªåŠ¨åŒ–è„šæœ¬è§£å¯†</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%A4%BA%E4%BE%8B-python-%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95-xor-%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95">ç¤ºä¾‹: Python å®ç°çš„ç®€å• XOR è§£å¯†ç®—æ³•</a> - <a href="#%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E4%B8%8E%E6%90%9C%E7%B4%A2">å†…å­˜æ¼«æ¸¸ä¸æœç´¢</a><ul>
<li><a href="#%E6%80%BB%E7%BB%93%E6%9C%80%E9%AB%98%E6%95%88%E7%9A%84%E5%88%86%E6%9E%90%E6%B5%81%E7%A8%8B">æ€»ç»“ï¼šæœ€é«˜æ•ˆçš„åˆ†ææµç¨‹</a></li>
</ul>
</li>
</ul>
<hr />
<h3>å­—ç¬¦ä¸²æ··æ·†çš„æ ¸å¿ƒæ€æƒ³</h3>
<p>å…¶æœ¬è´¨æ˜¯<strong>é¿å…å°†æ˜æ–‡å­—ç¬¦ä¸²ç›´æ¥å­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ <code>.rodata</code> æˆ– <code>.data</code> æ®µä¸­</strong>ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ç‰¹å®šçš„å‡½æ•°åŠ¨æ€åœ°åœ¨å†…å­˜ä¸­ï¼ˆæ ˆæˆ–å †ï¼‰æ¢å¤å‡ºåŸå§‹çš„å­—ç¬¦ä¸²ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„æµç¨‹å¦‚ä¸‹ï¼š
<code>åŠ å¯†çš„å­—èŠ‚æ•°ç»„</code> -&gt; <code>è§£å¯†/è§£æ··æ·†å‡½æ•°</code> -&gt; <code>å†…å­˜ä¸­çš„æ˜æ–‡å­—ç¬¦ä¸²</code></p>
<p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æˆªè·&quot;å†…å­˜ä¸­çš„æ˜æ–‡å­—ç¬¦ä¸²&quot;ã€‚</p>
<hr />
<h3>å¸¸è§çš„æ··æ·†æŠ€æœ¯</h3>
<ol>
<li><strong>ç®€å•ç¼–ç </strong>:</li>
</ol>
<ul>
<li><p><strong>Base64</strong>: å°† Base64 ç¼–ç åçš„å­—ç¬¦ä¸²å­˜å‚¨ï¼Œä½¿ç”¨æ—¶å†è§£ç ã€‚</p>
</li>
<li><p><strong>ROT13/Caesar Cipher</strong>: ç®€å•çš„å­—ç¬¦ä½ç§»ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>æŒ‰ä½è¿ç®—</strong>:</li>
</ol>
<ul>
<li><strong>XOR (å¼‚æˆ–)</strong>: å°†åŸå§‹å­—ç¬¦ä¸²ä¸ä¸€ä¸ªå›ºå®šçš„ï¼ˆæˆ–åŠ¨æ€è®¡ç®—çš„ï¼‰å¯†é’¥è¿›è¡ŒæŒ‰å­—èŠ‚å¼‚æˆ–ã€‚è¿™æ˜¯æœ€å¸¸è§ã€æœ€é«˜æ•ˆçš„ä¸€ç§æ–¹å¼ã€‚</li>
</ul>
<ol start="3">
<li><strong>æ ˆä¸Šæ„å»º</strong>:</li>
</ol>
<ul>
<li>ä¸åœ¨ä»»ä½•æ®µä¸­å­˜å‚¨å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åœ¨å‡½æ•°å¼€å§‹æ—¶ï¼Œé€šè¿‡ä¸€ç³»åˆ— <code>mov</code> æŒ‡ä»¤é€å­—èŠ‚åœ°å°†å­—ç¬¦ä¸² push åˆ°æ ˆä¸Šã€‚<pre><code class="language-c++">void get_secret_string() {
char secret[12];
secret[0] = 's';
secret[1] = 'e';
// ...
secret[10] = 't';
secret[11] = '\0';
// use secret
}
</code></pre>
</li>
</ul>
<pre><code>* ä½¿ç”¨å¦‚ AES, RC4, DES ç­‰æ ‡å‡†å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å¯†é’¥æœ¬èº«å¯èƒ½è¢«å†æ¬¡æ··æ·†æˆ–ä»å…¶ä»–åœ°æ–¹åŠ¨æ€è·å–ã€‚

- --

### å¯¹æŠ—ç­–ç•¥ä¸€ï¼šé™æ€åˆ†æ (IDA Pro / Ghidra)
é™æ€åˆ†æçš„ç›®æ ‡æ˜¯**ç†è§£è§£å¯†é€»è¾‘å¹¶è‡ªåŠ¨åŒ–åœ°åº”ç”¨å®ƒ**ã€‚

#### è¯†åˆ«è§£å¯†/è§£æ··æ·†å‡½æ•°
* **ç‰¹å¾**: è§£å¯†å‡½æ•°é€šå¸¸å…·æœ‰ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾ï¼š
* æ¥å—ä¸€ä¸ªæŒ‡å‘å­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆå’Œä¸€ä¸ªé•¿åº¦ä½œä¸ºå‚æ•°ã€‚

* å‡½æ•°å†…éƒ¨åŒ…å«ä¸€ä¸ªå¾ªç¯ç»“æ„ï¼ˆ`for` / `while`ï¼‰ã€‚

* å¾ªç¯å†…éƒ¨æœ‰æŒ‰ä½æ“ä½œï¼Œç‰¹åˆ«æ˜¯ `XOR` (å¼‚æˆ–) æŒ‡ä»¤ã€‚

* å‡½æ•°çš„äº¤å‰å¼•ç”¨ï¼ˆXrefsï¼‰éå¸¸å¤šï¼Œä¸”è°ƒç”¨çš„åœ°æ–¹éƒ½ä¼´éšç€ä¸€ä¸ªæ•°æ®å—çš„åœ°å€ã€‚
* **æ–¹æ³•**: åœ¨ IDA Pro æˆ– Ghidra ä¸­ï¼Œé€šè¿‡æœç´¢è¿™äº›ä»£ç æ¨¡å¼ï¼Œé€šå¸¸èƒ½å¾ˆå¿«å®šä½åˆ°æ ¸å¿ƒçš„è§£å¯†å‡½æ•°ã€‚

#### å®šä½äº¤å‰å¼•ç”¨
ä¸€æ—¦ä½ è¯†åˆ«å‡ºäº†è§£å¯†å‡½æ•°ï¼ˆä¾‹å¦‚ `decrypt_string`ï¼‰ï¼Œç«‹å³æŸ¥çœ‹å®ƒçš„æ‰€æœ‰äº¤å‰å¼•ç”¨ã€‚æ¯ä¸€ä¸ªè°ƒç”¨ `decrypt_string` çš„åœ°æ–¹ï¼Œéƒ½æ˜¯ä¸€ä¸ªåŠ å¯†å­—ç¬¦ä¸²è¢«ä½¿ç”¨çš„åœ°æ–¹ã€‚ä¼ é€’ç»™è¯¥å‡½æ•°çš„å‚æ•°ï¼Œå°±æ˜¯åŠ å¯†çš„æ•°æ®ã€‚

#### è‡ªåŠ¨åŒ–è„šæœ¬è§£å¯†
è¿™æ˜¯é™æ€åˆ†æçš„ç²¾é«“æ‰€åœ¨ã€‚
1. **åˆ†æç®—æ³•**: ä»”ç»†é˜…è¯»è§£å¯†å‡½æ•°çš„æ±‡ç¼–æˆ–åç¼–è¯‘ä»£ç ï¼Œç”¨ä¸€ç§é«˜çº§è¯­è¨€ï¼ˆå¦‚ Pythonï¼‰é‡æ–°å®ç°å…¶é€»è¾‘ã€‚
    ```python
# ç¤ºä¾‹: Python å®ç°çš„ç®€å• XOR è§£å¯†ç®—æ³•
def decrypt_xor(data, key):
decrypted = bytearray()
for i in range(len(data)):
decrypted.append(data[i] ^ key[i % len(key)])
return decrypted.decode('utf-8')

</code></pre>
<ul>
<li><strong>è„šæœ¬é€»è¾‘</strong>:</li>
</ul>
<ol>
<li>è·å–è§£å¯†å‡½æ•°çš„åœ°å€ã€‚</li>
<li>éå†è¯¥å‡½æ•°çš„æ‰€æœ‰äº¤å‰å¼•ç”¨ã€‚</li>
<li>åœ¨æ¯ä¸ªäº¤å‰å¼•ç”¨çš„åœ°æ–¹ï¼Œè§£æå…¶å‚æ•°ï¼Œæå–å‡ºåŠ å¯†æ•°æ®å—çš„åœ°å€å’Œé•¿åº¦ã€‚</li>
<li>è¯»å–åŠ å¯†æ•°æ®ã€‚</li>
<li>è°ƒç”¨æ­¥éª¤ 1 ä¸­å®ç°çš„ Python è§£å¯†å‡½æ•°ã€‚</li>
<li><strong>å°†è§£å¯†åçš„æ˜æ–‡å­—ç¬¦ä¸²ï¼Œä½œä¸ºæ³¨é‡Šï¼Œæ·»åŠ åˆ°äº¤å‰å¼•ç”¨çš„ä»£ç è¡Œæ—è¾¹</strong>ã€‚</li>
</ol>
<ul>
<li><strong>æ•ˆæœ</strong>: è¿è¡Œè„šæœ¬åï¼ŒIDA/Ghidra ä¸­çš„ä»£ç å°†å˜å¾—éå¸¸æ˜“è¯»ï¼Œæ‰€æœ‰åŠ å¯†å­—ç¬¦ä¸²éƒ½ä»¥æ³¨é‡Šçš„å½¢å¼è¢«&quot;è¿˜åŸ&quot;äº†ã€‚</li>
</ul>
<hr />
<h3>å¯¹æŠ—ç­–ç•¥äºŒï¼šåŠ¨æ€åˆ†æ (Frida)</h3>
<p>åŠ¨æ€åˆ†æçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>ä¸å…³å¿ƒè§£å¯†è¿‡ç¨‹ï¼Œåªå…³å¿ƒè§£å¯†ç»“æœ</strong>ã€‚å®ƒé€šå¸¸æ›´å¿«é€Ÿã€æ›´ç›´æ¥ã€‚</p>
<h4>Hook è§£å¯†å‡½æ•°ï¼ˆé¦–é€‰ç­–ç•¥ï¼‰</h4>
<p>è¿™æ˜¯å¯¹æŠ—å­—ç¬¦ä¸²æ··æ·†<strong>æœ€ç®€å•ã€æœ€é«˜æ•ˆ</strong>çš„æ–¹æ³•ã€‚</p>
<ol>
<li><strong>å®šä½å‡½æ•°</strong>: ä½¿ç”¨é™æ€åˆ†æå·¥å…·ï¼ˆIDA/Ghidraï¼‰æ‰¾åˆ°è§£å¯†å‡½æ•°çš„åœ°å€ã€‚</li>
<li><strong>ç¼–å†™ Frida è„šæœ¬</strong>:</li>
</ol>
<ul>
<li><p><strong>Hook <code>onEnter</code></strong>: åœ¨è¿›å…¥è§£å¯†å‡½æ•°æ—¶ï¼Œæ‰“å°å…¶è¾“å…¥å‚æ•°ï¼ˆåŠ å¯†çš„å­—èŠ‚æ•°ç»„ï¼‰ã€‚</p>
</li>
<li><p><strong>Hook <code>onLeave</code> (æ›´å¸¸ç”¨)</strong>: åœ¨å‡½æ•°è¿”å›æ—¶ï¼Œç›´æ¥è¯»å–å…¶è¿”å›å€¼ã€‚å› ä¸ºè¿”å›å€¼é€šå¸¸å°±æ˜¯æŒ‡å‘å†…å­˜ä¸­æ˜æ–‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚</p>
<pre><code class="language-javascript">const decryptFuncPtr = Module.findExportByName(
  &quot;libnative-lib.so&quot;,
  &quot;Java_com_example_MainActivity_decryptString&quot;
);
// æˆ–è€…ç›´æ¥ä½¿ç”¨åœ°å€: const decryptFuncPtr = Module.getBaseAddress(&quot;libnative-lib.so&quot;).add(0x1234);
</code></pre>
</li>
</ul>
<p>Interceptor.attach(decryptFuncPtr, {
onEnter: function(args) {
console.log(&quot;è¿›å…¥ decryptStringï¼Œæ•°æ®: &quot; + args[0].readCString());
},
onLeave: function(retval) {
// retval æ˜¯æŒ‡å‘è§£å¯†åå­—ç¬¦ä¸²çš„æŒ‡é’ˆ
var decryptedString = retval.readCString();
console.log(&quot;è§£å¯†åçš„å­—ç¬¦ä¸² -&gt; &quot; + decryptedString);
// å¯ä»¥è¿›ä¸€æ­¥å°†ç»“æœå†™å…¥æ–‡ä»¶
// send({ decrypted: decryptedString });
}
});</p>
<pre><code>
#### å†…å­˜æ¼«æ¸¸ä¸æœç´¢
åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒApp å¯èƒ½ä¼šåœ¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§è§£å¯†å¤§é‡å­—ç¬¦ä¸²ï¼Œå¹¶å°†å®ƒä»¬å­˜æ”¾åœ¨ä¸€ä¸ªç‰¹å®šçš„å†…å­˜åŒºåŸŸã€‚

* **æ–¹æ³•**:
1. è®© App è¿è¡Œä¸€æ®µæ—¶é—´ã€‚
2. ä½¿ç”¨ Frida çš„ `Memory.scan` API åœ¨è¿›ç¨‹çš„æ•´ä¸ªå†…å­˜ç©ºé—´ä¸­æœç´¢ä½ æ„Ÿå…´è¶£çš„å­—ç¬¦ä¸²æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œ`https://`ï¼‰ã€‚
    ```javascript
Memory.scan(Process.findModuleByName(&quot;libnative-lib.so&quot;).base, Process.findModuleByName(&quot;libnative-lib.so&quot;).size, &quot;68 74 74 70 73 3a 2f 2f&quot;, { // åå…­è¿›åˆ¶è¡¨ç¤º &quot;https://&quot;
onMatch: function(address, size) {
console.log(&quot;åœ¨ä»¥ä¸‹åœ°å€æ‰¾åˆ°æ¨¡å¼: &quot; + address);
// å¯èƒ½éœ€è¦å›é€€ä¸€äº›å­—èŠ‚æ¥æ‰¾åˆ°å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®
console.log(address.readCString());
},
onComplete: function() {
console.log(&quot;å†…å­˜æ‰«æå®Œæˆã€‚&quot;);
}
});

</code></pre>
<h3>æ€»ç»“ï¼šæœ€é«˜æ•ˆçš„åˆ†ææµç¨‹</h3>
<p>å¯¹äºå­—ç¬¦ä¸²æ··æ·†ï¼Œæœ€é«˜æ•ˆçš„å·¥ä½œæµç¨‹æ˜¯ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æï¼š</p>
<ol>
<li><strong>é™æ€åˆ†æå®šä½</strong>: ä½¿ç”¨ IDA Pro æˆ– Ghidra å¿«é€Ÿæµè§ˆ SO æ–‡ä»¶ï¼Œè¯†åˆ«å‡ºå¯èƒ½çš„è§£å¯†/è§£æ··æ·†å‡½æ•°ã€‚</li>
<li><strong>åŠ¨æ€åˆ†æéªŒè¯/è·å–</strong>: ä½¿ç”¨ Frida å¯¹ä¸Šä¸€æ­¥å®šä½åˆ°çš„å‡½æ•°åœ°å€è¿›è¡Œ Hookï¼Œè¿è¡Œ App å¹¶è§‚å¯Ÿ <code>onLeave</code> çš„è¿”å›å€¼ï¼Œå¿«é€Ÿè·å–æ‰€æœ‰è§£å¯†åçš„å­—ç¬¦ä¸²ã€‚</li>
<li><strong>(å¯é€‰) é™æ€åˆ†æè„šæœ¬åŒ–</strong>: å¦‚æœéœ€è¦å¯¹å¤§é‡å­—ç¬¦ä¸²è¿›è¡Œç¦»çº¿åˆ†ææˆ–å¸Œæœ›å¾—åˆ°ä¸€ä¸ªå¸¦æ³¨é‡Šçš„ã€æ›´æ˜“è¯»çš„åæ±‡ç¼–æ–‡ä»¶ï¼Œå†å›åˆ°é™æ€åˆ†æå·¥å…·ä¸­ï¼Œæ ¹æ®å·²çŸ¥çš„ç®—æ³•ç¼–å†™è‡ªåŠ¨åŒ–è§£å¯†è„šæœ¬ã€‚</li>
</ol>

                                            </div>
                                            
                                            <div class="section" id="section-18">
                                                <h2>18. R16: RE Workflow</h2>
                                                <h1>R16: Recipe: Android åº”ç”¨é€†å‘å·¥ç¨‹å®Œæ•´å·¥ä½œæµç¨‹</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p>ä½ åˆšæ‹¿åˆ°ä¸€ä¸ª Android åº”ç”¨éœ€è¦åˆ†æï¼Œä½†é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>&quot;æ‹¿åˆ° APK ååº”è¯¥å…ˆåšä»€ä¹ˆï¼Ÿä»å“ªé‡Œå…¥æ‰‹ï¼Ÿ&quot;</strong></li>
<li><strong>&quot;é™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æåº”è¯¥å¦‚ä½•é…åˆï¼Ÿ&quot;</strong></li>
<li><strong>&quot;å¦‚ä½•ç³»ç»ŸåŒ–åœ°åˆ†æï¼Œè€Œä¸æ˜¯ç›²ç›®å°è¯•ï¼Ÿ&quot;</strong></li>
<li><strong>&quot;é‡åˆ°åŠ å›ºã€æ··æ·†ã€åè°ƒè¯•è¯¥æ€ä¹ˆåŠï¼Ÿ&quot;</strong></li>
<li><strong>&quot;åˆ†æå®Œæˆåå¦‚ä½•ä¿®æ”¹åº”ç”¨ä»¥è¾¾åˆ°ç›®çš„ï¼Ÿ&quot;</strong></li>
</ul>
<p>æœ¬é…æ–¹æä¾›ä¸€ä¸ª<strong>ç»è¿‡å®æˆ˜éªŒè¯çš„æ ‡å‡†åŒ–å·¥ä½œæµç¨‹</strong>ï¼Œå¸®åŠ©ä½ ç³»ç»ŸåŒ–åœ°å®Œæˆä»ä¿¡æ¯æ”¶é›†åˆ°ä»£ç ä¿®æ”¹çš„æ•´ä¸ªé€†å‘å·¥ç¨‹è¿‡ç¨‹ã€‚</p>
<hr />
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…å¤‡å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>APK æå–</strong></td>
  <td>ADB + Package Manager</td>
</tr>
<tr>
  <td><strong>è§£åŒ…/å›åŒ…</strong></td>
  <td>Apktool</td>
</tr>
<tr>
  <td><strong>åç¼–è¯‘å·¥å…·</strong></td>
  <td>Jadx-GUIï¼ˆæ¨èï¼‰æˆ– JEB</td>
</tr>
<tr>
  <td><strong>åŠ¨æ€åˆ†æ</strong></td>
  <td>Frida + Frida-tools</td>
</tr>
<tr>
  <td><strong>Root è®¾å¤‡/æ¨¡æ‹Ÿå™¨</strong></td>
  <td>Genymotionã€å¤œç¥ã€é›·ç”µç­‰</td>
</tr>
</tbody>
</table>
<h3>å¯é€‰å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Native åˆ†æ</strong></td>
  <td>IDA Pro / Ghidra / Binary Ninja</td>
</tr>
<tr>
  <td><strong>ç½‘ç»œæŠ“åŒ…</strong></td>
  <td>mitmproxy / Burp Suite / Charles</td>
</tr>
<tr>
  <td><strong>è°ƒè¯•å™¨</strong></td>
  <td>Android Studio / jdb</td>
</tr>
<tr>
  <td><strong>ç­¾åå·¥å…·</strong></td>
  <td>apksignerï¼ˆAndroid SDK è‡ªå¸¦ï¼‰</td>
</tr>
<tr>
  <td><strong>åŠ å£³æ£€æµ‹</strong></td>
  <td>PKid / ApkTool-Plus</td>
</tr>
</tbody>
</table>
<hr />
<h2>å‰ç½®çŸ¥è¯†</h2>
<ul>
<li>äº†è§£ Android åŸºæœ¬æ¶æ„ï¼ˆå››å¤§ç»„ä»¶ã€Manifest æ–‡ä»¶ï¼‰</li>
<li>æŒæ¡åŸºæœ¬ Java/Smali è¯­æ³•</li>
<li>ç†Ÿæ‚‰ ADB å‘½ä»¤</li>
<li>æ‹¥æœ‰ Root è®¾å¤‡ï¼ˆåŠ¨æ€åˆ†æå¿…éœ€ï¼‰</li>
</ul>
<hr />
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h3>æ ¸å¿ƒåŸåˆ™</h3>
<blockquote>
<p><strong>ç”±å¤–åˆ°å†…ã€ç”±æµ…å…¥æ·±ã€é™åŠ¨ç»“åˆ</strong></p>
<ol>
<li><strong>ä¿¡æ¯ä¾¦å¯Ÿ</strong> â†’ äº†è§£åº”ç”¨åŸºæœ¬ä¿¡æ¯å’ŒæŠ€æœ¯æ ˆ</li>
<li><strong>é™æ€åˆ†æ</strong> â†’ ç†è§£ä»£ç é€»è¾‘å’Œç®—æ³•</li>
<li><strong>åŠ¨æ€éªŒè¯</strong> â†’ è§‚å¯Ÿå®é™…è¡Œä¸ºã€ç»•è¿‡ä¿æŠ¤</li>
<li><strong>ä»£ç ä¿®æ”¹</strong> â†’ å®ç°æ°¸ä¹…æ€§æ”¹åŠ¨</li>
</ol>
</blockquote>
<hr />
<h2>é˜¶æ®µä¸€ï¼šä¿¡æ¯æ”¶é›†ä¸åˆæ­¥åˆ†æï¼ˆ15-30 åˆ†é’Ÿï¼‰</h2>
<p><strong>ç›®æ ‡</strong>ï¼šåœ¨ä¸è¿è¡Œåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿäº†è§£åŸºæœ¬ä¿¡æ¯ã€åŠŸèƒ½å’Œæ½œåœ¨å…¥å£ç‚¹ã€‚</p>
<h3>æ­¥éª¤ 1ï¼šè·å– APK æ–‡ä»¶</h3>
<h4>æ–¹æ³• Aï¼šä»å·²å®‰è£…åº”ç”¨æå–</h4>
<pre><code class="language-bash"># 1. åˆ—å‡ºæ‰€æœ‰åŒ…å
adb shell pm list packages | grep &lt;å…³é”®è¯&gt;

# ç¤ºä¾‹ï¼šæŸ¥æ‰¾éŸ³ä¹åº”ç”¨
adb shell pm list packages | grep music
# è¾“å‡ºï¼špackage:com.example.musicapp

# 2. è·å– APK è·¯å¾„
adb shell pm path com.example.musicapp
# è¾“å‡ºï¼špackage:/data/app/~~ABC123/com.example.musicapp-XYZ456/base.apk

# 3. æ‹‰å–åˆ°æœ¬åœ°
adb pull /data/app/~~ABC123/com.example.musicapp-XYZ456/base.apk ./target.apk
</code></pre>
<h4>ä¸€é”®è„šæœ¬ï¼ˆä¿å­˜ä¸º pull-apk.shï¼‰</h4>
<pre><code class="language-bash">#!/bin/bash
PACKAGE=$1
APK_PATH=$(adb shell pm path $PACKAGE | cut -d: -f2 | tr -d '\r')
adb pull $APK_PATH ./$PACKAGE.apk
echo &quot;[+] APK å·²ä¿å­˜: $PACKAGE.apk&quot;
</code></pre>
<h3>æ­¥éª¤ 2ï¼šè§£åŒ… APK</h3>
<pre><code class="language-bash"># ä½¿ç”¨ Apktoolï¼ˆæ¨è - è§£ç èµ„æºå’Œ Smaliï¼‰
apktool d target.apk -o target_unpacked

# è¾“å‡ºç›®å½•ç»“æ„ï¼š
# target_unpacked/
# â”œâ”€â”€ AndroidManifest.xml (å·²è§£ç )
# â”œâ”€â”€ apktool.yml
# â”œâ”€â”€ smali/ (Dalvik å­—èŠ‚ç )
# â”œâ”€â”€ smali_classes2/ (å¤šä¸ª DEX)
# â”œâ”€â”€ res/ (èµ„æºæ–‡ä»¶)
# â”œâ”€â”€ lib/ (native åº“)
# â”œâ”€â”€ assets/ (èµ„äº§æ–‡ä»¶)
# â””â”€â”€ original/

# å¿«é€ŸæŸ¥çœ‹ï¼ˆä¸è§£ç ï¼‰
unzip -l target.apk
unzip target.apk -d target_quick
</code></pre>
<h3>æ­¥éª¤ 3ï¼šåˆ†æ AndroidManifest.xml</h3>
<pre><code class="language-bash"># æŸ¥çœ‹å·²è§£ç çš„ manifest
cat target_unpacked/AndroidManifest.xml

# æˆ–ä½¿ç”¨å·¥å…·ç¾åŒ–
xmllint --format target_unpacked/AndroidManifest.xml
</code></pre>
<p><strong>å…³é”®ä¿¡æ¯æå–è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
  <th>ä¿¡æ¯é¡¹</th>
  <th>ä½ç½®</th>
  <th>æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>åŒ…å</strong></td>
  <td><code>&lt;manifest package=&quot;...&quot;&gt;</code></td>
  <td>åº”ç”¨å”¯ä¸€æ ‡è¯†</td>
</tr>
<tr>
  <td><strong>å…¥å£ Activity</strong></td>
  <td><code>&lt;activity&gt;</code> å¸¦ <code>LAUNCHER</code> intent</td>
  <td>åº”ç”¨å¯åŠ¨å…¥å£</td>
</tr>
<tr>
  <td><strong>Application ç±»</strong></td>
  <td><code>&lt;application android:name=&quot;...&quot;&gt;</code></td>
  <td>è‡ªå®šä¹‰ Applicationï¼ˆå¯èƒ½æœ‰åˆå§‹åŒ–é€»è¾‘ï¼‰</td>
</tr>
<tr>
  <td><strong>æƒé™</strong></td>
  <td><code>&lt;uses-permission&gt;</code></td>
  <td>æ¨æ–­åŠŸèƒ½ï¼ˆç½‘ç»œã€å­˜å‚¨ã€ä½ç½®ç­‰ï¼‰</td>
</tr>
<tr>
  <td><strong>è°ƒè¯•æ ‡å¿—</strong></td>
  <td><code>android:debuggable=&quot;true&quot;</code></td>
  <td>å¯ç›´æ¥è°ƒè¯•</td>
</tr>
<tr>
  <td><strong>å¤‡ä»½æ ‡å¿—</strong></td>
  <td><code>android:allowBackup=&quot;true&quot;</code></td>
  <td>æ•°æ®å¯å¯¼å‡º</td>
</tr>
<tr>
  <td><strong>å¯¼å‡ºç»„ä»¶</strong></td>
  <td><code>android:exported=&quot;true&quot;</code></td>
  <td>å¯è¢«å¤–éƒ¨è°ƒç”¨</td>
</tr>
<tr>
  <td><strong>URL Scheme</strong></td>
  <td><code>&lt;intent-filter&gt;</code> å¸¦ <code>&lt;data&gt;</code></td>
  <td>Deep link å…¥å£ç‚¹</td>
</tr>
<tr>
  <td><strong>ContentProvider</strong></td>
  <td><code>&lt;provider&gt;</code></td>
  <td>æ•°æ®åº“æ¥å£</td>
</tr>
<tr>
  <td><strong>Service</strong></td>
  <td><code>&lt;service&gt;</code></td>
  <td>åå°æœåŠ¡</td>
</tr>
</tbody>
</table>
<h4>çœŸå®æ¡ˆä¾‹ï¼šåˆ†æè…¾è®¯ä¹å›ºåº”ç”¨</h4>
<pre><code class="language-xml">&lt;application
    android:name=&quot;com.tencent.StubShell.TxAppEntry&quot;  &lt;!-- åŠ å£³ç‰¹å¾ --&gt;
    android:debuggable=&quot;false&quot;
    android:allowBackup=&quot;false&quot;&gt;

    &lt;activity android:name=&quot;.MainActivity&quot;
        android:exported=&quot;true&quot;&gt;  &lt;!-- å¯å¤–éƒ¨å¯åŠ¨ --&gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;
            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;
        &lt;/intent-filter&gt;

        &lt;!-- è‡ªå®šä¹‰ URL Scheme --&gt;
        &lt;intent-filter&gt;
            &lt;data android:scheme=&quot;myapp&quot; android:host=&quot;open&quot;/&gt;
            &lt;action android:name=&quot;android.intent.action.VIEW&quot;/&gt;
            &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;
        &lt;/intent-filter&gt;
    &lt;/activity&gt;
&lt;/application&gt;
</code></pre>
<p><strong>åˆ†æç»“è®º</strong>ï¼š</p>
<ul>
<li>å¯é€šè¿‡ <code>myapp://open</code> URL å¯åŠ¨</li>
<li>è°ƒè¯•å’Œå¤‡ä»½å·²ç¦ç”¨ï¼ˆå®‰å…¨é…ç½®è‰¯å¥½ï¼‰</li>
</ul>
<hr />
<h3>æ­¥éª¤ 4ï¼šå¿«é€Ÿç›®å½•ç»“æ„å®¡æŸ¥</h3>
<pre><code class="language-bash"># æŸ¥çœ‹ native åº“
ls -lh target_unpacked/lib/*/
# è¾“å‡ºç¤ºä¾‹ï¼š
# lib/arm64-v8a/libnative-lib.so (2.3 MB) â† Native ä»£ç 
# lib/arm64-v8a/libencrypt.so (450 KB) â† å¯èƒ½æ˜¯åŠ å¯†åº“
# lib/armeabi-v7a/libnative-lib.so

# æŸ¥çœ‹èµ„äº§æ–‡ä»¶
ls -lh target_unpacked/assets/
# è¾“å‡ºç¤ºä¾‹ï¼š
# config.json â† é…ç½®æ–‡ä»¶
# encrypted.dat â† åŠ å¯†æ•°æ®
# web/index.html â† H5 é¡µé¢

# ç»Ÿè®¡ Smali æ–‡ä»¶æ•°é‡ï¼ˆä¼°ç®—ä»£ç è§„æ¨¡ï¼‰
find target_unpacked/smali* -name &quot;*.smali&quot; | wc -l
# è¾“å‡ºï¼š8432 (çº¦ 8000+ ç±»)

# æœç´¢å¯ç–‘å…³é”®è¯
grep -r &quot;password&quot; target_unpacked/smali/ | head -n 10
grep -r &quot;encrypt&quot; target_unpacked/smali/ | head -n 10
</code></pre>
<p><strong>é˜¶æ®µä¸€äº§å‡º</strong>ï¼š</p>
<ul>
<li>æŠ€æœ¯æ ˆè¯†åˆ«ï¼ˆæ˜¯å¦åŠ å£³ã€æ˜¯å¦ä½¿ç”¨ native ä»£ç ï¼‰</li>
<li>æ½œåœ¨æ”»å‡»é¢ï¼ˆå¯¼å‡ºç»„ä»¶ã€URL Schemeï¼‰</li>
<li>åˆæ­¥åˆ†ææ–¹å‘ï¼ˆåº”è¯¥æ·±å…¥å“ªé‡Œï¼‰</li>
</ul>
<hr />
<h2>é˜¶æ®µäºŒï¼šé™æ€åˆ†æï¼ˆ1-3 å°æ—¶ï¼‰</h2>
<p><strong>ç›®æ ‡</strong>ï¼šé€šè¿‡åç¼–è¯‘ç†è§£åº”ç”¨å¦‚ä½•å·¥ä½œã€ç®—æ³•å’Œä¸šåŠ¡é€»è¾‘ã€‚</p>
<h3>æ­¥éª¤ 1ï¼šä½¿ç”¨ Jadx åç¼–è¯‘</h3>
<pre><code class="language-bash"># å¯åŠ¨ Jadx GUI
jadx-gui target.apk

# æˆ–å‘½ä»¤è¡Œæ¨¡å¼
jadx -d target_decompiled target.apk
</code></pre>
<p><strong>å…³é”®æœç´¢è¯</strong>ï¼š</p>
<ul>
<li>&quot;encrypt&quot;ã€&quot;decrypt&quot;ã€&quot;AES&quot;ã€&quot;DES&quot; â†’ åŠ å¯†ç®—æ³•</li>
<li>&quot;http&quot;ã€&quot;api&quot;ã€&quot;request&quot; â†’ ç½‘ç»œè¯·æ±‚</li>
<li>&quot;premium&quot;ã€&quot;vip&quot;ã€&quot;paid&quot; â†’ ä¼šå‘˜æ£€æŸ¥</li>
<li>&quot;signature&quot;ã€&quot;sign&quot; â†’ ç­¾åç®—æ³•</li>
<li>&quot;root&quot;ã€&quot;frida&quot;ã€&quot;xposed&quot; â†’ åæ£€æµ‹</li>
</ul>
<p><strong>å®šä½å…³é”®ä»£ç </strong>ï¼š</p>
<ol>
<li>ä»å…¥å£ Activity å¼€å§‹ï¼ˆ<code>MainActivity.onCreate()</code>ï¼‰</li>
<li>æ£€æŸ¥ Application å­ç±»ï¼ˆ<code>Application.onCreate()</code> - åˆå§‹åŒ–é€»è¾‘ï¼‰</li>
<li>æœç´¢å­—ç¬¦ä¸²å¸¸é‡ï¼ˆå³é”® â†’ &quot;æŸ¥æ‰¾ç”¨æ³•&quot;ï¼‰</li>
<li>åˆ†æç½‘ç»œè¯·æ±‚ï¼ˆOkHttpã€Retrofitã€HttpURLConnectionï¼‰</li>
<li>è¿½è¸ªç”¨æˆ·è¾“å…¥å¤„ç†ï¼ˆ<code>onClick</code> å›è°ƒï¼‰</li>
</ol>
<p><strong>ä»£ç å¯¼èˆªå¿«æ·é”®</strong>ï¼š</p>
<ul>
<li>Ctrl+Hï¼šæŸ¥çœ‹ç±»å±‚æ¬¡ç»“æ„</li>
<li>Ctrl+F12ï¼šæŸ¥çœ‹å½“å‰ç±»çš„æ‰€æœ‰æ–¹æ³•</li>
</ul>
<hr />
<h3>æ­¥éª¤ 2ï¼šè¯†åˆ«ä»£ç æ¨¡å¼</h3>
<h4>æ­£å¸¸ä»£ç </h4>
<pre><code class="language-java">// å¯è¯»çš„ç±»åå’Œæ–¹æ³•å
public class LoginManager {
    private static final String API_URL = &quot;https://api.example.com/login&quot;;

    public boolean login(String username, String password) {
        String encryptedPassword = AESUtil.encrypt(password);
        return ApiClient.post(API_URL, username, encryptedPassword);
    }
}
</code></pre>
<h4>æ··æ·†ä»£ç </h4>
<pre><code class="language-java">// ProGuard/R8 æ··æ·†
public class a {
    private static final String a = &quot;https://api.example.com/login&quot;;

    public boolean a(String str, String str2) {
        String b = b.a(str2);  // å­—ç¬¦ä¸²å¸¸é‡é€šå¸¸ä¼šä¿ç•™
        return c.a(a, str, b);
    }
}
</code></pre>
<hr />
<h3>æ­¥éª¤ 3ï¼šåˆ†æ Native åº“</h3>
<p>å¦‚æœåº”ç”¨åŒ…å« <code>.so</code> æ–‡ä»¶ï¼Œæ ¸å¿ƒç®—æ³•é€šå¸¸åœ¨è¿™é‡Œå®ç°ã€‚</p>
<h4>æ–¹æ³• Aï¼šä½¿ç”¨ IDA Pro åˆ†æ</h4>
<pre><code class="language-bash"># 1. æ‰“å¼€ SO æ–‡ä»¶
ida64 target_unpacked/lib/arm64-v8a/libnative-lib.so

# 2. ç­‰å¾…è‡ªåŠ¨åˆ†æå®Œæˆ

# 3. æŸ¥çœ‹å¯¼å‡ºå‡½æ•°ï¼ˆExports çª—å£ï¼‰
# æŸ¥æ‰¾ JNI å‡½æ•°å‘½åæ¨¡å¼ï¼š
# Java_com_example_app_NativeHelper_encrypt
# Java_&lt;åŒ…å&gt;_&lt;ç±»å&gt;_&lt;æ–¹æ³•å&gt;

# 4. åç¼–è¯‘å…³é”®å‡½æ•°ï¼ˆF5 åç¼–è¯‘ä¸ºä¼ªä»£ç ï¼‰
</code></pre>
<h4>æ–¹æ³• Bï¼šä½¿ç”¨ Ghidra åˆ†æ</h4>
<pre><code class="language-bash"># 1. å¯åŠ¨ Ghidra
ghidraRun

# 2. æ–°å»ºé¡¹ç›® â†’ å¯¼å…¥æ–‡ä»¶ â†’ é€‰æ‹© .so æ–‡ä»¶

# 3. åŒå‡»æ–‡ä»¶ â†’ è‡ªåŠ¨åˆ†æ

# 4. çª—å£ â†’ Symbol Tree â†’ Exports
# æŸ¥çœ‹å¯¼å‡ºå‡½æ•°åˆ—è¡¨

# 5. åŒå‡»å‡½æ•° â†’ åç¼–è¯‘ï¼ˆå³ä¾§é¢æ¿æ˜¾ç¤º C ä¼ªä»£ç ï¼‰
</code></pre>
<h4>æ–¹æ³• Cï¼šå¿«é€Ÿå‘½ä»¤è¡Œåˆ†æ</h4>
<pre><code class="language-bash"># æŸ¥çœ‹å¯¼å‡ºå‡½æ•°
nm -D libnative-lib.so | grep Java
# è¾“å‡ºç¤ºä¾‹ï¼š
# 00012340 T Java_com_example_app_Crypto_encrypt
# 00012680 T Java_com_example_app_Crypto_decrypt
# 00012a00 T Java_com_example_app_Sign_generate

# æœç´¢å­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ‰¾åˆ°åŠ å¯†å¯†é’¥ï¼‰
strings libnative-lib.so | grep -i &quot;key\|secret\|password&quot;
</code></pre>
<h3>æ­¥éª¤ 4ï¼šåˆ›å»ºåˆ†æç¬”è®°</h3>
<pre><code class="language-markdown">## åˆ†æç›®æ ‡

- æå–ç™»å½• API ç­¾åç®—æ³•
- ç»•è¿‡ VIP ä¼šå‘˜æ£€æŸ¥
- è·å–åŠ å¯†å¯†é’¥

## å·²å®šä½çš„å…³é”®ç±»/æ–¹æ³•

1. `com.example.app.utils.SignUtil.generateSign(Map params)` - ç­¾åç”Ÿæˆ
2. `com.example.app.user.UserManager.isPremium()` - ä¼šå‘˜æ£€æŸ¥
3. Native: `Java_com_example_app_Crypto_encrypt` - åŠ å¯†å‡½æ•°

## Hook ç­–ç•¥

- Hook `generateSign()` æŸ¥çœ‹å‚æ•°å’Œè¿”å›å€¼
- Hook `isPremium()` å¼ºåˆ¶è¿”å› true
- Hook native å‡½æ•°è·å–åŠ å¯†å¯†é’¥

## é¢„æœŸæŒ‘æˆ˜

- ç­¾åç®—æ³•å¯èƒ½åœ¨ native å±‚
- å¯èƒ½æœ‰ Frida æ£€æµ‹
- ç½‘ç»œè¯·æ±‚å¯èƒ½æœ‰ SSL pinning
</code></pre>
<h3>é˜¶æ®µäºŒäº§å‡º</h3>
<ul>
<li>ç†è§£åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘</li>
<li>å®šä½å…³é”®ç±»ã€æ–¹æ³•å’Œ native å‡½æ•°</li>
<li>è¯†åˆ«ä½¿ç”¨çš„åŠ å¯†/ç­¾åç®—æ³•</li>
<li>ç¡®å®šåŠ¨æ€åˆ†æçš„ hook ç‚¹æ¸…å•</li>
<li>è¯†åˆ«æ½œåœ¨çš„åè°ƒè¯•/å hook æœºåˆ¶</li>
</ul>
<hr />
<h2>é˜¶æ®µä¸‰ï¼šåŠ¨æ€åˆ†æï¼ˆ2-4 å°æ—¶ï¼‰</h2>
<p><strong>ç›®æ ‡</strong>ï¼šåœ¨è¿è¡Œæ—¶è§‚å¯Ÿå®é™…è¡Œä¸ºï¼ŒéªŒè¯é™æ€åˆ†æç»“è®ºï¼Œç»•è¿‡ä¿æŠ¤æœºåˆ¶ã€‚</p>
<h3>æ­¥éª¤ 1ï¼šè®¾ç½® Frida ç¯å¢ƒ</h3>
<pre><code class="language-bash"># 1. å¯åŠ¨ Frida Serverï¼ˆåœ¨è®¾å¤‡ä¸Šï¼‰
adb push frida-server /data/local/tmp/
adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;
adb shell &quot;/data/local/tmp/frida-server &amp;&quot;

# 2. éªŒè¯è¿æ¥ï¼ˆåœ¨ PC ä¸Šï¼‰
frida-ps -U
# åº”è¯¥çœ‹åˆ°è®¾å¤‡ä¸Šè¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨

# 3. æµ‹è¯• hook
frida -U -f com.example.app --no-pause
# è¿›å…¥äº¤äº’å¼æ§åˆ¶å°
</code></pre>
<h3>æ­¥éª¤ 2ï¼šç¼–å†™ Hook è„šæœ¬</h3>
<p>åŸºäºé™æ€åˆ†æç»“æœï¼Œç¼–å†™ Frida è„šæœ¬ã€‚</p>
<h4>ç¤ºä¾‹ 1ï¼šHook ä¼šå‘˜æ£€æŸ¥</h4>
<pre><code class="language-javascript">// hook_premium.js - ç»•è¿‡ VIP æ£€æŸ¥

Java.perform(function () {
    console.log(&quot;[+] å¼€å§‹ hook ä¼šå‘˜æ£€æŸ¥...&quot;);

    var UserManager = Java.use(&quot;com.example.app.user.UserManager&quot;);

    // Hook isPremium æ–¹æ³•
    UserManager.isPremium.implementation = function () {
        console.log(&quot;[+] isPremium() è¢«è°ƒç”¨&quot;);

        // è°ƒç”¨åŸå§‹æ–¹æ³•æŸ¥çœ‹çœŸå®ç»“æœ
        var realResult = this.isPremium();
        console.log(&quot;    çœŸå®è¿”å›å€¼: &quot; + realResult);

        // å¼ºåˆ¶è¿”å› true
        console.log(&quot;    ä¿®æ”¹è¿”å›å€¼: true&quot;);
        return true;
    };

    console.log(&quot;[+] Hook å®Œæˆ&quot;);
});
</code></pre>
<h4>ç¤ºä¾‹ 2ï¼šæå–ç­¾åç®—æ³•</h4>
<pre><code class="language-javascript">// hook_sign.js - æå–ç­¾åç®—æ³•

Java.perform(function() {
    var SignUtil = Java.use(&quot;com.example.app.utils.SignUtil&quot;);

    SignUtil.generateSign.implementation = function(params) {
        console.log(&quot;\n[SIGN] generateSign() è¢«è°ƒç”¨&quot;);
        console.log(&quot;    å‚æ•°ç±»å‹: &quot; + params.$className);

        // å¦‚æœæ˜¯ Mapï¼Œéå†æ‰“å°
        if (params.$className === &quot;java.util.HashMap&quot;) {
            var HashMap = Java.use(&quot;java.util.HashMap&quot;);
            var entrySet = params.entrySet();
            var iterator = entrySet.iterator();

            console.log(&quot;    å‚æ•°å†…å®¹:&quot;);
            while (iterator.hasNext()) {
                var entry = iterator.next();
                var key = entry.getKey();
                var value = entry.getValue();
                console.log(&quot;        &quot; + key + &quot; = &quot; + value);
            }
        }

        // è°ƒç”¨åŸå§‹æ–¹æ³•
        var result = this.generateSign(params);

        console.log(&quot;    ç­¾åç»“æœ: &quot; + result);
        console.log(&quot;    ç­¾åé•¿åº¦: &quot; + result.length);

        // æ‰“å°è°ƒç”¨æ ˆ
        console.log(&quot;    è°ƒç”¨æ ˆ:&quot;);
        console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(
            Java.use(&quot;java.lang.Exception&quot;).$new()
        ));

        return result;
    };

    console.log(&quot;[+] ç­¾å hook å®Œæˆ&quot;);
});
</code></pre>
<h4>ç¤ºä¾‹ 3ï¼šHook Native å‡½æ•°</h4>
<pre><code class="language-javascript">// hook_native.js - Hook native åŠ å¯†å‡½æ•°

var encryptAddr = Module.findExportByName(&quot;libnative-lib.so&quot;,
    &quot;Java_com_example_app_Crypto_encrypt&quot;);

if (encryptAddr) {
    console.log(&quot;[+] æ‰¾åˆ° encrypt å‡½æ•°: &quot; + encryptAddr);

    Interceptor.attach(encryptAddr, {
        onEnter: function(args) {
            console.log(&quot;\n[NATIVE] encrypt() è¢«è°ƒç”¨&quot;);
            console.log(&quot;    JNIEnv*: &quot; + args[0]);
            console.log(&quot;    jobject: &quot; + args[1]);

            // ç¬¬ 3 ä¸ªå‚æ•°é€šå¸¸æ˜¯ jstringï¼ˆè¾“å…¥æ•°æ®ï¼‰
            try {
                var env = Java.vm.getEnv();
                var inputStr = env.getStringUtfChars(args[2], null);
                var input = inputStr.readCString();
                console.log(&quot;    è¾“å…¥: &quot; + input);
                env.releaseStringUtfChars(args[2], inputStr);
            } catch (e) {
                console.log(&quot;    è¾“å…¥: [æ— æ³•è¯»å–]&quot;);
            }
        },

        onLeave: function(retval) {
            // è¿”å›å€¼ä¹Ÿæ˜¯ jstringï¼ˆå¯†æ–‡ï¼‰
            try {
                var env = Java.vm.getEnv();
                var outputStr = env.getStringUtfChars(retval, null);
                var output = outputStr.readCString();
                console.log(&quot;    è¾“å‡º: &quot; + output);
                env.releaseStringUtfChars(retval, outputStr);
            } catch (e) {
                console.log(&quot;    è¾“å‡º: &quot; + retval);
            }
        }
    });

    console.log(&quot;[+] Native hook å®Œæˆ&quot;);
} else {
    console.log(&quot;[-] æœªæ‰¾åˆ° encrypt å‡½æ•°&quot;);
}
</code></pre>
<h3>æ­¥éª¤ 3ï¼šç»•è¿‡åè°ƒè¯•æ£€æµ‹</h3>
<pre><code class="language-javascript">// bypass_all.js - ç»¼åˆç»•è¿‡è„šæœ¬

Java.perform(function() {
    console.log(&quot;[+] åŠ è½½åæ£€æµ‹æ¨¡å—...&quot;);

    // 1. ç»•è¿‡ Frida ç«¯å£æ£€æµ‹
    var connect = Module.findExportByName(&quot;libc.so&quot;, &quot;connect&quot;);
    Interceptor.attach(connect, {
        onEnter: function(args) {
            var sockaddr = ptr(args[1]);
            var port = (sockaddr.add(2).readU8() &lt;&lt; 8) | sockaddr.add(3).readU8();
            if (port === 27042 || port === 27043) {
                console.log(&quot;[æ£€æµ‹] æ‹¦æˆªäº† Frida ç«¯å£æ‰«æ&quot;);
                sockaddr.add(2).writeU8(0xFF);
            }
        }
    });

    // 2. ç»•è¿‡ TracerPid æ£€æµ‹
    var fgets = Module.findExportByName(&quot;libc.so&quot;, &quot;fgets&quot;);
    Interceptor.attach(fgets, {
        onLeave: function(retval) {
            if (retval &amp;&amp; !retval.isNull()) {
                var line = retval.readCString();
                if (line &amp;&amp; line.includes(&quot;TracerPid:&quot;)) {
                    retval.writeUtf8String(&quot;TracerPid:\t0\n&quot;);
                    console.log(&quot;[æ£€æµ‹] ä¿®æ”¹ TracerPid ä¸º 0&quot;);
                }
            }
        }
    });

    // 3. ç»•è¿‡å­—ç¬¦ä¸²æ£€æµ‹
    var strstr = Module.findExportByName(&quot;libc.so&quot;, &quot;strstr&quot;);
    Interceptor.attach(strstr, {
        onLeave: function(retval) {
            if (this.needle &amp;&amp; this.needle.toLowerCase().includes(&quot;frida&quot;)) {
                retval.replace(ptr(0));
                console.log(&quot;[æ£€æµ‹] éšè— Frida å­—ç¬¦ä¸²&quot;);
            }
        },
        onEnter: function(args) {
            this.needle = args[1].readCString();
        }
    });

    console.log(&quot;[+] åæ£€æµ‹æ¨¡å—åŠ è½½å®Œæˆ&quot;);
});
</code></pre>
<h3>æ­¥éª¤ 4ï¼šè¿è¡Œåˆ†æ</h3>
<pre><code class="language-bash"># ç»„åˆä½¿ç”¨å¤šä¸ªè„šæœ¬
frida -U -f com.example.app \
    -l bypass_all.js \
    -l hook_premium.js \
    --no-pause
</code></pre>
<h3>æ­¥éª¤ 5ï¼šç½‘ç»œæµé‡åˆ†æ</h3>
<pre><code class="language-bash"># 1. é…ç½®ä»£ç†
adb shell settings put global http_proxy 192.168.1.100:8080

# 2. å¯åŠ¨åº”ç”¨å¹¶ç»•è¿‡ SSL pinning
frida -U -f com.example.app -l bypass_ssl_pinning.js --no-pause

# 3. åœ¨ Burp Suite ä¸­æŸ¥çœ‹æµé‡
</code></pre>
<h4>Hook OkHttp è¯·æ±‚</h4>
<pre><code class="language-javascript">// hook_okhttp.js
Java.perform(function() {
    var RealInterceptorChain = Java.use(&quot;okhttp3.internal.http.RealInterceptorChain&quot;);

    RealInterceptorChain.proceed.implementation = function(request) {
        console.log(&quot;\n[HTTP] &quot; + request.method() + &quot; &quot; + request.url().toString());

        // æ‰“å°è¯·æ±‚å¤´
        var headers = request.headers();
        for (var i = 0; i &lt; headers.size(); i++) {
            console.log(&quot;    &quot; + headers.name(i) + &quot;: &quot; + headers.value(i));
        }

        var response = this.proceed(request);

        console.log(&quot;[RESP] Code: &quot; + response.code());

        return response;
    };
});
</code></pre>
<h3>é˜¶æ®µä¸‰äº§å‡º</h3>
<ul>
<li>æˆåŠŸç»•è¿‡ä¼šå‘˜æ£€æŸ¥ã€åè°ƒè¯•ç­‰é™åˆ¶</li>
<li>å®Œæ•´çš„ç½‘ç»œè¯·æ±‚/å“åº”æ—¥å¿—</li>
<li>å‡†å¤‡å¥½é‡æ‰“åŒ…çš„ä¿®æ”¹ç‚¹</li>
</ul>
<hr />
<h2>é˜¶æ®µå››ï¼šä»£ç ä¿®æ”¹ä¸é‡æ‰“åŒ…ï¼ˆ30-60 åˆ†é’Ÿï¼‰</h2>
<p><strong>ç›®æ ‡</strong>ï¼šå¯¹åº”ç”¨è¿›è¡Œæ°¸ä¹…æ€§ä¿®æ”¹ï¼Œå®ç°æŒä¹…åŒ–çš„åŠŸèƒ½æ”¹å˜ã€‚</p>
<h3>æ­¥éª¤ 1ï¼šä¿®æ”¹ Smali ä»£ç </h3>
<p>åŸºäºåŠ¨æ€åˆ†æç»“æœï¼Œåœ¨ Smali å±‚é¢è¿›è¡Œä¿®æ”¹ã€‚</p>
<h4>ç¤ºä¾‹ 1ï¼šç»•è¿‡ä¼šå‘˜æ£€æŸ¥</h4>
<p><strong>åŸå§‹ Java ä»£ç </strong>ï¼ˆJadx åç¼–è¯‘ï¼‰ï¼š</p>
<pre><code class="language-java">public boolean isPremium() {
    return this.userInfo.vipStatus == 1;
}
</code></pre>
<p><strong>åŸå§‹ Smali ä»£ç </strong>ï¼š</p>
<pre><code class="language-smali">.method public isPremium()Z
    .locals 2

    # è¯»å– userInfo.vipStatus
    iget-object v0, p0, Lcom/example/app/user/UserManager;-&gt;userInfo:Lcom/example/app/model/UserInfo;
    iget v0, v0, Lcom/example/app/model/UserInfo;-&gt;vipStatus:I

    # æ¯”è¾ƒæ˜¯å¦ç­‰äº 1
    const/4 v1, 0x1
    if-ne v0, v1, :cond_0

    # å¦‚æœç›¸ç­‰ï¼Œè¿”å› true
    const/4 v0, 0x1
    return v0

    # å¦‚æœä¸ç›¸ç­‰ï¼Œè¿”å› false
    :cond_0
    const/4 v0, 0x0
    return v0
.end method
</code></pre>
<p><strong>ä¿®æ”¹å Smali ä»£ç </strong>ï¼š</p>
<pre><code class="language-smali">.method public isPremium()Z
    .locals 1

    # ç›´æ¥è¿”å› trueï¼Œè·³è¿‡æ‰€æœ‰æ£€æŸ¥
    const/4 v0, 0x1
    return v0
.end method
</code></pre>
<h4>ç¤ºä¾‹ 2ï¼šç§»é™¤å¹¿å‘Šæ˜¾ç¤º</h4>
<p><strong>åŸå§‹ Smali ä»£ç </strong>ï¼š</p>
<pre><code class="language-smali">.method private showAd()V
    .locals 1

    # æ£€æŸ¥æ˜¯å¦ä¸æ˜¯ VIP
    invoke-virtual {p0}, Lcom/example/app/MainActivity;-&gt;isPremium()Z
    move-result v0

    # å¦‚æœä¸æ˜¯ VIPï¼Œæ˜¾ç¤ºå¹¿å‘Š
    if-nez v0, :cond_0
    invoke-direct {p0}, Lcom/example/app/MainActivity;-&gt;loadAdView()V

    :cond_0
    return-void
.end method
</code></pre>
<p><strong>ä¿®æ”¹å Smali ä»£ç </strong>ï¼š</p>
<pre><code class="language-smali">.method private showAd()V
    .locals 0

    # ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ
    return-void
.end method
</code></pre>
<h3>æ­¥éª¤ 2ï¼šé‡æ–°æ‰“åŒ… APK</h3>
<pre><code class="language-bash"># 1. ä½¿ç”¨ Apktool é‡æ‰“åŒ…
apktool b target_unpacked -o modified.apk

# è¾“å‡ºï¼š
# I: Using Apktool 2.x.x
# I: Checking whether sources has changed...
# I: Smali folder: smali
# I: Smali folder: smali_classes2
# I: Copying raw resources...
# I: Copying libs... (/lib)
# I: Copying assets... (/assets)
# I: Building apk file...
# I: Copying unknown files/dir...
# I: Built apk into: modified.apk

# 2. æ£€æŸ¥ç”Ÿæˆçš„ APK
ls -lh modified.apk
# -rw-r--r-- 1 user user 8.5M modified.apk
</code></pre>
<h3>æ­¥éª¤ 3ï¼šç­¾å APK</h3>
<pre><code class="language-bash"># 1. ç”Ÿæˆç­¾åå¯†é’¥ï¼ˆåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼‰
keytool -genkey -v \
    -keystore my-release-key.keystore \
    -alias my-key-alias \
    -keyalg RSA \
    -keysize 2048 \
    -validity 10000

# æç¤ºè¾“å…¥å¯†ç å’Œä¿¡æ¯ï¼š
# Enter keystore password: [è¾“å…¥å¯†ç ]
# Re-enter new password: [å†æ¬¡è¾“å…¥]
# What is your first and last name? [éšæ„å¡«å†™]
# ...

# 2. ç­¾å APK
apksigner sign \
    --ks my-release-key.keystore \
    --ks-key-alias my-key-alias \
    --out signed.apk \
    modified.apk

# æç¤ºè¾“å…¥ keystore å¯†ç 
# è¾“å‡ºï¼šsigned.apk

# 3. éªŒè¯ç­¾å
apksigner verify signed.apk
# è¾“å‡ºï¼šVerifies
# è¡¨ç¤ºç­¾åæˆåŠŸ
</code></pre>
<h4>ä½¿ç”¨ uber-apk-signerï¼ˆæ›´ç®€å•ï¼‰</h4>
<pre><code class="language-bash">java -jar uber-apk-signer.jar --apks modified.apk
# è¾“å‡ºï¼šmodified-aligned-debugSigned.apk
</code></pre>
<h3>æ­¥éª¤ 4ï¼šå®‰è£…æµ‹è¯•</h3>
<pre><code class="language-bash"># 1. å¸è½½åŸåº”ç”¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
adb uninstall com.example.app

# 2. å®‰è£…ä¿®æ”¹åçš„ APK
adb install signed.apk

# å¦‚æœé‡åˆ°ç­¾åå†²çªï¼š
# adb install -r signed.apk (æ›¿æ¢å®‰è£…)

# 3. å¯åŠ¨åº”ç”¨
adb shell am start -n com.example.app/.MainActivity

# 4. æŸ¥çœ‹æ—¥å¿—éªŒè¯ä¿®æ”¹
adb logcat | grep &quot;example.app&quot;
</code></pre>
<p><strong>éªŒè¯æ¸…å•</strong>ï¼š</p>
<ul>
<li>ä¿®æ”¹çš„åŠŸèƒ½ç”Ÿæ•ˆï¼ˆä¾‹å¦‚ VIP æƒé™è§£é”ï¼‰</li>
<li>æ²¡æœ‰å´©æºƒæˆ–å¼‚å¸¸è¡Œä¸º</li>
<li>ç½‘ç»œåŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚æœä¿®æ”¹äº†ç­¾åç›¸å…³ä»£ç ï¼‰</li>
</ul>
<h3>å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<pre><code class="language-bash"># æŸ¥çœ‹å´©æºƒæ—¥å¿—
adb logcat | grep &quot;AndroidRuntime&quot;

# å¸¸è§é”™è¯¯ï¼š
# 1. &quot;INSTALL_PARSE_FAILED_NO_CERTIFICATES&quot;
#    â†’ ç­¾åå¤±è´¥ï¼Œé‡æ–°ç­¾å

# 2. &quot;INSTALL_FAILED_UPDATE_INCOMPATIBLE&quot;
#    â†’ ç­¾åä¸åŒ¹é…ï¼Œå…ˆå¸è½½åŸåº”ç”¨

# 3. åº”ç”¨å´©æºƒ
#    â†’ æŸ¥çœ‹ logcatï¼Œå¯èƒ½æ˜¯ Smali è¯­æ³•é”™è¯¯
</code></pre>
<hr />
<h2>å·¥ä½œæµç¨‹æ€»ç»“</h2>
<pre><code class="language-text">ä¿¡æ¯æ”¶é›† (15-30 åˆ†é’Ÿ)
        â†“
    å¿«é€Ÿäº†è§£æŠ€æœ¯æ ˆ
    é¿å…ç›²ç›®åˆ†ææµªè´¹æ—¶é—´
        â†“
é™æ€åˆ†æ (1-3 å°æ—¶)
        â†“
    ç†è§£ä»£ç é€»è¾‘å’Œç®—æ³•
    å®šä½å…³é”®å‡½æ•°å’Œ hook ç‚¹
        â†“
åŠ¨æ€åˆ†æ (2-4 å°æ—¶)
        â†“
    éªŒè¯é™æ€åˆ†æç»“è®º
    ç»•è¿‡è¿è¡Œæ—¶ä¿æŠ¤
    è·å–å®é™…æ•°æ®ï¼ˆå¯†é’¥ã€API å‚æ•°ï¼‰
        â†“
ä»£ç ä¿®æ”¹ (30-60 åˆ†é’Ÿ)
        â†“
    æ°¸ä¹…æ€§ä¿®æ”¹
    æ— éœ€æ¯æ¬¡éƒ½ä½¿ç”¨ Frida
</code></pre>
<h3>é™æ€ vs åŠ¨æ€åˆ†æå¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>åœºæ™¯</th>
  <th>é™æ€åˆ†æ</th>
  <th>åŠ¨æ€åˆ†æ</th>
  <th>æ¨è</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ç»•è¿‡æ··æ·†</strong></td>
  <td>å›°éš¾</td>
  <td>å¯è¡Œ</td>
  <td>åŠ¨æ€</td>
</tr>
<tr>
  <td><strong>è·å–å¯†é’¥</strong></td>
  <td>éš¾ï¼ˆå¯èƒ½ç¡¬ç¼–ç ï¼‰</td>
  <td>æ˜“ï¼ˆè¿è¡Œæ—¶ï¼‰</td>
  <td>åŠ¨æ€</td>
</tr>
<tr>
  <td><strong>ä¿®æ”¹ä»£ç </strong></td>
  <td>ç²¾ç¡®</td>
  <td>ä¸æŒä¹…</td>
  <td>é™æ€</td>
</tr>
<tr>
  <td><strong>æ—¶é—´æˆæœ¬</strong></td>
  <td>é«˜ï¼ˆæœ‰æ··æ·†æ—¶ï¼‰</td>
  <td>ä¸­ç­‰</td>
  <td>ç»“åˆä½¿ç”¨</td>
</tr>
</tbody>
</table>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h3>é—®é¢˜ 1ï¼šApktool è§£åŒ…å¤±è´¥</h3>
<p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š<code>brut.androlib.AndrolibException: Could not decode arsc file</code></p>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li>APK ä½¿ç”¨äº†èµ„æºæ··æ·†ï¼ˆAndResGuardï¼‰</li>
<li>APK å·²æŸå</li>
<li>Apktool ç‰ˆæœ¬è¿‡æ—§</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-bash"># 1. æ›´æ–° Apktool åˆ°æœ€æ–°ç‰ˆæœ¬
# ä¸‹è½½ï¼šhttps://ibotpeaches.github.io/Apktool/

# 2. ä½¿ç”¨ -r å‚æ•°è·³è¿‡èµ„æºè§£ç 
apktool d target.apk -r -o target_unpacked
# -r: ä¸è§£ç èµ„æºæ–‡ä»¶ (resources.arsc)

# 3. ä½¿ç”¨ --only-main-classes ä»…è§£ç ä¸» DEX
apktool d target.apk --only-main-classes -o target_unpacked

# 4. å¦‚æœåªéœ€è¦ Smaliï¼Œç›´æ¥ä½¿ç”¨ dex2jar + jd-gui
d2j-dex2jar target.apk
# ç”Ÿæˆ target-dex2jar.jarï¼Œç”¨ JD-GUI æ‰“å¼€
</code></pre>
<h3>é—®é¢˜ 2ï¼šä»£ç æ··æ·†ä¸¥é‡æ— æ³•é˜…è¯»</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-bash"># 1. ä¼˜å…ˆä½¿ç”¨åŠ¨æ€åˆ†æ
# æ··æ·†çš„ä»£ç åœ¨è¿è¡Œæ—¶è¡Œä¸ºä¸å˜
# ä½¿ç”¨ Frida ç›´æ¥ hookï¼Œè§‚å¯Ÿå‚æ•°å’Œè¿”å›å€¼

# 2. åˆ©ç”¨å­—ç¬¦ä¸²å¸¸é‡å®šä½
# å­—ç¬¦ä¸²é€šå¸¸ä¸ä¼šè¢«æ··æ·†
# åœ¨ Jadx ä¸­æœç´¢å…³é”®å­—ç¬¦ä¸²ï¼Œåå‘å®šä½ä»£ç 

# 3. é‡å‘½åç±»/æ–¹æ³•ï¼ˆJadx æ”¯æŒï¼‰
# å³é”®ç±»å â†’ Rename
# æ ¹æ®åŠŸèƒ½æ‰‹åŠ¨é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°

# 4. ä½¿ç”¨ç¬¦å·è¿˜åŸå·¥å…·
# å¦‚æœæœ‰ mapping.txtï¼ˆæ··æ·†æ˜ å°„æ–‡ä»¶ï¼‰
# å¯ä»¥ä½¿ç”¨å·¥å…·è¿˜åŸç¬¦å·
</code></pre>
<h3>é—®é¢˜ 3ï¼šFrida æ— æ³•è¿æ¥åº”ç”¨</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li>åº”ç”¨æœªè¿è¡Œ</li>
<li>åŒ…åé”™è¯¯</li>
<li>Frida Server æœªå¯åŠ¨</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-bash"># 1. æ£€æŸ¥ Frida Server æ˜¯å¦è¿è¡Œ
adb shell ps | grep frida-server
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œéœ€è¦å¯åŠ¨ Frida Server

# 2. ç¡®è®¤åº”ç”¨æ­£åœ¨è¿è¡Œ
adb shell ps | grep com.example.app
# æˆ–
frida-ps -U | grep example

# 3. ä½¿ç”¨æ­£ç¡®çš„åŒ…å
# æŸ¥çœ‹å·²å®‰è£…åº”ç”¨çš„åŒ…å
adb shell pm list packages | grep example

# 4. ä½¿ç”¨ spawn æ¨¡å¼ï¼ˆè‡ªåŠ¨å¯åŠ¨åº”ç”¨ï¼‰
frida -U -f com.example.app -l script.js --no-pause
# -f: spawn æ¨¡å¼ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨åº”ç”¨

# 5. æ£€æŸ¥è®¾å¤‡è¿æ¥
adb devices
# åº”æ˜¾ç¤ºï¼šdeviceï¼ˆä¸æ˜¯ offline æˆ– unauthorizedï¼‰
</code></pre>
<h3>é—®é¢˜ 4ï¼šé‡æ‰“åŒ…ååº”ç”¨å´©æºƒ</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li>Smali è¯­æ³•é”™è¯¯</li>
<li>ä¿®æ”¹ç ´åäº†ç±»ç»“æ„</li>
<li>ç¼ºå°‘ä¾èµ–</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="language-bash"># 1. æŸ¥çœ‹è¯¦ç»†å´©æºƒæ—¥å¿—
adb logcat -c  # æ¸…ç©ºæ—¥å¿—
adb logcat | grep -E &quot;AndroidRuntime|FATAL&quot;

# 2. éªŒè¯ Smali è¯­æ³•
# ç”¨ Apktool é‡æ–°åç¼–è¯‘ä¿®æ”¹åçš„ APK
apktool d signed.apk -o verify_unpacked
# æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æç¤º

# 3. å›æ»šä¿®æ”¹ï¼Œé€æ­¥æµ‹è¯•
# å…ˆä¿®æ”¹å•ä¸ªæ–¹æ³•ï¼Œé€šè¿‡åå†ä¿®æ”¹å…¶ä»–

# 4. ä½¿ç”¨ baksmali/smali éªŒè¯
baksmali d modified.apk -o smali_test
smali a smali_test -o test.dex
# å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¯´æ˜ Smali è¯­æ³•æ­£ç¡®

# 5. æ£€æŸ¥æ–¹æ³•ç­¾åæ˜¯å¦æ­£ç¡®
# ç¡®ä¿ä¿®æ”¹çš„æ–¹æ³•ç­¾åä¸æ¥å£/çˆ¶ç±»åŒ¹é…
</code></pre>
<hr />
<h2>ç›¸å…³èµ„æº</h2>
<h3>ç›¸å…³é…æ–¹</h3>
<table>
<thead>
<tr>
  <th>Recipe</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="#section-3">Android åº”ç”¨ç½‘ç»œæµé‡åˆ†æ</a></td>
  <td>è¯¦ç»†çš„ç½‘ç»œæµé‡åˆ†ææ­¥éª¤</td>
</tr>
<tr>
  <td><a href="#section-8">ç»•è¿‡åº”ç”¨å¯¹ Frida çš„æ£€æµ‹</a></td>
  <td>åè°ƒè¯•ç»•è¿‡</td>
</tr>
<tr>
  <td><a href="#section-14">è„±å£³å’Œåˆ†æåŠ å›ºçš„ Android åº”ç”¨</a></td>
  <td>å¤„ç†åŠ å£³åº”ç”¨</td>
</tr>
<tr>
  <td><a href="#section-35">Frida å¸¸ç”¨è„šæœ¬é€ŸæŸ¥</a></td>
  <td>ç°æˆçš„è„šæœ¬æ¨¡æ¿</td>
</tr>
</tbody>
</table>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><a href="#section-40">Frida ä½¿ç”¨æŒ‡å—</a> - å®Œæ•´çš„ Frida ä½¿ç”¨æ‰‹å†Œ</li>
<li><a href="#section-46">Ghidra ä½¿ç”¨æŒ‡å—</a> - Native ä»£ç åˆ†æ</li>
<li><a href="#section-47">IDA Pro ä½¿ç”¨æŒ‡å—</a> - ä¸“ä¸šé€†å‘å·¥ç¨‹å·¥å…·</li>
</ul>
<h3>æ¡ˆä¾‹ç ”ç©¶</h3>
<ul>
<li><a href="#section-51">æ¡ˆä¾‹ï¼šéŸ³ä¹åº”ç”¨åˆ†æ</a> - å®Œæ•´å·¥ä½œæµç¨‹å®è·µ</li>
<li><a href="#section-53">æ¡ˆä¾‹ï¼šåº”ç”¨åŠ å¯†åˆ†æ</a></li>
</ul>
<h3>å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="#section-58">APK æ–‡ä»¶ç»“æ„è¯¦è§£</a></li>
<li><a href="#section-63">Smali è¯­æ³•å‚è€ƒ</a></li>
<li><a href="#section-59">Android ç»„ä»¶è¯¦è§£</a></li>
</ul>
<hr />
<h2>é€ŸæŸ¥æ‰‹å†Œ</h2>
<h3>å·¥ä½œæµç¨‹å¿«é€Ÿåœ°å›¾</h3>
<pre><code class="language-text">è§£åŒ… APK â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†æ Manifest â”€â”€â”€â”€â”€â”€â”€â”€ æŸ¥çœ‹ç›®å½•
    â”‚                   â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                  ç¡®å®šåˆ†ææ–¹å‘
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                               â†“
    é™æ€åˆ†æ                         åŠ¨æ€åˆ†æ
   (Jadx/IDA)                        (Frida)
        â”‚                               â”‚
        â”œâ”€ å®šä½å…³é”®ä»£ç                  â”‚
        â”œâ”€ ç†è§£ç®—æ³•é€»è¾‘                 â”‚
        â””â”€ ç¡®å®š hook ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                â†“                       â†“
            Hook éªŒè¯               ç»•è¿‡ä¿æŠ¤
                â”‚                       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                      æå–å…³é”®æ•°æ®
                     (å¯†é’¥/ç®—æ³•)
                            â†“
                       ä¿®æ”¹ Smali
                            â†“
                    é‡æ‰“åŒ… &amp; ç­¾å
                            â†“
                      æµ‹è¯• &amp; éªŒè¯
</code></pre>
<h3>å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3>
<table>
<thead>
<tr>
  <th>æ“ä½œ</th>
  <th>å·¥å…·</th>
  <th>å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>è§£åŒ…</strong></td>
  <td>Apktool</td>
  <td><code>apktool d app.apk -o unpacked</code></td>
</tr>
<tr>
  <td><strong>åç¼–è¯‘</strong></td>
  <td>Jadx</td>
  <td><code>jadx-gui app.apk</code></td>
</tr>
<tr>
  <td><strong>Native åˆ†æ</strong></td>
  <td>IDA/Ghidra</td>
  <td>ç›´æ¥æ‰“å¼€ <code>.so</code> æ–‡ä»¶</td>
</tr>
<tr>
  <td><strong>åŠ¨æ€åˆ†æ</strong></td>
  <td>Frida</td>
  <td><code>frida -U -f &lt;pkg&gt; -l script.js --no-pause</code></td>
</tr>
<tr>
  <td><strong>é‡æ‰“åŒ…</strong></td>
  <td>Apktool</td>
  <td><code>apktool b unpacked -o modified.apk</code></td>
</tr>
<tr>
  <td><strong>ç­¾å</strong></td>
  <td>apksigner</td>
  <td><code>apksigner sign --ks key.keystore --out signed.apk modified.apk</code></td>
</tr>
<tr>
  <td><strong>å®‰è£…</strong></td>
  <td>ADB</td>
  <td><code>adb install signed.apk</code></td>
</tr>
</tbody>
</table>
<h3>å¸¸ç”¨å¿«æ·æ“ä½œ</h3>
<pre><code class="language-bash"># 1. ä¸€é”®æå– APK è„šæœ¬ï¼ˆä¿å­˜ä¸º get-apk.shï¼‰
#!/bin/bash
PKG=$1
APK_PATH=$(adb shell pm path $PKG | cut -d: -f2 | tr -d '\r')
adb pull $APK_PATH ./$PKG.apk
echo &quot;[+] å·²ä¿å­˜: $PKG.apk&quot;

# ä½¿ç”¨ï¼š./get-apk.sh com.example.app

# 2. ä¸€é”®è§£åŒ… + åç¼–è¯‘
apktool d app.apk &amp;&amp; jadx-gui app.apk &amp;

# 3. å¿«é€ŸæŸ¥çœ‹ Manifest
apktool d -s app.apk -o temp &amp;&amp; cat temp/AndroidManifest.xml

# 4. è‡ªåŠ¨ç­¾åè„šæœ¬ï¼ˆä¿å­˜ä¸º sign-apk.shï¼‰
#!/bin/bash
APK=$1
java -jar uber-apk-signer.jar --apks $APK
echo &quot;[+] ç­¾å APK å·²åˆ›å»º&quot;

# 5. Frida å¿«é€Ÿ hookï¼ˆäº¤äº’æ¨¡å¼ï¼‰
frida -U com.example.app
# è¿›å…¥åæ‰§è¡Œ:
# Java.perform(function() {
#     var cls = Java.use(&quot;com.example.Class&quot;);
#     cls.method.implementation = function() { return true; };
# });
</code></pre>
<h3>å†³ç­–æ ‘</h3>
<pre><code class="language-text">æ‹¿åˆ° APK
    â”‚
    â”œâ”€ æœ‰æºç ?
    â”‚   â””â”€ æœ‰ â†’ ç›´æ¥é˜…è¯»ä»£ç  â†’ åŠ¨æ€éªŒè¯
    â”‚   â””â”€ æ—  â†’ ç»§ç»­
    â”‚
    â”œâ”€ æ˜¯å¦åŠ å£³?
    â”‚   â””â”€ æ˜¯ â†’ å…ˆè„±å£³ï¼ˆå‚è§è„±å£³ Recipeï¼‰
    â”‚   â””â”€ å¦ â†’ ç»§ç»­
    â”‚
    â”œâ”€ æ˜¯å¦æ··æ·†?
    â”‚   â””â”€ é‡åº¦æ··æ·† â†’ ä¼˜å…ˆåŠ¨æ€åˆ†æï¼ˆFridaï¼‰
    â”‚   â””â”€ è½»åº¦/æ—  â†’ ä¼˜å…ˆé™æ€åˆ†æï¼ˆJadxï¼‰
    â”‚
    â”œâ”€ Native ä»£ç å¤š?
    â”‚   â””â”€ æ˜¯ â†’ ç”¨ IDA/Ghidra åˆ†æ .so
    â”‚   â””â”€ å¦ â†’ ä¸“æ³¨ Java å±‚
    â”‚
    â””â”€ æœ‰åè°ƒè¯•?
        â””â”€ æ˜¯ â†’ å…ˆç»•è¿‡æ£€æµ‹
        â””â”€ å¦ â†’ ç›´æ¥ hook
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-19">
                                                <h2>19. R17: Static Analysis Deep Dive</h2>
                                                <h1>R17: Recipe: ä½¿ç”¨é™æ€åˆ†æå®šä½ android App çš„å…³é”®é€»è¾‘</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p><strong>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>ä½ æƒ³æ‰¾åˆ° App çš„åŠ å¯†/ç­¾åç®—æ³•ï¼Œä½†ä»£ç å¤ªå¤šä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹</li>
<li>ğŸ§© ä½ æƒ³ç†è§£ App çš„å®Œæ•´ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬æ‰€æœ‰åˆ†æ”¯å’Œè¾¹ç•Œæ¡ä»¶</li>
<li>ğŸ› ä½ æƒ³å¯»æ‰¾å®‰å…¨æ¼æ´ï¼Œæ¯”å¦‚ç¡¬ç¼–ç å¯†é’¥ã€é€»è¾‘ç¼ºé™·</li>
<li>ä½ æƒ³åœ¨æ²¡æœ‰è¿è¡Œç¯å¢ƒçš„æƒ…å†µä¸‹åˆ†æ APK</li>
<li>ä½ æƒ³è¿›è¡Œæ‰¹é‡è‡ªåŠ¨åŒ–åˆ†æ</li>
</ul>
<p><strong>æœ¬é…æ–¹æ•™ä½ </strong>ï¼šç³»ç»Ÿæ€§åœ°ä½¿ç”¨é™æ€åˆ†æå·¥å…·ï¼ˆjadx, IDA Pro, Ghidraï¼‰å¿«é€Ÿå®šä½å…³é”®ä»£ç ã€è¿½è¸ªæ•°æ®æµã€è¯†åˆ«åŠ å¯†ç®—æ³•ã€‚</p>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>é™æ€åˆ†æï¼šä¸è¿è¡Œä»£ç ï¼Œçœ‹æ¸…å…¨å±€</strong></p>
<ul>
<li>é™æ€åˆ†æèƒ½çœ‹åˆ°æ‰€æœ‰ä»£ç è·¯å¾„ï¼ˆåŒ…æ‹¬æœªè§¦å‘çš„åˆ†æ”¯ï¼‰</li>
<li>é€‚åˆç†è§£å®Œæ•´ç®—æ³•å’Œå¯»æ‰¾æ¼æ´</li>
<li>å…ˆåŠ¨æ€è·å–çº¿ç´¢ï¼Œå†é™æ€æ·±å…¥åˆ†æ</li>
<li>äº¤æ›¿è¿­ä»£ï¼šåŠ¨æ€å‘ç° â†’ é™æ€éªŒè¯ â†’ åŠ¨æ€æµ‹è¯•</li>
</ul>
</blockquote>
<h2><strong>é¢„è®¡ç”¨æ—¶</strong>: 40-90 åˆ†é’Ÿ</h2>
<h2>å·¥å…·æ¸…å•</h2>
<h2># å¿…éœ€å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>jadx-gui</strong> - Java/Smali åç¼–è¯‘</li>
</ul>
</li>
<li><ul>
<li><strong>IDA Pro / Ghidra</strong> - Native å±‚åˆ†æ</li>
</ul>
</li>
<li><ul>
<li><strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong> - è®°å½•åˆ†æç¬”è®°</li>
</ul>
</li>
</ul>
<h2># å¯é€‰å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>Binary Ninja</strong> - å¯è§†åŒ– CFG</li>
</ul>
</li>
<li><ul>
<li><strong>FindCrypt</strong> (IDA æ’ä»¶) - è¯†åˆ«åŠ å¯†ç®—æ³•</li>
</ul>
</li>
<li><ul>
<li><strong>YARA</strong> - æ¨¡å¼åŒ¹é…</li>
</ul>
</li>
<li><ul>
<li><strong>angr</strong> - ç¬¦å·æ‰§è¡Œï¼ˆé«˜çº§ï¼‰</li>
</ul>
</li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h2># âœ… ç¡®è®¤æ¸…å•</h2>
<pre><code class="language-bash"># 1. jadx-gui å·²å®‰è£…
jadx-gui --version

# 2. IDA Pro or Ghidra å¯ç”¨
# IDA Pro: å•†ä¸šè½¯ä»¶
# Ghidra: å…è´¹ï¼Œä¸‹è½½è‡ª https://ghidra-sre.org/

# 3. APK æ–‡ä»¶å·²è§£å‹
unzip app.apk -d app_unzipped

</code></pre>
<h2># ğŸ¤” é™æ€ vs åŠ¨æ€ï¼šä½•æ—¶é€‰æ‹©ä»€ä¹ˆï¼Ÿ</h2>
<table>
<thead>
<tr>
  <th>ä½ çš„ç›®æ ‡</th>
  <th>æ¨èèµ·ç‚¹</th>
  <th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å¿«é€Ÿæå–ç»“æœ</strong>ï¼ˆå¦‚åŠ å¯†å‚æ•°ï¼‰</td>
  <td>åŠ¨æ€ä¼˜å…ˆ</td>
  <td>ç›´æ¥ Hook æ‹¿ç»“æœï¼Œä¸å¿…ç†è§£å…¨éƒ¨é€»è¾‘</td>
</tr>
<tr>
  <td><strong>ç†è§£å®Œæ•´ç®—æ³•</strong>ï¼ˆå¦‚åè®®é€†å‘ï¼‰</td>
  <td>é™æ€ä¼˜å…ˆ</td>
  <td>éœ€è¦çœ‹æ¸…æ‰€æœ‰åˆ†æ”¯å’Œè¾¹ç•Œæ¡ä»¶</td>
</tr>
<tr>
  <td><strong>å¯»æ‰¾æ¼æ´</strong></td>
  <td>é™æ€ä¼˜å…ˆ</td>
  <td>éœ€è¦è¦†ç›–æ‰€æœ‰ä»£ç è·¯å¾„ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†</td>
</tr>
<tr>
  <td><strong>å¯¹æŠ—æ··æ·†/åŠ å£³</strong></td>
  <td>åŠ¨æ€ä¼˜å…ˆ</td>
  <td>é™æ€åˆ†æå¯èƒ½å®Œå…¨å¤±æ•ˆï¼Œå…ˆåŠ¨æ€è„±å£³</td>
</tr>
<tr>
  <td><strong>æ‰¹é‡è‡ªåŠ¨åŒ–</strong></td>
  <td>é™æ€ä¼˜å…ˆ</td>
  <td>åŠ¨æ€åˆ†æéœ€è¦è¿è¡Œç¯å¢ƒï¼Œé™æ€å¯ç¦»çº¿</td>
</tr>
</tbody>
</table>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ol>
<li><strong>å…ˆåŠ¨æ€è·å–çº¿ç´¢</strong> - ç”¨ Frida å¿«é€Ÿå®šä½å…³é”®å‡½æ•°</li>
<li><strong>å†é™æ€æ·±å…¥åˆ†æ</strong> - æœ‰äº†&quot;åœ°å›¾&quot;åæ›´æœ‰æ–¹å‘æ€§</li>
<li><strong>äº¤æ›¿è¿­ä»£</strong> - åŠ¨æ€å‘ç°çš„ç–‘ç‚¹ç”¨é™æ€éªŒè¯</li>
</ol>
<hr />
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h2># ç¬¬ 1 æ­¥ï¼šç¡®å®šåˆ†æç›®æ ‡ï¼ˆ5 åˆ†é’Ÿï¼‰</h2>
<p><strong>æ˜ç¡®ä½ æƒ³æ‰¾ä»€ä¹ˆ</strong>ï¼š</p>
<ul>
<li><ul>
<li>API ç­¾åç®—æ³•</li>
</ul>
</li>
<li><ul>
<li>åŠ å¯†å¯†é’¥ä½ç½®</li>
</ul>
</li>
<li><ul>
<li>ç½‘ç»œåè®®é€»è¾‘</li>
</ul>
</li>
<li><ul>
<li>ç‰¹å®šåŠŸèƒ½å®ç°ï¼ˆå¦‚ç™»å½•ã€æ”¯ä»˜ï¼‰</li>
</ul>
</li>
<li><ul>
<li>å®‰å…¨æ¼æ´</li>
</ul>
</li>
</ul>
<h2><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾ç›®æ ‡æ˜¯æ‰¾åˆ° API è¯·æ±‚çš„ç­¾åé€»è¾‘</h2>
<h2># ç¬¬ 2 æ­¥ï¼šä»å­—ç¬¦ä¸²å…¥æ‰‹ï¼ˆ10 åˆ†é’Ÿï¼‰</h2>
<p><strong>æœ€æœ‰æ•ˆçš„èµ·ç‚¹</strong>ï¼šæœç´¢å…³é”®å­—ç¬¦ä¸²</p>
<h2># # 2.1 jadx-gui å­—ç¬¦ä¸²æœç´¢</h2>
<pre><code>md5
sha
hmac
key
secret
encrypt

</code></pre>
<p>HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();
params.put(&quot;sign&quot;, generateSign(data));</p>
<pre><code>
</code></pre>
<ol>
<li>å³é”®ç‚¹å‡» <code>generateSign</code> å‡½æ•°</li>
<li>é€‰æ‹© <strong>&quot;Find Usage&quot;</strong> æˆ–æŒ‰ <code>X</code></li>
<li>æŸ¥çœ‹æ‰€æœ‰è°ƒç”¨ç‚¹</li>
</ol>
<p><strong>åœ¨ IDA Pro ä¸­</strong>ï¼š</p>
<ol>
<li>å…‰æ ‡ç§»åˆ°å‡½æ•°å</li>
<li>æŒ‰ <code>X</code> é”®</li>
<li>æŸ¥çœ‹ <strong>Xrefs to</strong>ï¼ˆè¢«è°è°ƒç”¨ï¼‰å’Œ <strong>Xrefs from</strong>ï¼ˆè°ƒç”¨äº†è°ï¼‰</li>
</ol>
<h2># # 3.2 å‘ä¸Šè¿½æº¯è°ƒç”¨é“¾</h2>
<pre><code>RequestBuilder.buildParams()
â†“
SignUtils.generateSign() â† ç›®æ ‡å‡½æ•°

</code></pre>
<p>// Step 1: Sort parameters
TreeMap&lt;String, String&gt; sortedParams = new TreeMap&lt;&gt;(params);</p>
<p>// Step 2: Concatenate string
StringBuilder sb = new StringBuilder();
for (Map.Entry&lt;String, String&gt; entry : sortedParams.entrySet()) {
sb.append(entry.getKey()).append(&quot;=&quot;).append(entry.getValue()).append(&quot;&amp;&quot;);
}
sb.append(&quot;key=&quot;).append(SECRET_KEY);</p>
<p>// Step 3: Calculate MD5
return MD5.encode(sb.toString());</p>
<p>}</p>
<pre><code>---
## # ç¬¬ 4 æ­¥ï¼šæ•°æ®æµåˆ†æï¼ˆ15 åˆ†é’Ÿï¼‰

* *ç›®æ ‡**ï¼šè¿½è¸ª `SECRET_KEY` çš„æ¥æº

## # # 4.1 æŸ¥æ‰¾å˜é‡å®šä¹‰

* *åœ¨ jadx ä¸­**ï¼š

1. ç‚¹å‡» `SECRET_KEY`
2. Ctrl+Click è·³è½¬åˆ°å®šä¹‰


* *å¯èƒ½çš„æƒ…å†µ**ï¼š

&lt;details&gt;
&lt;summary&gt;&lt;b&gt;æƒ…å†µ 1: ç¡¬ç¼–ç ï¼ˆæœ€ç®€å•ï¼‰&lt;/b&gt;&lt;/summary&gt;

```java
private static final String SECRET_KEY = &quot;abc123def456&quot;;

</code></pre>
<summary><b>æƒ…å†µ 2: ä»é…ç½®æ–‡ä»¶è¯»å–</b></summary>

<pre><code class="language-java">static {
try {
Properties props = new Properties();
props.load(context.getAssets().open(&quot;config.properties&quot;));
SECRET_KEY = props.getProperty(&quot;api.secret&quot;);
} catch (IOException e) {
SECRET_KEY = null;
}
}

</code></pre>
<p>cat app_unzipped/assets/config.properties</p>
<pre><code>
```java
static {
System.loadLibrary(&quot;native-lib&quot;);
SECRET_KEY = getKeyFromNative();
}

private static native String getKeyFromNative();

</code></pre>
<p>åœ¨ Ghidra åç¼–è¯‘çª—å£ï¼š</p>
<ol>
<li>åŒå‡»å˜é‡å</li>
<li>æ‰€æœ‰ä½¿ç”¨è¯¥å˜é‡çš„åœ°æ–¹ä¼šé«˜äº®æ˜¾ç¤º</li>
<li>è¿½è¸ªå˜é‡åœ¨å‡½æ•°å†…çš„æµåŠ¨</li>
</ol>
<hr />
<h2># ç¬¬ 5 æ­¥ï¼šNative å±‚åˆ†æï¼ˆ20 åˆ†é’Ÿï¼‰</h2>
<p>å¦‚æœå…³é”®é€»è¾‘åœ¨ SO æ–‡ä»¶ä¸­ã€‚</p>
<h2># # 5.1 å®šä½ Native å‡½æ•°</h2>
<p><strong>åœ¨ jadx ä¸­æ‰¾åˆ° JNI å£°æ˜</strong>ï¼š</p>
<pre><code class="language-java">public native String encrypt(String plaintext);

</code></pre>
<p>ls app_unzipped/lib/arm64-v8a/</p>
<h1>libnative-lib.so</h1>
<h1>ç”¨ IDA Pro æ‰“å¼€</h1>
<pre><code>3. åŒå‡»è·³è½¬åˆ°å‡½æ•°


* *æˆ–ä½¿ç”¨ Exports çª—å£**ï¼š

1. **View â†’ Open Subviews â†’ Exports**
2. æœç´¢å‡½æ•°å
3. åŒå‡»è·³è½¬


## # # 5.3 åˆ†æå‡½æ•°é€»è¾‘

* *ç¤ºä¾‹åç¼–è¯‘ä»£ç **ï¼ˆIDA/Ghidraï¼‰ï¼š

```c
jstring Java_com_example_CryptoUtils_encrypt(JNIEnv *env, jobject obj, jstring plaintext) {
const char *plain = (*env)-&gt;GetStringUTFChars(env, plaintext, 0);

// AES encryption
unsigned char key[16] = {0x12, 0x34, 0x56, 0x78, ...};
unsigned char iv[16] = {0x00, 0x00, 0x00, 0x00, ...};

unsigned char *encrypted = aes_encrypt(plain, key, iv);

jstring result = (*env)-&gt;NewStringUTF(env, encrypted);
(*env)-&gt;ReleaseStringUTFChars(env, plaintext, plain);

return result;
}

</code></pre>
<ul>
<li>IVï¼š<code>{0x00, 0x00, ...}</code></li>
</ul>
<hr />
<h2># ç¬¬ 6 æ­¥ï¼šè¯†åˆ«åŠ å¯†ç®—æ³•ï¼ˆ10 åˆ†é’Ÿï¼‰</h2>
<h2># # 6.1 ä½¿ç”¨ FindCrypt æ’ä»¶ï¼ˆIDA Proï¼‰</h2>
<p><strong>å®‰è£…</strong>ï¼š</p>
<pre><code class="language-bash"># ä¸‹è½½
git clone https://github.com/polymorf/findcrypt-yara.git

# å¤åˆ¶åˆ° IDA æ’ä»¶ç›®å½•
cp findcrypt3.py $IDA_PATH/plugins/

</code></pre>
<h2># # 6.2 æ‰‹åŠ¨è¯†åˆ«</h2>
<p><strong>å¸¸è§åŠ å¯†ç®—æ³•ç‰¹å¾</strong>ï¼š</p>
<table>
<thead>
<tr>
  <th>ç®—æ³•</th>
  <th>ç‰¹å¾å¸¸é‡ï¼ˆåå…­è¿›åˆ¶ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
  <td>AES</td>
  <td><code>63 7C 77 7B F2 6B 6F C5</code> (S-Box)</td>
</tr>
<tr>
  <td>MD5</td>
  <td><code>67 45 23 01 EF CD AB 89</code> (åˆå§‹åŒ–å‘é‡)</td>
</tr>
<tr>
  <td>SHA-1</td>
  <td><code>67 45 23 01 EF CD AB 89 98 BA DC FE</code></td>
</tr>
<tr>
  <td>SHA-256</td>
  <td><code>428A2F98 71374491 B5C0FBCF</code></td>
</tr>
<tr>
  <td>DES</td>
  <td>å›ºå®šçš„ S-Box å’Œ P-Box è¡¨</td>
</tr>
</tbody>
</table>
<p><strong>åœ¨ IDA ä¸­æœç´¢</strong>ï¼š</p>
<pre><code>
* *ç”¨é€”**ï¼šç†è§£å¤æ‚å‡½æ•°çš„é€»è¾‘ç»“æ„

## # 7.1 æŸ¥çœ‹ CFG

* *IDA Pro**ï¼š

</code></pre>
<pre><code>[æ£€æŸ¥å¯†ç é•¿åº¦] --No--&gt; [è¿”å›é”™è¯¯ 2]
â†“ Yes
[åŠ å¯†å¯†ç ]
â†“
[å‘é€ç½‘ç»œè¯·æ±‚]
â†“
[è§£æå“åº”] --Failed--&gt; [è¿”å›é”™è¯¯ 3]
â†“ Success
[ä¿å­˜ Token]
â†“
[è¿”å›æˆåŠŸ]

</code></pre>
<p><strong>Xrefs to</strong>ï¼ˆè¢«è°è°ƒç”¨ï¼‰ï¼š</p>
<pre><code>
</code></pre>
<p>â†’ Base64.encode()</p>
<pre><code>â†“
params.put(&quot;user&quot;, username) â† æ±¡ç‚¹ä¼ æ’­
â†“
String signData = buildSignData(params)
â†“
network.send(signData) â† å¯èƒ½æ³¨å…¥ç‚¹

</code></pre>
<pre><code>[A] [B][C][D] [E]
\ | | | /
\ | | | /
[Dispatcher]

</code></pre>
<hr />
<h2>å¸¸è§é—®é¢˜</h2>
<h2># âŒ é—®é¢˜ 1: jadx åç¼–è¯‘å¤±è´¥</h2>
<p><strong>ç—‡çŠ¶</strong>ï¼šæ‰“å¼€ APK åæ˜¾ç¤ºé”™è¯¯æˆ–ä»£ç ä¸å®Œæ•´</p>
<p><strong>è§£å†³</strong>ï¼š</p>
<ol>
<li><strong>å°è¯•ä¸åŒç‰ˆæœ¬çš„ jadx</strong></li>
</ol>
<pre><code class="language-bash"># ä½¿ç”¨æœ€æ–°ç‰ˆ
wget https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip

</code></pre>
<pre><code>- ç¦ç”¨ &quot;Deobfuscation&quot;
- ç¦ç”¨ &quot;Inline methods&quot;
    ```

3. **æŸ¥çœ‹ Smali ä»£ç **
    ```bash
# ä½¿ç”¨ apktool
apktool d app.apk -o app_smali

</code></pre>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li><strong>å­—ç¬¦ä¸²è¢«åŠ å¯†/æ··æ·†</strong></li>
</ol>
<ul>
<li><p>åœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†</p>
</li>
<li><p><strong>è§£å†³</strong>ï¼šç”¨ Frida Hook æŸ¥çœ‹è¿è¡Œæ—¶å­—ç¬¦ä¸²</p>
</li>
<li><p>åœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†</p>
</li>
<li><p><strong>è§£å†³</strong>ï¼šç”¨ Frida Hook æŸ¥çœ‹è¿è¡Œæ—¶å­—ç¬¦ä¸²</p>
</li>
</ul>
<ol start="2">
<li><strong>å­—ç¬¦ä¸²åœ¨ Native å±‚</strong></li>
</ol>
<pre><code class="language-bash"># åœ¨ SO æ–‡ä»¶ä¸­æœç´¢
strings libnative-lib.so | grep &quot;sign&quot;

</code></pre>
<pre><code>```java</code></pre>
<p>// Code might be
String key = &quot;sec&quot; + &quot;ret&quot; + &quot;key&quot;;</p>
<pre><code>
**ç—‡çŠ¶**ï¼šæ‰“å¼€ SO æ–‡ä»¶ååªçœ‹åˆ°æ•°æ®ï¼Œæ²¡æœ‰å‡½æ•°

**è§£å†³**ï¼š

1. **æ‰‹åŠ¨åˆ›å»ºå‡½æ•°**

</code></pre>
<ul>
<li><p>æŒ‰ 'P' é”®åˆ›å»ºå‡½æ•°</p>
</li>
<li><p>æŒ‰ 'C' é”®è½¬æ¢ä¸ºä»£ç </p>
<pre><code>
</code></pre>
</li>
</ul>
<ol start="2">
<li><strong>ä½¿ç”¨è‡ªåŠ¨åˆ†æ</strong></li>
</ol>
<pre><code>å‹¾é€‰ &quot;Create Functions&quot; &quot;Analyze Code&quot;

</code></pre>
<ul>
<li><p>OLLVM æ§åˆ¶æµå¹³å¦åŒ–</p>
</li>
<li><p>å‚è€ƒï¼š<a href="#section-21">OLLVM åæ··æ·†</a></p>
</li>
<li><p>OLLVM æ§åˆ¶æµå¹³å¦åŒ–</p>
</li>
<li><p>å‚è€ƒï¼š<a href="#section-21">OLLVM åæ··æ·†</a></p>
</li>
</ul>
<h2># âŒ é—®é¢˜ 4: ä»£ç å¤ªå¤æ‚çœ‹ä¸æ‡‚</h2>
<p><strong>ç­–ç•¥</strong>ï¼š</p>
<ol>
<li><strong>é‡å‘½åå˜é‡å’Œå‡½æ•°</strong></li>
</ol>
<pre><code>Ghidra: å³é”® â†’ Rename

</code></pre>
<pre><code class="language-java">// Original
String a = b(c, d);

// After renaming
String encryptedData = encrypt(plaintext, key);

</code></pre>
<pre><code>Ghidra: å³é”® â†’ Set Comment

</code></pre>
<ul>
<li><p>ä¸€æ¬¡åªåˆ†æä¸€ä¸ªåŠŸèƒ½</p>
</li>
<li><p>ç”»æµç¨‹å›¾è®°å½•é€»è¾‘</p>
</li>
<li><p>ä¸€æ¬¡åªåˆ†æä¸€ä¸ªåŠŸèƒ½</p>
</li>
<li><p>ç”»æµç¨‹å›¾è®°å½•é€»è¾‘</p>
</li>
</ul>
<h2># âŒ é—®é¢˜ 5: å¦‚ä½•éªŒè¯é™æ€åˆ†æç»“æœï¼Ÿ</h2>
<p><strong>æ–¹æ³• 1ï¼šä½¿ç”¨ CyberChef</strong></p>
<p>è®¿é—® https://gchq.github.io/CyberChef/</p>
<pre><code>def generate_sign(params, secret_key):
# ä»é™æ€åˆ†æå¤åˆ¶çš„é€»è¾‘
sorted_params = sorted(params.items())
sign_str = '&amp;'.join([f'{k}={v}' for k, v in sorted_params])
sign_str += f'&amp;key={secret_key}'
return hashlib.md5(sign_str.encode()).hexdigest()

# æµ‹è¯•
params = {'user': 'test', 'timestamp': '1234567890'}
secret = 'abc123'
print(generate_sign(params, secret))

</code></pre>
<p>var SignUtils = Java.use('com.example.SignUtils');
var HashMap = Java.use('java.util.HashMap');</p>
<p>var params = HashMap.$new();
params.put('user', 'test');
params.put('timestamp', '1234567890');</p>
<p>var sign = SignUtils.generateSign(params);
console.log('[*] ç­¾åç»“æœ:', sign);</p>
<p>});</p>
<pre><code>- **[é€†å‘å·¥ç¨‹å·¥ä½œæµ](#section-18)** - å®Œæ•´çš„åˆ†ææµç¨‹
- **[å¯†ç å­¦åˆ†æ](#section-4)** - åŠ å¯†ç®—æ³•è¯†åˆ«
- **[OLLVM åæ··æ·†](#section-21)** - å¤„ç†æ··æ·†ä»£ç 


## # å·¥å…·æ·±å…¥

- **[IDA Pro ä½¿ç”¨æŒ‡å—](#section-47)**
- **[Ghidra ä½¿ç”¨æŒ‡å—](#section-46)**
- **[jadx ä½¿ç”¨æŠ€å·§](../../02-Tools/Static/)** - TODO


## # åœ¨çº¿èµ„æº


| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **IDA Pro æ•™ç¨‹** - https | //www.hex-rays.com/products/ida/support/tutorials/ |
| **Ghidra å®˜æ–¹æ‰‹å†Œ** - https | //ghidra-sre.org/docs/ |
| **FindCrypt æ’ä»¶** - https | //github.com/polymorf/findcrypt-yara |


## # ç†è®ºåŸºç¡€

- **[ARM æ±‡ç¼–åŸºç¡€](#section-66)**
- **[DEX æ–‡ä»¶æ ¼å¼](#section-62)**
- **[ELF æ–‡ä»¶æ ¼å¼](#section-64)**
---
## å¿«é€Ÿå‚è€ƒ

## # jadx å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Ctrl+Shift+F` | å…¨å±€æœç´¢ |
| `Ctrl+F` | å½“å‰æ–‡ä»¶æœç´¢ |
| `X` | æŸ¥æ‰¾ç”¨æ³•ï¼ˆXrefsï¼‰ |
| `Ctrl+Click` | è·³è½¬åˆ°å®šä¹‰ |
| `Alt+â†` | åé€€ |
| `F5` | é‡æ–°åç¼–è¯‘ |

## # IDA Pro å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `X` | äº¤å‰å¼•ç”¨ |
| `N` | é‡å‘½å |
| `;` | æ·»åŠ æ³¨é‡Š |
| `Space` | åˆ‡æ¢å›¾å½¢/æ–‡æœ¬è§†å›¾ |
| `G` | è·³è½¬åˆ°åœ°å€ |
| `P` | åˆ›å»ºå‡½æ•° |
| `C` | è½¬æ¢ä¸ºä»£ç  |
| `A` | è½¬æ¢ä¸ºå­—ç¬¦ä¸² |
| `Shift+F12` | æŸ¥çœ‹å­—ç¬¦ä¸² |
| `Alt+T` | æ–‡æœ¬æœç´¢ |
| `Alt+B` | äºŒè¿›åˆ¶æœç´¢ |

## # åˆ†ææµç¨‹æ¨¡æ¿

</code></pre>
<hr />
<p>â†“</p>
<hr />
<p>â†“</p>
<hr />
<hr />
<p>â†“</p>
<hr />
<p>â†“</p>
<hr />
<ol start="5">
<li>å…³é”®å˜é‡:</li>
</ol>
<ul>
<li>åç§°: _______________</li>
<li>ç±»å‹: _______________</li>
<li>æ¥æº: _______________</li>
<li>åç§°: _______________</li>
<li>ç±»å‹: _______________</li>
<li>æ¥æº: _______________</li>
</ul>
<ol start="6">
<li>ç®—æ³•è¯†åˆ«: _______________</li>
<li>éªŒè¯ç»“æœ: _______________</li>
<li>ä¸‹ä¸€æ­¥: _______________</li>
</ol>
<hr />
<p><strong>æˆåŠŸå®šä½å…³é”®é€»è¾‘äº†å—ï¼Ÿ</strong> ç°åœ¨ä½ å¯ä»¥ç†è§£ App çš„æ ¸å¿ƒç®—æ³•äº†ï¼</p>
<p>ä¸‹ä¸€æ­¥æ¨èï¼š<a href="#section-20">åŠ¨æ€åˆ†ææ·±å…¥</a>ï¼ˆéªŒè¯å’Œæµ‹è¯•ä½ çš„å‘ç°ï¼‰</p>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-20">
                                                <h2>20. R18: Dynamic Analysis Deep Dive</h2>
                                                <h1>R18: Recipe: ä½¿ç”¨åŠ¨æ€åˆ†æéªŒè¯å’Œæ¢ç´¢ android App çš„è¿è¡Œæ—¶è¡Œä¸º</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p><strong>ä½ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>âœ… ä½ å·²ç»é™æ€åˆ†ææ‰¾åˆ°äº†ç›®æ ‡å‡½æ•°ï¼Œç°åœ¨æƒ³éªŒè¯å®ƒçš„å®é™…è¾“å…¥è¾“å‡º</li>
<li>ä½ æƒ³æ•è·è¿è¡Œæ—¶æ‰ç”Ÿæˆçš„æ•°æ®ï¼ˆå¦‚åŠ¨æ€å¯†é’¥ã€ç­¾åç»“æœï¼‰</li>
<li>ä½ æƒ³ç»•è¿‡ SSL Pinning / åè°ƒè¯• / Root æ£€æµ‹</li>
<li>ğŸ§ª ä½ æƒ³ä¸»åŠ¨è°ƒç”¨å‡½æ•°æµ‹è¯•ä¸åŒå‚æ•°çš„æ•ˆæœ</li>
<li>ğŸ•µï¸ ä½ æƒ³è¿½è¸ªä»£ç æ‰§è¡Œè·¯å¾„ï¼Œçœ‹çœ‹å“ªäº›å‡½æ•°è¢«è°ƒç”¨äº†</li>
</ul>
<p><strong>æœ¬é…æ–¹æ•™ä½ </strong>ï¼šç³»ç»Ÿæ€§åœ°ä½¿ç”¨ Fridaã€è°ƒè¯•å™¨ã€è¿½è¸ªå·¥å…·æ¥éªŒè¯é™æ€åˆ†æç»“æœã€è·å–è¿è¡Œæ—¶æ•°æ®ã€ç»•è¿‡ä¿æŠ¤æœºåˆ¶ã€‚</p>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š</p>
<blockquote>
<p>ğŸ’¡ <strong>åŠ¨æ€åˆ†æï¼šè®©ä»£ç è¯´è¯</strong></p>
<ul>
<li>åŠ¨æ€åˆ†æéªŒè¯é™æ€åˆ†æçš„å‡è®¾</li>
<li>è·å–åªåœ¨è¿è¡Œæ—¶å­˜åœ¨çš„æ•°æ®</li>
<li>ä¸»åŠ¨æ¢ç´¢ç¨‹åºçš„å†…éƒ¨çŠ¶æ€</li>
<li>Hook â†’ Debug â†’ Trace ä¸‰ç§æ­¦å™¨å„æœ‰ç”¨é€”</li>
</ul>
</blockquote>
<h2><strong>é¢„è®¡ç”¨æ—¶</strong>: 30-90 åˆ†é’Ÿ</h2>
<h2>å·¥å…·æ¸…å•</h2>
<h2># å¿…éœ€å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>Frida</strong> - åŠ¨æ€æ’æ¡©æ¡†æ¶</li>
</ul>
</li>
<li><ul>
<li><strong>Android è®¾å¤‡</strong>ï¼ˆå·² Rootï¼‰æˆ–æ¨¡æ‹Ÿå™¨</li>
</ul>
</li>
<li><ul>
<li><strong>Python 3.7+</strong> - è¿è¡Œ Frida è„šæœ¬</li>
</ul>
</li>
</ul>
<h2># å¯é€‰å·¥å…·</h2>
<ul>
<li><ul>
<li><strong>IDA Pro Remote Debugger</strong> - Native å±‚è°ƒè¯•</li>
</ul>
</li>
<li><ul>
<li><strong>objection</strong> - Frida çš„äº¤äº’å¼å·¥å…·</li>
</ul>
</li>
<li><ul>
<li><strong>Burp Suite</strong> - ç½‘ç»œæŠ“åŒ…</li>
</ul>
</li>
<li><ul>
<li><strong>GDB</strong> - GNU è°ƒè¯•å™¨</li>
</ul>
</li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<h2># âœ… ç¡®è®¤æ¸…å•</h2>
<pre><code class="language-bash"># 1. Frida æ­£å¸¸è¿è¡Œ
frida-ps -U

# 2. Python ç¯å¢ƒ
python3 --version

# 3. ç›®æ ‡ App å·²å®‰è£…
adb shell pm list packages | grep &lt;app_name&gt;

</code></pre>
<h2># ğŸ¤” Hook vs Debug vs Traceï¼šä½•æ—¶ç”¨ä»€ä¹ˆï¼Ÿ</h2>
<table>
<thead>
<tr>
  <th>åœºæ™¯</th>
  <th>æ¨èå·¥å…·</th>
  <th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
  <td>æƒ³çŸ¥é“æŸä¸ªå‡½æ•°çš„è¾“å…¥è¾“å‡º</td>
  <td><strong>Frida Hook</strong></td>
  <td>æœ€å¿«é€Ÿï¼Œä¸ä¸­æ–­ç¨‹åºæµ</td>
</tr>
<tr>
  <td>æƒ³ç†è§£å¤æ‚ç®—æ³•çš„æ¯ä¸€æ­¥ç»†èŠ‚</td>
  <td><strong>IDA/GDB è°ƒè¯•å™¨</strong></td>
  <td>å¯ä»¥å•æ­¥æ‰§è¡Œï¼ŒæŸ¥çœ‹æ¯ä¸ªå˜é‡</td>
</tr>
<tr>
  <td>æƒ³çŸ¥é“ç¨‹åºæ‰§è¡Œäº†å“ªäº›ä»£ç è·¯å¾„</td>
  <td><strong>Stalker/Trace</strong></td>
  <td>å…¨è‡ªåŠ¨è®°å½•ï¼Œæ— éœ€è®¾æ–­ç‚¹</td>
</tr>
<tr>
  <td>æƒ³ç»•è¿‡æŸä¸ªæ£€æµ‹ï¼ˆå¦‚ SSL Pinningï¼‰</td>
  <td><strong>Frida Hook</strong></td>
  <td>ç›´æ¥æ›¿æ¢å‡½æ•°è¿”å›å€¼</td>
</tr>
<tr>
  <td>æƒ³æ‰¾åˆ°æŸä¸ªå­—ç¬¦ä¸²æ˜¯åœ¨å“ªé‡Œç”Ÿæˆçš„</td>
  <td><strong>å†…å­˜æ–­ç‚¹ + è°ƒè¯•å™¨</strong></td>
  <td>åœ¨å†™å…¥æ—¶ä¸­æ–­</td>
</tr>
<tr>
  <td>æƒ³åˆ†æåè°ƒè¯•æœºåˆ¶</td>
  <td><strong>Frida + è°ƒè¯•å™¨ç»„åˆ</strong></td>
  <td>å…ˆç”¨ Frida ç¦ç”¨ï¼Œå†ç”¨è°ƒè¯•å™¨åˆ†æ</td>
</tr>
</tbody>
</table>
<p><strong>ç»éªŒæ³•åˆ™</strong>ï¼š</p>
<ul>
<li>èƒ½ç”¨ Hook è§£å†³çš„ï¼Œåˆ«ç”¨è°ƒè¯•å™¨ï¼ˆæ•ˆç‡é—®é¢˜ï¼‰</li>
<li>éœ€è¦ç†è§£é€»è¾‘çš„ï¼Œå¿…é¡»ç”¨è°ƒè¯•å™¨ï¼ˆæ·±åº¦é—®é¢˜ï¼‰</li>
<li>éœ€è¦å…¨å±€è§†é‡çš„ï¼Œç”¨è¿½è¸ªï¼ˆè¦†ç›–ç‡é—®é¢˜ï¼‰</li>
</ul>
<hr />
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<h2># ç¬¬ 1 æ­¥ï¼šéªŒè¯é™æ€åˆ†æç»“æœï¼ˆ15 åˆ†é’Ÿï¼‰</h2>
<p>å‡è®¾é™æ€åˆ†æå‘ç°äº†ç­¾åå‡½æ•°ï¼š<code>SignUtils.generateSign()</code></p>
<h2># # 1.1 Hook å‡½æ•°æŸ¥çœ‹è¾“å…¥è¾“å‡º</h2>
<p><strong>åŸºç¡€ Hook è„šæœ¬</strong> <code>verify_sign.js</code>ï¼š</p>
<pre><code class="language-javascript">Java.perform(function () {
  console.log(&quot;[*] Start Hook SignUtils.generateSign&quot;);

  var SignUtils = Java.use(&quot;com.example.SignUtils&quot;);

  SignUtils.generateSign.implementation = function (params) {
    console.log(&quot;\n[*] generateSign is called!&quot;);
    console.log(&quot; InputParameter:&quot;);

    // Print HashMap
    var iterator = params.entrySet().iterator();
    while (iterator.hasNext()) {
      var entry = iterator.next();
      console.log(&quot; &quot; + entry.getKey() + &quot; = &quot; + entry.getValue());
    }

    // Call original function
    var result = this.generateSign(params);

    console.log(&quot; ReturnValue: &quot; + result);
    console.log(&quot;&quot;);

    return result;
  };

  console.log(&quot;[*] Hook install completed&quot;);
});
</code></pre>
<p>user = test123
timestamp = 1701234567
action = login
ReturnValue: a1b2c3d4e5f6g7h8i9j0</p>
<pre><code>
## # # 2.1 åˆ—å‡ºæ‰€æœ‰é‡è½½

```javascript
Java.perform(function () {
var CryptoUtil = Java.use(&quot;com.example.CryptoUtil&quot;);

// List all encryption methods
console.log(&quot;[*] encrypt Method overloads:&quot;);
CryptoUtil.encrypt.overloads.forEach(function (overload) {
console.log(&quot; &quot; + overload);
});
});

</code></pre>
<p>encrypt([B)</p>
<pre><code>
// This is the second overloaded version
CryptoUtil.encrypt.overload(
&quot;java.lang.String&quot;,
&quot;java.lang.String&quot;
).implementation = function (data, key) {
console.log(&quot;[*] encrypt(String, String) is called&quot;);
console.log(&quot; Data:&quot;, data);
console.log(&quot; Key:&quot;, key);

var result = this.encrypt(data, key);
console.log(&quot; Result:&quot;, result);

return result;
};

// This is the third overloaded version
CryptoUtil.encrypt.overload(&quot;[B&quot;).implementation = function (bytes) {
console.log(&quot;[*] encrypt(byte[]) is called&quot;);
console.log(&quot; BytesLength:&quot;, bytes.length);

var result = this.encrypt(bytes);
console.log(&quot; ResultLength:&quot;, result.length);

return result;
};
});

</code></pre>
<p><strong>æ–¹æ³• 1ï¼šåˆ›å»ºæ–°å®ä¾‹</strong></p>
<pre><code class="language-javascript">Java.perform(function () {
  var CryptoUtil = Java.use(&quot;com.example.CryptoUtil&quot;);

  // Constructor accessible
  try {
    var instance = CryptoUtil.$new(); // Call no-arg constructor
    var result = instance.encrypt(&quot;Hello World&quot;, &quot;mykey&quot;);
    console.log(&quot;[*] MainCallResult:&quot;, result);
  } catch (e) {
    console.log(&quot;[-] No way to create instance:&quot;, e);
  }
});
</code></pre>
<p>Java.choose(&quot;com.example.CryptoUtil&quot;, {
onMatch: function (instance) {
console.log(&quot;[+] Instance:&quot;, instance);</p>
<p>// Actively call
var encrypted = instance.encrypt(&quot;test data&quot;);
console.log(&quot;[*] EncryptResult:&quot;, encrypted);</p>
<p>var decrypted = instance.decrypt(encrypted);
console.log(&quot;[<em>] DecryptResult:&quot;, decrypted);
},
onComplete: function () {
console.log(&quot;[</em>] Search completed&quot;);
},</p>
<p>});
});</p>
<pre><code>var HashMap = Java.use(&quot;java.util.HashMap&quot;);

// CreateParameter
var params = HashMap.$new();
params.put(&quot;user&quot;, &quot;testuser&quot;);
params.put(&quot;timestamp&quot;, String(Date.now()));

// Actively call static method
var sign = SignUtils.generateSign(params);
console.log(&quot;[*] GenerateSignature:&quot;, sign);
});

</code></pre>
<pre><code class="language-javascript">Java.perform(function () {
  var RootDetector = Java.use(&quot;com.example.security.RootDetector&quot;);

  RootDetector.isRooted.implementation = function () {
    console.log(&quot;[*] Root Detection is Bypassed&quot;);
    return false; // Force return false (not rooted)
  };

  RootDetector.isXposedInstalled.implementation = function () {
    console.log(&quot;[*] Xposed Detection is Bypassed&quot;);
    return false;
  };
});
</code></pre>
<p>// Hook OkHttp 3
try {
var CertificatePinner = Java.use(&quot;okhttp3.CertificatePinner&quot;);
CertificatePinner.check.overload(
&quot;java.lang.String&quot;,
&quot;java.util.List&quot;
).implementation = function (hostname, peerCertificates) {
console.log(&quot;[*] Bypass OkHttp3 SSL Pinning:&quot;, hostname);
return; // Return directly, skip validation
};
console.log(&quot;[+] OkHttp3 SSL Pinning å·² Bypass&quot;);
} catch (e) {}</p>
<p>// Hook TrustManager
try {
var X509TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);
var SSLContext = Java.use(&quot;javax.net.ssl.SSLContext&quot;);</p>
<p>var TrustManager = Java.registerClass({
name: &quot;com.example.TrustManager&quot;,
implements: [X509TrustManager],
methods: {
checkClientTrusted: function (chain, authType) {},
checkServerTrusted: function (chain, authType) {},
getAcceptedIssuers: function () {
return [];
},
},
});</p>
<p>var TrustManagers = [TrustManager.$new()];
var SSLContext_init = SSLContext.init.overload(
&quot;[Ljavax.net.ssl.KeyManager;&quot;,
&quot;[Ljavax.net.ssl.TrustManager;&quot;,
&quot;java.security.SecureRandom&quot;
);
SSLContext_init.implementation = function (
keyManager,
trustManager,
secureRandom
) {
console.log(&quot;[*] æ›¿æ¢ TrustManager&quot;);
SSLContext_init.call(this, keyManager, TrustManagers, secureRandom);
};
console.log(&quot;[+] TrustManager å·² Bypass&quot;);</p>
<p>} catch (e) {}</p>
<p>console.log(&quot;[*] SSL Pinning BypassConfig å®Œæˆ&quot;);
});</p>
<pre><code>
## # # 5.1 å®šä¹‰ RPC å‡½æ•°

* *rpc_example.js**ï¼š

```javascript
rpc.exports = {
// ExportFunctionï¼šGenerateSignature
generateSign: function (params) {
var result = null;

Java.perform(function () {
var SignUtils = Java.use(&quot;com.example.SignUtils&quot;);
var HashMap = Java.use(&quot;java.util.HashMap&quot;);

var map = HashMap.$new();
for (var key in params) {
map.put(key, params[key]);
}

result = SignUtils.generateSign(map);
});

return result;
},

// ExportFunctionï¼šEncryptData
encrypt: function (plaintext, key) {
var result = null;

Java.perform(function () {
var CryptoUtil = Java.use(&quot;com.example.CryptoUtil&quot;);
result = CryptoUtil.encrypt(plaintext, key);
});

return result;
},
};

</code></pre>
<p>import frida
import sys</p>
<p>def on_message(message, data):
print(f&quot;[*] Message: {message}&quot;)</p>
<h1>Connect to to to to to to to device</h1>
<p>device = frida.get_usb_device()</p>
<h1>Attach to process</h1>
<p>pid = device.spawn(['com.example.app'])
session = device.attach(pid)</p>
<h1>LoadScript</h1>
<p>with open('rpc_example.js', 'r') as f:
script = session.create_script(f.read())</p>
<p>script.on('message', on_message)
script.load()</p>
<p>device.resume(pid)</p>
<h1>Wait forScriptInitialize</h1>
<p>import time
time.sleep(2)</p>
<h1>Call RPC Function</h1>
<p>params = {
'user': 'testuser',
'timestamp': '1701234567',
'action': 'login'
}</p>
<p>sign = script.exports_sync.generate_sign(params)
print(f&quot;[+] GenerateSignature: {sign}&quot;)</p>
<p>encrypted = script.exports_sync.encrypt('Hello World', 'mykey')
print(f&quot;[+] EncryptResult: {encrypted}&quot;)</p>
<h1>ä¿æŒè¿è¡Œ</h1>
<p>sys.stdin.read()</p>
<pre><code>
## # # 6.1 IDA Pro è¿œç¨‹è°ƒè¯• Native ä»£ç 

**å‡†å¤‡**ï¼š

```bash
# 1. æ¨é€ android_server åˆ°è®¾å¤‡
adb push android_server64 /data/local/tmp/
adb shell chmod 755 /data/local/tmp/android_server64

# 2. ä»¥ æ ¹ æƒé™Run
adb shell su -c &quot;/data/local/tmp/android_server64&quot;

# 3. Portè½¬å‘
adb forward tcp:23946 tcp:23946

</code></pre>
<ul>
<li>Port: 23946</li>
<li>Hostname: localhost</li>
<li>Port: 23946</li>
</ul>
<ol start="3">
<li><strong>Debugger â†’ Attach to Process</strong> â†’ é€‰æ‹©ç›®æ ‡ App</li>
<li>åœ¨ç›®æ ‡å‡½æ•°å¤„è®¾ç½®æ–­ç‚¹ï¼ˆF2ï¼‰</li>
<li>è§¦å‘ App ä¸­çš„æ“ä½œï¼Œæ–­ç‚¹å‘½ä¸­</li>
</ol>
<h2># # 6.2 ä½¿ç”¨ GDB è°ƒè¯•</h2>
<pre><code class="language-bash"># Attach to process
adb shell
su
ps | grep &lt;app_name&gt;
# æ‰¾åˆ° PIDï¼Œå¦‚ 12345

gdbserver :5039 --attach 12345

</code></pre>
<p>arm-linux-androideabi-gdb</p>
<h1>gdb In</h1>
<p>(gdb) target remote :5039
(gdb) continue</p>
<pre><code>| --------- | --------------------------- |
| `F2` | è®¾ç½®/å–æ¶ˆæ–­ç‚¹ |
| `F9` | è¿è¡Œ/ç»§ç»­ |
| `F7` | å•æ­¥è¿›å…¥ï¼ˆStep Intoï¼‰ |
| `F8` | å•æ­¥è·³è¿‡ï¼ˆStep Overï¼‰ |
| `Ctrl+F7` | æ‰§è¡Œåˆ°è¿”å›ï¼ˆRun to Returnï¼‰ |
---
## # ç¬¬ 7 æ­¥ï¼šä½¿ç”¨ Stalker è¿½è¸ªä»£ç è¦†ç›–ç‡ï¼ˆ15 åˆ†é’Ÿï¼‰

Frida Stalker å¯ä»¥è®°å½•çº¿ç¨‹æ‰§è¡Œçš„æ‰€æœ‰æŒ‡ä»¤ã€‚

## # # 7.1 åŸºç¡€ Stalker ç¤ºä¾‹

```javascript
// Stalker trace function execution
Interceptor.attach(
Module.findExportByName(&quot;libnative.so&quot;, &quot;Java_com_example_Native_encrypt&quot;),
{
onEnter: function (args) {
console.log(&quot;[*] Startè¿½è¸ª...&quot;);

Stalker.follow(Process.getCurrentThreadId(), {
events: {
call: true, // RecordFunctionCall
ret: false,
exec: false,
},
onReceive: function (events) {
console.log(&quot;[*] æ•è·åˆ°&quot;, events.length, &quot;äº‹ä»¶&quot;);

// Parse events
var calls = Stalker.parse(events, {
annotate: true,
stringify: false,
});

calls.forEach(function (call) {
console.log(&quot; Call:&quot;, call);
});
},
});
},
onLeave: function (retval) {
Stalker.unfollow(Process.getCurrentThreadId());
Stalker.flush();
console.log(&quot;[*] è¿½è¸ªEnd&quot;);
},
}
);

</code></pre>
<p>var base = Module.findBaseAddress(&quot;libnative.so&quot;);
var size = Process.findModuleByName(&quot;libnative.so&quot;).size;</p>
<p>Stalker.follow(Process.getCurrentThreadId(), {
transform: function (iterator) {
var instruction = iterator.next();
do {
// Only record instructions within libnative.so
if (
instruction.address.compare(base) &gt;= 0 &amp;&amp;
instruction.address.compare(base.add(size)) &lt; 0
) {
iterator.keep();
}
instruction = iterator.next();
} while (instruction !== null);
},
});</p>
<pre><code>
â”‚ Frida Hook â”‚ å¿«é€Ÿè·å– I/O â”‚ ä¸ä¸­æ–­æµç¨‹ â”‚ åªçœ‹å•ç‚¹ â”‚
â”‚ â”‚ ä¿®æ”¹è¿”å›å€¼ â”‚ æ˜“äº Auto åŒ– â”‚ ä¸çŸ¥é“ç»†èŠ‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Debug å™¨ â”‚ ç†è§£ç®—æ³• Logic â”‚ å®Œå…¨ Control â”‚ Speed æ…¢ â”‚
â”‚ (IDA/GDB) â”‚ å•æ­¥è·Ÿè¸ª â”‚ çœ‹æ‰€æœ‰ Variable â”‚ NeedManualOp â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stalker â”‚ Code è¦†ç›–ç‡ â”‚ å…¨ Auto â”‚ Performance å¼€é”€å¤§ â”‚
â”‚ â”‚ è¿½è¸ª ExecutePath â”‚ No éœ€æ–­ç‚¹ â”‚ Output é‡å·¨å¤§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
<p>â†“ â†“
Send RPC Request Execute Java.perform()
â†“ â†“
Etc å¾… Result Call App Function
â†“ â†“
ReceiveReturnValue ReturnResult
â†“ â†“
ProcessData å®Œæˆ</p>
<pre><code>
**æ£€æŸ¥æ¸…å•**ï¼š

1. **ç¡®è®¤ç±»/æ–¹æ³•åæ­£ç¡®**

```javascript
// List all classes
Java.enumerateLoadedClasses({
onMatch: function (className) {
if (className.includes(&quot;SignUtils&quot;)) {
console.log(className);
}
},
onComplete: function () {},
});

</code></pre>
<ul>
<li><p>åœ¨ App ä¸­è§¦å‘ç›¸å…³æ“ä½œ</p>
</li>
<li><p>æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä»£ç è·¯å¾„</p>
</li>
<li><p>åœ¨ App ä¸­è§¦å‘ç›¸å…³æ“ä½œ</p>
</li>
<li><p>æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä»£ç è·¯å¾„</p>
</li>
</ul>
<ol start="3">
<li><strong>æ£€æŸ¥æ··æ·†</strong></li>
</ol>
<pre><code class="language-javascript">// If class name is obfuscated as a.b.c, use obfuscated name
var SignUtils = Java.use(&quot;a.b.c&quot;);
</code></pre>
<p><strong>ç—‡çŠ¶</strong>ï¼š<code>script.exports_sync.func()</code> ä¸€ç›´ç­‰å¾…</p>
<p><strong>è§£å†³</strong>ï¼š</p>
<pre><code class="language-python"># UseAsyncCall
def on_rpc_message(result, error):
if error:
print(f&quot;[-] Error: {error}&quot;)
else:
print(f&quot;[+] Result: {result}&quot;)

script.exports.func(params, on_rpc_message)

# orå¢åŠ è¶…When
result = script.exports_sync.func(params, timeout=10)

</code></pre>
<p>// App Code
Socket socket = new Socket(&quot;127.0.0.1&quot;, 27042); // Frida default port</p>
<pre><code>
* *ç»•è¿‡**ï¼šä¿®æ”¹ Frida Server ç«¯å£

```bash
frida-server -l 0.0.0.0:8888

</code></pre>
<ol start="2">
<li><strong>æ£€æŸ¥ maps æ–‡ä»¶</strong></li>
</ol>
<pre><code class="language-java">BufferedReader reader = new BufferedReader(new FileReader(&quot;/proc/self/maps&quot;));
if (line.contains(&quot;frida&quot;)) {
System.exit(0);
}

</code></pre>
<pre><code class="language-bash"># strongR-frida
wget https://github.com/hluwa/strongR-frida-android/releases/download/xxx/frida-server

</code></pre>
<h2># âŒ é—®é¢˜ 4: è°ƒè¯•å™¨æ— æ³•é™„åŠ </h2>
<p><strong>ç—‡çŠ¶</strong>ï¼šIDA Pro æ˜¾ç¤º &quot;Cannot attach to process&quot;</p>
<p><strong>è§£å†³</strong>ï¼š</p>
<ol>
<li><strong>æ£€æŸ¥ SELinux</strong></li>
</ol>
<pre><code class="language-bash">adb shell getenforce
# IfIs Enforcing
adb shell setenforce 0

</code></pre>
<pre><code class="language-bash">adb shell ps | grep &lt;app_name&gt;
# ç¡®è®¤ PID æ­£ç¡®

</code></pre>
<pre><code>```bash</code></pre>
<p>adb shell
su
echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope</p>
<pre><code>
**ç—‡çŠ¶**ï¼šå¯ç”¨ Stalker å App å¡æ­»

**ä¼˜åŒ–**ï¼š

1. **åªè¿½è¸ªå…³é”®æ¨¡å—**ï¼ˆè§ç¬¬ 7.2 æ­¥ï¼‰

2. **å‡å°‘äº‹ä»¶ç±»å‹**

```javascript
events: {
call: true, // Only record function calls
ret: false, // Don't record returns
exec: false // Don't record every instruction
}

</code></pre>
<pre><code>```javascript</code></pre>
<p>transform: function(iterator) {
// Skip code we don't care about
}</p>
<pre><code>
## å»¶ä¼¸é˜…è¯»

## # ç›¸å…³é…æ–¹

- **[é™æ€åˆ†ææ·±å…¥](#section-19)** - å…ˆé™æ€æ‰¾åˆ°ç›®æ ‡
- **[Frida å¸¸ç”¨è„šæœ¬](#section-35)** - Hook è„šæœ¬æ¨¡æ¿
- **[Frida åè°ƒè¯•](#section-8)** - ç»•è¿‡æ£€æµ‹
- **[SSL Pinning ç»•è¿‡](#section-3-ç»•è¿‡-ssl-pinning)** - æŠ“åŒ…å¿…å¤‡

## # å·¥å…·æ·±å…¥

- **[Frida å®Œæ•´æŒ‡å—](#section-40)**
- **[IDA Pro è°ƒè¯•](#section-47-è¿œç¨‹è°ƒè¯•)**
- **[objection ä½¿ç”¨](../../02-Tools/Dynamic/)** - TODO

## # åœ¨çº¿èµ„æº

- **Frida å®˜æ–¹æ–‡æ¡£** - https://frida.re/docs/
- **Frida Codeshare** - https://codeshare.frida.re/ (è„šæœ¬åˆ†äº«)
- **Frida Handbook** - https://learnfrida.info/

## # ç†è®ºåŸºç¡€

- **[ARM æ±‡ç¼–](#section-66)** - ç†è§£ Native è°ƒè¯•
- **[ART è¿è¡Œæ—¶](#section-65)** - ç†è§£ Java Hook
---
## å¿«é€Ÿå‚è€ƒ

## # Frida Hook æ¨¡æ¿

**Hook Java æ–¹æ³•**ï¼š

```javascript
Java.perform(function () {
var ClassName = Java.use(&quot;com.example.ClassName&quot;);

ClassName.methodName.implementation = function (arg1, arg2) {
console.log(&quot;[*] methodName called&quot;);
console.log(&quot; arg1:&quot;, arg1);
console.log(&quot; arg2:&quot;, arg2);

var result = this.methodName(arg1, arg2);
console.log(&quot; result:&quot;, result);

return result;
};
});

</code></pre>
<p>onEnter: function (args) {
console.log(&quot;[*] native_func called&quot;);
console.log(&quot; arg0:&quot;, args[0]);
console.log(&quot; arg1:&quot;, args[1]);
},
onLeave: function (retval) {
console.log(&quot; retval:&quot;, retval);
},
});</p>
<pre><code>var result = null;
Java.perform(function () {
var Class = Java.use(className);
result = Class[methodName].apply(Class, args);
});
return result;
},
};

</code></pre>
<p>F8 - å•æ­¥è·³è¿‡
Ctrl+F7 - Execute åˆ° Return</p>
<pre><code>next - å•æ­¥è·³è¿‡
finish - Executeåˆ°Return
info registers - Viewå¯„å­˜å™¨
x/10x $sp - Viewæ ˆå†…å®¹

</code></pre>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-21">
                                                <h2>21. R19: OLLVM Deobfuscation</h2>
                                                <h1>R19: OLLVM åæ··æ·†</h1>
<p>OLLVM (Obfuscator-LLVM) æ˜¯ä¸€ä¸ªè‘—åçš„å¼€æºä»£ç æ··æ·†æ¡†æ¶ï¼Œå®ƒåœ¨ LLVM ç¼–è¯‘å™¨ IR (ä¸­é—´è¡¨ç¤º) å±‚é¢è¿›è¡Œæ“ä½œã€‚è¿™ä½¿å…¶èƒ½å¤Ÿä¸å…·ä½“è¯­è¨€æ— å…³ï¼Œå¹¶å¯¹ä»£ç åº”ç”¨å¤æ‚çš„ã€éš¾ä»¥é€†å‘çš„è½¬æ¢ã€‚</p>
<p>!!! warning &quot;åœºæ™¯å¯¼å…¥ï¼šå½“ä½ é‡åˆ° OLLVM&quot;
æ‰“å¼€ IDAï¼Œåç¼–è¯‘ä¸€ä¸ªå‡½æ•°ï¼Œç»“æœçœ‹åˆ°ï¼š</p>
<ul>
<li>ä¸€ä¸ªå·¨å¤§çš„ <code>switch-case</code> å¾ªç¯ï¼Œæœ‰å‡ åç”šè‡³ä¸Šç™¾ä¸ª case åˆ†æ”¯</li>
<li>æ¯ä¸ª case é‡Œåªæœ‰å‡ è¡Œä»£ç ï¼Œç„¶ååˆè·³å› switch</li>
<li>åˆ°å¤„éƒ½æ˜¯çœ‹èµ·æ¥æœ‰ç”¨å®é™…æ— ç”¨çš„ <code>if</code> åˆ¤æ–­</li>
<li>ç®€å•çš„åŠ æ³•è¢«æ›¿æ¢æˆäº† <code>a = b - (-c)</code> è¿™æ ·çš„æ€ªå¼‚è¡¨è¾¾å¼</li>
</ul>
<p><strong>ä½ çš„ç¬¬ä¸€ååº”å¯èƒ½æ˜¯ï¼šè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</strong></p>
<p>æ­å–œï¼Œä½ é‡åˆ°äº† OLLVM æ§åˆ¶æµå¹³å¦åŒ– (FLA) + è™šå‡æ§åˆ¶æµ (BCF) + æŒ‡ä»¤æ›¿æ¢ (SUB) çš„&quot;ä¸‰ä»¶å¥—&quot;ã€‚
è¿™æ˜¯ç›®å‰ Android Native å±‚æœ€å¸¸è§çš„å•†ä¸šçº§æ··æ·†æ–¹æ¡ˆã€‚</p>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼šé¢å¯¹è¿™ç§æ··æ·†ï¼Œæ˜¯é€‰æ‹©&quot;ç¡¬çœ‹&quot;ä»£ç ï¼Œè¿˜æ˜¯æœ‰æ›´èªæ˜çš„åŠæ³•ï¼Ÿ</p>
<p>æœ¬æ–‡æ¡£æ¶µç›–äº†å¸¸è§çš„ OLLVM æ··æ·†é€šé“ (pass) åŠå…¶åˆ†æå’Œé€†å‘ç­–ç•¥ã€‚</p>
<hr />
<h2>æ ¸å¿ƒæ··æ·†æŠ€æœ¯</h2>
<p>OLLVM çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºå…¶ä¸‰ç§æ ¸å¿ƒæ··æ·†æŠ€æœ¯ï¼š</p>
<ol>
<li><p><strong>æ§åˆ¶æµå¹³å¦åŒ– (<code>-fla</code>)</strong>: è¯¥æŠ€æœ¯ä¼šå½»åº•å¹³å¦åŒ–ä¸€ä¸ªå‡½æ•°çš„æ§åˆ¶æµã€‚å®ƒé€šè¿‡å°†æ‰€æœ‰åŸºæœ¬å—æ”¾å…¥ä¸€ä¸ªå•ä¸€çš„ã€å·¨å¤§çš„åˆ†å‘å™¨å¾ªç¯ï¼ˆ&quot;ä¸»åˆ†å‘å™¨&quot;ï¼‰ä¸­æ¥éšè—åŸå§‹çš„ç¨‹åºæµç¨‹ã€‚ä¸€ä¸ªçŠ¶æ€å˜é‡ç”¨äºæ§åˆ¶ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»£ç å—ã€‚é€†å‘æ­¤æŠ€æœ¯éœ€è¦é‡å»ºåŸå§‹çš„æ§åˆ¶æµå›¾ (CFG)ã€‚</p>
</li>
<li><p><strong>è™šå‡æ§åˆ¶æµ (<code>-bcf</code>)</strong>: è¯¥æŠ€æœ¯åœ¨ä»£ç ä¸­æ’å…¥æ— æ•ˆçš„æ¡ä»¶åˆ†æ”¯å’Œä¸é€æ˜è°“è¯ã€‚è¿™äº›åˆ†æ”¯è¢«è®¾è®¡ä¸ºé™æ€åˆ†æéš¾ä»¥è§£æï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œå®ƒä»¬æ€»æ˜¯ä¼šå¾—å‡ºç›¸åŒçš„ç»“æœã€‚è¿™ä¼šç»™æ§åˆ¶æµå›¾å¢åŠ å¤§é‡çš„å™ªå£°ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤æ›¿æ¢ (<code>-sub</code>)</strong>: è¿™æ˜¯æœ€ç®€å•çš„æ··æ·†æ–¹å¼ã€‚å®ƒå°†æ ‡å‡†çš„äºŒè¿›åˆ¶è¿ç®—ç¬¦ï¼ˆå¦‚ <code>add</code>, <code>sub</code>, <code>and</code>, <code>or</code>ï¼‰æ›¿æ¢ä¸ºåŠŸèƒ½ä¸Šç­‰ä»·ä½†æ›´å¤æ‚çš„æŒ‡ä»¤åºåˆ—ã€‚ä¾‹å¦‚ï¼Œ<code>a = b + c</code> å¯èƒ½ä¼šå˜æˆ <code>a = b - (-c)</code>ã€‚</p>
</li>
</ol>
<hr />
<h2>åˆ†æä¸åæ··æ·†ç­–ç•¥</h2>
<p>!!! question &quot;æ€è€ƒï¼šé™æ€åˆ†æ vs åŠ¨æ€åˆ†æï¼Œå“ªä¸ªæ›´æœ‰æ•ˆï¼Ÿ&quot;
é¢å¯¹ OLLVM æ··æ·†ï¼Œæœ‰ä¸¤ç§å®Œå…¨ä¸åŒçš„æ€è·¯ï¼š</p>
<p><strong>é™æ€åˆ†æ</strong>ï¼š</p>
<ul>
<li>âœ… ä¼˜åŠ¿ï¼šèƒ½çœ‹åˆ°æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†åˆ†æ”¯</li>
<li>âŒ åŠ£åŠ¿ï¼šéœ€è¦å¯¹æŠ—å¤§é‡çš„è™šå‡åˆ†æ”¯ï¼Œåˆ†æå·¥ä½œé‡å·¨å¤§</li>
<li>é€‚ç”¨åœºæ™¯ï¼šä½ éœ€è¦ç†è§£å®Œæ•´çš„ç®—æ³•é€»è¾‘ï¼Œæˆ–è€…å¯»æ‰¾æ¼æ´</li>
</ul>
<p><strong>åŠ¨æ€åˆ†æ</strong>ï¼š</p>
<ul>
<li>âœ… ä¼˜åŠ¿ï¼šç›´æ¥è®°å½•çœŸå®æ‰§è¡Œè·¯å¾„ï¼Œç»•è¿‡æ‰€æœ‰è™šå‡åˆ†æ”¯</li>
<li>âŒ åŠ£åŠ¿ï¼šåªèƒ½çœ‹åˆ°å½“å‰è¾“å…¥ä¸‹çš„æ‰§è¡Œè·¯å¾„ï¼Œå¯èƒ½é—æ¼å…³é”®åˆ†æ”¯</li>
<li>é€‚ç”¨åœºæ™¯ï¼šä½ åªæƒ³æå–ç®—æ³•ç»“æœï¼ˆå¦‚åŠ å¯†ç­¾åï¼‰ï¼Œä¸å…³å¿ƒå†…éƒ¨é€»è¾‘</li>
</ul>
<p><strong>å®æˆ˜å»ºè®®</strong>ï¼š</p>
<ol>
<li>å…ˆç”¨åŠ¨æ€åˆ†æï¼ˆFrida Stalker / Unidbg traceï¼‰å¿«é€Ÿè·å–&quot;çœŸå®&quot;çš„æ‰§è¡Œæµ</li>
<li>å†ç”¨é™æ€åˆ†æéªŒè¯å’Œè¡¥å……åŠ¨æ€åˆ†æé—æ¼çš„éƒ¨åˆ†</li>
<li>å¦‚æœç›®æ ‡æ˜¯è‡ªåŠ¨åŒ–ï¼ˆå¦‚ç®—æ³•è¿˜åŸï¼‰ï¼Œè€ƒè™‘ç¬¦å·æ‰§è¡Œï¼ˆAngrï¼‰</li>
</ol>
<h3>1. é™æ€åˆ†æ</h3>
<ul>
<li><p><strong>CFG é‡å»º</strong>: å¯¹äºæ§åˆ¶æµå¹³å¦åŒ–ï¼Œå…³é”®æ˜¯è¯†åˆ«çŠ¶æ€å˜é‡å’Œåˆ†å‘å™¨ã€‚é€šè¿‡ç¬¦å·æ‰§è¡Œæˆ–æ¨¡å¼åŒ¹é…åˆ†å‘å™¨é€»è¾‘ï¼Œå¯ä»¥ç¡®å®šæ¯ä¸ªçœŸå®åŸºæœ¬å—çš„åç»§ï¼Œä»è€Œé‡å»ºåŸå§‹å›¾ã€‚</p>
</li>
<li><p><strong>ä¸é€æ˜è°“è¯æ±‚è§£</strong>: Z3 æˆ–å…¶ä»– SMT æ±‚è§£å™¨ç­‰å·¥å…·å¯ç”¨äºè‡ªåŠ¨è¯æ˜è™šå‡æ§åˆ¶æµä¸­çš„æ¡ä»¶æ˜¯ä¸å˜çš„ã€‚è¿™ä½¿å¾—åˆ†æå¸ˆèƒ½å¤Ÿè¯†åˆ«å¹¶ç§»é™¤æ— æ•ˆçš„ä»£ç è·¯å¾„ã€‚</p>
</li>
<li><p><strong>æ¨¡å¼åŒ¹é…</strong>: å¯¹äºæŒ‡ä»¤æ›¿æ¢ï¼Œå¯ä»¥è¯†åˆ«å¹¶æ›¿æ¢ç®€å•çš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåƒ <code>x = rdtsc(); y = x &amp; 1; if (y == 0) ...</code> è¿™æ ·çš„åºåˆ—æ˜¯ä¸€ä¸ªå¸¸è§çš„è™šå‡è°“è¯ã€‚</p>
</li>
</ul>
<h3>2. åŠ¨æ€åˆ†æ</h3>
<ul>
<li><p><strong>ä½¿ç”¨ Frida/Unidbg è¿›è¡Œè¿½è¸ª</strong>: åŠ¨æ€è¿½è¸ªéå¸¸æœ‰æ•ˆã€‚é€šè¿‡ä½¿ç”¨ Frida çš„ <code>Stalker</code> æˆ– Unidbg çš„è¿½è¸ªåŠŸèƒ½ï¼Œå¯ä»¥è®°å½•è¿è¡Œæ—¶æ‰§è¡Œçš„åŸºæœ¬å—çš„ç¡®åˆ‡é¡ºåºã€‚è¿™å¯ä»¥ç»•è¿‡æ‰€æœ‰çš„æ§åˆ¶æµæ··æ·†ï¼Œä¸ºä½ æä¾›&quot;çœŸå®&quot;çš„æ‰§è¡Œè·¯å¾„ã€‚</p>
</li>
<li><p><strong>ç¬¦å·æ‰§è¡Œ</strong>: åƒ Angr è¿™æ ·çš„å¼•æ“å¯ç”¨äºæ¢ç´¢ç¨‹åºçŠ¶æ€ã€‚ç¬¦å·æ‰§è¡Œå¯ä»¥è‡ªåŠ¨æ±‚è§£è·¯å¾„çº¦æŸï¼Œä»è€Œæœ‰æ•ˆåœ°åæ··æ·†æ§åˆ¶æµå¹¶ç®€åŒ–ä¸é€æ˜è°“è¯ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½å¾ˆæ…¢ï¼Œä½†åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚</p>
</li>
</ul>
<h3>3. è‡ªåŠ¨åŒ–å·¥å…·</h3>
<ul>
<li><p><strong>d-obfuscator</strong>: ä¸€ä¸ªåŸºäº Python çš„å·¥å…·ï¼Œä½¿ç”¨ç¬¦å·æ‰§è¡Œï¼ˆé€šè¿‡ Angrï¼‰æ¥åæ··æ·† OLLVMã€‚</p>
</li>
<li><p><strong>QB-Di</strong>: ä¸€ä¸ªåŸºäº QBDI åŠ¨æ€æ’æ¡©æ¡†æ¶çš„äº¤äº’å¼åæ··æ·†å·¥å…·ã€‚</p>
</li>
<li><p><strong>Triton</strong>: ä¸€ä¸ªåŠ¨æ€äºŒè¿›åˆ¶åˆ†ææ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬æ¥æ‰§è¡Œæ±¡ç‚¹åˆ†æå’Œç¬¦å·æ‰§è¡Œã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-22">
                                                <h2>22. R20: VMP Analysis</h2>
                                                <h1>R20: VMP åˆ†æ</h1>
<p>VMP (VMProtect çš„ç®€ç§°) æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„è½¯ä»¶ä¿æŠ¤è§£å†³æ–¹æ¡ˆï¼Œå®ƒä½¿ç”¨è™šæ‹ŸåŒ–ï¼ˆä¸€ä¸ª&quot;è™šæ‹Ÿæœº&quot;ï¼‰æ¥ä¿æŠ¤ä»£ç ã€‚å—ä¿æŠ¤çš„ä»£ç ä¸å†æ‰§è¡ŒåŸç”Ÿ CPU æŒ‡ä»¤ï¼Œè€Œæ˜¯è¢«è½¬æ¢æˆä¸€ç§è‡ªå®šä¹‰çš„å­—èŠ‚ç ï¼Œåªæœ‰ç‰¹å®šçš„ã€åµŒå…¥çš„è™šæ‹Ÿæœºæ‰èƒ½è§£é‡Šæ‰§è¡Œã€‚</p>
<p>åˆ†æå— VMP ä¿æŠ¤çš„ä»£ç æ˜¯é€†å‘å·¥ç¨‹ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ä¹‹ä¸€ã€‚</p>
<hr />
<h2>æ ¸å¿ƒæ¦‚å¿µ</h2>
<ol>
<li><strong>è™šæ‹Ÿæœº (VM)</strong>: VMP çš„æ ¸å¿ƒã€‚å®ƒåŒ…æ‹¬ï¼š</li>
</ol>
<ul>
<li><strong>è§£é‡Šå™¨å¾ªç¯</strong>: è¯»å–å­—èŠ‚ç å¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†ç¨‹åº (handler)ã€‚</li>
<li><strong>å¤„ç†ç¨‹åº (Handlers)</strong>: å®ç°æ¯ä¸ªè‡ªå®šä¹‰å­—èŠ‚ç æŒ‡ä»¤é€»è¾‘çš„å°æ®µåŸç”Ÿä»£ç ï¼ˆä¾‹å¦‚ï¼Œè™šæ‹ŸåŠ æ³•ã€è™šæ‹Ÿè·³è½¬ï¼‰ã€‚</li>
<li><strong>è™šæ‹Ÿå¯„å­˜å™¨</strong>: VM ä½¿ç”¨è‡ªå·±çš„ä¸€å¥—è™šæ‹Ÿå¯„å­˜å™¨æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™äº›è™šæ‹Ÿå¯„å­˜å™¨ä¼šæ˜ å°„åˆ°åŸç”Ÿå¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ã€‚</li>
<li><strong>VM ä¸Šä¸‹æ–‡</strong>: ä¸€ä¸ªå­˜å‚¨ VM æ‰€æœ‰çŠ¶æ€çš„ç»“æ„ï¼ŒåŒ…æ‹¬è™šæ‹Ÿå¯„å­˜å™¨ã€æ ‡å¿—ä½å’Œè™šæ‹ŸæŒ‡ä»¤æŒ‡é’ˆ (VIP)ã€‚</li>
</ul>
<ol start="2">
<li><p><strong>å­—èŠ‚ç </strong>: åŸå§‹çš„åŸç”Ÿä»£ç è¢«ç¿»è¯‘æˆä¸€ä¸ªä¸“ä¸ºåµŒå…¥å¼ VM è®¾è®¡çš„è‡ªå®šä¹‰ã€éæ ‡å‡†çš„æŒ‡ä»¤é›†ã€‚</p>
</li>
<li><p><strong>çªå˜ (Mutation)</strong>: ä¸ºäº†è®©åˆ†ææ›´åŠ å›°éš¾ï¼ŒVMP ä¼šä¸ºæ¯ä¸ªæ–°ç‰ˆæœ¬çš„å—ä¿æŠ¤è½¯ä»¶çªå˜ VM çš„å¤„ç†ç¨‹åºå’Œå­—èŠ‚ç ã€‚è¿™æ„å‘³ç€ä¸€ä¸ª&quot;è™šæ‹ŸåŠ æ³•&quot;æŒ‡ä»¤çš„å¤„ç†ç¨‹åºæ¯æ¬¡éƒ½ä¼šçœ‹èµ·æ¥ä¸ä¸€æ ·ã€‚</p>
</li>
</ol>
<hr />
<h2>åˆ†æç­–ç•¥</h2>
<p>ç›´æ¥å¯¹ VMP è¿›è¡Œå»è™šæ‹ŸåŒ–æå…¶å›°éš¾ï¼Œé€šå¸¸ä¹Ÿä¸æ˜¯ä¸»è¦ç›®æ ‡ã€‚é‡ç‚¹é€šå¸¸æ˜¯ç†è§£æŸä¸ªç‰¹å®šå—ä¿æŠ¤å‡½æ•°çš„é€»è¾‘ã€‚</p>
<h3>1. è¯†åˆ« VM åŠå…¶ç»„ä»¶</h3>
<ul>
<li><strong>å…¥å£ç‚¹åˆ†æ</strong>: ç¬¬ä¸€æ­¥æ˜¯å®šä½&quot;VM å…¥å£&quot;ï¼Œå³ç¨‹åºä»æ‰§è¡ŒåŸç”Ÿä»£ç åˆ‡æ¢åˆ° VM è§£é‡Šå™¨å¾ªç¯çš„åœ°æ–¹ã€‚å…¶ç‰¹å¾é€šå¸¸æ˜¯ä¸€ç³»åˆ—çš„ PUSH æŒ‡ä»¤ï¼Œç”¨ä»¥ä¿å­˜åŸç”Ÿä¸Šä¸‹æ–‡ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ä¸€ä¸ª JMP/CALL æŒ‡ä»¤è¿›å…¥è§£é‡Šå™¨ã€‚</li>
<li><strong>å¤„ç†ç¨‹åºè¿½è¸ª</strong>: ä¸€æ—¦è¿›å…¥ VMï¼Œè¿½è¸ªæ‰§è¡Œæµå°†æ­ç¤ºä¸åŒå¤„ç†ç¨‹åºçš„åœ°å€ã€‚é€šè¿‡åˆ†ææ¯ä¸ªå¤„ç†ç¨‹åºå¯¹ VM ä¸Šä¸‹æ–‡åšäº†ä»€ä¹ˆï¼Œå°±å¯ä»¥å¼€å§‹å‹¾å‹’å‡ºè™šæ‹ŸæŒ‡ä»¤é›†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¯»å–ä¸¤ä¸ªè™šæ‹Ÿå¯„å­˜å™¨ã€å°†å®ƒä»¬ç›¸åŠ å¹¶å­˜å‚¨ç»“æœçš„å¤„ç†ç¨‹åºå¾ˆå¯èƒ½å°±æ˜¯&quot;è™šæ‹ŸåŠ æ³•&quot;ã€‚</li>
</ul>
<h3>2. åŠ¨æ€åˆ†æä¸è¿½è¸ª</h3>
<ul>
<li><strong>æŒ‡ä»¤è¿½è¸ª</strong>: è¿™æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„è™šæ‹ŸæŒ‡ä»¤çš„è¿½è¸ªè®°å½•ã€‚è¿™éœ€è¦ï¼š</li>
</ul>
<ol>
<li>åœ¨è§£é‡Šå™¨å¾ªç¯çš„å¼€å§‹å¤„ï¼ˆæˆ–æ¯ä¸ªå¤„ç†ç¨‹åºä¸Šï¼‰è®¾ç½®æ–­ç‚¹ã€‚</li>
<li>åœ¨æ¯ä¸€æ­¥ï¼Œè½¬å‚¨è™šæ‹Ÿæœºçš„çŠ¶æ€ï¼ˆè™šæ‹Ÿå¯„å­˜å™¨ã€VIPï¼‰ã€‚</li>
<li>è®°å½•å¤„ç†ç¨‹åºæ‰§è¡Œçš„åŸç”Ÿæ“ä½œã€‚</li>
</ol>
<ul>
<li><strong>Frida/DBI å·¥å…·</strong>: åƒ Fridaã€Pin æˆ– QBDI è¿™æ ·çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡© (DBI) æ¡†æ¶è‡³å…³é‡è¦ã€‚å®ƒä»¬å…è®¸ä½ ç¼–å†™è¿½è¸ªè¿‡ç¨‹çš„è„šæœ¬ï¼Œåœ¨è§£é‡Šå™¨çš„æ¯ä¸€æ­¥è‡ªåŠ¨è®°å½• VM çŠ¶æ€ã€‚</li>
</ul>
<h3>3. é‡å»ºé€»è¾‘</h3>
<ul>
<li><strong>è¯­ä¹‰é‡å»º</strong>: æ”¶é›†åˆ°è™šæ‹ŸæŒ‡ä»¤çš„è¿½è¸ªè®°å½•åï¼Œå°±å¯ä»¥å¼€å§‹é‡å»ºé«˜å±‚é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª&quot;åŠ è½½&quot;ã€&quot;ç›¸åŠ &quot;ã€&quot;å­˜å‚¨&quot;çš„è™šæ‹ŸæŒ‡ä»¤åºåˆ—å¯ä»¥è¢«ç¿»è¯‘å›ç±»ä¼¼ C çš„è¡¨è¾¾å¼ <code>var = a + b;</code>ã€‚</li>
<li><strong>æå‡åˆ°æ›´é«˜çº§åˆ«çš„ IR</strong>: å®Œæ•´çš„å»è™šæ‹ŸåŒ–å·¥ä½œçš„æœ€ç»ˆç›®æ ‡æ˜¯å°†è‡ªå®šä¹‰å­—èŠ‚ç &quot;æå‡&quot;åˆ°ä¸€ä¸ªæ ‡å‡†çš„ä¸­é—´è¡¨ç¤ºï¼Œå¦‚ LLVM IR æˆ– REILã€‚è¿™è®©ä½ èƒ½å¤Ÿä½¿ç”¨æ ‡å‡†çš„ç¼–è¯‘å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ã€ç ”ç©¶çº§åˆ«çš„é—®é¢˜ã€‚</li>
</ul>
<h3>4. å…³é”®è¦ç‚¹</h3>
<p>ä¸è¦è¯•å›¾åç¼–è¯‘ VM æœ¬èº«ã€‚ç›¸åï¼Œ<strong>è¿½è¸ª VM çš„æ‰§è¡Œ</strong>æ¥ç†è§£å®ƒåœ¨åšä»€ä¹ˆã€‚å®ƒæ‰€è°ƒç”¨çš„å¤„ç†ç¨‹åºçš„åºåˆ—æ‰æ˜¯ä½ éœ€è¦åˆ†æçš„çœŸæ­£é€»è¾‘ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-23">
                                                <h2>23. R21: JS Obfuscator</h2>
                                                <h1>R21: JavaScript Obfuscator (OB æ··æ·†) åˆ†æ</h1>
<p><code>javascript-obfuscator</code> æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œå’Œå¼ºå¤§çš„å¼€æºå·¥å…·ï¼Œç”¨äºæ··æ·†å’Œä¿æŠ¤ JavaScript ä»£ç ã€‚å®ƒçš„æ··æ·†äº§ç‰©é€šå¸¸è¢«ç§°ä¸º&quot;OB æ··æ·†&quot;ã€‚OB æ··æ·†é€šè¿‡å¤šç§æ‰‹æ®µçš„ç»„åˆï¼Œä½¿å¾—ä»£ç éš¾ä»¥é˜…è¯»ã€ç†è§£å’Œè°ƒè¯•ã€‚</p>
<h2>æ ¸å¿ƒæ··æ·†æŠ€æœ¯</h2>
<p>OB æ··æ·†ä¸»è¦ä¾èµ–äºä»¥ä¸‹å‡ ç§å…³é”®æŠ€æœ¯ï¼š</p>
<h3>1. å­—ç¬¦ä¸²æ··æ·† (String Concealing)</h3>
<ul>
<li><p><strong>å­—ç¬¦ä¸²æ•°ç»„</strong>ï¼šå°†ä»£ç ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼ˆç‰¹åˆ«æ˜¯æ•æ„Ÿä¿¡æ¯ï¼‰æå–å‡ºæ¥ï¼Œæ”¾å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå·¨å¤§çš„æ•°ç»„ä¸­ã€‚</p>
</li>
<li><p><strong>ç¼–ç ä¸åŠ å¯†</strong>ï¼šè¿™äº›å­—ç¬¦ä¸²é€šå¸¸ä¼šä½¿ç”¨ Base64ã€RC4 æˆ–å…¶ä»–è‡ªå®šä¹‰ç®—æ³•è¿›è¡Œç¼–ç æˆ–åŠ å¯†ã€‚</p>
</li>
<li><p><strong>è§£ç å‡½æ•°</strong>ï¼šæä¾›ä¸€ä¸ªæˆ–å¤šä¸ªè§£ç å‡½æ•°ã€‚åœ¨ä»£ç æ‰§è¡Œæ—¶ï¼Œé€šè¿‡è°ƒç”¨ <code>decoder(&quot;0x1&quot;)</code> è¿™æ ·çš„å½¢å¼æ¥è·å–åŸå§‹å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><strong>æ•°ç»„ä¹±åºä¸è‡ªæ„ˆ</strong>ï¼šä¸ºäº†é˜²æ­¢é™æ€åˆ†æï¼Œå­—ç¬¦ä¸²æ•°ç»„çš„é¡ºåºä¼šåœ¨è„šæœ¬æ‰§è¡ŒåˆæœŸè¢«åŠ¨æ€æ‰“ä¹±ï¼Œè§£ç å‡½æ•°ä¹Ÿä¼šéšä¹‹è°ƒæ•´ï¼Œå¢åŠ äº†é™æ€è¿˜åŸçš„éš¾åº¦ã€‚</p>
</li>
</ul>
<h3>2. æ§åˆ¶æµå¹³å¦åŒ– (Control Flow Flattening)</h3>
<p>è¿™æ˜¯ OB æ··æ·†æœ€æ ¸å¿ƒã€æœ€å¤æ‚çš„ç‰¹å¾ä¹‹ä¸€ã€‚</p>
<ul>
<li><p><strong>çŠ¶æ€æœºè½¬æ¢</strong>ï¼šå°†åŸå§‹ä»£ç å—ï¼ˆå¦‚å‡½æ•°ä½“å†…çš„è¯­å¥ï¼‰åˆ†å‰²æˆå¤šä¸ªå°çš„ä»£ç ç‰‡æ®µï¼Œå¹¶æ”¾å…¥ä¸€ä¸ªå·¨å¤§çš„ <code>while</code> å¾ªç¯ä¸­çš„ <code>switch</code> ç»“æ„é‡Œã€‚</p>
</li>
<li><p><strong>çŠ¶æ€å˜é‡</strong>ï¼šç”¨ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰æ¥æ§åˆ¶ <code>switch</code> çš„æ‰§è¡Œé¡ºåºã€‚æ¯ä¸ª <code>case</code> æ‰§è¡Œå®Œæ¯•åï¼Œä¼šæ›´æ–°çŠ¶æ€å˜é‡ï¼Œå†³å®šä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ <code>case</code>ã€‚</p>
</li>
<li><p><strong>é€»è¾‘æ‰“æ–­</strong>ï¼šåŸå§‹çº¿æ€§çš„ä»£ç é€»è¾‘è¢«å®Œå…¨æ‰“ä¹±ï¼Œå˜æˆäº†åœ¨ä¸€ä¸ªå·¨å¤§çš„å¾ªç¯ä¸­æ— åºè·³è½¬ï¼Œä½¿å¾—äººå·¥è·Ÿè¸ªå˜å¾—æå…¶å›°éš¾ã€‚</p>
</li>
</ul>
<h3>3. ä»£ç è½¬æ¢ä¸ç¼–ç  (Code Transformation)</h3>
<ul>
<li><p><strong>å˜é‡åæ··æ·† (Identifier Mangling)</strong>ï¼šå°†æœ‰æ„ä¹‰çš„å˜é‡åã€å‡½æ•°åå’Œå±æ€§åæ›¿æ¢æˆæ— æ„ä¹‰çš„çŸ­å­—ç¬¦ï¼Œå¦‚ <code>_0xabc123</code>ã€‚</p>
</li>
<li><p><strong>æ•°å­—å¸¸é‡æ›¿æ¢</strong>ï¼šå°†ä»£ç ä¸­çš„æ•°å­—å¸¸é‡ï¼ˆå¦‚ <code>123</code>ï¼‰æ›¿æ¢æˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼ˆå¦‚ <code>0x7b</code>ï¼‰ï¼Œæˆ–è€…æ›´å¤æ‚çš„è¡¨è¾¾å¼ï¼Œå¢åŠ é˜…è¯»éš¾åº¦ã€‚</p>
</li>
<li><p><strong>ä»£ç†å‡½æ•° (Proxy Functions)</strong>ï¼šå°†ç®€å•çš„äºŒå…ƒè¿ç®—ï¼ˆå¦‚ <code>a + b</code>ï¼‰æˆ–å¯¹è±¡å±æ€§è®¿é—®ï¼ˆ<code>obj.prop</code>ï¼‰æ›¿æ¢æˆå¯¹ä¸€ä¸ªä»£ç†å‡½æ•°çš„è°ƒç”¨ï¼Œä¾‹å¦‚ <code>add(a, b)</code>ã€‚è¿™ä½¿å¾—æ‰¹é‡æ›¿æ¢å’Œæ¨¡å¼è¯†åˆ«å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
</li>
<li><p><strong>æ­»ä»£ç æ³¨å…¥ (Dead Code Injection)</strong>ï¼šåœ¨ä»£ç ä¸­æ’å…¥ä¸€äº›æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œçš„ã€ä½†çœ‹èµ·æ¥å¾ˆå¤æ‚çš„é€»è¾‘åˆ†æ”¯ï¼ˆé€šå¸¸ä¸ä¸é€æ˜è°“è¯ç»“åˆï¼‰ï¼Œç”¨æ¥è¿·æƒ‘åˆ†æè€…ã€‚</p>
</li>
</ul>
<h3>4. åè°ƒè¯•ä¸åæ ¼å¼åŒ– (Anti-Debugging)</h3>
<ul>
<li><p><strong><code>debugger</code> è¯­å¥</strong>ï¼šåœ¨ä»£ç ä¸­æ’å…¥ <code>debugger;</code> è¯­å¥ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå°†å…¶åŒ…è£¹åœ¨ä¸€ä¸ªæ— é™å¾ªç¯çš„å‡½æ•°ä¸­ã€‚å½“å¼€å‘è€…å·¥å…·æ‰“å¼€æ—¶ï¼Œç¨‹åºä¼šç«‹å³æš‚åœå¹¶é™·å…¥è¿™ä¸ªå¾ªç¯ï¼Œé˜»ç¢åŠ¨æ€è°ƒè¯•ã€‚</p>
</li>
<li><p><strong>å‡½æ•°é‡ç»‘å®š</strong>ï¼šé€šè¿‡ <code>Function.prototype.constructor</code> æˆ– <code>eval</code> æ¥æ‰§è¡Œä»£ç ï¼Œä½¿å¾—å¸¸è§„çš„æ–­ç‚¹éš¾ä»¥å‘½ä¸­ã€‚</p>
</li>
<li><p><strong>åæ ¼å¼åŒ–</strong>ï¼šæ£€æµ‹ä»£ç æ˜¯å¦è¢«ç¾åŒ–æˆ–æ ¼å¼åŒ–ï¼Œå¦‚æœå‘ç°ï¼Œåˆ™å¯èƒ½è¿›å…¥æ­»å¾ªç¯æˆ–æ‰§è¡Œé”™è¯¯é€»è¾‘ã€‚</p>
</li>
</ul>
<h2>åˆ†æä¸åæ··æ·†ç­–ç•¥</h2>
<p>åæ··æ·† OB ä»£ç é€šå¸¸æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§çš„å·¥ç¨‹ï¼Œéœ€è¦å¤šç§å·¥å…·å’ŒæŠ€æœ¯ç»“åˆã€‚</p>
<h3>1. å­—ç¬¦ä¸²è§£å¯†ä¸æ›¿æ¢</h3>
<ul>
<li><p><strong>å®šä½è§£ç å‡½æ•°</strong>ï¼šæ‰¾åˆ°è´Ÿè´£ä»å­—ç¬¦ä¸²æ•°ç»„ä¸­å–å€¼å¹¶è§£å¯†çš„å‡½æ•°ã€‚</p>
</li>
<li><p><strong>æ‰§è¡Œè§£ç é€»è¾‘</strong>ï¼š</p>
</li>
<li><p><strong>åŠ¨æ€æ‰§è¡Œ</strong>ï¼šåœ¨ Node.js æˆ–æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨è§£ç å‡½æ•°ï¼Œå°†æ‰€æœ‰åŠ å¯†çš„å­—ç¬¦ä¸²é¢„å…ˆè§£å¯†å‡ºæ¥ã€‚</p>
</li>
<li><p><strong>é™æ€åˆ†æ</strong>ï¼šå¦‚æœè§£ç ç®—æ³•ï¼ˆå¦‚ RC4ï¼‰æ¯”è¾ƒæ ‡å‡†ï¼Œå¯ä»¥ç¼–å†™è„šæœ¬é™æ€åœ°è§£å¯†æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><strong>æ‰¹é‡æ›¿æ¢</strong>ï¼šç¼–å†™è„šæœ¬ï¼ˆé€šå¸¸åŸºäº ASTï¼‰ï¼Œå°†ä»£ç ä¸­æ‰€æœ‰å¯¹è§£ç å‡½æ•°çš„è°ƒç”¨ <code>decoder(&quot;0x1&quot;)</code> æ›¿æ¢æˆå…¶è¿”å›çš„åŸå§‹å­—ç¬¦ä¸² <code>&quot;original_string&quot;</code>ã€‚</p>
</li>
</ul>
<h3>2. æ§åˆ¶æµå¹³å¦åŒ–è¿˜åŸ</h3>
<p>è¿™æ˜¯æœ€å›°éš¾çš„ä¸€æ­¥ï¼Œä½†ä¹Ÿæ˜¯æœ€æœ‰ä»·å€¼çš„ä¸€æ­¥ã€‚</p>
<ul>
<li><p><strong>AST åˆ†æ</strong>ï¼šä½¿ç”¨ Babel ç­‰å·¥å…·å°†ä»£ç è§£ææˆ ASTã€‚</p>
</li>
<li><p><strong>å®šä½ä¸»å¾ªç¯</strong>ï¼šæ‰¾åˆ°åŒ…å« <code>while(true)</code> å’Œ <code>switch</code> çš„å·¨å¤§å¾ªç¯ä½“ã€‚</p>
</li>
<li><p><strong>è¯†åˆ«çŠ¶æ€å˜é‡</strong>ï¼šæ‰¾åˆ°æ§åˆ¶ <code>switch</code> è·³è½¬çš„çŠ¶æ€å˜é‡å’Œå®ƒçš„åˆå§‹å€¼ã€‚</p>
</li>
<li><p><strong>é‡æ’ä»£ç å—</strong>ï¼š</p>
</li>
</ul>
<ol>
<li>æå– <code>switch</code> çš„ <code>case</code> æ•°ç»„å’ŒçŠ¶æ€å˜é‡çš„åˆå§‹è·³è½¬é¡ºåºã€‚</li>
<li>æ ¹æ®è¿™ä¸ªé¡ºåºï¼Œå°†æ¯ä¸ª <code>case</code> å—ä¸­çš„ä»£ç æŒ‰æ­£ç¡®çš„é€»è¾‘é‡æ–°æ’åˆ—ã€‚</li>
<li>ç§»é™¤ <code>while</code> å’Œ <code>switch</code> ç»“æ„ï¼Œç”Ÿæˆçº¿æ€§çš„ã€å¯è¯»çš„ä»£ç ã€‚</li>
</ol>
<ul>
<li><strong>è‡ªåŠ¨åŒ–å·¥å…·</strong>ï¼šç¤¾åŒºä¸­æœ‰ä¸€äº›å°è¯•è‡ªåŠ¨åŒ–è¿˜åŸæ§åˆ¶æµçš„å·¥å…·ï¼Œä½†ç”±äº OB æ··æ·†å˜ç§ç¹å¤šï¼Œé€šç”¨æ€§æœ‰é™ã€‚</li>
</ul>
<h3>3. å…¶ä»–å‡€åŒ–æ“ä½œ</h3>
<ul>
<li><p><strong>å¸¸é‡è¡¨è¾¾å¼è®¡ç®—</strong>ï¼šå°† <code>0x7b</code> è¿™æ ·çš„è¡¨è¾¾å¼ç›´æ¥è®¡ç®—æˆ <code>123</code>ã€‚</p>
</li>
<li><p><strong>ä»£ç†å‡½æ•°å†…è”</strong>ï¼šå°†ä»£ç†å‡½æ•°çš„é€»è¾‘ç›´æ¥æ›¿æ¢å›åŸæ¥çš„ä½ç½®ï¼Œä¾‹å¦‚å°† <code>add(a, b)</code> è¿˜åŸæˆ <code>a + b</code>ã€‚</p>
</li>
<li><p><strong>æ­»ä»£ç ç§»é™¤</strong>ï¼šé€šè¿‡åˆ†ææ§åˆ¶æµï¼Œè¯†åˆ«å¹¶åˆ é™¤æ— æ³•è®¿é—®åˆ°çš„ä»£ç å—ã€‚</p>
</li>
</ul>
<h2>å¸¸ç”¨å·¥å…·</h2>
<ul>
<li><p><strong>Babel (æ ¸å¿ƒ)</strong>ï¼šç”¨äºè§£æï¼ˆParseï¼‰ã€è½¬æ¢ï¼ˆTransformï¼‰å’Œç”Ÿæˆï¼ˆGenerateï¼‰JavaScript ä»£ç ï¼Œæ˜¯ç¼–å†™åæ··æ·†è„šæœ¬çš„åŸºç¡€ã€‚</p>
</li>
<li><p><strong>AST Explorer</strong>ï¼šåœ¨çº¿æŸ¥çœ‹ AST ç»“æ„ï¼Œä¾¿äºç¼–å†™è½¬æ¢é€»è¾‘ã€‚</p>
</li>
<li><p><strong>Node.js / æµè§ˆå™¨æ§åˆ¶å°</strong>ï¼šç”¨äºåŠ¨æ€æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œç‰¹åˆ«æ˜¯è§£å¯†å‡½æ•°ã€‚</p>
</li>
<li><p><strong>de4js</strong>, <strong>js-beautify</strong>ï¼šç”¨äºåŸºæœ¬çš„ä»£ç æ ¼å¼åŒ–å’Œä¸€äº›ç®€å•çš„åæ··æ·†ã€‚</p>
</li>
<li><p><strong>AST-Deobfuscator</strong>ï¼šä¸€äº›å¼€æºçš„ã€åŸºäº AST çš„åæ··æ·†å·¥å…·æ¡†æ¶ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-24">
                                                <h2>24. R22: JS VMP</h2>
                                                <h1>R22: JavaScript VMP é€†å‘å·¥ç¨‹</h1>
<p>JavaScript VMPï¼ˆè™šæ‹Ÿæœºä¿æŠ¤ï¼‰æ˜¯ä¸€ç§é«˜çº§çš„ä»£ç ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†åŸå§‹çš„ JavaScript ä»£ç è½¬æ¢æˆä¸€ç§è‡ªå®šä¹‰çš„ã€åŸºäºè™šæ‹Ÿæœºçš„å­—èŠ‚ç ã€‚ç„¶åï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¸€ä¸ªå†…ç½®çš„è§£é‡Šå™¨ï¼ˆæˆ–è™šæ‹Ÿæœºï¼‰ä¼šæ‰§è¡Œè¿™äº›å­—èŠ‚ç ã€‚è¿™ç§æ–¹å¼æå¤§åœ°å¢åŠ äº†é€†å‘å·¥ç¨‹çš„éš¾åº¦ï¼Œå› ä¸ºå®ƒéšè—äº†åŸå§‹çš„ä»£ç é€»è¾‘å’Œç»“æ„ã€‚</p>
<h2>æ ¸å¿ƒåŸç†</h2>
<p>JSVMP çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡ä»¤é›†å’Œä¸€ä¸ªå¯¹åº”çš„è™šæ‹Ÿæœºæ¥æ‰§è¡Œå®ƒã€‚</p>
<ol>
<li><strong>ä»£ç è½¬æ¢ï¼ˆç¼–è¯‘ï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li><p><strong>è¯æ³•åˆ†æä¸è§£æ</strong>ï¼šå°†åŸå§‹ JavaScript ä»£ç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤ç”Ÿæˆ</strong>ï¼šéå† ASTï¼Œå°†ä»£ç é€»è¾‘è½¬æ¢æˆè‡ªå®šä¹‰çš„å­—èŠ‚ç åºåˆ—ã€‚ä¾‹å¦‚ï¼Œ<code>a + b</code> å¯èƒ½ä¼šè¢«è½¬æ¢æˆ <code>PUSH a; PUSH b; ADD</code>ã€‚</p>
</li>
<li><p><strong>è™šæ‹Ÿæœºæ³¨å…¥</strong>ï¼šå°†å®ç°äº†è§£é‡Šå™¨ã€æŒ‡ä»¤è°ƒåº¦å¾ªç¯å’Œæ“ä½œå‡½æ•°çš„è™šæ‹Ÿæœºï¼ˆé€šå¸¸ç”¨ JavaScript ç¼–å†™ï¼‰ä¸ç”Ÿæˆçš„å­—èŠ‚ç æ‰“åŒ…åœ¨ä¸€èµ·ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>è¿è¡Œæ—¶æ‰§è¡Œ</strong>ï¼š</li>
</ol>
<ul>
<li><p><strong>è™šæ‹Ÿæœºåˆå§‹åŒ–</strong>ï¼šè®¾ç½®è™šæ‹Ÿæœºçš„æ‰§è¡Œç¯å¢ƒï¼Œå¦‚å †æ ˆï¼ˆStackï¼‰ã€ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰å’Œä¸Šä¸‹æ–‡ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤å¾ªç¯ï¼ˆFetch-Decode-Executeï¼‰</strong>ï¼š</p>
</li>
<li><p><strong>Fetch</strong>ï¼šä»å­—èŠ‚ç æ•°ç»„ä¸­è·å–å½“å‰ PC æŒ‡å‘çš„æŒ‡ä»¤ã€‚</p>
</li>
<li><p><strong>Decode</strong>ï¼šè§£ææŒ‡ä»¤çš„æ“ä½œç å’Œæ“ä½œæ•°ã€‚</p>
</li>
<li><p><strong>Execute</strong>ï¼šæ‰§è¡ŒæŒ‡ä»¤å¯¹åº”çš„æ“ä½œï¼Œä¾‹å¦‚è¿›è¡Œæ•°å­¦è¿ç®—ã€æ“ä½œå †æ ˆã€è°ƒç”¨å‡½æ•°ç­‰ã€‚</p>
</li>
<li><p><strong>ç¨‹åºç»“æŸ</strong>ï¼šå½“æ‰§è¡Œå®Œæ‰€æœ‰å­—èŠ‚ç åï¼Œè™šæ‹Ÿæœºå°†ç»“æœè¿”å›æˆ–å®Œæˆæ“ä½œã€‚</p>
</li>
</ul>
<h2>å¸¸è§ç‰¹å¾</h2>
<ul>
<li><p><strong>å·¨å¤§çš„ä»£ç ä½“ç§¯</strong>ï¼šä»£ç ä¸­é€šå¸¸åŒ…å«ä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼ˆå­—èŠ‚ç ï¼‰å’Œä¸€ä¸ªåºå¤§çš„ <code>switch</code> æˆ– <code>while</code> å¾ªç¯ï¼ˆè™šæ‹Ÿæœºè§£é‡Šå™¨ï¼‰ã€‚</p>
</li>
<li><p><strong>æ§åˆ¶æµå¹³å¦åŒ–</strong>ï¼šåŸå§‹çš„ <code>if/else</code>, <code>for</code>, <code>while</code> ç»“æ„è¢«è½¬æ¢æˆç”±ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰æ§åˆ¶çš„è·³è½¬æŒ‡ä»¤ï¼Œä½¿å¾—ä»£ç é€»è¾‘éš¾ä»¥è·Ÿè¸ªã€‚</p>
</li>
<li><p><strong>ä¸é€æ˜è°“è¯</strong>ï¼šå¼•å…¥ä¸€äº›æ’ä¸ºçœŸæˆ–æ’ä¸ºå‡çš„å¤æ‚æ¡ä»¶åˆ¤æ–­ï¼Œå¢åŠ é™æ€åˆ†æçš„éš¾åº¦ã€‚</p>
</li>
<li><p><strong>è‡ªå®šä¹‰æ•°æ®ç»“æ„</strong>ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„å †æ ˆæ¥å­˜å‚¨å˜é‡å’Œä¸­é—´ç»“æœï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ JavaScript çš„å˜é‡ã€‚</p>
</li>
</ul>
<h2>åˆ†æä¸è„±å£³ç­–ç•¥</h2>
<p>é€†å‘ JSVMP æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œé€šå¸¸éœ€è¦ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æã€‚</p>
<h3>1. é™æ€åˆ†æï¼šç†è§£è™šæ‹Ÿæœº</h3>
<ul>
<li><p><strong>å®šä½æ ¸å¿ƒç»„ä»¶</strong>ï¼š</p>
</li>
<li><p><strong>å­—èŠ‚ç æ•°ç»„</strong>ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªå·¨å¤§çš„ã€åŒ…å«æ•°å­—æˆ–çŸ­å­—ç¬¦ä¸²çš„æ•°ç»„ã€‚</p>
</li>
<li><p><strong>è™šæ‹Ÿæœºå…¥å£</strong>ï¼šå¯åŠ¨æ•´ä¸ªè§£é‡Šå™¨å¾ªç¯çš„å‡½æ•°ã€‚</p>
</li>
<li><p><strong>åˆ†å‘å™¨ï¼ˆDispatcherï¼‰</strong>ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªå¤§çš„ <code>switch</code> è¯­å¥æˆ– <code>while(true)</code> å¾ªç¯ï¼Œæ ¹æ®æŒ‡ä»¤ç è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤å¤„ç†å™¨ï¼ˆHandlersï¼‰</strong>ï¼š<code>switch</code> ä¸­çš„æ¯ä¸ª <code>case</code> æˆ–è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå®ç°äº†å…·ä½“æŒ‡ä»¤çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤é›†é‡å»º</strong>ï¼š</p>
</li>
<li><p>é€šè¿‡åˆ†ææ¯ä¸ª Handler çš„åŠŸèƒ½ï¼Œé€æ­¥è¿˜åŸå‡ºæ¯ä¸ªå­—èŠ‚ç å¯¹åº”çš„å…·ä½“æ“ä½œï¼ˆå¦‚ <code>ADD</code>, <code>SUB</code>, <code>JMP</code> ç­‰ï¼‰ã€‚</p>
</li>
<li><p>ä¸ºæ¯ä¸ªæ“ä½œç ï¼ˆOpcodeï¼‰æ·»åŠ æ³¨é‡Šï¼Œè®°å½•å…¶åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶ä½†è‡³å…³é‡è¦çš„æ­¥éª¤ã€‚</p>
</li>
</ul>
<h3>2. åŠ¨æ€åˆ†æï¼šè·Ÿè¸ªä¸è°ƒè¯•</h3>
<ul>
<li><p><strong>Hook å…³é”®å‡½æ•°</strong>ï¼šä½¿ç”¨ Frida æˆ–æµè§ˆå™¨å¼€å‘è€…å·¥å…·åœ¨å…³é”®ä½ç½®ï¼ˆå¦‚æŒ‡ä»¤å¤„ç†å™¨ï¼‰ä¸‹æ–­ç‚¹æˆ–æ’å…¥æ—¥å¿—ã€‚</p>
</li>
<li><p><strong>è·Ÿè¸ª PC å’Œæ“ä½œæ•°</strong>ï¼šè®°å½•æ¯æ¬¡å¾ªç¯çš„ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰å’Œå½“å‰æŒ‡ä»¤çš„æ“ä½œæ•°ï¼Œå¯ä»¥å¾—åˆ°å®Œæ•´çš„æ‰§è¡Œè½¨è¿¹ï¼ˆTraceï¼‰ã€‚</p>
</li>
<li><p><strong>ç›‘æ§å †æ ˆå˜åŒ–</strong>ï¼šè§‚å¯Ÿè™šæ‹Ÿæœºè‡ªå®šä¹‰å †æ ˆçš„å‹å…¥ï¼ˆpushï¼‰å’Œå¼¹å‡ºï¼ˆpopï¼‰æ“ä½œï¼Œä»¥ç†è§£æ•°æ®æµã€‚</p>
</li>
<li><p><strong>AST è¾…åŠ©åˆ†æ</strong>ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚ Babelï¼‰å°† Handler çš„ä»£ç è§£ææˆ ASTï¼Œå¯ä»¥æ›´å¿«åœ°ç†è§£å…¶åŠŸèƒ½ï¼Œç”šè‡³è‡ªåŠ¨åŒ–åœ°è¯†åˆ«æŒ‡ä»¤æ¨¡å¼ã€‚</p>
</li>
</ul>
<h3>3. ä»£ç è¿˜åŸä¸é‡æ„</h3>
<ul>
<li><p><strong>ç¼–å†™åç¼–è¯‘å™¨</strong>ï¼šåŸºäºå·²ç»é‡å»ºçš„æŒ‡ä»¤é›†ï¼Œç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œå°†å­—èŠ‚ç åºåˆ—ç¿»è¯‘å›æ›´é«˜çº§ã€æ›´æ˜“è¯»çš„ JavaScript ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§æ­¥éª¤ï¼Œéœ€è¦å¯¹è™šæ‹Ÿæœºæœ‰å®Œæ•´çš„ç†è§£ã€‚</p>
</li>
<li><p><strong>æ‰‹åŠ¨é€»è¾‘é‡æ„</strong>ï¼šå¯¹äºä¸æ˜¯ç‰¹åˆ«å¤æ‚çš„ VMPï¼Œå¯ä»¥é€šè¿‡è·Ÿè¸ªæ‰§è¡Œæµç¨‹ï¼Œæ‰‹åŠ¨å°†å…³é”®é€»è¾‘ï¼ˆå¦‚åŠ å¯†ç®—æ³•ï¼‰ç”¨ç­‰æ•ˆçš„ JavaScript ä»£ç é‡å†™å‡ºæ¥ã€‚</p>
</li>
</ul>
<h2>å¸¸ç”¨å·¥å…·</h2>
<ul>
<li><p><strong>æµè§ˆå™¨å¼€å‘è€…å·¥å…·</strong>ï¼šç”¨äºä¸‹æ–­ç‚¹ã€å•æ­¥è°ƒè¯•å’Œè§‚å¯Ÿå˜é‡ã€‚</p>
</li>
<li><p><strong>Frida</strong>ï¼šç”¨äº Hook å…³é”®å‡½æ•°ï¼Œå®ç°åŠ¨æ€è·Ÿè¸ªã€‚</p>
</li>
<li><p><strong>Babel</strong>ï¼šç”¨äºå°† JavaScript ä»£ç è§£ææˆ ASTï¼Œè¾…åŠ©é™æ€åˆ†æã€‚</p>
</li>
<li><p><strong>AST Explorer</strong>ï¼šä¸€ä¸ªåœ¨çº¿å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹ä»£ç å¯¹åº”çš„ AST ç»“æ„ã€‚</p>
</li>
<li><p><strong>IDA Pro / Ghidra</strong>ï¼šè™½ç„¶ä¸»è¦ç”¨äºåŸç”Ÿä»£ç ï¼Œä½†å®ƒä»¬å¼ºå¤§çš„åæ±‡ç¼–å’Œåç¼–è¯‘åŠŸèƒ½å¯ä»¥ä¸ºç†è§£å¤æ‚çš„ JavaScript è™šæ‹Ÿæœºé€»è¾‘æä¾›å€Ÿé‰´ã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-25">
                                                <h2>25. R23: Native String Obfuscation</h2>
                                                <h1>R23: Native å±‚å­—ç¬¦ä¸²æ··æ·†ä¸é€†å‘</h1>
<p>åœ¨ Android Native å¼€å‘ï¼ˆC/C++ï¼‰ä¸­ï¼Œç›´æ¥å°†æ˜æ–‡å­—ç¬¦ä¸²ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ IDA Proã€Ghidraï¼‰å¯ä»¥è½»æ˜“åœ°åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ <code>.rodata</code>ï¼ˆåªè¯»æ•°æ®ï¼‰æ®µä¸­æ‰¾åˆ°è¿™äº›å­—ç¬¦ä¸²ï¼Œä»è€Œæ³„éœ² API åœ°å€ã€åŠ å¯†å¯†é’¥ã€æ•æ„Ÿæ ¡éªŒé€»è¾‘ç­‰ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¼€å‘è€…é€šå¸¸ä¼šé‡‡ç”¨å„ç§å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯æ¥ä¿æŠ¤è¿™äº›æ•°æ®ã€‚</p>
<h2>å¸¸è§çš„ Native å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯</h2>
<h3>1. æ ˆä¸ŠåŠ¨æ€æ„é€  (Stack-based Construction)</h3>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹æ³•ã€‚å®ƒé¿å…åœ¨æ•°æ®æ®µä¸­ç•™ä¸‹å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åœ¨å‡½æ•°è¿è¡Œæ—¶ï¼Œé€ä¸ªå­—ç¬¦åœ°å°†å­—ç¬¦ä¸²æ„é€ åœ¨æ ˆä¸Šã€‚</p>
<p><strong>ç¤ºä¾‹ä»£ç :</strong></p>
<pre><code class="language-cpp">void get_secret_url() {
char url[19];
url[0] = 'h'; url[1] = 't'; url[2] = 't'; url[3] = 'p';
url[4] = 's'; url[5] = ':'; url[6] = '/'; url[7] = '/';
url[8] = 'a'; url[9] = 'p'; url[10] = 'i'; url[11] = '.';
url[12] = 'e'; url[13] = 'x'; url[14] = 'a'; url[15] = 'm';
url[16] = 'p'; url[17] = 'l'; url[18] = 'e';
url[19] = '\0'; // Null terminator
// ... use url
}

</code></pre>
<p><strong>ç¤ºä¾‹ä»£ç :</strong></p>
<pre><code class="language-cpp">char* decrypt_string(char* encrypted) {
char key = 0xAB;
int len = strlen(encrypted);
for (int i = 0; i &lt; len; i++) {
encrypted[i] = encrypted[i] ^ key;
}
return encrypted;
}

void use_secret() {
// &quot;secret_key&quot; Xored with 0xAB
char encrypted_key[] = { 0xCF, 0xC4, 0xC2, 0xCD, 0xC4, 0xD1, 0xDF, 0xCB, 0xC4, 0xD8, 0x00 };
char* secret = decrypt_string(encrypted_key);
// ... use secret
}

</code></pre>
<p><strong>ä¼˜ç‚¹</strong>: è‡ªåŠ¨åŒ–ã€å…¨å±€è¦†ç›–ã€å¯¹å¼€å‘è€…é€æ˜ã€‚
<strong>ç¼ºç‚¹</strong>: é€šå¸¸éœ€è¦å®šåˆ¶çš„ç¼–è¯‘å™¨æˆ–å·¥å…·é“¾ã€‚</p>
<h2>é€†å‘ç­–ç•¥</h2>
<p>é€†å‘å­—ç¬¦ä¸²æ··æ·†çš„ç›®æ ‡æ˜¯ <strong>æ‰¹é‡åœ°ã€è‡ªåŠ¨åŒ–åœ°</strong> å°†æ··æ·†çš„å­—ç¬¦ä¸²è¿˜åŸå‡ºæ¥ã€‚</p>
<h3>1. é™æ€åˆ†æ (IDA Pro / Ghidra)</h3>
<p>é™æ€åˆ†ææ˜¯è¯†åˆ«è§£å¯†ä¾‹ç¨‹ï¼ˆDecryption Routineï¼‰å’Œæ‰¹é‡è§£å¯†çš„å…³é”®ã€‚</p>
<ul>
<li><p><strong>è¯†åˆ«è§£å¯†æ¨¡å¼</strong>:</p>
</li>
<li><p>å¯»æ‰¾ç‰¹å¾æ€§çš„å¾ªç¯ç»“æ„ã€‚ä¸€ä¸ªå¾ªç¯éå†å†…å­˜ã€æ‰§è¡Œå›ºå®šæ“ä½œï¼ˆå¦‚ <code>XOR</code>ï¼‰ç„¶åå†™å›ï¼Œè¿™é€šå¸¸å°±æ˜¯è§£å¯†å‡½æ•°ã€‚</p>
</li>
<li><p>åœ¨ IDA Pro ä¸­ï¼Œè¿™ç§å¾ªç¯çš„å›¾å½¢è§†å›¾éå¸¸å…·æœ‰è¾¨è¯†åº¦ã€‚</p>
</li>
<li><p><strong>å®šä½è§£å¯†å‡½æ•°</strong>:</p>
</li>
<li><p>é€šè¿‡äº¤å‰å¼•ç”¨ï¼ˆXrefsï¼‰æ‰¾åˆ°åŠ å¯†æ•°æ®è¢«å“ªäº›å‡½æ•°ä½¿ç”¨ã€‚è¿™äº›å‡½æ•°å¾ˆå¯èƒ½å°±æ˜¯è§£å¯†å‡½æ•°ã€‚</p>
</li>
<li><p>ä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªè§£å¯†å‡½æ•°ï¼Œåˆ†æå…¶é€»è¾‘ï¼ˆè¾“å…¥ã€è¾“å‡ºã€åŠ å¯†ç®—æ³•ï¼‰ã€‚</p>
</li>
<li><p><strong>è‡ªåŠ¨åŒ–è§£å¯† (IDAPython / Ghidra Script)</strong>:</p>
</li>
</ul>
<ol>
<li><strong>ç¼–å†™è„šæœ¬</strong>: è¿™æ˜¯æœ€é«˜æ•ˆçš„æ–¹æ³•ã€‚ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥æ¨¡æ‹Ÿè§£å¯†é€»è¾‘ã€‚</li>
<li><strong>å¯»æ‰¾å¼•ç”¨</strong>: è„šæœ¬é¦–å…ˆæ‰¾åˆ°æ‰€æœ‰å¯¹è§£å¯†å‡½æ•°çš„äº¤å‰å¼•ç”¨ã€‚</li>
<li><strong>æå–å‚æ•°</strong>: åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹ï¼Œè„šæœ¬å‘ä¸Šå›æº¯ï¼Œè§£æä¼ é€’ç»™è§£å¯†å‡½æ•°çš„å‚æ•°ï¼ˆåŠ å¯†çš„æ•°æ®ã€å¯†é’¥ç­‰ï¼‰ã€‚</li>
<li><strong>æ‰§è¡Œè§£å¯†</strong>: è„šæœ¬åœ¨å†…éƒ¨æ‰§è¡Œè§£å¯†ç®—æ³•ã€‚</li>
<li><strong>æ·»åŠ æ³¨é‡Š</strong>: æœ€åï¼Œå°†è§£å¯†åçš„å­—ç¬¦ä¸²ä½œä¸ºæ³¨é‡Šæ·»åŠ åˆ° IDA Pro æˆ– Ghidra çš„åæ±‡ç¼–ä»£ç ä¸­ã€‚</li>
</ol>
<h3>2. åŠ¨æ€åˆ†æ (Frida)</h3>
<p>å½“é™æ€åˆ†æè¿‡äºå¤æ‚æˆ–å­˜åœ¨åè°ƒè¯•æ—¶ï¼ŒåŠ¨æ€åˆ†ææ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<ul>
<li><strong>Hook è§£å¯†å‡½æ•°</strong>:</li>
</ul>
<ol>
<li>é€šè¿‡åˆæ­¥çš„é™æ€åˆ†æå®šä½åˆ°ç–‘ä¼¼çš„è§£å¯†å‡½æ•°ã€‚</li>
<li>ä½¿ç”¨ Frida <code>Interceptor.attach</code> æ¥ Hook è¿™ä¸ªå‡½æ•°çš„å…¥å£å’Œå‡ºå£ã€‚</li>
<li>åœ¨ <code>onEnter</code> ä¸­ï¼Œæ‰“å°å‡½æ•°çš„å‚æ•°ï¼ˆé€šå¸¸æ˜¯æŒ‡å‘åŠ å¯†æ•°æ®çš„æŒ‡é’ˆï¼‰ã€‚</li>
<li>åœ¨ <code>onLeave</code> ä¸­ï¼Œæ‰“å°å‡½æ•°çš„è¿”å›å€¼ï¼ˆé€šå¸¸æ˜¯æŒ‡å‘å·²è§£å¯†çš„æ˜æ–‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼‰ã€‚</li>
<li>é€šè¿‡è¿è¡Œ App å¹¶è§¦å‘ä¸åŒåŠŸèƒ½ï¼Œå°±å¯ä»¥ä»æ—¥å¿—ä¸­æ”¶é›†åˆ°å¤§é‡çš„æ˜æ–‡å­—ç¬¦ä¸²ã€‚</li>
</ol>
<ul>
<li><p><strong>å†…å­˜æ‰«æ</strong>:</p>
</li>
<li><p>å¦ä¸€ç§ç­–ç•¥æ˜¯è®©åº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åä½¿ç”¨ Frida è„šæœ¬æˆ– GameGuardian ç­‰å·¥å…·æ‰«ææ•´ä¸ªè¿›ç¨‹å†…å­˜ï¼Œå¯»æ‰¾ç¬¦åˆå­—ç¬¦ä¸²ç‰¹å¾ï¼ˆå¦‚ ASCIIã€UTF-8ï¼‰çš„å†…å­˜åŒºåŸŸã€‚</p>
</li>
<li><p><strong>ä¼˜ç‚¹</strong>: æ— éœ€å…³å¿ƒè§£å¯†é€»è¾‘ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: ä¿¡æ¯éå¸¸å˜ˆæ‚ï¼ŒåŒ…å«å¤§é‡æ— ç”¨æ•°æ®ï¼›æ— æ³•å°†è¢«åŠ å¯†å­˜å‚¨ä½†åœ¨è¿è¡Œæ—¶æœªè¢«ä½¿ç”¨çš„å­—ç¬¦ä¸²è§£å¯†å‡ºæ¥ã€‚</p>
</li>
</ul>
<h3>3. æ¨¡æ‹Ÿæ‰§è¡Œ (Emulation)</h3>
<p>å¯¹äºä¸€äº›ç‹¬ç«‹çš„ã€æ²¡æœ‰å¤ªå¤šå¤–éƒ¨ä¾èµ–çš„è§£å¯†å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ï¼ˆå¦‚ <code>Unicorn Engine</code>ï¼‰æ¥è§£å¯†ã€‚</p>
<ol>
<li><strong>æå–ä»£ç å’Œæ•°æ®</strong>: ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ dump å‡ºè§£å¯†å‡½æ•°çš„æœºå™¨ç å’Œéœ€è¦è§£å¯†çš„å­—èŠ‚æ•°ç»„ã€‚</li>
<li><strong>è®¾ç½®ç¯å¢ƒ</strong>: åœ¨ Unicorn ä¸­ï¼Œæ˜ å°„æ‰€éœ€çš„å†…å­˜åŒºåŸŸï¼Œå°†åŠ å¯†æ•°æ®æ”¾å…¥ã€‚</li>
<li><strong>æ¨¡æ‹Ÿæ‰§è¡Œ</strong>: è®¾ç½®å¥½åˆå§‹å¯„å­˜å™¨çŠ¶æ€ï¼ˆå¦‚å‚æ•°æŒ‡é’ˆï¼‰ï¼Œç„¶åå¼€å§‹æ¨¡æ‹Ÿæ‰§è¡Œè§£å¯†å‡½æ•°çš„æœºå™¨ç ã€‚</li>
<li><strong>è·å–ç»“æœ</strong>: æ‰§è¡Œå®Œæ¯•åï¼Œä»å†…å­˜ä¸­è¯»å›è§£å¯†åçš„å­—ç¬¦ä¸²ã€‚</li>
</ol>
<p><strong>ä¼˜ç‚¹</strong>: é€Ÿåº¦æ¯”åŠ¨æ€åˆ†æå¿«ï¼Œæ— éœ€è¿è¡Œå®Œæ•´çš„ Appï¼Œå¯ç»•è¿‡åè°ƒè¯•ã€‚
<strong>ç¼ºç‚¹</strong>: ç¯å¢ƒè®¾ç½®å¤æ‚ï¼Œä¸é€‚ç”¨äºæœ‰å¤§é‡ç³»ç»Ÿè°ƒç”¨æˆ–å¤æ‚ä¾èµ–çš„å‡½æ•°ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-26">
                                                <h2>26. R24: Automation & Device Farming</h2>
                                                <h1>R24: å·¥ç¨‹åŒ–ï¼šè‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿ</h1>
<h2>åœ¨è™šæ‹ŸåŒ–å’Œå®¹å™¨åŒ–è§£å†³äº†&quot;ç¯å¢ƒ&quot;é—®é¢˜ä¹‹åï¼Œè‡ªåŠ¨åŒ–å’Œç¾¤æ§ç³»ç»Ÿåˆ™è´Ÿè´£è§£å†³&quot;æ‰§è¡Œ&quot;å’Œ&quot;ç®¡ç†&quot;çš„é—®é¢˜ã€‚å®ƒä»¬æ˜¯é©±åŠ¨æ•´ä¸ªè§„æ¨¡åŒ–æµ‹è¯•å’Œåˆ†ææµæ°´çº¿è¿è½¬çš„æ ¸å¿ƒå¼•æ“ã€‚</h2>
<h2>1. è‡ªåŠ¨åŒ–æ¡†æ¶</h2>
<p>è‡ªåŠ¨åŒ–æ¡†æ¶æ˜¯æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºã€ä¸ App UI è¿›è¡Œäº¤äº’çš„å·¥å…·é›†ã€‚å®ƒçš„æ ¸å¿ƒä»»åŠ¡æ˜¯ä»£æ›¿äººå·¥ï¼Œå®ç°å¯¹ App çš„ç¨‹åºåŒ–æ§åˆ¶ã€‚</p>
<h3>a) ä¸»æµæ¡†æ¶å¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>æ¡†æ¶</th>
  <th>é©±åŠ¨åŸç†</th>
  <th>ä¼˜ç‚¹</th>
  <th>ç¼ºç‚¹</th>
  <th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Appium</strong></td>
  <td>WebDriver åè®® -&gt; UIAutomator2/XCUITest</td>
  <td>è·¨å¹³å°ï¼ˆAndroid/iOSï¼‰ï¼Œå¤šè¯­è¨€æ”¯æŒï¼Œç”Ÿæ€æˆç†Ÿï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</td>
  <td>ç¯å¢ƒé…ç½®å¤æ‚ï¼Œæ‰§è¡Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå¯¹ App æœ‰ä¸€å®šçš„ä¾µå…¥æ€§ï¼ˆéœ€è¦å®‰è£… WebDriver Agentï¼‰ã€‚</td>
  <td>æ ‡å‡†åŒ–çš„ã€è·¨å¹³å°çš„ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰åŠŸèƒ½æµ‹è¯•ã€‚</td>
</tr>
<tr>
  <td><strong>UIAutomator2 (Python)</strong></td>
  <td>Google UIAutomator2</td>
  <td>ç›´æ¥ä¸è®¾å¤‡é€šä¿¡ï¼Œé€Ÿåº¦å¿«ï¼Œç¨³å®šï¼ŒAPI ç®€æ´æ˜“ç”¨ã€‚</td>
  <td>ä»…æ”¯æŒ Androidï¼ŒåŠŸèƒ½ç›¸å¯¹ Appium è¾ƒå°‘ã€‚</td>
  <td>çº¯ Android å¹³å°çš„å¿«é€Ÿè‡ªåŠ¨åŒ–ã€çˆ¬è™«å’Œæ—¥å¸¸è„šæœ¬ã€‚</td>
</tr>
<tr>
  <td><strong>Airtest / Poco</strong></td>
  <td>å›¾åƒè¯†åˆ« + UI æ§ä»¶</td>
  <td>èƒ½å¤Ÿè§£å†³æ— æ³•è·å– UI æ§ä»¶æ ‘çš„é—®é¢˜ï¼ˆå¦‚æ¸¸æˆï¼‰ï¼Œè·¨å¼•æ“ï¼ˆUnity, Cocosï¼‰ã€‚</td>
  <td>å›¾åƒè¯†åˆ«ä¸ç¨³å®šï¼Œå—åˆ†è¾¨ç‡å’Œ UI å˜åŒ–å½±å“å¤§ï¼Œé€Ÿåº¦æ…¢ã€‚</td>
  <td>æ¸¸æˆè‡ªåŠ¨åŒ–ï¼Œé»‘ç›’æµ‹è¯•ã€‚</td>
</tr>
</tbody>
</table>
<h3>c) Poco è‡ªåŠ¨åŒ–æŠ€æœ¯æ·±åº¦è§£æ</h3>
<p>Poco æ˜¯ç½‘æ˜“æ¨å‡ºçš„ UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œä¸“ä¸ºæ¸¸æˆå’Œå¤æ‚åº”ç”¨è®¾è®¡ï¼Œæ˜¯ Airtest é¡¹ç›®çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚</p>
<h4>æ ¸å¿ƒæ¶æ„ä¸åŸç†</h4>
<pre><code>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚Poco SDK â”‚ â”‚ â”‚ â”‚
â”‚ â”‚æ’ä»¶ â”‚ â”‚ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â†“ â”‚ â”‚ â”‚
â”‚ UIæ§ä»¶æ ‘ â”‚ â”‚ â”‚
â”‚ èŠ‚ç‚¹ä¿¡æ¯ â”‚ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
<ol start="4">
<li><strong>æŒ‡ä»¤æ‰§è¡Œ</strong>: æ¥æ”¶æ§åˆ¶ç«¯æŒ‡ä»¤ï¼Œæ“ä½œå¯¹åº” UI æ§ä»¶</li>
<li><strong>ç»“æœå›ä¼ </strong>: å°†æ“ä½œç»“æœå’ŒçŠ¶æ€ä¿¡æ¯è¿”å›æ§åˆ¶ç«¯</li>
</ol>
<h4>SDK é›†æˆæ–¹å¼</h4>
<p><strong>Unity å¼•æ“é›†æˆ</strong>:</p>
<pre><code class="language-csharp">// Unity é¡¹ç›®ä¸­é›†æˆ Poco SDK
using Poco;

public class PocoManager : MonoBehaviour {
void Start() {
// å¯åŠ¨ Poco æœåŠ¡
var poco = new PocoServiceBuilder()
.SetPort(5001)
.SetDebugMode(true)
.Build();

poco.Start();
}
}

</code></pre>
<p>bool AppDelegate::applicationDidFinishLaunching() {
// åˆå§‹åŒ– Poco æœåŠ¡
poco::PocoManager::getInstance()-&gt;start();</p>
<p>return true;
}</p>
<pre><code>
public class MainActivity extends AppCompatActivity {
@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);

// å¯åŠ¨ Poco æœåŠ¡
Poco.start(&quot;poco&quot;, 5001);
}
}

</code></pre>
<p>from poco.drivers.android.uiautomation import AndroidUiautomationPoco</p>
<h1>Unity æ¸¸æˆè¿æ¥</h1>
<p>poco = UnityPoco(('192.168.1.100', 5001))</p>
<h1>Android åŸç”Ÿåº”ç”¨è¿æ¥</h1>
<p>poco = AndroidUiautomationPoco(use_airtest_input=True, screenshot_each_action=False)</p>
<h1>åŸºæœ¬æ“ä½œ</h1>
<p>poco('Button').click() # ç‚¹å‡»æŒ‰é’®
poco('InputField').set_text('test') # è¾“å…¥æ–‡æœ¬
poco('ScrollView').swipe('up') # æ»‘åŠ¨æ“ä½œ</p>
<h1>ç­‰å¾…å…ƒç´ å‡ºç°</h1>
<p>poco('LoadingPanel').wait_for_disappearance() # ç­‰å¾…åŠ è½½å®Œæˆ</p>
<pre><code>
# å±æ€§é€‰æ‹©
poco(text='ç¡®å®š').click()
poco(name='startBtn', enabled=True).click()
poco(type='Button', visible=True).click()

# ç›¸å¯¹ä½ç½®é€‰æ‹©
poco('username').sibling('password') # å…„å¼ŸèŠ‚ç‚¹
poco('title').parent() # çˆ¶èŠ‚ç‚¹

# æ¡ä»¶è¿‡æ»¤
buttons = poco('Button').filter(lambda x: x.get_text().startswith('ç¡®å®š'))

</code></pre>
<h1>æ‹–æ‹½æ“ä½œ</h1>
<p>poco.drag_to([0.2, 0.2], [0.8, 0.8])</p>
<h1>å¤šç‚¹è§¦æ§</h1>
<p>poco.pinch(in_or_out='in', center=[0.5, 0.5], percent=0.6)</p>
<h1>ç­‰å¾…æ¸¸æˆçŠ¶æ€</h1>
<p>def wait_for_battle_end():
return poco('BattleResult').exists()</p>
<p>poco.wait_for_all(wait_for_battle_end, timeout=60)</p>
<pre><code>class PocoEngine:
def __init__(self, addr):
self.client = PocoClient(addr)

def screenshot(self):
&quot;&quot;&quot;è·å–æ¸¸æˆæˆªå›¾&quot;&quot;&quot;
return self.client.call(&quot;Screenshot&quot;)

def get_screen_size(self):
&quot;&quot;&quot;è·å–å±å¹•å°ºå¯¸&quot;&quot;&quot;
return self.client.call(&quot;GetScreenSize&quot;)

def click(self, pos):
&quot;&quot;&quot;ç‚¹å‡»æ“ä½œ&quot;&quot;&quot;
return self.client.call(&quot;Click&quot;, pos)

def dump_hierarchy(self):
&quot;&quot;&quot;è·å– UI æ§ä»¶æ ‘&quot;&quot;&quot;
return self.client.call(&quot;Dump&quot;)

</code></pre>
<p>if engine_type == 'unity':
return UnityPoco(device_info['addr'])
elif engine_type == 'cocos':
return CocosJSPoco(device_info['addr'])
elif engine_type == 'unreal':
return UE4Poco(device_info['addr'])
elif engine_type == 'android':
return AndroidUiautomationPoco()
else:
raise ValueError(f&quot;Unsupported engine: {engine_type}&quot;)</p>
<pre><code>def __init__(self, max_connections=10):
self.pool = queue.Queue(max_connections)
self.max_connections = max_connections

def get_connection(self, addr):
try:
return self.pool.get_nowait()
except queue.Empty:
return UnityPoco(addr)

def return_connection(self, conn):
try:
self.pool.put_nowait(conn)
except queue.Full:
pass # ä¸¢å¼ƒå¤šä½™è¿æ¥

</code></pre>
<p>&quot;&quot;&quot;æ‰¹é‡è·å–å¤šä¸ªå…ƒç´ ï¼Œå‡å°‘ RPC è°ƒç”¨&quot;&quot;&quot;
elements = {}
for name, selector in selectors.items():
try:
elements[name] = poco(selector)
except:
elements[name] = None
return elements</p>
<h1>UseExample</h1>
<p>ui_elements = batch_get_elements(poco, {
'start_btn': 'StartButton',
'settings_btn': 'SettingsButton',
'exit_btn': 'ExitButton'
})</p>
<pre><code>
def retry_on_failure(max_retries=3, delay=1):
def decorator(func):
@wraps(func)
def wrapper(*args, **kwargs):
for attempt in range(max_retries):
try:
return func(*args, **kwargs)
except Exception as e:
if attempt == max_retries - 1:
raise e
print(f&quot;Attempt {attempt + 1} failed: {e}&quot;)
time.sleep(delay)
return None
return wrapper
return decorator

@retry_on_failure(max_retries=3, delay=2)
def stable_click(poco, selector):
&quot;&quot;&quot;ç¨³å®šçš„ç‚¹å‡»æ“ä½œï¼Œå¸¦é‡è¯•æœºåˆ¶&quot;&quot;&quot;
element = poco(selector)
if element.exists():
element.click()
return True
else:
raise Exception(f&quot;Element {selector} not found&quot;)

</code></pre>
<h1>è®¾ç½® Poco æ—¥å¿—</h1>
<p>setup_logger(level=logging.DEBUG)</p>
<h1>è‡ªå®šä¹‰æ“ä½œæ—¥å¿—</h1>
<p>class PocoLogger:
@staticmethod
def log_action(action, element, result=None):
timestamp = time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)
print(f&quot;[{timestamp}] {action} on {element}, result: {result}&quot;)</p>
<p>@staticmethod
def log_screenshot(path):
print(f&quot;Screenshot saved: {path}&quot;)</p>
<h1>ä½¿ç”¨ç¤ºä¾‹</h1>
<p>def logged_click(poco, selector):
try:
poco(selector).click()
PocoLogger.log_action(&quot;CLICK&quot;, selector, &quot;SUCCESS&quot;)
except Exception as e:
PocoLogger.log_action(&quot;CLICK&quot;, selector, f&quot;FAILED: {e}&quot;)</p>
<h1>ä¿å­˜é”™è¯¯æ—¶çš„æˆªå›¾</h1>
<p>screenshot<em>path = f&quot;error</em>{int(time.time())}.png&quot;
poco.snapshot(screenshot_path)
PocoLogger.log_screenshot(screenshot_path)
raise</p>
<pre><code>def __init__(self, device_id, poco_port=5001):
self.device_id = device_id
self.poco_port = poco_port
self.poco = None

def connect(self):
&quot;&quot;&quot;è¿æ¥åˆ°è®¾å¤‡ä¸Šçš„ Poco æœåŠ¡&quot;&quot;&quot;
device_ip = self.get_device_ip(self.device_id)
self.poco = UnityPoco((device_ip, self.poco_port))
return self.poco is not None

def execute_task(self, task_config):
&quot;&quot;&quot;æ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡&quot;&quot;&quot;
try:
# è§£æä»»åŠ¡é…ç½®
actions = task_config['actions']

for action in actions:
self.execute_action(action)

return {&quot;status&quot;: &quot;success&quot;, &quot;device_id&quot;: self.device_id}

except Exception as e:
return {&quot;status&quot;: &quot;failed&quot;, &quot;error&quot;: str(e), &quot;device_id&quot;: self.device_id}

def execute_action(self, action):
&quot;&quot;&quot;æ‰§è¡Œå•ä¸ªæ“ä½œ&quot;&quot;&quot;
action_type = action['type']

if action_type == 'click':
self.poco(action['selector']).click()
elif action_type == 'input':
self.poco(action['selector']).set_text(action['text'])
elif action_type == 'wait':
time.sleep(action['duration'])
# ... å…¶ä»–æ“ä½œç±»å‹

</code></pre>
<ol start="4">
<li><strong>å¼‚æ­¥æ“ä½œ</strong>: å¯¹äºè€—æ—¶æ“ä½œä½¿ç”¨å¼‚æ­¥æ¨¡å¼æé«˜æ•ˆç‡</li>
<li><strong>é”™è¯¯å¤„ç†</strong>: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ¢å¤æœºåˆ¶</li>
<li><strong>æ€§èƒ½ç›‘æ§</strong>: ç›‘æ§ RPC è°ƒç”¨å»¶è¿Ÿå’ŒæˆåŠŸç‡</li>
</ol>
<h4>ä¸å…¶ä»–è‡ªåŠ¨åŒ–æ¡†æ¶å¯¹æ¯”</h4>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">Poco</th>
  <th style="text-align:left">Appium</th>
  <th style="text-align:left">UIAutomator2</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>æ¸¸æˆæ”¯æŒ</strong></td>
  <td style="text-align:left">âœ… ä¼˜ç§€</td>
  <td style="text-align:left">âŒ ä¸æ”¯æŒ</td>
  <td style="text-align:left">âŒ ä¸æ”¯æŒ</td>
</tr>
<tr>
  <td style="text-align:left"><strong>è·¨å¼•æ“</strong></td>
  <td style="text-align:left">âœ… Unity/Cocos/UE4</td>
  <td style="text-align:left">âŒ ä»…åŸç”Ÿ</td>
  <td style="text-align:left">âŒ ä»… Android åŸç”Ÿ</td>
</tr>
<tr>
  <td style="text-align:left"><strong>é›†æˆå¤æ‚åº¦</strong></td>
  <td style="text-align:left">ä¸­ç­‰(éœ€ SDK)</td>
  <td style="text-align:left">ä½(æ— éœ€ä¿®æ”¹)</td>
  <td style="text-align:left">ä½(æ— éœ€ä¿®æ”¹)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ‰§è¡Œé€Ÿåº¦</strong></td>
  <td style="text-align:left">å¿«</td>
  <td style="text-align:left">ä¸­ç­‰</td>
  <td style="text-align:left">å¿«</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ç¨³å®šæ€§</strong></td>
  <td style="text-align:left">é«˜</td>
  <td style="text-align:left">ä¸­ç­‰</td>
  <td style="text-align:left">é«˜</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å­¦ä¹ æˆæœ¬</strong></td>
  <td style="text-align:left">ä¸­ç­‰</td>
  <td style="text-align:left">é«˜</td>
  <td style="text-align:left">ä½</td>
</tr>
</tbody>
</table>
<p>Poco ç‰¹åˆ«é€‚åˆæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ã€æ¸¸æˆ AI è®­ç»ƒã€æ¸¸æˆå†…å®¹éªŒè¯ç­‰åœºæ™¯ï¼Œæ˜¯ç§»åŠ¨æ¸¸æˆè‡ªåŠ¨åŒ–çš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<h3>b) è„šæœ¬ç¼–å†™çš„æœ€ä½³å®è·µ</h3>
<p><strong>åˆ†ç¦» UI å…ƒç´ ä¸ä¸šåŠ¡é€»è¾‘ (Page Object Model)</strong>: ä¸è¦å°† UI å…ƒç´ çš„å®šä½ç¬¦ï¼ˆå¦‚ <code>resource-id</code>ï¼‰ç¡¬ç¼–ç åœ¨ä¸šåŠ¡ä»£ç ä¸­ã€‚åº”è¯¥ä¸ºæ¯ä¸ªé¡µé¢åˆ›å»ºä¸€ä¸ªç±»ï¼ˆPage Objectï¼‰ï¼Œå°è£…è¯¥é¡µé¢çš„æ‰€æœ‰å…ƒç´ å’Œæ“ä½œã€‚å½“ UI å˜åŒ–æ—¶ï¼Œä½ åªéœ€è¦ä¿®æ”¹å¯¹åº”çš„ Page Objectï¼Œè€Œæ— éœ€æ”¹åŠ¨ä¸šåŠ¡æµç¨‹ä»£ç ã€‚</p>
<p><strong>æ˜ç¡®çš„æ–­è¨€</strong>: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½åº”è¯¥æœ‰æ˜ç¡®çš„æˆåŠŸæˆ–å¤±è´¥çš„åˆ¤æ–­æ ‡å‡†ï¼ˆæ–­è¨€ï¼‰ã€‚ä¾‹å¦‚ï¼Œç‚¹å‡»ç™»å½•åï¼Œæ–­è¨€&quot;ç”¨æˆ·å&quot;å…ƒç´ æ˜¯å¦å‡ºç°åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ã€‚</p>
<p><strong>å¼‚å¸¸å¤„ç†ä¸é‡è¯•</strong>: ç½‘ç»œå»¶è¿Ÿã€ç³»ç»Ÿå¼¹çª—ç­‰éƒ½å¯èƒ½å¯¼è‡´è‡ªåŠ¨åŒ–å¤±è´¥ã€‚åœ¨å…³é”®æ­¥éª¤åŠ å…¥åˆç†çš„ç­‰å¾…ã€å¼‚å¸¸æ•è·å’Œé‡è¯•æœºåˆ¶ï¼Œå¯ä»¥å¤§å¤§æé«˜è„šæœ¬çš„ç¨³å®šæ€§ã€‚</p>
<p><strong>æ—¥å¿—ä¸æŠ¥å‘Š</strong>: åœ¨è„šæœ¬çš„å…³é”®èŠ‚ç‚¹è¾“å‡ºæœ‰æ„ä¹‰çš„æ—¥å¿—ã€‚æµ‹è¯•ç»“æŸåï¼Œç”Ÿæˆå›¾æ–‡å¹¶èŒ‚çš„æµ‹è¯•æŠ¥å‘Šï¼ˆå¦‚ Allure Reportï¼‰ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<hr />
<h2>2. ç¾¤æ§ç³»ç»Ÿ (Device Farming)</h2>
<p>ç¾¤æ§ç³»ç»Ÿæ˜¯ä¸€ä¸ªå°†å¤§é‡ç‰©ç†è®¾å¤‡æˆ–è™šæ‹Ÿè®¾å¤‡ï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰æ±‡é›†æˆä¸€ä¸ªç»Ÿä¸€çš„ã€å¯ç¼–ç¨‹çš„èµ„æºæ± ï¼Œå¹¶å¯¹å…¶è¿›è¡Œé›†ä¸­åŒ–ç®¡ç†ã€è°ƒåº¦å’Œç›‘æ§çš„å¹³å°ã€‚</p>
<h3>a) æ ¸å¿ƒæ¶æ„</h3>
<p>ä¸€ä¸ªå·¥ä¸šçº§çš„ç¾¤æ§ç³»ç»Ÿé€šå¸¸æ˜¯å¾®æœåŠ¡æ¶æ„ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ol>
<li><strong>API ç½‘å…³ (API Gateway)</strong>:</li>
</ol>
<ul>
<li>ä½œä¸ºæ‰€æœ‰æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±ã€èº«ä»½è®¤è¯å’Œé€Ÿç‡é™åˆ¶ã€‚</li>
</ul>
<ol start="2">
<li><strong>è®¾å¤‡ç®¡ç†æœåŠ¡ (Device Management Service)</strong>:</li>
</ol>
<ul>
<li><p>ç»´æŠ¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰è®¾å¤‡ï¼ˆçœŸæœº/æ¨¡æ‹Ÿå™¨ï¼‰ä¿¡æ¯çš„æ•°æ®åº“ã€‚</p>
</li>
<li><p>é€šè¿‡å¿ƒè·³æœºåˆ¶å®æ—¶ç›‘æ§æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€ï¼ˆç©ºé—²ã€å ç”¨ã€ç¦»çº¿ã€å¥åº·çŠ¶å†µï¼‰ã€‚</p>
</li>
<li><p>å¤„ç†è®¾å¤‡çš„æ¥å…¥å’Œæ³¨é”€ã€‚</p>
</li>
</ul>
<ol start="3">
<li><strong>ä»»åŠ¡è°ƒåº¦æœåŠ¡ (Task Scheduling Service)</strong>:</li>
</ol>
<ul>
<li><p>æ¥æ”¶ç”¨æˆ·æäº¤çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œ&quot;åœ¨ Android 12 ä¸Šå¯¹ App X æ‰§è¡Œ Y æµ‹è¯•&quot;ï¼‰ã€‚</p>
</li>
<li><p>æ ¹æ®ä»»åŠ¡è¦æ±‚ï¼ˆè®¾å¤‡ç±»å‹ã€ç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰å’Œé¢„è®¾çš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚ä¼˜å…ˆçº§ã€FIFOï¼‰ä»è®¾å¤‡ç®¡ç†æœåŠ¡ä¸­æŸ¥è¯¢å¹¶é”å®šä¸€ä¸ªåˆé€‚çš„è®¾å¤‡ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>æ‰§è¡Œä»£ç† (Agent)</strong>:</li>
</ol>
<ul>
<li><p>åœ¨æ¯ä¸ªç‰©ç†è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œçš„ä¸€ä¸ªè½»é‡çº§ä»£ç†ç¨‹åºã€‚</p>
</li>
<li><p>è´Ÿè´£æ¥æ”¶å¹¶æ‰§è¡Œæ¥è‡ªè°ƒåº¦ä¸­å¿ƒçš„å…·ä½“æŒ‡ä»¤ï¼Œå¦‚ï¼šå®‰è£…/å¸è½½ APKã€å¯åŠ¨/åœæ­¢ Appiumã€æ‰§è¡Œ shell å‘½ä»¤ã€ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶ç­‰ã€‚</p>
</li>
</ul>
<ol start="5">
<li><strong>ç»“æœæ”¶é›†ä¸æŠ¥å‘ŠæœåŠ¡</strong>:</li>
</ol>
<ul>
<li><p>æ¥æ”¶æ¥è‡ª Agent çš„å®æ—¶æ—¥å¿—ã€æˆªå›¾ã€å½•å±å’Œæµ‹è¯•ç»“æœã€‚</p>
</li>
<li><p>å°†ç»“æœå­˜å…¥æ•°æ®åº“ï¼Œå¹¶åœ¨ä»»åŠ¡ç»“æŸåç”Ÿæˆæœ€ç»ˆçš„æµ‹è¯•æŠ¥å‘Šã€‚</p>
</li>
</ul>
<ol start="6">
<li><strong>Web ç®¡ç†å‰ç«¯</strong>:</li>
</ol>
<ul>
<li>æä¾›ä¸€ä¸ªå¯è§†åŒ–çš„ç•Œé¢ï¼Œè®©ç”¨æˆ·å¯ä»¥å®æ—¶æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨ã€è¿œç¨‹æ§åˆ¶è®¾å¤‡ï¼ˆå¦‚ STFï¼‰ã€æäº¤ä»»åŠ¡ã€æŸ¥çœ‹ä»»åŠ¡é˜Ÿåˆ—å’Œå†å²æŠ¥å‘Šã€‚</li>
</ul>
<h3>b) å¼€æºæ–¹æ¡ˆä¸è‡ªç ”</h3>
<p><strong>STF (Smartphone Test Farm)</strong>: æä¾›äº†ä¼˜ç§€çš„è®¾å¤‡ç®¡ç†å’Œè¿œç¨‹æ§åˆ¶åŠŸèƒ½ï¼Œæ˜¯è®¸å¤šè‡ªç ”ç¾¤æ§ç³»ç»Ÿçš„åŸºç¡€ã€‚ä½†å®ƒæœ¬èº«ä¸åŒ…å«ä»»åŠ¡è°ƒåº¦å’ŒæŠ¥å‘Šç­‰åŠŸèƒ½ã€‚</p>
<p><strong>è‡ªç ”</strong>: è®¸å¤šå¤§å‹å…¬å¸ä¼šåŸºäº STFã€Appiumã€Dockerã€Kubernetes ç­‰å¼€æºæŠ€æœ¯æ ˆï¼Œç»“åˆè‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ­å»ºè‡ªç ”çš„ç¾¤æ§å¹³å°ï¼Œä»¥å®ç°æ›´çµæ´»çš„è°ƒåº¦é€»è¾‘å’Œæ›´æ·±å…¥çš„ä¸šåŠ¡é›†æˆã€‚</p>
<hr />
<h2>æ€»ç»“</h2>
<p>è‡ªåŠ¨åŒ–ä¸ç¾¤æ§ç³»ç»Ÿæ˜¯ç§»åŠ¨ç«¯å·¥ç¨‹åŒ–èƒ½åŠ›çš„é›†ä¸­ä½“ç°ã€‚å®ƒå°†åº•å±‚çš„è®¾å¤‡èµ„æºã€ä¸­å±‚çš„æ‰§è¡Œè„šæœ¬å’Œä¸Šå±‚çš„ä¸šåŠ¡éœ€æ±‚æœ‰æœºåœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªå¼ºå¤§çš„ã€å¯æ‰©å±•çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ç°ä»£ App å¼€å‘ã€æµ‹è¯•å’Œå®‰å…¨åˆ†æä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-27">
                                                <h2>27. R25: Dial Up Proxy Pools</h2>
                                                <h1>R25: é€†å‘æŠ€æœ¯ï¼šåŠ¨æ€ä½å®… IP ä»£ç†æ± </h1>
<p>åœ¨é«˜å¼ºåº¦çš„çˆ¬è™«å’Œé€†å‘åˆ†æåœºæ™¯ä¸­ï¼Œè¯·æ±‚çš„ IP åœ°å€æ˜¯è¯†åˆ«å’Œå°ç¦çˆ¬è™«æµé‡çš„ç¬¬ä¸€é“å…³å¡ã€‚ç›¸æ¯”äºæ˜“äºè¢«è¯†åˆ«å’Œå±è”½çš„æ•°æ®ä¸­å¿ƒ IPï¼ŒåŠ¨æ€å˜åŒ–çš„ä½å®… IP åœ°å€å…·æœ‰æé«˜çš„ä¼ªè£…åº¦ï¼Œæ˜¯ç»•è¿‡åçˆ¬è™«ç­–ç•¥çš„å…³é”®æŠ€æœ¯ã€‚æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»åŠ¨æ€ä½å®… IPï¼ˆæ‹¨å·ä»£ç†ï¼‰çš„åŸç†åŠå…¶ä»£ç†æ± çš„æ­å»ºæ–¹æ³•ã€‚</p>
<hr />
<h2>1. åŠ¨æ€ä½å®… IP (æ‹¨å·ä»£ç†) åŸç†</h2>
<h3>a) ä»€ä¹ˆæ˜¯åŠ¨æ€ä½å®… IPï¼Ÿ</h3>
<ul>
<li><p><strong>ä½å®… IP</strong>: æŒ‡ç”±äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼ˆISPï¼‰ï¼Œå¦‚ç”µä¿¡ã€è”é€šã€ç§»åŠ¨ï¼Œåˆ†é…ç»™æ™®é€šå®¶åº­ç”¨æˆ·çš„ IP åœ°å€ã€‚è¿™äº› IP åœ°å€å±äºçœŸå®çš„ä½å®…ç½‘ç»œï¼Œä¿¡èª‰åº¦æœ€é«˜ã€‚</p>
</li>
<li><p><strong>åŠ¨æ€ IP</strong>: ä¸æ•°æ®ä¸­å¿ƒå›ºå®šçš„é™æ€ IP ä¸åŒï¼Œä½å®…å®½å¸¦é€šå¸¸ä½¿ç”¨ <strong>PPPoE (Point-to-Point Protocol over Ethernet)</strong> åè®®è¿›è¡Œæ‹¨å·ä¸Šç½‘ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š<strong>æ¯æ–­å¼€ä¸€æ¬¡è¿æ¥å†é‡æ–°æ‹¨å·ï¼ŒISP çš„ BRASï¼ˆå®½å¸¦è¿œç¨‹æ¥å…¥æœåŠ¡å™¨ï¼‰å°±ä¼šä»å…¶åœ°å€æ± ä¸­é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„ IP åœ°å€ç»™ç”¨æˆ·</strong>ã€‚</p>
</li>
</ul>
<p>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºè‡ªåŠ¨åŒ–åœ°æ§åˆ¶ ADSL (æˆ–å…‰çŒ«) è¿›è¡Œ&quot;æ–­çº¿é‡æ‹¨&quot;ï¼Œä»è€Œåœ¨æçŸ­çš„æ—¶é—´å†…è·å–ä¸€ä¸ªå…¨æ–°çš„ã€å¹²å‡€çš„ã€çœŸå®çš„ä½å®… IPã€‚è¿™å°±æ˜¯æ‹¨å·ä»£ç†çš„æ ¸å¿ƒåŸç†ã€‚</p>
<h3>b) ä¼˜åŠ¿</h3>
<ul>
<li><p><strong>æé«˜çš„çœŸå®æ€§</strong>: IP æ¥è‡ªçœŸå®çš„ ISP ä½å®…ç½‘ç»œï¼Œæ— æ³•è¢«ç›®æ ‡æœåŠ¡å™¨é€šè¿‡ IP åº“è¯†åˆ«ä¸ºæ•°æ®ä¸­å¿ƒæµé‡ã€‚</p>
</li>
<li><p><strong>æµ·é‡ IP èµ„æº</strong>: ä¸€ä¸ªåœ°åŒºçº§çš„ ISP è¿è¥å•†é€šå¸¸æ‹¥æœ‰æ•°ä¸‡åˆ°æ•°ç™¾ä¸‡çš„ IP åœ°å€æ± ã€‚ç†è®ºä¸Šï¼Œé€šè¿‡ä¸æ–­é‡æ‹¨ï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¥åœ°åŒºçš„æ‰€æœ‰ IPã€‚</p>
</li>
<li><p><strong>æˆæœ¬å¯æ§</strong>: ç›¸æ¯”äºæŒ‰æµé‡è®¡è´¹çš„å•†ä¸šä½å®…ä»£ç†æœåŠ¡ï¼Œè‡ªå»ºæ‹¨å·ä»£ç†æ± ï¼ˆå°¤å…¶æ˜¯åœ¨æ‹¥æœ‰ç‰©ç†è®¾å¤‡çš„æƒ…å†µä¸‹ï¼‰çš„é•¿æœŸæˆæœ¬æ›´ä½ã€‚</p>
</li>
</ul>
<hr />
<h2>2. æ­å»ºæ‹¨å·ä»£ç†æ± </h2>
<p>æ­å»ºä¸€ä¸ªç¨³å®šé«˜æ•ˆçš„æ‹¨å·ä»£ç†æ± ï¼Œéœ€è¦å°†ç‰©ç†å±‚çš„æ‹¨å·è®¾å¤‡ã€ç½‘ç»œå±‚çš„ä»£ç†æœåŠ¡å’Œç®¡ç†å±‚çš„è°ƒåº¦ç³»ç»Ÿç»“åˆèµ·æ¥ã€‚</p>
<h3>a) ç¡¬ä»¶ä¸ç‰©ç†å±‚</h3>
<ol>
<li><strong>ADSL/å…‰çŒ« + è·¯ç”±å™¨</strong>: è¿™æ˜¯æœ€åŸºç¡€çš„å•å…ƒã€‚ä½ éœ€è¦ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰åŠç†äº†å®½å¸¦ä¸šåŠ¡çš„ ADSL çŒ«æˆ–å…‰çŒ«ï¼Œå¹¶è¿æ¥åˆ°ä¸€ä¸ªå¯ä»¥è¢«ç¨‹åºæ§åˆ¶çš„è·¯ç”±å™¨ã€‚</li>
<li><strong>æ ‘è“æ´¾/å°å‹ PC</strong>: åœ¨æ¯ä¸ªæ‹¨å·è®¾å¤‡æ—è¾¹ï¼Œæ”¾ç½®ä¸€ä¸ªç±»ä¼¼æ ‘è“æ´¾çš„å»‰ä»·å°å‹ä¸»æœºï¼Œç”¨äºæ‰§è¡Œæ‹¨å·å’Œä»£ç†æœåŠ¡çš„æŒ‡ä»¤ã€‚</li>
<li><strong>4G/5G æ¨¡å— (å¯é€‰)</strong>: é™¤äº†å›ºå®šå®½å¸¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ 4G/5G å·¥ä¸šæ¨¡å—ã€‚é€šè¿‡æ§åˆ¶æ¨¡å—çš„é£è¡Œæ¨¡å¼åˆ‡æ¢æˆ–é‡ç½®ï¼ŒåŒæ ·å¯ä»¥å®ç° IP çš„æ›´æ¢ã€‚è¿™ç§æ–¹å¼çµæ´»æ€§æ›´é«˜ï¼Œä½†æµé‡æˆæœ¬ä¹Ÿæ›´é«˜ã€‚</li>
</ol>
<h3>b) è½¯ä»¶ä¸ç½‘ç»œå±‚</h3>
<ol>
<li><strong>æ‹¨å·è„šæœ¬</strong>: åœ¨æ ‘è“æ´¾ä¸Šè¿è¡Œä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºæ§åˆ¶è·¯ç”±å™¨æ‰§è¡Œ PPPoE çš„æ–­å¼€å’Œé‡è¿æ“ä½œã€‚è¿™é€šå¸¸å¯ä»¥é€šè¿‡ <code>curl</code> æˆ– <code>ssh</code> è°ƒç”¨è·¯ç”±å™¨çš„ç®¡ç†æ¥å£æ¥å®ç°ã€‚</li>
</ol>
<ul>
<li><p><strong>ç¤ºä¾‹ (æ§åˆ¶ OpenWrt/LEDE è·¯ç”±å™¨çš„è„šæœ¬)</strong>:</p>
<pre><code class="language-bash">
</code></pre>
</li>
</ul>
<h1>æ–­å¼€ PPPoE è¿æ¥</h1>
<p>ssh root@192.168.1.1 'ifdown wan'</p>
<h1>é‡æ–°è¿æ¥</h1>
<p>ssh root@192.168.1.1 'ifup wan'</p>
<h1>è·å–æ–° IP</h1>
<p>ssh root@192.168.1.1 'ifconfig pppoe-wan | grep &quot;inet addr&quot; | cut -d: -f2 | cut -d&quot; &quot; -f1'</p>
<pre><code>
* **Squid é…ç½®ç¤ºä¾‹ (`squid.conf`)**:
    ```

# å…è®¸æ‰€æœ‰æ¥æºçš„æ‰€æœ‰è¯·æ±‚
http_access allow all

# ç›‘å¬ç«¯å£
http_port 3128

# ç¦æ­¢æ³„éœ²åŸå§‹ IP
forwarded_for off
request_header_access Via deny all
request_header_access X-Forwarded-For deny all

</code></pre>
<p>å½“ä½ æœ‰å¤§é‡çš„æ‹¨å·èŠ‚ç‚¹æ—¶ï¼Œä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç®¡ç†ç³»ç»Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<ol>
<li><strong>ä¸­å¿ƒ API æœåŠ¡å™¨</strong>:</li>
</ol>
<ul>
<li><p><strong>IP æ³¨å†Œ</strong>: æ¯ä¸ªæ‹¨å·èŠ‚ç‚¹åœ¨æˆåŠŸè·å–æ–° IP åï¼Œå°† <code>(æ–°IP:ç«¯å£, åœ°ç†ä½ç½®, ISP)</code> ç­‰ä¿¡æ¯ä¸ŠæŠ¥ç»™ä¸­å¿ƒæœåŠ¡å™¨ã€‚</p>
</li>
<li><p><strong>IP è·å–</strong>: ä¸šåŠ¡ç¨‹åºï¼ˆå¦‚çˆ¬è™«ï¼‰é€šè¿‡è°ƒç”¨ APIï¼Œä»ä¸­å¿ƒæœåŠ¡å™¨è·å–ä¸€ä¸ªå½“å‰å¯ç”¨çš„ä»£ç† IPã€‚å¯ä»¥æ ¹æ®éœ€æ±‚æŒ‡å®šåœ°ç†ä½ç½®ç­‰æ¡ä»¶ã€‚</p>
</li>
<li><p><strong>IP ç»­æœŸä¸å¿ƒè·³</strong>: æ‹¨å·èŠ‚ç‚¹éœ€è¦å®šæœŸå‘ä¸­å¿ƒæœåŠ¡å™¨å‘é€å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±ä»ç„¶åœ¨çº¿ã€‚å¦‚æœå¿ƒè·³è¶…æ—¶ï¼ŒæœåŠ¡å™¨å°±å°†è¯¥ IP ä»å¯ç”¨æ± ä¸­ç§»é™¤ã€‚</p>
</li>
<li><p><strong>IP æ³¨å†Œ</strong>: æ¯ä¸ªæ‹¨å·èŠ‚ç‚¹åœ¨æˆåŠŸè·å–æ–° IP åï¼Œå°† <code>(æ–°IP:ç«¯å£, åœ°ç†ä½ç½®, ISP)</code> ç­‰ä¿¡æ¯ä¸ŠæŠ¥ç»™ä¸­å¿ƒæœåŠ¡å™¨ã€‚</p>
</li>
<li><p><strong>IP è·å–</strong>: ä¸šåŠ¡ç¨‹åºï¼ˆå¦‚çˆ¬è™«ï¼‰é€šè¿‡è°ƒç”¨ APIï¼Œä»ä¸­å¿ƒæœåŠ¡å™¨è·å–ä¸€ä¸ªå½“å‰å¯ç”¨çš„ä»£ç† IPã€‚å¯ä»¥æ ¹æ®éœ€æ±‚æŒ‡å®šåœ°ç†ä½ç½®ç­‰æ¡ä»¶ã€‚</p>
</li>
<li><p><strong>IP ç»­æœŸä¸å¿ƒè·³</strong>: æ‹¨å·èŠ‚ç‚¹éœ€è¦å®šæœŸå‘ä¸­å¿ƒæœåŠ¡å™¨å‘é€å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±ä»ç„¶åœ¨çº¿ã€‚å¦‚æœå¿ƒè·³è¶…æ—¶ï¼ŒæœåŠ¡å™¨å°±å°†è¯¥ IP ä»å¯ç”¨æ± ä¸­ç§»é™¤ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>IP æ± ç®¡ç†ç­–ç•¥</strong>:</li>
</ol>
<ul>
<li><p><strong>å¯ç”¨æ€§æ£€æµ‹</strong>: ä¸­å¿ƒæœåŠ¡å™¨å®šæœŸä¸»åŠ¨æ£€æµ‹æ± ä¸­ä»£ç†çš„è¿é€šæ€§ï¼Œå‰”é™¤å¤±æ•ˆçš„ IPã€‚</p>
</li>
<li><p><strong>IP è½®æ¢</strong>: å½“ä¸€ä¸ª IP è¢«å°ç¦æˆ–ä½¿ç”¨æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œä¸šåŠ¡ç¨‹åºå¯ä»¥è°ƒç”¨ API è¯·æ±‚ä¸­å¿ƒæœåŠ¡å™¨é€šçŸ¥å¯¹åº”çš„æ‹¨å·èŠ‚ç‚¹æ‰§è¡Œ&quot;æ¢ IP&quot;æ“ä½œã€‚</p>
</li>
<li><p><strong>å¹¶å‘æ§åˆ¶</strong>: ç®¡ç†æ¯ä¸ªä»£ç† IP å½“å‰çš„å¹¶å‘è¯·æ±‚æ•°ï¼Œé¿å…å› è¿‡åº¦ä½¿ç”¨è€Œè¢«å°ç¦ã€‚</p>
</li>
<li><p><strong>å¯ç”¨æ€§æ£€æµ‹</strong>: ä¸­å¿ƒæœåŠ¡å™¨å®šæœŸä¸»åŠ¨æ£€æµ‹æ± ä¸­ä»£ç†çš„è¿é€šæ€§ï¼Œå‰”é™¤å¤±æ•ˆçš„ IPã€‚</p>
</li>
<li><p><strong>IP è½®æ¢</strong>: å½“ä¸€ä¸ª IP è¢«å°ç¦æˆ–ä½¿ç”¨æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œä¸šåŠ¡ç¨‹åºå¯ä»¥è°ƒç”¨ API è¯·æ±‚ä¸­å¿ƒæœåŠ¡å™¨é€šçŸ¥å¯¹åº”çš„æ‹¨å·èŠ‚ç‚¹æ‰§è¡Œ&quot;æ¢ IP&quot;æ“ä½œã€‚</p>
</li>
<li><p><strong>å¹¶å‘æ§åˆ¶</strong>: ç®¡ç†æ¯ä¸ªä»£ç† IP å½“å‰çš„å¹¶å‘è¯·æ±‚æ•°ï¼Œé¿å…å› è¿‡åº¦ä½¿ç”¨è€Œè¢«å°ç¦ã€‚</p>
</li>
</ul>
<h3>d) æ•´ä½“æ¶æ„å›¾</h3>
<pre><code class="language-mermaid">graph TD
subgraph &quot;ä¸šåŠ¡æœåŠ¡å™¨&quot;
A[çˆ¬è™«/ä¸šåŠ¡åº”ç”¨] --&gt; B{ä¸­å¿ƒ API Server};
end

B -- è·å–ä»£ç† --&gt; A;
B -- ç®¡ç†/è°ƒåº¦ --&gt; C1;
B -- ç®¡ç†/è°ƒåº¦ --&gt; C2;
B -- ç®¡ç†/è°ƒåº¦ --&gt; C3;

subgraph &quot;æ‹¨å·èŠ‚ç‚¹ 1 (ä¸Šæµ·ç”µä¿¡)&quot;
C1[æ ‘è“æ´¾] --&gt; D1[ä»£ç†æœåŠ¡ (Squid)];
C1 -- æ§åˆ¶é‡æ‹¨ --&gt; E1[è·¯ç”±å™¨/å…‰çŒ«];
E1 -- PPPoE --&gt; F1[(ISP ç½‘ç»œ)];
end

subgraph &quot;æ‹¨å·èŠ‚ç‚¹ 2 (åŒ—äº¬è”é€š)&quot;
C2[æ ‘è“æ´¾] --&gt; D2[ä»£ç†æœåŠ¡ (Squid)];
C2 -- æ§åˆ¶é‡æ‹¨ --&gt; E2[è·¯ç”±å™¨/å…‰çŒ«];
E2 -- PPPoE --&gt; F2[(ISP ç½‘ç»œ)];
end

subgraph &quot;æ‹¨å·èŠ‚ç‚¹ N (æ·±åœ³ç§»åŠ¨)&quot;
C3[æ ‘è“æ´¾] --&gt; D3[ä»£ç†æœåŠ¡ (Squid)];
C3 -- æ§åˆ¶é‡æ‹¨ --&gt; E3[è·¯ç”±å™¨/å…‰çŒ«];
E3 -- PPPoE --&gt; F3[(ISP ç½‘ç»œ)];
end

C1 -- ä¸ŠæŠ¥ IP --&gt; B;
C2 -- ä¸ŠæŠ¥ IP --&gt; B;
C3 -- ä¸ŠæŠ¥ IP --&gt; B;

</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-28">
                                                <h2>28. R26: Proxy Pool Design</h2>
                                                <h1>R26: ä»£ç†æ± è®¾è®¡ä¸ Scrapy é›†æˆ</h1>
<p>åœ¨é¢å¯¹åçˆ¬è™«ç­–ç•¥ä¸¥å‰çš„ç›®æ ‡ç«™ï¼ˆå¦‚ç”µå•†ã€ç¤¾äº¤åª’ä½“ï¼‰æ—¶ï¼Œå•ä¸€ IP å¾ˆå®¹æ˜“è¢«å°ç¦ã€‚æ„å»ºä¸€ä¸ªé«˜å¯ç”¨ã€è‡ªåŠ¨è½®è½¬çš„ä»£ç†æ±  (Proxy Pool) æ˜¯å¤§è§„æ¨¡æ•°æ®é‡‡é›†çš„åŸºç¡€è®¾æ–½ã€‚</p>
<h2>1. ä»£ç†æ± æ¶æ„è®¾è®¡</h2>
<p>ä¸€ä¸ªæˆç†Ÿçš„ä»£ç†æ± ç³»ç»Ÿé€šå¸¸åŒ…å«å››ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œé€šè¿‡ Redis è¿›è¡Œè§£è€¦ï¼š</p>
<h3>æ ¸å¿ƒç»„ä»¶</h3>
<ol>
<li><strong>Fetcher (è·å–å™¨)</strong>:</li>
</ol>
<ul>
<li><strong>èŒè´£</strong>: å®šæ—¶ä»å„å¤§å…è´¹ä»£ç†ç½‘ç«™ï¼ˆå¿«ä»£ç†ã€äº‘ä»£ç†ç­‰ï¼‰æˆ–ä»˜è´¹ API æ¥å£æ‹‰å–ä»£ç† IPã€‚</li>
<li><strong>ç­–ç•¥</strong>: æ¯éš” N åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œå°†è·å–åˆ°çš„æ–° IP å­˜å…¥ Redis çš„â€œå¾…æ£€æµ‹â€é˜Ÿåˆ—ã€‚</li>
</ul>
<ol start="2">
<li><strong>Checker (æ£€æµ‹å™¨)</strong>:</li>
</ol>
<ul>
<li><strong>èŒè´£</strong>: å¼‚æ­¥æ£€æµ‹ Redis ä¸­ä»£ç† IP çš„å¯ç”¨æ€§ã€åŒ¿ååº¦å’Œå“åº”é€Ÿåº¦ã€‚</li>
<li><strong>å®ç°</strong>: ä½¿ç”¨ <code>aiohttp</code> æˆ– <code>requests</code> å¯¹ç›®æ ‡ç½‘ç«™ï¼ˆå¦‚ç™¾åº¦ã€è°·æ­Œæˆ–ç‰¹å®šç›®æ ‡ç«™ï¼‰å‘èµ·è¯·æ±‚ã€‚</li>
<li><strong>è¯„åˆ†æœºåˆ¶</strong>:</li>
</ul>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>å¯ç”¨</strong></td>
  <td>åˆ†æ•°è®¾ä¸º 100ï¼ˆæˆ– +1ï¼‰ã€‚</td>
</tr>
<tr>
  <td><strong>ä¸å¯ç”¨</strong></td>
  <td>åˆ†æ•°å‡ 1ï¼Œå½“åˆ†æ•°ä½äºé˜ˆå€¼ï¼ˆå¦‚ 0ï¼‰æ—¶ï¼Œä» Redis ç§»é™¤ã€‚</td>
</tr>
<tr>
  <td><strong>å¤æ£€</strong></td>
  <td>å®šæ—¶éå† Redis ä¸­ç°å­˜çš„ä»£ç†è¿›è¡Œå¤æ£€ï¼Œç¡®ä¿åº“ä¸­ IP å§‹ç»ˆæœ‰æ•ˆã€‚</td>
</tr>
</tbody>
</table>
<ol start="3">
<li><strong>Storage (å­˜å‚¨å™¨)</strong>:</li>
</ol>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ•°æ®åº“</strong></td>
  <td>Redis æ˜¯æœ€ä½³é€‰æ‹©ã€‚</td>
</tr>
<tr>
  <td><strong>æ•°æ®ç»“æ„</strong></td>
  <td><code>Sorted Set</code> (æœ‰åºé›†åˆ)ã€‚</td>
</tr>
<tr>
  <td><strong>Key</strong></td>
  <td>ä»£ç† IP (<code>1.2.3.4:8080</code>)</td>
</tr>
<tr>
  <td><strong>Score</strong></td>
  <td>ä»£ç†åˆ†æ•° (0-100)</td>
</tr>
<tr>
  <td><strong>ä¼˜åŠ¿</strong></td>
  <td>å¯ä»¥åˆ©ç”¨ <code>ZRANGEBYSCORE</code> è½»æ¾è·å–é«˜è´¨é‡ï¼ˆæ»¡åˆ†ï¼‰ä»£ç†ã€‚</td>
</tr>
</tbody>
</table>
<ol start="4">
<li><strong>API Server (æ¥å£æœåŠ¡)</strong>:</li>
</ol>
<ul>
<li><strong>èŒè´£</strong>: ä¸ºçˆ¬è™«æä¾›ç®€å•çš„ HTTP æ¥å£è·å–ä»£ç†ã€‚</li>
<li><strong>æ¥å£</strong>:</li>
<li><code>/get</code>: éšæœºè¿”å›ä¸€ä¸ªé«˜åˆ†ä»£ç†ã€‚</li>
<li><code>/count</code>: æŸ¥çœ‹å½“å‰å¯ç”¨ä»£ç†æ•°é‡ã€‚</li>
</ul>
<h3>architecture å›¾</h3>
<pre><code class="language-mermaid">graph LR
ProxySources[å…è´¹/ä»˜è´¹æº] --&gt; Fetcher
Fetcher --&gt;|Raw Proxy| Redis[(Redis Sorted Set)]
Redis &lt;--&gt;|Validation| Checker
Crawler[Scrapy çˆ¬è™«] --&gt;|Request| API[API Server]
API --&gt;|Get High Score Proxy| Redis

</code></pre>
<ol>
<li><strong>è¯·æ±‚å‰ (<code>process_request</code>)</strong>: ä»ä»£ç†æ± è·å–ä¸€ä¸ªä»£ç†ï¼Œèµ‹å€¼ç»™ <code>request.meta['proxy']</code>ã€‚</li>
<li><strong>å“åº”å (<code>process_response</code>)</strong>: æ£€æŸ¥çŠ¶æ€ç ã€‚å¦‚æœæ˜¯ 200ï¼Œè¯´æ˜ä»£ç†æ­£å¸¸ï¼›å¦‚æœæ˜¯ 403/429/è¶…æ—¶ï¼Œè¯´æ˜ä»£ç†å¯èƒ½å¤±æ•ˆæˆ–è¢«å°ã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç† (<code>process_exception</code>)</strong>: æ•è·è¿æ¥è¶…æ—¶ã€è¿æ¥æ‹’ç»ç­‰ç½‘ç»œé”™è¯¯ï¼Œæ ‡è®°è¯¥ä»£ç†å¤±æ•ˆï¼Œå¹¶å¯¹å½“å‰è¯·æ±‚è¿›è¡Œé‡è¯•ã€‚</li>
</ol>
<h3>ä»£ç å®ç°</h3>
<pre><code class="language-python"># middlewares.py
import requests
import logging
from scrapy.exceptions import IgnoreRequest

class ProxyMiddleware:
def __init__(self, proxy_pool_url):
self.proxy_pool_url = proxy_pool_url
self.logger = logging.getLogger(__name__)

@classmethod
def from_crawler(cls, crawler):
return cls(
proxy_pool_url=crawler.settings.get('PROXY_POOL_URL')
)

def _get_random_proxy(self):
try:
response = requests.get(self.proxy_pool_url)
if response.status_code == 200:
return response.text.strip()
except requests.ConnectionError:
return None
return None

def process_request(self, request, spider):
# IfRequestå·²ç»settingssssssä»£ç†ï¼ˆE.g.SpecificRequestï¼‰ï¼Œåˆ™è·³è¿‡
if request.meta.get('proxy'):
return

proxy = self._get_random_proxy()
if proxy:
self.logger.debug(f&quot;Using proxy: {proxy}&quot;)
# settingssssssä»£ç†ï¼Œæ ¼å¼: http://user:pass@ip:ç«¯å£ or http://ip:ç«¯å£
request.meta['proxy'] = f&quot;http://{proxy}&quot;
else:
self.logger.warning(&quot;No proxy available from pool!&quot;)

def process_response(self, request, response, spider):
# å¦‚æœé‡åˆ°éªŒè¯ç ã€å°ç¦ç­‰çŠ¶æ€ç 
if response.status_code in [403, 429]:
self.logger.warning(f&quot;Proxy {request.meta.get('proxy')} banned (Status {response.status_code}), retrying...&quot;)
# æ ‡è®°è¯¥ä»£ç†å¤±æ•ˆï¼ˆå¯é€‰ï¼šè°ƒç”¨ æ¥å£ æŠ¥å‘Šè¯¥ä»£ç†åï¼‰
# self._report_bad_proxy(request.meta.get('proxy'))

# DeleteCurrentä»£ç†settingssssssï¼ŒRe-è°ƒåº¦Requestï¼ˆä¼šå†æ¬¡ç»è¿‡ process_request æ¢æ–°ä»£ç†ï¼‰
del request.meta['proxy']
return request.replace(dont_filter=True)

return response

def process_exception(self, request, exception, spider):
# process connection timeoutã€DNS ErrorEtc
self.logger.error(f&quot;Proxy {request.meta.get('proxy')} failed: {exception}&quot;)

# æ¢ä»£ç†é‡è¯•
del request.meta['proxy']
return request.replace(dont_filter=True)

</code></pre>
<p>'myproject.middlewares.ProxyMiddleware': 543,</p>
<h1>ç¦ç”¨ Scrapy é»˜è®¤ UserAgent and é‡è¯• In é—´ä»¶ï¼ˆè§†æƒ…å†µè€Œå®šï¼‰</h1>
<h1>'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': None,</h1>
<p>}</p>
<p>PROXY_POOL_URL = 'http://localhost:5000/get'</p>
<pre><code>
- **GitHub**: `jhao104/proxy_pool`
- **ç‰¹ç‚¹**: ä¹Ÿæ˜¯åŸºäº Redisï¼Œæ¶æ„æ¸…æ™°ï¼Œæ”¯æŒ Docker ä¸€é”®éƒ¨ç½²ï¼Œå†…ç½®äº†å‡ åä¸ªå…è´¹æºçš„æŠ“å–è§„åˆ™ã€‚

2. **Gerapy / Scylla**

- **GitHub**: `imWildCat/scylla`
- **ç‰¹ç‚¹**: æ™ºèƒ½åŒ–ä»£ç†æ± ï¼Œè‡ªåŠ¨å­¦ä¹ ä»£ç†çš„ç¨³å®šæ€§ã€‚

3. **GimmeProxy**
- **ç‰¹ç‚¹**: Go è¯­è¨€ç¼–å†™ï¼Œæ€§èƒ½å¼ºåŠ²ã€‚
---
## 4. éš§é“ä»£ç† (Tunnel Proxy)

å¯¹äºä¼ä¸šçº§åº”ç”¨ï¼Œç»´æŠ¤è‡ªå»ºä»£ç†æ± æˆæœ¬è¾ƒé«˜ï¼ˆå…è´¹ IP è´¨é‡æå·®ï¼Œå¯ç”¨ç‡ä¸è¶³ 5%ï¼‰ã€‚æ­¤æ—¶é€šå¸¸ä½¿ç”¨å‚å•†æä¾›çš„**éš§é“ä»£ç†**ã€‚

**ç‰¹ç‚¹**:

- ä¸éœ€è¦åœ¨æœ¬åœ°ç»´æŠ¤ IP æ± ã€‚
- åªæœ‰ä¸€ä¸ªå›ºå®šçš„å…¥å£åœ°å€ï¼ˆå¦‚ `http://proxy.vendor.com:8000`ï¼‰ã€‚
- **æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œäº‘ç«¯ä¼šè‡ªåŠ¨è½¬å‘ç»™èƒŒåä¸åŒçš„åŠ¨æ€ IP**ã€‚

**Scrapy é›†æˆ**:
åªéœ€è¦åœ¨ `process_request` ä¸­å°†ä»£ç†è®¾ç½®ä¸ºè¯¥å›ºå®šåœ°å€ï¼Œå¹¶åœ¨ Header ä¸­æ·»åŠ é‰´æƒä¿¡æ¯ã€‚

```python
# Tunnel Proxy Example
request.meta['proxy'] = &quot;http://proxy.vendor.com:8000&quot;
# æŸäº›å‚å•†è¦æ±‚åœ¨å¤´éƒ¨é€šè¿‡ Proxy-Authorization è®¤è¯
import base64
auth = base64.b64encode(b&quot;user:pass&quot;).decode()
request.headers['Proxy-Authorization'] = f&quot;Basic {auth}&quot;

</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-29">
                                                <h2>29. R27: Scrapy</h2>
                                                <h1>R27: Scrapy å¿«é€Ÿå…¥é—¨å¤‡å¿˜å½•</h1>
<p>Scrapy æ˜¯ä¸€ä¸ªç”¨äºç½‘ç»œçˆ¬è™«å’Œæ•°æ®æŠ“å–çš„ã€å¼€æºçš„ã€åä½œå¼çš„ Python æ¡†æ¶ã€‚å®ƒå…·æœ‰é€Ÿåº¦å¿«ã€åŠŸèƒ½å¼ºå¤§ã€å¯æ‰©å±•æ€§é«˜çš„ç‰¹ç‚¹ã€‚æœ¬å¤‡å¿˜å½•ä¸º Scrapy çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤æä¾›å¿«é€Ÿå‚è€ƒã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#scrapy-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%A4%87%E5%BF%98%E5%BD%95">Scrapy å¿«é€Ÿå…¥é—¨å¤‡å¿˜å½•</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">æ ¸å¿ƒç»„ä»¶</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E5%91%BD%E4%BB%A4">é¡¹ç›®å‘½ä»¤</a></li>
<li><a href="#spider-%E7%88%AC%E8%99%AB">Spider (çˆ¬è™«)</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84">åŸºæœ¬ç»“æ„</a></li>
<li><a href="#%E5%A4%84%E7%90%86%E5%88%86%E9%A1%B5%E5%92%8C%E9%93%BE%E6%8E%A5">å¤„ç†åˆ†é¡µå’Œé“¾æ¥</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>æ ¸å¿ƒç»„ä»¶</h3>
<p>Scrapy çš„æ•°æ®æµç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ååŒå®Œæˆï¼š</p>
<ol>
<li><strong>Engine (å¼•æ“)</strong>: è´Ÿè´£æ§åˆ¶æ‰€æœ‰ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµï¼Œå¹¶åœ¨ç›¸åº”åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘äº‹ä»¶ã€‚</li>
<li><strong>Scheduler (è°ƒåº¦å™¨)</strong>: æ¥æ”¶æ¥è‡ªå¼•æ“çš„è¯·æ±‚ (<code>Request</code>)ï¼Œå¹¶å°†å…¶å…¥é˜Ÿï¼Œä»¥ä¾¿åç»­å¼•æ“è¯·æ±‚æ—¶æä¾›ã€‚</li>
<li><strong>Downloader (ä¸‹è½½å™¨)</strong>: è´Ÿè´£è·å–é¡µé¢æ•°æ®ï¼Œå¹¶å°†å…¶æä¾›ç»™å¼•æ“ï¼Œè€Œåç”±å¼•æ“å°†ç»“æœ (<code>Response</code>) äº¤ç»™ Spiderã€‚</li>
<li><strong>Spiders (çˆ¬è™«)</strong>: ç”¨æˆ·ç¼–å†™çš„ç”¨äºè§£æ <code>Response</code> å¹¶æå– <code>Item</code> æˆ–é¢å¤– <code>Request</code> çš„ç±»ã€‚</li>
<li><strong>Item Pipeline (é¡¹ç›®ç®¡é“)</strong>: è´Ÿè´£å¤„ç†ç”± Spider æå–å‡ºæ¥çš„ <code>Item</code>ã€‚å…¸å‹çš„æ“ä½œåŒ…æ‹¬æ•°æ®æ¸…æ´—ã€éªŒè¯å’ŒæŒä¹…åŒ–ï¼ˆå¦‚å­˜å…¥æ•°æ®åº“ï¼‰ã€‚</li>
<li><strong>Downloader Middlewares (ä¸‹è½½å™¨ä¸­é—´ä»¶)</strong>: ä½äºå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´çš„é’©å­ï¼Œç”¨äºåœ¨è¯·æ±‚å‘é€å’Œå“åº”è¿”å›æ—¶è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼ˆå¦‚è®¾ç½® User-Agentã€å¤„ç†ä»£ç†ï¼‰ã€‚</li>
<li><strong>Spider Middlewares (çˆ¬è™«ä¸­é—´ä»¶)</strong>: ä½äºå¼•æ“å’Œ Spider ä¹‹é—´çš„é’©å­ï¼Œç”¨äºå¤„ç† Spider çš„è¾“å…¥ (<code>Response</code>) å’Œè¾“å‡º (<code>Item</code>, <code>Request</code>)ã€‚</li>
</ol>
<p><img src="https://docs.scrapy.org/en/latest/_images/scrapy_architecture.png" alt="Scrapy Architecture" /></p>
<hr />
<h3>é¡¹ç›®å‘½ä»¤</h3>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>pip install scrapy</code></td>
  <td style="text-align:left">å®‰è£… Scrapy æ¡†æ¶</td>
</tr>
<tr>
  <td style="text-align:left"><code>scrapy startproject myproject</code></td>
  <td style="text-align:left">åˆ›å»ºä¸€ä¸ªåä¸º <code>myproject</code> çš„æ–°é¡¹ç›®</td>
</tr>
<tr>
  <td style="text-align:left"><code>cd myproject</code></td>
  <td style="text-align:left">è¿›å…¥é¡¹ç›®ç›®å½•</td>
</tr>
<tr>
  <td style="text-align:left"><code>scrapy genspider example example.com</code></td>
  <td style="text-align:left">åœ¨ <code>spiders</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>example</code> çš„çˆ¬è™«ï¼Œé™å®šåŸŸåä¸º <code>example.com</code></td>
</tr>
<tr>
  <td style="text-align:left"><code>scrapy crawl example</code></td>
  <td style="text-align:left">è¿è¡Œåä¸º <code>example</code> çš„çˆ¬è™«</td>
</tr>
<tr>
  <td style="text-align:left"><code>scrapy crawl example -o output.json</code></td>
  <td style="text-align:left">è¿è¡Œçˆ¬è™«å¹¶å°†æå–çš„æ•°æ®ä¿å­˜ä¸º JSON æ–‡ä»¶</td>
</tr>
<tr>
  <td style="text-align:left"><code>scrapy shell &quot;http://example.com&quot;</code></td>
  <td style="text-align:left">å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ Shellï¼Œç”¨äºæµ‹è¯• XPath/CSS é€‰æ‹©å™¨</td>
</tr>
<tr>
  <td style="text-align:left"><code>scrapy list</code></td>
  <td style="text-align:left">åˆ—å‡ºé¡¹ç›®ä¸­çš„æ‰€æœ‰å¯ç”¨çˆ¬è™«</td>
</tr>
</tbody>
</table>
<hr />
<h3>Spider (çˆ¬è™«)</h3>
<p>Spider æ˜¯ä½ å®šä¹‰å¦‚ä½•çˆ¬å–æŸä¸ªç½‘ç«™ï¼ˆæˆ–ä¸€ç»„ç½‘ç«™ï¼‰çš„ç±»ï¼ŒåŒ…æ‹¬çˆ¬å–åŠ¨ä½œå’Œå¦‚ä½•ä»é¡µé¢å†…å®¹ä¸­æå–ç»“æ„åŒ–æ•°æ®ã€‚</p>
<h4>åŸºæœ¬ç»“æ„</h4>
<pre><code class="language-python"># myproject/spiders/example_spider.py
import scrapy

class ExampleSpider(scrapy.Spider):
# çˆ¬è™«çš„å”¯ä¸€æ ‡è¯†åç§°
name = 'example'
# å…è®¸çˆ¬å–çš„åŸŸååˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
allowed_domains = ['example.com']
# çˆ¬è™«å¯åŠ¨æ—¶è¯·æ±‚çš„ URL åˆ—è¡¨
start_urls = ['http://example.com/']

# å¤„ç† start_urls å“åº”çš„é»˜è®¤å›è°ƒæ–¹æ³•
def parse(self, response):
# åœ¨è¿™é‡Œç¼–å†™è§£æé€»è¾‘
pass

</code></pre>
<ul>
<li><p><code>response.css('a::attr(href)').getall()</code>: æå–æ‰€æœ‰ <code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§ã€‚</p>
</li>
<li><p><code>response.css('div.product &gt; p::text').get()</code>: æå– <code>class=&quot;product&quot;</code> çš„ <code>div</code> ä¸‹çš„ <code>p</code> æ ‡ç­¾æ–‡æœ¬ã€‚</p>
</li>
<li><p><strong>XPath è¡¨è¾¾å¼</strong>:</p>
</li>
<li><p><code>response.xpath('//h1/text()').get()</code>: æå–ç¬¬ä¸€ä¸ª <code>&lt;h1&gt;</code> æ ‡ç­¾çš„æ–‡æœ¬ã€‚</p>
</li>
<li><p><code>response.xpath('//a/@href').getall()</code>: æå–æ‰€æœ‰ <code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§ã€‚</p>
</li>
<li><p><code>response.xpath('//div[@class=&quot;product&quot;]/p/text()').get()</code>: åŒä¸Šã€‚</p>
</li>
</ul>
<h4>å¤„ç†åˆ†é¡µå’Œé“¾æ¥</h4>
<p>åœ¨ <code>parse</code> æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥ <code>yield</code> æ–°çš„ <code>Request</code> å¯¹è±¡æ¥è·Ÿè¿›é“¾æ¥ã€‚</p>
<pre><code class="language-python">def parse(self, response):
# ... æå–å½“å‰é¡µé¢æ•°æ® ...

# æå–ä¸‹ä¸€é¡µé“¾æ¥å¹¶ç”Ÿæˆæ–°è¯·æ±‚
next_page = response.css('a.next_page::attr(href)').get()
if next_page is not None:
# response.urljoin() ç”¨äºå¤„ç†ç›¸å¯¹ URL
yield response.follow(next_page, callback=self.parse)

</code></pre>
<pre><code class="language-python"># myproject/items.py
import scrapy

class ProductItem(scrapy.Item):
name = scrapy.Field()
price = scrapy.Field()
description = scrapy.Field()

</code></pre>
<p>item = ProductItem()
item['name'] = response.css('h1.product-name::text').get()
item['price'] = response.css('span.price::text').get()
yield item</p>
<pre><code>
```python
# myproject/pipelines.py
import sqlite3

class SQLitePipeline:
def open_spider(self, spider):
# çˆ¬è™«å¼€å¯æ—¶è°ƒç”¨
self.connection = sqlite3.connect('products.db')
self.cursor = self.connection.cursor()
self.cursor.execute('CREATE TABLE IF NOT EXISTS products (name TEXT, price TEXT)')

def close_spider(self, spider):
# çˆ¬è™«å…³é—­æ—¶è°ƒç”¨
self.connection.close()

def process_item(self, item, spider):
# æ¯ä¸ª item éƒ½ä¼šè°ƒç”¨
self.cursor.execute('INSERT INTO products (name, price) VALUES (?, ?)', (item['name'], item['price']))
self.connection.commit()
return item # å¿…é¡»è¿”å› item

</code></pre>
<p>'myproject.pipelines.SQLitePipeline': 300,
}</p>
<pre><code>
* `DEFAULT_REQUEST_HEADERS`: è®¾ç½®é»˜è®¤çš„è¯·æ±‚å¤´ï¼Œå¦‚ `User-Agent`ã€‚

* `DOWNLOAD_DELAY = 1`: è®¾ç½®ä¸‹è½½å»¶è¿Ÿï¼ˆç§’ï¼‰ï¼Œä»¥é¿å…å¯¹æœåŠ¡å™¨é€ æˆå¤ªå¤§å‹åŠ›ã€‚

* `CONCURRENT_REQUESTS = 16`: å¹¶å‘è¯·æ±‚æ•°ã€‚

* `ITEM_PIPELINES`: æ¿€æ´»å’Œè®¾ç½® Item Pipeline çš„ä¼˜å…ˆçº§ã€‚

* `DOWNLOADER_MIDDLEWARES`: æ¿€æ´»å’Œè®¾ç½®ä¸‹è½½å™¨ä¸­é—´ä»¶çš„ä¼˜å…ˆçº§ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-30">
                                                <h2>30. R28: Scrapy Redis Distributed</h2>
                                                <h1>R28: åˆ†å¸ƒå¼çˆ¬è™«å®æˆ˜ï¼šScrapy-Redis è¯¦è§£</h1>
<p>Scrapy é»˜è®¤æ˜¯å•æœºæ¶æ„ï¼Œè¯·æ±‚é˜Ÿåˆ—ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯å³å¤±ï¼Œä¸”æ— æ³•å¤šæœºå…±äº«ã€‚<strong>Scrapy-Redis</strong> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç»„ä»¶ï¼Œå®ƒé‡å†™äº† Scrapy çš„è°ƒåº¦å™¨ (Scheduler) å’Œå»é‡ç»„ä»¶ (DupeFilter)ï¼Œå°†è¯·æ±‚é˜Ÿåˆ—å’ŒæŒ‡çº¹é›†åˆå­˜å‚¨åœ¨ Redis ä¸­ï¼Œä»è€Œå®ç°ï¼š</p>
<ol>
<li><strong>åˆ†å¸ƒå¼çˆ¬å–</strong>: å¤šä¸ªçˆ¬è™«èŠ‚ç‚¹å…±äº«åŒä¸€ä¸ª Redis é˜Ÿåˆ—ï¼ŒååŒå·¥ä½œã€‚</li>
<li><strong>æ–­ç‚¹ç»­çˆ¬</strong>: è¯·æ±‚æŒä¹…åŒ–åœ¨ Redis ä¸­ï¼Œçˆ¬è™«æŒ‚æ‰é‡å¯åå¯ç»§ç»­è¿è¡Œã€‚</li>
</ol>
<hr />
<h2>1. æ ¸å¿ƒ architecture åŸç†</h2>
<h2># åŸç”Ÿ Scrapy vs Scrapy-Redis</h2>
<ul>
<li><p><strong>åŸç”Ÿ Scrapy</strong>:</p>
</li>
<li><p><strong>Scheduler</strong>: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python <code>deque</code> æˆ– <code>queue</code>ã€‚</p>
</li>
<li><p><strong>DupeFilter</strong>: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python <code>set</code>ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: æ— æ³•è·¨è¿›ç¨‹/è·¨æœºå™¨å…±äº«ï¼Œå†…å­˜å—é™ã€‚</p>
</li>
<li><p><strong>Scheduler</strong>: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python <code>deque</code> æˆ– <code>queue</code>ã€‚</p>
</li>
<li><p><strong>DupeFilter</strong>: ç»´æŠ¤åœ¨å†…å­˜ä¸­çš„ Python <code>set</code>ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: æ— æ³•è·¨è¿›ç¨‹/è·¨æœºå™¨å…±äº«ï¼Œå†…å­˜å—é™ã€‚</p>
</li>
<li><p><strong>Scrapy-Redis</strong>:</p>
</li>
<li><p><strong>Scheduler</strong>: ä» Redis çš„ <code>List</code> (æˆ– <code>PriorityQueue</code>) ä¸­ <code>POP</code> è¯·æ±‚ï¼Œå‘å…¶ <code>PUSH</code> æ–°è¯·æ±‚ã€‚</p>
</li>
<li><p><strong>DupeFilter</strong>: åˆ©ç”¨ Redis çš„ <code>Set</code> æ•°æ®ç»“æ„å­˜å‚¨ URL æŒ‡çº¹ (SHA1)ï¼Œåˆ©ç”¨ Redis çš„åŸå­æ€§è¿›è¡Œå»é‡ã€‚</p>
</li>
<li><p><strong>Item Pipeline</strong>: å¯é€‰å°†æå–çš„æ•°æ®ç›´æ¥æ¨å…¥ Redisï¼Œç”±ç‹¬ç«‹çš„ Worker æ¶ˆè´¹å­˜å‚¨ã€‚</p>
</li>
<li><p><strong>Scheduler</strong>: ä» Redis çš„ <code>List</code> (æˆ– <code>PriorityQueue</code>) ä¸­ <code>POP</code> è¯·æ±‚ï¼Œå‘å…¶ <code>PUSH</code> æ–°è¯·æ±‚ã€‚</p>
</li>
<li><p><strong>DupeFilter</strong>: åˆ©ç”¨ Redis çš„ <code>Set</code> æ•°æ®ç»“æ„å­˜å‚¨ URL æŒ‡çº¹ (SHA1)ï¼Œåˆ©ç”¨ Redis çš„åŸå­æ€§è¿›è¡Œå»é‡ã€‚</p>
</li>
<li><p><strong>Item Pipeline</strong>: å¯é€‰å°†æå–çš„æ•°æ®ç›´æ¥æ¨å…¥ Redisï¼Œç”±ç‹¬ç«‹çš„ Worker æ¶ˆè´¹å­˜å‚¨ã€‚</p>
</li>
</ul>
<hr />
<h2>2. ç¯å¢ƒæ­å»ºä¸é…ç½®</h2>
<h2># å®‰è£…</h2>
<pre><code class="language-bash">pip install scrapy-redis

</code></pre>
<h1>1. å¯ç”¨ Scrapy-Redis è°ƒåº¦å™¨</h1>
<p>SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;</p>
<h1>2. å¯ç”¨ Scrapy-Redis å»é‡ Filter å™¨</h1>
<p>DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</p>
<h1>3. å…è®¸æš‚åœ (æ–­ç‚¹ç»­çˆ¬ Core)</h1>
<h1>å¦‚æœä¸ºçœŸï¼Œå½“çˆ¬è™«åœæ­¢æ—¶ï¼ŒRedis ä¸­çš„è¯·æ±‚é˜Ÿåˆ—ä¸ä¼šè¢«æ¸…ç©º</h1>
<p>SCHEDULER_PERSIST = True</p>
<h1>4. settingssssss Redis Connect</h1>
<h1>æ–¹å¼ä¸€ï¼šå•ç‹¬ Setting</h1>
<p>REDIS_HOST = '192.168.1.100'
REDIS_PORT = 6379</p>
<h1>REDIS_PARAMS = {'password': 'yourpassword'}</h1>
<h1>æ–¹å¼äºŒï¼šå®Œæˆ åœ°å€</h1>
<h1>REDIS_URL = 'redis://user:pass@hostname:9001'</h1>
<h1>5. é…ç½®è¯·æ±‚é˜Ÿåˆ—æ¨¡å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º PriorityQueueï¼‰</h1>
<h1>SCHEDULER_QUEUE_CLASS = 'scrapy_redis.queue.PriorityQueue' # æœ‰åºé›†åˆï¼Œæ”¯æŒä¼˜å…ˆçº§</h1>
<h1>SCHEDULER_QUEUE_CLASS = 'scrapy_redis.queue.FifoQueue' # å…ˆè¿›å…ˆå‡ºåˆ—è¡¨</h1>
<h1>SCHEDULER_QUEUE_CLASS = 'scrapy_redis.queue.LifoQueue' # åè¿›å…ˆå‡ºåˆ—è¡¨ï¼ˆæ ˆï¼‰</h1>
<h1>6. (å¯é€‰) å°†æ•°æ®å­˜å…¥ Redis Pipeline</h1>
<p>ITEM_PIPELINES = {
'scrapy_redis.pipelines.RedisPipeline': 300,
}</p>
<pre><code>
```python
from scrapy_redis.spiders import RedisSpider
import scrapy

class MyDistributedSpider(RedisSpider):
name = 'myspider_distributed'

# æ ¸å¿ƒå·®å¼‚ï¼šä¸å†å®šä¹‰ start_urls
# å®šä¹‰ redis_keyï¼Œçˆ¬è™«å¯åŠ¨åä¼šé˜»å¡ç­‰å¾…è¯¥é”®ä¸­å‡ºç°çš„ URL
redis_key = 'myspider:start_urls'

def parse(self, response):
self.logger.info(f&quot;Crawling {response.url}&quot;)

# æå–æ•°æ®é€»è¾‘ä¸æ™®é€š Spider ä¸€è‡´
yield {
'url': response.url,
'title': response.css('title::text').get()
}

# ç”Ÿæˆæ–°è¯·æ±‚
for href in response.css('a::attr(href)').getall():
yield response.follow(href, self.parse)

</code></pre>
<pre><code>
2. å‘ Redis æ¨é€èµ·å§‹ URLï¼š
    ```bash
redis-cli lpush myspider:start_urls http://example.com

</code></pre>
<h2>å¦‚æœä½ éœ€è¦åˆ©ç”¨ <code>Rule</code> å’Œ <code>LinkExtractor</code> è‡ªåŠ¨æŠ“å–å…¨ç«™ï¼Œå¯ä»¥ä½¿ç”¨ <code>RedisCrawlSpider</code>ã€‚</h2>
<h2>4. è¿›é˜¶ä¼˜åŒ–ç­–ç•¥</h2>
<h2># Bloom Filter å»é‡ä¼˜åŒ–</h2>
<p>Scrapy-Redis é»˜è®¤ä½¿ç”¨ Redis <code>Set</code> å­˜å‚¨æ‰€æœ‰æŒ‡çº¹ã€‚å¯¹äºäº¿çº§ URL çš„çˆ¬å–ï¼Œè¿™ä¼šæ¶ˆè€—æ•°å GB å†…å­˜ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é›†æˆ <strong>Bloom Filter</strong>ã€‚</p>
<ul>
<li><strong>å®ç°æ€è·¯</strong>:</li>
</ul>
<ol>
<li>é‡å†™ <code>RFPDupeFilter</code>ã€‚</li>
<li>ä½¿ç”¨ <code>redis-py</code> çš„ <code>bf.add</code> å’Œ <code>bf.exists</code> å‘½ä»¤ (éœ€è¦ RedisBloom æ¨¡å—) æˆ– Python ç«¯çš„ <code>pybloom_live</code> æ˜ å°„åˆ° Redis BitMapã€‚</li>
</ol>
<pre><code class="language-python"># custom_dupefilter.py ç®€æ˜“ç¤ºæ„
from scrapy_redis.dupefilter import RFPDupeFilter

class BloomFilterDupeFilter(RFPDupeFilter):
def request_seen(self, request):
fp = self.request_fingerprint(request)
# Assume self.æœåŠ¡å™¨ Is Redis è¿æ¥ï¼Œä¸”supports s s s s s BF command
# If fingerprintexists atï¼ŒReturn True
if self.server.execute_command('BF.EXISTS', self.key, fp):
return True
# ElseAddæŒ‡çº¹
self.server.execute_command('BF.ADD', self.key, fp)
return False

</code></pre>
<pre><code class="language-python"># When Generate Request Specify priority
yield scrapy.Request(url, priority=100) # é¦–é¡µï¼Œä¼˜å…ˆ
yield scrapy.Request(url, priority=10) # è¯¦æƒ…é¡µï¼Œæ¬¡ä¹‹

</code></pre>
<pre><code class="language-python"># settings.py
# æŒ‡å®šç©ºé—²ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶åˆ™å…³é—­çˆ¬è™«
SCHEDULER_IDLE_BEFORE_CLOSE = 10

</code></pre>
<p>subgraph &quot;Master / Redis Server&quot;
Redis[(Redis Queue &amp; Set)]
end</p>
<p>subgraph &quot;Slave 1&quot;
Spider1[Scrapy Spider 1] --&gt;|Pop Request| Redis
Spider1 --&gt;|Push Request| Redis
Spider1 --&gt;|Dupe Check| Redis
end</p>
<p>subgraph &quot;Slave 2&quot;
Spider2[Scrapy Spider 2] --&gt;|Pop Request| Redis
Spider2 --&gt;|Push Request| Redis
Spider2 --&gt;|Dupe Check| Redis
end</p>
<p>subgraph &quot;Data Storage&quot;
Mongo[(MongoDB)]
end</p>
<p>Spider1 --&gt;|Store Item| Mongo
Spider2 --&gt;|Store Item| Mongo</p>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-31">
                                                <h2>31. R29: Docker Deployment</h2>
                                                <h1>R29: å®¹å™¨åŒ–éƒ¨ç½²ï¼šDocker ä¸ Kubernetes å®æˆ˜</h1>
<p>å°†çˆ¬è™«é¡¹ç›®å®¹å™¨åŒ–æ˜¯å®ç°æ ‡å‡†åŒ–éƒ¨ç½²ã€å¼¹æ€§ä¼¸ç¼©å’Œ CI/CD çš„ç¬¬ä¸€æ­¥ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ç¼–å†™ Dockerfileï¼Œä½¿ç”¨ Docker Compose ç¼–æ’æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•åœ¨ Kubernetes (K8s) ä¸Šè¿è¡Œçˆ¬è™«ä»»åŠ¡ã€‚</p>
<h2>1. Dockerfile æœ€ä½³å®è·µ</h2>
<p>æˆ‘ä»¬éœ€è¦ä¸º Scrapy é¡¹ç›®æ„å»ºä¸€ä¸ªè½»é‡ã€ç¨³å®šçš„ Docker é•œåƒã€‚</p>
<h3>ç›®å½•ç»“æ„</h3>
<pre><code class="language-text">my_crawler/
â”œâ”€â”€ scrapy.cfg
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â””â”€â”€ myproject/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ items.py
â”œâ”€â”€ settings.py
â””â”€â”€ spiders/

</code></pre>
<p>FROM python:3.9-slim-buster</p>
<h1>è®¾ç½®å·¥ä½œç›®å½•</h1>
<p>WORKDIR /app</p>
<h1>è®¾ç½®ç¯å¢ƒå˜é‡</h1>
<h1>é˜²æ­¢ Python ç”Ÿæˆ .pyc æ–‡ä»¶</h1>
<p>ENV PYTHONDONTWRITEBYTECODE 1</p>
<h1>é˜²æ­¢ Python ç¼“å†²åŒº stdout/stderrï¼Œç¡®ä¿æ—¥å¿—å®æ—¶è¾“å‡º</h1>
<p>ENV PYTHONUNBUFFERED 1</p>
<h1>è®¾ç½®æ—¶åŒº (å¯é€‰)</h1>
<p>ENV TZ=Asia/Shanghai</p>
<h1>å®‰è£…ç³»ç»Ÿä¾èµ– (å¦‚æœéœ€è¦ç¼–è¯‘ lxml æˆ–å…¶å®ƒåº“)</h1>
<h1>RUN apt-get update &amp;&amp; apt-get install -y gcc libxml2-dev libxslt-dev &amp;&amp; rm -rf /var/lib/apt/lists/*</h1>
<h1>å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…</h1>
<p>COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt</p>
<h1>å¤åˆ¶é¡¹ç›®ä»£ç </h1>
<p>COPY . .</p>
<h1>é»˜è®¤å¯åŠ¨å‘½ä»¤ (å¯è¢« docker run è¦†ç›–)</h1>
<h1>è¿™é‡Œæˆ‘ä»¬é»˜è®¤å¯åŠ¨ scrapyd (å¦‚æœä½¿ç”¨ scrapyd éƒ¨ç½²) æˆ–ä»…ä½œä¸ºä¸€ä¸ª shell</h1>
<p>CMD [&quot;scrapy&quot;, &quot;list&quot;]</p>
<pre><code>
# è¿è¡Œçˆ¬è™«
docker run --rm my-crawler:v1 scrapy crawl myspider

</code></pre>
<p>version: '3.8'</p>
<p>services:</p>
<h1>1. Redis æœåŠ¡ (æ¶ˆæ¯é˜Ÿåˆ—)</h1>
<p>redis:
image: redis:6.2-alpine
ports:</p>
<ul>
<li>&quot;6379:6379&quot;
volumes:</li>
<li>redis_data:/data
command: redis-server --appendonly yes</li>
</ul>
<h1>2. MongoDB æœåŠ¡ (æ•°æ®å­˜å‚¨)</h1>
<p>mongo:
image: mongo:5.0
ports:</p>
<ul>
<li>&quot;27017:27017&quot;
environment:
MONGO_INITDB_ROOT_USERNAME: admin
MONGO_INITDB_ROOT_PASSWORD: password
volumes:</li>
<li>mongo_data:/data/db</li>
</ul>
<h1>3. çˆ¬è™«æœåŠ¡ (Master/Slave æ¨¡å¼ä¸­çš„ Slave)</h1>
<p>crawler:
build: .
image: my-crawler:latest</p>
<h1>è¦†ç›–é»˜è®¤å‘½ä»¤ï¼Œå¯åŠ¨çˆ¬è™«</h1>
<p>command: scrapy crawl myspider_distributed</p>
<h1>ä¾èµ–æœåŠ¡å°±ç»ª</h1>
<p>depends_on:</p>
<ul>
<li>redis</li>
<li>mongo
environment:</li>
<li>REDIS_HOST=redis</li>
<li>MONGO_URI=mongodb://admin:password@mongo:27017</li>
</ul>
<h1>æƒ³è¦å¼€å¯å¤šä¸ªçˆ¬è™«èŠ‚ç‚¹ï¼Ÿç›´æ¥ scale</h1>
<p>deploy:
replicas: 3</p>
<p>volumes:
redis_data:
mongo_data:</p>
<pre><code>
# æ‰©å®¹çˆ¬è™«èŠ‚ç‚¹åˆ° 5
docker-compose up -d --scale crawler=5

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f crawler

</code></pre>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
name: scrapy-worker
labels:
app: scrapy-worker
spec:
# å‰¯æœ¬æ•°ï¼Œå³å¹¶å‘çˆ¬è™«èŠ‚ç‚¹æ•°é‡
replicas: 5
selector:
matchLabels:
app: scrapy-worker
template:
metadata:
labels:
app: scrapy-worker
spec:
containers:
- name: crawler
image: registry.example.com/my-crawler:v1
# å®¹å™¨startupCommand
command: [&quot;scrapy&quot;, &quot;crawl&quot;, &quot;myspider_distributed&quot;]
# Env VarsConfig
env:
- name: REDIS_HOST
value: &quot;redis-service&quot; # K8s Service Name
- name: MONGO_URI
valueFrom:
secretKeyRef:
name: db-secrets
key: mongo-uri
resources:
requests:
memory: &quot;256Mi&quot;
cpu: &quot;250m&quot;
limits:
memory: &quot;512Mi&quot;
cpu: &quot;500m&quot;

</code></pre>
<pre><code class="language-yaml">apiVersion: batch/v1
kind: CronJob
metadata:
name: daily-crawler
spec:
# Run daily
schedule: &quot;0 2 * * *&quot;
jobTemplate:
spec:
template:
spec:
containers:
- name: crawler
image: registry.example.com/my-crawler:v1
command: [&quot;scrapy&quot;, &quot;crawl&quot;, &quot;daily_spider&quot;]
env:
- name: REDIS_HOST
value: &quot;redis-service&quot;
restartPolicy: OnFailure

</code></pre>
<h1>AppConfig</h1>
<p>kubectl apply -f crawler-deployment.yaml</p>
<h1>View Pod Status</h1>
<p>kubectl get pods</p>
<h1>åŠ¨æ€æ‰©ç¼©å®¹ (No éœ€ Modify yaml)</h1>
<p>kubectl scale deployment scrapy-worker --replicas=10</p>
<pre><code>* **Gerapy**: åŸºäº Scrapyd çš„åˆ†å¸ƒå¼ç®¡ç† GUIï¼Œæ”¯æŒèŠ‚ç‚¹ç®¡ç†ã€ä»£ç ç¼–è¾‘ã€å®šæ—¶ä»»åŠ¡ã€‚


**Dockerfile (é›†æˆ Scrapyd)**:

```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install scrapyd
COPY scrapyd.conf /etc/scrapyd/
CMD [&quot;scrapyd&quot;]

</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-32">
                                                <h2>32. R30: Virtualization & Containers</h2>
                                                <h1>R30: å·¥ç¨‹åŒ–ï¼šè™šæ‹ŸåŒ–ä¸å®¹å™¨æŠ€æœ¯</h1>
<p>ç§»åŠ¨ç«¯è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯åœ¨æœåŠ¡å™¨ç«¯æ¨¡æ‹Ÿå‡ºæˆç™¾ä¸Šåƒä¸ª Android è®¾å¤‡ç¯å¢ƒçš„èƒ½åŠ›ï¼Œå®ƒæ˜¯æ‰€æœ‰å¤§è§„æ¨¡è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ•°æ®é‡‡é›†å’Œå®‰å…¨åˆ†æä»»åŠ¡çš„åŸºçŸ³ã€‚è¿™é¡¹æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºå¹³è¡¡æ€§èƒ½ã€éš”ç¦»æ€§å’ŒçœŸå®æ€§ã€‚</p>
<hr />
<h2>1. Android æ¨¡æ‹Ÿå™¨ (Emulators)</h2>
<p>Android æ¨¡æ‹Ÿå™¨æ˜¯åœ¨é ARM æ¶æ„ï¼ˆé€šå¸¸æ˜¯ x86_64ï¼‰çš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è½¯ä»¶æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ Android æ“ä½œç³»ç»Ÿç¯å¢ƒçš„ç¨‹åºã€‚</p>
<h3>a) ä¸»æµæ–¹æ¡ˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
  <th>æ–¹æ¡ˆ</th>
  <th>ç±»å‹</th>
  <th>ä¼˜ç‚¹</th>
  <th>ç¼ºç‚¹</th>
  <th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Android SDK Emulator</strong></td>
  <td>å…¨ç³»ç»Ÿæ¨¡æ‹Ÿ (QEMU)</td>
  <td>åŠŸèƒ½æœ€å…¨ï¼ŒGoogle å®˜æ–¹æ”¯æŒï¼Œèƒ½æ¨¡æ‹Ÿæœ€æ–°çš„ Android API å’Œ Google æœåŠ¡ã€‚</td>
  <td>æ€§èƒ½å¼€é”€æå¤§ï¼Œèµ„æºå ç”¨é«˜ï¼Œå¯åŠ¨æ…¢ã€‚</td>
  <td>åº”ç”¨å¼€å‘ä¸è°ƒè¯•ï¼Œå°è§„æ¨¡æµ‹è¯•ã€‚</td>
</tr>
<tr>
  <td><strong>Anbox / Waydroid</strong></td>
  <td>åŸºäºå†…æ ¸çš„å®¹å™¨</td>
  <td>æ€§èƒ½æé«˜ï¼Œæ¥è¿‘åŸç”Ÿï¼Œèµ„æºå ç”¨å°ã€‚</td>
  <td>éš”ç¦»æ€§è¾ƒå·®ï¼Œä¾èµ–å®¿ä¸»æœºå†…æ ¸ï¼Œå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚</td>
  <td>å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„æ¸¸æˆæµ‹è¯•ï¼Œäº‘æ¸¸æˆã€‚</td>
</tr>
<tr>
  <td><strong>Redroid / anbox-cloud</strong></td>
  <td>åŸºäº Docker çš„å®¹å™¨åŒ–æ¨¡æ‹Ÿå™¨</td>
  <td>éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†æä¸ºæ–¹ä¾¿ï¼Œæ˜“äºé›†æˆåˆ° CI/CD æµæ°´çº¿ã€‚</td>
  <td>é…ç½®ç›¸å¯¹å¤æ‚ï¼Œå¯¹ Docker å’Œç½‘ç»œçŸ¥è¯†æœ‰ä¸€å®šè¦æ±‚ã€‚</td>
  <td>å¤§è§„æ¨¡ã€åŠ¨æ€ä¼¸ç¼©çš„äº‘æ‰‹æœºå¹³å°ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•é›†ç¾¤ã€‚</td>
</tr>
<tr>
  <td><strong>Genymotion</strong></td>
  <td>å•†ä¸šè™šæ‹ŸåŒ–æ–¹æ¡ˆ</td>
  <td>æ€§èƒ½å¥½ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ˆGPS, æ‘„åƒå¤´æ¨¡æ‹Ÿï¼‰ï¼Œæä¾› PaaS/SaaS æœåŠ¡ã€‚</td>
  <td>æ”¶è´¹ï¼Œé—­æºã€‚</td>
  <td>ä¼ä¸šçº§æµ‹è¯•ï¼Œéœ€è¦ä¸“ä¸šæŠ€æœ¯æ”¯æŒçš„åœºæ™¯ã€‚</td>
</tr>
</tbody>
</table>
<h3>b) å…³é”®æŠ€æœ¯ç‚¹</h3>
<ul>
<li><p><strong>æŒ‡ä»¤é›†ç¿»è¯‘</strong>: åœ¨ x86 æœåŠ¡å™¨ä¸Šè¿è¡Œä¸º ARM æ¶æ„ç¼–è¯‘çš„ Appï¼Œéœ€è¦è¿›è¡ŒåŠ¨æ€çš„æŒ‡ä»¤é›†ç¿»è¯‘ã€‚Intel çš„ <code>libhoudini</code> å’Œ Google çš„ <code>NdkVm</code> æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½çš„å…³é”®ç»„ä»¶ï¼Œå…¶æ•ˆç‡ç›´æ¥å†³å®šäº†æ¨¡æ‹Ÿå™¨çš„æ€§èƒ½ã€‚</p>
</li>
<li><p><strong>GPU ç¡¬ä»¶åŠ é€Ÿ</strong>: ä¸ºäº†æ¸²æŸ“å¤æ‚çš„ UI å’Œæ¸¸æˆï¼Œæ¨¡æ‹Ÿå™¨éœ€è¦å°† Android çš„å›¾å½¢æ¸²æŸ“æŒ‡ä»¤ï¼ˆOpenGL ESï¼‰æ¡¥æ¥åˆ°å®¿ä¸»æœºçš„ GPU ä¸Šã€‚<code>Virgil3D</code> ç­‰é¡¹ç›®å®ç°äº†è¿™ç§é€ä¼ èƒ½åŠ›ã€‚</p>
</li>
<li><p><strong>å¿«ç…§ä¸çŠ¶æ€ç®¡ç†</strong>: é«˜æ•ˆçš„å¿«ç…§åŠŸèƒ½å…è®¸æˆ‘ä»¬å¿«é€Ÿåœ°å°†æ¨¡æ‹Ÿå™¨æ¢å¤åˆ°ä¸€ä¸ªå¹²å‡€ã€é¢„è®¾çš„çŠ¶æ€ï¼Œè¿™å¯¹äºä¿è¯æ¯æ¬¡è‡ªåŠ¨åŒ–æµ‹è¯•éƒ½åœ¨åŒæ ·çš„ç¯å¢ƒä¸­è¿›è¡Œè‡³å…³é‡è¦ã€‚</p>
</li>
</ul>
<hr />
<h2>2. å®¹å™¨æŠ€æœ¯ (Containerization)</h2>
<p>å®¹å™¨æŠ€æœ¯ï¼ˆä»¥ Docker ä¸ºä»£è¡¨ï¼‰è™½ç„¶ä¸ç›´æ¥è¿è¡Œ Android ç³»ç»Ÿï¼Œä½†å®ƒåœ¨æ•´ä¸ªå·¥ç¨‹åŒ–ä½“ç³»ä¸­æ‰®æ¼”ç€&quot;èƒ¶æ°´&quot;å’Œ&quot;æ ‡å‡†äº¤ä»˜&quot;çš„å…³é”®è§’è‰²ã€‚</p>
<h3>a) éš”ç¦»ä¸æ‰“åŒ…ä¾èµ–é¡¹</h3>
<p>åœ¨å¤æ‚çš„è‡ªåŠ¨åŒ–æµç¨‹ä¸­ï¼Œé™¤äº† Android æ¨¡æ‹Ÿå™¨æœ¬èº«ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤§é‡çš„å‘¨è¾¹æœåŠ¡ã€‚</p>
<ul>
<li><p><strong>ä»»åŠ¡é˜Ÿåˆ—</strong>: ä½¿ç”¨ <code>redis</code> æˆ– <code>rabbitmq</code> å®¹å™¨æ¥ç®¡ç†å’Œåˆ†å‘æˆåƒä¸Šä¸‡çš„æµ‹è¯•ä»»åŠ¡ã€‚</p>
</li>
<li><p><strong>ä»£ç†æœåŠ¡</strong>: éƒ¨ç½² <code>mitmproxy</code> æˆ– <code>squid</code> å®¹å™¨æ¥é›†ä¸­æ‹¦æˆªå’Œåˆ†ææ‰€æœ‰æ¨¡æ‹Ÿå™¨çš„ç½‘ç»œæµé‡ã€‚</p>
</li>
<li><p><strong>æ•°æ®åº“</strong>: ä½¿ç”¨ <code>mongodb</code> æˆ– <code>postgresql</code> å®¹å™¨æ¥æŒä¹…åŒ–å­˜å‚¨æµ‹è¯•ç»“æœã€App å…ƒæ•°æ®å’Œè®¾å¤‡çŠ¶æ€ã€‚</p>
</li>
<li><p><strong>æ–‡ä»¶å­˜å‚¨</strong>: ä½¿ç”¨ <code>minio</code> å®¹å™¨æ¥æä¾›ä¸€ä¸ª S3 å…¼å®¹çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œç”¨äºå­˜æ”¾ APK æ–‡ä»¶ã€æµ‹è¯•æŠ¥å‘Šå’Œæˆªå›¾ã€‚</p>
</li>
</ul>
<p>å°†è¿™äº›æœåŠ¡å…¨éƒ¨å®¹å™¨åŒ–ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ä¸€é”®æ‹‰èµ·æ•´å¥—åç«¯åŸºç¡€è®¾æ–½ï¼Œæå¤§åœ°ç®€åŒ–äº†éƒ¨ç½²å’Œè¿ç»´ã€‚</p>
<h3>b) æ„å»ºæ ‡å‡†åŒ–çš„æ‰§è¡Œç¯å¢ƒ</h3>
<p>æˆ‘ä»¬å¯ä»¥å°† Appiumã€UIAutomator2 è„šæœ¬ã€Frida è„šæœ¬ä»¥åŠæ‰€æœ‰ Python ä¾èµ–æ‰“åŒ…åˆ°ä¸€ä¸ª Docker é•œåƒä¸­ã€‚</p>
<ul>
<li><p><strong>ä¸€è‡´æ€§</strong>: ç¡®ä¿æ— è®ºæ˜¯åœ¨å¼€å‘è€…çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œè¿˜æ˜¯åœ¨ CI/CD æœåŠ¡å™¨ä¸Šï¼Œè„šæœ¬çš„è¿è¡Œç¯å¢ƒéƒ½å®Œå…¨ä¸€è‡´ï¼Œé¿å…äº†&quot;åœ¨æˆ‘è¿™é‡Œèƒ½è·‘&quot;çš„é—®é¢˜ã€‚</p>
</li>
<li><p><strong>ç‰ˆæœ¬æ§åˆ¶</strong>: å¯ä»¥ä¸ºæ¯ä¸ªç‰ˆæœ¬çš„ App é…å¥—ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„æµ‹è¯•é•œåƒï¼Œæ–¹ä¾¿åœ°å¯¹å†å²ç‰ˆæœ¬è¿›è¡Œå›å½’æµ‹è¯•ã€‚</p>
</li>
<li><p><strong>å¯ç§»æ¤æ€§</strong>: æ•´ä¸ªæµ‹è¯•å¥—ä»¶å¯ä»¥ä½œä¸ºä¸€ä¸ª Docker é•œåƒè½»æ¾åœ°è¿ç§»åˆ°ä¸åŒçš„äº‘å¹³å°æˆ–ç‰©ç†æœåŠ¡å™¨ä¸Šã€‚</p>
</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>è™šæ‹ŸåŒ–å’Œå®¹å™¨åŒ–æ˜¯ä»&quot;æ‰‹å·¥ä½œåŠ&quot;è¿ˆå‘&quot;å·¥ä¸šåŒ–ç”Ÿäº§&quot;çš„ç¬¬ä¸€æ­¥ã€‚</p>
<ul>
<li><p><strong>è™šæ‹ŸåŒ–</strong> è§£å†³äº†&quot;è®¾å¤‡ä»å“ªé‡Œæ¥&quot;çš„é—®é¢˜ï¼Œæä¾›äº†å¯å¤§è§„æ¨¡å¤åˆ¶çš„ã€éš”ç¦»çš„ Android è¿è¡Œç¯å¢ƒã€‚</p>
</li>
<li><p><strong>å®¹å™¨åŒ–</strong> è§£å†³äº†&quot;ä¾èµ–å’Œè„šæœ¬å¦‚ä½•ç®¡ç†&quot;çš„é—®é¢˜ï¼Œæä¾›äº†æ ‡å‡†åŒ–çš„ã€å¯ç§»æ¤çš„äº¤ä»˜ç‰©ã€‚</p>
</li>
</ul>
<p>äºŒè€…ç»“åˆï¼Œä¸ºä¸Šå±‚çš„è‡ªåŠ¨åŒ–å’Œç¾¤æ§ç³»ç»Ÿæä¾›äº†åšå®ã€å¯é ã€å¯æ‰©å±•çš„åŸºç¡€è®¾æ–½ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-33">
                                                <h2>33. R31: Web Anti Scraping</h2>
                                                <h1>R31: Web åçˆ¬è™«æŠ€æœ¯</h1>
<p>ç½‘ç»œçˆ¬è™«æ˜¯è‡ªåŠ¨ä»ç½‘ç«™æå–æ•°æ®çš„è¿‡ç¨‹ã€‚ç”±äºè¿™å¯èƒ½è¢«æ»¥ç”¨ï¼Œè®¸å¤šç°ä»£ç½‘ç«™å’ŒæœåŠ¡å®æ–½äº†å¤æ‚çš„åçˆ¬è™«ï¼ˆæˆ–&quot;åæœºå™¨äºº&quot;ï¼‰æŠ€æœ¯æ¥ä¿æŠ¤å…¶æ•°æ®ã€‚è¿™äº›æŠ€æœ¯å¯å¤§è‡´åˆ†ä¸ºå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ç«¯é˜²å¾¡ã€‚</p>
<hr />
<h2>1. å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æŒ‘æˆ˜</h2>
<p>è¿™äº›é˜²å¾¡æªæ–½çš„é‡ç‚¹æ˜¯ç¡®ä¿å®¢æˆ·ç«¯æ˜¯ç”±äººç±»æ“ä½œçš„çœŸå®ã€æ ‡å‡†çš„ç½‘ç»œæµè§ˆå™¨ã€‚</p>
<ul>
<li><p><strong>JavaScript (JS) æŒ‘æˆ˜</strong>: æœåŠ¡å™¨å‘é€ä¸€æ®µå¤æ‚çš„ JavaScriptï¼Œå®¢æˆ·ç«¯å¿…é¡»æ­£ç¡®æ‰§è¡Œã€‚è¯¥è„šæœ¬å¯èƒ½æ‰§è¡Œè®¡ç®—ã€ä¸æµè§ˆå™¨ API äº¤äº’ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¿…é¡»åœ¨åç»­è¯·æ±‚ä¸­å‘å›çš„ä»¤ç‰Œã€‚éœ€è¦ä½¿ç”¨åƒ Puppeteer æˆ– Selenium è¿™æ ·çš„æ— å¤´æµè§ˆå™¨æ¥é€šè¿‡è¿™äº›æŒ‘æˆ˜ã€‚</p>
<ul>
<li><strong>ä¾‹å­</strong>: Akamai Bot Manager, Cloudflare Bot Managementã€‚</li>
</ul>
</li>
<li><p><strong>æµè§ˆå™¨æŒ‡çº¹</strong>: æœåŠ¡å™¨æ”¶é›†å®¢æˆ·ç«¯æµè§ˆå™¨ç¯å¢ƒçš„è¯¦ç»†ç”»åƒã€‚è¿™åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>User-Agent</code>ã€å±å¹•åˆ†è¾¨ç‡ã€é¢œè‰²æ·±åº¦ã€æ—¶åŒºã€‚</li>
<li>å®‰è£…çš„å­—ä½“ã€æµè§ˆå™¨æ’ä»¶ã€‚</li>
<li>æµè§ˆå™¨ JS å¼•æ“æˆ–æ¸²æŸ“å¼•æ“ï¼ˆCanvasï¼‰è¡Œä¸ºçš„ç»†å¾®å·®å¼‚ã€‚</li>
</ul>
</li>
<li><p><strong>TLS æŒ‡çº¹</strong>: åˆ†æå®¢æˆ·ç«¯ TLS æ¡æ‰‹çš„å‚æ•°ï¼ˆå¯†ç å¥—ä»¶ã€æ‰©å±•ç­‰ï¼‰ã€‚</p>
<ul>
<li>ä¸æ ‡å‡†æµè§ˆå™¨ç”»åƒï¼ˆä¾‹å¦‚ï¼ŒWindows ä¸Šçš„ Chromeï¼‰çš„åå·®å¯ç”¨äºå°†å®¢æˆ·ç«¯æ ‡è®°ä¸ºæœºå™¨äººã€‚</li>
</ul>
</li>
<li><p><strong>CAPTCHA</strong>: &quot;å…¨è‡ªåŠ¨åŒºåˆ†è®¡ç®—æœºå’Œäººç±»çš„å…¬å¼€å›¾çµæµ‹è¯•&quot;ã€‚è¿™éœ€è¦ç”¨æˆ·è§£å†³ä¸€ä¸ªå¯¹æœºå™¨äººæ¥è¯´å¾ˆå›°éš¾çš„æŒ‘æˆ˜ï¼ˆä¾‹å¦‚ï¼Œåœ¨å›¾åƒä¸­è¯†åˆ«ç‰©ä½“ï¼‰ã€‚</p>
<ul>
<li><strong>ä¾‹å­</strong>: è°·æ­Œçš„ reCAPTCHA (v2/v3), hCaptchaã€‚ç»•è¿‡è¿™äº›é€šå¸¸éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹ç ´è§£æœåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<h2>2. æœåŠ¡å™¨ç«¯æ£€æµ‹</h2>
<p>è¿™äº›é˜²å¾¡æªæ–½é€šè¿‡åˆ†ææœåŠ¡å™¨ä¸Šçš„è¯·æ±‚æ¨¡å¼æ¥è¯†åˆ«éäººç±»è¡Œä¸ºã€‚</p>
<ul>
<li><p><strong>IP åœ°å€ä¿¡èª‰</strong>: é˜»æ­¢æˆ–é€Ÿç‡é™åˆ¶æ¥è‡ªå·²çŸ¥å±äºæ•°æ®ä¸­å¿ƒï¼ˆå¦‚ AWSã€è°·æ­Œäº‘ï¼‰æˆ–ä»£ç†/VPN æœåŠ¡çš„ IP åœ°å€çš„è¯·æ±‚ã€‚é€šå¸¸ä½¿ç”¨ä½å®…ä»£ç†æ¥è§„é¿æ­¤é—®é¢˜ã€‚</p>
</li>
<li><p><strong>é€Ÿç‡é™åˆ¶</strong>: é™åˆ¶å•ä¸ª IP åœ°å€æˆ–ç”¨æˆ·å¸æˆ·åœ¨ç»™å®šæ—¶é—´æ®µå†…å¯ä»¥å‘å‡ºçš„è¯·æ±‚æ•°é‡ã€‚çˆ¬è™«å¿…é¡»éµå®ˆè¿™äº›é™åˆ¶ä»¥é¿å…è¢«é˜»æ­¢ã€‚</p>
</li>
<li><p><strong>è¡Œä¸ºåˆ†æ</strong>: è¿™æ˜¯æœ€å…ˆè¿›çš„æŠ€æœ¯ã€‚æœåŠ¡å™¨ä¼šé•¿æœŸè·Ÿè¸ªç”¨æˆ·è¡Œä¸ºï¼Œä»¥å»ºç«‹&quot;æ­£å¸¸&quot;äººç±»äº¤äº’çš„æ¨¡å‹ã€‚</p>
<ul>
<li><strong>é¼ æ ‡ç§»åŠ¨å’ŒæŒ‰é”®</strong>: çœŸå®ç”¨æˆ·æœ‰æ··ä¹±ã€éçº¿æ€§çš„é¼ æ ‡ç§»åŠ¨å’Œæ‰“å­—æ¨¡å¼ã€‚æœºå™¨äººé€šå¸¸ç¼ºä¹è¿™ä¸€ç‚¹ã€‚é«˜çº§æœºå™¨äººå¿…é¡»æ¨¡æ‹Ÿè¿™ç§&quot;äººç±»&quot;è¾“å…¥ã€‚</li>
<li><strong>å¯¼èˆªæ¨¡å¼</strong>: äººç±»é€šè¿‡ç½‘ç«™çš„è·¯å¾„æ˜¯å¯é¢„æµ‹ä½†éå®Œå…¨çº¿æ€§çš„ã€‚æœºå™¨äººé€šå¸¸ç›´æ¥æˆ–ä»¥åƒµç¡¬çš„é¡ºåºè®¿é—®é¡µé¢ã€‚</li>
<li><strong>è¯·æ±‚æ—¶é—´</strong>: æ¥è‡ªäººç±»ç”¨æˆ·çš„è¯·æ±‚ä¹‹é—´çš„æ—¶é—´æ˜¯å¯å˜çš„ã€‚æœºå™¨äººé€šå¸¸ä»¥å›ºå®šçš„ã€æœ€å°çš„å»¶è¿Ÿè¿è¡Œã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>è§„é¿ç­–ç•¥</h2>
<ul>
<li><p><strong>ä½¿ç”¨åŠŸèƒ½é½å…¨çš„æµè§ˆå™¨</strong>: ä½¿ç”¨ <strong>Selenium</strong>ã€<strong>Puppeteer</strong> æˆ– <strong>Playwright</strong> ç­‰å·¥å…·æ¥è‡ªåŠ¨åŒ–ä¸€ä¸ªçœŸå®çš„æµè§ˆå™¨ã€‚è¿™æœ‰åŠ©äºè§£å†³ JS æŒ‘æˆ˜å¹¶æä¾›æ›´å…·è¯´æœåŠ›çš„æµè§ˆå™¨æŒ‡çº¹ã€‚ä½¿ç”¨&quot;stealth&quot;æ’ä»¶è¿›ä¸€æ­¥éšè—è‡ªåŠ¨åŒ–ã€‚</p>
</li>
<li><p><strong>è½®æ¢ IP</strong>: ä½¿ç”¨é«˜è´¨é‡çš„<strong>ä½å®…æˆ–ç§»åŠ¨ä»£ç†</strong>æ± æ¥é¿å…åŸºäº IP çš„å°é”å¹¶æ¨¡ä»¿çœŸå®ç”¨æˆ·ã€‚</p>
</li>
<li><p><strong>æ¨¡ä»¿äººç±»è¡Œä¸º</strong>: å¼•å…¥éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿé€¼çœŸçš„é¼ æ ‡ç§»åŠ¨ï¼Œå¹¶ä»¥æ›´åƒäººç±»çš„æ–¹å¼åœ¨ç½‘ç«™ä¸Šå¯¼èˆªã€‚</p>
</li>
<li><p><strong>é€†å‘å·¥ç¨‹ JS</strong>: å¯¹äºæŸäº› JS æŒ‘æˆ˜ï¼Œå¯ä»¥é€†å‘å·¥ç¨‹æ··æ·†çš„ JavaScript ä»£ç ï¼Œä»¥äº†è§£åæœºå™¨äººä»¤ç‰Œæ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚è¿™ä½¿ä½ å¯ä»¥åœ¨è‡ªå·±çš„è„šæœ¬ä¸­å¤åˆ¶é€»è¾‘ï¼Œè€Œæ— éœ€å®Œæ•´çš„æµè§ˆå™¨ï¼Œè¿™æ ·ä¼šå¿«å¾—å¤šã€‚ç”šè‡³å¯ä»¥ä½¿ç”¨ Frida ç­‰å·¥å…·æ¥é’©ä½æµè§ˆå™¨è¿›ç¨‹ä»¥è¿›è¡Œåˆ†æã€‚</p>
</li>
<li><p><strong>IP è´¨é‡æ£€æµ‹</strong>: æœåŠ¡å™¨ç«¯ä¼šæ£€æŸ¥è¯·æ±‚ IP çš„ç±»å‹ï¼ˆæ•°æ®ä¸­å¿ƒã€ä½å®…ã€ç§»åŠ¨ï¼‰ï¼Œå¹¶å¯¹æ¥è‡ªæ•°æ®ä¸­å¿ƒçš„ IP æ–½åŠ æ›´ä¸¥æ ¼çš„é™åˆ¶ã€‚</p>
</li>
<li><p><strong>è¡Œä¸ºåˆ†æ</strong>: æœåŠ¡å™¨é€šè¿‡åˆ†æç”¨æˆ·åœ¨ä¸€ç³»åˆ—è¯·æ±‚ä¸­çš„è¡Œä¸ºæ¨¡å¼ï¼ˆå¦‚è¯·æ±‚é¢‘ç‡ã€è®¿é—®è·¯å¾„ã€é¼ æ ‡ç§»åŠ¨è½¨è¿¹ï¼‰æ¥åˆ¤æ–­å…¶æ˜¯å¦ä¸ºæœºå™¨äººã€‚</p>
</li>
</ul>
<hr />
<h2>ä¸“é¢˜ï¼šç»•è¿‡ Cloudflare äº”ç§’ç›¾</h2>
<p>Cloudflare çš„&quot;I'm Under Attack Mode&quot;ï¼ˆæˆ‘æ­£é­å—æ”»å‡»æ¨¡å¼ï¼‰æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„å¼ºåŠ›åæœºå™¨äººæªæ–½ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ä¸€ä¸ªæŒç»­çº¦äº”ç§’çš„&quot;Checking your browser before accessing...&quot;é¡µé¢ã€‚è¿™å°±æ˜¯ä¿—ç§°çš„&quot;äº”ç§’ç›¾&quot;ã€‚</p>
<h3>1. å·¥ä½œåŸç†</h3>
<p>äº”ç§’ç›¾çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª <strong>JavaScript æŒ‘æˆ˜ (JS Challenge)</strong>ã€‚å½“ç”¨æˆ·é¦–æ¬¡è®¿é—®å—ä¿æŠ¤çš„é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªåŒ…å«å¤æ‚ã€é«˜åº¦æ··æ·†çš„ JavaScript ä»£ç çš„ HTML é¡µé¢ã€‚è¿™æ®µ JS çš„ä¸»è¦ç›®çš„ä¸æ˜¯ä¸ºäº†å¥½çœ‹ï¼Œè€Œæ˜¯ä¸ºäº†ï¼š</p>
<ol>
<li><strong>ç¯å¢ƒæ£€æµ‹</strong>: æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºä¸€ä¸ªçœŸå®çš„ã€æ ‡å‡†çš„æµè§ˆå™¨ã€‚å®ƒä¼šæ£€æµ‹ <code>window</code>, <code>document</code> ç­‰å¯¹è±¡ï¼Œä»¥åŠå±å¹•åˆ†è¾¨ç‡ã€æ—¶åŒºã€æ’ä»¶ç­‰æµè§ˆå™¨æŒ‡çº¹ä¿¡æ¯ã€‚</li>
<li><strong>è®¡ç®—å¯†é›†å‹ä»»åŠ¡</strong>: æ‰§è¡Œä¸€ç³»åˆ—å¤æ‚çš„æ•°å­¦è¿ç®—ã€‚è¿™äº›è¿ç®—å¯¹äºç°ä»£æµè§ˆå™¨æ¥è¯´è€—æ—¶å¾ˆçŸ­ï¼ˆé€šå¸¸åœ¨ 1-2 ç§’å†…ï¼‰ï¼Œä½†å¯¹äºä¸å…·å¤‡ JS æ‰§è¡Œå¼•æ“çš„ç®€å•çˆ¬è™«ï¼ˆå¦‚çº¯ç²¹çš„ <code>requests</code> åº“ï¼‰æ¥è¯´æ˜¯æ— æ³•å®Œæˆçš„ã€‚</li>
<li><strong>ç”ŸæˆéªŒè¯ Token</strong>: JS è®¡ç®—çš„æœ€ç»ˆç»“æœä¼šä½œä¸ºä¸€ä¸ª Tokenï¼Œé€šè¿‡è¡¨å•æäº¤æˆ– Ajax è¯·æ±‚å‘é€å› Cloudflare çš„æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚</li>
<li><strong>è®¾ç½®èº«ä»½ Cookie</strong>: éªŒè¯é€šè¿‡åï¼ŒCloudflare ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„ Cookieï¼ˆå¦‚ <code>__cf_bm</code> æˆ– <code>cf_clearance</code>ï¼‰ï¼Œè¯¥ Cookie åœ¨ä¸€å®šæ—¶é—´å†…æœ‰æ•ˆã€‚åç»­çš„è¯·æ±‚åªè¦æºå¸¦è¿™ä¸ªæœ‰æ•ˆçš„ Cookieï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®ç½‘ç«™ï¼Œæ— éœ€å†æ¬¡æŒ‘æˆ˜ã€‚</li>
</ol>
<h3>2. ç»•è¿‡æ–¹æ¡ˆ</h3>
<p>ç»•è¿‡äº”ç§’ç›¾çš„æ ¸å¿ƒæ€æƒ³æ˜¯ <strong>æ¨¡æ‹Ÿä¸€ä¸ªèƒ½å¤ŸæˆåŠŸæ‰§è¡Œå…¶ JS æŒ‘æˆ˜çš„ç¯å¢ƒ</strong>ã€‚</p>
<h4>a. æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨æ— å¤´æµè§ˆå™¨ (Headless Browser) - æ¨è</h4>
<p>è¿™æ˜¯æœ€ç¨³å®šã€æˆåŠŸç‡æœ€é«˜çš„æ–¹æ¡ˆã€‚ä½¿ç”¨ <code>Puppeteer</code> (Node.js), <code>Playwright</code> (Python/Node.js) æˆ– <code>Selenium</code> ç­‰è‡ªåŠ¨åŒ–æµè§ˆå™¨æ¡†æ¶ã€‚</p>
<ul>
<li><strong>å·¥ä½œæ–¹å¼</strong>: è¿™äº›å·¥å…·ä¼šå¯åŠ¨ä¸€ä¸ªçœŸå®çš„ã€å®Œæ•´çš„æµè§ˆå™¨å†…æ ¸ï¼ˆå¦‚ Chromeï¼‰ï¼Œåªæ˜¯æ²¡æœ‰å›¾å½¢ç•Œé¢ã€‚å½“å®ƒä»¬è®¿é—®ç›®æ ‡é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šåƒæ­£å¸¸ç”¨æˆ·è®¿é—®ä¸€æ ·ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰çš„ JavaScriptï¼Œå®ŒæˆæŒ‘æˆ˜ï¼Œè·å– Cookieï¼Œç„¶åç»§ç»­è®¿é—®ç›®æ ‡é¡µé¢ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>: æˆåŠŸç‡æé«˜ï¼Œå‡ ä¹èƒ½åº”å¯¹æ‰€æœ‰åŸºäº JS æŒ‘æˆ˜çš„é˜²æŠ¤ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>: èµ„æºæ¶ˆè€—å¤§ï¼ˆéœ€è¦å¯åŠ¨æ•´ä¸ªæµè§ˆå™¨ï¼‰ï¼Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚</li>
</ul>
<p><strong>Playwright (Python) ç¤ºä¾‹ï¼š</strong></p>

                                            </div>
                                            
                                            <div class="section" id="section-34">
                                                <h2>34. R32: Frida Script Examples</h2>
                                                <h1>R32: Frida å®æˆ˜è„šæœ¬é›†</h1>
<p>æœ¬æ–‡æ¡£æ”¶é›†äº†é€‚ç”¨äºå„ç§å¸¸è§åœºæ™¯çš„ Frida è„šæœ¬ã€‚è¿™äº›è„šæœ¬æ—¨åœ¨ä½œä¸ºå³ç”¨å‹æ¨¡æ¿ï¼Œæ‚¨å¯ä»¥æ ¹æ®ç‰¹å®šç›®æ ‡è¿›è¡Œä¿®æ”¹ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">ä¿¡æ¯æ”¶é›† (Information Gathering)</a></li>
<li><a href="#hook-%E4%B8%8E%E4%BF%AE%E6%94%B9">Hook ä¸ä¿®æ”¹ (Hooking &amp; Modification)</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E7%9B%91%E6%8E%A7%E4%B8%8E%E7%BB%95%E8%BF%87">ç½‘ç»œç›‘æ§ä¸ç»•è¿‡ (Networking)</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E4%B8%8E%E8%84%B1%E5%A3%B3">æ•°æ®æŒä¹…åŒ–ä¸è„±å£³ (Storage &amp; Dumping)</a></li>
<li><a href="#%E5%8F%8D%E8%B0%83%E8%AF%95%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B%E7%BB%95%E8%BF%87">åè°ƒè¯•ä¸ç¯å¢ƒæ£€æµ‹ç»•è¿‡ (Anti-Analysis)</a></li>
<li><a href="#ui-%E4%B8%8E%E4%BA%8B%E4%BB%B6">UI ä¸äº‹ä»¶ (UI &amp; Events)</a></li>
</ol>
<hr />
<h3>ä¿¡æ¯æ”¶é›†</h3>
<h4>1. æšä¸¾æŒ‡å®šç±»çš„æ‰€æœ‰æ–¹æ³•</h4>
<pre><code class="language-javascript">// Usage: frida -U -f com.example.app -l list_methods.js
// Replace 'com.example.target class' below
Java.perform(function () {
  var targetClass = &quot;com.example.TargetClass&quot;;
  var wrapper = Java.use(targetClass);
  var ownMethods = wrapper.class.getDeclaredMethods();

  console.log(&quot;Methods of class &quot; + targetClass + &quot;:&quot;);
  ownMethods.forEach(function (method) {
    console.log(method.toString());
  });
});
</code></pre>
<p>console.log(&quot;Listing all loaded classes...&quot;);
Java.enumerateLoadedClasses({
onMatch: function(className) {
console.log(className);
},
onComplete: function() {
console.log(&quot;Class enumeration complete.&quot;);
}
});
});</p>
<pre><code>Java.perform(function() {
var TargetClass = Java.use('com.example.app.CryptoUtils');
var methodName = 'encrypt'; // Method name to trace

// Handle method overloads
TargetClass[methodName].overloads.forEach(function(overload) {
overload.implementation = function() {
console.log('\n[+] Called ' + TargetClass.$className + '.' + methodName);

// Print arguments
for (var i = 0; i &lt; arguments.length; i++) {
console.log(' - Argument ' + i + ': ' + arguments[i]);
}

// Call original method
var retval = this[methodName].apply(this, arguments);

// Print return value
console.log(' - Return value: ' + retval);

return retval;
};
});
});

</code></pre>
<p>Java.perform(function() {
var PremiumUtils = Java.use('com.example.app.PremiumUtils');</p>
<p>PremiumUtils.isUserPremium.implementation = function() {
console.log('[+] Bypassing Premium check...');
return true; // Return true directly
};
});</p>
<pre><code>
Java.choose('com.example.app.UserInfo', {
onMatch: function(instance) {
console.log('[+] Found UserInfo instance.');
// Directly modify field value
instance.userLevel.value = 99;
console.log(' - Patched userLevel to 99.');
},
onComplete: function() {}
});
});

</code></pre>
<pre><code class="language-javascript">// Usage: frida -U --no-pause -f com.example.app -l universal_ssl_unpinning.js
// Source: https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/
setTimeout(function () {
  Java.perform(function () {
    console.log(&quot;&quot;);
    console.log(&quot;[.] Android SSL Pinning Bypass&quot;);

    var CertificateFactory = Java.use(&quot;java.security.cert.CertificateFactory&quot;);
    var FileInputStream = Java.use(&quot;java.io.FileInputStream&quot;);
    var BufferedInputStream = Java.use(&quot;java.io.BufferedInputStream&quot;);
    var X509Certificate = Java.use(&quot;java.security.cert.X509Certificate&quot;);
    var KeyStore = Java.use(&quot;java.security.KeyStore&quot;);
    var TrustManagerFactory = Java.use(&quot;javax.net.ssl.TrustManagerFactory&quot;);
    var SSLContext = Java.use(&quot;javax.net.ssl.SSLContext&quot;);

    // TrustManagerImpl (android &gt; 7)
    try {
      var TrustManagerImpl = Java.use(
        &quot;com.android.org.conscrypt.TrustManagerImpl&quot;
      );
      TrustManagerImpl.verifyChain.implementation = function (
        untrustedChain,
        trustAnchorChain,
        host,
        clientAuth,
        ocspData,
        tlsSctData
      ) {
        console.log(
          &quot;[+] Bypassing TrustManagerImpl verifyChain() for host: &quot; + host
        );
        return untrustedChain;
      };
    } catch (e) {
      console.log(&quot;[-] TrustManagerImpl not found. Skipping.&quot;);
    }

    // OkHttp3
    try {
      var OkHttpClient = Java.use(&quot;okhttp3.OkHttpClient&quot;);
      OkHttpClient.Builder.prototype.build.implementation = function () {
        var builder = this.build.call(this);
        console.log(&quot;[+] OkHttp3 CertificatePinner removed.&quot;);
        builder.certificatePinner.value = null;
        return builder;
      };
    } catch (e) {
      console.log(&quot;[-] OkHttp3 not found. Skipping.&quot;);
    }

    // TrustManager (universal)
    var TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);
    var checkServerTrusted = TrustManager.checkServerTrusted;
    checkServerTrusted.overload(
      &quot;java.security.cert.X509Certificate[]&quot;,
      &quot;java.lang.String&quot;
    ).implementation = function (chain, authType) {
      console.log(
        &quot;[+] Bypassing TrustManager checkServerTrusted for authType: &quot; +
          authType
      );
      return;
    };
  });
}, 0);
</code></pre>
<p>Java.perform(function() {
var sharedPrefsEditor = Java.use('android.app.SharedPreferencesImpl$EditorImpl');</p>
<p>sharedPrefsEditor.putString.implementation = function(key, value) {
console.log('[SP Write] key: ' + key + ', value: ' + value);
return this.putString(key, value);
};</p>
<p>var sharedPrefs = Java.use('android.app.SharedPreferencesImpl');
sharedPrefs.getString.implementation = function(key, defValue) {
var value = this.getString(key, defValue);
console.log('[SP Read] key: ' + key + ', value: ' + value);
return value;
};
});</p>
<pre><code>
SQLiteDatabase.query.overload('java.lang.String', '[Ljava.lang.String;', 'java.lang.String', '[Ljava.lang.String;', 'java.lang.String', 'java.lang.String', 'java.lang.String').implementation = function(table, columns, selection, selectionArgs, groupBy, having, orderBy) {
console.log(&quot;\n[SQL Query] Table: &quot; + table);
console.log(&quot; - Columns: &quot; + columns);
console.log(&quot; - Selection: &quot; + selection);
console.log(&quot; - Selection Args: &quot; + selectionArgs);
return this.query(table, columns, selection, selectionArgs, groupBy, having, orderBy);
};

SQLiteDatabase.execSQL.overload('java.lang.String', '[Ljava.lang.Object;').implementation = function(sql, bindArgs) {
console.log(&quot;\n[SQL execSQL] SQL: &quot; + sql);
console.log(&quot; - Bind Args: &quot; + bindArgs);
return this.execSQL(sql, bindArgs);
};
});

</code></pre>
<p>Java.perform(function () {
var RootCheckClass = Java.use('com.example.security.RootUtil'); // Replace with target class</p>
<p>RootCheckClass.isDeviceRooted.implementation = function() {
console.log('[+] Bypassing root check...');
return false;
};
});</p>
<pre><code>Debug.isDebuggerConnected.implementation = function() {
console.log('[+] Bypassing isDebuggerConnected check...');
return false;
}
});

</code></pre>
<p>Java.perform(function() {
var View = Java.use('android.view.View');</p>
<p>View.setOnClickListener.implementation = function(listener) {
var originalListener = listener;
var view = this;</p>
<p>// Create a new listener to wrap the original listener
var newListener = Java.implement(Java.use('android.view.View$OnClickListener'), {
onClick: function(v) {
console.log('[+] View clicked! Class: ' + view.getClass().getName() + ', ID: ' + view.getId());
if (originalListener) {
originalListener.onClick(v); // Call the original click event
}
}
});</p>
<p>// Set the new listener
this.setOnClickListener(newListener);
};
});</p>

                                            </div>
                                            
                                            <div class="section" id="section-35">
                                                <h2>35. R33: Frida Common Scripts</h2>
                                                <h1>R33: Recipe: Frida å¸¸ç”¨è„šæœ¬é€ŸæŸ¥æ‰‹å†Œ</h1>
<h2>é—®é¢˜åœºæ™¯</h2>
<p>ä½ åœ¨ä½¿ç”¨ Frida è¿›è¡Œ Android é€†å‘æ—¶ï¼Œç»å¸¸é‡åˆ°ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>ğŸ’­ <strong>&quot;æˆ‘éœ€è¦ç»•è¿‡ SSL Pinning æŠ“åŒ…ï¼Œä½†ä¸æƒ³ä»é›¶å†™è„šæœ¬&quot;</strong></li>
<li>ğŸ’­ <strong>&quot;å¦‚ä½•å¿«é€Ÿ Hook æ‰€æœ‰ JNI å‡½æ•°æ¥åˆ†æ Native å±‚ï¼Ÿ&quot;</strong></li>
<li>ğŸ’­ <strong>&quot;æƒ³æ‹¦æˆªå¹¶ä¿®æ”¹ç½‘ç»œè¯·æ±‚ï¼Œæœ‰ç°æˆçš„æ¨¡æ¿å—ï¼Ÿ&quot;</strong></li>
<li>ğŸ’­ <strong>&quot;éœ€è¦ä» PC ç«¯ä¸»åŠ¨è°ƒç”¨ App çš„åŠ å¯†å‡½æ•°ï¼Œæ€ä¹ˆå†™ RPCï¼Ÿ&quot;</strong></li>
<li>ğŸ’­ <strong>&quot;App æ£€æµ‹åˆ° Frida å°±é—ªé€€ï¼Œæœ‰é€šç”¨çš„ç»•è¿‡è„šæœ¬å—ï¼Ÿ&quot;</strong></li>
</ul>
<p>æœ¬é…æ–¹æä¾›ä¸€å¥—<strong>ç»è¿‡å®æˆ˜éªŒè¯</strong>çš„ Frida è„šæœ¬æ¨¡æ¿åº“ï¼ŒæŒ‰åœºæ™¯åˆ†ç±»ï¼Œå¯ç›´æ¥ä½¿ç”¨æˆ–å¿«é€Ÿä¿®æ”¹ã€‚æ¯ä¸ªè„šæœ¬éƒ½åŒ…å«è¯¦ç»†æ³¨é‡Šå’Œä½¿ç”¨è¯´æ˜ã€‚</p>
<hr />
<h2>å·¥å…·æ¸…å•</h2>
<h3>å¿…éœ€å·¥å…·</h3>
<ul>
<li>[x] <strong>Frida</strong> - å·²å®‰è£…å¹¶é…ç½®å¥½ (å‚è€ƒ <a href="#section-40">Frida ä½¿ç”¨æŒ‡å—</a>)</li>
<li>[x] <strong>Root è®¾å¤‡/æ¨¡æ‹Ÿå™¨</strong> - è¿è¡Œ Frida Server</li>
<li>[x] <strong>ç›®æ ‡åº”ç”¨å·²å®‰è£…</strong> - éœ€è¦åˆ†æçš„ App</li>
</ul>
<h3>å¯é€‰å·¥å…·</h3>
<ul>
<li>â˜ <strong>Python 3</strong> - ç”¨äº RPC æ§åˆ¶è„šæœ¬</li>
<li>â˜ <strong>mitmproxy/Burp Suite</strong> - é…åˆ SSL Pinning ç»•è¿‡ä½¿ç”¨</li>
<li>â˜ <strong>IDA Pro/Ghidra</strong> - ç”¨äºåˆ†æ Native ä»£ç ç¡®å®š Hook ç‚¹</li>
</ul>
<hr />
<h2>å‰ç½®æ¡ä»¶</h2>
<p>âœ… <strong>Frida ç¯å¢ƒå·²é…ç½®</strong>å¹¶èƒ½æˆåŠŸ attach åˆ°ç›®æ ‡åº”ç”¨
âœ… <strong>äº†è§£åŸºæœ¬çš„ JavaScript è¯­æ³•</strong>
âœ… <strong>çŸ¥é“å¦‚ä½•è¿è¡Œ Frida è„šæœ¬</strong> (<code>frida -U -f com.app -l script.js</code>)
âœ… <strong>èƒ½è¯†åˆ«éœ€è¦ Hook çš„ç±»/å‡½æ•°å</strong>ï¼ˆè‡³å°‘çŸ¥é“åŒ…åï¼‰</p>
<hr />
<h2>è„šæœ¬ç´¢å¼•</h2>
<p>æœ¬æ‰‹å†ŒåŒ…å«ä»¥ä¸‹ <strong>8 ç±»åœºæ™¯</strong>çš„è„šæœ¬ï¼š</p>
<table>
<thead>
<tr>
  <th>åœºæ™¯</th>
  <th>è„šæœ¬æ•°é‡</th>
  <th>é€‚ç”¨æƒ…å†µ</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ğŸ›¡ï¸ <a href="#1-%E7%BB%95%E8%BF%87%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6">ç»•è¿‡ä¿æŠ¤æœºåˆ¶</a></td>
  <td>3 ä¸ª</td>
  <td>åè°ƒè¯•ã€å Fridaã€SSL Pinning</td>
</tr>
<tr>
  <td><a href="#2-%E7%BD%91%E7%BB%9C%E6%8B%A6%E6%88%AA%E4%B8%8E%E4%BF%AE%E6%94%B9">ç½‘ç»œæ‹¦æˆªä¸ä¿®æ”¹</a></td>
  <td>1 ä¸ª</td>
  <td>æŠ“åŒ…ã€ä¿®æ”¹è¯·æ±‚/å“åº”</td>
</tr>
<tr>
  <td><a href="#3-%E8%87%AA%E5%8A%A8%E5%8C%96-rpc-%E8%B0%83%E7%94%A8">è‡ªåŠ¨åŒ– RPC è°ƒç”¨</a></td>
  <td>1 å¥—</td>
  <td>ä¸»åŠ¨è°ƒç”¨åŠ å¯†å‡½æ•°ã€æ‰¹é‡æµ‹è¯•</td>
</tr>
<tr>
  <td><a href="#4-jni-%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90">JNI å‡½æ•°åˆ†æ</a></td>
  <td>5 ä¸ª</td>
  <td>Native å±‚é€†å‘ã€å‚æ•°è¿½è¸ª</td>
</tr>
<tr>
  <td><a href="#5-%E9%80%9A%E7%94%A8-hook-%E6%A8%A1%E6%9D%BF">é€šç”¨ Hook æ¨¡æ¿</a></td>
  <td>3 ä¸ª</td>
  <td>å¿«é€Ÿå®šä½ã€æ‰¹é‡ Hook</td>
</tr>
<tr>
  <td><a href="#6-c-%E4%BB%A3%E7%A0%81%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7">C ä»£ç è¾…åŠ©å·¥å…·</a></td>
  <td>2 ä¸ª</td>
  <td>ç®—æ³•ä»¿çœŸã€è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ</td>
</tr>
</tbody>
</table>
<hr />
<h2>1. ç»•è¿‡ä¿æŠ¤æœºåˆ¶</h2>
<h3>è„šæœ¬ 1.1: ç»•è¿‡ TracerPid åè°ƒè¯•æ£€æµ‹</h3>
<p><strong>ä½•æ—¶ä½¿ç”¨</strong>: App é€šè¿‡è¯»å– <code>/proc/self/status</code> ä¸­çš„ <code>TracerPid</code> æ¥æ£€æµ‹è°ƒè¯•å™¨ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>: Hook <code>fgets</code> å‡½æ•°ï¼Œå½“æ£€æµ‹åˆ°è¯»å– <code>TracerPid</code> æ—¶ï¼Œå°†å…¶å€¼å¼ºåˆ¶æ”¹ä¸º 0ã€‚</p>
<pre><code class="language-javascript">// bypass_tracerpid.js - Bypass TracerPid Anti-Debugging

// Step 1: Establish FILE* to path mapping
var fpMap = {};

// Hook fopen to record file paths
Interceptor.attach(Module.findExportByName(null, &quot;fopen&quot;), {
  onEnter: function (args) {
    this.path = args[0].readCString();
  },
  onLeave: function (retval) {
    if (!retval.isNull() &amp;&amp; this.path) {
      fpMap[retval.toString()] = this.path;
      if (this.path.includes(&quot;/status&quot;)) {
        console.log(&quot;[+] fopen: &quot; + this.path);
      }
    }
  },
});

// Hook fgets to modify TracerPid value
Interceptor.attach(Module.findExportByName(null, &quot;fgets&quot;), {
  onEnter: function (args) {
    this.buf = args[0];
    this.fp = args[2];
  },
  onLeave: function (retval) {
    if (retval.isNull()) return;

    var fp = this.fp.toString();
    var path = fpMap[fp];

    if (path &amp;&amp; path.endsWith(&quot;/status&quot;)) {
      var line = this.buf.readCString();

      if (line &amp;&amp; line.includes(&quot;TracerPid:&quot;)) {
        var oldValue = line.match(/TracerPid:\s*(\d+)/);
        this.buf.writeUtf8String(&quot;TracerPid:\t0\n&quot;);

        if (oldValue &amp;&amp; oldValue[1] !== &quot;0&quot;) {
          console.log(&quot;âœ“ [TracerPid] Modify: &quot; + oldValue[1] + &quot; -&gt; 0&quot;);
        }
      }
    }
  },
});

console.log(&quot;[+] TracerPid Anti-Debugging Bypass activated&quot;);
</code></pre>
<h1>Attach mode</h1>
<p>frida -U com.target.app -l bypass_tracerpid.js</p>
<pre><code>
**å·¥ä½œåŸç†**: Hook å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°ï¼Œå½“å‘ç°æ¯”è¾ƒå†…å®¹åŒ…å« &quot;frida&quot; æ—¶ï¼Œè¿”å›ä¸åŒ¹é…ã€‚

```javascript
// hide_frida_strings.js - Hide Frida signature strings

// Hook strstr (most commonly used string search function)
var strstrPtr = Module.findExportByName('libc.so', 'strstr');
if (strstrPtr) {
Interceptor.attach(strstrPtr, {
onEnter: function(args) {
this.haystack = args[0].readCString();
this.needle = args[1].readCString();
},
onLeave: function(retval) {
if (this.haystack &amp;&amp; this.needle) {
var haystackLower = this.haystack.toLowerCase();
var needleLower = this.needle.toLowerCase();

if (haystackLower.includes('frida') || needleLower.includes('frida')) {
console.log(&quot;âœ“ [strstr] Intercept Frida Detection:&quot;);
console.log(&quot; Search: \&quot;&quot; + this.needle + &quot;\&quot; in \&quot;&quot; + this.haystack.substring(0, 50) + &quot;...\&quot;&quot;);
retval.replace(ptr(0)); // Return NULL (not found)
}
}
}
});
console.log(&quot;[+] strstr hook configured&quot;);
}

// Hook strcmp
var strcmpPtr = Module.findExportByName('libc.so', 'strcmp');
if (strcmpPtr) {
Interceptor.attach(strcmpPtr, {
onEnter: function(args) {
this.str1 = args[0].readCString();
this.str2 = args[1].readCString();
},
onLeave: function(retval) {
if (this.str1 &amp;&amp; this.str2) {
var str1Lower = this.str1.toLowerCase();
var str2Lower = this.str2.toLowerCase();

if (str1Lower.includes('frida') || str2Lower.includes('frida')) {
console.log(&quot;âœ“ [strcmp] Intercept Frida Detection:&quot;);
console.log(&quot; Comparing: \&quot;&quot; + this.str1 + &quot;\&quot; vs \&quot;&quot; + this.str2 + &quot;\&quot;&quot;);
retval.replace(1); // Return non-zero (not equal)
}
}
}
});
console.log(&quot;[+] strcmp hook configured&quot;);
}

console.log(&quot;[+] Frida string hiding activated&quot;);

</code></pre>
<p><strong>å·¥ä½œåŸç†</strong>: Hook å¸¸è§ç½‘ç»œåº“ï¼ˆTrustManagerã€OkHttp3ã€HttpsURLConnectionï¼‰çš„è¯ä¹¦æ ¡éªŒå‡½æ•°ã€‚</p>
<pre><code class="language-javascript">// bypass_ssl_pinning.js - Universal SSL Pinning Bypass Script

Java.perform(function () {
  console.log(&quot;[+] Starting SSL Pinning bypass...&quot;);

  // ========================================
  // 1. TrustManagerImpl (system level)
  // ========================================
  try {
    var TrustManagerImpl = Java.use(
      &quot;com.android.org.conscrypt.TrustManagerImpl&quot;
    );

    // android 7.0+
    TrustManagerImpl.verifyChain.implementation = function (
      untrustedChain,
      trustAnchorChain,
      host,
      clientAuth,
      ocspData,
      tlsSctData
    ) {
      console.log(&quot;âœ“ [TrustManagerImpl] Bypass cert validation: &quot; + host);
      return untrustedChain; // Trust directly
    };

    console.log(&quot;[+] TrustManagerImpl Hook æˆåŠŸ&quot;);
  } catch (e) {
    console.log(&quot;[-] TrustManagerImpl not found: &quot; + e);
  }

  // ========================================
  // 2. OkHttp3 (most commonly used)
  // ========================================
  try {
    var CertificatePinner = Java.use(&quot;okhttp3.CertificatePinner&quot;);

    CertificatePinner.check.overload(
      &quot;java.lang.String&quot;,
      &quot;java.util.List&quot;
    ).implementation = function (hostname, peerCertificates) {
      console.log(&quot;âœ“ [OkHttp3] Bypass cert pinning: &quot; + hostname);
      return; // Skip all checks
    };

    console.log(&quot;[+] OkHttp3 CertificatePinner Hook æˆåŠŸ&quot;);
  } catch (e) {
    console.log(&quot;[-] OkHttp3 not found: &quot; + e);
  }

  // ========================================
  // 3. OkHttp3 - Hostname Verifier
  // ========================================
  try {
    var OkHostnameVerifier = Java.use(
      &quot;okhttp3.internal.tls.OkHostnameVerifier&quot;
    );

    OkHostnameVerifier.verify.overload(
      &quot;java.lang.String&quot;,
      &quot;javax.net.ssl.SSLSession&quot;
    ).implementation = function (host, session) {
      console.log(&quot;âœ“ [OkHttp3] Bypass hostname validation: &quot; + host);
      return true; // Always return validation passed
    };

    console.log(&quot;[+] OkHostnameVerifier Hook æˆåŠŸ&quot;);
  } catch (e) {
    console.log(&quot;[-] OkHostnameVerifier not found: &quot; + e);
  }

  // ========================================
  // 4. HttpsURLConnection
  // ========================================
  try {
    var HttpsURLConnection = Java.use(&quot;javax.net.ssl.HttpsURLConnection&quot;);

    HttpsURLConnection.setDefaultHostnameVerifier.implementation = function (
      hostnameVerifier
    ) {
      console.log(
        &quot;âœ“ [HttpsURLConnection] Intercept setDefaultHostnameVerifier&quot;
      );
      return; // Don't set verifier
    };

    HttpsURLConnection.setSSLSocketFactory.implementation = function (
      socketFactory
    ) {
      console.log(&quot;âœ“ [HttpsURLConnection] Intercept setSSLSocketFactory&quot;);
      return; // Don't set factory
    };

    HttpsURLConnection.setHostnameVerifier.implementation = function (
      hostnameVerifier
    ) {
      console.log(&quot;âœ“ [HttpsURLConnection] Intercept setHostnameVerifier&quot;);
      return;
    };

    console.log(&quot;[+] HttpsURLConnection Hook æˆåŠŸ&quot;);
  } catch (e) {
    console.log(&quot;[-] HttpsURLConnection Hook Failed: &quot; + e);
  }

  // ========================================
  // 5. SSLContext
  // ========================================
  try {
    var SSLContext = Java.use(&quot;javax.net.ssl.SSLContext&quot;);

    SSLContext.init.overload(
      &quot;[Ljavax.net.ssl.KeyManager;&quot;,
      &quot;[Ljavax.net.ssl.TrustManager;&quot;,
      &quot;java.security.SecureRandom&quot;
    ).implementation = function (km, tm, random) {
      console.log(&quot;âœ“ [SSLContext] Use custom TrustManager&quot;);

      // Create a TrustManager that trusts all certificates
      var TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);
      var EmptyTrustManager = Java.registerClass({
        name: &quot;com.frida.EmptyTrustManager&quot;,
        implements: [TrustManager],
        methods: {
          checkClientTrusted: function (chain, authType) {},
          checkServerTrusted: function (chain, authType) {},
          getAcceptedIssuers: function () {
            return [];
          },
        },
      });

      var emptyTrustManager = EmptyTrustManager.$new();
      this.init(km, [emptyTrustManager], random);
    };

    console.log(&quot;[+] SSLContext Hook æˆåŠŸ&quot;);
  } catch (e) {
    console.log(&quot;[-] SSLContext Hook Failed: &quot; + e);
  }

  console.log(&quot;[+] SSL Pinning bypass configuration complete&quot;);
});
</code></pre>
<h1>2. Run script</h1>
<p>frida -U -f com.target.app -l bypass_ssl_pinning.js --no-pause</p>
<h1>3. View traffic in Burp/mitmproxy</h1>
<pre><code>
* *ä½•æ—¶ä½¿ç”¨**: éœ€è¦åœ¨ä¸ä½¿ç”¨ä»£ç†çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨ App å†…éƒ¨æ‹¦æˆªå’Œä¿®æ”¹ç½‘ç»œæµé‡ã€‚

* *å·¥ä½œåŸç†**: Hook OkHttp3 çš„ `RealInterceptorChain.proceed` æ–¹æ³•ï¼Œå¯ä»¥è®¿é—®å’Œä¿®æ”¹è¯·æ±‚/å“åº”ã€‚

```javascript
// intercept_okhttp.js - Intercept and modify OkHttp3 network requests

Java.perform(function() {
console.log(&quot;[+] Starting OkHttp3 hook...&quot;);

try {
var RealInterceptorChain = Java.use('okhttp3.internal.http.RealInterceptorChain');

RealInterceptorChain.proceed.implementation = function(request) {
// ========================================
// Request Interception
// ========================================
console.log(&quot;\n[REQUEST] ========================================&quot;);
console.log(&quot; URL: &quot; + request.url().toString());
console.log(&quot; Method: &quot; + request.method());

// Print request headers
var headers = request.headers();
var headerCount = headers.size();
if (headerCount &gt; 0) {
console.log(&quot; Headers:&quot;);
for (var i = 0; i &lt; headerCount; i++) {
console.log(&quot; &quot; + headers.name(i) + &quot;: &quot; + headers.value(i));
}
}

// Print request body
var requestBody = request.body();
if (requestBody) {
try {
var Buffer = Java.use('okio.Buffer');
var buffer = Buffer.$new();
requestBody.writeTo(buffer);
var bodyString = buffer.readUtf8();
console.log(&quot; Body: &quot; + bodyString);
} catch (e) {
console.log(&quot; Body: [Cannot read]&quot;);
}
}

// ========================================
// Modify Request (Optional)
// ========================================
var modifiedRequest = request.newBuilder()
.header('X-Custom-Header', 'Injected-By-Frida') // Add custom header
.header('User-Agent', 'FridaBot/1.0') // Modify User-Agent
.build();

// Execute request
var response = this.proceed(modifiedRequest);

// ========================================
// Response Interception
// ========================================
console.log(&quot;\n[RESPONSE] ========================================&quot;);
console.log(&quot; Code: &quot; + response.code());
console.log(&quot; Message: &quot; + response.message());

// Print response headers
var respHeaders = response.headers();
var respHeaderCount = respHeaders.size();
if (respHeaderCount &gt; 0) {
console.log(&quot; Headers:&quot;);
for (var i = 0; i &lt; respHeaderCount; i++) {
console.log(&quot; &quot; + respHeaders.name(i) + &quot;: &quot; + respHeaders.value(i));
}
}

// ========================================
// Modify Response (Optional)
// ========================================
var responseBody = response.body();
if (responseBody) {
try {
var contentType = responseBody.contentType();
var bodyString = responseBody.string();

console.log(&quot; Body: &quot; + bodyString.substring(0, 500));

// Example: Modify JSON response field
if (bodyString.includes('&quot;status&quot;')) {
var modifiedBody = bodyString.replace(/&quot;status&quot;:&quot;error&quot;/g, '&quot;status&quot;:&quot;success&quot;');
console.log(&quot;âœ“ [Modify] Status field: error -&gt; success&quot;);

// Rebuild response
var MediaType = Java.use('okhttp3.MediaType');
var ResponseBody = Java.use('okhttp3.ResponseBody');

var newBody = ResponseBody.create(contentType, modifiedBody);

return response.newBuilder()
.body(newBody)
.build();
}

// If not modified, need to recreate body (because it was already read)
var ResponseBody = Java.use('okhttp3.ResponseBody');
var newBody = ResponseBody.create(contentType, bodyString);

return response.newBuilder()
.body(newBody)
.build();

} catch (e) {
console.log(&quot; Body: [Read failed] &quot; + e);
}
}

return response;
};

console.log(&quot;[+] OkHttp3 Hook æˆåŠŸ&quot;);

} catch (e) {
console.log(&quot;[-] Hook Failed: &quot; + e);
}
});

</code></pre>
<pre><code>
**ä½•æ—¶ä½¿ç”¨**: éœ€è¦ä» PC ç«¯æ‰¹é‡è°ƒç”¨ App çš„åŠ å¯†å‡½æ•°ã€ç­¾åç®—æ³•ç­‰ï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

**Frida è„šæœ¬** (`rpc_agent.js`):

```javascript
// rpc_agent.js - RPC export functions for Python calls

console.log(&quot;[+] RPC Agent loaded&quot;);

// Define exported RPC functions
rpc.exports = {
// ========================================
// Example 1: Call static encryption function
// ========================================
callEncrypt: function(plaintext) {
var result = &quot;&quot;;

Java.perform(function() {
try {
// Modify to target app's actual class name and method name
var CryptoUtil = Java.use('com.example.app.utils.CryptoUtil');

// Call static method
result = CryptoUtil.encrypt(plaintext);

console.log(&quot;[RPC] encrypt(\&quot;&quot; + plaintext + &quot;\&quot;) = &quot; + result);

} catch (e) {
result = &quot;ERROR: &quot; + e;
console.log(&quot;[-] &quot; + result);
}
});

return result;
},

// ========================================
// Example 2: Call instance method
// ========================================
callInstanceMethod: function(className, methodName, args) {
var result = &quot;&quot;;

Java.perform(function() {
try {
var TargetClass = Java.use(className);

// Enumerate all instances
Java.choose(className, {
onMatch: function(instance) {
console.log(&quot;[RPC] Found instance: &quot; + instance);

// Call instance method
result = instance[methodName].apply(instance, args);

console.log(&quot;[RPC] &quot; + methodName + &quot;() = &quot; + result);
},
onComplete: function() {}
});

} catch (e) {
result = &quot;ERROR: &quot; + e;
console.log(&quot;[-] &quot; + result);
}
});

return result;
},

// ========================================
// Example 3: Call Native Function
// ========================================
callNativeFunction: function(libraryName, functionName, args) {
try {
var funcAddr = Module.findExportByName(libraryName, functionName);

if (!funcAddr) {
return &quot;ERROR: Function not found&quot;;
}

// Define function signature (modify based on actual situation)
// Example: int encrypt(char* input, char* output, int length)
var nativeFunc = new NativeFunction(funcAddr, 'int', ['pointer', 'pointer', 'int']);

// Prepare parameters
var input = Memory.allocUtf8String(args[0]);
var output = Memory.alloc(1024);

// Call function
var ret = nativeFunc(input, output, args[0].length);

var result = output.readCString();
console.log(&quot;[RPC] Native &quot; + functionName + &quot;() returned: &quot; + ret);
console.log(&quot;[RPC] Output: &quot; + result);

return result;

} catch (e) {
return &quot;ERROR: &quot; + e;
}
},

// ========================================
// Example 4: Get app info
// ========================================
getAppInfo: function() {
var info = {};

Java.perform(function() {
var Context = Java.use('android.app.ActivityThread').currentApplication().getApplicationContext();
var PackageManager = Context.getPackageManager();
var PackageName = Context.getPackageName();
var PackageInfo = PackageManager.getPackageInfo(PackageName, 0);

info.packageName = PackageName;
info.versionName = PackageInfo.versionName.value;
info.versionCode = PackageInfo.versionCode.value;

console.log(&quot;[RPC] App Info: &quot; + JSON.stringify(info));
});

return info;
}
};

console.log(&quot;[+] RPC functions exported:&quot;);
console.log(&quot; - callEncrypt(plaintext)&quot;);
console.log(&quot; - callInstanceMethod(className, methodName, args)&quot;);
console.log(&quot; - callNativeFunction(libraryName, functionName, args)&quot;);
console.log(&quot; - getAppInfo()&quot;);

</code></pre>
<h1>rpc_controller.py - Python RPC control script</h1>
<p>import frida
import sys</p>
<p>def on_message(message, data):
&quot;&quot;&quot;Process messages from Frida script&quot;&quot;&quot;
if message['type'] == 'send':
print(f&quot;[*] {message['payload']}&quot;)
elif message['type'] == 'error':
print(f&quot;[!] Error: {message['stack']}&quot;)</p>
<p>def main(): # ======================================== # Connect to device and app # ========================================
try:
device = frida.get_usb_device(timeout=5)
print(f&quot;[+] Connected to device: {device}&quot;)
except frida.TimedOutError:
print(&quot;[-] Device connection timeout&quot;)
sys.exit(1)</p>
<h1>Attach to running app</h1>
<p>try:
package_name = &quot;com.example.app&quot; # Modify to target app package name
session = device.attach(package_name)
print(f&quot;[+] Attached to: {package_name}&quot;)
except frida.ProcessNotFoundError:
print(f&quot;[-] Process not found: {package_name}&quot;)
print(&quot;[*] Please ensure app is running&quot;)
sys.exit(1)</p>
<h1>========================================</h1>
<h1>Load Frida Script</h1>
<h1>========================================</h1>
<p>with open(&quot;rpc_agent.js&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
script_code = f.read()</p>
<p>script = session.create_script(script_code)
script.on('message', on_message)
script.load()
print(&quot;[+] Frida script loaded\n&quot;)</p>
<h1>========================================</h1>
<h1>Get RPC API</h1>
<h1>========================================</h1>
<p>api = script.exports</p>
<h1>========================================</h1>
<h1>Example 1: Call encryption function</h1>
<h1>========================================</h1>
<p>print(&quot;=&quot; _ 60)
print(&quot;Example 1: Call encryption function&quot;)
print(&quot;=&quot; _ 60)</p>
<p>test_data = &quot;Hello, Frida RPC!&quot;
encrypted = api.call_encrypt(test_data)
print(f&quot;Plaintext: {test_data}&quot;)
print(f&quot;Ciphertext: {encrypted}\n&quot;)</p>
<h1>========================================</h1>
<h1>Example 2: Batch test</h1>
<h1>========================================</h1>
<p>print(&quot;=&quot; _ 60)
print(&quot;Example 2: Batch test&quot;)
print(&quot;=&quot; _ 60)</p>
<p>test_cases = [
&quot;test1&quot;,
&quot;test2&quot;,
&quot;test3&quot;,
&quot;a&quot; * 100, # Long string
&quot;&quot;, # Empty string
]</p>
<p>for i, test_input in enumerate(test_cases):
result = api.call_encrypt(test_input)
print(f&quot;[{i+1}] {test_input[:20]:&lt;20} -&gt; {result}&quot;)</p>
<p>print()</p>
<h1>========================================</h1>
<h1>Example 3: Get app info</h1>
<h1>========================================</h1>
<p>print(&quot;=&quot; _ 60)
print(&quot;Example 3: Get app info&quot;)
print(&quot;=&quot; _ 60)</p>
<p>app_info = api.get_app_info()
print(f&quot;Package name: {app_info['packageName']}&quot;)
print(f&quot;Version: {app_info['versionName']} ({app_info['versionCode']})&quot;)</p>
<h1>========================================</h1>
<h1>Keep session alive</h1>
<h1>========================================</h1>
<p>print(&quot;\n[+] RPC session established, press Ctrl+C to exit&quot;)
try:
sys.stdin.read()
except KeyboardInterrupt:
print(&quot;\n[*] Disconnecting...&quot;)</p>
<p>session.detach()
print(&quot;[+] Disconnected&quot;)</p>
<p>if <strong>name</strong> == &quot;<strong>main</strong>&quot;:
main()</p>
<pre><code>
# 2. Run Python script
python3 rpc_controller.py

# Output example:
# [+] Connected to device: ...
# [+] Attached to: com.example.app
# [+] Frida script loaded
#
# Plaintext: Hello, Frida RPC!
# Ciphertext: SGVsbG8sIEZyaWRhIFJQQyE=

</code></pre>
<pre><code class="language-javascript">// enumerate_jni.js - Enumerate all JNI functions in specified SO file

function enumerateJNIFunctions(libraryName) {
  var module = Process.findModuleByName(libraryName);

  if (!module) {
    console.log(&quot;[-] Module not found: &quot; + libraryName);
    console.log(&quot;[*] Trying to wait for module loading...&quot;);

    // Monitor dlopen
    Interceptor.attach(Module.findExportByName(null, &quot;dlopen&quot;), {
      onEnter: function (args) {
        var path = args[0].readCString();
        if (path &amp;&amp; path.includes(libraryName)) {
          console.log(&quot;[+] Detected target library loading: &quot; + path);
          this.target = true;
        }
      },
      onLeave: function (retval) {
        if (this.target &amp;&amp; !retval.isNull()) {
          setTimeout(function () {
            enumerateJNIFunctions(libraryName);
          }, 500);
        }
      },
    });

    return;
  }

  console.log(&quot;\n&quot; + &quot;=&quot;.repeat(70));
  console.log(&quot; JNI Function Enumeration: &quot; + libraryName);
  console.log(&quot; Base address: &quot; + module.base);
  console.log(&quot; Size: &quot; + (module.size / 1024).toFixed(2) + &quot; KB&quot;);
  console.log(&quot;=&quot;.repeat(70) + &quot;\n&quot;);

  var exports = module.enumerateExports();
  var jniFunctions = [];

  // Filter JNI functions
  exports.forEach(function (exp) {
    if (exp.name.startsWith(&quot;Java_&quot;)) {
      jniFunctions.push(exp);
    }
  });

  if (jniFunctions.length === 0) {
    console.log(&quot;[-] No JNI functions found&quot;);
    return;
  }

  // Sort by name
  jniFunctions.sort(function (a, b) {
    return a.name.localeCompare(b.name);
  });

  // Print results
  jniFunctions.forEach(function (exp, index) {
    console.log(&quot;[&quot; + index + &quot;] &quot; + exp.name);
    console.log(&quot; Address: &quot; + exp.address);
    console.log(&quot; Offset: +&quot; + ptr(exp.address).sub(module.base));

    // Parse JNI function name
    // Format: Java_PackageName_ClassName_MethodName
    var parts = exp.name.split(&quot;_&quot;);
    if (parts.length &gt;= 4) {
      var packageAndClass = parts.slice(1, -1).join(&quot;.&quot;);
      var methodName = parts[parts.length - 1];
      console.log(&quot; Java Method: &quot; + packageAndClass + &quot;.&quot; + methodName + &quot;()&quot;);
    }
    console.log();
  });

  console.log(&quot;[+] Found &quot; + jniFunctions.length + &quot; JNI functions\n&quot;);
}

// ========================================
// Usage example
// ========================================
var TARGET_LIBRARY = &quot;libnative-lib.so&quot;; // Modify to target SO file name

// Method 1: If library is already loaded
enumerateJNIFunctions(TARGET_LIBRARY);

// Method 2: Wait for library to load then enumerate
// (If not found above, will automatically enable monitoring)
</code></pre>
<p>// hook_jni_function.js - Hook single JNI function</p>
<p>function hookJNIFunction(libraryName, functionName) {
var funcAddr = Module.findExportByName(libraryName, functionName);</p>
<p>if (!funcAddr) {
console.log(&quot;[-] Function not found: &quot; + functionName);
return;
}</p>
<p>console.log(&quot;[+] Hooking: &quot; + functionName);
console.log(&quot; Address: &quot; + funcAddr);</p>
<p>Interceptor.attach(funcAddr, {
onEnter: function (args) {
console.log(&quot;\n&quot; + &quot;=&quot;.repeat(60));
console.log(&quot;[JNI CALL] &quot; + functionName);
console.log(&quot;=&quot;.repeat(60));
console.log(&quot; JNIEnv*: &quot; + args[0]);
console.log(&quot; jobject/jclass: &quot; + args[1]);</p>
<p>// Try to parse parameters (starting from args[2])
for (var i = 2; i &lt; 8 &amp;&amp; i &lt; args.length; i++) {
var arg = args[i];
console.log(&quot; arg[&quot; + (i - 2) + &quot;]: &quot; + arg);</p>
<p>if (arg.isNull()) {
console.log(&quot; -&gt; null&quot;);
continue;
}</p>
<p>// Try to parse as jstring
try {
var env = Java.vm.getEnv();
var strPtr = env.getStringUtfChars(arg, null);
var str = strPtr.readCString();</p>
<p>if (str &amp;&amp; str.length &gt; 0 &amp;&amp; str.length &lt; 500) {
console.log(' -&gt; jstring: &quot;' + str + '&quot;');
}</p>
<p>env.releaseStringUtfChars(arg, strPtr);
continue;
} catch (e) {}</p>
<p>// Try to parse as integer
try {
var intVal = arg.toInt32();
console.log(
&quot; -&gt; jint: &quot; + intVal + &quot; (0x&quot; + intVal.toString(16) + &quot;)&quot;
);
continue;
} catch (e) {}</p>
<p>// Try to parse as byte array
try {
var env = Java.vm.getEnv();
var arrayLen = env.getArrayLength(arg);</p>
<p>if (arrayLen &gt; 0 &amp;&amp; arrayLen &lt; 1024) {
console.log(&quot; -&gt; jbyteArray[&quot; + arrayLen + &quot;]&quot;);</p>
<p>var bytePtr = env.getByteArrayElements(arg, null);
var bytes = bytePtr.readByteArray(Math.min(arrayLen, 64));
console.log(
hexdump(bytes, {
offset: 0,
length: Math.min(arrayLen, 64),
header: false,
ansi: false,
})
);
env.releaseByteArrayElements(arg, bytePtr, 0);
}
continue;
} catch (e) {}</p>
<p>console.log(&quot; -&gt; Pointer: &quot; + arg);
}
},</p>
<p>onLeave: function (retval) {
console.log(&quot;\n [Return Value]: &quot; + retval);</p>
<p>if (retval.isNull()) {
console.log(&quot; -&gt; null&quot;);
return;
}</p>
<p>// Try to parse return value
try {
var env = Java.vm.getEnv();
var strPtr = env.getStringUtfChars(retval, null);
var str = strPtr.readCString();</p>
<p>if (str &amp;&amp; str.length &gt; 0 &amp;&amp; str.length &lt; 500) {
console.log(' -&gt; jstring: &quot;' + str + '&quot;');
}</p>
<p>env.releaseStringUtfChars(retval, strPtr);
} catch (e) {
try {
var intVal = retval.toInt32();
console.log(&quot; -&gt; jint: &quot; + intVal);
} catch (e2) {
console.log(&quot; -&gt; Pointer: &quot; + retval);
}
}</p>
<p>console.log(&quot;=&quot;.repeat(60) + &quot;\n&quot;);
},
});</p>
<p>console.log(&quot;[+] Hook configured\n&quot;);
}</p>
<p>// ========================================
// Usage example
// ========================================
hookJNIFunction(&quot;libnative-lib.so&quot;, &quot;Java_com_example_app_Crypto_encrypt&quot;);</p>
<pre><code>// hook_all_jni.js - Batch hook all JNI functions

function hookAllJNI(libraryName) {
var module = Process.findModuleByName(libraryName);

if (!module) {
console.log(&quot;[-] Module not found, waiting for load: &quot; + libraryName);

Interceptor.attach(Module.findExportByName(null, &quot;dlopen&quot;), {
onEnter: function (args) {
var path = args[0].readCString();
if (path &amp;&amp; path.includes(libraryName)) {
this.target = true;
}
},
onLeave: function (retval) {
if (this.target &amp;&amp; !retval.isNull()) {
setTimeout(function () {
hookAllJNI(libraryName);
}, 500);
}
},
});

return;
}

console.log(&quot;[+] Starting batch JNI function hook: &quot; + libraryName);

var exports = module.enumerateExports();
var hookedCount = 0;

exports.forEach(function (exp) {
if (!exp.name.startsWith(&quot;Java_&quot;)) {
return;
}

try {
Interceptor.attach(exp.address, {
onEnter: function (args) {
console.log(&quot;\n[JNI] &quot; + exp.name);

// Simplified output, only print first 3 parameters
for (var i = 0; i &lt; 5 &amp;&amp; i &lt; args.length; i++) {
var arg = args[i];

if (i === 0) {
console.log(&quot; JNIEnv*: &quot; + arg);
} else if (i === 1) {
console.log(&quot; jobject: &quot; + arg);
} else {
console.log(&quot; arg[&quot; + (i - 2) + &quot;]: &quot; + arg);

// Try to parse string
if (!arg.isNull()) {
try {
var env = Java.vm.getEnv();
var str = env.getStringUtfChars(arg, null).readCString();
if (str &amp;&amp; str.length &gt; 0 &amp;&amp; str.length &lt; 100) {
console.log(' -&gt; &quot;' + str + '&quot;');
}
env.releaseStringUtfChars(arg, str);
} catch (e) {}
}
}
}
},

onLeave: function (retval) {
console.log(&quot; Return: &quot; + retval);
},
});

hookedCount++;
} catch (e) {
console.log(&quot;[-] Hook failed: &quot; + exp.name);
}
});

console.log(&quot;[+] Successfully hooked &quot; + hookedCount + &quot; JNI functions&quot;);
}

// ========================================
// Usage
// ========================================
hookAllJNI(&quot;libnative-lib.so&quot;);

</code></pre>
<p>// hook_jni_onload.js - Hook JNI_OnLoad function</p>
<p>function hookJNIOnLoad(libraryName) {
var onLoadAddr = Module.findExportByName(libraryName, &quot;JNI_OnLoad&quot;);</p>
<p>if (!onLoadAddr) {
console.log(&quot;[-] JNI_OnLoad not found: &quot; + libraryName);
return;
}</p>
<p>console.log(&quot;[+] Hooking JNI_OnLoad&quot;);
console.log(&quot; Address: &quot; + onLoadAddr);</p>
<p>Interceptor.attach(onLoadAddr, {
onEnter: function (args) {
console.log(&quot;\n&quot; + &quot;=&quot;.repeat(60));
console.log(&quot;[JNI_OnLoad] Called&quot;);
console.log(&quot;=&quot;.repeat(60));
console.log(&quot; JavaVM*: &quot; + args[0]);
console.log(&quot; reserved: &quot; + args[1]);</p>
<p>this.vm = args[0];
},</p>
<p>onLeave: function (retval) {
var jniVersion = retval.toInt32();
console.log(&quot; Return JNI Version: &quot; + jniVersion);</p>
<p>// Parse version number
var major = (jniVersion &gt;&gt; 16) &amp; 0xffff;
var minor = jniVersion &amp; 0xffff;
console.log(&quot; -&gt; JNI<em>VERSION</em>&quot; + major + &quot;_&quot; + minor);</p>
<p>console.log(&quot;=&quot;.repeat(60));</p>
<p>// After JNI_OnLoad completes, can start hooking other JNI functions
setTimeout(function () {
console.log(
&quot;\n[+] JNI_OnLoad completed, starting to hook JNI functions...\n&quot;
);
// Can call other hook functions here
}, 100);
},
});
}</p>
<p>// Monitor library loading
Interceptor.attach(Module.findExportByName(null, &quot;dlopen&quot;), {
onEnter: function (args) {
var path = args[0].readCString();
console.log(&quot;[dlopen] &quot; + path);</p>
<p>if (path &amp;&amp; path.includes(&quot;libnative-lib.so&quot;)) {
console.log(&quot;[+] Detected target library loading&quot;);
this.target = true;
}
},</p>
<p>onLeave: function (retval) {
if (this.target &amp;&amp; !retval.isNull()) {
setTimeout(function () {
hookJNIOnLoad(&quot;libnative-lib.so&quot;);
}, 100);
}
},
});</p>
<p>console.log(&quot;[+] Monitoring library loading...&quot;);</p>
<pre><code>
```javascript
// hook_java_method.js - Universal Java method hook template

function hookJavaMethod(className, methodName) {
Java.perform(function () {
try {
var targetClass = Java.use(className);

// Get all overloads
var overloads = targetClass[methodName].overloads;

console.log(
&quot;[+] Found &quot; +
overloads.length +
&quot; overloads: &quot; +
className +
&quot;.&quot; +
methodName
);

// Hook all overloads
overloads.forEach(function (overload) {
overload.implementation = function () {
console.log(&quot;\n[CALL] &quot; + className + &quot;.&quot; + methodName);

// Print parameters
for (var i = 0; i &lt; arguments.length; i++) {
console.log(&quot; arg[&quot; + i + &quot;]: &quot; + arguments[i]);
}

// Call original method
var result = this[methodName].apply(this, arguments);

console.log(&quot; Return: &quot; + result);

return result;
};
});

console.log(&quot;[+] Hook complete&quot;);
} catch (e) {
console.log(&quot;[-] Hook failed: &quot; + e);
}
});
}

// Usage example
hookJavaMethod(&quot;android.util.Log&quot;, &quot;d&quot;);
hookJavaMethod(&quot;com.example.app.Crypto&quot;, &quot;encrypt&quot;);

</code></pre>
<p>// hook_all_methods.js - Hook all methods of a class</p>
<p>function hookAllMethods(className) {
Java.perform(function () {
try {
var targetClass = Java.use(className);
var methods = targetClass.class.getDeclaredMethods();</p>
<p>console.log(&quot;[+] Class: &quot; + className);
console.log(&quot;[+] Found &quot; + methods.length + &quot; methods\n&quot;);</p>
<p>var hookedCount = 0;</p>
<p>methods.forEach(function (method) {
try {
var methodName = method.getName();</p>
<p>// Skip certain methods
if (methodName === &quot;toString&quot; || methodName === &quot;hashCode&quot;) {
return;
}</p>
<p>var overloads = targetClass[methodName].overloads;</p>
<p>overloads.forEach(function (overload) {
overload.implementation = function () {
console.log(&quot;\n[&quot; + className + &quot;] &quot; + methodName + &quot;()&quot;);</p>
<p>if (arguments.length &gt; 0) {
console.log(&quot; Parameters:&quot;);
for (var i = 0; i &lt; arguments.length; i++) {
console.log(&quot; [&quot; + i + &quot;] &quot; + arguments[i]);
}
}</p>
<p>var result = this[methodName].apply(this, arguments);</p>
<p>console.log(&quot; Return: &quot; + result);</p>
<p>return result;
};
});</p>
<p>hookedCount++;
} catch (e) {
// Some methods may not be hookable
}
});</p>
<p>console.log(&quot;[+] Successfully hooked &quot; + hookedCount + &quot; methods&quot;);
} catch (e) {
console.log(&quot;[-] Failed: &quot; + e);
}
});
}</p>
<p>// Usage
hookAllMethods(&quot;com.example.app.utils.CryptoUtil&quot;);</p>
<pre><code>// hook_constructor.js - Hook class constructor

function hookConstructor(className) {
Java.perform(function () {
try {
var targetClass = Java.use(className);

// $init is the special name for constructors
var overloads = targetClass.$init.overloads;

console.log(
&quot;[+] Found &quot; + overloads.length + &quot; constructors: &quot; + className
);

overloads.forEach(function (overload) {
overload.implementation = function () {
console.log(&quot;\n[NEW] &quot; + className + &quot;()&quot;);

if (arguments.length &gt; 0) {
console.log(&quot; Constructor parameters:&quot;);
for (var i = 0; i &lt; arguments.length; i++) {
console.log(&quot; [&quot; + i + &quot;] &quot; + arguments[i]);
}
}

// Call original constructor
var result = this.$init.apply(this, arguments);

console.log(&quot; Instance: &quot; + this);

return result;
};
});

console.log(&quot;[+] Constructor hook complete&quot;);
} catch (e) {
console.log(&quot;[-] Failed: &quot; + e);
}
});
}

// Usage
hookConstructor(&quot;javax.crypto.spec.SecretKeySpec&quot;);

</code></pre>
<p><strong>ç¤ºä¾‹ï¼šXOR åŠ å¯†ç®—æ³•ä»¿çœŸ</strong></p>
<pre><code class="language-c">// emulate_xor_encrypt.c - Emulate XOR encryption algorithm

# include &lt;stdio.h&gt;
# include &lt;string.h&gt;
# include &lt;stdint.h&gt;

// Algorithm extracted from IDA pseudocode
void encrypt_data(uint8_t* data, size_t len, uint8_t key) {
for (size_t i = 0; i &lt; len; i++) {
data[i] = (data[i] ^ key) + 5;
}
}

// Corresponding decryption algorithm
void decrypt_data(uint8_t* data, size_t len, uint8_t key) {
for (size_t i = 0; i &lt; len; i++) {
data[i] = (data[i] - 5) ^ key;
}
}

// Helper function: Print hexadecimal
void print_hex(const char* label, uint8_t* data, size_t len) {
printf(&quot;%s: &quot;, label);
for (size_t i = 0; i &lt; len; i++) {
printf(&quot;%02x &quot;, data[i]);
}
printf(&quot;\n&quot;);
}

int main() {
// Test data
uint8_t plaintext[] = &quot;Hello, Android Reverse Engineering!&quot;;
size_t len = strlen((char*)plaintext);
uint8_t key = 0x5A;

printf(&quot;=== XOR Encryption Algorithm Test ===\n\n&quot;);

// Plaintext
printf(&quot;Plaintext: %s\n&quot;, plaintext);
print_hex(&quot;Plaintext HEX&quot;, plaintext, len);
printf(&quot;\n&quot;);

// Encrypt
encrypt_data(plaintext, len, key);
printf(&quot;After encryption:\n&quot;);
print_hex(&quot;Ciphertext HEX&quot;, plaintext, len);
printf(&quot;\n&quot;);

// Decrypt
decrypt_data(plaintext, len, key);
printf(&quot;After decryption: %s\n&quot;, plaintext);
print_hex(&quot;Decrypted HEX&quot;, plaintext, len);

return 0;
}

</code></pre>
<h1>Run the program</h1>
<p>./emulate</p>
<h1>Output:</h1>
<h1>=== XOR Encryption Algorithm Test ===</h1>
<h1></h1>
<h1>Plaintext: Hello, Android Reverse Engineering!</h1>
<h1>Plaintext HEX: 48 65 6c 6c 6f 2c 20 41 6e 64 72 6f 69 64 ...</h1>
<h1></h1>
<h1>After encryption:</h1>
<h1>Ciphertext HEX: 17 30 39 39 32 79 75 16 39 31 2d 32 36 31 ...</h1>
<h1></h1>
<h1>After decryption: Hello, Android Reverse Engineering!</h1>
<pre><code>
```c
// device_fingerprint.c - è®¾å¤‡æŒ‡çº¹GenerateTool

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

// Execute shell command and get output
char* execute_command(const char* cmd) {
FILE* fp = popen(cmd, &quot;r&quot;);
if (!fp) return NULL;

char* result = malloc(256);
if (fgets(result, 256, fp) == NULL) {
free(result);
pclose(fp);
return NULL;
}

// Remove newline character
result[strcspn(result, &quot;\n&quot;)] = 0;
pclose(fp);

return result;
}

// Get system property
char* get_prop(const char* key) {
char command[256];
snprintf(command, sizeof(command), &quot;getprop %s&quot;, key);
return execute_command(command);
}

int main() {
printf(&quot;{\n&quot;);
printf(&quot; \&quot;timestamp\&quot;: %ld,\n&quot;, time(NULL));
printf(&quot; \&quot;device\&quot;: {\n&quot;);

// Device info
const char* props[] = {
&quot;ro.product.brand&quot;,
&quot;ro.product.model&quot;,
&quot;ro.product.manufacturer&quot;,
&quot;ro.product.device&quot;,
&quot;ro.build.version.release&quot;,
&quot;ro.build.version.sdk&quot;,
&quot;ro.build.fingerprint&quot;,
&quot;ro.serialno&quot;,
&quot;ro.boot.serialno&quot;
};

int num_props = sizeof(props) / sizeof(props[0]);

for (int i = 0; i &lt; num_props; i++) {
char* value = get_prop(props[i]);

if (value) {
// Extract last part of property name
const char* last_dot = strrchr(props[i], '.');
const char* key = last_dot ? last_dot + 1 : props[i];

printf(&quot; \&quot;%s\&quot;: \&quot;%s\&quot;&quot;, key, value);

if (i &lt; num_props - 1) {
printf(&quot;,&quot;);
}
printf(&quot;\n&quot;);

free(value);
}
}

printf(&quot; }\n&quot;);
printf(&quot;}\n&quot;);

return 0;
}

</code></pre>
<p>adb push device_fingerprint.c /data/local/tmp/
adb shell
cd /data/local/tmp
gcc device_fingerprint.c -o fingerprint
chmod +x fingerprint</p>
<h1>Run the program</h1>
<p>./fingerprint</p>
<h1>Output JSON format device fingerprint:</h1>
<h1>{</h1>
<h1>&quot;timestamp&quot;: 1734518400,</h1>
<h1>&quot;device&quot;: {</h1>
<h1>&quot;brand&quot;: &quot;google&quot;,</h1>
<h1>&quot;model&quot;: &quot;Pixel 5&quot;,</h1>
<h1>&quot;manufacturer&quot;: &quot;Google&quot;,</h1>
<h1>...</h1>
<h1>}</h1>
<h1>}</h1>
<h1>Save to file</h1>
<p>./fingerprint &gt; /sdcard/device_info.json</p>
<pre><code>
**å¯èƒ½åŸå› **:
1. Hook æ—¶æœºå¤ªæ™šï¼Œç›®æ ‡å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•
2. ç±»åæˆ–æ–¹æ³•åæ‹¼å†™é”™è¯¯
3. ä½¿ç”¨äº† Attach æ¨¡å¼ï¼Œä½† DEX è¿˜æœªåŠ è½½

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. Use Spawn mode (Recommended)
frida -U -f com.target.app -l script.js --no-pause

# 2. Check if class name is correct
Java.perform(function() {
Java.enumerateLoadedClasses({
onMatch: function(className) {
if (className.indexOf(&quot;Crypto&quot;) !== -1) {
console.log(&quot;[+] Found class: &quot; + className);
}
},
onComplete: function() {}
});
});

# 3. Delayed hook (if using Attach mode)
setTimeout(function() {
hookJavaMethod(&quot;com.example.app.Crypto&quot;, &quot;encrypt&quot;);
}, 2000);

</code></pre>
<p><strong>å¯èƒ½åŸå› </strong>:</p>
<ol>
<li>è¯»å–äº†æ— æ•ˆçš„æŒ‡é’ˆ</li>
<li>JNIEnv ä½¿ç”¨ä¸å½“</li>
<li>å­—èŠ‚æ•°ç»„é‡Šæ”¾é—®é¢˜</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">// Add try-catch protection
Interceptor.attach(funcAddr, {
  onEnter: function (args) {
    try {
      // Check pointer validity first
      if (!args[2].isNull()) {
        var env = Java.vm.getEnv();
        // ... Process parameters
      }
    } catch (e) {
      console.log(&quot;[-] Caught exception: &quot; + e);
      // Don't re-throw to avoid crash
    }
  },
});
</code></pre>
<ol>
<li>ç±»è¿˜æœªåŠ è½½åˆ°å†…å­˜</li>
<li>ç±»åé”™è¯¯æˆ–è¢«æ··æ·†</li>
<li>ä½¿ç”¨äº†åŠ¨æ€åŠ è½½çš„ DEX</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-python"># On Python side, wait for class to load first
api.wait_for_class(&quot;com.example.app.Crypto&quot;) # Custom wait function

# Or check in Frida script
rpc.exports = {
callEncrypt: function(input) {
var result = &quot;&quot;;

Java.perform(function() {
// Check if class exists first
try {
var Crypto = Java.use(&quot;com.example.app.Crypto&quot;);
result = Crypto.encrypt(input);
} catch (e) {
// Try to enumerate and find
Java.enumerateLoadedClasses({
onMatch: function(className) {
if (className.includes(&quot;Crypto&quot;)) {
console.log(&quot;[+] Found: &quot; + className);
}
},
onComplete: function() {}
});

result = &quot;ERROR: &quot; + e;
}
});

return result;
}
};

</code></pre>
<ol>
<li>åº”ç”¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ SSL Pinning å®ç°</li>
<li>Native å±‚å®ç°çš„ Pinning</li>
<li>ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ç½‘ç»œåº“ (å¦‚ Cronet)</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-javascript">// 1. Add more hook points
Java.perform(function () {
  // Hook custom TrustManager
  Java.enumerateLoadedClasses({
    onMatch: function (className) {
      if (
        className.includes(&quot;TrustManager&quot;) ||
        className.includes(&quot;Certificate&quot;)
      ) {
        console.log(&quot;[+] Found suspicious class: &quot; + className);

        try {
          var clazz = Java.use(className);
          var methods = clazz.class.getDeclaredMethods();

          methods.forEach(function (method) {
            var methodName = method.getName();
            if (methodName.includes(&quot;check&quot;) || methodName.includes(&quot;verify&quot;)) {
              console.log(&quot;[+] Hook: &quot; + className + &quot;.&quot; + methodName);
              // Batch hook
            }
          });
        } catch (e) {}
      }
    },
    onComplete: function () {},
  });
});

// 2. Hook native layer SSL_CTX_set_verify
var SSL_CTX_set_verify = Module.findExportByName(
  &quot;libssl.so&quot;,
  &quot;SSL_CTX_set_verify&quot;
);
if (SSL_CTX_set_verify) {
  Interceptor.attach(SSL_CTX_set_verify, {
    onEnter: function (args) {
      console.log(&quot;âœ“ [SSL_CTX_set_verify] Bypass&quot;);
      args[1] = ptr(0); // SSL_VERIFY_NONE
    },
  });
}
</code></pre>
<ul>
<li><a href="#section-3">Recipe: æŠ“åŒ…åˆ†æ Android åº”ç”¨çš„ç½‘ç»œæµé‡</a> - é…åˆ SSL Pinning ç»•è¿‡ä½¿ç”¨</li>
<li><a href="#section-4">Recipe: åˆ†æå¹¶æå– Android åº”ç”¨çš„åŠ å¯†å¯†é’¥</a> - å¯†ç å­¦åˆ†æçš„å®Œæ•´æµç¨‹</li>
</ul>
<h3>å·¥å…·æ·±å…¥</h3>
<ul>
<li><a href="#section-40">Frida ä½¿ç”¨æŒ‡å—</a> - å®Œæ•´çš„ Frida ä½¿ç”¨æ‰‹å†Œ</li>
<li><a href="#section-41">Frida å†…éƒ¨åŸç†</a> - æ·±å…¥ç†è§£ Frida å·¥ä½œæœºåˆ¶</li>
</ul>
<h3>æ¡ˆä¾‹åˆ†æ</h3>
<ul>
<li><a href="#section-51">æ¡ˆä¾‹: éŸ³ä¹ App åˆ†æ</a> - ç»¼åˆè¿ç”¨å¤šä¸ªè„šæœ¬</li>
</ul>
<h3>å‚è€ƒèµ„æ–™</h3>
<ul>
<li>JNI å‡½æ•°é€ŸæŸ¥ ğŸ“„</li>
<li>å¸¸è§åŠ å¯†ç®—æ³•è¯†åˆ« ğŸ“„</li>
</ul>
<hr />
<h2>å¿«é€Ÿå‚è€ƒ</h2>
<h3>è„šæœ¬é€ŸæŸ¥è¡¨</h3>
<table>
<thead>
<tr>
  <th>éœ€æ±‚</th>
  <th>ä½¿ç”¨è„šæœ¬</th>
  <th>éš¾åº¦</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ç»•è¿‡ TracerPid æ£€æµ‹</strong></td>
  <td><code>bypass_tracerpid.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>éšè— Frida å­—ç¬¦ä¸²</strong></td>
  <td><code>hide_frida_strings.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>ç»•è¿‡ SSL Pinning</strong></td>
  <td><code>bypass_ssl_pinning.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>æ‹¦æˆªç½‘ç»œè¯·æ±‚</strong></td>
  <td><code>intercept_okhttp.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>RPC è°ƒç”¨åŠ å¯†å‡½æ•°</strong></td>
  <td><code>rpc_agent.js + rpc_controller.py</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>æšä¸¾ JNI å‡½æ•°</strong></td>
  <td><code>enumerate_jni.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>Hook JNI å‡½æ•°</strong></td>
  <td><code>hook_jni_function.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>æ‰¹é‡ Hook JNI</strong></td>
  <td><code>hook_all_jni.js</code></td>
  <td></td>
</tr>
<tr>
  <td><strong>Hook æ„é€ å‡½æ•°</strong></td>
  <td><code>hook_constructor.js</code></td>
  <td></td>
</tr>
</tbody>
</table>
<h3>å¸¸ç”¨å‘½ä»¤</h3>
<pre><code class="language-bash"># 1. Spawn mode run script (recommended)
frida -U -f com.target.app -l script.js --no-pause

# 2. Attach mode
frida -U com.target.app -l script.js

# 3. List all processes
frida-ps -Ua

# 4. Interactive REPL
frida -U com.target.app

# 5. Load multiple scripts
frida -U -f com.target.app -l script1.js -l script2.js --no-pause

# 6. Export output to file
frida -U com.target.app -l script.js &gt; output.log 2&gt;&amp;1

3. **é€‚åº¦æ‰“å°æ—¥å¿—** - è¿‡å¤šæ—¥å¿—ä¼šå½±å“æ€§èƒ½
4. **æ¨¡å—åŒ–ç»„ç»‡** - å°†å¸¸ç”¨å‡½æ•°å°è£…ä¸ºç‹¬ç«‹æ¨¡å—
5. **ä¿å­˜è„šæœ¬åº“** - å»ºç«‹è‡ªå·±çš„è„šæœ¬æ¨¡æ¿åº“

- --

* *ğŸ’¡ æç¤º**: è¿™äº›è„šæœ¬éƒ½æ˜¯**æ¨¡æ¿**ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®ç›®æ ‡ App çš„å…·ä½“æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚å»ºè®®å…ˆç†è§£è„šæœ¬åŸç†ï¼Œå†ä¿®æ”¹å…³é”®å‚æ•° (å¦‚ç±»åã€æ–¹æ³•åã€SO æ–‡ä»¶åç­‰)ã€‚
    ```

</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-36">
                                                <h2>36. R34: Automation Scripts</h2>
                                                <h1>R34: è‡ªåŠ¨åŒ–è„šæœ¬ (Automation Scripts)</h1>
<p>åœ¨ Android é€†å‘å·¥ç¨‹ä¸­ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬å¯ä»¥æå¤§åœ°æé«˜æ•ˆç‡ï¼Œä¾‹å¦‚è‡ªåŠ¨å®‰è£… APKã€é‡å¯åº”ç”¨ã€æ¨¡æ‹Ÿç‚¹å‡»ä»¥åŠæ‰¹é‡å¤„ç†è®¾å¤‡ã€‚Python æ˜¯ç¼–å†™è¿™äº›è„šæœ¬çš„é¦–é€‰è¯­è¨€ã€‚</p>
<h2>1. åŸºç¡€ ADB å°è£… (Python)</h2>
<p>è™½ç„¶å¯ä»¥ç›´æ¥åœ¨ shell ä¸­è¿è¡Œ <code>adb</code> å‘½ä»¤ï¼Œä½†åœ¨ Python ä¸­å°è£…ä¸€å±‚å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œé€»è¾‘æ§åˆ¶ã€‚</p>
<pre><code class="language-python">import subprocess
import time
import os

class AdbWrapper:
def __init__(self, device_id=None):
self.device_id = device_id

def run_cmd(self, cmd):
adb_cmd = [&quot;adb&quot;]
if self.device_id:
adb_cmd.extend([&quot;-s&quot;, self.device_id])
adb_cmd.extend(cmd)

try:
result = subprocess.run(
adb_cmd,
capture_output=True,
text=True,
check=True
)
return result.stdout.strip()
except subprocess.CalledProcessError as e:
print(f&quot;Error running command {' '.join(adb_cmd)}: {e.stderr}&quot;)
return None

def install(self, apk_path):
print(f&quot;Installing {apk_path}...&quot;)
return self.run_cmd([&quot;install&quot;, &quot;-r&quot;, apk_path])

def uninstall(self, package_name):
print(f&quot;Uninstalling {package_name}...&quot;)
return self.run_cmd([&quot;uninstall&quot;, package_name])

def start_app(self, package_name, activity_name):
print(f&quot;Starting {package_name}/{activity_name}...&quot;)
return self.run_cmd([&quot;shell&quot;, &quot;am&quot;, &quot;start&quot;, &quot;-n&quot;, f&quot;{package_name}/{activity_name}&quot;])

def stop_app(self, package_name):
print(f&quot;Stopping {package_name}...&quot;)
return self.run_cmd([&quot;shell&quot;, &quot;am&quot;, &quot;force-stop&quot;, package_name])

def clear_data(self, package_name):
print(f&quot;Clearing data for {package_name}...&quot;)
return self.run_cmd([&quot;shell&quot;, &quot;pm&quot;, &quot;clear&quot;, package_name])

def click(self, x, y):
return self.run_cmd([&quot;shell&quot;, &quot;input&quot;, &quot;tap&quot;, str(x), str(y)])

def swipe(self, x1, y1, x2, y2, duration=500):
return self.run_cmd([&quot;shell&quot;, &quot;input&quot;, &quot;swipe&quot;, str(x1), str(y1), str(x2), str(y2), str(duration)])

def input_text(self, text):
# Note: special characters might need escaping
return self.run_cmd([&quot;shell&quot;, &quot;input&quot;, &quot;text&quot;, text])

def screenshot(self, remote_path=&quot;/sdcard/screenshot.png&quot;, local_path=&quot;screenshot.png&quot;):
self.run_cmd([&quot;shell&quot;, &quot;screencap&quot;, &quot;-p&quot;, remote_path])
self.run_cmd([&quot;pull&quot;, remote_path, local_path])
print(f&quot;Screenshot saved to {local_path}&quot;)

# UseExample
if __name__ == &quot;__main__&quot;:
adb = AdbWrapper() # é»˜è®¤è¿æ¥ç¬¬ä¸€ä¸ªè®¾å¤‡

# æ‰“å° connectedè®¾å¤‡
print(&quot;Devices:&quot;, adb.run_cmd([&quot;devices&quot;]))

# adb.start_app(&quot;com.example.app&quot;, &quot;com.example.app.MainActivity&quot;)
# time.sleep(5)
# adb.click(500, 1000)
# adb.screenshot()

</code></pre>
<p>pip install uiautomator2</p>
<pre><code>
import time

# Connect to to to to to to to device (USB)
d = u2.connect()
# oré€šè¿‡ WiFi: d = u2.è¿æ¥('192.168.1.100')

print(f&quot;Connected to device: {d.info}&quot;)

# startupApp
pkg_name = &quot;com.example.android.apis&quot;
d.app_start(pkg_name)

# Wait forAppstartup
d.wait_activity(&quot;.ApiDemos&quot;, timeout=10)

# æŸ¥æ‰¾å¹¶ç‚¹å‡»å…ƒç´  (Supportå¤šç§é€‰æ‹©å™¨)
try:
# é€šè¿‡æ–‡æœ¬æŸ¥æ‰¾å¹¶ç‚¹å‡»
if d(text=&quot;App&quot;).exists:
d(text=&quot;App&quot;).click()

# é€šè¿‡ resourceId æŸ¥æ‰¾
# d(resourceId=&quot;com.example:id/button&quot;).click()

# æ»šåŠ¨æŸ¥æ‰¾ (å‘ä¸‹æ»‘åŠ¨ç›´åˆ°æ‰¾åˆ°æ–‡æœ¬ä¸º 'é€šçŸ¥' å…ƒç´ )
d(scrollable=True).scroll.to(text=&quot;Notification&quot;)
d(text=&quot;Notification&quot;).click()

# è¾“å…¥æ–‡æœ¬
# d(resourceId=&quot;com.example:id/edit_text&quot;).set_text(&quot;Hello World&quot;)

# æˆªå›¾
d.screenshot(&quot;uiauto_screenshot.jpg&quot;)

except Exception as e:
print(f&quot;Error: {e}&quot;)

finally:
# åœæ­¢ App
# d.app_stoperation (pkg_name)
pass

</code></pre>
<p>import glob
from concurrent.futures import ThreadPoolExecutor</p>
<p>class BatchManager:
def <strong>init</strong>(self, adb_wrapper):
self.adb = adb_wrapper</p>
<p>def install_all(self, directory):
apk_files = glob.glob(os.path.join(directory, &quot;*.apk&quot;))
print(f&quot;Found {len(apk_files)} APKs.&quot;)</p>
<h1>UseThread æ±  ConcurrentInstall (æ³¨æ„ï¼šADB Concurrent å¯èƒ½ä¸ Stableï¼Œè§†æƒ…å†µè°ƒæ•´)</h1>
<p>with ThreadPoolExecutor(max_workers=3) as executor:
executor.map(self.adb.install, apk_files)</p>
<p>def setup_proxy(self, host, port):
print(f&quot;Setting global http proxy to {host}:{port}...&quot;)
self.adb.run_cmd([&quot;shell&quot;, &quot;settings&quot;, &quot;put&quot;, &quot;global&quot;, &quot;http_proxy&quot;, f&quot;{host}:{port}&quot;])</p>
<p>def clear_proxy(self):
print(&quot;Clearing global http proxy...&quot;)
self.adb.run_cmd([&quot;shell&quot;, &quot;settings&quot;, &quot;put&quot;, &quot;global&quot;, &quot;http_proxy&quot;, &quot;:0&quot;])</p>
<h1>UseExample</h1>
<p>if <strong>name</strong> == &quot;<strong>main</strong>&quot;:
adb = AdbWrapper()
manager = BatchManager(adb)</p>
<h1>æ‰¹é‡å®‰è£…å½“å‰ç›®å½•ä¸‹ apks æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰ apk</h1>
<h1>manager.install_all(&quot;./apks&quot;)</h1>
<h1>settingssssss ä»£ç†ä»¥ä¾¿æŠ“ Package</h1>
<h1>manager.setup_proxy(&quot;192.168.1.10&quot;, &quot;8080&quot;)</h1>

                                            </div>
                                            
                                            <div class="section" id="section-37">
                                                <h2>37. R35: Native Hooking</h2>
                                                <h1>R35: Native å±‚ Hook æŠ€å·§ (Native Hooking Patterns)</h1>
<p>åœ¨ Android é€†å‘ä¸­ï¼ŒNative å±‚ (C/C++) çš„åˆ†æå¾€å¾€æ¯” Java å±‚æ›´å…·æŒ‘æˆ˜æ€§ã€‚Hook æ ‡å‡† C åº“ (libc) å‡½æ•°æ˜¯ç†è§£ Native å±‚è¡Œä¸ºã€è„±å£³å’Œè¿˜åŸç®—æ³•çš„é‡è¦æ‰‹æ®µã€‚</p>
<h1># 1. æ–‡ä»¶æ“ä½œç›‘æ§ (File I/O)</h1>
<p>ç›‘æ§æ–‡ä»¶æ“ä½œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç° App è¯»å–äº†å“ªäº›é…ç½®æ–‡ä»¶ã€åŠ è½½äº†å“ªäº› Dex/So æ–‡ä»¶ï¼Œæˆ–è€…å°†è§£å¯†åçš„æ•°æ®å†™å…¥åˆ°äº†å“ªé‡Œã€‚</p>
<h2># Hook <code>open</code> / <code>openat</code></h2>
<pre><code class="language-javascript">// Hook open and openat to trace file access
function hookFileOpen() {
  // Intercept 'open'
  var openPtr = Module.findExportByName(&quot;libc.so&quot;, &quot;open&quot;);
  if (openPtr) {
    Interceptor.attach(openPtr, {
      onEnter: function (args) {
        this.path = args[0].readCString();
        this.flags = args[1].toInt32();
        // console.log(&quot;[open] &quot; + this.path);
      },
      onLeave: function (retval) {
        if (
          this.path &amp;&amp;
          (this.path.endsWith(&quot;.dex&quot;) || this.path.endsWith(&quot;.so&quot;))
        ) {
          console.log(&quot;[open] FD: &quot; + retval + &quot; Path: &quot; + this.path);
        }
      },
    });
  }

  // Intercept 'openat' (commonly used on newer android versions)
  var openatPtr = Module.findExportByName(&quot;libc.so&quot;, &quot;openat&quot;);
  if (openatPtr) {
    Interceptor.attach(openatPtr, {
      onEnter: function (args) {
        // args[0] is dirfd, args[1] is path
        this.path = args[1].readCString();
        this.flags = args[2].toInt32();
      },
      onLeave: function (retval) {
        if (
          this.path &amp;&amp;
          (this.path.indexOf(&quot;base.apk&quot;) &gt;= 0 || this.path.indexOf(&quot;.dex&quot;) &gt;= 0)
        ) {
          console.log(&quot;[openat] FD: &quot; + retval + &quot; Path: &quot; + this.path);
        }
      },
    });
  }
}
</code></pre>
<p>function hookDlopen() {
var dlopen = Module.findExportByName(null, &quot;dlopen&quot;);
var android_dlopen_ext = Module.findExportByName(null, &quot;android_dlopen_ext&quot;);</p>
<p>if (dlopen) {
Interceptor.attach(dlopen, {
onEnter: function(args) {
this.path = args[0].readCString();
},
onLeave: function(retval) {
if (this.path) {
console.log(&quot;[dlopen] &quot; + this.path + &quot; -&gt; Handle: &quot; + retval);
if (this.path.indexOf(&quot;libnative-lib.so&quot;) &gt;= 0) {
// Library loaded, ready to hook functions inside it
}
}
}
});
}</p>
<p>if (android_dlopen_ext) {
Interceptor.attach(android_dlopen_ext, {
onEnter: function(args) {
this.path = args[0].readCString();
},
onLeave: function(retval) {
if (this.path) {
console.log(&quot;[android_dlopen_ext] &quot; + this.path + &quot; -&gt; Handle: &quot; + retval);
}
}
});
}
}</p>
<pre><code>
```javascript
function hookMemcpy() {
var memcpy = Module.findExportByName(&quot;libc.so&quot;, &quot;memcpy&quot;);

Interceptor.attach(memcpy, {
onEnter: function(args) {
this.dest = args[0];
this.src = args[1];
this.n = args[2].toInt32();
},
onLeave: function(retval) {
// Filter by size or content to reduce noise
if (this.n &gt; 100 &amp;&amp; this.n &lt; 200) {
// Check if source contains specific magic bytes (e.g., ELF header)
try {
var magic = this.src.readU32();
if (magic == 0x464c457f) { // .ELF
console.log(&quot;[memcpy] ELF header detected! Size: &quot; + this.n);
console.log(hexdump(this.src, {length: 32}));
}
} catch(e) {}
}
}
});
}

</code></pre>
<p>function hookDlsym() {
var dlsym = Module.findExportByName(null, &quot;dlsym&quot;);</p>
<p>Interceptor.attach(dlsym, {
onEnter: function(args) {
this.handle = args[0];
this.symbol = args[1].readCString();
},
onLeave: function(retval) {
if (this.symbol) {
console.log(&quot;[dlsym] Symbol: &quot; + this.symbol + &quot; -&gt; Address: &quot; + retval);
}
}
});
}</p>
<pre><code>function hookStrcmp() {
var strcmp = Module.findExportByName(&quot;libc.so&quot;, &quot;strcmp&quot;);

Interceptor.attach(strcmp, {
onEnter: function(args) {
var s1 = args[0].readCString();
var s2 = args[1].readCString();

// Filter for interesting strings
if ((s1 &amp;&amp; s1.indexOf(&quot;secret&quot;) &gt;= 0) || (s2 &amp;&amp; s2.indexOf(&quot;secret&quot;) &gt;= 0)) {
console.log(&quot;[strcmp] &quot; + s1 + &quot; VS &quot; + s2);
}
}
});
}

</code></pre>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-38">
                                                <h2>38. R36: Objection Snippets</h2>
                                                <h1>R36: Objection å¸¸ç”¨æŠ€å·§ (Objection Snippets)</h1>
<p>Objection æ˜¯ä¸€ä¸ªåŸºäº Frida å¼€å‘çš„è¿è¡Œæ—¶ç§»åŠ¨ç«¯æ¢ç´¢å·¥å…·åŒ…ã€‚å®ƒæä¾›äº†ç±»ä¼¼äº shell çš„äº¤äº’å¼å‘½ä»¤è¡Œï¼Œæ— éœ€ç¼–å†™ JavaScript ä»£ç å³å¯å®Œæˆå¤§éƒ¨åˆ†å¸¸è§çš„é€†å‘ä»»åŠ¡ã€‚</p>
<ul>
<li><strong>å®‰è£…</strong>: <code>pip install objection</code></li>
<li><strong>å¯åŠ¨</strong>: <code>objection -g com.example.app explore</code></li>
</ul>
<h2>1. å†…å­˜æ¼«æ¸¸ä¸ç±»æŸ¥æ‰¾</h2>
<p>åœ¨ä¸çŸ¥é“ä»ä½•å…¥æ‰‹æ—¶ï¼Œé¦–å…ˆæµè§ˆåº”ç”¨ä¸­åŠ è½½äº†å“ªäº›ç±»ã€‚</p>
<ul>
<li><strong>æœç´¢ç±»</strong>:</li>
</ul>
<pre><code class="language-bash"># æœç´¢åŒ…å« &quot;Crypto&quot; çš„ç±»
android hooking search classes Crypto
</code></pre>
<pre><code class="language-bash"># æœç´¢åŒ…å« &quot;encrypt&quot; çš„æ–¹æ³•
android hooking search methods encrypt
</code></pre>
<pre><code class="language-bash"># åˆ—å‡º com.example.app.MainActivity çš„æ‰€æœ‰æ–¹æ³•
android hooking list class_methods com.example.app.MainActivity
</code></pre>
<h2>2. Hook æ–¹æ³•</h2>
<p>Objection çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯å¿«é€Ÿ Hook ç±»æˆ–æ–¹æ³•ï¼Œæ‰“å°è°ƒç”¨çš„å‚æ•°ã€è¿”å›å€¼å’Œè°ƒç”¨æ ˆã€‚</p>
<ul>
<li><strong>Hook æ•´ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•</strong>:</li>
</ul>
<pre><code class="language-bash">android hooking watch class com.example.app.CryptoUtil
</code></pre>
<pre><code class="language-bash"># æ‹¦æˆª encrypt æ–¹æ³•ï¼Œå¹¶æ‰“å°å‚æ•°å’Œè¿”å›å€¼
android hooking watch class_method com.example.app.CryptoUtil.encrypt --dump-args --dump-return
</code></pre>
<pre><code class="language-bash"># å¼ºåˆ¶ isRooted æ–¹æ³•è¿”å› false
android hooking set return_value com.example.app.Security.isRooted false
</code></pre>
<h2>3. å †æ“ä½œ</h2>
<p>å¯ä»¥æœç´¢å†…å­˜ä¸­å­˜åœ¨çš„å¯¹è±¡å®ä¾‹ï¼Œç”šè‡³è°ƒç”¨è¿™äº›å®ä¾‹çš„æ–¹æ³•ã€‚</p>
<ul>
<li><strong>æœç´¢å †ä¸­çš„å®ä¾‹</strong>:</li>
</ul>
<pre><code class="language-bash"># æŸ¥æ‰¾å†…å­˜ä¸­ç°å­˜çš„ User å®ä¾‹
android heap search instances com.example.app.User
</code></pre>
<pre><code class="language-bash"># å‡è®¾ä¸Šä¸€æ­¥æœç´¢åˆ°å®ä¾‹ hashcode ä¸º 123456
# è°ƒç”¨è¯¥å®ä¾‹çš„ getToken æ–¹æ³•
android heap execute 123456 getToken
</code></pre>
<pre><code class="language-bash"># æŸ¥çœ‹è¯¥å®ä¾‹çš„ username å­—æ®µå€¼
android heap evaluate 123456
# (è¿›å…¥ç¼–è¾‘å™¨åè¾“å…¥) console.log(clazz.username.value)
</code></pre>
<h2>4. Activity ä¸ Fragment</h2>
<ul>
<li><strong>æŸ¥çœ‹å½“å‰ Activity</strong>:</li>
</ul>
<pre><code class="language-bash">android hooking get current_activity
</code></pre>
<pre><code class="language-bash">android hooking list fragments
</code></pre>
<pre><code class="language-bash">android intent launch_activity com.example.app.SecretActivity
</code></pre>
<h2>5. å†…å­˜ä¸ SO åº“æ“ä½œ</h2>
<ul>
<li><strong>åˆ—å‡ºåŠ è½½çš„ SO åº“</strong>:</li>
</ul>
<pre><code class="language-bash">memory list modules
</code></pre>
<pre><code class="language-bash"># å°† libnative-lib.so å¯¼å‡ºåˆ°æœ¬åœ°æ–‡ä»¶ (ç”¨äºä¿®å¤è„±å£³åçš„ SO)
memory dump from_base 0x7b12345000 0x50000 output.so
# æˆ–è‡ªåŠ¨ä¸‹è½½
memory dump all libnative-lib.so
</code></pre>
<h2>6. æ–‡ä»¶ç³»ç»Ÿæ“ä½œ</h2>
<pre><code class="language-bash">ls
cd cache
cat log.txt
file download /data/data/com.example.app/shared_prefs/config.xml
</code></pre>
<h2>7. å®‰å…¨ç»•è¿‡</h2>
<ul>
<li><strong>ç¦ç”¨ SSL Pinning</strong>:</li>
</ul>
<pre><code class="language-bash">android sslpinning disable
</code></pre>
<pre><code class="language-bash">android root disable
</code></pre>
<h2>8. å¯¼å…¥è‡ªå®šä¹‰è„šæœ¬</h2>
<pre><code class="language-bash">import /path/to/my_script.js
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-39">
                                                <h2>39. R37: C For Emulation</h2>
                                                <h1>R37: C ä»£ç ï¼šç”¨äºè¿è¡Œæ—¶ä»¿çœŸä¸è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ</h1>
<p>åœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œç›´æ¥ä½¿ç”¨ C/C++ ç¼–å†™ä¸€äº›è¾…åŠ©å·¥å…·æˆ–é‡ç°ç›®æ ‡é€»è¾‘æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„ç­–ç•¥ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬è„±ç¦»å¤æ‚çš„ App ç¯å¢ƒï¼Œå¯¹æ ¸å¿ƒç®—æ³•è¿›è¡Œç‹¬ç«‹çš„æµ‹è¯•ã€Fuzzing æˆ–ä»¿çœŸã€‚</p>
<h1># 1. è¿è¡Œæ—¶ä»¿çœŸ (Runtime Emulation)</h1>
<p>å½“æˆ‘ä»¬åœ¨ SO æ–‡ä»¶ä¸­å®šä½åˆ°ä¸€ä¸ªå…³é”®çš„æ ¸å¿ƒç®—æ³•ï¼ˆå¦‚è‡ªå®šä¹‰åŠ å¯†ã€ç­¾åç”Ÿæˆï¼‰åï¼Œå¦‚æœè¯¥ç®—æ³•é€»è¾‘æ¸…æ™°ä¸”ä¾èµ–è¾ƒå°‘ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯å°†å…¶é€»è¾‘ç”¨ C/C++ â€œç¿»è¯‘â€ä¸€éã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹ï¼šé‡ç°ä¸€ä¸ªç®€å•çš„ XOR åŠ å¯†ç®—æ³•</strong></p>
<p>å‡è®¾åœ¨ IDA Pro ä¸­çœ‹åˆ°å¦‚ä¸‹ä¼ªä»£ç ï¼š</p>
<pre><code class="language-cpp">// Decompiled pseudo-code from IDA
void encrypt_data(char* data, int len) {
for (int i = 0; i &lt; len; ++i) {
data[i] = (data[i] ^ 0x5A) + 5;
}
}

</code></pre>
<p>// Re-implementation of the encryption algorithm
void simulate_encrypt(char** data, size_t len) {
for (size_t i = 0; i &lt; len; ++i) {
data[i] = (data[i] ^ 0x5A) + 5;
}
}</p>
<p>// Corresponding decryption for our own testing
void simulate_decrypt(char** data, size_t len) {
for (size_t i = 0; i &lt; len; ++i) {
data[i] = (data[i] - 5) ^ 0x5A;
}
}</p>
<p>int main() {
char my_data[] = &quot;this_is_a_test_message&quot;;
size_t len = strlen(my_data);</p>
<p>printf(&quot;Original: %s\n&quot;, my_data);</p>
<p>// Encrypt it
simulate_encrypt(my_data, len);
printf(&quot;Encrypted (as hex): &quot;);
for(size_t i = 0; i &lt; len; ++i) {
printf(&quot;%02x &quot;, (unsigned char)my_data[i]);
}
printf(&quot;\n&quot;);</p>
<p>// Decrypt it
simulate_decrypt(my_data, len);
printf(&quot;Decrypted: %s\n&quot;, my_data);</p>
<p>return 0;
}</p>
<pre><code>
# # 2. è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ (Device Fingerprint Generation)

è®¸å¤š App ä¼šé€šè¿‡è¯»å– Android ç³»ç»Ÿçš„ `build.prop` æˆ–å…¶ä»–ç³»ç»Ÿå±æ€§æ¥ç”Ÿæˆè®¾å¤‡æŒ‡çº¹ï¼Œç”¨äºè¯†åˆ«å’Œè·Ÿè¸ªè®¾å¤‡ã€‚åœ¨è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ¨¡æ‹Ÿè¿™äº›æŒ‡çº¹ã€‚

`getprop` æ˜¯ Android shell ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥è¯»å–ç³»ç»Ÿå±æ€§ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ C ä»£ç åœ¨ Native å±‚å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä»è€Œç”Ÿæˆå¯ä»¥ä¹±çœŸçš„æŒ‡çº¹æ•°æ®ã€‚

* *åœºæ™¯ç¤ºä¾‹ï¼šç”¨ C è¯»å–å…³é”®è®¾å¤‡å±æ€§å¹¶ç”Ÿæˆ JSON**

```c
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

// A simple wrapper to execute a shell command and get its output
// In a real scenario, you might use direct system calls for better performance/stealth
char* get_prop(const char* key) {
char command[256];
snprintf(command, sizeof(command), &quot;getprop %s&quot;, key);

FILE* fp = popen(command, &quot;r&quot;);
if (fp == NULL) {
return NULL;
}

char* line = malloc(256);
if (fgets(line, 256, fp) == NULL) {
free(line);
pclose(fp);
return NULL;
}

// Remove trailing newline
line[strcspn(line, &quot;\n&quot;)] = 0;
pclose(fp);
return line;
}

int main() {
// List of properties we want to fetch
const char* props_to_fetch[] = {
&quot;ro.product.brand&quot;,
&quot;ro.product.model&quot;,
&quot;ro.product.manufacturer&quot;,
&quot;ro.build.version.release&quot;,
&quot;ro.build.version.sdk&quot;,
&quot;ro.build.fingerprint&quot;
};
int num_props = sizeof(props_to_fetch) / sizeof(props_to_fetch[0]);

printf(&quot;{\n&quot;);
for (int i = 0; i &lt; num_props; ++i) {
char* value = get_prop(props_to_fetch[i]);
if (value) {
printf(&quot; \&quot;%s\&quot;: \&quot;%s\&quot;&quot;, props_to_fetch[i], value);
if (i &lt; num_props - 1) {
printf(&quot;,&quot;);
}
printf(&quot;\n&quot;);
free(value);
}
}
printf(&quot;}\n&quot;);

return 0;
}

</code></pre>
<pre><code>    ```bash
# (NDK_PATH is the path to your android NDK)
# This command is for arm64 architecture, adjust as needed
$NDK_PATH/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android21-clang fingerprinter.c -o fingerprinter
# Then push to device and run
# adb push fingerprinter /data/local/tmp/
# adb shell 'cd /data/local/tmp/ &amp;&amp; ./fingerprinter'

</code></pre>
<pre><code>
</code></pre>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">ğŸ› ï¸ Tools</h1>
                    
                                            <div class="section" id="section-40">
                                                <h2>40. Frida Guide</h2>
                                                <h1>Frida å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬ API å¤§å…¨</h1>
<p>Frida æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç æ’æ¡©å·¥å…·åŒ…ï¼Œå®ƒå…è®¸æ‚¨å°†è‡ªå·±çš„è„šæœ¬æ³¨å…¥åˆ°é»‘ç›’è¿›ç¨‹ä¸­ã€‚å®ƒå¯¹äºé€†å‘å·¥ç¨‹ã€å®‰å…¨ç ”ç©¶å’Œåº”ç”¨è°ƒè¯•éå¸¸æœ‰ç”¨ã€‚</p>
<hr />
<h1># ç›®å½•</h1>
<ul>
<li><a href="#frida-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B8%8E%E8%84%9A%E6%9C%AC-api-%E5%A4%A7%E5%85%A8">Frida å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬ API å¤§å…¨</a></li>
<li><a href="#-%E7%9B%AE%E5%BD%95"># ç›®å½•</a><ul>
<li><a href="#-frida-%E5%B7%A5%E5%85%B7%E9%9B%86"># Frida å·¥å…·é›†</a></li>
<li><a href="#-%E8%BF%9E%E6%8E%A5%E4%B8%8E%E9%99%84%E5%8A%A0%E6%A8%A1%E5%BC%8F"># è¿æ¥ä¸é™„åŠ æ¨¡å¼</a></li>
<li><a href="#-javascript-api-%E6%A0%B8%E5%BF%83"># JavaScript API (æ ¸å¿ƒ)</a><ul>
<li><a href="#-java-android"># Java (android)</a></li>
<li><a href="#-objective-c-ios"># Objective-C (iOS)</a></li>
<li><a href="#-%E9%80%9A%E7%94%A8%E5%8E%9F%E7%94%9F-native"># é€šç”¨/åŸç”Ÿ (Native)</a></li>
<li><a href="#-jni-java-native-interface"># JNI (Java Native Interface)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#-connect-to-device-and-attach-to-process-">... Connect to device and attach to process ...</a></li>
<li><a href="#script--sessioncreate_scriptjs_code">script = session.create_script(js_code)</a></li>
<li><a href="#">...</a></li>
<li><a href="#scriptload">script.load()</a></li>
<li><a href="#call-the-exported-function-from-the-script">Call the exported function from the script</a></li>
</ul>
<hr />
<h2># Frida å·¥å…·é›†</h2>
<p>è¿™äº›æ˜¯åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨çš„æ ¸å¿ƒ Frida å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>frida --version</code></td>
  <td>æŸ¥çœ‹ Frida ç‰ˆæœ¬</td>
</tr>
<tr>
  <td><code>frida-ps -U</code></td>
  <td>åˆ—å‡º USB è¿æ¥è®¾å¤‡ä¸Šçš„æ‰€æœ‰è¿›ç¨‹</td>
</tr>
<tr>
  <td><code>frida-ps -Ua</code></td>
  <td>åˆ—å‡º USB è¿æ¥è®¾å¤‡ä¸Šæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº</td>
</tr>
<tr>
  <td><code>frida-ps -Uai</code></td>
  <td>åˆ—å‡º USB è¿æ¥è®¾å¤‡ä¸Šæ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨ç¨‹åºåŠå…¶æ ‡è¯†ç¬¦</td>
</tr>
<tr>
  <td><code>frida-trace -U -f &lt;åŒ…å&gt; -i &quot;&lt;æ–¹æ³•&gt;&quot;</code></td>
  <td>è·Ÿè¸ªæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ï¼ˆé™„åŠ åˆ°æ–°è¿›ç¨‹ï¼‰</td>
</tr>
<tr>
  <td><code>frida-trace -U -p &lt;PID&gt; -i &quot;&lt;æ–¹æ³•&gt;&quot;</code></td>
  <td>è·Ÿè¸ªæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ï¼ˆé™„åŠ åˆ°ç°æœ‰è¿›ç¨‹ï¼‰</td>
</tr>
<tr>
  <td><code>frida -U -f &lt;åŒ…å&gt; -l &lt;è„šæœ¬.js&gt;</code></td>
  <td>Spawn ä¸€ä¸ªæ–°è¿›ç¨‹å¹¶æ³¨å…¥è„šæœ¬</td>
</tr>
<tr>
  <td><code>frida -U -p &lt;PID&gt; -l &lt;è„šæœ¬.js&gt;</code></td>
  <td>é™„åŠ åˆ°ç°æœ‰è¿›ç¨‹å¹¶æ³¨å…¥è„šæœ¬</td>
</tr>
<tr>
  <td><code>frida -U --no-pause -f &lt;åŒ…å&gt; -l &lt;è„šæœ¬.js&gt;</code></td>
  <td>Spawn æ–°è¿›ç¨‹å¹¶æ³¨å…¥è„šæœ¬ï¼Œä¸”ä¸æš‚åœä¸»çº¿ç¨‹</td>
</tr>
</tbody>
</table>
<hr />
<h2># è¿æ¥ä¸é™„åŠ æ¨¡å¼</h2>
<p>Frida æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹å¼æ¥ hook åº”ç”¨ï¼š</p>
<ul>
<li><p><strong>Spawn (Spawning)</strong>: Frida å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶ç«‹å³æš‚åœä¸»çº¿ç¨‹ï¼Œä»¥ä¾¿æ‚¨åœ¨åº”ç”¨ä»£ç æ‰§è¡Œå‰æ³¨å…¥è„šæœ¬ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—©æœŸè¿›è¡Œ Hook çš„åœºæ™¯ã€‚ä½¿ç”¨ <code>-f &lt;åŒ…å&gt;</code> å‚æ•°ã€‚</p>
</li>
<li><p><strong>Attach (Attaching)</strong>: Frida é™„åŠ åˆ°å·²ç»åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸Šã€‚è¿™å¯¹äº hook é‚£äº›åœ¨åº”ç”¨è¿è¡Œä¸­é€”æ‰ä¼šè§¦å‘çš„åŠŸèƒ½å¾ˆæœ‰ç”¨ã€‚ä½¿ç”¨ <code>-p &lt;PID&gt;</code> æˆ–åº”ç”¨åç§°ã€‚</p>
</li>
</ul>
<hr />
<h2># JavaScript API (æ ¸å¿ƒ)</h2>
<p>è¿™æ˜¯ Frida è„šæœ¬çš„æ ¸å¿ƒã€‚æ‰€æœ‰é€»è¾‘éƒ½åœ¨ JavaScript è„šæœ¬ä¸­å®ç°ã€‚</p>
<h3># Java (android)</h3>
<p>è¿™äº› API ç”¨äºä¸ Android çš„ Java è¿è¡Œæ—¶è¿›è¡Œäº¤äº’ã€‚æ‰€æœ‰ Java ç›¸å…³ä»£ç éƒ½å¿…é¡»åŒ…è£¹åœ¨ <code>Java.perform(function() { ... });</code> ä¸­ã€‚</p>
<table>
<thead>
<tr>
  <th>API/ä»£ç ç‰‡æ®µ</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Java.perform(function() { ... });</code></td>
  <td>Frida ä¸­ä¸ Java äº¤äº’çš„å…¥å£ç‚¹å’Œä½œç”¨åŸŸ</td>
</tr>
<tr>
  <td><code>Java.available</code></td>
  <td>æ£€æŸ¥ Java VM æ˜¯å¦å¯ç”¨</td>
</tr>
<tr>
  <td><code>var MyClass = Java.use('com.example.MyClass');</code></td>
  <td>è·å–ä¸€ä¸ªç±»çš„åŒ…è£…å™¨ï¼Œç”¨äºæ–¹æ³• Hook æˆ–åˆ›å»ºå®ä¾‹</td>
</tr>
<tr>
  <td><code>MyClass.myMethod.implementation = function(...) { ... }</code></td>
  <td>æ›¿æ¢ï¼ˆHookï¼‰ä¸€ä¸ªæ–¹æ³•çš„å®ç°</td>
</tr>
<tr>
  <td><code>this.myMethod(...)</code></td>
  <td>åœ¨ Hook çš„å®ç°ä¸­è°ƒç”¨åŸå§‹æ–¹æ³•</td>
</tr>
<tr>
  <td><code>MyClass.$new()</code></td>
  <td>åˆ›å»ºä¸€ä¸ªç±»çš„æ–°å®ä¾‹</td>
</tr>
<tr>
  <td><code>Java.choose('com.example.MyClass', { onMatch: ..., onComplete: ... })</code></td>
  <td>æŸ¥æ‰¾å †ä¸Šç‰¹å®šç±»çš„æ‰€æœ‰æ´»åŠ¨å®ä¾‹</td>
</tr>
<tr>
  <td><code>Java.cast(obj, MyClass)</code></td>
  <td>å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºç‰¹å®šçš„ç±»ç±»å‹</td>
</tr>
<tr>
  <td><code>Java.backtrace(this.context, true)</code></td>
  <td>è·å–å½“å‰çº¿ç¨‹çš„ Java è°ƒç”¨å †æ ˆ</td>
</tr>
<tr>
  <td><code>send(data)</code></td>
  <td>ä»è„šæœ¬å‘ Python/Node.js å·¥å…·å‘é€æ¶ˆæ¯</td>
</tr>
<tr>
  <td><code>recv(callback)</code></td>
  <td>ä» Python/Node.js å·¥å…·æ¥æ”¶æ¶ˆæ¯</td>
</tr>
</tbody>
</table>
<h3># Objective-C (iOS)</h3>
<p>è¿™äº› API ç”¨äºä¸ iOS çš„ Objective-C è¿è¡Œæ—¶è¿›è¡Œäº¤äº’ã€‚</p>
<table>
<thead>
<tr>
  <th>API/ä»£ç ç‰‡æ®µ</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>ObjC.classes.MyClass</code></td>
  <td>è·å–ä¸€ä¸ªç±»çš„å¼•ç”¨</td>
</tr>
<tr>
  <td><code>Interceptor.attach(ObjC.classes.MyClass['- myMethod'], { ... })</code></td>
  <td>é™„åŠ åˆ°æ–¹æ³•çš„å®ç° (Native Interceptor)</td>
</tr>
<tr>
  <td><code>ObjC.choose(ObjC.classes.MyClass, { ... })</code></td>
  <td>æŸ¥æ‰¾ç‰¹å®šç±»çš„æ‰€æœ‰æ´»åŠ¨å®ä¾‹</td>
</tr>
<tr>
  <td><code>ObjC.available</code></td>
  <td>æ£€æŸ¥ Objective-C è¿è¡Œæ—¶æ˜¯å¦å¯ç”¨</td>
</tr>
</tbody>
</table>
<h3># é€šç”¨/åŸç”Ÿ (Native)</h3>
<p>è¿™äº› API ç”¨äºä¸åŸç”Ÿä»£ç ï¼ˆC/C++ï¼‰è¿›è¡Œäº¤äº’ï¼Œè·¨å¹³å°é€šç”¨ã€‚</p>
<table>
<thead>
<tr>
  <th>API/ä»£ç ç‰‡æ®µ</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Interceptor.attach(ptr(&quot;...&quot;), { onEnter: ..., onLeave: ... })</code></td>
  <td>æ‹¦æˆªæŒ‡å®šåœ°å€çš„åŸç”Ÿå‡½æ•°è°ƒç”¨</td>
</tr>
<tr>
  <td><code>Module.findExportByName(&quot;libname.so&quot;, &quot;function_name&quot;)</code></td>
  <td>æŒ‰åç§°æŸ¥æ‰¾æ¨¡å—ï¼ˆåº“ï¼‰çš„å¯¼å‡ºå‡½æ•°åœ°å€</td>
</tr>
<tr>
  <td><code>Module.findBaseAddress(&quot;libname.so&quot;)</code></td>
  <td>è·å–æ¨¡å—åŠ è½½çš„åŸºåœ°å€</td>
</tr>
<tr>
  <td><code>Memory.readByteArray(address, size)</code></td>
  <td>ä»æŒ‡å®šåœ°å€è¯»å–å­—èŠ‚æ•°ç»„</td>
</tr>
<tr>
  <td><code>Memory.writeByteArray(address, bytes)</code></td>
  <td>å‘æŒ‡å®šåœ°å€å†™å…¥å­—èŠ‚æ•°ç»„</td>
</tr>
<tr>
  <td><code>NativeFunction(address, returnType, argTypes)</code></td>
  <td>åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨çš„åŸç”Ÿå‡½æ•°å¯¹è±¡</td>
</tr>
<tr>
  <td><code>ptr(&quot;0x...&quot;)</code></td>
  <td>åˆ›å»ºä¸€ä¸ªåŸç”ŸæŒ‡é’ˆ</td>
</tr>
<tr>
  <td><code>Thread.backtrace(this.context, Backtracer.ACCURATE)</code></td>
  <td>è·å–å½“å‰çº¿ç¨‹çš„åŸç”Ÿè°ƒç”¨å †æ ˆ</td>
</tr>
</tbody>
</table>
<h3># JNI (Java Native Interface)</h3>
<p>JNI æ˜¯ Android é€†å‘ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒFrida æä¾›äº†å¼ºå¤§çš„ JNI Hook èƒ½åŠ›ã€‚</p>
<table>
<thead>
<tr>
  <th>API/ä»£ç ç‰‡æ®µ</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Module.findExportByName(&quot;lib.so&quot;, &quot;Java_com_pkg_Class_method&quot;)</code></td>
  <td>æŸ¥æ‰¾ JNI å‡½æ•°åœ°å€</td>
</tr>
<tr>
  <td><code>Java.vm.getEnv()</code></td>
  <td>è·å–å½“å‰çº¿ç¨‹çš„ JNIEnv æŒ‡é’ˆ</td>
</tr>
<tr>
  <td><code>Java.vm.tryGetEnv()</code></td>
  <td>å°è¯•è·å– JNIEnvï¼ˆä¸ä¼šæŠ›å¼‚å¸¸ï¼‰</td>
</tr>
<tr>
  <td><code>Java.vm.perform(callback)</code></td>
  <td>åœ¨ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¸­æ‰§è¡Œå›è°ƒ</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>JNI Hook ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="language-javascript">// Hook JNI Function
var jni_func = Module.findExportByName(
  &quot;libnative.so&quot;,
  &quot;Java_com_example_app_Crypto_encrypt&quot;
);

if (jni_func) {
  Interceptor.attach(jni_func, {
    onEnter: function (args) {
      console.log(&quot;[JNI Hook] encrypt() called&quot;);

      // args[0] = JNIEnv*
      // args[1] = jclass/jobject
      // args[2] = first Java parameter

      // Read jstring parameter
      if (args[2]) {
        var env = Java.vm.getEnv();
        var jstr = args[2];
        var cstr = env.getStringUtfChars(jstr, null);
        console.log(&quot;Input: &quot; + cstr.readCString());
        env.releaseStringUtfChars(jstr, cstr);
      }
    },
    onLeave: function (retval) {
      // Read returned jstring
      if (retval &amp;&amp; !retval.isNull()) {
        var env = Java.vm.getEnv();
        var cstr = env.getStringUtfChars(retval, null);
        console.log(&quot;Output: &quot; + cstr.readCString());
        env.releaseStringUtfChars(retval, cstr);
      }
    },
  });
}

// Also hook the native method call from Java layer
Java.perform(function () {
  var Crypto = Java.use(&quot;com.example.app.Crypto&quot;);

  Crypto.encrypt.implementation = function (input) {
    console.log(&quot;[Java Hook] encrypt called with: &quot; + input);
    var result = this.encrypt(input);
    console.log(&quot;[Java Hook] encrypt returned: &quot; + result);
    return result;
  };
});
</code></pre>
<p>var module = Process.getModuleByName(moduleName);
var exports = module.enumerateExports();</p>
<p>console.log(&quot;[JNI Enumeration] &quot; + moduleName);
exports.forEach(function(exp) {
if (exp.name.startsWith(&quot;Java_&quot;)) {
console.log(&quot; &quot; + exp.name + &quot; @ &quot; + exp.address);
}
});
}</p>
<p>// Usage example
enumerateJNIFunctions(&quot;libnative.so&quot;);</p>
<pre><code>Java.perform(function() {
var MyClass = Java.use('com.example.SecretClass');

MyClass.secretMethod.implementation = function(arg1, arg2) {
console.log('secretMethod called with:', arg1, arg2);

// Call original method and get return value
var retval = this.secretMethod(arg1, arg2);
console.log('Original return value:', retval);

return retval; // Return original value
};
});

</code></pre>
<p>PremiumUtils.isUserPremium.implementation = function() {
console.log('Bypassing isUserPremium check...');
return true; // Always return true to bypass VIP check
};
});</p>
<pre><code>onMatch: function(instance) {
console.log('Found UserManager instance:', instance);
console.log('User ID:', instance.getUserId());
},
onComplete: function() {
console.log('Search complete.');
}
});
});

</code></pre>
<p>User.$init.implementation = function(name, age) {
console.log('User object created with name:', name, 'and age:', age);</p>
<p>// Call original constructor
this.$init(name, age);
};
});</p>
<pre><code>// args[0] is the SSL context
// args[1] is the buffer
// args[2] is the size
console.log(&quot;Intercepted SSL_write, size:&quot;, args[2].toInt32());
// You can use hexdump(args[1]) to view the data
},
onLeave: function(retval) {
// retval is the original return value
console.log(&quot;SSL_write returned:&quot;, retval.toInt32());
}
});

</code></pre>
<pre><code class="language-javascript">function getSecretValueFromApp() {
  var secret = &quot;&quot;;
  Java.perform(function () {
    // Assume there's a method to get the secret value
    var Utils = Java.use(&quot;com.example.Utils&quot;);
    secret = Utils.getSecret();
  });
  return secret;
}

// Export function
rpc.exports.getsecret = getSecretValueFromApp;
</code></pre>
<h1>... Connect to device and attach to process ...</h1>
<h1>script = session.create_script(js_code)</h1>
<h1>...</h1>
<h1>script.load()</h1>
<h1>Call the exported function from the script</h1>
<p>secret = script.exports.getsecret()
print(&quot;Secret from app:&quot;, secret)</p>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-41">
                                                <h2>41. Frida Internals</h2>
                                                <h1>Frida æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†</h1>
<p>Frida æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åŠ¨æ€æ’æ¡©æ¡†æ¶ï¼Œä½†è¦å……åˆ†åˆ©ç”¨å®ƒï¼Œç†è§£å…¶å†…éƒ¨å·¥ä½œåŸç†è‡³å…³é‡è¦ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨æ„æˆ Frida çš„å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ã€å®ƒä»¬çš„ä½œç”¨ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#frida-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">Frida æ ¸å¿ƒæ¨¡å—ä¸å®ç°åŸç†</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#frida-%E7%9A%84-architecture-%E6%A6%82%E8%A7%88">Frida çš„ architecture æ¦‚è§ˆ</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3">æ ¸å¿ƒç»„ä»¶è¯¦è§£</a><ul>
<li><a href="#frida-server-%E8%AE%BE%E5%A4%87%E7%AB%AF%E7%9A%84%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><strong>Frida-Server</strong>: è®¾å¤‡ç«¯çš„å®ˆæŠ¤è¿›ç¨‹</a></li>
<li><a href="#frida-core-%E6%B3%A8%E5%85%A5%E7%9B%AE%E6%A0%87%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%A0%B8%E5%BF%83%E5%BC%95%E6%93%8E"><strong>Frida-Core</strong>: æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„æ ¸å¿ƒå¼•æ“</a></li>
<li><a href="#frida-gum-%E5%AE%9E%E7%8E%B0-hook-%E7%9A%84%E9%AD%94%E6%B3%95%E6%A3%92"><strong>Frida-Gum</strong>: å®ç° Hook çš„é­”æ³•æ£’</a><ul>
<li><a href="#interceptor-%E5%87%BD%E6%95%B0%E6%8B%A6%E6%88%AA%E5%99%A8"><code>Interceptor</code>: å‡½æ•°æ‹¦æˆªå™¨</a></li>
<li><a href="#stalker-%E6%8C%87%E4%BB%A4%E7%BA%A7%E8%B7%9F%E8%B8%AA%E5%99%A8"><code>Stalker</code>: æŒ‡ä»¤çº§è·Ÿè¸ªå™¨</a></li>
</ul>
</li>
<li><a href="#javascript-v8-%E8%BF%90%E8%A1%8C%E6%97%B6-%E8%84%9A%E6%9C%AC%E7%9A%84%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83"><strong>JavaScript (V8) è¿è¡Œæ—¶</strong>: è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒ</a></li>
<li><a href="#%E8%AF%AD%E8%A8%80%E7%BB%91%E5%AE%9A-bindings-%E4%BD%A0%E7%9A%84%E6%8E%A7%E5%88%B6%E5%8F%B0"><strong>è¯­è¨€ç»‘å®š (Bindings)</strong>: ä½ çš„æ§åˆ¶å°</a></li>
</ul>
</li>
<li><a href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%B8%B2%E8%AE%B2">å·¥ä½œæµç¨‹ä¸²è®²</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>Frida çš„ architecture æ¦‚è§ˆ</h3>
<p>Frida é‡‡ç”¨çš„æ˜¯ä¸€ç§<strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨ (Client-Server)</strong> æ¶æ„ã€‚</p>
<p>!!! question &quot;æ€è€ƒï¼šä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å¤æ‚çš„æ¶æ„ï¼Ÿ&quot;
Frida ä¸ºä»€ä¹ˆä¸è®¾è®¡æˆä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œè€Œè¦åˆ†æˆå®¢æˆ·ç«¯ã€æœåŠ¡å™¨ã€Agent ä¸‰å±‚ï¼Ÿ</p>
<ul>
<li><strong>è·¨å¹³å°çš„å¿…ç„¶é€‰æ‹©</strong>ï¼š</li>
</ul>
<ul>
<li><strong>éš”ç¦»æ€§</strong>ï¼šä½ çš„åˆ†æè„šæœ¬ï¼ˆPythonï¼‰è¿è¡Œåœ¨ PCï¼Œä¸ä¼šå½±å“ç›®æ ‡è®¾å¤‡çš„æ€§èƒ½</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šServer åªè´Ÿè´£è¿›ç¨‹ç®¡ç†å’Œæ³¨å…¥ï¼ŒçœŸæ­£çš„&quot;å±é™©æ“ä½œ&quot;åœ¨éš”ç¦»çš„è¿›ç¨‹å†…</li>
<li><strong>çµæ´»æ€§</strong>ï¼šåŒä¸€ä¸ª Server å¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡ï¼Œæ”¯æŒå›¢é˜Ÿåä½œ</li>
<li><strong>è·¨è¯­è¨€</strong>ï¼šPC ç«¯ç”¨ Python/Node.js ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œç›®æ ‡è¿›ç¨‹å†…ç”¨ JavaScript æ“ä½œå†…å­˜ï¼Œå„å–æ‰€é•¿</li>
</ul>
<p>è¿™ç§æ¶æ„çš„æœ¬è´¨æ˜¯ï¼š<strong>æŠŠ&quot;æ§åˆ¶&quot;å’Œ&quot;æ‰§è¡Œ&quot;åˆ†ç¦»</strong>ï¼Œå°±åƒé¥æ§æ— äººæœºâ€”â€”é¥æ§å™¨åœ¨ä½ æ‰‹ä¸Šï¼Œä½†é£è¡Œé€»è¾‘åœ¨æœºä¸Šã€‚</p>
<ul>
<li><p><strong>å®¢æˆ·ç«¯ (Client)</strong>: è¿è¡Œåœ¨ä½  PC ä¸Šçš„éƒ¨åˆ†ã€‚è¿™åŒ…æ‹¬ä½ ç¼–å†™çš„ Python æˆ– Node.js è„šæœ¬ï¼Œä»¥åŠä½ ä½¿ç”¨çš„ Frida å‘½ä»¤è¡Œå·¥å…· (<code>frida</code>, <code>frida-trace</code> ç­‰)ã€‚</p>
</li>
<li><p><strong>æœåŠ¡å™¨ (Server)</strong>: åœ¨ç›®æ ‡è®¾å¤‡ï¼ˆå¦‚ Android æ‰‹æœºï¼‰ä¸Šä»¥åå°å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œçš„ <code>frida-server</code>ã€‚</p>
</li>
<li><p><strong>Agent</strong>: å½“ä½ é™„åŠ åˆ°ä¸€ä¸ªç›®æ ‡è¿›ç¨‹æ—¶ï¼ŒFrida ä¼šå°†ä¸€ä¸ªåŠ¨æ€åº“ (<code>frida-agent.so</code>) <strong>æ³¨å…¥</strong>åˆ°è¯¥è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ã€‚è¿™ä¸ª Agent è´Ÿè´£æ‰§è¡Œä½ åœ¨å®¢æˆ·ç«¯è„šæœ¬ä¸­å®šä¹‰çš„é€»è¾‘ã€‚</p>
</li>
</ul>
<p><img src="https://frida.re/static/images/frida-architecture.png" alt="Frida Architecture" /></p>
<ul>
<li>å›¾ç‰‡æ¥æº: frida.re*</li>
</ul>
<hr />
<h3>æ ¸å¿ƒç»„ä»¶è¯¦è§£</h3>
<h4><strong>Frida-Server</strong>: è®¾å¤‡ç«¯çš„å®ˆæŠ¤è¿›ç¨‹</h4>
<p><code>frida-server</code> æ˜¯ä¸€ä¸ªåœ¨ç›®æ ‡è®¾å¤‡ä¸Šè¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒçš„ä¸»è¦èŒè´£æ˜¯ï¼š</p>
<ol>
<li><strong>ç›‘å¬è¿æ¥</strong>: ç›‘å¬æ¥è‡ªä½  PC ä¸Š Frida å®¢æˆ·ç«¯çš„ TCP è¿æ¥ã€‚</li>
<li><strong>è¿›ç¨‹ç®¡ç†</strong>: æšä¸¾ç›®æ ‡è®¾å¤‡ä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè·å–åº”ç”¨ä¿¡æ¯ã€‚</li>
<li><strong>æ³¨å…¥ Agent</strong>: å½“å®¢æˆ·ç«¯æŒ‡å®šè¦é™„åŠ  (attach) æˆ–å¯åŠ¨ (spawn) ä¸€ä¸ªåº”ç”¨æ—¶ï¼Œ<code>frida-server</code> è´Ÿè´£å°† <code>frida-agent.so</code> æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹ä¸­ã€‚åœ¨ Android ä¸Šï¼Œå®ƒé€šå¸¸é€šè¿‡ <code>ptrace</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</li>
</ol>
<h4><strong>Frida-Core</strong>: æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„æ ¸å¿ƒå¼•æ“</h4>
<p><code>frida-core</code> æ˜¯ Frida çš„æ ¸å¿ƒï¼Œå®ƒè¢«ç¼–è¯‘æˆ <code>frida-agent.so</code> å¹¶æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„å¤šå¹³å°åº“ï¼Œä¸»è¦è´Ÿè´£ï¼š</p>
<ol>
<li><strong>è¿›ç¨‹å†…é€šä¿¡</strong>: å»ºç«‹ä¸€ä¸ªä¸ <code>frida-server</code> çš„é€šä¿¡æ¸ é“ï¼Œä»è€Œé—´æ¥åœ°ä¸ä½ çš„ PC å®¢æˆ·ç«¯é€šä¿¡ã€‚</li>
<li><strong>åŠ è½½ JavaScript å¼•æ“</strong>: å®ƒå†…éƒ¨åµŒå…¥äº†ä¸€ä¸ª Google V8 JavaScript å¼•æ“ã€‚</li>
<li><strong>æš´éœ²åŸç”Ÿ API</strong>: å°†åº•å±‚çš„ <code>frida-gum</code> åŠŸèƒ½é€šè¿‡ JavaScript API (å¦‚ <code>Interceptor</code>, <code>Memory</code>, <code>NativePointer</code>) æš´éœ²ç»™ç”¨æˆ·è„šæœ¬ã€‚</li>
</ol>
<h4><strong>Frida-Gum</strong>: å®ç° Hook çš„é­”æ³•æ£’</h4>
<p><code>frida-gum</code> æ˜¯ <code>frida-core</code> ä¸­æœ€å…·é­”åŠ›çš„éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ä»£ç æ’æ¡©å·¥å…·åŒ…ã€‚æ‰€æœ‰ Hook å’Œä»£ç è·Ÿè¸ªåŠŸèƒ½éƒ½ç”±å®ƒæä¾›ã€‚</p>
<h5><code>Interceptor</code>: å‡½æ•°æ‹¦æˆªå™¨</h5>
<p><code>Interceptor</code> æ˜¯ä½ æœ€å¸¸ä½¿ç”¨çš„åŠŸèƒ½ï¼Œç”¨äº Hook/Trace/æ›¿æ¢ä»»æ„å‡½æ•°ã€‚</p>
<p>!!! tip &quot;æ·±å…¥ç†è§£ï¼šHook çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ&quot;
å¾ˆå¤šäººæŠŠ Hook å½“æˆ&quot;é»‘é­”æ³•&quot;ï¼Œä½†å…¶å®åŸç†å¾ˆæœ´ç´ ï¼š</p>
<ul>
<li><strong>Hook = åŠ«æŒç¨‹åºçš„æ‰§è¡Œæµ</strong></li>
</ul>
<p>æƒ³è±¡ä½ åœ¨é«˜é€Ÿå…¬è·¯ä¸Šè®¾ç½®äº†ä¸€ä¸ªæ”¶è´¹ç«™ï¼š</p>
<ol>
<li><strong>åŸå§‹é“è·¯</strong>ï¼šå‡½æ•°çš„æ­£å¸¸æ‰§è¡Œæµç¨‹</li>
<li><strong>æ”¶è´¹ç«™ï¼ˆTrampolineï¼‰</strong>ï¼šä½ æ’å…¥çš„ä»£ç </li>
<li><strong>æ”¹é“æ ‡å¿—ï¼ˆJMPï¼‰</strong>ï¼šä¿®æ”¹å‡½æ•°å…¥å£çš„è·³è½¬æŒ‡ä»¤</li>
<li><strong>æ¢å¤é€šè¡Œ</strong>ï¼šæ‰§è¡ŒåŸå§‹æŒ‡ä»¤åç»§ç»­</li>
</ol>
<p>ç†è§£äº†è¿™ä¸ªæœ¬è´¨ï¼Œä½ å°±èƒ½ï¼š</p>
<ul>
<li>åˆ¤æ–­å“ªäº› Hook ä¼šç›¸äº’å†²çªï¼ˆéƒ½ä¿®æ”¹åŒä¸€ä¸ªå‡½æ•°å…¥å£ï¼‰</li>
<li>ç†è§£ä¸ºä»€ä¹ˆæœ‰äº›å Hook æ£€æµ‹èƒ½å‘ç°ä½ ï¼ˆæ£€æŸ¥å‡½æ•°å¤´çš„ä¿®æ”¹ï¼‰</li>
<li>çŸ¥é“å¦‚ä½•å†™æ›´éšè”½çš„ Hookï¼ˆinline hook vs. PLT/GOT hookï¼‰</li>
</ul>
<ul>
<li><strong>å®ç°åŸç†</strong>:</li>
</ul>
<ol>
<li><strong>åŠ¨æ€ä»£ç ç”Ÿæˆ</strong>: å½“ä½  <code>Interceptor.attach</code> ä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒFrida-Gum ä¼šåœ¨å†…å­˜ä¸­åŠ¨æ€åœ°ç”Ÿæˆä¸€å°æ®µæ±‡ç¼–ä»£ç ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>è¹¦åºŠ (Trampoline)</strong>ã€‚</li>
<li><strong>å‡½æ•°å¤´é‡å†™ (Prologue Rewriting)</strong>: Frida-Gum ä¼šä¿®æ”¹ç›®æ ‡å‡½æ•°å…¥å£ç‚¹ï¼ˆå‡½æ•°å¤´ï¼‰çš„å‡ æ¡æŒ‡ä»¤ï¼Œå°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ª<strong>æ— æ¡ä»¶è·³è½¬ (<code>JMP</code>) æŒ‡ä»¤</strong>ï¼Œè¯¥æŒ‡ä»¤æŒ‡å‘åˆšåˆšåˆ›å»ºçš„è¹¦åºŠã€‚Frida ä¼šéå¸¸å°å¿ƒåœ°ä¿å­˜è¢«å®ƒè¦†ç›–æ‰çš„åŸå§‹æŒ‡ä»¤ã€‚</li>
<li><strong>æ‰§è¡Œæµç¨‹</strong>:</li>
</ol>
<ul>
<li><p>å½“åº”ç”¨è°ƒç”¨ç›®æ ‡å‡½æ•°æ—¶ï¼Œå®ƒä¼šé¦–å…ˆè·³è½¬åˆ°è¹¦åºŠã€‚</p>
</li>
<li><p>è¹¦åºŠä»£ç ä¼šä¿å­˜å½“å‰çš„ CPU ä¸Šä¸‹æ–‡ï¼ˆå¯„å­˜å™¨çŠ¶æ€ï¼‰ï¼Œç„¶åè°ƒç”¨ä½ åœ¨ JavaScript ä¸­å®šä¹‰çš„ <code>onEnter</code> å›è°ƒã€‚</p>
</li>
<li><p><code>onEnter</code> æ‰§è¡Œå®Œæ¯•åï¼Œè¹¦åºŠä¼šæ‰§è¡Œè¢«å®ƒè¦†ç›–æ‰çš„åŸå§‹å‡½æ•°æŒ‡ä»¤ï¼Œç„¶åè·³è½¬å›åŸå§‹å‡½æ•°çš„å‰©ä½™éƒ¨åˆ†ç»§ç»­æ‰§è¡Œã€‚</p>
</li>
<li><p>å½“åŸå§‹å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œæ§åˆ¶æƒè¿”å›ç»™è¹¦åºŠï¼Œè¹¦åºŠå†è°ƒç”¨ä½ çš„ <code>onLeave</code> å›è°ƒã€‚</p>
</li>
<li><p>æœ€åï¼Œè¹¦åºŠæ¢å¤ä¹‹å‰ä¿å­˜çš„ CPU ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†è¿”å›å€¼ä¼ é€’ç»™åŸå§‹çš„è°ƒç”¨è€…ã€‚</p>
</li>
</ul>
<h5><code>Stalker</code>: æŒ‡ä»¤çº§è·Ÿè¸ªå™¨</h5>
<p><code>Stalker</code> æ˜¯ Frida çš„ä»£ç è·Ÿè¸ªå¼•æ“ï¼ŒåŠŸèƒ½æå…¶å¼ºå¤§ä½†ä½¿ç”¨ä¹Ÿæ›´å¤æ‚ã€‚å®ƒå¯ä»¥ç”¨æ¥è®°å½•ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡çš„<strong>æ¯ä¸€æ¡</strong>æ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<ul>
<li><strong>å®ç°åŸç† (åŸºäºåŠ¨æ€é‡æ–°ç¼–è¯‘)</strong>:</li>
</ul>
<ol>
<li><strong>åŸºæœ¬å— (Basic Block)</strong>: Stalker å°†ä»£ç åˆ†è§£ä¸ºâ€œåŸºæœ¬å—â€ã€‚ä¸€ä¸ªåŸºæœ¬å—æ˜¯ä¸€ç³»åˆ—è¿ç»­çš„æŒ‡ä»¤ï¼Œåªæœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œä¸€ä¸ªå‡ºå£ç‚¹ï¼ˆé€šå¸¸æ˜¯è·³è½¬æˆ–è¿”å›æŒ‡ä»¤ï¼‰ã€‚</li>
<li><strong>ä»£ç æ‹·è´ä¸æ’æ¡©</strong>: å½“ä¸€ä¸ªçº¿ç¨‹å°†è¦æ‰§è¡ŒæŸä¸ªåŸºæœ¬å—æ—¶ï¼ŒStalker ä¼šï¼š
a. å°†è¿™ä¸ªåŸºæœ¬å—çš„æ‰€æœ‰æŒ‡ä»¤<strong>æ‹·è´</strong>åˆ°ä¸€å—æ–°çš„å†…å­˜åŒºåŸŸã€‚
b. åœ¨è¿™ä»½æ‹·è´ä¸­<strong>æ’å…¥</strong>ä½ çš„åˆ†æä»£ç ï¼ˆä¾‹å¦‚ï¼Œè®°å½•æŒ‡ä»¤åœ°å€ã€å¯„å­˜å™¨å€¼çš„ä»£ç ï¼‰ã€‚
c. æ‰§è¡Œè¿™ä»½è¢«æ’æ¡©åçš„ä»£ç å‰¯æœ¬ã€‚</li>
<li><strong>ä»£ç ç¼“å­˜ (Code Cache)</strong>: Stalker ä¼šç¼“å­˜è¿™äº›è¢«ä¿®æ”¹è¿‡çš„åŸºæœ¬å—ã€‚ä¸‹æ¬¡å†æ‰§è¡Œåˆ°åŒä¸€ä¸ªåŸºæœ¬å—æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„ç‰ˆæœ¬ï¼Œæå¤§åœ°æé«˜äº†æ€§èƒ½ã€‚</li>
<li><strong>é“¾æ¥ (Chaining)</strong>: Stalker ä¼šä¿®æ”¹æ¯ä¸ªæ’æ¡©ååŸºæœ¬å—çš„æœ«å°¾ï¼Œä½¿å…¶è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå³å°†æ‰§è¡Œçš„åŸå§‹åŸºæœ¬å—å¯¹åº”çš„â€œæ’æ¡©ç‰ˆæœ¬â€ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è·Ÿè¸ªé“¾ã€‚</li>
</ol>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>Stalker</code> é€šè¿‡åˆ›å»ºå’Œæ‰§è¡ŒåŸå§‹ä»£ç çš„â€œå¸¦ç›‘æ§çš„å‰¯æœ¬â€æ¥å®ç°æ— æ­»è§’çš„æŒ‡ä»¤çº§è·Ÿè¸ªã€‚</p>
<h4><strong>JavaScript (V8) è¿è¡Œæ—¶</strong>: è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒ</h4>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨ JavaScript å†™ Hook é€»è¾‘ï¼Ÿå› ä¸º <code>frida-agent.so</code> åœ¨æ³¨å…¥ç›®æ ‡è¿›ç¨‹åï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ª V8 å¼•æ“å®ä¾‹ã€‚ä½ çš„ JS è„šæœ¬è¢«å®Œæ•´åœ°åŠ è½½åˆ°è¿™ä¸ª V8 å¼•æ“ä¸­æ‰§è¡Œã€‚</p>
<p>è¿™å¸¦æ¥äº†å·¨å¤§çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li><p><strong>é«˜çº§è¯­è¨€çš„ä¾¿åˆ©æ€§</strong>: ä½ å¯ä»¥åœ¨ç›®æ ‡è¿›ç¨‹çš„åœ°å€ç©ºé—´å†…ï¼Œç”¨ JavaScript çš„ä¾¿åˆ©æ€§æ¥æ“ä½œå†…å­˜ã€è°ƒç”¨å‡½æ•°ã€‚</p>
</li>
<li><p><strong>JIT ç¼–è¯‘</strong>: V8 çš„å³æ—¶ç¼–è¯‘ (JIT) ç‰¹æ€§ä½¿å¾—ä½ çš„ JS è„šæœ¬èƒ½ä»¥æ¥è¿‘åŸç”Ÿçš„é€Ÿåº¦è¿è¡Œï¼Œæ€§èƒ½è¿œè¶…è§£é‡Šæ‰§è¡Œã€‚</p>
</li>
<li><p><strong>å¼ºå¤§çš„ç”Ÿæ€</strong>: å¯ä»¥åˆ©ç”¨ç°æœ‰çš„ JS åº“ã€‚</p>
</li>
</ul>
<h4><strong>è¯­è¨€ç»‘å®š (Bindings)</strong>: ä½ çš„æ§åˆ¶å°</h4>
<p><code>frida-python</code>, <code>frida-node</code> ç­‰åº“æ˜¯ä½ çš„â€œæ§åˆ¶ç«¯â€ã€‚å®ƒä»¬è´Ÿè´£ï¼š</p>
<ul>
<li><p><strong>è¿æ¥ Server</strong>: ä¸è®¾å¤‡ä¸Šçš„ <code>frida-server</code> å»ºç«‹é€šä¿¡ã€‚</p>
</li>
<li><p><strong>å‘é€æŒ‡ä»¤</strong>: å°†ä½ çš„æŒ‡ä»¤ï¼ˆå¦‚â€œé™„åŠ åˆ° PID 1234â€ï¼‰å‘é€ç»™ <code>frida-server</code>ã€‚</p>
</li>
<li><p><strong>åŠ è½½è„šæœ¬</strong>: å°†ä½ çš„ <code>.js</code> è„šæœ¬æ–‡ä»¶å†…å®¹å‘é€ç»™ <code>frida-agent.so</code> é‡Œçš„ V8 å¼•æ“å»æ‰§è¡Œã€‚</p>
</li>
<li><p><strong>åŒå‘é€šä¿¡ (RPC)</strong>: å»ºç«‹ä¸€ä¸ªåŒå‘çš„ RPC é€šé“ã€‚è¿™ä½¿å¾—ä½ åœ¨ JS ä¸­è°ƒç”¨ <code>send()</code> çš„æ•°æ®èƒ½è¢« Python çš„ <code>on_message</code> å›è°ƒæ¥æ”¶ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
</li>
</ul>
<hr />
<h3>å·¥ä½œæµç¨‹ä¸²è®²</h3>
<p>å½“ä½ æ‰§è¡Œ <code>frida -U -f com.example.app -l script.js</code> æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<ol>
<li><strong>[PC]</strong> <code>frida</code> (Python å®¢æˆ·ç«¯) è§£æå‘½ä»¤ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯é€šè¿‡ USB è¿æ¥åˆ°æ‰‹æœºä¸Šçš„ <code>frida-server</code>ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯å‘ <code>frida-server</code> å‘é€æŒ‡ä»¤ï¼šâ€œè¯·ä»¥ <code>spawn</code> æ¨¡å¼å¯åŠ¨ <code>com.example.app</code>â€ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-server</code> æ‰¾åˆ° <code>com.example.app</code> å¹¶å¯åŠ¨å®ƒï¼Œä½†ä½¿å…¶å¤„äº<strong>æš‚åœ</strong>çŠ¶æ€ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-server</code> å°† <code>frida-agent.so</code> æ³¨å…¥åˆ°è¿™ä¸ªæ–°åˆ›å»ºçš„åº”ç”¨è¿›ç¨‹ä¸­ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-agent.so</code> åœ¨è¿›ç¨‹å†…åˆå§‹åŒ–ï¼Œå¯åŠ¨ V8 å¼•æ“ï¼Œå¹¶å»ºç«‹ä¸ <code>frida-server</code> çš„å†…éƒ¨é€šä¿¡ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯è¯»å– <code>script.js</code> çš„å†…å®¹ï¼Œå¹¶é€šè¿‡ <code>frida-server</code> å°†å…¶å‘é€ç»™ <code>frida-agent.so</code>ã€‚</li>
<li><strong>[Phone]</strong> <code>frida-agent.so</code> ä¸­çš„ V8 å¼•æ“æ‰§è¡Œ <code>script.js</code> çš„ä»£ç ï¼ˆä¾‹å¦‚ï¼Œ<code>Interceptor.attach(...)</code>ï¼‰ã€‚</li>
<li><strong>[PC -&gt; Phone]</strong> å®¢æˆ·ç«¯å‘é€â€œæ¢å¤è¿›ç¨‹â€çš„æŒ‡ä»¤ã€‚</li>
<li><strong>[Phone]</strong> åº”ç”¨è¿›ç¨‹ä»æš‚åœçŠ¶æ€ä¸­æ¢å¤ï¼Œå¼€å§‹æ­£å¸¸æ‰§è¡Œã€‚å½“å®ƒè°ƒç”¨è¢« Hook çš„å‡½æ•°æ—¶ï¼Œä½ åœ¨ <code>script.js</code> ä¸­å®šä¹‰çš„é€»è¾‘å°±ä¼šè¢«è§¦å‘ã€‚</li>
<li><strong>[åŒå‘]</strong> è„šæœ¬ä¸­çš„ <code>send()</code> æ¶ˆæ¯ä¼šé€šè¿‡ <code>agent -&gt; server -&gt; client</code> çš„è·¯å¾„å›åˆ°ä½ çš„ PC ç»ˆç«¯ä¸Šæ˜¾ç¤ºã€‚</li>
</ol>

                                            </div>
                                            
                                            <div class="section" id="section-42">
                                                <h2>42. Xposed Guide</h2>
                                                <h1>Xposed æ¡†æ¶å…¥é—¨</h1>
<h2>Xposed æ˜¯ä¸€ä¸ªåœ¨ Android å¹³å°ä¸Šå¹¿å—æ¬¢è¿çš„åŠ¨æ€ä»£ç  Hook æ¡†æ¶ã€‚ä¸ Frida ä¸»è¦ç”¨äºå®æ—¶ã€ä¸´æ—¶çš„åˆ†æä¸åŒï¼ŒXposed æ—¨åœ¨å¯¹ç³»ç»Ÿå’Œåº”ç”¨è¿›è¡Œ<strong>æ°¸ä¹…æ€§</strong>çš„ä¿®æ”¹ã€‚å®ƒé€šè¿‡æ›¿æ¢ä¸€ä¸ªæ ¸å¿ƒç³»ç»Ÿè¿›ç¨‹ (<code>app_process</code>)ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½è‡ªå®šä¹‰æ¨¡å—ï¼Œä»è€Œå®ç°å¯¹ä»»æ„æ–¹æ³•çš„é«˜æ•ˆ Hookã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#xposed-%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97">Xposed æ¡†æ¶å…¥é—¨</a><ul>
<li><a href="#xposed-%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9C%A8-android-%E5%B9%B3%E5%8F%B0%E4%B8%8A%E5%B9%BF%E5%8F%97%E6%AC%A2%E8%BF%8E%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%A0%81-hook-%E6%A1%86%E6%9E%B6%E4%B8%8E-frida-%E4%B8%BB%E8%A6%81%E7%94%A8%E4%BA%8E%E5%AE%9E%E6%97%B6%E4%B8%B4%E6%97%B6%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8D%E5%90%8Cxposed-%E6%97%A8%E5%9C%A8%E5%AF%B9%E7%B3%BB%E7%BB%9F%E5%92%8C%E5%BA%94%E7%94%A8%E8%BF%9B%E8%A1%8C%E6%B0%B8%E4%B9%85%E6%80%A7%E7%9A%84%E4%BF%AE%E6%94%B9%E5%AE%83%E9%80%9A%E8%BF%87%E6%9B%BF%E6%8D%A2%E4%B8%80%E4%B8%AA%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B-app_process%E5%9C%A8%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E5%8A%A0%E8%BD%BD%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%E4%BB%8E%E8%80%8C%E5%AE%9E%E7%8E%B0%E5%AF%B9%E4%BB%BB%E6%84%8F%E6%96%B9%E6%B3%95%E7%9A%84%E9%AB%98%E6%95%88-hook">Xposed æ˜¯ä¸€ä¸ªåœ¨ Android å¹³å°ä¸Šå¹¿å—æ¬¢è¿çš„åŠ¨æ€ä»£ç  Hook æ¡†æ¶ã€‚ä¸ Frida ä¸»è¦ç”¨äºå®æ—¶ã€ä¸´æ—¶çš„åˆ†æä¸åŒï¼ŒXposed æ—¨åœ¨å¯¹ç³»ç»Ÿå’Œåº”ç”¨è¿›è¡Œ<strong>æ°¸ä¹…æ€§</strong>çš„ä¿®æ”¹ã€‚å®ƒé€šè¿‡æ›¿æ¢ä¸€ä¸ªæ ¸å¿ƒç³»ç»Ÿè¿›ç¨‹ (<code>app_process</code>)ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½è‡ªå®šä¹‰æ¨¡å—ï¼Œä»è€Œå®ç°å¯¹ä»»æ„æ–¹æ³•çš„é«˜æ•ˆ Hookã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86">æ ¸å¿ƒåŸç†</a></li>
<li><a href="#xposed-vs-frida">Xposed vs. Frida</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-%E4%BB%A5-lsposed-%E4%B8%BA%E4%BE%8B">ç¯å¢ƒæ­å»º (ä»¥ LSPosed ä¸ºä¾‹)</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E7%AC%AC%E4%B8%80%E4%B8%AA-xposed-%E6%A8%A1%E5%9D%97">å¼€å‘ç¬¬ä¸€ä¸ª Xposed æ¨¡å—</a><ul>
<li><a href="#1-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">1. é¡¹ç›®ç»“æ„</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>æ ¸å¿ƒåŸç†</h3>
<p>Xposed çš„å·¥ä½œåŸºç¡€æ˜¯å®ƒèƒ½å¤Ÿåœ¨ Android ç³»ç»Ÿå¯åŠ¨çš„æ ¸å¿ƒé˜¶æ®µä»‹å…¥ï¼Œå¹¶å°†è‡ªå·±çš„ä»£ç æ³¨å…¥åˆ°æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚</p>
<ol>
<li><strong>Zygote æ³¨å…¥</strong>: Xposed é€šè¿‡æ›¿æ¢ç³»ç»ŸåŸç”Ÿçš„ <code>/system/bin/app_process</code> å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ç°äº†å¯¹ Zygote è¿›ç¨‹ï¼ˆæ‰€æœ‰ App è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼‰çš„æ§åˆ¶ã€‚å½“ Zygote å¯åŠ¨æ—¶ï¼Œä¼šåŠ è½½ Xposed çš„æ ¸å¿ƒ Jar åŒ…ï¼ˆXposed Bridgeï¼‰ã€‚</li>
<li><strong>æ–¹æ³• Hook</strong>: å½“æ¨¡å—éœ€è¦ Hook ä¸€ä¸ªæ–¹æ³•æ—¶ï¼ŒXposed ä¼šåœ¨è¿è¡Œæ—¶æ·±å…¥è™šæ‹Ÿæœºï¼ˆARTï¼‰å†…éƒ¨ï¼Œç›´æ¥ä¿®æ”¹è¯¥æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„ã€‚å®ƒå°†ç›®æ ‡æ–¹æ³•&quot;ä¼ªè£…&quot;æˆä¸€ä¸ª Native æ–¹æ³•ï¼Œå¹¶å°†å…¶æ‰§è¡Œå…¥å£æŒ‡å‘ Xposed çš„ä¸€ä¸ªé€šç”¨æ¡¥æ¥å‡½æ•°ã€‚</li>
<li><strong>æ‰§è¡Œæµé‡å®šå‘</strong>: å½“ App è°ƒç”¨è¢« Hook çš„æ–¹æ³•æ—¶ï¼Œæ‰§è¡Œæµä¼šå…ˆè¿›å…¥ Xposed çš„æ¡¥æ¥å‡½æ•°ï¼Œåœ¨è¿™é‡Œ Xposed ä¾æ¬¡è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ <code>beforeHookedMethod</code>ï¼Œç„¶åè°ƒç”¨åŸæ–¹æ³•ï¼Œæœ€åå†è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ <code>afterHookedMethod</code>ï¼Œä»è€Œå®ç°å¯¹æ–¹æ³•è°ƒç”¨çš„å®Œå…¨æ§åˆ¶ã€‚</li>
</ol>
<blockquote>
<p>æƒ³è¦æ›´æ·±å…¥åœ°äº†è§£å…¶å®ç°ç»†èŠ‚ï¼Œè¯·å‚è€ƒ <a href="#section-43"><strong>Xposed Internals: A Deep Dive</strong></a>ã€‚</p>
</blockquote>
<hr />
<h3>Xposed vs. Frida</h3>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">Xposed</th>
  <th style="text-align:left">Frida</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>æ ¸å¿ƒç›®æ ‡</strong></td>
  <td style="text-align:left"><strong>æ°¸ä¹…æ€§ä¿®æ”¹</strong>: å¯¹åº”ç”¨æˆ–ç³»ç»ŸåŠŸèƒ½è¿›è¡Œé•¿æœŸã€ç¨³å®šçš„ä¿®æ”¹ã€‚</td>
  <td style="text-align:left"><strong>åŠ¨æ€åˆ†æ</strong>: ç”¨äºå®æ—¶ã€ä¸´æ—¶çš„åˆ†æã€é€†å‘å’Œå¿«é€ŸåŸå‹éªŒè¯ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>è¿è¡Œç¯å¢ƒ</strong></td>
  <td style="text-align:left">éœ€è¦ Rootï¼Œé€šè¿‡åˆ·å…¥æ¡†æ¶ä¿®æ”¹ç³»ç»Ÿï¼Œ<strong>éœ€è¦é‡å¯</strong>ã€‚</td>
  <td style="text-align:left">é€šå¸¸éœ€è¦ Rootï¼Œä½†æ— éœ€é‡å¯ï¼Œé€šè¿‡ <code>frida-server</code> åŠ¨æ€é™„åŠ ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¼€å‘è¯­è¨€</strong></td>
  <td style="text-align:left"><strong>Java</strong>: æ¨¡å—æ˜¯æ ‡å‡†çš„ Android APKã€‚</td>
  <td style="text-align:left"><strong>JavaScript</strong>: ä¸»è¦ä½¿ç”¨ JS ç¼–å†™è„šæœ¬ï¼Œä¹Ÿæ”¯æŒå…¶ä»–è¯­è¨€ç»‘å®šã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¼€å‘å‘¨æœŸ</strong></td>
  <td style="text-align:left">è¾ƒæ…¢ï¼šç¼–ç  â†’ ç¼–è¯‘ APK â†’ å®‰è£… â†’ æ¿€æ´» â†’ é‡å¯ App/è®¾å¤‡ â†’ æµ‹è¯•ã€‚</td>
  <td style="text-align:left">æå¿«ï¼šç¼–å†™/ä¿®æ”¹è„šæœ¬ â†’ é™„åŠ è¿›ç¨‹ â†’ ç«‹å³çœ‹åˆ°ç»“æœã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ç¨³å®šæ€§</strong></td>
  <td style="text-align:left">æé«˜ã€‚ä¸ºé•¿æœŸè¿è¡Œè®¾è®¡ï¼Œä¸€æ—¦æ¿€æ´»ï¼Œéš App å¯åŠ¨è‡ªåŠ¨ç”Ÿæ•ˆã€‚</td>
  <td style="text-align:left">è¾ƒä½ã€‚ä¾èµ–äº <code>frida-server</code> å’Œé™„åŠ ä¼šè¯ï¼ŒApp é‡å¯åå¤±æ•ˆã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>é€‚ç”¨åœºæ™¯</strong></td>
  <td style="text-align:left">UI å®šåˆ¶ã€åŠŸèƒ½å¢å¼ºã€å»å¹¿å‘Šã€éšç§æ§åˆ¶ï¼ˆå¦‚ä¼ªé€ æ•°æ®ï¼‰ã€‚</td>
  <td style="text-align:left">SSL Pinning ç»•è¿‡ã€ç®—æ³•é€†å‘ã€åè®®åˆ†æã€æ¼æ´æŒ–æ˜ã€‚</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>æ€»ç»“</strong>: å¦‚æœä½ æƒ³å†™ä¸€ä¸ª&quot;æ’ä»¶&quot;æ¥æ°¸ä¹…æ€§åœ°æ”¹å˜ä¸€ä¸ª App çš„åŠŸèƒ½ï¼Œç”¨ Xposedï¼›å¦‚æœä½ æƒ³åˆ†æä¸€ä¸ª App çš„å†…éƒ¨è¡Œä¸ºï¼Œç”¨ Fridaã€‚</li>
</ul>
<hr />
<h3>ç¯å¢ƒæ­å»º (ä»¥ LSPosed ä¸ºä¾‹)</h3>
<p>å½“å‰ï¼ŒLSPosed æ˜¯ç¤¾åŒºä¸­æœ€ä¸»æµã€å…¼å®¹æ€§æœ€å¥½çš„ Xposed æ¡†æ¶å®ç°ï¼Œå®ƒåŸºäº Riru/Zygiskï¼Œä»¥ Magisk æ¨¡å—çš„å½¢å¼å·¥ä½œã€‚</p>
<ol>
<li><strong>å‰ææ¡ä»¶</strong>:</li>
</ol>
<ul>
<li>ä¸€å°å·²è§£é”å¹¶åˆ·å…¥ Magisk çš„ Android è®¾å¤‡ï¼ˆAndroid 8.1+ï¼‰ã€‚</li>
</ul>
<ol start="2">
<li><strong>å®‰è£… Riru æˆ–å¯ç”¨ Zygisk</strong>:</li>
</ol>
<ul>
<li><p><strong>Zygisk (æ¨è)</strong>: åœ¨ Magisk Manager ä¸­ï¼Œè¿›å…¥è®¾ç½®ï¼Œå¼€å¯ <code>Zygisk</code> é€‰é¡¹ã€‚</p>
</li>
<li><p><strong>Riru (å¤‡é€‰)</strong>: åœ¨ Magisk Manager çš„&quot;æ¨¡å—&quot;éƒ¨åˆ†ï¼Œæœç´¢å¹¶å®‰è£… <code>Riru</code> æ¨¡å—ã€‚</p>
</li>
</ul>
<ol start="3">
<li><strong>å®‰è£… LSPosed</strong>:</li>
</ol>
<ul>
<li><p>ä» <a href="https://github.com/LSPosed/LSPosed/releases">LSPosed çš„ GitHub Releases</a> é¡µé¢ä¸‹è½½æœ€æ–°çš„ Zygisk ç‰ˆæœ¬ ZIP åŒ…ã€‚</p>
</li>
<li><p>åœ¨ Magisk Manager çš„&quot;æ¨¡å—&quot;é¡µï¼Œé€‰æ‹©&quot;ä»æœ¬åœ°å®‰è£…&quot;ï¼Œç„¶åé€‰ä¸­ä¸‹è½½çš„ LSPosed ZIP åŒ…ã€‚</p>
</li>
<li><p>å®‰è£…å®Œæˆåï¼Œç‚¹å‡»å³ä¸‹è§’çš„&quot;é‡å¯&quot;æŒ‰é’®ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>éªŒè¯å®‰è£…</strong>:</li>
</ol>
<ul>
<li><p>é‡å¯åï¼Œæ¡Œé¢ä¸Šä¼šå‡ºç° LSPosed çš„ç®¡ç†ç¨‹åºå›¾æ ‡ã€‚</p>
</li>
<li><p>æ‰“å¼€ LSPosedï¼Œå¦‚æœçŠ¶æ€æ˜¾ç¤ºä¸º&quot;å·²æ¿€æ´»&quot;ï¼Œåˆ™è¡¨ç¤ºæ¡†æ¶å®‰è£…æˆåŠŸã€‚</p>
</li>
</ul>
<hr />
<h3>å¼€å‘ç¬¬ä¸€ä¸ª Xposed æ¨¡å—</h3>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œæ¥ Hook ç³»ç»Ÿçš„æ—¶é’Ÿï¼Œåœ¨åé¢åŠ ä¸Šä¸€ä¸ªå°å°¾å·´ã€‚</p>
<h4>1. é¡¹ç›®ç»“æ„</h4>
<ul>
<li><p>åœ¨ Android Studio ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç©ºçš„ Android é¡¹ç›®ã€‚</p>
</li>
<li><p>åœ¨ app çš„ <code>build.gradle</code> æ–‡ä»¶ä¸­æ·»åŠ  Xposed API ä¾èµ–ï¼š</p>
<pre><code class="language-groovy">dependencies {
// ... other dependencies
compileOnly 'de.robv.android.xposed:api:82'
// 'compileOnly' is used because the framework is already provided by the system, only needed at compile time
}
</code></pre>
</li>
</ul>
<pre><code>
* åˆ›å»ºä¸€ä¸ªæ–°çš„ Java ç±»ï¼Œä¾‹å¦‚ `ClockHook`ï¼Œå¹¶è®©å®ƒå®ç° `IXposedHookLoadPackage` æ¥å£ã€‚

```java
package com.example.myxposedmodule;

import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XC_MethodHook;
import de.robv.android.xposed.XposedBridge;
import de.robv.android.xposed.XposedHelpers;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;
import android.widget.TextView;

public class ClockHook implements IXposedHookLoadPackage {
@Override
public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {
// We only care about system UI
if (!lpparam.packageName.equals(&quot;com.android.systemui&quot;)) {
return;
}

XposedBridge.log(&quot;Loaded app: &quot; + lpparam.packageName);

// Find and Hook the clock update class and method
// (Note: class names and method names may differ across Android versions)
XposedHelpers.findAndHookMethod(
&quot;com.android.systemui.statusbar.policy.Clock&quot;, // Class name
lpparam.classLoader, // ClassLoader
&quot;updateClock&quot;, // Method name
new XC_MethodHook() { // Hook callback
@Override
protected void afterHookedMethod(MethodHookParam param) throws Throwable {
super.afterHookedMethod(param);
TextView clockView = (TextView) param.thisObject;
String originalTime = clockView.getText().toString();
String newTime = originalTime + &quot; &quot;;
clockView.setText(newTime);
XposedBridge.log(&quot;Clock hooked! New time: &quot; + newTime);
}
}
);
}
}

</code></pre>
<ul>
<li>åœ¨ <code>app/src/main/AndroidManifest.xml</code> çš„ <code>&lt;application&gt;</code> æ ‡ç­¾å†…ï¼Œæ·»åŠ  meta-data æ¥å£°æ˜è¿™æ˜¯ä¸€ä¸ª Xposed æ¨¡å—ã€‚</li>
</ul>
<pre><code class="language-xml">&lt;meta-data
android:name=&quot;xposedmodule&quot;
android:value=&quot;true&quot; /&gt;
&lt;meta-data
android:name=&quot;xposeddescription&quot;
android:value=&quot;This is an example module that adds a tail to system clock&quot; /&gt;
&lt;meta-data
android:name=&quot;xposedminversion&quot;
android:value=&quot;52&quot; /&gt;

</code></pre>
<ul>
<li><p>åœ¨ <code>assets</code> æ–‡ä»¶å¤¹å†…ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>xposed_init</code> çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p>
</li>
<li><p>åœ¨ <code>xposed_init</code> æ–‡ä»¶ä¸­ï¼Œå†™å…¥ä½ çš„ Hook ç±»çš„å®Œæ•´è·¯å¾„ï¼š</p>
<pre><code>
</code></pre>
</li>
</ul>
<p>com.example.myxposedmodule.ClockHook</p>
<pre><code>
1. **æ„å»º APK**: åœ¨ Android Studio ä¸­æ„å»ºä½ çš„é¡¹ç›®ï¼Œç”Ÿæˆ APKã€‚
2. **å®‰è£… APK**: å°† APK å®‰è£…åˆ°ä½ çš„æµ‹è¯•è®¾å¤‡ä¸Šã€‚
3. **æ¿€æ´»æ¨¡å—**:
* æ‰“å¼€ LSPosed Managerã€‚

* è¿›å…¥&quot;æ¨¡å—&quot;éƒ¨åˆ†ï¼Œæ‰¾åˆ°ä½ åˆšåˆšå®‰è£…çš„æ¨¡å—ã€‚

* ç‚¹å‡»å®ƒï¼Œç„¶å**å¯ç”¨**æ¨¡å—ã€‚

* åœ¨ä½œç”¨åŸŸåˆ—è¡¨ä¸­ï¼Œå‹¾é€‰&quot;**SystemUI**&quot;ã€‚
4. **é‡å¯ç›®æ ‡è¿›ç¨‹**:
* åœ¨ LSPosed çš„çŠ¶æ€é¡µå³ä¸Šè§’ï¼Œç‚¹å‡»ä¸‰ä¸ªç‚¹èœå•ï¼Œé€‰æ‹©&quot;è½¯é‡å¯&quot;æˆ–&quot;é‡å¯ SystemUI&quot;ï¼Œæˆ–è€…ç›´æ¥é‡å¯æ‰‹æœºã€‚
5. **æŸ¥çœ‹æ•ˆæœ**: æŸ¥çœ‹ä½ çš„çŠ¶æ€æ æ—¶é’Ÿï¼Œå®ƒç°åœ¨åº”è¯¥å¸¦æœ‰ä¸€ä¸ª å°å°¾å·´äº†ï¼ä½ ä¹Ÿå¯ä»¥åœ¨ LSPosed çš„æ—¥å¿—ä¸­çœ‹åˆ° `XposedBridge.log` è¾“å‡ºçš„ä¿¡æ¯ã€‚
---
### æ ¸å¿ƒ API è¯¦è§£

#### `IXposedHookLoadPackage`
è¿™æ˜¯æ‰€æœ‰æ¨¡å—çš„å…¥å£ç‚¹ã€‚å®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³• `handleLoadPackage(LoadPackageParam lpparam)`ã€‚å½“ä»»ä½•ä¸€ä¸ª App å¯åŠ¨æ—¶ï¼ŒXposed éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¼ å…¥ `lpparam` å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ï¼š

* `lpparam.packageName`: å½“å‰åŠ è½½çš„ App çš„åŒ…åã€‚

* `lpparam.processName`: å½“å‰è¿›ç¨‹åã€‚

* `lpparam.classLoader`: å½“å‰ App çš„ ClassLoaderï¼Œè¿™æ˜¯ Hook App å†…éƒ¨ç±»çš„**å¿…éœ€å“**ã€‚

#### `XposedHelpers`
ä¸€ä¸ªåŒ…å«å¤§é‡é™æ€è¾…åŠ©æ–¹æ³•çš„å·¥å…·ç±»ï¼Œæå¤§ç®€åŒ–äº†åå°„æ“ä½œã€‚

* `findAndHookMethod(String className, ClassLoader classLoader, String methodName, Object... parameterTypesAndCallback)`: æœ€æ ¸å¿ƒçš„ Hook æ–¹æ³•ã€‚æœ€åä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ `XC_MethodHook` å›è°ƒã€‚

* `findClass(String className, ClassLoader classLoader)`: æŸ¥æ‰¾ä¸€ä¸ªç±»ã€‚

* `getObjectField(Object obj, String fieldName)` / `setObjectField(Object obj, String fieldName, Object value)`: è·å–/è®¾ç½®å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚

* `callMethod(Object obj, String methodName, Object... args)`: è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚

* `getStaticObjectField(...)` / `callStaticMethod(...)`: ç”¨äºæ“ä½œé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ã€‚

#### `XC_MethodHook`
è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½ éœ€è¦ç»§æ‰¿å®ƒå¹¶é‡å†™å®ƒçš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ã€‚

* `beforeHookedMethod(MethodHookParam param)`: åœ¨åŸæ–¹æ³•æ‰§è¡Œ**å‰**è¢«è°ƒç”¨ã€‚

* `afterHookedMethod(MethodHookParam param)`: åœ¨åŸæ–¹æ³•æ‰§è¡Œ**å**è¢«è°ƒç”¨ã€‚

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ª `MethodHookParam` å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æœ¬æ¬¡æ–¹æ³•è°ƒç”¨çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

* `param.thisObject`: `this` æŒ‡é’ˆï¼Œå³æ–¹æ³•æ‰€å±çš„å¯¹è±¡å®ä¾‹ã€‚

* `param.args`: `Object[]` æ•°ç»„ï¼ŒåŒ…å«äº†æ–¹æ³•è¢«è°ƒç”¨æ—¶çš„æ‰€æœ‰å‚æ•°ã€‚ä½ å¯ä»¥åœ¨ `beforeHookedMethod` ä¸­ä¿®æ”¹å®ƒã€‚

* `param.getResult()`: è·å–åŸæ–¹æ³•çš„è¿”å›å€¼ã€‚åªèƒ½åœ¨ `afterHookedMethod` ä¸­è°ƒç”¨ã€‚

* `param.setResult(Object result)`: è®¾ç½®ä¸€ä¸ªæ–°çš„è¿”å›å€¼ã€‚å¦‚æœåœ¨ `beforeHookedMethod` ä¸­è°ƒç”¨ï¼ŒåŸæ–¹æ³•å°†**ä¸ä¼šè¢«æ‰§è¡Œ**ã€‚å¦‚æœåœ¨ `afterHookedMethod` ä¸­è°ƒç”¨ï¼Œå®ƒä¼šè¦†ç›–åŸæ–¹æ³•çš„è¿”å›å€¼ã€‚

* `param.getThrowable()` / `param.setThrowable(Throwable t)`: ç”¨äºè·å–/è®¾ç½®æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ã€‚
---
### å¸¸è§åº”ç”¨åœºæ™¯

* **UI å®šåˆ¶**: ä¿®æ”¹ç³»ç»Ÿæˆ–åº”ç”¨çš„å¤–è§‚ï¼Œå¦‚çŠ¶æ€æ ã€é€šçŸ¥ã€é”å±ç­‰ï¼ˆä»£è¡¨ä½œï¼š`GravityBox`ï¼‰ã€‚

* **åŠŸèƒ½å¢å¼º**: ä¸ºåº”ç”¨æ·»åŠ åŸç”Ÿä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œå¦‚ä¸ºå¾®ä¿¡æ·»åŠ é˜²æ’¤å›ã€è‡ªåŠ¨æŠ¢çº¢åŒ…åŠŸèƒ½ã€‚

* **å»é™¤é™åˆ¶**: ç ´è§£åº”ç”¨çš„ä»˜è´¹åŠŸèƒ½ã€å»é™¤æˆªå›¾é™åˆ¶ã€å»é™¤å¹¿å‘Šç­‰ã€‚

* **éšç§ä¿æŠ¤**: æ‹¦æˆªåº”ç”¨è·å–æ•æ„Ÿä¿¡æ¯çš„è¯·æ±‚ï¼ˆå¦‚å®šä½ã€è”ç³»äººã€è®¾å¤‡IDï¼‰ï¼Œå¹¶è¿”å›è™šå‡æˆ–ç©ºæ•°æ®ï¼ˆä»£è¡¨ä½œï¼š`XPrivacyLua`ï¼‰ã€‚

* **å®‰å…¨åˆ†æ**:
* ç»•è¿‡ SSL Pinningï¼ˆå°½ç®¡ Frida æ›´çµæ´»ï¼‰ã€‚

* ç¦ç”¨ Root æ£€æµ‹æˆ–åè°ƒè¯•æœºåˆ¶ã€‚

* æ—¥å¿—è®°å½•ï¼šæ‰“å°å…³é”®æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œåˆ†æåº”ç”¨è¡Œä¸ºã€‚


</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-43">
                                                <h2>43. Xposed Internals</h2>
                                                <h1>Xposed å†…éƒ¨åŸç†ï¼šæ·±åº¦å‰–æ</h1>
<h2>Xposed æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Android æ¡†æ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨è¿è¡Œæ—¶ä¿®æ”¹ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿›ç¨‹çš„è¡Œä¸ºï¼Œè€Œæ— éœ€ä¿®æ”¹ä»»ä½• APK æ–‡ä»¶ã€‚æœ¬æ–‡æ¡£æ·±å…¥æ¢è®¨äº† Xposed å·¥ä½œçš„æ ¸å¿ƒåŸç†ã€‚</h2>
<h2>1. å…¥å£ç‚¹ï¼šZygote è¿›ç¨‹æ³¨å…¥</h2>
<p>Xposed çš„åŸºç¡€åœ¨äºå®ƒèƒ½å¤Ÿå°†è‡ªå®šä¹‰ä»£ç æ³¨å…¥åˆ°æ¯ä¸ª Android åº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚å®ƒé€šè¿‡é’ˆå¯¹ <strong>Zygote</strong> è¿›ç¨‹æ¥å®ç°è¿™ä¸€ç‚¹ï¼ŒZygote æ˜¯ Android OS ä¸­çš„åŸå§‹è¿›ç¨‹ï¼Œæ‰€æœ‰åº”ç”¨ç¨‹åºè¿›ç¨‹éƒ½ä»å®ƒ fork è€Œæ¥ã€‚</p>
<h3>å·¥ä½œåŸç†ï¼š</h3>
<ol>
<li><p><strong>æ›¿æ¢ <code>app_process</code></strong>ï¼šåœ¨å®‰è£…æœŸé—´ï¼ŒXposed ç”¨è‡ªå·±ä¿®æ”¹åçš„ç‰ˆæœ¬æ›¿æ¢åŸå§‹çš„ <code>/system/bin/app_process</code> å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ˜¯ Zygote è¿›ç¨‹å¯åŠ¨çš„ç¬¬ä¸€ä¸ªç¨‹åºã€‚</p>
</li>
<li><p><strong>åŠ è½½æ¡¥æ¥å™¨</strong>ï¼šå½“ Zygote å¯åŠ¨æ—¶ï¼Œå®ƒè¿è¡Œ Xposed ç‰ˆæœ¬çš„ <code>app_process</code>ã€‚è¿™ä¸ªè‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸»è¦ä»»åŠ¡æ˜¯å°†ä¸€ä¸ªç‰¹æ®Šçš„ JAR æ–‡ä»¶ï¼ˆé€šå¸¸ç§°ä¸º <strong>Xposed Bridge</strong>ï¼Œå³ <code>XposedBridge.jar</code>ï¼‰åŠ è½½åˆ° Zygote çš„åœ°å€ç©ºé—´ä¸­ã€‚</p>
</li>
<li><p><strong>é€šè¿‡ Fork ç»§æ‰¿</strong>ï¼šç”±äºæ¯ä¸ª Android åº”ç”¨ç¨‹åºéƒ½æ˜¯ Zygote è¿›ç¨‹çš„ forkï¼Œå®ƒä»¬éƒ½ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚è¿™æ„å‘³ç€ Xposed Bridge JAR ä»åˆ›å»ºæ—¶åˆ»èµ·å°±è‡ªåŠ¨åŠ è½½åˆ°æ¯ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚</p>
</li>
</ol>
<p>è¿™ç§å·§å¦™çš„æ–¹æ³•ç¡®ä¿ Xposed çš„æ ¸å¿ƒé€»è¾‘åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­éƒ½å­˜åœ¨å¹¶å‡†å¤‡å¥½æ‰§è¡Œï¼Œä¸ºæ–¹æ³• Hook æä¾›äº†ä¸€ä¸ªé€šç”¨å¹³å°ã€‚</p>
<h2>2. æ ¸å¿ƒé­”æ³•ï¼šæ–¹æ³• Hook</h2>
<p>Xposed æœ€è‘—åçš„åŠŸèƒ½æ˜¯å…¶&quot;Hook&quot;Java æ–¹æ³•çš„èƒ½åŠ›ã€‚è¿™ä¸æ˜¯ç®€å•çš„åå°„ï¼›å®ƒæ˜¯å¯¹åº•å±‚è™šæ‹Ÿæœºæ•°æ®ç»“æ„çš„æ·±åº¦æ“çºµã€‚</p>
<h3><code>Method</code> ç»“æ„è½¬æ¢ï¼š</h3>
<p>æ ¸å¿ƒæ€æƒ³æ˜¯æ”¹å˜è™šæ‹Ÿæœºä¸­ç›®æ ‡ Java æ–¹æ³•çš„ç±»å‹ç­¾åï¼Œä½¿è™šæ‹Ÿæœºè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ª <code>native</code> æ–¹æ³•ã€‚</p>
<ol>
<li><p><strong>æŸ¥æ‰¾ç›®æ ‡</strong>ï¼šæ¨¡å—ä½¿ç”¨ <code>findAndHookMethod</code> ç­‰è¾…åŠ©å‡½æ•°æ¥æŒ‡å®šå®ƒä»¬å¸Œæœ› Hook çš„ç±»å’Œæ–¹æ³•ã€‚</p>
</li>
<li><p><strong>ä¿®æ”¹ <code>Method</code> å¯¹è±¡</strong>ï¼šåœ¨å†…éƒ¨ï¼ŒXposed ä½¿ç”¨åå°„å’Œæœ¬åœ°ä»£ç æ¥è·å–ä¸ç›®æ ‡å¯¹åº”çš„ Java <code>java.lang.reflect.Method</code> å¯¹è±¡çš„å¥æŸ„ã€‚</p>
</li>
<li><p><strong>&quot;Native&quot;ä¼ªè£…</strong>ï¼š</p>
</li>
</ol>
<ul>
<li><p>Xposed ä¿®æ”¹ <code>Method</code> å¯¹è±¡çš„ <code>accessFlags</code>ï¼Œæ·»åŠ  <code>ACC_NATIVE</code> æ ‡å¿—ã€‚</p>
</li>
<li><p>ç„¶åå®ƒè¦†ç›–æ–¹æ³•çš„å…¥å£ç‚¹æŒ‡é’ˆã€‚åœ¨ ART è¿è¡Œæ—¶ä¸­ï¼Œè¿™æ„å‘³ç€æ›¿æ¢å†…éƒ¨ <code>ArtMethod</code> ç»“æ„ä¸­çš„ <code>entry_point_from_quick_compiled_code_</code> å­—æ®µã€‚</p>
</li>
<li><p>è¿™ä¸ªæ–°çš„å…¥å£ç‚¹ç°åœ¨æŒ‡å‘ Xposed æä¾›çš„é€šç”¨åŸç”Ÿæ¡¥æ¥å‡½æ•°ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>ä¿å­˜åŸå§‹æ–¹æ³•</strong>ï¼šåœ¨è¦†ç›–ä¹‹å‰ï¼ŒXposed ä»”ç»†åœ°å°†åŸå§‹æ–¹æ³•çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬å…¶åŸå§‹å…¥å£ç‚¹å’Œè®¿é—®æ ‡å¿—ï¼‰ä¿å­˜åˆ°å•ç‹¬çš„å¤‡ä»½ç»“æ„ä¸­ã€‚</li>
</ol>
<h3>Hooked æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼š</h3>
<p>å½“åº”ç”¨ç¨‹åºè°ƒç”¨è¢« Xposed Hook çš„æ–¹æ³•æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹åºåˆ—ï¼š</p>
<ol>
<li><p><strong>ç»•é“åˆ°åŸç”Ÿæ¡¥æ¥å™¨</strong>ï¼šè™šæ‹Ÿæœºç°åœ¨è®¤ä¸ºè¯¥æ–¹æ³•æ˜¯åŸç”Ÿæ–¹æ³•ï¼Œå°†è°ƒç”¨å®šå‘åˆ° Xposed çš„é€šç”¨åŸç”Ÿæ¡¥æ¥å‡½æ•°ã€‚</p>
</li>
<li><p><strong>å›è°ƒåˆ° Java æ¡¥æ¥å™¨</strong>ï¼šåŸç”Ÿå‡½æ•°åšçš„äº‹æƒ…å¾ˆå°‘ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯å›è°ƒåˆ° Java ä¸–ç•Œï¼Œè°ƒç”¨ Xposed Bridge ä¸­çš„æ ¸å¿ƒ Java æ–¹æ³•ï¼š<code>handleHookedMethod</code>ã€‚</p>
</li>
<li><p><strong><code>handleHookedMethod</code> åè°ƒ</strong>ï¼šè¿™ä¸ªå¼ºå¤§çš„ Java æ–¹æ³•åè°ƒæ•´ä¸ª Hook ç”Ÿå‘½å‘¨æœŸï¼š</p>
</li>
</ol>
<p>a. å®ƒå°†æ–¹æ³•çš„å‚æ•°å’Œ <code>this</code> å¼•ç”¨å‡†å¤‡åˆ°ä¸€ä¸ª <code>MethodHookParam</code> å¯¹è±¡ä¸­ã€‚</p>
<p>b. <strong><code>beforeHookedMethod</code></strong>ï¼šå®ƒéå†æ¨¡å—ä¸­æ‰€æœ‰æ³¨å†Œçš„å›è°ƒï¼Œå¹¶è°ƒç”¨å®ƒä»¬çš„ <code>beforeHookedMethod</code> æ–¹æ³•ã€‚è¿™äº›å›è°ƒå¯ä»¥æ£€æŸ¥æˆ–ä¿®æ”¹å‚æ•°ã€‚å…³é”®çš„æ˜¯ï¼Œ&quot;before&quot;å›è°ƒå¯ä»¥é€‰æ‹©é€šè¿‡ç›´æ¥åœ¨ <code>param</code> å¯¹è±¡ä¸Šè®¾ç½®ç»“æœæ¥å®Œå…¨è·³è¿‡åŸå§‹æ–¹æ³•ã€‚</p>
<p>c. <strong>è°ƒç”¨åŸå§‹æ–¹æ³•</strong>ï¼šå¦‚æœæ–¹æ³•æ²¡æœ‰è¢«è·³è¿‡ï¼Œ<code>handleHookedMethod</code> ä½¿ç”¨ä¿å­˜çš„å¤‡ä»½ä¿¡æ¯æ¥è°ƒç”¨åŸå§‹æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ï¼ˆå¯èƒ½å·²ä¿®æ”¹çš„ï¼‰å‚æ•°ã€‚</p>
<p>d. <strong><code>afterHookedMethod</code></strong>ï¼šåœ¨åŸå§‹æ–¹æ³•å®Œæˆåï¼Œå®ƒå†æ¬¡éå†å›è°ƒï¼Œè¿™æ¬¡è°ƒç”¨å®ƒä»¬çš„ <code>afterHookedMethod</code> æ–¹æ³•ã€‚è¿™äº›å›è°ƒå¯ä»¥æ£€æŸ¥æˆ–ä¿®æ”¹æ–¹æ³•çš„è¿”å›å€¼ã€‚</p>
<ol start="4">
<li><strong>è¿”å›ç»™è°ƒç”¨è€…</strong>ï¼šæœ€åï¼Œ<code>handleHookedMethod</code> å°†æœ€ç»ˆç»“æœï¼ˆæ¥è‡ª&quot;before&quot;å›è°ƒæˆ–åŸå§‹æ–¹æ³•çš„ï¼ˆå·²ä¿®æ”¹çš„ï¼‰ç»“æœï¼‰è¿”å›ç»™åº”ç”¨ç¨‹åºçš„åŸå§‹è°ƒç”¨ç‚¹ã€‚</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºä»£ç æ˜¯é€æ˜çš„ï¼Œåº”ç”¨ç¨‹åºåªæ˜¯çœ‹åˆ°ä¸€ä¸ªè¿”å›å€¼çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸çŸ¥é“å®ƒç»å†äº†å¤æ‚çš„ç»•é“ã€‚</p>
<h2>3. æ¨¡å—åŠ è½½æœºåˆ¶</h2>
<p>Xposed æ¨¡å—æ˜¯æ ‡å‡†çš„ Android APKï¼Œå®ƒä»¬å‘æ¡†æ¶è¡¨æ˜è‡ªå·±çš„æ€§è´¨ã€‚</p>
<ul>
<li><p><strong><code>AndroidManifest.xml</code></strong>ï¼šæ¨¡å—çš„æ¸…å•æ–‡ä»¶å¿…é¡»åŒ…å«ä¸€ä¸ª <code>&lt;meta-data&gt;</code> æ ‡ç­¾ï¼Œå…¶ä¸­ <code>android:name=&quot;xposedmodule&quot;</code> è®¾ç½®ä¸º <code>true</code>ã€‚</p>
</li>
<li><p><strong><code>assets/xposed_init</code></strong>ï¼šæ¨¡å— assets ç›®å½•ä¸­çš„è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ–‡ä»¶ã€‚æ¯è¡ŒæŒ‡å‘ä¸€ä¸ªå®Œå…¨é™å®šçš„ç±»åã€‚</p>
</li>
<li><p><strong><code>IXposedHookLoadPackage</code></strong>ï¼š<code>xposed_init</code> ä¸­åˆ—å‡ºçš„ç±»å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ã€‚Xposed æ¡†æ¶å°†å®ä¾‹åŒ–è¿™äº›ç±»ï¼Œå¹¶ä¸ºæ¯ä¸ªåŠ è½½çš„åº”ç”¨ç¨‹åºåŒ…è°ƒç”¨å®ƒä»¬çš„ <code>handleLoadPackage</code> æ–¹æ³•ï¼Œå…è®¸æ¨¡å—å†³å®šæ˜¯å¦åº”ç”¨å…¶ Hookã€‚</p>
</li>
</ul>
<hr />
<h2>æ¶æ„å›¾è§£</h2>
<h3>Xposed å·¥ä½œæµç¨‹å›¾</h3>
<pre><code>â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯åŠ¨ Zygote è¿›ç¨‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿è¡Œä¿®æ”¹çš„ app_process â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ XposedBridge.jar â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fork åº”ç”¨è¿›ç¨‹ â”‚
â”‚ (ç»§æ‰¿ Xposed Bridge) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å¯åŠ¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ Xposed æ¨¡å— â”‚
â”‚ (è°ƒç”¨ handleLoadPackage)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hook ç›®æ ‡æ–¹æ³• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VM æŸ¥æ‰¾æ–¹æ³•å…¥å£ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æµ‹åˆ° ACC_NATIVE æ ‡å¿— â”‚
â”‚ (å·²è¢« Xposed ä¿®æ”¹) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·³è½¬åˆ° Xposed Native Bridge â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ handleHookedMethod â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€â”€â–º è°ƒç”¨ beforeHookedMethod å›è°ƒ
â”‚ (å¯ä»¥ä¿®æ”¹å‚æ•°æˆ–è·³è¿‡åŸæ–¹æ³•)
â”‚
â”œâ”€â”€â–º è°ƒç”¨åŸå§‹æ–¹æ³• (å¦‚æœæœªè·³è¿‡)
â”‚ (ä½¿ç”¨å¤‡ä»½çš„åŸå§‹å…¥å£ç‚¹)
â”‚
â”œâ”€â”€â–º è°ƒç”¨ afterHookedMethod å›è°ƒ
â”‚ (å¯ä»¥ä¿®æ”¹è¿”å›å€¼)
â”‚
â–¼
è¿”å›ç»™è°ƒç”¨è€…</p>
<pre><code>
**å…³é”®å­—æ®µä¿®æ”¹ï¼š**

- `access_flags_`: æ·»åŠ  `ACC_NATIVE` æ ‡å¿—
- `entry_point_from_quick_compiled_code_`: æ›¿æ¢ä¸º Xposed æ¡¥æ¥å‡½æ•°åœ°å€
- å¤‡ä»½åŸå§‹å­—æ®µå€¼ä»¥ä¾¿åç»­æ¢å¤

**ä¼ªä»£ç ç¤ºä¾‹ï¼š**

```cpp
// Xposed å†…éƒ¨ç®€åŒ–é€»è¾‘
void hookMethod(ArtMethod* method) {
// ä¿å­˜åŸå§‹ä¿¡æ¯
backup.original_flags = method-&gt;access_flags_;
backup.original_entry = method-&gt;entry_point_from_quick_compiled_code_;

// ä¿®æ”¹ä¸º native æ–¹æ³•
method-&gt;access_flags_ |= ACC_NATIVE;
method-&gt;entry_point_from_quick_compiled_code_ = xposed_bridge_entry;
}

</code></pre>
<p>æ¨¡å— A - beforeHookedMethod
â”‚
â–¼
æ¨¡å— B - beforeHookedMethod
â”‚
â–¼
åŸå§‹æ–¹æ³•æ‰§è¡Œ
â”‚
â–¼
æ¨¡å— B - afterHookedMethod
â”‚
â–¼
æ¨¡å— A - afterHookedMethod
â”‚
â–¼
è¿”å›ç»“æœ</p>
<pre><code>
### 3. æ€§èƒ½ä¼˜åŒ–æœºåˆ¶

* *JIT/AOT ç¼–è¯‘å½±å“ï¼š**

- Hooked æ–¹æ³•è¢«æ ‡è®°ä¸º nativeï¼Œé¿å… JIT ç¼–è¯‘
- é€šè¿‡ native æ¡¥æ¥çš„é¢å¤–å¼€é”€ï¼ˆçº¦ 10-50Î¼s æ¯æ¬¡è°ƒç”¨ï¼‰
- å¤§é‡ Hook å¯èƒ½å½±å“åº”ç”¨å¯åŠ¨æ—¶é—´

* *æœ€ä½³å®è·µï¼š**

- åª Hook å¿…è¦çš„æ–¹æ³•
- åœ¨å›è°ƒä¸­é¿å…è€—æ—¶æ“ä½œ
- ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å‡å°‘ä¸å¿…è¦çš„å¤„ç†
---
## ä¸å…¶ä»– Hook æ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | Xposed | Frida | VirtualXposed |
| ------------- | ------------ | --------------------- | ------------- |
| **éœ€è¦ Root** | æ˜¯ | å¦ï¼ˆGadget æ¨¡å¼é™¤å¤–ï¼‰ | å¦ |
| **æ³¨å…¥æ–¹å¼** | Zygote çº§åˆ« | è¿›ç¨‹çº§åˆ« | è™šæ‹ŸåŒ–å®¹å™¨ |
| **æ€§èƒ½å¼€é”€** | ä½-ä¸­ | ä¸­-é«˜ | ä¸­ |
| **å¼€å‘è¯­è¨€** | Java | JavaScript/Python | Java |
| **åŠ¨æ€æ€§** | é‡å¯åº”ç”¨ç”Ÿæ•ˆ | å®æ—¶ç”Ÿæ•ˆ | é‡å¯åº”ç”¨ç”Ÿæ•ˆ |
| **ç¨³å®šæ€§** | é«˜ | ä¸­ | ä¸­-ä½ |
| **é€‚ç”¨åœºæ™¯** | é•¿æœŸä¿®æ”¹ | åŠ¨æ€åˆ†æ/è°ƒè¯• | æ—  Root æµ‹è¯• |
---
## å®‰å…¨å½±å“ä¸æ£€æµ‹

### åº”ç”¨å±‚æ£€æµ‹æ–¹æ³•

* *1. æ£€æŸ¥ Xposed ç‰¹å¾æ–‡ä»¶ï¼š**

```java
private boolean isXposedInstalled() {
try {
// æ£€æŸ¥ XposedBridge ç±»
Class.forName(&quot;de.robv.android.xposed.XposedBridge&quot;);
return true;
} catch (ClassNotFoundException e) {
return false;
}
}

</code></pre>
<p>int modifiers = method.getModifiers();
return Modifier.isNative(modifiers) &amp;&amp; !shouldBeNative(method);
}</p>
<pre><code>for (StackTraceElement trace : traces) {
if (trace.getClassName().contains(&quot;XposedBridge&quot;)) {
return true;
}
}
return false;
}

</code></pre>
<ol start="3">
<li>æ¸…ç†å †æ ˆè·Ÿè¸ªä¿¡æ¯</li>
<li>ä½¿ç”¨å®šåˆ¶ç‰ˆ Xposedï¼ˆä¿®æ”¹ç‰¹å¾å­—ç¬¦ä¸²ï¼‰</li>
</ol>
<hr />
<h2>å®é™…åº”ç”¨åœºæ™¯</h2>
<h3>1. éšç§ä¿æŠ¤</h3>
<ul>
<li>ä¼ªé€ è®¾å¤‡ä¿¡æ¯ï¼ˆIMEIã€MAC åœ°å€ç­‰ï¼‰</li>
<li>é˜»æ­¢æƒé™è¯·æ±‚</li>
<li>æ‹¦æˆªæ•æ„Ÿæ•°æ®ä¸Šä¼ </li>
</ul>
<h3>2. åŠŸèƒ½å¢å¼º</h3>
<ul>
<li>ç§»é™¤å¹¿å‘Š</li>
<li>è§£é” VIP åŠŸèƒ½</li>
<li>ä¿®æ”¹åº”ç”¨è¡Œä¸º</li>
</ul>
<h3>3. é€†å‘åˆ†æ</h3>
<ul>
<li>ç›‘æ§æ–¹æ³•è°ƒç”¨</li>
<li>æå–åŠ å¯†å¯†é’¥</li>
<li>åˆ†æç®—æ³•é€»è¾‘</li>
</ul>
<h3>4. è‡ªåŠ¨åŒ–æµ‹è¯•</h3>
<ul>
<li>æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸º</li>
<li>æ³¨å…¥æµ‹è¯•æ•°æ®</li>
<li>ç»•è¿‡éªŒè¯ç </li>
</ul>
<hr />
<h2>æ¨¡å—å¼€å‘ç¤ºä¾‹</h2>
<h3>åŸºç¡€ Hook ç¤ºä¾‹</h3>
<pre><code class="language-java">public class MyXposedModule implements IXposedHookLoadPackage {

@Override
public void handleLoadPackage(XC_LoadPackage.LoadPackageParam lpparam)
throws Throwable {

// åª Hook ç›®æ ‡åº”ç”¨
if (!lpparam.packageName.equals(&quot;com.example.target&quot;))
return;

// Hook æ–¹æ³•
findAndHookMethod(
&quot;com.example.target.MainActivity&quot;,
lpparam.classLoader,
&quot;getUserInfo&quot;, // æ–¹æ³•å
new XC_MethodHook() {
@Override
protected void beforeHookedMethod(MethodHookParam param)
throws Throwable {
// åœ¨æ–¹æ³•æ‰§è¡Œå‰
XposedBridge.log(&quot;getUserInfo å³å°†è¢«è°ƒç”¨&quot;);
}

@Override
protected void afterHookedMethod(MethodHookParam param)
throws Throwable {
// åœ¨æ–¹æ³•æ‰§è¡Œå
String result = (String) param.getResult();
XposedBridge.log(&quot;getUserInfo è¿”å›: &quot; + result);

// ä¿®æ”¹è¿”å›å€¼
param.setResult(&quot;Fake User Info&quot;);
}
}
);
}
}

</code></pre>
<p>lpparam.classLoader,
byte[].class, // å‚æ•°ç±»å‹
String.class,
new XC_MethodHook() {
@Override
protected void afterHookedMethod(MethodHookParam param)
throws Throwable {
byte[] key = (byte[]) param.args[0];
String algorithm = (String) param.args[1];</p>
<p>XposedBridge.log(&quot;æ•è·å¯†é’¥!&quot;);
XposedBridge.log(&quot;ç®—æ³•: &quot; + algorithm);
XposedBridge.log(&quot;å¯†é’¥: &quot; + bytesToHex(key));
}
}
);</p>
<ol>
<li><strong>ä¾èµ– Root æƒé™</strong>ï¼šéœ€è¦ç³»ç»Ÿçº§è®¿é—®</li>
<li><strong>ç¨³å®šæ€§é—®é¢˜</strong>ï¼šä¸å½“ä½¿ç”¨å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ</li>
<li><strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong>ï¼šéœ€è¦é’ˆå¯¹ä¸åŒ Android ç‰ˆæœ¬é€‚é…</li>
<li><strong>æ£€æµ‹ä¸å¯¹æŠ—</strong>ï¼šè¶Šæ¥è¶Šå¤šåº”ç”¨å®æ–½å Xposed æ£€æµ‹</li>
</ol>
<h3>æœªæ¥è¶‹åŠ¿</h3>
<ol>
<li><strong>EdXposed/LSPosed</strong>ï¼šåŸºäº Riru/Zygisk çš„æ–°å®ç°</li>
<li><strong>è™šæ‹ŸåŒ–æ–¹æ¡ˆ</strong>ï¼šVirtualXposedã€å¤ªæç­‰æ— éœ€ Root çš„æ–¹æ¡ˆ</li>
<li><strong>å¯¹æŠ—å‡çº§</strong>ï¼šæ›´å¤æ‚çš„æ£€æµ‹ä¸åæ£€æµ‹æŠ€æœ¯</li>
</ol>
<hr />
<h2>æ€»ç»“</h2>
<p>Xposed é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯å®ç°äº†å¼ºå¤§çš„è¿è¡Œæ—¶ä¿®æ”¹èƒ½åŠ›ï¼š</p>
<ol>
<li><strong>Zygote æ³¨å…¥</strong>ï¼šç¡®ä¿æ¯ä¸ªåº”ç”¨éƒ½åŠ è½½ Xposed Bridge</li>
<li><strong>æ–¹æ³•ä¼ªè£…</strong>ï¼šå°† Java æ–¹æ³•è½¬æ¢ä¸º nativeï¼Œé‡å®šå‘å…¥å£ç‚¹</li>
<li><strong>å›è°ƒæœºåˆ¶</strong>ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘</li>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šçµæ´»çš„ APK æ’ä»¶ç³»ç»Ÿ</li>
</ol>
<p>è¿™ç§è®¾è®¡ä½¿ Xposed æˆä¸º Android å¹³å°ä¸Šæœ€å¼ºå¤§çš„è¿è¡Œæ—¶ä¿®æ”¹æ¡†æ¶ä¹‹ä¸€ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†å®‰å…¨é£é™©å’Œæ£€æµ‹å¯¹æŠ—çš„æŒ‘æˆ˜ã€‚</p>
<p>ç†è§£ Xposed çš„å†…éƒ¨åŸç†ä¸ä»…æœ‰åŠ©äºå¼€å‘æ›´å¥½çš„æ¨¡å—ï¼Œä¹Ÿä¸ºé€†å‘å·¥ç¨‹ã€å®‰å…¨ç ”ç©¶å’Œåº”ç”¨ä¿æŠ¤æä¾›äº†é‡è¦çš„æŠ€æœ¯æ´å¯Ÿã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-44">
                                                <h2>44. Unidbg Guide</h2>
                                                <h1>Unidbg æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—</h1>
<h2>Unidbg æ˜¯ä¸€ä¸ªåŸºäº Java å¼€å‘çš„ã€å¼€æºçš„ã€åŠŸèƒ½å¼ºå¤§çš„ Android/iOS åŸç”Ÿåº“ (<code>.so</code>/<code>.dylib</code>) æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ã€‚å®ƒèƒ½å¤Ÿåœ¨ PC (Windows/Linux/macOS) ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ ARM æ‰§è¡Œç¯å¢ƒï¼Œä½¿å¾—ä½ å¯ä»¥åƒè°ƒç”¨æœ¬åœ° Java æ–¹æ³•ä¸€æ ·ç›´æ¥è°ƒç”¨å’Œè°ƒè¯•åŸç”Ÿåº“ä¸­çš„å‡½æ•°ã€‚è¿™å¯¹äºåˆ†æé«˜åº¦æ··æ·†ã€åŒ…å«å¤§é‡ç¯å¢ƒä¾èµ–å’Œåè°ƒè¯•æœºåˆ¶çš„åŸç”Ÿç®—æ³•æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªé©å‘½æ€§çš„å·¥å…·ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#unidbg-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C%E6%A1%86%E6%9E%B6%E6%8C%87%E5%8D%97">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶æŒ‡å—</a><ul>
<li><a href="#unidbg-%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E-java-%E5%BC%80%E5%8F%91%E7%9A%84%E5%BC%80%E6%BA%90%E7%9A%84%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84-androidios-%E5%8E%9F%E7%94%9F%E5%BA%93-sodylib-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C%E6%A1%86%E6%9E%B6%E5%AE%83%E8%83%BD%E5%A4%9F%E5%9C%A8-pc-windowslinuxmacos-%E4%B8%8A%E6%A8%A1%E6%8B%9F%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84-arm-%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%BD%BF%E5%BE%97%E4%BD%A0%E5%8F%AF%E4%BB%A5%E5%83%8F%E8%B0%83%E7%94%A8%E6%9C%AC%E5%9C%B0-java-%E6%96%B9%E6%B3%95%E4%B8%80%E6%A0%B7%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%E5%92%8C%E8%B0%83%E8%AF%95%E5%8E%9F%E7%94%9F%E5%BA%93%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E8%BF%99%E5%AF%B9%E4%BA%8E%E5%88%86%E6%9E%90%E9%AB%98%E5%BA%A6%E6%B7%B7%E6%B7%86%E5%8C%85%E5%90%AB%E5%A4%A7%E9%87%8F%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8F%8D%E8%B0%83%E8%AF%95%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%94%9F%E7%AE%97%E6%B3%95%E6%9D%A5%E8%AF%B4%E6%98%AF%E4%B8%80%E4%B8%AA%E9%9D%A9%E5%91%BD%E6%80%A7%E7%9A%84%E5%B7%A5%E5%85%B7">Unidbg æ˜¯ä¸€ä¸ªåŸºäº Java å¼€å‘çš„ã€å¼€æºçš„ã€åŠŸèƒ½å¼ºå¤§çš„ Android/iOS åŸç”Ÿåº“ (<code>.so</code>/<code>.dylib</code>) æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ã€‚å®ƒèƒ½å¤Ÿåœ¨ PC (Windows/Linux/macOS) ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ ARM æ‰§è¡Œç¯å¢ƒï¼Œä½¿å¾—ä½ å¯ä»¥åƒè°ƒç”¨æœ¬åœ° Java æ–¹æ³•ä¸€æ ·ç›´æ¥è°ƒç”¨å’Œè°ƒè¯•åŸç”Ÿåº“ä¸­çš„å‡½æ•°ã€‚è¿™å¯¹äºåˆ†æé«˜åº¦æ··æ·†ã€åŒ…å«å¤§é‡ç¯å¢ƒä¾èµ–å’Œåè°ƒè¯•æœºåˆ¶çš„åŸç”Ÿç®—æ³•æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªé©å‘½æ€§çš„å·¥å…·ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li>
<li><a href="#-%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"># æ ¸å¿ƒæ€æƒ³ä¸åº”ç”¨åœºæ™¯</a></li>
<li><a href="#-unidbg-vs-frida"># Unidbg vs. Frida</a></li>
<li><a href="#-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"># ç¯å¢ƒæ­å»º</a></li>
<li><a href="#-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"># åŸºæœ¬ä½¿ç”¨æµç¨‹</a></li>
<li><a href="#-%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7"># å®æˆ˜æŠ€å·§</a></li>
</ul>
</li>
</ul>
<hr />
<h2># æ ¸å¿ƒæ€æƒ³ä¸åº”ç”¨åœºæ™¯</h2>
<p>Unidbg çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>&quot;æ¬ºéª—&quot;</strong>ã€‚å®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼è®© <code>.so</code> æ–‡ä»¶è®¤ä¸ºè‡ªå·±æ­£è¿è¡Œåœ¨ä¸€ä¸ªçœŸå®çš„ Android è®¾å¤‡ä¸Šï¼š</p>
<ul>
<li><p><strong>æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</strong>: åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½ å¯ä»¥å°†åº”ç”¨çš„æ•°æ®ã€é…ç½®æ–‡ä»¶ç­‰æ”¾å…¥å…¶ä¸­ã€‚</p>
</li>
<li><p><strong>æ¨¡æ‹Ÿå†…å­˜ç©ºé—´</strong>: åŠ è½½ <code>.so</code> æ–‡ä»¶åŠå…¶ä¾èµ–çš„ç³»ç»Ÿåº“ (å¦‚ <code>libc.so</code>, <code>libdl.so</code>) åˆ°æ¨¡æ‹Ÿçš„å†…å­˜ç©ºé—´ä¸­ã€‚</p>
</li>
<li><p><strong>æ¨¡æ‹Ÿ JNI ç¯å¢ƒ</strong>: å®ç°äº†å¤§éƒ¨åˆ† JNI å‡½æ•°ï¼Œå½“ <code>.so</code> æ–‡ä»¶è¯•å›¾é€šè¿‡ JNI è°ƒç”¨ Java å±‚ä»£ç æ—¶ï¼ŒUnidbg ä¼šæ‹¦æˆªå¹¶å¯ä»¥è¿”å›ä½ æŒ‡å®šçš„å€¼ã€‚</p>
</li>
<li><p><strong>Hook ç³»ç»Ÿè°ƒç”¨ (SVC)</strong>: æ‹¦æˆªåº•å±‚çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿”å›é¢„è®¾çš„ç»“æœã€‚</p>
</li>
<li><p><strong>ä¸»è¦åº”ç”¨åœºæ™¯</strong>:</p>
</li>
<li><p><strong>ç®—æ³•å¤ç° (ä¸€æŠŠæ¢­)</strong>: ç›´æ¥è°ƒç”¨ç›®æ ‡åŠ å¯†/è§£å¯†å‡½æ•°ï¼Œè¾“å…¥å‚æ•°å¹¶è·å–è¿”å›å€¼ï¼Œæ— éœ€è´¹åŠ›å»é€†å‘ç®—æ³•æœ¬èº«ã€‚</p>
</li>
<li><p><strong>ç»•è¿‡ç¯å¢ƒæ£€æµ‹</strong>: ç›®æ ‡å‡½æ•°å¯èƒ½åŒ…å«å¯¹ Rootã€æ¨¡æ‹Ÿå™¨ã€è®¾å¤‡ ID ç­‰çš„æ£€æµ‹ã€‚Unidbg å¯ä»¥è½»æ¾ Hook è¿™äº›æ£€æµ‹ç‚¹ï¼Œè®©å®ƒä»¬å…¨éƒ¨å¤±æ•ˆã€‚</p>
</li>
<li><p><strong>ç»•è¿‡åè°ƒè¯•</strong>: <code>ptrace</code> ç­‰åè°ƒè¯•æ‰‹æ®µåœ¨ Unidbg çš„æ¨¡æ‹Ÿç¯å¢ƒä¸­å¤©ç„¶æ— æ•ˆã€‚</p>
</li>
<li><p><strong>æ‰¹é‡è®¡ç®—/çˆ†ç ´</strong>: ç¼–å†™è„šæœ¬ï¼Œæ‰¹é‡è°ƒç”¨ç›®æ ‡å‡½æ•°ï¼Œç”¨äºå‚æ•°çš„çˆ†ç ´æˆ–ç”Ÿæˆå¤§é‡ç­¾åã€‚</p>
</li>
<li><p><strong>ä¸»åŠ¨è°ƒç”¨éå¯¼å‡ºå‡½æ•°</strong>: ä¸ Frida ä¸åŒï¼Œåªè¦çŸ¥é“å‡½æ•°åç§»ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œæ— è®ºå®ƒæ˜¯å¦è¢«å¯¼å‡ºã€‚</p>
</li>
</ul>
<hr />
<h2># Unidbg vs. Frida</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">Unidbg</th>
  <th style="text-align:left">Frida</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>æ‰§è¡Œç¯å¢ƒ</strong></td>
  <td style="text-align:left"><strong>PC ç«¯ (æ¨¡æ‹Ÿæ‰§è¡Œ)</strong></td>
  <td style="text-align:left"><strong>ç§»åŠ¨è®¾å¤‡ç«¯ (çœŸæœº/æ¨¡æ‹Ÿå™¨)</strong></td>
</tr>
<tr>
  <td style="text-align:left"><strong>å·¥ä½œæ¨¡å¼</strong></td>
  <td style="text-align:left">å°† <code>.so</code> å½“ä½œä¸€ä¸ª&quot;é»‘ç›’&quot;åº“æ¥è°ƒç”¨</td>
  <td style="text-align:left">ä¾µå…¥æ­£åœ¨è¿è¡Œçš„åº”ç”¨è¿›ç¨‹è¿›è¡Œ Hook</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ä¾èµ–</strong></td>
  <td style="text-align:left">ä»…éœ€è¦ <code>.so</code> æ–‡ä»¶åŠå…¶ä¾èµ–çš„åº“</td>
  <td style="text-align:left">éœ€è¦ä¸€ä¸ªå®Œæ•´çš„ã€èƒ½è¿è¡Œçš„ APK</td>
</tr>
<tr>
  <td style="text-align:left"><strong>åè°ƒè¯•</strong></td>
  <td style="text-align:left"><strong>å¤©ç„¶å…ç–«</strong></td>
  <td style="text-align:left">éœ€è¦ç¼–å†™è„šæœ¬æ¥å¯¹æŠ—åè°ƒè¯•</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ç¯å¢ƒä¾èµ–</strong></td>
  <td style="text-align:left">éœ€è¦æ‰‹åŠ¨æ¨¡æ‹Ÿæˆ– Hook</td>
  <td style="text-align:left">è¿è¡Œåœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œæ— éœ€æ¨¡æ‹Ÿ</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ€§èƒ½</strong></td>
  <td style="text-align:left">è¾ƒä½ (å› ä¸ºæ˜¯å…¨æ¨¡æ‹Ÿ)</td>
  <td style="text-align:left">è¾ƒé«˜ (ä»£ç åœ¨è®¾å¤‡ä¸ŠåŸç”Ÿè¿è¡Œ)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>é€‚ç”¨æ€§</strong></td>
  <td style="text-align:left">é€‚åˆçº¯ç®—æ³•åˆ†æï¼Œä¸æ¶‰åŠ UI å’Œå¤æ‚ä¸šåŠ¡æµ</td>
  <td style="text-align:left">é€‚åˆåˆ†æä¸ Android ç³»ç»Ÿã€UI å¼ºç›¸å…³çš„ä¸šåŠ¡é€»è¾‘</td>
</tr>
</tbody>
</table>
<hr />
<h2># ç¯å¢ƒæ­å»º</h2>
<ol>
<li><strong>JDK</strong>: ç¡®ä¿å·²å®‰è£… JDK 8 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
<li><strong>Maven</strong>: ç”¨äºé¡¹ç›®æ„å»ºå’Œä¾èµ–ç®¡ç†ã€‚</li>
<li><strong>IDE</strong>: æ¨èä½¿ç”¨ IntelliJ IDEAã€‚</li>
<li><strong>ä¸‹è½½ Unidbg</strong>: ä»å…¶ GitHub Release é¡µé¢ä¸‹è½½æœ€æ–°çš„å‘è¡Œç‰ˆ <code>unidbg-dist.zip</code>ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ Maven ä¾èµ–ã€‚</li>
<li><strong>åˆ›å»º Maven é¡¹ç›®</strong>: åœ¨ IDE ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Maven é¡¹ç›®ï¼Œå¹¶åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ  Unidbg çš„ä¾èµ–ï¼š<pre><code class="language-xml">&lt;dependency&gt;
&lt;groupId&gt;com.github.unidbg&lt;/groupId&gt;
&lt;artifactId&gt;unidbg-android&lt;/artifactId&gt;
&lt;version&gt;0.9.7&lt;/version&gt; &lt;!-- Use latest version --&gt;
&lt;/dependency&gt;
</code></pre>
</li>
</ol>
<pre><code>
## # åŸºæœ¬ä½¿ç”¨æµç¨‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè°ƒç”¨ `.so` ä¸­ç®€å•å‡½æ•°çš„å…¸å‹ä»£ç ç»“æ„ï¼š

```java
import com.github.unidbg.AndroidEmulator;
import com.github.unidbg.Module;
import com.github.unidbg.linux.android.AndroidEmulatorBuilder;
import com.github.unidbg.linux.android.AndroidResolver;
import com.github.unidbg.linux.android.dvm.*;
import com.github.unidbg.memory.Memory;

import java.io.File;

public class MyTest extends DvmObject&lt;String&gt; {

private final AndroidEmulator emulator;
private final Module module;
private final VM vm;

public MyTest() {
// 1. Create emulator instance
emulator = AndroidEmulatorBuilder.for32Bit().build();
final Memory memory = emulator.getMemory();
// 2. Set system library resolver
memory.setLibraryResolver(new AndroidResolver(23)); // API 23

// 3. Create virtual machine instance (DVM)
vm = emulator.createDalvikVM(new File(&quot;target/classes/apk/app-debug.apk&quot;)); // APK can be provided for automatic extraction
vm.setVerbose(true); // Print detailed logs

// 4. Load target .so
DalvikModule dm = vm.loadLibrary(new File(&quot;target/classes/so/libnative-lib.so&quot;), true);
module = dm.getModule();

// 5. Call JNI_OnLoad (optional but recommended)
dm.callJNI_OnLoad(emulator);
}

public void callNativeFunc() {
// 6. Call target function
Number result = module.callFunction(emulator, 0x1234, &quot;hello unidbg&quot;)[0]; // 0x1234 is the function offset
System.out.println(&quot;Result: &quot; + result.intValue());
}

public static void main(String[] args) {
MyTest test = new MyTest();
test.callNativeFunc();
test.emulator.close();
}
}

</code></pre>
<ul>
<li><p><strong><code>VM</code></strong>: è™šæ‹Ÿæœºï¼Œå¯ä»¥æ˜¯ <code>DalvikVM</code> (DVM) æˆ– <code>ART</code>ã€‚è´Ÿè´£ç®¡ç† Java å¯¹è±¡ (<code>DvmObject</code>) å’Œ JNI è°ƒç”¨ã€‚</p>
</li>
<li><p><strong><code>Module</code></strong>: ä»£è¡¨ä¸€ä¸ªå·²åŠ è½½åˆ°å†…å­˜ä¸­çš„ <code>.so</code> æ¨¡å—ã€‚</p>
</li>
<li><p><code>callFunction(emulator, address, args...)</code>: <strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼Œé€šè¿‡ç»å¯¹åœ°å€æˆ–åç§»è°ƒç”¨å‡½æ•°ã€‚</p>
</li>
<li><p><code>findSymbolByName(&quot;...&quot;)</code>: æŒ‰åç§°æŸ¥æ‰¾å¯¼å‡ºå‡½æ•°ã€‚</p>
</li>
<li><p><strong><code>DvmObject</code></strong>: Java å¯¹è±¡çš„ä»£ç†ã€‚Unidbg ä½¿ç”¨å®ƒæ¥å‘ native å‡½æ•°ä¼ é€’å­—ç¬¦ä¸²ã€å­—èŠ‚æ•°ç»„ç­‰ã€‚</p>
</li>
<li><p><strong><code>AbstractJni</code></strong>: å¦‚æœ <code>.so</code> ä¸­æœ‰å¤æ‚çš„ JNI å›è°ƒï¼Œä½ éœ€è¦ç»§æ‰¿ <code>AbstractJni</code> å¹¶é‡å†™å¯¹åº”çš„æ–¹æ³•ï¼Œä»¥æ¨¡æ‹Ÿ Java å±‚çš„è¡Œä¸ºã€‚</p>
</li>
<li><p><strong>Hooking</strong>: Unidbg ä½¿ç”¨ <code>com.github.unidbg.hook.Hooker</code> æ¥å£å’Œ <code>TraceHook</code> ç­‰å·¥å…·æ¥æä¾›ç±»ä¼¼ Frida çš„ Hooking èƒ½åŠ›ï¼Œå¯ä»¥ç›‘æ§æŒ‡ä»¤ã€å†…å­˜è¯»å†™ç­‰ã€‚</p>
</li>
</ul>
<hr />
<h2># å®æˆ˜æŠ€å·§</h2>
<ul>
<li><p><strong>è¡¥ç¯å¢ƒ</strong>: å¦‚æœ <code>.so</code> ä¾èµ–ç‰¹å®šçš„è®¾å¤‡ä¿¡æ¯æˆ–æ–‡ä»¶ï¼Œä½ éœ€è¦ï¼š</p>
</li>
<li><p>åœ¨è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å’Œå†…å®¹ã€‚</p>
</li>
<li><p>Hook <code>open</code>, <code>read</code>, <code>access</code> ç­‰ libc å‡½æ•°ï¼Œè¿”å›é¢„æœŸçš„ç»“æœã€‚</p>
</li>
<li><p>Hook JNI è°ƒç”¨ï¼Œå¦‚ <code>getSystemService</code>ï¼Œè¿”å›ä¸€ä¸ªæ¨¡æ‹Ÿçš„ <code>TelephonyManager</code> å¯¹è±¡ã€‚</p>
</li>
<li><p><strong>å®šä½å‡½æ•°åœ°å€</strong>: å‡½æ•°åœ°å€æ˜¯ <code>åŸºåœ°å€ (module.base) + åç§»</code>ã€‚åç§»å¯ä»¥ä» IDA/Ghidra ä¸­è·å¾—ã€‚</p>
</li>
<li><p><strong>è®¾ç½®æ–­ç‚¹</strong>: ä½¿ç”¨ <code>emulator.attach().addBreakPoint(address, ...)</code> å¯ä»¥åœ¨æŒ‡å®šåœ°å€è®¾ç½®æ–­ç‚¹ï¼Œè¿›è¡Œè°ƒè¯•ã€‚</p>
</li>
<li><p><strong>æ—¥å¿—åˆ†æ</strong>: <code>vm.setVerbose(true)</code> ä¼šæ‰“å°éå¸¸è¯¦ç»†çš„ JNI è°ƒç”¨å’Œ SVC æ—¥å¿—ï¼Œè¿™æ˜¯è§£å†³ç¯å¢ƒé—®é¢˜çš„å…³é”®ã€‚</p>
</li>
<li><p><strong>å‚è€ƒå®˜æ–¹æµ‹è¯•ç”¨ä¾‹</strong>: Unidbg é¡¹ç›®çš„ <code>unidbg-android/src/test/java</code> ç›®å½•ä¸‹æœ‰å¤§é‡é’ˆå¯¹ä¸»æµ App çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ˜¯å­¦ä¹  Unidbg çš„æœ€ä½³èµ„æ–™ã€‚</p>
</li>
</ul>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-45">
                                                <h2>45. Unidbg Internals</h2>
                                                <h1>Unidbg å®ç°åŸç†å‰–æ</h1>
<h2>Unidbg æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Android åŸç”Ÿåº“ (<code>.so</code>) æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ã€‚å®ƒå…è®¸ä½ åœ¨æ²¡æœ‰ Android çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨ PC (macOS, Windows, Linux) ä¸Šè¿è¡Œå’Œè°ƒè¯• JNI å‡½æ•°ã€‚ç†è§£å…¶å·¥ä½œåŸç†ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆåœ°è§£å†³å¤æ‚çš„åŠ å¯†ç®—æ³•é€†å‘ã€åè®®åˆ†æç­‰é—®é¢˜ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#unidbg-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90">Unidbg å®ç°åŸç†å‰–æ</a><ul>
<li><a href="#unidbg-%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-android-%E5%8E%9F%E7%94%9F%E5%BA%93-so-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C%E6%A1%86%E6%9E%B6%E5%AE%83%E5%85%81%E8%AE%B8%E4%BD%A0%E5%9C%A8%E6%B2%A1%E6%9C%89-android-%E7%9C%9F%E6%9C%BA%E6%88%96%E6%A8%A1%E6%8B%9F%E5%99%A8%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E7%9B%B4%E6%8E%A5%E5%9C%A8-pc-macos-windows-linux-%E4%B8%8A%E8%BF%90%E8%A1%8C%E5%92%8C%E8%B0%83%E8%AF%95-jni-%E5%87%BD%E6%95%B0%E7%90%86%E8%A7%A3%E5%85%B6%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%E6%9B%B4%E9%AB%98%E6%95%88%E5%9C%B0%E8%A7%A3%E5%86%B3%E5%A4%8D%E6%9D%82%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%80%86%E5%90%91%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%E7%AD%89%E9%97%AE%E9%A2%98">Unidbg æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Android åŸç”Ÿåº“ (<code>.so</code>) æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ã€‚å®ƒå…è®¸ä½ åœ¨æ²¡æœ‰ Android çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨ PC (macOS, Windows, Linux) ä¸Šè¿è¡Œå’Œè°ƒè¯• JNI å‡½æ•°ã€‚ç†è§£å…¶å·¥ä½œåŸç†ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆåœ°è§£å†³å¤æ‚çš„åŠ å¯†ç®—æ³•é€†å‘ã€åè®®åˆ†æç­‰é—®é¢˜ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3%E5%9C%A8-pc-%E4%B8%8A%E6%A8%A1%E6%8B%9F%E4%B8%80%E4%B8%AA-android-%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83">æ ¸å¿ƒæ€æƒ³ï¼šåœ¨ PC ä¸Šæ¨¡æ‹Ÿä¸€ä¸ª android æ‰§è¡Œç¯å¢ƒ</a></li>
</ul>
</li>
<li><a href="#unidbg-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3%E5%B0%B1%E6%98%AF%E7%94%A8%E7%BA%AF-java-%E5%9C%A8-pc-%E4%B8%8A%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%99%9A%E6%8B%9F%E7%9A%84%E9%AB%98%E5%BA%A6%E4%BB%BF%E7%9C%9F%E7%9A%84-android-%E7%94%A8%E6%88%B7%E6%80%81-user-mode-%E7%8E%AF%E5%A2%83%E5%AE%83%E4%B8%8D%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A8%A1%E6%8B%9F%E5%99%A8%E8%80%8C%E6%98%AF%E4%B8%93%E6%B3%A8%E4%BA%8E%E6%A8%A1%E6%8B%9F%E4%B8%80%E4%B8%AA-android-%E8%BF%9B%E7%A8%8B-%E6%89%80%E9%9C%80%E7%9A%84%E4%B8%80%E5%88%87%E8%AE%A9-so-%E6%96%87%E4%BB%B6%E6%84%9F%E8%A7%89%E8%87%AA%E5%B7%B1%E6%AD%A3%E8%BF%90%E8%A1%8C%E5%9C%A8%E4%B8%80%E4%B8%AA%E7%9C%9F%E5%AE%9E%E7%9A%84-android-%E8%AE%BE%E5%A4%87%E9%87%8C">Unidbg çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼š<strong>ç”¨çº¯ Java åœ¨ PC ä¸Šæ„å»ºä¸€ä¸ªè™šæ‹Ÿçš„ã€é«˜åº¦ä»¿çœŸçš„ Android ç”¨æˆ·æ€ (User-Mode) ç¯å¢ƒ</strong>ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå™¨ï¼Œè€Œæ˜¯ä¸“æ³¨äºæ¨¡æ‹Ÿä¸€ä¸ª Android <em>è¿›ç¨‹</em> æ‰€éœ€çš„ä¸€åˆ‡ï¼Œè®© <code>.so</code> æ–‡ä»¶â€œæ„Ÿè§‰â€è‡ªå·±æ­£è¿è¡Œåœ¨ä¸€ä¸ªçœŸå®çš„ Android è®¾å¤‡é‡Œã€‚</a><ul>
<li><a href="#%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3">å…³é”®ç»„ä»¶è¯¦è§£</a><ul>
<li><a href="#unicorn-engine-cpu-%E6%A8%A1%E6%8B%9F%E5%99%A8"><strong>Unicorn Engine</strong>: CPU æ¨¡æ‹Ÿå™¨</a></li>
<li><a href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B8%8E%E6%98%A0%E5%B0%84-memory-management"><strong>å†…å­˜ç®¡ç†ä¸æ˜ å°„ (Memory Management)</strong></a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E5%BA%93%E5%8A%A0%E8%BD%BD%E5%99%A8-dynamic-linker"><strong>åŠ¨æ€åº“åŠ è½½å™¨ (Dynamic Linker)</strong></a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%A4%84%E7%90%86-syscall-handler"><strong>ç³»ç»Ÿè°ƒç”¨å¤„ç† (Syscall Handler)</strong></a></li>
<li><a href="#jni-%E5%87%BD%E6%95%B0%E6%A8%A1%E6%8B%9F-jni-emulation"><strong>JNI å‡½æ•°æ¨¡æ‹Ÿ (JNI Emulation)</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E9%80%9A%E8%BF%87%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8Funidbg-%E5%B7%A7%E5%A6%99%E5%9C%B0%E5%B0%86-so-%E5%AF%B9-android-%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E8%B0%83%E7%94%A8%E5%AB%81%E6%8E%A5%E5%88%B0%E4%BA%86-pc-%E7%AB%AF%E7%9A%84-jvm-%E4%B8%8A">é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒUnidbg å·§å¦™åœ°å°† <code>.so</code> å¯¹ Android è™šæ‹Ÿæœºçš„è°ƒç”¨â€œå«æ¥â€åˆ°äº† PC ç«¯çš„ JVM ä¸Šã€‚</a><ul>
<li><a href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8Bunidbg-%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA-so-%E7%9A%84">å·¥ä½œæµç¨‹ï¼š<code>unidbg</code> æ˜¯å¦‚ä½•è¿è¡Œä¸€ä¸ª <code>.so</code> çš„ï¼Ÿ</a></li>
<li><a href="#unidbg-%E7%9A%84%E4%BC%98%E5%8A%BF%E4%B8%8E%E5%B1%80%E9%99%90">Unidbg çš„ä¼˜åŠ¿ä¸å±€é™</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>æ ¸å¿ƒæ€æƒ³ï¼šåœ¨ PC ä¸Šæ¨¡æ‹Ÿä¸€ä¸ª android æ‰§è¡Œç¯å¢ƒ</h3>
<p><code>.so</code> æ–‡ä»¶æ˜¯ä¸ºç‰¹å®š CPU æ¶æ„ï¼ˆå¦‚ ARMï¼‰å’Œæ“ä½œç³»ç»Ÿï¼ˆå¦‚ Androidï¼‰ç¼–è¯‘çš„ã€‚å®ƒä¸èƒ½ç›´æ¥åœ¨ä½ çš„ x86 æ¶æ„çš„ PC ä¸Šè¿è¡Œã€‚</p>
<h2>Unidbg çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼š<strong>ç”¨çº¯ Java åœ¨ PC ä¸Šæ„å»ºä¸€ä¸ªè™šæ‹Ÿçš„ã€é«˜åº¦ä»¿çœŸçš„ Android ç”¨æˆ·æ€ (User-Mode) ç¯å¢ƒ</strong>ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå™¨ï¼Œè€Œæ˜¯ä¸“æ³¨äºæ¨¡æ‹Ÿä¸€ä¸ª Android <em>è¿›ç¨‹</em> æ‰€éœ€çš„ä¸€åˆ‡ï¼Œè®© <code>.so</code> æ–‡ä»¶â€œæ„Ÿè§‰â€è‡ªå·±æ­£è¿è¡Œåœ¨ä¸€ä¸ªçœŸå®çš„ Android è®¾å¤‡é‡Œã€‚</h2>
<h3>å…³é”®ç»„ä»¶è¯¦è§£</h3>
<h4><strong>Unicorn Engine</strong>: CPU æ¨¡æ‹Ÿå™¨</h4>
<p>Unicorn æ˜¯ Unidbg çš„åŸºçŸ³ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäº QEMU çš„è½»é‡çº§ã€å¤šå¹³å°ã€å¤šæ¶æ„çš„ CPU æ¨¡æ‹Ÿå™¨åº“ã€‚</p>
<ul>
<li><p><strong>ä½œç”¨</strong>: è´Ÿè´£<strong>é€æ¡è§£é‡Šå’Œæ‰§è¡Œ</strong> <code>.so</code> æ–‡ä»¶ä¸­çš„ ARM æˆ– AArch64 (ARM64) æ±‡ç¼–æŒ‡ä»¤ã€‚</p>
</li>
<li><p><strong>åŸç†</strong>: å½“ Unidbg åŠ è½½ <code>.so</code> çš„ä»£ç æ®µåˆ°è™šæ‹Ÿå†…å­˜åï¼Œå®ƒä¼šè®¾ç½®ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ (PC) æŒ‡å‘è¦æ‰§è¡Œçš„å‡½æ•°åœ°å€ï¼Œç„¶åå‘½ä»¤ Unicorn ä»è¯¥åœ°å€å¼€å§‹æ‰§è¡Œã€‚Unicorn ä¼šè¯»å–æŒ‡ä»¤ã€è§£ç ã€æ¨¡æ‹Ÿå¯„å­˜å™¨å’Œå†…å­˜çš„è¯»å†™ï¼Œå¹¶æ›´æ–° CPU çŠ¶æ€ï¼Œå°±åƒä¸€ä¸ªçœŸå®çš„ ARM èŠ¯ç‰‡ä¸€æ ·ã€‚</p>
</li>
</ul>
<h4><strong>å†…å­˜ç®¡ç†ä¸æ˜ å°„ (Memory Management)</strong></h4>
<p>Unidbg å†…éƒ¨å®ç°äº†ä¸€å¥—å®Œæ•´çš„å†…å­˜ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºæ¨¡æ‹Ÿä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p>
<ul>
<li><strong>ä½œç”¨</strong>:</li>
</ul>
<ol>
<li>ä¸ºåŠ è½½çš„ <code>.so</code> æ–‡ä»¶åˆ†é…è™šæ‹Ÿå†…å­˜ï¼ˆä»£ç æ®µã€æ•°æ®æ®µã€BSS æ®µç­‰ï¼‰ã€‚</li>
<li>ç®¡ç†å‡½æ•°çš„æ ˆç©ºé—´ (Stack)ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€ã€‚</li>
<li>å¤„ç† <code>malloc</code>, <code>free</code> ç­‰å†…å­˜åˆ†é…è¯·æ±‚ã€‚</li>
</ol>
<ul>
<li><strong>åŸç†</strong>: å®ƒé€šè¿‡ Java çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ <code>byte[]</code> æˆ– <code>ByteBuffer</code>ï¼‰æ¥è¡¨ç¤ºå†…å­˜å—ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæ˜ å°„è¡¨ï¼ˆ<code>Map&lt;Long, MemoryBlock&gt;</code>ï¼‰æ¥ç®¡ç†è™šæ‹Ÿåœ°å€å’Œè¿™äº›å®é™…å†…å­˜å—ä¹‹é—´çš„å…³ç³»ã€‚å½“ Unicorn éœ€è¦è¯»å†™æŸä¸ªè™šæ‹Ÿåœ°å€æ—¶ï¼ŒUnidbg ä¼šæŸ¥è¯¢è¿™ä¸ªè¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„ Java å†…å­˜å—å¹¶è¿›è¡Œæ“ä½œã€‚</li>
</ul>
<h4><strong>åŠ¨æ€åº“åŠ è½½å™¨ (Dynamic Linker)</strong></h4>
<p>Android åº”ç”¨çš„ <code>.so</code> æ–‡ä»¶é€šå¸¸ä¼šä¾èµ–å…¶ä»–çš„ç³»ç»Ÿåº“ï¼Œå¦‚ <code>libc.so</code> (æ ‡å‡† C åº“), <code>liblog.so</code> (æ—¥å¿—åº“), <code>libz.so</code> (å‹ç¼©åº“) ç­‰ã€‚</p>
<ul>
<li><p><strong>ä½œç”¨</strong>: Unidbg å†…ç½®äº†ä¸€ä¸ªç®€æ˜“çš„ <code>linker</code>ï¼Œè´Ÿè´£è§£æ <code>.so</code> æ–‡ä»¶çš„ä¾èµ–é¡¹ï¼Œå¹¶åŠ è½½è¿™äº›ä¾èµ–åº“ã€‚</p>
</li>
<li><p><strong>åŸç†</strong>:</p>
</li>
</ul>
<ol>
<li><strong>è§£æ ELF</strong>: Unidbg ä¼šè¯»å– <code>.so</code> æ–‡ä»¶çš„ ELF å¤´ï¼Œæ‰¾åˆ°å…¶ <code>.dynamic</code> sectionï¼Œè¿™é‡Œè®°å½•äº†æ‰€æœ‰ä¾èµ–åº“çš„åç§°ã€‚</li>
<li><strong>åŠ è½½ä¾èµ–</strong>: Unidbg ä¼šåœ¨é¢„è®¾çš„è·¯å¾„ä¸­æŸ¥æ‰¾è¿™äº›ä¾èµ–åº“ï¼ˆå®ƒè‡ªå¸¦äº†ä¸€äº›æ ¸å¿ƒçš„ Android ç³»ç»Ÿåº“ï¼‰ï¼Œç„¶ååƒåŠ è½½ä¸» <code>.so</code> ä¸€æ ·ï¼Œå°†å®ƒä»¬ä¹ŸåŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­ã€‚</li>
<li><strong>ç¬¦å·é‡å®šä½ (Relocation)</strong>: åŠ è½½å™¨æœ€é‡è¦çš„å·¥ä½œæ˜¯å¤„ç†<strong>é‡å®šä½</strong>ã€‚å¦‚æœ A.so è°ƒç”¨äº† B.so ä¸­çš„å‡½æ•° <code>foo</code>ï¼ŒA.so ä¸­åªå­˜äº†ä¸€ä¸ªå¯¹ <code>foo</code> çš„â€œç¬¦å·å¼•ç”¨â€ã€‚åŠ è½½å™¨éœ€è¦åœ¨ B.so ä¸­æ‰¾åˆ° <code>foo</code> çš„å®é™…åœ°å€ï¼Œç„¶åå°†è¿™ä¸ªåœ°å€å¡«å›åˆ° A.so çš„è°ƒç”¨æŒ‡ä»¤ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ <code>.so</code> æ–‡ä»¶èƒ½å¤Ÿè·¨åº“è°ƒç”¨çš„å…³é”®ã€‚</li>
</ol>
<h4><strong>ç³»ç»Ÿè°ƒç”¨å¤„ç† (Syscall Handler)</strong></h4>
<p>å½“ <code>.so</code> æ–‡ä»¶éœ€è¦æ‰§è¡Œä¸€äº›éœ€è¦æ“ä½œç³»ç»Ÿå†…æ ¸å‚ä¸çš„æ“ä½œæ—¶ï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ï¼‰ï¼Œå®ƒä¼šå‘èµ·ä¸€ä¸ª<strong>ç³»ç»Ÿè°ƒç”¨ (syscall)</strong>ï¼Œè¿™é€šè¿‡ <code>SVC</code> æˆ– <code>SWI</code> æŒ‡ä»¤å®ç°ã€‚</p>
<ul>
<li><p><strong>ä½œç”¨</strong>: æ‹¦æˆªå¹¶å¤„ç† <code>.so</code> å‘å‡ºçš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ã€‚</p>
</li>
<li><p><strong>åŸç†</strong>: Unicorn å¼•æ“åœ¨æ‰§è¡Œ <code>SVC</code> æŒ‡ä»¤æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªâ€œä¸­æ–­â€ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤è¿˜ç»™ Unidbgã€‚Unidbg ä¼šæ£€æŸ¥ç‰¹å®šçš„å¯„å­˜å™¨ï¼ˆå¦‚ <code>r7</code>ï¼‰æ¥è·å–ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ï¼Œç„¶ååœ¨å…¶ <code>SyscallHandler</code> ä¸­æ‰¾åˆ°å¯¹åº”çš„ Java å®ç°å¹¶æ‰§è¡Œã€‚</p>
</li>
<li><p>ä¾‹å¦‚ï¼Œå¦‚æœ <code>.so</code> å°è¯•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼ŒUnidbg ä¼šæ‹¦æˆªè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ç”¨ Java çš„ <code>FileInputStream</code> åœ¨ PC ä¸Šå®é™…æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™ <code>.so</code>ã€‚</p>
</li>
</ul>
<h4><strong>JNI å‡½æ•°æ¨¡æ‹Ÿ (JNI Emulation)</strong></h4>
<p>è¿™æ˜¯ Unidbg æœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ã€‚JNI (Java Native Interface) æ˜¯ <code>.so</code> æ–‡ä»¶ä¸ Java å±‚ä»£ç äº¤äº’çš„æ¡¥æ¢ã€‚</p>
<ul>
<li><p><strong>ä½œç”¨</strong>: æ¨¡æ‹Ÿ Android ART/Dalvik è™šæ‹Ÿæœºæä¾›çš„æ‰€æœ‰ JNI å‡½æ•°ï¼Œå¦‚ <code>FindClass</code>, <code>GetMethodID</code>, <code>CallObjectMethod</code> ç­‰ã€‚</p>
</li>
<li><p><strong>åŸç†</strong>: Unidbg åœ¨å…¶è™šæ‹Ÿç¯å¢ƒä¸­é¢„å…ˆæ³¨å†Œäº†æ‰€æœ‰ JNI å‡½æ•°çš„ Java å®ç°ã€‚</p>
</li>
<li><p>å½“ <code>.so</code> è°ƒç”¨ <code>FindClass(&quot;java/lang/String&quot;)</code> æ—¶ï¼ŒUnidbg çš„ JNI æ¨¡å—ä¼šæ¥ç®¡è¿™ä¸ªè°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªä»£è¡¨ <code>java.lang.String</code> ç±»çš„è™šæ‹Ÿå¯¹è±¡ï¼ˆä¸€ä¸ª Java <code>DvmClass</code> å®ä¾‹ï¼‰ã€‚</p>
</li>
<li><p>å½“ <code>.so</code> è°ƒç”¨ <code>CallObjectMethod</code> æ—¶ï¼ŒUnidbg ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œå®é™…åœ°åœ¨ PC ç«¯çš„ JVM ä¸­æ‰§è¡Œå¯¹åº” Java å¯¹è±¡çš„ç›¸åº”æ–¹æ³•ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ <code>.so</code>ã€‚</p>
</li>
</ul>
<h2>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒUnidbg å·§å¦™åœ°å°† <code>.so</code> å¯¹ Android è™šæ‹Ÿæœºçš„è°ƒç”¨â€œå«æ¥â€åˆ°äº† PC ç«¯çš„ JVM ä¸Šã€‚</h2>
<h3>å·¥ä½œæµç¨‹ï¼š<code>unidbg</code> æ˜¯å¦‚ä½•è¿è¡Œä¸€ä¸ª <code>.so</code> çš„ï¼Ÿ</h3>
<ol>
<li><strong>åˆ›å»ºæ¨¡æ‹Ÿå™¨å®ä¾‹</strong>: <code>AndroidARMEmulator emulator = new AndroidARMEmulator(&quot;com.example.app&quot;);</code></li>
<li><strong>å†…å­˜åˆå§‹åŒ–</strong>: <code>Memory memory = emulator.getMemory();</code> Unidbg åˆå§‹åŒ–å†…å­˜ç®¡ç†å™¨å’Œ Unicorn å¼•æ“ã€‚</li>
<li><strong>åŠ è½½åŠ¨æ€åº“</strong>: <code>Module module = emulator.loadLibrary(new File(&quot;libnative-lib.so&quot;));</code>
a. Unidbg çš„ <code>linker</code> è§£æ <code>libnative-lib.so</code> çš„ ELF ç»“æ„ã€‚
b. æ ¹æ® <code>PT_LOAD</code> æ®µï¼Œå°† <code>.so</code> çš„å†…å®¹æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ã€‚
c. è§£æå…¶ä¾èµ–åº“ï¼ˆå¦‚ <code>libc.so</code>ï¼‰ï¼Œé€’å½’åŠ è½½å®ƒä»¬ã€‚
d. è¿›è¡Œç¬¦å·é‡å®šä½ï¼Œä¿®å¤å‡½æ•°è°ƒç”¨åœ°å€ã€‚</li>
<li><strong>è°ƒç”¨ JNI å‡½æ•°</strong>: <code>module.callJNI_OnLoad(emulator);</code> æˆ– <code>DvmObject&lt;?&gt; obj = module.callJniMethod(...);</code>
a. Unidbg æ‰¾åˆ°ç›®æ ‡ JNI å‡½æ•°åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„åœ°å€ã€‚
b. è®¾ç½®å‡½æ•°å‚æ•°ï¼Œä¸»è¦æ˜¯å°† <code>JNIEnv</code> å’Œ <code>jobject</code> ç­‰ JNI å¯¹è±¡ä½œä¸ºæŒ‡é’ˆï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ä¼ å…¥ã€‚
c. å¯åŠ¨ Unicorn å¼•æ“ï¼Œä»ç›®æ ‡å‡½æ•°åœ°å€å¼€å§‹æ‰§è¡Œ ARM æ±‡ç¼–æŒ‡ä»¤ã€‚</li>
<li><strong>æ‰§è¡Œä¸äº¤äº’</strong>:</li>
</ol>
<ul>
<li><p>æ±‡ç¼–æŒ‡ä»¤ç”± Unicorn è§£é‡Šæ‰§è¡Œã€‚</p>
</li>
<li><p>é‡åˆ°ç³»ç»Ÿè°ƒç”¨ï¼ŒUnicorn ä¸­æ–­ï¼Œç”± Unidbg çš„ <code>SyscallHandler</code> å¤„ç†ã€‚</p>
</li>
<li><p>é‡åˆ°è°ƒç”¨ JNI å‡½æ•°ï¼Œç”± Unidbg çš„ JNI æ¨¡æ‹Ÿå±‚å¤„ç†ï¼Œå¯èƒ½ä¼šåœ¨ PC çš„ JVM ä¸Šæ‰§è¡ŒçœŸå®çš„ Java ä»£ç ã€‚</p>
</li>
</ul>
<ol start="6">
<li><strong>è¿”å›ç»“æœ</strong>: å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œä»æ¨¡æ‹Ÿçš„å¯„å­˜å™¨ï¼ˆå¦‚ <code>r0</code>ï¼‰æˆ–æ ˆä¸Šè·å–è¿”å›å€¼ï¼Œå¹¶è½¬æ¢ä¸º Java å¯¹è±¡ã€‚</li>
</ol>
<hr />
<h3>Unidbg çš„ä¼˜åŠ¿ä¸å±€é™</h3>
<ul>
<li><p><strong>ä¼˜åŠ¿</strong>:</p>
</li>
<li><p><strong>æ‘†è„±ç¯å¢ƒé™åˆ¶</strong>: æ— éœ€çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ï¼Œæ—  root æƒé™è¦æ±‚ã€‚</p>
</li>
<li><p><strong>é«˜å¯æ§æ€§</strong>: å¯ä»¥å®Œå…¨æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä»»æ„ä¿®æ”¹å†…å­˜ã€å¯„å­˜å™¨ã€‚</p>
</li>
<li><p><strong>è‡ªåŠ¨åŒ–ä¸é›†æˆ</strong>: æ˜“äºä¸ Java/Python é¡¹ç›®é›†æˆï¼Œè¿›è¡Œå¤§è§„æ¨¡çš„è‡ªåŠ¨åŒ–æµ‹è¯•å’Œåˆ†æã€‚</p>
</li>
<li><p><strong>ååè°ƒè¯•</strong>: ç”±äºæ²¡æœ‰å®é™…çš„è°ƒè¯•å™¨è¿›ç¨‹ (<code>ptrace</code>)ï¼Œå¯ä»¥ç»•è¿‡å¤§å¤šæ•°åŸºäº <code>ptrace</code> çš„åè°ƒè¯•æ£€æµ‹ã€‚</p>
</li>
<li><p><strong>å±€é™</strong>:</p>
</li>
<li><p><strong>ç¯å¢ƒä¸å®Œæ•´</strong>: å¹¶é 100% å®Œæ•´çš„ Android ç¯å¢ƒã€‚å¯¹äºå¼ºä¾èµ–ç‰¹å®šç³»ç»Ÿè¡Œä¸ºã€ç¡¬ä»¶ç‰¹æ€§æˆ–å¤§é‡ UI æ“ä½œçš„ <code>.so</code> æ–‡ä»¶ï¼Œæ¨¡æ‹Ÿå¯èƒ½ä¼šå¤±è´¥ã€‚</p>
</li>
<li><p><strong>æ€§èƒ½å¼€é”€</strong>: æ¯•ç«Ÿæ˜¯é€æ¡æŒ‡ä»¤æ¨¡æ‹Ÿï¼Œæ€§èƒ½è¿œä½äºåŸç”Ÿæ‰§è¡Œã€‚</p>
</li>
<li><p><strong>ç³»ç»Ÿè°ƒç”¨å’Œ JNI è¦†ç›–</strong>: å¦‚æœ <code>.so</code> ç”¨åˆ°äº† Unidbg å°šæœªå®ç°çš„ç³»ç»Ÿè°ƒç”¨æˆ– JNI å‡½æ•°ï¼Œæ‰§è¡Œä¼šä¸­æ–­ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥å……å®ç°ã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-46">
                                                <h2>46. Ghidra Guide</h2>
                                                <h1>Ghidra å…¥é—¨</h1>
<h2>Ghidra æ˜¯ç”±ç¾å›½å›½å®¶å®‰å…¨å±€ (NSA) å¼€å‘å¹¶å¼€æºçš„ä¸€æ¬¾è½¯ä»¶é€†å‘å·¥ç¨‹ (SRE) å¥—ä»¶ã€‚å®ƒä»¥åŠŸèƒ½å…¨é¢ã€å…è´¹å¼€æºã€è·¨å¹³å°ç­‰ç‰¹æ€§ï¼Œè¿…é€Ÿæˆä¸º IDA Pro ä¹‹å¤–é€†å‘å·¥ç¨‹å¸ˆä»¬çš„å¦ä¸€ä¸ªé‡è¦é€‰æ‹©ï¼Œå°¤å…¶åœ¨å­¦æœ¯ç•Œå’Œç‹¬ç«‹ç ”ç©¶è€…ä¸­å¹¿å—æ¬¢è¿ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><strong>æ ¸å¿ƒç‰¹æ€§</strong></a></li>
<li><a href="#ghidra-vs-ida-pro-vs-radare2"><strong>Ghidra vs. IDA Pro vs. Radare2</strong></a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><strong>å®‰è£…ä¸é…ç½®</strong></a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><strong>åŸºæœ¬å·¥ä½œæµç¨‹</strong></a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E7%AA%97%E5%8F%A3%E4%B8%8E%E6%A6%82%E5%BF%B5"><strong>å…³é”®çª—å£ä¸æ¦‚å¿µ</strong></a></li>
</ol>
<ul>
<li><p><a href="#code-browser-%E4%BB%A3%E7%A0%81%E6%B5%8F%E8%A7%88%E5%99%A8">Code Browser (ä»£ç æµè§ˆå™¨)</a></p>
</li>
<li><p><a href="#decompiler-%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8">Decompiler (åç¼–è¯‘å™¨)</a></p>
</li>
<li><p><a href="#symbol-tree-%E7%AC%A6%E5%8F%B7%E6%A0%91">Symbol Tree (ç¬¦å·æ ‘)</a></p>
</li>
<li><p><a href="#data-type-manager-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%AE%A1%E7%90%86%E5%99%A8">Data Type Manager (æ•°æ®ç±»å‹ç®¡ç†å™¨)</a></p>
</li>
<li><p><a href="#code-browser-%E4%BB%A3%E7%A0%81%E6%B5%8F%E8%A7%88%E5%99%A8">Code Browser (ä»£ç æµè§ˆå™¨)</a></p>
</li>
<li><p><a href="#decompiler-%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8">Decompiler (åç¼–è¯‘å™¨)</a></p>
</li>
<li><p><a href="#symbol-tree-%E7%AC%A6%E5%8F%B7%E6%A0%91">Symbol Tree (ç¬¦å·æ ‘)</a></p>
</li>
<li><p><a href="#data-type-manager-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%AE%A1%E7%90%86%E5%99%A8">Data Type Manager (æ•°æ®ç±»å‹ç®¡ç†å™¨)</a></p>
</li>
</ul>
<ol start="6">
<li><a href="#%E8%84%9A%E6%9C%AC%E5%8C%96%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96"><strong>è„šæœ¬åŒ–ä¸è‡ªåŠ¨åŒ–</strong></a></li>
<li><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90"><strong>ä¼˜ç¼ºç‚¹åˆ†æ</strong></a></li>
</ol>
<hr />
<h2># æ ¸å¿ƒç‰¹æ€§</h2>
<ul>
<li><p><strong>å¼ºå¤§çš„åç¼–è¯‘å™¨ (Decompiler)</strong>: è¿™æ˜¯ Ghidra çš„ç‹ç‰ŒåŠŸèƒ½ã€‚å®ƒå†…ç½®äº†ä¸€ä¸ªé«˜è´¨é‡çš„ã€æ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„çš„å…è´¹åç¼–è¯‘å™¨ï¼Œèƒ½å¤Ÿå°†æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºç±»ä¼¼ C/C++ çš„é«˜çº§è¯­è¨€ä¼ªä»£ç ï¼Œæå¤§åœ°æé«˜äº†ä»£ç ç†è§£æ•ˆç‡ã€‚</p>
</li>
<li><p><strong>å…¨é¢çš„åˆ†æèƒ½åŠ›</strong>: æ”¯æŒå¯¹å¤šç§å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œåæ±‡ç¼–ã€åˆ†æã€åç¼–è¯‘ã€å›¾è¡¨ç»˜åˆ¶å’Œè„šæœ¬åŒ–ï¼ŒåŒ…æ‹¬ Windows, macOS, Linux, Android, iOS ç­‰ã€‚</p>
</li>
<li><p><strong>å¼ºå¤§çš„è„šæœ¬å¼•æ“</strong>: å†…ç½®å¯¹ Java å’Œ Python (é€šè¿‡ Jython) çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·ç¼–å†™å¤æ‚çš„è„šæœ¬æ¥è‡ªåŠ¨åŒ–åˆ†æä»»åŠ¡ï¼Œä»ç®€å•çš„é‡å‘½ååˆ°å¤æ‚çš„æ¼æ´æ¨¡å¼åŒ¹é…ã€‚</p>
</li>
<li><p><strong>äº¤äº’å¼ä¸è‡ªåŠ¨åŒ–æ“ä½œ</strong>: æ—¢æ”¯æŒåƒ IDA Pro é‚£æ ·çš„äº¤äº’å¼æ‰‹åŠ¨åˆ†æï¼Œä¹Ÿæä¾›äº†å¼ºå¤§çš„&quot;æ— å¤´åˆ†æå™¨&quot;(Headless Analyzer)ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæ‰¹é‡ã€è‡ªåŠ¨åŒ–çš„åˆ†æã€‚</p>
</li>
<li><p><strong>å¤šç”¨æˆ·åä½œ</strong>: Ghidra Server ç»„ä»¶æ”¯æŒå¤šååˆ†æå¸ˆå¯¹åŒä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡ŒååŒé€†å‘ï¼Œå¹¶èƒ½æ–¹ä¾¿åœ°è¿›è¡Œç‰ˆæœ¬è¿½è¸ªå’Œåˆå¹¶ã€‚</p>
</li>
<li><p><strong>å¯æ‰©å±•æ€§</strong>: ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å’Œæ‰©å±• Ghidra çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¼–å†™æ–°çš„å¤„ç†å™¨æ¨¡å—ã€åŠ è½½å™¨å’Œåˆ†æå™¨æ’ä»¶ã€‚</p>
</li>
</ul>
<hr />
<h2># Ghidra vs. IDA Pro vs. Radare2</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">Ghidra</th>
  <th style="text-align:left">IDA Pro</th>
  <th style="text-align:left">Radare2</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>ä»·æ ¼</strong></td>
  <td style="text-align:left"><strong>å®Œå…¨å…è´¹</strong></td>
  <td style="text-align:left">éå¸¸æ˜‚è´µ</td>
  <td style="text-align:left">å®Œå…¨å…è´¹</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¼€æº</strong></td>
  <td style="text-align:left"><strong>æ˜¯</strong> (Java)</td>
  <td style="text-align:left">å¦</td>
  <td style="text-align:left">æ˜¯ (C)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td>
  <td style="text-align:left"><strong>é«˜è´¨é‡çš„å…è´¹åç¼–è¯‘å™¨</strong></td>
  <td style="text-align:left"><strong>æœ€å¼ºçš„äº¤äº’å¼åæ±‡ç¼–</strong></td>
  <td style="text-align:left"><strong>æè‡´çš„è„šæœ¬åŒ–å’Œå‘½ä»¤è¡Œ</strong></td>
</tr>
<tr>
  <td style="text-align:left"><strong>UI</strong></td>
  <td style="text-align:left">Java Swingï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ç•¥æ˜¾ç¬¨é‡</td>
  <td style="text-align:left">Qtï¼Œä¸šç•Œæ ‡å‡†ï¼Œæˆç†Ÿç¨³å®š</td>
  <td style="text-align:left">å‘½ä»¤è¡Œï¼Œæˆ–é€šè¿‡ Cutter æä¾› GUI</td>
</tr>
<tr>
  <td style="text-align:left"><strong>è‡ªåŠ¨åŒ–</strong></td>
  <td style="text-align:left">å¼ºå¤§çš„ Headless æ¨¡å¼å’Œè„šæœ¬</td>
  <td style="text-align:left">ä¸»è¦é€šè¿‡ IDC/IDAPython è„šæœ¬</td>
  <td style="text-align:left">è®¾è®¡å“²å­¦æ ¸å¿ƒï¼Œè‡ªåŠ¨åŒ–èƒ½åŠ›æå¼º</td>
</tr>
<tr>
  <td style="text-align:left"><strong>åä½œ</strong></td>
  <td style="text-align:left">å†…ç½® Ghidra Server æ”¯æŒ</td>
  <td style="text-align:left">ç¬¬ä¸‰æ–¹æ’ä»¶ (å¦‚ BinSync)</td>
  <td style="text-align:left">è„šæœ¬åŒ–åä½œï¼Œæˆ–é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å­¦ä¹ æ›²çº¿</strong></td>
  <td style="text-align:left">ä¸­ç­‰ï¼ŒUI ç›´è§‚</td>
  <td style="text-align:left">ä¸­ç­‰ï¼ŒåŠŸèƒ½ç¹å¤š</td>
  <td style="text-align:left"><strong>éå¸¸é™¡å³­</strong>ï¼Œå‘½ä»¤ç¹æ‚</td>
</tr>
</tbody>
</table>
<hr />
<h2># å®‰è£…ä¸é…ç½®</h2>
<ol>
<li><strong>å‰æ</strong>: ç¡®ä¿å·²å®‰è£… Java Development Kit (JDK) 11 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
<li><strong>ä¸‹è½½</strong>: ä» <a href="https://ghidra-sre.org/">Ghidra å®˜æ–¹ç½‘ç«™</a> ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆ ZIP åŒ…ã€‚</li>
<li><strong>è§£å‹</strong>: å°† ZIP åŒ…è§£å‹åˆ°ä»»æ„ç›®å½•ã€‚</li>
<li><strong>è¿è¡Œ</strong>:</li>
</ol>
<ul>
<li><p><strong>Windows</strong>: åŒå‡»è¿è¡Œ <code>ghidraRun.bat</code>ã€‚</p>
</li>
<li><p><strong>Linux / macOS</strong>: åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>sh ghidraRun</code>ã€‚</p>
</li>
<li><p><strong>Windows</strong>: åŒå‡»è¿è¡Œ <code>ghidraRun.bat</code>ã€‚</p>
</li>
<li><p><strong>Linux / macOS</strong>: åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>sh ghidraRun</code>ã€‚</p>
</li>
</ul>
<ol start="5">
<li><strong>(å¯é€‰) Ghidra Dark Theme</strong>: Ghidra çš„é»˜è®¤ä¸»é¢˜æ¯”è¾ƒåˆºçœ¼ï¼Œå¯ä»¥é€šè¿‡å®‰è£… <code>Ghidra-dark-theme</code> æ’ä»¶æ¥è·å¾—æ›´å¥½çš„è§†è§‰ä½“éªŒã€‚</li>
</ol>
<hr />
<h2># åŸºæœ¬å·¥ä½œæµç¨‹</h2>
<ol>
<li><strong>åˆ›å»ºé¡¹ç›®</strong>:</li>
</ol>
<ul>
<li><p><code>File -&gt; New Project...</code></p>
</li>
<li><p>é€‰æ‹© <code>Non-Shared Project</code> (å•ç”¨æˆ·é¡¹ç›®)ã€‚</p>
</li>
<li><p>æŒ‡å®šé¡¹ç›®è·¯å¾„å’Œåç§°ã€‚</p>
</li>
<li><p><code>File -&gt; New Project...</code></p>
</li>
<li><p>é€‰æ‹© <code>Non-Shared Project</code> (å•ç”¨æˆ·é¡¹ç›®)ã€‚</p>
</li>
<li><p>æŒ‡å®šé¡¹ç›®è·¯å¾„å’Œåç§°ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>å¯¼å…¥æ–‡ä»¶</strong>:</li>
</ol>
<ul>
<li><p><code>File -&gt; Import File...</code></p>
</li>
<li><p>é€‰æ‹©ä½ æƒ³è¦åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ (å¦‚ <code>.exe</code>, <code>.dll</code>, <code>.so</code>, <code>.apk</code>)ã€‚</p>
</li>
<li><p>Ghidra ä¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶æ ¼å¼ã€å¤„ç†å™¨æ¶æ„ç­‰ï¼Œç›´æ¥ç‚¹å‡» <code>OK</code>ã€‚</p>
</li>
<li><p><code>File -&gt; Import File...</code></p>
</li>
<li><p>é€‰æ‹©ä½ æƒ³è¦åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ (å¦‚ <code>.exe</code>, <code>.dll</code>, <code>.so</code>, <code>.apk</code>)ã€‚</p>
</li>
<li><p>Ghidra ä¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶æ ¼å¼ã€å¤„ç†å™¨æ¶æ„ç­‰ï¼Œç›´æ¥ç‚¹å‡» <code>OK</code>ã€‚</p>
</li>
</ul>
<ol start="3">
<li><strong>åˆ†ææ–‡ä»¶</strong>:</li>
</ol>
<ul>
<li><p>åœ¨å¼¹å‡ºçš„åˆ†æé€‰é¡¹æ¡†ä¸­ï¼Œä¿ç•™é»˜è®¤å‹¾é€‰çš„åˆ†æå™¨å³å¯ï¼Œç‚¹å‡» <code>Analyze</code>ã€‚</p>
</li>
<li><p>Ghidra ä¼šå¼€å§‹å¯¹æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨åˆ†æï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå–å†³äºæ–‡ä»¶å¤§å°å’Œå¤æ‚åº¦ã€‚</p>
</li>
<li><p>åœ¨å¼¹å‡ºçš„åˆ†æé€‰é¡¹æ¡†ä¸­ï¼Œä¿ç•™é»˜è®¤å‹¾é€‰çš„åˆ†æå™¨å³å¯ï¼Œç‚¹å‡» <code>Analyze</code>ã€‚</p>
</li>
<li><p>Ghidra ä¼šå¼€å§‹å¯¹æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨åˆ†æï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå–å†³äºæ–‡ä»¶å¤§å°å’Œå¤æ‚åº¦ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>å¼€å§‹æ¢ç´¢</strong>:</li>
</ol>
<ul>
<li><p>åˆ†æå®Œæˆåï¼ŒåŒå‡»é¡¹ç›®çª—å£ä¸­çš„æ–‡ä»¶åï¼Œæ‰“å¼€ Ghidra çš„æ ¸å¿ƒå·¥å…· <strong>Code Browser</strong>ã€‚</p>
</li>
<li><p>ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½ çš„é€†å‘ä¹‹æ—…äº†ï¼</p>
</li>
<li><p>åˆ†æå®Œæˆåï¼ŒåŒå‡»é¡¹ç›®çª—å£ä¸­çš„æ–‡ä»¶åï¼Œæ‰“å¼€ Ghidra çš„æ ¸å¿ƒå·¥å…· <strong>Code Browser</strong>ã€‚</p>
</li>
<li><p>ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½ çš„é€†å‘ä¹‹æ—…äº†ï¼</p>
</li>
</ul>
<hr />
<h2># å…³é”®çª—å£ä¸æ¦‚å¿µ</h2>
<h3># Code Browser (ä»£ç æµè§ˆå™¨)</h3>
<p>è¿™æ˜¯ Ghidra çš„ä¸»ç•Œé¢ï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒå­çª—å£ï¼š</p>
<ul>
<li><p><strong>Listing (æ¸…å•/åæ±‡ç¼–çª—å£)</strong>: å·¦ä¾§æ˜¾ç¤ºåæ±‡ç¼–ä»£ç ï¼Œæ˜¯åˆ†æçš„ä¸»è¦åŒºåŸŸã€‚</p>
</li>
<li><p><strong>Functions (å‡½æ•°çª—å£)</strong>: å·¦ä¸‹è§’ï¼Œåˆ—å‡ºæ‰€æœ‰å·²è¯†åˆ«çš„å‡½æ•°ã€‚ç‚¹å‡»å‡½æ•°åå¯ä»¥åœ¨åæ±‡ç¼–çª—å£ä¸­è·³è½¬ã€‚</p>
</li>
<li><p><strong>Program Trees (ç¨‹åºæ ‘)</strong>: å·¦ä¸Šè§’ï¼Œä»¥æ ‘çŠ¶ç»“æ„å±•ç¤ºç¨‹åºçš„æ®µ (sections)ã€‚</p>
</li>
</ul>
<h3># Decompiler (åç¼–è¯‘å™¨)</h3>
<ul>
<li><p>é€šå¸¸ä½äºåæ±‡ç¼–çª—å£çš„å³ä¾§ã€‚</p>
</li>
<li><p>å®ƒä¼šè‡ªåŠ¨æ˜¾ç¤ºå½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°çš„ C ä¼ªä»£ç ã€‚</p>
</li>
<li><p>è¿™æ˜¯ Ghidra æœ€æœ‰ä»·å€¼çš„çª—å£ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ä¼ªä»£ç ä¸­å¯¹å˜é‡ã€å‡½æ•°è¿›è¡Œé‡å‘½åã€ä¿®æ”¹ç±»å‹ï¼Œè¿™äº›æ”¹åŠ¨ä¼š<strong>åŒå‘åŒæ­¥</strong>åˆ°åæ±‡ç¼–çª—å£ã€‚</p>
</li>
</ul>
<h3># Symbol Tree (ç¬¦å·æ ‘)</h3>
<ul>
<li><p>ä½äºå·¦ä¾§ï¼Œ<code>Functions</code> çª—å£æ—è¾¹ã€‚</p>
</li>
<li><p>å®ƒä»¥æ ‘çŠ¶ç»“æ„åˆ—å‡ºäº†ç¨‹åºä¸­æ‰€æœ‰çš„ç¬¦å·ï¼ŒåŒ…æ‹¬å‡½æ•°ã€æ ‡ç­¾ã€å¯¼å…¥/å¯¼å‡ºå‡½æ•°ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨å¿«é€ŸæŸ¥æ‰¾ç‰¹å®šå‡½æ•°ã€‚</p>
</li>
</ul>
<h3># Data Type Manager (æ•°æ®ç±»å‹ç®¡ç†å™¨)</h3>
<ul>
<li><p>å·¦ä¸‹è§’ï¼Œ<code>Functions</code> çª—å£ä¸‹æ–¹ã€‚</p>
</li>
<li><p>è¿™é‡Œç®¡ç†ç€ç¨‹åºä¸­æ‰€æœ‰çš„æ•°æ®ç±»å‹ (struct, union, enum ç­‰)ã€‚ä½ å¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€å¯¼å…¥å’Œå¯¼å‡ºæ•°æ®ç±»å‹å®šä¹‰ã€‚è¿™å¯¹äºåˆ†æå¤æ‚çš„æ•°æ®ç»“æ„è‡³å…³é‡è¦ã€‚</p>
</li>
</ul>
<hr />
<h2># è„šæœ¬åŒ–ä¸è‡ªåŠ¨åŒ–</h2>
<p>Ghidra å¼ºå¤§çš„è„šæœ¬èƒ½åŠ›æ˜¯å…¶æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚</p>
<ol>
<li><strong>æ‰“å¼€ Script Manager</strong>: åœ¨ Code Browser ä¸­ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•æ çš„ç»¿è‰²æ’­æ”¾æŒ‰é’®å›¾æ ‡ï¼Œæ‰“å¼€ <strong>Script Manager</strong>ã€‚</li>
<li><strong>é€‰æ‹©ä¸è¿è¡Œè„šæœ¬</strong>: è¿™é‡Œæœ‰å¤§é‡ NSA å®˜æ–¹å’Œç¤¾åŒºè´¡çŒ®çš„é¢„ç½®è„šæœ¬ï¼Œè¦†ç›–äº†ä»æŸ¥æ‰¾å¯†ç ã€è§£å¯†æ•°æ®åˆ°è¯†åˆ«ç‰¹å®šä»£ç æ¨¡å¼ç­‰å„ç§ä»»åŠ¡ã€‚</li>
<li><strong>ç¼–å†™è‡ªå·±çš„è„šæœ¬</strong>:</li>
</ol>
<ul>
<li><p>ä½ å¯ä»¥é€šè¿‡ <code>Create New Script</code> æŒ‰é’®åˆ›å»ºæ–°çš„ Java æˆ– Python è„šæœ¬ã€‚</p>
</li>
<li><p>Ghidra æä¾›äº†ä¸°å¯Œçš„ API (ç§°ä¸º <code>FlatAPI</code>)ï¼Œè®©ä½ å¯ä»¥åœ¨è„šæœ¬ä¸­è®¿é—®å’Œä¿®æ”¹ç¨‹åºçš„å‡ ä¹æ‰€æœ‰ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-python">
</code></pre>
</li>
</ul>
<h1>A simple Python script example that prints all function names and addresses</h1>
<p>from ghidra.program.model.symbol import SymbolType</p>
<p>print(&quot;--- All Functions ---&quot;)
func_manager = currentProgram.getFunctionManager()
funcs = func_manager.getFunctions(True) # True means iterate in address order
for func in funcs:
print(&quot;{} at {}&quot;.format(func.getName(), func.getEntryPoint()))</p>
<pre><code>
## # ä¼˜ç¼ºç‚¹åˆ†æ

### ä¼˜ç‚¹

* **å…è´¹ä¸å¼€æº**: æ— ä»»ä½•è´¹ç”¨ï¼Œç¤¾åŒºå¯ä»¥å®¡æŸ¥å’Œè´¡çŒ®ä»£ç ã€‚


* **å¼ºå¤§çš„åç¼–è¯‘å™¨**: å†…ç½®çš„é«˜è´¨é‡åç¼–è¯‘å™¨æ˜¯å…¶æœ€å¤§çš„å–ç‚¹ï¼Œè¶³ä»¥åª²ç¾ç”šè‡³åœ¨æŸäº›æ–¹é¢è¶…è¶Šæ˜‚è´µçš„å•†ä¸šè½¯ä»¶ã€‚


* **è·¨å¹³å°**: åŸºäº Javaï¼Œå¯ä»¥åœ¨ Windows, macOS, Linux ä¸Šæ— å·®åˆ«è¿è¡Œã€‚


* **ä¼˜ç§€çš„åä½œåŠŸèƒ½**: Ghidra Server çš„å­˜åœ¨ä½¿å¾—å›¢é˜Ÿåä½œå˜å¾—éå¸¸å®¹æ˜“ã€‚


### ç¼ºç‚¹

* **æ€§èƒ½**: åŸºäº Java Swing çš„ UI åœ¨å¤„ç†è¶…å¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šæ„Ÿåˆ°å¡é¡¿ï¼Œæ€§èƒ½ä¸å¦‚ IDA Proã€‚


* **ç”Ÿæ€ç³»ç»Ÿ**: è™½ç„¶æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œä½†æ’ä»¶å’Œç¤¾åŒºæ”¯æŒçš„æˆç†Ÿåº¦ä»ç„¶ä¸åŠ IDA Pro ç»è¥å¤šå¹´çš„ç”Ÿæ€ã€‚


* **åŸç”Ÿè°ƒè¯•å™¨**: Ghidra çš„è°ƒè¯•å™¨åŠŸèƒ½ç›¸å¯¹è¾ƒå¼±ï¼Œä¸å¦‚ IDA Pro å’Œ x64dbg ç­‰ä¸“ç”¨è°ƒè¯•å™¨æˆç†Ÿã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-47">
                                                <h2>47. IDA Pro Guide</h2>
                                                <h1>IDA Pro å…¥é—¨</h1>
<h2>IDA Pro (Interactive Disassembler Professional) æ˜¯ç”± Hex-Rays å…¬å¸å¼€å‘çš„ä¸€æ¬¾ä¸šç•Œé—»åçš„äº¤äº’å¼åæ±‡ç¼–å™¨ã€‚åœ¨é€†å‘å·¥ç¨‹é¢†åŸŸï¼ŒIDA Pro è¢«å¹¿æ³›è®¤ä¸ºæ˜¯<strong>é»„é‡‘æ ‡å‡†</strong>ï¼Œä»¥å…¶æœ€å¼ºå¤§çš„åæ±‡ç¼–å¼•æ“ã€æ— ä¸ä¼¦æ¯”çš„å¤„ç†å™¨æ”¯æŒå’Œæå…¶æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿï¼Œæˆä¸ºä¸“ä¸šäººå£«è¿›è¡Œè½¯ä»¶åˆ†æã€æ¼æ´æŒ–æ˜å’Œæ¶æ„è½¯ä»¶ç ”ç©¶çš„é¦–é€‰å·¥å…·ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#ida-pro-%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97">IDA Pro å…¥é—¨</a><ul>
<li><a href="#ida-pro-interactive-disassembler-professional-%E6%98%AF%E7%94%B1-hex-rays-%E5%85%AC%E5%8F%B8%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%80%E6%AC%BE%E4%B8%9A%E7%95%8C%E9%97%BB%E5%90%8D%E7%9A%84%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%8F%8D%E6%B1%87%E7%BC%96%E5%99%A8%E5%9C%A8%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E9%A2%86%E5%9F%9Fida-pro-%E8%A2%AB%E5%B9%BF%E6%B3%9B%E8%AE%A4%E4%B8%BA%E6%98%AF%E9%BB%84%E9%87%91%E6%A0%87%E5%87%86%E4%BB%A5%E5%85%B6%E6%9C%80%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%97%A0%E4%B8%8E%E4%BC%A6%E6%AF%94%E7%9A%84%E5%A4%84%E7%90%86%E5%99%A8%E6%94%AF%E6%8C%81%E5%92%8C%E6%9E%81%E5%85%B6%E6%88%90%E7%86%9F%E7%9A%84%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%88%90%E4%B8%BA%E4%B8%93%E4%B8%9A%E4%BA%BA%E5%A3%AB%E8%BF%9B%E8%A1%8C%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E5%92%8C%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E7%A0%94%E7%A9%B6%E7%9A%84%E9%A6%96%E9%80%89%E5%B7%A5%E5%85%B7">IDA Pro (Interactive Disassembler Professional) æ˜¯ç”± Hex-Rays å…¬å¸å¼€å‘çš„ä¸€æ¬¾ä¸šç•Œé—»åçš„äº¤äº’å¼åæ±‡ç¼–å™¨ã€‚åœ¨é€†å‘å·¥ç¨‹é¢†åŸŸï¼ŒIDA Pro è¢«å¹¿æ³›è®¤ä¸ºæ˜¯<strong>é»„é‡‘æ ‡å‡†</strong>ï¼Œä»¥å…¶æœ€å¼ºå¤§çš„åæ±‡ç¼–å¼•æ“ã€æ— ä¸ä¼¦æ¯”çš„å¤„ç†å™¨æ”¯æŒå’Œæå…¶æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿï¼Œæˆä¸ºä¸“ä¸šäººå£«è¿›è¡Œè½¯ä»¶åˆ†æã€æ¼æ´æŒ–æ˜å’Œæ¶æ„è½¯ä»¶ç ”ç©¶çš„é¦–é€‰å·¥å…·ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7">æ ¸å¿ƒç‰¹æ€§</a></li>
<li><a href="#ida-pro-vs-ghidra-vs-radare2">IDA Pro vs. Ghidra vs. Radare2</a></li>
<li><a href="#%E7%89%88%E6%9C%AC%E4%B8%8E%E5%AE%89%E8%A3%85">ç‰ˆæœ¬ä¸å®‰è£…</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">åŸºæœ¬å·¥ä½œæµç¨‹</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E8%A7%86%E5%9B%BE%E4%B8%8E%E5%BF%AB%E6%8D%B7%E9%94%AE">å…³é”®è§†å›¾ä¸å¿«æ·é”®</a><ul>
<li><a href="#ida-view-%E5%8F%8D%E6%B1%87%E7%BC%96%E8%A7%86%E5%9B%BE">IDA View (åæ±‡ç¼–è§†å›¾)</a></li>
<li><a href="#hex-view-%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E8%A7%86%E5%9B%BE">Hex View (åå…­è¿›åˆ¶è§†å›¾)</a></li>
<li><a href="#structures-%E7%BB%93%E6%9E%84%E4%BD%93%E8%A7%86%E5%9B%BE">Structures (ç»“æ„ä½“è§†å›¾)</a></li>
<li><a href="#enums-%E6%9E%9A%E4%B8%BE%E8%A7%86%E5%9B%BE">Enums (æšä¸¾è§†å›¾)</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%BF%AB%E6%8D%B7%E9%94%AE">æ ¸å¿ƒå¿«æ·é”®</a></li>
</ul>
</li>
<li><a href="#%E8%84%9A%E6%9C%AC%E4%B8%8E%E6%8F%92%E4%BB%B6">è„šæœ¬ä¸æ’ä»¶</a></li>
<li><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90">ä¼˜ç¼ºç‚¹åˆ†æ</a><ul>
<li><a href="#%E4%BC%98%E7%82%B9">ä¼˜ç‚¹</a></li>
<li><a href="#%E7%BC%BA%E7%82%B9">ç¼ºç‚¹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li><p><strong>é¡¶çº§çš„åæ±‡ç¼–å¼•æ“</strong>: IDA Pro çš„æ ¸å¿ƒç«äº‰åŠ›åœ¨äºå…¶æ— ä¸ä¼¦æ¯”çš„é™æ€åæ±‡ç¼–èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿæ™ºèƒ½åœ°ã€é€’å½’åœ°éå†ä»£ç ï¼ŒåŒºåˆ†ä»£ç ä¸æ•°æ®ï¼Œè¯†åˆ«å‡½æ•°è¾¹ç•Œï¼Œå…¶åˆ†æç»“æœçš„å‡†ç¡®æ€§æ˜¯ä¸šç•Œå…¬è®¤çš„æœ€é«˜æ°´å‡†ã€‚</p>
</li>
<li><p><strong>FLIRT æŠ€æœ¯</strong>: <strong>F</strong>ast <strong>L</strong>ibrary <strong>I</strong>dentification and <strong>R</strong>ecognition <strong>T</strong>echnologyã€‚è¿™æ˜¯ IDA çš„æ ‡å¿—æ€§æŠ€æœ¯ï¼Œé€šè¿‡å¯¹æ ‡å‡†ç¼–è¯‘å™¨åº“å‡½æ•°çš„ç­¾åè¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶å‘½åå¤§é‡çš„åº“å‡½æ•°ï¼Œæå¤§åœ°å‡å°‘äº†é€†å‘å·¥ç¨‹å¸ˆçš„é‡å¤å·¥ä½œã€‚</p>
</li>
<li><p><strong>å¼ºå¤§çš„äº¤äº’æ€§</strong>: IDA çš„è®¾è®¡å“²å­¦é¼“åŠ±ç”¨æˆ·ä¸åæ±‡ç¼–ç»“æœè¿›è¡Œäº¤äº’ã€‚ç”¨æˆ·å¯ä»¥éšæ—¶é‡å‘½åå˜é‡ã€ä¿®æ”¹ç±»å‹ã€æ·»åŠ æ³¨é‡Šã€è½¬æ¢æ•°æ®æ ¼å¼ï¼Œè¿™äº›äº¤äº’æ“ä½œä¼šå®æ—¶åœ°å½±å“æ•´ä¸ªåˆ†ææ•°æ®åº“ã€‚</p>
</li>
<li><p><strong>Hex-Rays åç¼–è¯‘å™¨ (ä»˜è´¹æ’ä»¶)</strong>: IDA Pro çš„æ€æ‰‹çº§åº”ç”¨æ˜¯å…¶é…å¥—çš„ Hex-Rays åç¼–è¯‘å™¨ã€‚è™½ç„¶éœ€è¦é¢å¤–ä»˜è´¹ï¼Œä½†å®ƒè¢«å…¬è®¤ä¸ºç›®å‰å¸‚é¢ä¸Šæœ€å¼ºå¤§çš„ C/C++ åç¼–è¯‘å™¨ï¼Œç”Ÿæˆçš„ä¼ªä»£ç è´¨é‡æé«˜ï¼Œå¯è¯»æ€§æå¼ºã€‚</p>
</li>
<li><p><strong>å¤šå¹³å°è°ƒè¯•å™¨</strong>: å†…ç½®äº†å¼ºå¤§çš„è·¨å¹³å°è°ƒè¯•å™¨ï¼Œæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹è°ƒè¯•ï¼Œå…è®¸åŠ¨æ€åˆ†æå’Œä¿®æ”¹ç¨‹åºè¡Œä¸ºã€‚</p>
</li>
<li><p><strong>æå…¶ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€</strong>: ç»è¿‡æ•°åå¹´çš„å‘å±•ï¼ŒIDA Pro ç§¯ç´¯äº†æµ·é‡çš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œè¦†ç›–äº†ä»æ¼æ´æ‰«æã€ä»£ç ç€è‰²ã€æ•°æ®è§£å¯†åˆ°ä¸å…¶ä»–å·¥å…·è”åŠ¨çš„æ–¹æ–¹é¢é¢ï¼Œæå¤§åœ°æ‰©å±•äº†å…¶åŠŸèƒ½è¾¹ç•Œã€‚</p>
</li>
</ul>
<hr />
<h3>IDA Pro vs. Ghidra vs. Radare2</h3>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">IDA Pro</th>
  <th style="text-align:left">Ghidra</th>
  <th style="text-align:left">Radare2</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>ä»·æ ¼</strong></td>
  <td style="text-align:left"><strong>éå¸¸æ˜‚è´µ</strong></td>
  <td style="text-align:left">å®Œå…¨å…è´¹</td>
  <td style="text-align:left">å®Œå…¨å…è´¹</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¼€æº</strong></td>
  <td style="text-align:left"><strong>å¦</strong></td>
  <td style="text-align:left">æ˜¯ (Java)</td>
  <td style="text-align:left">æ˜¯ (C)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td>
  <td style="text-align:left"><strong>æœ€å¼ºçš„äº¤äº’å¼åæ±‡ç¼–</strong></td>
  <td style="text-align:left">é«˜è´¨é‡çš„å…è´¹åç¼–è¯‘å™¨</td>
  <td style="text-align:left">æè‡´çš„è„šæœ¬åŒ–å’Œå‘½ä»¤è¡Œ</td>
</tr>
<tr>
  <td style="text-align:left"><strong>UI</strong></td>
  <td style="text-align:left"><strong>Qtï¼Œä¸šç•Œæ ‡å‡†ï¼Œæˆç†Ÿç¨³å®š</strong></td>
  <td style="text-align:left">Java Swingï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ç•¥æ˜¾ç¬¨é‡</td>
  <td style="text-align:left">å‘½ä»¤è¡Œï¼Œæˆ–é€šè¿‡ Cutter æä¾› GUI</td>
</tr>
<tr>
  <td style="text-align:left"><strong>åç¼–è¯‘å™¨</strong></td>
  <td style="text-align:left"><strong>Hex-Rays (ä¸šç•Œé¡¶å°–ï¼Œéœ€ä»˜è´¹)</strong></td>
  <td style="text-align:left">å†…ç½®å…è´¹ï¼Œè´¨é‡éå¸¸é«˜</td>
  <td style="text-align:left">å†…ç½®å…è´¹ (ghidra-dec)ï¼Œæˆ–æ”¯æŒå…¶ä»–</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ç”Ÿæ€ç³»ç»Ÿ</strong></td>
  <td style="text-align:left"><strong>æå…¶æˆç†Ÿï¼Œæ’ä»¶æµ·é‡</strong></td>
  <td style="text-align:left">å¿«é€Ÿå‘å±•ä¸­</td>
  <td style="text-align:left">é«˜åº¦å¯å®šåˆ¶ï¼Œä½†æ’ä»¶è¾ƒå°‘</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¤„ç†å™¨æ”¯æŒ</strong></td>
  <td style="text-align:left"><strong>æœ€å¹¿æ³›</strong></td>
  <td style="text-align:left">å¹¿æ³›ï¼Œä½†ç•¥å°‘äº IDA</td>
  <td style="text-align:left">æå¹¿ï¼Œè¦†ç›–å¾ˆå¤šå°ä¼—æ¶æ„</td>
</tr>
</tbody>
</table>
<hr />
<h3>ç‰ˆæœ¬ä¸å®‰è£…</h3>
<ul>
<li><p><strong>ç‰ˆæœ¬</strong>: IDA Pro æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ”¯æŒçš„å¤„ç†å™¨æ¶æ„å’Œæ˜¯å¦åŒ…å«åç¼–è¯‘å™¨ã€‚<code>IDA Pro</code> ç‰ˆæœ¬é€šå¸¸åŒ…å«æ‰€æœ‰å¤„ç†å™¨æ¨¡å—å’Œè°ƒè¯•å™¨ï¼Œè€Œ <code>IDA Home</code> æ˜¯é’ˆå¯¹ä¸ªäººçˆ±å¥½è€…çš„å»‰ä»·ç‰ˆï¼ŒåŠŸèƒ½å—é™ã€‚</p>
</li>
<li><p><strong>è´­ä¹°ä¸å®‰è£…</strong>: éœ€è¦é€šè¿‡å®˜æ–¹æˆ–æˆæƒç»é”€å•†è´­ä¹°ã€‚å®‰è£…è¿‡ç¨‹æ˜¯æ ‡å‡†çš„ä¸‹ä¸€æ­¥å¼å®‰è£…ã€‚</p>
</li>
<li><p><strong>å…è´¹ç‰ˆ</strong>: Hex-Rays æä¾›ä¸€ä¸ªå…è´¹ç‰ˆæœ¬çš„ IDAï¼Œä½†åŠŸèƒ½ä¸¥é‡å—é™ï¼Œä»…æ”¯æŒ x86/x64ï¼Œä¸”ä¸èƒ½ä¿å­˜æ•°æ®åº“ï¼Œä»…é€‚åˆéå¸¸åˆçº§çš„å­¦ä¹ ã€‚</p>
</li>
</ul>
<hr />
<h3>åŸºæœ¬å·¥ä½œæµç¨‹</h3>
<ol>
<li><strong>å¯åŠ¨ IDA</strong>: æ‰“å¼€ IDA Proã€‚</li>
<li><strong>åŠ è½½æ–‡ä»¶</strong>: åœ¨å¯åŠ¨ç•Œé¢ç‚¹å‡» <code>New</code>ï¼Œæˆ–å°†äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥æ‹–å…¥ä¸»çª—å£ã€‚</li>
<li><strong>åŠ è½½é€‰é¡¹</strong>: IDA ä¼šå¼¹å‡ºä¸€ä¸ªåŠ è½½å¯¹è¯æ¡†ï¼Œè®©ä½ ç¡®è®¤æ–‡ä»¶ç±»å‹ã€å¤„ç†å™¨ç±»å‹ç­‰ã€‚é€šå¸¸ï¼ŒIDA çš„è‡ªåŠ¨åˆ†æéå¸¸å‡†ç¡®ï¼Œç›´æ¥ç‚¹å‡» <code>OK</code> å³å¯ã€‚</li>
<li><strong>è‡ªåŠ¨åˆ†æ</strong>: IDA ä¼šè¿›è¡Œé•¿æ—¶é—´çš„è‡ªåŠ¨åˆ†æã€‚åˆ†æè¿‡ç¨‹å¯ä»¥åœ¨åº•éƒ¨çš„è¾“å‡ºçª—å£çœ‹åˆ°ã€‚<strong>è€å¿ƒç­‰å¾…åˆ†æå®Œæˆ</strong>æ˜¯ä½¿ç”¨ IDA çš„å¥½ä¹ æƒ¯ï¼Œå¦åˆ™å¾ˆå¤šåŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚</li>
<li><strong>å¼€å§‹åˆ†æ</strong>: åˆ†æå®Œæˆåï¼Œå³å¯å¼€å§‹äº¤äº’å¼åˆ†æã€‚</li>
</ol>
<hr />
<h3>å…³é”®è§†å›¾ä¸å¿«æ·é”®</h3>
<h4>IDA View (åæ±‡ç¼–è§†å›¾)</h4>
<ul>
<li><p>è¿™æ˜¯ IDA çš„ä¸»è§†å›¾ã€‚æŒ‰<strong>ç©ºæ ¼é”®</strong>å¯ä»¥åœ¨<strong>å›¾å½¢è§†å›¾</strong>ï¼ˆæµç¨‹å›¾ï¼‰å’Œ<strong>æ–‡æœ¬è§†å›¾</strong>ï¼ˆçº¿æ€§åæ±‡ç¼–ï¼‰ä¹‹é—´åˆ‡æ¢ã€‚</p>
</li>
<li><p><strong>å›¾å½¢è§†å›¾</strong>éå¸¸é€‚åˆç†è§£å‡½æ•°å†…çš„é€»è¾‘åˆ†æ”¯å’Œå¾ªç¯ã€‚</p>
</li>
</ul>
<h4>Hex View (åå…­è¿›åˆ¶è§†å›¾)</h4>
<ul>
<li>ä»¥ç»å…¸çš„åå…­è¿›åˆ¶ç¼–è¾‘å™¨å½¢å¼å±•ç¤ºæ–‡ä»¶å†…å®¹ï¼Œä¸åæ±‡ç¼–è§†å›¾åŒæ­¥é«˜äº®ã€‚</li>
</ul>
<h4>Structures (ç»“æ„ä½“è§†å›¾)</h4>
<ul>
<li><p>å¿«æ·é”® <code>Shift+F9</code>ã€‚</p>
</li>
<li><p>ç”¨äºå®šä¹‰å’Œç®¡ç† C è¯­è¨€é£æ ¼çš„ç»“æ„ä½“ã€‚ä½ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä» C å¤´æ–‡ä»¶å¯¼å…¥ã€‚æ­£ç¡®åœ°å®šä¹‰æ•°æ®ç»“æ„æ˜¯é€†å‘å·¥ç¨‹çš„å…³é”®ä¸€æ­¥ã€‚</p>
</li>
</ul>
<h4>Enums (æšä¸¾è§†å›¾)</h4>
<ul>
<li><p>å¿«æ·é”® <code>Shift+F10</code>ã€‚</p>
</li>
<li><p>ç”¨äºå®šä¹‰å’Œç®¡ç†æšä¸¾ç±»å‹ï¼Œå¯ä»¥æå¤§åœ°æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œä¾‹å¦‚å°† <code>mov eax, 2</code> å˜ä¸º <code>mov eax, MODE_READ</code>ã€‚</p>
</li>
</ul>
<h4>æ ¸å¿ƒå¿«æ·é”®</h4>
<ul>
<li><p><code>G</code>: è·³è½¬åˆ°æŒ‡å®šåœ°å€ã€‚</p>
</li>
<li><p><code>N</code>: é‡å‘½åå˜é‡ã€å‡½æ•°ã€æ ‡ç­¾ã€‚</p>
</li>
<li><p><code>Y</code>: ä¿®æ”¹å˜é‡ç±»å‹ã€‚</p>
</li>
<li><p><code>X</code>: æŸ¥çœ‹äº¤å‰å¼•ç”¨ (cross-references)ï¼Œå³å“ªäº›åœ°æ–¹è°ƒç”¨/å¼•ç”¨äº†å½“å‰ç¬¦å·ã€‚</p>
</li>
<li><p><code>P</code>: åˆ›å»ºä¸€ä¸ªå‡½æ•°ã€‚</p>
</li>
<li><p><code>U</code>: å–æ¶ˆå®šä¹‰ï¼ˆå¦‚å°†ä»£ç å˜ä¸ºæœªå®šä¹‰æ•°æ®ï¼‰ã€‚</p>
</li>
<li><p><code>;</code>: æ·»åŠ è¡Œæ³¨é‡Šã€‚</p>
</li>
<li><p><code>:</code>: æ·»åŠ å¯é‡å¤æ³¨é‡Šã€‚</p>
</li>
<li><p><code>F5</code>: (å¦‚æœå·²è´­ä¹°) å¯åŠ¨ Hex-Rays åç¼–è¯‘å™¨ã€‚</p>
</li>
</ul>
<hr />
<h3>è„šæœ¬ä¸æ’ä»¶</h3>
<p>IDA çš„å¼ºå¤§èƒ½åŠ›æœ‰ä¸€åŠæ¥è‡ªäºå…¶è„šæœ¬å’Œæ’ä»¶ç³»ç»Ÿã€‚</p>
<ul>
<li><p><strong>IDAPython</strong>: è¿™æ˜¯ç›®å‰æœ€ä¸»æµçš„è„šæœ¬è¯­è¨€ã€‚IDA å†…ç½®äº†ä¸€ä¸ªå®Œæ•´çš„ Python è§£é‡Šå™¨å’Œä¸°å¯Œçš„ APIï¼Œå…è®¸ä½ ç”¨ Python è„šæœ¬ä¸ IDA æ•°æ®åº“è¿›è¡Œæ·±åº¦äº¤äº’ã€‚å‡ ä¹æ‰€æœ‰é‡å¤æ€§å·¥ä½œéƒ½å¯ä»¥é€šè¿‡ IDAPython è‡ªåŠ¨åŒ–ã€‚</p>
</li>
<li><p><strong>IDC</strong>: IDA è‡ªå¸¦çš„ç±» C è„šæœ¬è¯­è¨€ã€‚è¯­æ³•å¤è€ï¼ŒåŠŸèƒ½ä¸å¦‚ IDAPython å¼ºå¤§ï¼Œä½†å¯¹äºä¸€äº›ç®€å•çš„ä»»åŠ¡ä»ç„¶æœ‰ç”¨ã€‚</p>
</li>
<li><p><strong>æ’ä»¶</strong>: IDA çš„æ’ä»¶æœºåˆ¶å…è®¸å¼€å‘è€…ä½¿ç”¨ C++ ç¼–å†™é«˜æ€§èƒ½æ’ä»¶ï¼Œå¹¶å°†å…¶æ·±åº¦é›†æˆåˆ° IDA çš„ UI å’Œæ ¸å¿ƒä¸­ã€‚ç¤¾åŒºä¸­æœ‰å¤§é‡ä¼˜ç§€çš„å¼€æºæ’ä»¶ï¼Œå¦‚ <code>FindCrypt</code>, <code>Keypatch</code> ç­‰ã€‚</p>
</li>
</ul>
<hr />
<h3>ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<h4>ä¼˜ç‚¹</h4>
<ul>
<li><p><strong>æœ€å¼ºçš„åæ±‡ç¼–è´¨é‡</strong>: ä¸šç•Œå…¬è®¤çš„ã€æœ€å¯é çš„é™æ€åˆ†æç»“æœã€‚</p>
</li>
<li><p><strong>FLIRT å’Œç±»å‹ç³»ç»Ÿ</strong>: æå¤§åœ°è‡ªåŠ¨åŒ–äº†åº“å‡½æ•°å’Œæ•°æ®ç»“æ„çš„è¯†åˆ«è¿‡ç¨‹ã€‚</p>
</li>
<li><p><strong>æˆç†Ÿå’Œç¨³å®š</strong>: ç»è¿‡æ•°åå¹´æ‰“ç£¨ï¼Œè½¯ä»¶æœ¬èº«æä¸ºç¨³å®šï¼Œç”¨æˆ·ä½“éªŒæµç•…ã€‚</p>
</li>
<li><p><strong>å¼ºå¤§çš„ç”Ÿæ€</strong>: æµ·é‡çš„æ’ä»¶ã€æ•™ç¨‹å’Œç¤¾åŒºæ”¯æŒï¼Œé‡åˆ°ä»»ä½•é—®é¢˜å‡ ä¹éƒ½èƒ½æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
<li><p><strong>é¡¶çº§çš„åç¼–è¯‘å™¨</strong>: Hex-Rays åç¼–è¯‘å™¨æ˜¯å…¶æœ€å¼ºå¤§çš„æŠ¤åŸæ²³ã€‚</p>
</li>
</ul>
<h4>ç¼ºç‚¹</h4>
<ul>
<li><p><strong>ä»·æ ¼æ˜‚è´µ</strong>: å¯¹äºä¸ªäººå¼€å‘è€…æˆ–å°å‹å›¢é˜Ÿæ¥è¯´ï¼Œä»·æ ¼æ˜¯æœ€å¤§çš„é—¨æ§›ã€‚</p>
</li>
<li><p><strong>é—­æº</strong>: æ ¸å¿ƒåŠŸèƒ½æ˜¯é»‘ç›’ï¼Œæ— æ³•å®¡æŸ¥æˆ–ä¿®æ”¹ã€‚</p>
</li>
<li><p><strong>åä½œä¸ä¾¿</strong>: åŸç”Ÿä¸æ”¯æŒå¤šäººåä½œï¼Œéœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-48">
                                                <h2>48. Radare2 Guide</h2>
                                                <h1>Radare2 å…¥é—¨</h1>
<h2>Radare2 (é€šå¸¸ç®€ç§°ä¸º r2) æ˜¯ä¸€æ¬¾å¼€æºã€å…è´¹ã€å‘½ä»¤è¡Œé©±åŠ¨çš„é€†å‘å·¥ç¨‹æ¡†æ¶ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªåæ±‡ç¼–å™¨ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªåŠŸèƒ½æå…¶ä¸°å¯Œçš„&quot;ç‘å£«å†›åˆ€&quot;ï¼Œé›†æˆäº†åå…­è¿›åˆ¶ç¼–è¾‘ã€åæ±‡ç¼–ã€è°ƒè¯•ã€ä»£ç åˆ†æã€æ¼æ´åˆ©ç”¨ã€æ•°æ®å¯è§†åŒ–ç­‰å¤šç§åŠŸèƒ½ã€‚Radare2 ä»¥å…¶é«˜åº¦çš„å¯è„šæœ¬åŒ–å’Œå¯æ‰©å±•æ€§è€Œé—»åï¼Œæ·±å—å¯»æ±‚è‡ªåŠ¨åŒ–å’Œæ·±åº¦å®šåˆ¶çš„é»‘å®¢ã€CTF é€‰æ‰‹å’Œå®‰å…¨ç ”ç©¶å‘˜çš„å–œçˆ±ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#radare2-%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97">Radare2 å…¥é—¨</a><ul>
<li><a href="#radare2-%E9%80%9A%E5%B8%B8%E7%AE%80%E7%A7%B0%E4%B8%BA-r2-%E6%98%AF%E4%B8%80%E6%AC%BE%E5%BC%80%E6%BA%90%E5%85%8D%E8%B4%B9%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%A9%B1%E5%8A%A8%E7%9A%84%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6%E5%AE%83%E4%B8%8D%E4%BB%85%E4%BB%85%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%8D%E6%B1%87%E7%BC%96%E5%99%A8%E6%9B%B4%E5%83%8F%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD%E6%9E%81%E5%85%B6%E4%B8%B0%E5%AF%8C%E7%9A%84%E7%91%9E%E5%A3%AB%E5%86%9B%E5%88%80%E9%9B%86%E6%88%90%E4%BA%86%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E7%BC%96%E8%BE%91%E5%8F%8D%E6%B1%87%E7%BC%96%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%AD%89%E5%A4%9A%E7%A7%8D%E5%8A%9F%E8%83%BDradare2-%E4%BB%A5%E5%85%B6%E9%AB%98%E5%BA%A6%E7%9A%84%E5%8F%AF%E8%84%9A%E6%9C%AC%E5%8C%96%E5%92%8C%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E8%80%8C%E9%97%BB%E5%90%8D%E6%B7%B1%E5%8F%97%E5%AF%BB%E6%B1%82%E8%87%AA%E5%8A%A8%E5%8C%96%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AE%9A%E5%88%B6%E7%9A%84%E9%BB%91%E5%AE%A2ctf-%E9%80%89%E6%89%8B%E5%92%8C%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6%E5%91%98%E7%9A%84%E5%96%9C%E7%88%B1">Radare2 (é€šå¸¸ç®€ç§°ä¸º r2) æ˜¯ä¸€æ¬¾å¼€æºã€å…è´¹ã€å‘½ä»¤è¡Œé©±åŠ¨çš„é€†å‘å·¥ç¨‹æ¡†æ¶ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªåæ±‡ç¼–å™¨ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªåŠŸèƒ½æå…¶ä¸°å¯Œçš„&quot;ç‘å£«å†›åˆ€&quot;ï¼Œé›†æˆäº†åå…­è¿›åˆ¶ç¼–è¾‘ã€åæ±‡ç¼–ã€è°ƒè¯•ã€ä»£ç åˆ†æã€æ¼æ´åˆ©ç”¨ã€æ•°æ®å¯è§†åŒ–ç­‰å¤šç§åŠŸèƒ½ã€‚Radare2 ä»¥å…¶é«˜åº¦çš„å¯è„šæœ¬åŒ–å’Œå¯æ‰©å±•æ€§è€Œé—»åï¼Œæ·±å—å¯»æ±‚è‡ªåŠ¨åŒ–å’Œæ·±åº¦å®šåˆ¶çš„é»‘å®¢ã€CTF é€‰æ‰‹å’Œå®‰å…¨ç ”ç©¶å‘˜çš„å–œçˆ±ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%90%86%E5%BF%B5%E4%B8%8E%E7%89%B9%E6%80%A7">æ ¸å¿ƒç†å¿µä¸ç‰¹æ€§</a></li>
<li><a href="#radare2-vs-ida-pro-vs-ghidra">Radare2 vs. IDA Pro vs. Ghidra</a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E5%85%A5%E9%97%A8">å®‰è£…ä¸å…¥é—¨</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#open-file-and-perform-analysis">Open file and perform analysis</a></li>
<li><a href="#open-file-and-perform-debug">Open file and perform debug</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">åŸºæœ¬å‘½ä»¤ä¸å·¥ä½œæµç¨‹</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%87%E7%89%A9%E7%9A%86-">æ ¸å¿ƒæ¦‚å¿µï¼šä¸‡ç‰©çš† <code>?</code></a></li>
<li><a href="#%E5%88%86%E6%9E%90-a">åˆ†æ (<code>a</code>)</a></li>
<li><a href="#%E6%89%93%E5%8D%B0-p">æ‰“å° (<code>p</code>)</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF-i">ä¿¡æ¯ (<code>i</code>)</a></li>
<li><a href="#seek-s">Seek (<code>s</code>)</a></li>
<li><a href="#%E5%8F%AF%E8%A7%86%E5%8C%96-v">å¯è§†åŒ– (<code>V</code>)</a></li>
</ul>
</li>
<li><a href="#cutter---radare2-%E7%9A%84-gui">Cutter - Radare2 çš„ GUI</a></li>
<li><a href="#%E8%84%9A%E6%9C%AC%E5%8C%96">è„šæœ¬åŒ–</a><ul>
<li><a href="#%E7%BC%BA%E7%82%B9">ç¼ºç‚¹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>æ ¸å¿ƒç†å¿µä¸ç‰¹æ€§</h3>
<ul>
<li><p><strong>å‘½ä»¤è¡Œé©±åŠ¨</strong>: Radare2 çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½é€šè¿‡å‘½ä»¤è¡Œæ¥å£æš´éœ²ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆåœ¨ç»ˆç«¯ã€SSH ä¼šè¯æˆ–è„šæœ¬ä¸­è¿è¡Œï¼Œæ˜“äºå®ç°è‡ªåŠ¨åŒ–ã€‚</p>
</li>
<li><p><strong>æ¨¡å—åŒ–è®¾è®¡</strong>: å…¶åŠŸèƒ½ç”±ä¸€ç³»åˆ—å•å­—æ¯å‘½ä»¤å’Œå­å‘½ä»¤æ„æˆï¼Œä¾‹å¦‚ <code>p</code> ç”¨äºæ‰“å° (print)ï¼Œ<code>a</code> ç”¨äºåˆ†æ (analyze)ï¼Œ<code>d</code> ç”¨äºè°ƒè¯• (debug)ã€‚è¿™ç§è®¾è®¡éµå¾ªäº† Unix å“²å­¦ã€‚</p>
</li>
<li><p><strong>æµ·é‡æ¶æ„æ”¯æŒ</strong>: Radare2 æ”¯æŒæ•°é‡æƒŠäººçš„å¤„ç†å™¨æ¶æ„ï¼ŒåŒ…æ‹¬è®¸å¤šéå¸¸å°ä¼—å’Œå¤è€çš„åµŒå…¥å¼æ¶æ„ï¼Œè¿™æ–¹é¢ç”šè‡³è¶…è¿‡äº† IDA Proã€‚</p>
</li>
<li><p><strong>é«˜åº¦å¯è„šæœ¬åŒ–</strong>: ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„è¯­è¨€ï¼ˆPython, Go, JavaScript, Rust ç­‰ï¼‰é€šè¿‡ r2pipe ä¸ Radare2 å®ä¾‹è¿›è¡Œäº¤äº’ï¼Œå®ç°å¤æ‚çš„è‡ªåŠ¨åŒ–åˆ†ææµç¨‹ã€‚</p>
</li>
<li><p><strong>å†…ç½®è°ƒè¯•å™¨</strong>: é›†æˆäº†åŠŸèƒ½å¼ºå¤§çš„å¤šå¹³å°è°ƒè¯•å™¨ï¼Œæ”¯æŒç¡¬ä»¶æ–­ç‚¹ã€è·Ÿè¸ªç­‰é«˜çº§åŠŸèƒ½ã€‚</p>
</li>
<li><p><strong>å¼ºå¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶è§£æ</strong>: ä¸ä»…æ”¯æŒ ELF, PE, Mach-O ç­‰æ ‡å‡†æ ¼å¼ï¼Œè¿˜èƒ½è§£ææ–‡ä»¶ç³»ç»Ÿã€å›¾ç‰‡ã€æ–‡æ¡£ç­‰å„ç§äºŒè¿›åˆ¶ blobã€‚</p>
</li>
</ul>
<hr />
<h3>Radare2 vs. IDA Pro vs. Ghidra</h3>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">Radare2</th>
  <th style="text-align:left">IDA Pro</th>
  <th style="text-align:left">Ghidra</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>ä»·æ ¼</strong></td>
  <td style="text-align:left"><strong>å®Œå…¨å…è´¹</strong></td>
  <td style="text-align:left">éå¸¸æ˜‚è´µ</td>
  <td style="text-align:left">å®Œå…¨å…è´¹</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¼€æº</strong></td>
  <td style="text-align:left"><strong>æ˜¯ (C)</strong></td>
  <td style="text-align:left">å¦</td>
  <td style="text-align:left">æ˜¯ (Java)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td>
  <td style="text-align:left"><strong>æè‡´çš„è„šæœ¬åŒ–å’Œå‘½ä»¤è¡Œ</strong></td>
  <td style="text-align:left">æœ€å¼ºçš„äº¤äº’å¼åæ±‡ç¼–</td>
  <td style="text-align:left">é«˜è´¨é‡çš„å…è´¹åç¼–è¯‘å™¨</td>
</tr>
<tr>
  <td style="text-align:left"><strong>UI</strong></td>
  <td style="text-align:left"><strong>å‘½ä»¤è¡Œ</strong> (æˆ– Cutter GUI)</td>
  <td style="text-align:left">Qtï¼Œä¸šç•Œæ ‡å‡†ï¼Œæˆç†Ÿç¨³å®š</td>
  <td style="text-align:left">Java Swingï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ç•¥æ˜¾ç¬¨é‡</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å­¦ä¹ æ›²çº¿</strong></td>
  <td style="text-align:left"><strong>éå¸¸é™¡å³­</strong></td>
  <td style="text-align:left">ä¸­ç­‰</td>
  <td style="text-align:left">ä¸­ç­‰</td>
</tr>
<tr>
  <td style="text-align:left"><strong>è‡ªåŠ¨åŒ–</strong></td>
  <td style="text-align:left"><strong>è®¾è®¡å“²å­¦æ ¸å¿ƒï¼Œèƒ½åŠ›æå¼º</strong></td>
  <td style="text-align:left">ä¸»è¦é€šè¿‡ IDC/IDAPython</td>
  <td style="text-align:left">å¼ºå¤§çš„ Headless æ¨¡å¼</td>
</tr>
<tr>
  <td style="text-align:left"><strong>çµæ´»æ€§</strong></td>
  <td style="text-align:left"><strong>æœ€é«˜</strong>ï¼Œä¸€åˆ‡çš†å¯å®šåˆ¶</td>
  <td style="text-align:left">è¾ƒä½ï¼Œä¾èµ–æ’ä»¶</td>
  <td style="text-align:left">è¾ƒé«˜ï¼Œå¯é€šè¿‡æ’ä»¶æ‰©å±•</td>
</tr>
</tbody>
</table>
<hr />
<h3>å®‰è£…ä¸å…¥é—¨</h3>
<ul>
<li><strong>å®‰è£…</strong>: æœ€æ¨èçš„å®‰è£…æ–¹å¼æ˜¯é€šè¿‡ <code>git</code> å…‹éš†å®˜æ–¹ä»“åº“å¹¶è¿è¡Œå®‰è£…è„šæœ¬ï¼š<pre><code class="language-bash">git clone https://github.com/radareorg/radare2
cd radare2
sys/install.sh
</code></pre>
</li>
</ul>
<pre><code>
* **å¯åŠ¨**:
    ```bash
# Open file and perform analysis
r2 /bin/ls

# Open file and perform debug
r2 -d /bin/ls

</code></pre>
<hr />
<h3>åŸºæœ¬å‘½ä»¤ä¸å·¥ä½œæµç¨‹</h3>
<p>Radare2 çš„å‘½ä»¤ç»“æ„æ˜¯ <code>[å‘½ä»¤][å­å‘½ä»¤][å‚æ•°]</code>ã€‚ä¾‹å¦‚ <code>pdf</code> æ˜¯ <code>p</code> (print) -&gt; <code>d</code> (disassemble) -&gt; <code>f</code> (function) çš„ç»„åˆï¼Œæ„ä¸º&quot;æ‰“å°å‡½æ•°åæ±‡ç¼–&quot;ã€‚</p>
<h4>æ ¸å¿ƒæ¦‚å¿µï¼šä¸‡ç‰©çš† <code>?</code></h4>
<p>åœ¨ä»»ä½•å‘½ä»¤åé¢åŠ ä¸Š <code>?</code> éƒ½å¯ä»¥æŸ¥çœ‹è¯¥å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£ã€‚è¿™æ˜¯å­¦ä¹  Radare2 æœ€é‡è¦çš„æ–¹æ³•ã€‚</p>
<ul>
<li><p><code>?</code>: æ˜¾ç¤ºé¡¶çº§å¸®åŠ©ã€‚</p>
</li>
<li><p><code>a?</code>: æ˜¾ç¤ºåˆ†æ (analyze) å‘½ä»¤çš„å¸®åŠ©ã€‚</p>
</li>
<li><p><code>pdf?</code>: æ˜¾ç¤ºæ‰“å°å‡½æ•°åæ±‡ç¼–å‘½ä»¤çš„å¸®åŠ©ã€‚</p>
</li>
</ul>
<h4>åˆ†æ (<code>a</code>)</h4>
<p>åœ¨ä½ å¯¹ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶åšä»»ä½•äº‹æƒ…ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦å…ˆåˆ†æå®ƒã€‚</p>
<ul>
<li><p><code>aaa</code>: è‡ªåŠ¨åˆ†ææ‰€æœ‰ï¼ˆå‡½æ•°ã€ç¬¦å·ç­‰ï¼‰ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„èµ·æ‰‹å‘½ä»¤ã€‚</p>
</li>
<li><p><code>afl</code>: åˆ—å‡ºæ‰€æœ‰å·²è¯†åˆ«çš„å‡½æ•° (Analyze Function List)ã€‚</p>
</li>
<li><p><code>af</code>: åˆ†æå‡½æ•°ã€‚</p>
</li>
</ul>
<h4>æ‰“å° (<code>p</code>)</h4>
<p>ç”¨äºä»¥ä¸åŒæ ¼å¼æ˜¾ç¤ºæ•°æ®ã€‚</p>
<ul>
<li><p><code>px</code>: ä»¥åå…­è¿›åˆ¶æ ¼å¼æ‰“å° (Print heXadecimal)ã€‚</p>
</li>
<li><p><code>ps</code>: æ‰“å°å­—ç¬¦ä¸² (Print String)ã€‚</p>
</li>
<li><p><code>pd N</code>: åæ±‡ç¼– N æ¡æŒ‡ä»¤ (Print Disassembly)ã€‚</p>
</li>
<li><p><code>pdf</code>: æ‰“å°å½“å‰å‡½æ•°çš„åæ±‡ç¼– (Print Disassembly Function)ã€‚</p>
</li>
</ul>
<h4>ä¿¡æ¯ (<code>i</code>)</h4>
<p>ç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚</p>
<ul>
<li><p><code>iI</code>: æ˜¾ç¤ºæ–‡ä»¶åŸºæœ¬ä¿¡æ¯ (å…¥å£ç‚¹ã€æ¶æ„ç­‰)ã€‚</p>
</li>
<li><p><code>is</code>: æ˜¾ç¤ºç¬¦å·ã€‚</p>
</li>
<li><p><code>iS</code>: æ˜¾ç¤ºæ®µ (sections)ã€‚</p>
</li>
</ul>
<h4>Seek (<code>s</code>)</h4>
<p>ç”¨äºåœ¨æ–‡ä»¶ä¸­è·³è½¬ã€‚</p>
<ul>
<li><p><code>s main</code>: è·³è½¬åˆ° <code>main</code> å‡½æ•°çš„åœ°å€ã€‚</p>
</li>
<li><p><code>s 0x8048400</code>: è·³è½¬åˆ°æŒ‡å®šåœ°å€ã€‚</p>
</li>
<li><p><code>s-</code>: æ’¤é”€ä¸Šä¸€æ¬¡è·³è½¬ã€‚</p>
</li>
</ul>
<h4>å¯è§†åŒ– (<code>V</code>)</h4>
<p>Radare2 æä¾›äº†å¼ºå¤§çš„æ–‡æœ¬æ¨¡å¼å¯è§†åŒ–åŠŸèƒ½ã€‚</p>
<ul>
<li><p><strong>è¿›å…¥/é€€å‡º</strong>: æŒ‰ <code>V</code> è¿›å…¥å¯è§†åŒ–æ¨¡å¼ï¼ŒæŒ‰ <code>q</code> é€€å‡ºã€‚</p>
</li>
<li><p><strong>åˆ‡æ¢è§†å›¾</strong>: åœ¨å¯è§†åŒ–æ¨¡å¼ä¸‹ï¼ŒæŒ‰ <code>p</code> å’Œ <code>P</code> å¯ä»¥åœ¨ä¸åŒè§†å›¾ï¼ˆåæ±‡ç¼–ã€åå…­è¿›åˆ¶ã€è°ƒè¯•å¯„å­˜å™¨ç­‰ï¼‰ä¹‹é—´åˆ‡æ¢ã€‚</p>
</li>
<li><p><strong>å›¾å½¢è§†å›¾</strong>: å¯è§†åŒ–æ¨¡å¼ä¸‹çš„ <code>v</code> é”®å¯ä»¥å±•ç¤ºå‡½æ•°çš„ ASCII-art æµç¨‹å›¾ï¼Œéå¸¸é…·ã€‚</p>
</li>
</ul>
<hr />
<h3>Cutter - Radare2 çš„ GUI</h3>
<p>å¯¹äºä¸ä¹ æƒ¯çº¯å‘½ä»¤è¡Œçš„ç”¨æˆ·ï¼Œç¤¾åŒºå¼€å‘äº† <strong>Cutter</strong>ã€‚Cutter æ˜¯ä¸€ä¸ªåŸºäº Qt C++ çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œåç«¯ç”± Radare2 é©±åŠ¨ã€‚</p>
<ul>
<li><p>å®ƒæä¾›äº†ç±»ä¼¼ IDA Pro å’Œ Ghidra çš„å›¾å½¢åŒ–ç•Œé¢ï¼ŒåŒ…æ‹¬åæ±‡ç¼–çª—å£ã€åç¼–è¯‘çª—å£ï¼ˆé›†æˆäº† Ghidra Decompilerï¼‰ã€å‡½æ•°åˆ—è¡¨ã€Hexdump ç­‰ã€‚</p>
</li>
<li><p>æ‰€æœ‰åœ¨ Cutter ä¸­è¿›è¡Œçš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯åœ¨åå°è°ƒç”¨ Radare2 çš„å‘½ä»¤å®Œæˆçš„ã€‚</p>
</li>
<li><p>å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œä» Cutter å…¥æ‰‹å¯ä»¥æå¤§åœ°é™ä½å­¦ä¹  Radare2 çš„é—¨æ§›ã€‚</p>
</li>
</ul>
<hr />
<h3>è„šæœ¬åŒ–</h3>
<p>Radare2 çš„ç²¾é«“åœ¨äºè‡ªåŠ¨åŒ–ã€‚<code>r2pipe</code> æ˜¯å…¶å®˜æ–¹çš„è„šæœ¬åº“ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ª Python è„šæœ¬ç¤ºä¾‹ï¼Œç”¨äºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ†æå®ƒï¼Œå¹¶æ‰“å°æ‰€æœ‰å‡½æ•°çš„åç§°ï¼š</p>
<pre><code class="language-python">import r2pipe

# Open file
r2 = r2pipe.open(&quot;/bin/ls&quot;)

# Run 'aaa' command to perform analysis
r2.cmd('aaa')

# Run 'aflj' command to get JSON format function list and parse
functions = r2.cmdj('aflj')

# Print each function name
if functions:
for func in functions:
print(f&quot;Function found: {func['name']} at {hex(func['offset'])}&quot;)

</code></pre>
<ul>
<li><p><strong>æ— ä¸ä¼¦æ¯”çš„è„šæœ¬åŒ–èƒ½åŠ›</strong>: è®¾è®¡å“²å­¦ä½¿å…¶æˆä¸ºè‡ªåŠ¨åŒ–é€†å‘åˆ†æçš„ç†æƒ³é€‰æ‹©ã€‚</p>
</li>
<li><p><strong>æé«˜çš„çµæ´»æ€§å’Œå®šåˆ¶æ€§</strong>: ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ç»„åˆå‘½ä»¤ï¼Œæ„å»ºå·¥ä½œæµã€‚</p>
</li>
<li><p><strong>è½»é‡ä¸å¿«é€Ÿ</strong>: æ ¸å¿ƒç¨‹åºéå¸¸å°ï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨å°‘ã€‚</p>
</li>
<li><p><strong>æµ·é‡æ¶æ„æ”¯æŒ</strong>: å¯¹å„ç§å¥‡å¼‚æ¶æ„çš„æ”¯æŒæ˜¯å…¶ä¸€å¤§ç‰¹è‰²ã€‚</p>
</li>
</ul>
<h4>ç¼ºç‚¹</h4>
<ul>
<li><p><strong>é™¡å³­çš„å­¦ä¹ æ›²çº¿</strong>: å‘½ä»¤ç¹å¤šï¼Œè¯­æ³•ç‰¹æ®Šï¼Œå¯¹æ–°æ‰‹éå¸¸ä¸å‹å¥½ã€‚</p>
</li>
<li><p><strong>æ–‡æ¡£ç›¸å¯¹æ··ä¹±</strong>: è™½ç„¶æœ‰å¸®åŠ©ç³»ç»Ÿï¼Œä½†å®˜æ–¹æ–‡æ¡£çš„ç»“æ„æ€§å’Œå®Œæ•´æ€§ä¸å¦‚å•†ä¸šè½¯ä»¶ã€‚</p>
</li>
<li><p><strong>é»˜è®¤åç¼–è¯‘å™¨</strong>: å†…ç½®çš„åç¼–è¯‘å™¨è´¨é‡ä¸å¦‚ Ghidra æˆ– Hex-Raysï¼Œä½†å¯ä»¥é€šè¿‡æ’ä»¶é›†æˆ Ghidra Decompilerã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-49">
                                                <h2>49. ADB Cheatsheet</h2>
                                                <h1>å¸¸ç”¨ ADB å‘½ä»¤å¤§å…¨</h1>
<p>ADB (Android Debug Bridge) æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯è®©æ‚¨ä¸æ¨¡æ‹Ÿå™¨å®ä¾‹æˆ–è¿æ¥çš„ Android è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</p>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#%E5%B8%B8%E7%94%A8-adb-%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8">å¸¸ç”¨ ADB å‘½ä»¤å¤§å…¨</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86">è®¾å¤‡ç®¡ç†</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86">æ–‡ä»¶ç®¡ç†</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86">åº”ç”¨ç®¡ç†</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C">ç½‘ç»œ</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%B0%83%E8%AF%95">ç³»ç»Ÿä¸è°ƒè¯•</a></li>
<li><a href="#logcat-%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B">Logcat æ—¥å¿—æŸ¥çœ‹</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7-shell-%E5%91%BD%E4%BB%A4">é«˜çº§ Shell å‘½ä»¤</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>è®¾å¤‡ç®¡ç†</h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>adb devices -l</code></td>
  <td>åˆ—å‡ºæ‰€æœ‰è¿æ¥çš„è®¾å¤‡åŠå…¶è¯¦ç»†ä¿¡æ¯</td>
</tr>
<tr>
  <td><code>adb reboot</code></td>
  <td>é‡å¯è®¾å¤‡</td>
</tr>
<tr>
  <td><code>adb reboot bootloader</code></td>
  <td>é‡å¯åˆ°å¼•å¯¼åŠ è½½ç¨‹åº (Bootloader)</td>
</tr>
<tr>
  <td><code>adb reboot recovery</code></td>
  <td>é‡å¯åˆ°æ¢å¤æ¨¡å¼ (Recovery)</td>
</tr>
<tr>
  <td><code>adb root</code></td>
  <td>ä»¥ root æƒé™é‡å¯ adbd æœåŠ¡</td>
</tr>
<tr>
  <td><code>adb shell getprop ro.product.model</code></td>
  <td>è·å–è®¾å¤‡å‹å·</td>
</tr>
<tr>
  <td><code>adb shell getprop ro.build.version.release</code></td>
  <td>è·å– Android ç³»ç»Ÿç‰ˆæœ¬</td>
</tr>
<tr>
  <td><code>adb shell wm size</code></td>
  <td>è·å–å±å¹•åˆ†è¾¨ç‡</td>
</tr>
<tr>
  <td><code>adb shell wm density</code></td>
  <td>è·å–å±å¹•åƒç´ å¯†åº¦ (DPI)</td>
</tr>
</tbody>
</table>
<hr />
<h3>æ–‡ä»¶ç®¡ç†</h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>adb push &lt;æœ¬åœ°è·¯å¾„&gt; &lt;è¿œç¨‹è·¯å¾„&gt;</code></td>
  <td>å°†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä»ç”µè„‘æ¨é€åˆ°è®¾å¤‡</td>
</tr>
<tr>
  <td><code>adb pull &lt;è¿œç¨‹è·¯å¾„&gt; [æœ¬åœ°è·¯å¾„]</code></td>
  <td>å°†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä»è®¾å¤‡æ‹‰å–åˆ°ç”µè„‘</td>
</tr>
<tr>
  <td><code>adb shell ls &lt;è·¯å¾„&gt;</code></td>
  <td>åˆ—å‡ºè®¾å¤‡æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</td>
</tr>
<tr>
  <td><code>adb shell cd &lt;è·¯å¾„&gt;</code></td>
  <td>åˆ‡æ¢è®¾å¤‡ä¸Šçš„å½“å‰ç›®å½•</td>
</tr>
<tr>
  <td><code>adb shell pwd</code></td>
  <td>æ˜¾ç¤ºè®¾å¤‡ä¸Šçš„å½“å‰å·¥ä½œç›®å½•</td>
</tr>
<tr>
  <td><code>adb shell cp &lt;æºè·¯å¾„&gt; &lt;ç›®æ ‡è·¯å¾„&gt;</code></td>
  <td>åœ¨è®¾å¤‡ä¸Šå¤åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>adb shell mv &lt;æºè·¯å¾„&gt; &lt;ç›®æ ‡è·¯å¾„&gt;</code></td>
  <td>åœ¨è®¾å¤‡ä¸Šç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶</td>
</tr>
<tr>
  <td><code>adb shell rm &lt;æ–‡ä»¶è·¯å¾„&gt;</code></td>
  <td>åœ¨è®¾å¤‡ä¸Šåˆ é™¤æ–‡ä»¶</td>
</tr>
<tr>
  <td><code>adb shell mkdir &lt;è·¯å¾„&gt;</code></td>
  <td>åœ¨è®¾å¤‡ä¸Šåˆ›å»ºæ–°ç›®å½•</td>
</tr>
</tbody>
</table>
<hr />
<h3>åº”ç”¨ç®¡ç†</h3>
<p>| å‘½ä»¤                                        | æè¿°                                  |
| ------------------------------------------- | ------------------------------------- | --------------------- |
| <code>adb install &lt;apkè·¯å¾„&gt;</code>                     | å®‰è£…åº”ç”¨                              |
| <code>adb install -r &lt;apkè·¯å¾„&gt;</code>                  | é‡æ–°å®‰è£…åº”ç”¨ï¼ˆä¿ç•™æ•°æ®ï¼‰              |
| <code>adb install -g &lt;apkè·¯å¾„&gt;</code>                  | ä¸ºåº”ç”¨æˆäºˆæ‰€æœ‰è¿è¡Œæ—¶æƒé™              |
| <code>adb uninstall &lt;åŒ…å&gt;</code>                      | å¸è½½åº”ç”¨                              |
| <code>adb shell pm list packages</code>                | åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨åŒ…å              |
| <code>adb shell pm list packages -f</code>             | åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨åŒ…ååŠå…¶ APK è·¯å¾„ |
| <code>adb shell pm list packages -3</code>             | åˆ—å‡ºæ‰€æœ‰ç¬¬ä¸‰æ–¹åº”ç”¨åŒ…å                |
| <code>adb shell pm path &lt;åŒ…å&gt;</code>                  | è·å–æŒ‡å®šåº”ç”¨çš„ APK è·¯å¾„               |
| <code>adb shell am start -n &lt;åŒ…å&gt;/&lt;Activityå&gt;</code> | å¯åŠ¨ä¸€ä¸ª Activity                     |
| <code>adb shell am force-stop &lt;åŒ…å&gt;</code>            | å¼ºåˆ¶åœæ­¢åº”ç”¨                          |
| <code>adb shell pm clear &lt;åŒ…å&gt;</code>                 | æ¸…é™¤åº”ç”¨æ•°æ®å’Œç¼“å­˜                    |
| <code>adb shell dumpsys activity                 | grep mFocusedActivity</code>                | è·å–å½“å‰å‰å° Activity |</p>
<hr />
<h3>ç½‘ç»œ</h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>adb forward tcp:&lt;PCç«¯å£&gt; tcp:&lt;è®¾å¤‡ç«¯å£&gt;</code></td>
  <td>å°†ç”µè„‘ç«¯å£çš„è¯·æ±‚è½¬å‘åˆ°è®¾å¤‡ç«¯å£</td>
</tr>
<tr>
  <td><code>adb forward --list</code></td>
  <td>åˆ—å‡ºæ‰€æœ‰ç«¯å£è½¬å‘è§„åˆ™</td>
</tr>
<tr>
  <td><code>adb forward --remove-all</code></td>
  <td>ç§»é™¤æ‰€æœ‰ç«¯å£è½¬å‘è§„åˆ™</td>
</tr>
<tr>
  <td><code>adb shell netstat</code></td>
  <td>æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ï¼ˆç›‘å¬çš„ç«¯å£ã€è¿æ¥ç­‰ï¼‰</td>
</tr>
<tr>
  <td><code>adb shell ifconfig</code> or <code>adb shell ip addr</code></td>
  <td>æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯å’Œ IP åœ°å€</td>
</tr>
</tbody>
</table>
<hr />
<h3>ç³»ç»Ÿä¸è°ƒè¯•</h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>adb shell ps</code></td>
  <td>æŸ¥çœ‹è®¾å¤‡ä¸Šçš„è¿›ç¨‹åˆ—è¡¨</td>
</tr>
<tr>
  <td><code>adb shell top</code></td>
  <td>æŸ¥çœ‹å®æ—¶èµ„æºå ç”¨æƒ…å†µ</td>
</tr>
<tr>
  <td><code>adb shell dumpsys &lt;æœåŠ¡å&gt;</code></td>
  <td>Dump æŒ‡å®šç³»ç»ŸæœåŠ¡çš„ä¿¡æ¯ (å¦‚ <code>activity</code>, <code>battery</code>, <code>wifi</code>)</td>
</tr>
<tr>
  <td><code>adb shell screencap /sdcard/screenshot.png</code></td>
  <td>æˆªå±å¹¶ä¿å­˜åˆ°è®¾å¤‡</td>
</tr>
<tr>
  <td><code>adb shell screenrecord /sdcard/demo.mp4</code></td>
  <td>å½•åˆ¶å±å¹•ï¼ˆCtrl+C åœæ­¢ï¼‰</td>
</tr>
<tr>
  <td><code>adb bugreport [è·¯å¾„]</code></td>
  <td>ç”Ÿæˆå¹¶æ‹‰å–å®Œæ•´çš„ bug æŠ¥å‘Š</td>
</tr>
<tr>
  <td><code>adb jdwp</code></td>
  <td>åˆ—å‡ºè®¾å¤‡ä¸Šå¯ä¾›è°ƒè¯•çš„ Java è¿›ç¨‹ ID (JDWP)</td>
</tr>
</tbody>
</table>
<hr />
<h3>Logcat æ—¥å¿—æŸ¥çœ‹</h3>
<p>| å‘½ä»¤                             | æè¿°                      |
| -------------------------------- | ------------------------- | ------------------------------- |
| <code>adb logcat</code>                     | å®æ—¶æ‰“å°è®¾å¤‡æ—¥å¿—          |
| <code>adb logcat -c</code>                  | æ¸…é™¤æ—§çš„æ—¥å¿—ç¼“å­˜          |
| <code>adb logcat -d</code>                  | Dump å½“å‰æ—¥å¿—åˆ°å±å¹•å¹¶é€€å‡º |
| <code>adb logcat -f /sdcard/log.txt</code>  | å°†æ—¥å¿—è¾“å‡ºåˆ°è®¾å¤‡ä¸Šçš„æ–‡ä»¶  |
| <code>adb logcat *:S &lt;æ ‡ç­¾&gt;:&lt;ä¼˜å…ˆçº§&gt;</code> | æŒ‰æ ‡ç­¾å’Œä¼˜å…ˆçº§è¿‡æ»¤æ—¥å¿—    |
| <code>adb logcat                      | grep &lt;å…³é”®è¯&gt;</code>            | åœ¨æ—¥å¿—ä¸­æœç´¢å…³é”®è¯ (åŒºåˆ†å¤§å°å†™) |</p>
<ul>
<li><p><strong>æ—¥å¿—ä¼˜å…ˆçº§</strong>:</p>
</li>
<li><p><code>V</code> â€” Verbose (æœ€ä½)</p>
</li>
<li><p><code>D</code> â€” Debug</p>
</li>
<li><p><code>I</code> â€” Info</p>
</li>
<li><p><code>W</code> â€” Warning</p>
</li>
<li><p><code>E</code> â€” Error</p>
</li>
<li><p><code>F</code> â€” Fatal</p>
</li>
<li><p><code>S</code> â€” Silent (æœ€é«˜)</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>: <code>adb logcat *:S MyApp:D</code> åªæ˜¾ç¤ºæ ‡ç­¾ä¸º &quot;MyApp&quot; ä¸”ä¼˜å…ˆçº§ä¸º Debug æˆ–æ›´é«˜çš„æ—¥å¿—ã€‚</p>
</li>
</ul>
<hr />
<h3>é«˜çº§ Shell å‘½ä»¤</h3>
<table>
<thead>
<tr>
  <th>å‘½ä»¤</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>adb shell input text '&lt;æ–‡æœ¬&gt;'</code></td>
  <td>å‘å½“å‰è¾“å…¥æ¡†è¾“å…¥æ–‡æœ¬ï¼ˆä¸æ”¯æŒä¸­æ–‡ï¼‰</td>
</tr>
<tr>
  <td><code>adb shell input keyevent &lt;æŒ‰é”®ç &gt;</code></td>
  <td>å‘é€ä¸€ä¸ªæŒ‰é”®äº‹ä»¶ (ä¾‹å¦‚ <code>3</code>=HOME, <code>4</code>=BACK, <code>26</code>=POWER)</td>
</tr>
<tr>
  <td><code>adb shell input tap &lt;x&gt; &lt;y&gt;</code></td>
  <td>æ¨¡æ‹Ÿåœ¨å±å¹•æŒ‡å®šåæ ‡çš„å•å‡»äº‹ä»¶</td>
</tr>
<tr>
  <td><code>adb shell input swipe &lt;x1&gt; &lt;y1&gt; &lt;x2&gt; &lt;y2&gt; [æ—¶é•¿ms]</code></td>
  <td>æ¨¡æ‹Ÿæ»‘åŠ¨äº‹ä»¶</td>
</tr>
<tr>
  <td><code>adb shell settings get &lt;å‘½åç©ºé—´&gt; &lt;é”®&gt;</code></td>
  <td>è·å–ç³»ç»Ÿè®¾ç½®é¡¹çš„å€¼</td>
</tr>
<tr>
  <td><code>adb shell settings put &lt;å‘½åç©ºé—´&gt; &lt;é”®&gt; &lt;å€¼&gt;</code></td>
  <td>ä¿®æ”¹ç³»ç»Ÿè®¾ç½®é¡¹çš„å€¼</td>
</tr>
<tr>
  <td><code>adb shell content query --uri &lt;URI&gt;</code></td>
  <td>æŸ¥è¯¢ Content Provider ä¸­çš„æ•°æ®</td>
</tr>
<tr>
  <td><code>adb shell ime list -s</code></td>
  <td>åˆ—å‡ºå¯ç”¨çš„è¾“å…¥æ³•</td>
</tr>
<tr>
  <td><code>adb shell ime set &lt;è¾“å…¥æ³•ID&gt;</code></td>
  <td>è®¾ç½®é»˜è®¤è¾“å…¥æ³•</td>
</tr>
</tbody>
</table>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">ğŸ“„ Case Studies</h1>
                    
                                            <div class="section" id="section-50">
                                                <h2>50. Case: Anti Analysis Techniques</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šååˆ†ææŠ€æœ¯</h1>
<p>ä¸ºäº†ä¿æŠ¤å…¶æ ¸å¿ƒä»£ç å’Œæ•°æ®ä¸è¢«è½»æ˜“åˆ†æï¼Œç°ä»£ App æ™®éé‡‡ç”¨äº†ä¸€ç³»åˆ—çš„ååˆ†ææŠ€æœ¯ã€‚è¿™äº›æŠ€æœ¯æ—¨åœ¨æ£€æµ‹å’Œé˜»æ­¢è°ƒè¯•å™¨ã€Hook æ¡†æ¶ï¼ˆå¦‚ Fridaï¼‰å’Œæ¨¡æ‹Ÿå™¨çš„è¿è¡Œã€‚æœ¬æ¡ˆä¾‹å°†åˆ†ç±»ä»‹ç»è¿™äº›æŠ€æœ¯çš„å®ç°åŸç†å’Œå¸¸è§çš„ç»•è¿‡ç­–ç•¥ã€‚</p>
<hr />
<h2>1. åè°ƒè¯• (Anti-Debugging)</h2>
<p><strong>ç›®æ ‡</strong>: æ£€æµ‹ App æ˜¯å¦æ­£è¢«è°ƒè¯•å™¨é™„åŠ ã€‚</p>
<h3>æ¡ˆä¾‹ï¼šåŸºäº <code>TracerPid</code> çš„æ£€æµ‹</h3>
<p>è¿™æ˜¯æœ€å¸¸è§çš„ä¸€ç§åè°ƒè¯•æ–¹æ³•ã€‚åœ¨ Linux å†…æ ¸ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ <code>/proc/&lt;pid&gt;/status</code> æ–‡ä»¶éƒ½è®°å½•äº†å…¶çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ä¸­ <code>TracerPid</code> å­—æ®µè¡¨ç¤ºæ­£åœ¨è¿½è¸ªï¼ˆè°ƒè¯•ï¼‰è¯¥è¿›ç¨‹çš„è¿›ç¨‹ PIDã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¢«è°ƒè¯•ï¼Œè¯¥å€¼ä¸º 0ã€‚</p>
<p><strong>å®ç°åŸç†</strong>:
App åœ¨è¿è¡Œæ—¶ä¼šå¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æˆ–å­è¿›ç¨‹ï¼Œå‘¨æœŸæ€§åœ°è¯»å–è‡ªèº«çš„ <code>TracerPid</code>ã€‚</p>
<pre><code class="language-c">// Native (C/C++) implementation
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int check_tracer_pid() {
FILE *fp = fopen(&quot;/proc/self/status&quot;, &quot;r&quot;);
if (fp == NULL) {
return 0;
}

char line[128];
while (fgets(line, sizeof(line), fp)) {
if (strncmp(line, &quot;TracerPid:&quot;, 10) == 0) {
int tracer_pid = 0;
sscanf(line, &quot;TracerPid:\t%d&quot;, &amp;tracer_pid);
fclose(fp);
return tracer_pid;
}
}
fclose(fp);
return 0;
}

// Call this in a loop somewhere in the App
if (check_tracer_pid() != 0) {
// Debugger detected, execute exit or crash logic
exit(0);
}

</code></pre>
<hr />
<h2>2. å Hook (Anti-Hooking)</h2>
<p><strong>ç›®æ ‡</strong>: æ£€æµ‹å’Œé˜»æ­¢ Frida ç­‰ Hook æ¡†æ¶çš„æ³¨å…¥å’ŒåŠŸèƒ½ã€‚</p>
<h3>æ¡ˆä¾‹ï¼šæ‰«æå†…å­˜ä¸­çš„ Frida ç‰¹å¾</h3>
<p>Frida åœ¨æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹åï¼Œä¼šåœ¨å†…å­˜ä¸­ç•™ä¸‹ä¸€äº›ç‰¹å¾ï¼Œå¦‚å…¶æ ¸å¿ƒåº“ <code>frida-agent.so</code>ã€‚</p>
<p><strong>å®ç°åŸç†</strong>:
App ä¼šæ‰«æè‡ªèº«çš„å†…å­˜æ˜ å°„ï¼ˆ<code>/proc/self/maps</code>ï¼‰ï¼Œå¯»æ‰¾æ˜¯å¦å­˜åœ¨åŒ…å« <code>frida</code> æˆ– <code>gumjs</code> ç­‰å…³é”®è¯çš„åº“ã€‚</p>
<pre><code class="language-c">// Native (C/C++) implementation
int check_for_frida_in_maps() {
FILE *fp = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
if (fp == NULL) {
return 0;
}

char line[256];
while (fgets(line, sizeof(line), fp)) {
if (strstr(line, &quot;frida-agent&quot;) || strstr(line, &quot;gumjs&quot;)) {
fclose(fp);
return 1; // Frida detected
}
}
fclose(fp);
return 0;
}

</code></pre>
<hr />
<h2>3. åæ¨¡æ‹Ÿå™¨ (Anti-Emulator)</h2>
<p><strong>ç›®æ ‡</strong>: æ£€æµ‹ App æ˜¯å¦è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ï¼ˆå¦‚ Genymotion, Android SDK Emulatorï¼‰è€ŒéçœŸå®è®¾å¤‡ä¸Šã€‚</p>
<h3>æ¡ˆä¾‹ï¼šæ£€æµ‹è®¾å¤‡ç‰¹æœ‰æ–‡ä»¶æˆ–å±æ€§</h3>
<p>æ¨¡æ‹Ÿå™¨é€šå¸¸ä¼šç•™ä¸‹ä¸€äº›åŒºåˆ«äºçœŸæœºçš„ç‰¹æœ‰æ–‡ä»¶ã€é©±åŠ¨æˆ–ç³»ç»Ÿå±æ€§ã€‚</p>
<p><strong>å®ç°åŸç†</strong>:
<strong>æ£€æŸ¥ç³»ç»Ÿå±æ€§</strong>: é€šè¿‡ <code>getprop</code> æˆ–ç›´æ¥è¯»å– <code>build.prop</code> æ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>ro.kernel.qemu</code>, <code>ro.hardware.goldfish</code> ç­‰æ¨¡æ‹Ÿå™¨ç‰¹æœ‰çš„å±æ€§ã€‚</p>
<p><strong>æ£€æŸ¥æ–‡ä»¶</strong>: æ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>/system/lib/libc_malloc_debug_qemu.so</code> æˆ– <code>/sys/qemu_trace</code> ç­‰æ–‡ä»¶ã€‚</p>
<p><strong>æ£€æŸ¥ CPU ä¿¡æ¯</strong>: è¯»å– <code>/proc/cpuinfo</code>ï¼Œæ£€æŸ¥ <code>Hardware</code> å­—æ®µæ˜¯å¦åŒ…å« <code>Goldfish</code> æˆ– <code>Intel</code> ç­‰ï¼Œè€Œé <code>Qualcomm</code>, <code>MediaTek</code> ç­‰ç§»åŠ¨ç«¯å¤„ç†å™¨å‚å•†ã€‚</p>
<p><strong>ç»•è¿‡ç­–ç•¥</strong>:
<strong>Hook <code>System.getProperty</code></strong>: åœ¨ Java å±‚ Hook è¯¥æ–¹æ³•ï¼Œå½“è¯·æ±‚ç‰¹å®šå±æ€§æ—¶è¿”å›ä¸€ä¸ªä¼ªé€ çš„ã€çœ‹èµ·æ¥åƒçœŸæœºçš„å€¼ã€‚</p>
<p><strong>Hook æ–‡ä»¶ API</strong>: Hook <code>File.exists()</code> æˆ– Native å±‚çš„ <code>access()</code>, <code>stat()</code> ç­‰å‡½æ•°ï¼Œå¯¹ç‰¹å®šçš„æ¨¡æ‹Ÿå™¨æ–‡ä»¶è·¯å¾„è¿”å› <code>false</code>ã€‚</p>
<p><strong>ä½¿ç”¨å®šåˆ¶ ROM</strong>: åœ¨ä¸€ä¸ªä¿®æ”¹è¿‡çš„ Android ROM ä¸­ï¼Œå¯ä»¥ä»ç³»ç»Ÿå±‚é¢ç§»é™¤æˆ–ä¼ªé€ è¿™äº›æ¨¡æ‹Ÿå™¨ç‰¹å¾ã€‚</p>
<p><strong>é€‰æ‹©æ›´é€¼çœŸçš„æ¨¡æ‹Ÿå™¨</strong>: ä¸€äº›å•†ä¸šæˆ–å¼€æºçš„ã€é«˜åº¦å®šåˆ¶åŒ–çš„æ¨¡æ‹Ÿå™¨åœ¨éšè—è‡ªèº«ç‰¹å¾æ–¹é¢åšå¾—æ›´å¥½ï¼Œæ›´éš¾è¢«æ£€æµ‹ã€‚</p>
<hr />
<h2>æ€»ç»“</h2>
<p>ååˆ†ææŠ€æœ¯çš„æ”»é˜²æ˜¯ä¸€ä¸ªä¸æ–­å‡çº§çš„&quot;çŒ«é¼ æ¸¸æˆ&quot;ã€‚</p>
<p><strong>æ£€æµ‹æ–¹</strong>: åŠªåŠ›å¯»æ‰¾åˆ†æå·¥å…·ï¼ˆè°ƒè¯•å™¨ã€Fridaï¼‰åœ¨ç›®æ ‡ç³»ç»Ÿä¸­ç•™ä¸‹çš„ä»»ä½•è››ä¸é©¬è¿¹ã€‚</p>
<p><strong>ç»•è¿‡æ–¹</strong>: åŠªåŠ›æŠ¹å»æˆ–ä¼ªé€ è¿™äº›ç—•è¿¹ï¼Œè®© App è®¤ä¸ºè‡ªå·±è¿è¡Œåœ¨ä¸€ä¸ª&quot;å¹²å‡€&quot;çš„ç¯å¢ƒä¸­ã€‚</p>
<p>æˆåŠŸçš„ç»•è¿‡å¾€å¾€éœ€è¦å¤šé¡¹æŠ€æœ¯çš„ç»„åˆï¼Œä» Java å±‚çš„ Hookï¼Œåˆ° Native å±‚çš„ Patchingï¼Œå†åˆ°å¯¹æ“ä½œç³»ç»Ÿå’Œå·¥å…·é“¾æœ¬èº«çš„å®šåˆ¶ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-51">
                                                <h2>51. Case: Music Apps</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šéŸ³ä¹ App</h1>
<h2>éŸ³ä¹ç±» App æ˜¯éå¸¸å…¸å‹çš„é€†å‘åˆ†æç›®æ ‡ã€‚å…¶æ ¸å¿ƒåœºæ™¯é€šå¸¸å›´ç»•ç€ VIP ä¼šå‘˜ç‰¹æƒã€éŸ³é¢‘æ•°æ®åŠ å¯†å’Œå®¢æˆ·ç«¯é£æ§ç­–ç•¥ã€‚æœ¬æ¡ˆä¾‹å°†æ¨¡æ‹Ÿå¯¹ä¸€ä¸ªå…¸å‹éŸ³ä¹ App çš„åˆ†æè¿‡ç¨‹ã€‚</h2>
<h2>æ ¸å¿ƒåˆ†æç›®æ ‡</h2>
<ol>
<li><strong>è§£é” VIP åŠŸèƒ½</strong>: å…è´¹æ”¶å¬ä»˜è´¹æ­Œæ›²ã€ä¸‹è½½æ— æŸéŸ³è´¨ã€å»é™¤å¹¿å‘Šã€ä½¿ç”¨ä¸“å±çš®è‚¤ç­‰ã€‚</li>
<li><strong>éŸ³é¢‘æ•°æ®æå–</strong>: åˆ†æåŠ å¯†çš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚ <code>ncm</code>, <code>qmcflac</code>ï¼‰ï¼Œæå–å‡ºå¯æ’­æ”¾çš„ <code>mp3</code> æˆ– <code>flac</code> æ–‡ä»¶ã€‚</li>
<li><strong>API åˆ†æ</strong>: åˆ†æå…¶æ­Œæ›²æœç´¢ã€æ­Œå•è·å–ã€è¯„è®ºåŒºç­‰ APIï¼Œä¸ºç¬¬ä¸‰æ–¹å·¥å…·æˆ–çˆ¬è™«æä¾›æ”¯æŒã€‚</li>
</ol>
<hr />
<h2>æ¡ˆä¾‹ï¼šåˆ†æ VIP æ­Œæ›²çš„æ’­æ”¾æµç¨‹</h2>
<h3>ç¬¬ 1 æ­¥ï¼šå®šä½åˆ‡å…¥ç‚¹</h3>
<p><strong>ç›®æ ‡</strong>: æ‰¾åˆ°åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸º VIP ä»¥åŠæ­Œæ›²æ˜¯å¦ä¸ºä»˜è´¹æ­Œæ›²çš„å…³é”®ä»£ç ã€‚</p>
<ol>
<li><strong>ç•Œé¢åˆ†æ</strong>: åœ¨ App ä¸­æ’­æ”¾ä¸€é¦–éœ€è¦ VIP çš„æ­Œæ›²ï¼Œé€šå¸¸ä¼šå¼¹å‡ºä¸€ä¸ª&quot;å¼€é€š VIP&quot;çš„æç¤ºæ¡†ã€‚è¿™ä¸ªæç¤ºæ¡†æ˜¯ç»ä½³çš„åˆ‡å…¥ç‚¹ã€‚</li>
<li><strong>å¯»æ‰¾å…³é”®è¯</strong>: ä½¿ç”¨ <code>jadx-gui</code> åç¼–è¯‘ APKï¼Œæœç´¢ä¸å¼¹çª—å†…å®¹ç›¸å…³çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚&quot;ä»…é™ VIP&quot;ã€&quot;å¼€é€šä¼šå‘˜&quot;ç­‰ã€‚</li>
<li><strong>äº¤å‰å¼•ç”¨</strong>: å¯¹æ‰¾åˆ°çš„å­—ç¬¦ä¸²è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œå®šä½åˆ°æ˜¾ç¤ºè¿™ä¸ªå¼¹çª—çš„ä»£ç ã€‚ä½ å¾ˆå¯èƒ½ä¼šæ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼ <code>showVipDialog()</code> çš„æ–¹æ³•ã€‚</li>
<li><strong>å›æº¯è°ƒç”¨æ ˆ</strong>: ç»§ç»­å¯¹ <code>showVipDialog()</code> è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œå‘ä¸Šå›æº¯ã€‚é€šå¸¸ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªåŒ…å«äº†æ ¸å¿ƒåˆ¤æ–­é€»è¾‘çš„å‡½æ•°ï¼Œå…¶ä¼ªä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="language-java">void onPlayButtonClick(Song song) {
// isVip() determines from user information
// song.isPaywalled() determines from song information
if (!isVip() &amp;&amp; song.isPaywalled()) {
showVipDialog();
return;
}
// ...execute playback logic...
startPlayback(song);
}

</code></pre>
<p><strong>ç›®æ ‡</strong>: ç»•è¿‡ VIP åˆ¤æ–­ï¼Œè®© App è®¤ä¸ºæˆ‘ä»¬æ˜¯ VIP ç”¨æˆ·ã€‚</p>
<p>æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ Hook è´Ÿè´£åˆ¤æ–­ç”¨æˆ·èº«ä»½çš„å‡½æ•°ã€‚</p>
<pre><code class="language-javascript">Java.perform(function () {
  // Assume UserInfo class manages user information
  var UserInfo = Java.use(&quot;com.example.music.model.UserInfo&quot;);

  // Directly hook isVip method to always return true
  UserInfo.isVip.implementation = function () {
    console.log(&quot;Bypassing VIP check, returning true.&quot;);
    return true;
  };

  // Some apps may also verify VIP expiration time
  UserInfo.getVipExpireTime.implementation = function () {
    // Return a timestamp far in the future
    return new Date(2099, 11, 31).getTime();
  };
});
</code></pre>
<ul>
<li><p>è¯·æ±‚çš„ URL ä¸­å¸¦æœ‰ <code>quality=flac</code> æˆ– <code>hires</code> ç­‰å‚æ•°ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨è¿”å›çš„å“åº” <code>Content-Type</code> å¯èƒ½ä¸æ˜¯ <code>audio/mpeg</code>ï¼Œè€Œæ˜¯ä¸€äº›è‡ªå®šä¹‰çš„ç±»å‹å¦‚ <code>application/octet-stream</code>ã€‚</p>
</li>
<li><p>ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œ<code>song.ncm</code>ï¼‰æ— æ³•ç”¨æ ‡å‡†æ’­æ”¾å™¨æ’­æ”¾ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>å®šä½è§£å¯†ä»£ç </strong>: è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚æ•°æ®è§£å¯†é€»è¾‘é€šå¸¸åœ¨ Native å±‚ï¼ˆ<code>.so</code> æ–‡ä»¶ï¼‰ä»¥æé«˜æ€§èƒ½å’Œé€†å‘éš¾åº¦ã€‚</li>
</ol>
<ul>
<li><p><strong>å…³é”®è¯æœç´¢</strong>: åœ¨ IDA Pro æˆ– Ghidra ä¸­æ‰“å¼€ç›¸å…³çš„ <code>.so</code> æ–‡ä»¶ï¼Œæœç´¢ <code>aes</code>, <code>cbc</code>, <code>decrypt</code>, <code>RC4</code> ç­‰åŠ å¯†ç®—æ³•ç›¸å…³çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><strong>JNI å…¥å£</strong>: ä» Java å±‚è°ƒç”¨ Native ä»£ç éœ€è¦é€šè¿‡ JNI (Java Native Interface)ã€‚åœ¨ Java ä»£ç ä¸­å¯»æ‰¾ <code>native</code> å…³é”®å­—å£°æ˜çš„å‡½æ•°ï¼Œä¾‹å¦‚ <code>private native byte[] decryptAudio(byte[] encryptedData, int core);</code>ã€‚è¿™ä¸ªå‡½æ•°åå°±æ˜¯ä½ åœ¨ <code>.so</code> æ–‡ä»¶ä¸­è¦æ‰¾çš„ç¬¦å·ã€‚</p>
</li>
<li><p><strong>Hook Native å‡½æ•°</strong>: ä¸€æ—¦å®šä½åˆ° JNI å‡½æ•°ï¼ˆå¦‚ <code>Java_com_example_music_player_NativeDecoder_decryptAudio</code>ï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨ Frida è¿›è¡Œ Hookï¼Œè§‚å¯Ÿå…¶è¾“å…¥å’Œè¾“å‡ºã€‚</p>
</li>
</ul>
<pre><code class="language-javascript">Interceptor.attach(
  Module.findExportByName(
    &quot;libaudiodecrypt.so&quot;,
    &quot;Java_com_example_music_player_NativeDecoder_decryptAudio&quot;
  ),
  {
    onEnter: function (args) {
      // args[0] is JNIEnv*, args[1] is jclass, args[2] is encrypted data jbyteArray
      console.log(&quot;Entering decryptAudio...&quot;);
      // Can save encrypted data for subsequent offline analysis
      this.encryptedBuffer = args[2];
    },
    onLeave: function (retval) {
      // retval is the decrypted jbyteArray
      console.log(&quot;Leaving decryptAudio. Decrypted data pointer: &quot; + retval);
      // Here you can read the memory pointed to by retval to get the decrypted PCM or MP3 data
    },
  }
);
</code></pre>
<p>é€šè¿‡åŠ¨æ€åˆ†æï¼Œä½ å·²ç»èƒ½å¤Ÿè·å–åˆ°è§£å¯†åçš„éŸ³é¢‘æ•°æ®ã€‚ä½†å¦‚æœæƒ³å¼€å‘ä¸€ä¸ªç‹¬ç«‹çš„ã€ç¦»çº¿çš„æ ¼å¼è½¬æ¢å·¥å…·ï¼Œå°±éœ€è¦å½»åº•ç†è§£å…¶åŠ å¯†æ–¹æ¡ˆã€‚</p>
<ul>
<li><p><strong>é™æ€åˆ†æ Native ä»£ç </strong>: åœ¨ Ghidra/IDA ä¸­ä»”ç»†åˆ†æ <code>decryptAudio</code> å‡½æ•°çš„é€»è¾‘ã€‚å®ƒå¯èƒ½åŒ…å«ï¼š</p>
</li>
<li><p><strong>å…ƒæ•°æ®è§£æ</strong>: ä»åŠ å¯†æ–‡ä»¶å¤´éƒ¨è¯»å–æ­Œæ›² IDã€ä¸“è¾‘å°é¢ã€æ¯”ç‰¹ç‡ç­‰ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>å¯†é’¥æ´¾ç”Ÿ</strong>: ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ Core Key å’Œä»æ–‡ä»¶å…ƒæ•°æ®ä¸­æå–çš„ Nonce æ¥æ´¾ç”Ÿå‡ºæ¯ä¸ªæ–‡ä»¶å”¯ä¸€çš„ AES Keyã€‚</p>
</li>
<li><p><strong>è§£å¯†å¾ªç¯</strong>: å¾ªç¯è¯»å–åŠ å¯†çš„éŸ³é¢‘å¸§ï¼Œä½¿ç”¨ AES æˆ–å…¶ä»–ç®—æ³•è¿›è¡Œè§£å¯†ã€‚</p>
</li>
<li><p><strong>ä»£ç å®ç°</strong>: ä½¿ç”¨ Python çš„ <code>cryptography</code> ç­‰åº“ï¼Œå°†ä½ åœ¨ Native ä»£ç ä¸­çœ‹åˆ°çš„é€»è¾‘é‡æ–°å®ç°ä¸€éã€‚æœ€ç»ˆï¼Œä½ å°±èƒ½å¼€å‘å‡ºä¸€ä¸ªå¯ä»¥å°† <code>.ncm</code> æ‰¹é‡è½¬æ¢ä¸º <code>.flac</code> çš„å·¥å…·ã€‚</p>
</li>
</ul>
<hr />
<h2>ä¸»æµå¹³å°åŠ å¯†æ–¹æ¡ˆå®ä¾‹</h2>
<p>è™½ç„¶é€šç”¨çš„åˆ†ææ€è·¯æ˜¯ä¸€è‡´çš„ï¼Œä½†ä¸åŒå¹³å°çš„å…·ä½“å®ç°ç»†èŠ‚å„ä¸ç›¸åŒã€‚äº†è§£è¿™äº›ç‰¹å¾æœ‰åŠ©äºæ›´å¿«åœ°å®šä½é—®é¢˜ã€‚</p>
<h3>ç½‘æ˜“äº‘éŸ³ä¹ (<code>.ncm</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.ncm</code> (Netease Cloud Music)</p>
</li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>: é‡‡ç”¨ <strong>AES + RC4</strong> çš„æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<ol>
<li><strong>å…ƒæ•°æ® (Meta)</strong>: æ–‡ä»¶ä¸­åŒ…å«ä¸€å—åŠ å¯†çš„å…ƒæ•°æ®åŒºåŸŸï¼Œå…¶ä¸­å«æœ‰æ­Œæ›²åã€ä¸“è¾‘å°é¢ã€AES Key ç­‰ä¿¡æ¯ã€‚è¿™å—åŒºåŸŸæœ¬èº«ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ Meta Key è¿›è¡Œ AES-ECB è§£å¯†ã€‚</li>
<li><strong>éŸ³é¢‘æ•°æ® (Audio)</strong>: éŸ³é¢‘å¸§æ•°æ®ä½¿ç”¨ AES-ECB åŠ å¯†ã€‚è§£å¯†æ‰€éœ€çš„ AES Key å°±å­˜åœ¨äºä¸Šä¸€æ­¥è§£å¯†åçš„å…ƒæ•°æ®ä¸­ã€‚ç„¶è€Œï¼Œæœ€ç»ˆçš„è§£å¯†å¯†é’¥æµæ˜¯é€šè¿‡ä¸€ä¸ªç±»ä¼¼ RC4-KSA çš„ç®—æ³•ï¼ŒåŸºäºè¿™ä¸ª AES Key ç”Ÿæˆçš„ã€‚</li>
</ol>
<ul>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
</li>
<li><p>åœ¨ SO åº“ä¸­æœç´¢å­—ç¬¦ä¸² <code>ncm</code>, <code>core</code>, <code>meta</code>, <code>AES</code>, <code>RC4</code>ã€‚</p>
</li>
<li><p>å…¶è§£å¯†é€»è¾‘é€šå¸¸è¢«å°è£…åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªä¸“é—¨çš„ Native å‡½æ•°ä¸­ã€‚</p>
</li>
</ul>
<h3>QQ éŸ³ä¹ (<code>.qmcflac</code>, <code>.mflac</code>, <code>.qmc0</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.qmcflac</code>, <code>.qmc0</code>, <code>.qmc3</code>, <code>.mflac</code> ç­‰ã€‚</p>
</li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>: <strong>æœªä½¿ç”¨æ ‡å‡†åŠ å¯†ç®—æ³•</strong>ï¼Œè€Œæ˜¯ä¸€å¥—è‡ªå®šä¹‰çš„å­—èŠ‚<strong>ç½®ä¹± (Scramble)</strong> æ–¹æ¡ˆã€‚</p>
</li>
<li><p>å…¶æ ¸å¿ƒæ˜¯ä¾èµ–ä¸€ä¸ªå·¨å¤§çš„<strong>é™æ€æ˜ å°„è¡¨ (Seed Map)</strong>ï¼Œè¿™ä¸ªè¡¨ç¡¬ç¼–ç åœ¨ SO æ–‡ä»¶ä¸­ã€‚</p>
</li>
<li><p>è§£å¯†æ—¶ï¼Œæ ¹æ®å½“å‰å­—èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ï¼Œé€šè¿‡ä¸€ä¸ªå¤æ‚çš„å…¬å¼è®¡ç®—å‡ºåœ¨æ˜ å°„è¡¨ä¸­çš„ç´¢å¼•ï¼Œç„¶åå–å‡ºè¡¨ä¸­çš„å€¼ä¸åŠ å¯†å­—èŠ‚è¿›è¡Œè¿ç®—ï¼ˆé€šå¸¸æ˜¯å¼‚æˆ–ï¼‰ã€‚</p>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
</li>
<li><p>ç”±äºæ²¡æœ‰ä½¿ç”¨æ ‡å‡†ç®—æ³•ï¼Œæœç´¢åŠ å¯†å…³é”®è¯æ˜¯æ— æ•ˆçš„ã€‚</p>
</li>
<li><p>é€†å‘çš„å…³é”®æ˜¯åœ¨ SO æ–‡ä»¶ä¸­<strong>æ‰¾åˆ°é‚£ä¸ªå·¨å¤§çš„é™æ€æ•°ç»„ï¼ˆæ˜ å°„è¡¨ï¼‰</strong>ã€‚</p>
</li>
<li><p>å®šä½ä¸€ä¸ªç´§å‡‘çš„å¾ªç¯ï¼Œè¯¥å¾ªç¯ä½“å†…éƒ¨åŒ…å«äº†å¤æ‚çš„åç§»é‡è®¡ç®—å’ŒæŸ¥è¡¨æ“ä½œã€‚</p>
</li>
</ul>
<h3>é…·ç‹—éŸ³ä¹ (<code>.kgm</code>, <code>.vpr</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.kgm</code> (Kugou Music), <code>.vpr</code>ã€‚</p>
</li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>: åŒæ ·æ˜¯<strong>è‡ªå®šä¹‰çš„ç½®ä¹±ç®—æ³•</strong>ï¼Œä¸ QQ éŸ³ä¹æ€è·¯ç›¸ä¼¼ï¼Œä½†å®ç°ä¸åŒã€‚</p>
</li>
<li><p>ä¾èµ–å¤šä¸ªé™æ€è¡¨ï¼ˆé€šå¸¸åœ¨å¼€æºé¡¹ç›®ä¸­è¢«ç§°ä¸º <code>table1</code>, <code>table2</code>ï¼‰ã€‚</p>
</li>
<li><p>æ–‡ä»¶å¤´åŒ…å«äº†è§£å¯†æ‰€éœ€çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚å¯†é’¥é•¿åº¦ç­‰ã€‚è§£å¯†å¯†é’¥ç”±æ–‡ä»¶å¤´ä¿¡æ¯å’Œé™æ€è¡¨å…±åŒæ´¾ç”Ÿã€‚</p>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
</li>
<li><p>åˆ†ææ–‡ä»¶å¤´çš„è§£æé€»è¾‘ã€‚</p>
</li>
<li><p>å®šä½å¤šä¸ªé™æ€è¡¨ï¼Œå¹¶è¿˜åŸå…¶æŸ¥è¡¨å’Œå¯†é’¥ç”Ÿæˆçš„ç®—æ³•ã€‚</p>
</li>
</ul>
<h3>é…·æˆ‘éŸ³ä¹ (<code>.kwm</code>)</h3>
<ul>
<li><p><strong>æ–‡ä»¶æ ¼å¼</strong>: <code>.kwm</code> (Kuwo Music)ã€‚</p>
</li>
<li><p><strong>åŠ å¯†ç»†èŠ‚</strong>: é‡‡ç”¨ç›¸å¯¹ç®€å•çš„ <strong>XOR å¼‚æˆ–åŠ å¯†</strong>ã€‚</p>
</li>
<li><p>è§£å¯†å¯†é’¥ç”±ä¸€ä¸ª<strong>ç¡¬ç¼–ç åœ¨ SO ä¸­çš„é™æ€å¯†é’¥ (Base Key)</strong> ä¸è¯¥æ­Œæ›²çš„<strong>èµ„æº ID (<code>rid</code>)</strong> è¿›è¡Œè¿ç®—åå¾—å‡ºã€‚<code>rid</code> æ˜¯ä¸€ä¸ª uin64_t ç±»å‹çš„æ•°å­—ã€‚</p>
</li>
<li><p>å¾—åˆ°æœ€ç»ˆå¯†é’¥åï¼Œå¯¹åŠ å¯†çš„éŸ³é¢‘æ•°æ®è¿›è¡Œé€å­—èŠ‚å¼‚æˆ–å³å¯å®Œæˆè§£å¯†ã€‚</p>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
</li>
<li><p>æœç´¢å…³é”®è¯ <code>rid</code>, <code>kwm</code>ã€‚</p>
</li>
<li><p>å®šä½ä¸€ä¸ªé€»è¾‘ç›¸å¯¹ç®€å•çš„å‡½æ•°ï¼Œå…¶åŒ…å«äº†è·å– <code>rid</code>ã€ä¸é™æ€å¯†é’¥è¿›è¡Œè¿ç®—ã€ç„¶åå¾ªç¯å¼‚æˆ–çš„è¿‡ç¨‹ã€‚</p>
</li>
</ul>
<h2>æ€»ç»“</h2>
<p>è¿™ä¸ªæ¡ˆä¾‹å±•ç¤ºäº†ä»å®¢æˆ·ç«¯åŠŸèƒ½ç»•è¿‡ï¼Œåˆ°ç½‘ç»œåè®®åˆ†æï¼Œå†åˆ°æ ¸å¿ƒåŠ å¯†ç®—æ³•é€†å‘çš„å®Œæ•´æµç¨‹ã€‚å®ƒç»“åˆäº† Java å±‚çš„ Hook å’Œ Native å±‚çš„åˆ†æï¼Œæ˜¯ç§»åŠ¨ç«¯é€†å‘ä¸­éå¸¸å…·æœ‰ä»£è¡¨æ€§çš„åœºæ™¯ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-52">
                                                <h2>52. Case: Social Media & Anti Bot</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šç¤¾äº¤åª’ä½“ App ä¸é£æ§</h1>
<h2>ç¤¾äº¤åª’ä½“ Appï¼ˆå¦‚ Xã€Instagramã€TikTokï¼‰æ˜¯çˆ¬è™«å’Œè‡ªåŠ¨åŒ–å·¥å…·æœ€å¸¸å…‰é¡¾çš„åœ°æ–¹ã€‚å› æ­¤ï¼Œè¿™äº› App çš„å¼€å‘è€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½éƒ¨ç½²äº†æå…¶å¤æ‚çš„å®‰å…¨ä¸é£æ§ç³»ç»Ÿï¼Œä»¥ä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œå¹³å°ç”Ÿæ€ã€‚æœ¬æ¡ˆä¾‹å°†èšç„¦äºè¿™äº› App ä¸­å¸¸è§çš„é£æ§å¯¹æŠ—æŠ€æœ¯ã€‚</h2>
<h2>æ ¸å¿ƒåˆ†æç›®æ ‡</h2>
<ol>
<li><strong>API ç­¾åç®—æ³•é€†å‘</strong>: å‡ ä¹æ‰€æœ‰ç¤¾äº¤ App çš„æ ¸å¿ƒ API è¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç­¾åå‚æ•°ï¼ˆå¦‚ <code>X-Signature</code>, <code>X-Gorgon</code>ï¼‰ã€‚è¿™äº›ç­¾åæ˜¯è¯·æ±‚åˆæ³•æ€§çš„è¯æ˜ï¼Œä¹Ÿæ˜¯é€†å‘çš„ä¸»è¦ç›®æ ‡ã€‚</li>
<li><strong>è®¾å¤‡æŒ‡çº¹åˆ†æ</strong>: ç†è§£ App å¦‚ä½•æ”¶é›†è®¾å¤‡ä¿¡æ¯ï¼ˆç¡¬ä»¶ã€è½¯ä»¶ã€ç½‘ç»œç¯å¢ƒç­‰ï¼‰æ¥ç”Ÿæˆå”¯ä¸€çš„è®¾å¤‡ ID (<code>device_id</code>)ï¼Œå¹¶ç”¨äºé£æ§å†³ç­–ã€‚</li>
<li><strong>ä¸šåŠ¡é£æ§é€»è¾‘åˆ†æ</strong>: åˆ†æ App åœ¨å…³é”®ä¸šåŠ¡ç‚¹ï¼ˆå¦‚æ³¨å†Œã€ç™»å½•ã€ç‚¹èµã€è¯„è®ºï¼‰çš„é£æ§ç­–ç•¥ï¼Œä¾‹å¦‚äººæœºéªŒè¯ï¼ˆæ»‘å—éªŒè¯ç ã€ç‚¹å›¾éªŒè¯ç­‰ï¼‰ã€‚</li>
</ol>
<hr />
<h2>æ¡ˆä¾‹ï¼šåˆ†æä¸€ä¸ªå…¸å‹ç¤¾äº¤ App çš„ API ç­¾åæµç¨‹</h2>
<h2># ç¬¬ 1 æ­¥ï¼šå®šä½ç­¾åå‚æ•°</h2>
<p><strong>ç›®æ ‡</strong>: è¯†åˆ«å‡º API è¯·æ±‚ä¸­å“ªä¸ªå‚æ•°æ˜¯ç­¾åã€‚</p>
<ol>
<li><strong>ç½‘ç»œæŠ“åŒ…</strong>: ä½¿ç”¨ Charles æˆ– Mitmproxy æ‹¦æˆª App çš„ç½‘ç»œæµé‡ã€‚åˆ·æ–°é¦–é¡µåŠ¨æ€ï¼ˆtimelineï¼‰çš„è¯·æ±‚æ˜¯æœ€å¥½çš„åˆ†æå¯¹è±¡ï¼Œå› ä¸ºå®ƒé€šå¸¸åŒ…å«äº†æœ€å¤æ‚çš„ç­¾åã€‚</li>
<li><strong>è§‚å¯Ÿè¯·æ±‚</strong>: æŸ¥çœ‹ä¸€ä¸ªå…¸å‹çš„ API è¯·æ±‚ï¼Œä¾‹å¦‚ <code>/api/v2/feed</code>ã€‚ä½ ä¼šæ³¨æ„åˆ°å…¶ URL å‚æ•°æˆ–è¯·æ±‚å¤´ (Headers) ä¸­å­˜åœ¨ä¸€äº›çœ‹èµ·æ¥åƒå“ˆå¸Œå€¼çš„ã€æ— æ˜æ˜¾è¯­ä¹‰çš„å‚æ•°ã€‚</li>
</ol>
<ul>
<li><p><strong>URL å‚æ•°</strong>: <code>...&amp;mas=01&amp;as=a1...&amp;ts=166...&amp;ssmix=a...</code></p>
</li>
<li><p><strong>è¯·æ±‚å¤´</strong>: <code>X-Gorgon: 0404...</code>, <code>X-Khronos: 166...</code></p>
</li>
<li><p><strong>URL å‚æ•°</strong>: <code>...&amp;mas=01&amp;as=a1...&amp;ts=166...&amp;ssmix=a...</code></p>
</li>
<li><p><strong>è¯·æ±‚å¤´</strong>: <code>X-Gorgon: 0404...</code>, <code>X-Khronos: 166...</code></p>
</li>
</ul>
<ol start="3">
<li><strong>å‚æ•°ç­›é€‰</strong>: é€šè¿‡å¤šæ¬¡é‡å¤è¯·æ±‚ï¼Œæ¯”è¾ƒå‚æ•°çš„å˜åŒ–è§„å¾‹ã€‚</li>
</ol>
<ul>
<li><p><strong>ä¸å˜çš„</strong>: <code>device_id</code>, <code>os_version</code> ç­‰ï¼Œé€šå¸¸æ˜¯è®¾å¤‡æŒ‡çº¹çš„ä¸€éƒ¨åˆ†ã€‚</p>
</li>
<li><p><strong>éšæ—¶é—´å˜åŒ–çš„</strong>: <code>ts</code>, <code>X-Khronos</code> ç­‰ï¼Œé€šå¸¸æ˜¯æ—¶é—´æˆ³ã€‚</p>
</li>
<li><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½éšæœºå˜åŒ–çš„</strong>: <code>mas</code>, <code>as</code>, <code>X-Gorgon</code> ç­‰ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ ¸å¿ƒç­¾åã€‚</p>
</li>
<li><p><strong>ä¸å˜çš„</strong>: <code>device_id</code>, <code>os_version</code> ç­‰ï¼Œé€šå¸¸æ˜¯è®¾å¤‡æŒ‡çº¹çš„ä¸€éƒ¨åˆ†ã€‚</p>
</li>
<li><p><strong>éšæ—¶é—´å˜åŒ–çš„</strong>: <code>ts</code>, <code>X-Khronos</code> ç­‰ï¼Œé€šå¸¸æ˜¯æ—¶é—´æˆ³ã€‚</p>
</li>
<li><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½éšæœºå˜åŒ–çš„</strong>: <code>mas</code>, <code>as</code>, <code>X-Gorgon</code> ç­‰ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ ¸å¿ƒç­¾åã€‚</p>
</li>
</ul>
<h2># ç¬¬ 2 æ­¥ï¼šå®šä½ç­¾åç”Ÿæˆä»£ç </h2>
<p><strong>ç›®æ ‡</strong>: æ‰¾åˆ°åœ¨å®¢æˆ·ç«¯ç”Ÿæˆè¿™äº›ç­¾åçš„ä»£ç ã€‚è¿™æ˜¯æ•´ä¸ªæµç¨‹ä¸­æœ€å…³é”®ã€ä¹Ÿæœ€å›°éš¾çš„ä¸€æ­¥ã€‚</p>
<ol>
<li><strong>å…¨å±€æœç´¢</strong>: åœ¨ <code>jadx-gui</code> ä¸­ï¼Œå…¨å±€æœç´¢ä¸Šä¸€æ­¥è¯†åˆ«å‡ºçš„å‚æ•°åï¼Œå¦‚ <code>X-Gorgon</code>ã€‚å¦‚æœè¿æ°”å¥½ï¼Œä½ èƒ½ç›´æ¥å®šä½åˆ°æ„å»ºç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ã€‚</li>
<li><strong>Hook å¤§æ³•</strong>: å¦‚æœæœç´¢æ— æœï¼ˆé€šå¸¸æ˜¯å› ä¸ºå‚æ•°ååœ¨ä»£ç ä¸­è¢«åŠ å¯†æˆ–æ··æ·†äº†ï¼‰ï¼ŒFrida Hook å°†æ˜¯ä½ çš„ä¸»åŠ›æ­¦å™¨ã€‚</li>
</ol>
<ul>
<li><strong>Hook ç½‘ç»œåº“</strong>: ä»ç½‘ç»œè¯·æ±‚çš„æºå¤´å…¥æ‰‹ã€‚Hook <code>OkHttp</code> çš„ <code>Request.Builder.addHeader</code> æˆ– <code>url()</code> æ–¹æ³•ï¼Œæ‰“å°å‡ºè°ƒç”¨æ ˆã€‚<pre><code class="language-javascript">Java.perform(function () {
  var Builder = Java.use(&quot;okhttp3.Request$Builder&quot;);
  Builder.addHeader.implementation = function (name, value) {
    if (name === &quot;X-Gorgon&quot;) {
      // Found it! Print call stack
      console.log(&quot;Found X-Gorgon being added: &quot; + value);
      console.log(
        Java.use(&quot;android.util.Log&quot;).getStackTraceString(
          Java.use(&quot;java.lang.Exception&quot;).$new()
        )
      );
    }
    return this.addHeader(name, value);
  };
});
</code></pre>
</li>
</ul>
<pre><code>3. **é™æ€åˆ†æç­¾åå‡½æ•°**: å®šä½åˆ°å…·ä½“çš„ç­¾åå‡½æ•°åï¼ˆä¾‹å¦‚ï¼Œ`SignHelper.getSign(params)`ï¼‰ï¼Œåœ¨ Ghidra æˆ– IDA ä¸­ä»”ç»†åˆ†æå…¶é€»è¾‘ã€‚

* **è¾“å…¥**: å®ƒçš„è¾“å…¥é€šå¸¸æ˜¯ä¸€ä¸ª `Map` æˆ– `List`ï¼ŒåŒ…å«äº†æ‰€æœ‰è¦å‚ä¸ç­¾åçš„ä¸šåŠ¡å‚æ•°ï¼ˆå¦‚ `user_id`ï¼‰å’Œè®¾å¤‡æŒ‡çº¹å‚æ•°ã€‚

* **é€»è¾‘**: å‡½æ•°å†…éƒ¨é€»è¾‘é€šå¸¸æ˜¯ï¼š
1. å¯¹æ‰€æœ‰å‚æ•°æŒ‰ key è¿›è¡Œå­—å…¸åºæ’åºã€‚
2. å°†æ’åºåçš„ key-value å¯¹æ‹¼æ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ã€‚
3. å°†å›ºå®šçš„ç›ï¼ˆsaltï¼Œå¯èƒ½ç¡¬ç¼–ç æˆ–ä» Native è·å–ï¼‰æ‹¼æ¥åˆ°å­—ç¬¦ä¸²çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚
4. å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œã€‚
5. æœ‰æ—¶è¿˜ä¼šè¿›è¡Œé¢å¤–çš„å˜æ¢ï¼Œå¦‚ Base64 ç¼–ç æˆ–è‡ªå®šä¹‰çš„å­—èŠ‚æ“ä½œã€‚

* **Native æ··æ·†**: è¶Šæ¥è¶Šå¤šçš„ App å°†æ ¸å¿ƒçš„ç­¾åç®—æ³•ï¼ˆç‰¹åˆ«æ˜¯ç›ï¼‰æ”¾åˆ° `.so` æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ OLLVM æˆ– VMP ç­‰æŠ€æœ¯è¿›è¡Œæ··æ·†ï¼Œä»¥å¯¹æŠ—é™æ€åˆ†æã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ç»“åˆåŠ¨æ€è°ƒè¯•æ¥ä¸€æ­¥æ­¥è·Ÿè¸ªå…¶æ‰§è¡Œæµç¨‹ã€‚


* **è¾“å…¥**: å®ƒçš„è¾“å…¥é€šå¸¸æ˜¯ä¸€ä¸ª `Map` æˆ– `List`ï¼ŒåŒ…å«äº†æ‰€æœ‰è¦å‚ä¸ç­¾åçš„ä¸šåŠ¡å‚æ•°ï¼ˆå¦‚ `user_id`ï¼‰å’Œè®¾å¤‡æŒ‡çº¹å‚æ•°ã€‚


* **é€»è¾‘**: å‡½æ•°å†…éƒ¨é€»è¾‘é€šå¸¸æ˜¯ï¼š
1. å¯¹æ‰€æœ‰å‚æ•°æŒ‰ key è¿›è¡Œå­—å…¸åºæ’åºã€‚
2. å°†æ’åºåçš„ key-value å¯¹æ‹¼æ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ã€‚
3. å°†å›ºå®šçš„ç›ï¼ˆsaltï¼Œå¯èƒ½ç¡¬ç¼–ç æˆ–ä» Native è·å–ï¼‰æ‹¼æ¥åˆ°å­—ç¬¦ä¸²çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚
4. å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œã€‚
5. æœ‰æ—¶è¿˜ä¼šè¿›è¡Œé¢å¤–çš„å˜æ¢ï¼Œå¦‚ Base64 ç¼–ç æˆ–è‡ªå®šä¹‰çš„å­—èŠ‚æ“ä½œã€‚

1. å¯¹æ‰€æœ‰å‚æ•°æŒ‰ key è¿›è¡Œå­—å…¸åºæ’åºã€‚
2. å°†æ’åºåçš„ key-value å¯¹æ‹¼æ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ã€‚
3. å°†å›ºå®šçš„ç›ï¼ˆsaltï¼Œå¯èƒ½ç¡¬ç¼–ç æˆ–ä» Native è·å–ï¼‰æ‹¼æ¥åˆ°å­—ç¬¦ä¸²çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚
4. å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œã€‚
5. æœ‰æ—¶è¿˜ä¼šè¿›è¡Œé¢å¤–çš„å˜æ¢ï¼Œå¦‚ Base64 ç¼–ç æˆ–è‡ªå®šä¹‰çš„å­—èŠ‚æ“ä½œã€‚


* **Native æ··æ·†**: è¶Šæ¥è¶Šå¤šçš„ App å°†æ ¸å¿ƒçš„ç­¾åç®—æ³•ï¼ˆç‰¹åˆ«æ˜¯ç›ï¼‰æ”¾åˆ° `.so` æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ OLLVM æˆ– VMP ç­‰æŠ€æœ¯è¿›è¡Œæ··æ·†ï¼Œä»¥å¯¹æŠ—é™æ€åˆ†æã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ç»“åˆåŠ¨æ€è°ƒè¯•æ¥ä¸€æ­¥æ­¥è·Ÿè¸ªå…¶æ‰§è¡Œæµç¨‹ã€‚


## # ç¬¬ 3 æ­¥ï¼šæ¨¡æ‹Ÿç­¾åä¸è‡ªåŠ¨åŒ–

* *ç›®æ ‡**: åœ¨ä½ è‡ªå·±çš„ Python æˆ–å…¶ä»–è¯­è¨€è„šæœ¬ä¸­ï¼Œé‡æ–°å®ç°ç­¾åç®—æ³•ï¼Œä»è€Œå¯ä»¥è„±ç¦» App ç‹¬ç«‹å‘èµ·åˆæ³•çš„ API è¯·æ±‚ã€‚

1. **ä»£ç å¤ç°**: æ ¹æ®é™æ€åˆ†æçš„ç»“æœï¼Œç”¨ Python å®Œæ•´åœ°å¤ç°æ•´ä¸ªç­¾åæµç¨‹ã€‚æ¯ä¸€ä¸ªç»†èŠ‚éƒ½è¦ç²¾ç¡®åŒ¹é…ï¼ŒåŒ…æ‹¬å‚æ•°çš„æ’åºã€æ‹¼æ¥æ–¹å¼ã€å“ˆå¸Œç®—æ³•ç­‰ã€‚
2. **è·å–è®¾å¤‡å‚æ•°**: ç­¾åä¾èµ–çš„è®¾å¤‡æŒ‡çº¹å‚æ•°ï¼ˆ`device_id`, `install_id` ç­‰ï¼‰é€šå¸¸åœ¨ App é¦–æ¬¡å¯åŠ¨æ—¶ç”Ÿæˆå¹¶å­˜å‚¨åœ¨æœ¬åœ°ã€‚ä½ éœ€è¦ Hook ç›¸å…³çš„å‡½æ•°æ¥è·å–ä¸€å¥—åˆæ³•çš„è®¾å¤‡å‚æ•°ï¼Œå¹¶åœ¨ä½ çš„è„šæœ¬ä¸­ä½¿ç”¨å®ƒä»¬ã€‚
3. **é£æ§å¯¹æŠ—**:
* **æ»‘å—éªŒè¯ç **: å½“æœåŠ¡å™¨æ£€æµ‹åˆ°ä½ çš„è¯·æ±‚å¼‚å¸¸æ—¶ï¼ˆä¾‹å¦‚ï¼ŒIP åœ°å€å¼‚å¸¸ã€è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªéœ€è¦è¿›è¡ŒäººæœºéªŒè¯çš„å“åº”ã€‚ä½ éœ€è¦åˆ†æéªŒè¯ç çš„é€»è¾‘ï¼Œè¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹ä¸€ä¸ª `JavaScript` æ–‡ä»¶çš„é€†å‘ï¼Œåˆ†æå…¶æ»‘å—è½¨è¿¹åŠ å¯†ç®—æ³•ã€‚

* **è¯·æ±‚é¢‘ç‡**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„è¡Œä¸ºï¼Œåœ¨è¯·æ±‚ä¹‹é—´åŠ å…¥éšæœºçš„å»¶è¿Ÿã€‚

* **ä»£ç† IP**: ä½¿ç”¨é«˜è´¨é‡çš„ä»£ç† IP æ± æ¥é¿å…å•ä¸ª IP è¢«å°ç¦ã€‚

* **æ»‘å—éªŒè¯ç **: å½“æœåŠ¡å™¨æ£€æµ‹åˆ°ä½ çš„è¯·æ±‚å¼‚å¸¸æ—¶ï¼ˆä¾‹å¦‚ï¼ŒIP åœ°å€å¼‚å¸¸ã€è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªéœ€è¦è¿›è¡ŒäººæœºéªŒè¯çš„å“åº”ã€‚ä½ éœ€è¦åˆ†æéªŒè¯ç çš„é€»è¾‘ï¼Œè¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹ä¸€ä¸ª `JavaScript` æ–‡ä»¶çš„é€†å‘ï¼Œåˆ†æå…¶æ»‘å—è½¨è¿¹åŠ å¯†ç®—æ³•ã€‚


* **è¯·æ±‚é¢‘ç‡**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„è¡Œä¸ºï¼Œåœ¨è¯·æ±‚ä¹‹é—´åŠ å…¥éšæœºçš„å»¶è¿Ÿã€‚


* **ä»£ç† IP**: ä½¿ç”¨é«˜è´¨é‡çš„ä»£ç† IP æ± æ¥é¿å…å•ä¸ª IP è¢«å°ç¦ã€‚
---
## æ€»ç»“

ç¤¾äº¤åª’ä½“ App çš„é€†å‘æ˜¯å…¸å‹çš„&quot;æ•°æ®åœ¨å®¢æˆ·ç«¯ï¼Œä½†ç”±æœåŠ¡å™¨è§„åˆ™æ ¡éªŒ&quot;çš„åœºæ™¯ã€‚å…¶æ ¸å¿ƒæ˜¯å¯¹æŠ—ï¼Œè€Œä¸åªæ˜¯è§£å¯†ã€‚

* **ç­¾åæ˜¯æ ¸å¿ƒ**: é€†å‘ç­¾åç®—æ³•æ˜¯æ‰€æœ‰å·¥ä½œçš„åŸºç¡€ã€‚


* **åŠ¨é™ç»“åˆ**: éœ€è¦åå¤åœ¨é™æ€åˆ†æï¼ˆGhidra/IDAï¼‰å’ŒåŠ¨æ€éªŒè¯ï¼ˆFridaï¼‰ä¹‹é—´åˆ‡æ¢ã€‚


* **é£æ§æ˜¯æŒç»­çš„æ–—äº‰**: å³ä½¿ä½ æˆåŠŸé€†å‘äº†ç­¾åï¼ŒæœåŠ¡å™¨ç«¯çš„é£æ§ç­–ç•¥ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚è¿™æ˜¯ä¸€ä¸ªé•¿æœŸçš„ã€åŠ¨æ€çš„æ”»é˜²è¿‡ç¨‹ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-53">
                                                <h2>53. Case: App Encryption</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šä¸»æµ App çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ</h1>
<p>å¯¹ä¸»æµ App çš„ API åŠ å¯†æœºåˆ¶è¿›è¡Œé€†å‘åˆ†æï¼Œæ˜¯æ£€éªŒå’Œåº”ç”¨é€†å‘å·¥ç¨‹ç»¼åˆèƒ½åŠ›çš„æœ€ä½³å®æˆ˜ã€‚æœ¬æ¡ˆä¾‹ç ”ç©¶å°†ä»¥å¸¸è§çš„ç”µå•†å’Œç¤¾äº¤ç±» App ä¸ºä¾‹ï¼Œå‰–æå…¶ç½‘ç»œè¯·æ±‚ä¸­æ ¸å¿ƒåŠ å¯†å­—æ®µå’Œç­¾åçš„ç”Ÿæˆé€»è¾‘ï¼Œå±•ç¤ºç†è®ºçŸ¥è¯†åœ¨å®æˆ˜ä¸­çš„åº”ç”¨ã€‚</p>
<blockquote>
<p><strong>å…è´£å£°æ˜</strong>: æœ¬æ–‡å†…å®¹åŸºäºå…¬å¼€æŠ€æœ¯å’Œè¿‡å¾€åˆ†æç»éªŒçš„æ€»ç»“ï¼Œæ—¨åœ¨æŠ€æœ¯äº¤æµä¸å­¦ä¹ ã€‚å…·ä½“çš„åŠ å¯†å®ç°ä¼šé¢‘ç¹æ›´æ–°ï¼Œæœ¬æ–‡ä¸ä¿è¯ä¸çº¿ä¸Šæœ€æ–°ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚</p>
</blockquote>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6%E4%B8%BB%E6%B5%81-app-%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AD%BE%E5%90%8D%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90">æ¡ˆä¾‹ç ”ç©¶ï¼šä¸»æµ App çš„åŠ å¯†ç­¾åæœºåˆ¶è§£æ</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li>
<li><a href="#%E9%80%9A%E7%94%A8%E5%8A%A0%E5%AF%86%E4%B8%8E%E7%AD%BE%E5%90%8D%E6%A8%A1%E5%BC%8F">é€šç”¨åŠ å¯†ä¸ç­¾åæ¨¡å¼</a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-1%E7%94%B5%E5%95%86-app-%E7%B1%BB%E6%8B%BC%E5%A4%9A%E5%A4%9A%E6%A8%A1%E5%BC%8F">æ¡ˆä¾‹åˆ†æ 1ï¼šç”µå•† App (ç±»æ‹¼å¤šå¤šæ¨¡å¼)</a></li>
<li><a href="#-%E6%A0%B8%E5%BF%83%E9%A3%8E%E6%8E%A7%E5%AD%97%E6%AE%B5-anti_content"># æ ¸å¿ƒé£æ§å­—æ®µ (<code>anti_content</code>)</a></li>
<li><a href="#-api-%E8%AE%A4%E8%AF%81%E7%AD%BE%E5%90%8D-sign"># API è®¤è¯ç­¾å (<code>sign</code>)</a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-2%E7%A4%BE%E4%BA%A4-app-%E7%B1%BB%E5%B0%8F%E7%BA%A2%E4%B9%A6%E6%A8%A1%E5%BC%8F">æ¡ˆä¾‹åˆ†æ 2ï¼šç¤¾äº¤ App (ç±»å°çº¢ä¹¦æ¨¡å¼)</a></li>
<li><a href="#-%E5%A4%8D%E6%9D%82%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4%E7%AD%BE%E5%90%8D-x-sign"># å¤æ‚çš„è¯·æ±‚å¤´ç­¾å (<code>X-Sign</code>)</a></li>
<li><a href="#-%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E4%B8%8A%E6%8A%A5-x-deviceinfo"># è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥ (<code>X-DeviceInfo</code>)</a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-3%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E7%B3%BB-%E6%8A%96%E9%9F%B3tiktok">æ¡ˆä¾‹åˆ†æ 3ï¼šå­—èŠ‚è·³åŠ¨ç³» (æŠ–éŸ³/TikTok)</a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-4%E5%BF%AB%E6%89%8B">æ¡ˆä¾‹åˆ†æ 4ï¼šå¿«æ‰‹</a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-5%E7%BE%8E%E5%9B%A2">æ¡ˆä¾‹åˆ†æ 5ï¼šç¾å›¢</a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-6%E9%98%BF%E9%87%8C%E7%B3%BB-%E6%B7%98%E5%AE%9D%E6%94%AF%E4%BB%98%E5%AE%9D">æ¡ˆä¾‹åˆ†æ 6ï¼šé˜¿é‡Œç³» (æ·˜å®ã€æ”¯ä»˜å®)</a></li>
<li><a href="#%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E9%80%9A%E7%94%A8%E7%AD%96%E7%95%A5">é€†å‘åˆ†æé€šç”¨ç­–ç•¥</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E7%AD%96%E7%95%A5%E9%BB%91%E7%9B%92-rpc-%E8%B0%83%E7%94%A8%E8%AF%A6%E8%A7%A3">é«˜çº§ç­–ç•¥ï¼šé»‘ç›’ RPC è°ƒç”¨è¯¦è§£</a></li>
<li><a href="#-%E4%BB%80%E4%B9%88%E6%98%AF%E9%BB%91%E7%9B%92-rpc-%E8%B0%83%E7%94%A8"># ä»€ä¹ˆæ˜¯é»‘ç›’ RPC è°ƒç”¨ï¼Ÿ</a></li>
<li><a href="#-%E5%AE%9E%E7%8E%B0%E9%BB%91%E7%9B%92-rpc-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%AD%A5%E9%AA%A4"># å®ç°é»‘ç›’ RPC çš„æ ¸å¿ƒæ­¥éª¤</a><ul>
<li><a href="#-%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%AE%9A%E4%BD%8D%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0%E5%9C%B0%E5%9D%80-finding-the-function-pointer"># ç¬¬ä¸€æ­¥ï¼šå®šä½ç›®æ ‡å‡½æ•°åœ°å€ (Finding the Function Pointer)</a></li>
<li><a href="#-%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B-analyzing-the-prototype"># ç¬¬äºŒæ­¥ï¼šåˆ†æå‡½æ•°åŸå‹ (Analyzing the Prototype)</a></li>
<li><a href="#-%E7%AC%AC%E4%B8%89%E6%AD%A5%E6%9E%84%E5%BB%BA-rpc-%E6%9C%8D%E5%8A%A1%E7%AB%AF-frida-agent"># ç¬¬ä¸‰æ­¥ï¼šæ„å»º RPC æœåŠ¡ç«¯ (Frida Agent)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#clientpy">client.py</a></li>
<li><a href="#connect-to-frida-server-on-device">Connect to frida-server on device</a></li>
<li><a href="#attach-to-target-app-process">Attach to target App process</a></li>
<li><a href="#load-frida-agent-script">Load Frida Agent script</a></li>
<li><a href="#prepare-parameters">Prepare parameters</a></li>
<li><a href="#call-rpc-interface-like-calling-a-local-function">Call RPC interface like calling a local function</a></li>
<li><a href="#can-use-the-obtained-sign-to-construct-and-send-network-requests-here">Can use the obtained sign to construct and send network requests here</a></li>
<li><a href="#">...</a></li>
</ul>
<hr />
<h2>é€šç”¨åŠ å¯†ä¸ç­¾åæ¨¡å¼</h2>
<p>åœ¨åˆ†æå…·ä½“æ¡ˆä¾‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ç§è¡Œä¸šå†…é€šç”¨çš„ API ä¿æŠ¤æ¨¡å¼ï¼š</p>
<ul>
<li><p><strong>è¯·æ±‚ä½“åŠ å¯†</strong>ï¼šå¯¹æ•´ä¸ª POST Body è¿›è¡Œå¯¹ç§°ï¼ˆAESï¼‰æˆ–éå¯¹ç§°ï¼ˆRSAï¼‰åŠ å¯†ï¼Œä¿æŠ¤æ•°æ®å†…å®¹éšç§ã€‚</p>
</li>
<li><p><strong>å‚æ•°çº§åŠ å¯†</strong>ï¼šä»…å¯¹è¯·æ±‚ä¸­çš„ä¸ªåˆ«æ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç ã€æ‰‹æœºå·ï¼‰è¿›è¡ŒåŠ å¯†ã€‚</p>
</li>
<li><p><strong><code>sign</code> ç­¾åæœºåˆ¶</strong>ï¼š<strong>æœ€æ ¸å¿ƒã€æœ€æ™®éçš„æ¨¡å¼</strong>ã€‚é€šè¿‡å¯¹è¯·æ±‚å‚æ•°ã€æ—¶é—´æˆ³ã€éšæœºæ•°ç­‰è¿›è¡Œç»„åˆå’Œå“ˆå¸Œï¼Œç”Ÿæˆä¸€ä¸ªç­¾åå€¼ã€‚æœåŠ¡å™¨ç«¯ä¼šä»¥åŒæ ·çš„æ–¹å¼è®¡ç®—ç­¾åå¹¶è¿›è¡Œæ¯”å¯¹ï¼Œç”¨äºï¼š</p>
</li>
<li><p><strong>é˜²ç¯¡æ”¹</strong>ï¼šç¡®ä¿ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®æœªè¢«ä¿®æ”¹ã€‚</p>
</li>
<li><p><strong>é˜²é‡æ”¾</strong>ï¼šé€šè¿‡åŠ å…¥æ—¶é—´æˆ³æˆ– Nonceï¼Œè®©ç­¾åä¸€æ¬¡æœ‰æ•ˆã€‚</p>
</li>
<li><p><strong>èº«ä»½è®¤è¯</strong>ï¼šéªŒè¯è¯·æ±‚æ˜¯å¦ç”±åˆæ³•çš„å®¢æˆ·ç«¯å‘å‡ºã€‚</p>
</li>
</ul>
<h2>æ¡ˆä¾‹åˆ†æ 1ï¼šç”µå•† App (ç±»æ‹¼å¤šå¤šæ¨¡å¼)</h2>
<h2># æ ¸å¿ƒé£æ§å­—æ®µ (<code>anti_content</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: åœ¨å…¶ API è¯·æ±‚ä¸­ï¼Œç»å¸¸èƒ½çœ‹åˆ°ä¸€ä¸ªåä¸º <code>anti_content</code> çš„ã€å†…å®¹æé•¿çš„åŠ å¯†å­—æ®µã€‚</p>
</li>
<li><p><strong>æœ¬è´¨</strong>: å®ƒå¹¶éç®€å•çš„ API å‚æ•°ç­¾åï¼Œè€Œæ˜¯ä¸€ä¸ªç”±å®¢æˆ·ç«¯ SDK ç”Ÿæˆçš„ã€é«˜åº¦å¤æ‚çš„<strong>é£æ§æ•°æ®åŒ…</strong>ã€‚å®ƒæ›´ä¾§é‡äº<strong>è¯†åˆ«&quot;äºº&quot;ä¸&quot;æœºå™¨&quot;</strong>ï¼Œè€Œéè®¤è¯ API è°ƒç”¨æœ¬èº«ã€‚</p>
</li>
<li><p><strong>å¯èƒ½åŒ…å«çš„å†…å®¹</strong>:</p>
</li>
<li><p><strong>è®¾å¤‡æŒ‡çº¹</strong>: åŒ…å«ä¹‹å‰æ–‡æ¡£ä¸­æåˆ°çš„å‡ ä¹æ‰€æœ‰ç¡¬ä»¶ã€è½¯ä»¶å’Œç³»ç»Ÿç‰¹å¾ã€‚</p>
</li>
<li><p><strong>ç¯å¢ƒæ£€æµ‹</strong>: æ˜¯å¦ Rootã€æ˜¯å¦è¶Šç‹±ã€æ˜¯å¦ä½¿ç”¨äº† Hook æ¡†æ¶ (Frida/Xposed)ã€æ˜¯å¦åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œã€‚</p>
</li>
<li><p><strong>ä¼ æ„Ÿå™¨æ•°æ®</strong>: åœ¨ç‰¹å®šæ—¶é—´æ®µå†…é‡‡é›†çš„åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªæ•°æ®ï¼Œç”¨äºåˆ¤æ–­è®¾å¤‡æ˜¯å¦åœ¨æ­£å¸¸ç‰©ç†çŠ¶æ€ä¸‹ã€‚</p>
</li>
<li><p><strong>è¡Œä¸ºæ•°æ®</strong>ï¼šç”¨æˆ·çš„ç‚¹å‡»åæ ‡ã€æ»‘åŠ¨è½¨è¿¹ç­‰ã€‚</p>
</li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>: <code>anti_content</code> çš„ç”Ÿæˆé€»è¾‘é€šå¸¸è¢«å°è£…åœ¨é«˜åº¦æ··æ·†çš„åŸç”Ÿ SO åº“ä¸­ï¼Œå¹¶å¯èƒ½åŒ…å« <code>SVC</code> ç³»ç»Ÿè°ƒç”¨ç­‰ååˆ†ææŠ€æœ¯ã€‚å®Œæ•´å¤ç°å…¶ç®—æ³•çš„éš¾åº¦æé«˜ã€‚</p>
</li>
</ul>
<h2># API è®¤è¯ç­¾å (<code>sign</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: é™¤äº† <code>anti_content</code>ï¼Œè¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ <code>sign</code> å­—æ®µã€‚</p>
</li>
<li><p><strong>ç›®çš„</strong>: è¿™ä¸ªå­—æ®µæ‰æ˜¯çœŸæ­£ç”¨äº API çº§åˆ«è®¤è¯çš„ç­¾åã€‚</p>
</li>
<li><p><strong>å…¸å‹ç”Ÿæˆé€»è¾‘</strong>:</p>
</li>
</ul>
<ol>
<li>æ”¶é›†æ‰€æœ‰è¯·æ±‚å‚æ•°ï¼ˆGET Query Params å’Œ POST Form Body Paramsï¼‰ã€‚</li>
<li>å‰”é™¤ <code>sign</code> å­—æ®µæœ¬èº«ã€‚</li>
<li>æŒ‰å‚æ•°åçš„ ASCII å­—æ¯é¡ºåºè¿›è¡Œæ’åºã€‚</li>
<li>å°†æ’åºåçš„å‚æ•°æ‹¼æ¥æˆ <code>key=value&amp;...</code> çš„å­—ç¬¦ä¸²ï¼ˆç©ºå€¼å‚æ•°å¯èƒ½ä¸å‚ä¸æ‹¼æ¥ï¼‰ã€‚</li>
<li>åœ¨æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²<strong>å‰å</strong>æˆ–<strong>ä¸­é—´</strong>æ’å…¥ä¸€ä¸ªå›ºå®šçš„å¯†é’¥ï¼ˆApp Secret / Saltï¼‰ï¼Œè¿™ä¸ªå¯†é’¥é€šå¸¸ç¡¬ç¼–ç åœ¨ SO æ–‡ä»¶ä¸­ã€‚</li>
<li>å¯¹æœ€ç»ˆçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 æˆ– HMAC-SHA256 å“ˆå¸Œï¼Œå¾—åˆ°ç­¾åå€¼ã€‚</li>
</ol>
<h2>æ¡ˆä¾‹åˆ†æ 2ï¼šç¤¾äº¤ App (ç±»å°çº¢ä¹¦æ¨¡å¼)</h2>
<h2># å¤æ‚çš„è¯·æ±‚å¤´ç­¾å (<code>X-Sign</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: è®¤è¯ä¿¡æ¯ä¸æ”¾åœ¨ URL å‚æ•°ä¸­ï¼Œè€Œæ˜¯ä½äº HTTP è¯·æ±‚å¤´ï¼Œå¦‚ <code>X-Sign</code>, <code>X-T</code> (æ—¶é—´æˆ³), <code>X-B3-TraceId</code> ç­‰ã€‚</p>
</li>
<li><p><strong><code>X-Sign</code> çš„æ„æˆ</strong>:</p>
</li>
<li><p><strong>æ ¼å¼</strong>: é€šå¸¸æ˜¯ <code>MD5(some_string)</code> çš„å½¢å¼ã€‚</p>
</li>
<li><p><strong><code>some_string</code> çš„æ‹¼æ¥æ–¹å¼</strong>: <code>URL Path + Sorted Query Params + (POST Body Hash) + Token/Salt</code>ã€‚</p>
</li>
<li><p>è¿™æ„å‘³ç€ï¼Œä¸ä»… URL å‚æ•°ï¼Œè¿ POST çš„å†…å®¹ä¹Ÿå‚ä¸äº†ç­¾åè®¡ç®—ã€‚</p>
</li>
<li><p>æœ‰æ—¶è¿˜ä¼šåŒ…å«å…¶ä»–è¯·æ±‚å¤´çš„å€¼ã€‚</p>
</li>
<li><p><strong>åŠ¨æ€ Salt</strong>: å…¶ç­¾åç”¨çš„å¯†é’¥å¯èƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯éƒ¨åˆ†ç”±æœåŠ¡å™¨ä¸‹å‘ï¼Œæˆ–ä¸æ—¶é—´æˆ³ã€è®¾å¤‡ä¿¡æ¯åŠ¨æ€ç”Ÿæˆï¼Œè¿™ä½¿å¾—æš´åŠ›ç ´è§£å’Œç®€å•æ¨¡æ‹Ÿè¯·æ±‚å˜å¾—éå¸¸å›°éš¾ã€‚</p>
</li>
</ul>
<h2># è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥ (<code>X-DeviceInfo</code>)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: æœ‰ä¸€ä¸ªä¸“é—¨çš„è¯·æ±‚å¤´ï¼Œå¦‚ <code>X-DeviceInfo</code>ï¼Œå…¶å†…å®¹æ˜¯åŠ å¯†æˆ– Base64 ç¼–ç åçš„ JSON å­—ç¬¦ä¸²ï¼Œé‡Œé¢æ˜¯è¯¦ç»†çš„è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>å…³è”æ€§</strong>: æœåŠ¡ç«¯çš„é£æ§ç³»ç»Ÿä¼šå°† <code>X-Sign</code> å’Œ <code>X-DeviceInfo</code> è¿›è¡Œå¼ºå…³è”æ ¡éªŒã€‚</p>
</li>
<li><p>é¦–å…ˆéªŒè¯ <code>X-Sign</code> æ˜¯å¦åˆæ³•ã€‚</p>
</li>
<li><p>ç„¶åè§£ç  <code>X-DeviceInfo</code>ï¼Œåˆ†æè®¾å¤‡æ˜¯å¦å¯ä¿¡ã€‚</p>
</li>
<li><p>æœ€åï¼Œå¯èƒ½ä¼šäº¤å‰éªŒè¯ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªç‰ˆæœ¬çš„ App æ˜¯å¦å¯èƒ½è¿è¡Œåœ¨æŸä¸ªç‰¹å®šçš„ Android SDK ç‰ˆæœ¬ä¸Šï¼Œå¦‚æœä¸åŒ¹é…ï¼Œåˆ™åˆ¤å®šä¸ºå¼‚å¸¸ã€‚</p>
</li>
</ul>
<h2>æ¡ˆä¾‹åˆ†æ 3ï¼šå­—èŠ‚è·³åŠ¨ç³» (æŠ–éŸ³/TikTok)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: å…¶ API è¯·æ±‚ä¸­åŒ…å«å¤šä¸ªå¤æ‚çš„è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œå¦‚ <code>X-Gorgon</code>, <code>X-Khronos</code>, <code>X-Argus</code>, <code>X-Ladon</code>ã€‚è¯·æ±‚ä½“é€šå¸¸æ˜¯ç»è¿‡ Protobuf åºåˆ—åŒ–åå†åŠ å¯†çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p>
</li>
<li><p><strong>è®¾å¤‡æ³¨å†Œ</strong>: App é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè¿›è¡Œè®¾å¤‡æ³¨å†Œ (<code>/service/2/device_register/</code>)ï¼Œè·å–æœåŠ¡å™¨ä¸‹å‘çš„ <code>device_id</code> å’Œ <code>install_id</code>ã€‚è¿™ä¸¤ä¸ª ID æ˜¯åç»­æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚çš„èº«ä»½åŸºç¡€ã€‚</p>
</li>
<li><p><strong>å¤šé‡ç­¾åç³»ç»Ÿ</strong>: <code>X-Gorgon</code> æ˜¯æœ€æ ¸å¿ƒçš„ API è¯·æ±‚ç­¾åï¼Œå®ƒå°† URLã€Cookieã€POST Body çš„å“ˆå¸Œã€è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ç­‰å¤šç§å› ç´ æ··åˆè®¡ç®—è€Œæˆã€‚<code>X-Khronos</code> æ˜¯åŠ å¯†è¿‡çš„æ—¶é—´æˆ³ã€‚è¿™å¥—ä½“ç³»ç¡®ä¿äº†è¯·æ±‚çš„æ¥æºã€æ—¶æ•ˆå’Œå®Œæ•´æ€§éƒ½å¯è¢«éªŒè¯ã€‚</p>
</li>
<li><p><strong>Protobuf åºåˆ—åŒ–</strong>: å¤§é‡ä½¿ç”¨ Protobuf è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œç›¸æ¯” JSONï¼Œå®ƒæ›´é«˜æ•ˆï¼Œä½†ä¹Ÿå¢åŠ äº†é€†å‘éš¾åº¦ï¼Œå› ä¸ºåˆ†æè€…éœ€è¦å…ˆæ‰¾åˆ°æˆ–è¿˜åŸ <code>.proto</code> æ–‡ä»¶æ‰èƒ½ç†è§£æ•°æ®ç»“æ„ã€‚</p>
</li>
<li><p><strong>Cronet ç½‘ç»œåº“</strong>: ä½¿ç”¨ Google çš„ Cronet ç½‘ç»œåº“è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œè¿™ä½¿å¾—å¸¸è§„çš„ OkHttp Hook æ–¹æ³•å¤±æ•ˆï¼Œå¿…é¡»æ·±å…¥åˆ°æ›´åº•å±‚çš„ <code>cronet.so</code> æˆ–ç³»ç»Ÿç½‘ç»œè°ƒç”¨å±‚é¢å»è¿›è¡Œ Hookã€‚</p>
</li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p>
</li>
<li><p><strong>è™šæ‹Ÿæœºä¿æŠ¤ (VMP)</strong>: å…¶æ ¸å¿ƒ SO åº“ï¼ˆå¦‚ <code>libmetasec_ml.so</code>, <code>libmsaoaidsec.so</code>ï¼‰ä½¿ç”¨äº†è¡Œä¸šé¡¶çº§çš„ VMP æˆ–å…¶è‡ªç ”çš„è™šæ‹Ÿæœºä¿æŠ¤æŠ€æœ¯ã€‚è¿™ä¼šå°†åŸå§‹çš„ ARM æŒ‡ä»¤è½¬æ¢æˆè™šæ‹Ÿæœºè‡ªå®šä¹‰çš„å­—èŠ‚ç ï¼Œå¯¼è‡´ IDA ç­‰å·¥å…·æ— æ³•è¿›è¡Œé™æ€åˆ†æã€‚</p>
</li>
<li><p><strong>ç®—æ³•å¿«é€Ÿè¿­ä»£</strong>: ç­¾åç®—æ³•å‡ ä¹æ¯ä¸ªç‰ˆæœ¬éƒ½åœ¨å˜åŒ–ï¼Œå¢åŠ äº†é•¿æœŸç»´æŠ¤çš„éš¾åº¦ã€‚</p>
</li>
<li><p><strong>åˆ†æç­–ç•¥</strong>: é‰´äº VMP çš„å­˜åœ¨ï¼Œå®Œå…¨è¿˜åŸç­¾åç®—æ³•å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ä¸šç•Œä¸»æµçš„ç­–ç•¥æ˜¯<strong>æ”¾å¼ƒç®—æ³•è¿˜åŸï¼Œè½¬å‘ RPC è°ƒç”¨</strong>ã€‚å³é€šè¿‡ Frida ç­‰å·¥å…·æ‰¾åˆ° SO ä¸­è´Ÿè´£è®¡ç®—ç­¾åçš„å‡½æ•°ï¼ˆæ— è®ºæ˜¯å¯¼å‡ºè¿˜æ˜¯éå¯¼å‡ºå‡½æ•°ï¼‰ï¼Œæ¨¡æ‹Ÿå…¶è¿è¡Œç¯å¢ƒå’Œå‚æ•°ï¼Œç›´æ¥è°ƒç”¨å®ƒæ¥è·å–ç­¾åç»“æœã€‚</p>
</li>
</ul>
<h2>æ¡ˆä¾‹åˆ†æ 4ï¼šå¿«æ‰‹</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: API è¯·æ±‚å‚æ•°ä¸­åŒ…å« <code>sig</code> å’Œ <code>__NS_sig</code> å­—æ®µã€‚è¯·æ±‚ä½“åŒæ ·å¯èƒ½ä½¿ç”¨ Protobuf åºåˆ—åŒ–å¹¶åŠ å¯†ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p>
</li>
<li><p><strong>åŒç­¾åä½“ç³»</strong>:</p>
</li>
<li><p><code>sig</code>: ä¸€ä¸ªç›¸å¯¹ä¼ ç»Ÿçš„ API ç­¾åï¼Œé€šå¸¸æ˜¯å¯¹æ‰€æœ‰è¯·æ±‚å‚æ•°è¿›è¡Œæ’åºã€æ‹¼æ¥ã€åŠ ç›åè¿›è¡Œ MD5 æˆ– HMAC å“ˆå¸Œã€‚</p>
</li>
<li><p><code>__NS_sig</code> (New Signature): è¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„é£æ§ç­¾åï¼Œå…¶è®¡ç®—è¿‡ç¨‹èå…¥äº†å¤§é‡çš„è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ï¼Œç”¨äºå¯¹æŠ—æ¨¡æ‹Ÿå™¨å’Œè„šæœ¬ã€‚</p>
</li>
<li><p><strong>åŠ¨æ€ Salt</strong>: åœ¨åŠ å¯†å’Œç­¾åè¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°ä¸€ä¸ª <code>client_salt</code>ï¼Œè¿™ä¸ªç›å€¼å¹¶éå›ºå®šï¼Œè€Œæ˜¯å¯èƒ½ä» Protobuf æ•°æ®ä¸­åŠ¨æ€è·å–ï¼Œæˆ–è€…é€šè¿‡ JNI è°ƒç”¨ SO åº“åŠ¨æ€ç”Ÿæˆï¼Œè¿™å¢åŠ äº†æ¨¡æ‹Ÿè¯·æ±‚çš„éš¾åº¦ã€‚</p>
</li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p>
</li>
<li><p>å…¶æ ¸å¿ƒ SO åº“ï¼ˆå¦‚ <code>libcore.so</code>ï¼‰ç»è¿‡äº†æ·±åº¦æ··æ·†ï¼Œè™½ç„¶å¯èƒ½ä¸æ˜¯ VMP çº§åˆ«ï¼Œä½†é™æ€åˆ†æä¾ç„¶å›°éš¾é‡é‡ã€‚</p>
</li>
<li><p>åŒæ ·å¤§é‡ä½¿ç”¨äº† Protobufï¼Œéœ€è¦æŠ•å…¥ç²¾åŠ›å»é€†å‘å…¶æ•°æ®ç»“æ„ã€‚</p>
</li>
</ul>
<h2>æ¡ˆä¾‹åˆ†æ 5ï¼šç¾å›¢</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: API è¯·æ±‚ä¸­åŒ…å«å¤§é‡è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œå¦‚ <code>M-TraceId</code>ã€‚è¯·æ±‚ä½“è¢«åŠ å¯†ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ° <code>rohr</code> å’Œ <code>mtgsig</code> ç­‰æ–°ä¸€ä»£çš„é£æ§åŠç­¾åå­—æ®µã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p>
</li>
<li><p><strong>ä¸­å¿ƒåŒ–é£æ§åº“</strong>: æ ¸å¿ƒä¿æŠ¤é€»è¾‘é«˜åº¦é›†ä¸­åœ¨ <code>libmtguard.so</code> ä¸­ï¼Œè¯¥åº“è´Ÿè´£ç”Ÿæˆå‡ ä¹æ‰€æœ‰çš„ç­¾åå’Œé£æ§æ•°æ®ã€‚</p>
</li>
<li><p><strong>è¯·æ±‚å‹ç¼©ä¸åŠ å¯†</strong>: è¯·æ±‚ä½“å¯èƒ½ä¼šå…ˆç”¨ <code>zlib</code> æˆ– <code>gzip</code> è¿›è¡Œå‹ç¼©ï¼Œç„¶åå†é€šè¿‡ AES è¿›è¡ŒåŠ å¯†ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦å…ˆè§£å¯†å†è§£å‹ã€‚</p>
</li>
<li><p><strong><code>rohr</code> &amp; <code>mtgsig</code></strong>: è¿™æ˜¯å…¶æ–°ä¸€ä»£çš„é£æ§ç­¾åä½“ç³»ã€‚<code>rohr</code> æ˜¯ä¸€ä¸ªé£æ§ä»¤ç‰Œï¼ŒåŒ…å«äº†åŠ å¯†çš„è®¾å¤‡å’Œç¯å¢ƒä¿¡æ¯ï¼›<code>mtgsig</code> æ˜¯ API ç­¾åï¼Œå®ƒåœ¨è®¡ç®—æ—¶ä¼šä¾èµ– <code>rohr</code> çš„éƒ¨åˆ†æ•°æ®ï¼Œä¸¤è€…å¼ºå…³è”ã€‚</p>
</li>
<li><p><strong>ç»Ÿä¸€è¯·æ±‚ç½‘å…³</strong>: æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ API ç½‘å…³ï¼ŒåŠ å¯†å’Œç­¾åé€»è¾‘ç›¸å¯¹é›†ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†å’Œè¿­ä»£ã€‚</p>
</li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p>
</li>
<li><p><code>libmtguard.so</code> æ˜¯é€†å‘çš„é‡ä¸­ä¹‹é‡ï¼Œå…¶å†…éƒ¨é€»è¾‘å¤æ‚ä¸”ç»è¿‡æ··æ·†ã€‚</p>
</li>
<li><p>é£æ§ç»´åº¦æå¹¿ï¼Œé™¤äº†å¸¸è§„çš„è®¾å¤‡æŒ‡çº¹ï¼Œè¿˜å¯èƒ½åŒ…æ‹¬åœ°ç†ä½ç½®ã€å†å²è¡Œä¸ºã€ç½‘ç»œç¯å¢ƒç­‰ï¼Œå¯¹ä¼ªé€ è®¾å¤‡ç”»åƒçš„ä¸€è‡´æ€§è¦æ±‚éå¸¸é«˜ã€‚</p>
</li>
</ul>
<h2>æ¡ˆä¾‹åˆ†æ 6ï¼šé˜¿é‡Œç³» (æ·˜å®ã€æ”¯ä»˜å®)</h2>
<ul>
<li><p><strong>ç°è±¡</strong>: API è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ª <code>sign</code> å­—æ®µï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªåä¸º <code>wua</code> çš„ç¥ç§˜å‚æ•°ã€‚ç½‘ç»œè¯·æ±‚é€šè¿‡è‡ªæœ‰çš„ MTop ç½‘å…³è¿›è¡Œåˆ†å‘ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒé€»è¾‘</strong>:</p>
</li>
<li><p><strong>ç»Ÿä¸€ç½‘å…³ (MTop)</strong>: é˜¿é‡Œç³» App ä½¿ç”¨è‡ªç ”çš„ MTop (Mobile Taobao Open Platform) ä½œä¸ºç»Ÿä¸€æ— çº¿ç½‘å…³ã€‚æ‰€æœ‰çš„ API è¯·æ±‚éƒ½ç»è¿‡è¿™ä¸ªç½‘å…³ï¼Œä¾¿äºç»Ÿä¸€è¿›è¡Œç­¾åæ ¡éªŒã€å®‰å…¨é£æ§å’Œæµé‡è°ƒåº¦ã€‚</p>
</li>
<li><p><strong>å®‰å…¨æ ¸å¿ƒ (<code>libsgmain.so</code>)</strong>: æ‰€æœ‰çš„å®‰å…¨é€»è¾‘éƒ½é«˜åº¦é›†æˆåœ¨ <code>libsgmain.so</code> ä»¥åŠä¸€ç³»åˆ— <code>libsgxxx.so</code> (å¦‚ <code>libsgsecuritybody.so</code>) çš„å®‰å…¨ç»„ä»¶ä¸­ã€‚è¿™æ˜¯é˜¿é‡Œå®‰å…¨çš„æ ¸å¿ƒæŠ€æœ¯ç»“æ™¶ï¼Œè´Ÿè´£ç­¾å <code>sign</code> å’Œé£æ§å‚æ•° <code>wua</code> çš„ç”Ÿæˆã€‚</p>
</li>
<li><p><strong><code>sign</code> ç­¾å</strong>: ç­¾åç®—æ³•æå…¶å¤æ‚ã€‚å®ƒä¸ä»…åŒ…å« API çš„ä¸šåŠ¡å‚æ•°ï¼Œè¿˜ä¼šå°†æ—¶é—´æˆ³ã€App ç‰ˆæœ¬ã€Token ä»¥åŠä»å®‰å…¨ SDK ä¸­è·å–çš„å¤§é‡è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ä¸€åŒå‚ä¸è®¡ç®—ã€‚å…¶æ‹¼æ¥å’ŒåŠ å¯†æ–¹å¼éå¸¸è§„æ•´ã€‚</p>
</li>
<li><p><strong><code>wua</code> é£æ§å‚æ•°</strong>: è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äº <code>anti_content</code> çš„é»‘ç›’é£æ§å‚æ•°ã€‚å®ƒç”± <code>libsgmain.so</code> é‡‡é›†æµ·é‡çš„è®¾å¤‡ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç¡¬ä»¶ã€ç³»ç»Ÿã€ç½‘ç»œã€ä¼ æ„Ÿå™¨ã€ç¯å¢ƒæ£€æµ‹ç­‰ï¼‰åï¼Œç»è¿‡é«˜åº¦æ··æ·†çš„ç®—æ³•åŠ å¯†ç”Ÿæˆã€‚<code>wua</code> çš„ç”Ÿæˆéš¾åº¦å’Œé‡è¦æ€§ç”šè‡³é«˜äº <code>sign</code>ã€‚æœåŠ¡ç«¯ä¼šå°† <code>sign</code> å’Œ <code>wua</code> è¿›è¡Œå¼ºå…³è”æ ¡éªŒã€‚</p>
</li>
<li><p><strong>ACCS é€šé“</strong>: ä½¿ç”¨è‡ªç ”çš„ ACCS (Alibaba Cloud Channel Service) é•¿è¿æ¥é€šé“ï¼ŒåŸºäº HTTP/2ï¼Œè¿›ä¸€æ­¥å°è£…äº†ç½‘ç»œè¯·æ±‚ï¼Œä½¿å¾—å¸¸è§„æŠ“åŒ…å’Œåˆ†æå˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
</li>
<li><p><strong>é€†å‘æŒ‘æˆ˜</strong>:</p>
</li>
<li><p><strong>é¡¶çº§æ··æ·†</strong>: <code>libsgmain.so</code> åŠå…¶ä¾èµ–åº“ä½¿ç”¨äº†è‡ªç ”çš„ã€å¤šå±‚æ¬¡çš„å¤æ‚æ··æ·†æŠ€æœ¯ï¼Œé™æ€åˆ†æå‡ ä¹æ— æ³•ä¸‹æ‰‹ï¼Œæ˜¯ä¸šç•Œå…¬è®¤çš„æœ€éš¾é€†å‘çš„ SO åº“ä¹‹ä¸€ã€‚</p>
</li>
<li><p><strong>åŠ¨æ€åŠ è½½ä¸åè°ƒè¯•</strong>: å®‰å…¨ç»„ä»¶çš„åŠ è½½å’Œåˆå§‹åŒ–è¿‡ç¨‹éå¸¸éšæ™¦ï¼Œå¹¶ä¼´æœ‰å¤§é‡çš„åè°ƒè¯•å’Œç¯å¢ƒæ£€æµ‹æ‰‹æ®µï¼Œç»™åŠ¨æ€è°ƒè¯•å’Œåˆ†æè®¾ç½®äº†æé«˜çš„é—¨æ§›ã€‚</p>
</li>
<li><p><strong>é»‘ç›’ RPC è°ƒç”¨</strong>: ä¸å­—èŠ‚ç³»ç±»ä¼¼ï¼Œä¸šç•Œçš„ä¸»æµç­–ç•¥æ˜¯æ”¾å¼ƒç®—æ³•è¿˜åŸã€‚é€†å‘çš„ç»ˆæç›®æ ‡æ˜¯åœ¨ SO æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼ <code>main</code> çš„å‡½æ•°å…¥å£ï¼Œé€šè¿‡ RPC è°ƒç”¨çš„æ–¹å¼ï¼Œä¼ å…¥è¯·æ±‚å‚æ•°ï¼Œè·å–è®¡ç®—å¥½çš„ <code>sign</code> å’Œ <code>wua</code> å€¼ã€‚å®šä½è¿™ä¸ªå…¥å£éœ€è¦æå…¶æ·±åšçš„åŠ¨æ€è°ƒè¯•å’ŒäºŒè¿›åˆ¶åˆ†æåŠŸåº•ã€‚</p>
</li>
</ul>
<h2>é€†å‘åˆ†æé€šç”¨ç­–ç•¥</h2>
<ol>
<li><strong>é™æ€åˆ†æ (Jadx/Ghidra)</strong>:</li>
</ol>
<ul>
<li><p><strong>å…¨å±€æœç´¢</strong>ï¼šæœç´¢å…³é”®è¯ï¼Œå¦‚ <code>sign</code>, <code>encrypt</code>, ä»¥åŠä¸Šè¿°æ¡ˆä¾‹ä¸­çš„ <code>anti_content</code>, <code>X-Sign</code>, <code>X-Gorgon</code>, <code>mtgsig</code>, <code>wua</code> ç­‰ã€‚</p>
</li>
<li><p><strong>å®šä½ç½‘ç»œåº“</strong>: ç°ä»£ App å¤§å¤šä½¿ç”¨ OkHttpã€‚æœç´¢ <code>okhttp3.Interceptor</code> çš„å®ç°ç±»ï¼Œå› ä¸ºåŠ å¯†å’Œç­¾åçš„é€»è¾‘å¸¸å¸¸åœ¨è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸­ç»Ÿä¸€å¤„ç†ã€‚</p>
</li>
<li><p><strong>è¿½è¸ª JNI è°ƒç”¨</strong>: æ‰¾åˆ° Java å±‚è°ƒç”¨ Native æ–¹æ³•çš„åœ°æ–¹ï¼Œé‡ç‚¹å…³æ³¨é‚£äº›å‡½æ•°åå¯ç–‘ï¼ˆå¦‚ <code>getSignFromC</code>ï¼‰ã€å‚æ•°å¤šä¸”åŒ…å«å­—èŠ‚æ•°ç»„çš„å‡½æ•°ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>åŠ¨æ€åˆ†æ (Frida)</strong>:</li>
</ol>
<ul>
<li><p><strong>Hook åŠ å¯†ç®—æ³•</strong>: è¿™æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚Hook <code>java.security.MessageDigest.digest</code> å’Œ <code>javax.crypto.Mac.doFinal</code>ï¼Œæ‰“å°å®ƒä»¬çš„è¾“å…¥ï¼ˆå³è¢«ç­¾åçš„æ˜æ–‡ï¼‰å’Œè°ƒç”¨å †æ ˆï¼Œå¯ä»¥ç¬é—´å®šä½åˆ°ç”Ÿæˆç­¾åçš„ä»£ç ä½ç½®ã€‚</p>
</li>
<li><p><strong>Hook ç½‘ç»œè¯·æ±‚</strong>: Hook <code>okhttp3.Request.Builder</code> çš„ <code>build()</code> æ–¹æ³•ï¼Œæˆ– <code>okhttp3.OkHttpClient</code> çš„ <code>newCall</code> æ–¹æ³•ï¼Œå¯ä»¥ dump å‡ºæ‰€æœ‰å³å°†å‘å‡ºçš„ç½‘ç»œè¯·æ±‚çš„å®Œæ•´ä¿¡æ¯ï¼ˆURL, Headers, Bodyï¼‰ï¼Œç”¨äºå’ŒæŠ“åŒ…ç»“æœå¯¹æ¯”ã€‚</p>
</li>
</ul>
<ul>
<li><strong>Hook SO å‡½æ•°</strong>: å®šä½åˆ°æ ¸å¿ƒ SO åº“åï¼Œç”¨ Frida <code>Interceptor.attach</code> ç›´æ¥ Hook ç›®æ ‡å¯¼å‡ºå‡½æ•°ï¼Œè§‚å¯Ÿå…¶è¾“å…¥å’Œè¾“å‡ºã€‚å¯¹äºéå¯¼å‡ºå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡åŸºåœ°å€åŠ åç§»çš„æ–¹å¼è¿›è¡Œ Hookã€‚</li>
</ul>
<hr />
<h2>é«˜çº§ç­–ç•¥ï¼šé»‘ç›’ RPC è°ƒç”¨è¯¦è§£</h2>
<p>åœ¨åˆ†æå­—èŠ‚ã€é˜¿é‡Œç­‰é¡¶çº§å‚å•†çš„åŠ å›º SO æ—¶ï¼Œä¼šå‘ç°å…¶æ ¸å¿ƒé€»è¾‘å— VMP (è™šæ‹Ÿæœºä¿æŠ¤) æˆ–è‡ªç ”è™šæ‹Ÿæœºä¿æŠ¤ã€‚è¿™æ„å‘³ç€åŸå§‹çš„ ARM æŒ‡ä»¤è¢«è½¬æ¢æˆäº†ä¸€å¥—è‡ªå®šä¹‰çš„ã€æ— æ³•è¢«å¸¸è§„åæ±‡ç¼–å·¥å…·è§£æçš„å­—èŠ‚ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯•å›¾å®Œå…¨ç†è§£å¹¶&quot;ç™½ç›’&quot;åœ°è¿˜åŸç­¾åç®—æ³•ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>å› æ­¤ï¼Œä¸šç•Œçš„åˆ†ææ€è·¯ä»&quot;ç®—æ³•è¿˜åŸ&quot;è½¬å‘&quot;ç®—æ³•åˆ©ç”¨&quot;ï¼Œè¿™ä¾¿æ˜¯<strong>é»‘ç›’ RPC (Remote Procedure Call) è°ƒç”¨</strong>ã€‚</p>
<h2># ä»€ä¹ˆæ˜¯é»‘ç›’ RPC è°ƒç”¨ï¼Ÿ</h2>
<p>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ä¸å†å…³å¿ƒå‡½æ•°å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¸€ä¸ªé»‘ç›’å­ã€‚æˆ‘ä»¬åªå…³å¿ƒå®ƒçš„è¾“å…¥å’Œè¾“å‡ºã€‚</strong>
æˆ‘ä»¬å°†é€šè¿‡ Frida ç­‰å·¥å…·ï¼Œåœ¨ App çš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ï¼Œå¼ºè¡Œè°ƒç”¨è¿™ä¸ªé»‘ç›’å‡½æ•°ï¼Œè®©å®ƒä¸ºæˆ‘ä»¬è®¡ç®—å‡ºæ‰€éœ€çš„ç»“æœï¼ˆå¦‚ <code>sign</code>, <code>wua</code>ï¼‰ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™å¤–éƒ¨çš„è‡ªåŠ¨åŒ–ç¨‹åºã€‚</p>
<p>è¿™å°±å¥½æ¯”æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç½‘ç«™çš„ APIï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ƒçš„æºç ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„ URLã€å‚æ•°å’Œè¿”å›å€¼æ ¼å¼å°±èƒ½ä½¿ç”¨å®ƒã€‚åœ¨è¿™é‡Œï¼ŒSO é‡Œçš„å‡½æ•°å°±æ˜¯é‚£ä¸ª&quot;API&quot;ã€‚</p>
<h2># å®ç°é»‘ç›’ RPC çš„æ ¸å¿ƒæ­¥éª¤</h2>
<h3># ç¬¬ä¸€æ­¥ï¼šå®šä½ç›®æ ‡å‡½æ•°åœ°å€ (Finding the Function Pointer)</h3>
<p>è¿™æ˜¯æœ€å›°éš¾ã€æœ€è€—æ—¶çš„ä¸€æ­¥ï¼Œéœ€è¦æ·±åšçš„åŠ¨æ€è°ƒè¯•åŠŸåº•ã€‚</p>
<ol>
<li><strong>ä» JNI å…¥å£å¼€å§‹</strong>: ä» Java å±‚è°ƒç”¨ Native æ–¹æ³•çš„åœ°æ–¹ï¼ˆ<code>JNI</code> å‡½æ•°ï¼‰ä½œä¸ºèµ·ç‚¹ã€‚</li>
<li><strong>ä¸»åŠ¨è°ƒç”¨ä¸æ’æ¡©</strong>: ä½¿ç”¨ Frida ä¸»åŠ¨è°ƒç”¨è¯¥ JNI å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ <code>Stalker</code> ç­‰æŒ‡ä»¤çº§è·Ÿè¸ªå·¥å…·ï¼Œè®°å½•ä¸‹æ‰§è¡Œè½¨è¿¹ã€‚</li>
<li><strong>æ‰§è¡Œæµåˆ†æ</strong>: åˆ†æ Stalker äº§ç”Ÿçš„å·¨å¤§æ—¥å¿—ï¼Œæˆ–ä½¿ç”¨ <code>Unicorn Engine</code> ç­‰æ¨¡æ‹Ÿæ‰§è¡Œå·¥å…·è¿›è¡Œåˆ†æï¼Œç†æ¸…å¤æ‚çš„è·³è½¬å’Œè®¡ç®—é€»è¾‘ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ª&quot;å¹²å‡€&quot;çš„å‡½æ•°å…¥å£â€”â€”å®ƒæ¥æ”¶ç›¸å¯¹åŸå§‹çš„ä¸šåŠ¡å‚æ•°ï¼Œè¿”å›æœ€ç»ˆçš„ç­¾åç»“æœã€‚è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼ˆé€šå¸¸æ˜¯ SO åŸºå€ + åç§»é‡ï¼‰å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚</li>
</ol>
<h3># ç¬¬äºŒæ­¥ï¼šåˆ†æå‡½æ•°åŸå‹ (Analyzing the Prototype)</h3>
<p>ç¡®å®šç›®æ ‡å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºã€‚</p>
<ul>
<li><p><strong>è¾“å…¥å‚æ•°</strong>: åœ¨ä¸Šä¸€æ­¥æ‰¾åˆ°çš„å‡½æ•°è°ƒç”¨ç‚¹ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿè°ƒç”¨å‰å„å¯„å­˜å™¨ï¼ˆARM32 ä¸‹é‡ç‚¹å…³æ³¨ R0-R3ï¼‰å’Œæ ˆä¸Šçš„å€¼ï¼Œæ¨æ–­å‡ºå‡½æ•°çš„å‚æ•°ç±»å‹ã€æ•°é‡å’Œé¡ºåºã€‚å‚æ•°å¯èƒ½æ˜¯å­—ç¬¦ä¸²ã€å­—èŠ‚æ•°ç»„ã€ç»“æ„ä½“æŒ‡é’ˆç­‰ã€‚</p>
</li>
<li><p><strong>è¿”å›å€¼</strong>: åœ¨å‡½æ•°è¿”å›ç‚¹ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿ R0 å¯„å­˜å™¨çš„å€¼ï¼Œç¡®å®šå‡½æ•°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æœå­—ç¬¦ä¸²çš„æŒ‡é’ˆæˆ–ä¸€ä¸ªçŠ¶æ€ç ï¼‰ã€‚</p>
</li>
</ul>
<h3># ç¬¬ä¸‰æ­¥ï¼šæ„å»º RPC æœåŠ¡ç«¯ (Frida Agent)</h3>
<p>ç¼–å†™ä¸€ä¸ª Frida è„šæœ¬ï¼Œå°†å®šä½åˆ°çš„åŸç”Ÿå‡½æ•°å°è£…æˆä¸€ä¸ªå¯ä¾›è¿œç¨‹è°ƒç”¨çš„æœåŠ¡ã€‚</p>
<pre><code class="language-javascript">// agent.js
// 1. Get SO base address
const baseAddr = Module.findBaseAddress(&quot;libsgmain.so&quot;);
// 2. Calculate target function absolute address
// This 0x123456 is the function offset found through great effort in step one
const targetFuncPtr = baseAddr.add(0x123456);

// 3. Define function based on the prototype analyzed in step two
// Assume function prototype is: char* func(char* input1, int input2)
const nativeFunc = new NativeFunction(targetFuncPtr, &quot;pointer&quot;, [
  &quot;pointer&quot;,
  &quot;int&quot;,
]);

// 4. Expose interface using rpc.exports
rpc.exports = {
  // Define a remote call interface named getSign
  getSign: function (param1, param2) {
    console.log(&quot;RPC call received, invoking native function...&quot;);
    // Prepare parameters for native function
    const input1Ptr = Memory.allocUtf8String(param1);

    // Call native function
    const resultPtr = nativeFunc(input1Ptr, param2);

    // Read and return result
    return resultPtr.readUtf8String();
  },
};
</code></pre>
<h1>client.py</h1>
<p>import frida
import sys</p>
<p>def main():</p>
<h1>Connect to frida-server on device</h1>
<p>device = frida.get_usb_device()</p>
<h1>Attach to target App process</h1>
<p>pid = device.spawn([&quot;com.example.app&quot;])
session = device.attach(pid)</p>
<h1>Load Frida Agent script</h1>
<p>with open(&quot;agent.js&quot;) as f:
script_code = f.read()
script = session.create_script(script_code)
script.load()</p>
<h1>Prepare parameters</h1>
<p>api_params_str = &quot;param1=value1&amp;param2=value2&quot;
some_int_value = 123</p>
<h1>Call RPC interface like calling a local function</h1>
<p>print(&quot;Calling RPC function: getSign...&quot;)
result_sign = script.exports.get_sign(api_params_str, some_int_value)</p>
<p>print(f&quot;Successfully got sign: {result_sign}&quot;)</p>
<h1>Can use the obtained sign to construct and send network requests here</h1>
<h1>...</h1>
<p>session.detach()</p>
<p>if <strong>name</strong> == '<strong>main</strong>':
main()</p>
<pre><code>
é€šè¿‡é»‘ç›’ RPCï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡å¯¹ VMP ç­‰å¤æ‚æŠ€æœ¯çš„ç›´æ¥å¯¹æŠ—ï¼Œå°†é€†å‘çš„é‡ç‚¹æ”¾åœ¨å¯»æ‰¾å’Œè°ƒç”¨å…³é”®å‡½æ•°ä¸Šï¼Œè¿™åœ¨å½“ä»Šçš„é«˜çº§ç§»åŠ¨å®‰å…¨æ”»é˜²ä¸­æ˜¯ä¸€ç§åŠ¡å®ä¸”é«˜æ•ˆçš„ç­–ç•¥ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-54">
                                                <h2>54. Case: Video Apps & DRM</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šè§†é¢‘ App ä¸ DRM</h1>
<h2>è§†é¢‘ç±» App çš„é€†å‘åˆ†ææ˜¯ç§»åŠ¨ç«¯å®‰å…¨é¢†åŸŸæœ€å…·æŒ‘æˆ˜æ€§çš„æ–¹å‘ä¹‹ä¸€ï¼Œå…¶æ ¸å¿ƒéš¾ç‚¹åœ¨äºæ•°å­—ç‰ˆæƒç®¡ç†ï¼ˆDRMï¼‰æŠ€æœ¯çš„å¯¹æŠ—ã€‚æœ¬æ¡ˆä¾‹å°†æ·±å…¥æ¢è®¨è§†é¢‘ Appï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠ DRM çš„åˆ†ææ€è·¯ã€‚</h2>
<h2>æ ¸å¿ƒåˆ†æç›®æ ‡</h2>
<ol>
<li><strong>è§†é¢‘æµåˆ†æ</strong>: è§£æè§†é¢‘æ’­æ”¾çš„ç½‘ç»œåè®®ï¼Œå¦‚ <code>HLS</code> (<code>.m3u8</code>) å’Œ <code>DASH</code> (<code>.mpd</code>)ï¼Œå¹¶æå–è§†é¢‘åˆ†ç‰‡ã€‚</li>
<li><strong>è§£é” VIP åŠŸèƒ½</strong>: ç»•è¿‡ä»˜è´¹å¢™ï¼Œè§‚çœ‹ VIP ä¸“å±å½±ç‰‡æˆ–è§£é”æ›´é«˜æ¸…æ™°åº¦ï¼ˆå¦‚ 1080p, 4Kï¼‰ã€‚</li>
<li><strong>DRM å¯¹æŠ—</strong>: ç†è§£ DRM çš„å·¥ä½œåŸç†ï¼Œå¹¶å°è¯•è·å–è§£å¯†è§†é¢‘æ‰€éœ€çš„å¯†é’¥ã€‚<strong>ï¼ˆæ³¨æ„ï¼šè¿™é€šå¸¸æ˜¯æå…¶å›°éš¾çš„ï¼Œä¸”å¯èƒ½æ¶‰åŠæ³•å¾‹é£é™©ã€‚ï¼‰</strong></li>
</ol>
<hr />
<h2>æ¡ˆä¾‹ï¼šåˆ†æä¸€ä¸ªä½¿ç”¨ Widevine DRM çš„è§†é¢‘æ’­æ”¾æµç¨‹</h2>
<h3>ç¬¬ 1 æ­¥ï¼šè§†é¢‘æµåè®®åˆ†æ</h3>
<p><strong>ç›®æ ‡</strong>: æ‰¾åˆ°æè¿°è§†é¢‘ä¿¡æ¯çš„æ¸…å•æ–‡ä»¶ (<code>.m3u8</code> æˆ– <code>.mpd</code>)ã€‚</p>
<ol>
<li><strong>ç½‘ç»œæŠ“åŒ…</strong>: æ‰“å¼€ Charles æˆ– Mitmproxyï¼Œå¯åŠ¨ç›®æ ‡è§†é¢‘ App å¹¶æ’­æ”¾ä¸€ä¸ªå½±ç‰‡ã€‚</li>
<li><strong>è¿‡æ»¤è¯·æ±‚</strong>: åœ¨æŠ“åŒ…ç»“æœä¸­ï¼Œä½¿ç”¨å…³é”®è¯ <code>m3u8</code> æˆ– <code>mpd</code> è¿›è¡Œè¿‡æ»¤ã€‚ä½ å¾ˆå¿«å°±èƒ½å®šä½åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶ URL ç±»ä¼¼äº <code>https://.../video.mpd</code>ã€‚</li>
<li><strong>åˆ†ææ¸…å•æ–‡ä»¶</strong>:</li>
</ol>
<ul>
<li><p><strong>DASH (<code>.mpd</code>)</strong>: è¿™æ˜¯ä¸€ä¸ª XML æ–‡ä»¶ï¼Œæè¿°äº†è§†é¢‘çš„å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸åŒçš„åˆ†è¾¨ç‡ã€éŸ³è½¨ã€å­—å¹•è½¨é“ä»¥åŠåŠ å¯†ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>HLS (<code>.m3u8</code>)</strong>: è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚ä¸» <code>m3u8</code> æ–‡ä»¶å¯èƒ½æŒ‡å‘å¤šä¸ªå­ <code>m3u8</code> æ–‡ä»¶ï¼Œæ¯ä¸ªå­æ–‡ä»¶ä»£è¡¨ä¸€ç§ç‰¹å®šçš„ç ç‡ï¼ˆæ¸…æ™°åº¦ï¼‰ï¼Œå¹¶åŒ…å«äº†è¯¥ç ç‡ä¸‹æ‰€æœ‰è§†é¢‘åˆ†ç‰‡ï¼ˆ<code>.ts</code> æ–‡ä»¶ï¼‰çš„ URLã€‚</p>
</li>
</ul>
<p>åœ¨æ¸…å•æ–‡ä»¶ä¸­ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªå…³é”®çš„æ ‡ç­¾ï¼Œè¡¨æ˜å†…å®¹æ˜¯å—ä¿æŠ¤çš„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-xml">&lt;!-- DASH MPD inEncryptInformation --&gt;
&lt;ContentProtection schemeIdUri=&quot;urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed&quot; cenc:default_KID=&quot;...value...&quot;&gt;
&lt;cenc:pssh&gt;...&lt;/cenc:pssh&gt;
&lt;/ContentProtection&gt;

</code></pre>
<h3>ç¬¬ 2 æ­¥ï¼šç†è§£ DRM å·¥ä½œæµç¨‹ (Widevine)</h3>
<p>Google çš„ Widevine æ˜¯ Android å¹³å°ä¸Šæœ€ä¸»æµçš„ DRM æ–¹æ¡ˆã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªå®‰å…¨çº§åˆ« (L1, L2, L3)ï¼Œå…¶ä¸­ L1 å®‰å…¨æ€§æœ€é«˜ã€‚</p>
<ol>
<li><strong>App è¯·æ±‚æ’­æ”¾</strong>: App ä»è§†é¢‘æ¸…å•ä¸­è§£æå‡º <code>pssh</code> æ•°æ®ã€‚</li>
<li><strong>è·å–è®¸å¯è¯ (License)</strong>: App å°† <code>pssh</code> æ•°æ®å‘é€ç»™ç³»ç»Ÿçš„ <code>MediaDrm</code> APIï¼Œç”Ÿæˆä¸€ä¸ªè®¸å¯è¯è¯·æ±‚ï¼ˆLicense Requestï¼‰ã€‚ç„¶åï¼ŒApp å°†è¿™ä¸ªè¯·æ±‚å‘é€åˆ°è§†é¢‘æœåŠ¡æä¾›å•†çš„è®¸å¯è¯æœåŠ¡å™¨ã€‚</li>
<li><strong>æœåŠ¡å™¨éªŒè¯</strong>: è®¸å¯è¯æœåŠ¡å™¨éªŒè¯è¯·æ±‚çš„åˆæ³•æ€§ï¼ˆä¾‹å¦‚ï¼ŒéªŒè¯ç”¨æˆ·çš„ VIP èº«ä»½ï¼‰ï¼Œç„¶åè¿”å›ä¸€ä¸ªåŠ å¯†çš„è®¸å¯è¯ï¼ˆEncrypted Licenseï¼‰ã€‚</li>
<li><strong>è§£å¯†å¯†é’¥</strong>: App å°†åŠ å¯†çš„è®¸å¯è¯æä¾›ç»™ <code>MediaDrm</code> APIã€‚è¿™ä¸€æ­¥æ˜¯å…³é”®ï¼š</li>
</ol>
<ul>
<li><p><strong>L1 å®‰å…¨çº§åˆ«</strong>: è®¸å¯è¯çš„å¤„ç†å’Œå†…å®¹å¯†é’¥çš„è§£å¯†å®Œå…¨åœ¨å¤„ç†å™¨çš„å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ä¸­è¿›è¡Œã€‚Android æ“ä½œç³»ç»Ÿå’Œ App æœ¬èº«éƒ½æ— æ³•è®¿é—®åˆ°è§£å¯†åçš„å¯†é’¥ã€‚è§†é¢‘å¸§çš„è§£å¯†ä¹Ÿåœ¨ TEE ä¸­å®Œæˆï¼Œç„¶åç›´æ¥è¾“å‡ºåˆ°å±å¹•ï¼Œä¸ä¼šåœ¨ App çš„å†…å­˜ä¸­æš´éœ²ã€‚</p>
</li>
<li><p><strong>L3 å®‰å…¨çº§åˆ«</strong>: åœ¨æ²¡æœ‰ TEE æ”¯æŒçš„è®¾å¤‡ä¸Šï¼Œè¿™äº›æ“ä½œéƒ½åœ¨è½¯ä»¶å±‚é¢å®Œæˆã€‚å› æ­¤ï¼ŒL3 æ˜¯ç†è®ºä¸Šæœ€å®¹æ˜“è¢«æ”»å‡»çš„ã€‚</p>
</li>
</ul>
<h3>ç¬¬ 3 æ­¥ï¼šé€†å‘åˆ†æä¸ä¿¡æ¯è·å–</h3>
<p>ç”±äº L1 çš„ç¡¬ä»¶çº§ä¿æŠ¤ï¼Œç›´æ¥è·å–å†…å®¹å¯†é’¥ï¼ˆContent Keyï¼‰å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œåˆ†æçš„é‡ç‚¹è½¬å‘äº†è®¸å¯è¯çš„è·å–è¿‡ç¨‹ã€‚</p>
<p><strong>ç›®æ ‡</strong>: æ‹¦æˆª App ä¸è®¸å¯è¯æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œè·å–è®¸å¯è¯è¯·æ±‚å’Œå“åº”ã€‚</p>
<ol>
<li><strong>å®šä½è®¸å¯è¯è¯·æ±‚ä»£ç </strong>:</li>
</ol>
<ul>
<li><p>æœç´¢ <code>MediaDrm</code>, <code>getKeyRequest</code>, <code>provideKeyResponse</code> ç­‰ <code>android.media</code> åŒ…ä¸­çš„ DRM ç›¸å…³ APIã€‚</p>
</li>
<li><p>ä½¿ç”¨ Frida Hook è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥æ‰“å°å‡º <code>pssh</code>ã€è®¸å¯è¯è¯·æ±‚å’ŒåŠ å¯†çš„è®¸å¯è¯å“åº”ã€‚</p>
</li>
</ul>
<pre><code class="language-javascript">Java.perform(function () {
  var MediaDrm = Java.use(&quot;android.media.MediaDrm&quot;);

  // Hook getKeyRequest method to capture license requests
  MediaDrm.getKeyRequest.implementation = function (
    scope,
    initData,
    mimeType,
    keyType,
    optionalParameters
  ) {
    console.log(&quot;Intercepting getKeyRequest...&quot;);
    // initData is the pssh
    console.log(&quot;PSSH (initData):&quot;, bytesToHex(initData));

    var keyRequest = this.getKeyRequest(
      scope,
      initData,
      mimeType,
      keyType,
      optionalParameters
    );
    // keyRequest is a complex object, needs further parsing
    // ...
    return keyRequest;
  };

  // Hook provideKeyResponse method to capture encrypted license
  MediaDrm.provideKeyResponse.implementation = function (scope, response) {
    console.log(&quot;Intercepting provideKeyResponse...&quot;);
    // response is the encrypted license obtained from the server
    console.log(&quot;Encrypted License (response):&quot;, bytesToHex(response));

    return this.provideKeyResponse(scope, response);
  };
});
function bytesToHex(arr) {
  /* ... a function to convert byte array to hex string ... */
}
</code></pre>
<ol start="3">
<li><strong>CDM (å†…å®¹è§£å¯†æ¨¡å—) åˆ†æ</strong>: Widevine çš„ L3 çº§ CDM æ˜¯ä¸€ä¸ªåŸç”Ÿåº“ï¼ˆ<code>.so</code> æ–‡ä»¶ï¼‰ï¼Œè´Ÿè´£å¤„ç†ç™½ç›’åŠ å¯†çš„é€»è¾‘ã€‚å¯¹è¿™ä¸ª <code>.so</code> æ–‡ä»¶è¿›è¡Œæ·±å…¥çš„é™æ€å’ŒåŠ¨æ€åˆ†æï¼Œæ˜¯ç†è®ºä¸Šè¿˜åŸå‡ºè®¾å¤‡å¯†é’¥ï¼ˆDevice Keyï¼‰çš„å”¯ä¸€é€”å¾„ï¼Œè¿™ä¹Ÿæ˜¯ CDM Challenge ç­‰æ¯”èµ›çš„æ ¸å¿ƒã€‚è¿™æ˜¯ä¸€ä¸ªæå…¶å¤æ‚å’Œè€—æ—¶çš„è¿‡ç¨‹ã€‚</li>
</ol>
<hr />
<h2>ä¸»æµå¹³å° DRM ä¸åŠ å¯†æ–¹æ¡ˆå®ä¾‹</h2>
<h3>å›½å†…å¹³å° (ä¼˜é…·ã€çˆ±å¥‡è‰ºã€è…¾è®¯è§†é¢‘ã€èŠ’æœ TV)</h3>
<p>å›½å†…ä¸»æµè§†é¢‘å¹³å°åœ¨åŠ å¯†ç­–ç•¥ä¸Šé€šå¸¸é‡‡ç”¨<strong>&quot;è‡ªç ”åŠ å¯†æ–¹æ¡ˆ + æ ‡å‡† DRM&quot;</strong>çš„æ··åˆæ¨¡å¼ã€‚</p>
<ul>
<li><p>å¯¹äºæ‹¥æœ‰å…¨çƒç‰ˆæƒçš„å½±è§†å‰§ï¼ˆå¦‚å¥½è±åå¤§ç‰‡ï¼‰ï¼Œå®ƒä»¬ä¼šä½¿ç”¨è¡Œä¸šæ ‡å‡†çš„ Widevine DRMã€‚</p>
</li>
<li><p>å¯¹äºå¤§é‡çš„è‡ªåˆ¶å‰§ã€ç»¼è‰ºç­‰å†…å®¹ï¼Œå®ƒä»¬æ›´å€¾å‘äºä½¿ç”¨è‡ªç ”çš„åŠ å¯†æ–¹æ¡ˆï¼Œå…¶æ ¸å¿ƒæ˜¯å¯¹ HLS åè®®è¿›è¡Œæ”¹é€ ã€‚</p>
</li>
</ul>
<p><strong>é€šç”¨æ¨¡å¼ï¼šä¿æŠ¤ HLS å¯†é’¥çš„è·å–è¿‡ç¨‹</strong></p>
<ol>
<li><strong>è§†é¢‘æµ</strong>: æ™®éä½¿ç”¨ HLS (<code>.m3u8</code>) åè®®ã€‚</li>
<li><strong>åŠ å¯†ç®—æ³•</strong>: <code>.m3u8</code> æ–‡ä»¶ä¸­ä¼šå£°æ˜è§†é¢‘åˆ†ç‰‡ï¼ˆ<code>.ts</code> æ–‡ä»¶ï¼‰ä½¿ç”¨ <code>AES-128-CBC</code> åŠ å¯†ã€‚</li>
<li><strong>æ ¸å¿ƒä¿æŠ¤</strong>: <strong>è§†é¢‘æ•°æ®æœ¬èº«çš„åŠ å¯†ç®—æ³•æ˜¯æ ‡å‡†çš„ï¼Œä½†è·å–è§£å¯†å¯†é’¥ï¼ˆKeyï¼‰çš„è¿‡ç¨‹æ˜¯é«˜åº¦å®šåˆ¶å’Œä¿æŠ¤çš„ã€‚</strong></li>
</ol>
<ul>
<li><p><code>.m3u8</code> æ–‡ä»¶æœ¬èº«ä¸æ˜¯é™æ€çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªéœ€è¦å¤æ‚ç­¾åçš„ API åŠ¨æ€ç”Ÿæˆçš„ã€‚</p>
</li>
<li><p><code>#EXT-X-KEY</code> æ ‡ç­¾ä¸­æŒ‡å‘çš„å¯†é’¥ URL (<code>key.key</code>) ä¹Ÿä¸æ˜¯ä¸€ä¸ªèƒ½ç›´æ¥è®¿é—®çš„åœ°å€ï¼Œè®¿é—®å®ƒåŒæ ·éœ€è¦æ­£ç¡®çš„ Cookieã€Referer å’ŒåŠ å¯†å‚æ•°ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>é€†å‘å…³é”®</strong>:</li>
</ol>
<ul>
<li><p><strong>å®šä½æ’­æ”¾ API</strong>: é€†å‘çš„é‡ç‚¹æ˜¯æ‰¾åˆ° App ä¸­è´Ÿè´£è¯·æ±‚è§†é¢‘æ’­æ”¾ä¿¡æ¯çš„ APIã€‚è¿™ä¸ª API çš„è¯·æ±‚å‚æ•°é€šå¸¸åŒ…å«è§†é¢‘ IDã€æ¸…æ™°åº¦ã€ä»¥åŠä¸€ä¸ªç±»ä¼¼æˆ‘ä»¬åœ¨ä¸Šä¸€ç« åˆ†æè¿‡çš„ã€åŒ…å«è®¾å¤‡æŒ‡çº¹å’Œæ—¶é—´æˆ³çš„ <code>sign</code> æˆ– <code>token</code>ã€‚</p>
</li>
<li><p><strong>æ¨¡æ‹Ÿåˆæ³•è¯·æ±‚</strong>: åªè¦èƒ½å¤ŸæˆåŠŸæ¨¡æ‹Ÿè¿™ä¸ª API çš„è°ƒç”¨ï¼Œå°±èƒ½è·å–åˆ°ä¸€ä¸ªåŒ…å«äº†æœ‰æ•ˆå¯†é’¥ URL çš„ <code>.m3u8</code> æ–‡ä»¶ã€‚æ‹¿åˆ°å¯†é’¥åï¼Œå°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ <code>AES-128</code> ç®—æ³•è§£å¯† <code>.ts</code> æ–‡ä»¶å¹¶åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„è§†é¢‘ã€‚</p>
</li>
<li><p><strong>è…¾è®¯è§†é¢‘çš„ <code>vkey</code></strong>: ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯è…¾è®¯è§†é¢‘ï¼Œå…¶æ’­æ”¾ API ä¸­éœ€è¦ä¸€ä¸ªè‡³å…³é‡è¦çš„ <code>vkey</code> å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ç”Ÿæˆç®—æ³•å°±å°è£…åœ¨å®¢æˆ·ç«¯çš„ SO åº“ä¸­ã€‚</p>
</li>
</ul>
<h3>å›½å¤–å¹³å° (Netflix, YouTube, Hulu, HBO Max)</h3>
<p>å›½å¤–ä¸»æµè§†é¢‘å¹³å°ï¼Œç‰¹åˆ«æ˜¯å†…å®¹æä¾›å•†ï¼Œä¸¥æ ¼ä¸”æ·±åº¦åœ°ä¾èµ–æ ‡å‡†åŒ–çš„ DRM ä½“ç³»ã€‚é€†å‘çš„ç„¦ç‚¹<strong>å®Œå…¨ä¸åœ¨äºåˆ†æè§†é¢‘æ–‡ä»¶æ ¼å¼æˆ–ç®—æ³•ï¼Œè€Œåœ¨äº DRM è®¸å¯è¯çš„è·å–æµç¨‹</strong>ã€‚</p>
<h4>Netflix / Hulu / HBO Max</h4>
<ul>
<li><p><strong>DRM æ–¹æ¡ˆ</strong>: åœ¨ Android ä¸Šæ— ä¸€ä¾‹å¤–åœ°ä½¿ç”¨ Google Widevineï¼Œåœ¨è‹¹æœè®¾å¤‡ä¸Šä½¿ç”¨ FairPlayã€‚</p>
</li>
<li><p><strong>å®‰å…¨çº§åˆ«</strong>: å¯¹äºé«˜æ¸…å†…å®¹ï¼ˆHD, 4Kï¼‰ï¼Œå¼ºåˆ¶è¦æ±‚è®¾å¤‡çš„ Widevine å®‰å…¨çº§åˆ«ä¸º L1ã€‚è¿™æ„å‘³ç€å¯†é’¥äº¤æ¢å’Œå†…å®¹è§£å¯†å…¨ç¨‹åœ¨ç¡¬ä»¶ TEE ä¸­å®Œæˆï¼ŒApp å’Œæ“ä½œç³»ç»Ÿå‡æ— æ³•è§¦åŠæ˜æ–‡å¯†é’¥ã€‚</p>
</li>
<li><p><strong>è®¸å¯è¯è¯·æ±‚ä¿æŠ¤</strong>: é€†å‘çš„å”¯ä¸€ç€çœ¼ç‚¹æ˜¯ App å‘èµ·è®¸å¯è¯è¯·æ±‚çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p>è¿™ä¸ªè¯·æ±‚è¢«å¤šç§æ–¹å¼ä¿æŠ¤ï¼Œä¾‹å¦‚ Netflix ä½¿ç”¨è‡ªç ”çš„ <strong>MSL (Message Security Layer)</strong> åè®®å¯¹è®¸å¯è¯è¯·æ±‚æœ¬èº«è¿›è¡ŒäºŒæ¬¡å°è£…å’ŒåŠ å¯†ã€‚</p>
</li>
<li><p>App ä¼šé‡‡é›†å¤§é‡è®¾å¤‡æŒ‡çº¹ä¿¡æ¯ï¼Œè¿åŒç”¨æˆ·çš„èº«ä»½å‡­è¯ä¸€èµ·ï¼Œç”¨äºç”Ÿæˆè®¸å¯è¯è¯·æ±‚ã€‚æœåŠ¡ç«¯çš„é£æ§ç³»ç»Ÿä¼šä¸¥æ ¼æ ¡éªŒè¿™äº›ä¿¡æ¯ï¼Œä»¥ç¡®ä¿è¯·æ±‚æ¥è‡ªäºä¸€ä¸ªåˆæ³•çš„ã€æœªè¢«ç¯¡æ”¹çš„å®˜æ–¹ App å®¢æˆ·ç«¯ã€‚</p>
</li>
<li><p><strong>é€†å‘ç»“è®º</strong>: åœ¨ L1 ä¿æŠ¤ä¸‹ï¼Œé€šè¿‡é€†å‘ App æ¥è·å–è§†é¢‘è§£å¯†å¯†é’¥ä»¥è¿›è¡Œç¦»çº¿ä¸‹è½½æ˜¯<strong>å‡ ä¹ä¸å¯èƒ½</strong>çš„ã€‚åˆ†æçš„ä¸»è¦æ„ä¹‰åœ¨äºç†è§£å…¶æ¶æ„å’Œå®‰å…¨å¼ºåº¦ã€‚</p>
</li>
</ul>
<h4>YouTube</h4>
<p>YouTube çš„æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒéœ€è¦åŒºåˆ†å¯¹å¾…ï¼š</p>
<ul>
<li><p><strong>ä»˜è´¹å†…å®¹ (YouTube Premium / ç”µå½±)</strong>: ä¸ Netflix ç±»ä¼¼ï¼Œä½¿ç”¨æ ‡å‡†çš„ Widevine DRM è¿›è¡Œä¿æŠ¤ã€‚</p>
</li>
<li><p><strong>æ™®é€š UGC å†…å®¹</strong>: å¤§éƒ¨åˆ†è§†é¢‘æ²¡æœ‰ä½¿ç”¨ DRM åŠ å¯†ï¼Œä½†ä½¿ç”¨äº†å¦ä¸€ç§å·§å¦™çš„ä¿æŠ¤æ–¹å¼â€”â€”<strong>åŠ¨æ€ URL ç­¾å</strong>ã€‚</p>
</li>
<li><p><strong>ç°è±¡</strong>: ä½¿ç”¨ <code>youtube-dl</code> ç­‰å·¥å…·ä¸‹è½½è§†é¢‘æ—¶ï¼Œä¼šçœ‹åˆ°å®ƒæœ‰ä¸€ä¸ª&quot;deciphering signature&quot;çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p><strong>åŸç†</strong>: è§†é¢‘æµçš„ URL ä¸­åŒ…å«ä¸€ä¸ª <code>s</code> æˆ– <code>sig</code> å‚æ•°ï¼Œè¿™ä¸ªç­¾åæ˜¯ç”±ä¸€æ®µæ··æ·†è¿‡çš„ JavaScript ä»£ç ï¼ˆåœ¨ Web ç«¯ï¼‰æˆ– Native ä»£ç ï¼ˆåœ¨ App ç«¯ï¼‰åŠ¨æ€ç”Ÿæˆçš„ã€‚è¯¥ç®—æ³•å°†è§†é¢‘çš„ <code>cipher</code> (ä¸€æ®µåŠ å¯†å­—ç¬¦ä¸²) å’Œå…¶ä»–å‚æ•°ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€ä¸ªè§£å¯†çš„ç­¾åã€‚</p>
</li>
<li><p><strong>é€†å‘å…³é”®</strong>: é€†å‘çš„é‡ç‚¹ä¸å†æ˜¯ DRMï¼Œè€Œæ˜¯<strong>æ‰¾åˆ°å¹¶è¿˜åŸé‚£æ®µè´Ÿè´£è®¡ç®—ç­¾åçš„ JavaScript/Native å‡½æ•°</strong>ã€‚ç”±äºä»£ç ç»è¿‡äº†é«˜åº¦æ··æ·†ï¼Œè¿™ä¾ç„¶æ˜¯ä¸€é¡¹å…·æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œã€‚</p>
</li>
</ul>
<h2>æ€»ç»“</h2>
<p>è§†é¢‘ App çš„ DRM é€†å‘æ˜¯ä¸€åœºä¸ç¡¬ä»¶å’Œå¤æ‚å¯†ç å­¦åè®®çš„è‰°è‹¦æ–—äº‰ã€‚ä¸éŸ³ä¹ App ä¸åŒï¼Œå…¶æ ¸å¿ƒç›®æ ‡é€šå¸¸ä¸æ˜¯å¼€å‘ä¸€ä¸ª&quot;ä¸‹è½½å™¨&quot;ï¼Œè€Œæ˜¯ç†è§£å…¶å®‰å…¨ä½“ç³»çš„å¼ºåº¦å’Œå¼±ç‚¹ã€‚</p>
<ul>
<li><p>å¯¹äºæ™®é€šåˆ†æï¼Œé‡ç‚¹æ˜¯<strong>æ‹¦æˆªå’Œç†è§£ä¿¡ä»¤</strong>ï¼ˆæ¸…å•æ–‡ä»¶ã€è®¸å¯è¯è¯·æ±‚/å“åº”ï¼‰ã€‚</p>
</li>
<li><p>å¯¹äºé«˜çº§ç ”ç©¶ï¼Œæ ¸å¿ƒæ˜¯<strong>æ”»å‡» L3 çš„ CDM å®ç°</strong>ï¼Œä½†è¿™éœ€è¦æé«˜çš„é€†å‘å·¥ç¨‹å’Œå¯†ç å­¦çŸ¥è¯†ã€‚</p>
</li>
</ul>
<p>è¿™ä¸ªé¢†åŸŸçš„æ”»é˜²æ°´å¹³ä»£è¡¨äº†æ•´ä¸ªè¡Œä¸šå®‰å…¨å¯¹æŠ—çš„é¡¶å³°ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-55">
                                                <h2>55. Case: Unity Games (Il2Cpp)</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šUnity æ¸¸æˆé€†å‘ (Il2Cpp)</h1>
<h2>Unity æ˜¯ç›®å‰æœ€æµè¡Œçš„ç§»åŠ¨æ¸¸æˆå¼•æ“ä¹‹ä¸€ã€‚ç°ä»£ Unity æ¸¸æˆé€šå¸¸ä½¿ç”¨ Il2Cpp è„šæœ¬åç«¯ï¼Œå°† C# ä»£ç è½¬æ¢ä¸º C++ ä»£ç å¹¶ç¼–è¯‘ä¸º Native åº“ (<code>libil2cpp.so</code>)ã€‚è¿™ä½¿å¾—ä¼ ç»Ÿçš„ Java/Smali é€†å‘æ–¹æ³•å¤±æ•ˆï¼Œéœ€è¦å…¨æ–°çš„å·¥å…·å’Œæ€è·¯ã€‚</h2>
<h2>æ ¸å¿ƒæ¶æ„ä¸æ–‡ä»¶ç»“æ„</h2>
<p>ä¸€ä¸ªå…¸å‹çš„ Unity Il2Cpp æ¸¸æˆåŒ…å«ä»¥ä¸‹å…³é”®æ–‡ä»¶ï¼š</p>
<ol>
<li><strong><code>lib/armeabi-v7a/libil2cpp.so</code></strong>: è¿™æ˜¯æ¸¸æˆçš„æ ¸å¿ƒé€»è¾‘åº“ã€‚æ‰€æœ‰çš„ C# è„šæœ¬ï¼ˆç©å®¶æ§åˆ¶ã€æ¸¸æˆé€»è¾‘ã€ç½‘ç»œé€šä¿¡ï¼‰éƒ½è¢«ç¼–è¯‘åˆ°äº†è¿™é‡Œã€‚</li>
<li><strong><code>assets/bin/Data/Managed/global-metadata.dat</code></strong>: è¿™æ˜¯ Il2Cpp çš„å…ƒæ•°æ®æ–‡ä»¶ã€‚å®ƒåŒ…å«äº†è¢«è½¬æ¢å‰çš„ C# ç±»åã€æ–¹æ³•åã€å­—æ®µåä»¥åŠå®ƒä»¬åœ¨ <code>libil2cpp.so</code> ä¸­çš„åç§»åœ°å€ã€‚<strong>è¿™æ˜¯é€†å‘çš„å…³é”®é’¥åŒ™</strong>ã€‚</li>
<li><strong><code>lib/armeabi-v7a/libmain.so</code></strong> (æˆ– <code>libunity.so</code>): Unity å¼•æ“çš„è¿è¡Œæ—¶åº“ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹ã€‚</li>
</ol>
<hr />
<h2>é€†å‘æµç¨‹</h2>
<h3>ç¬¬ 1 æ­¥ï¼šå…ƒæ•°æ®æå– (Metadata Dumping)</h3>
<p>ç”±äº <code>libil2cpp.so</code> æ˜¯å‰¥ç¦»äº†ç¬¦å·è¡¨ (stripped) çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç›´æ¥ç”¨ IDA æ‰“å¼€åªèƒ½çœ‹åˆ°æˆåƒä¸Šä¸‡ä¸ªæ— åå‡½æ•° (<code>sub_xxxx</code>)ã€‚æˆ‘ä»¬éœ€è¦ç»“åˆ <code>global-metadata.dat</code> æ¥è¿˜åŸè¿™äº›å‡½æ•°çš„çœŸå®åç§°ã€‚</p>
<ul>
<li><strong>å·¥å…·</strong>: <a href="https://github.com/Perfare/Il2CppDumper">Il2CppDumper</a></li>
</ul>
<ol>
<li>å°† APK è§£å‹ï¼Œæå–å‡º <code>libil2cpp.so</code> å’Œ <code>global-metadata.dat</code>ã€‚</li>
<li>è¿è¡Œ <code>Il2CppDumper.exe &lt;libil2cpp.so&gt; &lt;global-metadata.dat&gt;</code>ã€‚</li>
<li>å·¥å…·ä¼šç”Ÿæˆï¼š</li>
</ol>
<ul>
<li><strong><code>dump.cs</code></strong>: è¿˜åŸåçš„ C# ä¼ªä»£ç ï¼Œå±•ç¤ºäº†æ‰€æœ‰ç±»ã€å­—æ®µå’Œæ–¹æ³•ç»“æ„ã€‚</li>
<li><strong><code>script.py</code></strong>: ç”¨äº IDA Pro çš„ Python è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨é‡å‘½å IDA ä¸­çš„å‡½æ•°ã€‚</li>
<li><strong><code>ghidra.py</code></strong>: ç”¨äº Ghidra çš„è„šæœ¬ã€‚</li>
<li><strong><code>DummyDll/</code></strong>: ç”Ÿæˆçš„ç©º DLL æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ dnSpy æ‰“å¼€æŸ¥çœ‹ç±»ç»“æ„ã€‚</li>
</ul>
<h3>ç¬¬ 2 æ­¥ï¼šé™æ€åˆ†æä¸å®šä½</h3>
<p>ä½¿ç”¨ <code>dnSpy</code> æ‰“å¼€ç”Ÿæˆçš„ Dummy DLLï¼Œæˆ–æ˜¯ç›´æ¥é˜…è¯» <code>dump.cs</code>ï¼Œæˆ‘ä»¬å¯ä»¥åƒé˜…è¯»æºç ä¸€æ ·æµè§ˆæ¸¸æˆçš„ç±»ç»“æ„ã€‚</p>
<ul>
<li><p><strong>å¯»æ‰¾åˆ‡å…¥ç‚¹</strong>:</p>
</li>
<li><p><strong>è´§å¸ä¿®æ”¹</strong>: æœç´¢ <code>Coin</code>, <code>Gem</code>, <code>Money</code>, <code>Currency</code> ç­‰å…³é”®è¯ã€‚å¯»æ‰¾ <code>AddCoin()</code>, <code>GetMoney()</code>, <code>UpdateCurrency()</code> ç­‰æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>æ— æ•Œ/é«˜ä¼¤å®³</strong>: æœç´¢ <code>PlayerController</code>, <code>BattleManager</code>, <code>Health</code>, <code>Damage</code>ã€‚å¯»æ‰¾ <code>TakeDamage()</code>, <code>OnHit()</code> ç­‰æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>å†…è´­ç ´è§£</strong>: æœç´¢ <code>IAP</code>, <code>Purchase</code>, <code>Store</code>, <code>Payment</code>ã€‚å¯»æ‰¾ <code>OnPurchaseSuccess()</code>, <code>VerifyReceipt()</code> ç­‰æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>:
åœ¨ <code>dump.cs</code> ä¸­æ‰¾åˆ°å¦‚ä¸‹ç±»ï¼š</p>
</li>
</ul>
<pre><code class="language-csharp">public class PlayerData {
public int coin;
public int gem;
public void AddCoin(int amount); // Address: 0x123456
public void SubCoin(int amount); // Address: 0x123460
}

</code></pre>
<p>// Il2Cpp Hook Template</p>
<p>var soName = &quot;libil2cpp.so&quot;;
var baseAddr = Module.findBaseAddress(soName);</p>
<p>if (baseAddr) {
// Target function offset: 0x123456 (AddCoin)
var addCoinFunc = baseAddr.add(0x123456);</p>
<p>Interceptor.attach(addCoinFunc, {
onEnter: function(args) {
// args[0] is 'this' pointer (PlayerData instance)
// args[1] is amount (coin count to add)</p>
<p>console.log(&quot;[*] AddCoin called&quot;);
console.log(&quot; Amount: &quot; + args[1].toInt32());</p>
<p>// Modify parameter: force add 99999 regardless of game logic
args[1] = ptr(99999);
},
onLeave: function(retval) {
console.log(&quot;[*] AddCoin finished&quot;);
}
});
} else {
console.log(&quot;[-] libil2cpp.so not found!&quot;);
}</p>
<pre><code>// Use frida-il2cpp-bridge
Il2Cpp.perform(() =&gt; {
// 1. Find class
const PlayerData = Il2Cpp.domain.assembly(&quot;Assembly-CSharp&quot;).image.class(&quot;PlayerData&quot;);

// 2. Hook method (auto process offset, no need to calculate manually)
PlayerData.method(&quot;SubCoin&quot;).implementation = function (amount) {
console.log(&quot;[*] SubCoin called with amount: &quot; + amount);
// Prevent coin deduction (do nothing)
return;
};

// 3. Manually call method
// Assume we want to call PlayerData.Instance.AddCoin(1000)
// Need to find static instance or current instance first

// Trace all PlayerData instance creation
Il2Cpp.traceClass(PlayerData);
});

</code></pre>
<ul>
<li><strong>å¯¹æŠ—</strong>:<ul>
<li><strong>Hook åŠ è½½å‡½æ•°</strong>: æ¸¸æˆå¿…é¡»åœ¨è¿è¡Œæ—¶è§£å¯† metadata æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚Hook <code>libil2cpp.so</code> ä¸­åŠ è½½ metadata çš„å‡½æ•°ï¼ˆé€šå¸¸æ˜¯ <code>il2cpp::vm::MetadataCache::Register</code> æˆ–ç›¸å…³åˆå§‹åŒ–å‡½æ•°ï¼‰ï¼ŒDump å‡ºè§£å¯†åçš„å†…å­˜å†…å®¹ã€‚</li>
</ul>
</li>
<li><strong>åˆ†æè§£å¯†é€»è¾‘</strong>: é€†å‘ <code>libil2cpp.so</code> çš„åˆå§‹åŒ–æµç¨‹ï¼Œæ‰¾åˆ°è§£å¯† metadata çš„ç®—æ³•ï¼ˆé€šå¸¸æ˜¯ XOR æˆ– AESï¼‰ï¼Œå†™è„šæœ¬è¿˜åŸã€‚</li>
</ul>
<h3>2. å‡½æ•°åœ°å€æ··æ·† / åŠ¨æ€è®¡ç®—</h3>
<ul>
<li><strong>ç°è±¡</strong>: Il2CppDumper å¯¼å‡ºçš„åœ°å€ä¸å†…å­˜ä¸­çš„å®é™…åœ°å€ä¸ç¬¦ã€‚</li>
<li><strong>å¯¹æŠ—</strong>:</li>
<li>è¿™é€šå¸¸æ˜¯å› ä¸ºæ¸¸æˆåœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹äº†å‡½æ•°æŒ‡é’ˆã€‚</li>
<li>ä½¿ç”¨ <strong>Frida çš„æ‰«æåŠŸèƒ½</strong>ï¼Œæ ¹æ®æœºå™¨ç ç‰¹å¾ï¼ˆPattern Scanningï¼‰æ¥å®šä½å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¾èµ–å›ºå®šçš„åç§»ã€‚</li>
</ul>
<h3>3. åè°ƒè¯•ä¸å®Œæ•´æ€§æ ¡éªŒ</h3>
<ul>
<li><strong>ç°è±¡</strong>: é™„åŠ  Frida åæ¸¸æˆå´©æºƒæˆ–é—ªé€€ã€‚</li>
<li><strong>å¯¹æŠ—</strong>:</li>
<li>å‚è€ƒ &quot;Anti-Debugging&quot; ç« èŠ‚ï¼Œéšè— Frida ç‰¹å¾ï¼ŒBypass TracerPid æ£€æµ‹ã€‚</li>
<li>ä½¿ç”¨ Magisk + Riru + Il2CppDumper (Zygisk ç‰ˆ) åœ¨ç³»ç»Ÿå±‚é¢è¿›è¡Œ Dumpï¼Œè§„é¿åº”ç”¨å±‚æ£€æµ‹ã€‚</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>Unity Il2Cpp é€†å‘çš„æ ¸å¿ƒåœ¨äº<strong>è¿˜åŸç¬¦å·</strong>ã€‚åªè¦æ‹¿åˆ°äº†æ­£ç¡®çš„ <code>global-metadata.dat</code> å’Œ <code>libil2cpp.so</code> çš„æ˜ å°„å…³ç³»ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±å˜æˆäº†æ ‡å‡†çš„é€»è¾‘åˆ†æå’Œ Native Hookã€‚ç†Ÿç»ƒæŒæ¡ Il2CppDumper å’Œ Frida æ˜¯æå®šè¿™ç±»æ¸¸æˆçš„å…³é”®ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-56">
                                                <h2>56. Case: Flutter Apps</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šFlutter åº”ç”¨é€†å‘</h1>
<p>Flutter æ˜¯ Google æ¨å‡ºçš„è·¨å¹³å° UI æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Dart è¯­è¨€å¼€å‘ã€‚ä¸ä¼ ç»Ÿçš„ Android App (Java/Kotlin) æˆ– Unity (C#) ä¸åŒï¼ŒRelease æ¨¡å¼ä¸‹çš„ Flutter åº”ç”¨å°† Dart ä»£ç é¢„ç¼–è¯‘ (AOT) æˆäº†åŸç”Ÿæœºå™¨ç ï¼Œæ‰“åŒ…åœ¨ <code>libapp.so</code> ä¸­ï¼Œè¿™ä½¿å¾—é€†å‘éš¾åº¦å¤§å¤§å¢åŠ ã€‚</p>
<hr />
<h1># æ ¸å¿ƒæ¶æ„</h1>
<ol>
<li><strong><code>lib/armeabi-v7a/libflutter.so</code></strong>: Flutter å¼•æ“ï¼Œè´Ÿè´£æ¸²æŸ“ã€é€šä¿¡å’Œè¿è¡Œæ—¶æ”¯æŒã€‚é€šå¸¸ä¸éœ€è¦é€†å‘ï¼Œä½†å¯ä»¥ç”¨å®ƒæ¥å®šä½å…³é”®çš„å†…éƒ¨å‡½æ•°ã€‚</li>
<li><strong><code>lib/armeabi-v7a/libapp.so</code></strong>: <strong>é€†å‘çš„æ ¸å¿ƒç›®æ ‡</strong>ã€‚åŒ…å«äº†å¼€å‘è€…çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆDart ä»£ç ç¼–è¯‘åçš„äº§ç‰©ï¼‰ã€‚</li>
<li><strong>Snapshot æ ¼å¼</strong>: <code>libapp.so</code> å®é™…ä¸Šä¸ä»…ä»…æ˜¯ä»£ç ï¼Œè¿˜åŒ…å«äº†ä¸€ä¸ª Dart VM Snapshotã€‚å®ƒæ²¡æœ‰æ ‡å‡†çš„ ELF ç¬¦å·è¡¨ï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼ Java çš„ç±»ç»“æ„å…ƒæ•°æ®ã€‚</li>
</ol>
<hr />
<h1># é€†å‘æµç¨‹</h1>
<h2># ç¬¬ 1 æ­¥ï¼šè¯†åˆ« Flutter åº”ç”¨</h2>
<p>è§£å‹ APKï¼ŒæŸ¥çœ‹ <code>lib</code> ç›®å½•ã€‚å¦‚æœçœ‹åˆ° <code>libflutter.so</code> å’Œ <code>libapp.so</code>ï¼Œé‚£ä¹ˆè¿™è‚¯å®šæ˜¯ä¸€ä¸ª Flutter åº”ç”¨ã€‚</p>
<h2># ç¬¬ 2 æ­¥ï¼šä½¿ç”¨ reFlutter æ¡†æ¶</h2>
<p>ç”±äº Dart AOT çš„ç‰¹æ®Šæ€§ï¼Œç›´æ¥ç”¨ IDA åˆ†æ <code>libapp.so</code> éå¸¸å›°éš¾ï¼Œå› ä¸ºæ‰€æœ‰å‡½æ•°åéƒ½è¢«å‰¥ç¦»äº†ï¼Œä¸” Dart çš„è°ƒç”¨çº¦å®šå’Œå¯„å­˜å™¨ä½¿ç”¨æ–¹å¼ä¸æ ‡å‡† C/C++ ä¸åŒã€‚</p>
<p><strong>reFlutter</strong> æ˜¯ç›®å‰æœ€å¼ºå¤§çš„ Flutter é€†å‘è¾…åŠ©å·¥å…·ã€‚å®ƒé€šè¿‡ä¿®æ”¹ Flutter å¼•æ“ (<code>libflutter.so</code>)ï¼Œåœ¨åº”ç”¨è¿è¡Œæ—¶åˆ©ç”¨ Dart VM çš„å†…éƒ¨æœºåˆ¶æ¥ Dump ç±»ã€å‡½æ•°å’Œåç§»ä¿¡æ¯ã€‚</p>
<p><strong>å·¥å…·</strong>: <a href="https://github.com/Impact-I/reFlutter">reFlutter</a></p>
<p><strong>æ“ä½œæ­¥éª¤</strong>:</p>
<ol>
<li><strong>é‡æ‰“åŒ…</strong>: ä½¿ç”¨ reFlutter å¤„ç†ç›®æ ‡ APKã€‚<pre><code class="language-bash">reflutter target.apk
</code></pre>
</li>
</ol>
<pre><code>2. **å®‰è£…è¿è¡Œ**: å®‰è£…ç”Ÿæˆçš„ `release.RE.apk` åˆ°æ‰‹æœºã€‚
3. **è·å–åç§»**: åº”ç”¨å¯åŠ¨åï¼ŒreFlutter ä¼šåœ¨ Logcat ä¸­è¾“å‡ºå…³é”®çš„ Dart åº“å‡½æ•°çš„åç§»åœ°å€ï¼Œæˆ–è€…ç”Ÿæˆä¸€ä¸ª `dump.dart` æ–‡ä»¶ã€‚

## # ç¬¬ 3 æ­¥ï¼šæµé‡æ‹¦æˆª (SSL Pinning Bypass)

Flutter åº”ç”¨ä¸ä½¿ç”¨ç³»ç»Ÿçš„ä»£ç†è®¾ç½®ï¼Œä¹Ÿä¸ä½¿ç”¨ Java å±‚çš„ HTTP å®¢æˆ·ç«¯ (OkHttp)ï¼Œè€Œæ˜¯ä½¿ç”¨ Dart è‡ªå·±çš„ `HttpClient`ã€‚å› æ­¤ï¼Œä¼ ç»Ÿçš„æŠ“åŒ…è®¾ç½®ï¼ˆWi-Fi ä»£ç†ï¼‰å’Œ Frida SSL Pinning è„šæœ¬é€šå¸¸æ— æ•ˆã€‚

* *reFlutter çš„æ–¹æ¡ˆ**:
reFlutter åœ¨é‡æ‰“åŒ…æ—¶ï¼Œä¼šè‡ªåŠ¨ Patch `libflutter.so` ä¸­çš„ç½‘ç»œæ ¡éªŒé€»è¾‘ï¼Œå¹¶å¼ºåˆ¶å°†æµé‡è½¬å‘åˆ°æŒ‡å®šçš„ä»£ç† IPï¼ˆéœ€è¦åœ¨ reFlutter é…ç½®é˜¶æ®µè¾“å…¥ä½ çš„ Burp/Charles IPï¼‰ã€‚è¿™æ˜¯ç›®å‰æ‹¦æˆª Flutter æµé‡æœ€ç¨³å®šçš„æ–¹æ³•ã€‚

* *Frida æ–¹æ¡ˆ (Hook éªŒè¯å‡½æ•°)**:
å¦‚æœä½ ä¸æƒ³é‡æ‰“åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ Frida Hook `libflutter.so` ä¸­è´Ÿè´£éªŒè¯è¯ä¹¦çš„å‡½æ•°ã€‚
* å‡½æ•°åé€šå¸¸åŒ…å« `SessionVerifyCertificateChain`ã€‚
* ä½ éœ€è¦ä¸‹è½½å¯¹åº” Flutter ç‰ˆæœ¬çš„ `libflutter.so` ç¬¦å·æ–‡ä»¶ï¼Œæˆ–è€…é€šè¿‡ç‰¹å¾ç æœç´¢è¯¥å‡½æ•°ã€‚
* Hook è¯¥å‡½æ•°å¹¶ä½¿å…¶ç›´æ¥è¿”å›éªŒè¯æˆåŠŸã€‚

## # ç¬¬ 4 æ­¥ï¼šä½¿ç”¨ Doldrums è¿˜åŸä»£ç 

* *Doldrums** æ˜¯ä¸€ä¸ªé’ˆå¯¹ Flutter Android åº”ç”¨çš„é™æ€åˆ†æå·¥å…·ï¼Œè¯•å›¾å°† `libapp.so` åç¼–è¯‘å› Dart ä¼ªä»£ç ã€‚

* *å·¥å…·**: [Doldrums](https://github.com/rscloura/Doldrums)

* æ³¨æ„ï¼šç”±äº Flutter ç‰ˆæœ¬æ›´æ–°æå¿«ï¼ŒSnapshot æ ¼å¼ç»å¸¸å˜åŠ¨ï¼ŒDoldrums å¯èƒ½ä¸æ”¯æŒæœ€æ–°çš„ Flutter ç‰ˆæœ¬ã€‚

## # ç¬¬ 5 æ­¥ï¼šåŠ¨æ€åˆ†æ (Dart VM Hook)

å¦‚æœæ— æ³•é™æ€è¿˜åŸä»£ç ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œ Hookã€‚ç”±äºæ²¡æœ‰ç¬¦å·ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆ reFlutter å¯¼å‡ºçš„åç§»åœ°å€ã€‚

```javascript
// Frida Script Example: Hook Dart Function
// Assume reFlutter tells us the function offset to hook is 0x1a2b3c

var appBase = Module.findBaseAddress('libapp.so');
var targetOffset = 0x1a2b3c;
var targetFunc = appBase.add(targetOffset);

Interceptor.attach(targetFunc, {
onEnter: function(args) {
// Dart function parameter passing is special
// args[0] may not be the first parameter, but a Closure or other VM structure
// Parameters are usually stored in specific registers or stack locations, depending on Dart version and ABI
console.log(&quot;Dart function called!&quot;);

// Print parameters (try reading first 4 parameters)
console.log(&quot;Arg1: &quot; + args[0]);
console.log(&quot;Arg2: &quot; + args[1]);
console.log(&quot;Arg3: &quot; + args[2]);
},
onLeave: function(retval) {
console.log(&quot;Dart function returned: &quot; + retval);
}
});

</code></pre>
<ol start="2">
<li><strong>ä»£ç åˆ†æ</strong>: é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ Doldrumsï¼‰å…¼å®¹æ€§è¾ƒå·®ï¼Œä¸»è¦ä¾èµ– <strong>reFlutter</strong> æå–åç§» + <strong>Frida</strong> åŠ¨æ€è°ƒè¯•ã€‚</li>
<li><strong>æ ¸å¿ƒ</strong>: ç†è§£ Dart VM çš„å·¥ä½œåŸç†ï¼ˆSnapshot ç»“æ„ã€Object Poolã€Dispatch Tableï¼‰æ˜¯æ·±å…¥é€†å‘ Flutter çš„åŸºç¡€ã€‚</li>
</ol>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-57">
                                                <h2>57. Case: Malware Analysis</h2>
                                                <h1>æ¡ˆä¾‹ç ”ç©¶ï¼šå®‰å“é“¶è¡Œæœ¨é©¬åˆ†æ</h1>
<p>æ¶æ„è½¯ä»¶åˆ†ææ˜¯é€†å‘å·¥ç¨‹çš„ä¸€ä¸ªé‡è¦åº”ç”¨é¢†åŸŸã€‚ä¸å¸¸è§„ App åˆ†æä¸åŒï¼Œåˆ†ææ¶æ„è½¯ä»¶æ›´å…³æ³¨å…¶<strong>éšè—è¡Œä¸º</strong>ã€<strong>æŒä¹…åŒ–æœºåˆ¶</strong>ã€<strong>çªƒå¯†æ‰‹æ®µ</strong>ä»¥åŠ<strong>C2 (Command &amp; Control) é€šä¿¡</strong>ã€‚</p>
<h2>æœ¬æ¡ˆä¾‹å°†æ¨¡æ‹Ÿåˆ†æä¸€ä¸ªå…¸å‹çš„ <strong>Android é“¶è¡Œæœ¨é©¬ (Banking Trojan)</strong>ã€‚</h2>
<h2>æ ·æœ¬æ¦‚å†µ</h2>
<p><strong>ä¼ªè£…</strong>: è¯¥æœ¨é©¬ä¼ªè£…æˆ &quot;Flash Player&quot; æˆ– &quot;ç³»ç»Ÿæ›´æ–°&quot; åº”ç”¨ã€‚
<strong>è¡Œä¸º</strong>: è¯±å¯¼ç”¨æˆ·å¼€å¯â€œæ— éšœç¢æœåŠ¡â€ï¼Œç„¶ååˆ©ç”¨è¯¥æƒé™è¿›è¡Œç‚¹å‡»åŠ«æŒã€è¦†ç›–æ”»å‡» (Overlay Attack)ï¼Œçªƒå–é“¶è¡Œ App çš„è´¦å·å¯†ç ï¼Œå¹¶æ‹¦æˆªçŸ­ä¿¡éªŒè¯ç ã€‚</p>
<hr />
<h2>è¯¦ç»†åˆ†ææµç¨‹</h2>
<h2># ç¬¬ 1 æ­¥ï¼šé™æ€åˆ†æ (Manifest &amp; æƒé™)</h2>
<p>ä½¿ç”¨ <code>jadx</code> æ‰“å¼€ APKï¼Œé¦–å…ˆæŸ¥çœ‹ <code>AndroidManifest.xml</code>ã€‚</p>
<ul>
<li><strong>å…³é”®å‘ç°</strong>:</li>
</ul>
<ol>
<li><strong>æ•æ„Ÿæƒé™</strong>:</li>
</ol>
<ul>
<li><code>android.permission.BIND_ACCESSIBILITY_SERVICE</code> (æ— éšœç¢æœåŠ¡ - æ ¸å¿ƒæƒé™)</li>
<li><code>android.permission.RECEIVE_SMS</code> (æ¥æ”¶çŸ­ä¿¡)</li>
<li><code>android.permission.READ_SMS</code> (è¯»å–çŸ­ä¿¡)</li>
<li><code>android.permission.SYSTEM_ALERT_WINDOW</code> (æ‚¬æµ®çª— - ç”¨äºè¦†ç›–æ”»å‡»)</li>
<li><code>android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS</code> (å¿½ç•¥ç”µæ± ä¼˜åŒ– - ä¿æ´»)</li>
</ul>
<ol start="2">
<li><strong>å…¥å£ç‚¹ (Entry Points)</strong>:</li>
</ol>
<ul>
<li>å‘ç°ä¸€ä¸ª <code>MainActivity</code>ï¼Œä½†ä»£ç å¾ˆç®€å•ï¼Œåªæ˜¯è¯·æ±‚æƒé™ã€‚</li>
<li>å‘ç°ä¸€ä¸ª <code>MyAccessibilityService</code>ï¼Œç»§æ‰¿è‡ª <code>AccessibilityService</code>ï¼Œè¿™æ˜¯æ ¸å¿ƒé€»è¾‘æ‰€åœ¨ã€‚</li>
</ul>
<h2># ç¬¬ 2 æ­¥ï¼šåˆ†ææ— éšœç¢æœåŠ¡ (Accessibility Service)</h2>
<p>å®šä½åˆ° <code>MyAccessibilityService</code> ç±»ï¼Œé‡ç‚¹åˆ†æ <code>onAccessibilityEvent</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-java">public void onAccessibilityEvent(AccessibilityEvent event) {
String packageName = event.getPackageName().toString();

// 1. Auto grant permissions (Self-Protection &amp; Persistence)
if (packageName.equals(&quot;com.android.settings&quot;)) {
// If user opens settings page to uninstall or disable permissions, malware will auto click &quot;Back&quot; or &quot;Cancel&quot;
performGlobalAction(GLOBAL_ACTION_BACK);
}

// 2. Monitor target banking apps
if (TARGET_BANK_APPS.contains(packageName)) {
// Detected victim opened banking app
showOverlay(packageName);
}

// 3. Keyboard recording (Keylogging)
if (event.getEventType() == AccessibilityEvent.TYPE_VIEW_TEXT_CHANGED) {
String text = event.getText().toString();
logKey(text);
}
}

</code></pre>
<p><strong>çªƒå–</strong>: ç”¨æˆ·ä»¥ä¸ºè‡ªå·±åœ¨ç™»å½•é“¶è¡Œï¼Œå®é™…ä¸Šæ˜¯åœ¨æœ¨é©¬çš„ WebView ä¸­è¾“å…¥äº†è´¦å·å¯†ç ã€‚æœ¨é©¬é€šè¿‡ JavaScript Interface å°†è¾“å…¥çš„æ•°æ®ä¼ å› Java å±‚ï¼Œç„¶åä¸Šä¼ æœåŠ¡å™¨ã€‚</p>
<h2># ç¬¬ 4 æ­¥ï¼šçŸ­ä¿¡æ‹¦æˆª (SMS Stealing)</h2>
<p>åˆ†æ <code>SmsReceiver</code> ç±»ã€‚</p>
<pre><code class="language-java">public class SmsReceiver extends BroadcastReceiver {
@Override
public void onReceive(Context context, Intent intent) {
Object[] pdus = (Object[]) intent.getExtras().get(&quot;pdus&quot;);
for (Object pdu : pdus) {
SmsMessage sms = SmsMessage.createFromPdu((byte[]) pdu);
String body = sms.getMessageBody();
String sender = sms.getOriginatingAddress();

// Upload SMS to C2 Server
uploadSmsToC2(sender, body);

// If SMS contains &quot;verification code&quot; or other key words, intercept the broadcast so user cannot see it
if (is2FACode(body)) {
abortBroadcast();
}
}
}
}

</code></pre>
<p><strong>èµ„æºè§£å¯†</strong>: æœ‰æ—¶ C2 åœ°å€è¢«åŠ å¯†å­˜å‚¨åœ¨ <code>assets</code> ä¸‹çš„å›¾ç‰‡æˆ–æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ DGA (åŸŸåç”Ÿæˆç®—æ³•) åŠ¨æ€ç”Ÿæˆã€‚
<strong>Native åˆ†æ</strong>: è¶Šæ¥è¶Šå¤šçš„æœ¨é©¬å°† C2 åœ°å€å’Œé€šä¿¡é€»è¾‘éšè—åœ¨ SO åº“ä¸­ã€‚</p>
<ol start="2">
<li><strong>é€šä¿¡åè®®</strong>:</li>
</ol>
<p><strong>HTTP/HTTPS</strong>: æŠ“åŒ…åˆ†æ POST è¯·æ±‚ã€‚
<strong>WebSocket</strong>: ç”¨äºå®æ—¶æ§åˆ¶ã€‚
<strong>Telegram Bot API</strong>: å¾ˆå¤šæ–°å‹æœ¨é©¬åˆ©ç”¨ Telegram Bot ä½œä¸º C2ï¼Œå› ä¸º Telegram çš„æµé‡é€šå¸¸ä¸ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªï¼Œä¸” HTTPS éš¾ä»¥è§£å¯†ã€‚</p>
<ul>
<li><strong>Frida Hook ç¤ºä¾‹ (æ‹¦æˆª Telegram API)</strong>:<pre><code class="language-javascript">// Assume malware uses OkHttp
var OkHttpClient = Java.use(&quot;okhttp3.OkHttpClient&quot;);
OkHttpClient.newCall.implementation = function (request) {
  var url = request.url().toString();
  if (url.includes(&quot;api.telegram.org&quot;)) {
    console.log(&quot;[!] Detected Telegram C2 Communication: &quot; + url);
  }
  return this.newCall(request);
};
</code></pre>
</li>
</ul>
<pre><code>
æœ¨é©¬ä½œè€…ä¹Ÿä¼šä½¿ç”¨å„ç§æ‰‹æ®µé˜²æ­¢è¢«é€†å‘ï¼š
* **æ¨¡æ‹Ÿå™¨æ£€æµ‹**: æ£€æŸ¥ `Build.FINGERPRINT`, `Build.MODEL` ç­‰ã€‚
* **åŠ å£³**: ä½¿ç”¨å…è´¹æˆ–å•†ä¸šçš„åŠ å›ºæœåŠ¡ã€‚
* **åŠ¨æ€åŠ è½½**: æ ¸å¿ƒ `dex` æ–‡ä»¶è¢«åŠ å¯†å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†åŠ è½½ (DexClassLoader)ã€‚
---
## æ€»ç»“

åˆ†æé“¶è¡Œæœ¨é©¬çš„å…³é”®åœ¨äºç†è§£å…¶**æ”»å‡»é“¾ (Kill Chain)**ï¼š
1. **Infection**: è¯±å¯¼å®‰è£…ã€‚
2. **Persistence**: è·å–æ— éšœç¢æƒé™ã€ä¿æ´»ã€‚
3. **Stealing**: è¦†ç›–æ”»å‡»çªƒå–å‡­è¯ã€æ‹¦æˆªçŸ­ä¿¡ã€‚
4. **Exfiltration**: å°†æ•°æ®å›ä¼  C2ã€‚

é€†å‘å·¥ç¨‹å¸ˆçš„ä»»åŠ¡æ˜¯é˜»æ–­è¿™ä¸€é“¾æ¡ï¼Œæå– IOC (Indicators of Compromiseï¼Œå¦‚ C2 åŸŸåã€æ–‡ä»¶ Hash)ï¼Œå¹¶ååŠ©å¼€å‘æŸ¥æ€ç­–ç•¥ã€‚
</code></pre>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">ğŸ“š Reference</h1>
                    
                                            <div class="section" id="section-58">
                                                <h2>58. APK Structure</h2>
                                                <h1>APK æ–‡ä»¶ç»“æ„è¯¦è§£</h1>
<h2>APK (Android Package) æ˜¯ Android æ“ä½œç³»ç»Ÿç”¨äºåˆ†å‘å’Œå®‰è£…ç§»åŠ¨åº”ç”¨çš„æ–‡ä»¶æ ¼å¼ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP å½’æ¡£æ–‡ä»¶ï¼ŒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä»£ç ã€èµ„æºã€è¯ä¹¦ç­‰ã€‚ç†è§£å…¶å†…éƒ¨ç»“æ„æ˜¯é€†å‘å·¥ç¨‹å’Œå®‰å…¨åˆ†æçš„ç¬¬ä¸€æ­¥ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#apk-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3">APK æ–‡ä»¶ç»“æ„è¯¦è§£</a><ul>
<li><a href="#apk-android-package-%E6%98%AF-android-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%94%A8%E4%BA%8E%E5%88%86%E5%8F%91%E5%92%8C%E5%AE%89%E8%A3%85%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%AE%83%E6%9C%AC%E8%B4%A8%E4%B8%8A%E6%98%AF%E4%B8%80%E4%B8%AA-zip-%E5%BD%92%E6%A1%A3%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%BA%86%E5%BA%94%E7%94%A8%E7%9A%84%E6%89%80%E6%9C%89%E4%BB%A3%E7%A0%81%E8%B5%84%E6%BA%90%E8%AF%81%E4%B9%A6%E7%AD%89%E7%90%86%E8%A7%A3%E5%85%B6%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84%E6%98%AF%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%92%8C%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AD%A5">APK (Android Package) æ˜¯ Android æ“ä½œç³»ç»Ÿç”¨äºåˆ†å‘å’Œå®‰è£…ç§»åŠ¨åº”ç”¨çš„æ–‡ä»¶æ ¼å¼ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP å½’æ¡£æ–‡ä»¶ï¼ŒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä»£ç ã€èµ„æºã€è¯ä¹¦ç­‰ã€‚ç†è§£å…¶å†…éƒ¨ç»“æ„æ˜¯é€†å‘å·¥ç¨‹å’Œå®‰å…¨åˆ†æçš„ç¬¬ä¸€æ­¥ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#apk-%E6%A6%82%E8%A7%88">APK æ¦‚è§ˆ</a><ul>
<li><a href="#classesdex"><code>classes.dex</code></a></li>
<li><a href="#resourcesarsc"><code>resources.arsc</code></a></li>
<li><a href="#res"><code>res/</code></a></li>
<li><a href="#lib"><code>lib/</code></a></li>
<li><a href="#assets"><code>assets/</code></a></li>
<li><a href="#meta-inf"><code>META-INF/</code></a></li>
</ul>
</li>
<li><a href="#apk-%E5%88%86%E6%9E%90%E6%B5%81%E7%A8%8B">APK åˆ†ææµç¨‹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>APK æ¦‚è§ˆ</h3>
<p>ä¸€ä¸ªæ ‡å‡†çš„ APK æ–‡ä»¶ï¼Œå½“ç”¨è§£å‹ç¼©å·¥å…·æ‰“å¼€æ—¶ï¼Œé€šå¸¸ä¼šçœ‹åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<pre><code>â”œâ”€â”€ resources.arsc # [Required] Pre-compiled resource file, index for strings, layouts, etc.
â”œâ”€â”€ res/ # [Required] Uncompiled resource directory for icons, layout XMLs, etc.
â”œâ”€â”€ lib/ # [Optional] Directory for native libraries (.so files)
â”œâ”€â”€ assets/ # [Optional] Directory for raw app assets
â””â”€â”€ META-INF/ # [Required] Directory for app signature and certificate information

</code></pre>
<ul>
<li><p><strong>åŒ…å (Package Name)</strong>: åº”ç”¨åœ¨ç³»ç»Ÿä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ (e.g., <code>com.example.app</code>)ã€‚</p>
</li>
<li><p><strong>ç»„ä»¶ (Components)</strong>: å£°æ˜æ‰€æœ‰çš„å››å¤§ç»„ä»¶ï¼š</p>
</li>
<li><p><code>Activity</code>: ç”¨æˆ·ç•Œé¢ã€‚</p>
</li>
<li><p><code>Service</code>: åå°æœåŠ¡ã€‚</p>
</li>
<li><p><code>BroadcastReceiver</code>: å¹¿æ’­æ¥æ”¶å™¨ã€‚</p>
</li>
<li><p><code>ContentProvider</code>: å†…å®¹æä¾›è€…ã€‚</p>
</li>
<li><p><strong>æƒé™ (Permissions)</strong>: å£°æ˜åº”ç”¨éœ€è¦å‘ç³»ç»Ÿç”³è¯·çš„æƒé™ (e.g., <code>android.permission.INTERNET</code>)ã€‚</p>
</li>
<li><p><strong>å…¥å£ç‚¹ (Entry Point)</strong>: æŒ‡å®šå“ªä¸ª Activity æ˜¯åº”ç”¨çš„å¯åŠ¨å…¥å£ï¼ˆ<code>LAUNCHER</code> Activityï¼‰ã€‚</p>
</li>
<li><p><strong>SDK ç‰ˆæœ¬</strong>: æŒ‡å®šæœ€ä½æ”¯æŒçš„ SDK ç‰ˆæœ¬å’Œç›®æ ‡ SDK ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>åˆ†ææç¤º*: å¿…é¡»ä½¿ç”¨ <code>apktool</code> æˆ– <code>jadx</code> ç­‰å·¥å…·å°†å…¶è§£ç ä¸ºäººç±»å¯è¯»çš„ XML æ ¼å¼ã€‚ç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ˜¯ä¹±ç ã€‚</p>
</li>
</ul>
<h4><code>classes.dex</code></h4>
<p>æˆ‘ä»¬å·²ç»åœ¨ <code>dex.md</code> ä¸­è¯¦ç»†è®¨è®ºè¿‡ã€‚è¿™æ˜¯ç”± Java/Kotlin ä»£ç ç¼–è¯‘ã€è½¬æ¢åç”Ÿæˆçš„ Dalvik è™šæ‹Ÿæœºå­—èŠ‚ç ã€‚åº”ç”¨çš„æ‰€æœ‰é€»è¾‘éƒ½åœ¨è¿™é‡Œã€‚å¦‚æœåº”ç”¨æ–¹æ³•æ•°è¶…è¿‡ 65536 ä¸ªï¼Œå°±ä¼šæœ‰ <code>classes2.dex</code>, <code>classes3.dex</code> ç­‰æ–‡ä»¶ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: ä½¿ç”¨ <code>jadx</code> å¯ä»¥å°†å…¶åç¼–è¯‘ä¸º Java ä»£ç ï¼Œä½¿ç”¨ <code>baksmali</code> å¯ä»¥åæ±‡ç¼–ä¸º Smali ä»£ç ã€‚</li>
</ul>
<h4><code>resources.arsc</code></h4>
<p>è¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶èµ„æºç´¢å¼•è¡¨ã€‚Android ç³»ç»Ÿä½¿ç”¨å®ƒæ¥å¿«é€ŸæŸ¥æ‰¾å’ŒåŒ¹é…èµ„æºã€‚å®ƒåŒ…å«äº†ä¸€ä¸ªä»èµ„æº ID åˆ°å…·ä½“èµ„æºæ–‡ä»¶ï¼ˆæˆ–å­—ç¬¦ä¸²å€¼ï¼‰çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ä»£ç ä¸­è°ƒç”¨ <code>R.string.app_name</code> æ—¶ï¼Œç³»ç»Ÿé€šè¿‡ <code>resources.arsc</code> æ‰¾åˆ° <code>app_name</code> å¯¹åº”çš„å­—ç¬¦ä¸²å€¼ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: <code>apktool</code> å¯ä»¥è§£ç æ­¤æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å­—ç¬¦ä¸²ç­‰èµ„æºè¿˜åŸåˆ° <code>res/values/strings.xml</code> ç­‰æ–‡ä»¶ä¸­ã€‚ç›´æ¥æŸ¥çœ‹æ˜¯äºŒè¿›åˆ¶æ ¼å¼ã€‚</li>
</ul>
<h4><code>res/</code></h4>
<p>å­˜æ”¾<strong>æœªç¼–è¯‘</strong>çš„èµ„æºæ–‡ä»¶ï¼Œè¿™äº›èµ„æºåœ¨æ‰“åŒ…æ—¶å¤§å¤šä¿æŒåŸæ ·æˆ–åªè¿›è¡Œç®€å•å¤„ç†ã€‚ç›®å½•ç»“æ„ä¸ Android Studio é¡¹ç›®ä¸­çš„ <code>res</code> ç›®å½•ç±»ä¼¼ã€‚</p>
<ul>
<li><p><code>res/drawable/</code>: å›¾ç‰‡èµ„æºã€‚</p>
</li>
<li><p><code>res/layout/</code>: å¸ƒå±€ XML æ–‡ä»¶ã€‚</p>
</li>
<li><p><code>res/xml/</code>: ä»»æ„ XML æ–‡ä»¶ã€‚</p>
</li>
<li><p><code>res/raw/</code>: ä»»æ„åŸå§‹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
</li>
<li><p>åˆ†ææç¤º*: è¿™é‡Œçš„å¸ƒå±€ XML æ–‡ä»¶è™½ç„¶å¯è¯»ï¼Œä½†å®ƒä»¬å¼•ç”¨çš„å­—ç¬¦ä¸²ç­‰èµ„æºæ˜¯ä»¥ <code>@string/app_name</code> çš„å½¢å¼å­˜åœ¨çš„ï¼Œéœ€è¦ç»“åˆ <code>resources.arsc</code> æ‰èƒ½å®Œå…¨ç†è§£ã€‚</p>
</li>
</ul>
<h4><code>lib/</code></h4>
<p>å­˜æ”¾åº”ç”¨ä½¿ç”¨çš„ C/C++ åŸç”Ÿåº“ï¼ˆ<code>.so</code> æ–‡ä»¶ï¼‰ã€‚ä¸ºäº†é€‚é…ä¸åŒçš„ CPU æ¶æ„ï¼Œå®ƒé€šå¸¸åŒ…å«å¤šä¸ªå­ç›®å½•ã€‚</p>
<ul>
<li><p><code>armeabi-v7a</code>: é€‚ç”¨äº 32 ä½çš„ ARM æ¶æ„ã€‚</p>
</li>
<li><p><code>arm64-v8a</code>: é€‚ç”¨äº 64 ä½çš„ ARM æ¶æ„ (ç›®å‰ä¸»æµ)ã€‚</p>
</li>
<li><p><code>x86</code>: é€‚ç”¨äº 32 ä½çš„ x86 æ¶æ„ï¼ˆå¸¸è§äºæ¨¡æ‹Ÿå™¨ï¼‰ã€‚</p>
</li>
<li><p><code>x86_64</code>: é€‚ç”¨äº 64 ä½çš„ x86 æ¶æ„ï¼ˆå¸¸è§äºæ¨¡æ‹Ÿå™¨ï¼‰ã€‚</p>
</li>
<li><p>åˆ†ææç¤º*: æ ¸å¿ƒçš„åŠ å¯†ã€è§£å¯†ã€æ ¸å¿ƒç®—æ³•æˆ–æ¸¸æˆå¼•æ“å¸¸å¸¸åœ¨è¿™é‡Œå®ç°ã€‚éœ€è¦ä½¿ç”¨ <code>IDA Pro</code>, <code>Ghidra</code>, <code>Binary Ninja</code> ç­‰å·¥å…·è¿›è¡Œé€†å‘åˆ†æã€‚</p>
</li>
</ul>
<h4><code>assets/</code></h4>
<p>è¿™æ˜¯ä¸€ä¸ª&quot;åŸå°ä¸åŠ¨&quot;çš„èµ„æºç›®å½•ã€‚ä¸ <code>res/raw</code> ç±»ä¼¼ï¼Œè¿™é‡Œçš„ä»»ä½•æ–‡ä»¶åœ¨æ‰“åŒ…æ—¶éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå¤„ç†ã€‚å¼€å‘è€…é€šå¸¸ç”¨å®ƒæ¥å­˜æ”¾æ¸¸æˆèµ„æºã€é…ç½®æ–‡ä»¶ã€å­—ä½“ã€HTML/JS/CSS ç­‰ã€‚</p>
<ul>
<li>åˆ†ææç¤º*: æ£€æŸ¥æ­¤ç›®å½•æ˜¯å¦æœ‰æ•æ„Ÿçš„é…ç½®æ–‡ä»¶ã€å¯†é’¥æˆ– Web èµ„æºã€‚</li>
</ul>
<h4><code>META-INF/</code></h4>
<p>å­˜æ”¾åº”ç”¨çš„ç­¾åä¿¡æ¯ï¼Œç”¨äºéªŒè¯ APK çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</p>
<ul>
<li><p><code>CERT.SF</code>: APK ä¸­æ¯ä¸ªæ–‡ä»¶çš„æ‘˜è¦ï¼ˆå“ˆå¸Œå€¼ï¼‰ã€‚</p>
</li>
<li><p><code>CERT.RSA</code>: åŒ…å«ç”¨äºç­¾ç½² <code>CERT.SF</code> çš„å…¬é’¥å’Œè¯ä¹¦ã€‚</p>
</li>
<li><p><code>MANIFESF.MF</code>: åŒ…å« APK ä¸­æ¯ä¸ªæ–‡ä»¶çš„åç§°åŠå…¶ SHA-256 å“ˆå¸Œå€¼ã€‚</p>
</li>
<li><p><strong>ç­¾åæœºåˆ¶</strong>:</p>
</li>
</ul>
<ol>
<li>è®¡ç®— APK ä¸­æ¯ä¸ªæ–‡ä»¶çš„å“ˆå¸Œï¼Œå¹¶è®°å½•åœ¨ <code>MANIFESF.MF</code>ã€‚</li>
<li>è®¡ç®— <code>MANIFESF.MF</code> æ•´ä¸ªæ–‡ä»¶çš„å“ˆå¸Œï¼Œå¹¶è®°å½•åœ¨ <code>CERT.SF</code>ã€‚</li>
<li>ç”¨å¼€å‘è€…çš„ç§é’¥å¯¹ <code>CERT.SF</code> è¿›è¡Œç­¾åï¼Œç”Ÿæˆ <code>CERT.RSA</code>ã€‚</li>
</ol>
<p>å½“ç³»ç»Ÿå®‰è£… APK æ—¶ï¼Œä¼šç”¨ <code>CERT.RSA</code> ä¸­çš„å…¬é’¥æ¥éªŒè¯ç­¾åï¼Œç¡®ä¿æ–‡ä»¶è‡ªç­¾ååæœªè¢«ç¯¡æ”¹ã€‚</p>
<ul>
<li><strong>åˆ†ææç¤º</strong>: å¯¹ APK è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼ˆåŒ…æ‹¬é‡æ‰“åŒ…ï¼‰åï¼Œéƒ½å¿…é¡»ç”¨è‡ªå·±çš„å¯†é’¥é‡æ–°ç­¾åï¼Œå¦åˆ™å®‰è£…ä¼šå¤±è´¥ã€‚</li>
</ul>
<hr />
<h3>APK åˆ†ææµç¨‹</h3>
<ol>
<li><strong>è§£åŒ…</strong>: ä½¿ç”¨ <code>apktool d myapp.apk</code> æˆ–ç›´æ¥ç”¨ <code>unzip</code> å‘½ä»¤è§£å‹ã€‚<code>apktool</code> æ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒèƒ½æ­£ç¡®è§£ç  <code>AndroidManifest.xml</code> å’Œ <code>resources.arsc</code>ã€‚</li>
<li><strong>é™æ€åˆ†æ</strong>:</li>
</ol>
<ul>
<li><p>ç”¨ <code>jadx-gui myapp.apk</code> æ‰“å¼€ï¼Œç›´æ¥æµè§ˆåç¼–è¯‘çš„ Java ä»£ç å’Œèµ„æºã€‚</p>
</li>
<li><p>é˜…è¯» <code>AndroidManifest.xml</code>ï¼Œäº†è§£å…¶ä¸»è¦ç»„ä»¶ã€æƒé™å’Œå…¥å£ç‚¹ã€‚</p>
</li>
<li><p>æ£€æŸ¥ <code>assets/</code> å’Œ <code>lib/</code> ç›®å½•ï¼Œå¯»æ‰¾å…³é”®é…ç½®æ–‡ä»¶æˆ–åŸç”Ÿåº“ã€‚</p>
</li>
</ul>
<ol start="3">
<li><strong>åŠ¨æ€åˆ†æ</strong>: ä½¿ç”¨ <code>adb</code> å®‰è£…åº”ç”¨ï¼Œå¹¶ç”¨ <code>frida</code> æˆ– <code>Xposed</code> è¿›è¡Œ Hookï¼Œè§‚å¯Ÿå…¶è¿è¡Œæ—¶è¡Œä¸ºã€‚</li>
</ol>

                                            </div>
                                            
                                            <div class="section" id="section-59">
                                                <h2>59. Android Components</h2>
                                                <hr />
<h1>android å››å¤§ç»„ä»¶</h1>
<h2>Android çš„åº”ç”¨æ¡†æ¶æ ¸å¿ƒç”±å››ä¸ªåŸºæœ¬ç»„ä»¶æ„æˆã€‚æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œç³»ç»Ÿå’Œåº”ç”¨å¯ä»¥é€šè¿‡å®ƒè¿›å…¥ä½ çš„ Appã€‚ç†è§£è¿™å››ä¸ªç»„ä»¶çš„èŒè´£å’Œç”Ÿå‘½å‘¨æœŸæ˜¯è¿›è¡Œä»»ä½• Android å¼€å‘æˆ–é€†å‘åˆ†æçš„åŸºç¡€ã€‚</h2>
<h2>1. æ´»åŠ¨ (Activity)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: Activity æ˜¯ç”¨æˆ·ç•Œé¢çš„å•ä¸€å±å¹•ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå¯ä»¥è¿›è¡Œäº¤äº’çš„æ“ä½œç•Œé¢ã€‚ä¸€ä¸ª App é€šå¸¸ç”±å¤šä¸ªç›¸äº’å…³è”çš„ Activity ç»„æˆã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>UI æ‰¿è½½</strong>: è´Ÿè´£ç»˜åˆ¶ç”¨æˆ·ç•Œé¢ã€æ‰¿è½½ <code>View</code> å’Œ <code>ViewGroup</code>ã€‚</li>
<li><strong>ç”¨æˆ·äº¤äº’</strong>: å“åº”ç”¨æˆ·çš„ç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥ç­‰äº‹ä»¶ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>: ç®¡ç†ä»åˆ›å»ºåˆ°é”€æ¯çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä»¥å“åº”ç³»ç»ŸçŠ¶æ€çš„å˜åŒ–ï¼ˆå¦‚æ¥ç”µã€å±å¹•æ—‹è½¬ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>:</p>
<p>ä¸€ä¸ª Activity å…·æœ‰æ¸…æ™°çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ï¼Œè¿™å¯¹äºé€†å‘åˆ†æè‡³å…³é‡è¦ï¼Œå› ä¸ºæ ¸å¿ƒé€»è¾‘ï¼ˆå¦‚æ•°æ®åŠ è½½ã€UI æ›´æ–°ï¼‰å¸¸å¸¸åœ¨è¿™äº›æ–¹æ³•ä¸­è¢«è§¦å‘ã€‚</p>
<ul>
<li><code>onCreate()</code>: <strong>Activity è¢«åˆ›å»º</strong>ã€‚è¿™æ˜¯æœ€é‡è¦çš„å›è°ƒï¼Œé€šå¸¸åœ¨è¿™é‡Œè¿›è¡Œå¸ƒå±€åŠ è½½ (<code>setContentView</code>)ã€æ•°æ®åˆå§‹åŒ–ã€äº‹ä»¶ç»‘å®šç­‰ã€‚</li>
<li><code>onStart()</code>: Activity å˜å¾—å¯è§ï¼Œä½†è¿˜ä¸èƒ½ä¸ç”¨æˆ·äº¤äº’ã€‚</li>
<li><code>onResume()</code>: <strong>Activity åˆ°è¾¾å‰å°</strong>ï¼Œå¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ Hook UI ç›¸å…³é€»è¾‘çš„ç»ä½³ä½ç½®ã€‚</li>
<li><code>onPause()</code>: Activity å³å°†è¿›å…¥åå°ï¼Œä¸å†æ˜¯ç„¦ç‚¹ã€‚é€šå¸¸åœ¨è¿™é‡Œä¿å­˜æœªæäº¤çš„æ•°æ®ã€‚</li>
<li><code>onStop()</code>: Activity å®Œå…¨ä¸å¯è§ã€‚</li>
<li><code>onDestroy()</code>: Activity å³å°†è¢«é”€æ¯ã€‚</li>
<li><code>onRestart()</code>: Activity ä»åœæ­¢çŠ¶æ€é‡æ–°å¯åŠ¨ã€‚</li>
</ul>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>Hook <code>onCreate()</code> æˆ– <code>onResume()</code> æ˜¯åˆ†æä¸€ä¸ªæ–°é¡µé¢çš„æ ‡å‡†èµ·ç‚¹ã€‚</li>
<li>é€šè¿‡ <code>adb shell dumpsys activity top</code> å¯ä»¥æŸ¥çœ‹å½“å‰ä½äºå‰å°çš„ Activity çš„ç±»åï¼Œè¿™æ˜¯å¿«é€Ÿå®šä½ç›®æ ‡é¡µé¢çš„å…³é”®å‘½ä»¤ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>2. æœåŠ¡ (Service)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: Service æ˜¯ä¸€ä¸ªåœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„ç»„ä»¶ã€‚å³ä½¿ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ï¼ŒæœåŠ¡ä»ç„¶å¯ä»¥ç»§ç»­å·¥ä½œã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>åå°ä»»åŠ¡</strong>: æ‰§è¡Œä¸éœ€è¦ UI çš„ä»»åŠ¡ï¼Œå¦‚æ’­æ”¾éŸ³ä¹ã€ä¸‹è½½æ–‡ä»¶ã€åŒæ­¥æ•°æ®ã€‚</li>
<li><strong>è¿›ç¨‹é—´é€šä¿¡ (IPC)</strong>: å¯ä»¥ä½œä¸ºæœåŠ¡ç«¯ï¼Œä¸ºå…¶ä»– App æä¾›åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li><p><strong>ç±»å‹</strong>:</p>
<ul>
<li><strong>å¯åŠ¨æœåŠ¡ (Started Service)</strong>: é€šè¿‡ <code>startService()</code> å¯åŠ¨ï¼Œä¸€æ—¦å¯åŠ¨ï¼ŒæœåŠ¡å°±å¯ä»¥æ— é™æœŸåœ°åœ¨åå°è¿è¡Œï¼Œç›´åˆ°å®ƒè‡ªå·±åœæ­¢æˆ–è¢«ç³»ç»Ÿé”€æ¯ã€‚</li>
<li><strong>ç»‘å®šæœåŠ¡ (Bound Service)</strong>: é€šè¿‡ <code>bindService()</code> å¯åŠ¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¥å£ï¼Œå…è®¸ç»„ä»¶ï¼ˆå¦‚ Activityï¼‰ä¸æœåŠ¡è¿›è¡Œäº¤äº’ã€å‘é€è¯·æ±‚ã€è·å–ç»“æœã€‚å½“æ‰€æœ‰ç»‘å®šçš„ç»„ä»¶éƒ½è§£ç»‘åï¼ŒæœåŠ¡å°±ä¼šè¢«é”€æ¯ã€‚</li>
<li><strong>å‰å°æœåŠ¡ (Foreground Service)</strong>: ä¸ºäº†é˜²æ­¢è¢«ç³»ç»Ÿè½»æ˜“æ€æ­»ï¼ŒService å¯ä»¥é€šè¿‡ <code>startForeground()</code> å°†è‡ªå·±æå‡ä¸ºå‰å°æœåŠ¡ï¼Œæ­¤æ—¶å¿…é¡»åœ¨çŠ¶æ€æ æ˜¾ç¤ºä¸€ä¸ªæŒç»­çš„é€šçŸ¥ï¼ˆä¾‹å¦‚éŸ³ä¹æ’­æ”¾é€šçŸ¥ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>å¾ˆå¤š App çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ¶ˆæ¯æ¨é€ã€ä½ç½®ä¸ŠæŠ¥ã€æ•°æ®åŒæ­¥ï¼‰éƒ½æ”¾åœ¨ Service ä¸­ã€‚</li>
<li>Hook Service çš„ <code>onStartCommand()</code> æˆ– <code>onBind()</code> æ–¹æ³•å¯ä»¥å¸®åŠ©ç†è§£å…¶åå°è¡Œä¸ºã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>3. å¹¿æ’­æ¥æ”¶å™¨ (Broadcast Receiver)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: å¹¿æ’­æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªç”¨äºå“åº”ç³»ç»ŸèŒƒå›´å¹¿æ’­é€šçŸ¥çš„ç»„ä»¶ã€‚è®¸å¤šå¹¿æ’­æºè‡ªç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œå±å¹•å…³é—­ã€ç½‘ç»œçŠ¶æ€æ”¹å˜ã€ç”µæ± ç”µé‡ä½ï¼‰ï¼Œä½†åº”ç”¨ä¹Ÿå¯ä»¥å‘èµ·è‡ªå®šä¹‰å¹¿æ’­ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>ç›‘å¬ç³»ç»Ÿäº‹ä»¶</strong>: è®© App èƒ½å¤Ÿå¯¹è®¾å¤‡çŠ¶æ€çš„å˜åŒ–åšå‡ºååº”ã€‚</li>
<li><strong>åº”ç”¨é—´é€šä¿¡</strong>: ä¸€ä¸ª App å¯ä»¥å‘å…¶ä»– App å‘é€å¹¿æ’­ï¼Œå®ç°ç®€å•çš„æ¶ˆæ¯é€šçŸ¥ã€‚</li>
</ul>
</li>
<li><p><strong>ç±»å‹</strong>:</p>
<ul>
<li><strong>é™æ€æ³¨å†Œ</strong>: åœ¨ <code>AndroidManifest.xml</code> ä¸­ä½¿ç”¨ <code>&lt;receiver&gt;</code> æ ‡ç­¾å£°æ˜ã€‚å³ä½¿ App æ²¡æœ‰è¿è¡Œï¼Œå½“å¹¿æ’­äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¹Ÿä¼šå”¤é†’ App æ¥å¤„ç†å®ƒã€‚</li>
<li><strong>åŠ¨æ€æ³¨å†Œ</strong>: åœ¨ä»£ç ä¸­é€šè¿‡ <code>Context.registerReceiver()</code> æ³¨å†Œã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸æ³¨å†Œå®ƒçš„ç»„ä»¶ï¼ˆå¦‚ Activityï¼‰ç›¸å…³è”ã€‚</li>
</ul>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>åˆ†æ <code>AndroidManifest.xml</code> ä¸­çš„é™æ€å¹¿æ’­æ¥æ”¶å™¨ï¼Œå¯ä»¥äº†è§£ App å…³å¿ƒå“ªäº›ç³»ç»Ÿäº‹ä»¶ã€‚</li>
<li>Hook <code>onReceive()</code> æ–¹æ³•æ˜¯æ•è·å’Œåˆ†æå¹¿æ’­å†…å®¹ï¼ˆIntentï¼‰çš„å…³é”®ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>4. å†…å®¹æä¾›å™¨ (Content Provider)</h2>
<ul>
<li><p><strong>æ¦‚å¿µ</strong>: å†…å®¹æä¾›å™¨ç”¨äºç®¡ç†ä¸€ç»„å…±äº«çš„åº”ç”¨æ•°æ®ã€‚å®ƒä»¥ä¸€ç§æ ‡å‡†åŒ–çš„æ¥å£ï¼Œå°†æ•°æ®æš´éœ²ç»™å…¶ä»–åº”ç”¨ã€‚æ•°æ®å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿã€SQLite æ•°æ®åº“æˆ–ä»»ä½•å…¶ä»–æŒä¹…åŒ–å­˜å‚¨ä½ç½®ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li><strong>æ•°æ®å…±äº«</strong>: æä¾›ä¸€ä¸ªå®‰å…¨ã€ç»Ÿä¸€çš„æ¥å£ï¼Œè®©å…¶ä»–åº”ç”¨å¯ä»¥æŸ¥è¯¢æˆ–ä¿®æ”¹æœ¬åº”ç”¨çš„æ•°æ®ã€‚</li>
<li><strong>æ•°æ®æŠ½è±¡</strong>: éšè—äº†åº•å±‚æ•°æ®çš„å­˜å‚¨ç»†èŠ‚ã€‚æ— è®ºæ•°æ®æ˜¯å­˜åœ¨æ•°æ®åº“è¿˜æ˜¯æ–‡ä»¶ä¸­ï¼Œå¯¹å¤–çš„æ¥å£éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li>
<li><strong>æƒé™æ§åˆ¶</strong>: å¯ä»¥ç²¾ç»†åœ°æ§åˆ¶å…¶ä»–åº”ç”¨å¯¹æ•°æ®çš„è¯»å†™æƒé™ã€‚</li>
</ul>
</li>
<li><p><strong>å·¥ä½œæ–¹å¼</strong>:</p>
<ul>
<li>é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„ <code>URI</code> (Uniform Resource Identifier) æ¥æ ‡è¯†æ•°æ®ã€‚ä¾‹å¦‚ <code>content://com.example.app.provider/users/10</code>ã€‚</li>
<li>å…¶ä»–åº”ç”¨ä½¿ç”¨ <code>ContentResolver</code> å¯¹è±¡ï¼Œé€šè¿‡ <code>query()</code>, <code>insert()</code>, <code>update()</code>, <code>delete()</code> ç­‰æ–¹æ³•ä¸ Content Provider è¿›è¡Œäº¤äº’ã€‚</li>
</ul>
</li>
<li><p><strong>é€†å‘åˆ‡å…¥ç‚¹</strong>:</p>
<ul>
<li>App çš„è”ç³»äººã€çŸ­ä¿¡ã€åª’ä½“åº“ç­‰éƒ½æ˜¯é€šè¿‡ Content Provider è®¿é—®çš„ã€‚</li>
<li>åˆ†æ <code>AndroidManifest.xml</code> ä¸­å£°æ˜çš„ <code>provider</code>ï¼Œå¯ä»¥æ‰¾åˆ° App å¯¹å¤–æš´éœ²äº†å“ªäº›æ•°æ®ã€‚</li>
<li>é€†å‘ App æ—¶ï¼Œå¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ª App æ¥è°ƒç”¨ç›®æ ‡ App çš„ Content Providerï¼Œä»è€Œè¯»å–æˆ–æ“çºµå…¶å†…éƒ¨æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<hr />

                                            </div>
                                            
                                            <div class="section" id="section-60">
                                                <h2>60. Android Manifest</h2>
                                                <h1>androidManifest.xml æ·±åº¦è§£æ</h1>
<h2><code>AndroidManifest.xml</code> æ˜¯ Android åº”ç”¨çš„&quot;å¤§è„‘&quot;å’Œ&quot;è“å›¾&quot;ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„é…ç½®æ–‡ä»¶ï¼Œä½äºæ¯ä¸ª APK çš„æ ¹ç›®å½•ä¸­ã€‚è¯¥æ–‡ä»¶å‘ Android æ„å»ºå·¥å…·ã€æ“ä½œç³»ç»Ÿå’Œ Google Play æè¿°äº†åº”ç”¨çš„åŸºæœ¬ä¿¡æ¯ã€ç»„ä»¶ã€æƒé™å’Œç¡¬ä»¶è¦æ±‚ã€‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™æ˜¯äº†è§£åº”ç”¨åŠŸèƒ½ã€å…¥å£ç‚¹å’Œå®‰å…¨è¾¹ç•Œçš„é¦–è¦åˆ‡å…¥ç‚¹ã€‚</h2>
<h2># æ ¸å¿ƒä½œç”¨ä¸ç‰¹æ€§</h2>
<ul>
<li><p><strong>å”¯ä¸€æ ‡è¯†</strong>: å®šä¹‰äº†åº”ç”¨çš„ Java åŒ…åï¼Œè¿™æ˜¯å®ƒåœ¨è®¾å¤‡å’Œ Google Play ä¸Šçš„å”¯ä¸€æ ‡è¯†ã€‚</p>
</li>
<li><p><strong>ç»„ä»¶å£°æ˜</strong>: å£°æ˜åº”ç”¨çš„æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼ˆå››å¤§ç»„ä»¶ï¼‰ã€‚ä»»ä½•æœªåœ¨æ­¤æ–‡ä»¶ä¸­å£°æ˜çš„ç»„ä»¶éƒ½å¯¹ç³»ç»Ÿä¸å¯è§ï¼Œä¹Ÿæ— æ³•è¿è¡Œã€‚</p>
</li>
<li><p><strong>æƒé™è¯·æ±‚</strong>: åˆ—å‡ºåº”ç”¨éœ€è¦è®¿é—®çš„å—ä¿æŠ¤éƒ¨åˆ† API æˆ–ç³»ç»Ÿèµ„æºæ‰€éœ€çš„æƒé™ã€‚</p>
</li>
<li><p><strong>ç¡¬ä»¶/è½¯ä»¶è¦æ±‚</strong>: å£°æ˜åº”ç”¨è¿è¡Œæ‰€éœ€çš„ç¡¬ä»¶åŠŸèƒ½ï¼ˆå¦‚æ‘„åƒå¤´ã€è“ç‰™ï¼‰å’Œæœ€ä½ Android API çº§åˆ«ã€‚</p>
</li>
<li><p><strong>å…¥å£ç‚¹å®šä¹‰</strong>: é€šè¿‡ <code>intent-filter</code> æŒ‡å®šå“ªä¸ª Activity æ˜¯åº”ç”¨çš„å¯åŠ¨å™¨ã€‚</p>
</li>
<li><p><strong>é‡è¦æç¤º</strong>: åŸå§‹çš„ <code>AndroidManifest.xml</code> æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚å¿…é¡»ä½¿ç”¨ <code>apktool</code>, <code>jadx</code>, <code>aapt</code> ç­‰å·¥å…·è§£ç åæ‰èƒ½é˜…è¯»ã€‚</p>
</li>
</ul>
<hr />
<h2># å…³é”®æ ‡ç­¾ (Tags) è¯¦è§£</h2>
<h3># <code>&lt;manifest&gt;</code></h3>
<p>æ ¹å…ƒç´ ã€‚å®ƒå¿…é¡»åŒ…å« <code>package</code> å±æ€§æ¥å®šä¹‰åº”ç”¨çš„å”¯ä¸€åŒ…åã€‚</p>
<pre><code class="language-xml">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
package=&quot;com.example.myapp&quot;&gt;
...
&lt;/manifest&gt;

</code></pre>
<ul>
<li><p><code>android:theme</code>: åº”ç”¨çš„å…¨å±€ä¸»é¢˜ã€‚</p>
</li>
<li><p><code>android:name</code>: æŒ‡å®š <code>Application</code> å­ç±»çš„åç§°ï¼Œå¸¸ç”¨äºåº”ç”¨åˆå§‹åŒ–ã€‚è¿™æ˜¯ Hook çš„ç»ä½³ç›®æ ‡ã€‚</p>
</li>
<li><p><code>android:debuggable</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> <code>true</code> è¡¨ç¤ºåº”ç”¨æ˜¯å¯è°ƒè¯•çš„ï¼Œå…è®¸ <code>adb</code> è¿æ¥å’Œä»»æ„ä»£ç æ‰§è¡Œã€‚å‘å¸ƒçš„ Release ç‰ˆæœ¬å¿…é¡»ä¸º <code>false</code>ã€‚</p>
</li>
<li><p><code>android:allowBackup</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> <code>true</code> å…è®¸ç”¨æˆ·é€šè¿‡ <code>adb backup</code> å¤‡ä»½åº”ç”¨æ•°æ®ã€‚å¦‚æœåº”ç”¨æ•°æ®æ•æ„Ÿï¼Œåº”è®¾ä¸º <code>false</code>ã€‚</p>
</li>
<li><p><code>android:networkSecurityConfig</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> æŒ‡å‘ç½‘ç»œå®‰å…¨é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ SSL Pinningã€è‡ªå®šä¹‰ CA ç­‰é«˜çº§ç½‘ç»œç­–ç•¥ã€‚</p>
</li>
</ul>
<h3># <code>&lt;activity&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª Activity (UI ç•Œé¢)ã€‚</p>
<ul>
<li><p><code>android:name</code>: Activity ç±»çš„åç§°ã€‚<code>.MyActivity</code> æ˜¯ <code>package.MyActivity</code> çš„ç®€å†™ã€‚</p>
</li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> <code>true</code> è¡¨ç¤ºè¯¥ Activity å¯ä»¥è¢«å…¶ä»–åº”ç”¨å¯åŠ¨ã€‚å¦‚æœè¯¥ Activity å¤„ç†æ•æ„Ÿæ•°æ®ä¸”æ— éœ€å¤–éƒ¨è°ƒç”¨ï¼Œåº”è®¾ä¸º <code>false</code>ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç»„ä»¶åŠ«æŒå’Œæ•°æ®æ³„éœ²ã€‚å¯¹äºåŒ…å« <code>LAUNCHER</code> intent-filter çš„ Activityï¼Œ<code>exported</code> é»˜è®¤ä¸º <code>true</code>ã€‚</p>
</li>
</ul>
<h3># <code>&lt;service&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª Service (åå°æœåŠ¡)ã€‚</p>
<ul>
<li><p><code>android:name</code>: Service ç±»çš„åç§°ã€‚</p>
</li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> <code>true</code> è¡¨ç¤ºè¯¥ Service å¯ä»¥è¢«å…¶ä»–åº”ç”¨ç»‘å®šæˆ–å¯åŠ¨ã€‚è§„åˆ™åŒ Activityã€‚</p>
</li>
</ul>
<h3># <code>&lt;receiver&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª BroadcastReceiver (å¹¿æ’­æ¥æ”¶å™¨)ã€‚</p>
<ul>
<li><p><code>android:name</code>: Receiver ç±»çš„åç§°ã€‚</p>
</li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> <code>true</code> è¡¨ç¤ºå®ƒå¯ä»¥æ¥æ”¶æ¥è‡ªç³»ç»Ÿæˆ–å…¶ä»–åº”ç”¨çš„å¹¿æ’­ã€‚</p>
</li>
</ul>
<h3># <code>&lt;provider&gt;</code></h3>
<p>å£°æ˜ä¸€ä¸ª ContentProvider (å†…å®¹æä¾›è€…)ï¼Œç”¨äºè·¨åº”ç”¨å…±äº«æ•°æ®ã€‚</p>
<ul>
<li><p><code>android:name</code>: Provider ç±»çš„åç§°ã€‚</p>
</li>
<li><p><code>android:authorities</code>: Provider çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯åŒ…ååŠ ä¸Šæè¿°æ€§åç¼€ã€‚</p>
</li>
<li><p><code>android:exported</code>: <strong>ï¼ˆå®‰å…¨å…³é”®ï¼‰</strong> <code>true</code> è¡¨ç¤ºå…¶ä»–åº”ç”¨å¯ä»¥è®¿é—®å…¶æ•°æ®ã€‚å¦‚æœ <code>minSdkVersion</code> æˆ– <code>targetSdkVersion</code> &gt;= 17ï¼Œé»˜è®¤å€¼ä¸º <code>false</code>ã€‚ä¸æ­£ç¡®çš„ <code>exported</code> è®¾ç½®å¯èƒ½å¯¼è‡´ SQL æ³¨å…¥æˆ–æ–‡ä»¶éå†æ¼æ´ã€‚</p>
</li>
</ul>
<h3># <code>&lt;uses-permission&gt;</code></h3>
<p>è¯·æ±‚åº”ç”¨è¿è¡Œæ‰€éœ€çš„æƒé™ã€‚è¿™æ˜¯åˆ†æåº”ç”¨è¡Œä¸ºçš„å…³é”®ã€‚</p>
<pre><code class="language-xml">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;

</code></pre>
<activity android:name=".MainActivity" android:exported="true">
<intent-filter>
<action android:name="android.intent.action.MAIN" />
<category android:name="android.intent.category.LAUNCHER" />
</intent-filter>
<intent-filter>
<action android:name="android.intent.action.VIEW" />
<category android:name="android.intent.category.DEFAULT" />
<data android:scheme="http" android:host="example.com" />
</intent-filter>
</activity>

<pre><code>
1. **ç¡®å®šå…¥å£ç‚¹**:

* å¯»æ‰¾ `MAIN/LAUNCHER` çš„ Activityã€‚

* å¯»æ‰¾ `android:name` å±æ€§å®šä¹‰çš„ `Application` å­ç±»ï¼Œè¿™æ˜¯æœ€æ—©æ‰§è¡Œä»£ç çš„åœ°æ–¹ã€‚

2. **è¯†åˆ«æ ¸å¿ƒåŠŸèƒ½**:

* é˜…è¯»æƒé™åˆ—è¡¨ (`&lt;uses-permission&gt;`)ï¼Œå¿«é€Ÿäº†è§£åº”ç”¨èƒ½åŠ›ã€‚

* æŸ¥çœ‹å£°æ˜çš„ Activitiesã€Servicesï¼Œæ¨æµ‹å…¶åŠŸèƒ½æ¨¡å—ã€‚

3. **å¯»æ‰¾æ”»å‡»é¢**:

* æ£€æŸ¥æ‰€æœ‰ç»„ä»¶çš„ `android:exported=&quot;true&quot;` å±æ€§ï¼Œè¿™äº›æ˜¯æ½œåœ¨çš„æ”»å‡»å…¥å£ã€‚

* åˆ†æ `intent-filter`ï¼Œç‰¹åˆ«æ˜¯è‡ªå®šä¹‰çš„ `scheme`ï¼Œå¯»æ‰¾ URL Scheme æ¼æ´ã€‚

* æ£€æŸ¥ `android:debuggable=&quot;true&quot;`ï¼Œå¦‚æœä¸º `true`ï¼Œå¯ä»¥ç›´æ¥é™„åŠ è°ƒè¯•å™¨ã€‚

* æ£€æŸ¥ `android:allowBackup=&quot;true&quot;`ï¼Œå°è¯• `adb backup` å¯¼å‡ºæ•°æ®ã€‚
---
## # å®‰å…¨é£é™©ä¸é…ç½®

* **ç»„ä»¶å¯¼å‡ºé£é™©**: é”™è¯¯åœ°å°†å†…éƒ¨ç»„ä»¶è®¾ç½®ä¸º `exported=&quot;true&quot;` æ˜¯æœ€å¸¸è§çš„ Android æ¼æ´ä¹‹ä¸€ã€‚

* **Webview é£é™©**: æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `WebView`ï¼Œå¹¶ç¡®è®¤æ˜¯å¦å¼€å¯äº† `setJavaScriptEnabled(true)`ï¼Œè¿™å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

* **File Provider è·¯å¾„éå†**: å¦‚æœ `ContentProvider` æ˜¯ `FileProvider`ï¼Œä¸æ­£ç¡®çš„é…ç½®å¯èƒ½å¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚

* **ç¡¬ç¼–ç å¯†é’¥**: è™½ç„¶ä¸åœ¨ Manifest ä¸­ï¼Œä½†åˆ†æååº”åœ¨ `res/values/strings.xml` æˆ–ä»£ç ä¸­å¯»æ‰¾ç¡¬ç¼–ç çš„ API å¯†é’¥æˆ– URLã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-61">
                                                <h2>61. Android Studio Debug Tools</h2>
                                                <hr />
<h1>android Studio è°ƒè¯•å·¥å…·é›†</h1>
<h2>Android Studio ä¸ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨ï¼Œå®ƒè¿˜é›†æˆäº†ä¸€å¥—å¼ºå¤§ã€å¯è§†åŒ–çš„è°ƒè¯•å’Œåˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿæå¤§åœ°æå‡å¼€å‘å’Œé€†å‘åˆ†æçš„æ•ˆç‡ã€‚ç†Ÿæ‚‰è¿™äº›å·¥å…·æ˜¯æ¯ä¸ª Android å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ã€‚</h2>
<h2>1. æ—¥å¿—çŒ« (Logcat)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>: Logcat æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæŸ¥çœ‹ Android ç³»ç»Ÿçš„æ—¥å¿—è¾“å‡ºã€‚Android Studio å°†å…¶å°è£…åœ¨ä¸€ä¸ªä¾¿æ·çš„çª—å£ä¸­ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹æ¥è‡ªç³»ç»Ÿå’Œæ‰€æœ‰åº”ç”¨çš„æ—¥å¿—ä¿¡æ¯ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:<ul>
<li><strong>å®æ—¶æ—¥å¿—æµ</strong>: æ˜¾ç¤ºæ¥è‡ªè®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨çš„è¿ç»­æ—¥å¿—ã€‚</li>
<li><strong>æ—¥å¿—çº§åˆ«è¿‡æ»¤</strong>: å¯ä»¥æŒ‰ Verbose, Debug, Info, Warn, Error, Assert ç­‰çº§åˆ«è¿›è¡Œè¿‡æ»¤ã€‚åœ¨è°ƒè¯•æ—¶ï¼Œé€šå¸¸å…³æ³¨ Error å’Œ Warn çº§åˆ«ã€‚</li>
<li><strong>è¿›ç¨‹/åº”ç”¨è¿‡æ»¤</strong>: å¯ä»¥åªæ˜¾ç¤ºå½“å‰æ­£åœ¨è°ƒè¯•çš„åº”ç”¨ï¼Œæˆ–ç‰¹å®šè¿›ç¨‹çš„æ—¥å¿—ã€‚</li>
<li><strong>å…³é”®è¯æœç´¢</strong>: å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾åˆ°ä½ å…³å¿ƒçš„æ—¥å¿—æ¡ç›®ã€‚</li>
<li><strong>å †æ ˆè·Ÿè¸ªç‚¹å‡»</strong>: å½“æ—¥å¿—ä¸­åŒ…å«å¼‚å¸¸å †æ ˆæ—¶ï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡»ç±»åå’Œè¡Œå·ï¼Œè·³è½¬åˆ°æºç çš„å¯¹åº”ä½ç½®ã€‚</li>
</ul>
</li>
<li><em>é€†å‘åº”ç”¨</em>:<ul>
<li>å¾ˆå¤š App åœ¨å¼€å‘é˜¶æ®µä¼šç•™ä¸‹å¤§é‡çš„è°ƒè¯•æ—¥å¿—ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚åŠ å¯†å‰çš„è¯·æ±‚å‚æ•°ã€æœåŠ¡å™¨è¿”å›çš„æ˜æ–‡ç­‰ã€‚</li>
<li>é€šè¿‡è§‚å¯Ÿ App åœ¨ç‰¹å®šæ“ä½œä¸‹çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥æ¨æ–­å…¶å†…éƒ¨çš„å·¥ä½œæµç¨‹ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>2. å¸ƒå±€æ£€æŸ¥å™¨ (Layout Inspector)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>: è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¯è§†åŒ–å·¥å…·ï¼Œå…è®¸ä½ å®æ—¶æ£€æŸ¥å’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„åº”ç”¨çš„è§†å›¾å±‚æ¬¡ç»“æ„ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:<ul>
<li><strong>3D è§†å›¾å±‚æ¬¡</strong>: ä»¥ 3D å¯æ—‹è½¬çš„è§†å›¾å±•ç¤ºå½“å‰ Activity çš„æ‰€æœ‰ <code>View</code> ç»„ä»¶æ˜¯å¦‚ä½•åµŒå¥—çš„ã€‚</li>
<li><strong>å±æ€§æŸ¥çœ‹</strong>: ç‚¹å‡»ä»»ä½•ä¸€ä¸ª <code>View</code>ï¼Œéƒ½å¯ä»¥å®æ—¶æŸ¥çœ‹å…¶æ‰€æœ‰çš„å±æ€§ï¼Œå¦‚ <code>ID</code>, <code>text</code>, <code>width</code>, <code>height</code>, <code>padding</code>, <code>color</code> ç­‰ã€‚</li>
<li><strong>å®æ—¶æ›´æ–°</strong>: åœ¨è®¾å¤‡ä¸Šæ“ä½œ UIï¼Œå¸ƒå±€æ£€æŸ¥å™¨ä¸­çš„è§†å›¾ä¼šå®æ—¶åŒæ­¥æ›´æ–°ã€‚</li>
<li><strong>å®šä½é‡å è§†å›¾</strong>: å¯ä»¥è½»æ¾å‘ç°è¢«å…¶ä»–è§†å›¾é®æŒ¡æˆ–å°ºå¯¸ä¸º 0 çš„ä¸å¯è§è§†å›¾ã€‚</li>
</ul>
</li>
<li><em>é€†å‘åº”ç”¨</em>:<ul>
<li>å¿«é€Ÿå®šä½ä¸€ä¸ªæŒ‰é’®æˆ–æ–‡æœ¬æ¡†çš„ <code>resource-id</code>ï¼Œè¿™æ˜¯ç¼–å†™ UIAutomator2 ç­‰è‡ªåŠ¨åŒ–è„šæœ¬çš„å…³é”®ã€‚</li>
<li>åˆ†æè‡ªå®šä¹‰ <code>View</code> çš„ç»˜åˆ¶æ–¹å¼å’Œå†…éƒ¨ç»“æ„ã€‚</li>
<li>ç†è§£ä¸€äº›åæˆªå›¾ã€åå½•å±æŠ€æœ¯æ˜¯å¦‚ä½•é€šè¿‡æ·»åŠ ä¸€ä¸ªé€æ˜çš„ <code>FLAG_SECURE</code> çª—å£æ¥å®ç°çš„ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>3. åº”ç”¨åˆ†æå™¨ (Profiler)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>: Profiler æ˜¯ä¸€å¥—ç”¨äºå®æ—¶åˆ†æåº”ç”¨æ€§èƒ½çš„å·¥å…·ï¼Œä¸»è¦å…³æ³¨ CPUã€å†…å­˜ã€ç½‘ç»œå’Œç”µé‡å››ä¸ªæ–¹é¢ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:<ul>
<li><strong>CPU Profiler</strong>:<ul>
<li><strong>æ–¹æ³•è¿½è¸ª (Method Tracing)</strong>: å¯ä»¥è®°å½•ä¸‹åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…æ‰€æœ‰å‡½æ•°çš„è°ƒç”¨æ ˆå’Œæ‰§è¡Œæ—¶é—´ï¼Œç”Ÿæˆç«ç„°å›¾ã€‚è¿™å¯¹äºå¯»æ‰¾æ€§èƒ½ç“¶é¢ˆè‡³å…³é‡è¦ã€‚</li>
<li><strong>ç³»ç»Ÿè°ƒç”¨è¿½è¸ª</strong>: å¯ä»¥æŸ¥çœ‹ App ä¸ç³»ç»Ÿå†…æ ¸çš„äº¤äº’æƒ…å†µã€‚</li>
</ul>
</li>
<li><strong>Memory Profiler</strong>:<ul>
<li><strong>å®æ—¶å†…å­˜å ç”¨</strong>: æ˜¾ç¤º App çš„ Java å †ã€Native å †å’Œå›¾å½¢å†…å­˜çš„å®æ—¶ä½¿ç”¨æƒ…å†µã€‚</li>
<li><strong>å †è½¬å‚¨ (Heap Dump)</strong>: å¯ä»¥æ•è·æŸä¸€æ—¶åˆ»çš„å†…å­˜å¿«ç…§ï¼Œå¹¶åˆ†æå…¶ä¸­æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ã€å¼•ç”¨å…³ç³»ã€‚</li>
<li><strong>å†…å­˜æ³„æ¼æ£€æµ‹</strong>: é•¿æœŸè¿è¡Œå¹¶è§‚å¯Ÿå†…å­˜æ›²çº¿ï¼Œå¯ä»¥å¸®åŠ©å®šä½å†…å­˜æ³„æ¼é—®é¢˜ã€‚</li>
</ul>
</li>
<li><strong>Network Profiler</strong>:<ul>
<li><strong>ç½‘ç»œè¯·æ±‚æ—¶é—´çº¿</strong>: ä»¥æ—¶é—´çº¿çš„å½¢å¼å±•ç¤º App å‘èµ·çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„å»ºç«‹æ—¶é—´ã€å‘é€æ—¶é—´å’Œæ¥æ”¶æ—¶é—´ã€‚</li>
<li><strong>è¯·æ±‚è¯¦æƒ…</strong>: å¯ä»¥æŸ¥çœ‹æ¯ä¸ªè¯·æ±‚çš„ URLã€è¯·æ±‚å¤´ã€å“åº”å¤´å’Œ Payloadã€‚<strong>ï¼ˆæ³¨æ„ï¼šå¯¹äº HTTPS æµé‡ï¼Œé»˜è®¤åªèƒ½çœ‹åˆ°åŠ å¯†åçš„å†…å®¹ï¼Œéœ€è¦é…åˆå…¶ä»–æŠ“åŒ…å·¥å…·ä½¿ç”¨ï¼‰</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><em>é€†å‘åº”ç”¨</em>:<ul>
<li><strong>æ–¹æ³•è¿½è¸ª</strong>: é€šè¿‡å¯¹ä¸€ä¸ªåŠ å¯†å‡½æ•°è¿›è¡Œè¿½è¸ªï¼Œå¯ä»¥å®Œæ•´åœ°äº†è§£å…¶å†…éƒ¨éƒ½è°ƒç”¨äº†å“ªäº›å­å‡½æ•°ï¼Œå¸®åŠ©ç†è§£å¤æ‚ç®—æ³•ã€‚</li>
<li><strong>å †è½¬å‚¨</strong>: åœ¨ App è§£å¯†å¹¶åŠ è½½äº†æŸäº›æ ¸å¿ƒæ•°æ®åˆ°å†…å­˜åï¼Œé€šè¿‡ Heap Dump å¯èƒ½ä¼šæ‰¾åˆ°è¿™äº›æ•°æ®å¯¹è±¡ï¼Œç”šè‡³æ˜¯å¯†é’¥å¯¹è±¡ã€‚</li>
<li><strong>ç½‘ç»œåˆ†æ</strong>: è™½ç„¶ä¸èƒ½è§£å¯† HTTPSï¼Œä½†å¯ä»¥å¿«é€Ÿäº†è§£ App åœ¨ä½•æ—¶ã€å‘å“ªäº›åŸŸåå‘èµ·äº†ç½‘ç»œè¯·æ±‚ï¼Œä¸ºç½‘ç»œæŠ“åŒ…æä¾›ç›®æ ‡ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>4. æ•°æ®åº“æ£€æŸ¥å™¨ (Database Inspector)</h2>
<ul>
<li><em>æ¦‚å¿µ</em>: å…è®¸ä½ å®æ—¶æ£€æŸ¥ã€æŸ¥è¯¢å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ä¸­çš„æ•°æ®åº“ï¼ˆSQLiteï¼‰ã€‚</li>
<li><em>æ ¸å¿ƒåŠŸèƒ½</em>:<ul>
<li><strong>å®æ—¶æ•°æ®æŸ¥çœ‹</strong>: å®æ—¶æ˜¾ç¤ºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨çš„å†…å®¹ã€‚</li>
<li><strong>è‡ªå®šä¹‰æŸ¥è¯¢</strong>: å¯ä»¥ç›´æ¥è¿è¡Œ SQL æŸ¥è¯¢è¯­å¥æ¥æ£€ç´¢æˆ–ä¿®æ”¹æ•°æ®ã€‚</li>
<li><strong>æ•°æ®ä¿®æ”¹</strong>: å¯ä»¥ç›´æ¥åœ¨å›¾å½¢ç•Œé¢ä¸­ä¿®æ”¹å­—æ®µçš„å€¼ã€‚</li>
<li><strong>ä¿æŒè¿æ¥</strong>: å³ä½¿ App è¿›ç¨‹è¢«æ€æ­»åé‡å¯ï¼Œæ£€æŸ¥å™¨ä¹Ÿèƒ½ä¿æŒè¿æ¥ã€‚</li>
</ul>
</li>
<li><em>é€†å‘åº”ç”¨</em>:<ul>
<li>å¾ˆå¤š App ä¼šå°†ç”¨æˆ·ä¿¡æ¯ã€é…ç½®ã€èŠå¤©è®°å½•ç­‰é‡è¦æ•°æ®å­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­ã€‚é€šè¿‡æ•°æ®åº“æ£€æŸ¥å™¨ï¼Œå¯ä»¥ä¸€ç›®äº†ç„¶åœ°åˆ†æå…¶æ•°æ®ç»“æ„å’Œå†…å®¹ã€‚</li>
<li>é€šè¿‡ä¿®æ”¹æ•°æ®åº“ä¸­çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œå°†ä¼šå‘˜çŠ¶æ€å­—æ®µä» 0 æ”¹ä¸º 1ï¼‰ï¼Œå¯ä»¥æµ‹è¯•å’ŒéªŒè¯ä¸€äº›æœ¬åœ°çš„ VIP åŠŸèƒ½ç»•è¿‡ã€‚</li>
</ul>
</li>
</ul>
<hr />

                                            </div>
                                            
                                            <div class="section" id="section-62">
                                                <h2>62. DEX Format</h2>
                                                <h1>DEX æ–‡ä»¶æƒå¨æŒ‡å—</h1>
<p>DEX (Dalvik Executable) æ–‡ä»¶æ˜¯ Android æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚å®ƒä»¬æ˜¯ä¸“é—¨ä¸ºåœ¨å†…å­˜å’Œå¤„ç†å™¨é€Ÿåº¦å—é™çš„è®¾å¤‡ä¸Šé«˜æ•ˆè¿è¡Œè€Œè®¾è®¡çš„ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨ DEX æ–‡ä»¶çš„å®šä¹‰ã€æ ¼å¼ã€è¿è¡ŒåŸç†ä»¥åŠç›¸å…³å·¥å…·ã€‚</p>
<p>!!! question &quot;æ€è€ƒï¼šç†è§£ DEX æ ¼å¼çš„å®æˆ˜ä»·å€¼&quot;
å¾ˆå¤šåˆå­¦è€…ä¼šé—®ï¼š&quot;DEX æ ¼å¼è¿™ä¹ˆå¤æ‚ï¼Œæˆ‘çœŸçš„éœ€è¦äº†è§£è¿™äº›åº•å±‚ç»†èŠ‚å—ï¼Ÿ&quot;</p>
<p>è€ƒè™‘è¿™äº›å®é™…åœºæ™¯ï¼š</p>
<ul>
<li><strong>åŠ å›ºå¯¹æŠ—</strong>ï¼šå½“ App ä½¿ç”¨äº† DEX åŠ å£³ï¼ˆå¦‚æ¢†æ¢†ã€360ï¼‰ï¼Œä½ éœ€è¦çŸ¥é“ DEX çš„é­”æ•°ã€ç­¾åå­—æ®µåœ¨å“ªï¼Œæ‰èƒ½åˆ¤æ–­è„±å£³æ˜¯å¦å®Œæ•´</li>
<li><strong>åŠ¨æ€åŠ è½½åˆ†æ</strong>ï¼šå¾ˆå¤š App ä¼šåœ¨è¿è¡Œæ—¶è§£å¯†å¹¶åŠ è½½éšè—çš„ DEXï¼Œç†è§£ <code>Class Defs</code> ç»“æ„èƒ½å¸®ä½ å¿«é€Ÿå®šä½è¢«éšè—çš„æ¶æ„ä»£ç </li>
<li><strong>Multi-DEX å®šä½</strong>ï¼šå½“ä½ æƒ³ Hook æŸä¸ªç±»ï¼Œä½†ä¸çŸ¥é“å®ƒåœ¨å“ªä¸ª <code>classes.dex</code> ä¸­æ—¶ï¼Œç†è§£ String IDs å’Œ Type IDs èƒ½å¸®ä½ å¿«é€Ÿæœç´¢</li>
<li><strong>æ–¹æ³•æ•°ä¼˜åŒ–</strong>ï¼šç†è§£ 65536 æ–¹æ³•æ•°é™åˆ¶çš„æ ¹æœ¬åŸå› ï¼ˆMethod IDs ç´¢å¼•ç”¨ 16 ä½ï¼‰ï¼Œèƒ½å¸®ä½ æ›´å¥½åœ°è¿›è¡Œæ¨¡å—åŒ–è®¾è®¡</li>
</ul>
<h2>DEX æ ¼å¼ä¸æ˜¯å­¦æœ¯çŸ¥è¯†ï¼Œè€Œæ˜¯ä½ ç ´è§£åŠ å›ºã€åˆ†ææ¶æ„ä»£ç çš„<strong>æ‰‹æœ¯åˆ€</strong>ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E5%AE%9A%E4%B9%89%E4%B8%8E%E8%A7%92%E8%89%B2"><strong>å®šä¹‰ä¸è§’è‰²</strong>ï¼šä»€ä¹ˆæ˜¯ DEX æ–‡ä»¶ï¼Ÿ</a></li>
<li><a href="#dex-vs-class"><strong>DEX vs. CLASS</strong>ï¼šä¸ Java å­—èŠ‚ç çš„å¯¹æ¯”</a></li>
<li><a href="#dex-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><strong>DEX æ–‡ä»¶ç»“æ„</strong>ï¼šæ·±å…¥å‰–ææ ¼å¼</a></li>
<li><a href="#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><strong>è¿è¡ŒåŸç†</strong>ï¼šDEX æ–‡ä»¶å¦‚ä½•è¢«æ‰§è¡Œï¼Ÿ</a></li>
<li><a href="#multi-dex"><strong>Multi-DEX</strong>ï¼šåº”å¯¹æ–¹æ³•æ•°é™åˆ¶</a></li>
<li><a href="#dex-%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7"><strong>DEX åˆ†æä¸å¤„ç†å·¥å…·</strong></a></li>
</ol>
<hr />
<h3>å®šä¹‰ä¸è§’è‰²</h3>
<p><strong>DEX æ–‡ä»¶</strong>æ˜¯åŒ…å«äº† Android åº”ç”¨ä»£ç çš„å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨æ‰“åŒ…ï¼ˆBuildï¼‰è¿‡ç¨‹ä¸­ï¼ŒJava ç¼–è¯‘å™¨é¦–å…ˆå°† <code>.java</code> æºç æ–‡ä»¶ç¼–è¯‘æˆæ ‡å‡†çš„ Java å­—èŠ‚ç  <code>.class</code> æ–‡ä»¶ã€‚ç„¶åï¼ŒAndroid SDK ä¸­çš„ <code>d8</code> å·¥å…·ï¼ˆæ—§ç‰ˆæœ¬ä¸º <code>dx</code>ï¼‰ä¼šå°†æ‰€æœ‰çš„ <code>.class</code> æ–‡ä»¶ï¼ˆåŒ…æ‹¬é¡¹ç›®ä»£ç å’Œä¾èµ–åº“ï¼‰ä¼˜åŒ–å¹¶åˆå¹¶æˆ <strong>ä¸€ä¸ªæˆ–å¤šä¸ª</strong> <code>classes.dex</code> æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ª <code>classes.dex</code> æ–‡ä»¶æœ€ç»ˆè¢«æ‰“åŒ…è¿› APK (Android Package) ä¸­ã€‚å½“ç”¨æˆ·å®‰è£…å¹¶è¿è¡Œåº”ç”¨æ—¶ï¼ŒAndroid ç³»ç»Ÿï¼ˆç‰¹åˆ«æ˜¯ ARTï¼‰ä¼šç›´æ¥æ‰§è¡Œ DEX æ–‡ä»¶ä¸­çš„ä»£ç ã€‚</p>
<p><strong>æ ¸å¿ƒè§’è‰²</strong>ï¼š</p>
<ul>
<li><p><strong>ç´§å‡‘æ€§</strong>: å°†æ‰€æœ‰ç±»æ–‡ä»¶åˆå¹¶ï¼Œå¹¶å…±äº«å­—ç¬¦ä¸²å’Œå¸¸é‡ï¼Œå¤§å¤§å‡å°‘äº†æ–‡ä»¶ä½“ç§¯å’Œ I/O å¼€é”€ã€‚</p>
</li>
<li><p><strong>é«˜æ•ˆæ€§</strong>: é‡‡ç”¨åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†ï¼Œæ›´æ¥è¿‘åº•å±‚ç¡¬ä»¶ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”åŸºäºæ ˆçš„ JVM æ›´é«˜ã€‚</p>
</li>
<li><p><strong>ç§»åŠ¨ä¼˜åŒ–</strong>: ä¸“ä¸ºå†…å­˜æœ‰é™çš„ç§»åŠ¨è®¾å¤‡è®¾è®¡ã€‚</p>
</li>
</ul>
<h2>æœ¬æ–‡æ¡£å‚è€ƒäº† Android å®˜æ–¹å…³äº <a href="https://source.android.com/docs/core/dalvik/dex-format">DEX æ–‡ä»¶æ ¼å¼</a> çš„è¯´æ˜ã€‚</h2>
<h3>DEX vs. CLASS</h3>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th><code>.class</code> æ–‡ä»¶ (JVM)</th>
  <th><code>.dex</code> æ–‡ä»¶ (ART/Dalvik)</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ–‡ä»¶æ•°é‡</strong></td>
  <td>æ¯ä¸ªæºæ–‡ä»¶å¯¹åº”ä¸€ä¸ª <code>.class</code> æ–‡ä»¶</td>
  <td>æ‰€æœ‰ <code>.class</code> æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæˆ–å¤šä¸ª <code>.dex</code> æ–‡ä»¶</td>
</tr>
<tr>
  <td><strong>æŒ‡ä»¤é›†æ¶æ„</strong></td>
  <td><strong>åŸºäºæ ˆ (Stack-based)</strong></td>
  <td><strong>åŸºäºå¯„å­˜å™¨ (Register-based)</strong></td>
</tr>
<tr>
  <td><strong>å¸¸é‡æ± </strong></td>
  <td>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å¸¸é‡æ± </td>
  <td>æ‰€æœ‰ç±»å…±äº«ä¸€ä¸ªå…¨å±€çš„å­—ç¬¦ä¸²å’Œå¸¸é‡æ± </td>
</tr>
<tr>
  <td><strong>å†—ä½™ä¿¡æ¯</strong></td>
  <td>å¤§é‡å†—ä½™å­—ç¬¦ä¸²ï¼ˆå¦‚ç±»åã€æ–¹æ³•åï¼‰</td>
  <td>å­—ç¬¦ä¸²å’Œå¸¸é‡å»é‡ï¼Œé€šè¿‡ç´¢å¼•å¼•ç”¨ï¼Œå†—ä½™å°‘</td>
</tr>
<tr>
  <td><strong>å¹³å°</strong></td>
  <td>ä»»ä½•æœ‰ JVM çš„åœ°æ–¹</td>
  <td>Android å¹³å°</td>
</tr>
<tr>
  <td><strong>è½¬æ¢å·¥å…·</strong></td>
  <td><code>javac</code></td>
  <td><code>javac</code> -&gt; <code>d8</code>/<code>dx</code></td>
</tr>
</tbody>
</table>
<hr />
<h3>DEX æ–‡ä»¶ç»“æ„</h3>
<p>DEX æ–‡ä»¶æ ¼å¼éå¸¸ç´§å‡‘å’Œé«˜æ•ˆï¼Œå…¶ç»“æ„å¯ä»¥å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼Œå¹¶ç”±ä¸€ä¸ª <code>header</code> æ¥æè¿°æ•´ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®å’Œåç§»é‡ã€‚</p>
<p>!!! tip &quot;é€†å‘æŠ€å·§ï¼šä»ç»“æ„å…¥æ‰‹å¿«é€Ÿå®šä½&quot;
é¢å¯¹ä¸€ä¸ªé™Œç”Ÿçš„ DEX æ–‡ä»¶ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ä½ æ„Ÿå…´è¶£çš„ä»£ç ï¼Ÿ</p>
<p><strong>è‡ªé¡¶å‘ä¸‹çš„åˆ†æç­–ç•¥</strong>ï¼š</p>
<ol>
<li><strong>çœ‹ Header</strong>ï¼šæ£€æŸ¥é­”æ•°ç¡®è®¤æ–‡ä»¶å®Œæ•´æ€§ï¼ŒæŸ¥çœ‹ <code>class_defs_size</code> äº†è§£æœ‰å¤šå°‘ä¸ªç±»</li>
<li><strong>æœ String IDs</strong>ï¼šç”¨ <code>dexdump</code> æˆ– <code>strings</code> æœç´¢å…³é”®å­—ç¬¦ä¸²ï¼ˆå¦‚ &quot;encrypt&quot;, &quot;http://&quot;ï¼‰ï¼Œå®šä½å¯ç–‘ä»£ç </li>
<li><strong>æŸ¥ Method IDs</strong>ï¼šé€šè¿‡æ–¹æ³•åç´¢å¼•æ‰¾åˆ°å…·ä½“å®ç°</li>
<li><strong>è·³ Class Defs</strong>ï¼šç›´æ¥å®šä½åˆ°ç›®æ ‡ç±»çš„å®Œæ•´å®šä¹‰</li>
<li><strong>è¯» Code Item</strong>ï¼šæœ€åæ‰æ·±å…¥å­—èŠ‚ç ç»†èŠ‚</li>
</ol>
<p>è¿™ç§&quot;çº¿ç´¢é©±åŠ¨&quot;çš„æ–¹æ³•ï¼Œæ¯”æ¼«æ— ç›®çš„åœ°æµè§ˆä»£ç é«˜æ•ˆå¾—å¤šã€‚</p>
<!-- ![DEX File Structure](../images/dex-format.png) -->

<p>A DEX file consists of several main sections:</p>
<h3>1. å¤´éƒ¨ (Header)</h3>
<ul>
<li><p><strong>Header</strong>: æ–‡ä»¶å¤´ï¼ŒåŒ…å«é­”æ•°ï¼ˆ<code>dex\n035\0</code>ï¼‰ã€æ ¡éªŒå’Œã€ç­¾åï¼Œä»¥åŠæŒ‡å‘å…¶ä»–æ•°æ®ç»“æ„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€ç±»å®šä¹‰ç­‰ï¼‰çš„åç§»é‡å’Œå¤§å°ã€‚</p>
</li>
<li><p><strong>String IDs</strong>: å­—ç¬¦ä¸²æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚åŒ…å« DEX æ–‡ä»¶ä¸­ç”¨åˆ°çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼ˆå¦‚ç±»åã€æ–¹æ³•åã€å˜é‡åã€å­—ç¬¦ä¸²å¸¸é‡ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªå­—ç¬¦ä¸²åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚</p>
</li>
<li><p><strong>Type IDs</strong>: ç±»å‹æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚åŒ…å«ä»£ç ä¸­ç”¨åˆ°çš„æ‰€æœ‰ç±»å‹ï¼ˆç±»ã€æ¥å£ã€æ•°ç»„ã€åŸºæœ¬ç±»å‹ï¼‰ï¼Œå¹¶æŒ‡å‘ <code>String IDs</code> ä¸­çš„ç›¸åº”å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><strong>Proto IDs</strong>: æ–¹æ³•åŸå‹æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚å®šä¹‰äº†æ–¹æ³•çš„è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹ã€‚</p>
</li>
<li><p><strong>Field IDs</strong>: å­—æ®µæ ‡è¯†ç¬¦åˆ—è¡¨ã€‚å®šä¹‰äº†ç±»çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬å…¶æ‰€å±ç±»ã€ç±»å‹å’Œåç§°ã€‚</p>
</li>
<li><p><strong>Method IDs</strong>: æ–¹æ³•æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚å®šä¹‰äº†æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¶æ‰€å±ç±»ã€åŸå‹ (Proto ID) å’Œåç§°ã€‚</p>
</li>
<li><p><strong>Class Defs</strong>: ç±»å®šä¹‰åˆ—è¡¨ã€‚è¿™æ˜¯æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŒ…å«äº†æ¯ä¸ªç±»çš„è¯¦ç»†ä¿¡æ¯ï¼šè®¿é—®æ ‡å¿—ã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æºç æ–‡ä»¶åã€æ³¨è§£ã€ä»¥åŠæŒ‡å‘å…¶å­—æ®µå’Œæ–¹æ³•çš„æŒ‡é’ˆã€‚</p>
</li>
<li><p><strong>Data Section</strong>: æ•°æ®åŒºï¼ŒåŒ…å«äº†æ‰€æœ‰ç±»çš„å®é™…å†…å®¹ï¼Œä¾‹å¦‚ï¼š</p>
</li>
<li><p><strong>Code Item</strong>: å®é™…çš„æ–¹æ³•å­—èŠ‚ç ï¼ˆDalvik æŒ‡ä»¤ï¼‰ã€‚</p>
</li>
<li><p><strong>Class Data</strong>: ç±»çš„å­—æ®µå’Œæ–¹æ³•åˆ—è¡¨çš„å…·ä½“æ•°æ®ã€‚</p>
</li>
<li><p><strong>Map List</strong>: æè¿°æ•´ä¸ª DEX æ–‡ä»¶æ•°æ®å¸ƒå±€çš„æ˜ å°„è¡¨ï¼Œ<code>dexdump</code> ç­‰å·¥å…·ä½¿ç”¨å®ƒæ¥è§£ææ–‡ä»¶ã€‚</p>
</li>
</ul>
<hr />
<h3>è¿è¡ŒåŸç†</h3>
<p>DEX æ–‡ä»¶çš„æ‰§è¡Œç”± Android è¿è¡Œæ—¶ (ART) è´Ÿè´£ï¼Œåœ¨ Android 5.0 ä¹‹å‰ç”± Dalvik è™šæ‹Ÿæœº (DVM) è´Ÿè´£ã€‚</p>
<h4>1. Dalvik è™šæ‹Ÿæœº (DVM) - android 4.4 åŠæ›´æ—©ç‰ˆæœ¬</h4>
<ul>
<li><p><strong>JIT (Just-In-Time) ç¼–è¯‘</strong>: å½“åº”ç”¨è¿è¡Œæ—¶ï¼ŒDVM ä¼šè§£é‡Šæ‰§è¡Œ DEX å­—èŠ‚ç ã€‚å¯¹äºé¢‘ç¹æ‰§è¡Œçš„&quot;çƒ­ç‚¹&quot;ä»£ç è·¯å¾„ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°†å…¶åŠ¨æ€ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œä»¥æé«˜åç»­æ‰§è¡Œé€Ÿåº¦ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: æ¯æ¬¡å¯åŠ¨åº”ç”¨éƒ½éœ€è¦è¿›è¡Œè§£é‡Šå’Œ JIT ç¼–è¯‘ï¼Œå¯¼è‡´åº”ç”¨å¯åŠ¨é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸”è¿è¡Œæ—¶æ¶ˆè€—æ›´å¤šè®¡ç®—èµ„æºã€‚</p>
</li>
</ul>
<h4>2. android è¿è¡Œæ—¶ (ART) - Android 5.0 åŠæ›´é«˜ç‰ˆæœ¬</h4>
<ul>
<li><p><strong>AOT (Ahead-Of-Time) ç¼–è¯‘</strong>: åœ¨åº”ç”¨<strong>å®‰è£…æ—¶</strong>ï¼ŒART ä¼šä½¿ç”¨ <code>dex2oat</code> å·¥å…·å°† DEX æ–‡ä»¶ä¸­çš„å­—èŠ‚ç é¢„ç¼–è¯‘æˆè®¾å¤‡åŸç”Ÿçš„æœºå™¨ç ï¼Œå¹¶ä¿å­˜ä¸º OAT (Optimized Android file format) æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>ä¼˜ç‚¹</strong>:</p>
</li>
<li><p><strong>å¯åŠ¨é€Ÿåº¦å¿«</strong>: åº”ç”¨ç›´æ¥æ‰§è¡Œé¢„ç¼–è¯‘çš„æœ¬åœ°ä»£ç ï¼Œæ— éœ€å®æ—¶ç¼–è¯‘ï¼Œå¤§å¤§åŠ å¿«äº†å¯åŠ¨é€Ÿåº¦ã€‚</p>
</li>
<li><p><strong>æ€§èƒ½æ›´é«˜</strong>: AOT å¯ä»¥è¿›è¡Œæ›´æ·±åº¦çš„ä¼˜åŒ–ï¼Œæ€§èƒ½é€šå¸¸ä¼˜äº JITã€‚</p>
</li>
<li><p><strong>æ›´çœç”µ</strong>: å‡å°‘äº†è¿è¡Œæ—¶çš„ CPU è®¡ç®—è´Ÿæ‹…ã€‚</p>
</li>
<li><p><strong>AOT + JIT æ··åˆæ¨¡å¼ (Android 7.0+ )</strong>:</p>
</li>
<li><p>ä¸ºäº†å¹³è¡¡å®‰è£…é€Ÿåº¦/ç©ºé—´å ç”¨å’Œæ€§èƒ½ï¼ŒART å¼•å…¥äº†æ··åˆæ¨¡å¼ã€‚</p>
</li>
<li><p><strong>å®‰è£…æ—¶</strong>: ä¸è¿›è¡Œå®Œå…¨ AOT ç¼–è¯‘ï¼Œæˆ–åªç¼–è¯‘éƒ¨åˆ†å…³é”®ä»£ç ã€‚</p>
</li>
<li><p><strong>é¦–æ¬¡è¿è¡Œ</strong>: è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ JIT ç¼–è¯‘çƒ­ç‚¹ä»£ç ï¼ŒåŒæ—¶æ”¶é›†åˆ†æä¿¡æ¯ (Profile)ã€‚</p>
</li>
<li><p><strong>è®¾å¤‡ç©ºé—²æ—¶</strong>: å½“è®¾å¤‡å……ç”µä¸”ç©ºé—²æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®æ”¶é›†åˆ°çš„åˆ†æä¿¡æ¯ï¼Œå¯¹å¸¸ç”¨ä»£ç è¿›è¡Œ AOT ç¼–è¯‘ï¼Œå®ç°æœ€ä½³æ€§èƒ½ã€‚</p>
</li>
</ul>
<hr />
<h3>Multi-DEX</h3>
<p>å•ä¸ª DEX æ–‡ä»¶æœ‰ä¸€ä¸ªæ–¹æ³•å¼•ç”¨æ•°ä¸Šé™ï¼ˆ65,536 ä¸ªï¼‰ï¼Œå½“åº”ç”¨ï¼ˆåŒ…æ‹¬å…¶ä¾èµ–åº“ï¼‰çš„æ–¹æ³•æ€»æ•°è¶…è¿‡è¿™ä¸ªé™åˆ¶æ—¶ï¼Œç¼–è¯‘ä¼šå¤±è´¥ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAndroid å¼•å…¥äº† <strong>Multi-DEX</strong> æœºåˆ¶ã€‚æ‰“åŒ…å·¥å…·ä¼šå°†åº”ç”¨ä»£ç åˆ†å‰²åˆ°å¤šä¸ª DEX æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ <code>classes.dex</code>, <code>classes2.dex</code>, <code>classes3.dex</code> ç­‰ã€‚ä¸» <code>classes.dex</code> æ–‡ä»¶ä¼šä¼˜å…ˆåŠ è½½ï¼Œç„¶ååº”ç”¨ä»£ç ä¼šè´Ÿè´£åŠ è½½å…¶ä½™çš„ DEX æ–‡ä»¶ã€‚</p>
<h2>ä» Android 5.0 (API 21) å¼€å§‹ï¼ŒART åŸç”Ÿæ”¯æŒåŠ è½½å¤šä¸ª DEX æ–‡ä»¶ï¼Œæ— éœ€é¢å¤–çš„åº“ã€‚å¯¹äºæ›´æ—©çš„ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦ä½¿ç”¨å®˜æ–¹çš„ <code>multidex-support-library</code>ã€‚</h2>
<h3>DEX åˆ†æä¸å¤„ç†å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>å·¥å…·</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>d8 / dx</strong></td>
  <td>Google å®˜æ–¹å·¥å…·ï¼Œç”¨äºå°† <code>.class</code> æ–‡ä»¶è½¬æ¢ä¸º <code>.dex</code> æ–‡ä»¶ã€‚<code>d8</code> æ˜¯æ–°ä¸€ä»£çš„è½¬æ¢å™¨ã€‚</td>
</tr>
<tr>
  <td><strong>dexdump</strong></td>
  <td>ä½äº Android SDK <code>build-tools</code> ä¸­ï¼Œç”¨äºæ‰“å° DEX æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€ç±»ã€æ–¹æ³•å’Œå­—èŠ‚ç ã€‚</td>
</tr>
<tr>
  <td><strong>baksmali</strong></td>
  <td>å°† <code>.dex</code> æ–‡ä»¶åæ±‡ç¼–æˆ <code>.smali</code> æ–‡ä»¶ã€‚Smali æ˜¯ä¸€ç§äººç±»å¯è¯»çš„ Dalvik å­—èŠ‚ç è¡¨ç¤ºå½¢å¼ã€‚</td>
</tr>
<tr>
  <td><strong>smali</strong></td>
  <td>å°† <code>.smali</code> æ–‡ä»¶é‡æ–°æ±‡ç¼–æˆ <code>.dex</code> æ–‡ä»¶ã€‚å¸¸ç”¨äºä¿®æ”¹åº”ç”¨é€»è¾‘åé‡æ–°æ‰“åŒ…ã€‚</td>
</tr>
<tr>
  <td><strong>Jadx</strong></td>
  <td>éå¸¸å¼ºå¤§çš„åç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥ç›´æ¥å°† APK/DEX æ–‡ä»¶åç¼–è¯‘æˆå¯è¯»çš„ Java ä»£ç ï¼Œå¹¶æä¾›å›¾å½¢åŒ–ç•Œé¢ã€‚</td>
</tr>
<tr>
  <td><strong>Ghidra / IDA Pro</strong></td>
  <td>é«˜çº§é€†å‘å·¥ç¨‹å·¥å…·ï¼Œæ”¯æŒå¯¹ DEX æ–‡ä»¶å’ŒåŸç”Ÿåº“è¿›è¡Œæ·±åº¦é™æ€å’ŒåŠ¨æ€åˆ†æã€‚</td>
</tr>
</tbody>
</table>

                                            </div>
                                            
                                            <div class="section" id="section-63">
                                                <h2>63. Smali Syntax</h2>
                                                <h1>Smali è¯­æ³•å…¥é—¨</h1>
<h2>Smali/Baksmali æ˜¯ Dalvik è™šæ‹Ÿæœºå­—èŠ‚ç çš„æ±‡ç¼–å™¨/åæ±‡ç¼–å™¨ã€‚Smali æ˜¯å¯¹ DEX æ ¼å¼çš„ä¸€ç§äººç±»å¯è¯»çš„è¡¨ç¤ºï¼Œå…è®¸æˆ‘ä»¬ç²¾ç¡®åœ°æŸ¥çœ‹å’Œä¿®æ”¹åº”ç”¨çš„è¡Œä¸ºã€‚ç†è§£ Smali æ˜¯è¿›è¡Œ Android åº”ç”¨é™æ€ patchingï¼ˆä¿®æ”¹åé‡æ‰“åŒ…ï¼‰çš„å…³é”®ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#smali-%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97">Smali è¯­æ³•å…¥é—¨</a><ul>
<li><a href="#smalibaksmali-%E6%98%AF-dalvik-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E6%B1%87%E7%BC%96%E5%99%A8%E5%8F%8D%E6%B1%87%E7%BC%96%E5%99%A8smali-%E6%98%AF%E5%AF%B9-dex-%E6%A0%BC%E5%BC%8F%E7%9A%84%E4%B8%80%E7%A7%8D%E4%BA%BA%E7%B1%BB%E5%8F%AF%E8%AF%BB%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%85%81%E8%AE%B8%E6%88%91%E4%BB%AC%E7%B2%BE%E7%A1%AE%E5%9C%B0%E6%9F%A5%E7%9C%8B%E5%92%8C%E4%BF%AE%E6%94%B9%E5%BA%94%E7%94%A8%E7%9A%84%E8%A1%8C%E4%B8%BA%E7%90%86%E8%A7%A3-smali-%E6%98%AF%E8%BF%9B%E8%A1%8C-android-%E5%BA%94%E7%94%A8%E9%9D%99%E6%80%81-patching%E4%BF%AE%E6%94%B9%E5%90%8E%E9%87%8D%E6%89%93%E5%8C%85%E7%9A%84%E5%85%B3%E9%94%AE">Smali/Baksmali æ˜¯ Dalvik è™šæ‹Ÿæœºå­—èŠ‚ç çš„æ±‡ç¼–å™¨/åæ±‡ç¼–å™¨ã€‚Smali æ˜¯å¯¹ DEX æ ¼å¼çš„ä¸€ç§äººç±»å¯è¯»çš„è¡¨ç¤ºï¼Œå…è®¸æˆ‘ä»¬ç²¾ç¡®åœ°æŸ¥çœ‹å’Œä¿®æ”¹åº”ç”¨çš„è¡Œä¸ºã€‚ç†è§£ Smali æ˜¯è¿›è¡Œ Android åº”ç”¨é™æ€ patchingï¼ˆä¿®æ”¹åé‡æ‰“åŒ…ï¼‰çš„å…³é”®ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E8%A1%A8%E7%A4%BA">æ•°æ®ç±»å‹ä¸è¡¨ç¤º</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8E%E7%B1%BB%E7%BB%93%E6%9E%84">æ–‡ä»¶ä¸ç±»ç»“æ„</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#format-field-access_modifier-static-final-field_namefield_type">Format: .field &lt;access_modifier&gt; [static] [final] &lt;field_name&gt;:&lt;field_type&gt;</a> - <a href="#%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4">å¯¹è±¡æ“ä½œæŒ‡ä»¤</a> - <a href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E6%8C%87%E4%BB%A4">æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</a> - <a href="#%E8%B7%B3%E8%BD%AC%E6%9D%A1%E4%BB%B6%E6%8C%87%E4%BB%A4">è·³è½¬/æ¡ä»¶æŒ‡ä»¤</a> - <a href="#%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4">è¿ç®—æŒ‡ä»¤</a><ul>
<li><a href="#smali-%E5%AE%9E%E6%88%98%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95">Smali å®æˆ˜ï¼šä¿®æ”¹æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#complex-check-logic-corresponding-smali-instructions">Complex check logic corresponding smali instructions...</a></li>
</ul>
<hr />
<h3>åŸºæœ¬æ¦‚å¿µ</h3>
<ul>
<li><p><strong>å¯„å­˜å™¨ (Registers)</strong>: Dalvik VM æ˜¯åŸºäºå¯„å­˜å™¨çš„ã€‚æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚</p>
</li>
<li><p><code>v</code> å¼€å¤´çš„å¯„å­˜å™¨ç”¨äºå­˜æ”¾æœ¬åœ°å˜é‡ï¼Œå¦‚ <code>v0</code>, <code>v1</code>, <code>v2</code>...</p>
</li>
<li><p><code>p</code> å¼€å¤´çš„å¯„å­˜å™¨ç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°ï¼Œå¦‚ <code>p0</code>, <code>p1</code>, <code>p2</code>...</p>
</li>
<li><p>å¯¹äºéé™æ€æ–¹æ³•ï¼Œ<code>p0</code> æ€»æ˜¯æŒ‡å‘ <code>this</code> (å½“å‰å¯¹è±¡å®ä¾‹)ã€‚</p>
</li>
<li><p>å‚æ•°ä» <code>p1</code> å¼€å§‹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°çš„éé™æ€æ–¹æ³•ï¼Œ<code>p0</code> æ˜¯ <code>this</code>ï¼Œ<code>p1</code> æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>p2</code> æ˜¯ç¬¬äºŒä¸ªå‚æ•°ã€‚å¯¹äºé™æ€æ–¹æ³•ï¼Œå‚æ•°ä» <code>p0</code> å¼€å§‹ã€‚</p>
</li>
<li><p><strong><code>.locals</code></strong>: å£°æ˜ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨äº†å¤šå°‘ä¸ªæœ¬åœ°å˜é‡å¯„å­˜å™¨ã€‚</p>
</li>
<li><p><strong><code>.prologue</code></strong>: æ–¹æ³•ä½“çš„åºè¨€éƒ¨åˆ†ã€‚</p>
</li>
<li><p><strong><code>.line</code></strong>: å¯¹åº”åŸå§‹ Java ä»£ç çš„è¡Œå·ï¼Œç”¨äºè°ƒè¯•ã€‚</p>
</li>
</ul>
<hr />
<h3>æ•°æ®ç±»å‹ä¸è¡¨ç¤º</h3>
<p>Smali ä½¿ç”¨ç‰¹å®šçš„æè¿°ç¬¦æ¥è¡¨ç¤º Java ä¸­çš„æ•°æ®ç±»å‹ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">Smali ç±»å‹</th>
  <th style="text-align:left">Java ç±»å‹</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>V</code></td>
  <td style="text-align:left"><code>void</code></td>
  <td style="text-align:left">ç©ºè¿”å›ç±»å‹</td>
</tr>
<tr>
  <td style="text-align:left"><code>Z</code></td>
  <td style="text-align:left"><code>boolean</code></td>
  <td style="text-align:left">å¸ƒå°”å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>B</code></td>
  <td style="text-align:left"><code>byte</code></td>
  <td style="text-align:left">å­—èŠ‚</td>
</tr>
<tr>
  <td style="text-align:left"><code>S</code></td>
  <td style="text-align:left"><code>short</code></td>
  <td style="text-align:left">çŸ­æ•´å‹</td>
</tr>
<tr>
  <td style="text-align:left"><code>C</code></td>
  <td style="text-align:left"><code>char</code></td>
  <td style="text-align:left">å­—ç¬¦</td>
</tr>
<tr>
  <td style="text-align:left"><code>I</code></td>
  <td style="text-align:left"><code>int</code></td>
  <td style="text-align:left">æ•´å‹</td>
</tr>
<tr>
  <td style="text-align:left"><code>J</code></td>
  <td style="text-align:left"><code>long</code></td>
  <td style="text-align:left">é•¿æ•´å‹ (å ç”¨ä¸¤ä¸ªå¯„å­˜å™¨)</td>
</tr>
<tr>
  <td style="text-align:left"><code>F</code></td>
  <td style="text-align:left"><code>float</code></td>
  <td style="text-align:left">æµ®ç‚¹å‹</td>
</tr>
<tr>
  <td style="text-align:left"><code>D</code></td>
  <td style="text-align:left"><code>double</code></td>
  <td style="text-align:left">åŒç²¾åº¦æµ®ç‚¹å‹ (å ç”¨ä¸¤ä¸ªå¯„å­˜å™¨)</td>
</tr>
<tr>
  <td style="text-align:left"><code>L&lt;åŒ…å&gt;/&lt;ç±»å&gt;;</code></td>
  <td style="text-align:left"><code>package.ClassName</code></td>
  <td style="text-align:left">å¯¹è±¡ç±»å‹ï¼Œä»¥ <code>L</code> å¼€å¤´ï¼Œ<code>;</code> ç»“å°¾</td>
</tr>
<tr>
  <td style="text-align:left"><code>[&lt;ç±»å‹&gt;</code></td>
  <td style="text-align:left"><code>type[]</code></td>
  <td style="text-align:left">æ•°ç»„ç±»å‹ï¼Œ<code>[I</code> ä»£è¡¨ <code>int[]</code></td>
</tr>
</tbody>
</table>
<p><strong>ç¤ºä¾‹</strong>:</p>
<ul>
<li><p><code>Ljava/lang/String;</code> -&gt; <code>java.lang.String</code></p>
</li>
<li><p><code>[I</code> -&gt; <code>int[]</code></p>
</li>
<li><p><code>[[Ljava/lang/Object;</code> -&gt; <code>java.lang.Object[][]</code></p>
</li>
</ul>
<hr />
<h3>æ–‡ä»¶ä¸ç±»ç»“æ„</h3>
<p>æ¯ä¸ª <code>.smali</code> æ–‡ä»¶å¯¹åº”ä¸€ä¸ª Java ç±»ã€‚</p>
<pre><code class="language-smali"># Define class, access modifiers, and complete class path
.class public Lcom/example/app/MainActivity;

# Define superclass
.super Landroid/app/Activity;

# Define source file name, optional
.source &quot;MainActivity.java&quot;

# ... Field definitions ...

# ... Method definitions ...

</code></pre>
<h1>Format: .field &lt;access_modifier&gt; [static] [final] &lt;field_name&gt;:&lt;field_type&gt;</h1>
<p>.field private TAG:Ljava/lang/String;
.field public static final MY_CONSTANT:I = 0x1</p>
<pre><code># Format: .method &lt;access_modifier&gt; [static] [final] &lt;method_name&gt;(&lt;parameter_types&gt;)&lt;return_type&gt;
.method public onCreate(Landroid/os/Bundle;)V
# Declare number of local variable registers
.locals 3

# Declare parameter registers
.param p1, &quot;savedInstanceState&quot; # p1 is savedInstanceState

# Method body begins
.prologue
.line 15

# ... Smali instructions ...

# Method return
return-void
.end method

</code></pre>
<ul>
<li><p><code>const-string v1, &quot;Hello&quot;</code>: å°†å­—ç¬¦ä¸² &quot;Hello&quot; èµ‹å€¼ç»™ <code>v1</code>ã€‚</p>
</li>
<li><p><code>move-result-object v0</code>: å°†ä¸Šä¸€ä¸ª <code>invoke</code> æŒ‡ä»¤è¿”å›çš„å¯¹è±¡ç»“æœç§»åŠ¨åˆ° <code>v0</code>ã€‚</p>
</li>
<li><p><code>move-result v0</code>: å°†ä¸Šä¸€ä¸ª <code>invoke</code> æŒ‡ä»¤è¿”å›çš„éå¯¹è±¡ç»“æœç§»åŠ¨åˆ° <code>v0</code>ã€‚</p>
</li>
<li><p><code>move-exception v0</code>: åœ¨ <code>catch</code> å—ä¸­ï¼Œå°†æ•è·çš„å¼‚å¸¸å¯¹è±¡ç§»åŠ¨åˆ° <code>v0</code>ã€‚</p>
</li>
</ul>
<h4>å¯¹è±¡æ“ä½œæŒ‡ä»¤</h4>
<ul>
<li><p><code>new-instance v0, Ljava/lang/StringBuilder;</code>: åˆ›å»ºä¸€ä¸ª <code>StringBuilder</code> çš„æ–°å®ä¾‹ï¼Œå¹¶å°†å…¶å¼•ç”¨å­˜å…¥ <code>v0</code>ã€‚</p>
</li>
<li><p><code>iget-object v0, p0, Lcom/example/app/MyClass;-&gt;myField:Ljava/lang/String;</code>: è·å–å®ä¾‹å­—æ®µ (iget) çš„å€¼ã€‚ä» <code>p0</code> (this) å¯¹è±¡ä¸­è¯»å– <code>myField</code> å­—æ®µï¼Œå¹¶å­˜å…¥ <code>v0</code>ã€‚</p>
</li>
<li><p><code>iput-object v1, p0, Lcom/example/app/MyClass;-&gt;myField:Ljava/lang/String;</code>: è®¾ç½®å®ä¾‹å­—æ®µ (iput) çš„å€¼ã€‚å°† <code>v1</code> çš„å€¼èµ‹ç»™ <code>p0</code> (this) å¯¹è±¡çš„ <code>myField</code> å­—æ®µã€‚</p>
</li>
<li><p><code>sget-object v0, Lcom/example/app/Constants;-&gt;SOME_STRING:Ljava/lang/String;</code>: è·å–é™æ€å­—æ®µ (sget) çš„å€¼ã€‚</p>
</li>
<li><p><code>sput-object v0, Lcom/example/app/Constants;-&gt;SOME_STRING:Ljava/lang/String;</code>: è®¾ç½®é™æ€å­—æ®µ (sput) çš„å€¼ã€‚</p>
</li>
</ul>
<h4>æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</h4>
<ul>
<li><p><code>invoke-virtual {p0, p1}, Lcom/example/app/MyClass;-&gt;myMethod(I)V</code>: è°ƒç”¨ä¸€ä¸ª <code>virtual</code> æ–¹æ³•ï¼ˆæœ€å¸¸è§çš„å…¬æœ‰/ä¿æŠ¤æ–¹æ³•ï¼‰ã€‚<code>{p0, p1}</code> æ˜¯å‚æ•°åˆ—è¡¨ï¼Œ<code>p0</code> æ˜¯ <code>this</code>ï¼Œ<code>p1</code> æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p>
</li>
<li><p><code>invoke-direct {p0}, Ljava/lang/Object;-&gt;&lt;init&gt;()V</code>: è°ƒç”¨ä¸€ä¸ª <code>direct</code> æ–¹æ³•ï¼ˆç§æœ‰æ–¹æ³•æˆ–æ„é€ å‡½æ•°ï¼‰ã€‚è¿™é‡Œæ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</p>
</li>
<li><p><code>invoke-static {v0}, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I</code>: è°ƒç”¨ä¸€ä¸ª <code>static</code> æ–¹æ³•ã€‚</p>
</li>
<li><p><code>invoke-super {p0, p1}, Landroid/app/Activity;-&gt;onCreate(Landroid/os/Bundle;)V</code>: è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><code>invoke-interface {p0, v0}, Ljava/util/List;-&gt;add(Ljava/lang/Object;)Z</code>: è°ƒç”¨æ¥å£æ–¹æ³•ã€‚</p>
</li>
</ul>
<h4>è·³è½¬/æ¡ä»¶æŒ‡ä»¤</h4>
<ul>
<li><p><code>goto :label_10</code>: æ— æ¡ä»¶è·³è½¬åˆ° <code>:label_10</code> æ ‡ç­¾ã€‚</p>
</li>
<li><p><code>if-eqz v0, :label_10</code>: å¦‚æœ <code>v0</code> ç­‰äº 0 (æˆ– <code>false</code>/<code>null</code>)ï¼Œåˆ™è·³è½¬åˆ° <code>:label_10</code>ã€‚<code>eqz</code> (equal zero)ã€‚</p>
</li>
<li><p><code>if-nez v0, :label_10</code>: å¦‚æœ <code>v0</code> ä¸ç­‰äº 0 (æˆ– <code>true</code>/<code>not null</code>)ï¼Œåˆ™è·³è½¬ã€‚<code>nez</code> (not equal zero)ã€‚</p>
</li>
<li><p><code>if-eq v0, v1, :label_10</code>: å¦‚æœ <code>v0</code> ç­‰äº <code>v1</code>ï¼Œåˆ™è·³è½¬ã€‚</p>
</li>
</ul>
<h4>è¿ç®—æŒ‡ä»¤</h4>
<ul>
<li><p><code>add-int v0, v1, v2</code>: <code>v0 = v1 + v2</code> (æ•´å‹åŠ æ³•)ã€‚</p>
</li>
<li><p><code>sub-int v0, v1, v2</code>: <code>v0 = v1 - v2</code> (æ•´å‹å‡æ³•)ã€‚</p>
</li>
<li><p><code>mul-int/2addr v0, v1</code>: <code>v0 = v0 * v1</code> (<code>/2addr</code> è¡¨ç¤ºç»“æœå­˜å›ç¬¬ä¸€ä¸ªæºå¯„å­˜å™¨)ã€‚</p>
</li>
</ul>
<hr />
<h3>Smali å®æˆ˜ï¼šä¿®æ”¹æ–¹æ³•</h3>
<p>å‡è®¾æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•ï¼Œè®©å®ƒæ€»æ˜¯è¿”å› <code>true</code>ã€‚</p>
<p><strong>åŸå§‹ Java ä»£ç :</strong></p>
<pre><code class="language-java">public class LicenseCheck {
public boolean isLicensed() {
// ...ComplexCheckLogic...
return false;
}
}

</code></pre>
<h1>Complex check logic corresponding smali instructions...</h1>
<p>const/4 v0, 0x0 # v0 = 0 (false)
return v0
.end method</p>
<pre><code>
# Remove all complex check logic

const/4 v0, 0x1 # v0 = 1 (true)
return v0
.end method

</code></pre>
<ul>
<li>ä½¿ç”¨ <code>apktool b myapp -o new_app.apk</code> é‡æ–°æ‰“åŒ…ã€‚</li>
<li>ç”¨ <code>jarsigner</code> æˆ– <code>apksigner</code> å¯¹ <code>new_app.apk</code> è¿›è¡Œç­¾åã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-64">
                                                <h2>64. SO ELF Format</h2>
                                                <h1>android .so æ–‡ä»¶è¯¦è§£ (ELF Format)</h1>
<h2><code>.so</code> æ–‡ä»¶ï¼ˆShared Objectï¼‰æ˜¯ Android å¹³å°ä¸Šçš„åŸç”Ÿå…±äº«åº“ï¼Œç­‰åŒäº Windows ä¸Šçš„ <code>.dll</code> æˆ– Linux ä¸Šçš„ <code>.so</code>ã€‚å®ƒä»¬åŒ…å«äº†ç”± C/C++ ç­‰åŸç”Ÿä»£ç ç¼–è¯‘è€Œæˆçš„æœºå™¨ç ã€‚åœ¨ Android é€†å‘å·¥ç¨‹ä¸­ï¼Œåˆ†æ <code>.so</code> æ–‡ä»¶æ˜¯ç†è§£åº”ç”¨æ ¸å¿ƒé€»è¾‘ã€ç ´è§£åŠ å¯†ç®—æ³•å’Œç»•è¿‡å®‰å…¨æœºåˆ¶çš„å…³é”®ä¸€æ­¥ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#elf-%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><strong>ELF æ–‡ä»¶æ ¼å¼</strong></a></li>
</ol>
<ul>
<li><p><a href="#elf-header">ELF Header</a></p>
</li>
<li><p><a href="#program-header-table">Program Header Table</a></p>
</li>
<li><p><a href="#section-header-table">Section Header Table</a></p>
</li>
<li><p><a href="#%E5%85%B3%E9%94%AE-section">å…³é”® Section</a></p>
</li>
<li><p><a href="#elf-header">ELF Header</a></p>
</li>
<li><p><a href="#program-header-table">Program Header Table</a></p>
</li>
<li><p><a href="#section-header-table">Section Header Table</a></p>
</li>
<li><p><a href="#%E5%85%B3%E9%94%AE-section">å…³é”® Section</a></p>
</li>
</ul>
<ol start="2">
<li><a href="#%E5%8A%A0%E8%BD%BD%E4%B8%8E%E9%93%BE%E6%8E%A5"><strong>åŠ è½½ä¸é“¾æ¥</strong></a></li>
</ol>
<ul>
<li><p><a href="#systemloadlibrary"><code>System.loadLibrary()</code></a></p>
</li>
<li><p><a href="#jni-java-native-interface">JNI (Java Native Interface)</a></p>
</li>
<li><p><a href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%99%A8-systembinlinker">åŠ¨æ€é“¾æ¥å™¨ (<code>/system/bin/linker</code>)</a></p>
</li>
<li><p><a href="#systemloadlibrary"><code>System.loadLibrary()</code></a></p>
</li>
<li><p><a href="#jni-java-native-interface">JNI (Java Native Interface)</a></p>
</li>
<li><p><a href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%99%A8-systembinlinker">åŠ¨æ€é“¾æ¥å™¨ (<code>/system/bin/linker</code>)</a></p>
</li>
</ul>
<ol start="3">
<li><a href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><strong>é™æ€åˆ†æ</strong></a></li>
</ol>
<ul>
<li><p><a href="#%E8%AF%86%E5%88%AB%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0">è¯†åˆ«å…³é”®å‡½æ•°</a></p>
</li>
<li><p><a href="#%E4%BD%BF%E7%94%A8-ida-pro--ghidra">ä½¿ç”¨ IDA Pro / Ghidra</a></p>
</li>
<li><p><a href="#%E8%AF%86%E5%88%AB%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0">è¯†åˆ«å…³é”®å‡½æ•°</a></p>
</li>
<li><p><a href="#%E4%BD%BF%E7%94%A8-ida-pro--ghidra">ä½¿ç”¨ IDA Pro / Ghidra</a></p>
</li>
</ul>
<ol start="4">
<li><a href="#%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90"><strong>åŠ¨æ€åˆ†æ</strong></a></li>
</ol>
<ul>
<li><p><a href="#frida-hook-%E5%8E%9F%E7%94%9F%E5%87%BD%E6%95%B0">Frida Hook åŸç”Ÿå‡½æ•°</a></p>
</li>
<li><p><a href="#unidbg-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œ</a></p>
</li>
<li><p><a href="#frida-hook-%E5%8E%9F%E7%94%9F%E5%87%BD%E6%95%B0">Frida Hook åŸç”Ÿå‡½æ•°</a></p>
</li>
<li><p><a href="#unidbg-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C">Unidbg æ¨¡æ‹Ÿæ‰§è¡Œ</a></p>
</li>
</ul>
<ol start="5">
<li><a href="#%E5%B8%B8%E8%A7%81%E4%BF%9D%E6%8A%A4%E6%89%8B%E6%AE%B5"><strong>å¸¸è§ä¿æŠ¤æ‰‹æ®µ</strong></a></li>
</ol>
<hr />
<h3>ELF æ–‡ä»¶æ ¼å¼</h3>
<p><code>.so</code> æ–‡ä»¶éµå¾ª <strong>ELF (Executable and Linkable Format)</strong> æ ¼å¼ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡ä»£ç ã€å…±äº«åº“å’Œæ ¸å¿ƒè½¬å‚¨çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚</p>
<h4>ELF Header</h4>
<p>ä½äºæ–‡ä»¶å¼€å¤´ï¼Œæè¿°äº†æ•´ä¸ªæ–‡ä»¶çš„&quot;æ¡£æ¡ˆ&quot;ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><p><strong>Magic Number</strong>: æ–‡ä»¶çš„å‰ 16 ä¸ªå­—èŠ‚ï¼Œç”¨äºè¯†åˆ«è¿™æ˜¯ä¸€ä¸ª ELF æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>Architecture</strong>: æ ‡è¯†æ–‡ä»¶æ˜¯ä¸ºå“ªç§ CPU æ¶æ„ç¼–è¯‘çš„ï¼ˆå¦‚ ARM, ARM64, x86ï¼‰ã€‚</p>
</li>
<li><p><strong>Type</strong>: æ–‡ä»¶ç±»å‹ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ã€å…±äº«åº“ç­‰ï¼‰ã€‚</p>
</li>
<li><p><strong>Entry Point Address</strong>: å¦‚æœæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™æ˜¯ç¨‹åºå¯åŠ¨çš„åœ°å€ã€‚</p>
</li>
<li><p><strong>Program Header Table Offset</strong>: æŒ‡å‘ç¨‹åºå¤´è¡¨çš„åç§»ã€‚</p>
</li>
<li><p><strong>Section Header Table Offset</strong>: æŒ‡å‘èŠ‚å¤´è¡¨çš„åç§»ã€‚</p>
</li>
</ul>
<h4>Program Header table</h4>
<p>æè¿°äº†ç³»ç»Ÿå¦‚ä½•å°†æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†ï¼ˆæ®µï¼ŒSegmentsï¼‰åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ¯ä¸ªæ¡ç›®éƒ½å®šä¹‰äº†ä¸€ä¸ªæ®µçš„ç±»å‹ï¼ˆå¦‚ <code>LOAD</code>ï¼Œè¡¨ç¤ºéœ€è¦åŠ è½½åˆ°å†…å­˜ï¼‰ã€è™šæ‹Ÿåœ°å€ã€ç‰©ç†åœ°å€ã€å¤§å°å’Œæƒé™ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰ã€‚åŠ¨æ€é“¾æ¥å™¨ (<code>linker</code>) ä¾èµ–è¿™ä¸ªè¡¨æ¥æ­£ç¡®æ˜ å°„ <code>.so</code> æ–‡ä»¶ã€‚</p>
<h4>Section Header table</h4>
<p>æè¿°äº†æ–‡ä»¶ä¸­å„ä¸ª&quot;èŠ‚&quot;ï¼ˆSectionsï¼‰çš„ä¿¡æ¯ã€‚èŠ‚æ˜¯é“¾æ¥å™¨ç”¨æ¥ç»„ç»‡å’Œå¤„ç†æ•°æ®çš„å•ä½ã€‚</p>
<h4>å…³é”® Section</h4>
<ul>
<li><p><strong>.text</strong>: åŒ…å«å·²ç¼–è¯‘çš„ç¨‹åºæœºå™¨ç ï¼ˆæ±‡ç¼–æŒ‡ä»¤ï¼‰ã€‚è¿™æ˜¯åˆ†æçš„æ ¸å¿ƒåŒºåŸŸã€‚</p>
</li>
<li><p><strong>.rodata</strong>: åªè¯»æ•°æ®åŒºï¼Œé€šå¸¸å­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡ã€const å˜é‡ç­‰ã€‚</p>
</li>
<li><p><strong>.data</strong>: å·²åˆå§‹åŒ–çš„å¯è¯»å¯å†™æ•°æ®åŒºï¼ˆå…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼‰ã€‚</p>
</li>
<li><p><strong>.bss</strong>: æœªåˆå§‹åŒ–çš„æ•°æ®åŒºã€‚åœ¨æ–‡ä»¶ä¸­ä¸å ç©ºé—´ï¼Œä½†åœ¨åŠ è½½åˆ°å†…å­˜æ—¶ä¼šè¢«åˆ†é…å¹¶æ¸…é›¶ã€‚</p>
</li>
<li><p><strong>.init_array</strong> / <strong>.fini_array</strong>: å­˜æ”¾ä¸€ç³»åˆ—å‡½æ•°æŒ‡é’ˆï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨åº“è¢«åŠ è½½ (<code>dlopen</code>) æ—¶ï¼ˆ<code>.init_array</code>ï¼‰æˆ–å¸è½½ (<code>dlclose</code>) æ—¶ï¼ˆ<code>.fini_array</code>ï¼‰è‡ªåŠ¨æ‰§è¡Œã€‚<strong>è¿™æ˜¯åˆ†æ <code>.so</code> æ–‡ä»¶è‡ªå¯åŠ¨é€»è¾‘å’Œåè°ƒè¯•çš„ç»ä½³å…¥å£ç‚¹</strong>ã€‚</p>
</li>
<li><p><strong>.dynsym</strong> (Dynamic Symbol Table): åŠ¨æ€ç¬¦å·è¡¨ï¼ŒåŒ…å«äº†åº“ä¸­å¯¼å‡ºï¼ˆæä¾›ç»™å¤–éƒ¨ä½¿ç”¨ï¼‰å’Œå¯¼å…¥ï¼ˆéœ€è¦ä»å…¶ä»–åº“å¼•ç”¨ï¼‰çš„å‡½æ•°å’Œå˜é‡åã€‚</p>
</li>
<li><p><strong>.dynstr</strong> (Dynamic String Table): å­—ç¬¦ä¸²è¡¨ï¼Œ<code>.dynsym</code> ä¸­çš„ç¬¦å·åç§°å°±å­˜å‚¨åœ¨è¿™é‡Œã€‚</p>
</li>
</ul>
<hr />
<h3>åŠ è½½ä¸é“¾æ¥</h3>
<h4><code>System.loadLibrary()</code></h4>
<p>åœ¨ Java/Kotlin ä»£ç ä¸­ï¼Œå¼€å‘è€…é€šè¿‡ <code>System.loadLibrary(&quot;mylib&quot;)</code> æ¥åŠ è½½ä¸€ä¸ªåä¸º <code>libmylib.so</code> çš„åŸç”Ÿåº“ã€‚ç³»ç»Ÿä¼šåœ¨ <code>lib/</code> ç›®å½•ä¸‹çš„ç›¸åº” ABI æ–‡ä»¶å¤¹ï¼ˆå¦‚ <code>arm64-v8a</code>ï¼‰ä¸­æŸ¥æ‰¾å¹¶åŠ è½½è¯¥åº“ã€‚</p>
<h4>JNI (Java Native Interface)</h4>
<p>JNI æ˜¯è¿æ¥ Java ä¸–ç•Œå’Œ Native (C/C++) ä¸–ç•Œçš„æ¡¥æ¢ï¼Œæ˜¯ Android é€†å‘åˆ†æä¸­çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚</p>
<h5>JNI åŸºç¡€æ¦‚å¿µ</h5>
<p><strong>Java ä¾§å£°æ˜</strong>:</p>
<pre><code class="language-java">public class NativeHelper {
static {
System.loadLibrary(&quot;native-lib&quot;); // Load libnative-lib.so
}

// Static native method
public static native String doEncrypt(String input);

// Instance native method
public native byte[] processData(byte[] data, int flag);

// Multiple parameter native method
public native int complexOperation(String str, int[] array, boolean flag);
}

</code></pre>
<p>// Static method JNI function signature: second parameter is jclass
JNIEXPORT jstring JNICALL
Java_com_example_app_NativeHelper_doEncrypt(JNIEnv <em>env, jclass clazz, jstring input) {
const char *nativeString = (</em>env)-&gt;GetStringUTFChars(env, input, 0);
// Execute encryption logic...
jstring result = (<em>env)-&gt;NewStringUTF(env, encrypted_result);
(\</em>env)-&gt;ReleaseStringUTFChars(env, input, nativeString);
return result;
}</p>
<p>// Instance method JNI function signature: second parameter is jobject
JNIEXPORT jbyteArray JNICALL
Java_com_example_app_NativeHelper_processData(JNIEnv <em>env, jobject thiz, jbyteArray data, jint flag) {
jsize len = (</em>env)-&gt;GetArrayLength(env, data);
jbyte <em>body = (</em>env)-&gt;GetByteArrayElements(env, data, 0);</p>
<p>// Process data...</p>
<p>jbyteArray result = (<em>env)-&gt;NewByteArray(env, len);
(</em>env)-&gt;SetByteArrayRegion(env, result, 0, len, processed_data);
(*env)-&gt;ReleaseByteArrayElements(env, data, body, 0);
return result;
}</p>
<pre><code>

- å¸¸ç”¨å‡½æ•°åˆ†ç±»ï¼š

- **å­—ç¬¦ä¸²æ“ä½œ**: `NewStringUTF()`, `GetStringUTFChars()`, `ReleaseStringUTFChars()`

- **æ•°ç»„æ“ä½œ**: `NewByteArray()`, `GetByteArrayElements()`, `SetByteArrayRegion()`

- **å¯¹è±¡æ“ä½œ**: `NewObject()`, `GetObjectClass()`, `CallObjectMethod()`

- **å­—æ®µè®¿é—®**: `GetFieldID()`, `GetIntField()`, `SetIntField()`

- **æ–¹æ³•è°ƒç”¨**: `GetMethodID()`, `CallVoidMethod()`, `CallIntMethod()`


- **å­—ç¬¦ä¸²æ“ä½œ**: `NewStringUTF()`, `GetStringUTFChars()`, `ReleaseStringUTFChars()`


- **æ•°ç»„æ“ä½œ**: `NewByteArray()`, `GetByteArrayElements()`, `SetByteArrayRegion()`


- **å¯¹è±¡æ“ä½œ**: `NewObject()`, `GetObjectClass()`, `CallObjectMethod()`


- **å­—æ®µè®¿é—®**: `GetFieldID()`, `GetIntField()`, `SetIntField()`


- **æ–¹æ³•è°ƒç”¨**: `GetMethodID()`, `CallVoidMethod()`, `CallIntMethod()`


**2. æ•°æ®ç±»å‹æ˜ å°„**

```c
// Java type -&gt; JNI type
boolean -&gt; jboolean
byte -&gt; jbyte
char -&gt; jchar
short -&gt; jshort
int -&gt; jint
long -&gt; jlong
float -&gt; jfloat
double -&gt; jdouble
String -&gt; jstring
Object -&gt; jobject
Class -&gt; jclass
Array -&gt; jarray (jintArray, jbyteArray etc.)

</code></pre>
<ul>
<li>ç¤ºä¾‹ï¼š<code>Java_com_example_myapp_crypto_AESUtil_encrypt</code></li>
</ul>
<h5>JNI æ–¹æ³•æ³¨å†Œ</h5>
<p><strong>é™æ€æ³¨å†Œ</strong>ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰ï¼š</p>
<pre><code class="language-c">// Function name must strictly follow naming rules
JNIEXPORT jstring JNICALL
Java_com_example_app_MainActivity_stringFromJNI(JNIEnv *env, jobject thiz) {
return (*env)-&gt;NewStringUTF(env, &quot;Hello from JNI!&quot;);
}

</code></pre>
<p>{&quot;encrypt&quot;, &quot;(Ljava/lang/String;)Ljava/lang/String;&quot;, (void<em>)native_encrypt},
{&quot;decrypt&quot;, &quot;([B)[B&quot;, (void</em>)native_decrypt},
{&quot;init&quot;, &quot;(I)V&quot;, (void*)native_init}
};</p>
<p>// JNI_OnLoad function will be automatically called when library is loaded
JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM* vm, void* reserved) {
JNIEnv* env;
if ((*vm)-&gt;GetEnv(vm, (void**)&amp;env, JNI_VERSION_1_6) != JNI_OK) {
return JNI_ERR;
}</p>
<p>jclass clazz = (*env)-&gt;FindClass(env, &quot;com/example/app/NativeHelper&quot;);
if (clazz == NULL) {
return JNI_ERR;
}</p>
<p>// Register native methods
if ((*env)-&gt;RegisterNatives(env, clazz, gMethods,
sizeof(gMethods)/sizeof(gMethods[0])) &lt; 0) {
return JNI_ERR;
}</p>
<p>return JNI_VERSION_1_6;
}</p>
<pre><code>
S - short
I - int
J - long
F - float
D - double
V - void

</code></pre>
<p>[[Ljava/lang/String; - String[][]</p>
<pre><code>
// Java: public native void processArray(int[] data, boolean flag);
// JNI Signature: ([IZ)V

</code></pre>
<p>nm -D libexample.so | grep Java_</p>
<h1>Or use objdump</h1>
<p>objdump -T libexample.so | grep Java_</p>
<pre><code>&quot;libnative.so&quot;,
&quot;Java_com_example_app_NativeHelper_doEncrypt&quot;
);

Interceptor.attach(encrypt_func, {
onEnter: function (args) {
// args[0] = JNIEnv*
// args[1] = jclass/jobject
// args[2] = first parameter (jstring)
var jstring_ptr = args[2];
var str_content = Java.vm.getEnv().getStringUtfChars(jstring_ptr, null);
console.log(&quot;Input: &quot; + str_content.readCString());
},
onLeave: function (retval) {
var result = Java.vm.getEnv().getStringUtfChars(retval, null);
console.log(&quot;Output: &quot; + result.readCString());
},
});

</code></pre>
<p>var NativeHelper = Java.use(&quot;com.example.app.NativeHelper&quot;);</p>
<p>NativeHelper.doEncrypt.implementation = function (input) {
console.log(&quot;Java -&gt; Native: &quot; + input);
var result = this.doEncrypt(input);
console.log(&quot;Native -&gt; Java: &quot; + result);
return result;
};
});</p>
<pre><code>JNIEXPORT void JNICALL
Java_com_example_app_Security_checkDebugger(JNIEnv *env, jclass clazz) {
if (ptrace(PTRACE_TRACEME, 0, 1, 0) == -1) {
// Debugger detected, execute countermeasure
exit(1);
}
}

</code></pre>
<p>// XOR decryption example
static char decrypted[256];
int key = 0x42;
for (int i = 0; encrypted[i]; i++) {
decrypted[i] = encrypted[i] ^ key;
}
return decrypted;
}</p>
<pre><code>Java_com_example_app_Security_isEmulator(JNIEnv *env, jclass clazz) {
// Check system property
char prop_value[256];
__system_property_get(&quot;ro.kernel.qemu&quot;, prop_value);
return strcmp(prop_value, &quot;1&quot;) == 0;
}

</code></pre>
<ol start="3">
<li>è§£æè¯¥åº“çš„ä¾èµ–é¡¹ï¼ˆå³å®ƒéœ€è¦ä»å…¶ä»–åº“ï¼Œå¦‚ <code>libc.so</code>ï¼Œå¯¼å…¥çš„å‡½æ•°ï¼‰ï¼Œå¹¶å¡«å……å¯¼å…¥å‡½æ•°çš„åœ°å€ã€‚</li>
<li>æ‰§è¡Œ <code>.init_array</code> ä¸­çš„åˆå§‹åŒ–å‡½æ•°ã€‚</li>
</ol>
<hr />
<h3>é™æ€åˆ†æ</h3>
<h4>è¯†åˆ«å…³é”®å‡½æ•°</h4>
<ul>
<li><p><strong>JNI å‡½æ•°</strong>: åœ¨ IDA/Ghidra ä¸­ï¼Œç›´æ¥åœ¨ç¬¦å·åˆ—è¡¨ä¸­æœç´¢ <code>Java_</code> å‰ç¼€ï¼Œå¯ä»¥å¿«é€Ÿå®šä½æ‰€æœ‰ Java å’Œ Native çš„äº¤äº’ç‚¹ã€‚</p>
</li>
<li><p><strong>å¯¼å‡ºå‡½æ•°</strong>: æŸ¥çœ‹ <code>Exports</code> åˆ—è¡¨ï¼Œå¯»æ‰¾æœ‰æ„ä¹‰çš„å‡½æ•°åï¼Œå¦‚ <code>encrypt</code>, <code>decrypt</code>, <code>checkSignature</code> ç­‰ã€‚</p>
</li>
<li><p><strong><code>.init_array</code> å‡½æ•°</strong>: æŸ¥çœ‹ <code>.init_array</code> sectionï¼Œåˆ†æåœ¨åº“åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ç»å¸¸è¢«ç”¨æ¥å®ç°åè°ƒè¯•æˆ–åˆå§‹åŒ–åŠ å¯†å¯†é’¥ã€‚</p>
</li>
</ul>
<h4>ä½¿ç”¨ IDA Pro / Ghidra</h4>
<ol>
<li><strong>åŠ è½½æ–‡ä»¶</strong>: å°† <code>.so</code> æ–‡ä»¶æ‹–å…¥ IDA æˆ– Ghidraã€‚</li>
<li><strong>æŸ¥çœ‹ä¼ªä»£ç </strong>: æŒ‰ <code>F5</code> (IDA) æˆ–ç­‰å¾… Ghidra çš„è‡ªåŠ¨åˆ†æï¼Œç›´æ¥é˜…è¯»åç¼–è¯‘å‡ºçš„ C ä¼ªä»£ç ã€‚è¿™æ˜¯æœ€é«˜æ•ˆçš„åˆ†ææ–¹å¼ã€‚</li>
<li><strong>äº¤å‰å¼•ç”¨ (Cross-References)</strong>: å¯¹ä¸€ä¸ªå‡½æ•°åæˆ–å­—ç¬¦ä¸²å¸¸é‡æŒ‰ <code>X</code> é”®ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¼•ç”¨äº†å®ƒçš„åœ°æ–¹ï¼Œä»è€Œè¿½è¸ªæ•°æ®æµå’Œè°ƒç”¨å…³ç³»ã€‚</li>
<li><strong>å›¾å½¢æ¨¡å¼</strong>: ä½¿ç”¨å›¾å½¢è§†å›¾æ¥ç†è§£å¤æ‚çš„å‡½æ•°è°ƒç”¨æµç¨‹å’Œæ¡ä»¶åˆ†æ”¯ã€‚</li>
</ol>
<hr />
<h3>åŠ¨æ€åˆ†æ</h3>
<h4>Frida Hook åŸç”Ÿå‡½æ•°</h4>
<p>å½“é™æ€åˆ†æå›°éš¾ï¼ˆå¦‚ä»£ç è¢«æ··æ·†æˆ–ç®—æ³•å¤æ‚ï¼‰æ—¶ï¼ŒåŠ¨æ€ Hook æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p>
<pre><code class="language-javascript">// frida script
const baseAddr = Module.findBaseAddress(&quot;libnative-lib.so&quot;);
const targetFuncPtr = baseAddr.add(0x1234); // 0x1234 is function offset from IDA/Ghidra

Interceptor.attach(targetFuncPtr, {
  onEnter: function (args) {
    // args[0], args[1]... are function parameters (pointers)
    console.log(&quot;Hooked function called!&quot;);
    // Can use Memory.readCString(args[0]) etc. to read parameter content
  },
  onLeave: function (retval) {
    // retval is function return value
    // retval.replace(0x1); // Can modify return value
  },
});
</code></pre>
<h4>å­—ç¬¦ä¸²åŠ å¯†</h4>
<p><strong>ä¿æŠ¤æœºåˆ¶</strong>: <code>.so</code> æ–‡ä»¶ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¸²ï¼ˆå¦‚å¯†é’¥ã€URLï¼‰è¢«åŠ å¯†å­˜æ”¾ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†ä½¿ç”¨ã€‚é™æ€åˆ†ææ—¶æ— æ³•ç›´æ¥çœ‹åˆ°ã€‚</p>
<p><strong>æ”»å‡»æ–¹æ³•</strong>:</p>
<ul>
<li><p>Hook è§£å¯†å‡½æ•°: æ‰¾åˆ°è§£å¯†å‡½æ•°å…¥å£ï¼Œæ‰“å°è§£å¯†åçš„å­—ç¬¦ä¸²</p>
</li>
<li><p>å†…å­˜ Dump: åœ¨è§£å¯†å Hook å†…å­˜è¯»å–æ“ä½œï¼Œè·å–æ˜æ–‡å­—ç¬¦ä¸²</p>
</li>
<li><p>äº¤å‰å¼•ç”¨åˆ†æ: ä½¿ç”¨ <code>axt</code> æŸ¥çœ‹è°ƒç”¨æœ€å¤šçš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è§£å¯†å‡½æ•°</p>
</li>
</ul>
<pre><code class="language-javascript">// Frida Hook example
var decrypt_func = Module.findExportByName(&quot;libnative.so&quot;, &quot;decrypt_string&quot;);
Interceptor.attach(decrypt_func, {
  onLeave: function (retval) {
    console.log(&quot;Decrypted string:&quot;, Memory.readCString(retval));
  },
});
</code></pre>
<p><strong>æ”»å‡»æ–¹æ³•</strong>:</p>
<ul>
<li><p>åŠ¨æ€åˆ†æä¸ºä¸»: ç»•è¿‡é™æ€åˆ†æå›°éš¾ï¼Œç›´æ¥ Hook å…³é”®å‡½æ•°</p>
</li>
<li><p>å»æ··æ·†å·¥å…·: ä½¿ç”¨ d810 (IDA æ’ä»¶) ç­‰å·¥å…·å»é™¤æ§åˆ¶æµå¹³å¦åŒ–</p>
</li>
<li><p>æ¨¡æ‹Ÿæ‰§è¡Œ: ä½¿ç”¨ Unidbg æ¨¡æ‹Ÿæ‰§è¡Œï¼Œè·å–ç®—æ³•è¾“å…¥è¾“å‡º</p>
</li>
<li><p>æŒ‡ä»¤çº§ Hook: Hook æ±‡ç¼–æŒ‡ä»¤çº§åˆ«ï¼Œè§‚å¯Ÿå¯„å­˜å™¨å˜åŒ–</p>
</li>
</ul>
<pre><code class="language-javascript">// Hook instruction-level example
var baseAddr = Module.findBaseAddress(&quot;libnative.so&quot;);
Interceptor.attach(baseAddr.add(0x1000), {
  onEnter: function (args) {
    console.log(&quot;Register state:&quot;, this.context);
  },
});
</code></pre>
<p><strong>æ”»å‡»æ–¹æ³•</strong>:</p>
<ul>
<li><p>Hook åè°ƒè¯•å‡½æ•°: ç›´æ¥è¿”å›æ­£å¸¸å€¼ï¼Œç»•è¿‡æ£€æµ‹</p>
</li>
<li><p>ä¿®æ”¹æ£€æµ‹é€»è¾‘: ä½¿ç”¨ Frida ä¿®æ”¹å†…å­˜ä¸­çš„åè°ƒè¯•ä»£ç </p>
</li>
<li><p>ç¯å¢ƒä¼ªè£…: ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼ï¼Œä¼ªè£…æ­£å¸¸ç¯å¢ƒ</p>
</li>
<li><p>Spawn æ¨¡å¼: ä½¿ç”¨ Frida çš„ spawn æ¨¡å¼ï¼Œåœ¨åº”ç”¨å¯åŠ¨å‰æ³¨å…¥</p>
</li>
</ul>
<pre><code class="language-javascript">// Bypass anti-debugging example
var anti_debug = Module.findExportByName(&quot;libnative.so&quot;, &quot;check_debug&quot;);
Interceptor.attach(anti_debug, {
  onLeave: function (retval) {
    retval.replace(0); // Return 0 to indicate no debugging detected
  },
});

// Hook ptrace system call
var ptrace = Module.findExportByName(&quot;libc.so&quot;, &quot;ptrace&quot;);
Interceptor.attach(ptrace, {
  onEnter: function (args) {
    args[0] = ptr(0); // Modify ptrace arguments
  },
});
</code></pre>
<h3>è°ƒç”¨æ—¶æœºè¯¦è§£</h3>
<p><code>.init_array</code> ä¸­çš„å‡½æ•°åœ¨ <strong>ELF åº“åŠ è½½è¿‡ç¨‹ä¸­çš„æ—©æœŸé˜¶æ®µ</strong> è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶æœºéå¸¸å…³é”®ï¼Œå‘ç”Ÿåœ¨ JNI_OnLoad ä¹‹å‰ã€‚</p>
<h4>å®Œæ•´çš„è°ƒç”¨æµç¨‹</h4>
<pre><code>
</code></pre>
<p>â†“
nativeLoad() [art/runtime/native/java_lang_Runtime.cc]
â†“
android_dlopen_ext() [bionic/libdl/libdl.cpp]
â†“
do_dlopen() [bionic/linker/linker.cpp]
â†“
find_library() â†’ load_library() â†’ link_image()
â†“
call_constructors() â†’ init_arrayFunctionExecute</p>
<pre><code>// 1. First call DT_INIT initialization function
if (init_func_ != nullptr) {
init_func_();
}

// 2. Then iterate through .init_array section function pointers
if (init_array_ != nullptr) {
for (size_t i = 0; i &lt; init_array_count_; ++i) {
// Call each constructor function, including init_string_obfuscation
((void (*)())init_array_[i])();
}
}
}

</code></pre>
<p>// String obfuscation initialization function declaration
<strong>attribute</strong>((constructor))
void init_string_obfuscation() {
// String decryption and anti-debugging logic
decrypt_critical_strings();
setup_anti_debug_measures();
}</p>
<p>// Can also specify priority (lower number = higher priority)
<strong>attribute</strong>((constructor(101)))
void init_anti_debug_level1() {
// First level anti-debugging detection
basic_environment_check();
}</p>
<p><strong>attribute</strong>((constructor(102)))
void init_string_decryption() {
// String decryption, depends on first level detection passing
if (environment_safe) {
decrypt_strings();
}
}</p>
<pre><code>4. **è¿è¡Œæ—¶è°ƒç”¨**: åŠ¨æ€é“¾æ¥å™¨æŒ‰é¡ºåºè°ƒç”¨æ‰€æœ‰å‡½æ•°æŒ‡é’ˆ


#### å®é™…åº”ç”¨ç¤ºä¾‹

```cpp
// Actual string obfuscation initialization function example
__attribute__((constructor(100)))
void init_string_obfuscation() {
// 1. Environment security check
if (detect_debug_environment()) {
// Debug environment detected, execute countermeasures
execute_anti_debug_response();
return;
}

// 2. Decrypt critical strings
decrypt_api_strings();
decrypt_config_strings();
decrypt_url_strings();

// 3. Mark initialization complete
string_obfuscation_initialized = true;
}

// String decryption function
void decrypt_api_strings() {
// Decrypt API name strings
for (int i = 0; i &lt; API_STRING_COUNT; i++) {
decrypt_string_xor(encrypted_api_names[i],
decrypted_api_names[i],
API_XOR_KEY);
}
}

// XOR decryption implementation
void decrypt_string_xor(const char* encrypted, char* decrypted, uint8_t key) {
int len = strlen(encrypted);
for (int i = 0; i &lt; len; i++) {
decrypted[i] = encrypted[i] ^ key;
}
decrypted[len] = '\0';
}

</code></pre>
<ul>
<li><strong>ä¼˜å…ˆçº§æ§åˆ¶</strong>: å¯ä»¥é€šè¿‡å‚æ•°æ§åˆ¶å¤šä¸ªåˆå§‹åŒ–å‡½æ•°çš„æ‰§è¡Œé¡ºåº</li>
</ul>
<h4>2. å®‰å…¨é˜²æŠ¤ä¼˜åŠ¿</h4>
<ul>
<li><p><strong>é™æ€åˆ†æå›°æ‰°</strong>: åŠ å¯†å­—ç¬¦ä¸²åœ¨é™æ€åˆ†ææ—¶ä¸å¯è§</p>
</li>
<li><p><strong>è¿è¡Œæ—¶è§£å¯†</strong>: åªåœ¨è¿è¡Œæ—¶ä¸´æ—¶è§£å¯†ï¼Œå¢åŠ åˆ†æéš¾åº¦</p>
</li>
<li><p><strong>åè°ƒè¯•é›†æˆ</strong>: å¯åœ¨åˆå§‹åŒ–é˜¶æ®µè¿›è¡Œç¯å¢ƒæ£€æµ‹</p>
</li>
</ul>
<h4>3. é€†å‘åˆ†ææŒ‘æˆ˜</h4>
<ul>
<li><p><strong>æ—¶æœºæŠŠæ¡å›°éš¾</strong>: Hook éœ€è¦åœ¨ init_array æ‰§è¡Œå‰å®Œæˆ</p>
</li>
<li><p><strong>å‡½æ•°å®šä½å¤æ‚</strong>: éœ€è¦åˆ†æ ELF ç»“æ„æ‰èƒ½å‡†ç¡®å®šä½</p>
</li>
<li><p><strong>è°ƒè¯•æ—¶æœºçª—å£çŸ­</strong>: æ‰§è¡Œæ—¶é—´çŸ­ï¼Œéš¾ä»¥åŠæ—¶ä»‹å…¥</p>
</li>
</ul>
<h3>é€†å‘åˆ†æå¯¹ç­–</h3>
<h4>é™æ€åˆ†ææ–¹æ³•</h4>
<pre><code class="language-python"># Python script to analyze .init_array section
from elftools.elf.elffile import ELFFile

def analyze_init_array(so_path):
with open(so_path, 'rb') as f:
elf = ELFFile(f)

# Find .init_array section
init_array_section = elf.get_section_by_name('.init_array')
if init_array_section:
data = init_array_section.data()

print(f&quot;[+] Found .init_array section, size: {len(data)} bytes&quot;)

# Parse function pointers (8-byte aligned, 64-bit system)
for i in range(0, len(data), 8):
if i + 8 &lt;= len(data):
func_addr = int.from_bytes(data[i:i+8], 'little')
print(f&quot;[+] Init function {i//8}: 0x{func_addr:x}&quot;)

</code></pre>
<p>// Hook constructor call function
var call_constructors = Module.findExportByName(
&quot;linker64&quot;,
&quot;_ZN6soinfo17call_constructorsEv&quot;
);
if (call_constructors) {
Interceptor.attach(call_constructors, {
onEnter: function (args) {
var soinfo = args[0];
console.log(&quot;[+] Calling constructors for SO&quot;);
this.start_time = Date.now();
},
onLeave: function (retval) {
var duration = Date.now() - this.start_time;
console.log(&quot;[+] Constructors completed in &quot; + duration + &quot;ms&quot;);
},
});
}</p>
<p>// Directly hook init_array functions of target SO
hook_target_init_functions();
}</p>
<p>function hook_target_init_functions() {
var target_module = Process.findModuleByName(&quot;libtarget.so&quot;);
if (target_module) {
// Hook function at specific address based on static analysis results
var init_func_addr = target_module.base.add(0x2000); // Example address</p>
<p>Interceptor.attach(init_func_addr, {
onEnter: function (args) {
console.log(&quot;[!] init_string_obfuscation called&quot;);
console.log(&quot;[+] Call stack:&quot;);
console.log(
Thread.backtrace(this.context, Backtracer.ACCURATE)
.map(DebugSymbol.fromAddress)
.join(&quot;\n&quot;)
);
},
onLeave: function (retval) {
console.log(&quot;[!] init_string_obfuscation completed&quot;);
},
});
}
}</p>

                                            </div>
                                            
                                            <div class="section" id="section-65">
                                                <h2>65. ART Runtime</h2>
                                                <h1>android è¿è¡Œæ—¶ (ART) æ·±åº¦è§£æ</h1>
<h2>ART (Android Runtime) æ˜¯ Android 5.0 (Lollipop) ä¹‹åé»˜è®¤çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ç¯å¢ƒï¼Œå–ä»£äº†æ—§çš„ Dalvik è™šæ‹Ÿæœº (DVM)ã€‚ART çš„å¼•å…¥æ˜¾è‘—æ”¹å˜äº† Android åº”ç”¨çš„æ‰§è¡Œæ–¹å¼ï¼Œæ—¨åœ¨æé«˜åº”ç”¨çš„æ€§èƒ½ã€å¯åŠ¨é€Ÿåº¦å’Œç”µæ± ç»­èˆªã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#android-%E8%BF%90%E8%A1%8C%E6%97%B6-art-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">android è¿è¡Œæ—¶ (ART) æ·±åº¦è§£æ</a><ul>
<li><a href="#art-android-runtime-%E6%98%AF-android-50-lollipop-%E4%B9%8B%E5%90%8E%E9%BB%98%E8%AE%A4%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E7%8E%AF%E5%A2%83%E5%8F%96%E4%BB%A3%E4%BA%86%E6%97%A7%E7%9A%84-dalvik-%E8%99%9A%E6%8B%9F%E6%9C%BA-dvmart-%E7%9A%84%E5%BC%95%E5%85%A5%E6%98%BE%E8%91%97%E6%94%B9%E5%8F%98%E4%BA%86-android-%E5%BA%94%E7%94%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F%E6%97%A8%E5%9C%A8%E6%8F%90%E9%AB%98%E5%BA%94%E7%94%A8%E7%9A%84%E6%80%A7%E8%83%BD%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E5%92%8C%E7%94%B5%E6%B1%A0%E7%BB%AD%E8%88%AA">ART (Android Runtime) æ˜¯ Android 5.0 (Lollipop) ä¹‹åé»˜è®¤çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ç¯å¢ƒï¼Œå–ä»£äº†æ—§çš„ Dalvik è™šæ‹Ÿæœº (DVM)ã€‚ART çš„å¼•å…¥æ˜¾è‘—æ”¹å˜äº† Android åº”ç”¨çš„æ‰§è¡Œæ–¹å¼ï¼Œæ—¨åœ¨æé«˜åº”ç”¨çš„æ€§èƒ½ã€å¯åŠ¨é€Ÿåº¦å’Œç”µæ± ç»­èˆªã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6aot-vs-jit">æ ¸å¿ƒæœºåˆ¶ï¼šAOT vs JIT</a><ul>
<li><a href="#dalvik-%E7%9A%84-jit-just-in-time">Dalvik çš„ JIT (Just-In-Time)</a></li>
<li><a href="#art-%E7%9A%84-aot-ahead-of-time">ART çš„ AOT (Ahead-Of-Time)</a></li>
<li><a href="#%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%91-aot--jit">æ··åˆç¼–è¯‘ (AOT + JIT)</a></li>
</ul>
</li>
<li><a href="#art-%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F">ART ç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼</a><ul>
<li><a href="#oat-%E6%96%87%E4%BB%B6-oat">OAT æ–‡ä»¶ (<code>.oat</code>)</a></li>
<li><a href="#vdex-%E6%96%87%E4%BB%B6-vdex">VDEX æ–‡ä»¶ (<code>.vdex</code>)</a></li>
<li><a href="#art-%E6%96%87%E4%BB%B6-art-image">ART æ–‡ä»¶ (<code>.art</code>) (Image)</a></li>
</ul>
</li>
<li><a href="#art-vs-dalvik">ART vs. Dalvik</a></li>
<li><a href="#%E5%AF%B9%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%9A%84%E5%BD%B1%E5%93%8D">å¯¹é€†å‘å·¥ç¨‹çš„å½±å“</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>æ ¸å¿ƒæœºåˆ¶ï¼šAOT vs JIT</h3>
<p>!!! question &quot;æ€è€ƒï¼šä¸ºä»€ä¹ˆé€†å‘å·¥ç¨‹å¸ˆå¿…é¡»ç†è§£ ARTï¼Ÿ&quot;
ä½ å¯èƒ½ä¼šæƒ³ï¼š&quot;æˆ‘åªå…³å¿ƒåº”ç”¨çš„ Java ä»£ç å’ŒåŠ å¯†ç®—æ³•ï¼ŒART çš„ç¼–è¯‘æœºåˆ¶ä¸æˆ‘æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ&quot;</p>
<p><strong>å®é™…åœºæ™¯å‘Šè¯‰ä½ ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>Frida Hook å¤±è´¥</strong>ï¼šä½ å†™çš„ Hook è„šæœ¬åœ¨ Android 4.x ä¸Šå¥½ç”¨ï¼Œåœ¨ 8.0+ ä¸Šå°±ä¸å·¥ä½œäº†â€”â€”å› ä¸º ART çš„ AOT ç¼–è¯‘æ”¹å˜äº†æ–¹æ³•çš„æ‰§è¡Œæ–¹å¼</li>
<li><strong>è„±å£³å›°å¢ƒ</strong>ï¼šä½ ç”¨ä¼ ç»Ÿæ–¹æ³• dump DEXï¼Œç»“æœå‘ç°å…³é”®ç±»æ ¹æœ¬ä¸åœ¨ DEX é‡Œâ€”â€”å®ƒä»¬åœ¨è¿è¡Œæ—¶è¢«è§£å¯†åç›´æ¥ç¼–è¯‘æˆäº† OAT</li>
<li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šä¸ºä»€ä¹ˆåŒæ ·çš„ä»£ç åœ¨ä¸åŒ Android ç‰ˆæœ¬ä¸Šæ€§èƒ½å·®å¼‚å·¨å¤§ï¼Ÿæ··åˆç¼–è¯‘æ¨¡å¼æ˜¯å…³é”®</li>
<li><strong>åè°ƒè¯•å¯¹æŠ—</strong>ï¼šæŸäº› App ä¼šæ£€æµ‹ OAT æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œæˆ–è€…åˆ©ç”¨ <code>dex2oat</code> çš„æ—¶æœºæ¥è¿›è¡Œåè°ƒè¯•</li>
</ul>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ul>
<li>Android 5.0+ çš„åº”ç”¨ä¸å†æ˜¯ç®€å•çš„&quot;DEX å­—èŠ‚ç &quot;æ‰§è¡Œ</li>
<li>çœŸæ­£æ‰§è¡Œçš„æ˜¯ <strong>æœ¬åœ°æœºå™¨ç </strong>ï¼ˆOAT æ–‡ä»¶ï¼‰</li>
<li>ç†è§£ DEX â†’ VDEX â†’ OAT çš„è½¬æ¢æµç¨‹ï¼Œæ‰èƒ½åº”å¯¹ç°ä»£ Android é€†å‘</li>
</ul>
<h4>Dalvik çš„ JIT (Just-In-Time)</h4>
<p>åœ¨ Android 4.4 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ï¼ŒDalvik è™šæ‹Ÿæœºä½¿ç”¨ JIT ç¼–è¯‘ã€‚</p>
<ul>
<li><p><strong>å·¥ä½œæ–¹å¼</strong>: åº”ç”¨æ¯æ¬¡è¿è¡Œæ—¶ï¼ŒDalvik ä¼šè§£é‡Šæ‰§è¡Œ DEX å­—èŠ‚ç ã€‚å¯¹äºé¢‘ç¹æ‰§è¡Œçš„&quot;çƒ­ç‚¹ä»£ç &quot; (hotspot)ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°†å…¶åŠ¨æ€åœ°ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç å¹¶ç¼“å­˜ã€‚</p>
</li>
<li><p><strong>ä¼˜ç‚¹</strong>: å®‰è£…é€Ÿåº¦å¿«ï¼Œä¸å ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>: åº”ç”¨å¯åŠ¨å’Œè¿è¡ŒæœŸé—´éœ€è¦æŒç»­è¿›è¡Œè§£é‡Šå’Œç¼–è¯‘ï¼Œå¯¼è‡´å¯åŠ¨æ…¢ã€è€—ç”µå¤šã€‚</p>
</li>
</ul>
<h4>ART çš„ AOT (Ahead-Of-Time)</h4>
<p>ART æœ€åˆçš„è®¾è®¡æ˜¯çº¯ AOT ç¼–è¯‘ã€‚</p>
<ul>
<li><p><strong>å·¥ä½œæ–¹å¼</strong>: åœ¨åº”ç”¨<strong>å®‰è£…æ—¶</strong>ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ <code>dex2oat</code> å·¥å…·ï¼Œå°† APK ä¸­çš„ <code>classes.dex</code> æ–‡ä»¶å®Œæ•´åœ°ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œå¹¶ä»¥ OAT æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ã€‚</p>
</li>
<li><p><strong>ä¼˜ç‚¹</strong>:</p>
</li>
<li><p><strong>è¿è¡Œé€Ÿåº¦å¿«</strong>: åº”ç”¨ç›´æ¥æ‰§è¡Œæœ¬åœ°æœºå™¨ç ï¼Œæ— éœ€å®æ—¶ç¼–è¯‘ï¼Œæ€§èƒ½å’Œå¯åŠ¨é€Ÿåº¦éƒ½å¤§å¤§æå‡ã€‚</p>
</li>
<li><p><strong>æ›´çœç”µ</strong>: CPU åœ¨è¿è¡Œæ—¶è´Ÿæ‹…æ›´è½»ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong>:</p>
</li>
<li><p><strong>å®‰è£…æ—¶é—´é•¿</strong>: åº”ç”¨å®‰è£…è¿‡ç¨‹éœ€è¦é¢å¤–çš„ç¼–è¯‘æ—¶é—´ã€‚</p>
</li>
<li><p><strong>å ç”¨ç©ºé—´å¤§</strong>: é¢„ç¼–è¯‘çš„ OAT æ–‡ä»¶ä¼šå ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´ã€‚</p>
</li>
</ul>
<h4>æ··åˆç¼–è¯‘ (AOT + JIT)</h4>
<p>ä» Android 7.0 (Nougat) å¼€å§‹ï¼ŒART å¼•å…¥äº†ç»“åˆ JIT çš„æ··åˆç¼–è¯‘æ¨¡å¼ï¼Œä»¥å¹³è¡¡ä¸Šè¿°ä¼˜ç¼ºç‚¹ã€‚</p>
<ul>
<li><strong>å·¥ä½œæµç¨‹</strong>:</li>
</ul>
<ol>
<li><p><strong>åˆæ¬¡å®‰è£…</strong>: åº”ç”¨å®‰è£…é€Ÿåº¦å¾ˆå¿«ï¼Œä¸è¿›è¡Œ AOT ç¼–è¯‘ã€‚</p>
</li>
<li><p><strong>é¦–æ¬¡è¿è¡Œ</strong>: åº”ç”¨ä»£ç ç”±è§£é‡Šå™¨æ‰§è¡Œï¼ŒåŒæ—¶ JIT ç¼–è¯‘å™¨ä¼šä»‹å…¥ï¼Œç¼–è¯‘çƒ­ç‚¹ä»£ç ã€‚åœ¨æ­¤æœŸé—´ï¼ŒART ä¼šç”Ÿæˆä¸€ä»½<strong>ä»£ç æ‰§è¡Œé¢‘ç‡çš„åˆ†ææ–‡ä»¶ (Profile)</strong>ã€‚</p>
</li>
<li><p><strong>è®¾å¤‡ç©ºé—²æ—¶</strong>: å½“è®¾å¤‡å¤„äºç©ºé—²çŠ¶æ€å¹¶æ­£åœ¨å……ç”µæ—¶ï¼ŒAndroid ç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ªåå°ä¼˜åŒ–ä»»åŠ¡ã€‚è¯¥ä»»åŠ¡ä¼šæ ¹æ®ä¹‹å‰æ”¶é›†çš„ Profile ä¿¡æ¯ï¼Œ<strong>åªå¯¹é‚£äº›é¢‘ç¹æ‰§è¡Œçš„çƒ­ç‚¹æ–¹æ³•è¿›è¡Œ AOT ç¼–è¯‘</strong>ï¼Œå¹¶ç”Ÿæˆæ–°çš„ OAT æ–‡ä»¶ã€‚</p>
</li>
</ol>
<ul>
<li><strong>ä¼˜ç‚¹</strong>: å…¼é¡¾äº†å®‰è£…é€Ÿåº¦ã€è¿è¡Œæ€§èƒ½å’Œå­˜å‚¨å ç”¨ï¼Œæ˜¯ç›®å‰ Android çš„æ ‡å‡†æ‰§è¡Œæ¨¡å¼ã€‚</li>
</ul>
<hr />
<h3>ART ç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼</h3>
<p>å½“ ART å¤„ç†ä¸€ä¸ª APK æ—¶ï¼Œä¼šåœ¨ <code>/data/dalvik-cache/&lt;arch&gt;/</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€äº›ä¼˜åŒ–åçš„æ–‡ä»¶ã€‚</p>
<h4>OAT æ–‡ä»¶ (<code>.oat</code>)</h4>
<p>OAT (Optimized Android file format) æ–‡ä»¶æ˜¯æ ¸å¿ƒã€‚å®ƒåŒ…å«äº†ç”± <code>dex2oat</code> ä» DEX å­—èŠ‚ç ç¼–è¯‘è€Œæ¥çš„<strong>æœ¬åœ°æœºå™¨ç </strong> (ARM æ±‡ç¼–)ã€‚ä¸€ä¸ª OAT æ–‡ä»¶é€šå¸¸åŒ…å«ï¼š</p>
<ul>
<li><p><strong>oatdata</strong>: åŒ…å«å·²ç¼–è¯‘çš„æœ¬åœ°ä»£ç ã€‚</p>
</li>
<li><p><strong>oatexec</strong>: åŒ…å«å¯æ‰§è¡Œçš„æœ¬åœ°ä»£ç ã€‚</p>
</li>
<li><p><strong>oatlastword</strong>: æ ‡è¯† OAT æ–‡ä»¶çš„ç»“æŸã€‚</p>
</li>
</ul>
<h4>VDEX æ–‡ä»¶ (<code>.vdex</code>)</h4>
<p>ä» Android 8.0 (Oreo) å¼€å§‹å¼•å…¥ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œç³»ç»Ÿä¼šå°†åŸå§‹çš„ <code>classes.dex</code> æ–‡ä»¶è¿›è¡Œ&quot;è§£å‹ç¼©&quot;å’Œ&quot;éªŒè¯&quot;ï¼Œç”Ÿæˆä¸€ä¸ª VDEX (<code>Verified DEX</code>) æ–‡ä»¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li><p><strong>å¿«é€ŸéªŒè¯</strong>: ç³»ç»Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ VDEX æ–‡ä»¶ï¼Œè·³è¿‡äº†å¯¹åŸå§‹ DEX çš„éªŒè¯æ­¥éª¤ï¼ŒåŠ å¿«äº†åŠ è½½é€Ÿåº¦ã€‚</p>
</li>
<li><p><strong>å†…å®¹</strong>: VDEX æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœªå‹ç¼©çš„ã€å¸¦æœ‰é¢å¤–ä¾èµ–å’ŒéªŒè¯ä¿¡æ¯çš„ DEX æ–‡ä»¶ã€‚<code>dex2oat</code> ä¼šç›´æ¥ä½¿ç”¨ VDEX æ–‡ä»¶ä½œä¸ºè¾“å…¥æ¥ç”Ÿæˆ OAT æ–‡ä»¶ã€‚</p>
</li>
</ul>
<h4>ART æ–‡ä»¶ (<code>.art</code>) (Image)</h4>
<p>è¿™æ˜¯ä¸€ä¸ªé¢„åŠ è½½çš„é•œåƒæ–‡ä»¶ï¼ŒåŒ…å«äº†ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦é¢„åŠ è½½çš„ä¸€äº›æ ¸å¿ƒç±»ï¼ˆå¦‚ <code>java.lang.Object</code>ï¼‰ã€‚å½“ Zygote è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šç›´æ¥å°†è¿™ä¸ªé•œåƒæ˜ å°„åˆ°å†…å­˜ï¼Œä»è€Œé¿å…äº†å¯¹è¿™äº›å¸¸ç”¨ç±»è¿›è¡Œé‡å¤çš„åˆå§‹åŒ–ï¼ŒåŠ å¿«äº†æ‰€æœ‰åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ã€‚</p>
<p><strong>æ€»ç»“</strong>: åœ¨ç°ä»£ Android ç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œæµç¨‹æ˜¯ï¼š<code>classes.dex</code> -&gt; (å®‰è£…æ—¶) <code>.vdex</code> -&gt; (åå°ä¼˜åŒ–æ—¶) <code>.oat</code>ã€‚</p>
<hr />
<h3>ART vs. Dalvik</h3>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">ART</th>
  <th style="text-align:left">Dalvik</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>ç¼–è¯‘æ¨¡å¼</strong></td>
  <td style="text-align:left">AOT + JIT æ··åˆç¼–è¯‘</td>
  <td style="text-align:left">JIT</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ‰§è¡Œå•å…ƒ</strong></td>
  <td style="text-align:left">æœ¬åœ°æœºå™¨ç  (ä¸»è¦)</td>
  <td style="text-align:left">DEX å­—èŠ‚ç </td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ€§èƒ½</strong></td>
  <td style="text-align:left">æ›´é«˜</td>
  <td style="text-align:left">è¾ƒä½</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¯åŠ¨é€Ÿåº¦</strong></td>
  <td style="text-align:left">æ›´å¿«</td>
  <td style="text-align:left">è¾ƒæ…¢</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å®‰è£…æ—¶é—´</strong></td>
  <td style="text-align:left">æ›´å¿« (æ··åˆæ¨¡å¼ä¸‹)</td>
  <td style="text-align:left">å¿«</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å­˜å‚¨å ç”¨</strong></td>
  <td style="text-align:left">æ›´é«˜ (å›  OAT æ–‡ä»¶)</td>
  <td style="text-align:left">è¾ƒä½</td>
</tr>
<tr>
  <td style="text-align:left"><strong>åƒåœ¾å›æ”¶ (GC)</strong></td>
  <td style="text-align:left">ä¼˜åŒ–æ›´å¥½ï¼Œæš‚åœæ—¶é—´æ›´çŸ­</td>
  <td style="text-align:left">æ•ˆç‡è¾ƒä½</td>
</tr>
</tbody>
</table>
<hr />
<h3>å¯¹é€†å‘å·¥ç¨‹çš„å½±å“</h3>
<p>!!! tip &quot;å®æˆ˜æŠ€å·§ï¼šä» ART æœºåˆ¶æ‰¾åˆ°çªç ´å£&quot;
ç†è§£ ART çš„å·¥ä½œåŸç†ï¼Œèƒ½è®©ä½ æ‰¾åˆ°å¾ˆå¤š&quot;éå¸¸è§„&quot;çš„é€†å‘æ€è·¯ï¼š</p>
<p><strong>è„±å£³æ–°æ€è·¯</strong>ï¼š</p>
<ol>
<li><strong>ç›‘æ§ <code>dex2oat</code> è°ƒç”¨</strong>ï¼šæŸäº›å£³ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨ <code>dex2oat</code>ï¼Œç›‘æ§å…¶å‘½ä»¤è¡Œå‚æ•°èƒ½å‘ç°éšè—çš„ DEX</li>
<li><strong>ä» VDEX æå– DEX</strong>ï¼šAndroid 8.0+ çš„ VDEX æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ DEXï¼Œç”¨ <code>vdexExtractor</code> å¯ä»¥å¿«é€Ÿæå–</li>
<li><strong>ä» OAT è¿˜åŸ DEX</strong>ï¼šä½¿ç”¨ <code>oat2dex</code> ç­‰å·¥å…·ä»ç¼–è¯‘åçš„ OAT æ–‡ä»¶åæ¨åŸå§‹ DEX</li>
</ol>
<p><strong>Hook ä¼˜åŒ–ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>Java æ–¹æ³• Hook</strong>ï¼šä¼˜å…ˆ Hook Java å±‚ APIï¼Œæ›´ç¨³å®šé€šç”¨</li>
<li><strong>Native Hook</strong>ï¼šå½“ Java Hook å¤±æ•ˆæ—¶ï¼Œæ‰¾åˆ° ART ç¼–è¯‘åçš„æœºå™¨ç åœ°å€è¿›è¡Œ inline hook</li>
<li><strong>GOT/PLT Hook</strong>ï¼šHook åŠ¨æ€é“¾æ¥åº“çš„å¯¼å…¥è¡¨ï¼Œç»•è¿‡ä»£ç å®Œæ•´æ€§æ£€æŸ¥</li>
</ul>
<ul>
<li><p><strong>Hook ç‚¹çš„å˜åŒ–</strong>: ç”±äºå­˜åœ¨ AOT ç¼–è¯‘ï¼ŒFrida/Xposed ç­‰æ¡†æ¶çš„ Hook åŸç†ä¹Ÿéœ€è¦é€‚åº”ã€‚å®ƒä»¬ä¸ä»…ä»…æ˜¯ Hook Java æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯æ‰¾åˆ°äº†è¯¥æ–¹æ³•ç¼–è¯‘åçš„æœ¬åœ°æœºå™¨ç åœ°å€ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼ˆinline hookï¼‰ã€‚</p>
</li>
<li><p><strong>è„±å£³çš„å¤æ‚æ€§</strong>: è®¸å¤šåŠ å›ºå‚å•†åˆ©ç”¨ ART çš„ AOT æœºåˆ¶ã€‚ä»–ä»¬å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£å¯†å¹¶åŠ è½½ DEXï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨ <code>dex2oat</code> ç”Ÿæˆ OAT æ–‡ä»¶æ¥æ‰§è¡Œã€‚è¿™ä½¿å¾—ä¼ ç»Ÿçš„ DEX Dump æ–¹æ³•å¤±æ•ˆï¼Œéœ€è¦å¯¹ OAT æ–‡ä»¶æ ¼å¼å’Œ <code>dex2oat</code> çš„è°ƒç”¨æ—¶æœºè¿›è¡Œç›‘æ§ã€‚</p>
</li>
<li><p><strong>OAT æ–‡ä»¶åˆ†æ</strong>: é«˜çº§é€†å‘åˆ†ææœ‰æ—¶éœ€è¦ç›´æ¥åˆ†æ OAT æ–‡ä»¶ã€‚æœ‰ä¸€äº›å·¥å…·ï¼ˆå¦‚ <code>oatdump</code>ï¼‰å¯ä»¥ä» OAT æ–‡ä»¶ä¸­æå–å‡ºåŸå§‹çš„ DEX æ•°æ®æˆ–æŸ¥çœ‹ç¼–è¯‘åçš„æ±‡ç¼–ä»£ç ã€‚</p>
</li>
<li><p><strong>å¯»æ‰¾ä»£ç çš„æºå¤´</strong>: å³ä½¿ä»£ç è¢« AOT ç¼–è¯‘ï¼Œå…¶å…ƒæ•°æ®ä¾ç„¶ä¸åŸå§‹çš„ DEX æ–‡ä»¶ç›¸å…³è”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„åˆ†æèµ·ç‚¹é€šå¸¸è¿˜æ˜¯ä» <code>classes.dex</code> åç¼–è¯‘å‡ºçš„ Java ä»£ç å¼€å§‹ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸€å¤´æ‰è¿› OAT æ–‡ä»¶çš„æ±‡ç¼–ä»£ç ä¸­ã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-66">
                                                <h2>66. ARM Assembly</h2>
                                                <h1>ARM æ±‡ç¼–å…¥é—¨ (android Native)</h1>
<p>å½“åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘ã€åŠ å¯†ç®—æ³•æˆ–æ€§èƒ½å¯†é›†å‹ä»»åŠ¡ç”¨ C/C++ ç¼–å†™æ—¶ï¼Œå®ƒä»¬ä¼šè¢«ç¼–è¯‘æˆåŸç”Ÿåº“ (<code>.so</code> æ–‡ä»¶)ã€‚åœ¨ Android ä¸Šï¼Œè¿™äº›åº“ä¸»è¦æ˜¯ ARM æ¶æ„çš„ã€‚ç†è§£ ARM æ±‡ç¼–æ˜¯åˆ†æ <code>.so</code> æ–‡ä»¶çš„åŸºç¡€ã€‚æœ¬æŒ‡å—å°†ä»‹ç»é€†å‘å·¥ç¨‹å¸ˆéœ€è¦äº†è§£çš„ ARMv7 (32-bit) å’Œ ARMv8 (64-bit/A64) çš„åŸºç¡€çŸ¥è¯†ã€‚</p>
<p>!!! question &quot;æ€è€ƒï¼šä¸ºä»€ä¹ˆå¿…é¡»å­¦ä¹ æ±‡ç¼–ï¼Ÿ&quot;
å½“ä½ é‡åˆ°ä»¥ä¸‹åœºæ™¯æ—¶ï¼Œè¯¥å¦‚ä½•åº”å¯¹ï¼Ÿ</p>
<ul>
<li>ç”¨ Jadx æ‰“å¼€ APKï¼Œå‘ç°å…³é”®çš„åŠ å¯†é€»è¾‘éƒ½åœ¨ <code>native</code> æ–¹æ³•ä¸­</li>
<li>Frida Hook åˆ°äº†æŸä¸ª JNI å‡½æ•°ï¼Œä½†å‚æ•°æ˜¯æŒ‡é’ˆï¼Œä¸çŸ¥é“å¦‚ä½•è¯»å–</li>
<li>IDA æ‰“å¼€ <code>.so</code> æ–‡ä»¶ï¼Œæ»¡å±çš„æ±‡ç¼–æŒ‡ä»¤è®©ä½ æ— ä»ä¸‹æ‰‹</li>
</ul>
<h2>è¿™äº›åœºæ™¯çš„å…±åŒç‚¹æ˜¯ï¼š<strong>æ ¸å¿ƒé€»è¾‘è¢«ç¼–è¯‘æˆäº†æœºå™¨ç </strong>ã€‚ä¸ç†è§£æ±‡ç¼–ï¼Œå°±åƒè¯•å›¾åœ¨ä¸æ‡‚å¤–è¯­çš„æƒ…å†µä¸‹é˜…è¯»å¤–æ–‡ä¹¦ç±â€”â€”ä½ åªèƒ½é çŒœã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5arm-vs-x86"><strong>åŸºæœ¬æ¦‚å¿µï¼šARM vs x86</strong></a></li>
<li><a href="#%E5%AF%84%E5%AD%98%E5%99%A8-registers"><strong>å¯„å­˜å™¨ (Registers)</strong></a></li>
</ol>
<ul>
<li><p><a href="#arm-32-bit-armv7">ARM 32-bit (ARMv7)</a></p>
</li>
<li><p><a href="#arm-64-bit-aarch64">ARM 64-bit (AArch64)</a></p>
</li>
</ul>
<ol start="3">
<li><a href="#%E6%A0%B8%E5%BF%83%E6%8C%87%E4%BB%A4%E9%9B%86"><strong>æ ¸å¿ƒæŒ‡ä»¤é›†</strong></a></li>
</ol>
<ul>
<li><p><a href="#%E6%95%B0%E6%8D%AE%E7%A7%BB%E5%8A%A8%E6%8C%87%E4%BB%A4">æ•°æ®ç§»åŠ¨æŒ‡ä»¤</a></p>
</li>
<li><p><a href="#%E7%AE%97%E6%9C%AF%E4%B8%8E%E9%80%BB%E8%BE%91%E6%8C%87%E4%BB%A4">ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤</a></p>
</li>
<li><p><a href="#%E5%88%86%E6%94%AF%E4%B8%8E%E6%9D%A1%E4%BB%B6%E6%89%A7%E8%A1%8C%E6%8C%87%E4%BB%A4">åˆ†æ”¯ä¸æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤</a></p>
</li>
<li><p><a href="#%E6%A0%88%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4">æ ˆæ“ä½œæŒ‡ä»¤</a></p>
</li>
</ul>
<ol start="4">
<li><a href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A"><strong>å‡½æ•°è°ƒç”¨çº¦å®š (Procedure Call Standard)</strong></a></li>
<li><a href="#%E4%BB%8E-c-%E4%BB%A3%E7%A0%81%E5%88%B0%E6%B1%87%E7%BC%96"><strong>ä» C ä»£ç åˆ°æ±‡ç¼–</strong></a></li>
<li><a href="#ida-proghidra-%E4%B8%AD%E7%9A%84%E8%A7%86%E5%9B%BE"><strong>IDA Pro/Ghidra ä¸­çš„è§†å›¾</strong></a></li>
</ol>
<hr />
<h3>åŸºæœ¬æ¦‚å¿µï¼šARM vs x86</h3>
<ul>
<li><p><strong>RISC vs CISC</strong>: ARM æ˜¯<strong>ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœº (RISC)</strong>ï¼ŒæŒ‡ä»¤é•¿åº¦å›ºå®šï¼Œç§ç±»è¾ƒå°‘ï¼Œæ“ä½œç®€å•ã€‚x86 æ˜¯<strong>å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœº (CISC)</strong>ã€‚</p>
</li>
<li><p><strong>Load/Store æ¶æ„</strong>: ARM æ˜¯ä¸€ç§&quot;åŠ è½½/å­˜å‚¨&quot;æ¶æ„ã€‚è¿™æ„å‘³ç€æ•°æ®å¤„ç†ï¼ˆå¦‚åŠ æ³•ã€å‡æ³•ï¼‰<strong>åªèƒ½åœ¨å¯„å­˜å™¨ä¹‹é—´</strong>è¿›è¡Œã€‚ä½ å¿…é¡»å…ˆç”¨åŠ è½½æŒ‡ä»¤ (<code>LDR</code>) å°†å†…å­˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨ï¼Œè®¡ç®—å®Œæˆåå†ç”¨å­˜å‚¨æŒ‡ä»¤ (<code>STR</code>) å°†ç»“æœå­˜å›å†…å­˜ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤æ¨¡å¼</strong>: ARMv7 (32-bit) æ”¯æŒä¸¤ç§æŒ‡ä»¤é›†ï¼š</p>
</li>
<li><p><strong>ARM</strong>: 32-bit å®šé•¿æŒ‡ä»¤ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</p>
</li>
<li><p><strong>Thumb</strong>: 16-bit/32-bit å˜é•¿æŒ‡ä»¤ï¼Œä»£ç å¯†åº¦æ›´é«˜ï¼Œæ˜¯ç§»åŠ¨è®¾å¤‡ä¸Šçš„ä¸»æµã€‚åœ¨ IDA ç­‰å·¥å…·ä¸­ï¼Œä½ é€šå¸¸ä¼šåˆ†æ Thumb æ¨¡å¼ä¸‹çš„ä»£ç ã€‚</p>
</li>
</ul>
<hr />
<h3>å¯„å­˜å™¨ (Registers)</h3>
<p>å¯„å­˜å™¨æ˜¯ CPU å†…çš„é«˜é€Ÿå­˜å‚¨å•å…ƒã€‚</p>
<p>!!! tip &quot;å¿«é€Ÿå®šä½å…³é”®å¯„å­˜å™¨&quot;
åœ¨åˆ†æä¸€ä¸ªé™Œç”Ÿå‡½æ•°æ—¶ï¼Œå¦‚ä½•å¿«é€ŸæŠ“ä½é‡ç‚¹ï¼Ÿ</p>
<ul>
<li><strong>å‡½æ•°å…¥å£</strong>ï¼šå…ˆçœ‹ <code>R0-R3</code> (32 ä½) æˆ– <code>X0-X7</code> (64 ä½)ï¼Œè¿™äº›æ˜¯å‚æ•°</li>
<li><strong>å‡½æ•°è¿”å›</strong>ï¼šå…³æ³¨ <code>R0/X0</code>ï¼Œè¿™æ˜¯è¿”å›å€¼å­˜æ”¾çš„åœ°æ–¹</li>
<li><strong>å‡½æ•°è°ƒç”¨</strong>ï¼š<code>BL</code> æŒ‡ä»¤å‰åï¼Œæ£€æŸ¥å‚æ•°å¯„å­˜å™¨çš„å˜åŒ–</li>
<li><strong>æ ˆæ“ä½œ</strong>ï¼š<code>SP</code> çš„å˜åŒ–åæ˜ äº†å±€éƒ¨å˜é‡çš„åˆ†é…</li>
</ul>
<p>è¿™ç§&quot;é‡ç‚¹ä¼˜å…ˆ&quot;çš„é˜…è¯»ç­–ç•¥ï¼Œèƒ½è®©ä½ å¿«é€Ÿç†è§£å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œè€Œä¸å¿…é€è¡Œåˆ†ææ¯æ¡æŒ‡ä»¤ã€‚</p>
<h4>ARM 32-bit (ARMv7)</h4>
<p>å…±æœ‰ 16 ä¸ªé€šç”¨å¯„å­˜å™¨ (<code>R0</code> - <code>R15</code>)ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å¯„å­˜å™¨</th>
  <th style="text-align:left">åˆ«å</th>
  <th style="text-align:left">ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>R0</code> - <code>R3</code></td>
  <td style="text-align:left"><code>A1</code> - <code>A4</code></td>
  <td style="text-align:left"><strong>å‚æ•°å¯„å­˜å™¨</strong> (Argument)ã€‚ç”¨äºä¼ é€’å‡½æ•°çš„å‰ 4 ä¸ªå‚æ•°ã€‚<code>R0</code> ä¹Ÿç”¨ä½œ<strong>è¿”å›å€¼å¯„å­˜å™¨</strong>ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><code>R4</code> - <code>R11</code></td>
  <td style="text-align:left"><code>V1</code> - <code>V8</code></td>
  <td style="text-align:left"><strong>å˜é‡å¯„å­˜å™¨</strong> (Variable)ã€‚ç”¨äºä¿å­˜å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><code>R12</code></td>
  <td style="text-align:left"><code>IP</code></td>
  <td style="text-align:left">è¿‡ç¨‹è°ƒç”¨é—´ä¸´æ—¶å¯„å­˜å™¨ (Intra-Procedure call scratch register)ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><code>R13</code></td>
  <td style="text-align:left"><code>SP</code></td>
  <td style="text-align:left"><strong>æ ˆæŒ‡é’ˆ</strong> (Stack Pointer)ã€‚æŒ‡å‘æ ˆé¡¶ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><code>R14</code></td>
  <td style="text-align:left"><code>LR</code></td>
  <td style="text-align:left"><strong>é“¾æ¥å¯„å­˜å™¨</strong> (Link Register)ã€‚å­˜å‚¨å‡½æ•°è°ƒç”¨çš„è¿”å›åœ°å€ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><code>R15</code></td>
  <td style="text-align:left"><code>PC</code></td>
  <td style="text-align:left"><strong>ç¨‹åºè®¡æ•°å™¨</strong> (Program Counter)ã€‚æŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</td>
</tr>
</tbody>
</table>
<h4>ARM 64-bit (AArch64)</h4>
<p>å¯„å­˜å™¨æ•°é‡æ›´å¤šï¼Œä¸”åŠŸèƒ½æ›´æ˜ç¡®ã€‚</p>
<p>| å¯„å­˜å™¨        | ç”¨é€”                                                                       |
| :------------ | :------------------------------------------------------------------------- | -------------------------------- |
| <code>X0</code> - <code>X7</code>   | <strong>å‚æ•°å¯„å­˜å™¨</strong>ã€‚ç”¨äºä¼ é€’å‡½æ•°çš„å‰ 8 ä¸ªå‚æ•°ã€‚<code>X0</code> åŒæ ·ç”¨ä½œ<strong>è¿”å›å€¼å¯„å­˜å™¨</strong>ã€‚ |
| <code>X8</code> - <code>X18</code>  | è°ƒç”¨è€…/è¢«è°ƒç”¨è€…ä¿å­˜çš„ä¸´æ—¶å¯„å­˜å™¨ã€‚                                          |
| <code>X19</code> - <code>X28</code> | è¢«è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨ (Callee-saved)ã€‚                                      |
| <code>X29</code>         | <code>FP</code>                                                                       | <strong>å¸§æŒ‡é’ˆ</strong> (Frame Pointer)ã€‚     |
| <code>X30</code>         | <code>LR</code>                                                                       | <strong>é“¾æ¥å¯„å­˜å™¨</strong> (Link Register)ã€‚ |
| <code>SP</code>          | <strong>æ ˆæŒ‡é’ˆ</strong> (Stack Pointer)ã€‚                                               |</p>
<ul>
<li>æ³¨*: <code>W</code> å¯„å­˜å™¨ (<code>W0</code>, <code>W1</code>...) æ˜¯ <code>X</code> å¯„å­˜å™¨çš„ä½ 32 ä½ã€‚ä¾‹å¦‚ï¼Œå¯¹ <code>W0</code> çš„æ“ä½œå°±æ˜¯å¯¹ <code>X0</code> çš„ä½ 32 ä½è¿›è¡Œæ“ä½œã€‚</li>
</ul>
<hr />
<h3>æ ¸å¿ƒæŒ‡ä»¤é›†</h3>
<h4>æ•°æ®ç§»åŠ¨æŒ‡ä»¤</h4>
<ul>
<li><p><code>MOV R1, R2</code> (32-bit) / <code>MOV X1, X2</code> (64-bit): å°†å¯„å­˜å™¨ <code>R2</code> çš„å€¼ç§»åŠ¨åˆ° <code>R1</code>ã€‚</p>
</li>
<li><p><code>LDR R0, [SP, #4]</code> (32-bit) / <code>LDR X0, [SP, #8]</code> (64-bit): <strong>åŠ è½½</strong>ã€‚ä»æ ˆæŒ‡é’ˆ <code>SP</code> åç§» 4 (æˆ– 8) å­—èŠ‚çš„ä½ç½®è¯»å–æ•°æ®ï¼Œå¹¶å­˜å…¥ <code>R0</code> (æˆ– <code>X0</code>)ã€‚</p>
</li>
<li><p><code>STR R0, [SP, #4]</code> (32-bit) / <code>STR X0, [SP, #8]</code> (64-bit): <strong>å­˜å‚¨</strong>ã€‚å°† <code>R0</code> (æˆ– <code>X0</code>) çš„å€¼å†™å…¥åˆ° <code>SP</code> åç§» 4 (æˆ– 8) å­—èŠ‚çš„å†…å­˜åœ°å€ã€‚</p>
</li>
<li><p><code>ADR X0, aHelloWorld</code> (64-bit, PC-relative): <code>ADR</code> (Address PC-Relative) æŒ‡ä»¤å°†ä¸€ä¸ªç›¸å¯¹äº PC çš„åœ°å€ï¼ˆå¦‚å­—ç¬¦ä¸² &quot;Hello World&quot; çš„åœ°å€ï¼‰åŠ è½½åˆ° <code>X0</code>ã€‚</p>
</li>
</ul>
<h4>ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤</h4>
<ul>
<li><p><code>ADD R0, R1, R2</code>: <code>R0 = R1 + R2</code>ã€‚</p>
</li>
<li><p><code>SUB R0, R1, #1</code>: <code>R0 = R1 - 1</code>ã€‚</p>
</li>
<li><p><code>and R0, R0, #0xFF</code>: æŒ‰ä½ä¸ã€‚</p>
</li>
<li><p><code>CMP R0, #10</code>: <strong>æ¯”è¾ƒ</strong> <code>R0</code> å’Œ 10ã€‚è¯¥æŒ‡ä»¤ä¼šæ›´æ–°çŠ¶æ€å¯„å­˜å™¨ (CPSR)ï¼Œä½†ä¸å­˜å‚¨ç»“æœã€‚å®ƒæ€»æ˜¯ç´§è·Ÿåœ¨æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ä¹‹å‰ã€‚</p>
</li>
</ul>
<h4>åˆ†æ”¯ä¸æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤</h4>
<ul>
<li><p><code>B label</code>: <strong>åˆ†æ”¯</strong> (Branch)ã€‚æ— æ¡ä»¶è·³è½¬åˆ° <code>label</code>ã€‚</p>
</li>
<li><p><code>BL label</code>: <strong>å¸¦é“¾æ¥çš„åˆ†æ”¯</strong> (Branch with Link)ã€‚è·³è½¬åˆ° <code>label</code> ä¹‹å‰ï¼Œå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜å…¥ <code>LR</code> (é“¾æ¥å¯„å­˜å™¨)ã€‚è¿™æ˜¯<strong>å‡½æ•°è°ƒç”¨</strong>çš„æ ¸å¿ƒæŒ‡ä»¤ã€‚</p>
</li>
<li><p><code>BX LR</code> / <code>RET</code>: <strong>å¸¦äº¤æ¢çš„åˆ†æ”¯</strong> (Branch with Exchange) / <strong>è¿”å›</strong>ã€‚è·³è½¬åˆ° <code>LR</code> ä¸­çš„åœ°å€ï¼Œå®ç°å‡½æ•°è¿”å›ã€‚<code>RET</code> æ˜¯ <code>BX LR</code> çš„åˆ«åã€‚</p>
</li>
<li><p><code>B.EQ label</code>: <strong>æ¡ä»¶åˆ†æ”¯</strong>ã€‚å¦‚æœå‰ä¸€ä¸ª <code>CMP</code> æŒ‡ä»¤çš„ç»“æœæ˜¯ç›¸ç­‰ (Equal)ï¼Œåˆ™è·³è½¬ã€‚</p>
</li>
<li><p><code>B.NE label</code>: ä¸ç›¸ç­‰ (Not Equal)ã€‚</p>
</li>
<li><p><code>B.GT label</code>: å¤§äº (Greater Than)ã€‚</p>
</li>
<li><p><code>B.LT label</code>: å°äº (Less Than)ã€‚</p>
</li>
<li><p><code>B.GE label</code>: å¤§äºæˆ–ç­‰äº (Greater or Equal)ã€‚</p>
</li>
<li><p><code>B.LE label</code>: å°äºæˆ–ç­‰äº (Less or Equal)ã€‚</p>
</li>
</ul>
<h4>æ ˆæ“ä½œæŒ‡ä»¤</h4>
<ul>
<li><p><code>PUSH {R4, LR}</code>: å°† <code>R4</code> å’Œ <code>LR</code> å¯„å­˜å™¨å‹å…¥æ ˆã€‚é€šå¸¸åœ¨å‡½æ•°å¼€å¤´ï¼Œç”¨äºä¿å­˜éœ€è¦ä½¿ç”¨çš„å¯„å­˜å™¨å’Œè¿”å›åœ°å€ã€‚</p>
</li>
<li><p><code>POP {R4, PC}</code>: å°†æ ˆé¡¶æ•°æ®å¼¹å‡ºåˆ° <code>R4</code> å’Œ <code>PC</code>ã€‚<code>POP {..., PC}</code> æ˜¯ä¸€ç§å¸¸è§çš„å‡½æ•°è¿”å›æ–¹å¼ï¼Œå®ƒå°†ä¿å­˜åœ¨æ ˆä¸Šçš„ <code>LR</code> å€¼ç›´æ¥å¼¹å‡ºåˆ° <code>PC</code>ï¼Œå®ç°äº†è·³è½¬è¿”å›ã€‚</p>
</li>
<li><p><code>STP X29, X30, [SP, #-16]!</code> (A64): <code>STP</code> (Store Pair) æŒ‡ä»¤ï¼Œå°†ä¸€å¯¹å¯„å­˜å™¨ (<code>X29</code>/<code>FP</code>, <code>X30</code>/<code>LR</code>) å­˜å…¥ <code>SP</code> æŒ‡å‘çš„åœ°å€ï¼Œ<code>!</code> è¡¨ç¤º <code>SP</code> ä¼šé¢„å…ˆå‡å» 16ã€‚</p>
</li>
<li><p><code>LDP X29, X30, [SP], #16</code> (A64): <code>LDP</code> (Load Pair) æŒ‡ä»¤ï¼Œä» <code>SP</code> åœ°å€åŠ è½½æ•°æ®åˆ° <code>X29</code> å’Œ <code>X30</code>ï¼Œç„¶å <code>SP</code> å†å¢åŠ  16ã€‚</p>
</li>
</ul>
<hr />
<h3>å‡½æ•°è°ƒç”¨çº¦å®š (Procedure Call Standard)</h3>
<ol>
<li><strong>å‚æ•°ä¼ é€’</strong>:</li>
</ol>
<ul>
<li><p><strong>32-bit</strong>: å‰ 4 ä¸ªå‚æ•°é€šè¿‡ <code>R0</code> - <code>R3</code> ä¼ é€’ã€‚</p>
</li>
<li><p><strong>64-bit</strong>: å‰ 8 ä¸ªå‚æ•°é€šè¿‡ <code>X0</code> - <code>X7</code> ä¼ é€’ã€‚</p>
</li>
<li><p>è¶…å‡ºæ•°é‡çš„å‚æ•°é€šè¿‡<strong>æ ˆ</strong>ä¼ é€’ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>å‡½æ•°è°ƒç”¨</strong>: è°ƒç”¨è€…ä½¿ç”¨ <code>BL</code> æŒ‡ä»¤ã€‚</li>
<li><strong>å‡½æ•°åºè¨€ (Prologue)</strong>:</li>
</ol>
<ul>
<li><p>è¢«è°ƒç”¨å‡½æ•°ï¼ˆå­å‡½æ•°ï¼‰é¦–å…ˆè¦åšçš„æ˜¯ä¿å­˜ç°åœºã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>PUSH</code> æˆ– <code>STP</code> å°†éœ€è¦åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„å¯„å­˜å™¨ï¼ˆå¦‚ <code>R4-R11</code>, <code>FP</code>, <code>LR</code>) å‹å…¥æ ˆä¸­ã€‚</p>
</li>
<li><p>åˆ†é…æ ˆç©ºé—´ç»™å±€éƒ¨å˜é‡ (<code>SUB SP, SP, #...</code>)ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>å‡½æ•°ç»“è¯­ (Epilogue)</strong>:</li>
</ol>
<ul>
<li><p>å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå‡†å¤‡è¿”å›ã€‚</p>
</li>
<li><p>é‡Šæ”¾å±€éƒ¨å˜é‡çš„æ ˆç©ºé—´ (<code>ADD SP, SP, #...</code>)ã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>POP</code> æˆ– <code>LDP</code> ä»æ ˆä¸­æ¢å¤ä¹‹å‰ä¿å­˜çš„å¯„å­˜å™¨ã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>BX LR</code> æˆ– <code>RET</code> æˆ– <code>POP {PC}</code> è¿”å›ã€‚</p>
</li>
</ul>
<ol start="5">
<li><strong>è¿”å›å€¼</strong>:</li>
</ol>
<ul>
<li>ç®€å•çš„è¿”å›å€¼ï¼ˆæ•´æ•°ã€æŒ‡é’ˆï¼‰å­˜æ”¾åœ¨ <code>R0</code> (32-bit) æˆ– <code>X0</code> (64-bit) ä¸­ã€‚</li>
</ul>
<hr />
<h3>ä» C ä»£ç åˆ°æ±‡ç¼–</h3>
<p><strong>C ä»£ç :</strong></p>
<pre><code class="language-c">int add_one(int a) {
return a + 1;
}

</code></pre>
<p>BX LR ; return</p>
<pre><code>RET ; return

</code></pre>
<ul>
<li><strong>ä¼ªä»£ç è§†å›¾ (Pseudocode View)</strong>: IDA Pro (F5 é”®) å’Œ Ghidra çš„åç¼–è¯‘å™¨å¯ä»¥ç›´æ¥å°†æ±‡ç¼–ä»£ç è½¬æ¢æˆå¯è¯»æ€§å¾ˆé«˜çš„ C ä¼ªä»£ç ï¼Œè¿™æ˜¯é™æ€åˆ†æçš„åˆ©å™¨ã€‚é€šå¸¸å…ˆçœ‹ä¼ªä»£ç ï¼Œé‡åˆ°ä¸ç†è§£çš„åœ°æ–¹å†å›å¤´çœ‹æ±‡ç¼–ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-67">
                                                <h2>67. x86 & ARM Assembly Basics</h2>
                                                <h1>x86 ä¸ ARM æ±‡ç¼–åŸºç¡€æŒ‡å—</h1>
<p>æ±‡ç¼–è¯­è¨€æ˜¯ä¸è®¡ç®—æœºç¡¬ä»¶ç›´æ¥å¯¹è¯çš„ä½çº§ç¼–ç¨‹è¯­è¨€ï¼Œæ˜¯é€†å‘å·¥ç¨‹ã€ç³»ç»Ÿç¼–ç¨‹å’Œæ€§èƒ½ä¼˜åŒ–çš„åŸºçŸ³ã€‚åœ¨å½“ä»Šä¸–ç•Œï¼Œx86 å’Œ ARM æ˜¯ä¸¤ç§æœ€ä¸»æµçš„æŒ‡ä»¤é›†æ¶æ„ (ISA)ã€‚ç†è§£å®ƒä»¬çš„æ ¸å¿ƒæ¦‚å¿µä¸å·®å¼‚å¯¹äºé€†å‘å·¥ç¨‹å¸ˆè‡³å…³é‡è¦ã€‚</p>
<ul>
<li><p><strong>x86</strong>: ç”± Intel ä¸»å¯¼ï¼Œé‡‡ç”¨<strong>CISC (å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœº)</strong> è®¾è®¡ã€‚æŒ‡ä»¤é•¿åº¦å¯å˜ï¼ŒåŠŸèƒ½å¼ºå¤§ä½†å¤æ‚ï¼Œä¸»è¦ç”¨äºæ¡Œé¢å’ŒæœåŠ¡å™¨ã€‚</p>
</li>
<li><p><strong>ARM</strong>: ç”± ARM Holdings è®¾è®¡ï¼Œé‡‡ç”¨<strong>RISC (ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœº)</strong> è®¾è®¡ã€‚æŒ‡ä»¤é•¿åº¦å›ºå®šï¼Œè®¾è®¡ç®€æ´ä¼˜é›…ï¼ŒåŠŸè€—ä½ï¼Œä¸»å®°äº†ç§»åŠ¨å’ŒåµŒå…¥å¼è®¾å¤‡é¢†åŸŸã€‚</p>
</li>
</ul>
<hr />
<h2>ç›®å½•</h2>
<ul>
<li><a href="#x86-%E4%B8%8E-arm-%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E6%8C%87%E5%8D%97">x86 ä¸ ARM æ±‡ç¼–åŸºç¡€æŒ‡å—</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li>
<li><a href="#x86-%E6%B1%87%E7%BC%96-ia-32">x86 æ±‡ç¼– (IA-32)</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%AF%84%E5%AD%98%E5%99%A8">æ ¸å¿ƒå¯„å­˜å™¨</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4">å¸¸ç”¨æŒ‡ä»¤</a></li>
<li><a href="#%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A-calling-convention">è°ƒç”¨çº¦å®š (Calling Convention)</a></li>
</ul>
</li>
<li><a href="#arm-%E6%B1%87%E7%BC%96-armv7">ARM æ±‡ç¼– (ARMv7)</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%AF%84%E5%AD%98%E5%99%A8-1">æ ¸å¿ƒå¯„å­˜å™¨</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%AD%98%E5%82%A8-loadstore-%E6%9E%B6%E6%9E%84">åŠ è½½/å­˜å‚¨ (Load/Store) æ¶æ„</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4-1">å¸¸ç”¨æŒ‡ä»¤</a></li>
<li><a href="#%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A-aapcs">è°ƒç”¨çº¦å®š (AAPCS)</a></li>
</ul>
</li>
<li><a href="#x86-vs-arm-%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82%E5%AF%B9%E6%AF%94">x86 vs. ARM æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</a></li>
</ul>
</li>
</ul>
<hr />
<h2>x86 æ±‡ç¼– (IA-32)</h2>
<p>ä»¥ 32 ä½ x86 æ¶æ„ä¸ºä¾‹ï¼Œå…¶è®¾è®¡å¤æ‚è€Œçµæ´»ã€‚</p>
<h3>æ ¸å¿ƒå¯„å­˜å™¨</h3>
<p>8 ä¸ª 32 ä½é€šç”¨å¯„å­˜å™¨ï¼Œå®ƒä»¬æœ‰ä¸»è¦ç”¨é€”ï¼Œä½†åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥é€šç”¨ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å¯„å­˜å™¨</th>
  <th style="text-align:left">ä¸»è¦ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>EAX</strong></td>
  <td style="text-align:left"><strong>ç´¯åŠ å™¨ (Accumulator)</strong>: é€šå¸¸ç”¨äºå­˜æ”¾å‡½æ•°è¿”å›å€¼å’Œç®—æœ¯è¿ç®—ç»“æœã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>EBX</strong></td>
  <td style="text-align:left"><strong>åŸºå€ (Base)</strong>: å¸¸ä½œä¸ºæ•°æ®æ®µçš„åŸºå€æŒ‡é’ˆã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ECX</strong></td>
  <td style="text-align:left"><strong>è®¡æ•°å™¨ (Counter)</strong>: å¸¸ç”¨äºå¾ªç¯è®¡æ•°ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>EDX</strong></td>
  <td style="text-align:left"><strong>æ•°æ® (Data)</strong>: å¸¸ç”¨äºå­˜æ”¾æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¹˜é™¤æ³•ä¸­ä¸ EAX é…åˆã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ESP</strong></td>
  <td style="text-align:left"><strong>æ ˆæŒ‡é’ˆ (Stack Pointer)</strong>: <strong>æ°¸è¿œæŒ‡å‘æ ˆé¡¶</strong>ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>EBP</strong></td>
  <td style="text-align:left"><strong>åŸºå€æŒ‡é’ˆ (Base Pointer)</strong>: <strong>æ°¸è¿œæŒ‡å‘å½“å‰å‡½æ•°æ ˆå¸§çš„åº•éƒ¨</strong>ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>ESI</strong></td>
  <td style="text-align:left"><strong>æºå˜å€ (Source Index)</strong>: å­—ç¬¦ä¸²å’Œå†…å­˜æ“ä½œä¸­çš„æºåœ°å€ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>EDI</strong></td>
  <td style="text-align:left"><strong>ç›®çš„å˜å€ (Destination Index)</strong>: å­—ç¬¦ä¸²å’Œå†…å­˜æ“ä½œä¸­çš„ç›®çš„åœ°å€ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>EIP</strong></td>
  <td style="text-align:left"><strong>æŒ‡ä»¤æŒ‡é’ˆ (Instruction Pointer)</strong>: <strong>æ°¸è¿œæŒ‡å‘ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</strong>ã€‚</td>
</tr>
</tbody>
</table>
<h3>å¸¸ç”¨æŒ‡ä»¤</h3>
<ul>
<li><p><strong>æ•°æ®ä¼ é€</strong>:</p>
</li>
<li><p><code>MOV dest, src</code>: å°† <code>src</code> çš„å€¼èµ‹ç»™ <code>dest</code>ã€‚ (e.g., <code>MOV EAX, EBX</code>)</p>
</li>
<li><p><code>PUSH val</code>: å°† <code>val</code> å‹å…¥æ ˆé¡¶ï¼Œ<code>ESP</code> å‡ 4ã€‚</p>
</li>
<li><p><code>POP reg</code>: ä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå€¼åˆ° <code>reg</code>ï¼Œ<code>ESP</code> åŠ  4ã€‚</p>
</li>
<li><p><code>LEA reg, [mem]</code>: å°† <code>mem</code> çš„<strong>æœ‰æ•ˆåœ°å€</strong>åŠ è½½åˆ° <code>reg</code>ï¼Œè€Œä¸æ˜¯å…¶å†…å®¹ã€‚</p>
</li>
<li><p><strong>ç®—æœ¯è¿ç®—</strong>:</p>
</li>
<li><p><code>ADD dest, src</code>: <code>dest = dest + src</code></p>
</li>
<li><p><code>SUB dest, src</code>: <code>dest = dest - src</code></p>
</li>
<li><p><code>INC reg</code>: <code>reg = reg + 1</code></p>
</li>
<li><p><code>DEC reg</code>: <code>reg = reg - 1</code></p>
</li>
<li><p><strong>é€»è¾‘ä¸è·³è½¬</strong>:</p>
</li>
<li><p><code>CMP reg1, reg2</code>: æ¯”è¾ƒ <code>reg1</code> å’Œ <code>reg2</code> (å®é™…æ˜¯åšå‡æ³•)ï¼Œå¹¶æ ¹æ®ç»“æœè®¾ç½®æ ‡å¿—ä½ã€‚</p>
</li>
<li><p><code>JMP target</code>: æ— æ¡ä»¶è·³è½¬åˆ° <code>target</code> åœ°å€ã€‚</p>
</li>
<li><p><code>JE target</code>: å¦‚æœç›¸ç­‰ (Zero Flag=1) åˆ™è·³è½¬ã€‚</p>
</li>
<li><p><code>JNE target</code>: å¦‚æœä¸ç›¸ç­‰ (Zero Flag=0) åˆ™è·³è½¬ã€‚</p>
</li>
<li><p><code>JG/JL/JGE/JLE</code>: å¤§äº/å°äº/å¤§äºç­‰äº/å°äºç­‰äºæ—¶è·³è½¬ã€‚</p>
</li>
<li><p><strong>å‡½æ•°è°ƒç”¨</strong>:</p>
</li>
<li><p><code>CALL target</code>: å°† <code>EIP</code> çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹æ ˆï¼Œç„¶åè·³è½¬åˆ° <code>target</code>ã€‚</p>
</li>
<li><p><code>RET</code>: ä»æ ˆé¡¶å¼¹å‡ºåœ°å€ï¼Œå¹¶è·³è½¬åˆ°è¯¥åœ°å€ã€‚</p>
</li>
</ul>
<h3>è°ƒç”¨çº¦å®š (Calling Convention)</h3>
<p>è§„å®šäº†å‡½æ•°å¦‚ä½•ä¼ é€’å‚æ•°å’Œè¿”å›ç»“æœã€‚å¸¸è§äº 32 ä½ Windows çš„æ˜¯ <code>stdcall</code>ï¼Œè€Œ Linux/macOS ä¸Šå¸¸è§ <code>cdecl</code>ã€‚</p>
<ul>
<li><p><strong><code>cdecl</code></strong>:</p>
</li>
<li><p>å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­ã€‚</p>
</li>
<li><p><strong>è°ƒç”¨è€…</strong>è´Ÿè´£åœ¨å‡½æ•°è¿”å›åæ¸…ç†æ ˆã€‚</p>
</li>
<li><p><strong><code>stdcall</code></strong>:</p>
</li>
<li><p>å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­ã€‚</p>
</li>
<li><p><strong>è¢«è°ƒç”¨è€…</strong>è‡ªå·±è´Ÿè´£åœ¨è¿”å›å‰æ¸…ç†æ ˆã€‚</p>
</li>
</ul>
<hr />
<h2>ARM æ±‡ç¼– (ARMv7)</h2>
<p>ä»¥ 32 ä½ ARM æ¶æ„ä¸ºä¾‹ï¼Œå…¶è®¾è®¡ç®€æ´è€Œé«˜æ•ˆã€‚</p>
<h3>æ ¸å¿ƒå¯„å­˜å™¨</h3>
<p>å…±æœ‰ 16 ä¸ª 32 ä½é€šç”¨å¯„å­˜å™¨ (R0-R15)ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å¯„å­˜å™¨</th>
  <th style="text-align:left">åˆ«å</th>
  <th style="text-align:left">ä¸»è¦ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>R0 - R3</strong></td>
  <td style="text-align:left"></td>
  <td style="text-align:left"><strong>å‚æ•°/è¿”å›å€¼</strong>: ç”¨äºä¼ é€’å‡½æ•°çš„å‰ 4 ä¸ªå‚æ•°ï¼Œ<code>R0</code> ä¹Ÿç”¨äºå­˜æ”¾å‡½æ•°è¿”å›å€¼ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>R4 - R12</strong></td>
  <td style="text-align:left"></td>
  <td style="text-align:left">é€šç”¨å¯„å­˜å™¨ï¼Œç”¨äºä¿å­˜å±€éƒ¨å˜é‡ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>R13</strong></td>
  <td style="text-align:left"><strong>SP</strong></td>
  <td style="text-align:left"><strong>æ ˆæŒ‡é’ˆ (Stack Pointer)</strong>: æŒ‡å‘æ ˆé¡¶ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>R14</strong></td>
  <td style="text-align:left"><strong>LR</strong></td>
  <td style="text-align:left"><strong>é“¾æ¥å¯„å­˜å™¨ (Link Register)</strong>: <strong>å­˜å‚¨å‡½æ•°çš„è¿”å›åœ°å€</strong>ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>R15</strong></td>
  <td style="text-align:left"><strong>PC</strong></td>
  <td style="text-align:left"><strong>ç¨‹åºè®¡æ•°å™¨ (Program Counter)</strong>: <strong>æŒ‡å‘ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤</strong>ã€‚</td>
</tr>
</tbody>
</table>
<h3>åŠ è½½/å­˜å‚¨ (Load/Store) æ¶æ„</h3>
<p>è¿™æ˜¯ RISC çš„æ ¸å¿ƒæ€æƒ³ã€‚<strong>CPU ä¸èƒ½ç›´æ¥å¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œè¿ç®—</strong>ã€‚</p>
<ol>
<li>å¿…é¡»å…ˆç”¨ <code>LDR</code> (Load Register) æŒ‡ä»¤å°†å†…å­˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ã€‚</li>
<li>åœ¨å¯„å­˜å™¨ä¹‹é—´å®Œæˆæ‰€æœ‰ç®—æœ¯å’Œé€»è¾‘è¿ç®—ã€‚</li>
<li>å†ç”¨ <code>STR</code> (Store Register) æŒ‡ä»¤å°†ç»“æœå­˜å›å†…å­˜ã€‚</li>
</ol>
<h3>å¸¸ç”¨æŒ‡ä»¤</h3>
<ul>
<li><p><strong>æ•°æ®ä¼ é€</strong>:</p>
</li>
<li><p><code>MOV Rd, Rn</code>: å°† <code>Rn</code> çš„å€¼èµ‹ç»™ <code>Rd</code>ã€‚ (e.g., <code>MOV R0, R1</code>)</p>
</li>
<li><p><strong>ç®—æœ¯è¿ç®—</strong>:</p>
</li>
<li><p><code>ADD Rd, Rn, Rm</code>: <code>Rd = Rn + Rm</code></p>
</li>
<li><p><code>SUB Rd, Rn, Rm</code>: <code>Rd = Rn - Rm</code></p>
</li>
<li><p><strong>å†…å­˜æ“ä½œ</strong>:</p>
</li>
<li><p><code>LDR Rd, [Rn, #offset]</code>: ä»åœ°å€ <code>Rn + offset</code> åŠ è½½ä¸€ä¸ªå­—åˆ° <code>Rd</code>ã€‚</p>
</li>
<li><p><code>STR Rd, [Rn, #offset]</code>: å°† <code>Rd</code> çš„å€¼å­˜å‚¨åˆ°ä¸€ä¸ªå­—åˆ°åœ°å€ <code>Rn + offset</code>ã€‚</p>
</li>
<li><p><strong>æ ˆæ“ä½œ</strong>:</p>
</li>
<li><p><code>PUSH {reg_list}</code>: å°†å¯„å­˜å™¨åˆ—è¡¨å‹å…¥æ ˆã€‚</p>
</li>
<li><p><code>POP {reg_list}</code>: å°†å€¼ä»æ ˆä¸­å¼¹å‡ºåˆ°å¯„å­˜å™¨åˆ—è¡¨ã€‚</p>
</li>
<li><p><strong>è·³è½¬ä¸æ¯”è¾ƒ</strong>:</p>
</li>
<li><p><code>CMP Rn, Rm</code>: æ¯”è¾ƒ <code>Rn</code> å’Œ <code>Rm</code>ï¼Œå¹¶è®¾ç½®æ ‡å¿—ä½ã€‚</p>
</li>
<li><p><code>B target</code>: æ— æ¡ä»¶è·³è½¬åˆ° <code>target</code>ã€‚</p>
</li>
<li><p><code>BEQ target</code>: å¦‚æœç›¸ç­‰åˆ™è·³è½¬ã€‚</p>
</li>
<li><p><code>BNE target</code>: å¦‚æœä¸ç›¸ç­‰åˆ™è·³è½¬ã€‚</p>
</li>
<li><p><code>BL target</code>: <strong>(Branch with Link)</strong> &quot;è°ƒç”¨å‡½æ•°&quot;ã€‚å®ƒä¼š<strong>è‡ªåŠ¨å°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜å…¥ LR å¯„å­˜å™¨</strong>ï¼Œç„¶åè·³è½¬åˆ° <code>target</code>ã€‚</p>
</li>
<li><p>å‡½æ•°è¿”å›æ—¶ï¼Œåªéœ€æ‰§è¡Œ <code>MOV PC, LR</code> æˆ– <code>BX LR</code> å³å¯ã€‚</p>
</li>
</ul>
<h3>è°ƒç”¨çº¦å®š (AAPCS)</h3>
<p>ARM Procedure Call Standardã€‚</p>
<ul>
<li><p><strong>å‚æ•°ä¼ é€’</strong>:</p>
</li>
<li><p>å‰ 4 ä¸ªå‚æ•°é€šè¿‡ <strong>R0, R1, R2, R3</strong> ä¼ é€’ã€‚</p>
</li>
<li><p>å‰©ä½™çš„å‚æ•°é€šè¿‡æ ˆä¼ é€’ã€‚</p>
</li>
<li><p><strong>è¿”å›å€¼</strong>:</p>
</li>
<li><p>è¿”å›å€¼å­˜å‚¨åœ¨ <strong>R0</strong> ä¸­ã€‚</p>
</li>
<li><p><strong>è¿”å›åœ°å€</strong>:</p>
</li>
<li><p>é€šè¿‡ <strong>LR</strong> å¯„å­˜å™¨ç®¡ç†ã€‚</p>
</li>
</ul>
<hr />
<h2>x86 vs. ARM æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">x86 (CISC)</th>
  <th style="text-align:left">ARM (RISC)</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>æŒ‡ä»¤é›†</strong></td>
  <td style="text-align:left">å¤æ‚ï¼Œé•¿åº¦å¯å˜</td>
  <td style="text-align:left">ç²¾ç®€ï¼Œé•¿åº¦å›ºå®š</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å†…å­˜è®¿é—®</strong></td>
  <td style="text-align:left"><strong>å¯ä»¥ç›´æ¥å¯¹å†…å­˜æ“ä½œ</strong> (e.g., <code>ADD [mem], EAX</code>)</td>
  <td style="text-align:left"><strong>åŠ è½½/å­˜å‚¨æ¶æ„</strong> (å¿…é¡»å…ˆ <code>LDR</code>ï¼Œå† <code>STR</code>)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å¯„å­˜å™¨</strong></td>
  <td style="text-align:left">è¾ƒå°‘ï¼Œä¸”æœ‰ç‰¹å®šç”¨é€”</td>
  <td style="text-align:left">è¾ƒå¤šï¼Œå¤§å¤šä¸ºé€šç”¨å¯„å­˜å™¨</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å‡½æ•°è°ƒç”¨</strong></td>
  <td style="text-align:left"><code>CALL</code> æŒ‡ä»¤å‹æ ˆ <code>EIP</code></td>
  <td style="text-align:left"><code>BL</code> æŒ‡ä»¤å°†è¿”å›åœ°å€å­˜å…¥ <code>LR</code> å¯„å­˜å™¨</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å‚æ•°ä¼ é€’</strong></td>
  <td style="text-align:left">ä¸»è¦é€šè¿‡<strong>æ ˆ</strong></td>
  <td style="text-align:left">ä¸»è¦é€šè¿‡<strong>å¯„å­˜å™¨</strong> (R0-R3)</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ¡ä»¶æ‰§è¡Œ</strong></td>
  <td style="text-align:left">é€šè¿‡ <code>CMP</code> å’Œ <code>Jcc</code> è·³è½¬æŒ‡ä»¤</td>
  <td style="text-align:left"><strong>æ‰€æœ‰æŒ‡ä»¤éƒ½å¯ä»¥æ˜¯æ¡ä»¶æ‰§è¡Œçš„</strong> (e.g., <code>MOVEQ R0, R1</code>)</td>
</tr>
</tbody>
</table>

                                            </div>
                                            
                                            <div class="section" id="section-68">
                                                <h2>68. Android Sandbox Implementation</h2>
                                                <h1>android æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—</h1>
<p>Android æ²™ç®±æŠ€æœ¯ï¼Œé€šå¸¸ä¹Ÿè¢«ç§°ä¸º&quot;è™šæ‹ŸåŒ–å¼•æ“&quot;æˆ–&quot;App å¤šå¼€æ¡†æ¶&quot;ï¼Œæ˜¯ä¸€ç§åœ¨å•ä¸ª Android è®¾å¤‡ä¸Šåˆ›å»ºéš”ç¦»ç¯å¢ƒä»¥è¿è¡Œå…¶ä»–åº”ç”¨ç¨‹åºçš„æŠ€æœ¯ã€‚å®ƒå…è®¸ä¸€ä¸ª&quot;å®¿ä¸»&quot;åº”ç”¨ç¨‹åºåœ¨è‡ªå·±çš„è¿›ç¨‹ç©ºé—´å†…åŠ è½½å¹¶è¿è¡Œä¸€ä¸ª&quot;æ’ä»¶&quot;åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å¯¹æ’ä»¶åº”ç”¨çš„æ‰€æœ‰ç³»ç»Ÿäº¤äº’è¿›è¡Œæ‹¦æˆªå’Œç®¡ç†ã€‚</p>
<h2>è¿™é¡¹æŠ€æœ¯çš„æ ¸å¿ƒåº”ç”¨åŒ…æ‹¬ï¼šåº”ç”¨å¤šå¼€ã€æ— æ„ŸçŸ¥éšç§ä¿æŠ¤ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»¥åŠå…å®‰è£…è¿è¡Œ Appã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E6%B2%99%E7%AE%B1-vs-%E8%99%9A%E6%8B%9F%E6%9C%BA"><strong>æ ¸å¿ƒæ¦‚å¿µï¼šæ²™ç®± vs. è™šæ‹Ÿæœº</strong></a></li>
<li><a href="#%E6%B2%99%E7%AE%B1%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3"><strong>æ²™ç®±å®ç°åŸç†è¯¦è§£</strong></a></li>
</ol>
<ul>
<li><a href="#android-%E6%B2%99%E7%AE%B1%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97">android æ²™ç®±æŠ€æœ¯ä¸å®ç°æŒ‡å—</a><ul>
<li><a href="#%E8%BF%99%E9%A1%B9%E6%8A%80%E6%9C%AF%E7%9A%84%E6%A0%B8%E5%BF%83%E5%BA%94%E7%94%A8%E5%8C%85%E6%8B%AC%E5%BA%94%E7%94%A8%E5%A4%9A%E5%BC%80%E6%97%A0%E6%84%9F%E7%9F%A5%E9%9A%90%E7%A7%81%E4%BF%9D%E6%8A%A4%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E4%BB%A5%E5%8F%8A%E5%85%8D%E5%AE%89%E8%A3%85%E8%BF%90%E8%A1%8C-app">è¿™é¡¹æŠ€æœ¯çš„æ ¸å¿ƒåº”ç”¨åŒ…æ‹¬ï¼šåº”ç”¨å¤šå¼€ã€æ— æ„ŸçŸ¥éšç§ä¿æŠ¤ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»¥åŠå…å®‰è£…è¿è¡Œ Appã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E6%B2%99%E7%AE%B1-vs-%E8%99%9A%E6%8B%9F%E6%9C%BA">æ ¸å¿ƒæ¦‚å¿µï¼šæ²™ç®± vs. è™šæ‹Ÿæœº</a></li>
<li><a href="#%E6%B2%99%E7%AE%B1%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3">æ²™ç®±å®ç°åŸç†è¯¦è§£</a><ul>
<li><a href="#1-%E7%B1%BB%E5%8A%A0%E8%BD%BD-class-loading">1. ç±»åŠ è½½ (Class Loading)</a></li>
<li><a href="#2-%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86-component-lifecycle">2. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç† (Component Lifecycle)</a></li>
<li><a href="#3-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1-hook-api-hooking-via-binder-proxy">3. ç³»ç»ŸæœåŠ¡ Hook (API Hooking via Binder Proxy)</a></li>
<li><a href="#4-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86-resource-management">4. èµ„æºç®¡ç† (Resource Management)</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%80%E5%B0%8F%E5%8C%96%E6%B2%99%E7%AE%B1%E7%9A%84%E6%AD%A5%E9%AA%A4">å®ç°ä¸€ä¸ªæœ€å°åŒ–æ²™ç®±çš„æ­¥éª¤</a></li>
</ul>
</li>
<li><a href="#%E8%87%B3%E6%AD%A4%E6%8F%92%E4%BB%B6-activity-%E7%9A%84%E7%95%8C%E9%9D%A2%E5%B0%B1%E6%98%BE%E7%A4%BA%E5%87%BA%E6%9D%A5%E4%BA%86%E4%BD%86%E5%AE%83%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E8%BF%90%E8%A1%8C%E5%9C%A8-stubactivity-%E7%9A%84%E5%A3%B3%E9%87%8C">è‡³æ­¤ï¼Œæ’ä»¶ Activity çš„ç•Œé¢å°±æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯è¿è¡Œåœ¨ <code>StubActivity</code> çš„&quot;å£³&quot;é‡Œã€‚</a><ul>
<li><a href="#%E7%9F%A5%E5%90%8D%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%8F%82%E8%80%83">çŸ¥åå¼€æºé¡¹ç›®å‚è€ƒ</a></li>
<li><a href="#%E6%8C%91%E6%88%98%E4%B8%8E%E5%B1%80%E9%99%90">æŒ‘æˆ˜ä¸å±€é™</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li><a href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%80%E5%B0%8F%E5%8C%96%E6%B2%99%E7%AE%B1%E7%9A%84%E6%AD%A5%E9%AA%A4"><strong>å®ç°ä¸€ä¸ªæœ€å°åŒ–æ²™ç®±çš„æ­¥éª¤</strong></a></li>
<li><a href="#%E7%9F%A5%E5%90%8D%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%8F%82%E8%80%83"><strong>çŸ¥åå¼€æºé¡¹ç›®å‚è€ƒ</strong></a></li>
<li><a href="#%E6%8C%91%E6%88%98%E4%B8%8E%E5%B1%80%E9%99%90"><strong>æŒ‘æˆ˜ä¸å±€é™</strong></a></li>
</ol>
<hr />
<h3>æ ¸å¿ƒæ¦‚å¿µï¼šæ²™ç®± vs. è™šæ‹Ÿæœº</h3>
<ul>
<li><p><strong>è™šæ‹Ÿæœº (VM)</strong>: åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ã€ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿï¼Œæ‹¥æœ‰è‡ªå·±çš„å†…æ ¸å’Œç³»ç»ŸæœåŠ¡ï¼Œèµ„æºå¼€é”€å·¨å¤§ã€‚</p>
</li>
<li><p><strong>Android æ²™ç®±</strong>: ä¸åˆ›å»ºç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿã€‚å®ƒè¿è¡Œåœ¨å®¿ä¸» App çš„è¿›ç¨‹ä¸­ï¼Œä¸å®¿ä¸»å…±äº«åŒä¸€ä¸ª Android ç³»ç»Ÿå†…æ ¸å’Œè¿è¡Œæ—¶ã€‚å®ƒé€šè¿‡<strong>API Hooking</strong>çš„æ–¹å¼ï¼Œä¸ºæ’ä»¶ App åˆ›é€ äº†ä¸€ä¸ª&quot;è™šæ‹Ÿçš„&quot;è¿è¡Œç¯å¢ƒï¼Œæ‹¦æˆªå’Œé‡å®šå‘å…¶å¯¹ç³»ç»ŸæœåŠ¡çš„è¯·æ±‚ã€‚æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>è¿›ç¨‹å†…è™šæ‹ŸåŒ–</strong>ã€‚</p>
</li>
</ul>
<hr />
<h3>æ²™ç®±å®ç°åŸç†è¯¦è§£</h3>
<p>å®ç°ä¸€ä¸ª Android æ²™ç®±éœ€è¦è§£å†³å››å¤§æ ¸å¿ƒé—®é¢˜ï¼š</p>
<h4>1. ç±»åŠ è½½ (Class Loading)</h4>
<p>ç”±äºæ’ä»¶ App å¹¶æœªè¢«ç³»ç»Ÿ&quot;å®‰è£…&quot;ï¼Œå…¶ä»£ç ä¸èƒ½é€šè¿‡å¸¸è§„çš„ <code>PathClassLoader</code> åŠ è½½ã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: ä½¿ç”¨ <code>DexClassLoader</code>ã€‚å®¿ä¸» App éœ€è¦åˆ›å»ºä¸€ä¸ª <code>DexClassLoader</code> å®ä¾‹ï¼Œå°†æ’ä»¶ APK çš„è·¯å¾„å’Œå®¿ä¸» App çš„ç§æœ‰æ•°æ®ç›®å½•ï¼ˆç”¨äºå­˜æ”¾ä¼˜åŒ–åçš„ ODEX æ–‡ä»¶ï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™æ ·ï¼Œå®¿ä¸» App å°±èƒ½åŠ è½½å¹¶å®ä¾‹åŒ–æ’ä»¶ App ä¸­çš„ä»»æ„ç±»ã€‚</li>
</ul>
<h4>2. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç† (Component Lifecycle)</h4>
<p>æ’ä»¶ App çš„ç»„ä»¶ï¼ˆActivity, Service ç­‰ï¼‰å¹¶æ²¡æœ‰åœ¨å®¿ä¸» App çš„ <code>AndroidManifest.xml</code> ä¸­æ³¨å†Œï¼Œå› æ­¤æ— æ³•è¢«ç³»ç»Ÿç›´æ¥å¯åŠ¨ã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: <strong>å å‘ (Stub/Proxy Component)</strong>ã€‚</li>
</ul>
<ol>
<li><strong>åœ¨å®¿ä¸»ä¸­é¢„æ³¨å†Œ</strong>: åœ¨å®¿ä¸» App çš„ <code>AndroidManifest.xml</code> ä¸­é¢„å…ˆæ³¨å†Œä¸€ç³»åˆ—&quot;å å‘&quot;çš„ç»„ä»¶ï¼Œä¾‹å¦‚ <code>StubActivity1</code>, <code>StubActivity2</code>, <code>StubService1</code>...</li>
<li><strong>è¯·æ±‚æ‹¦æˆªä¸æ›¿æ¢</strong>: å½“æ’ä»¶ App æƒ³è¦å¯åŠ¨ä¸€ä¸ªç»„ä»¶æ—¶ï¼ˆä¾‹å¦‚ <code>startActivity(intentToPluginActivity)</code>ï¼‰ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè¢«æˆ‘ä»¬ä¸‹ä¸€æ­¥è¦è®²çš„ç³»ç»ŸæœåŠ¡ Hook æ‹¦æˆªåˆ°ã€‚</li>
<li><strong>ç§»èŠ±æ¥æœ¨</strong>: æ‹¦æˆªåˆ°è¯·æ±‚åï¼Œæ²™ç®±æ¡†æ¶ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å‘&quot;å å‘&quot;Activity çš„æ–° <code>Intent</code> (<code>intentToStubActivity</code>)ï¼Œå¹¶å°†åŸå§‹çš„ <code>Intent</code> ä½œä¸º extra æ•°æ®é™„åŠ åˆ°æ–° <code>Intent</code> ä¸Šã€‚ç„¶åï¼Œå®ƒä¼šç”¨è¿™ä¸ªæ–°çš„ <code>Intent</code> å»è°ƒç”¨åŸå§‹çš„ç³»ç»ŸæœåŠ¡ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸå§”æ‰˜</strong>: ç³»ç»Ÿå¯åŠ¨äº† <code>StubActivity</code>ã€‚åœ¨ <code>StubActivity</code> çš„ <code>onCreate</code> æ–¹æ³•ä¸­ï¼Œå®ƒä¼šä» extra ä¸­æ¢å¤å‡ºåŸå§‹ <code>Intent</code>ï¼Œå¾—çŸ¥è‡ªå·±éœ€è¦æ‰®æ¼”å“ªä¸ªæ’ä»¶ Activity çš„è§’è‰²ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨ç¬¬ä¸€æ­¥çš„ <code>DexClassLoader</code> å®ä¾‹åŒ–çœŸæ­£çš„æ’ä»¶ Activityï¼Œå¹¶æ‰‹åŠ¨è°ƒç”¨å…¶ <code>onCreate</code>, <code>onStart</code>, <code>onResume</code> ç­‰æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå°†è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ&quot;å§”æ‰˜&quot;ç»™æ’ä»¶ Activityã€‚</li>
</ol>
<h4>3. ç³»ç»ŸæœåŠ¡ Hook (API Hooking via Binder Proxy)</h4>
<p>è¿™æ˜¯æ•´ä¸ªæ²™ç®±æŠ€æœ¯<strong>æœ€æ ¸å¿ƒã€æœ€å¤æ‚</strong>çš„éƒ¨åˆ†ã€‚æ’ä»¶ App çš„æ‰€æœ‰è¡Œä¸ºï¼Œå¦‚å¯åŠ¨ Activityã€å‘é€å¹¿æ’­ã€è®¿é—®æ•°æ®åº“ï¼Œéƒ½æ˜¯é€šè¿‡è°ƒç”¨ç³»ç»ŸæœåŠ¡å®Œæˆçš„ã€‚æˆ‘ä»¬å¿…é¡»æ‹¦æˆªè¿™äº›è°ƒç”¨ã€‚</p>
<ul>
<li><p><strong>ç›®æ ‡</strong>: Android çš„å„ç§ <code>XXXManager</code>ï¼ˆå¦‚ <code>ActivityManager</code>, <code>PackageManager</code>ï¼‰å®é™…ä¸Šéƒ½æ˜¯é€šè¿‡ Binder IPC ä¸ç³»ç»ŸæœåŠ¡ (<code>ActivityManagerService</code>, <code>PackageManagerService</code>) é€šä¿¡çš„ã€‚æˆ‘ä»¬éœ€è¦ Hook çš„å°±æ˜¯è¿™ä¸ªé€šä¿¡çš„æ¥å£ã€‚</p>
</li>
<li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>: <strong>åŠ¨æ€ä»£ç† (Dynamic Proxy)</strong>ã€‚</p>
</li>
</ul>
<ol>
<li><strong>å®šä½ Binder æ¥å£</strong>: ä½¿ç”¨ Java åå°„æ‰¾åˆ° <code>ActivityManager</code> ç­‰ç±»ä¸­æŒæœ‰çš„ <code>IActivityManager</code> ç±»å‹çš„ Binder ä»£ç†å¯¹è±¡ã€‚</li>
<li><strong>åˆ›å»ºä»£ç†å¯¹è±¡</strong>: ä½¿ç”¨ <code>java.lang.reflect.Proxy.newProxyInstance()</code> æ–¹æ³•ï¼Œä¸ºåŸå§‹çš„ <code>IActivityManager</code> Binder ä»£ç†å¯¹è±¡åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ã€‚</li>
<li><strong>å®ç° <code>InvocationHandler</code></strong>: åœ¨ <code>InvocationHandler</code> çš„ <code>invoke</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ‰€æœ‰å¯¹ <code>IActivityManager</code> æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼ˆå¦‚ <code>startActivity</code>, <code>getRunningAppProcesses</code> ç­‰ï¼‰ã€‚</li>
<li><strong>è¯·æ±‚é‡å®šå‘</strong>: åœ¨ <code>invoke</code> æ–¹æ³•ä¸­ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ¥è‡ªæ’ä»¶ Appã€‚å¦‚æœæ˜¯ï¼Œå°±ä¸æ‰§è¡ŒåŸå§‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯å°†å…¶é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±çš„æ²™ç®±ç®¡ç†é€»è¾‘ä¸­ï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œä¸Šè¿°çš„&quot;å å‘&quot;æµç¨‹ï¼‰ã€‚å¦‚æœä¸æ˜¯ï¼Œå°±è°ƒç”¨åŸå§‹çš„ Binder æ–¹æ³•ï¼Œä¿è¯å®¿ä¸» App è‡ªèº«åŠŸèƒ½æ­£å¸¸ã€‚</li>
</ol>
<h4>4. èµ„æºç®¡ç† (Resource Management)</h4>
<p>æ’ä»¶ App éœ€è¦åŠ è½½è‡ªå·±çš„å¸ƒå±€ã€å­—ç¬¦ä¸²ã€å›¾ç‰‡ç­‰èµ„æºã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Resources</code> å¯¹è±¡ã€‚</li>
</ul>
<ol>
<li>é€šè¿‡ <code>AssetManager</code> çš„éšè—æ–¹æ³• <code>addAssetPath()</code>ï¼Œå°†æ’ä»¶ APK çš„è·¯å¾„æ·»åŠ åˆ° <code>AssetManager</code> ä¸­ã€‚</li>
<li>åŸºäºè¿™ä¸ª <code>AssetManager</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Resources</code> å¯¹è±¡ã€‚</li>
<li>åœ¨åˆ›å»ºæ’ä»¶ Activity ç­‰ç»„ä»¶æ—¶ï¼Œå°†è¿™ä¸ªè‡ªå®šä¹‰çš„ <code>Resources</code> å¯¹è±¡æ³¨å…¥åˆ°å…¶ <code>Context</code> ä¸­ï¼Œä»è€Œè®©å®ƒå¯ä»¥è®¿é—®åˆ°è‡ªå·±çš„èµ„æºã€‚</li>
</ol>
<hr />
<h3>å®ç°ä¸€ä¸ªæœ€å°åŒ–æ²™ç®±çš„æ­¥éª¤</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯åŠ¨æ’ä»¶ Activity çš„æç®€æµç¨‹ï¼š</p>
<ol>
<li><strong>å‡†å¤‡</strong>:</li>
</ol>
<ul>
<li><p>ä¸€ä¸ªå®¿ä¸» Appã€‚</p>
</li>
<li><p>ä¸€ä¸ªæ’ä»¶ App çš„ APK æ–‡ä»¶ã€‚</p>
</li>
<li><p>åœ¨å®¿ä¸» App çš„ <code>AndroidManifest.xml</code> ä¸­æ³¨å†Œä¸€ä¸ª <code>StubActivity</code>ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>Hook AMS</strong>: åœ¨å®¿ä¸» App å¯åŠ¨æ—¶ï¼ˆå¦‚ <code>Application.onCreate</code>ï¼‰ï¼Œé€šè¿‡åå°„å’ŒåŠ¨æ€ä»£ç†ï¼ŒHook <code>IActivityManager</code>ã€‚</li>
<li><strong>åŠ è½½æ’ä»¶</strong>: å½“ç”¨æˆ·è§¦å‘&quot;å¯åŠ¨æ’ä»¶&quot;æ“ä½œæ—¶ï¼š</li>
</ol>
<ul>
<li><p>åˆ›å»º <code>DexClassLoader</code> å’Œè‡ªå®šä¹‰ <code>Resources</code> å¯¹è±¡ã€‚</p>
</li>
<li><p>æ„é€ ä¸€ä¸ªæŒ‡å‘æ’ä»¶ä¸» Activity çš„ <code>Intent</code>ã€‚</p>
</li>
<li><p>è°ƒç”¨ <code>startActivity(pluginIntent)</code>ã€‚</p>
</li>
</ul>
<ol start="4">
<li><strong>æ‹¦æˆªä¸æ›¿æ¢</strong>:</li>
</ol>
<ul>
<li><p><code>IActivityManager</code> çš„åŠ¨æ€ä»£ç† <code>invoke</code> æ–¹æ³•æ‹¦æˆªåˆ°è¿™ä¸ª <code>startActivity</code> è°ƒç”¨ã€‚</p>
</li>
<li><p><code>invoke</code> æ–¹æ³•å‘ç°è¿™æ˜¯ä¸€ä¸ªæ’ä»¶ <code>Intent</code>ï¼Œäºæ˜¯å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ <code>StubActivity</code> çš„ <code>Intent</code>ï¼Œå¹¶å°†åŸ <code>Intent</code> å­˜å…¥ extraã€‚</p>
</li>
</ul>
<ol start="5">
<li><strong>å¯åŠ¨ä¸è¿˜åŸ</strong>:</li>
</ol>
<ul>
<li><p>ç³»ç»Ÿæ­£å¸¸å¯åŠ¨ <code>StubActivity</code>ã€‚</p>
</li>
<li><p><code>StubActivity</code> åœ¨ <code>onCreate</code> ä¸­ï¼Œè§£æå‡ºæ’ä»¶ Activity çš„ç±»åã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>DexClassLoader</code> åå°„åˆ›å»ºæ’ä»¶ Activity å®ä¾‹ã€‚</p>
</li>
<li><p>å°†è‡ªå®šä¹‰ <code>Resources</code> ç­‰æ³¨å…¥æ’ä»¶ Activity çš„ <code>Context</code>ã€‚</p>
</li>
<li><p>æ‰‹åŠ¨è°ƒç”¨æ’ä»¶ Activity çš„ <code>onCreate()</code> ç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p>
</li>
</ul>
<h2>è‡³æ­¤ï¼Œæ’ä»¶ Activity çš„ç•Œé¢å°±æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯è¿è¡Œåœ¨ <code>StubActivity</code> çš„&quot;å£³&quot;é‡Œã€‚</h2>
<h3>çŸ¥åå¼€æºé¡¹ç›®å‚è€ƒ</h3>
<p>ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªå®Œæ•´çš„æ²™ç®±æ¡†æ¶éå¸¸å›°éš¾ï¼Œä»¥ä¸‹é¡¹ç›®æ˜¯æä½³çš„å­¦ä¹ èµ„æºï¼š</p>
<ul>
<li><p><strong>VirtualApp</strong>: æœ€è‘—åçš„ Android æ²™ç®±é¡¹ç›®ä¹‹ä¸€ï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜¯å­¦ä¹ åŸç†çš„ç»ä½³èŒƒä¾‹ã€‚</p>
</li>
<li><p><strong>DroidPlugin</strong>: ç”± 360 å¼€å‘çš„æ—©æœŸæ²™ç®±é¡¹ç›®ï¼Œå¯¹å››å¤§ç»„ä»¶çš„æ”¯æŒéå¸¸å®Œæ•´ã€‚</p>
</li>
</ul>
<hr />
<h3>æŒ‘æˆ˜ä¸å±€é™</h3>
<ul>
<li><p><strong>å…¼å®¹æ€§</strong>: Android ç‰ˆæœ¬æ¯æ¬¡å¤§æ›´æ–°ï¼Œå¤§é‡ç³»ç»ŸæœåŠ¡å†…éƒ¨å®ç°ä¼šæ”¹å˜ï¼Œéœ€è¦æŒç»­é€‚é…ã€‚</p>
</li>
<li><p><strong>å¤æ‚æ€§</strong>: éœ€è¦å¤„ç†å››å¤§ç»„ä»¶ã€æ–‡ä»¶ç³»ç»Ÿã€Content Providerã€ç³»ç»Ÿå¹¿æ’­ç­‰æ–¹æ–¹é¢é¢çš„è™šæ‹ŸåŒ–ã€‚</p>
</li>
<li><p><strong>Native Code</strong>: å¯¹åŒ…å« JNI/Native ä»£ç çš„ App æ”¯æŒèµ·æ¥æ›´å¤æ‚ï¼Œå¯èƒ½éœ€è¦å¯¹ so æ–‡ä»¶çš„åŠ è½½å’Œç¬¦å·è§£æè¿›è¡Œ Hookã€‚</p>
</li>
<li><p><strong>å‚å•† ROM</strong>: ä¸åŒæ‰‹æœºå‚å•†å¯¹ Android ç³»ç»Ÿçš„é­”æ”¹ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ²™ç®±åœ¨æŸäº›è®¾å¤‡ä¸Šå¤±æ•ˆã€‚</p>
</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-69">
                                                <h2>69. AOSP & System Customization</h2>
                                                <h1>AOSP ä¸ Android ç³»ç»Ÿè£å‰ª</h1>
<p>Android å¼€æºé¡¹ç›®ï¼ˆAOSPï¼‰æ˜¯ Android æ“ä½œç³»ç»Ÿçš„å¼€æºåŸºç¡€ã€‚èƒ½å¤Ÿç¼–è¯‘å’Œä¿®æ”¹ AOSP æ˜¯è¿›è¡Œæ·±åº¦ç³»ç»Ÿçº§å®šåˆ¶ã€å®‰å…¨ç ”ç©¶å’Œ ROM å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æœ¬èŠ‚å°†ä»‹ç» AOSP çš„åŸºæœ¬æ¦‚å¿µã€ç¼–è¯‘æµç¨‹ä»¥åŠå¸¸è§çš„ç³»ç»Ÿè£å‰ªæŠ€æœ¯ã€‚</p>
<h2>1. AOSP åŸºç¡€ä¸ç¼–è¯‘</h2>
<h3>a) AOSP æºç åŒæ­¥</h3>
<p>ç¼–è¯‘ AOSP çš„ç¬¬ä¸€æ­¥æ˜¯è·å–å…¶åºå¤§çš„æºä»£ç æ ‘ã€‚</p>
<ol>
<li><p><strong>ç¯å¢ƒå‡†å¤‡</strong>:</p>
<ul>
<li>ä¸€ä¸ªå¼ºå¤§çš„ Linux æ„å»ºæœåŠ¡å™¨ï¼ˆæ¨è Ubuntu LTSï¼‰ï¼Œè‡³å°‘éœ€è¦ 16GB RAM å’Œ 300GB çš„å¯ç”¨ç£ç›˜ç©ºé—´ã€‚</li>
<li>å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…ï¼Œå¦‚ <code>git</code>, <code>curl</code>, <code>python</code>, <code>Java SDK</code> ç­‰ã€‚</li>
</ul>
</li>
<li><p><strong>è·å– Repo å·¥å…·</strong>: <code>Repo</code> æ˜¯ Google å¼€å‘çš„ã€åŸºäº Git çš„ä»£ç åº“ç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç† AOSP ä¸­æ•°ç™¾ä¸ªä¸åŒçš„ Git ä»“åº“ã€‚</p>
</li>
</ol>
<pre><code class="language-bash"># ä¸‹è½½ Repo å·¥å…·
mkdir -p ~/.bin
curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/.bin/repo
chmod a+x ~/.bin/repo
export PATH=~/.bin:$PATH
</code></pre>
<pre><code class="language-bash"># åˆ›å»ºå·¥ä½œç›®å½•
mkdir aosp &amp;&amp; cd aosp

# åˆå§‹åŒ–æºç ä»“åº“ï¼ŒæŒ‡å®šåˆ†æ”¯ï¼ˆä¾‹å¦‚ android-12.0.0_r1ï¼‰
repo init -u https://android.googlesource.com/platform/manifest -b android-12.0.0_r1 --depth=1

# å¼€å§‹åŒæ­¥æºç ï¼ˆè¿™å°†æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼‰
repo sync -c -j8
</code></pre>
<ul>
<li><code>--depth=1</code>: åªåŒæ­¥æœ€æ–°çš„ commitï¼Œå¤§å¹…å‡å°‘ä¸‹è½½é‡ã€‚</li>
<li><code>-c</code>: åªåŒæ­¥å½“å‰åˆ†æ”¯ã€‚</li>
<li><code>-j8</code>: ä½¿ç”¨ 8 ä¸ªçº¿ç¨‹å¹¶è¡ŒåŒæ­¥ã€‚</li>
</ul>
<h3>b) ç¼–è¯‘æµç¨‹</h3>
<ol>
<li><strong>è®¾ç½®ç¯å¢ƒ</strong>:</li>
</ol>
<pre><code class="language-bash">source build/envsetup.sh
</code></pre>
<ol start="2">
<li><strong>é€‰æ‹©ç›®æ ‡ (Lunch)</strong>:</li>
</ol>
<pre><code class="language-bash">lunch aosp_arm64-eng
</code></pre>
<ul>
<li><code>aosp_arm64</code>: ç›®æ ‡è®¾å¤‡æ¶æ„ï¼ˆ64 ä½ ARMï¼‰ã€‚</li>
<li><code>eng</code>: æ„å»ºå˜ä½“ï¼ˆEngineeringï¼‰ï¼ŒåŒ…å«æœ€å¤šçš„è°ƒè¯•å·¥å…·ï¼Œæƒé™ä¸º rootï¼Œé€‚åˆå¼€å‘å’Œé€†å‘ã€‚å…¶ä»–è¿˜æœ‰ <code>user</code>ï¼ˆå‘å¸ƒç‰ˆï¼‰å’Œ <code>userdebug</code>ï¼ˆå¸¦ root å’Œè°ƒè¯•åŠŸèƒ½çš„ç”¨æˆ·ç‰ˆï¼‰ã€‚</li>
</ul>
<ol start="3">
<li><strong>å¼€å§‹ç¼–è¯‘ (Make)</strong>:</li>
</ol>
<pre><code class="language-bash">m
</code></pre>
<ol start="4">
<li><strong>ç¼–è¯‘äº§ç‰©</strong>:</li>
</ol>
<p>ç¼–è¯‘å®Œæˆåï¼Œæ‰€æœ‰çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶éƒ½å­˜æ”¾åœ¨ <code>out/target/product/&lt;device_name&gt;/</code> ç›®å½•ä¸‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>system.img</code>: ç³»ç»Ÿåˆ†åŒºé•œåƒã€‚</li>
<li><code>vendor.img</code>: å‚å•†åˆ†åŒºé•œåƒã€‚</li>
<li><code>boot.img</code>: å¯åŠ¨åˆ†åŒºé•œåƒï¼ŒåŒ…å«å†…æ ¸å’Œ ramdiskã€‚</li>
<li><code>userdata.img</code>: ç”¨æˆ·æ•°æ®åˆ†åŒºé•œåƒã€‚</li>
</ul>
<hr />
<h2>2. ç³»ç»Ÿè£å‰ªä¸å®šåˆ¶æŠ€æœ¯</h2>
<p>æ‹¥æœ‰äº†ç¼–è¯‘ AOSP çš„èƒ½åŠ›åï¼Œä½ å°±å¯ä»¥å¯¹ç³»ç»Ÿè¿›è¡Œä»»æ„çš„ä¿®æ”¹ã€‚</p>
<h3>a) é¢„ç½®ä¸åˆ é™¤ App</h3>
<ul>
<li><strong>è·¯å¾„</strong>: App é€šå¸¸å®šä¹‰åœ¨ <code>packages/apps/</code> ç›®å½•ä¸‹ã€‚</li>
<li><strong>ä¿®æ”¹ <code>PRODUCT_PACKAGES</code></strong>: åœ¨ç‰¹å®šè®¾å¤‡çš„ <code>device.mk</code> æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ <code>device/&lt;vendor&gt;/&lt;device_name&gt;/device.mk</code>ï¼‰ï¼Œæœ‰ä¸€ä¸ªåä¸º <code>PRODUCT_PACKAGES</code> çš„å˜é‡ã€‚</li>
<li><strong>å¢åŠ  App</strong>: å°†ä½ æƒ³è¦é¢„ç½®çš„ App çš„æ¨¡å—åæ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚</li>
<li><strong>åˆ é™¤ App</strong>: ä»è¿™ä¸ªåˆ—è¡¨ä¸­ç§»é™¤ä½ ä¸æƒ³è¦çš„ç³»ç»Ÿ Appï¼ˆå¦‚ <code>Calendar</code>, <code>Camera2</code>ï¼‰çš„æ¨¡å—åã€‚</li>
</ul>
<h3>b) ä¿®æ”¹ Framework å±‚</h3>
<p>è¿™æ˜¯æ›´æ·±åº¦çš„å®šåˆ¶ï¼Œå¯ä»¥æ”¹å˜ Android ç³»ç»Ÿçš„æ ¸å¿ƒè¡Œä¸ºã€‚</p>
<ul>
<li><strong>è·¯å¾„</strong>: Framework æ ¸å¿ƒä»£ç ä½äº <code>frameworks/base/</code>ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼šä¿®æ”¹çŠ¶æ€æ é€»è¾‘</strong>:<ol>
<li>æ‰¾åˆ°è´Ÿè´£çŠ¶æ€æ ç®¡ç†çš„ <code>SystemUI</code> App (<code>frameworks/base/packages/SystemUI/</code>)ã€‚</li>
<li>ä¿®æ”¹å…¶ä¸­çš„ Java æˆ– XML æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œæ”¹å˜æ—¶é’Ÿçš„æ˜¾ç¤ºæ ¼å¼æˆ–ç”µæ± å›¾æ ‡ã€‚</li>
<li>é‡æ–°ç¼–è¯‘ <code>SystemUI</code> æ¨¡å—ï¼š<code>m SystemUI</code>ã€‚</li>
<li>åªç¼–è¯‘æ¨¡å—å¹¶ç”Ÿæˆæ–°çš„ <code>system.img</code>ï¼š<code>m snod</code> (<code>make systemimage-nodeps</code>)ã€‚</li>
</ol>
</li>
</ul>
<h3>c) å®šåˆ¶å†…æ ¸ (Kernel)</h3>
<p>AOSP é»˜è®¤ä¸åŒ…å«å†…æ ¸æºç ã€‚ä½ éœ€è¦ä» Google çš„å†…æ ¸æºç ä»“åº“æˆ–è®¾å¤‡å‚å•†çš„å¼€æºç«™ç‚¹å•ç‹¬ä¸‹è½½å†…æ ¸æºç ï¼Œå¹¶è¿›è¡Œç¼–è¯‘ã€‚</p>
<ol>
<li><strong>è·å–å†…æ ¸æºç </strong>:</li>
</ol>
<pre><code class="language-bash">git clone https://android.googlesource.com/kernel/common.git
</code></pre>
<ol start="2">
<li><strong>é…ç½®ä¸ç¼–è¯‘</strong>:</li>
</ol>
<pre><code class="language-bash"># ä½¿ç”¨ä¸ AOSP åŒ¹é…çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾
export CROSS_COMPILE=.../aarch64-linux-android-4.9/bin/aarch64-linux-android-

# é…ç½®å†…æ ¸
make defconfig

# ç¼–è¯‘å†…æ ¸é•œåƒ
make
</code></pre>
<h3>d) åˆ¶ä½œå®Œæ•´çš„è‡ªå®šä¹‰ ROM</h3>
<p>ä¸€ä¸ªå®Œæ•´çš„è‡ªå®šä¹‰ ROMï¼ˆå¦‚ LineageOSï¼‰çš„åˆ¶ä½œè¿‡ç¨‹ï¼Œå°±æ˜¯ä¸Šè¿°æ‰€æœ‰æŠ€æœ¯çš„ç»¼åˆåº”ç”¨ï¼š</p>
<ol>
<li>åŒæ­¥ AOSP åŸºç¡€ä»£ç ã€‚</li>
<li>é›†æˆç‰¹å®šè®¾å¤‡çš„é©±åŠ¨å’Œé…ç½®æ–‡ä»¶ï¼ˆDevice Treeï¼‰ã€‚</li>
<li>ä¿®æ”¹ Frameworkï¼Œæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ï¼ˆå¦‚é«˜çº§é‡å¯èœå•ï¼‰ã€‚</li>
<li>ç§»é™¤æˆ–æ›¿æ¢ç³»ç»Ÿ Appã€‚</li>
<li>é›†æˆå®šåˆ¶çš„å†…æ ¸ã€‚</li>
<li>ç¼–è¯‘å¹¶æ‰“åŒ…æˆä¸€ä¸ªå¯ä¾›ç”¨æˆ·åˆ·å†™çš„ <code>zip</code> æ–‡ä»¶ã€‚</li>
</ol>
<hr />
<h2>3. Android Linker ä¸ SO åŠ è½½åŸç†</h2>
<h3>Linker æ¶æ„ä¸å·¥ä½œåŸç†</h3>
<p>Android ç³»ç»Ÿä½¿ç”¨åŠ¨æ€é“¾æ¥å™¨ (<code>/system/bin/linker</code> æˆ– <code>/system/bin/linker64</code>) æ¥åŠ è½½å’Œé“¾æ¥å…±äº«åº“ (.so æ–‡ä»¶)ã€‚</p>
<h4>ç³»ç»Ÿæ¶æ„</h4>
<pre><code class="language-text">Runtime.loadLibrary()
        â†“
DexPathList.loadLibrary()
        â†“
nativeLoad() [JNI]
        â†“
android_dlopen_ext()
        â†“
do_dlopen() [linker]
        â†“
find_library_internal()
        â†“
load_library() â†’ link_image()
</code></pre>
<h4>æ ¸å¿ƒå‡½æ•°åˆ†æ</h4>
<p><strong>find_library_internal - æŸ¥æ‰¾åº“</strong>:</p>
<pre><code class="language-cpp">static soinfo* find_library_internal(android_namespace_t* ns,
                                     const char* name,
                                     int rtld_flags,
                                     const android_dlextinfo* extinfo,
                                     soinfo* needed_by) {
    // 1. æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
    soinfo* si = find_loaded_library_by_soname(ns, name);
    if (si != nullptr) {
        return si;
    }

    // 2. åœ¨å‘½åç©ºé—´ä¸­æœç´¢
    std::string realpath;
    if (!find_library_in_namespace(ns, name, &amp;realpath)) {
        return nullptr;
    }

    // 3. åŠ è½½åº“æ–‡ä»¶
    return load_library(ns, realpath.c_str(), rtld_flags, extinfo, needed_by);
}
</code></pre>
<p><strong>load_library - åŠ è½½åº“</strong>:</p>
<pre><code class="language-cpp">static soinfo* load_library(android_namespace_t* ns,
                            const char* name,
                            int rtld_flags,
                            const android_dlextinfo* extinfo,
                            soinfo* needed_by) {
    // 1. æ‰“å¼€ ELF æ–‡ä»¶
    int fd = open(name, O_RDONLY | O_CLOEXEC);

    // 2. è§£æ ELF å¤´
    ElfReader elf_reader(name, fd, file_offset, file_size);
    if (!elf_reader.Load(extinfo)) {
        return nullptr;
    }

    // 3. åˆ›å»º soinfo ç»“æ„
    soinfo* si = soinfo_alloc(ns, realpath, &amp;file_stat, rtld_flags, extinfo);

    // 4. æ˜ å°„å†…å­˜æ®µ
    if (!si-&gt;prelink_image()) {
        return nullptr;
    }

    return si;
}
</code></pre>
<p><strong>link_image - é“¾æ¥é•œåƒ</strong>:</p>
<pre><code class="language-cpp">bool soinfo::link_image(const soinfo_list_t&amp; global_group,
                        const soinfo_list_t&amp; local_group,
                        const android_dlextinfo* extinfo) {
    // 1. è§£æåŠ¨æ€æ®µ
    if (!phdr_table_get_dynamic_section(phdr, phnum, load_bias, &amp;dynamic, &amp;dynamic_flags)) {
        return false;
    }

    // 2. å¤„ç†ä¾èµ–åº“
    for (ElfW(Dyn)* d = dynamic; d-&gt;d_tag != DT_NULL; ++d) {
        if (d-&gt;d_tag == DT_NEEDED) {
            const char* library_name = get_string(d-&gt;d_un.d_val);
            soinfo* lsi = find_library(library_name, ...);
        }
    }

    // 3. é‡å®šä½å¤„ç†
    if (!relocate(global_group, local_group)) {
        return false;
    }

    // 4. è°ƒç”¨æ„é€ å‡½æ•°
    call_constructors();

    return true;
}
</code></pre>
<h4>SO å†…å­˜å¸ƒå±€</h4>
<pre><code class="language-text">0x7000000000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ .text (RX)      â”‚ ä»£ç æ®µ
0x7001000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚ .rodata (R)     â”‚ åªè¯»æ•°æ®æ®µ
0x7002000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚ .data (RW)      â”‚ å¯è¯»å†™æ•°æ®æ®µ
0x7003000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚ .bss (RW)       â”‚ æœªåˆå§‹åŒ–æ•°æ®æ®µ
0x7004000000 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4>å†…å­˜ä¿æŠ¤è®¾ç½®</h4>
<pre><code class="language-cpp">int phdr_table_protect_segments(const ElfW(Phdr)* phdr_table,
                                size_t phdr_count,
                                ElfW(Addr) load_bias) {
    for (size_t i = 0; i &lt; phdr_count; ++i) {
        const ElfW(Phdr)* phdr = &amp;phdr_table[i];
        if (phdr-&gt;p_type != PT_LOAD) continue;

        int prot = PFLAGS_TO_PROT(phdr-&gt;p_flags);
        if (mprotect(reinterpret_cast&lt;void*&gt;(seg_page_start + load_bias),
                     seg_page_end - seg_page_start, prot) &lt; 0) {
            return -1;
        }
    }
    return 0;
}
</code></pre>
<hr />
<h2>4. åè°ƒè¯•ä¸æ£€æµ‹æŠ€æœ¯</h2>
<h3>init å‡½æ•°ä¸­çš„åè°ƒè¯•</h3>
<pre><code class="language-cpp">__attribute__((constructor))
void anti_debug_check() {
    // æ£€æµ‹ Frida
    if (access(&quot;/data/local/tmp/frida-server&quot;, F_OK) == 0) {
        _exit(1);
    }

    // æ£€æµ‹è°ƒè¯•å™¨
    if (ptrace(PTRACE_TRACEME, 0, 1, 0) == -1) {
        _exit(1);
    }

    // æ£€æµ‹è™šæ‹Ÿæœºç¯å¢ƒ
    check_emulator_files();
}
</code></pre>
<h3>ç¬¦å·è¡¨æ£€æµ‹</h3>
<pre><code class="language-cpp">void check_loaded_symbols() {
    void* handle = dlopen(NULL, RTLD_NOW);

    // æ£€æµ‹ Frida ç¬¦å·
    if (dlsym(handle, &quot;frida_agent_main&quot;) != NULL) {
        _exit(1);
    }

    // æ£€æµ‹ Xposed ç¬¦å·
    if (dlsym(handle, &quot;xposed_bridge&quot;) != NULL) {
        _exit(1);
    }
}
</code></pre>
<h3>ä»£ç å®Œæ•´æ€§æ ¡éªŒ</h3>
<pre><code class="language-cpp">void check_code_integrity() {
    Dl_info info;
    dladdr((void*)check_code_integrity, &amp;info);

    // è®¡ç®—ä»£ç æ®µå“ˆå¸Œ
    uint32_t current_hash = calculate_hash(info.dli_fbase, TEXT_SIZE);
    if (current_hash != EXPECTED_HASH) {
        _exit(1);
    }
}
</code></pre>
<hr />
<h2>5. Frida ç»•è¿‡æŠ€æœ¯</h2>
<h3>ç»•è¿‡ ptrace æ£€æµ‹</h3>
<pre><code class="language-javascript">var ptrace = Module.findExportByName(&quot;libc.so&quot;, &quot;ptrace&quot;);
if (ptrace) {
    Interceptor.attach(ptrace, {
        onEnter: function(args) {
            var request = args[0].toInt32();
            if (request === 0) { // PTRACE_TRACEME
                console.log(&quot;[+] ptrace(PTRACE_TRACEME) blocked&quot;);
                args[0] = ptr(-1); // ä¿®æ”¹å‚æ•°ä½¿å…¶å¤±è´¥
            }
        },
        onLeave: function(retval) {
            retval.replace(ptr(0)); // è¿”å›æˆåŠŸ
        }
    });
}
</code></pre>
<h3>éšè— Frida ç¬¦å·</h3>
<pre><code class="language-javascript">var dlsym = Module.findExportByName(&quot;libdl.so&quot;, &quot;dlsym&quot;);
Interceptor.attach(dlsym, {
    onEnter: function(args) {
        this.symbol_name = args[1].readCString();
    },
    onLeave: function(retval) {
        var blocked_symbols = [&quot;frida_agent_main&quot;, &quot;xposed_bridge&quot;];
        if (blocked_symbols.includes(this.symbol_name)) {
            console.log(&quot;[+] Hiding symbol: &quot; + this.symbol_name);
            retval.replace(ptr(0));
        }
    }
});
</code></pre>
<h3>ç»•è¿‡ mprotect æ£€æµ‹</h3>
<pre><code class="language-javascript">var mprotect = Module.findExportByName(&quot;libc.so&quot;, &quot;mprotect&quot;);
Interceptor.attach(mprotect, {
    onEnter: function(args) {
        var addr = args[0];
        var size = args[1].toInt32();
        var prot = args[2].toInt32();

        console.log(&quot;[+] mprotect called: &quot; + addr + &quot;, size: &quot; + size + &quot;, prot: &quot; + prot);

        // é˜²æ­¢ç§»é™¤æ‰§è¡Œæƒé™
        if ((prot &amp; 0x4) == 0) { // PROT_EXEC
            args[2] = ptr(prot | 0x4);
        }
    }
});
</code></pre>
<h3>éšè—æ•æ„Ÿè·¯å¾„</h3>
<pre><code class="language-javascript">var access = Module.findExportByName(&quot;libc.so&quot;, &quot;access&quot;);
Interceptor.attach(access, {
    onEnter: function(args) {
        var path = args[0].readCString();
        var sensitive_paths = [
            &quot;/data/local/tmp/frida-server&quot;,
            &quot;/system/xbin/su&quot;,
            &quot;/system/app/Superuser.apk&quot;
        ];

        if (sensitive_paths.some(p =&gt; path.includes(p))) {
            console.log(&quot;[+] Blocking access to: &quot; + path);
            args[0] = Memory.allocUtf8String(&quot;/non/existent/path&quot;);
        }
    }
});
</code></pre>
<hr />
<h2>6. init_array æ³¨å…¥æŠ€æœ¯</h2>
<h3>Python è„šæœ¬æ³¨å…¥</h3>
<pre><code class="language-python">from elftools.elf.elffile import ELFFile

def inject_init_array(elf_path, hook_function_addr):
    with open(elf_path, 'r+b') as f:
        elf = ELFFile(f)

        # æŸ¥æ‰¾ .init_array æ®µ
        init_array = elf.get_section_by_name('.init_array')
        if init_array:
            # åœ¨ç°æœ‰å‡½æ•°æŒ‡é’ˆåæ·»åŠ æ–°å‡½æ•°åœ°å€
            f.seek(init_array['sh_offset'] + init_array['sh_size'])
            f.write(hook_function_addr.to_bytes(8, 'little'))
</code></pre>
<h3>C ä»£ç è¿è¡Œæ—¶æ³¨å…¥</h3>
<pre><code class="language-cpp">void inject_init_array_runtime() {
    // 1. æ‰¾åˆ°ç›®æ ‡ SO åŠ è½½åŸºå€
    void* base_addr = dlopen(&quot;target.so&quot;, RTLD_NOLOAD);

    // 2. è§£æ ELF å¤´æ‰¾åˆ° .init_array æ®µ
    ElfW(Ehdr)* ehdr = (ElfW(Ehdr)*)base_addr;
    ElfW(Shdr)* shdr = (ElfW(Shdr)*)((char*)base_addr + ehdr-&gt;e_shoff);

    // 3. ä¿®æ”¹å†…å­˜ä¿æŠ¤
    mprotect(init_array_addr, init_array_size, PROT_READ | PROT_WRITE);

    // 4. æ·»åŠ å‡½æ•°æŒ‡é’ˆ
    *(void**)(init_array_addr + init_array_size) = target_function;

    // 5. æ¢å¤ä¿æŠ¤
    mprotect(init_array_addr, init_array_size, PROT_READ);
}
</code></pre>
<hr />
<h2>7. ç»¼åˆåè°ƒè¯•æ£€æµ‹</h2>
<pre><code class="language-cpp">class AntiDebugChecker {
private:
    static bool check_debugger_presence() {
        return ptrace(PTRACE_TRACEME, 0, 1, 0) == -1;
    }

    static bool check_frida_artifacts() {
        const char* frida_files[] = {
            &quot;/data/local/tmp/frida-server&quot;,
            &quot;/data/local/tmp/frida-agent-64.so&quot;
        };

        for (auto file : frida_files) {
            if (access(file, F_OK) == 0) return true;
        }
        return false;
    }

    static bool check_memory_maps() {
        FILE* fp = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
        char line[512];
        while (fgets(line, sizeof(line), fp)) {
            if (strstr(line, &quot;frida&quot;) || strstr(line, &quot;gum-js-loop&quot;)) {
                fclose(fp);
                return true;
            }
        }
        fclose(fp);
        return false;
    }

public:
    static void comprehensive_check() {
        if (check_debugger_presence() ||
            check_frida_artifacts() ||
            check_memory_maps()) {
            // æ‰§è¡Œå¯¹æŠ—æªæ–½
            execute_countermeasures();
        }
    }
};
</code></pre>
<h3>å®šæ—¶æ£€æµ‹çº¿ç¨‹</h3>
<pre><code class="language-cpp">void start_anti_debug_thread() {
    std::thread([]{
        while (true) {
            std::this_thread::sleep_for(std::chrono::seconds(5));
            AntiDebugChecker::comprehensive_check();
        }
    }).detach();
}
</code></pre>
<hr />
<h2>æ€»ç»“</h2>
<p>æŒæ¡ AOSP ç¼–è¯‘å’Œç³»ç»Ÿå®šåˆ¶æŠ€æœ¯çš„æ„ä¹‰ï¼š</p>
<ul>
<li>æ·±å…¥ç†è§£ Android Framework çš„å·¥ä½œåŸç†ï¼Œä¸º Hook å’Œé€†å‘æä¾›æ›´åº•å±‚çš„è§†è§’ã€‚</li>
<li>é€šè¿‡ä¿®æ”¹ç³»ç»Ÿæ¥ç»•è¿‡åº”ç”¨å±‚çš„ååˆ†ææŠ€æœ¯ï¼Œå®ç°&quot;é™ç»´æ‰“å‡»&quot;ã€‚</li>
</ul>

                                            </div>
                                            
                                            <div class="section" id="section-70">
                                                <h2>70. AOSP Device Modification</h2>
                                                <h1>åŸºäº AOSP çš„æ·±åº¦æ”¹æœºæŠ€æœ¯æŒ‡å—</h1>
<p>åœ¨ Android å®‰å…¨å’Œé€†å‘å·¥ç¨‹é¢†åŸŸï¼Œ&quot;æ”¹æœº&quot;æŒ‡çš„æ˜¯ä¿®æ”¹è®¾å¤‡çš„å„ç§ç¡¬ä»¶å’Œè½¯ä»¶æ ‡è¯†ç¬¦ï¼Œä»¥ç»•è¿‡åº”ç”¨ç¨‹åºçš„å®‰å…¨æ£€æµ‹æˆ–å®ç°éšç§ä¿æŠ¤ã€‚è™½ç„¶ä½¿ç”¨ Xposed æˆ– Frida ç­‰ Hook æ¡†æ¶å¯ä»¥åœ¨åº”ç”¨å±‚å®ç°æ”¹æœºï¼Œä½†è¿™äº›æ–¹æ³•å®¹æ˜“è¢«æ£€æµ‹ã€‚<strong>åŸºäº AOSP (Android Open Source Project) æºç è¿›è¡Œä¿®æ”¹ï¼Œæ˜¯ä»ç³»ç»Ÿå±‚é¢ä¼ªé€ è®¾å¤‡æŒ‡çº¹çš„ç»ˆææ‰‹æ®µ</strong>ï¼Œå› ä¸º App è·å–åˆ°çš„ä¿¡æ¯æ˜¯ç”±ç³»ç»Ÿæœ¬èº«&quot;çœŸå®&quot;åœ°æä¾›çš„ã€‚</p>
<h2>æœ¬æ–‡æ—¨åœ¨æä¾›ä¸€ä¸ªå…³äºå¦‚ä½•é€šè¿‡ä¿®æ”¹ AOSP æºç æ¥å®ç°æ·±åº¦æ”¹æœºçš„æŠ€æœ¯æ¡†æ¶å’Œæ€è·¯ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3%E5%BA%94%E7%94%A8%E5%B1%82-hook-vs-%E7%B3%BB%E7%BB%9F%E5%B1%82%E4%BF%AE%E6%94%B9"><strong>æ ¸å¿ƒæ€æƒ³ï¼šåº”ç”¨å±‚ Hook vs. ç³»ç»Ÿå±‚ä¿®æ”¹</strong></a></li>
<li><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><strong>å‡†å¤‡å·¥ä½œ</strong></a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0%E5%AE%9A%E4%BD%8D%E4%B8%8E%E4%BF%AE%E6%94%B9"><strong>å…³é”®å‚æ•°å®šä½ä¸ä¿®æ”¹</strong></a></li>
</ol>
<ul>
<li><p><a href="#build-info-buildprop"><strong>Build Info (build.prop)</strong></a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E5%8F%82%E6%95%B0-imei-mac-android-id"><strong>ç¡¬ä»¶å‚æ•° (IMEI, MAC, Android ID)</strong></a></p>
</li>
<li><p><a href="#%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7-system-properties"><strong>ç³»ç»Ÿå±æ€§ (System Properties)</strong></a></p>
</li>
<li><p><a href="#%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0-serial-number"><strong>å†…æ ¸å‚æ•° (Serial Number)</strong></a></p>
</li>
<li><p><a href="#build-info-buildprop"><strong>Build Info (build.prop)</strong></a></p>
</li>
<li><p><a href="#%E7%A1%AC%E4%BB%B6%E5%8F%82%E6%95%B0-imei-mac-android-id"><strong>ç¡¬ä»¶å‚æ•° (IMEI, MAC, Android ID)</strong></a></p>
</li>
<li><p><a href="#%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7-system-properties"><strong>ç³»ç»Ÿå±æ€§ (System Properties)</strong></a></p>
</li>
<li><p><a href="#%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0-serial-number"><strong>å†…æ ¸å‚æ•° (Serial Number)</strong></a></p>
</li>
</ul>
<ol start="4">
<li><a href="#%E7%BC%96%E8%AF%91%E4%B8%8E%E5%88%B7%E6%9C%BA"><strong>ç¼–è¯‘ä¸åˆ·æœº</strong></a></li>
<li><a href="#%E4%BC%98%E5%8A%BF%E4%B8%8E%E6%8C%91%E6%88%98"><strong>ä¼˜åŠ¿ä¸æŒ‘æˆ˜</strong></a></li>
</ol>
<hr />
<h2># æ ¸å¿ƒæ€æƒ³ï¼šåº”ç”¨å±‚ Hook vs. ç³»ç»Ÿå±‚ä¿®æ”¹</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰¹æ€§</th>
  <th style="text-align:left">åº”ç”¨å±‚ Hook (Xposed/Frida)</th>
  <th style="text-align:left">AOSP ç³»ç»Ÿå±‚ä¿®æ”¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><strong>åŸç†</strong></td>
  <td style="text-align:left">åœ¨ App è¿è¡Œæ—¶ï¼Œæ‹¦æˆª API è°ƒç”¨ï¼Œè¿”å›ä¼ªé€ ç»“æœã€‚</td>
  <td style="text-align:left">ç›´æ¥ä¿®æ”¹ Android æ¡†æ¶å±‚æºç ï¼Œä½¿ API <strong>æœ¬èº«</strong>å°±è¿”å›ä¼ªé€ çš„å€¼ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ•ˆæœ</strong></td>
  <td style="text-align:left">è¾ƒå¥½ï¼Œä½†å¯è¢«æ£€æµ‹ã€‚</td>
  <td style="text-align:left"><strong>æå¥½</strong>ï¼Œæ•ˆæœå½»åº•ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>æ£€æµ‹éš¾åº¦</strong></td>
  <td style="text-align:left">å®¹æ˜“è¢«å Hookã€åè°ƒè¯•æŠ€æœ¯æ£€æµ‹åˆ°ã€‚</td>
  <td style="text-align:left">æéš¾è¢«æ£€æµ‹ï¼Œå› ä¸ºå¯¹ App æ¥è¯´ç³»ç»Ÿè¡Œä¸ºæ˜¯&quot;åŸç”Ÿ&quot;çš„ã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>å®ç°éš¾åº¦</strong></td>
  <td style="text-align:left">ç›¸å¯¹è¾ƒä½ï¼Œåªéœ€ç¼–å†™ Hook è„šæœ¬ã€‚</td>
  <td style="text-align:left"><strong>éå¸¸é«˜</strong>ï¼Œéœ€è¦ç¼–è¯‘æ•´ä¸ª Android ç³»ç»Ÿã€‚</td>
</tr>
<tr>
  <td style="text-align:left"><strong>é€‚ç”¨æ€§</strong></td>
  <td style="text-align:left">é€šç”¨æ€§å¼ºï¼Œé€‚ç”¨äºå¤§å¤šæ•°è®¾å¤‡ã€‚</td>
  <td style="text-align:left">é€šå¸¸åªé€‚ç”¨äº AOSP æ”¯æŒè‰¯å¥½çš„è®¾å¤‡ï¼ˆå¦‚ Google Pixelï¼‰ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>ç»“è®º</strong>: AOSP æ”¹æœºçš„æœ¬è´¨æ˜¯<strong>æ„å»ºä¸€ä¸ª&quot;å‡ºå‚è®¾ç½®&quot;å°±æ˜¯ä¼ªè£…çŠ¶æ€çš„è‡ªå®šä¹‰æ“ä½œç³»ç»Ÿ</strong>ã€‚</p>
<hr />
<h2># å‡†å¤‡å·¥ä½œ</h2>
<ol>
<li><strong>ç¡¬ä»¶è¦æ±‚</strong>:</li>
</ol>
<ul>
<li><p>ä¸€å°é«˜æ€§èƒ½çš„ PCï¼ˆè‡³å°‘ 16GB RAMï¼Œæ¨è 32GB æˆ–æ›´é«˜ï¼‰ã€‚</p>
</li>
<li><p>å¤§å®¹é‡é«˜é€Ÿç¡¬ç›˜ï¼ˆSSDï¼Œè‡³å°‘ 500GB å¯ç”¨ç©ºé—´ï¼‰ã€‚</p>
</li>
<li><p>ä¸€å°å— AOSP å®˜æ–¹æ”¯æŒçš„è®¾å¤‡ï¼ˆå¦‚ Google Pixel ç³»åˆ—ï¼‰ï¼Œç”¨äºåˆ·æœºéªŒè¯ã€‚</p>
</li>
<li><p>ä¸€å°é«˜æ€§èƒ½çš„ PCï¼ˆè‡³å°‘ 16GB RAMï¼Œæ¨è 32GB æˆ–æ›´é«˜ï¼‰ã€‚</p>
</li>
<li><p>å¤§å®¹é‡é«˜é€Ÿç¡¬ç›˜ï¼ˆSSDï¼Œè‡³å°‘ 500GB å¯ç”¨ç©ºé—´ï¼‰ã€‚</p>
</li>
<li><p>ä¸€å°å— AOSP å®˜æ–¹æ”¯æŒçš„è®¾å¤‡ï¼ˆå¦‚ Google Pixel ç³»åˆ—ï¼‰ï¼Œç”¨äºåˆ·æœºéªŒè¯ã€‚</p>
</li>
</ul>
<ol start="2">
<li><strong>è½¯ä»¶ç¯å¢ƒ</strong>:</li>
</ol>
<ul>
<li><p>Linux æ“ä½œç³»ç»Ÿï¼ˆæ¨è Ubuntu LTS ç‰ˆæœ¬ï¼‰ã€‚</p>
</li>
<li><p>ç†Ÿæ‚‰ Android ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…å¥½ <code>repo</code> å’Œæ‰€æœ‰å¿…éœ€çš„ä¾èµ–åº“ã€‚</p>
</li>
<li><p>Linux æ“ä½œç³»ç»Ÿï¼ˆæ¨è Ubuntu LTS ç‰ˆæœ¬ï¼‰ã€‚</p>
</li>
<li><p>ç†Ÿæ‚‰ Android ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…å¥½ <code>repo</code> å’Œæ‰€æœ‰å¿…éœ€çš„ä¾èµ–åº“ã€‚</p>
</li>
</ul>
<ol start="3">
<li><strong>AOSP æºç </strong>:</li>
</ol>
<ul>
<li><p>æ ¹æ®ä½ çš„ç›®æ ‡è®¾å¤‡å’Œ Android ç‰ˆæœ¬ï¼Œåˆå§‹åŒ–å¹¶åŒæ­¥å¯¹åº”çš„ AOSP æºç ä»“åº“ã€‚</p>
</li>
<li><p>æ ¹æ®ä½ çš„ç›®æ ‡è®¾å¤‡å’Œ Android ç‰ˆæœ¬ï¼Œåˆå§‹åŒ–å¹¶åŒæ­¥å¯¹åº”çš„ AOSP æºç ä»“åº“ã€‚</p>
</li>
</ul>
<hr />
<h2># å…³é”®å‚æ•°å®šä½ä¸ä¿®æ”¹</h2>
<h3># Build Info (build.prop)</h3>
<p>è¿™äº›æ˜¯æè¿°è®¾å¤‡å‹å·ã€å“ç‰Œã€åˆ¶é€ å•†ç­‰æœ€åŸºç¡€çš„ä¿¡æ¯ã€‚</p>
<ul>
<li><p><strong>å®šä½</strong>: è¿™äº›å€¼é€šå¸¸å®šä¹‰åœ¨ <code>device/</code> ç›®å½•ä¸‹çš„ç‰¹å®šäºè®¾å¤‡çš„ <code>*.mk</code> makefile æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨ <code>build/make/target/product/</code> ä¸‹çš„é€šç”¨äº§å“å®šä¹‰æ–‡ä»¶ä¸­ã€‚</p>
</li>
<li><p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>:</p>
</li>
<li><p>æ‰“å¼€ <code>device/&lt;vendor&gt;/&lt;product_name&gt;/device.mk</code> æˆ–ç±»ä¼¼æ–‡ä»¶ã€‚</p>
</li>
<li><p>æ‰¾åˆ°å¹¶ä¿®æ”¹ä»¥ä¸‹å˜é‡ï¼š</p>
<pre><code class="language-makefile">PRODUCT_MODEL := Pixel 8 Pro
PRODUCT_BRAND := Google
PRODUCT_NAME := my_custom_device
PRODUCT_DEVICE := generic
PRODUCT_MANUFACTURER := MyCompany
</code></pre>
</li>
</ul>
<pre><code>

### ç¡¬ä»¶å‚æ•° (IMEI, MAC, android ID)
è¿™äº›æ˜¯æ›´æ•æ„Ÿã€æ›´æ ¸å¿ƒçš„è®¾å¤‡æ ‡è¯†ç¬¦ã€‚ä¿®æ”¹å®ƒä»¬éœ€è¦æ·±å…¥åˆ° Framework å±‚çš„ Java ä»£ç å’Œ JNIã€‚

* **IMEI (Telephony)**:
* **å®šä½**: `frameworks/opt/telephony/src/java/com/android/internal/telephony/Phone.java` æˆ–ç›¸å…³çš„ `*SubInfo.java` æ–‡ä»¶ã€‚

* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getImei()` æˆ–ç±»ä¼¼æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ç¡¬ç¼–ç æˆ–è¿”å›ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ä¼ªé€  IMEIã€‚
* **å®šä½**: `frameworks/opt/telephony/src/java/com/android/internal/telephony/Phone.java` æˆ–ç›¸å…³çš„ `*SubInfo.java` æ–‡ä»¶ã€‚


* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getImei()` æˆ–ç±»ä¼¼æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ç¡¬ç¼–ç æˆ–è¿”å›ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ä¼ªé€  IMEIã€‚
* **MAC Address (Wi-Fi)**:
* **å®šä½**: `frameworks/base/wifi/java/android/net/wifi/WifiInfo.java`ã€‚

* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getMacAddress()` æ–¹æ³•ã€‚æ³¨æ„ï¼Œåœ¨é«˜ç‰ˆæœ¬ Android ä¸­ï¼Œè¯¥æ–¹æ³•å¯èƒ½è¿”å›ä¸€ä¸ªå›ºå®šçš„ã€éçœŸå®çš„ MAC åœ°å€ã€‚éœ€è¦æ‰¾åˆ°å…¶æ›´åº•å±‚çš„å®ç°ï¼Œå¯èƒ½åœ¨ `wpa_supplicant` æˆ– Wi-Fi é©±åŠ¨çš„ JNI æ¥å£ä¸­ã€‚
* **å®šä½**: `frameworks/base/wifi/java/android/net/wifi/WifiInfo.java`ã€‚


* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ° `getMacAddress()` æ–¹æ³•ã€‚æ³¨æ„ï¼Œåœ¨é«˜ç‰ˆæœ¬ Android ä¸­ï¼Œè¯¥æ–¹æ³•å¯èƒ½è¿”å›ä¸€ä¸ªå›ºå®šçš„ã€éçœŸå®çš„ MAC åœ°å€ã€‚éœ€è¦æ‰¾åˆ°å…¶æ›´åº•å±‚çš„å®ç°ï¼Œå¯èƒ½åœ¨ `wpa_supplicant` æˆ– Wi-Fi é©±åŠ¨çš„ JNI æ¥å£ä¸­ã€‚
* **Android ID**:
* **å®šä½**: `frameworks/base/services/core/java/com/android/server/pm/Settings.java` ä¸­çš„ `getStringForUser()` æ–¹æ³•ï¼Œç»“åˆ `android.provider.Settings.Secure.ANDROID_ID` çš„å®ç°ã€‚

* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ°ç”Ÿæˆå’Œå­˜å‚¨ Android ID çš„é€»è¾‘ï¼Œå°†å…¶æ›¿æ¢ä¸ºè¿”å›ä¸€ä¸ªå›ºå®šçš„æˆ–æ¯æ¬¡å¯åŠ¨éƒ½éšæœºç”Ÿæˆçš„å€¼ã€‚

* **å®šä½**: `frameworks/base/services/core/java/com/android/server/pm/Settings.java` ä¸­çš„ `getStringForUser()` æ–¹æ³•ï¼Œç»“åˆ `android.provider.Settings.Secure.ANDROID_ID` çš„å®ç°ã€‚


* **ä¿®æ”¹æ€è·¯**: æ‰¾åˆ°ç”Ÿæˆå’Œå­˜å‚¨ Android ID çš„é€»è¾‘ï¼Œå°†å…¶æ›¿æ¢ä¸ºè¿”å›ä¸€ä¸ªå›ºå®šçš„æˆ–æ¯æ¬¡å¯åŠ¨éƒ½éšæœºç”Ÿæˆçš„å€¼ã€‚


### ç³»ç»Ÿå±æ€§ (System Properties)
App é€šè¿‡ `android.os.SystemProperties.get()` è·å–å„ç§ç³»ç»Ÿå±æ€§ã€‚

* **å®šä½**: `frameworks/base/core/java/android/os/SystemProperties.java` åŠå…¶å¯¹åº”çš„ JNI å®ç° `frameworks/base/core/jni/android_os_SystemProperties.cpp`ã€‚


* **ä¿®æ”¹æ€è·¯**: ç›´æ¥åœ¨ `SystemProperties.cpp` çš„ `native_get` æ–¹æ³•ä¸­è¿›è¡Œæ‹¦æˆªã€‚åˆ¤æ–­ä¼ å…¥çš„å±æ€§åï¼Œå¦‚æœæ˜¯ç›®æ ‡å±æ€§ï¼ˆå¦‚ `ro.serialno`ï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªä¼ªé€ çš„å€¼ï¼Œå¦åˆ™æ‰§è¡ŒåŸå§‹é€»è¾‘ã€‚


### å†…æ ¸å‚æ•° (Serial Number)
ä¸€äº›åº•å±‚ä¿¡æ¯ï¼ˆå¦‚ CPU åºåˆ—å·ï¼‰ç›´æ¥ç”± Linux å†…æ ¸é€šè¿‡ `/proc` æ–‡ä»¶ç³»ç»Ÿæš´éœ²ã€‚

* **å®šä½**: å†…æ ¸æºç ä¸­çš„ `arch/&lt;arch&gt;/kernel/setup.c` æˆ–ç›¸å…³é©±åŠ¨æ–‡ä»¶ã€‚


* **ä¿®æ”¹æ€è·¯**:
1. ä¸‹è½½ä¸ AOSP ç‰ˆæœ¬åŒ¹é…çš„å†…æ ¸æºç ã€‚
2. æ‰¾åˆ°å‘ `/proc/cpuinfo` æˆ– `/proc/serial` ç­‰æ–‡ä»¶å†™å…¥ä¿¡æ¯çš„ä»£ç ã€‚
3. ä¿®æ”¹è¿™éƒ¨åˆ†é€»è¾‘ï¼Œä½¿å…¶è¾“å‡ºä¼ªé€ çš„ä¿¡æ¯ã€‚
4. é‡æ–°ç¼–è¯‘å†…æ ¸ (`boot.img`)ã€‚

1. ä¸‹è½½ä¸ AOSP ç‰ˆæœ¬åŒ¹é…çš„å†…æ ¸æºç ã€‚
2. æ‰¾åˆ°å‘ `/proc/cpuinfo` æˆ– `/proc/serial` ç­‰æ–‡ä»¶å†™å…¥ä¿¡æ¯çš„ä»£ç ã€‚
3. ä¿®æ”¹è¿™éƒ¨åˆ†é€»è¾‘ï¼Œä½¿å…¶è¾“å‡ºä¼ªé€ çš„ä¿¡æ¯ã€‚
4. é‡æ–°ç¼–è¯‘å†…æ ¸ (`boot.img`)ã€‚
---
## # ç¼–è¯‘ä¸åˆ·æœº

1. **è®¾ç½®ç¯å¢ƒ**: `source build/envsetup.sh`
2. **é€‰æ‹©ç›®æ ‡**: `lunch aosp_&lt;device_name&gt;-userdebug` (ä¾‹å¦‚ `lunch aosp_husky-userdebug` å¯¹åº” Pixel 8 Pro)
3. **å¼€å§‹ç¼–è¯‘**: `make -j$(nproc)` (è¿™ä¼šèŠ±è´¹æ•°å°æ—¶)
4. **åˆ·æœº**:
* å°†è®¾å¤‡ç½®äº `fastboot` æ¨¡å¼ã€‚

* æ‰§è¡Œ `fastboot flashall -w`ï¼Œè¿™å°†åˆ·å†™æ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„é•œåƒ (`system.img`, `boot.img`, `vendor.img` ç­‰)ã€‚

* å°†è®¾å¤‡ç½®äº `fastboot` æ¨¡å¼ã€‚


* æ‰§è¡Œ `fastboot flashall -w`ï¼Œè¿™å°†åˆ·å†™æ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„é•œåƒ (`system.img`, `boot.img`, `vendor.img` ç­‰)ã€‚
---
## # ä¼˜åŠ¿ä¸æŒ‘æˆ˜

### ä¼˜åŠ¿
* **å½»åº•æ€§**: ä»ç³»ç»Ÿæ ¹æºä¸Šæ”¹å˜è®¾å¤‡æŒ‡çº¹ï¼Œå‡ ä¹æ— æ³•è¢«åº”ç”¨å±‚æŠ€æœ¯æ£€æµ‹ã€‚


* **ç¨³å®šæ€§**: ä¸ä¼šåƒ Hook æ¡†æ¶é‚£æ ·å› ä¸ºåº”ç”¨æ›´æ–°æˆ–åŠ å›ºè€Œå¤±æ•ˆã€‚


* **æ€§èƒ½å¥½**: æ²¡æœ‰é¢å¤–çš„ Hook å¼€é”€ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½æ˜¯åŸç”Ÿä»£ç ã€‚


### æŒ‘æˆ˜
* **æŠ€æœ¯é—¨æ§›æé«˜**: éœ€è¦æ·±å…¥ç†è§£ AOSP æºç ç»“æ„ã€ç¼–è¯‘ç³»ç»Ÿå’Œ Linux å†…æ ¸ã€‚


* **æ—¶é—´æˆæœ¬é«˜**: å…¨é‡ç¼–è¯‘ä¸€æ¬¡ AOSP é€šå¸¸éœ€è¦æ•°å°æ—¶ã€‚


* **è®¾å¤‡é™åˆ¶**: å¼ºä¾èµ–äºæœ‰è‰¯å¥½ AOSP æ”¯æŒå’Œå¼€æ”¾é©±åŠ¨çš„è®¾å¤‡ã€‚


* **ç»´æŠ¤å›°éš¾**: æ¯æ¬¡ Android ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ½éœ€è¦é‡æ–°è¿›è¡Œæºç é€‚é…å’Œä¿®æ”¹ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-71">
                                                <h2>71. Minimal Android Rootfs</h2>
                                                <h1>æ„å»ºæœ€å°åŒ– android ç³»ç»Ÿ (RootFS) æŒ‡å—</h1>
<p>æ„å»ºä¸€ä¸ªå®Œæ•´çš„ AOSP (Android Open Source Project) è€—æ—¶å·¨å¤§ä¸”å¯¹ç¡¬ä»¶è¦æ±‚è‹›åˆ»ã€‚è€Œæ„å»ºä¸€ä¸ªæœ€å°åŒ–çš„ Android RootFS (Root File System) æ˜¯ä¸€ä¸ªèƒ½è®©æˆ‘ä»¬æ·±åˆ»ç†è§£ Android å¯åŠ¨æµç¨‹å’Œæ ¸å¿ƒç»„ä»¶çš„ç»ä½³å®è·µã€‚å…¶ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªä»…åŒ…å«æœ€åŸºæœ¬ç»„ä»¶ã€èƒ½å¤Ÿå¼•å¯¼ Linux å†…æ ¸å¹¶æœ€ç»ˆå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ Shell çš„ç³»ç»Ÿã€‚</p>
<h2>æœ¬æ–‡å°†æŒ‡å¯¼ä½ å®Œæˆè¿™ä¸€è¿‡ç¨‹ï¼Œä¸»è¦ä½¿ç”¨ QEMU ä½œä¸ºç›®æ ‡å¹³å°ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96-android-%E7%B3%BB%E7%BB%9F-rootfs-%E6%8C%87%E5%8D%97">æ„å»ºæœ€å°åŒ– Android ç³»ç»Ÿ (RootFS) æŒ‡å—</a></p>
</li>
<li><p><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></p>
</li>
<li><p><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B">æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</a></p>
</li>
<li><p><a href="#%E6%9C%80%E5%B0%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></p>
</li>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4%E8%AF%A6%E8%A7%A3">æ„å»ºæ­¥éª¤è¯¦è§£</a></p>
</li>
<li><p><a href="#step-1-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%93%BE">Step 1: å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p>
</li>
<li><p><a href="#step-2-%E8%8E%B7%E5%8F%96%E5%B9%B6%E7%BC%96%E8%AF%91-linux-%E5%86%85%E6%A0%B8">Step 2: è·å–å¹¶ç¼–è¯‘ Linux å†…æ ¸</a></p>
</li>
<li><p><a href="#step-3-%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96-rootfs">Step 3: æ„å»ºæœ€å°åŒ– RootFS</a></p>
</li>
<li><p><a href="#step-4-%E6%89%93%E5%8C%85%E5%B9%B6%E8%BF%90%E8%A1%8C">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p>
</li>
<li><p><a href="#%E4%BB%8E-shell-%E5%88%B0-zygote%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%98%AF%E4%BB%80%E4%B9%88">ä» Shell åˆ° Zygoteï¼šä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
</li>
<li><p><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></p>
</li>
<li><p><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B">æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</a></p>
</li>
<li><p><a href="#%E6%9C%80%E5%B0%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></p>
</li>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4%E8%AF%A6%E8%A7%A3">æ„å»ºæ­¥éª¤è¯¦è§£</a></p>
</li>
<li><p><a href="#step-1-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%93%BE">Step 1: å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p>
</li>
<li><p><a href="#step-2-%E8%8E%B7%E5%8F%96%E5%B9%B6%E7%BC%96%E8%AF%91-linux-%E5%86%85%E6%A0%B8">Step 2: è·å–å¹¶ç¼–è¯‘ Linux å†…æ ¸</a></p>
</li>
<li><p><a href="#step-3-%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96-rootfs">Step 3: æ„å»ºæœ€å°åŒ– RootFS</a></p>
</li>
<li><p><a href="#step-4-%E6%89%93%E5%8C%85%E5%B9%B6%E8%BF%90%E8%A1%8C">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p>
</li>
<li><p><a href="#%E4%BB%8E-shell-%E5%88%B0-zygote%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%98%AF%E4%BB%80%E4%B9%88">ä» Shell åˆ° Zygoteï¼šä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
</li>
<li><p><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B">æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</a></p>
</li>
<li><p><a href="#%E6%9C%80%E5%B0%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</a></p>
</li>
<li><p><a href="#%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4%E8%AF%A6%E8%A7%A3">æ„å»ºæ­¥éª¤è¯¦è§£</a></p>
</li>
<li><p><a href="#step-1-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%93%BE">Step 1: å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p>
</li>
<li><p><a href="#step-2-%E8%8E%B7%E5%8F%96%E5%B9%B6%E7%BC%96%E8%AF%91-linux-%E5%86%85%E6%A0%B8">Step 2: è·å–å¹¶ç¼–è¯‘ Linux å†…æ ¸</a></p>
</li>
<li><p><a href="#step-3-%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96-rootfs">Step 3: æ„å»ºæœ€å°åŒ– RootFS</a></p>
</li>
<li><p><a href="#step-4-%E6%89%93%E5%8C%85%E5%B9%B6%E8%BF%90%E8%A1%8C">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p>
</li>
<li><p><a href="#step-1-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%93%BE">Step 1: å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</a></p>
</li>
<li><p><a href="#step-2-%E8%8E%B7%E5%8F%96%E5%B9%B6%E7%BC%96%E8%AF%91-linux-%E5%86%85%E6%A0%B8">Step 2: è·å–å¹¶ç¼–è¯‘ Linux å†…æ ¸</a></p>
</li>
<li><p><a href="#step-3-%E6%9E%84%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96-rootfs">Step 3: æ„å»ºæœ€å°åŒ– RootFS</a></p>
</li>
<li><p><a href="#step-4-%E6%89%93%E5%8C%85%E5%B9%B6%E8%BF%90%E8%A1%8C">Step 4: æ‰“åŒ…å¹¶è¿è¡Œ</a></p>
</li>
<li><p><a href="#%E4%BB%8E-shell-%E5%88%B0-zygote%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%98%AF%E4%BB%80%E4%B9%88">ä» Shell åˆ° Zygoteï¼šä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
</li>
</ul>
<hr />
<h2># æ ¸å¿ƒæ¦‚å¿µä¸å¯åŠ¨æµç¨‹</h2>
<ol>
<li><strong>Bootloader</strong>: è®¾å¤‡ä¸Šç”µåæ‰§è¡Œçš„ç¬¬ä¸€æ®µä»£ç ï¼Œè´Ÿè´£åˆå§‹åŒ–ç¡¬ä»¶å¹¶åŠ è½½ Linux å†…æ ¸åˆ°å†…å­˜ã€‚</li>
<li><strong>Kernel</strong>: å†…æ ¸è¢«åŠ è½½åï¼Œå¼€å§‹åˆå§‹åŒ–å„ç§é©±åŠ¨ã€å†…å­˜ç®¡ç†ç­‰ï¼Œç„¶åæŒ‚è½½ä¸€ä¸ªä¸´æ—¶çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ (ramdisk)ã€‚</li>
<li><strong><code>init</code> è¿›ç¨‹</strong>: å†…æ ¸åœ¨ç”¨æˆ·ç©ºé—´å¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶ PID ä¸º 1ã€‚å®ƒæ˜¯æ‰€æœ‰å…¶ä»–ç”¨æˆ·ç©ºé—´è¿›ç¨‹çš„ç¥–å…ˆã€‚</li>
<li><strong><code>init.rc</code></strong>: <code>init</code> è¿›ç¨‹ä¼šè§£æè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ ¹æ®å…¶ä¸­çš„æŒ‡ä»¤æ‰§è¡ŒåŠ¨ä½œï¼Œå¦‚æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€è®¾ç½®ç³»ç»Ÿå±æ€§ã€å¯åŠ¨æœåŠ¡ç­‰ã€‚</li>
</ol>
<p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åˆ›å»ºä¸€ä¸ªæç®€çš„ RootFSï¼Œå…¶ä¸­åŒ…å« <code>init</code> ç¨‹åºå’Œä¸€ä¸ªèƒ½è¢«å®ƒå¯åŠ¨çš„ Shellã€‚</p>
<h2># æœ€å°ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶</h2>
<p>ä¸€ä¸ªèƒ½å¯åŠ¨åˆ° Shell çš„æœ€å° Android ç³»ç»Ÿï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li><p><strong>Linux Kernel</strong>: æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒã€‚</p>
</li>
<li><p><strong><code>init</code></strong>: ç”¨æˆ·ç©ºé—´çš„å®ˆæŠ¤ç¥ï¼Œæ¥è‡ª AOSP æºç  <code>system/core/init</code>ã€‚</p>
</li>
<li><p><strong>C åº“</strong>: <code>libc.so</code> (C æ ‡å‡†åº“), <code>libm.so</code> (æ•°å­¦åº“)ã€‚æ‰€æœ‰åŸç”Ÿç¨‹åºéƒ½ä¾èµ–å®ƒã€‚</p>
</li>
<li><p><strong>åŠ¨æ€é“¾æ¥å™¨</strong>: <code>linker</code> æˆ– <code>linker64</code>ï¼Œç”¨äºåŠ è½½ <code>.so</code> åŠ¨æ€åº“ã€‚</p>
</li>
<li><p><strong>Shell</strong>: <code>sh</code>ï¼Œæˆ‘ä»¬çš„äº¤äº’ç•Œé¢ï¼Œé€šå¸¸ç”± <code>toybox</code> æˆ– <code>toolbox</code> æä¾›ã€‚</p>
</li>
<li><p><strong><code>init.rc</code></strong>: ä¸€ä¸ªæœ€ç®€å•çš„é…ç½®æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>åŸºæœ¬ç›®å½•ç»“æ„</strong>: <code>/dev</code>, <code>/proc</code>, <code>/sys</code>, <code>/system/bin</code>ã€‚</p>
</li>
</ul>
<hr />
<h2># æ„å»ºæ­¥éª¤è¯¦è§£</h2>
<h3># Step 1: å‡†å¤‡ç¯å¢ƒä¸å·¥å…·é“¾</h3>
<p>ä½ éœ€è¦ä¸€ä¸ª Linux ç¯å¢ƒï¼ˆå¦‚ Ubuntuï¼‰å’Œç”¨äºäº¤å‰ç¼–è¯‘çš„å·¥å…·é“¾ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä» AOSP é¢„ç¼–è¯‘åº“ä¸­è·å–ã€‚</p>
<pre><code class="language-bash"># Download AOSP prebuilt aarch64 (ARM64) Toolchain
git clone https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9

# WillToolchainPathAdd toEnvironment variables
export PATH=$(pwd)/aarch64-linux-android-4.9/bin:$PATH
export CROSS_COMPILE=aarch64-linux-android-

</code></pre>
<p>git clone https://android.googlesource.com/kernel/common.git
cd common</p>
<h1>Switch to ä¸€ Stable branch</h1>
<p>git checkout android-4.14</p>
<h1>é…ç½®å†…æ ¸</h1>
<p>export ARCH=arm64
make defconfig</p>
<h1>ç¼–è¯‘å†…æ ¸</h1>
<p>make -j$(nproc)</p>
<h1>CompileSuccessAfterï¼Œä¼š in/at arch/arm64/boot/ Directory ä¸‹ Generate Image.gz å†…æ ¸ File</h1>
<pre><code>mkdir -p my_rootfs/{dev,proc,sys,system/bin,system/lib64}
cd my_rootfs

</code></pre>
<p>è¿™ä¸€æ­¥æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºéœ€è¦ä»å®Œæ•´çš„ AOSP æºç ä¸­å•ç‹¬ç¼–è¯‘ã€‚ä¸€ä¸ªç®€åŒ–çš„æ–¹æ³•æ˜¯<strong>ç›´æ¥ä»ä¸€ä¸ªç°æœ‰çš„ Android ç³»ç»Ÿæˆ– AOSP ç¼–è¯‘äº§ç‰©ä¸­æå–è¿™äº›é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ã€‚</p>
<ul>
<li><p>ä» AOSP ç¼–è¯‘äº§ç‰© <code>out/target/product/&lt;device&gt;/system/</code> ä¸­æ‰¾åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
</li>
<li><p><code>bin/linker64</code> -&gt; å¤åˆ¶åˆ° <code>my_rootfs/system/bin/</code></p>
</li>
<li><p><code>bin/init</code> -&gt; å¤åˆ¶åˆ° <code>my_rootfs/</code></p>
</li>
<li><p><code>bin/toybox</code> -&gt; å¤åˆ¶åˆ° <code>my_rootfs/system/bin/</code></p>
</li>
<li><p><code>lib64/libc.so</code>, <code>lib64/libm.so</code> -&gt; å¤åˆ¶åˆ° <code>my_rootfs/system/lib64/</code></p>
</li>
<li><p>ä¸º <code>toybox</code> åˆ›å»ºå„ç§å‘½ä»¤çš„è½¯é“¾æ¥ï¼š</p>
<pre><code class="language-bash">cd my_rootfs/system/bin
for cmd in $(./toybox); do
ln -s toybox $cmd
done
cd ../../
</code></pre>
</li>
</ul>
<pre><code>åœ¨ `my_rootfs/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `init.rc` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```rc
# init.rc for minimal android

on early-init
mount tmpfs tmpfs /dev
mkdir /dev/pts
mount devpts devpts /dev/pts
mount proc proc /proc
mount sysfs sysfs /sys

on init
export PATH /system/bin
export LD_LIBRARY_PATH /system/lib64

on post-fs
# In a real system, we would mount /data, /cache, etc.
# Here we just start the shell.

service shell /system/bin/sh
class core
console
disabled
user shell
group shell
seclabel u:r:shell:s0

on property:sys.boot_completed=1
start shell

</code></pre>
<ol>
<li><strong>æ‰“åŒ… RootFS</strong>: æˆ‘ä»¬éœ€è¦å°† <code>my_rootfs</code> ç›®å½•æ‰“åŒ…æˆä¸€ä¸ª <code>cpio</code> å½’æ¡£ï¼Œå¹¶ç”¨ <code>gzip</code> å‹ç¼©ï¼Œä½œä¸ºå†…æ ¸çš„ <code>initramfs</code>ã€‚</li>
</ol>
<pre><code class="language-bash">cd my_rootfs
find . | cpio -o -H newc | gzip &gt; ../rootfs.cpio.gz
cd ..

</code></pre>
<h1>ç¡®ä¿ common/arch/arm64/boot/Image.gz and rootfs.cpio.gz in/atCurrentDirectory</h1>
<p>qemu-system-aarch64 \</p>
<ul>
<li>M virt \</li>
<li>cpu cortex-a57 \</li>
<li>m 2048 \</li>
<li>kernel common/arch/arm64/boot/Image.gz \</li>
<li>initrd rootfs.cpio.gz \</li>
<li>nographic \</li>
<li>append &quot;console=ttyAMA0&quot;</li>
</ul>
<p>æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªæœ€å°çš„ Linux ç¯å¢ƒï¼Œä½†å®ƒè¿˜ä¸æ˜¯&quot;Android&quot;ã€‚è¦è®©å®ƒæˆä¸º Androidï¼Œè¿˜éœ€è¦ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li><strong>å¯åŠ¨ <code>servicemanager</code></strong>: ç¼–è¯‘å¹¶è¿è¡Œå®ƒï¼Œå®ƒæ˜¯ Android Binder IPC æœºåˆ¶çš„æ ¸å¿ƒã€‚</li>
<li><strong>å¯åŠ¨ Zygote</strong>: ç¼–è¯‘ <code>app_process</code> å¹¶é€šè¿‡ <code>init.rc</code> å¯åŠ¨å®ƒã€‚Zygote ä¼šé¢„åŠ è½½ Android æ¡†æ¶çš„æ ¸å¿ƒç±» (<code>framework.jar</code>) å¹¶ç›‘å¬ä¸€ä¸ª socketï¼Œç­‰å¾…å­µåŒ–æ–°çš„ App è¿›ç¨‹ã€‚</li>
<li><strong>å¯åŠ¨ <code>system_server</code></strong>: Zygote å¯åŠ¨çš„ç¬¬ä¸€ä¸ª Java è¿›ç¨‹ï¼Œå®ƒä¼šåˆ›å»ºæ‰€æœ‰çš„ Android ç³»ç»ŸæœåŠ¡ (AMS, WMS, PMS ç­‰)ã€‚</li>
</ol>
<p>å®Œæˆè¿™äº›åï¼Œç³»ç»Ÿæ‰èƒ½çœŸæ­£åœ°è¿è¡Œ Android åº”ç”¨ã€‚ä½†è¿™å·²ç»è¶…å‡ºäº†&quot;æœ€å°åŒ– RootFS&quot;çš„èŒƒç•´ï¼Œè¿›å…¥äº†å®Œæ•´çš„ç³»ç»Ÿç§»æ¤å’Œå¼€å‘é¢†åŸŸã€‚</p>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-72">
                                                <h2>72. SO Anti Debugging & Obfuscation</h2>
                                                <h1>SO æ–‡ä»¶åè°ƒè¯•ä¸å­—ç¬¦ä¸²æ··æ·†æŠ€æœ¯</h1>
<h2>åœ¨ Android Native å±‚å®‰å…¨å¯¹æŠ—ä¸­ï¼ŒSO æ–‡ä»¶æ˜¯å®ç°é«˜å¼ºåº¦ä¿æŠ¤çš„é‡è¦è½½ä½“ã€‚é€šè¿‡ init_array æœºåˆ¶ã€å­—ç¬¦ä¸²æ··æ·†å’Œåè°ƒè¯•æŠ€æœ¯çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥æ˜¾è‘—æé«˜é€†å‘åˆ†æçš„éš¾åº¦ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æè¿™äº›æŠ€æœ¯çš„å®ç°åŸç†åŠå¯¹åº”çš„åˆ†æç»•è¿‡æ–¹æ³•ã€‚</h2>
<h2>1. init_array è°ƒç”¨æµç¨‹åŸç†</h2>
<h2># 1.1 ELF åŠ è½½ä¸ init_array æ‰§è¡Œæ—¶æœº</h2>
<pre><code>
</code></pre>
<p>// 1. First call DT<em>INIT initialization function
if (init_func</em> != nullptr) {
init<em>func</em>();
}</p>
<p>// 2. Then iterate through .init<em>array section function pointers
if (init_array</em> != nullptr) {
for (size<em>t i = 0; i &lt; init_array_count</em>; ++i) {
// Call each constructor function
((void (*)())init<em>array</em>[i])();
}
}
}</p>
<pre><code>â†“
nativeLoad() [art/runtime/native/java_lang_Runtime.cc]
â†“
android_dlopen_ext() [bionic/libdl/libdl.cpp]
â†“
do_dlopen() [bionic/linker/linker.cpp]
â†“
find_library() â†’ load_library() â†’ link_image()
â†“
call_constructors() â†’ init_arrayFunctionExecute

</code></pre>
<p>readelf -d target.so | grep INIT</p>
<h1>Use objdump for analysis</h1>
<p>objdump -s -j .init_array target.so</p>
<pre><code>Elf64_Addr *init_array; // Function pointer array
size_t init_array_count; // Array size
} init_array_info;

// Anti-debugging function declaration
__attribute__((constructor))
void anti_debug_init() {
// Anti-debugging logic
}

// After compilation, function pointers are generated in .init_array section

</code></pre>
<pre><code class="language-cpp">// String encryption macro definition
# define ENCRYPT_STRING(str) encrypt_string_xor(str, sizeof(str)-1, 0xAA)

constexpr char* encrypt_string_xor(const char* str, size_t len, char key) {
static char encrypted[256];
for (size_t i = 0; i &lt; len; i++) {
encrypted[i] = str[i] ^ key;
}
encrypted[len] = '\0';
return encrypted;
}

// Usage example
void check_frida() {
// Original string: &quot;/data/local/tmp/frida-server&quot;
const char* encrypted = ENCRYPT_STRING(&quot;\xc4\xae\xa8\xa8\xe4\xe6\xe8\xe0\xe4\xe6\xe4\xa8\xe3\xed\xe4\xa0\xd7\xd9\xd6\xae\xa4\xd7\xd9\xe5\xd9&quot;);

char decrypted[256];
decrypt_string(encrypted, decrypted, strlen(encrypted), 0xAA);

if (access(decrypted, F_OK) == 0) {
exit(1);
}
}

</code></pre>
<p>private:
static constexpr uint8_t AES_KEY[16] = {
0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c
};</p>
<p>static void aes_decrypt(const uint8_t* encrypted, uint8_t* decrypted, size_t len) {
AES_KEY aes_key;
AES_set_decrypt_key(AES_KEY, 128, &amp;aes_key);</p>
<p>for (size_t i = 0; i &lt; len; i += 16) {
AES_decrypt(encrypted + i, decrypted + i, &amp;aes_key);
}
}</p>
<p>public:
static std::string decrypt_string(const uint8_t* encrypted_data, size_t len) {
std::vector&lt;uint8_t&gt; decrypted(len);
aes_decrypt(encrypted_data, decrypted.data(), len);</p>
<p>// ç§»é™¤ padding
size_t actual_len = len;
while (actual_len &gt; 0 &amp;&amp; decrypted[actual_len - 1] == 0) {
actual_len--;
}</p>
<p>return std::string(reinterpret_cast&lt;char*&gt;(decrypted.data()), actual_len);
}
};</p>
<p>// Use encrypted strings
void advanced_anti_debug() {
// Encrypted &quot;/proc/self/status&quot; string
const uint8_t encrypted_proc_status[] = {
0x8a, 0x2d, 0x5e, 0x1f, 0x9b, 0x7c, 0x85, 0xa3,
0x4e, 0x92, 0x67, 0xc1, 0x55, 0x98, 0x33, 0x2a
};</p>
<p>std::string proc_status = StringObfuscator::decrypt_string(
encrypted_proc_status, sizeof(encrypted_proc_status)
);</p>
<p>check_debugger_via_status(proc_status.c_str());
}</p>
<pre><code>void construct_string_on_stack() {
char target_path[64];

// åˆ†æ®µæ„é€ String
strcpy(target_path, &quot;/data/&quot;);
strcat(target_path, &quot;local/&quot;);
strcat(target_path, &quot;tmp/&quot;);
strcat(target_path, &quot;frida-&quot;);
strcat(target_path, &quot;server&quot;);

if (access(target_path, F_OK) == 0) {
exit(1);
}

// æ¸…ç†æ ˆä¸Šæ•æ„ŸString
memset(target_path, 0, sizeof(target_path));
}

</code></pre>
<p>std::vector<a href="std::string">std::string</a> fragments;</p>
<p>public:
void add_fragment(const char* encrypted, size_t len, uint8_t key) {
std::string decrypted;
for (size_t i = 0; i &lt; len; i++) {
decrypted += static_cast<char>(encrypted[i] ^ key);
}
fragments.push_back(decrypted);
}</p>
<p>std::string build() {
std::string result;
for (const auto&amp; fragment : fragments) {
result += fragment;
}</p>
<p>// ç«‹å³æ¸…ç† fragments
fragments.clear();</p>
<p>return result;
}
};</p>
<p>void dynamic_string_detection() {
DynamicStringBuilder builder;</p>
<p>// åˆ†æ®µ EncryptString ç‰‡æ®µ
const char frag1[] = {0x8f, 0x9e, 0x9a, 0x9a, 0x8f}; // &quot;/data&quot;
const char frag2[] = {0x8f, 0x93, 0x91, 0x9d, 0x9e, 0x93}; // &quot;/local&quot;
const char frag3[] = {0x8f, 0x9a, 0x94, 0x92}; // &quot;/tmp&quot;</p>
<p>builder.add_fragment(frag1, 5, 0xEE);
builder.add_fragment(frag2, 6, 0xEE);
builder.add_fragment(frag3, 4, 0xEE);</p>
<p>std::string path = builder.build();</p>
<p>// Use æ„é€  PathPerformDetection
perform_detection(path.c_str());
}</p>
<pre><code>import re
from elftools.elf.elffile import ELFFile

def detect_string_obfuscation(so_path):
with open(so_path, 'rb') as f:
elf = ELFFile(f)

# Check if .rodata section contains suspicious encrypted data
rodata_section = elf.get_section_by_name('.rodata')
if rodata_section:
data = rodata_section.data()

# Detect Xor pattern (high entropy)
entropy = calculate_entropy(data)
if entropy &gt; 7.5:
print(f&quot;[+] Possible XOR encrypted strings, entropy: {entropy}&quot;)

# Detect AES block pattern (16-byte aligned data blocks)
aes_patterns = find_aes_patterns(data)
if aes_patterns:
print(f&quot;[+] Possible AES encrypted strings: {len(aes_patterns)} blocks&quot;)

def calculate_entropy(data):
import math
byte_counts = [0] * 256
for byte in data:
byte_counts[byte] += 1

entropy = 0
for count in byte_counts:
if count &gt; 0:
freq = count / len(data)
entropy -= freq * math.log2(freq)

return entropy

</code></pre>
<p>// Hook common string decryption functions
var decrypt_func = Module.findExportByName(&quot;libtarget.so&quot;, &quot;_Z15decrypt_stringPKcS0_h&quot;);
if (decrypt_func) {
Interceptor.attach(decrypt_func, {
onEnter: function(args) {
this.encrypted = args[0];
this.output = args[1];
},
onLeave: function(retval) {
var decrypted = this.output.readCString();
console.log(&quot;[+] Decrypted string: &quot; + decrypted);</p>
<p>// Save the decrypted string
send({
type: &quot;decrypted_string&quot;,
data: decrypted
});
}
});
}</p>
<p>// Hook Xor decryption
var xor_decrypt = Module.findExportByName(&quot;libtarget.so&quot;, &quot;decrypt_string&quot;);
if (xor_decrypt) {
Interceptor.attach(xor_decrypt, {
onLeave: function(retval) {
var result = retval.readCString();
console.log(&quot;[+] XOR decrypted: &quot; + result);
}
});
}
}</p>
<p>// Hook dynamic string construction
function hook_string_construction() {
var strcat = Module.findExportByName(&quot;libc.so&quot;, &quot;strcat&quot;);
var strcpy = Module.findExportByName(&quot;libc.so&quot;, &quot;strcpy&quot;);</p>
<p>var string_tracker = new Map();</p>
<p>Interceptor.attach(strcpy, {
onEnter: function(args) {
this.dest = args[0];
this.src = args[1].readCString();
},
onLeave: function(retval) {
string_tracker.set(this.dest.toString(), this.src);
}
});</p>
<p>Interceptor.attach(strcat, {
onEnter: function(args) {
this.dest = args[0];
this.src = args[1].readCString();
},
onLeave: function(retval) {
var dest_key = this.dest.toString();
var current = string_tracker.get(dest_key) || &quot;&quot;;
var new_string = current + this.src;
string_tracker.set(dest_key, new_string);</p>
<p>// Detect sensitive string construction
if (new_string.includes(&quot;frida&quot;) || new_string.includes(&quot;/proc/&quot;) || new_string.includes(&quot;gdb&quot;)) {
console.log(&quot;[!] Sensitive string constructed: &quot; + new_string);
}
}
});
}</p>
<pre><code>
```cpp
// in/at.init_arrayInExecuteAnti-DebuggingFunction
__attribute__((constructor(101))) // Specifiedä¼˜å…ˆçº§
void init_anti_debug_level1() {
// 1. ptraceè‡ªèº«Protected
if (ptrace(PTRACE_TRACEME, 0, 1, 0) == -1) {
_exit(1);
}

// 2. DetectionDebugå™¨Process
check_debugger_processes();

// 3. DetectionFridaFile
check_frida_artifacts();
}

__attribute__((constructor(102)))
void init_anti_debug_level2() {
// 4. DetectionMemoryMap
check_suspicious_mappings();

// 5. Detectionhookç—•è¿¹
check_hook_signatures();

// 6. TimeDetection
timing_attack_detection();
}

void check_debugger_processes() {
const char* debugger_names[] = {
&quot;gdb&quot;, &quot;lldb&quot;, &quot;strace&quot;, &quot;ida&quot;, &quot;x64dbg&quot;
};

for (const char* name : debugger_names) {
if (process_exists(name)) {
execute_anti_debug_response();
}
}
}

void check_frida_artifacts() {
const char* frida_indicators[] = {
&quot;/data/local/tmp/frida-server&quot;,
&quot;/data/local/tmp/frida-agent-64.so&quot;,
&quot;/system/lib64/libfrida-gum.so&quot;
};

for (const char* indicator : frida_indicators) {
if (file_exists(indicator)) {
execute_anti_debug_response();
}
}
}

</code></pre>
<p>// æ£€æµ‹ä»£ç æ®µå®Œæ•´æ€§
verify_code_integrity();</p>
<p>// Detectionanomaly å‘é‡ table
check_exception_handlers();</p>
<p>// SetMemoryProtected
setup_memory_protection();
}</p>
<p>void check_suspicious_mappings() {
FILE* maps = fopen(&quot;/proc/self/maps&quot;, &quot;r&quot;);
char line[512];</p>
<p>while (fgets(line, sizeof(line), maps)) {
// Detection å¯ç–‘ LibraryMap
if (strstr(line, &quot;frida&quot;) ||
strstr(line, &quot;gum-js-loop&quot;) ||
strstr(line, &quot;xposed&quot;)) {
fclose(maps);
execute_anti_debug_response();
}</p>
<p>// Detection å¯ç–‘æƒé™ç»„åˆ
if (strstr(line, &quot;rwxp&quot;)) { // å¯è¯»å†™æ‰§è¡Œé¡µé¢
analyze_rwx_mapping(line);
}
}</p>
<p>fclose(maps);
}</p>
<p>void verify_code_integrity() {
// CalculateCode æ®µå“ˆå¸Œ Value
Dl_info info;
dladdr((void*)verify_code_integrity, &amp;info);</p>
<p>const char* base = (const char*)info.dli_fbase;
size_t text_size = get_text_section_size(base);</p>
<p>uint32_t current_hash = calculate_crc32(base, text_size);
uint32_t expected_hash = get_expected_hash();</p>
<p>if (current_hash != expected_hash) {
// Code è¢« Modifyï¼ŒExecute å¯¹æŠ— Measure
code_tampering_detected();
}
}</p>
<pre><code>void init_timing_checks() {
// å¯åŠ¨å®šæ—¶å™¨æ£€æµ‹
start_timing_monitor();

// Detectionå•æ­¥Execute
detect_single_stepping();
}

void detect_single_stepping() {
struct timespec start, end;
clock_gettime(CLOCK_MONOTONIC, &amp;start);

// Executeä¸€äº›SimpleOperation
volatile int dummy = 0;
for (int i = 0; i &lt; 1000; i++) {
dummy += i;
}

clock_gettime(CLOCK_MONOTONIC, &amp;end);

long duration = (end.tv_sec - start.tv_sec) * 1000000000 +
(end.tv_nsec - start.tv_nsec);

// IfExecuteTimeanomalyï¼Œå¯èƒ½in/atå•æ­¥Debug
if (duration &gt; NORMAL_EXECUTION_TIME * 10) {
single_step_detected();
}
}

void start_timing_monitor() {
std::thread([]() {
while (true) {
std::this_thread::sleep_for(std::chrono::seconds(5));

// å®šæœŸæ£€æµ‹ç³»ç»Ÿè°ƒç”¨æ—¶é—´
struct timespec start, end;
clock_gettime(CLOCK_MONOTONIC, &amp;start);
getpid(); // Simpleç³»ç»ŸCall
clock_gettime(CLOCK_MONOTONIC, &amp;end);

long syscall_time = (end.tv_sec - start.tv_sec) * 1000000000 +
(end.tv_nsec - start.tv_nsec);

if (syscall_time &gt; NORMAL_SYSCALL_TIME * 5) {
// ç³»ç»Ÿè°ƒç”¨è¢«æ‹¦æˆªæˆ–è°ƒè¯•
syscall_hooking_detected();
}
}
}).detach();
}

</code></pre>
<p>EXIT_SILENTLY,
CORRUPT_DATA,
FAKE_EXECUTION,
CRASH_GRACEFULLY,
REPORT_TO_SERVER
};</p>
<p>void execute_anti_debug_response() {
static int detection_count = 0;
detection_count++;</p>
<p>// æ ¹æ®æ£€æµ‹æ¬¡æ•°é€‰æ‹©ä¸åŒå“åº”ç­–ç•¥
AntiDebugResponse response = select_response_strategy(detection_count);</p>
<p>switch (response) {
case AntiDebugResponse::EXIT_SILENTLY:
_exit(0);
break;</p>
<p>case AntiDebugResponse::CORRUPT_DATA:
corrupt_critical_data();
break;</p>
<p>case AntiDebugResponse::FAKE_EXECUTION:
enter_fake_execution_mode();
break;</p>
<p>case AntiDebugResponse::CRASH_GRACEFULLY:
trigger_controlled_crash();
break;</p>
<p>case AntiDebugResponse::REPORT_TO_SERVER:
report_debug_attempt();
_exit(1);
break;
}
}</p>
<p>void corrupt_critical_data() {
// ç ´åå…³ KeyData ç»“æ„ï¼Œä½¿ AnalysisResultNo æ•ˆ
extern char critical_data_start[];
extern char critical_data_end[];</p>
<p>size_t size = critical_data_end - critical_data_start;
for (size_t i = 0; i &lt; size; i++) {
critical_data_start[i] ^= 0xFF;
}
}</p>
<p>void enter_fake_execution_mode() {
// è¿›å…¥è™š FalseExecute æ¨¡å¼ï¼ŒReturnErrorAnalysisResult
global_fake_mode = true;</p>
<p>// ModifyFunction æŒ‡é’ˆï¼ŒæŒ‡å‘è™š FalseImplement
redirect_function_calls();
}</p>
<pre><code>
```python
# Tool to analyze init_array section
import subprocess
from elftools.elf.elffile import ELFFile

class InitArrayAnalyzer:
def __init__(self, so_path):
self.so_path = so_path
self.init_functions = []

def analyze_init_array(self):
# Use readelf to get init_array information
result = subprocess.run(['readelf', '-d', self.so_path],
capture_output=True, text=True)

for line in result.stdout.split('\n'):
if 'INIT_ARRAY' in line:
# Parse init_array address and size
self.parse_init_array_info(line)

def extract_function_addresses(self):
with open(self.so_path, 'rb') as f:
elf = ELFFile(f)

# Find .init_array section
init_array_section = elf.get_section_by_name('.init_array')
if init_array_section:
data = init_array_section.data()

# Parse function pointers (8-byte aligned)
for i in range(0, len(data), 8):
if i + 8 &lt;= len(data):
func_addr = int.from_bytes(data[i:i+8], 'little')
self.init_functions.append(func_addr)
print(f&quot;[+] Init function at: 0x{func_addr:x}&quot;)

def disassemble_functions(self):
# Use objdump to disassemble each initialization function
for addr in self.init_functions:
print(f&quot;\n[+] Disassembling function at 0x{addr:x}&quot;)
subprocess.run(['objdump', '-d', '--start-address', hex(addr),
'--stop-address', hex(addr + 0x100), self.so_path])

# Usage example
analyzer = InitArrayAnalyzer('target.so')
analyzer.analyze_init_array()
analyzer.extract_function_addresses()
analyzer.disassemble_functions()

</code></pre>
<p>// Hook constructor function calls
var call_constructors = Module.findExportByName(&quot;linker64&quot;, &quot;_ZN6soinfo17call_constructorsEv&quot;);
if (call_constructors) {
Interceptor.attach(call_constructors, {
onEnter: function(args) {
var soinfo = args[0];
var soname = get_soname(soinfo);
console.log(&quot;[+] Calling constructors for: &quot; + soname);</p>
<p>this.soname = soname;
this.start_time = Date.now();
},
onLeave: function(retval) {
var duration = Date.now() - this.start_time;
console.log(&quot;[+] Constructors completed for &quot; + this.soname +
&quot; in &quot; + duration + &quot;ms&quot;);
}
});
}</p>
<p>// Hook each function in init_array
var target_module = Process.findModuleByName(&quot;libtarget.so&quot;);
if (target_module) {
analyze_init_array_section(target_module);
}
}</p>
<p>function analyze_init_array_section(module) {
// ParseELFFile æ‰¾åˆ° init_array æ®µ
var elf_base = module.base;
var elf_header = elf_base.readByteArray(64); // ELF header</p>
<p>// GetProgram å¤´ table åç§»
var phoff = elf_base.add(0x20).readU64();
var phnum = elf_base.add(0x38).readU16();</p>
<p>// IterateProgram å¤´ï¼ŒæŸ¥æ‰¾ PT_DYNAMIC
for (var i = 0; i &lt; phnum; i++) {
var ph_addr = elf_base.add(phoff).add(i * 56);
var p_type = ph_addr.readU32();</p>
<p>if (p_type === 2) { // PT_DYNAMIC
var p_vaddr = ph_addr.add(16).readU64();
var dynamic_addr = elf_base.add(p_vaddr);</p>
<p>parse_dynamic_section(dynamic_addr, module);
break;
}
}
}</p>
<p>function parse_dynamic_section(dynamic_addr, module) {
var addr = dynamic_addr;</p>
<p>while (true) {
var tag = addr.readU64();
var val = addr.add(8).readU64();</p>
<p>if (tag === 0) break; // DT_NULL</p>
<p>if (tag === 25) { // DT_INIT_ARRAY
var init_array_addr = module.base.add(val);
console.log(&quot;[+] Found init_array at: &quot; + init_array_addr);</p>
<p>// Hook init_arrayin æ¯ Function
hook_init_array_functions(init_array_addr, module);
} else if (tag === 27) { // DT_INIT_ARRAYSZ
var array_size = val;
console.log(&quot;[+] Init_array size: &quot; + array_size);
}</p>
<p>addr = addr.add(16);
}
}</p>
<p>function hook_init_array_functions(init_array_addr, module) {
var num_functions = 10; // False è®¾æœ€å¤š 10Function</p>
<p>for (var i = 0; i &lt; num_functions; i++) {
var func_ptr_addr = init_array_addr.add(i * 8);
var func_addr = func_ptr_addr.readPointer();</p>
<p>if (func_addr.isNull()) break;</p>
<p>console.log(&quot;[+] Hooking init function &quot; + i + &quot; at: &quot; + func_addr);</p>
<p>Interceptor.attach(func_addr, {
onEnter: function(args) {
console.log(&quot;[!] Init function &quot; + this.func_index + &quot; called&quot;);</p>
<p>// PrintCall æ ˆ
console.log(Thread.backtrace(this.context, Backtracer.ACCURATE)
.map(DebugSymbol.fromAddress).join('\n'));
},
onLeave: function(retval) {
console.log(&quot;[!] Init function &quot; + this.func_index + &quot; completed&quot;);
}
});
}
}</p>
<pre><code>function bypass_ptrace() {
var ptrace = Module.findExportByName(&quot;libc.so&quot;, &quot;ptrace&quot;);
if (ptrace) {
Interceptor.attach(ptrace, {
onEnter: function(args) {
var request = args[0].toInt32();
if (request === 0) { // PTRACE_TRACEME
console.log(&quot;[+] Blocking PTRACE_TRACEME&quot;);
args[0] = ptr(-1);
}
},
onLeave: function(retval) {
// å§‹ç»ˆReturnSuccess
retval.replace(ptr(0));
}
});
}
}

// BypassFileDetection
function bypass_file_detection() {
var access = Module.findExportByName(&quot;libc.so&quot;, &quot;access&quot;);
var openat = Module.findExportByName(&quot;libc.so&quot;, &quot;openat&quot;);

var blocked_paths = [
&quot;/data/local/tmp/frida-server&quot;,
&quot;/proc/self/maps&quot;,
&quot;/proc/self/status&quot;
];

if (access) {
Interceptor.attach(access, {
onEnter: function(args) {
var path = args[0].readCString();
if (blocked_paths.some(p =&gt; path.includes(p))) {
console.log(&quot;[+] Blocking access to: &quot; + path);
args[0] = Memory.allocUtf8String(&quot;/dev/null&quot;);
}
}
});
}

if (openat) {
Interceptor.attach(openat, {
onEnter: function(args) {
var path = args[1].readCString();
if (blocked_paths.some(p =&gt; path.includes(p))) {
console.log(&quot;[+] Blocking openat for: &quot; + path);
args[1] = Memory.allocUtf8String(&quot;/dev/null&quot;);
}
}
});
}
}

// BypassTimeDetection
function bypass_timing_detection() {
var clock_gettime = Module.findExportByName(&quot;libc.so&quot;, &quot;clock_gettime&quot;);
if (clock_gettime) {
var fake_time = {
sec: 1640995200, // å›ºå®šæ—¶é—´æˆ³
nsec: 0
};

Interceptor.attach(clock_gettime, {
onLeave: function(retval) {
var timespec = this.context.x1; // SecondParameter
if (!timespec.isNull()) {
// Writeå›ºå®šTimeValue
timespec.writeU64(fake_time.sec);
timespec.add(8).writeU64(fake_time.nsec);

// æ¯æ¬¡è°ƒç”¨ç•¥å¾®å¢åŠ çº³ç§’
fake_time.nsec += 1000;
}
}
});
}
}

</code></pre>
<p>var mprotect = Module.findExportByName(&quot;libc.so&quot;, &quot;mprotect&quot;);
if (mprotect) {
Interceptor.attach(mprotect, {
onEnter: function(args) {
var addr = args[0];
var size = args[1].toInt32();
var prot = args[2].toInt32();</p>
<p>console.log(&quot;[+] mprotect: &quot; + addr + &quot;, size: &quot; + size +
&quot;, prot: 0x&quot; + prot.toString(16));</p>
<p>// é˜»æ­¢ç§»é™¤ execute permission
if ((prot &amp; 0x4) === 0) {
args[2] = ptr(prot | 0x4); // AddPROT_EXEC
}
}
});
}
}</p>
<p>// HookStringDecryptFunction
function hook_string_decryption() {
var module = Process.findModuleByName(&quot;libtarget.so&quot;);
if (!module) return;</p>
<p>// æ‰«æ DecryptFunction æ¨¡å¼
var pattern = &quot;48 89 ?? 48 89 ?? 48 83 ?? ?? 8B ?? ??&quot;; // x64DecryptFunction æ¨¡å¼</p>
<p>Memory.scan(module.base, module.size, pattern, {
onMatch: function(address, size) {
console.log(&quot;[+] Found potential decryption function at: &quot; + address);</p>
<p>Interceptor.attach(address, {
onEnter: function(args) {
console.log(&quot;[+] Decryption function called&quot;);
this.args = Array.prototype.slice.call(args);
},
onLeave: function(retval) {
// å°è¯• ReadDecryptResult
try {
var result = retval.readCString();
if (result &amp;&amp; result.length &gt; 0 &amp;&amp; result.length &lt; 256) {
console.log(&quot;[+] Decrypted string: &quot; + result);
}
} catch (e) {
// å¯èƒ½ä¸ isString
}
}
});
},
onComplete: function() {
console.log(&quot;[+] Decryption function scan completed&quot;);
}
});
}</p>
<p>// æ™ºèƒ½ Anti-DebuggingBypass
function intelligent_anti_debug_bypass() {
// 1. è‡ªåŠ¨æ£€æµ‹å¹¶ç»•è¿‡å¸¸è§åè°ƒè¯•æŠ€æœ¯
bypass_ptrace();
bypass_file_detection();
bypass_timing_detection();
bypass_memory_protection();</p>
<p>// 2. Monitorinit_arrayExecute
monitor_init_array();</p>
<p>// 3. HookStringDecrypt
hook_string_decryption();</p>
<p>// 4. Set å®šæœŸ Checkï¼ŒProcessNewAnti-Debugging æœºåˆ¶
setInterval(function() {
check_new_anti_debug_mechanisms();
}, 5000);
}</p>
<p>function check_new_anti_debug_mechanisms() {
// DetectionNewAnti-DebuggingThread
var threads = Process.enumerateThreads();
threads.forEach(function(thread) {
// Check if ThreadCall æ ˆ is ContainsAnti-DebuggingFunction
var backtrace = Thread.backtrace(thread.context, Backtracer.ACCURATE);
// Analysis å¹¶ Process...
});
}</p>
<pre><code>// å®ç°å¤šå±‚çº§ä¿æŠ¤æœºåˆ¶
class ComprehensiveProtection {
private:
static bool stage1_passed;
static bool stage2_passed;
static bool stage3_passed;

public:
// ç¬¬ä¸€Stageï¼šBasicDetection
__attribute__((constructor(101)))
static void protection_stage1() {
if (basic_anti_debug_check()) {
stage1_passed = true;
decrypt_stage2_key();
} else {
enter_decoy_mode();
}
}

// SecondStageï¼šæ·±åº¦Detection
__attribute__((constructor(102)))
static void protection_stage2() {
if (!stage1_passed) return;

if (advanced_detection()) {
stage2_passed = true;
unlock_critical_functions();
} else {
corrupt_stage2_data();
}
}

// ç¬¬ä¸‰Stageï¼šRunWhenProtected
__attribute__((constructor(103)))
static void protection_stage3() {
if (!stage2_passed) return;

start_runtime_protection();
stage3_passed = true;
}

// å…³é”®å‡½æ•°åªæœ‰åœ¨æ‰€æœ‰æ£€æµ‹é€šè¿‡åæ‰èƒ½æ­£å¸¸æ‰§è¡Œ
static bool is_protection_active() {
return stage1_passed &amp;&amp; stage2_passed &amp;&amp; stage3_passed;
}
};

</code></pre>
<p>private:
enum ThreatLevel {
NO_THREAT = 0,
LOW_THREAT = 1,
MEDIUM_THREAT = 2,
HIGH_THREAT = 3,
CRITICAL_THREAT = 4
};</p>
<p>static ThreatLevel assess_threat_level() {
int threat_score = 0;</p>
<p>// å„ç§æ£€æµ‹æƒé‡è¯„åˆ†
if (detect_frida()) threat_score += 30;
if (detect_debugger()) threat_score += 25;
if (detect_hook()) threat_score += 20;
if (detect_emulator()) threat_score += 15;
if (detect_root()) threat_score += 10;</p>
<p>if (threat_score &gt;= 80) return CRITICAL_THREAT;
if (threat_score &gt;= 60) return HIGH_THREAT;
if (threat_score &gt;= 40) return MEDIUM_THREAT;
if (threat_score &gt;= 20) return LOW_THREAT;
return NO_THREAT;
}</p>
<p>public:
static void adaptive_response() {
ThreatLevel level = assess_threat_level();</p>
<p>switch (level) {
case CRITICAL_THREAT:
immediate_termination();
break;
case HIGH_THREAT:
data_corruption_and_exit();
break;
case MEDIUM_THREAT:
fake_execution_mode();
break;
case LOW_THREAT:
increased_monitoring();
break;
case NO_THREAT:
normal_execution();
break;
}
}
};</p>
<pre><code>1. å¤šå±‚çº§æ£€æµ‹æœºåˆ¶ï¼Œåˆ†é˜¶æ®µéªŒè¯
2. å­—ç¬¦ä¸²åŠ¨æ€è§£å¯†ï¼Œé¿å…é™æ€åˆ†æ
3. æ—¶é—´å’Œè¡Œä¸ºæ£€æµ‹ï¼Œè¯†åˆ«è°ƒè¯•ç¯å¢ƒ
4. è‡ªé€‚åº”å“åº”ç­–ç•¥ï¼Œæ ¹æ®å¨èƒç­‰çº§è°ƒæ•´

* *åˆ†ææ–¹çš„åº”å¯¹ç­–ç•¥**ï¼š
1. é™æ€åˆ†æç»“åˆåŠ¨æ€Hook
2. å…¨é¢çš„APIæ‹¦æˆªå’Œé‡å®šå‘
3. æ—¶é—´å’Œç¯å¢ƒæ¨¡æ‹Ÿ
4. è‡ªåŠ¨åŒ–ç»•è¿‡è„šæœ¬å¼€å‘

è¿™ä¸€æŠ€æœ¯å¯¹æŠ—å°†æŒç»­æ¼”è¿›ï¼ŒåŒæ–¹éƒ½éœ€è¦ä¸æ–­æå‡æŠ€æœ¯æ°´å¹³ä»¥åº”å¯¹æ–°çš„æŒ‘æˆ˜ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-73">
                                                <h2>73. SO Runtime Emulation</h2>
                                                <h1>SO è¿è¡Œæ—¶ä»¿çœŸï¼šè„±ç¦»è®¾å¤‡çš„ Native ä»£ç æ‰§è¡Œ</h1>
<p>åœ¨é«˜çº§ Android é€†å‘å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è‡ªåŠ¨åŒ–åœ°è°ƒç”¨ SO æ–‡ä»¶ä¸­çš„åŠ å¯†ã€ç­¾åæˆ–æ ¡éªŒå‡½æ•°ã€‚ç„¶è€Œï¼Œåœ¨çœŸå®çš„è®¾å¤‡ä¸Šé€šè¿‡ Frida Hook æ¥åšè¿™ä»¶äº‹ï¼Œä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°åè°ƒè¯•å’Œç¯å¢ƒæ£€æµ‹çš„é˜»ç¢ã€‚</p>
<p><strong>SO è¿è¡Œæ—¶ä»¿çœŸ</strong>ï¼ˆæœ‰æ—¶è¢«ç§°ä¸º&quot;ç¬¦å·æ‰§è¡Œ&quot;çš„å·¥ç¨‹åŒ–åº”ç”¨ï¼‰æ˜¯ä¸€ç§é©å‘½æ€§çš„æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åœ¨ PC ä¸Šåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„ Android Native è¿è¡Œç¯å¢ƒï¼Œç›´æ¥åŠ è½½å¹¶æ‰§è¡Œ SO æ–‡ä»¶ï¼Œä»è€Œæ‘†è„±å¯¹çœŸå®è®¾å¤‡çš„ä¾èµ–ã€‚</p>
<h2>æ ¸å¿ƒæ¶æ„</h2>
<p>ä¸€ä¸ªå…¸å‹çš„ SO ä»¿çœŸæ¡†æ¶ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†æ„æˆï¼š</p>
<h2># 1. ELF åŠ è½½å™¨ (ELF Loader)</h2>
<p>è¿™æ˜¯ä»¿çœŸçš„åŸºç¡€ã€‚å®ƒè´Ÿè´£åƒ Android çš„ <code>linker</code> ä¸€æ ·å·¥ä½œï¼š</p>
<ul>
<li><p><strong>è§£æ ELF</strong>: è¯»å– SO æ–‡ä»¶çš„å¤´éƒ¨ã€ç¨‹åºå¤´ã€æ®µè¡¨ç­‰ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>å†…å­˜æ˜ å°„</strong>: æ ¹æ®ç¨‹åºå¤´ï¼ˆ<code>PT_LOAD</code>ï¼‰å°† SO çš„ä»£ç æ®µï¼ˆ<code>.text</code>ï¼‰å’Œæ•°æ®æ®µï¼ˆ<code>.data</code>, <code>.bss</code>ï¼‰åŠ è½½åˆ°æ¨¡æ‹Ÿçš„å†…å­˜ç©ºé—´ä¸­ã€‚</p>
</li>
<li><p><strong>å¤„ç†é‡å®šä½</strong>: è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚SO æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“å®ƒä¼šè¢«åŠ è½½åˆ°å“ªä¸ªåŸºåœ°å€ï¼Œä¹Ÿä¸çŸ¥é“å¤–éƒ¨å‡½æ•°ï¼ˆå¦‚ <code>memcpy</code>ï¼‰çš„å…·ä½“åœ°å€ã€‚åŠ è½½å™¨éœ€è¦è§£æé‡å®šä½è¡¨ï¼ˆ<code>.rel.dyn</code>, <code>.rela.dyn</code>ï¼‰ï¼Œå¹¶å°†ä»£ç ä¸­æ‰€æœ‰å¯¹å†…éƒ¨åœ°å€å’Œå¤–éƒ¨ç¬¦å·çš„å¼•ç”¨è¿›è¡Œä¿®æ­£ï¼Œå¡«å†™æ­£ç¡®çš„è¿è¡Œæ—¶åœ°å€ã€‚</p>
</li>
</ul>
<h2># 2. CPU æ¨¡æ‹Ÿå™¨ (CPU Emulator)</h2>
<ul>
<li><p><strong>Unicorn Engine</strong>: è¿™æ˜¯ç›®å‰æœ€ä¸»æµçš„é€‰æ‹©ã€‚Unicorn æ˜¯ä¸€ä¸ªåŸºäº QEMU çš„è½»é‡çº§ã€å¤šå¹³å°çš„ CPU æ¨¡æ‹Ÿå™¨åº“ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥æ‰§è¡ŒåŠ è½½åˆ°å†…å­˜ä¸­çš„ ARM æˆ– ARM64 æœºå™¨ç ã€‚</p>
</li>
<li><p><strong>æŒ‡ä»¤çº§æ§åˆ¶</strong>: Unicorn å…è®¸æˆ‘ä»¬ç²¾ç»†åœ°æ§åˆ¶æ‰§è¡Œæµç¨‹ï¼ŒåŒ…æ‹¬è®¾ç½®å¯„å­˜å™¨ã€è¯»å†™å†…å­˜ã€ä»¥åŠé€šè¿‡ Hook æœºåˆ¶åœ¨æ‰§è¡Œåˆ°ç‰¹å®šæŒ‡ä»¤æˆ–åœ°å€æ—¶è§¦å‘å›è°ƒã€‚</p>
</li>
</ul>
<h2># 3. ç³»ç»Ÿåº“ä¸ç¯å¢ƒæ¨¡æ‹Ÿ (Library &amp; Environment Mocking)</h2>
<p>SO æ–‡ä»¶ä¸ä¼šç‹¬ç«‹å­˜åœ¨ï¼Œå®ƒæ€»æ˜¯ä¼šè°ƒç”¨å¤–éƒ¨å‡½æ•°ã€‚ä»¿çœŸæ¡†æ¶å¿…é¡»èƒ½å¤Ÿ&quot;å‡è£…&quot;è‡ªå·±æ˜¯ Android ç³»ç»Ÿï¼Œæä¾›è¿™äº›å‡½æ•°ã€‚</p>
<ul>
<li><p><strong>Mock <code>libc.so</code></strong>: æä¾› <code>malloc</code>, <code>free</code>, <code>memcpy</code>, <code>strlen</code>, <code>printf</code> ç­‰æ ‡å‡† C åº“å‡½æ•°çš„å®ç°ã€‚å½“ SO è°ƒç”¨è¿™äº›å‡½æ•°æ—¶ï¼Œä¼šè¢«é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±å®ç°çš„ç‰ˆæœ¬ã€‚</p>
</li>
<li><p><strong>Mock Android Framework Libraries</strong>: æä¾› <code>liblog.so</code> (<code>__android_log_print</code>)ã€<code>libz.so</code> (å‹ç¼©åº“)ã€<code>libcrypto.so</code> (OpenSSL) ç­‰å¸¸ç”¨ç³»ç»Ÿåº“çš„å‡½æ•°å®ç°ã€‚</p>
</li>
<li><p><strong>Mock JNI ç¯å¢ƒ</strong>: å¦‚æœè¦è°ƒç”¨çš„å‡½æ•°æ˜¯ JNI å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜éœ€è¦æ¨¡æ‹Ÿ <code>JNIEnv</code> æŒ‡é’ˆå’Œç›¸å…³çš„å‡½æ•°è¡¨ï¼ˆ<code>NewStringUTF</code>, <code>GetFieldID</code> ç­‰ï¼‰ã€‚è¿™æ˜¯ä¸ Java ä¸–ç•Œäº¤äº’çš„å…³é”®ã€‚</p>
</li>
</ul>
<h2>æ¨èé¡¹ç›®ï¼š<code>unidbg</code></h2>
<p><code>unidbg</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œæˆç†Ÿçš„ã€ä¸“é—¨ç”¨äº Android SO ä»¿çœŸå’Œç¬¦å·æ‰§è¡Œçš„ Java å¼€æºé¡¹ç›®ã€‚å®ƒæå¤§åœ°ç®€åŒ–äº†ä¸Šè¿°å¤æ‚çš„å·¥ä½œã€‚</p>
<p><strong><code>unidbg</code> çš„ä¼˜ç‚¹</strong>:</p>
<ul>
<li><p><strong>é«˜åº¦è‡ªåŠ¨åŒ–</strong>: å†…ç½®äº†å®Œå–„çš„ ELF åŠ è½½å™¨å’Œå¸¸ç”¨ç³»ç»Ÿåº“çš„ Mock å®ç°ã€‚</p>
</li>
<li><p><strong>æ˜“äºä½¿ç”¨</strong>: æä¾›äº†ç®€æ´çš„ APIï¼Œç”¨æˆ·åªéœ€å‡ è¡Œä»£ç å°±å¯ä»¥åŠ è½½ SOã€è°ƒç”¨å‡½æ•°ã€‚</p>
</li>
<li><p><strong>JNI æ¨¡æ‹Ÿ</strong>: æ‹¥æœ‰å¼ºå¤§çš„ JNI æ¨¡æ‹Ÿèƒ½åŠ›ï¼Œç”šè‡³å¯ä»¥è°ƒç”¨å’Œ Mock Java å¯¹è±¡çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>è°ƒè¯•ä¸è·Ÿè¸ª</strong>: æ”¯æŒä¸ GDB è¿æ¥è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Hook æœºåˆ¶æ‰“å°è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ã€‚</p>
</li>
</ul>
<h2># <code>unidbg</code> ä½¿ç”¨èŒƒä¾‹ (æ¦‚å¿µä»£ç )</h2>
<pre><code class="language-java">// Use unidbg Callä¸€ SO inSignatureFunction
public class SignatureCalculator {
public static void main(String[] args) {
// 1. Createä¸€ android ARM64 æ¨¡æ‹Ÿå™¨Instance
Emulator&lt;?&gt; emulator = AndroidEmulatorBuilder.for64Bit().build();
Memory memory = emulator.getMemory();

// 2. LoadTarget SO FileåŠå…¶ä¾èµ–
// unidbg ä¼šAutoProcessé‡å®šä½andä¾èµ–Load
Module module = emulator.loadLibrary(new File(&quot;libnative-lib.so&quot;));

// 3. å‡†å¤‡InputData
String input = &quot;this is my data to sign&quot;;
// WillInputStringWriteæ¨¡æ‹Ÿå™¨MemoryIn
Pointer inputPtr = memory.allocateString(input);

// 4. CallTargetFunction
// d.callFunction() ä¼šAutoProcesså¯„å‚¨å™¨andStackSet
Number result = module.callFunction(emulator, /* function offset */ 0x1234, inputPtr, input.length());

// 5. ä»æ¨¡æ‹Ÿå™¨MemoryInReadResult
Pointer resultPtr = Pointer.pointer(emulator, result.intValue());
String signature = resultPtr.getString(0);

System.out.println(&quot;Input: &quot; + input);
System.out.println(&quot;Signature: &quot; + signature);

// 6. å…³é—­æ¨¡æ‹Ÿå™¨
emulator.close();
}
}

</code></pre>
<ul>
<li><p><strong>pyelftools</strong>: ç”¨äºè§£æ ELF æ–‡ä»¶ï¼Œè·å–åŠ è½½ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>Python</strong>: èƒ¶æ°´è¯­è¨€ï¼Œç”¨äºç¼–å†™åŠ è½½å™¨å’Œ Mock å‡½æ•°ã€‚</p>
</li>
</ul>
<h2># 2. å®ç°æ­¥éª¤</h2>
<h3># a. åˆå§‹åŒ– Unicorn ç¯å¢ƒ</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šæ¶æ„çš„æ¨¡æ‹Ÿå™¨ï¼Œå¹¶åˆ†é…å†…å­˜ç”¨äºåŠ è½½ SO å’Œå †æ ˆã€‚</p>
<pre><code class="language-python">from unicorn import *
from unicorn.arm64_const import *

# Initialize ARM64 æ¨¡æ‹Ÿå™¨
mu = Uc(UC_ARCH_ARM64, UC_MODE_ARM)

# DefineMemoryåŒºåŸŸ
BASE_ADDRESS = 0x40000000
STACK_ADDRESS = 0x70000000
STACK_SIZE = 1024 * 1024 # 1MB Stack

# MapMemory
mu.mem_map(BASE_ADDRESS, 2 * 1024 * 1024) # 2MB for SO
mu.mem_map(STACK_ADDRESS, STACK_SIZE)

# SetStackæŒ‡é’ˆ (SP)
mu.reg_write(UC_ARM64_REG_SP, STACK_ADDRESS + STACK_SIZE)

</code></pre>
<p>def load_so(mu, so_path):
with open(so_path, 'rb') as f:
elffile = ELFFile(f)
for segment in elffile.iter_segments():
if segment.header.p_type == 'PT_LOAD':
vaddr = segment.header.p_vaddr
mem_size = segment.header.p_memsz
file_size = segment.header.p_filesz
data = segment.data()</p>
<h1>å°†æ®µå†™å…¥æ¨¡æ‹Ÿå™¨å†…å­˜</h1>
<p>mu.mem_write(BASE_ADDRESS + vaddr, data)
print(f&quot;Loaded segment at {hex(BASE_ADDRESS + vaddr)} size {hex(mem_size)}&quot;)
return BASE_ADDRESS</p>
<h1>...</h1>
<h1>load_so(mu, 'libnative-lib.so')</h1>
<pre><code># æ¨¡æ‹Ÿå¤–éƒ¨å‡½æ•°åœ°å€
MOCK_PUTS_ADDR = 0xFFFFFFFF00001000

# è®°å½•è¢« Hook çš„æŒ‡ä»¤ï¼Œé˜²æ­¢é‡å¤å¤„ç†
hooked_instructions = set()

def hook_code(mu, address, size, user_data):
# OnlyProcessè·³è½¬æŒ‡ä»¤
if address in hooked_instructions:
return

instruction = mu.mem_read(address, size)
# ç®€åŒ– BL æŒ‡ä»¤Check
if instruction[3] == 0x94: # BL instruction in ARM64
# è®¡ç®—è·³è½¬ç›®æ ‡åœ°å€ (ç®€åŒ–)
# å®é™…éœ€è¦å®Œæ•´è§£ç æŒ‡ä»¤
target_addr = ...

if target_addr == MOCK_PUTS_ADDR:
# 1. ReadParameter (ARM64Inç¬¬ä¸€Parameterin/at X0 å¯„å­˜å™¨)
str_ptr = mu.reg_read(UC_ARM64_REG_X0)
# 2. ä»æ¨¡æ‹Ÿå™¨MemoryInReadString
str_val = mu.mem_read(str_ptr, 50).split(b'\x00')[0]
# 3. Execute Mock åŠŸèƒ½
print(f&quot;[+] puts called with: '{str_val.decode()}'&quot;)
# 4. æ¨¡æ‹ŸFunctionReturnï¼ŒSetReturnAddress (LR) åˆ° PC
mu.reg_write(UC_ARM64_REG_PC, mu.reg_read(UC_ARM64_REG_LR))
else:
print(f&quot;Warning: Unhandled call to {hex(target_addr)}&quot;)

hooked_instructions.add(address)

# in/atæ•´ SO LoadåŒºåŸŸSet Hook
mu.hook_add(UC_HOOK_CODE, hook_code, begin=BASE_ADDRESS, end=BASE_ADDRESS + 0x100000) # Adjust size

</code></pre>
<ul>
<li><p><strong>Mock <code>fopen</code></strong>: åœ¨ Hook ä¸­ï¼Œå½“ä½ è¯†åˆ«å‡ºå¯¹ <code>fopen</code> çš„è°ƒç”¨æ—¶ï¼Œä½ çš„ Python Mock å‡½æ•°ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªè·¯å¾„å‚æ•°ï¼ˆå¦‚ <code>/data/local/tmp/config.txt</code>ï¼‰ã€‚ä½ çš„ Mock å‡½æ•°é€»è¾‘å°±æ˜¯å°†è¿™ä¸ªæ¨¡æ‹Ÿå™¨å†…çš„è·¯å¾„æ‹¼æ¥ä¸Šä½ çš„ PC Rootfs è·¯å¾„ (<code>./my_rootfs</code> + <code>/data/local/tmp/config.txt</code>)ï¼Œç„¶åç”¨ Python çš„ <code>open()</code> å‡½æ•°æ‰“å¼€çœŸå®æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„æ¨¡æ‹Ÿå€¼ç»™ SOã€‚</p>
</li>
<li><p><strong>Mock <code>fread</code>/<code>fwrite</code></strong>: åç»­å¯¹ <code>fread</code> çš„è°ƒç”¨ï¼Œéƒ½ä¼šæ ¹æ®æ¨¡æ‹Ÿçš„æ–‡ä»¶å¥æŸ„ï¼Œåœ¨ä½ çš„ Python Mock å‡½æ•°ä¸­æ“ä½œå¯¹åº”çš„çœŸå®æ–‡ä»¶ã€‚</p>
</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥å®Œå…¨æ§åˆ¶ SO çš„æ–‡ä»¶è®¿é—®ï¼Œä¸ºå…¶æä¾›å®šåˆ¶çš„è¾“å…¥æˆ–è®°å½•å…¶è¾“å‡ºã€‚</p>
<h2>åŸºäº <code>chroot</code> ä¸ <code>linker</code> çš„é«˜çº§ä»¿çœŸ (C è¯­è¨€)</h2>
<p>è¿™æ˜¯æœ€æ¥è¿‘&quot;çœŸå®&quot;çš„ä»¿çœŸæ–¹å¼ã€‚æˆ‘ä»¬ä¸å†ç”¨ <code>pyelftools</code> å»æ¨¡æ‹Ÿ ELF åŠ è½½ï¼Œè€Œæ˜¯ç›´æ¥åˆ©ç”¨ä» Android ç³»ç»Ÿä¸­æå–å‡ºçš„ <code>linker64</code> ç¨‹åºï¼Œè®©å®ƒåœ¨ä¸€ä¸ªå—æ§çš„ <code>chroot</code> ç¯å¢ƒä¸­ä¸ºæˆ‘ä»¬åŠ è½½ç›®æ ‡ SOã€‚</p>
<h2># 1. æ ¸å¿ƒæ€è·¯</h2>
<ol>
<li><strong>æ„å»º Android Rootfs</strong>: åœ¨ Linux ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªæœ€å°åŒ–çš„ Android æ–‡ä»¶ç³»ç»Ÿã€‚</li>
<li><strong>ç¼–å†™åŠ è½½å™¨ (Loader)</strong>: ç”¨ C ç¼–å†™ä¸€ä¸ªåŠ è½½å™¨ç¨‹åºï¼Œå®ƒçš„å”¯ä¸€ä½¿å‘½å°±æ˜¯ <code>chroot</code> åˆ°æˆ‘ä»¬æ„å»ºçš„ Rootfs ä¸­ï¼Œç„¶åé€šè¿‡ <code>execve</code> å¯åŠ¨ <code>linker64</code>ã€‚</li>
<li><strong>ç¼–å†™æµ‹è¯•æ¡© (Test Harness)</strong>: ç”±äº <code>linker64</code> éœ€è¦æ‰§è¡Œä¸€ä¸ªå¸¦æœ‰ <code>main</code> å‡½æ•°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª&quot;æµ‹è¯•æ¡©&quot;ç¨‹åºã€‚å®ƒçš„å”¯ä¸€ä½œç”¨å°±æ˜¯åŠ è½½ç›®æ ‡ SOï¼Œè°ƒç”¨æŒ‡å®šå‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœã€‚</li>
</ol>
<h2># 2. å®ç°æ­¥éª¤</h2>
<h3># a. å‡†å¤‡ android Rootfs</h3>
<p>åœ¨ä½ çš„ Linux ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚ <code>~/android_rootfs/</code>ï¼Œå¹¶ä»¿ç…§çœŸå®è®¾å¤‡åˆ›å»ºç›®å½•ç»“æ„ã€‚ç„¶åä»ä¸€ä¸ªçœŸå®çš„ Android è®¾å¤‡ï¼ˆæˆ– AOSP ç¼–è¯‘äº§ç‰©ï¼‰ä¸­ <code>adb pull</code> å‡ºå¿…è¦çš„ç³»ç»Ÿæ–‡ä»¶ï¼š</p>
<pre><code class="language-bash"># in/atä½  PC ä¸Š
mkdir -p ~/android_rootfs/system/lib64
mkdir -p ~/android_rootfs/system/bin
mkdir -p ~/android_rootfs/data/local/tmp

# ä»è®¾å¤‡ä¸Šæ‹‰å–æ–‡ä»¶ (ä»¥ arm64 ä¸ºä¾‹)
adb pull /system/bin/linker64 ~/android_rootfs/system/bin/
adb pull /system/lib64/libc.so ~/android_rootfs/system/lib64/
adb pull /system/lib64/libdl.so ~/android_rootfs/system/lib64/
adb pull /system/lib64/libm.so ~/android_rootfs/system/lib64/

# ... ä»¥åŠTargetSOå¯èƒ½ä¾èµ–å…¶ä»–Library

# å°†ä½ çš„ç›®æ ‡ SO å’Œæµ‹è¯•æ¡©ç¨‹åºä¹Ÿæ”¾è¿›å»
cp your_target.so ~/android_rootfs/data/local/tmp/
cp your_harness ~/android_rootfs/data/local/tmp/

</code></pre>
<h1>include &lt;dlfcn.h&gt;</h1>
<p>// False è®¾ TargetSO æœ‰ä¸€ ExportFunction: char* process_data(const char* input);
typedef const char* (<em>process_data_func)(const char\</em>);</p>
<p>int main(int argc, char *<em>argv) {
// in/at chroot ç¯å¢ƒ Inï¼ŒPathis ç›¸å¯¹äºæ–°æ ¹ Directory
void</em> handle = dlopen(&quot;/data/local/tmp/your_target.so&quot;, RTLD_LAZY);
if (!handle) {
fprintf(stderr, &quot;Cannot open library: %s\n&quot;, dlerror());
return -1;
}</p>
<p>// GetFunction æŒ‡é’ˆ
process_data_func func = (process_data_func)dlsym(handle, &quot;process_data&quot;);
if (!func) {
fprintf(stderr, &quot;Cannot find symbol: %s\n&quot;, dlerror());
dlclose(handle);
return -1;
}</p>
<p>// CallFunction å¹¶ PrintResult
const char* input = &quot;hello from harness&quot;;
const char* result = func(input);
printf(&quot;Result from SO: %s\n&quot;, result);</p>
<p>dlclose(handle);
return 0;
}</p>
<pre><code>
</code></pre>
<h1>include &lt;unistd.h&gt;</h1>
<h1>include &lt;stdlib.h&gt;</h1>
<p>int main(int argc, char *<em>argv) {
const char</em> root_dir = &quot;/home/user/android_rootfs&quot;; // Modify ä¸ºä½  rootfs Path</p>
<p>if (chroot(root_dir) != 0) {
perror(&quot;chroot failed&quot;);
return 1;
}</p>
<p>// è¿›å…¥ chroot Afterï¼Œ'/' å°± is ä¹‹ Before root_dir
chdir(&quot;/&quot;);</p>
<p>// å‡†å¤‡ execve Parameter
char *new_argv[] = {
&quot;/data/local/tmp/harness&quot;, // è¦ ExecuteProgram
NULL
};
char *new_envp[] = {
&quot;LD_LIBRARY_PATH=/system/lib64&quot;, // å‘Šè¯‰ linker in/atWhere æ‰¾ .so
NULL
};</p>
<p>// ä½¿ç”¨ linker64 æ¥æ‰§è¡Œæˆ‘ä»¬çš„æµ‹è¯•æ¡©ç¨‹åº
// linker64 ä¼š Process harness AllLoadand é“¾æ¥å·¥ä½œ
execve(&quot;/system/bin/linker64&quot;, new_argv, new_envp);</p>
<p>// å¦‚æœ execve æˆåŠŸï¼Œè¿™è¡Œä»£ç æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ
perror(&quot;execve failed&quot;);
return 1;
}</p>
<pre><code>| **Python + Unicorn** | çµæ´»ï¼Œå¯å®šåˆ¶æ€§å¼ºï¼Œå¯å®Œå…¨æ§åˆ¶æ‰§è¡Œæµç¨‹å’Œå†…å­˜å¸ƒå±€ï¼Œè·¨å¹³å°ã€‚å¸®åŠ©æ·±å…¥ç†è§£åŸç†ã€‚ | **ä¸­** | çº¯ Native ç®—æ³•é€†å‘ã€å®‰å…¨ç ”ç©¶ã€Fuzzingã€å­¦ä¹  ELF åŠ è½½å’Œ CPU ä»¿çœŸã€æ— å¤æ‚ç³»ç»Ÿæˆ– JNI ä¾èµ–çš„å‡½æ•°ã€‚ |
| **C + chroot + Test Harness** | ä¿çœŸåº¦æœ€é«˜ï¼Œæ€§èƒ½æœ€å¥½ï¼Œç›´æ¥åˆ©ç”¨ç³»ç»ŸåŸç”Ÿ `linker` å’Œåº“ï¼Œç¯å¢ƒä¸çœŸæœºå‡ ä¹ä¸€è‡´ã€‚ | **é«˜** | å¯¹è¿è¡Œç¯å¢ƒè¦æ±‚è‹›åˆ»çš„ SOã€éœ€è¦ TLS åˆå§‹åŒ–æˆ–æœ‰å¤æ‚ä¾èµ–çš„åœºæ™¯ã€è¿½æ±‚æè‡´çš„æ‰§è¡Œæ€§èƒ½ã€‚ |

## æ€»ç»“

SO è¿è¡Œæ—¶ä»¿çœŸæ˜¯ä¸€é¡¹é«˜çº§ä½†å›æŠ¥å·¨å¤§çš„æŠ€æœ¯ã€‚å®ƒå°†é€†å‘åˆ†æä»ç¹ççš„æ‰‹å·¥è°ƒè¯•å’Œ Hook ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¸¦å…¥äº†è‡ªåŠ¨åŒ–ã€å¯å¤§è§„æ¨¡æ‰©å±•çš„æ–°é˜¶æ®µã€‚å¯¹äºéœ€è¦é¢‘ç¹è°ƒç”¨ Native å‡½æ•°ã€åˆ†æå¤æ‚ç®—æ³•çš„åœºæ™¯ï¼ŒæŒæ¡å¦‚ `unidbg` è¿™æ ·çš„ä»¿çœŸæ¡†æ¶æ˜¯å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚

* **é€šä¿¡å›°éš¾**: ä¸»æœºä¸è¢«ä»¿çœŸè¿›ç¨‹çš„é€šä¿¡éœ€è¦å€ŸåŠ©æ–‡ä»¶ã€ç®¡é“æˆ– Socket ç­‰ IPC æœºåˆ¶ï¼Œä¸å¦‚ `unidbg` çš„ API è°ƒç”¨æ–¹ä¾¿ã€‚

* **æƒé™è¦æ±‚**: `chroot` æ“ä½œéœ€è¦ root æƒé™ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-74">
                                                <h2>74. Frameworks & Middleware</h2>
                                                <h1>å·¥ç¨‹åŒ–ï¼šæ¡†æ¶ã€å·¥å…·ä¸ä¸­é—´ä»¶</h1>
<p>åœ¨å¤æ‚çš„é€†å‘å·¥ç¨‹å’Œæ•°æ®é‡‡é›†ä¸­ï¼Œå•çº¯ä¾é åŸºç¡€å·¥å…·å¾€å¾€æ•ˆç‡ä½ä¸‹ã€‚ä¸ºäº†å¤„ç†å¤§è§„æ¨¡çš„ä»»åŠ¡ã€ç®¡ç†å¤æ‚çš„ä¾èµ–å’Œä¿è¯æµç¨‹çš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥â€œå·¥ç¨‹åŒ–â€çš„æ€ç»´ï¼Œåˆ©ç”¨æˆç†Ÿçš„æ¡†æ¶å’Œä¸­é—´ä»¶æ¥æ„å»ºå¥å£®ã€å¯æ‰©å±•çš„åˆ†æç³»ç»Ÿã€‚</p>
<p>æœ¬èŠ‚å†…å®¹å°†èšç„¦äºé‚£äº›èƒ½å°†å•ä¸ªè„šæœ¬æå‡ä¸ºå·¥ä¸šçº§è§£å†³æ–¹æ¡ˆçš„å…³é”®æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p><strong>æ¶ˆæ¯é˜Ÿåˆ— (Message Queues)</strong>: å¦‚ RabbitMQï¼Œç”¨äºè§£è€¦ä»»åŠ¡çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œå®ç°å¼‚æ­¥å¤„ç†å’Œå‰Šå³°å¡«è°·ã€‚</p>
</li>
<li><p><strong>æ•°æ®å­˜å‚¨ (Data Storage)</strong>: å¦‚ MongoDB æˆ– PostgreSQLï¼Œç”¨äºç»“æ„åŒ–åœ°å­˜å‚¨åˆ†æç»“æœï¼Œæ–¹ä¾¿åç»­çš„æŸ¥è¯¢å’ŒäºŒæ¬¡å¼€å‘ã€‚</p>
</li>
<li><p><strong>ç¼“å­˜ç³»ç»Ÿ (Caching Systems)</strong>: å¦‚ Redisï¼Œç”¨äºç¼“å­˜å¸¸ç”¨æ•°æ®ï¼ŒåŠ é€Ÿçƒ­ç‚¹è·¯å¾„çš„è®¿é—®ã€‚</p>
</li>
<li><p><strong>çˆ¬è™«æ¡†æ¶ (Crawling Frameworks)</strong>: å¦‚ Scrapyï¼Œæä¾›äº†ä¸€æ•´å¥—ç”¨äºç½‘ç»œæ•°æ®æå–çš„æ¶æ„ï¼ŒåŒ…æ‹¬è¯·æ±‚è°ƒåº¦ã€ä¸­é—´ä»¶å¤„ç†å’Œæ•°æ®ç®¡é“ã€‚</p>
</li>
</ul>
<p>é€šè¿‡ç»„åˆè¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ­å»ºèµ·ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†æµ·é‡è®¾å¤‡ã€æ‰§è¡Œå¤æ‚ä»»åŠ¡å¹¶é«˜æ•ˆå­˜å‚¨ç»“æœçš„å¼ºå¤§å¹³å°ã€‚</p>

                                            </div>
                                            
                                            <div class="section" id="section-75">
                                                <h2>75. Message Queues</h2>
                                                <hr />
<h1>å·¥ç¨‹åŒ–ï¼šæ¶ˆæ¯é˜Ÿåˆ— (Message Queue)</h1>
<h2>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”¨äºæœåŠ¡é—´å¼‚æ­¥é€šä¿¡çš„æ ¸å¿ƒç»„ä»¶ã€‚åœ¨è§„æ¨¡åŒ–çš„é€†å‘åˆ†æå’Œæ•°æ®é‡‡é›†ä¸­ï¼Œå®ƒæ‰®æ¼”ç€&quot;ç¼“å†²æ± &quot;å’Œ&quot;è§£è€¦å™¨&quot;çš„å…³é”®è§’è‰²ï¼Œç¡®ä¿æ•°æ®æµçš„ç¨³å®šã€é«˜æ•ˆå’Œå¯é ã€‚</h2>
<h2>1. æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨</h2>
<h3>a) ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h3>
<p>æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼šä½ æœ‰ 100 å°çˆ¬è™«èŠ‚ç‚¹ï¼ˆç”Ÿäº§è€…ï¼‰åœ¨é«˜é€ŸæŠ“å–æ•°æ®ï¼ŒåŒæ—¶æœ‰ 10 ä¸ªæ•°æ®å¤„ç†èŠ‚ç‚¹ï¼ˆæ¶ˆè´¹è€…ï¼‰è´Ÿè´£æ¸…æ´—å’Œå…¥åº“ã€‚å¦‚æœè®©ç”Ÿäº§è€…ç›´æ¥è°ƒç”¨æ¶ˆè´¹è€…çš„ APIï¼Œä¼šäº§ç”Ÿå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><strong>æ€§èƒ½è€¦åˆ</strong>: æ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦ä¼šç›´æ¥é™åˆ¶ç”Ÿäº§è€…çš„æŠ“å–é€Ÿåº¦ã€‚å¦‚æœæ•°æ®åº“å†™å…¥ç¼“æ…¢ï¼Œæ•´ä¸ªçˆ¬è™«é›†ç¾¤éƒ½å¾—ç­‰ã€‚</li>
<li><strong>å³°å€¼å‹åŠ›</strong>: å¦‚æœçŸ­æ—¶é—´å†…æŠ“å–åˆ°å¤§é‡æ•°æ®ï¼ˆæµé‡æ´ªå³°ï¼‰ï¼Œå¯èƒ½ä¼šç¬é—´å‹å®æ¶ˆè´¹è€…æœåŠ¡ã€‚</li>
<li><strong>æœåŠ¡ä¾èµ–</strong>: å¦‚æœæ¶ˆè´¹è€…æœåŠ¡å®•æœºï¼Œæ‰€æœ‰ç”Ÿäº§è€…éƒ½ä¼šå¤±è´¥ï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚</li>
</ul>
<h3>b) æ¶ˆæ¯é˜Ÿåˆ—çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>MQ åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´å¢åŠ äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œè§£å†³äº†ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼š</p>
<ul>
<li><strong>å¼‚æ­¥è§£è€¦</strong>: ç”Ÿäº§è€…åªéœ€å°†æ¶ˆæ¯ï¼ˆå¦‚&quot;ä¸€ä¸ªå¾…å¤„ç†çš„æ•°æ®åŒ…&quot;ï¼‰æ‰”è¿›é˜Ÿåˆ—å³å¯ï¼Œæ— éœ€å…³å¿ƒè°åœ¨æ¶ˆè´¹ã€ä½•æ—¶æ¶ˆè´¹ã€‚</li>
<li><strong>å‰Šå³°å¡«è°·</strong>: æµé‡æ´ªå³°åˆ°æ¥æ—¶ï¼Œæ¶ˆæ¯ä¼šå…ˆåœ¨é˜Ÿåˆ—ä¸­ç§¯å‹ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„èŠ‚å¥å¹³ç¨³åœ°è¿›è¡Œå¤„ç†ï¼Œé¿å…äº†ç³»ç»Ÿå´©æºƒã€‚</li>
<li><strong>å¯é æ€§ä¸å†—ä½™</strong>: å³ä½¿æ¶ˆè´¹è€…å®•æœºï¼Œæ¶ˆæ¯ä»ç„¶å®‰å…¨åœ°å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚å½“æ¶ˆè´¹è€…æ¢å¤åï¼Œå¯ä»¥ç»§ç»­å¤„ç†ï¼Œä¿è¯äº†æ•°æ®ä¸ä¸¢å¤±ã€‚</li>
</ul>
<hr />
<h2>2. ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ</h2>
<h3>a) Kafka</h3>
<ul>
<li><strong>å®šä½</strong>: ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€åˆ†åŒºçš„ã€å¤šå‰¯æœ¬çš„ã€åŸºäº Zookeeper çš„<strong>æ—¥å¿—æäº¤ç³»ç»Ÿ (Commit Log)</strong>ã€‚</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:<ul>
<li><strong>æè‡´çš„ååé‡</strong>: è®¾è®¡ç›®æ ‡å°±æ˜¯ä¸ºäº†å¤„ç†æµ·é‡æ—¥å¿—æ•°æ®ï¼Œæ‹¥æœ‰æ— ä¸ä¼¦æ¯”çš„å†™å…¥å’Œè¯»å–æ€§èƒ½ï¼Œæ˜¯å¤§æ•°æ®é¢†åŸŸçš„é¦–é€‰ã€‚</li>
<li><strong>å‘å¸ƒ-è®¢é˜…æ¨¡å‹</strong>: æ¶ˆæ¯ä»¥&quot;ä¸»é¢˜ (Topic)&quot;è¿›è¡Œåˆ†ç±»ã€‚ç”Ÿäº§è€…å‘ä¸€ä¸ª Topic å‘é€æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ç»„ (Consumer Group) å¯ä»¥ç‹¬ç«‹åœ°è®¢é˜…å’Œæ¶ˆè´¹åŒä¸€ä¸ª Topic çš„æ¶ˆæ¯ï¼Œäº’ä¸å¹²æ‰°ã€‚</li>
<li><strong>æŒä¹…åŒ–ä¸å›æº¯</strong>: æ¶ˆæ¯åœ¨ Kafka ä¸­æ˜¯æŒä¹…åŒ–å­˜å‚¨çš„ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®éœ€è¦&quot;å›æº¯&quot;åˆ°ä»»æ„æ—¶é—´ç‚¹ï¼ˆOffsetï¼‰é‡æ–°æ¶ˆè´¹æ•°æ®ï¼Œè¿™å¯¹äºæ•°æ®é‡å¤„ç†å’Œæ•…éšœæ¢å¤éå¸¸æœ‰ç”¨ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul>
<li>éœ€è¦å¤„ç†æµ·é‡æ•°æ®æµçš„æ—¥å¿—æ”¶é›†ï¼ˆLog Ingestionï¼‰ã€‚</li>
<li>ä½œä¸º Spark Streaming æˆ– Flink ç­‰å®æ—¶è®¡ç®—æ¡†æ¶çš„æ•°æ®æºã€‚</li>
<li>æ„å»ºå¤§è§„æ¨¡æ•°æ®ç®¡é“çš„æ€»çº¿ã€‚</li>
</ul>
</li>
</ul>
<h3>b) RabbitMQ</h3>
<ul>
<li><strong>å®šä½</strong>: ä¸€ä¸ªå®ç°äº† AMQP (é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) çš„ã€åŠŸèƒ½ä¸°å¯Œçš„<strong>æ¶ˆæ¯ä»£ç† (Message Broker)</strong>ã€‚</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:<ul>
<li><strong>çµæ´»çš„è·¯ç”±</strong>: æ‹¥æœ‰å¼ºå¤§çš„äº¤æ¢æœº (Exchange) å’Œè·¯ç”±é”® (Routing Key) æœºåˆ¶ï¼Œå¯ä»¥å®ç°éå¸¸å¤æ‚çš„è·¯ç”±é€»è¾‘ï¼ˆå¦‚ fanout, direct, topic, headersï¼‰ã€‚</li>
<li><strong>åŠŸèƒ½å…¨é¢</strong>: æ”¯æŒæ¶ˆæ¯ç¡®è®¤ã€ä¼˜å…ˆçº§é˜Ÿåˆ—ã€å»¶è¿Ÿé˜Ÿåˆ—ã€æ­»ä¿¡é˜Ÿåˆ—ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚</li>
<li><strong>å¯é æ€§</strong>: æä¾›äº†å¼ºå¤§çš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œèƒ½ç¡®ä¿æ¶ˆæ¯&quot;è‡³å°‘è¢«æˆåŠŸæ¶ˆè´¹ä¸€æ¬¡&quot;ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul>
<li>ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œéœ€è¦ç²¾ç»†åŒ–æ§åˆ¶æ¶ˆæ¯è·¯ç”±çš„åœºæ™¯ã€‚</li>
<li>å¯¹æ¶ˆæ¯æŠ•é€’çš„å¯é æ€§è¦æ±‚æé«˜çš„é‡‘èæˆ–äº‹åŠ¡æ€§ç³»ç»Ÿã€‚</li>
<li>éœ€è¦ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—ç­‰é«˜çº§ç‰¹æ€§çš„ä¸šåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<h3>c) Redis</h3>
<ul>
<li><strong>å®šä½</strong>: ä¸€ä¸ªé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œä½†å…¶ <code>List</code> å’Œ <code>Pub/Sub</code> åŠŸèƒ½ä½¿å…¶å¯ä»¥ä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ã€‚</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:<ul>
<li><strong>ç®€å•å¿«é€Ÿ</strong>: é…ç½®ç®€å•ï¼Œè¯»å†™æ€§èƒ½æé«˜ï¼ˆåŸºäºå†…å­˜ï¼‰ã€‚</li>
<li><strong>åŠŸèƒ½æœ‰é™</strong>: ä¸æ”¯æŒå¤æ‚è·¯ç”±ï¼Œå¯é æ€§ä¿è¯è¾ƒå¼±ï¼ˆå¦‚ <code>Pub/Sub</code> ä¸ä¿è¯æ¶ˆæ¯å¿…è¾¾ï¼‰ï¼Œæ¶ˆæ¯ç§¯å‹èƒ½åŠ›å—å†…å­˜é™åˆ¶ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul>
<li>ç³»ç»Ÿè§„æ¨¡ä¸å¤§ï¼Œå¯¹å¯é æ€§è¦æ±‚ä¸é«˜ï¼Œä½†å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚</li>
<li>ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚ Celery çš„ Brokerï¼‰ã€‚</li>
<li>å®ç°ç®€å•çš„å®æ—¶é€šçŸ¥æˆ–èŠå¤©åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>æ€»ç»“</h2>
<p>åœ¨å·¥ç¨‹åŒ–ä½“ç³»ä¸­ï¼Œé€‰æ‹©å“ªç§ MQ å–å†³äºå…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ï¼š</p>
<ul>
<li>è¿½æ±‚<strong>æè‡´çš„ååé‡å’Œå¤§æ•°æ®ç”Ÿæ€å…¼å®¹æ€§</strong>ï¼Œé€‰æ‹© <code>Kafka</code>ã€‚</li>
<li>è¿½æ±‚<strong>çµæ´»çš„è·¯ç”±å’Œä¸šåŠ¡åŠŸèƒ½çš„ä¸°å¯Œæ€§</strong>ï¼Œé€‰æ‹© <code>RabbitMQ</code>ã€‚</li>
<li>è¿½æ±‚<strong>ç®€å•ã€è½»é‡å’Œæè‡´çš„ä½å»¶è¿Ÿ</strong>ï¼Œ<code>Redis</code> æ˜¯ä¸€ä¸ªä¸é”™çš„å¤‡é€‰é¡¹ã€‚</li>
</ul>
<hr />

                                            </div>
                                            
                                            <div class="section" id="section-76">
                                                <h2>76. Redis</h2>
                                                <h1>Redis å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•</h1>
<h2>Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸºäºå†…å­˜çš„ã€é«˜æ€§èƒ½çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆã€‚æœ¬å¤‡å¿˜å½•æ—¨åœ¨æä¾›å¸¸ç”¨å‘½ä»¤çš„å¿«é€Ÿå‚è€ƒã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><p><a href="#redis-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95">Redis å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•</a></p>
</li>
<li><p><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></p>
</li>
<li><p><a href="#%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86">è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</a></p>
</li>
<li><p><a href="#%E9%94%AE-key-%E6%93%8D%E4%BD%9C">é”® (Key) æ“ä½œ</a></p>
</li>
<li><p><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-string">å­—ç¬¦ä¸² (String)</a></p>
</li>
<li><p><a href="#%E5%93%88%E5%B8%8C-hash">å“ˆå¸Œ (Hash)</a></p>
</li>
<li><p><a href="#%E5%88%97%E8%A1%A8-list">åˆ—è¡¨ (List)</a></p>
</li>
<li><p><a href="#%E9%9B%86%E5%90%88-set">é›†åˆ (Set)</a></p>
</li>
<li><p><a href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88-sorted-set--zset">æœ‰åºé›†åˆ (Sorted Set / ZSet)</a></p>
</li>
<li><p><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></p>
</li>
<li><p><a href="#%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86">è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</a></p>
</li>
<li><p><a href="#%E9%94%AE-key-%E6%93%8D%E4%BD%9C">é”® (Key) æ“ä½œ</a></p>
</li>
<li><p><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-string">å­—ç¬¦ä¸² (String)</a></p>
</li>
<li><p><a href="#%E5%93%88%E5%B8%8C-hash">å“ˆå¸Œ (Hash)</a></p>
</li>
<li><p><a href="#%E5%88%97%E8%A1%A8-list">åˆ—è¡¨ (List)</a></p>
</li>
<li><p><a href="#%E9%9B%86%E5%90%88-set">é›†åˆ (Set)</a></p>
</li>
<li><p><a href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88-sorted-set--zset">æœ‰åºé›†åˆ (Sorted Set / ZSet)</a></p>
</li>
<li><p><a href="#%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86">è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</a></p>
</li>
<li><p><a href="#%E9%94%AE-key-%E6%93%8D%E4%BD%9C">é”® (Key) æ“ä½œ</a></p>
</li>
<li><p><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-string">å­—ç¬¦ä¸² (String)</a></p>
</li>
<li><p><a href="#%E5%93%88%E5%B8%8C-hash">å“ˆå¸Œ (Hash)</a></p>
</li>
<li><p><a href="#%E5%88%97%E8%A1%A8-list">åˆ—è¡¨ (List)</a></p>
</li>
<li><p><a href="#%E9%9B%86%E5%90%88-set">é›†åˆ (Set)</a></p>
</li>
<li><p><a href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88-sorted-set--zset">æœ‰åºé›†åˆ (Sorted Set / ZSet)</a></p>
</li>
</ul>
<hr />
<h2># è¿æ¥ä¸æœåŠ¡å™¨ç®¡ç†</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>redis-cli</code></td>
  <td style="text-align:left">å¯åŠ¨ Redis å‘½ä»¤è¡Œå®¢æˆ·ç«¯</td>
</tr>
<tr>
  <td style="text-align:left"><code>redis-cli -h &lt;host&gt; -p &lt;port&gt; -a &lt;password&gt;</code></td>
  <td style="text-align:left">è¿æ¥åˆ°æŒ‡å®šçš„ Redis å®ä¾‹</td>
</tr>
<tr>
  <td style="text-align:left"><code>PING</code></td>
  <td style="text-align:left">æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦ä»åœ¨è¿è¡Œï¼Œè¿”å› <code>PONG</code></td>
</tr>
<tr>
  <td style="text-align:left"><code>AUTH &lt;password&gt;</code></td>
  <td style="text-align:left">éªŒè¯è¿æ¥å¯†ç </td>
</tr>
<tr>
  <td style="text-align:left"><code>SELECT &lt;index&gt;</code></td>
  <td style="text-align:left">é€‰æ‹©æ•°æ®åº“ (é»˜è®¤ 0-15)</td>
</tr>
<tr>
  <td style="text-align:left"><code>FLUSHDB</code></td>
  <td style="text-align:left">æ¸…ç©ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰é”®</td>
</tr>
<tr>
  <td style="text-align:left"><code>FLUSHALL</code></td>
  <td style="text-align:left">æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰é”®</td>
</tr>
<tr>
  <td style="text-align:left"><code>INFO</code></td>
  <td style="text-align:left">è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®</td>
</tr>
</tbody>
</table>
<hr />
<h2># é”® (Key) æ“ä½œ</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>KEYS &lt;pattern&gt;</code></td>
  <td style="text-align:left">æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼çš„é”® (å¦‚ <code>KEYS *</code>, <code>KEYS user:*</code>) <strong>(æ…ç”¨ï¼Œä¼šé˜»å¡)</strong></td>
</tr>
<tr>
  <td style="text-align:left"><code>SCAN &lt;cursor&gt; [MATCH pattern] [COUNT count]</code></td>
  <td style="text-align:left">è¿­ä»£æ•°æ®åº“ä¸­çš„é”®ï¼Œæ¯” <code>KEYS</code> æ›´å®‰å…¨</td>
</tr>
<tr>
  <td style="text-align:left"><code>EXISTS &lt;key&gt;</code></td>
  <td style="text-align:left">æ£€æŸ¥ç»™å®šé”®æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
  <td style="text-align:left"><code>DEL &lt;key&gt; [key ...]</code></td>
  <td style="text-align:left">åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”®</td>
</tr>
<tr>
  <td style="text-align:left"><code>TYPE &lt;key&gt;</code></td>
  <td style="text-align:left">è¿”å›é”®æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹ (string, hash, list, set, zset)</td>
</tr>
<tr>
  <td style="text-align:left"><code>TTL &lt;key&gt;</code></td>
  <td style="text-align:left">ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›ç»™å®šé”®çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ (Time To Live)</td>
</tr>
<tr>
  <td style="text-align:left"><code>EXPIRE &lt;key&gt; &lt;seconds&gt;</code></td>
  <td style="text-align:left">ä¸ºç»™å®šé”®è®¾ç½®ç”Ÿå­˜æ—¶é—´</td>
</tr>
<tr>
  <td style="text-align:left"><code>PERSIST &lt;key&gt;</code></td>
  <td style="text-align:left">ç§»é™¤ç»™å®šé”®çš„ç”Ÿå­˜æ—¶é—´ï¼Œä½¿å…¶æ°¸ä¹…ä¿å­˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>RENAME &lt;key&gt; &lt;newkey&gt;</code></td>
  <td style="text-align:left">ä¿®æ”¹é”®çš„åç§°</td>
</tr>
</tbody>
</table>
<hr />
<h2># å­—ç¬¦ä¸² (String)</h2>
<p>å­—ç¬¦ä¸²æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå¦‚æ–‡æœ¬ã€åºåˆ—åŒ–çš„ JSON æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>SET &lt;key&gt; &lt;value&gt;</code></td>
  <td style="text-align:left">è®¾ç½®æŒ‡å®šé”®çš„å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>GET &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–æŒ‡å®šé”®çš„å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>SETEX &lt;key&gt; &lt;seconds&gt; &lt;value&gt;</code></td>
  <td style="text-align:left">è®¾ç½®é”®å€¼å¯¹å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´</td>
</tr>
<tr>
  <td style="text-align:left"><code>SETNX &lt;key&gt; &lt;value&gt;</code></td>
  <td style="text-align:left">åªæœ‰åœ¨é”®ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®é”®çš„å€¼ (SET if Not eXists)</td>
</tr>
<tr>
  <td style="text-align:left"><code>MSET &lt;key1&gt; &lt;value1&gt; [key2 value2 ...]</code></td>
  <td style="text-align:left">åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹</td>
</tr>
<tr>
  <td style="text-align:left"><code>MGET &lt;key1&gt; [key2 ...]</code></td>
  <td style="text-align:left">è·å–æ‰€æœ‰ç»™å®šé”®çš„å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>INCR &lt;key&gt;</code></td>
  <td style="text-align:left">å°†é”®ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ (åŸå­æ“ä½œ)</td>
</tr>
<tr>
  <td style="text-align:left"><code>DECR &lt;key&gt;</code></td>
  <td style="text-align:left">å°†é”®ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ (åŸå­æ“ä½œ)</td>
</tr>
<tr>
  <td style="text-align:left"><code>INCRBY &lt;key&gt; &lt;increment&gt;</code></td>
  <td style="text-align:left">å°†é”®æ‰€å‚¨å­˜çš„å€¼åŠ ä¸ŠæŒ‡å®šçš„å¢é‡å€¼</td>
</tr>
</tbody>
</table>
<hr />
<h2># å“ˆå¸Œ (Hash)</h2>
<p>å“ˆå¸Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆï¼Œéå¸¸é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>HSET &lt;key&gt; &lt;field&gt; &lt;value&gt;</code></td>
  <td style="text-align:left">å°†å“ˆå¸Œè¡¨ <code>key</code> ä¸­çš„å­—æ®µ <code>field</code> çš„å€¼è®¾ä¸º <code>value</code></td>
</tr>
<tr>
  <td style="text-align:left"><code>HGET &lt;key&gt; &lt;field&gt;</code></td>
  <td style="text-align:left">è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>HMSET &lt;key&gt; &lt;field1&gt; &lt;value1&gt; [field2 value2 ...]</code></td>
  <td style="text-align:left">åŒæ—¶å°†å¤šä¸ª <code>field-value</code> å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨ä¸­</td>
</tr>
<tr>
  <td style="text-align:left"><code>HMGET &lt;key&gt; &lt;field1&gt; [field2 ...]</code></td>
  <td style="text-align:left">è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>HGETALL &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šé”®çš„æ‰€æœ‰å­—æ®µå’Œå€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>HKEYS &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å­—æ®µ</td>
</tr>
<tr>
  <td style="text-align:left"><code>HVALS &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>HDEL &lt;key&gt; &lt;field1&gt; [field2 ...]</code></td>
  <td style="text-align:left">åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ</td>
</tr>
<tr>
  <td style="text-align:left"><code>HEXISTS &lt;key&gt; &lt;field&gt;</code></td>
  <td style="text-align:left">æŸ¥çœ‹å“ˆå¸Œè¡¨çš„æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</td>
</tr>
</tbody>
</table>
<hr />
<h2># åˆ—è¡¨ (List)</h2>
<p>åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>LPUSH &lt;key&gt; &lt;value1&gt; [value2 ...]</code></td>
  <td style="text-align:left">å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</td>
</tr>
<tr>
  <td style="text-align:left"><code>RPUSH &lt;key&gt; &lt;value1&gt; [value2 ...]</code></td>
  <td style="text-align:left">å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å°¾éƒ¨</td>
</tr>
<tr>
  <td style="text-align:left"><code>LPOP &lt;key&gt;</code></td>
  <td style="text-align:left">ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
  <td style="text-align:left"><code>RPOP &lt;key&gt;</code></td>
  <td style="text-align:left">ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
  <td style="text-align:left"><code>LLEN &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–åˆ—è¡¨çš„é•¿åº¦</td>
</tr>
<tr>
  <td style="text-align:left"><code>LRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt;</code></td>
  <td style="text-align:left">è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´  (-1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ )</td>
</tr>
<tr>
  <td style="text-align:left"><code>LINDEX &lt;key&gt; &lt;index&gt;</code></td>
  <td style="text-align:left">é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </td>
</tr>
<tr>
  <td style="text-align:left"><code>LSET &lt;key&gt; &lt;index&gt; &lt;value&gt;</code></td>
  <td style="text-align:left">é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>LTRIM &lt;key&gt; &lt;start&gt; &lt;stop&gt;</code></td>
  <td style="text-align:left">å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ </td>
</tr>
</tbody>
</table>
<hr />
<h2># é›†åˆ (Set)</h2>
<p>é›†åˆæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„<strong>æ— åº</strong>é›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>SADD &lt;key&gt; &lt;member1&gt; [member2 ...]</code></td>
  <td style="text-align:left">å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>SMEMBERS &lt;key&gt;</code></td>
  <td style="text-align:left">è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>SISMEMBER &lt;key&gt; &lt;member&gt;</code></td>
  <td style="text-align:left">åˆ¤æ–­ <code>member</code> å…ƒç´ æ˜¯å¦æ˜¯é›†åˆçš„æˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>SCARD &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–é›†åˆçš„æˆå‘˜æ•°</td>
</tr>
<tr>
  <td style="text-align:left"><code>SREM &lt;key&gt; &lt;member1&gt; [member2 ...]</code></td>
  <td style="text-align:left">ç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>SPOP &lt;key&gt; [count]</code></td>
  <td style="text-align:left">éšæœºç§»é™¤å¹¶è¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>SUNION &lt;key1&gt; [key2 ...]</code></td>
  <td style="text-align:left">è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†</td>
</tr>
<tr>
  <td style="text-align:left"><code>SINTER &lt;key1&gt; [key2 ...]</code></td>
  <td style="text-align:left">è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„äº¤é›†</td>
</tr>
<tr>
  <td style="text-align:left"><code>SDIFF &lt;key1&gt; [key2 ...]</code></td>
  <td style="text-align:left">è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å·®é›†</td>
</tr>
</tbody>
</table>
<hr />
<h2># æœ‰åºé›†åˆ (Sorted Set / ZSet)</h2>
<p>æœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ª <code>double</code> ç±»å‹çš„<strong>åˆ†æ•° (score)</strong>ã€‚Redis æ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚</p>
<table>
<thead>
<tr>
  <th style="text-align:left">å‘½ä»¤</th>
  <th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>ZADD &lt;key&gt; &lt;score1&gt; &lt;member1&gt; [score2 member2 ...]</code></td>
  <td style="text-align:left">å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES]</code></td>
  <td style="text-align:left">é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆæˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ (æŒ‰åˆ†æ•°å€¼é€’å¢)</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZREVRANGE &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES]</code></td>
  <td style="text-align:left">è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ (æŒ‰åˆ†æ•°å€¼é€’å‡)</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZRANGEBYSCORE &lt;key&gt; &lt;min&gt; &lt;max&gt; [WITHSCORES]</code></td>
  <td style="text-align:left">é€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZCARD &lt;key&gt;</code></td>
  <td style="text-align:left">è·å–æœ‰åºé›†åˆçš„æˆå‘˜æ•°</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZSCORE &lt;key&gt; &lt;member&gt;</code></td>
  <td style="text-align:left">è¿”å›æœ‰åºé›†ä¸­ï¼Œæˆå‘˜çš„ score å€¼</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZREM &lt;key&gt; &lt;member1&gt; [member2 ...]</code></td>
  <td style="text-align:left">ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
  <td style="text-align:left"><code>ZCOUNT &lt;key&gt; &lt;min&gt; &lt;max&gt;</code></td>
  <td style="text-align:left">è®¡ç®—åœ¨æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´çš„æˆå‘˜æ•°</td>
</tr>
</tbody>
</table>
<hr />
<h2>Redis å‘å±•å†ç¨‹ä¸ architecture æ¼”è¿›</h2>
<h2># ç‰ˆæœ¬å‘å±•</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç‰ˆæœ¬</th>
  <th style="text-align:left">å‘å¸ƒæ—¶é—´</th>
  <th style="text-align:left">ä¸»è¦ç‰¹æ€§</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left">Redis 1.0</td>
  <td style="text-align:left">2009 å¹´</td>
  <td style="text-align:left">åŸºç¡€é”®å€¼å­˜å‚¨ï¼Œ5 ç§åŸºæœ¬æ•°æ®ç»“æ„</td>
</tr>
<tr>
  <td style="text-align:left">Redis 2.0</td>
  <td style="text-align:left">2010 å¹´</td>
  <td style="text-align:left">å¼•å…¥è™šæ‹Ÿå†…å­˜ã€å‘å¸ƒè®¢é˜…</td>
</tr>
<tr>
  <td style="text-align:left">Redis 2.2</td>
  <td style="text-align:left">2010 å¹´</td>
  <td style="text-align:left">æŒä¹…åŒ–æ”¹è¿›ã€ä¸»ä»å¤åˆ¶</td>
</tr>
<tr>
  <td style="text-align:left">Redis 2.6</td>
  <td style="text-align:left">2012 å¹´</td>
  <td style="text-align:left">Lua è„šæœ¬æ”¯æŒã€è¿‡æœŸé”®å¤„ç†ä¼˜åŒ–</td>
</tr>
<tr>
  <td style="text-align:left">Redis 2.8</td>
  <td style="text-align:left">2013 å¹´</td>
  <td style="text-align:left">éƒ¨åˆ†é‡åŒæ­¥ã€Sentinel é«˜å¯ç”¨</td>
</tr>
<tr>
  <td style="text-align:left">Redis 3.0</td>
  <td style="text-align:left">2015 å¹´</td>
  <td style="text-align:left"><strong>Redis Cluster é›†ç¾¤æ”¯æŒ</strong></td>
</tr>
<tr>
  <td style="text-align:left">Redis 4.0</td>
  <td style="text-align:left">2017 å¹´</td>
  <td style="text-align:left">æ¨¡å—ç³»ç»Ÿã€å†…å­˜ä¼˜åŒ–ã€æ··åˆæŒä¹…åŒ–</td>
</tr>
<tr>
  <td style="text-align:left">Redis 5.0</td>
  <td style="text-align:left">2018 å¹´</td>
  <td style="text-align:left"><strong>Stream æ•°æ®ç»“æ„</strong>ã€åŠ¨æ€ HZ</td>
</tr>
<tr>
  <td style="text-align:left">Redis 6.0</td>
  <td style="text-align:left">2020 å¹´</td>
  <td style="text-align:left">å¤šçº¿ç¨‹ I/Oã€ACL æƒé™æ§åˆ¶ã€SSL</td>
</tr>
<tr>
  <td style="text-align:left">Redis 7.0</td>
  <td style="text-align:left">2022 å¹´</td>
  <td style="text-align:left">Redis Functionsã€å¤š ACL ç”¨æˆ·ã€Cluster åˆ†ç‰‡</td>
</tr>
</tbody>
</table>
<h2># architecture æ¼”è¿›è·¯å¾„</h2>
<h3># 1. å•æœºæ¨¡å¼ (Single Instance)</h3>
<pre><code>

### 2. ä¸»ä»å¤åˆ¶ (Master-Slave)

</code></pre>
<h3># 3. Sentinel é«˜å¯ç”¨ (Redis Sentinel)</h3>
<pre><code>

### è„‘è£‚é—®é¢˜ (Split-Brain)

* *å®šä¹‰**: è„‘è£‚æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºç½‘ç»œåˆ†åŒºæˆ–èŠ‚ç‚¹æ•…éšœï¼Œå¯¼è‡´ç³»ç»Ÿä¸­å‡ºç°å¤šä¸ª&quot;å¤§è„‘&quot;ï¼ˆå¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºè‡ªå·±æ˜¯ä¸»èŠ‚ç‚¹ï¼‰çš„æƒ…å†µã€‚

* *Redisä¸­çš„è„‘è£‚åœºæ™¯**:

</code></pre>
<p>PartitionB: Sentinel2,3 â†â†’ Slave1 â†â†’ Slave2 (ElectNew master)</p>
<pre><code>

* *Redisè„‘è£‚é¢„é˜²æœºåˆ¶**:

1. **Sentinelå¥‡æ•°éƒ¨ç½²**: ç¡®ä¿æ•…éšœè½¬ç§»æ—¶æœ‰æ˜ç¡®çš„å¤šæ•°æ´¾

```bash
# Recommended configurationï¼šAt least3Sentinel
Sentinel1, Sentinel2, Sentinel3

</code></pre>
<h1>At leastNeed2Slave Nodeï¼Œmaximum delay10Second</h1>
<p>min-slaves-to-write 2
min-slaves-max-lag 10</p>
<pre><code>
sentinel = Sentinel([('localhost', 26379), ('localhost', 26380), ('localhost', 26381)])
master = sentinel.master_for('mymaster', socket_timeout=0.1)

</code></pre>
<h3># 4. é›†ç¾¤æ¨¡å¼ (Redis Cluster)</h3>
<pre><code>---
## Redis é›†ç¾¤è¯¦è§£

## # Sentinel æ¨¡å¼

### æ ¸å¿ƒåŠŸèƒ½
1. **ç›‘æ§ (Monitoring)**: ç›‘æ§masterå’Œslaveå¥åº·çŠ¶æ€
2. **é€šçŸ¥ (Notification)**: æ•…éšœæ—¶é€šçŸ¥ç®¡ç†å‘˜
3. **è‡ªåŠ¨æ•…éšœè½¬ç§» (Automatic Failover)**: è‡ªåŠ¨é€‰ä¸¾æ–°master
4. **é…ç½®æä¾› (Configuration Provider)**: ä¸ºå®¢æˆ·ç«¯æä¾›å½“å‰masteråœ°å€


### å·¥ä½œåŸç†

```bash
# SentinelConfigFile
sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 30000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 180000

</code></pre>
<ol start="4">
<li><strong>æ–°ä¸»é€‰æ‹©</strong>: é€‰æ‹©æœ€ä¼˜ slave æå‡ä¸º master</li>
<li><strong>é…ç½®æ›´æ–°</strong>: æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹é…ç½®</li>
</ol>
<h2># Cluster é›†ç¾¤æ¨¡å¼</h2>
<h3># é›†ç¾¤ç‰¹æ€§</h3>
<ul>
<li><p><strong>å»ä¸­å¿ƒåŒ–</strong>: æ— å•ç‚¹æ•…éšœ</p>
</li>
<li><p><strong>æ•°æ®åˆ†ç‰‡</strong>: è‡ªåŠ¨æ•°æ®åˆ†å¸ƒ</p>
</li>
<li><p><strong>é«˜å¯ç”¨</strong>: master æ•…éšœè‡ªåŠ¨åˆ‡æ¢</p>
</li>
<li><p><strong>åœ¨çº¿æ‰©ç¼©å®¹</strong>: æ”¯æŒåŠ¨æ€æ·»åŠ /åˆ é™¤èŠ‚ç‚¹</p>
</li>
</ul>
<h3># æ•°æ®åˆ†ç‰‡ç®—æ³•</h3>
<pre><code class="language-bash"># CalculateKeyå“ˆå¸ŒSlot
HASH_SLOT = CRC16(key) % 16384

# SlotAllocationExampleï¼ˆ3Master Nodeï¼‰
Master1: 0-5461 (5462Slot)
Master2: 5462-10923 (5462Slot)
Master3: 10924-16383 (5460Slot)

</code></pre>
<ol start="127">
<li>0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \</li>
</ol>
<ul>
<li>-cluster-replicas 1</li>
</ul>
<h1>ViewClusterInformation</h1>
<p>CLUSTER INFO
CLUSTER NODES</p>
<h1>Re-Sharding</h1>
<p>redis-cli --cluster reshard 127.0.0.1:7000</p>
<h1>AddNode</h1>
<p>redis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000</p>
<pre><code>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ¦‚ç‡æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **è¯¯æŠ¥ç‡**: å¯èƒ½è¯¯åˆ¤å­˜åœ¨ï¼Œä½†ä¸ä¼šè¯¯åˆ¤ä¸å­˜åœ¨


- **ç©ºé—´æ•ˆç‡**: ä½¿ç”¨ä½æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦ä½


- **æ—¶é—´å¤æ‚åº¦**: O(k) æŸ¥è¯¢æ—¶é—´ï¼Œkä¸ºå“ˆå¸Œå‡½æ•°æ•°é‡


### å®ç°åŸç†

```python
# åŸºæœ¬æµç¨‹
1. Initialize: Createmä½ä½Arrayï¼Œkå“ˆå¸ŒFunction
2. æ·»åŠ å…ƒç´ : å¯¹å…ƒç´ è®¡ç®— k ä¸ªå“ˆå¸Œå€¼ï¼Œè®¾ç½®å¯¹åº”ä½ä¸º1
3. Queryå…ƒç´ : Calculatekå“ˆå¸ŒValueï¼ŒCheckå¯¹åº”ä½isNoéƒ½ä¸º1

</code></pre>
<h1>æœ€ä¼˜ä½æ•°ç»„å¤§å°</h1>
<p>m = -n * ln(p) / (ln(2))^2</p>
<h1>æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡</h1>
<p>k = (m/n) * ln(2)</p>
<h1>å…¶ä¸­ï¼šn=å…ƒç´ æ•°é‡ï¼Œp=è¯¯æŠ¥ç‡ï¼Œm=ä½æ•°ç»„å¤§å°ï¼Œk=å“ˆå¸Œå‡½æ•°æ•°é‡</h1>
<pre><code>
```bash
# åŠ è½½ RedisBloom æ¨¡å—
MODULE LOAD /path/to/redisbloom.so

</code></pre>
<h1>æ·»åŠ å…ƒç´ </h1>
<p>BF.ADD myfilter &quot;user123&quot;
BF.MADD myfilter &quot;user1&quot; &quot;user2&quot; &quot;user3&quot;</p>
<h1>æ£€æŸ¥å…ƒç´ </h1>
<p>BF.EXISTS myfilter &quot;user123&quot;
BF.MEXISTS myfilter &quot;user1&quot; &quot;user2&quot;</p>
<h1>GetInformation</h1>
<p>BF.INFO myfilter</p>
<pre><code>4. **æ¨èç³»ç»Ÿ**: å·²æ¨èå†…å®¹è¿‡æ»¤
---
## Stream æµæ•°æ®ç»“æ„

## # åŸºæœ¬æ¦‚å¿µ

Streamæ˜¯Redis 5.0å¼•å…¥çš„æ–°æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶æµå¤„ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **æŒä¹…åŒ–æ¶ˆæ¯é˜Ÿåˆ—**: æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨


- **æ¶ˆè´¹è€…ç»„**: æ”¯æŒå¤šæ¶ˆè´¹è€…åä½œ


- **æ¶ˆæ¯ç¡®è®¤**: æ”¯æŒæ¶ˆæ¯ç¡®è®¤æœºåˆ¶


- **å†å²æ¶ˆæ¯**: å¯ä»¥æŸ¥è¯¢å†å²æ¶ˆæ¯


### æ¶ˆæ¯IDç»“æ„

</code></pre>
<h1>æ·»åŠ æ¶ˆæ¯</h1>
<p>XADD mystream * field1 value1 field2 value2
XADD mystream 1609459200000-0 user &quot;john&quot; action &quot;login&quot;</p>
<h1>è¯»å–æ¶ˆæ¯</h1>
<p>XREAD COUNT 2 STREAMS mystream 0
XREAD BLOCK 1000 STREAMS mystream $ # é˜»å¡è¯»å–æ–°æ¶ˆæ¯</p>
<h1>ViewStreamInformation</h1>
<p>XINFO STREAM mystream
XLEN mystream</p>
<h1>èŒƒå›´æŸ¥è¯¢</h1>
<p>XRANGE mystream - +
XRANGE mystream 1609459200000 1609459300000</p>
<pre><code>
# æ¶ˆè´¹è€…è¯»å–
XREADGROUP GROUP mygroup consumer1 COUNT 1 STREAMS mystream &gt;

# ç¡®è®¤æ¶ˆæ¯
XACK mystream mygroup 1609459200000-0

# æŸ¥çœ‹æ¶ˆè´¹è€…ç»„ä¿¡æ¯
XINFO GROUPS mystream
XINFO CONSUMERS mystream mygroup

# å¤„ç† pending æ¶ˆæ¯
XPENDING mystream mygroup
XCLAIM mystream mygroup consumer2 1800000 1609459200000-0

</code></pre>
<h1>ä¿®å‰ª Stream</h1>
<p>XTRIM mystream MAXLEN 1000
XTRIM mystream MAXLEN ~ 1000 # è¿‘ä¼¼ä¿®å‰ªï¼ŒPerformance æ›´å¥½</p>
<pre><code>| å¤šæ¶ˆè´¹è€… | âŒ | âœ… | âœ… |
| æ¶ˆæ¯ç¡®è®¤ | âŒ | âŒ | âœ… |
| å†å²æ¶ˆæ¯ | âœ… | âŒ | âœ… |
| æ¶ˆè´¹è€…ç»„ | âŒ | âŒ | âœ… |
---
## é¢è¯•é«˜é¢‘è€ƒç‚¹

## # æŒä¹…åŒ–æœºåˆ¶

### RDB (Redis Database)

```bash
# ConfigFileSet
save 900 1 # 900seconds with at least1keyå˜åŒ–
save 300 10 # 300seconds with at least10keyå˜åŒ–
save 60 10000 # 60seconds with at least10000keyå˜åŒ–

# æ‰‹åŠ¨è§¦å‘
SAVE # SynchronizationSaveï¼ˆé˜»å¡ï¼‰
BGSAVE # AsyncSaveï¼ˆAfterå°ï¼‰

</code></pre>
<h3># AOF (Append Only File)</h3>
<pre><code class="language-bash"># ConfigOption
appendonly yes
appendfsync always # æ¯æ¬¡å†™å…¥ç«‹å³åŒæ­¥
appendfsync everysec # æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæ¨èï¼‰
appendfsync no # ç”±OSå†³å®šSynchronizationWhenæœº

</code></pre>
<h3># æ··åˆæŒä¹…åŒ– (Redis 4.0+)</h3>
<pre><code class="language-bash">aof-use-rdb-preamble yes

</code></pre>
<pre><code class="language-bash"># é…ç½®æœ€å¤§å†…å­˜
maxmemory 2gb

# æ·˜æ±°ç­–ç•¥
maxmemory-policy allkeys-lru

</code></pre>
<p>| <code>allkeys-lfu</code> | æ‰€æœ‰ key ä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡çš„ |
| <code>volatile-lru</code> | æœ‰è¿‡æœŸæ—¶é—´çš„ key ä¸­æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„ |
| <code>volatile-lfu</code> | æœ‰è¿‡æœŸæ—¶é—´çš„ key ä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡çš„ |
| <code>volatile-random</code> | æœ‰è¿‡æœŸæ—¶é—´çš„ key ä¸­éšæœºæ·˜æ±° |
| <code>volatile-ttl</code> | æ·˜æ±°å³å°†è¿‡æœŸçš„ key |</p>
<h2># ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
<h3>1. ç¼“å­˜ç©¿é€</h3>
<ul>
<li><p><strong>é—®é¢˜</strong>: æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç»•è¿‡ç¼“å­˜ç›´æ¥æŸ¥æ•°æ®åº“</p>
</li>
<li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
</li>
</ul>
<ul>
<li><p>å¸ƒéš†è¿‡æ»¤å™¨é¢„è¿‡æ»¤</p>
</li>
<li><p>ç©ºå€¼ç¼“å­˜ï¼ˆè®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´ï¼‰</p>
</li>
<li><p>å‚æ•°æ ¡éªŒ</p>
</li>
</ul>
<h3>2. ç¼“å­˜é›ªå´©</h3>
<ul>
<li><p><strong>é—®é¢˜</strong>: å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œæ•°æ®åº“å‹åŠ›æ¿€å¢</p>
</li>
<li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
</li>
</ul>
<ul>
<li><p>éšæœºè¿‡æœŸæ—¶é—´</p>
</li>
<li><p>ç¼“å­˜é¢„çƒ­</p>
</li>
<li><p>å¤šçº§ç¼“å­˜</p>
</li>
<li><p>é™æµé™çº§</p>
</li>
</ul>
<h3>3. ç¼“å­˜å‡»ç©¿</h3>
<ul>
<li><p><strong>é—®é¢˜</strong>: çƒ­ç‚¹æ•°æ®è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚ç›´è¾¾æ•°æ®åº“</p>
</li>
<li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
</li>
</ul>
<ul>
<li><p>äº’æ–¥é”é‡å»ºç¼“å­˜</p>
</li>
<li><p>å¼‚æ­¥æ›´æ–°ç¼“å­˜</p>
</li>
<li><p>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</p>
</li>
</ul>
<h2># åˆ†å¸ƒå¼é”å®ç°</h2>
<h3># åŸºäº SETNX çš„ç®€å•é”</h3>
<pre><code class="language-bash"># åŠ é”
SET lock_key unique_value PX 30000 NX

# é‡Šæ”¾é”ï¼ˆLuaScriptä¿è¯åŸå­æ€§ï¼‰
if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then
return redis.call(&quot;del&quot;, KEYS[1])
else
return 0
end

</code></pre>
<ol start="2">
<li>è¶…è¿‡ N/2+1 ä¸ªå®ä¾‹åŠ é”æˆåŠŸæ‰ç®—æˆåŠŸ</li>
<li>åŠ é”æ€»æ—¶é—´è¦å°äºé”è¿‡æœŸæ—¶é—´</li>
<li>é‡Šæ”¾æ‰€æœ‰å®ä¾‹ä¸Šçš„é”</li>
</ol>
<pre><code>- å°æ•°æ®é‡ä½¿ç”¨ziplistç¼–ç ï¼ˆèŠ‚çœå†…å­˜ï¼‰

- å¤§æ•°æ®é‡ä½¿ç”¨hashtableç¼–ç ï¼ˆæé«˜æ€§èƒ½ï¼‰

### 2. æ‰¹é‡æ“ä½œ

```bash
# ä½¿ç”¨ pipeline å‡å°‘ç½‘ç»œå¾€è¿”
PIPELINE
SET key1 value1
SET key2 value2
EXEC

# UseMGET/MSETBatchOperation
MSET key1 value1 key2 value2
MGET key1 key2

</code></pre>
<h1>ConfigOptimize</h1>
<p>hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
set-max-intset-entries 512</p>
<pre><code>---
## æ•°æ®åº“æŠ€æœ¯é€‰å‹å¯¹æ¯”

## # å…³ç³»å‹æ•°æ®åº“ (RDBMS)

### MySQL
* *ç‰¹ç‚¹**: å¼€æºã€æˆç†Ÿã€ç¤¾åŒºæ´»è·ƒ

| æ–¹é¢ | æè¿° |
|:---|:---|
| **å­˜å‚¨å¼•æ“** | InnoDB(äº‹åŠ¡)ã€MyISAM(æ€§èƒ½) |
| **äº‹åŠ¡æ”¯æŒ** | å®Œæ•´ACIDæ”¯æŒ |
| **å¤åˆ¶** | ä¸»ä»å¤åˆ¶ã€ä¸»ä¸»å¤åˆ¶ |
| **åˆ†ç‰‡** | åº”ç”¨å±‚åˆ†ç‰‡ |
| **é€‚ç”¨åœºæ™¯** | Webåº”ç”¨ã€ç”µå•†ç³»ç»Ÿã€é‡‘èç³»ç»Ÿ |

```sql
- - IndexOptimize
CREATE INDEX idx_user_email ON users(email);
EXPLAIN SELECT * FROM users WHERE email = 'test@example.com';

- - PartitionTable
CREATE TABLE orders (
id INT,
order_date DATE,
amount DECIMAL(10,2)
) PARTITION BY RANGE (YEAR(order_date)) (
PARTITION p2022 VALUES LESS THAN (2023),
PARTITION p2023 VALUES LESS THAN (2024)
);

</code></pre>
<p>| <strong>æ•°æ®ç±»å‹</strong> | ä¸°å¯Œçš„å†…ç½®ç±»å‹(JSONã€æ•°ç»„ã€åœ°ç†) |
| <strong>ç´¢å¼•ç±»å‹</strong> | B-treeã€Hashã€GiSTã€SP-GiSTã€GINã€BRIN |
| <strong>å¹¶å‘æ§åˆ¶</strong> | MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ |
| <strong>æ‰©å±•æ€§</strong> | ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ |
| <strong>é€‚ç”¨åœºæ™¯</strong> | å¤æ‚æŸ¥è¯¢ã€æ•°æ®åˆ†æã€åœ°ç†ä¿¡æ¯ç³»ç»Ÿ |</p>
<pre><code class="language-sql">- - JSONOperation
SELECT data-&gt;&gt;'name' FROM users WHERE data @&gt; '{&quot;age&quot;: 25}';

- - ArrayClassType
CREATE TABLE posts (
id SERIAL,
tags TEXT[]
);
INSERT INTO posts (tags) VALUES (ARRAY['postgres', 'database']);

- - çª—å£Function
SELECT name, salary,
RANK() OVER (ORDER BY salary DESC) as rank
FROM employees;

</code></pre>
<p>|:---|:---|
| <strong>æ•°æ®æ¨¡å‹</strong> | BSON æ–‡æ¡£ |
| <strong>æŸ¥è¯¢è¯­è¨€</strong> | MongoDB Query Language |
| <strong>åˆ†ç‰‡</strong> | è‡ªåŠ¨åˆ†ç‰‡(Auto-Sharding) |
| <strong>å¤åˆ¶</strong> | å‰¯æœ¬é›†(Replica Set) |
| <strong>é€‚ç”¨åœºæ™¯</strong> | å†…å®¹ç®¡ç†ã€å®æ—¶åˆ†æã€ç‰©è”ç½‘ |</p>
<pre><code class="language-javascript">// DocumentationOperation
db.users.insertOne({
  name: &quot;John&quot;,
  age: 30,
  address: {
    city: &quot;New York&quot;,
    state: &quot;NY&quot;,
  },
  hobbies: [&quot;reading&quot;, &quot;swimming&quot;],
});

// Aggregateç®¡é“
db.orders.aggregate([
  { $match: { status: &quot;completed&quot; } },
  { $group: { _id: &quot;$customer_id&quot;, total: { $sum: &quot;$amount&quot; } } },
  { $sort: { total: -1 } },
]);

// Index
db.users.createIndex({ email: 1 }, { unique: true });
db.posts.createIndex({ title: &quot;text&quot;, content: &quot;text&quot; }); // å…¨æ–‡Index
</code></pre>
<p>| <strong>æ•°æ®æ¨¡å‹</strong> | å®½åˆ—å­˜å‚¨ |
| <strong>ä¸€è‡´æ€§</strong> | å¯è°ƒä¸€è‡´æ€§ |
| <strong>åˆ†åŒº</strong> | ä¸€è‡´æ€§å“ˆå¸Œ |
| <strong>å®¹é”™</strong> | æ— å•ç‚¹æ•…éšœ |
| <strong>é€‚ç”¨åœºæ™¯</strong> | æ—¶åºæ•°æ®ã€æ—¥å¿—ç³»ç»Ÿã€æ¨èç³»ç»Ÿ |</p>
<pre><code class="language-sql">- - Tableè®¾è®¡ï¼ˆByQueryè®¾è®¡ï¼‰
CREATE TABLE user_posts (
user_id UUID,
post_time TIMESTAMP,
post_id UUID,
content TEXT,
PRIMARY KEY (user_id, post_time, post_id)
) WITH CLUSTERING ORDER BY (post_time DESC);

- - Query
SELECT * FROM user_posts
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
AND post_time &gt;= '2023-01-01';

</code></pre>
<p>| <strong>PostgreSQL</strong> | å…³ç³»å‹ | å¼ºä¸€è‡´ | å‚ç›´æ‰©å±• | âœ… å¾ˆå¼º | ä¸­ | å¤æ‚ä¸šåŠ¡ã€åˆ†æ |
| <strong>Redis</strong> | é”®å€¼ | æœ€ç»ˆä¸€è‡´ | æ°´å¹³æ‰©å±• | âŒ å¼± | ä½ | ç¼“å­˜ã€ä¼šè¯ |
| <strong>MongoDB</strong> | æ–‡æ¡£ | å¼ºä¸€è‡´ | æ°´å¹³æ‰©å±• | âœ… ä¸­ç­‰ | ä¸­ | å†…å®¹ç®¡ç†ã€å¿«é€Ÿå¼€å‘ |
| <strong>Cassandra</strong> | åˆ—æ— | å¯è°ƒä¸€è‡´ | çº¿æ€§æ‰©å±• | âŒ å¼± | é«˜ | å¤§æ•°æ®ã€é«˜å¹¶å‘å†™å…¥ |
| <strong>HBase</strong> | åˆ—æ— | å¼ºä¸€è‡´ | æ°´å¹³æ‰©å±• | âŒ å¼± | é«˜ | å¤§æ•°æ®å­˜å‚¨ã€å®æ—¶è¯»å†™ |</p>
<h2># CAP ç†è®ºä¸é€‰æ‹©</h2>
<h3># CAP ç†è®º</h3>
<ul>
<li><p><strong>C (Consistency)</strong>: ä¸€è‡´æ€§</p>
</li>
<li><p><strong>A (Availability)</strong>: å¯ç”¨æ€§</p>
</li>
<li><p><strong>P (Partition tolerance)</strong>: åˆ†åŒºå®¹é”™æ€§</p>
</li>
</ul>
<h3># æ•°æ®åº“åœ¨ CAP ä¸­çš„å®šä½</h3>
<pre><code>
APç³»ç»Ÿ (é«˜å¯ç”¨æ€§)
â”œâ”€â”€ Cassandra
â”œâ”€â”€ DynamoDB
â””â”€â”€ CouchDB

CAç³»ç»Ÿ (NetworkPartitionå°‘è§)
â”œâ”€â”€ ä¼ ç»ŸRDBMS (å•æœº)
â””â”€â”€ Redis (å•æœºæ¨¡å¼)

</code></pre>
<p>â”‚ â”‚ â”œâ”€â”€ is â†’ PostgreSQL
â”‚ â”‚ â””â”€â”€ No â†’ MySQL
â”‚ â””â”€â”€ ç®€å•é”®å€¼è®¿é—®ï¼Ÿ â†’ Redis
â”œâ”€â”€ ä¸­å‹ (1TB - 10TB)
â”‚ â”œâ”€â”€ ç»“æ„åŒ–æ•°æ®ï¼Ÿ
â”‚ â”‚ â”œâ”€â”€ å…³ç³»å‹éœ€æ±‚ â†’ MySQL/PostgreSQL + åˆ†åº“åˆ†è¡¨
â”‚ â”‚ â””â”€â”€ æ–‡æ¡£ç±»å‹éœ€æ±‚ â†’ MongoDB
â”‚ â””â”€â”€ ç¼“å­˜éœ€æ±‚ï¼Ÿ â†’ Redis Cluster
â””â”€â”€ å¤§å‹ (&gt; 10TB)
â”œâ”€â”€ å®æ—¶è¯»å†™ â†’ HBase
â”œâ”€â”€ é«˜å¹¶å‘å†™ â†’ Cassandra
â””â”€â”€ å¤æ‚åˆ†æ â†’ Hadoop ç”Ÿæ€ + Hive</p>
<pre><code>â†“
MySQL (TransactionLayer)
â†“
MongoDB (DocumentationStorage)
â†“
HBase (å¤§Data storage)

</code></pre>
<p>def <strong>init</strong>(self):
self.redis = Redis()
self.mysql = MySQL()
self.mongodb = MongoDB()</p>
<p>def get_user_profile(self, user_id):</p>
<h1>1. å…ˆæŸ¥ RedisCache</h1>
<p>cached = self.redis.get(f&quot;user:{user_id}&quot;)
if cached:
return json.loads(cached)</p>
<h1>2. æŸ¥ MySQLGetBasic information</h1>
<p>user_basic = self.mysql.query(
&quot;SELECT * FROM users WHERE id = %s&quot;, user_id
)</p>
<h1>3. æŸ¥ MongoDBGetExtensionInformation</h1>
<p>user_extended = self.mongodb.find_one(
{&quot;user_id&quot;: user_id}, collection=&quot;user_profiles&quot;
)</p>
<h1>4. åˆå¹¶æ•°æ®å¹¶ç¼“å­˜</h1>
<p>user_data = {**user_basic, **user_extended}
self.redis.setex(f&quot;user:{user_id}&quot;, 3600, json.dumps(user_data))</p>
<p>return user_data</p>
<ul>
<li><p><strong>MySQL</strong>: 10K+ (SSD + ç´¢å¼•)</p>
</li>
<li><p><strong>MongoDB</strong>: 20K+ (å†…å­˜ + ç´¢å¼•)</p>
</li>
<li><p><strong>PostgreSQL</strong>: 15K+ (ä¼˜åŒ–å)</p>
</li>
<li><p><strong>Cassandra</strong>: 50K+ (åˆ†å¸ƒå¼)</p>
</li>
</ul>
<h3># å†™æ€§èƒ½ (TPS)</h3>
<ul>
<li><p><strong>Redis</strong>: 80K+ (å†…å­˜)</p>
</li>
<li><p><strong>MySQL</strong>: 5K+ (InnoDB)</p>
</li>
<li><p><strong>MongoDB</strong>: 15K+ (å¼‚æ­¥å†™å…¥)</p>
</li>
<li><p><strong>Cassandra</strong>: 100K+ (LSM æ ‘)</p>
</li>
<li><p><strong>HBase</strong>: 50K+ (WAL + MemStore)</p>
</li>
</ul>
<h3># å­˜å‚¨æˆæœ¬</h3>
<ul>
<li><p><strong>å†…å­˜æ•°æ®åº“</strong>: $100/GB/æœˆ (Redis)</p>
</li>
<li><p><strong>SSD å­˜å‚¨</strong>: $1/GB/æœˆ (MySQL/PostgreSQL)</p>
</li>
<li><p><strong>HDD å­˜å‚¨</strong>: $0.1/GB/æœˆ (MongoDB/Cassandra)</p>
</li>
</ul>
<hr />
<h2>æ€»ç»“ä¸å»ºè®®</h2>
<h2># é€‰å‹åŸåˆ™</h2>
<ol>
<li><strong>ä¸šåŠ¡éœ€æ±‚ä¼˜å…ˆ</strong>: æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©</li>
<li><strong>å›¢é˜Ÿèƒ½åŠ›</strong>: è€ƒè™‘å›¢é˜Ÿçš„æŠ€æœ¯æ ˆå’Œç»´æŠ¤èƒ½åŠ›</li>
<li><strong>æˆæœ¬æ§åˆ¶</strong>: ç»¼åˆè€ƒè™‘å¼€å‘ã€è¿ç»´ã€ç¡¬ä»¶æˆæœ¬</li>
<li><strong>æœªæ¥æ‰©å±•</strong>: é¢„ç•™æŠ€æœ¯æ¼”è¿›ç©ºé—´</li>
</ol>
<h2># æœ€ä½³å®è·µ</h2>
<ul>
<li><p><strong>è¯»å¤šå†™å°‘</strong>: MySQL/PostgreSQL + Redis</p>
</li>
<li><p><strong>å†™å¤šè¯»å°‘</strong>: Cassandra/MongoDB + Redis</p>
</li>
<li><p><strong>å¤æ‚æŸ¥è¯¢</strong>: PostgreSQL + æ•°æ®ä»“åº“</p>
</li>
<li><p><strong>å®æ—¶åˆ†æ</strong>: HBase + Spark/Flink</p>
</li>
<li><p><strong>æ··åˆè´Ÿè½½</strong>: å¤šæ•°æ®åº“æ¶æ„ + æ•°æ®åŒæ­¥</p>
</li>
</ul>
<pre><code>
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-77">
                                                <h2>77. Risk Control SDK Build Guide</h2>
                                                <h1>Risk Control SDK ç¼–è¯‘æŒ‡å—</h1>
<h2>Risk Control SDK æ˜¯ä¸€ä¸ªç”¨äºç§»åŠ¨åº”ç”¨çš„è®¾å¤‡æŒ‡çº¹è¯†åˆ«å’Œå®‰å…¨è¯„ä¼°ç³»ç»Ÿï¼ŒåŸºäº JNI æ¶æ„å®ç°ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†è¯´æ˜å¦‚ä½•ç¼–è¯‘å’Œæ„å»ºè¯¥ SDKã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">é¡¹ç›®æ¦‚è¿°</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">ç¯å¢ƒå‡†å¤‡</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">é¡¹ç›®ç»“æ„</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E6%AD%A5%E9%AA%A4">ç¼–è¯‘æ­¥éª¤</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9">æ„å»ºé€‰é¡¹</a></li>
<li><a href="#%E5%A4%9A%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91">å¤šå¹³å°ç¼–è¯‘</a></li>
<li><a href="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">é—®é¢˜æ’æŸ¥</a></li>
</ol>
<hr />
<h2>é¡¹ç›®æ¦‚è¿°</h2>
<p>Risk Control SDK æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ul>
<li><p><strong>è®¾å¤‡æŒ‡çº¹è¯†åˆ«</strong>: ç¡¬ä»¶ã€è½¯ä»¶ã€ç½‘ç»œã€è¡Œä¸ºæŒ‡çº¹é‡‡é›†</p>
</li>
<li><p><strong>å®‰å…¨æ£€æµ‹</strong>: æ¨¡æ‹Ÿå™¨ã€Rootã€è°ƒè¯•å™¨ã€Hook æ¡†æ¶æ£€æµ‹</p>
</li>
<li><p><strong>åé€†å‘å·¥ç¨‹</strong>: ä»£ç æ··æ·†ã€å­—ç¬¦ä¸²åŠ å¯†ã€è¿è¡Œæ—¶å®Œæ•´æ€§ç›‘æ§</p>
</li>
<li><p><strong>é£é™©è¯„ä¼°</strong>: åŸºäºå¤šç»´åº¦æ•°æ®çš„é£é™©è¯„åˆ†ç®—æ³•</p>
</li>
</ul>
<h3>æŠ€æœ¯æ¶æ„</h3>
<pre><code>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Native Layer â”‚ â† C/C++ CoreImplement
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
<pre><code class="language-bash"># Ubuntu/Debian
sudo apt update
sudo apt install -y build-essential cmake git

# macOS
brew install cmake
xcode-select --install

# Windows (Use MSYS2)
pacman -S base-devel cmake git

</code></pre>
<h1>VerifyInstall</h1>
<p>java -version
javac -version</p>
<pre><code>unzip android-ndk-r25c-linux.zip
export ANDROID_NDK=/path/to/android-ndk-r25c

# Download android SDK (optional, Used forTest)
wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip

</code></pre>
<h1>MemoryCheck (Only Linux)</h1>
<p>sudo apt install -y valgrind</p>
<pre><code>export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH

</code></pre>
<p>â”œâ”€â”€ docs/ # DocumentationDirectory
â”‚ â”œâ”€â”€ ArtMethod_Direct_Registration.md
â”‚ â””â”€â”€ diagrams/ # Architecture Diagramtable
â”œâ”€â”€ examples/ # Example code
â”‚ â”œâ”€â”€ ArtMethodDemo.java
â”‚ â””â”€â”€ RiskControlDemo.java
â”œâ”€â”€ include/ # Header file directory
â”œâ”€â”€ scripts/ # Build scripts
â”‚ â”œâ”€â”€ build.sh.in # Generic build script template
â”‚ â””â”€â”€ build-android.sh.in # Android build script template
â””â”€â”€ src/ # Source code
â”œâ”€â”€ java/ # Java layer implementation
â”‚ â””â”€â”€ com/riskcontrol/
â”‚ â”œâ”€â”€ DeviceFingerprint.java
â”‚ â”œâ”€â”€ RiskControlSDK.java
â”‚ â”œâ”€â”€ RiskScore.java
â”‚ â””â”€â”€ SecurityResult.java
â””â”€â”€ native/ # Native layer implementation
â”œâ”€â”€ anti_reverse.c/.h # Anti-reverse engineering protection
â”œâ”€â”€ art_method_hook.c/.h # ART method hooking
â”œâ”€â”€ risk_control.c/.h # Main risk control logic
â””â”€â”€ svc_syscall.c/.h # System call handling</p>
<pre><code>
```bash
cd /path/to/android_reversing/playground
git clone &lt;repository-url&gt; risk-control-sdk # orUseExistingCode
cd risk-control-sdk

</code></pre>
<pre><code>
# orSpecifiedDetailedOption
cmake -DCMAKE_BUILD_TYPE=Release \
- DENABLE_DEBUG=OFF \
- DENABLE_ANTI_REVERSE=ON \
- DENABLE_SVC_SYSCALLS=ON \
..

</code></pre>
<h1>orCompileSpecificTarget</h1>
<p>make riskcontrol # Compile Native Library
make compile_java # Compile Java Code
make create_jar # Create JAR Package
make example # CompileExampleProgram</p>
<pre><code>
# Should see:

# - libriskcontrol.so (Linux) or libriskcontrol.jnilib (macOS)

# - RiskControlSDK.jar

# - examples/

# Run tests
./examples/RiskControlDemo

</code></pre>
<p>echo $ANDROID_NDK</p>
<h1>ShouldOutput: /path/to/android-ndk-r25c</h1>
<h1>Verify NDK Toolchain</h1>
<p>$ANDROID_NDK/ndk-build --version</p>
<pre><code>cmake -P scripts/generate_build_scripts.cmake

# Execute android Build
chmod +x build-android.sh
./build-android.sh

</code></pre>
<p>cd build-android</p>
<h1>Config android Toolchain</h1>
<p>cmake -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK/build/cmake/android.toolchain.cmake <br />
-DANDROID_ABI=arm64-v8a <br />
-DANDROID_PLATFORM=android-21 <br />
-DANDROID_NDK=$ANDROID_NDK <br />
-DBUILD_ANDROID=ON <br />
-DCMAKE_BUILD_TYPE=Release <br />
..</p>
<h1>Compile</h1>
<p>make -j$(nproc)</p>
<pre><code>
for ARCH in &quot;${ARCHITECTURES[@]}&quot;; do
echo &quot;Building for $ARCH...&quot;
mkdir -p build-android-$ARCH
cd build-android-$ARCH

cmake -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK/build/cmake/android.toolchain.cmake \
- DANDROID_ABI=$ARCH \
- DANDROID_PLATFORM=android-21 \
- DANDROID_NDK=$ANDROID_NDK \
- DBUILD_ANDROID=ON \
- DCMAKE_BUILD_TYPE=Release \
..

make -j$(nproc)
cd ..
done

</code></pre>
<p>|---------|--------|------|
| <code>CMAKE_BUILD_TYPE</code> | <code>Release</code> | æ„å»ºç±»å‹: Debug/Release/RelWithDebInfo |
| <code>ENABLE_DEBUG</code> | <code>OFF</code> | å¯ç”¨è°ƒè¯•æ¨¡å¼å’Œæ—¥å¿—è¾“å‡º |
| <code>ENABLE_ANTI_REVERSE</code> | <code>ON</code> | å¯ç”¨åé€†å‘å·¥ç¨‹ä¿æŠ¤ |
| <code>ENABLE_SVC_SYSCALLS</code> | <code>ON</code> | å¯ç”¨ SVC ç³»ç»Ÿè°ƒç”¨æ”¯æŒ |
| <code>BUILD_ANDROID</code> | <code>OFF</code> | Android å¹³å°æ„å»ºæ¨¡å¼ |
| <code>BUILD_EXAMPLES</code> | <code>ON</code> | æ„å»ºç¤ºä¾‹ç¨‹åº |
| <code>BUILD_DOCS</code> | <code>OFF</code> | ç”Ÿæˆ Doxygen æ–‡æ¡£ |</p>
<h3>ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="language-bash"># DebugBuild
cmake -DCMAKE_BUILD_TYPE=Debug -DENABLE_DEBUG=ON ..

# æœ€å°åŒ–æ„å»º (ç¦ç”¨ä¿æŠ¤åŠŸèƒ½)
cmake -DENABLE_ANTI_REVERSE=OFF -DENABLE_SVC_SYSCALLS=OFF ..

# ReleaseBuild (å…¨åŠŸèƒ½)
cmake -DCMAKE_BUILD_TYPE=Release \
- DENABLE_ANTI_REVERSE=ON \
- DENABLE_SVC_SYSCALLS=ON \
- DBUILD_EXAMPLES=OFF \
..

</code></pre>
<p>|------|------|--------|--------|
| Linux | x86_64 | GCC/Clang | <code>libriskcontrol.so</code> |
| macOS | x86_64/arm64 | Clang | <code>libriskcontrol.jnilib</code> |
| Windows | x86_64 | MinGW/MSVC | <code>riskcontrol.dll</code> |
| Android | arm64-v8a | Android NDK | <code>libriskcontrol.so</code> |
| Android | armeabi-v7a | Android NDK | <code>libriskcontrol.so</code> |
| Android | x86/x86_64 | Android NDK | <code>libriskcontrol.so</code> |</p>
<h3>å¹³å°ç‰¹å®šé…ç½®</h3>
<h4>Linux ç¼–è¯‘</h4>
<pre><code class="language-bash"># Ubuntu/Debian ä¾èµ–
sudo apt install -y build-essential cmake openjdk-8-jdk

# Compile
mkdir build-linux &amp;&amp; cd build-linux
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j$(nproc)

</code></pre>
<h1>Compile (Support Universal Binary)</h1>
<p>mkdir build-macos &amp;&amp; cd build-macos
cmake -DCMAKE_BUILD_TYPE=Release <br />
-DCMAKE_OSX_ARCHITECTURES=&quot;x86_64;arm64&quot; <br />
..
make -j$(sysctl -n hw.ncpu)</p>
<pre><code>
mkdir build-windows &amp;&amp; cd build-windows
cmake -G &quot;MinGW Makefiles&quot; -DCMAKE_BUILD_TYPE=Release ..
mingw32-make -j$(nproc)

</code></pre>
<pre><code>java -version
javac -version

2. æŸ¥æ‰¾æ­£ç¡® JDK Path


# macOS Homebrew Install OpenJDK
ls /usr/local/Cellar/openjdk/

# Ubuntu/Debian
ls /usr/lib/jvm/

# æ‰‹åŠ¨æŸ¥æ‰¾ JNI å¤´æ–‡ä»¶
find /usr -name &quot;jni.h&quot; 2&gt;/dev/null

3. è®¾ç½®æ­£ç¡®çš„ JAVA_HOME


# macOS Homebrew OpenJDK Example
export JAVA_HOME=/usr/local/Cellar/openjdk/24.0.1/libexec/openjdk.jdk/Contents/Home

# Ubuntu/Debian Example
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64

4. éªŒè¯ JNI å¤´æ–‡ä»¶å­˜åœ¨
ls -la $JAVA_HOME/include/jni.h

5. Re-Run CMake
cmake .

</code></pre>
<p>è§£å†³: Add å¹³å°å…¼å®¹æ€§ Process</p>
<p>in/at art_method_hook.c InModify:
// originalCode</p>
<h1>include &lt;sys/system_properties.h&gt;</h1>
<p>// Modify ä¸ºå¹³å°å…¼å®¹</p>
<h1>ifdef <strong>andROID</strong></h1>
<h1>include &lt;sys/system_properties.h&gt;</h1>
<h1>else</h1>
<p>// Not android å¹³å°æ›¿ä»£ Implement</p>
<h1>define PROP_VALUE_MAX 256</h1>
<p>static int __system_property_get(const char* name, char* value) {
if (strcmp(name, &quot;ro.build.version.sdk&quot;) == 0) {
strcpy(value, &quot;28&quot;); // æ¨¡æ‹Ÿ Android API 28
return strlen(value);
}
value[0] = '\0';
return 0;
}</p>
<h1>endif</h1>
<pre><code>#include &lt;stdint.h&gt; // Addæ ‡å‡†IntegerClassTypeSupport

</code></pre>
<p>// Add ç»“æ„ä½“ Define
typedef struct {
const char* name;
const char* signature;
void* fnPtr;
} native_method_t;</p>
<p>// UpdateFunction å£°æ˜
int register_native_methods_direct(JNIEnv* env, const char* class_name,
const native_method_t* methods, int method_count);</p>
<pre><code>// originalCodeï¼ˆDeleteï¼‰
typedef struct {
const char* name;
const char* signature;
void* fnPtr;
} native_method_t;

// ä¿®æ”¹ä¸ºå‰å‘å£°æ˜
typedef struct native_method_t native_method_t;

</code></pre>
<p>uint32_t calculate_string_hash(const char* str); // åŸ calculate_hash
char* decrypt_raw_string(const unsigned char* encrypted, size_t len); // åŸ decrypt_string</p>
<p>// MeanwhileUpdate .c FileinFunctionImplementandCall</p>
<pre><code>#else
// Not ARM architectureæ¨¡æ‹ŸImplementï¼ˆUsed foræ¡Œé¢å¹³å°Testï¼‰
static inline long svc_call(long number, long arg1, long arg2, long arg3, long arg4, long arg5, long arg6) {
switch (number) {
case __NR_getpid: return getpid();
case __NR_getuid: return getuid();
default: return -1;
}
}
#endif

</code></pre>
<p>if (!env-&gt;functions-&gt;FindClass ||</p>
<p>// Modify ä¸º
if (!(*env)-&gt;FindClass ||</p>
<pre><code>

- Check JDK InstallCompleteæ€§


- å¯¹äº Android: ç¡®è®¤ NDK Version &gt;= r20

</code></pre>
<p>æœ€ä½³è§£å†³æ–¹æ¡ˆ: CreatePublicClassTypeDefineFile</p>
<ol>
<li><p>Create src/native/common_types.h:
#ifndef COMMON_TYPES_H
#define COMMON_TYPES_H
typedef struct {
const char* name;
const char* signature;
void* fnPtr;
} native_method_t;
#endif</p>
</li>
<li><p>in/atAllNeed æ­¤ ClassType å¤´ FileInContains:
#include &quot;common_types.h&quot;</p>
</li>
<li><p>åˆ é™¤å…¶ä»–æ–‡ä»¶ä¸­çš„é‡å¤å®šä¹‰</p>
</li>
</ol>
<pre><code>
Error: implicit declaration of function 'dladdr'
è§£å†³: Enabled GNU Extensionå¹¶Add dl Libraryé“¾æ¥

1. åœ¨ art_method_hook.c å¼€å¤´æ·»åŠ ï¼ˆå¿…é¡»åœ¨æ‰€æœ‰ #include ä¹‹Beforeï¼‰:
// Enabled GNU ExtensionåŠŸèƒ½ä»¥ç¡®ä¿ dladdr å¯ç”¨
#ifndef _GNU_SOURCE
#define _GNU_SOURCE
#endif

#include &quot;art_method_hook.h&quot;
// ... å…¶ä»– includes ...
#include &lt;dlfcn.h&gt;

2. in/at CMakeLists.txt InAdd dl Libraryé“¾æ¥:


# é“¾æ¥åº“
target_link_libraries(riskcontrol ${JNI_LIBRARIES})

# in/atNot android å¹³å°ä¸Šé“¾æ¥ dl Library
if(NOT BUILD_ANDROID)
target_link_libraries(riskcontrol dl)
endif()

3. Re-ConfigProject:
rm -f CMakeCache.txt
cmake .
make clean
make -j8

</code></pre>
<pre><code>sudo chown -R $USER:$USER build/

</code></pre>
<p>make -j$(nproc) # Linux
make -j$(sysctl -n hw.ncpu) # macOS</p>
<pre><code>
# Use Ninja Buildç³»ç»Ÿ (æ›´å¿«)
cmake -G Ninja ..
ninja

</code></pre>
<p>export CC=&quot;ccache gcc&quot;
export CXX=&quot;ccache g++&quot;</p>
<pre><code>cmake --verbose ..

# Make DetailedOutput
make VERBOSE=1

</code></pre>
<p>otool -L libriskcontrol.jnilib # macOS</p>
<h1>æ£€æŸ¥ç¬¦å·</h1>
<p>nm -D libriskcontrol.so
objdump -T libriskcontrol.so</p>
<pre><code>
# Java JNI Debug
java -Djava.library.path=./build -verbose:jni RiskControlDemo

</code></pre>
<p>// Load SDK
System.loadLibrary(&quot;riskcontrol&quot;);</p>
<p>// Use SDK
RiskControlSDK sdk = RiskControlSDK.getInstance();
SecurityResult result = sdk.performSecurityCheck();
DeviceFingerprint fingerprint = sdk.getDeviceFingerprint();
RiskScore score = sdk.calculateRiskScore(fingerprint, result);</p>
<pre><code>// ...
sourceSets {
main {
jniLibs.srcDirs = ['libs']
}
}
}

dependencies {
implementation files('libs/RiskControlSDK.jar')
}

</code></pre>
<p>cp build/RiskControlSDK.jar /target/project/libs/</p>
<pre><code>2. **æ„å»ºé€‰é¡¹**: æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„åŠŸèƒ½å¼€å…³å’Œä¼˜åŒ–çº§åˆ«
3. **å¤šå¹³å°æ”¯æŒ**: ä½¿ç”¨ç»Ÿä¸€çš„ CMake é…ç½®æ”¯æŒå¤šç§ç›®æ ‡å¹³å°
4. **é—®é¢˜æ’æŸ¥**: é‡åˆ°é—®é¢˜æ—¶ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡ã€ä¾èµ–åº“å’Œæƒé™è®¾ç½®


é€šè¿‡éµå¾ªæœ¬æŒ‡å—ï¼Œä½ åº”è¯¥èƒ½å¤ŸæˆåŠŸç¼–è¯‘å’Œé›†æˆ Risk Control SDK åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-78">
                                                <h2>78. Data Warehousing & Processing</h2>
                                                <hr />
<h1>æ•°æ®åˆ†æï¼šæ•°æ®ä»“åº“ä¸è®¡ç®—å¼•æ“</h1>
<h2>å½“é€šè¿‡é€†å‘å’Œçˆ¬è™«é‡‡é›†åˆ°æµ·é‡æ•°æ®åï¼ˆä¾‹å¦‚ï¼Œæ•°äº¿æ¡ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€å•†å“ä¿¡æ¯ï¼‰ï¼Œå¦‚ä½•å­˜å‚¨ã€ç®¡ç†å’Œåˆ†æè¿™äº›æ•°æ®ï¼Œå°±æˆäº†å¤§æ•°æ®é¢†åŸŸçš„æ ¸å¿ƒé—®é¢˜ã€‚æœ¬èŠ‚å°†ä»‹ç»ä¸»æµçš„æ•°æ®ä»“åº“å’Œåˆ†å¸ƒå¼è®¡ç®—å¼•æ“æŠ€æœ¯ã€‚</h2>
<h2>1. æ•°æ®ä»“åº“ (Data Warehouse)</h2>
<p>æ•°æ®ä»“åº“æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†ææµ·é‡ç»“æ„åŒ–ã€åŠç»“æ„åŒ–æ•°æ®çš„ç³»ç»Ÿã€‚å®ƒä¸ä¸šåŠ¡æ•°æ®åº“ï¼ˆOLTPï¼‰ä¸åŒï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯æ”¯æŒå¤æ‚çš„åˆ†ææŸ¥è¯¢ï¼ˆOLAPï¼‰ã€‚</p>
<h3>a) Hive</h3>
<ul>
<li><p><strong>å®šä½</strong>: åŸºäº Hadoop çš„ä¸€ä¸ª<strong>æ•°æ®ä»“åº“åŸºç¡€æ¶æ„</strong>ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒæ€æƒ³</strong>: Hive å…è®¸ä½ ä½¿ç”¨æ ‡å‡†çš„ <strong>SQL è¯­è¨€</strong> æ¥æŸ¥è¯¢å­˜å‚¨åœ¨ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHDFSï¼‰ä¸Šçš„å¤§è§„æ¨¡æ•°æ®é›†ã€‚å®ƒå°† SQL æŸ¥è¯¢ç¿»è¯‘æˆ MapReduceã€Tez æˆ– Spark ä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>
</li>
<li><p><strong>å…ƒæ•°æ® (Metastore)</strong>: Hive çš„æ ¸å¿ƒæ˜¯å…¶å…ƒæ•°æ®å­˜å‚¨ã€‚å®ƒè®°å½•äº†&quot;è¡¨&quot;çš„ç»“æ„ï¼ˆåˆ—åã€æ•°æ®ç±»å‹ï¼‰ä¸ HDFS ä¸Šçš„æ–‡ä»¶ï¼ˆå¦‚ CSV, Parquet, ORC æ–‡ä»¶ï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚æœ¬è´¨ä¸Šï¼ŒHive æä¾›äº†ä¸€ç§&quot;ç»™æ–‡ä»¶ç³»ç»Ÿå¥—ä¸Šä¸€ä¸ªç»“æ„åŒ–å¤–å£³&quot;çš„èƒ½åŠ›ã€‚</p>
</li>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>å¯¹æµ·é‡ï¼ˆTB/PB çº§ï¼‰çš„ã€éå®æ—¶çš„æ•°æ®è¿›è¡Œç¦»çº¿åˆ†æå’Œ ETLï¼ˆæå–ã€è½¬æ¢ã€åŠ è½½ï¼‰ã€‚</li>
<li>æ„å»ºä¼ä¸šçº§çš„æ•°æ®ä»“åº“ï¼Œä¸ºæ•°æ®åˆ†æå¸ˆå’Œ BI æŠ¥è¡¨æä¾›ç»Ÿä¸€çš„ SQL æŸ¥è¯¢å…¥å£ã€‚</li>
</ul>
</li>
</ul>
<h3>b) HBase</h3>
<ul>
<li><p><strong>å®šä½</strong>: ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å¯ä¼¸ç¼©çš„ã€é¢å‘åˆ—çš„ <strong>NoSQL æ•°æ®åº“</strong>ã€‚å®ƒæ„å»ºåœ¨ HDFS ä¹‹ä¸Šï¼Œå¹¶æ¨¡ä»¿ Google Bigtable çš„è®¾è®¡ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:</p>
<ul>
<li><strong>æµ·é‡å­˜å‚¨</strong>: ä¸“ä¸ºå­˜å‚¨æ•°åäº¿è¡Œã€æ•°ç™¾ä¸‡åˆ—çš„è¶…å¤§è§„æ¨¡ç¨€ç–æ•°æ®é›†è€Œè®¾è®¡ã€‚</li>
<li><strong>å®æ—¶è¯»å†™</strong>: ä¸ Hive ä¸»è¦ç”¨äºç¦»çº¿æ‰¹é‡åˆ†æä¸åŒï¼ŒHBase çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ”¯æŒå¯¹æµ·é‡æ•°æ®çš„<strong>ä½å»¶è¿Ÿéšæœºè¯»å†™</strong>ã€‚</li>
<li><strong>é¢å‘åˆ—</strong>: æ•°æ®æŒ‰åˆ—æ—ï¼ˆColumn Familyï¼‰ç»„ç»‡ã€‚ä¸€ä¸ªåˆ—æ—ä¸­çš„æ‰€æœ‰åˆ—åœ¨ç‰©ç†ä¸Šå­˜å‚¨åœ¨ä¸€èµ·ï¼Œè¿™ä½¿å¾—å¯¹ç‰¹å®šåˆ—çš„è¯»å–éå¸¸é«˜æ•ˆã€‚</li>
<li><strong>æ— æ¨¡å¼ (Schemaless)</strong>: ä½ å¯ä»¥éšæ—¶å‘ä¸€ä¸ªåˆ—æ—ä¸­æ·»åŠ æ–°çš„åˆ—ï¼Œè€Œæ— éœ€é¢„å…ˆå®šä¹‰è¡¨ç»“æ„ã€‚</li>
</ul>
</li>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>éœ€è¦å¯¹æµ·é‡æ•°æ®è¿›è¡Œå®æ—¶ã€éšæœºè®¿é—®çš„åœºæ™¯ï¼Œä¾‹å¦‚ç”¨æˆ·ç”»åƒç³»ç»Ÿã€å®æ—¶æ¨èå¼•æ“çš„ç‰¹å¾åº“ã€ç›‘æ§æ•°æ®çš„å­˜å‚¨ã€‚</li>
<li>ä½œä¸ºæ•°æ®é‡‡é›†ç³»ç»Ÿçš„&quot;è½åœ°å±‚&quot;ï¼Œæ¥æ”¶å®æ—¶å†™å…¥çš„æ•°æ®æµï¼Œç„¶åç”± Hive æˆ– Spark è¿›è¡Œåç»­çš„æ‰¹é‡åˆ†æã€‚</li>
</ul>
</li>
</ul>
<h3>Hive vs. HBase</h3>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>Hive</th>
  <th>HBase</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ•°æ®åº“ç±»å‹</strong></td>
  <td>æ•°æ®ä»“åº“ (SQL on Hadoop)</td>
  <td>NoSQL æ•°æ®åº“ (é¢å‘åˆ—)</td>
</tr>
<tr>
  <td><strong>æ ¸å¿ƒç”¨é€”</strong></td>
  <td>æ‰¹é‡åˆ†æ (OLAP)</td>
  <td>å®æ—¶éšæœºè¯»å†™ (OLTP)</td>
</tr>
<tr>
  <td><strong>å»¶è¿Ÿ</strong></td>
  <td>é«˜ï¼ˆåˆ†é’Ÿçº§ï¼‰</td>
  <td>ä½ï¼ˆæ¯«ç§’çº§ï¼‰</td>
</tr>
<tr>
  <td><strong>æ•°æ®æ¨¡å‹</strong></td>
  <td>ç»“æ„åŒ–</td>
  <td>åŠç»“æ„åŒ–/æ— æ¨¡å¼ (ç¨€ç–è¡¨)</td>
</tr>
<tr>
  <td><strong>è¯­è¨€</strong></td>
  <td>SQL (HiveQL)</td>
  <td>Java API, Shell, Thrift/REST</td>
</tr>
</tbody>
</table>
<hr />
<h2>2. åˆ†å¸ƒå¼è®¡ç®—å¼•æ“</h2>
<p>è®¡ç®—å¼•æ“è´Ÿè´£å®é™…æ‰§è¡Œæ•°æ®å¤„ç†ä»»åŠ¡ã€‚ç°ä»£è®¡ç®—å¼•æ“é€šè¿‡åœ¨å†…å­˜ä¸­è¿›è¡Œè®¡ç®—ï¼Œæå¤§åœ°æå‡äº†å¤„ç†é€Ÿåº¦ã€‚</p>
<h3>a) Spark</h3>
<ul>
<li><p><strong>å®šä½</strong>: ä¸€ä¸ªå¿«é€Ÿã€é€šç”¨ã€å¯æ‰©å±•çš„<strong>åˆ†å¸ƒå¼è®¡ç®—å¼•æ“</strong>ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒæ¦‚å¿µ: RDD (å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)</strong>: Spark çš„åŸºç¡€æ•°æ®ç»“æ„ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸å¯å˜çš„ã€è¢«åˆ†åŒºåˆ°é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„å…ƒç´ é›†åˆï¼Œæ”¯æŒä¸°å¯Œçš„è½¬æ¢ï¼ˆ<code>map</code>, <code>filter</code>, <code>join</code>ï¼‰å’Œè¡ŒåŠ¨ï¼ˆ<code>count</code>, <code>collect</code>, <code>save</code>ï¼‰æ“ä½œã€‚RDD çš„&quot;å¼¹æ€§&quot;ä½“ç°åœ¨å…¶è¡€ç¼˜å…³ç³»ï¼ˆLineageï¼‰ï¼Œä»»ä½•åˆ†åŒºçš„ä¸¢å¤±éƒ½å¯ä»¥æ ¹æ®å…¶è½¬æ¢å†å²è¢«é‡æ–°è®¡ç®—å‡ºæ¥ã€‚</p>
</li>
<li><p><strong>DataFrame &amp; Spark SQL</strong>: åœ¨ RDD ä¹‹ä¸Šï¼ŒSpark æä¾›äº†æ›´é«˜çº§çš„ DataFrame APIï¼Œå®ƒå°†æ•°æ®ç»„ç»‡æˆå¸¦æœ‰å‘½ååˆ—çš„äºŒç»´è¡¨ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„è¡¨ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥ä½¿ç”¨ Spark SQL æ¥è¿›è¡Œç»“æ„åŒ–æ•°æ®å¤„ç†ï¼Œå¹¶ä¸” Spark çš„ Catalyst ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨å¯¹ä½ çš„æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</p>
</li>
<li><p><strong>ç”Ÿæ€ç³»ç»Ÿ</strong>:</p>
<ul>
<li><strong>Spark Streaming</strong>: ç”¨äºå¤„ç†å®æ—¶æ•°æ®æµï¼ˆMicro-batchingï¼‰ã€‚</li>
<li><strong>MLlib</strong>: æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„æœºå™¨å­¦ä¹ ç®—æ³•åº“ã€‚</li>
<li><strong>GraphX</strong>: ç”¨äºå›¾è®¡ç®—ã€‚</li>
</ul>
</li>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>éœ€è¦é«˜æ€§èƒ½çš„ã€è¿­ä»£å¼çš„æ‰¹é‡æ•°æ®å¤„ç†å’Œæœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚</li>
<li>ç»Ÿä¸€æ‰¹å¤„ç†å’Œæµå¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<h3>b) Flink</h3>
<ul>
<li><p><strong>å®šä½</strong>: ä¸€ä¸ªä»¥<strong>çœŸæ­£çš„æµå¤„ç† (True Streaming)</strong>ä¸ºæ ¸å¿ƒçš„åˆ†å¸ƒå¼è®¡ç®—å¼•æ“ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:</p>
<ul>
<li><strong>æµä¸ºæ ¸å¿ƒ</strong>: Flink çš„è®¾è®¡å“²å­¦æ˜¯&quot;ä¸€åˆ‡çš†æ˜¯æµ&quot;ï¼Œæ‰¹é‡è®¡ç®—è¢«çœ‹ä½œæ˜¯æµè®¡ç®—çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚å®ƒèƒ½å¤Ÿä»¥äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œé€æ¡å¤„ç†æ•°æ®ï¼Œå®ç°æä½çš„å»¶è¿Ÿã€‚</li>
<li><strong>çŠ¶æ€ç®¡ç†ä¸çª—å£</strong>: Flink æä¾›äº†å¼ºå¤§çš„çŠ¶æ€ç®¡ç†èƒ½åŠ›ï¼Œå…è®¸ä½ åœ¨æµå¤„ç†ä¸­ç»´æŠ¤å’Œæ›´æ–°çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·çš„ç´¯è®¡æ¶ˆè´¹é‡‘é¢ï¼‰ã€‚å®ƒè¿˜æ”¯æŒçµæ´»çš„çª—å£æ“ä½œï¼ˆå¦‚æ»šåŠ¨çª—å£ã€æ»‘åŠ¨çª—å£ã€ä¼šè¯çª—å£ï¼‰ï¼Œç”¨äºå¯¹æ— ç•Œæ•°æ®æµè¿›è¡Œèšåˆåˆ†æã€‚</li>
<li><strong>é«˜ååä¸ä½å»¶è¿Ÿ</strong>: ä¸“ä¸ºä½å»¶è¿Ÿã€é«˜ååçš„å®æ—¶è®¡ç®—åœºæ™¯è®¾è®¡ã€‚</li>
</ul>
</li>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>å¯¹å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼Œå¦‚å®æ—¶é£æ§ã€å®æ—¶æ¨èã€å®æ—¶ç›‘æ§å¤§ç›˜ã€‚</li>
<li>éœ€è¦è¿›è¡Œå¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰çš„åœºæ™¯ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h2>Spark vs. Flink</h2>
<table>
<thead>
<tr>
  <th>ç‰¹æ€§</th>
  <th>Spark</th>
  <th>Flink</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>æ ¸å¿ƒæ¨¡å‹</strong></td>
  <td>æ‰¹å¤„ç† (Batch)</td>
  <td>æµå¤„ç† (Streaming)</td>
</tr>
<tr>
  <td><strong>æµå¤„ç†æ–¹å¼</strong></td>
  <td>å¾®æ‰¹æ¬¡ (Micro-batch)</td>
  <td>é€æ¡å¤„ç† (Per-event)</td>
</tr>
<tr>
  <td><strong>å»¶è¿Ÿ</strong></td>
  <td>ç§’çº§</td>
  <td>æ¯«ç§’çº§</td>
</tr>
<tr>
  <td><strong>çª—å£</strong></td>
  <td>åŸºäºæ—¶é—´çš„çª—å£</td>
  <td>çµæ´»çš„çª—å£ï¼ˆæ—¶é—´ã€è®¡æ•°ã€ä¼šè¯ï¼‰</td>
</tr>
<tr>
  <td><strong>ç”Ÿæ€</strong></td>
  <td>æ›´æˆç†Ÿï¼Œç¤¾åŒºæ›´åºå¤§</td>
  <td>å¿«é€Ÿå‘å±•ï¼Œåœ¨å®æ—¶è®¡ç®—é¢†åŸŸæ˜¯äº‹å®æ ‡å‡†</td>
</tr>
</tbody>
</table>
<h2><strong>æ€»ç»“</strong>: å¦‚æœä½ çš„ä¸»è¦ä»»åŠ¡æ˜¯ç¦»çº¿åˆ†æå’Œæœºå™¨å­¦ä¹ ï¼Œ<code>Spark</code> æ˜¯ä¸€ä¸ªæ›´é€šç”¨ã€æ›´æˆç†Ÿçš„é€‰æ‹©ã€‚å¦‚æœä½ çš„æ ¸å¿ƒæ˜¯éœ€è¦äºšç§’çº§å“åº”çš„å®æ—¶è®¡ç®—ï¼Œ<code>Flink</code> åˆ™æ˜¯æ›´ä¸“ä¸šçš„å·¥å…·ã€‚åœ¨è®¸å¤šç°ä»£æ•°æ®å¹³å°ä¸­ï¼ŒäºŒè€…å¾€å¾€ä¼šå…±å­˜ï¼Œåˆ†åˆ«å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚</h2>

                                            </div>
                                            
                                            <div class="section" id="section-79">
                                                <h2>79. Flink</h2>
                                                <h1>Apache Flink å®æ—¶æµå¤„ç†</h1>
<h2>Apache Flink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†æ¡†æ¶ï¼Œä¸“ä¸ºä½å»¶è¿Ÿã€é«˜ååé‡çš„å®æ—¶æ•°æ®å¤„ç†è€Œè®¾è®¡ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#flink-%E6%9E%B6%E6%9E%84"><strong>Flink æ¶æ„</strong></a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></a></li>
<li><a href="#datastream-api"><strong>DataStream API</strong></a></li>
<li><a href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><strong>çŠ¶æ€ç®¡ç†</strong></a></li>
<li><a href="#%E6%97%B6%E9%97%B4%E4%B8%8E%E7%AA%97%E5%8F%A3"><strong>æ—¶é—´ä¸çª—å£</strong></a></li>
<li><a href="#%E5%AE%B9%E9%94%99%E6%9C%BA%E5%88%B6"><strong>å®¹é”™æœºåˆ¶</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><strong>æ€§èƒ½è°ƒä¼˜</strong></a></li>
<li><a href="#%E9%9D%A2%E8%AF%95%E8%A6%81%E7%82%B9"><strong>çŸ¥è¯†è¦ç‚¹</strong></a></li>
</ol>
<hr />
<h2>Flink æ¶æ„</h2>
<h2># é›†ç¾¤æ¶æ„</h2>
<pre><code>â”œâ”€â”€ ResourceManager
â””â”€â”€ JobMaster
â†“
TaskManager1 TaskManager2 TaskManager3
â”œâ”€â”€ Task Slot1 â”œâ”€â”€ Task Slot1 â”œâ”€â”€ Task Slot1
â”œâ”€â”€ Task Slot2 â”œâ”€â”€ Task Slot2 â”œâ”€â”€ Task Slot2
â””â”€â”€ Task Slot3 â””â”€â”€ Task Slot3 â””â”€â”€ Task Slot3

</code></pre>
<p>| <strong>TaskManager</strong> | æ‰§è¡Œå…·ä½“ä»»åŠ¡ï¼Œç®¡ç†å†…å­˜å’Œç½‘ç»œ |
| <strong>Dispatcher</strong> | æ¥æ”¶ä½œä¸šæäº¤ï¼Œå¯åŠ¨ JobMaster |
| <strong>ResourceManager</strong> | ç®¡ç† TaskManager èµ„æº |
| <strong>JobMaster</strong> | ç®¡ç†å•ä¸ªä½œä¸šçš„æ‰§è¡Œ |</p>
<h2># è¿è¡Œæ—¶æ¶æ„</h2>
<pre><code>Operator1 â†’ Operator2 â†’ Operator3

</code></pre>
<pre><code class="language-java">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

DataStream&lt;String&gt; stream = env
.socketTextStream(&quot;localhost&quot;, 9999)
.flatMap(new Tokenizer())
.keyBy(value -&gt; value.f0)
.window(TumblingProcessingTimeWindows.of(Time.seconds(5)))
.sum(1);

env.execute(&quot;Word Count&quot;);

</code></pre>
<pre><code>DataStream&lt;Integer&gt; intStream;

// 2. å…ƒç»„ç±»å‹
DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; tupleStream;

// 3. POJO ç±»å‹
public class WordCount {
public String word;
public int count;
// constructors, getters, setters
}
DataStream&lt;WordCount&gt; pojoStream;

// 4. Row ç±»å‹ï¼ˆåŠ¨æ€ï¼‰
DataStream&lt;Row&gt; rowStream;

</code></pre>
<p>StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</p>
<p>// 1. Create from collection
DataStream<String> fromCollection = env.fromCollection(Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;));</p>
<p>// 2. ä»æ–‡ä»¶ç³»ç»Ÿ
DataStream<String> fromFile = env.readTextFile(&quot;path/to/file&quot;);</p>
<p>// 3. ä» Kafka
Properties props = new Properties();
props.setProperty(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
props.setProperty(&quot;group.id&quot;, &quot;test&quot;);</p>
<p>DataStream<String> fromKafka = env.addSource(
new FlinkKafkaConsumer&lt;&gt;(&quot;topic&quot;, new SimpleStringSchema(), props));</p>
<p>// 4. è‡ªå®šä¹‰æ•°æ®æº
DataStream<String> customSource = env.addSource(new CustomSourceFunction());</p>
<p>public class CustomSourceFunction implements SourceFunction<String> {
private volatile boolean running = true;</p>
<p>@Override
public void run(SourceContext<String> ctx) throws Exception {
while (running) {
ctx.collect(&quot;data-&quot; + System.currentTimeMillis());
Thread.sleep(1000);
}
}</p>
<p>@Override
public void cancel() {
running = false;
}
}</p>
<pre><code>DataStream&lt;String&gt; mapped = input.map(String::toUpperCase);

// 2. FlatMap - ä¸€å¯¹å¤šConvert
DataStream&lt;String&gt; flatMapped = input.flatMap(
(String line, Collector&lt;String&gt; out) -&gt; {
for (String word : line.split(&quot; &quot;)) {
out.collect(word);
}
});

// 3. Filter - Filter
DataStream&lt;String&gt; filtered = input.filter(s -&gt; s.startsWith(&quot;error&quot;));

// 4. KeyBy - Group
KeyedStream&lt;Tuple2&lt;String, Integer&gt;, String&gt; keyed =
tupleStream.keyBy(value -&gt; value.f0);

// 5. Reduce - Aggregate
DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; reduced =
keyed.reduce((a, b) -&gt; new Tuple2&lt;&gt;(a.f0, a.f1 + b.f1));

// 6. Aggregate - è‡ªå®šä¹‰èšåˆ
DataStream&lt;Double&gt; aggregated = keyed
.aggregate(new AverageAggregate());

public class AverageAggregate implements AggregateFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple2&lt;Long, Long&gt;, Double&gt; {
@Override
public Tuple2&lt;Long, Long&gt; createAccumulator() {
return new Tuple2&lt;&gt;(0L, 0L);
}

@Override
public Tuple2&lt;Long, Long&gt; add(Tuple2&lt;String, Integer&gt; value, Tuple2&lt;Long, Long&gt; accumulator) {
return new Tuple2&lt;&gt;(accumulator.f0 + value.f1, accumulator.f1 + 1L);
}

@Override
public Double getResult(Tuple2&lt;Long, Long&gt; accumulator) {
return ((double) accumulator.f0) / accumulator.f1;
}

@Override
public Tuple2&lt;Long, Long&gt; merge(Tuple2&lt;Long, Long&gt; a, Tuple2&lt;Long, Long&gt; b) {
return new Tuple2&lt;&gt;(a.f0 + b.f0, a.f1 + b.f1);
}
}

</code></pre>
<p>// 2. å†™å…¥æ–‡ä»¶
stream.writeAsText(&quot;path/to/output&quot;);</p>
<p>// 3. å†™å…¥ Kafka
Properties props = new Properties();
props.setProperty(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);</p>
<p>stream.addSink(new FlinkKafkaProducer&lt;&gt;(&quot;output-topic&quot;, new SimpleStringSchema(), props));</p>
<p>// 4. å†™å…¥æ•°æ®åº“
stream.addSink(new CustomSinkFunction());</p>
<p>public class CustomSinkFunction extends RichSinkFunction<String> {
private Connection connection;</p>
<p>@Override
public void open(Configuration parameters) throws Exception {
// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
connection = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/test&quot;, &quot;user&quot;, &quot;password&quot;);
}</p>
<p>@Override
public void invoke(String value, Context context) throws Exception {
// æ‰§è¡Œæ’å…¥æ“ä½œ
PreparedStatement stmt = connection.prepareStatement(&quot;INSERT INTO table VALUES (?)&quot;);
stmt.setString(1, value);
stmt.executeUpdate();
}</p>
<p>@Override
public void close() throws Exception {
if (connection != null) {
connection.close();
}
}
}</p>
<pre><code>
```java
public class StatefulMap extends RichMapFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple2&lt;String, Integer&gt;&gt; {
private ValueState&lt;Integer&gt; sumState;

@Override
public void open(Configuration config) {
ValueStateDescriptor&lt;Integer&gt; descriptor =
new ValueStateDescriptor&lt;&gt;(&quot;sum&quot;, Integer.class);
sumState = getRuntimeContext().getState(descriptor);
}

@Override
public Tuple2&lt;String, Integer&gt; map(Tuple2&lt;String, Integer&gt; input) throws Exception {
Integer currentSum = sumState.value();
if (currentSum == null) {
currentSum = 0;
}
currentSum += input.f1;
sumState.update(currentSum);

return new Tuple2&lt;&gt;(input.f0, currentSum);
}
}

</code></pre>
<p>private ListState<String> checkpointedState;</p>
<p>@Override
public void snapshotState(FunctionSnapshotContext context) throws Exception {
checkpointedState.clear();
for (String element : bufferedElements) {
checkpointedState.add(element);
}
}</p>
<p>@Override
public void initializeState(FunctionInitializationContext context) throws Exception {
ListStateDescriptor<String> descriptor =
new ListStateDescriptor&lt;&gt;(&quot;buffered-elements&quot;, String.class);</p>
<p>checkpointedState = context.getOperatorStateStore().getListState(descriptor);</p>
<p>if (context.isRestored()) {
for (String element : checkpointedState.get()) {
bufferedElements.add(element);
}
}
}
}</p>
<pre><code>
// 2. FsStateBackend (ç”Ÿäº§æ¨è)
env.setStateBackend(new FsStateBackend(&quot;hdfs://namenode:port/flink-checkpoints&quot;));

// 3. RocksDBStateBackend (å¤§çŠ¶æ€)
env.setStateBackend(new RocksDBStateBackend(&quot;hdfs://namenode:port/flink-checkpoints&quot;));

// é…ç½®
env.enableCheckpointing(60000); // 60 ç§’ checkpoint ä¸€æ¬¡
env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);
env.getCheckpointConfig().setMinPauseBetweenCheckpoints(30000);
env.getCheckpointConfig().setCheckpointTimeout(600000);

</code></pre>
<p>// 1. Processing Time (å¤„ç†æ—¶é—´)
env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime);</p>
<p>// 2. Event Time (äº‹ä»¶æ—¶é—´)
env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</p>
<p>// 3. Watermark (æ°´ä½çº¿)
stream.assignTimestampsAndWatermarks(
WatermarkStrategy.<Event>forBoundedOutOfOrderness(Duration.ofSeconds(10))
.withTimestampAssigner((event, timestamp) -&gt; event.getTimestamp()));</p>
<pre><code>stream.keyBy(...)
.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.sum(1);

// æ»‘åŠ¨çª—å£ (Sliding Window)
stream.keyBy(...)
.window(SlidingEventTimeWindows.of(Time.minutes(10), Time.minutes(2)))
.sum(1);

// ä¼šè¯çª—å£ (Session Window)
stream.keyBy(...)
.window(EventTimeSessionWindows.withGap(Time.minutes(30)))
.sum(1);

</code></pre>
<p>.countWindow(100)
.sum(1);</p>
<p>// æ»‘åŠ¨è®¡æ•°çª—å£
stream.keyBy(...)
.countWindow(100, 10)
.sum(1);</p>
<pre><code>.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.reduce(new SumReduceFunction());

// 2. AggregateFunction
stream.keyBy(...)
.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.aggregate(new AverageAggregateFunction());

// 3. ProcessWindowFunction
stream.keyBy(...)
.window(TumblingEventTimeWindows.of(Time.minutes(5)))
.process(new MyProcessWindowFunction());

public class MyProcessWindowFunction extends ProcessWindowFunction&lt;Tuple2&lt;String, Integer&gt;, String, String, TimeWindow&gt; {
@Override
public void process(String key, Context context, Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; elements, Collector&lt;String&gt; out) {
int count = 0;
for (Tuple2&lt;String, Integer&gt; element : elements) {
count++;
}
out.collect(&quot;Window: &quot; + context.window() + &quot; count: &quot; + count);
}
}

</code></pre>
<p>// EnabledCheckpoint
env.enableCheckpointing(60000, CheckpointingMode.EXACTLY_ONCE);</p>
<p>// ConfigCheckpoint
CheckpointConfig config = env.getCheckpointConfig();
config.setMinPauseBetweenCheckpoints(30000);
config.setCheckpointTimeout(600000);
config.setMaxConcurrentCheckpoints(1);
config.enableExternalizedCheckpoints(ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);</p>
<p>// é‡å¯ Strategy
env.setRestartStrategy(RestartStrategies.fixedDelayRestart(
3, // é‡å¯æ¬¡æ•°
Time.of(10, TimeUnit.SECONDS) // é‡å¯é—´éš”
));</p>
<p>env.setRestartStrategy(RestartStrategies.exponentialDelayRestart(
Time.milliseconds(1),
Time.milliseconds(1000),</p>
<ol>
<li>2, // æŒ‡æ•°åŸºæ•°
Time.milliseconds(5000), // æœ€å¤§ Latency</li>
<li>1 // æŠ–åŠ¨å› å­
));</li>
</ol>
<pre><code>
# ä» Savepoint æ¢å¤
bin/flink run -s &lt;savepointPath&gt; &lt;jarFile&gt;

# DeleteSavepoint
bin/flink savepoint -d &lt;savepointPath&gt;

</code></pre>
<p>// 1. å…¨å±€å¹¶è¡Œåº¦
env.setParallelism(4);</p>
<p>// 2. ç®—å­å¹¶è¡Œåº¦
stream.map(...).setParallelism(2);</p>
<p>// 3. Slot å…±äº«ç»„
stream.map(...).slotSharingGroup(&quot;group1&quot;);</p>
<pre><code>taskmanager.memory.flink.size: 3g
taskmanager.memory.network.fraction: 0.1
taskmanager.memory.managed.fraction: 0.4

</code></pre>
<p>// æ‰¹é‡ä¼ è¾“
env.setBufferTimeout(100);</p>
<pre><code>backend.setPredefinedOptions(PredefinedOptions.SPINNING_DISK_OPTIMIZED);
backend.setDbStoragePath(&quot;/tmp/rocksdb&quot;);
env.setStateBackend(backend);

</code></pre>
<p>|:---|:---|:---|
| <strong>å¤„ç†æ¨¡å‹</strong> | çœŸæ­£çš„æµå¤„ç† | å¾®æ‰¹å¤„ç† |
| <strong>å»¶è¿Ÿ</strong> | æ¯«ç§’çº§ | ç§’çº§ |
| <strong>ååé‡</strong> | é«˜ | å¾ˆé«˜ |
| <strong>çŠ¶æ€ç®¡ç†</strong> | åŸç”Ÿæ”¯æŒ | æœ‰é™æ”¯æŒ |
| <strong>å®¹é”™</strong> | Checkpoint | RDD lineage |
| <strong>åå‹</strong> | åŸç”Ÿæ”¯æŒ | æœ‰é™æ”¯æŒ |</p>
<h2># 2. åå‹ (Backpressure) æœºåˆ¶</h2>
<ul>
<li><p><strong>é—®é¢˜</strong>: ä¸‹æ¸¸å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä¸Šæ¸¸äº§ç”Ÿé€Ÿåº¦</p>
</li>
<li><p><strong>Flink è§£å†³æ–¹æ¡ˆ</strong>:</p>
</li>
</ul>
<ol>
<li><strong>ä¿¡ç”¨æœºåˆ¶</strong>: åŸºäºä¿¡ç”¨çš„æµé‡æ§åˆ¶</li>
<li><strong>ç¼“å†²æ± </strong>: åŠ¨æ€è°ƒæ•´ç¼“å†²æ± å¤§å°</li>
<li><strong>ç½‘ç»œæ ˆ</strong>: TCP æµé‡æ§åˆ¶</li>
<li><strong>ç›‘æ§</strong>: Web UI æ˜¾ç¤ºåå‹æƒ…å†µ</li>
</ol>
<h2># 3. Exactly-Once è¯­ä¹‰ä¿è¯</h2>
<ul>
<li><strong>ç»„ä»¶</strong>:</li>
</ul>
<ol>
<li><strong>Source</strong>: å¯é‡æ”¾ï¼ˆå¦‚ Kafka offsetï¼‰</li>
<li><strong>å†…éƒ¨å¤„ç†</strong>: Checkpoint æœºåˆ¶</li>
<li><strong>Sink</strong>: ä¸¤é˜¶æ®µæäº¤æˆ–å¹‚ç­‰å†™å…¥</li>
</ol>
<pre><code class="language-java">// ä¸¤é˜¶æ®µæäº¤ Sink ç¤ºä¾‹
public class TwoPhaseCommitSink extends TwoPhaseCommitSinkFunction&lt;String, Transaction, Void&gt; {
@Override
protected Transaction beginTransaction() throws Exception {
return new Transaction();
}

@Override
protected void invoke(Transaction transaction, String value, Context context) throws Exception {
transaction.add(value);
}

@Override
protected void preCommit(Transaction transaction) throws Exception {
transaction.flush();
}

@Override
protected void commit(Transaction transaction) {
transaction.commit();
}

@Override
protected void abort(Transaction transaction) {
transaction.rollback();
}
}

</code></pre>
<ol>
<li><strong>Watermark</strong>: äº‹ä»¶æ—¶é—´çª—å£</li>
<li><strong>Processing Time</strong>: å¤„ç†æ—¶é—´çª—å£</li>
<li><strong>å…ƒç´ è®¡æ•°</strong>: è®¡æ•°çª—å£</li>
<li><strong>è‡ªå®šä¹‰</strong>: ç”¨æˆ·å®šä¹‰çš„è§¦å‘å™¨</li>
</ol>
<h2># 5. çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>é€‰æ‹©åˆé€‚çš„çŠ¶æ€ç±»å‹</strong>: ValueState vs ListState vs MapState</li>
<li><strong>è®¾ç½®çŠ¶æ€ TTL</strong>: é¿å…çŠ¶æ€æ— é™å¢é•¿</li>
<li><strong>é€‰æ‹©åˆé€‚çš„çŠ¶æ€åç«¯</strong>: å†…å­˜ vs æ–‡ä»¶ç³»ç»Ÿ vs RocksDB</li>
<li><strong>çŠ¶æ€å¤§å°ç›‘æ§</strong>: åŠæ—¶å‘ç°çŠ¶æ€è†¨èƒ€</li>
</ol>
<pre><code class="language-java">// SetStatusTTL
StateTtlConfig ttlConfig = StateTtlConfig
.newBuilder(Time.days(7))
.setUpdateType(StateTtlConfig.UpdateType.OnCreateAndWrite)
.setStateVisibility(StateTtlConfig.StateVisibility.NeverReturnExpired)
.build();

ValueStateDescriptor&lt;String&gt; descriptor = new ValueStateDescriptor&lt;&gt;(&quot;my-state&quot;, String.class);
descriptor.enableTimeToLive(ttlConfig);


1. **æ£€æµ‹æ•…éšœ**: JobManagerç›‘æ§TaskManagerå¿ƒè·³
2. **é‡å¯ä»»åŠ¡**: æ ¹æ®é‡å¯ç­–ç•¥é‡å¯å¤±è´¥ä»»åŠ¡
3. **æ¢å¤çŠ¶æ€**: ä»æœ€è¿‘çš„ Checkpoint æ¢å¤çŠ¶æ€
4. **é‡æ”¾æ•°æ®**: Source é‡æ”¾ Checkpoint ä¹‹åçš„æ•°æ®
5. **ç»§ç»­å¤„ç†**: æ¢å¤æ­£å¸¸å¤„ç†æµç¨‹
    ```
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-80">
                                                <h2>80. HBase</h2>
                                                <h1>HBase åˆ†å¸ƒå¼ NoSQL æ•°æ®åº“</h1>
<h2>Apache HBase æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ï¼ŒåŸºäº Google Bigtable è®ºæ–‡å®ç°ï¼Œè¿è¡Œåœ¨ HDFS ä¹‹ä¸Šã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#hbase-%E6%9E%B6%E6%9E%84"><strong>HBase æ¶æ„</strong></a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><strong>æ•°æ®æ¨¡å‹</strong></a></li>
<li><a href="#shell-%E6%93%8D%E4%BD%9C"><strong>Shell æ“ä½œ</strong></a></li>
<li><a href="#java-api"><strong>Java API</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><strong>æ€§èƒ½ä¼˜åŒ–</strong></a></li>
<li><a href="#%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86"><strong>é›†ç¾¤ç®¡ç†</strong></a></li>
<li><a href="#%E9%9D%A2%E8%AF%95%E8%A6%81%E7%82%B9"><strong>çŸ¥è¯†è¦ç‚¹</strong></a></li>
</ol>
<hr />
<h2>HBase æ¶æ„</h2>
<h2># æ ¸å¿ƒç»„ä»¶</h2>
<pre><code>RegionServer1 RegionServer2 RegionServer3
â†“ â†“ â†“
Region1,2 Region3,4 Region5,6
â†“ â†“ â†“
HDFS DataNode HDFS DataNode HDFS DataNode

</code></pre>
<p>| <strong>Region</strong> | è¡¨çš„æ°´å¹³åˆ†ç‰‡ï¼ŒåŒ…å«ä¸€å®šèŒƒå›´çš„è¡Œ |
| <strong>ZooKeeper</strong> | åè°ƒæœåŠ¡ï¼Œå­˜å‚¨å…ƒæ•°æ®ï¼Œæ•…éšœæ£€æµ‹ |
| <strong>HDFS</strong> | åº•å±‚å­˜å‚¨ç³»ç»Ÿ |</p>
<h2># Region è¯¦ç»†ç»“æ„</h2>
<pre><code>â”‚ â”œâ”€â”€ Index Block
â”‚ â””â”€â”€ Bloom Filter
â””â”€â”€ WAL (Write-Ahead Log)

</code></pre>
<ol start="3">
<li><strong>MemStore</strong>: æ•°æ®å†™å…¥å†…å­˜</li>
<li><strong>Flush</strong>: MemStore è¾¾åˆ°é˜ˆå€¼æ—¶åˆ·å†™åˆ° HFile</li>
<li><strong>Compaction</strong>: å®šæœŸåˆå¹¶ HFile</li>
</ol>
<h3># è¯»å–æµç¨‹</h3>
<ol>
<li><strong>Client</strong> â†’ <strong>RegionServer</strong>: è¯»è¯·æ±‚</li>
<li><strong>MemStore</strong>: å…ˆæŸ¥å†…å­˜ä¸­çš„æ•°æ®</li>
<li><strong>BlockCache</strong>: æŸ¥è¯¢ç¼“å­˜çš„ HFile å—</li>
<li><strong>HFile</strong>: ä»ç£ç›˜è¯»å–æ•°æ®</li>
<li><strong>Merge</strong>: åˆå¹¶å¤šä¸ªæ¥æºçš„æ•°æ®è¿”å›</li>
</ol>
<hr />
<h2>æ•°æ®æ¨¡å‹</h2>
<h2># é€»è¾‘è§†å›¾</h2>
<pre><code>â”‚ â”‚ â””â”€â”€ age:25 (timestamp:1234567891)
â”‚ â””â”€â”€ Column Family: contact_info
â”‚ â”œâ”€â”€ email:zhang@example.com (timestamp:1234567892)
â”‚ â””â”€â”€ phone:13800138000 (timestamp:1234567893)
â””â”€â”€ Row Key: user002
â””â”€â”€ ...

</code></pre>
<p>user002:name:1234567900 â†’ li_si</p>
<p>contact_info Store:
user001:email:1234567892 â†’ zhang@example.com
user001:phone:1234567893 â†’ 13800138000</p>
<pre><code>| **Column Family** | åˆ—æ—ï¼Œåˆ—çš„é€»è¾‘åˆ†ç»„ |
| **Column Qualifier** | åˆ—é™å®šç¬¦ï¼Œåˆ—æ—ä¸‹çš„å…·ä½“åˆ— |
| **Cell** | å•å…ƒæ ¼ï¼Œç”±(row, column family, column qualifier, timestamp)ç¡®å®š |
| **Timestamp** | æ—¶é—´æˆ³ï¼ŒåŒä¸€ Cell çš„å¤šä¸ªç‰ˆæœ¬ |
---
## Shell æ“ä½œ

## # è¿æ¥ä¸åŸºæœ¬æ“ä½œ

```bash
# StartHBase Shell
hbase shell

# ViewStatus
status
version

# ViewClusterInformation
whoami

</code></pre>
<h1>ListNamespace</h1>
<p>list_namespace</p>
<h1>DeleteNamespace</h1>
<p>drop_namespace 'my_namespace'</p>
<pre><code>
# Createtableï¼ˆå¸¦Configï¼‰
create 'user_info',
{NAME =&gt; 'basic_info', VERSIONS =&gt; 3, TTL =&gt; 2592000},
{NAME =&gt; 'contact_info', COMPRESSION =&gt; 'SNAPPY'}

# Listtable
list

# View tableç»“æ„
describe 'user_info'

# ç¦ç”¨table
disable 'user_info'

# Enabledtable
enable 'user_info'

# Deletetable
drop 'user_info'

# ä¿®æ”¹è¡¨ç»“æ„
alter 'user_info', {NAME =&gt; 'basic_info', VERSIONS =&gt; 5}

</code></pre>
<p>put 'user_info', 'user001', 'basic_info:age', '25'
put 'user_info', 'user001', 'contact_info:email', 'zhang@example.com'</p>
<h1>æŸ¥è¯¢å•è¡Œ</h1>
<p>get 'user_info', 'user001'</p>
<h1>æŸ¥è¯¢æŒ‡å®šåˆ—æ—</h1>
<p>get 'user_info', 'user001', 'basic_info'</p>
<h1>æŸ¥è¯¢æŒ‡å®šåˆ—</h1>
<p>get 'user_info', 'user001', 'basic_info:name'</p>
<h1>æ‰«æè¡¨</h1>
<p>scan 'user_info'</p>
<h1>æ¡ä»¶æ‰«æ</h1>
<p>scan 'user_info', {STARTROW =&gt; 'user001', ENDROW =&gt; 'user999'}
scan 'user_info', {FILTER =&gt; &quot;SingleColumnValueFilter('basic_info', 'age', &gt;=, 'binary:18')&quot;}</p>
<h1>åˆ é™¤æ•°æ®</h1>
<p>delete 'user_info', 'user001', 'basic_info:age'</p>
<h1>åˆ é™¤è¡Œ</h1>
<p>deleteall 'user_info', 'user001'</p>
<h1>è®¡æ•°</h1>
<p>count 'user_info'</p>
<pre><code>// ConfigConnect
Configuration conf = HBaseConfiguration.create();
conf.set(&quot;hbase.zookeeper.quorum&quot;, &quot;node1,node2,node3&quot;);
conf.set(&quot;hbase.zookeeper.property.clientPort&quot;, &quot;2181&quot;);

// CreateConnect
Connection connection = ConnectionFactory.createConnection(conf);
Admin admin = connection.getAdmin();

</code></pre>
<p>HTableDescriptor tableDesc = new HTableDescriptor(tableName);</p>
<p>// Add åˆ—æ—
HColumnDescriptor basicInfo = new HColumnDescriptor(&quot;basic_info&quot;);
basicInfo.setMaxVersions(3);
basicInfo.setTimeToLive(30 _ 24 _ 60 * 60); // 30 å¤© TTL</p>
<p>HColumnDescriptor contactInfo = new HColumnDescriptor(&quot;contact_info&quot;);
contactInfo.setCompressionType(Compression.Algorithm.SNAPPY);</p>
<p>tableDesc.addFamily(basicInfo);
tableDesc.addFamily(contactInfo);</p>
<p>// Createtable
admin.createTable(tableDesc);</p>
<pre><code>Put put = new Put(Bytes.toBytes(&quot;user001&quot;));
put.addColumn(Bytes.toBytes(&quot;basic_info&quot;), Bytes.toBytes(&quot;name&quot;), Bytes.toBytes(&quot;zhang_san&quot;));
put.addColumn(Bytes.toBytes(&quot;basic_info&quot;), Bytes.toBytes(&quot;age&quot;), Bytes.toBytes(&quot;25&quot;));
table.put(put);

// æ‰¹é‡æ’å…¥
List&lt;Put&gt; puts = new ArrayList&lt;&gt;();
for (int i = 0; i &lt; 1000; i++) {
Put batchPut = new Put(Bytes.toBytes(&quot;user&quot; + String.format(&quot;%03d&quot;, i)));
batchPut.addColumn(Bytes.toBytes(&quot;basic_info&quot;), Bytes.toBytes(&quot;name&quot;), Bytes.toBytes(&quot;user&quot; + i));
puts.add(batchPut);
}
table.put(puts);

// æŸ¥è¯¢æ•°æ®
Get get = new Get(Bytes.toBytes(&quot;user001&quot;));
get.addFamily(Bytes.toBytes(&quot;basic_info&quot;));
Result result = table.get(get);

// è§£æç»“æœ
for (Cell cell : result.listCells()) {
String family = Bytes.toString(CellUtil.cloneFamily(cell));
String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
String value = Bytes.toString(CellUtil.cloneValue(cell));
System.out.println(family + &quot;:&quot; + qualifier + &quot; = &quot; + value);
}

// æ‰«ææ•°æ®
Scan scan = new Scan();
scan.setStartRow(Bytes.toBytes(&quot;user001&quot;));
scan.setStopRow(Bytes.toBytes(&quot;user999&quot;));
scan.addFamily(Bytes.toBytes(&quot;basic_info&quot;));

ResultScanner scanner = table.getScanner(scan);
for (Result res : scanner) {
// ProcessResult
}
scanner.close();

</code></pre>
<p>Bytes.toBytes(&quot;basic_info&quot;),
Bytes.toBytes(&quot;age&quot;),
CompareFilter.CompareOp.GREATER_OR_EQUAL,
Bytes.toBytes(&quot;18&quot;)
);</p>
<p>// å‰ç¼€è¿‡æ»¤å™¨
PrefixFilter prefixFilter = new PrefixFilter(Bytes.toBytes(&quot;user00&quot;));</p>
<p>// ç»„åˆè¿‡æ»¤å™¨
FilterList filterList = new FilterList(FilterList.Operator.MUST_PASS_ALL);
filterList.addFilter(filter);
filterList.addFilter(prefixFilter);</p>
<p>scan.setFilter(filterList);</p>
<pre><code>// 1. é¿å…çƒ­ç‚¹ï¼šä½¿ç”¨æ•£åˆ—å‰ç¼€
String rowKey = MD5Hash.digest(userId).toString().substring(0, 2) + &quot;_&quot; + userId;

// 2. æ—¶é—´å€’åºï¼šä¾¿äºæŸ¥è¯¢æœ€æ–°æ•°æ®
String rowKey = userId + &quot;_&quot; + (Long.MAX_VALUE - timestamp);

// 3. ç»„åˆKeyï¼šSupportå¤šç»´Query
String rowKey = region + &quot;_&quot; + userId + &quot;_&quot; + timestamp;

</code></pre>
<p>{NAME =&gt; 'profile', COMPRESSION =&gt; 'SNAPPY'}, // ç”¨æˆ· Basic information
{NAME =&gt; 'behavior', TTL =&gt; 604800} // ç”¨æˆ·è¡Œä¸º Data(7 å¤© TTL)</p>
<p>// é¿å…ï¼šåˆ—æ—è¿‡å¤š
// é¿å…ï¼šä¸åŒè®¿é—®æ¨¡å¼åˆ—æ”¾ in/at åŒä¸€åˆ—æ—</p>
<pre><code>for (UserData user : userData) {
Put put = createPut(user);
puts.add(put);

// æ‰¹é‡æäº¤
if (puts.size() &gt;= 1000) {
table.put(puts);
puts.clear();
}
}
// æäº¤å‰©ä½™æ•°æ®
if (!puts.isEmpty()) {
table.put(puts);
}

</code></pre>
<p>family.setBlockCacheEnabled(true);
family.setCacheBloomsOnWrite(true);
family.setCacheDataOnWrite(true);
family.setCacheIndexesOnWrite(true);</p>
<pre><code># æ‰‹åŠ¨åˆ†è£‚ Region
split 'user_info', 'user500'

# åˆå¹¶ Region
merge_region 'region1_encoded_name', 'region2_encoded_name'

# ViewRegionInformation
list_regions 'user_info'

</code></pre>
<p>balancer</p>
<h1>æŸ¥çœ‹è´Ÿè½½å‡è¡¡çŠ¶æ€</h1>
<p>balancer_enabled</p>
<pre><code>
# æ‰‹åŠ¨è§¦å‘ Minor Compaction
compact 'user_info'

# ViewCompressStatus
compaction_state 'user_info'

</code></pre>
<h1>ViewRegionServerInformation</h1>
<p>list_regionservers</p>
<h1>View tableStatisticsInformation</h1>
<p>list_table_stats 'user_info'</p>
<pre><code>|:---|:---|:---|
| **æ•°æ®æ¨¡å‹** | åˆ—æ—æ¨¡å‹ | å…³ç³»æ¨¡å‹ |
| **ACID** | è¡Œçº§åŸå­æ€§ | å®Œæ•´ACID |
| **æ‰©å±•æ€§** | æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±• |
| **æŸ¥è¯¢è¯­è¨€** | NoSQL API | SQL |
| **é€‚ç”¨åœºæ™¯** | å¤§æ•°æ®è¯»å†™ | å¤æ‚äº‹åŠ¡ |

## # 2. æ•°æ®å€¾æ–œé—®é¢˜

* *é—®é¢˜**: Region çƒ­ç‚¹ï¼ŒæŸäº›Regionè®¿é—®é‡è¿‡å¤§

* *è§£å†³æ–¹æ¡ˆ**:
1. **Row Keyè®¾è®¡**: é¿å…å•è°ƒé€’å¢ï¼Œä½¿ç”¨æ•£åˆ—å‰ç¼€
2. **é¢„åˆ†åŒº**: åˆ›å»ºè¡¨æ—¶é¢„å…ˆåˆ†åŒº
3. **è´Ÿè½½å‡è¡¡**: å®šæœŸæ‰§è¡Œbalanceæ“ä½œ

```java
// é¢„PartitionExample
byte[][] splits = new byte[10][];
for (int i = 0; i &lt; 10; i++) {
splits[i] = Bytes.toBytes(String.format(&quot;%02d&quot;, i));
}
admin.createTable(tableDesc, splits);

</code></pre>
<ol start="2">
<li><strong>Block Cache</strong>: ç¼“å­˜çƒ­ç‚¹æ•°æ®</li>
<li><strong>å‹ç¼©</strong>: å‡å°‘å­˜å‚¨ç©ºé—´å’Œ IO</li>
<li><strong>é¢„è¯»</strong>: è®¾ç½®åˆç†çš„æ‰«æç¼“å­˜</li>
</ol>
<pre><code class="language-java">// ConfigBloom Filter
HColumnDescriptor family = new HColumnDescriptor(&quot;data&quot;);
family.setBloomFilterType(BloomType.ROW);

</code></pre>
<ol start="2">
<li><strong>WAL</strong>: æ ¹æ®éœ€è¦å…³é—­ WAL</li>
<li><strong>MemStore</strong>: è°ƒæ•´å†…å­˜å¤§å°</li>
<li><strong>å‹ç¼©</strong>: å¼‚æ­¥å‹ç¼©</li>
</ol>
<pre><code class="language-java">// å…³é—­WALï¼ˆDataSecurityæ€§é™ä½ï¼‰
put.setDurability(Durability.SKIP_WAL);

</code></pre>
<ol start="2">
<li><strong>Region è¿ç§»</strong>: è‡ªåŠ¨è¿ç§»æ•…éšœèŠ‚ç‚¹çš„ Region</li>
<li><strong>ZooKeeper</strong>: ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œåè°ƒæ•…éšœæ¢å¤</li>
<li><strong>æ•°æ®å‰¯æœ¬</strong>: ä¾èµ– HDFS çš„æ•°æ®å‰¯æœ¬æœºåˆ¶</li>
</ol>
<h2># 6. çƒ­ç‚¹é—®é¢˜è¯Šæ–­</h2>
<pre><code class="language-bash"># 1. ViewRegionåˆ†å¸ƒ
list_regions 'table_name'

# 2. ViewRegionServerè´Ÿè½½
status 'detailed'

# 3. Analysisè®¿é—®æ¨¡å¼

# é€šè¿‡æ—¥å¿—åˆ†æçƒ­ç‚¹ Row Key

# 4. Re-è®¾è®¡Row Key

# æ·»åŠ æ•£åˆ—å‰ç¼€æˆ–ä½¿ç”¨åå‘æ—¶é—´æˆ³

</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-81">
                                                <h2>81. Hive</h2>
                                                <h1>Hive æ•°æ®ä»“åº“</h1>
<h2>Apache Hive æ˜¯åŸºäº Hadoop çš„æ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºæ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç±» SQL æŸ¥è¯¢åŠŸèƒ½ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#hive-%E6%9E%B6%E6%9E%84"><strong>Hive æ¶æ„</strong></a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F"><strong>æ•°æ®ç±»å‹ä¸å­˜å‚¨æ ¼å¼</strong></a></li>
<li><a href="#ddl-%E6%93%8D%E4%BD%9C"><strong>DDL æ“ä½œ</strong></a></li>
<li><a href="#dml-%E6%93%8D%E4%BD%9C"><strong>DML æ“ä½œ</strong></a></li>
<li><a href="#%E5%88%86%E5%8C%BA%E4%B8%8E%E5%88%86%E6%A1%B6"><strong>åˆ†åŒºä¸åˆ†æ¡¶</strong></a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E4%B8%8Eudf"><strong>å‡½æ•°ä¸ UDF</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><strong>æ€§èƒ½ä¼˜åŒ–</strong></a></li>
<li><a href="#%E9%9D%A2%E8%AF%95%E8%A6%81%E7%82%B9"><strong>çŸ¥è¯†è¦ç‚¹</strong></a></li>
</ol>
<hr />
<h2>Hive æ¶æ„</h2>
<h2># æ ¸å¿ƒç»„ä»¶</h2>
<pre><code>Metastore (Metadata storage)
â†“
HDFS (Data storage) + MapReduce/Tez/Spark (Compute engine)

</code></pre>
<p>| <strong>Driver</strong> | è§£æ SQLã€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€åè°ƒæ‰§è¡Œ |
| <strong>Execution Engine</strong> | æ‰§è¡Œå¼•æ“ï¼ˆMapReduce/Tez/Sparkï¼‰ |</p>
<h2># å·¥ä½œæµç¨‹</h2>
<ol>
<li><strong>SQL è§£æ</strong>: è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ è¯­ä¹‰åˆ†æ</li>
<li><strong>é€»è¾‘è®¡åˆ’</strong>: ç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’</li>
<li><strong>ç‰©ç†è®¡åˆ’</strong>: è½¬æ¢ä¸º MapReduce/Tez/Spark ä»»åŠ¡</li>
<li><strong>æ‰§è¡Œ</strong>: æäº¤åˆ° Hadoop é›†ç¾¤æ‰§è¡Œ</li>
</ol>
<hr />
<h2>æ•°æ®ç±»å‹ä¸å­˜å‚¨æ ¼å¼</h2>
<h2># åŸºæœ¬æ•°æ®ç±»å‹</h2>
<table>
<thead>
<tr>
  <th style="text-align:left">ç±»å‹</th>
  <th style="text-align:left">æè¿°</th>
  <th style="text-align:left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left"><code>TINYINT</code></td>
  <td style="text-align:left">1 å­—èŠ‚æ•´æ•°</td>
  <td style="text-align:left">-128 åˆ° 127</td>
</tr>
<tr>
  <td style="text-align:left"><code>SMALLINT</code></td>
  <td style="text-align:left">2 å­—èŠ‚æ•´æ•°</td>
  <td style="text-align:left">-32,768 åˆ° 32,767</td>
</tr>
<tr>
  <td style="text-align:left"><code>INT</code></td>
  <td style="text-align:left">4 å­—èŠ‚æ•´æ•°</td>
  <td style="text-align:left">-2,147,483,648 åˆ° 2,147,483,647</td>
</tr>
<tr>
  <td style="text-align:left"><code>BIGINT</code></td>
  <td style="text-align:left">8 å­—èŠ‚æ•´æ•°</td>
  <td style="text-align:left">-9,223,372,036,854,775,808 åˆ° 9,223,372,036,854,775,807</td>
</tr>
<tr>
  <td style="text-align:left"><code>FLOAT</code></td>
  <td style="text-align:left">4 å­—èŠ‚æµ®ç‚¹æ•°</td>
  <td style="text-align:left">3.14159</td>
</tr>
<tr>
  <td style="text-align:left"><code>DOUBLE</code></td>
  <td style="text-align:left">8 å­—èŠ‚æµ®ç‚¹æ•°</td>
  <td style="text-align:left">3.141592653589793</td>
</tr>
<tr>
  <td style="text-align:left"><code>STRING</code></td>
  <td style="text-align:left">å­—ç¬¦ä¸²</td>
  <td style="text-align:left">'Hello World'</td>
</tr>
<tr>
  <td style="text-align:left"><code>BOOLEAN</code></td>
  <td style="text-align:left">å¸ƒå°”å€¼</td>
  <td style="text-align:left">TRUE/FALSE</td>
</tr>
<tr>
  <td style="text-align:left"><code>TIMESTAMP</code></td>
  <td style="text-align:left">æ—¶é—´æˆ³</td>
  <td style="text-align:left">'2023-01-01 12:00:00'</td>
</tr>
<tr>
  <td style="text-align:left"><code>DATE</code></td>
  <td style="text-align:left">æ—¥æœŸ</td>
  <td style="text-align:left">'2023-01-01'</td>
</tr>
</tbody>
</table>
<h2># å¤æ‚æ•°æ®ç±»å‹</h2>
<pre><code class="language-sql">- - Array
ARRAY&lt;data_type&gt;
- - ç¤ºä¾‹ï¼šARRAY&lt;STRING&gt;

- - Map
MAP&lt;primitive_type, data_type&gt;
- - ç¤ºä¾‹ï¼šMAP&lt;STRING, INT&gt;

- - ç»“æ„ä½“
STRUCT&lt;col_name:data_type [COMMENT col_comment], ...&gt;
- - ç¤ºä¾‹ï¼šSTRUCT&lt;name:STRING, age:INT&gt;

- - è”åˆä½“
UNIONTYPE&lt;data_type, data_type, ...&gt;

</code></pre>
<p>| <strong>SequenceFile</strong> | ä¸­ | ä¸­ | ä¸­ | ä¸­é—´æ•°æ® |
| <strong>RCFile</strong> | é«˜ | ä¸­ | ä½ | åˆ—å¼åˆ†æ |
| <strong>ORC</strong> | å¾ˆé«˜ | å¾ˆé«˜ | ä½ | OLAP åˆ†æ |
| <strong>Parquet</strong> | å¾ˆé«˜ | å¾ˆé«˜ | ä½ | è·¨å¹³å°åˆ†æ |</p>
<hr />
<h2>DDL æ“ä½œ</h2>
<h2># æ•°æ®åº“æ“ä½œ</h2>
<pre><code class="language-sql">- - åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS mydb
COMMENT 'My database'
LOCATION '/user/hive/warehouse/mydb.db';

- - ä½¿ç”¨æ•°æ®åº“
USE mydb;

- - æ˜¾ç¤ºæ•°æ®åº“
SHOW DATABASES;

- - åˆ é™¤æ•°æ®åº“
DROP DATABASE IF EXISTS mydb CASCADE;

</code></pre>
<p>id INT,
name STRING,
salary DOUBLE,
department STRING
)
STORED AS ORC
TBLPROPERTIES ('orc.compress'='SNAPPY');</p>
<pre><code>name STRING,
salary DOUBLE,
department STRING
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE
LOCATION '/data/employee/';

</code></pre>
<p>name STRING,
salary DOUBLE
)
PARTITIONED BY (department STRING, year INT)
STORED AS ORC;</p>
<pre><code>
- - ä¿®æ”¹åˆ—
ALTER TABLE employee CHANGE salary salary DECIMAL(10,2);

- - æ·»åŠ åˆ†åŒº
ALTER TABLE partitioned_employee ADD PARTITION (department='IT', year=2023);

- - åˆ é™¤åˆ†åŒº
ALTER TABLE partitioned_employee DROP PARTITION (department='IT', year=2023);

- - é‡å‘½åè¡¨
ALTER TABLE employee RENAME TO emp;

</code></pre>
<ul>
<li><ul>
<li>æ’å…¥æ•°æ®
INSERT INTO employee VALUES (1, 'John', 5000.0, 'IT');</li>
</ul>
</li>
<li><ul>
<li>ä»æŸ¥è¯¢æ’å…¥
INSERT INTO employee
SELECT id, name, salary, department
FROM temp_employee;</li>
</ul>
</li>
<li><ul>
<li>è¦†ç›–æ’å…¥
INSERT OVERWRITE TABLE employee
SELECT * FROM temp_employee;</li>
</ul>
</li>
<li><ul>
<li>åˆ†åŒºæ’å…¥
INSERT INTO partitioned_employee PARTITION(department='IT', year=2023)
SELECT id, name, salary FROM temp_employee;</li>
</ul>
</li>
<li><ul>
<li>åŠ¨æ€åˆ†åŒºæ’å…¥
SET hive.exec.dynamic.partition=true;
SET hive.exec.dynamic.partition.mode=nonstrict;</li>
</ul>
</li>
</ul>
<p>INSERT INTO partitioned_employee PARTITION(department, year)
SELECT id, name, salary, department, year FROM temp_employee;</p>
<pre><code>
- - èšåˆæŸ¥è¯¢
SELECT department, AVG(salary) as avg_salary
FROM employee
GROUP BY department
HAVING AVG(salary) &gt; 6000;

- - è¿æ¥æŸ¥è¯¢
SELECT e.name, d.dept_name
FROM employee e
JOIN department d ON e.department = d.dept_id;

- - çª—å£å‡½æ•°
SELECT name, salary,
ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) as rank
FROM employee;

</code></pre>
<pre><code class="language-sql">- - é™æ€åˆ†åŒº
INSERT INTO partitioned_employee PARTITION(department='IT', year=2023)
SELECT id, name, salary FROM source_table;

- - åŠ¨æ€åˆ†åŒº
INSERT INTO partitioned_employee PARTITION(department, year)
SELECT id, name, salary, department, year FROM source_table;

- - æŸ¥è¯¢ç‰¹å®šåˆ†åŒº
SELECT * FROM partitioned_employee
WHERE department='IT' AND year=2023;

</code></pre>
<p>CREATE TABLE bucketed_employee (
id INT,
name STRING,
salary DOUBLE,
department STRING
)
CLUSTERED BY (id) INTO 4 BUCKETS
STORED AS ORC;</p>
<ul>
<li><ul>
<li>å¯ç”¨åˆ†æ¡¶
SET hive.enforce.bucketing=true;</li>
</ul>
</li>
<li><ul>
<li>æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨åˆ†æ¡¶ï¼‰
INSERT INTO bucketed_employee
SELECT * FROM employee;</li>
</ul>
</li>
</ul>
<pre><code>
```sql
- - å­—ç¬¦ä¸²æ“ä½œ
SELECT
CONCAT(first_name, ' ', last_name) as full_name,
UPPER(name) as upper_name,
LENGTH(name) as name_length,
SUBSTR(name, 1, 3) as name_prefix
FROM employee;

</code></pre>
<p>FROM_UNIXTIME(UNIX_TIMESTAMP()) as current_time,
YEAR(hire_date) as hire_year,
DATEDIFF(CURRENT_DATE, hire_date) as days_since_hire
FROM employee;</p>
<pre><code>COUNT(*) as total_count,
SUM(salary) as total_salary,
AVG(salary) as avg_salary,
MAX(salary) as max_salary,
MIN(salary) as min_salary,
STDDEV(salary) as salary_stddev
FROM employee;

</code></pre>
<p>public String evaluate(String input) {
if (input == null) return null;
return input.toUpperCase();
}
}</p>
<pre><code>
- - ä½¿ç”¨ UDF
SELECT my_upper(name) FROM employee;

</code></pre>
<ul>
<li><ul>
<li>é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ ¼å¼
CREATE TABLE optimized_table (
col1 STRING,
col2 INT
)
STORED AS ORC
TBLPROPERTIES (
'orc.compress'='SNAPPY',
'orc.create.index'='true'
);</li>
</ul>
</li>
</ul>
<pre><code>SELECT * FROM partitioned_table
WHERE partition_col = 'value';

- - é¿å…ï¼šå…¨è¡¨æ‰«æ
SELECT * FROM partitioned_table
WHERE non_partition_col = 'value';

</code></pre>
<ul>
<li><ul>
<li>é¿å…ï¼šSELECT _
SELECT _ FROM employee;</li>
</ul>
</li>
</ul>
<pre><code>FROM employee e
JOIN department d ON e.dept_id = d.id
WHERE e.salary &gt; 5000;

</code></pre>
<ul>
<li><ul>
<li>å¯ç”¨ä»£ä»·ä¼˜åŒ–å™¨
SET hive.cbo.enable=true;</li>
</ul>
</li>
<li><ul>
<li>è®¾ç½®åˆç†çš„ MapReduce å‚æ•°
SET mapreduce.job.reduces=10;
SET hive.exec.reducers.bytes.per.reducer=1000000000;</li>
</ul>
</li>
<li><ul>
<li>å¯ç”¨å¹¶è¡Œæ‰§è¡Œ
SET hive.exec.parallel=true;
SET hive.exec.parallel.thread.number=8;</li>
</ul>
</li>
</ul>
<pre><code>|:---|:---|:---|
| **æ•°æ®é‡** | PBçº§ | GB-TBçº§ |
| **å»¶è¿Ÿ** | é«˜ï¼ˆç§’-åˆ†é’Ÿï¼‰ | ä½ï¼ˆæ¯«ç§’ï¼‰ |
| **ACID** | æœ‰é™æ”¯æŒ | å®Œå…¨æ”¯æŒ |
| **ç´¢å¼•** | æœ‰é™ | ä¸°å¯Œ |
| **æ‰©å±•æ€§** | æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±• |
| **é€‚ç”¨åœºæ™¯** | ç¦»çº¿åˆ†æ | åœ¨çº¿äº‹åŠ¡ |

## # 2. å†…éƒ¨è¡¨ vs å¤–éƒ¨è¡¨

| ç‰¹æ€§ | å†…éƒ¨è¡¨ | å¤–éƒ¨è¡¨ |
|:---|:---|:---|
| **æ•°æ®ç®¡ç†** | Hiveç®¡ç† | ç”¨æˆ·ç®¡ç† |
| **åˆ é™¤è¡¨** | åˆ é™¤å…ƒæ•°æ®å’Œæ•°æ® | åªåˆ é™¤å…ƒæ•°æ® |
| **æ•°æ®ä½ç½®** | Hiveä»“åº“ç›®å½• | ç”¨æˆ·æŒ‡å®šä½ç½® |
| **ä½¿ç”¨åœºæ™¯** | ä¸´æ—¶æ•°æ®ã€ä¸­é—´ç»“æœ | å…±äº«æ•°æ®ã€å¤–éƒ¨æ•°æ®æº |

## # 3. æ•°æ®å€¾æ–œè§£å†³æ–¹æ¡ˆ

```sql
- - 1. å¢åŠ  Reduce ä»»åŠ¡æ•°
SET mapreduce.job.reduces=100;

- - 2. å¯ç”¨è´Ÿè½½å‡è¡¡
SET hive.groupby.skewindata=true;

- - 3. ä½¿ç”¨éšæœºå‰ç¼€
SELECT /*+ MAPJOIN(b) */ *
FROM (
SELECT CONCAT(CAST(RAND() * 100 AS INT), '_', key) as new_key, value
FROM skewed_table
) a
JOIN small_table b ON a.key = b.key;

</code></pre>
<ul>
<li><ul>
<li><ol>
<li>åˆå¹¶å°æ–‡ä»¶
SET hive.merge.mapfiles=true;
SET hive.merge.mapredfiles=true;
SET hive.merge.size.per.task=256000000;</li>
</ol>
</li>
</ul>
</li>
<li><ul>
<li><ol start="2">
<li>ä½¿ç”¨ Concatenate
ALTER TABLE table_name CONCATENATE;</li>
</ol>
</li>
</ul>
</li>
<li><ul>
<li><ol start="3">
<li>é‡æ–°ç»„ç»‡æ•°æ®
INSERT OVERWRITE TABLE new_table
SELECT * FROM old_table;</li>
</ol>
</li>
</ul>
</li>
</ul>
<pre><code>4. **åˆ†æ¡¶**: å¯¹å¤§è¡¨ä½¿ç”¨åˆ†æ¡¶
5. **ç´¢å¼•**: åˆ›å»ºé€‚å½“çš„ç´¢å¼•
6. **ç¼“å­˜**: ç¼“å­˜çƒ­ç‚¹æ•°æ®
7. **å¹¶è¡Œåº¦**: è°ƒæ•´Map/Reduceä»»åŠ¡æ•°
8. **èµ„æº**: åˆç†åˆ†é…å†…å­˜å’ŒCPU
</code></pre>

                                            </div>
                                            
                                            <div class="section" id="section-82">
                                                <h2>82. Spark</h2>
                                                <h1>Apache Spark å¤§æ•°æ®å¤„ç†</h1>
<h2>Apache Spark æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å¤§æ•°æ®å¤„ç†å¼•æ“ï¼Œæ”¯æŒæ‰¹å¤„ç†ã€æµå¤„ç†ã€æœºå™¨å­¦ä¹ å’Œå›¾è®¡ç®—ã€‚</h2>
<h2>ç›®å½•</h2>
<ol>
<li><a href="#spark-%E6%9E%B6%E6%9E%84"><strong>Spark æ¶æ„</strong></a></li>
<li><a href="#rdd-%E7%BC%96%E7%A8%8B"><strong>RDD ç¼–ç¨‹</strong></a></li>
<li><a href="#dataframe--dataset"><strong>DataFrame &amp; Dataset</strong></a></li>
<li><a href="#spark-sql"><strong>Spark SQL</strong></a></li>
<li><a href="#spark-streaming"><strong>Spark Streaming</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><strong>æ€§èƒ½ä¼˜åŒ–</strong></a></li>
<li><a href="#%E9%9D%A2%E8%AF%95%E8%A6%81%E7%82%B9"><strong>çŸ¥è¯†è¦ç‚¹</strong></a></li>
</ol>
<hr />
<h2>Spark æ¶æ„</h2>
<h2># é›†ç¾¤æ¶æ„</h2>
<pre><code>Cluster Manager (YARN/Mesos/Standalone)
â†“
Worker Node1 Worker Node2 Worker Node3
â”œâ”€â”€ Executor1 â”œâ”€â”€ Executor1 â”œâ”€â”€ Executor1
â”‚ â”œâ”€â”€ Task1 â”‚ â”œâ”€â”€ Task1 â”‚ â”œâ”€â”€ Task1
â”‚ â””â”€â”€ Task2 â”‚ â””â”€â”€ Task2 â”‚ â””â”€â”€ Task2
â””â”€â”€ Cache â””â”€â”€ Cache â””â”€â”€ Cache

</code></pre>
<p>| <strong>SparkContext</strong> | Spark ç¨‹åºå…¥å£ï¼Œåè°ƒé›†ç¾¤èµ„æº |
| <strong>Cluster Manager</strong> | é›†ç¾¤èµ„æºç®¡ç†å™¨ |
| <strong>Worker Node</strong> | é›†ç¾¤ä¸­çš„å·¥ä½œèŠ‚ç‚¹ |
| <strong>Executor</strong> | è¿è¡Œåœ¨ Worker ä¸Šçš„è¿›ç¨‹ï¼Œæ‰§è¡Œ Task |
| <strong>Task</strong> | æœ€å°çš„å·¥ä½œå•å…ƒ |</p>
<h2># è¿è¡Œæµç¨‹</h2>
<ol>
<li><strong>Driver åˆ›å»º SparkContext</strong></li>
<li><strong>èµ„æºç”³è¯·</strong>: å‘ Cluster Manager ç”³è¯·èµ„æº</li>
<li><strong>ä»»åŠ¡è°ƒåº¦</strong>: DAG Scheduler å°† Job åˆ†è§£ä¸º Stage å’Œ Task</li>
<li><strong>ä»»åŠ¡åˆ†å‘</strong>: Task Scheduler å°† Task åˆ†å‘åˆ° Executor</li>
<li><strong>ä»»åŠ¡æ‰§è¡Œ</strong>: Executor æ‰§è¡Œ Task å¹¶è¿”å›ç»“æœ</li>
</ol>
<hr />
<h2>RDD ç¼–ç¨‹</h2>
<h2># RDD åŸºæœ¬æ¦‚å¿µ</h2>
<ul>
<li><strong>RDD (Resilient Distributed Dataset)</strong>: å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†</li>
</ul>
<h3># ç‰¹æ€§</h3>
<ul>
<li><p><strong>ä¸å¯å˜æ€§</strong>: RDD ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹</p>
</li>
<li><p><strong>åˆ†åŒºæ€§</strong>: æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªåˆ†åŒº</p>
</li>
<li><p><strong>å®¹é”™æ€§</strong>: é€šè¿‡è¡€ç»Ÿ(Lineage)æ¢å¤ä¸¢å¤±æ•°æ®</p>
</li>
<li><p><strong>æƒ°æ€§æ±‚å€¼</strong>: åªæœ‰åœ¨ Action æ“ä½œæ—¶æ‰ä¼šæ‰§è¡Œ</p>
</li>
</ul>
<h2># RDD åˆ›å»º</h2>
<pre><code class="language-scala">import org.apache.spark.{SparkConf, SparkContext}

val conf = new SparkConf().setAppName(&quot;SparkExample&quot;).setMaster(&quot;local[*]&quot;)
val sc = new SparkContext(conf)

// 1. ä»é›†åˆåˆ›å»º
val rdd1 = sc.parallelize(List(1, 2, 3, 4, 5))
val rdd2 = sc.makeRDD(Array(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;))

// 2. ä»å¤–éƒ¨å­˜å‚¨åˆ›å»º
val rdd3 = sc.textFile(&quot;hdfs://path/to/file&quot;)
val rdd4 = sc.wholeTextFiles(&quot;hdfs://path/to/directory&quot;)

// 3. ä»å…¶ä»– RDD åˆ›å»º
val rdd5 = rdd1.map(_ * 2)

</code></pre>
<p>val mapped = data.map(_ * 2)</p>
<p>// 2. filter - Filter
val filtered = data.filter(_ % 2 == 0)</p>
<p>// 3. flatMap - ä¸€å¯¹å¤šè½¬æ¢
val words = sc.parallelize(List(&quot;hello world&quot;, &quot;spark scala&quot;))
val flatMapped = words.flatMap(_.split(&quot; &quot;))</p>
<p>// 4. distinct - å»é‡
val distincted = data.distinct()</p>
<p>// 5. union - åˆå¹¶
val rdd1 = sc.parallelize(List(1, 2, 3))
val rdd2 = sc.parallelize(List(4, 5, 6))
val unioned = rdd1.union(rdd2)</p>
<p>// 6. intersection - äº¤é›†
val intersected = rdd1.intersection(rdd2)</p>
<p>// 7. groupByKey - æŒ‰é”®åˆ†ç»„
val pairs = sc.parallelize(List((&quot;a&quot;, 1), (&quot;b&quot;, 2), (&quot;a&quot;, 3)))
val grouped = pairs.groupByKey()</p>
<p>// 8. reduceByKey - æŒ‰é”®èšåˆ
val reduced = pairs.reduceByKey(_ + _)</p>
<p>// 9. sortByKey - æŒ‰é”®æ’åº
val sorted = pairs.sortByKey()</p>
<p>// 10. join - è¿æ¥
val rdd3 = sc.parallelize(List((&quot;a&quot;, &quot;x&quot;), (&quot;b&quot;, &quot;y&quot;)))
val joined = pairs.join(rdd3)</p>
<pre><code>val collected = data.collect()

// 2. count - è®¡ç®—å…ƒç´ æ•°
val count = data.count()

// 3. first - è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
val first = data.first()

// 4. take - è·å–å‰ n ä¸ªå…ƒç´ 
val taken = data.take(3)

// 5. reduce - èšåˆæ‰€æœ‰å…ƒç´ 
val sum = data.reduce(_ + _)

// 6. fold - å¸¦åˆå§‹å€¼çš„èšåˆ
val folded = data.fold(0)(_ + _)

// 7. aggregate - å¤æ‚èšåˆ
val (sum, count) = data.aggregate((0, 0))(
(acc, value) =&gt; (acc._1 + value, acc._2 + 1),
(acc1, acc2) =&gt; (acc1._1 + acc2._1, acc1._2 + acc2._2)
)

// 8. foreach - å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œæ“ä½œ
data.foreach(println)

// 9. saveAsTextFile - ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶
data.saveAsTextFile(&quot;hdfs://path/to/output&quot;)

</code></pre>
<pre><code class="language-scala">import org.apache.spark.sql.{SparkSession, DataFrame}

val spark = SparkSession.builder()
.appName(&quot;DataFrameExample&quot;)
.master(&quot;local[*]&quot;)
.getOrCreate()

import spark.implicits._

// 1. ä» RDD åˆ›å»º DataFrame
case class Person(name: String, age: Int, city: String)
val peopleRDD = spark.sparkContext.parallelize(List(
Person(&quot;Alice&quot;, 25, &quot;NYC&quot;),
Person(&quot;Bob&quot;, 30, &quot;LA&quot;),
Person(&quot;Charlie&quot;, 35, &quot;Chicago&quot;)
))
val peopleDF = peopleRDD.toDF()

// 2. ä»æ–‡ä»¶åˆ›å»º DataFrame
val df = spark.read
.option(&quot;header&quot;, &quot;true&quot;)
.option(&quot;inferSchema&quot;, &quot;true&quot;)
.csv(&quot;path/to/file.csv&quot;)

// 3. ä» JSON åˆ›å»º
val jsonDF = spark.read.json(&quot;path/to/file.json&quot;)

</code></pre>
<p>df.show()
df.describe().show()</p>
<p>// 2. é€‰æ‹©åˆ—
df.select(&quot;name&quot;, &quot;age&quot;).show()
df.select($&quot;name&quot;, $&quot;age&quot; + 1).show()</p>
<p>// 3. è¿‡æ»¤
df.filter($&quot;age&quot; &gt; 25).show()
df.where(&quot;age &gt; 25&quot;).show()</p>
<p>// 4. åˆ†ç»„èšåˆ
df.groupBy(&quot;city&quot;).count().show()
df.groupBy(&quot;city&quot;).agg(avg(&quot;age&quot;), max(&quot;age&quot;)).show()</p>
<p>// 5. æ’åº
df.orderBy($&quot;age&quot;.desc).show()
df.sort(&quot;name&quot;).show()</p>
<p>// 6. Connect
val df2 = spark.createDataFrame(List(
(&quot;NYC&quot;, &quot;NY&quot;),
(&quot;LA&quot;, &quot;CA&quot;),
(&quot;Chicago&quot;, &quot;IL&quot;)
)).toDF(&quot;city&quot;, &quot;state&quot;)</p>
<p>df.join(df2, &quot;city&quot;).show()</p>
<p>// 7. çª—å£ Function
import org.apache.spark.sql.expressions.Window
import org.apache.spark.sql.functions._</p>
<p>val windowSpec = Window.partitionBy(&quot;city&quot;).orderBy($&quot;age&quot;.desc)
df.withColumn(&quot;rank&quot;, row_number().over(windowSpec)).show()</p>
<pre><code>
val ds: Dataset[Person] = df.as[Person]

// ç±»å‹å®‰å…¨æ“ä½œ
val adults = ds.filter(_.age &gt;= 18)
val names = ds.map(_.name)

// ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
// ds.filter(_.salary &gt; 1000) // ç¼–è¯‘é”™è¯¯ï¼ŒPerson æ²¡æœ‰ salary å­—æ®µ

</code></pre>
<p>// æ³¨å†Œä¸´æ—¶è§†å›¾
df.createOrReplaceTempView(&quot;people&quot;)</p>
<p>// SQL æŸ¥è¯¢
val result = spark.sql(&quot;&quot;&quot;
SELECT city, COUNT(*) as count, AVG(age) as avg_age
FROM people
WHERE age &gt; 20
GROUP BY city
ORDER BY count DESC
&quot;&quot;&quot;)</p>
<p>result.show()</p>
<p>// å¤æ‚æŸ¥è¯¢
val complexQuery = spark.sql(&quot;&quot;&quot;
SELECT name, age, city,
ROW_NUMBER() OVER (PARTITION BY city ORDER BY age DESC) as rank
FROM people
&quot;&quot;&quot;)</p>
<pre><code>spark.catalog.listTables().show()

// ç¼“å­˜è¡¨
spark.catalog.cacheTable(&quot;people&quot;)
spark.catalog.uncacheTable(&quot;people&quot;)

// åˆ é™¤ä¸´æ—¶è§†å›¾
spark.catalog.dropTempView(&quot;people&quot;)

</code></pre>
<p>import org.apache.spark.streaming.{StreamingContext, Seconds}</p>
<p>val ssc = new StreamingContext(spark.sparkContext, Seconds(1))</p>
<p>// 1. ä» socket åˆ›å»ºæµ
val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)</p>
<p>// 2. è½¬æ¢æ“ä½œ
val words = lines.flatMap(<em>.split(&quot; &quot;))
val pairs = words.map(word =&gt; (word, 1))
val wordCounts = pairs.reduceByKey(</em> + _)</p>
<p>// 3. è¾“å‡ºæ“ä½œ
wordCounts.print()</p>
<p>// å¯åŠ¨æµå¤„ç†
ssc.start()
ssc.awaitTermination()</p>
<pre><code>(a: Int, b: Int) =&gt; a + b, // reduce å‡½æ•°
(a: Int, b: Int) =&gt; a - b, // inverse reduce å‡½æ•°
Seconds(30), // çª—å£é•¿åº¦
Seconds(10) // æ»‘åŠ¨é—´éš”
)

// çŠ¶æ€æ›´æ–°
def updateFunction(newValues: Seq[Int], runningCount: Option[Int]): Option[Int] = {
val newCount = newValues.sum + runningCount.getOrElse(0)
Some(newCount)
}

val stateDstream = pairs.updateStateByKey[Int](updateFunction)

</code></pre>
<p>val df = spark
.readStream
.format(&quot;socket&quot;)
.option(&quot;host&quot;, &quot;localhost&quot;)
.option(&quot;port&quot;, 9999)
.load()</p>
<p>// å¤„ç†æµæ•°æ®
val words = df.as[String].flatMap(_.split(&quot; &quot;))
val wordCounts = words.groupBy(&quot;value&quot;).count()</p>
<p>// è¾“å‡ºç»“æœ
val query = wordCounts.writeStream
.outputMode(&quot;complete&quot;)
.format(&quot;console&quot;)
.trigger(Trigger.ProcessingTime(&quot;10 seconds&quot;))
.start()</p>
<p>query.awaitTermination()</p>
<pre><code>import org.apache.spark.storage.StorageLevel

// 1. åŸºæœ¬Cache
val cachedRDD = rdd.cache() // MEMORY_ONLY
val persistedRDD = rdd.persist(StorageLevel.MEMORY_AND_DISK)

// 2. DataFrame ç¼“å­˜
df.cache()
df.persist(StorageLevel.MEMORY_AND_DISK_SER)

// 3. ä¸åŒå­˜å‚¨çº§åˆ«
StorageLevel.MEMORY_ONLY // ä»…å†…å­˜
StorageLevel.MEMORY_AND_DISK // å†…å­˜+ç£ç›˜
StorageLevel.MEMORY_ONLY_SER // å†…å­˜åºåˆ—åŒ–
StorageLevel.DISK_ONLY // ä»…ç£ç›˜
StorageLevel.MEMORY_AND_DISK_2 // å†…å­˜+ç£ç›˜ï¼Œ2å‰¯æœ¬

</code></pre>
<p>val coalesced = rdd.coalesce(2) // å‡å°‘åˆ†åŒº</p>
<p>// 2. è‡ªå®šä¹‰åˆ†åŒºå™¨
class CustomPartitioner(numPartitions: Int) extends Partitioner {
override def numPartitions: Int = numPartitions</p>
<p>override def getPartition(key: Any): Int = {
key.hashCode() % numPartitions
}
}</p>
<p>val partitioned = pairs.partitionBy(new CustomPartitioner(4))</p>
<p>// 3. æ•°æ®æœ¬åœ°æ€§
val localData = sc.textFile(&quot;hdfs://path&quot;, minPartitions = 4)</p>
<pre><code>val result = rdd.map(x =&gt; x * broadcastVar.value.sum)

// 2. ç´¯åŠ å™¨
val accum = sc.longAccumulator(&quot;My Accumulator&quot;)
rdd.foreach(x =&gt; accum.add(x))
println(s&quot;Accumulator value: ${accum.value}&quot;)

// 3. è‡ªå®šä¹‰ç´¯åŠ å™¨
class VectorAccumulator extends AccumulatorV2[Vector, Vector] {
private var _sum = Vector.zeros(3)

override def isZero: Boolean = _sum == Vector.zeros(3)
override def copy(): VectorAccumulator = new VectorAccumulator
override def reset(): Unit = _sum = Vector.zeros(3)
override def add(v: Vector): Unit = _sum += v
override def merge(other: AccumulatorV2[Vector, Vector]): Unit = {
_sum += other.asInstanceOf[VectorAccumulator]._sum
}
override def value: Vector = _sum
}

</code></pre>
<p>// 2. å¯ç”¨ä»£ç ç”Ÿæˆ
spark.conf.set(&quot;spark.sql.codegen.wholeStage&quot;, &quot;true&quot;)</p>
<p>// 3. å¹¿æ’­ Join ä¼˜åŒ–
spark.conf.set(&quot;spark.sql.adaptive.enabled&quot;, &quot;true&quot;)
spark.conf.set(&quot;spark.sql.adaptive.coalescePartitions.enabled&quot;, &quot;true&quot;)</p>
<p>// 4. è°“è¯ä¸‹æ¨
val optimizedDF = df.filter($&quot;age&quot; &gt; 18) // Filter ä¸‹æ¨åˆ°æ•°æ®æº</p>
<pre><code>|:---|:---|:---|:---|
| **ç±»å‹å®‰å…¨** | ç¼–è¯‘æ—¶ | è¿è¡Œæ—¶ | ç¼–è¯‘æ—¶ |
| **æ€§èƒ½ä¼˜åŒ–** | æ—  | Catalystä¼˜åŒ–å™¨ | Catalystä¼˜åŒ–å™¨ |
| **APIé£æ ¼** | å‡½æ•°å¼ | å…³ç³»å‹ | ç±»å‹å®‰å…¨çš„å…³ç³»å‹ |
| **å†…å­˜ä½¿ç”¨** | Javaå¯¹è±¡ | äºŒè¿›åˆ¶æ ¼å¼ | äºŒè¿›åˆ¶æ ¼å¼ |
| **åºåˆ—åŒ–** | Javaåºåˆ—åŒ– | è‡ªå®šä¹‰ç¼–ç å™¨ | è‡ªå®šä¹‰ç¼–ç å™¨ |

## # 2. Sparkå†…å­˜ç®¡ç†

### å†…å­˜åˆ†é…

</code></pre>
<p>â”‚ â””â”€â”€ æ‰§è¡Œå†…å­˜ (Execution) Ã— 0.5
â””â”€â”€ ç”¨æˆ·å†…å­˜ (å‰©ä½™éƒ¨åˆ†)</p>
<pre><code>- -executor-memory 4g

# 2. å†…å­˜åˆ†é…æ¯”ä¾‹
- -conf spark.sql.execution.memory.fraction=0.6
- -conf spark.sql.execution.memory.storageFraction=0.5

# 3. åºåˆ—åŒ–
- -conf spark.serializer=org.apache.spark.serializer.KryoSerializer

</code></pre>
<h3># Shuffle ä¼˜åŒ–</h3>
<pre><code class="language-scala">// 1. é¢„åˆ†åŒº
val partitioned = rdd.partitionBy(new HashPartitioner(100))

// 2. è°ƒæ•´å¹¶è¡Œåº¦
spark.conf.set(&quot;spark.sql.shuffle.partitions&quot;, &quot;400&quot;)

// 3. å¯ç”¨å¤–éƒ¨æ’åº
spark.conf.set(&quot;spark.sql.execution.useObjectHashAggregateExec&quot;, &quot;false&quot;)

</code></pre>
<p>val skewedRDD = sc.parallelize(List((&quot;key1&quot;, 1), (&quot;key1&quot;, 1), /<em>å¾ˆå¤š key1</em>/, (&quot;key2&quot;, 1)))</p>
<p>// åŠ ç›å¤„ç†
val saltedRDD = skewedRDD.map { case (key, value) =&gt;
val salt = Random.nextInt(10)
(s&quot;${key}_$salt&quot;, value)
}</p>
<p>val result = saltedRDD.reduceByKey(_ + <em>)
.map { case (saltedKey, value) =&gt;
val originalKey = saltedKey.split(&quot;</em>&quot;)(0)
(originalKey, value)
}
.reduceByKey(_ + _)</p>
<pre><code>iter.toList.groupBy(_._1).map { case (key, values) =&gt;
(key, values.map(_._2).sum)
}.toIterator
}

// ç¬¬äºŒé˜¶æ®µï¼šå…¨å±€èšåˆ
val globalAgg = localAgg.reduceByKey(_ + _)

</code></pre>
<ul>
<li>-num-executors 10 --executor-cores 5 --executor-memory 2g</li>
</ul>
<h1>å†…å­˜å¯†é›†å‹</h1>
<ul>
<li>-num-executors 5 --executor-cores 2 --executor-memory 8g</li>
</ul>
<h1>å¹³è¡¡å‹</h1>
<ul>
<li>-num-executors 15 --executor-cores 3 --executor-memory 4g</li>
</ul>
<pre><code>
// é¿å…
rdd.map(...).filter(...) // å…ˆè½¬æ¢å†è¿‡æ»¤

// å‡å°‘Shuffle
val broadcastVar = sc.broadcast(smallData)
largeRDD.map(x =&gt; x + broadcastVar.value) // ä½¿ç”¨å¹¿æ’­å˜é‡ä»£æ›¿ join

</code></pre>
<p>.mode(&quot;overwrite&quot;)
.option(&quot;compression&quot;, &quot;snappy&quot;)
.parquet(&quot;path/to/output&quot;) // Parquet æ ¼å¼</p>
<p>// åˆ†åŒºå­˜å‚¨
df.write
.partitionBy(&quot;year&quot;, &quot;month&quot;)
.parquet(&quot;path/to/partitioned/output&quot;)</p>
<pre><code>
</code></pre>

                                            </div>
                                            </div>
                    <div class="chapter">
                        <h1 class="no-page-break">ğŸ“ Appendix</h1>
                    
                                            <div class="section" id="section-83">
                                                <h2>83. Github Projects</h2>
                                                <h1>é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„ GitHub å¼€æºé¡¹ç›®</h1>
<h2>æœ¬åˆ—è¡¨æ—¨åœ¨æ”¶é›†å’Œåˆ†ç±»é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜ç§€å¼€æºé¡¹ç›®ï¼Œæ–¹ä¾¿æŸ¥é˜…å’Œå­¦ä¹ ã€‚</h2>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E9%A2%86%E5%9F%9F%E7%9B%B8%E5%85%B3%E7%9A%84-github-%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE">é€†å‘å·¥ç¨‹é¢†åŸŸç›¸å…³çš„ GitHub å¼€æºé¡¹ç›®</a><ul>
<li><a href="#%E6%9C%AC%E5%88%97%E8%A1%A8%E6%97%A8%E5%9C%A8%E6%94%B6%E9%9B%86%E5%92%8C%E5%88%86%E7%B1%BB%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E9%A2%86%E5%9F%9F%E7%9A%84%E4%BC%98%E7%A7%80%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%96%B9%E4%BE%BF%E6%9F%A5%E9%98%85%E5%92%8C%E5%AD%A6%E4%B9%A0">æœ¬åˆ—è¡¨æ—¨åœ¨æ”¶é›†å’Œåˆ†ç±»é€†å‘å·¥ç¨‹é¢†åŸŸçš„ä¼˜ç§€å¼€æºé¡¹ç›®ï¼Œæ–¹ä¾¿æŸ¥é˜…å’Œå­¦ä¹ ã€‚</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a><ul>
<li><a href="#1-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E4%B8%8E%E6%8F%92%E6%A1%A9%E5%B7%A5%E5%85%B7">1. åŠ¨æ€åˆ†æä¸æ’æ¡©å·¥å…·</a></li>
<li><a href="#2-%E5%8F%8D%E6%B1%87%E7%BC%96%E5%99%A8%E4%B8%8E%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8">2. åæ±‡ç¼–å™¨ä¸åç¼–è¯‘å™¨</a></li>
<li><a href="#3-%E8%B0%83%E8%AF%95%E5%99%A8">3. è°ƒè¯•å™¨</a></li>
<li><a href="#4-%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%B8%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E6%9E%90">4. é™æ€åˆ†æä¸äºŒè¿›åˆ¶åˆ†æ</a></li>
<li><a href="#5-android-%E5%B9%B3%E5%8F%B0">5. android å¹³å°</a></li>
<li><a href="#6-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E4%B8%8E%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7">6. å¤šå¹³å°ä¸é€šç”¨å·¥å…·</a></li>
<li><a href="#7-hex-%E7%BC%96%E8%BE%91%E5%99%A8">7. Hex ç¼–è¾‘å™¨</a></li>
<li><a href="#8-%E8%84%B1%E5%A3%B3%E4%B8%8E%E5%8F%8D%E6%B7%B7%E6%B7%86">8. è„±å£³ä¸åæ··æ·†</a></li>
<li><a href="#9-%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90">9. å›ºä»¶åˆ†æ</a></li>
<li><a href="#10-apple-%E5%B9%B3%E5%8F%B0-iosmacos">10. Apple å¹³å° (iOS/macOS)</a></li>
<li><a href="#11-%E5%85%B6%E4%BB%96%E4%B8%8E%E8%B5%84%E6%BA%90">11. å…¶ä»–ä¸èµ„æº</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3>1. åŠ¨æ€åˆ†æä¸æ’æ¡©å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/frida/frida">frida/frida</a></td>
  <td>14.5k</td>
  <td>è·¨å¹³å°åŠ¨æ€æ’æ¡©æ¡†æ¶ï¼Œæ”¯æŒ Windows, macOS, Linux, iOS, Android, å’Œ QNXã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/DynamoRIO/dynamorio">DynamoRIO/dynamorio</a></td>
  <td>1.8k</td>
  <td>Google å‡ºå“çš„è·¨å¹³å°åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://www.intel.com/content/www/us/en/developer/articles/tool/pin-a-dynamic-binary-instrumentation-tool.html">intel/pin</a></td>
  <td>N/A</td>
  <td>Intel å‡ºå“çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/googleprojectzero/winafl">googleprojectzero/winafl</a></td>
  <td>2.1k</td>
  <td>AFL çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œç”¨äºå¯¹ Windows äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/processhacker/processhacker">processhacker/processhacker</a></td>
  <td>3.2k</td>
  <td>å¼ºå¤§çš„å¤šç”¨é€”å·¥å…·ï¼Œç”¨äºç›‘æ§ç³»ç»Ÿèµ„æºã€è°ƒè¯•è½¯ä»¶å’Œæ£€æµ‹æ¶æ„è½¯ä»¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/dsincl/procmon-parser">dsincl/procmon-parser</a></td>
  <td>170</td>
  <td>Sysinternals Process Monitor (Procmon) çš„æ—¥å¿—è§£æå™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/microsoft/detours">microsoft/Detours</a></td>
  <td>1.9k</td>
  <td>å¾®è½¯å®˜æ–¹çš„ API Hooking å·¥å…·åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/easyhook/EasyHook">easyhook/EasyHook</a></td>
  <td>1.8k</td>
  <td>å¼ºå¤§çš„ Windows API Hooking åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/tmate-io/tmate">tmate-io/tmate</a></td>
  <td>3.5k</td>
  <td>å³æ—¶ç»ˆç«¯å…±äº«å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/lief-project/LIEF">lief-project/LIEF</a></td>
  <td>4k</td>
  <td>ç”¨äºè§£æã€ä¿®æ”¹å’ŒæŠ½è±¡ ELF, PE, MachO æ ¼å¼çš„åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/qbdi/QBDI">qbdi/QBDI</a></td>
  <td>680</td>
  <td>åŸºäº LLVM çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/jmpews/dobby">jmpews/dobby</a></td>
  <td>1.6k</td>
  <td>è½»é‡çº§ã€å¤šå¹³å°ã€å¤šæ¶æ„çš„ Hook æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/aslody/whale">aslody/whale</a></td>
  <td>880</td>
  <td>è·¨å¹³å°çš„ Hook æ¡†æ¶ (Android/iOS/Linux/macOS)ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/iqiyi/xHook">iqiyi/xHook</a></td>
  <td>1.6k</td>
  <td>ç”¨äº Android aarch64/arm/x86 å¹³å°çš„ PLT hook åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/facebook/fishhook">facebook/fishhook</a></td>
  <td>3.8k</td>
  <td>åœ¨ iOS/macOS ä¸ŠåŠ¨æ€é‡ç»‘å®š Mach-O äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ç¬¦å·ã€‚</td>
</tr>
</tbody>
</table>
<h3>2. åæ±‡ç¼–å™¨ä¸åç¼–è¯‘å™¨</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/NationalSecurityAgency/ghidra">NationalSecurityAgency/ghidra</a></td>
  <td>47.9k</td>
  <td>NSA å‡ºå“çš„è½¯ä»¶é€†å‘å·¥ç¨‹æ¡†æ¶ï¼ŒåŒ…å«åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/radareorg/radare2">radareorg/radare2</a></td>
  <td>19.8k</td>
  <td>å¼€æºçš„é€†å‘å·¥ç¨‹æ¡†æ¶å’Œå‘½ä»¤è¡Œå·¥å…·é›†ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/rizin-re/rizin">rizin-re/rizin</a></td>
  <td>2.5k</td>
  <td>radare2 çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸“æ³¨äºå¯ç”¨æ€§å’Œç¤¾åŒºã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/avast/retdec">avast/retdec</a></td>
  <td>8.2k</td>
  <td>åŸºäº LLVM çš„å¯é‡å®šå‘æœºå™¨ç åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/yegord/snowman">yegord/snowman</a></td>
  <td>1.8k</td>
  <td>æ”¯æŒ x86, ARM å’Œ x86-64 çš„åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/aquynh/capstone">aquynh/capstone</a></td>
  <td>7.4k</td>
  <td>å¼ºå¤§çš„å¤šæ¶æ„åæ±‡ç¼–æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/keystone-engine/keystone">keystone-engine/keystone</a></td>
  <td>3.9k</td>
  <td>è½»é‡çº§å¤šæ¶æ„æ±‡ç¼–å™¨æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/unicorn-engine/unicorn">unicorn-engine/unicorn</a></td>
  <td>7.5k</td>
  <td>åŸºäº QEMU çš„å¤šæ¶æ„ CPU æ¨¡æ‹Ÿå™¨æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/lifting-bits/mcsema">lifting-bits/mcsema</a></td>
  <td>1.7k</td>
  <td>å°† x86/64, aarch64 äºŒè¿›åˆ¶æ–‡ä»¶æå‡åˆ° LLVM IRã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/maji-cat/redress">maji-cat/redress</a></td>
  <td>680</td>
  <td>åŸºäº Triton çš„äºŒè¿›åˆ¶åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/wtdcode/retdec-idaplugin">wtdcode/retdec-idaplugin</a></td>
  <td>500+</td>
  <td>RetDec åç¼–è¯‘å™¨çš„ IDA æ’ä»¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/airbus-seclab/bincat">airbus-seclab/bincat</a></td>
  <td>1k</td>
  <td>äºŒè¿›åˆ¶ä»£ç é™æ€åˆ†æå·¥å…·ï¼Œæ”¯æŒå€¼åˆ†æã€æ±¡ç‚¹åˆ†æå’Œç±»å‹æ¨æ–­ã€‚</td>
</tr>
</tbody>
</table>
<h3>3. è°ƒè¯•å™¨</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/x64dbg/x64dbg">x64dbg/x64dbg</a></td>
  <td>45.3k</td>
  <td>Windows å¹³å°å¼€æºçš„ x64/x32 è°ƒè¯•å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://www.gnu.org/software/gdb/">gdb/gdb</a></td>
  <td>N/A</td>
  <td>GNU é¡¹ç›®è°ƒè¯•å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/radareorg/cutter">radareorg/cutter</a></td>
  <td>15.6k</td>
  <td>radare2 çš„ GUI ç•Œé¢ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/hugsy/gef">hugsy/gef</a></td>
  <td>6.4k</td>
  <td>GDB çš„ç°ä»£åŒ–æ’ä»¶ï¼Œç”¨äºæ¼æ´åˆ©ç”¨å’Œé€†å‘ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/pwndbg/pwndbg">pwndbg/pwndbg</a></td>
  <td>6.7k</td>
  <td>GDB çš„ä¸€ä¸ªæ’ä»¶ï¼Œè¾…åŠ© pwnã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/longld/peda">longld/peda</a></td>
  <td>5.7k</td>
  <td>GDB PEDA - Python Exploit Development Assistance for GDB.</td>
</tr>
<tr>
  <td><a href="https://github.com/snare/voltron">voltron/voltron</a></td>
  <td>5.3k</td>
  <td>ä¸€ä¸ªå¯æ‰©å±•çš„ã€è·¨å¹³å°çš„è°ƒè¯•å™¨ UI å·¥å…·åŒ…ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/microsoft/WinDbg-Samples">microsoft/WinDbg-Samples</a></td>
  <td>300+</td>
  <td>WinDbg çš„ç¤ºä¾‹æ‰©å±•ã€è„šæœ¬å’Œ API ç”¨æ³•ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/moyix/pdbpp">moyix/pdbpp</a></td>
  <td>1.4k</td>
  <td>Python è°ƒè¯•å™¨ (pdb) çš„ä¸€ä¸ªå¢å¼ºç‰ˆã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/deroko/x64dbg-python">deroko/x64dbg-python</a></td>
  <td>300+</td>
  <td>ç”¨äº x64dbg çš„ Python è„šæœ¬æ’ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h3>4. é™æ€åˆ†æä¸äºŒè¿›åˆ¶åˆ†æ</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/angr/angr">angr/angr</a></td>
  <td>7.3k</td>
  <td>å¼ºå¤§çš„äºŒè¿›åˆ¶åˆ†æå¹³å°ï¼Œæ”¯æŒç¬¦å·æ‰§è¡Œã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/trailofbits/manticore">trailofbits/manticore</a></td>
  <td>2k</td>
  <td>åŠ¨æ€äºŒè¿›åˆ¶åˆ†æå·¥å…·ï¼Œæ”¯æŒç¬¦å·æ‰§è¡Œã€æ±¡ç‚¹åˆ†æã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/JonathanSalwan/triton">JonathanSalwan/triton</a></td>
  <td>2.7k</td>
  <td>åŠ¨æ€äºŒè¿›åˆ¶åˆ†æ (DBA) æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/google/binexport">google/binexport</a></td>
  <td>450+</td>
  <td>å°†åæ±‡ç¼–ä» IDA Pro, Binary Ninja, Ghidra å¯¼å‡ºåˆ° BinNaviã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/google/binnavi">google/binnavi</a></td>
  <td>2.8k</td>
  <td>äºŒè¿›åˆ¶ä»£ç é€†å‘å·¥ç¨‹å’Œåˆ†æçš„å›¾å½¢åŒ–å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/Gallopsled/pwntools">Gallopsled/pwntools</a></td>
  <td>11.2k</td>
  <td>CTF æ¡†æ¶å’Œæ¼æ´åˆ©ç”¨å¼€å‘åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/erocarrera/pefile">erocarrera/pefile</a></td>
  <td>1.3k</td>
  <td>ç”¨äºè§£æå’Œæ“ä½œ PE æ–‡ä»¶çš„ Python æ¨¡å—ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/eliben/pyelftools">eliben/pyelftools</a></td>
  <td>1k</td>
  <td>ç”¨äºè§£æå’Œåˆ†æ ELF æ–‡ä»¶å’Œ DWARF è°ƒè¯•ä¿¡æ¯çš„ Python åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/s-c-repo/vtable-dumper">s-c-repo/vtable-dumper</a></td>
  <td>250</td>
  <td>ç”¨äºä» PE/ELF æ–‡ä»¶ä¸­ dump è™šå‡½æ•°è¡¨çš„å·¥å…·ã€‚</td>
</tr>
</tbody>
</table>
<h3>5. android å¹³å°</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/iBotPeaches/Apktool">iBotPeaches/Apktool</a></td>
  <td>18.2k</td>
  <td>ç”¨äºé€†å‘ Android apk æ–‡ä»¶çš„å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/pxb1988/dex2jar">pxb1988/dex2jar</a></td>
  <td>12k</td>
  <td>ç”¨äºå¤„ç† .dex å’Œ .class æ–‡ä»¶çš„å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/skylot/jadx">skylot/jadx</a></td>
  <td>38.6k</td>
  <td>Dex åˆ° Java çš„åç¼–è¯‘å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/JesusFreke/smali">JesusFreke/smali</a></td>
  <td>4.4k</td>
  <td>Android çš„ smali/baksmali æ±‡ç¼–å™¨/åæ±‡ç¼–å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF/Mobile-Security-Framework-MobSF</a></td>
  <td>16.4k</td>
  <td>è‡ªåŠ¨åŒ–çš„ç§»åŠ¨åº”ç”¨ (Android/iOS/Windows) å®‰å…¨æµ‹è¯•å’Œæ¶æ„è½¯ä»¶åˆ†ææ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/sensepost/objection">sensepost/objection</a></td>
  <td>8.3k</td>
  <td>è¿è¡Œæ—¶ç§»åŠ¨å®‰å…¨è¯„ä¼°æ¡†æ¶ï¼ŒåŸºäº Fridaã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/Fuzion24/JustTrustMe">Fuzion24/JustTrustMe</a></td>
  <td>2.2k</td>
  <td>ç¦ç”¨ SSL è¯ä¹¦æ£€æŸ¥çš„ Xposed æ¨¡å—ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/ac-pm/Inspeckage">ac-pm/Inspeckage</a></td>
  <td>1.8k</td>
  <td>Android åŒ…åŠ¨æ€åˆ†æå·¥å…·ï¼Œå¸¦ API hook åŠŸèƒ½ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/rednaga/APKiD">rednaga/APKiD</a></td>
  <td>850</td>
  <td>ç”¨äºè¯†åˆ« Android å®‰è£…åŒ…ä¸­åŠ å£³ã€æ··æ·†å’Œå…¶å®ƒå¼‚å¸¸çš„å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/CalebFenton/simplify">CalebFenton/simplify</a></td>
  <td>3.2k</td>
  <td>é€šç”¨ Android åæ··æ·†å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/strazzere/android-unpacker">strazzere/android-unpacker</a></td>
  <td>900+</td>
  <td>Defcon 22 ä¸Šæ¼”ç¤ºçš„ Android è„±å£³å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/asLody/AndHook">asLody/AndHook</a></td>
  <td>600+</td>
  <td>Android åŠ¨æ€æ’æ¡©æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/turing-technician/fasthook">turing-technician/fasthook</a></td>
  <td>400+</td>
  <td>Android ART Hook æ¡†æ¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/wrbug/dumpdex">wrbug/dumpdex</a></td>
  <td>1.9k</td>
  <td>Android è„±å£³å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/topjohnwu/Magisk">topjohnwu/Magisk</a></td>
  <td>35k+</td>
  <td>Android ç³»ç»Ÿæ— æ„ŸçŸ¥ Root å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/LSPosed/LSPosed">LSPosed/LSPosed</a></td>
  <td>15k+</td>
  <td>åŸºäº Riru/Zygisk çš„ ART Hook æ¡†æ¶ (Xposed æ›¿ä»£å“)ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/Genymobile/scrcpy">Genymobile/scrcpy</a></td>
  <td>90k+</td>
  <td>é«˜æ€§èƒ½çš„ Android æŠ•å±ä¸æ§åˆ¶å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/shroudedcode/apk-mitm">shroudedcode/apk-mitm</a></td>
  <td>3k+</td>
  <td>è‡ªåŠ¨ä¿®æ”¹ APK ä»¥ä¾¿è¿›è¡Œ HTTPS æŠ“åŒ…çš„å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/r0ysue/r0capture">r0ysue/r0capture</a></td>
  <td>4k+</td>
  <td>åŸºäº Frida çš„å®‰å“åº”ç”¨å±‚æŠ“åŒ…é€šæ€è„šæœ¬ã€‚</td>
</tr>
</tbody>
</table>
<h3>6. å¤šå¹³å°ä¸é€šç”¨å·¥å…·</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/upx/upx">upx/upx</a></td>
  <td>4.9k</td>
  <td>æè‡´çš„å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/horsicq/Detect-It-Easy">horsicq/Detect-It-Easy</a></td>
  <td>5.8k</td>
  <td>ç”¨äºåˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ç¨‹åºï¼Œæ”¯æŒ Windows, Linux, macOSã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/wbenny/xorsearch">wbenny/xorsearch</a></td>
  <td>450+</td>
  <td>åœ¨æ–‡ä»¶ä¸­æœç´¢ç»è¿‡ XOR, ROL, ROT æˆ– SHIFT ç¼–ç çš„å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/balena-io/etason">balena-io/etason</a></td>
  <td>200+</td>
  <td>JSON è§£æå™¨ï¼Œèƒ½å®¹å¿è¯­æ³•é”™è¯¯ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/google/santa">google/santa</a></td>
  <td>3.1k</td>
  <td>ç”¨äº macOS çš„äºŒè¿›åˆ¶æ–‡ä»¶ç™½åå•/é»‘åå•ç³»ç»Ÿã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/trailofbits/osquery-extensions">trailofbits/osquery-extensions</a></td>
  <td>300+</td>
  <td>osquery çš„æ‰©å±•ï¼Œç”¨äºå¢å¼ºå®‰å…¨åˆ†æã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/checkra1n/pongoOS">checkra1n/pongoOS</a></td>
  <td>1.2k</td>
  <td>checkra1n ä½¿ç”¨çš„ Pre-boot eXecution Environmentã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/mitmproxy/mitmproxy">mitmproxy/mitmproxy</a></td>
  <td>33k+</td>
  <td>äº¤äº’å¼çš„ HTTPS ä»£ç†ï¼Œç”¨äºè°ƒè¯•ã€æµ‹è¯•å’Œæ¸—é€ã€‚</td>
</tr>
</tbody>
</table>
<h3>7. Hex ç¼–è¾‘å™¨</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/codepainters/distorm">codepainters/distorm</a></td>
  <td>500+</td>
  <td>x86/AMD64 çš„å¿«é€Ÿåæ±‡ç¼–åº“ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/radareorg/hex-lib">radareorg/hex-lib</a></td>
  <td>100+</td>
  <td>Hex a go go.</td>
</tr>
<tr>
  <td><a href="https://github.com/WerWolv/ImHex">WerWolv/ImHex</a></td>
  <td>3k</td>
  <td>ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ç°ä»£ Hex ç¼–è¾‘å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/chrystianvieira/hexcute">chrystianvieira/hexcute</a></td>
  <td>100+</td>
  <td>ä¸€ä¸ªç®€å•çš„åå…­è¿›åˆ¶ç¼–è¾‘å™¨ã€‚</td>
</tr>
</tbody>
</table>
<h3>8. è„±å£³ä¸åæ··æ·†</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/de4dot/de4dot">de4dot/de4dot</a></td>
  <td>6.5k</td>
  <td>.NET åæ··æ·†å™¨å’Œè„±å£³å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/fireeye/flare-floss">fireeye/flare-floss</a></td>
  <td>1.5k</td>
  <td>è‡ªåŠ¨ä»æ¶æ„è½¯ä»¶ä¸­æå–æ··æ·†åçš„å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/ioncodes/dnpatch">ioncodes/dnpatch</a></td>
  <td>500+</td>
  <td>ç”¨äºä¿®è¡¥ .NET ç¨‹åºé›†çš„å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/rolfrolles/deobfuscator">rolfrolles/deobfuscator</a></td>
  <td>400+</td>
  <td>åŸºäº QEMU çš„ x86 åæ··æ·†å™¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/hluwa/frida-dexdump">hluwa/frida-dexdump</a></td>
  <td>3k+</td>
  <td>åŸºäº Frida çš„å¿«é€Ÿ Dex å†…å­˜å¯¼å‡ºå·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/Perfare/Il2CppDumper">Perfare/Il2CppDumper</a></td>
  <td>7k+</td>
  <td>Unity Il2Cpp é€†å‘å·¥å…·ï¼Œè¿˜åŸ DLL å’Œå¤´æ–‡ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h3>9. å›ºä»¶åˆ†æ</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/ReFirmLabs/binwalk">ReFirmLabs/binwalk</a></td>
  <td>10.1k</td>
  <td>ç”¨äºåˆ†æã€é€†å‘å’Œæå–å›ºä»¶é•œåƒçš„å·¥å…·ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/craigz/firmwalker">craigz/firmwalker</a></td>
  <td>1k</td>
  <td>è‡ªåŠ¨åœ¨å›ºä»¶ä¸­æœç´¢æ•æ„Ÿä¿¡æ¯çš„è„šæœ¬ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/attify/firmware-analysis-toolkit">attify/firmware-analysis-toolkit</a></td>
  <td>1k</td>
  <td>ç”¨äºå›ºä»¶å®‰å…¨æµ‹è¯•çš„å·¥å…·åŒ…ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/scriptingx/IoTSecurity101">scriptingx/IoTSecurity101</a></td>
  <td>500+</td>
  <td>ç‰©è”ç½‘å®‰å…¨å…¥é—¨ã€‚</td>
</tr>
</tbody>
</table>
<h3>10. Apple å¹³å° (iOS/macOS)</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/nygard/class-dump">nygard/class-dump</a></td>
  <td>2.6k</td>
  <td>ä» Mach-O æ–‡ä»¶ç”Ÿæˆ Objective-C å¤´æ–‡ä»¶ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/KJCracks/Clutch">KJCracks/Clutch</a></td>
  <td>2.8k</td>
  <td>å¿«é€Ÿçš„ iOS å¯æ‰§è¡Œæ–‡ä»¶ dumperã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/alonemonkey/MonkeyDev">alonemonkey/MonkeyDev</a></td>
  <td>4.5k</td>
  <td>iOS Tweak å¼€å‘å·¥å…·ï¼Œæ— éœ€è¶Šç‹±ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/facebook/chisel">facebook/chisel</a></td>
  <td>8.3k</td>
  <td>è¾…åŠ©è°ƒè¯• iOS åº”ç”¨çš„ LLDB å‘½ä»¤é›†åˆã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/nabla-c0d3/ssl-kill-switch2">nabla-c0d3/ssl-kill-switch2</a></td>
  <td>1.6k</td>
  <td>é»‘ç›’å·¥å…·ï¼Œç”¨äºåœ¨ iOS å’Œ macOS åº”ç”¨ä¸­ç¦ç”¨ SSL è¯ä¹¦éªŒè¯ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/ptoomey3/Keychain-Dumper">ptoomey3/Keychain-Dumper</a></td>
  <td>1k</td>
  <td>åœ¨è¶Šç‹±è®¾å¤‡ä¸Šæ£€æŸ¥å“ªäº›é’¥åŒ™ä¸²é¡¹å¯è¢«è®¿é—®ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/limneos/classdump-dyld">limneos/classdump-dyld</a></td>
  <td>450+</td>
  <td>æ— éœ€ä» dyld_shared_cache ä¸­æå–å³å¯ class-dump ä»»ä½• Mach-O æ–‡ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h3>11. å…¶ä»–ä¸èµ„æº</h3>
<table>
<thead>
<tr>
  <th>é¡¹ç›®</th>
  <th>Star æ•°é‡</th>
  <th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="https://github.com/firmianay/security-paper">firmianay/security-paper</a></td>
  <td>1.7k</td>
  <td>å®‰å…¨é¢†åŸŸçš„ä¸€äº›ç»å…¸è®ºæ–‡ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/endgameinc/RSOI">endgameinc/RSOI</a></td>
  <td>200+</td>
  <td>é€†å‘å·¥ç¨‹é¢†åŸŸçš„èµ„æºå’Œä¿¡æ¯ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/enaqx/awesome-pentest">enaqx/awesome-pentest</a></td>
  <td>18k+</td>
  <td>ç²¾é€‰çš„æ¸—é€æµ‹è¯•èµ„æºã€å·¥å…·å’Œå…¶å®ƒå¾ˆæ£’çš„ä¸œè¥¿ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/carpedm20/awesome-hacking">carpedm20/awesome-hacking</a></td>
  <td>9k+</td>
  <td>ç²¾é€‰çš„é»‘å®¢èµ„æºã€å·¥å…·å’Œæ•™ç¨‹ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/onethawt/idaplugins-list">onethawt/idaplugins-list</a></td>
  <td>1.9k</td>
  <td>IDA Pro æ’ä»¶åˆ—è¡¨ã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/Siguza/ios-resources">Siguza/ios-resources</a></td>
  <td>700+</td>
  <td>iOS é»‘å®¢ç›¸å…³çš„æœ‰ç”¨èµ„æºã€‚</td>
</tr>
<tr>
  <td><a href="https://github.com/michalmalik/osx-re-101">michalmalik/osx-re-101</a></td>
  <td>1.4k</td>
  <td>OSX/iOS é€†å‘èµ„æºã€‚</td>
</tr>
</tbody>
</table>

                                            </div>
                                            
                                            <div class="section" id="section-84">
                                                <h2>84. Learning Resources</h2>
                                                <hr />
<h1>å­¦ä¹ èµ„æº (Learning Resources)</h1>
<h2>æœ¬é¡µé¢æ”¶é›†äº† Android é€†å‘å·¥ç¨‹é¢†åŸŸçš„é«˜è´¨é‡å­¦ä¹ èµ„æºï¼ŒåŒ…æ‹¬ä¹¦ç±ã€åšå®¢ã€è®ºå›ã€ç¤¾åŒºå’Œè¯¾ç¨‹ã€‚</h2>
<h2>ä¹¦ç± (Books)</h2>
<h3>å…¥é—¨ä¸åŸºç¡€</h3>
<ul>
<li><strong>ã€ŠAndroid è½¯ä»¶å®‰å…¨ä¸é€†å‘åˆ†æã€‹</strong> (ä¸°ç”Ÿå¼º / éè™«)
ç»å…¸çš„å…¥é—¨ä¹¦ç±ï¼Œæ¶µç›–äº† Android ç³»ç»Ÿæ¶æ„ã€Smali è¯­æ³•ã€é™æ€åˆ†æã€åŠ¨æ€è°ƒè¯•ç­‰åŸºç¡€çŸ¥è¯†ã€‚</li>
<li><strong>ã€ŠAndroid å®‰å…¨æ”»é˜²å®æˆ˜ã€‹</strong> (EaaLaboratory)
åå‘å®æˆ˜ï¼ŒåŒ…å«å¾ˆå¤šæ¡ˆä¾‹åˆ†æã€‚</li>
</ul>
<h3>è¿›é˜¶ä¸æ·±å…¥</h3>
<ul>
<li><strong>ã€ŠAndroid Internals: A Confectioner's Cookbookã€‹</strong> (Jonathan Levin)
<a href="http://newandroidbook.com/">é“¾æ¥</a>
æ·±å…¥å‰–æ Android ç³»ç»Ÿå†…éƒ¨åŸç†ï¼Œæ˜¯ç†è§£ Android åº•å±‚æœºåˆ¶çš„å¿…è¯»ä¹‹ä½œã€‚</li>
<li><strong>ã€ŠAndroid Hacker's Handbookã€‹</strong> (Joshua J. Drake et al.)
å…¨é¢ä»‹ç» Android å®‰å…¨æ¶æ„ã€æ¼æ´æŒ–æ˜å’Œåˆ©ç”¨æŠ€æœ¯ã€‚</li>
<li><strong>ã€ŠMASTG - Mobile App Security Testing Guideã€‹</strong> (OWASP)
<a href="https://mas.owasp.org/MASTG/">é“¾æ¥</a>
OWASP å‘å¸ƒçš„ç§»åŠ¨åº”ç”¨å®‰å…¨æµ‹è¯•æŒ‡å—ï¼Œæ¶µç›–äº† iOS å’Œ Android å¹³å°çš„å®‰å…¨æµ‹è¯•æ–¹æ³•è®ºå’ŒæŠ€æœ¯ç»†èŠ‚ï¼Œæ˜¯è¡Œä¸šæ ‡å‡†å‚è€ƒæ–‡æ¡£ã€‚</li>
</ul>
<hr />
<h2>åšå®¢ä¸ç½‘ç«™ (Blogs &amp; Websites)</h2>
<h3>ä¸ªäººåšå®¢</h3>
<ul>
<li><strong>Maddie Stone</strong> (<a href="https://googleprojectzero.blogspot.com/">Project Zero</a>)
ä¸“æ³¨äº Android æ¶æ„è½¯ä»¶åˆ†æå’Œæ¼æ´æŒ–æ˜ï¼Œæ–‡ç« è´¨é‡æé«˜ã€‚</li>
<li><strong>R0ysue (è‚‰ä¸)</strong>
å›½å†…çŸ¥åçš„ Android é€†å‘ä¸“å®¶ï¼ŒFrida é¢†åŸŸçš„é¢†å†›äººç‰©ã€‚</li>
<li><strong>Wei (LSPosed Developer)</strong>
æ·±å…¥ç ”ç©¶ Android Runtime (ART) å’Œ Hook æŠ€æœ¯ã€‚</li>
<li><strong>Orange Tsai</strong>
Web å’Œç§»åŠ¨å®‰å…¨é¢†åŸŸçš„çŸ¥åç ”ç©¶å‘˜ï¼Œå¸¸æœ‰ç²¾å½©çš„åˆ©ç”¨æ€è·¯ã€‚</li>
</ul>
<h3>æŠ€æœ¯å›¢é˜Ÿä¸å‚å•†</h3>
<ul>
<li><strong>Google Project Zero</strong>
<a href="https://googleprojectzero.blogspot.com/">é“¾æ¥</a>
Google çš„å®‰å…¨ç ”ç©¶å›¢é˜Ÿï¼Œå‘å¸ƒäº†å¤§é‡å…³äº Android å†…æ ¸ã€é©±åŠ¨å’Œæ¡†æ¶å±‚çš„é«˜è´¨é‡æ¼æ´åˆ†ææŠ¥å‘Šã€‚</li>
<li><strong>Quarkslab Blog</strong>
<a href="https://blog.quarkslab.com/">é“¾æ¥</a>
å‘å¸ƒäº†è®¸å¤šå…³äºæ··æ·†ã€åæ··æ·†å’Œåº•å±‚é€†å‘å·¥å…·ï¼ˆå¦‚ Tritonï¼‰çš„ç ”ç©¶æ–‡ç« ã€‚</li>
<li><strong>Check Point Research</strong>
ç»å¸¸æŠ«éœ² Android æ¶æ„è½¯ä»¶å’Œé«˜å±æ¼æ´ã€‚</li>
</ul>
<hr />
<h2>è®ºå›ä¸ç¤¾åŒº (Forums &amp; Communities)</h2>
<ul>
<li><strong>52pojie (å¾çˆ±ç ´è§£)</strong>
<a href="https://www.52pojie.cn/">é“¾æ¥</a>
å›½å†…æœ€å¤§çš„ç ´è§£å’Œé€†å‘æŠ€æœ¯äº¤æµè®ºå›ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æ•™ç¨‹ã€å·¥å…·å’Œæ´»è·ƒçš„ç¤¾åŒºæ°›å›´ã€‚</li>
<li><strong>Kanxue (çœ‹é›ªè®ºå›)</strong>
<a href="https://bbs.kanxue.com/">é“¾æ¥</a>
å›½å†…è€ç‰Œçš„å®‰å…¨æŠ€æœ¯ç¤¾åŒºï¼Œä¸“æ³¨äºäºŒè¿›åˆ¶å®‰å…¨ã€æ¼æ´æŒ–æ˜å’Œå†…æ ¸å®‰å…¨ï¼ŒæŠ€æœ¯æ·±åº¦è¾ƒé«˜ã€‚</li>
<li><strong>XDA Developers</strong>
<a href="https://forum.xda-developers.com/">é“¾æ¥</a>
å…¨çƒæœ€å¤§çš„ Android å¼€å‘è€…ç¤¾åŒºï¼Œå…³äº ROM å®šåˆ¶ã€Rootã€Xposed/Magisk æ¨¡å—çš„èµ„æºéå¸¸ä¸°å¯Œã€‚</li>
<li><strong>Reddit r/ReverseEngineering</strong>
<a href="https://www.reddit.com/r/ReverseEngineering/">é“¾æ¥</a>
å›½é™…é€†å‘å·¥ç¨‹æŠ€æœ¯è®¨è®ºåŒºï¼Œæ±‡é›†äº†å…¨çƒçš„é€†å‘çˆ±å¥½è€…å’Œä¸“å®¶ã€‚</li>
<li><strong>Reddit r/androiddev</strong>
<a href="https://www.reddit.com/r/androiddev/">é“¾æ¥</a>
è™½ç„¶ä¾§é‡å¼€å‘ï¼Œä½†äº†è§£å¼€å‘è€…çš„æ€ç»´å¯¹äºé€†å‘å·¥ç¨‹ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚</li>
</ul>
<hr />
<h2>è¯¾ç¨‹ä¸æ•™ç¨‹ (Courses &amp; Tutorials)</h2>
<ul>
<li><strong>Frida å®˜æ–¹æ–‡æ¡£ä¸æ•™ç¨‹</strong>
<a href="https://frida.re/docs/home/">é“¾æ¥</a>
å­¦ä¹  Frida æœ€æƒå¨çš„èµ„æ–™ã€‚</li>
<li><strong>Android App Reverse Engineering 101</strong> (Maddie Stone)
<a href="https://www.r00t0k.com/course/android-app-reverse-engineering-101">é“¾æ¥</a> (éœ€æŸ¥æ‰¾æœ‰æ•ˆé“¾æ¥æˆ–å­˜æ¡£)
Workshops å½¢å¼çš„å…¥é—¨æ•™ç¨‹ï¼Œéå¸¸é€‚åˆåˆå­¦è€…ã€‚</li>
<li><strong>OWASP Mobile Security Testing Guide (MSTG) Hacking Playground</strong>
é…åˆ MSTG ä¹¦ç±çš„ç»ƒä¹ ç¯å¢ƒã€‚</li>
</ul>
<hr />
<h2>å…¶ä»–èµ„æº</h2>
<ul>
<li><strong>Android Open Source Project (AOSP)</strong>
<a href="https://source.android.com/">é“¾æ¥</a>
é˜…è¯»æºç æ˜¯ç†è§£ Android æœ€æ ¹æœ¬çš„æ–¹æ³•ã€‚ä½¿ç”¨ <a href="https://cs.android.com/">cs.android.com</a> è¿›è¡Œåœ¨çº¿æºç æœç´¢éå¸¸æ–¹ä¾¿ã€‚</li>
<li><strong>Android Developers Documentation</strong>
<a href="https://developer.android.com/docs">é“¾æ¥</a>
å®˜æ–¹å¼€å‘æ–‡æ¡£ï¼Œé€†å‘æ—¶é‡åˆ°ä¸æ‡‚çš„ API é¦–å…ˆåº”è¯¥æŸ¥é˜…çš„åœ°æ–¹ã€‚</li>
</ul>
<hr />

                                            </div>
                                            
                                            <div class="section" id="section-85">
                                                <h2>85. CTF Platforms</h2>
                                                <hr />
<h1>CTF ä¸ ç»ƒä¹ å¹³å° (CTF &amp; Practice Platforms)</h1>
<h2>å®è·µæ˜¯æŒæ¡é€†å‘å·¥ç¨‹æŠ€æœ¯çš„å…³é”®ã€‚æœ¬é¡µé¢æ•´ç†äº†æä¾› Android é€†å‘æŒ‘æˆ˜çš„ CTF å¹³å°å’Œ CrackMe ç½‘ç«™ã€‚</h2>
<h2>ç§»åŠ¨å®‰å…¨ä¸“é¡¹æŒ‘æˆ˜ (Mobile Specific Challenges)</h2>
<h3>OWASP UnCrackable Apps</h3>
<ul>
<li><strong>æè¿°</strong>: OWASP å®˜æ–¹æä¾›çš„ä¸€ç³»åˆ— Android å’Œ iOS é€†å‘æŒ‘æˆ˜åº”ç”¨ï¼Œåˆ†ä¸º Level 1 åˆ° Level 4 ä¸åŒéš¾åº¦ã€‚æ˜¯å­¦ä¹ ç§»åŠ¨å®‰å…¨æµ‹è¯•æ ‡å‡† (MSTG) çš„æœ€ä½³é…å¥—ç»ƒä¹ ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://github.com/OWASP/owasp-mastg/tree/master/Crackmes">OWASP MSTG Repo</a></li>
</ul>
<h3>Google CTF (Mobile Category)</h3>
<ul>
<li><strong>æè¿°</strong>: Google æ¯å¹´ä¸¾åŠçš„ CTF æ¯”èµ›ä¸­çš„ Mobile ç±»ç›®é¢˜ç›®ã€‚è¿™äº›é¢˜ç›®é€šå¸¸è´¨é‡å¾ˆé«˜ï¼Œæ¶‰åŠå„ç§ Android ç‰¹æ€§å’Œæ–°é¢–çš„ä¿æŠ¤æœºåˆ¶ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://capturetheflag.withgoogle.com/">Google CTF Archives</a> (æŸ¥çœ‹å†å¹´é¢˜ç›®)</li>
</ul>
<h3>android App Reverse Engineering 101 Crackmes</h3>
<ul>
<li><strong>æè¿°</strong>: Maddie Stone åœ¨å¥¹çš„ Workshop ä¸­ä½¿ç”¨çš„ç»ƒä¹ é¢˜ç›®ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://github.com/maddiestone/AndroidAppRE">GitHub Repo</a></li>
</ul>
<hr />
<h2>ç»¼åˆ CTF å¹³å° (General CTF Platforms)</h2>
<h3>Hack The Box (HTB)</h3>
<ul>
<li><strong>æè¿°</strong>: è‘—åçš„æ¸—é€æµ‹è¯•ç»ƒä¹ å¹³å°ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸å°‘ Android é€†å‘ç›¸å…³çš„ Challenge (é€šå¸¸åœ¨ Mobile æˆ– Reversing åˆ†ç±»ä¸‹) å’Œ Machineã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://www.hackthebox.com/">https://www.hackthebox.com/</a></li>
</ul>
<h3>TryHackMe</h3>
<ul>
<li><strong>æè¿°</strong>: å¯¹åˆå­¦è€…æ›´å‹å¥½çš„ç½‘ç»œå®‰å…¨å­¦ä¹ å¹³å°ï¼Œæä¾›æœ‰å¼•å¯¼æ€§çš„ Android é€†å‘æˆ¿é—´ (Rooms)ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://tryhackme.com/">https://tryhackme.com/</a></li>
</ul>
<h3>CTFtime</h3>
<ul>
<li><strong>æè¿°</strong>: å…¨çƒ CTF èµ›äº‹èšåˆå¹³å°ã€‚å¯ä»¥åœ¨è¿™é‡Œå…³æ³¨å³å°†å¼€å§‹çš„æ¯”èµ›ï¼Œå¾ˆå¤šç»¼åˆæ€§æ¯”èµ›éƒ½ä¼šåŒ…å« Reverse å’Œ Mobile æ–¹å‘çš„é¢˜ç›®ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://ctftime.org/">https://ctftime.org/</a></li>
</ul>
<hr />
<h2>CrackMe ç½‘ç«™</h2>
<h3>Crackmes.one</h3>
<ul>
<li><strong>æè¿°</strong>: å…¨çƒæœ€å¤§çš„ CrackMe æ”¶é›†ç½‘ç«™ã€‚ä½ å¯ä»¥é€šè¿‡æœç´¢ &quot;Android&quot; æˆ– &quot;APK&quot; æ ‡ç­¾æ‰¾åˆ°å¤§é‡çš„ Android é€†å‘ç»ƒä¹ ç¨‹åºï¼Œéš¾åº¦ä»ç®€å•åˆ°æéš¾éƒ½æœ‰ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://crackmes.one/">https://crackmes.one/</a></li>
</ul>
<h3>Root Me</h3>
<ul>
<li><strong>æè¿°</strong>: ä¸€ä¸ªæ¶µç›–å„ç§å®‰å…¨é¢†åŸŸçš„ç»ƒä¹ å¹³å°ï¼Œå…¶ &quot;Cracking&quot; å’Œ &quot;App - Script&quot; åˆ†ç±»ä¸‹æœ‰ä¸€äº›é’ˆå¯¹ç§»åŠ¨åº”ç”¨çš„æŒ‘æˆ˜ã€‚</li>
<li><strong>é“¾æ¥</strong>: <a href="https://www.root-me.org/">https://www.root-me.org/</a></li>
</ul>
<hr />
<h2>æ¨èç»ƒä¹ è·¯çº¿</h2>
<ol>
<li><strong>å…¥é—¨</strong>: ä» <strong>OWASP UnCrackable Level 1</strong> å¼€å§‹ï¼Œå­¦ä¹ åŸºæœ¬çš„åç¼–è¯‘ã€ä»£ç åˆ†æå’Œç®€å•çš„é€»è¾‘ç»•è¿‡ã€‚</li>
<li><strong>è¿›é˜¶</strong>: å°è¯• <strong>Crackmes.one</strong> ä¸Šè¯„åˆ†è¾ƒé«˜çš„ Android é¢˜ç›®ï¼Œæˆ–è€… <strong>Hack The Box</strong> çš„ç®€å• Mobile æŒ‘æˆ˜ã€‚</li>
<li><strong>é«˜çº§</strong>: æŒ‘æˆ˜ <strong>Google CTF</strong> çš„å†å²é¢˜ç›®ï¼Œæˆ–è€… <strong>OWASP UnCrackable Level 3/4</strong>ï¼Œä¸»è¦æ¶‰åŠå„ç§åè°ƒè¯•ã€Native å±‚æ··æ·†ã€å£³åˆ†æç­‰ã€‚</li>
</ol>
<hr />

                                            </div>
                                            
                                            <div class="section" id="section-86">
                                                <h2>86. Glossary</h2>
                                                <h1>æœ¯è¯­è¡¨ (Glossary)</h1>
<p>æ”¶é›†äº† Android é€†å‘å·¥ç¨‹ä¸­å¸¸è§çš„æœ¯è¯­å’Œç¼©å†™ã€‚</p>
<h2>A</h2>
<ul>
<li><strong>ADB (Android Debug Bridge)</strong>: Android è°ƒè¯•æ¡¥ï¼Œä¸€ä¸ªé€šç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ä½ ä¸æ¨¡æ‹Ÿå™¨å®ä¾‹æˆ–è¿æ¥çš„ Android è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</li>
<li><strong>AOSP (Android Open Source Project)</strong>: Android å¼€æºé¡¹ç›®ï¼Œå³ Android ç³»ç»Ÿçš„æºä»£ç ã€‚</li>
<li><strong>APK (Android Package)</strong>: Android åº”ç”¨ç¨‹åºåŒ…ï¼ŒAndroid æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ä¸€ç§åº”ç”¨ç¨‹åºåŒ…æ–‡ä»¶æ ¼å¼ã€‚</li>
<li><strong>ART (Android Runtime)</strong>: Android è¿è¡Œæ—¶ï¼ŒAndroid 5.0 å¼•å…¥çš„æ–°çš„åº”ç”¨è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®Œå…¨å–ä»£äº† Dalvikã€‚å®ƒä½¿ç”¨ AOT (Ahead-Of-Time) ç¼–è¯‘æŠ€æœ¯ã€‚</li>
<li><strong>ARM</strong>: ä¸€ç§ç²¾ç®€æŒ‡ä»¤é›† (RISC) å¤„ç†å™¨æ¶æ„ï¼Œå¹¿æ³›ç”¨äºç§»åŠ¨è®¾å¤‡ã€‚</li>
</ul>
<h2>B</h2>
<ul>
<li><strong>Bootloader</strong>: å¼•å¯¼åŠ è½½ç¨‹åºï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œä¹‹å‰è¿è¡Œçš„ä¸€æ®µå°ç¨‹åºï¼Œè´Ÿè´£åŠ è½½æ“ä½œç³»ç»Ÿã€‚</li>
<li><strong>Baksmali</strong>: ä¸€ä¸ªå°† dex æ–‡ä»¶åæ±‡ç¼–æˆ smali æ–‡ä»¶çš„å·¥å…·ã€‚</li>
</ul>
<h2>D</h2>
<ul>
<li><strong>Dalvik</strong>: Google æ—©æœŸä¸º Android è®¾è®¡çš„è™šæ‹Ÿæœºï¼Œä½¿ç”¨ JIT (Just-In-Time) ç¼–è¯‘ã€‚åœ¨ Android 5.0 åè¢« ART å–ä»£ã€‚</li>
<li><strong>DEX (Dalvik Executable)</strong>: Android å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼ŒåŒ…å«ç¼–è¯‘åçš„ä»£ç ã€‚</li>
<li><strong>Dynamic Analysis (åŠ¨æ€åˆ†æ)</strong>: åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹å…¶è¿›è¡Œåˆ†æçš„æŠ€æœ¯ï¼Œé€šå¸¸æ¶‰åŠè°ƒè¯•ã€Hook ç­‰ã€‚</li>
</ul>
<h2>E</h2>
<ul>
<li><strong>ELF (Executable and Linkable Format)</strong>: å¯æ‰§è¡Œä¸å¯é“¾æ¥æ ¼å¼ï¼ŒLinux ç³»ç»Ÿï¼ˆåŒ…æ‹¬ Android Native å±‚ï¼‰ä½¿ç”¨çš„æ ‡å‡†äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ã€‚</li>
</ul>
<h2>F</h2>
<ul>
<li><strong>Frida</strong>: ä¸€ä¸ªåŠ¨æ€æ’æ¡©å·¥å…·åŒ…ï¼Œå…è®¸å¼€å‘è€…ã€é€†å‘å·¥ç¨‹å¸ˆå’Œå®‰å…¨ç ”ç©¶äººå‘˜åœ¨è¿è¡Œæ—¶ç›‘è§†å’Œä¿®æ”¹åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚</li>
</ul>
<h2>G</h2>
<ul>
<li><strong>Ghidra</strong>: NSA å¼€æºçš„è½¯ä»¶é€†å‘å·¥ç¨‹ (SRE) æ¡†æ¶ã€‚</li>
</ul>
<h2>H</h2>
<ul>
<li><strong>Hooking (æŒ‚é’©)</strong>: ä¸€ç§æ‹¦æˆªè½¯ä»¶ç»„ä»¶ä¹‹é—´å‡½æ•°è°ƒç”¨ã€æ¶ˆæ¯æˆ–äº‹ä»¶çš„æŠ€æœ¯ï¼Œç”¨äºæ”¹å˜æˆ–ç›‘è§†ç³»ç»Ÿçš„è¡Œä¸ºã€‚</li>
</ul>
<h2>I</h2>
<ul>
<li><strong>IDA Pro (Interactive DisAssembler)</strong>: ä¸šç•Œæ ‡å‡†çš„äº¤äº’å¼åæ±‡ç¼–å™¨å’Œè°ƒè¯•å™¨ã€‚</li>
<li><strong>IL2CPP</strong>: Unity æ¸¸æˆå¼•æ“çš„ä¸€ç§è„šæœ¬åç«¯ï¼Œå°† C# ä»£ç è½¬æ¢ä¸º C++ ä»£ç ï¼Œå¢åŠ äº†é€†å‘éš¾åº¦ã€‚</li>
</ul>
<h2>J</h2>
<ul>
<li><strong>JADX</strong>: ä¸€ä¸ªå°† DEX æ–‡ä»¶åç¼–è¯‘ä¸º Java ä»£ç çš„å·¥å…·ã€‚</li>
<li><strong>JNI (Java Native Interface)</strong>: Java æœ¬åœ°æ¥å£ï¼Œå…è®¸ Java ä»£ç å’Œå…¶ä»–è¯­è¨€ï¼ˆä¸»è¦æ˜¯ C/C++ï¼‰å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚</li>
</ul>
<h2>M</h2>
<ul>
<li><strong>Magisk</strong>: ä¸€ä¸ªå¼€æºçš„ Android Root è§£å†³æ–¹æ¡ˆï¼Œä»¥ &quot;Systemless&quot;ï¼ˆä¸ä¿®æ”¹ç³»ç»Ÿåˆ†åŒºï¼‰è‘—ç§°ã€‚</li>
<li><strong>Manifest (AndroidManifest.xml)</strong>: æ¯ä¸ª Android åº”ç”¨éƒ½å¿…é¡»åŒ…å«çš„æ–‡ä»¶ï¼Œæè¿°äº†åº”ç”¨çš„åŒ…åã€ç»„ä»¶ã€æƒé™ç­‰åŸºæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<h2>N</h2>
<ul>
<li><strong>Native Code</strong>: é€šå¸¸æŒ‡ä½¿ç”¨ C/C++ ç¼–å†™çš„ï¼Œç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨ç çš„ä»£ç ï¼ˆç›¸å¯¹äº Java/Kotlin å­—èŠ‚ç ï¼‰ã€‚</li>
<li><strong>NDK (Native Development Kit)</strong>: ä¸€ä¸ªå·¥å…·é›†ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ C å’Œ C++ å®ç°åº”ç”¨çš„ä¸€éƒ¨åˆ†ã€‚</li>
</ul>
<h2>O</h2>
<ul>
<li><strong>Obfuscation (æ··æ·†)</strong>: ä½¿ä»£ç éš¾ä»¥ç†è§£ä½†ä¿æŒå…¶åŠŸèƒ½ä¸å˜çš„æŠ€æœ¯ï¼Œç”¨äºä¿æŠ¤çŸ¥è¯†äº§æƒæˆ–éšè—æ¶æ„è¡Œä¸ºã€‚</li>
<li><strong>OLLVM (Obfuscator-LLVM)</strong>: åŸºäº LLVM çš„ä»£ç æ··æ·†é¡¹ç›®ï¼Œå¸¸ç”¨äº Native ä»£ç æ··æ·†ã€‚</li>
<li><strong>OAT</strong>: ART è¿è¡Œæ—¶ä½¿ç”¨çš„ç§æœ‰ ELF æ–‡ä»¶æ ¼å¼ï¼ŒåŒ…å« AOT ç¼–è¯‘åçš„æœºå™¨ç ã€‚</li>
</ul>
<h2>R</h2>
<ul>
<li><strong>Recovery</strong>: Android è®¾å¤‡çš„æ¢å¤æ¨¡å¼ï¼Œç”¨äºæ¢å¤å‡ºå‚è®¾ç½®ã€åˆ·å…¥æ›´æ–°åŒ…ç­‰ã€‚</li>
<li><strong>Rooting</strong>: è·å– Android è®¾å¤‡è¶…çº§ç”¨æˆ· (Root) æƒé™çš„è¿‡ç¨‹ã€‚</li>
<li><strong>Riru</strong>: ä¸€ä¸ªç”¨äºæ³¨å…¥ Zygote è¿›ç¨‹çš„æ¨¡å—ï¼Œå¸¸ä½œä¸ºå…¶ä»–æ¨¡å—ï¼ˆå¦‚ LSPosedï¼‰çš„åŸºç¡€ã€‚</li>
</ul>
<h2>S</h2>
<ul>
<li><strong>Smali</strong>: Android çš„ Dalvik å­—èŠ‚ç çš„äººç±»å¯è¯»æ±‡ç¼–è¯­è¨€ã€‚</li>
<li><strong>Static Analysis (é™æ€åˆ†æ)</strong>: åœ¨ä¸è¿è¡Œç¨‹åºçš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œåˆ†æçš„æŠ€æœ¯ã€‚</li>
<li><strong>So (Shared Object)</strong>: Linux/Android ä¸‹çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œé€šå¸¸ç”± C/C++ ç¼–å†™ã€‚</li>
</ul>
<h2>V</h2>
<ul>
<li><strong>VMP (Virtual Machine Protection)</strong>: è™šæ‹Ÿæœºä¿æŠ¤ï¼Œä¸€ç§é«˜çº§æ··æ·†æŠ€æœ¯ï¼Œå°†åŸå§‹ä»£ç è½¬æ¢ä¸ºè‡ªå®šä¹‰å­—èŠ‚ç å¹¶åœ¨è‡ªå®šä¹‰è§£é‡Šå™¨ä¸­è¿è¡Œã€‚</li>
</ul>
<h2>X</h2>
<ul>
<li><strong>Xposed</strong>: ä¸€ä¸ªå¼ºå¤§çš„ Android æ¡†æ¶ï¼Œå…è®¸åœ¨ä¸ä¿®æ”¹ APK çš„æƒ…å†µä¸‹é€šè¿‡æ¨¡å—æ”¹å˜ç³»ç»Ÿå’Œåº”ç”¨çš„è¡Œä¸ºã€‚</li>
</ul>
<h2>Z</h2>
<ul>
<li><strong>Zygote</strong>: Android ç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚</li>
</ul>

                                            </div>
                                            </div>
        </body>
        </html>
        